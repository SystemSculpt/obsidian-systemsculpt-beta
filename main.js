/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[Object.keys(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// src/services/SystemPromptService.ts
var _SystemPromptService, SystemPromptService;
var init_SystemPromptService = __esm({
  "src/services/SystemPromptService.ts"() {
    _SystemPromptService = class {
      constructor(app) {
        this.app = app;
        if (!_SystemPromptService.initPromise && !_SystemPromptService.isInitializing) {
          _SystemPromptService.initializeCache();
        }
      }
      static setSystemSculptService(service) {
        _SystemPromptService.systemSculptService = service;
      }
      static isCacheValid() {
        if (!_SystemPromptService.cache)
          return false;
        const now = Date.now();
        return now - _SystemPromptService.cache.timestamp < _SystemPromptService.CACHE_DURATION;
      }
      static updateCache(prompts) {
        const byId = {};
        prompts.forEach((prompt) => {
          byId[prompt.id] = prompt;
        });
        _SystemPromptService.cache = {
          prompts,
          timestamp: Date.now(),
          byId
        };
      }
      static initializeCache() {
        if (_SystemPromptService.initPromise) {
          return _SystemPromptService.initPromise;
        }
        if (!_SystemPromptService.systemSculptService) {
          return Promise.reject(new Error("SystemSculptService not initialized"));
        }
        _SystemPromptService.isInitializing = true;
        _SystemPromptService.initPromise = fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`).then(async (response) => {
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
        }).catch((error) => {
          console.error("Error initializing system prompts cache:", error);
          _SystemPromptService.initPromise = null;
        }).finally(() => {
          _SystemPromptService.isInitializing = false;
        });
        return _SystemPromptService.initPromise;
      }
      async ensureCacheInitialized() {
        if (_SystemPromptService.isCacheValid())
          return;
        if (_SystemPromptService.initPromise) {
          await _SystemPromptService.initPromise;
          return;
        }
        await _SystemPromptService.initializeCache();
      }
      async getSystemPrompts() {
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && _SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
          return data.prompts;
        } catch (error) {
          console.error("Error fetching system prompts:", error);
          if (_SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          throw error;
        }
      }
      async getSystemPromptById(id) {
        var _a, _b, _c;
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && ((_a = _SystemPromptService.cache) == null ? void 0 : _a.byId[id])) {
            return _SystemPromptService.cache.byId[id];
          }
          await this.getSystemPrompts();
          return ((_b = _SystemPromptService.cache) == null ? void 0 : _b.byId[id]) || null;
        } catch (error) {
          console.error(`Error fetching system prompt ${id}:`, error);
          if ((_c = _SystemPromptService.cache) == null ? void 0 : _c.byId[id]) {
            return _SystemPromptService.cache.byId[id];
          }
          throw error;
        }
      }
      async getSystemPromptTemplate() {
        try {
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts/template`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompt template: ${response.statusText}`);
          }
          const data = await response.json();
          return data.template;
        } catch (error) {
          console.error("Error fetching system prompt template:", error);
          throw error;
        }
      }
      async refreshCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
        await _SystemPromptService.initializeCache();
      }
      static clearCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
      }
    };
    SystemPromptService = _SystemPromptService;
    SystemPromptService.cache = null;
    SystemPromptService.CACHE_DURATION = 60 * 60 * 1e3;
    SystemPromptService.initPromise = null;
    SystemPromptService.isInitializing = false;
  }
});

// src/utils/errors.ts
function getErrorMessage(code, model) {
  const message = ERROR_MESSAGES[code];
  if (typeof message === "function") {
    return message(model);
  }
  return message;
}
var ERROR_CODES, ERROR_MESSAGES, SystemSculptError;
var init_errors = __esm({
  "src/utils/errors.ts"() {
    ERROR_CODES = {
      INVALID_LICENSE: "INVALID_LICENSE",
      LICENSE_EXPIRED: "LICENSE_EXPIRED",
      LICENSE_DISABLED: "LICENSE_DISABLED",
      PRO_REQUIRED: "PRO_REQUIRED",
      MODEL_UNAVAILABLE: "MODEL_UNAVAILABLE",
      MODEL_REQUEST_ERROR: "MODEL_REQUEST_ERROR",
      STREAM_ERROR: "STREAM_ERROR",
      INVALID_RESPONSE: "INVALID_RESPONSE",
      NO_IMAGE: "NO_IMAGE",
      FILE_NOT_FOUND: "FILE_NOT_FOUND",
      FILE_TOO_LARGE: "FILE_TOO_LARGE",
      UNSUPPORTED_FORMAT: "UNSUPPORTED_FORMAT",
      PROCESSING_ERROR: "PROCESSING_ERROR",
      UNKNOWN_ERROR: "UNKNOWN_ERROR",
      QUOTA_EXCEEDED: "QUOTA_EXCEEDED"
    };
    ERROR_MESSAGES = {
      [ERROR_CODES.INVALID_LICENSE]: "Invalid license key. Please check and try again.",
      [ERROR_CODES.LICENSE_EXPIRED]: "Your license has expired.",
      [ERROR_CODES.LICENSE_DISABLED]: "This license has been disabled.",
      [ERROR_CODES.PRO_REQUIRED]: "This feature requires a Pro subscription. Please upgrade.",
      [ERROR_CODES.MODEL_UNAVAILABLE]: (model) => `Model ${model || ""} is currently unavailable.`,
      [ERROR_CODES.MODEL_REQUEST_ERROR]: (model) => `Model ${model || ""} cannot process this request.`,
      [ERROR_CODES.STREAM_ERROR]: "Streaming failed. Please try again.",
      [ERROR_CODES.INVALID_RESPONSE]: "Invalid response received from server. Please try again.",
      [ERROR_CODES.UNKNOWN_ERROR]: "An unexpected error occurred. Please try again or contact support.",
      [ERROR_CODES.QUOTA_EXCEEDED]: "You have exceeded your quota. Please upgrade your plan.",
      [ERROR_CODES.NO_IMAGE]: "No image in clipboard",
      [ERROR_CODES.FILE_NOT_FOUND]: "File not found",
      [ERROR_CODES.FILE_TOO_LARGE]: "File too large (max 10MB)",
      [ERROR_CODES.UNSUPPORTED_FORMAT]: "Unsupported file format",
      [ERROR_CODES.PROCESSING_ERROR]: "Failed to process file"
    };
    SystemSculptError = class extends Error {
      constructor(message, code = ERROR_CODES.UNKNOWN_ERROR, statusCode = 500, metadata) {
        super(message);
        this.code = code;
        this.statusCode = statusCode;
        this.metadata = metadata;
        this.name = "SystemSculptError";
      }
    };
  }
});

// src/utils/ImageProcessor.ts
var _ImageProcessor, ImageProcessor;
var init_ImageProcessor = __esm({
  "src/utils/ImageProcessor.ts"() {
    init_errors();
    _ImageProcessor = class {
      static async processImage(file, app) {
        if (!file) {
          throw new SystemSculptError("File not found", "FILE_NOT_FOUND", 404);
        }
        if (file.stat.size > _ImageProcessor.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        const extension = file.extension.toLowerCase();
        if (!_ImageProcessor.SUPPORTED_FORMATS.has(extension)) {
          throw new SystemSculptError("Unsupported image format", "UNSUPPORTED_FORMAT", 415);
        }
        try {
          const arrayBuffer = await app.vault.readBinary(file);
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              const dataUrl = reader.result;
              resolve(dataUrl);
            };
            reader.onerror = () => reject(reader.error);
            const type = `image/${extension === "jpg" ? "jpeg" : extension}`;
            const blob = new Blob([arrayBuffer], { type });
            reader.readAsDataURL(blob);
          });
          return base64;
        } catch (error) {
          console.error("Image processing failed:", error);
          throw new SystemSculptError("Failed to process image", "PROCESSING_ERROR", 500);
        }
      }
      static async processClipboardImage(clipboardData) {
        const file = clipboardData.files[0];
        if (!file || !file.type.startsWith("image/")) {
          throw new SystemSculptError("No image in clipboard", "NO_IMAGE", 400);
        }
        if (file.size > this.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(reader.error);
          reader.readAsDataURL(file);
        });
      }
    };
    ImageProcessor = _ImageProcessor;
    ImageProcessor.MAX_FILE_SIZE = 10 * 1024 * 1024;
    ImageProcessor.SUPPORTED_FORMATS = new Set([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp"
    ]);
  }
});

// src/constants/api.ts
var API_BASE_URL, SYSTEMSCULPT_API_ENDPOINTS, SYSTEMSCULPT_API_HEADERS;
var init_api = __esm({
  "src/constants/api.ts"() {
    API_BASE_URL = window.location.hostname === "localhost" ? "http://localhost:3001/api/v1" : "https://api.systemsculpt.com/api/v1";
    SYSTEMSCULPT_API_ENDPOINTS = {
      LICENSE: {
        VALIDATE: (key) => `/api/v1/license/validate/${key}`
      },
      MODELS: {
        LIST: "/api/v1/models",
        GET: (modelId) => `/api/v1/models/${modelId}`
      },
      CHAT: {
        COMPLETIONS: "/api/v1/chat/completions"
      },
      SYSTEM_PROMPTS: {
        GET: (id) => `/api/v1/system-prompts/${id}`,
        LIST: "/api/v1/system-prompts"
      },
      DOCUMENTS: {
        PROCESS: "/api/v1/documents/process",
        GET: (id) => `/api/v1/documents/${id}`,
        DOWNLOAD: (id) => `/api/v1/documents/${id}/download`
      }
    };
    SYSTEMSCULPT_API_HEADERS = {
      DEFAULT: {
        "Content-Type": "application/json"
      },
      WITH_LICENSE: (licenseKey) => ({
        ...SYSTEMSCULPT_API_HEADERS.DEFAULT,
        Authorization: `Bearer ${licenseKey}`
      })
    };
  }
});

// src/services/SystemSculptService.ts
function generateUUID() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var import_obsidian, _SystemSculptService, SystemSculptService;
var init_SystemSculptService = __esm({
  "src/services/SystemSculptService.ts"() {
    import_obsidian = __toModule(require("obsidian"));
    init_SystemPromptService();
    init_errors();
    init_ImageProcessor();
    init_api();
    _SystemSculptService = class {
      constructor(settings, app) {
        this.isInsideThinkTags = false;
        this.hasLoggedDevMode = false;
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
        this.app = app;
      }
      get baseUrl() {
        if (!this.hasLoggedDevMode) {
          this.hasLoggedDevMode = true;
        }
        if (this.settings.developmentMode) {
          return this.settings.serverUrl;
        }
        return "https://api.systemsculpt.com";
      }
      get extractionsDirectory() {
        var _a;
        return (_a = this.settings.extractionsDirectory) != null ? _a : "";
      }
      static getInstance(settings, app) {
        if (!_SystemSculptService.instance) {
          _SystemSculptService.instance = new _SystemSculptService(settings, app);
        } else {
          _SystemSculptService.instance.settings = settings;
          _SystemSculptService.instance.licenseKey = settings.licenseKey;
        }
        return _SystemSculptService.instance;
      }
      updateSettings(settings) {
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
      }
      async makeRequest(endpoint, options = {}) {
        if (options.requiresPro && !endpoint.includes("/license/validate")) {
          const isValid = await this.validateLicense(true);
          if (!isValid) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.PRO_REQUIRED), ERROR_CODES.PRO_REQUIRED, 403);
          }
        }
        const headers = this.licenseKey ? SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey) : SYSTEMSCULPT_API_HEADERS.DEFAULT;
        const url = `${this.baseUrl}${endpoint}`;
        const response = await (0, import_obsidian.requestUrl)({
          url,
          method: options.method || "GET",
          headers: {
            ...headers,
            ...options.headers || {}
          },
          body: options.body,
          throw: false
        });
        let apiResponse;
        try {
          apiResponse = response.json;
        } catch (e) {
          throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, response.status);
        }
        if (response.status !== 200 || apiResponse.status === "error") {
          this.handleApiError(endpoint, response, apiResponse);
        }
        return apiResponse.data !== void 0 ? apiResponse.data : apiResponse;
      }
      handleApiError(endpoint, response, apiResponse) {
        if (apiResponse.error) {
          const errorCode = apiResponse.error.code || ERROR_CODES.UNKNOWN_ERROR;
          const statusCode = apiResponse.error.statusCode || response.status;
          const errorMessage = getErrorMessage(errorCode, apiResponse.error.model);
          const metadata = {};
          if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
            metadata.shouldResubmit = true;
            metadata.model = apiResponse.error.model;
          }
          throw new SystemSculptError(errorMessage, errorCode, statusCode, metadata);
        }
        throw new SystemSculptError(getErrorMessage(ERROR_CODES.UNKNOWN_ERROR), ERROR_CODES.UNKNOWN_ERROR, response.status);
      }
      async handleStreamError(response, isCustomProvider = false) {
        var _a, _b, _c, _d;
        console.error("Stream error response:", {
          status: response.status,
          statusText: response.statusText,
          contentType: response.headers.get("content-type"),
          isCustomProvider
        });
        let errorCode = ERROR_CODES.STREAM_ERROR;
        let metadata = {};
        try {
          const errorData = await response.json();
          console.error("Stream error data:", errorData);
          if (isCustomProvider) {
            metadata.rawError = errorData;
            metadata.provider = "custom";
            if (response.status === 401) {
              errorCode = ERROR_CODES.INVALID_LICENSE;
              throw new SystemSculptError(((_a = errorData.error) == null ? void 0 : _a.message) || "Invalid API key for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 429) {
              errorCode = ERROR_CODES.QUOTA_EXCEEDED;
              throw new SystemSculptError(((_b = errorData.error) == null ? void 0 : _b.message) || "Rate limit exceeded for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 404) {
              errorCode = ERROR_CODES.MODEL_UNAVAILABLE;
              throw new SystemSculptError(((_c = errorData.error) == null ? void 0 : _c.message) || "Model not found or endpoint incorrect", errorCode, response.status, metadata);
            }
            throw new SystemSculptError(((_d = errorData.error) == null ? void 0 : _d.message) || response.statusText, errorCode, response.status, metadata);
          }
          if (errorData.error) {
            errorCode = errorData.error.code || ERROR_CODES.STREAM_ERROR;
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata = {
                model: errorData.error.model,
                shouldResubmit: true,
                rawError: errorData
              };
            }
          }
        } catch (e) {
          console.error("Error parsing error response:", e);
          if (e instanceof SystemSculptError) {
            throw e;
          }
          errorCode = ERROR_CODES.STREAM_ERROR;
        }
        throw new SystemSculptError(getErrorMessage(errorCode, metadata.model), errorCode, response.status, metadata);
      }
      async validateLicense(forceCheck = false) {
        if (!this.licenseKey)
          return false;
        try {
          await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
            method: "GET",
            headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
          });
          return true;
        } catch (e) {
          return false;
        }
      }
      async getModels() {
        try {
          const response = await this.makeRequest("/api/v1/models", {
            method: "GET"
          });
          if (!response || !Array.isArray(response.models)) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, 500);
          }
          const systemsculptModels = response.models.map((model) => ({
            ...model,
            provider: "systemsculpt"
          }));
          return systemsculptModels;
        } catch (error) {
          throw error;
        }
      }
      async getTokenBalance() {
        const isValid = await this.validateLicense(true);
        if (!isValid)
          return 0;
        const licenseInfo = await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
          method: "GET",
          headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
        });
        return licenseInfo.credits_balance || 0;
      }
      async getContextFileContents(filePath) {
        try {
          const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
          const cleanPath = linkText.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            if (resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
              const base64 = await ImageProcessor.processImage(resolvedFile, this.app);
              return { type: "image", base64 };
            }
            const content = await this.app.vault.read(resolvedFile);
            return content;
          }
          const fileName = cleanPath.split("/").pop();
          if (fileName) {
            const allFiles = this.app.vault.getFiles();
            const matchingFile = allFiles.find((f) => f.name === fileName);
            if (matchingFile) {
              if (matchingFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
                const base64 = await ImageProcessor.processImage(matchingFile, this.app);
                return { type: "image", base64 };
              }
              const content = await this.app.vault.read(matchingFile);
              return content;
            }
          }
          return null;
        } catch (error) {
          return null;
        }
      }
      async buildContextMessageFromFile(filePath) {
        const content = await this.getContextFileContents(filePath);
        const displayName = filePath.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
        if (content) {
          if (typeof content === "string") {
            return {
              role: "user",
              content: `Context from ${displayName}:

${content}`,
              message_id: generateUUID()
            };
          } else if (content.type === "image") {
            return {
              role: "user",
              content: [
                {
                  type: "text",
                  text: `Context from ${displayName}:

`
                },
                {
                  type: "image_url",
                  image_url: {
                    url: `data:image/png;base64,${content.base64.replace(/^data:.*;base64,/, "")}`
                  }
                }
              ],
              message_id: generateUUID()
            };
          }
        }
        return null;
      }
      async prepareMessagesWithContext(messages, contextFiles, systemPromptType, systemPromptPath) {
        const preparedMessages = [];
        let systemPromptContent;
        if (systemPromptType === "custom" && systemPromptPath) {
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(systemPromptPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            systemPromptContent = await this.app.vault.read(resolvedFile);
          } else {
            const fileWithExt = this.app.vault.getAbstractFileByPath(`${systemPromptPath}.md`);
            if (fileWithExt instanceof import_obsidian.TFile) {
              systemPromptContent = await this.app.vault.read(fileWithExt);
            } else {
              const fileInSystemPromptsDir = this.app.vault.getAbstractFileByPath(`SystemSculpt/System Prompts/${systemPromptPath}.md`);
              if (fileInSystemPromptsDir instanceof import_obsidian.TFile) {
                systemPromptContent = await this.app.vault.read(fileInSystemPromptsDir);
              }
            }
          }
        } else if (systemPromptType) {
          try {
            const systemPromptService = new SystemPromptService(this.app);
            const preset = await systemPromptService.getSystemPromptById(systemPromptType);
            if (preset) {
              systemPromptContent = preset.systemPrompt;
            }
          } catch (error) {
          }
        }
        if (systemPromptContent) {
          preparedMessages.push({
            role: "system",
            content: systemPromptContent,
            message_id: crypto.randomUUID(),
            systemPromptType,
            systemPromptPath
          });
        }
        const documentIds = [];
        for (const filePath of contextFiles) {
          if (filePath.startsWith("doc:")) {
            const documentId = filePath.substring(4);
            documentIds.push(documentId);
          } else {
            const contextMessage = await this.buildContextMessageFromFile(filePath);
            if (contextMessage) {
              preparedMessages.push(contextMessage);
            }
          }
        }
        if (documentIds.length > 0) {
          const firstMessage = messages[0];
          if (firstMessage) {
            firstMessage.documentContext = { documentIds };
          }
        }
        for (const msg of messages) {
          preparedMessages.push({
            role: msg.role,
            content: msg.content,
            message_id: msg.message_id || generateUUID(),
            documentContext: msg.documentContext,
            systemPromptType: msg.systemPromptType,
            systemPromptPath: msg.systemPromptPath
          });
        }
        return preparedMessages;
      }
      normalizeDataPrefix(line) {
        if (!(line == null ? void 0 : line.trim()))
          return "";
        const trimmed = line.trim();
        if (trimmed === "data:" || trimmed === "data: " || trimmed === "[DONE]" || trimmed.startsWith(": OPENROUTER")) {
          return "";
        }
        return trimmed.replace(/^(?:data:\s*)+/, "");
      }
      isValidStreamEvent(data, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _i;
        if (!data)
          return false;
        try {
          const parsed = JSON.parse(data);
          return !!(parsed && (((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || ((_i = (_h = (_g = parsed.choices) == null ? void 0 : _g[0]) == null ? void 0 : _h.delta) == null ? void 0 : _i.function_call) || parsed.error));
        } catch (e) {
          return false;
        }
      }
      processStreamLine(line, isCustomProvider = false) {
        if (!line.trim().startsWith("data:")) {
          return null;
        }
        const normalized = this.normalizeDataPrefix(line);
        return this.isValidStreamEvent(normalized, isCustomProvider) ? normalized : null;
      }
      async handleStreamEvent(event, model, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f;
        if (!event)
          return null;
        try {
          let parsed;
          try {
            parsed = JSON.parse(event);
          } catch (parseError) {
            return null;
          }
          if (!parsed)
            return null;
          if (parsed.error) {
            const errorCode = parsed.error.code || ERROR_CODES.STREAM_ERROR;
            let errorMessage = parsed.error.message || getErrorMessage(errorCode, model);
            const metadata = {
              model,
              shouldResubmit: false,
              rawError: parsed.error,
              originalEvent: event
            };
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata.shouldResubmit = true;
            }
            throw new SystemSculptError(errorMessage, errorCode, parsed.error.statusCode || 500, metadata);
          }
          const content = ((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || null;
          const reasoning = ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || null;
          if (this.isInsideThinkTags) {
            let combinedText = "";
            if (reasoning)
              combinedText += reasoning;
            if (content)
              combinedText += content;
            const thinkEndMatch = combinedText.match(/(.*?)\s*<\/think>\s*(.*)/);
            if (thinkEndMatch) {
              this.isInsideThinkTags = false;
              return {
                reasoning: thinkEndMatch[1] || "",
                content: thinkEndMatch[2] || ""
              };
            }
            return {
              content: null,
              reasoning: combinedText || null
            };
          } else {
            if (content) {
              const thinkStartMatch = content.match(/<think>\s*(.*)/);
              if (thinkStartMatch) {
                this.isInsideThinkTags = true;
                return {
                  content: null,
                  reasoning: thinkStartMatch[1] || ""
                };
              }
            }
          }
          return { content, reasoning };
        } catch (e) {
          if (e instanceof SystemSculptError) {
            throw e;
          }
          return null;
        }
      }
      async processStreamChunk(chunk, buffer, model, isCustomProvider = false) {
        const decoded = _SystemSculptService.decoder.decode(chunk, { stream: true });
        const fullChunk = buffer + decoded;
        const lines = fullChunk.split("\n");
        const contents = [];
        const reasonings = [];
        for (let i = 0; i < lines.length - 1; i++) {
          const event = this.processStreamLine(lines[i], isCustomProvider);
          if (event) {
            const result = await this.handleStreamEvent(event, model, isCustomProvider);
            if (result) {
              if (result.content)
                contents.push(result.content);
              if (result.reasoning)
                reasonings.push(result.reasoning);
            }
          }
        }
        const newBuffer = lines[lines.length - 1].trim() ? lines[lines.length - 1] : "";
        return { newBuffer, contents, reasonings };
      }
      stripProviderPrefixes(modelId) {
        return modelId.replace(/^openrouter\//, "");
      }
      async getModelInfo(modelId) {
        if (this.settings.activeProvider.type === "custom") {
          const activeProvider = this.settings.customProviders.find((p) => p.id === this.settings.activeProvider.id && p.isEnabled);
          if (!activeProvider) {
            throw new SystemSculptError(`Provider ${this.settings.activeProvider.name} not found or disabled`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
          }
          return {
            isCustom: true,
            provider: activeProvider,
            actualModelId: modelId
          };
        }
        return {
          isCustom: false,
          actualModelId: this.stripProviderPrefixes(modelId)
        };
      }
      async handleCustomProviderCompletion(provider, messages, temperature, modelId, signal) {
        const endpoint = provider.endpoint.trim().replace(/\/$/, "");
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${provider.apiKey}`
        };
        if (endpoint.includes("openrouter.ai")) {
          headers["HTTP-Referer"] = "https://systemsculpt.com";
          headers["X-Title"] = "SystemSculpt AI";
        }
        const requestBody = {
          model: modelId,
          messages: messages.map((msg) => ({
            role: msg.role,
            content: msg.content
          })),
          temperature,
          stream: true,
          ...endpoint.includes("openrouter.ai") && {
            include_reasoning: true
          }
        };
        const response = await fetch(`${endpoint}/chat/completions`, {
          method: "POST",
          headers,
          body: JSON.stringify(requestBody),
          signal
        });
        if (!response.ok) {
          await this.handleStreamError(response, true);
        }
        return response;
      }
      async *streamMessage({
        messages,
        model,
        temperature = 0.7,
        onError,
        contextFiles,
        systemPromptType,
        systemPromptPath,
        signal
      }) {
        try {
          this.isInsideThinkTags = false;
          const preparedMessages = await this.prepareMessagesWithContext(messages, contextFiles || new Set(), systemPromptType, systemPromptPath);
          const { isCustom, provider, actualModelId } = await this.getModelInfo(model);
          let response;
          if (isCustom && provider) {
            response = await this.handleCustomProviderCompletion(provider, preparedMessages, temperature, actualModelId, signal);
          } else {
            const requestBody = {
              model: actualModelId,
              messages: preparedMessages,
              temperature,
              stream: true,
              include_reasoning: true
            };
            response = await fetch(`${this.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.CHAT.COMPLETIONS}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "text/event-stream",
                "Cache-Control": "no-cache",
                "X-Request-ID": crypto.randomUUID(),
                "x-license-key": this.licenseKey
              },
              body: JSON.stringify(requestBody),
              signal
            });
          }
          if (!response.ok) {
            await this.handleStreamError(response, !!provider);
          }
          if (!response.body) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.STREAM_ERROR), ERROR_CODES.STREAM_ERROR, response.status);
          }
          const reader = response.body.getReader();
          let buffer = "";
          try {
            while (true) {
              const { done, value } = await reader.read();
              if (done) {
                const finalChunk = _SystemSculptService.decoder.decode();
                if (finalChunk) {
                  const event = this.processStreamLine(finalChunk);
                  if (event) {
                    const result = await this.handleStreamEvent(event, model, !!provider);
                    if (result) {
                      if (result.content || result.reasoning) {
                        yield {
                          content: result.content || void 0,
                          reasoning: result.reasoning || void 0
                        };
                      }
                    }
                  }
                }
                break;
              }
              const { newBuffer, contents, reasonings } = await this.processStreamChunk(value, buffer, model, !!provider);
              buffer = newBuffer;
              for (let i = 0; i < Math.max(contents.length, reasonings.length); i++) {
                yield {
                  content: contents[i],
                  reasoning: reasonings[i]
                };
              }
            }
          } finally {
            reader.releaseLock();
          }
        } catch (error) {
          if (error instanceof DOMException && error.name === "AbortError") {
            return;
          }
          if (onError) {
            let errorMessage = error instanceof Error ? error.message : getErrorMessage(ERROR_CODES.UNKNOWN_ERROR);
            if (error instanceof SystemSculptError && error.code === ERROR_CODES.STREAM_ERROR && error.statusCode === 400) {
              errorMessage += "\nPlease try again in a few moments. If the issue persists, try selecting a different model.";
            }
            onError(errorMessage);
          }
          throw error;
        }
      }
      async uploadDocument(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/documents/process`, {
            method: "POST",
            headers: {
              "x-license-key": this.licenseKey
            },
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          throw error;
        }
      }
      async uploadAudio(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/audio/transcriptions`, {
            method: "POST",
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Audio upload failed: ${response.status}`);
          }
          const result = await response.json();
          return result;
        } catch (error) {
          throw error;
        }
      }
      async preloadModels() {
        return Promise.resolve();
      }
    };
    SystemSculptService = _SystemSculptService;
    SystemSculptService.decoder = new TextDecoder();
  }
});

// src/core/ui/components/LoadingIndicator.ts
var init_LoadingIndicator = __esm({
  "src/core/ui/components/LoadingIndicator.ts"() {
  }
});

// src/core/ui/components/Button.ts
var init_Button = __esm({
  "src/core/ui/components/Button.ts"() {
  }
});

// src/core/ui/modals/TextAreaModal.ts
var import_obsidian2, TextAreaModal;
var init_TextAreaModal = __esm({
  "src/core/ui/modals/TextAreaModal.ts"() {
    import_obsidian2 = __toModule(require("obsidian"));
    TextAreaModal = class extends import_obsidian2.Modal {
      constructor(app, title, initialContent, options) {
        super(app);
        this.title = title;
        this.initialContent = initialContent;
        this.options = options;
        this.result = null;
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
      }
      onOpen() {
        var _a, _b, _c, _d, _e, _f;
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText(this.title);
        this.titleEl.addClass("systemsculpt-modal-title");
        const textAreaContainer = contentEl.createDiv("systemsculpt-textarea-container");
        if (((_a = this.options) == null ? void 0 : _a.presetButtons) && this.options.presetButtons.length > 0) {
          const presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
          this.options.presetButtons.forEach((preset) => {
            const button = presetButtonContainer.createEl("button", {
              text: preset.label,
              cls: "systemsculpt-preset-button"
            });
            button.onclick = () => {
              this.textArea.value = preset.value;
              const event = new Event("input", { bubbles: true });
              this.textArea.dispatchEvent(event);
            };
          });
        }
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            rows: ((_c = (_b = this.options) == null ? void 0 : _b.rows) == null ? void 0 : _c.toString()) || "10",
            placeholder: ((_d = this.options) == null ? void 0 : _d.placeholder) || ""
          }
        });
        this.textArea.value = this.initialContent;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = contentEl.createDiv("systemsculpt-button-container");
        if ((_e = this.options) == null ? void 0 : _e.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            text: this.options.secondaryButton,
            cls: "systemsculpt-button"
          });
          secondaryButton.onclick = () => {
            this.result = null;
            this.close();
          };
        }
        const primaryButton = buttonContainer.createEl("button", {
          text: ((_f = this.options) == null ? void 0 : _f.primaryButton) || "Save",
          cls: "systemsculpt-button mod-cta"
        });
        primaryButton.onclick = () => {
          this.result = this.textArea.value;
          this.close();
        };
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/core/ui/modals/PopupModal.ts
function showPopup(app, message, options) {
  return new Promise((resolve) => {
    const modal = new import_obsidian3.Modal(app);
    modal.modalEl.addClass("systemsculpt-modal");
    modal.modalEl.style.setProperty("--modal-border-width", "0");
    modal.titleEl.setText((options == null ? void 0 : options.title) || "SystemSculpt AI");
    modal.titleEl.addClass("systemsculpt-modal-title");
    if (options == null ? void 0 : options.description) {
      const descriptionEl = modal.titleEl.createDiv();
      descriptionEl.addClass("systemsculpt-modal-description");
      descriptionEl.setText(options.description);
      descriptionEl.style.color = "var(--text-muted)";
      descriptionEl.style.fontSize = "0.9em";
      descriptionEl.style.marginTop = "0.2em";
      descriptionEl.style.marginBottom = "1em";
    }
    const { contentEl } = modal;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal-content");
    contentEl.style.padding = "0";
    const inputValues = [];
    if (message && message.trim() && (!(options == null ? void 0 : options.title) || message !== options.title)) {
      const messageContainer = contentEl.createDiv("systemsculpt-message-container");
      messageContainer.style.marginTop = "1em";
      messageContainer.style.marginBottom = "0.5em";
      const messageEl = messageContainer.createDiv("systemsculpt-message-text");
      messageEl.setText(message);
    }
    if (options == null ? void 0 : options.inputs) {
      const inputContainer = contentEl.createDiv("systemsculpt-input-container");
      inputContainer.style.padding = "0 1em";
      if (options.inputs.some((input) => {
        var _a;
        return (_a = input.className) == null ? void 0 : _a.includes("systemsculpt-prompt-creation");
      })) {
        inputContainer.addClass("systemsculpt-prompt-creation-container");
      }
      options.inputs.forEach((input, index) => {
        const inputEl = inputContainer.createEl(input.type === "textarea" ? "textarea" : "input", {
          type: input.type === "textarea" ? void 0 : input.type,
          placeholder: input.placeholder,
          attr: input.required ? { required: "" } : {}
        });
        if (input.className) {
          inputEl.addClass(input.className);
        } else {
          inputEl.style.width = "100%";
          inputEl.style.marginBottom = "0.5em";
        }
        if (input.value) {
          if (input.type === "textarea") {
            inputEl.value = input.value;
          } else {
            inputEl.setAttribute("value", input.value);
          }
          inputValues[index] = input.value;
        }
        inputEl.addEventListener("input", () => {
          inputValues[index] = inputEl.value;
        });
      });
    }
    const buttonContainer = contentEl.createDiv("systemsculpt-button-container");
    buttonContainer.style.marginTop = "1em";
    let wasHandled = false;
    if (options == null ? void 0 : options.secondaryButton) {
      const secondaryButton = buttonContainer.createEl("button", {
        text: options.secondaryButton,
        cls: "systemsculpt-button"
      });
      secondaryButton.onclick = () => {
        wasHandled = true;
        modal.close();
        resolve({ confirmed: false });
      };
    }
    const primaryButton = buttonContainer.createEl("button", {
      text: (options == null ? void 0 : options.primaryButton) || "Close",
      cls: "systemsculpt-button mod-cta"
    });
    const handleConfirm = () => {
      var _a;
      const allInputsValid = !((_a = options == null ? void 0 : options.inputs) == null ? void 0 : _a.some((input, i) => input.required && !inputValues[i]));
      if (allInputsValid) {
        wasHandled = true;
        modal.close();
        resolve({
          confirmed: true,
          inputs: (options == null ? void 0 : options.inputs) ? inputValues : void 0
        });
      }
    };
    primaryButton.onclick = handleConfirm;
    modal.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey) {
        e.preventDefault();
        handleConfirm();
      } else if (e.key === "Escape") {
        e.preventDefault();
        wasHandled = true;
        modal.close();
        resolve({ confirmed: false });
      }
    });
    modal.onClose = () => {
      if (!wasHandled) {
        resolve({ confirmed: false });
      }
    };
    if (options == null ? void 0 : options.inputs) {
      const firstInput = contentEl.querySelector("input");
      if (firstInput) {
        firstInput.focus();
      }
    }
    modal.open();
  });
}
var import_obsidian3;
var init_PopupModal = __esm({
  "src/core/ui/modals/PopupModal.ts"() {
    import_obsidian3 = __toModule(require("obsidian"));
  }
});

// src/core/ui/components/Notice.ts
function showEnhancedNotice(message, type, error) {
  if (error) {
    console.error("Notice error details:", {
      error,
      message: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
  }
  let duration;
  switch (type) {
    case "error":
      duration = 1e4;
      break;
    case "warning":
      duration = 5e3;
      break;
    default:
      duration = 3e3;
  }
  const notice = new import_obsidian4.Notice(message, duration);
  return notice;
}
var import_obsidian4;
var init_Notice = __esm({
  "src/core/ui/components/Notice.ts"() {
    import_obsidian4 = __toModule(require("obsidian"));
    init_errors();
  }
});

// src/core/ui/index.ts
var init_ui = __esm({
  "src/core/ui/index.ts"() {
    init_LoadingIndicator();
    init_Button();
    init_TextAreaModal();
    init_PopupModal();
    init_Notice();
  }
});

// src/components/FileSuggester.ts
function getFileSuggestions(app, directory) {
  const files = app.vault.getAllLoadedFiles().filter((file) => {
    var _a;
    if (!(file instanceof import_obsidian8.TFile))
      return false;
    const fileDir = (_a = file.parent) == null ? void 0 : _a.path;
    return fileDir === directory && file.extension === "md";
  });
  return new Set(files.map((file) => file.path));
}
function attachFileSuggester(inputEl, onSelect, app, directory) {
  return new FileSuggester(inputEl, onSelect, app, directory);
}
var import_obsidian8, FileSuggester;
var init_FileSuggester = __esm({
  "src/components/FileSuggester.ts"() {
    import_obsidian8 = __toModule(require("obsidian"));
    FileSuggester = class extends import_obsidian8.AbstractInputSuggest {
      constructor(inputEl, onSelectCb, app, directory) {
        super(app, inputEl);
        this.inputEl = inputEl;
        this.onSelectCb = onSelectCb;
        this.directory = directory;
        this.content = getFileSuggestions(app, directory);
      }
      getSuggestions(inputStr) {
        const lowerCaseInputStr = inputStr.toLowerCase();
        return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
      }
      renderSuggestion(content, el) {
        let display = content.replace(/\.md$/, "");
        el.setText(display);
      }
      selectSuggestion(content, evt) {
        this.onSelectCb(content);
        this.inputEl.value = content.replace(/\.md$/, "");
        this.inputEl.blur();
        this.close();
      }
    };
  }
});

// src/modals/PostProcessingPromptModal.ts
var PostProcessingPromptModal_exports = {};
__export(PostProcessingPromptModal_exports, {
  PostProcessingPromptModal: () => PostProcessingPromptModal,
  showPostProcessingPromptModal: () => showPostProcessingPromptModal
});
async function showPostProcessingPromptModal(app, plugin, currentPrompt, options) {
  const modal = new PostProcessingPromptModal(app, plugin, currentPrompt, options == null ? void 0 : options.systemPromptsDirectory, options == null ? void 0 : options.currentCustomPath);
  return await modal.openAndGetValue();
}
var import_obsidian10, PostProcessingPromptModal;
var init_PostProcessingPromptModal = __esm({
  "src/modals/PostProcessingPromptModal.ts"() {
    import_obsidian10 = __toModule(require("obsidian"));
    init_ui();
    init_FileSuggester();
    init_SystemSculptService();
    PostProcessingPromptModal = class extends import_obsidian10.Modal {
      constructor(app, plugin, currentPrompt, systemPromptsDirectory = "SystemSculpt/System Prompts", currentCustomPath) {
        super(app);
        this.plugin = plugin;
        this.currentPrompt = currentPrompt;
        this.systemPromptsDirectory = systemPromptsDirectory;
        this.currentCustomPath = currentCustomPath;
        this.result = null;
        this.activePreset = "general";
        this.prompts = [];
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        this.sculptService = SystemSculptService.getInstance(plugin.settings, app);
      }
      showLoading(show) {
        if (!this.loadingIndicator || !this.contentContainer)
          return;
        this.loadingIndicator.style.display = show ? "flex" : "none";
        this.contentContainer.style.display = show ? "none" : "block";
      }
      async loadPrompts() {
        try {
          this.showLoading(true);
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/post-transcription-prompts`);
          if (!response.ok) {
            throw new Error("Failed to load prompts");
          }
          const data = await response.json();
          this.prompts = data.data.prompts;
          this.createPresetButtons();
          this.showLoading(false);
        } catch (error) {
          console.error("Failed to load post-transcription prompts:", error);
          this.showLoading(false);
          await showPopup(this.app, "", {
            title: "Error",
            description: "Failed to load prompts. Please try again later.",
            primaryButton: "OK"
          });
        }
      }
      createPresetButtons() {
        if (!this.presetButtonContainer)
          return;
        this.presetButtonContainer.empty();
        if (this.currentCustomPath) {
          this.activePreset = "custom";
        } else {
          this.prompts.forEach((preset) => {
            if (preset.systemPrompt === this.currentPrompt) {
              this.activePreset = preset.id;
            }
          });
        }
        this.prompts.forEach((preset) => {
          const button = this.presetButtonContainer.createEl("button", {
            text: preset.label,
            cls: "systemsculpt-preset-button"
          });
          if (preset.description) {
            button.setAttribute("aria-label", preset.description);
            button.addClass("has-tooltip");
          }
          if (preset.id === this.activePreset) {
            button.addClass("active");
            if (this.textArea) {
              this.textArea.value = preset.systemPrompt;
              this.textArea.readOnly = !preset.isUserConfigurable;
            }
          }
          button.onclick = () => {
            this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
            button.addClass("active");
            this.activePreset = preset.id;
            if (preset.id === "custom") {
              this.customSection.style.display = "block";
              this.customInput.focus();
              if (this.textArea) {
                this.textArea.readOnly = false;
              }
            } else {
              this.customSection.style.display = "none";
              if (this.textArea) {
                this.textArea.value = preset.systemPrompt;
                this.textArea.readOnly = !preset.isUserConfigurable;
              }
            }
          };
        });
        if (this.activePreset === "custom") {
          this.customSection.style.display = "block";
          if (this.currentCustomPath) {
            this.customInput.value = this.currentCustomPath;
          }
        }
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Edit Post-Processing Prompt");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Configure how your transcriptions should be post-processed");
        descriptionEl.style.color = "var(--text-muted)";
        descriptionEl.style.fontSize = "0.9em";
        descriptionEl.style.marginTop = "0.2em";
        this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
        this.loadingIndicator.style.display = "none";
        this.loadingIndicator.style.justifyContent = "center";
        this.loadingIndicator.style.alignItems = "center";
        this.loadingIndicator.style.padding = "20px";
        const loadingText = this.loadingIndicator.createSpan();
        loadingText.setText("Loading prompts...");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
        this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
        this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
        this.customSection.style.display = "none";
        const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
        const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
        inputWrapper.style.display = "flex";
        inputWrapper.style.gap = "8px";
        inputWrapper.style.alignItems = "center";
        this.customInput = inputWrapper.createEl("input", {
          type: "text",
          placeholder: "Search for a system prompt file...",
          cls: "systemsculpt-custom-input"
        });
        const createButton2 = inputWrapper.createEl("button", {
          cls: "systemsculpt-create-button"
        });
        createButton2.style.padding = "4px 8px";
        createButton2.style.borderRadius = "4px";
        createButton2.style.cursor = "pointer";
        (0, import_obsidian10.setIcon)(createButton2, "plus");
        createButton2.addEventListener("click", async () => {
          var _a, _b;
          let templateContent = "";
          try {
            const response = await fetch(`${this.sculptService.baseUrl}/api/v1/system-prompts/template`);
            if (!response.ok) {
              throw new Error("Failed to fetch template");
            }
            const data = await response.json();
            templateContent = data.template;
          } catch (error) {
            console.error("Error fetching system prompt template:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: "Failed to fetch system prompt template. Please try again later.",
              primaryButton: "OK"
            });
            return;
          }
          const result = await showPopup(this.app, "", {
            title: "Create New System Prompt",
            description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
            primaryButton: "Create",
            secondaryButton: "Cancel",
            inputs: [
              {
                type: "text",
                placeholder: "My Custom Assistant",
                required: true,
                className: "systemsculpt-prompt-creation-title-input"
              },
              {
                type: "textarea",
                value: templateContent,
                required: true,
                className: "systemsculpt-prompt-creation-content"
              }
            ]
          });
          if (!(result == null ? void 0 : result.confirmed) || !((_a = result.inputs) == null ? void 0 : _a[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
            return;
          }
          const [title, content] = result.inputs;
          const fileName = title.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
          const filePath = `${this.systemPromptsDirectory}/${fileName}`;
          try {
            await this.app.vault.createFolder(this.systemPromptsDirectory).catch(() => {
            });
            const fileContent = `# ${title}

${content}`;
            const file = await this.app.vault.create(filePath + ".md", fileContent);
            if (!file) {
              throw new Error("Failed to create file");
            }
            if (this.textArea) {
              this.textArea.value = fileContent;
              this.textArea.readOnly = false;
            }
            this.customInput.value = filePath;
            await showPopup(this.app, "", {
              title: "Success",
              description: "System prompt file created successfully!",
              primaryButton: "OK"
            });
          } catch (error) {
            console.error("Error creating system prompt file:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: error instanceof Error ? error.message : "Failed to create system prompt file",
              primaryButton: "OK"
            });
          }
        });
        attachFileSuggester(this.customInput, async (selectedPath) => {
          try {
            const file = this.app.vault.getAbstractFileByPath(selectedPath);
            if (file instanceof import_obsidian10.TFile) {
              const content = await this.app.vault.read(file);
              this.textArea.value = content;
              this.textArea.readOnly = false;
              this.customInput.value = selectedPath.replace(/\.md$/, "");
            }
          } catch (error) {
            console.error("Error reading system prompt file:", error);
          }
        }, this.app, this.systemPromptsDirectory);
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            placeholder: "Enter post-processing prompt"
          }
        });
        this.textArea.value = this.currentPrompt;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        const primaryButton = buttonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          const activePreset = this.prompts.find((p) => p.id === this.activePreset);
          this.result = {
            content: this.textArea.value,
            type: (activePreset == null ? void 0 : activePreset.id) || "custom",
            path: this.activePreset === "custom" ? this.customInput.value : void 0
          };
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
        await this.loadPrompts();
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/main.ts
__export(exports, {
  default: () => SystemSculptPlugin
});
var import_obsidian30 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/modals/SettingsTab.ts
var import_obsidian11 = __toModule(require("obsidian"));
init_ui();

// src/types/llm.ts
var DEFAULT_FILTER_SETTINGS = {
  showVisionModels: false,
  showReasoningModels: false,
  showCreativeModels: false
};

// src/types.ts
var DEFAULT_SETTINGS = {
  licenseKey: "",
  licenseValid: false,
  selectedModelId: "deepseek/deepseek-r1",
  chatsDirectory: "SystemSculpt/Chats",
  lastValidated: 0,
  systemPrompt: "You are a helpful AI assistant. You help users with their questions and tasks in a clear and concise way.",
  recordingsDirectory: "SystemSculpt/Recordings",
  developmentMode: false,
  preferredMicrophoneId: "",
  autoTranscribeRecordings: true,
  autoPasteTranscription: true,
  postProcessingPrompt: "You are a transcription post-processor. Your task is to fix any transcription errors, correct grammar and punctuation, and ensure the text is properly formatted. Keep the original meaning intact while making the text more readable.",
  postProcessingEnabled: false,
  showModelTooltips: false,
  showVisionModelsOnly: false,
  showTopPicksOnly: false,
  selectedProvider: "all",
  serverUrl: "http://localhost:3001",
  attachmentsDirectory: "SystemSculpt/Attachments",
  extractionsDirectory: "SystemSculpt/Extractions",
  systemPromptsDirectory: "SystemSculpt/System Prompts",
  tasksDirectory: "SystemSculpt/Tasks",
  moveCompletedTasksDown: true,
  systemPromptType: "general-use",
  systemPromptPath: "",
  customProviders: [],
  modelFilterSettings: DEFAULT_FILTER_SETTINGS,
  favoriteModels: [],
  activeProvider: {
    id: "systemsculpt",
    name: "SystemSculpt",
    type: "native"
  }
};

// src/modals/SettingsTab.ts
init_SystemSculptService();

// src/modals/ModelSelectionModal.ts
var import_obsidian6 = __toModule(require("obsidian"));

// src/services/SearchService.ts
var SearchService = class {
  constructor() {
    this.DEFAULT_INITIAL_RESULTS_LIMIT = 25;
    this.DEFAULT_MAX_FILTERED_RESULTS = 50;
  }
  search(items, query, getSearchableFields, options) {
    var _a, _b;
    const initialLimit = (_a = options == null ? void 0 : options.initialResultsLimit) != null ? _a : this.DEFAULT_INITIAL_RESULTS_LIMIT;
    const maxFiltered = (_b = options == null ? void 0 : options.maxFilteredResults) != null ? _b : this.DEFAULT_MAX_FILTERED_RESULTS;
    if (!query.trim()) {
      return items.slice(0, initialLimit).map((item) => ({
        item,
        matches: [],
        score: 0
      }));
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
    const searchResults = items.map((item) => {
      const fields = getSearchableFields(item);
      const matches = [];
      let totalScore = 0;
      fields.forEach((field) => {
        if (!field.text)
          return;
        const fieldText = field.text;
        const fieldTextLower = fieldText.toLowerCase();
        const allTermsFound = searchTerms.every((term) => fieldTextLower.includes(term));
        if (allTermsFound) {
          searchTerms.forEach((term) => {
            const match = this.findMatches(fieldText, term);
            if (match.indices.length > 0) {
              matches.push({
                field: field.field,
                text: fieldText,
                indices: match.indices,
                matchQuality: match.quality
              });
              let score = field.weight * match.quality;
              if (searchTerms.length > 1) {
                const termPositions = searchTerms.map((t) => {
                  const idx = fieldTextLower.indexOf(t);
                  return idx >= 0 ? idx : Infinity;
                });
                const maxDistance = Math.max(...termPositions) - Math.min(...termPositions.filter((p) => p !== Infinity));
                if (maxDistance < 50) {
                  score *= 2;
                }
              }
              totalScore += score;
            }
          });
        }
      });
      return {
        item,
        matches,
        score: totalScore
      };
    });
    const validResults = searchResults.filter((result) => {
      if (result.matches.length === 0)
        return false;
      const foundTerms = new Set();
      result.matches.forEach((match) => {
        const text = match.text.toLowerCase();
        searchTerms.forEach((term) => {
          if (text.includes(term))
            foundTerms.add(term);
        });
      });
      return foundTerms.size === searchTerms.length;
    });
    return validResults.sort((a, b) => b.score - a.score).slice(0, maxFiltered);
  }
  findMatches(text, query) {
    const normalizedText = text.toLowerCase();
    const normalizedQuery = query.toLowerCase().trim();
    const indices = [];
    let quality = 0;
    if (normalizedQuery.length === 1) {
      const regex = new RegExp(`\\b${normalizedQuery}\\b`, "gi");
      let match;
      while ((match = regex.exec(text)) !== null) {
        indices.push(match.index);
        quality = 1;
      }
      return { indices, quality };
    }
    let pos = 0;
    while ((pos = normalizedText.indexOf(normalizedQuery, pos)) !== -1) {
      const beforeChar = pos > 0 ? normalizedText[pos - 1] : " ";
      const afterChar = pos + normalizedQuery.length < normalizedText.length ? normalizedText[pos + normalizedQuery.length] : " ";
      if ((/\s/.test(beforeChar) || /\W/.test(beforeChar) || pos === 0) && (/\s/.test(afterChar) || /\W/.test(afterChar) || pos + normalizedQuery.length === normalizedText.length)) {
        quality = 1;
      } else {
        quality = 0.8;
      }
      for (let i = 0; i < normalizedQuery.length; i++) {
        indices.push(pos + i);
      }
      pos += 1;
    }
    return { indices: [...new Set(indices)].sort((a, b) => a - b), quality };
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-search-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
    }
    return fragment;
  }
};

// src/modals/ModelSelectionHelper.ts
var ModelSelectionHelper = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.logger = console;
    this.filterSettings = { ...this.plugin.settings.modelFilterSettings };
  }
  getFilterSettings() {
    return this.filterSettings;
  }
  async setFilterSetting(key, value) {
    this.filterSettings[key] = value;
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  async resetFilterSettings() {
    this.filterSettings = { ...DEFAULT_FILTER_SETTINGS };
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  formatPrice(price) {
    try {
      if (price === null || price === void 0 || price === "0") {
        return "Free";
      }
      const numericPrice = typeof price === "string" ? parseFloat(price) : price;
      if (isNaN(numericPrice) || numericPrice === 0) {
        return "Free";
      }
      const pricePerMillion = numericPrice * 1e6;
      return `$${pricePerMillion.toFixed(2)}`;
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error formatting price", {
        price,
        error
      });
      return "Price error";
    }
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        const textNode = document.createTextNode(text.slice(lastIndex, match.index));
        fragment.appendChild(textNode);
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-model-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      const textNode = document.createTextNode(text.slice(lastIndex));
      fragment.appendChild(textNode);
    }
    return fragment;
  }
  sortModels(models) {
    const tiers = {
      favorites: [],
      essential: [],
      advanced: [],
      professional: [],
      custom: []
    };
    models.forEach((model) => {
      if (model.isFavorite) {
        tiers.favorites.push(model);
        return;
      }
      if (model.provider === "custom") {
        tiers.custom.push(model);
      } else {
      }
    });
    Object.values(tiers).forEach((tierModels) => {
      tierModels.sort((a, b) => a.name.localeCompare(b.name));
    });
    const sortedModels = [];
    if (tiers.favorites.length > 0) {
      sortedModels.push(...tiers.favorites);
    }
    sortedModels.push(...tiers.essential);
    sortedModels.push(...tiers.advanced);
    sortedModels.push(...tiers.professional);
    sortedModels.push(...tiers.custom);
    return sortedModels;
  }
  filterModels(models) {
    try {
      return models.filter((model) => {
        var _a, _b, _c;
        try {
          const hasVisionCapability = ((_a = model.capabilities) == null ? void 0 : _a.includes("vision")) || false;
          const hasReasoningCapability = ((_b = model.capabilities) == null ? void 0 : _b.includes("reasoning")) || false;
          const hasCreativeCapability = ((_c = model.capabilities) == null ? void 0 : _c.includes("creative")) || false;
          if (!Object.values(this.filterSettings).some((value) => value)) {
            return true;
          }
          return (!this.filterSettings.showVisionModels || hasVisionCapability) && (!this.filterSettings.showReasoningModels || hasReasoningCapability) && (!this.filterSettings.showCreativeModels || hasCreativeCapability);
        } catch (error) {
          this.logger.error("ModelSelectionHelper: Error filtering individual model", {
            model,
            error
          });
          return false;
        }
      });
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error in filterModels", error);
      return models;
    }
  }
};

// src/modals/CustomProviderModal.ts
var import_obsidian5 = __toModule(require("obsidian"));
var CustomProviderManagerModal = class extends import_obsidian5.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  renderProviderCard(provider, container) {
    const card = container.createDiv("systemsculpt-custom-provider-card");
    const header = card.createDiv("systemsculpt-custom-provider-card-header");
    header.createEl("h3", {
      text: provider.name,
      cls: "systemsculpt-custom-provider-card-name"
    });
    const actions = header.createDiv("systemsculpt-custom-provider-card-actions");
    const deleteBtn = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-card-action delete"
    });
    (0, import_obsidian5.setIcon)(deleteBtn, "trash-2");
    deleteBtn.addEventListener("click", async (e) => {
      e.stopPropagation();
      this.plugin.settings.customProviders = this.plugin.settings.customProviders.filter((p) => p.id !== provider.id);
      await this.plugin.saveSettings();
      this.renderProviderList();
    });
    const details = card.createDiv("systemsculpt-custom-provider-card-details");
    const typeDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian5.setIcon)(typeDetail.createSpan(), "box");
    typeDetail.createSpan({
      text: "OpenAI Compatible"
    });
    const endpointDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian5.setIcon)(endpointDetail.createSpan(), "link");
    endpointDetail.createSpan({ text: provider.endpoint });
    const statusDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    const toggleContainer = statusDetail.createDiv({
      cls: "systemsculpt-custom-provider-toggle-container"
    });
    toggleContainer.createSpan({
      text: provider.isEnabled ? "Enabled" : "Disabled",
      cls: "systemsculpt-custom-provider-toggle-label"
    });
    const toggle = toggleContainer.createDiv({
      cls: `checkbox-container ${provider.isEnabled ? "is-enabled" : ""}`
    });
    toggle.createDiv({ cls: "checkbox-toggle" });
    toggle.addEventListener("click", async (e) => {
      e.stopPropagation();
      if (provider.isEnabled) {
        provider.isEnabled = false;
        await this.plugin.saveSettings();
        this.renderProviderList();
        return;
      }
      toggle.addClass("testing");
      const result = await this.plugin.customProviderService.testConnection(provider);
      toggle.removeClass("testing");
      if (result.success) {
        provider.isEnabled = true;
        await this.plugin.saveSettings();
        this.renderProviderList();
      } else {
        new import_obsidian5.Notice(`Failed to enable ${provider.name}: ${result.error || "Connection failed"}`, 5e3);
      }
    });
  }
  renderProviderList() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-manager-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-manager-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-back"
    });
    (0, import_obsidian5.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Models" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Custom Providers" });
    const content = contentEl.createDiv("systemsculpt-custom-provider-manager-content");
    const listContainer = content.createDiv("systemsculpt-custom-provider-manager-list");
    const providers = this.plugin.settings.customProviders;
    if (providers.length === 0) {
      const emptyState = listContainer.createDiv("systemsculpt-custom-provider-manager-empty");
      const emptyIcon = emptyState.createDiv("systemsculpt-custom-provider-manager-empty-icon");
      (0, import_obsidian5.setIcon)(emptyIcon, "server-off");
      emptyState.createDiv({
        cls: "systemsculpt-custom-provider-manager-empty-text",
        text: "No custom providers added yet"
      });
    } else {
      providers.forEach((provider) => {
        this.renderProviderCard(provider, listContainer);
      });
    }
    const actions = content.createDiv("systemsculpt-custom-provider-manager-actions");
    const addButton = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-button systemsculpt-custom-provider-manager-button-primary",
      text: "Add Provider"
    });
    (0, import_obsidian5.setIcon)(addButton.createSpan(), "plus");
    addButton.addEventListener("click", () => {
      this.close();
      const customProviderModal = new CustomProviderModal(this.app, this.plugin, () => {
        const managerModal = new CustomProviderManagerModal(this.app, this.plugin, this.onBack);
        managerModal.open();
      });
      customProviderModal.open();
    });
  }
  onOpen() {
    this.renderProviderList();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var CustomProviderModal = class extends import_obsidian5.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-back"
    });
    (0, import_obsidian5.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Providers" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Add Custom Provider" });
    const form = contentEl.createDiv("systemsculpt-custom-provider-form");
    const nameGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    nameGroup.createEl("label", { text: "Provider Name" });
    const nameInput = nameGroup.createEl("input", {
      type: "text",
      placeholder: "e.g., LM Studio, OpenAI",
      attr: {
        maxlength: "25"
      }
    });
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const urlGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    urlGroup.createEl("label", { text: "API Endpoint URL" });
    const presetContainer = urlGroup.createDiv("systemsculpt-custom-provider-presets");
    presetContainer.createEl("label", { text: "Quick Setup:" });
    const presetButtons = presetContainer.createDiv("systemsculpt-custom-provider-preset-buttons");
    const ollamaButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Ollama"
    });
    ollamaButton.addEventListener("click", () => {
      nameInput.value = "Ollama";
      urlInput.value = "http://localhost:11434/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const lmStudioButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "LM Studio"
    });
    lmStudioButton.addEventListener("click", () => {
      nameInput.value = "LM Studio";
      urlInput.value = "http://localhost:1234/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const openRouterButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenRouter"
    });
    openRouterButton.addEventListener("click", () => {
      nameInput.value = "OpenRouter";
      urlInput.value = "https://openrouter.ai/api/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const groqButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Groq"
    });
    groqButton.addEventListener("click", () => {
      nameInput.value = "Groq";
      urlInput.value = "https://api.groq.com/openai/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const urlInput = urlGroup.createEl("input", {
      type: "text",
      placeholder: "https://your-api-endpoint.com"
    });
    const urlError = urlGroup.createDiv({
      cls: "systemsculpt-custom-provider-error systemsculpt-custom-provider-error-hidden",
      text: " "
    });
    const validateEndpointUrl = (url) => {
      try {
        const parsedUrl = new URL(url);
        const isLocal = parsedUrl.hostname === "localhost" || parsedUrl.hostname === "127.0.0.1";
        if (isLocal && parsedUrl.protocol !== "http:") {
          return { isValid: false, error: "Local endpoints must use HTTP" };
        }
        if (!isLocal && parsedUrl.protocol !== "https:") {
          return { isValid: false, error: "Remote endpoints must use HTTPS" };
        }
        if (isLocal && !parsedUrl.port) {
          return {
            isValid: false,
            error: "Local endpoints require a port number"
          };
        }
        return { isValid: true };
      } catch (e) {
        return { isValid: false, error: "Invalid URL format" };
      }
    };
    const apiKeyGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    apiKeyGroup.createEl("label", { text: "API Key (Optional)" });
    const apiKeyInput = apiKeyGroup.createEl("input", {
      type: "password",
      placeholder: "Enter your API key"
    });
    const resetValidation = () => {
      isConnectionTested = false;
      testResult = null;
      updateButtonState("test");
      urlError.addClass("systemsculpt-custom-provider-error-hidden");
      urlError.removeClass("systemsculpt-custom-provider-success");
    };
    nameInput.addEventListener("input", resetValidation);
    urlInput.addEventListener("input", resetValidation);
    apiKeyInput.addEventListener("input", resetValidation);
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const formActions = form.createDiv("systemsculpt-custom-provider-form-actions");
    const cancelButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-secondary",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    const actionButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-primary",
      text: "Test Connection"
    });
    let isConnectionTested = false;
    let testResult = null;
    const createProviderFromForm = () => ({
      id: crypto.randomUUID(),
      name: nameInput.value.trim(),
      endpoint: urlInput.value.trim(),
      apiKey: apiKeyInput.value.trim(),
      isEnabled: true,
      lastTested: Date.now()
    });
    const updateButtonState = (state) => {
      switch (state) {
        case "test":
          actionButton.setText("Test Connection");
          actionButton.removeAttribute("disabled");
          break;
        case "testing":
          actionButton.setText("Testing...");
          actionButton.setAttribute("disabled", "true");
          break;
        case "retry":
          actionButton.setText("Try Again");
          actionButton.removeAttribute("disabled");
          break;
        case "save":
          actionButton.setText("Save Provider");
          actionButton.removeAttribute("disabled");
          break;
      }
    };
    const validateForm = () => {
      if (!nameInput.value.trim()) {
        return { isValid: false, error: "Provider name is required" };
      }
      const urlValidation = validateEndpointUrl(urlInput.value);
      if (!urlValidation.isValid) {
        return urlValidation;
      }
      const isLocal = urlInput.value.includes("localhost") || urlInput.value.includes("127.0.0.1");
      if (!isLocal && !apiKeyInput.value.trim()) {
        return {
          isValid: false,
          error: "API key is required for remote endpoints"
        };
      }
      return { isValid: true };
    };
    actionButton.addEventListener("click", async () => {
      var _a;
      const validation = validateForm();
      if (!validation.isValid) {
        urlError.textContent = validation.error || "Invalid form data";
        urlError.removeClass("systemsculpt-custom-provider-error-hidden");
        return;
      }
      if (!isConnectionTested) {
        updateButtonState("testing");
        const provider = createProviderFromForm();
        const result = await this.plugin.customProviderService.testConnection(provider);
        if (result.success) {
          isConnectionTested = true;
          updateButtonState("save");
          testResult = result;
          urlError.textContent = `Connection successful! Found ${((_a = result.models) == null ? void 0 : _a.length) || 0} models.`;
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.addClass("systemsculpt-custom-provider-success");
        } else {
          updateButtonState("retry");
          urlError.textContent = result.error || "Connection failed";
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.removeClass("systemsculpt-custom-provider-success");
        }
      } else {
        const provider = createProviderFromForm();
        this.plugin.settings.customProviders = [
          ...this.plugin.settings.customProviders,
          provider
        ];
        await this.plugin.saveSettings();
        this.close();
        this.onBack();
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/ModelSelectionModal.ts
var ModelSelectionModal = class extends import_obsidian6.Modal {
  constructor(app, currentModelId, onSelect, plugin) {
    super(app);
    this.allModels = [];
    this.selectedCardIndex = -1;
    this.modelCards = [];
    this.isClosing = false;
    this.getSearchableFields = (model) => {
      return [
        { field: "name", text: model.name, weight: 200 },
        ...model.name.split(/[\s\-:\.]+/).map((part) => ({
          field: "name",
          text: part,
          weight: 150
        })),
        ...model.provider === "custom" ? [{ field: "provider", text: model.id.split("-")[0], weight: 180 }] : [],
        { field: "description", text: model.description || "", weight: 50 }
      ];
    };
    this.selectedModelId = currentModelId;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.logger = console;
    this.helper = new ModelSelectionHelper(plugin);
    this.searchService = new SearchService();
  }
  async onOpen() {
    try {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.addClass("systemsculpt-model-selection-modal");
      this.createSearchUI();
      this.createModelGrid();
      this.setupSearch();
      this.allModels = await this.plugin.getInitialModels();
      this.renderModels(this.getVisibleModels());
    } catch (error) {
      this.logger.error("ModelSelectionModal: Error in onOpen", error);
      this.contentEl.createDiv({
        cls: "systemsculpt-error-message",
        text: "Error loading model selection modal"
      });
    }
  }
  getVisibleModels() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.allModels.map((m) => ({ item: m, matches: [], score: 0 }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.allModels, query, (model) => this.getSearchableFields(model), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
  createSearchUI() {
    const searchContainer = this.contentEl.createDiv({
      cls: "systemsculpt-search-container"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search models...",
      cls: "systemsculpt-search-input"
    });
    const providersButton = searchContainer.createEl("button", {
      cls: "systemsculpt-providers-button"
    });
    (0, import_obsidian6.setIcon)(providersButton.createSpan(), "settings");
    providersButton.createSpan({ text: "Providers" });
    providersButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modelSelectionModal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modelSelectionModal.open();
      });
      managerModal.open();
    });
  }
  createModelGrid() {
    this.modelGrid = this.contentEl.createDiv({
      cls: "systemsculpt-model-grid"
    });
  }
  setupSearch() {
    var _a, _b, _c;
    this.searchInput.addEventListener("input", () => {
      const results = this.getVisibleModels();
      this.renderModels(results);
    });
    this.contentEl.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey) {
          this.selectedCardIndex = this.selectedCardIndex <= 0 ? this.modelCards.length - 1 : this.selectedCardIndex - 1;
        } else {
          this.selectedCardIndex = this.selectedCardIndex >= this.modelCards.length - 1 ? 0 : this.selectedCardIndex + 1;
        }
        this.modelCards.forEach((card, i) => {
          const isSelected = i === this.selectedCardIndex;
          card.classList.toggle("systemsculpt-keyboard-selected", isSelected);
          if (isSelected) {
            card.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }
        });
        this.searchInput.focus();
      } else if (e.key === "Enter") {
        const highlightedCard = this.modelCards[this.selectedCardIndex];
        if (highlightedCard) {
          e.preventDefault();
          const modelId = highlightedCard.dataset.modelId;
          if (modelId) {
            this.onSelect(modelId);
            this.close();
          }
        }
      }
    });
    (_a = this.modelGrid) == null ? void 0 : _a.addEventListener("wheel", () => {
    }, { passive: true });
    (_b = this.modelGrid) == null ? void 0 : _b.addEventListener("touchstart", () => {
    }, { passive: true });
    (_c = this.modelGrid) == null ? void 0 : _c.addEventListener("touchmove", () => {
    }, { passive: true });
  }
  renderModels(searchResults) {
    if (!this.modelGrid)
      return;
    this.modelGrid.empty();
    this.modelCards = [];
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const favorites = [];
    const nonFavorites = [];
    const visibleModels = searchResults.map((sr) => sr.item);
    visibleModels.forEach((model) => {
      if (model.isFavorite) {
        favorites.push(model);
      } else {
        nonFavorites.push(model);
      }
    });
    if (favorites.length > 0) {
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => a.name.localeCompare(b.name));
      favorites.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    const modelsByProvider = new Map();
    nonFavorites.forEach((model) => {
      var _a;
      const provider = model.provider;
      if (!modelsByProvider.has(provider)) {
        modelsByProvider.set(provider, []);
      }
      (_a = modelsByProvider.get(provider)) == null ? void 0 : _a.push(model);
    });
    const sortedProviders = Array.from(modelsByProvider.keys()).sort((a, b) => {
      if (a === "systemsculpt")
        return -1;
      if (b === "systemsculpt")
        return 1;
      return a.localeCompare(b);
    });
    sortedProviders.forEach((provider) => {
      const models = modelsByProvider.get(provider) || [];
      if (models.length === 0)
        return;
      const sortedModels = models.sort((a, b) => a.name.localeCompare(b.name));
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      const providerName = provider === "systemsculpt" ? "SystemSculpt Models" : `${provider.charAt(0).toUpperCase() + provider.slice(1)} Models`;
      header.createSpan({ text: providerName });
      sortedModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    });
    if (this.modelCards.length === 0) {
      const noResultsCard = this.renderNoResultsCard();
      this.modelGrid.appendChild(noResultsCard);
    }
  }
  renderNoResultsCard() {
    const card = createDiv({ cls: "systemsculpt-model-card" });
    const iconsContainer = card.createDiv({ cls: "systemsculpt-model-icons" });
    const searchIcon = iconsContainer.createDiv({
      cls: "systemsculpt-model-icon systemsculpt-pricing-low"
    });
    (0, import_obsidian6.setIcon)(searchIcon, "search");
    const nameContainer = card.createDiv({
      cls: "systemsculpt-model-name-container"
    });
    nameContainer.createDiv({
      cls: "systemsculpt-model-name",
      text: "No models found"
    });
    const description = card.createDiv({
      cls: "systemsculpt-model-description",
      text: "No models match your current search criteria. Click here to reset all filters."
    });
    card.createDiv({ cls: "systemsculpt-model-details" });
    card.addEventListener("click", () => {
      if (this.searchInput) {
        this.searchInput.value = "";
      }
      this.renderModels(this.allModels.map((m) => ({ item: m, matches: [], score: 0 })));
    });
    return card;
  }
  renderModelCard(model, matches = []) {
    var _a, _b, _c, _d, _e, _f, _g;
    const card = document.createElement("div");
    card.className = "systemsculpt-model-card";
    if (model.provider !== "systemsculpt") {
      card.classList.add("systemsculpt-custom-model-card");
    }
    card.setAttribute("tabindex", "0");
    card.dataset.modelId = model.id;
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${model.isFavorite ? "is-favorite" : ""}`,
      attr: {
        "aria-label": model.isFavorite ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian6.setIcon)(favoriteButton, "star");
    favoriteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isFavorite = !model.isFavorite;
      model.isFavorite = isFavorite;
      favoriteButton.classList.toggle("is-favorite", isFavorite);
      favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
      if (!Array.isArray(this.plugin.settings.favoriteModels)) {
        this.plugin.settings.favoriteModels = [];
      }
      if (isFavorite) {
        const newFav = { provider: model.provider, modelId: model.id };
        if (!this.plugin.settings.favoriteModels.some((f) => f.modelId === model.id && f.provider === model.provider)) {
          this.plugin.settings.favoriteModels.push(newFav);
        }
      } else {
        this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((f) => !(f.modelId === model.id && f.provider === model.provider));
      }
      await this.plugin.saveSettings();
      this.renderModels(this.getVisibleModels());
    });
    if (model.provider !== "systemsculpt") {
      const nameContainer = card.createDiv({
        cls: "systemsculpt-custom-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-custom-model-name"
      });
      const nameMatches = matches.filter((m) => m.field === "name");
      modelName.append(this.helper.highlightText(model.name, nameMatches, (_a = this.searchInput) == null ? void 0 : _a.value));
    } else {
      const iconsContainer = card.createDiv({
        cls: "systemsculpt-model-icons"
      });
      const completionPrice = parseFloat(model.pricing.completion) * 1e6;
      const pricingIndicator = iconsContainer.createDiv({
        cls: "systemsculpt-model-icon",
        attr: {
          "aria-label": `Approx ~$${completionPrice.toFixed(2)} per million tokens`
        }
      });
      (0, import_obsidian6.setIcon)(pricingIndicator, "wallet");
      if ((_b = model.capabilities) == null ? void 0 : _b.includes("fast")) {
        const speedIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-speed-indicator",
          attr: { "aria-label": "Blazing fast responses" }
        });
        (0, import_obsidian6.setIcon)(speedIndicator, "zap");
      }
      if ((_c = model.capabilities) == null ? void 0 : _c.includes("reasoning")) {
        const reasonIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-reasoning-indicator",
          attr: { "aria-label": "Complex reasoning" }
        });
        (0, import_obsidian6.setIcon)(reasonIndicator, "brain");
      }
      if ((_d = model.capabilities) == null ? void 0 : _d.includes("creative")) {
        const creativeIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-creative-indicator",
          attr: { "aria-label": "Creative writing" }
        });
        (0, import_obsidian6.setIcon)(creativeIndicator, "brush");
      }
      if (((_e = model.architecture) == null ? void 0 : _e.modality) === "text+image->text") {
        const visionIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-vision-indicator",
          attr: { "aria-label": "Vision/image input" }
        });
        (0, import_obsidian6.setIcon)(visionIndicator, "eye");
      }
      const nameContainer = card.createDiv({
        cls: "systemsculpt-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-model-name"
      });
      modelName.append(this.helper.highlightText(model.name, matches, (_f = this.searchInput) == null ? void 0 : _f.value));
      const description = card.createDiv({
        cls: "systemsculpt-model-description"
      });
      description.append(this.helper.highlightText(model.description, matches, (_g = this.searchInput) == null ? void 0 : _g.value));
      description.setAttribute("aria-label", model.description);
      description.addClass("has-tooltip");
      const details = card.createDiv({ cls: "systemsculpt-model-details" });
      const contextLength = details.createDiv({
        cls: "systemsculpt-model-detail"
      });
      contextLength.createSpan({
        text: "Context: ",
        cls: "systemsculpt-detail-label"
      });
      contextLength.createSpan({
        text: `${model.context_length.toLocaleString()} tokens`,
        cls: "systemsculpt-detail-value"
      });
    }
    card.addEventListener("click", async () => {
      const customProvider = this.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === model.provider.toLowerCase());
      if (customProvider) {
        this.plugin.settings.activeProvider = {
          id: customProvider.id,
          name: customProvider.name,
          type: "custom"
        };
      } else {
        this.plugin.settings.activeProvider = {
          id: "systemsculpt",
          name: "SystemSculpt",
          type: "native"
        };
      }
      await this.plugin.saveSettings();
      this.onSelect(model.id);
      this.close();
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        this.onSelect(model.id);
        this.close();
      }
    });
    card.addEventListener("focus", () => {
      this.modelCards.forEach((c) => c.classList.remove("systemsculpt-keyboard-selected"));
      card.classList.add("systemsculpt-keyboard-selected");
      this.searchInput.focus();
    });
    return card;
  }
  onClose() {
    this.isClosing = true;
    this.contentEl.empty();
  }
  setModels(models) {
    if (!Array.isArray(models)) {
      this.logger.error("Invalid models data", { models });
      return;
    }
    this.allModels = models;
    if (this.modelGrid) {
      this.renderModels(this.getVisibleModels());
    }
  }
};

// src/components/FolderSuggester.ts
var import_obsidian7 = __toModule(require("obsidian"));
var FolderSuggester = class extends import_obsidian7.AbstractInputSuggest {
  constructor(inputEl, onSelectCb, app) {
    super(app, inputEl);
    this.inputEl = inputEl;
    this.onSelectCb = onSelectCb;
    this.content = getFolderSuggestions(app);
  }
  getSuggestions(inputStr) {
    const lowerCaseInputStr = inputStr.toLowerCase();
    return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
  }
  renderSuggestion(content, el) {
    el.setText(content);
  }
  selectSuggestion(content, evt) {
    this.onSelectCb(content);
    this.inputEl.value = content;
    this.inputEl.blur();
    this.close();
  }
};
function getFolderSuggestions(app) {
  const folders = app.vault.getAllLoadedFiles().filter((file) => file instanceof import_obsidian7.TFolder);
  return new Set(folders.map((folder) => folder.path));
}
function attachFolderSuggester(inputEl, onSelect, app) {
  return new FolderSuggester(inputEl, onSelect, app);
}

// src/modals/SystemPromptModal.ts
var import_obsidian9 = __toModule(require("obsidian"));
init_FileSuggester();
init_ui();
init_SystemPromptService();
function sanitizeFileName(name) {
  return name.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
}
function getSystemPromptPath(directory, fileName) {
  return `${directory}/${fileName}.md`;
}
var SystemPromptModal = class extends import_obsidian9.Modal {
  constructor(app, currentPrompt, options) {
    super(app);
    this.currentPrompt = currentPrompt;
    this.result = null;
    this.systemPrompts = [];
    this.activePreset = null;
    var _a;
    this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
    this.options = {
      ...options,
      systemPromptsDirectory: (_a = options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts"
    };
    this.systemPromptService = new SystemPromptService(app);
  }
  showLoading(show) {
    if (!this.loadingIndicator || !this.contentContainer)
      return;
    this.loadingIndicator.style.display = show ? "flex" : "none";
    this.contentContainer.style.display = show ? "none" : "block";
  }
  async loadSystemPrompts() {
    try {
      this.showLoading(true);
      this.systemPrompts = await this.systemPromptService.getSystemPrompts();
      this.createPresetButtons();
      this.showLoading(false);
    } catch (error) {
      console.error("Failed to load system prompts:", error);
      this.showLoading(false);
      await showPopup(this.app, "", {
        title: "Error",
        description: "Failed to load system prompts. Please try again later.",
        primaryButton: "OK"
      });
    }
  }
  createPresetButtons() {
    if (!this.presetButtonContainer)
      return;
    this.presetButtonContainer.empty();
    this.systemPrompts.forEach((preset) => {
      if (preset.systemPrompt === this.currentPrompt) {
        this.activePreset = preset.label;
      }
    });
    if (!this.activePreset && this.currentPrompt) {
      const generalUsePreset = this.systemPrompts.find((p) => p.id === "general-use");
      if (generalUsePreset && generalUsePreset.systemPrompt.trim() === this.currentPrompt.trim()) {
        this.activePreset = generalUsePreset.label;
      } else {
        this.activePreset = "General-use";
        if (this.textArea && generalUsePreset) {
          this.textArea.value = generalUsePreset.systemPrompt;
        }
      }
    }
    const presetButtons = [
      ...this.systemPrompts,
      ...!this.systemPrompts.some((p) => p.id === "custom") ? [
        {
          id: "custom",
          label: "Custom",
          isUserConfigurable: true,
          systemPrompt: ""
        }
      ] : []
    ].map((preset) => {
      const button = this.presetButtonContainer.createEl("button", {
        text: preset.label,
        cls: "systemsculpt-preset-button"
      });
      if (preset.label === this.activePreset) {
        button.addClass("active");
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
        }
      }
      button.onclick = () => {
        this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
        button.addClass("active");
        this.activePreset = preset.label;
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
          this.customInput.focus();
          if (this.textArea) {
            this.textArea.readOnly = false;
          }
        } else {
          this.customSection.style.display = "none";
          if (this.textArea) {
            this.textArea.value = preset.systemPrompt;
            this.textArea.readOnly = !preset.isUserConfigurable;
          }
        }
      };
      return button;
    });
  }
  async onOpen() {
    var _a, _b;
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal-content");
    this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
    this.loadingIndicator.style.display = "none";
    this.loadingIndicator.style.justifyContent = "center";
    this.loadingIndicator.style.alignItems = "center";
    this.loadingIndicator.style.padding = "20px";
    const loadingText = this.loadingIndicator.createSpan();
    loadingText.setText("Loading system prompts...");
    this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
    const title = this.options.mode === "default" ? "Edit Default System Prompt" : "Chat View Settings";
    const description = this.options.mode === "default" ? "Changes will apply as the default for all new chat views" : "Configure settings for this specific chat view";
    this.titleEl.setText(title);
    this.titleEl.addClass("systemsculpt-modal-title");
    const descriptionEl = this.titleEl.createDiv();
    descriptionEl.addClass("systemsculpt-modal-description");
    descriptionEl.setText(description);
    descriptionEl.style.color = "var(--text-muted)";
    descriptionEl.style.fontSize = "0.9em";
    descriptionEl.style.marginTop = "0.2em";
    const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
    this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
    this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
    this.customSection.style.display = "none";
    const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
    const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
    inputWrapper.style.display = "flex";
    inputWrapper.style.gap = "8px";
    inputWrapper.style.alignItems = "center";
    this.customInput = inputWrapper.createEl("input", {
      type: "text",
      placeholder: "Search for a system prompt file...",
      cls: "systemsculpt-custom-input"
    });
    const createButton2 = inputWrapper.createEl("button", {
      cls: "systemsculpt-create-button"
    });
    createButton2.style.padding = "4px 8px";
    createButton2.style.borderRadius = "4px";
    createButton2.style.cursor = "pointer";
    (0, import_obsidian9.setIcon)(createButton2, "plus");
    createButton2.addEventListener("click", async () => {
      var _a2, _b2, _c;
      let templateContent = "";
      try {
        templateContent = await this.systemPromptService.getSystemPromptTemplate();
      } catch (error) {
        console.error("Error fetching system prompt template:", error);
        await showPopup(this.app, "", {
          title: "Error",
          description: "Failed to fetch system prompt template. Please try again later.",
          primaryButton: "OK"
        });
        return;
      }
      const result = await showPopup(this.app, "", {
        title: "Create New System Prompt",
        description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
        primaryButton: "Create",
        secondaryButton: "Cancel",
        inputs: [
          {
            type: "text",
            placeholder: "My Custom Assistant",
            required: true,
            className: "systemsculpt-prompt-creation-title-input"
          },
          {
            type: "textarea",
            value: templateContent,
            required: true,
            className: "systemsculpt-prompt-creation-content"
          }
        ]
      });
      if (!(result == null ? void 0 : result.confirmed) || !((_a2 = result.inputs) == null ? void 0 : _a2[0]) || !((_b2 = result.inputs) == null ? void 0 : _b2[1])) {
        return;
      }
      const [title2, content] = result.inputs;
      const promptsDirectory = (_c = this.options.systemPromptsDirectory) != null ? _c : "SystemSculpt/System Prompts";
      const fileName = sanitizeFileName(title2);
      const filePath = getSystemPromptPath(promptsDirectory, fileName);
      try {
        await this.app.vault.createFolder(promptsDirectory).catch(() => {
        });
        const fileContent = `# ${title2}

${content}`;
        const file = await this.app.vault.create(filePath, fileContent);
        if (!file) {
          throw new Error("Failed to create file");
        }
        if (this.textArea) {
          this.textArea.value = fileContent;
          this.textArea.readOnly = false;
        }
        this.customInput.value = filePath;
        await showPopup(this.app, "", {
          title: "Success",
          description: "System prompt file created successfully!",
          primaryButton: "OK"
        });
      } catch (error) {
        console.error("Error creating system prompt file:", error);
        const errorMessage = error instanceof Error ? error.message : "Failed to create system prompt file. Please try again.";
        await showPopup(this.app, "", {
          title: "Error",
          description: errorMessage,
          primaryButton: "OK"
        });
      }
    });
    if (this.customInput) {
      attachFileSuggester(this.customInput, async (selectedPath) => {
        try {
          const file = this.app.vault.getAbstractFileByPath(selectedPath);
          if (file && file instanceof import_obsidian9.TFile) {
            const content = await this.app.vault.read(file);
            this.textArea.value = content;
            this.textArea.readOnly = false;
            this.customInput.value = selectedPath.replace(/\.md$/, "");
          }
        } catch (error) {
          console.error("Error reading system prompt file:", error);
        }
      }, this.app, (_a = this.options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts");
    }
    this.textArea = textAreaContainer.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter system prompt",
        readOnly: this.activePreset !== "Custom"
      }
    });
    this.textArea.value = this.currentPrompt;
    if (this.options.mode === "chat-specific") {
      const tokenLimitContainer = textAreaContainer.createDiv({
        cls: "systemsculpt-token-limit-container"
      });
      tokenLimitContainer.style.display = "flex";
      tokenLimitContainer.style.justifyContent = "flex-end";
      tokenLimitContainer.style.alignItems = "center";
      tokenLimitContainer.style.marginTop = "1rem";
      tokenLimitContainer.style.gap = "8px";
      const tokenLimitWrapper = tokenLimitContainer.createDiv({
        cls: "systemsculpt-token-limit-wrapper"
      });
      tokenLimitWrapper.style.display = "flex";
      tokenLimitWrapper.style.flexDirection = "column";
      tokenLimitWrapper.style.alignItems = "flex-end";
      tokenLimitWrapper.style.width = "50%";
      const tokenLimitLabel = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-label",
        text: "Context Token Limit"
      });
      tokenLimitLabel.style.fontWeight = "500";
      tokenLimitLabel.style.marginBottom = "4px";
      tokenLimitLabel.style.fontSize = "14px";
      const inputWrapper2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-input-wrapper"
      });
      inputWrapper2.style.display = "flex";
      inputWrapper2.style.alignItems = "center";
      inputWrapper2.style.gap = "4px";
      inputWrapper2.style.width = "100%";
      this.tokenLimitInput = inputWrapper2.createEl("input", {
        type: "range",
        cls: "systemsculpt-token-limit-input",
        attr: {
          min: "0",
          max: "100",
          step: "1",
          value: ((_b = this.options.tokenLimitPercentage) == null ? void 0 : _b.toString()) || "0"
        }
      });
      this.tokenLimitInput.style.width = "100%";
      const valueDisplay = inputWrapper2.createDiv({
        cls: "systemsculpt-token-limit-display",
        text: this.options.tokenLimitPercentage ? this.options.modelContextLength ? `${Math.floor(this.options.tokenLimitPercentage / 100 * this.options.modelContextLength / 1e3)}K` : `${this.options.tokenLimitPercentage}%` : "\u221E"
      });
      valueDisplay.style.minWidth = "45px";
      valueDisplay.style.textAlign = "right";
      valueDisplay.style.fontVariantNumeric = "tabular-nums";
      valueDisplay.style.fontSize = "14px";
      valueDisplay.style.fontWeight = "500";
      valueDisplay.style.color = "var(--text-accent)";
      const description2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-description",
        text: this.options.modelContextLength ? `Model max: ${Math.floor(this.options.modelContextLength / 1e3)}K tokens` : "Set to 0% for no limit"
      });
      description2.style.fontSize = "12px";
      description2.style.color = "var(--text-muted)";
      description2.style.marginTop = "4px";
      this.tokenLimitInput.addEventListener("input", (e) => {
        const percentage = parseInt(e.target.value, 10);
        if (percentage === 0) {
          valueDisplay.setText("\u221E");
        } else if (this.options.modelContextLength) {
          const tokens = Math.floor(percentage / 100 * this.options.modelContextLength / 1e3);
          valueDisplay.setText(`${tokens}K`);
        } else {
          valueDisplay.setText(`${percentage}%`);
        }
      });
    }
    if (this.activePreset === "Custom" && this.options.customPromptFilePath) {
      this.customInput.value = this.options.customPromptFilePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    }
    const resizeObserver = new ResizeObserver(() => {
      this.textArea.style.height = "auto";
      this.textArea.style.height = this.textArea.scrollHeight + "px";
    });
    resizeObserver.observe(this.textArea);
    const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
    const secondaryButton = buttonContainer.createEl("button", {
      text: "Cancel",
      cls: "systemsculpt-button"
    });
    const handleCancel = () => {
      this.result = null;
      this.close();
    };
    secondaryButton.onclick = handleCancel;
    const primaryButton = buttonContainer.createEl("button", {
      text: "Save",
      cls: "systemsculpt-button mod-cta"
    });
    const handleSave = () => {
      var _a2, _b2;
      const activeButton = this.modalEl.querySelector(".systemsculpt-preset-button.active");
      const activePresetLabel = (_a2 = activeButton == null ? void 0 : activeButton.textContent) != null ? _a2 : "";
      let result;
      if (activePresetLabel === "Custom" && this.customInput.value) {
        const path = this.customInput.value.replace(/\.md$/, "");
        result = {
          content: this.textArea.value,
          type: "custom",
          path
        };
      } else {
        const preset = this.systemPrompts.find((p) => p.label === activePresetLabel);
        if (preset) {
          result = {
            content: preset.systemPrompt,
            type: preset.id
          };
        } else {
          result = {
            content: this.textArea.value,
            type: "custom"
          };
        }
      }
      if (this.options.mode === "chat-specific" && ((_b2 = this.tokenLimitInput) == null ? void 0 : _b2.value)) {
        const percentage = parseInt(this.tokenLimitInput.value, 10);
        if (percentage > 0) {
          result.tokenLimitPercentage = percentage;
          if (this.options.modelContextLength) {
            result.tokenLimit = Math.floor(percentage / 100 * this.options.modelContextLength);
          }
        }
      }
      this.result = result;
      this.close();
    };
    primaryButton.onclick = handleSave;
    this.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
        e.preventDefault();
        handleSave();
      } else if (e.key === "Escape") {
        e.preventDefault();
        handleCancel();
      }
    });
    this.textArea.focus();
    this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
    await this.loadSystemPrompts();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
      this.resolvePromise(this.result);
    }
  }
  async openAndGetValue() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
};
async function showSystemPromptModal(app, currentPrompt, options) {
  const defaultOptions = {
    systemPromptsDirectory: "SystemSculpt/System Prompts",
    mode: "default",
    modelContextLength: void 0
  };
  const modal = new SystemPromptModal(app, currentPrompt, {
    ...defaultOptions,
    ...options
  });
  const result = await modal.openAndGetValue();
  if (result !== null && (options == null ? void 0 : options.onSave)) {
    await options.onSave(result.content);
  }
  return result;
}

// src/modals/SettingsTab.ts
var SystemSculptSettingTab = class extends import_obsidian11.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.debounceTimer = null;
    this.plugin = plugin;
    this.systemSculptService = SystemSculptService.getInstance(plugin.settings, this.app);
  }
  validateDirectory(path) {
    if (!path)
      return true;
    return !path.includes("..") && !path.startsWith("/") && !path.startsWith("\\");
  }
  async handleDirectoryChange(value, settingKey) {
    if (!this.validateDirectory(value)) {
      showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
      return;
    }
    if (this.debounceTimer)
      clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(async () => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    }, 500);
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    const mainContainer = containerEl.createDiv("systemsculpt-settings-container");
    mainContainer.createEl("h2", { text: "SystemSculpt AI Settings" });
    const tabContainer = mainContainer.createDiv("systemsculpt-settings-tabs");
    const contentContainer = mainContainer.createDiv("systemsculpt-settings-content");
    const tabs = [
      { id: "license", label: "License" },
      { id: "directories", label: "Directories" },
      { id: "recorder", label: "Recorder" },
      { id: "chat", label: "Chat" },
      { id: "tasks", label: "Tasks" },
      { id: "advanced", label: "Advanced" }
    ];
    tabs.forEach((tab) => {
      const tabButton = tabContainer.createEl("button", {
        cls: "systemsculpt-tab-button",
        text: tab.label
      });
      tabButton.dataset.tab = tab.id;
      if (tab.id === "license")
        tabButton.addClass("active");
    });
    const isProActive = this.plugin.settings.licenseValid === true;
    const licenseContent = contentContainer.createDiv("systemsculpt-tab-content active");
    const directoriesContent = contentContainer.createDiv("systemsculpt-tab-content");
    const recorderContent = contentContainer.createDiv("systemsculpt-tab-content");
    const chatContent = contentContainer.createDiv("systemsculpt-tab-content");
    const tasksContent = contentContainer.createDiv("systemsculpt-tab-content");
    const advancedContent = contentContainer.createDiv("systemsculpt-tab-content");
    this.displayLicenseTab(licenseContent, isProActive);
    this.displayDirectoriesTab(directoriesContent, isProActive);
    this.displayRecorderTab(recorderContent);
    this.displayChatTab(chatContent);
    this.displayTasksTab(tasksContent);
    this.displayAdvancedTab(advancedContent);
    tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((button) => {
      button.addEventListener("click", (e) => {
        var _a;
        const target = e.target;
        const tabId = target.dataset.tab;
        tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((b) => b.classList.remove("active"));
        contentContainer.querySelectorAll(".systemsculpt-tab-content").forEach((c) => c.classList.remove("active"));
        target.classList.add("active");
        (_a = contentContainer.querySelector(`[data-tab="${tabId}"]`)) == null ? void 0 : _a.classList.add("active");
      });
    });
    if (!document.getElementById("systemsculpt-settings-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-settings-styles";
      style.textContent = `
      .systemsculpt-settings-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 16px;
        border-bottom: 1px solid var(--background-modifier-border);
        padding-bottom: 8px;
        max-width: 100%;
      }
      
      .systemsculpt-tab-button {
        background: none;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: var(--text-normal);
        transition: all 0.2s ease;
        font-size: 0.9em;
        flex: 1 1 auto;
        min-width: 120px;
        text-align: center;
      }
      
      .systemsculpt-tab-button:hover {
        background-color: var(--background-modifier-hover);
      }
      
      .systemsculpt-tab-button.active {
        background-color: var(--interactive-accent);
        color: var(--text-on-accent);
      }
      
      .systemsculpt-tab-content {
        display: none;
        max-width: 100%;
        overflow-x: hidden;
      }
      
      .systemsculpt-tab-content.active {
        display: block;
        padding: 0 8px;
      }
      
      /* License Tab Styling */
      .systemsculpt-license-input {
        width: 100%;
        max-width: 400px;
      }
      
      .pro-badge {
        background: var(--interactive-accent);
        color: var(--text-on-accent);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: 600;
        margin-left: 8px;
        vertical-align: middle;
      }
      
      .token-balance-value {
        font-weight: 600;
        color: var(--text-accent);
        margin-left: 8px;
      }
      
      .pro-features-grid .setting-item {
        padding: 8px;
        border-radius: 4px;
        background: var(--background-secondary-alt);
        margin: 4px 0;
      }
      
      .pro-benefits-list {
        margin: 16px 0;
        padding-left: 20px;
        color: var(--text-muted);
      }
      
      .pro-benefits-list li {
        margin: 8px 0;
        list-style-type: '\u2192';
        padding-left: 20px;
        text-indent: -12px;
        word-break: break-word;
      }
    `;
      mainContainer.appendChild(style);
    }
  }
  displayLicenseTab(containerEl, isProActive) {
    containerEl.dataset.tab = "license";
    const licenseSettingContainer = containerEl.createDiv("systemsculpt-license-settings");
    licenseSettingContainer.createEl("h3", {
      text: "SystemSculpt License"
    });
    const licenseSetting = new import_obsidian11.Setting(licenseSettingContainer).setName("License Key").setDesc("Unlock Pro features with your license key").addText((text) => {
      text.setPlaceholder("Paste license key").setValue(this.plugin.settings.licenseKey).onChange(async (value) => {
        this.plugin.settings.licenseKey = value;
        await this.plugin.saveSettings();
      }).inputEl.addClass("systemsculpt-license-input");
      text.inputEl.type = "password";
      text.inputEl.style.fontFamily = "monospace";
      text.inputEl.addEventListener("focus", () => {
        text.inputEl.type = "text";
        text.inputEl.style.fontFamily = "inherit";
      });
      text.inputEl.addEventListener("blur", () => {
        text.inputEl.type = "password";
        text.inputEl.style.fontFamily = "monospace";
      });
      return text;
    }).addToggle((toggle) => {
      toggle.setValue(isProActive).setTooltip(isProActive ? "Disable Pro features" : "Enable Pro features").onChange(async (value) => {
        if (value) {
          const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true);
          if (!isValid) {
            toggle.setValue(false);
            showPopup(this.app, "Invalid license key - Pro features disabled");
          }
        } else {
          this.plugin.settings.licenseValid = false;
          await this.plugin.saveSettings();
        }
        this.display();
      });
      if (isProActive) {
        toggle.toggleEl.addClass("mod-cta");
      }
    });
    if (isProActive) {
      const statusSetting = new import_obsidian11.Setting(licenseSettingContainer).setName("Pro Status").setDesc("Active subscription \u2022 Premium features enabled");
      statusSetting.nameEl.createSpan({
        cls: "pro-badge",
        text: "ACTIVE"
      });
      const balanceEl = createSpan({
        cls: "token-balance-value",
        text: "Loading..."
      });
      statusSetting.addExtraButton((button) => {
        button.setIcon("sparkles").setTooltip("Available credits").setDisabled(true);
        statusSetting.controlEl.appendChild(balanceEl);
      });
      this.displayTokenBalance(balanceEl);
    }
    this.displayProPromotionSection(licenseSettingContainer, isProActive);
    const betaNoticeEl = licenseSettingContainer.createEl("div", {
      cls: "systemsculpt-beta-notice"
    });
    const headerContainer = betaNoticeEl.createEl("div", {
      cls: "beta-notice-header"
    });
    new import_obsidian11.Setting(headerContainer).setHeading().setName("Beta Testing Phase").addExtraButton((button) => {
      button.setIcon("rocket").setDisabled(true).extraSettingsEl.addClass("beta-header-icon");
    });
    betaNoticeEl.createEl("p", {
      text: "Thank you for trying out SystemSculpt! While some core features are available to everyone during this beta phase, certain advanced capabilities are currently limited to Patreon members to help manage the testing group size.",
      cls: "beta-notice-text"
    });
    betaNoticeEl.createEl("p", {
      text: "As a solo developer, your feedback is incredibly valuable in shaping SystemSculpt. Feel free to test the available features, and if you'd like access to the full beta experience, consider becoming a Patreon supporter!",
      cls: "beta-notice-text"
    });
    if (!document.getElementById("systemsculpt-beta-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-beta-styles";
      style.textContent = `
        .systemsculpt-beta-notice {
          margin-top: 32px;
          padding: 20px;
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .beta-notice-header {
          margin-bottom: 16px;
        }

        .beta-notice-header .setting-item {
          padding: 0;
          border: none;
        }

        .beta-notice-header .setting-item-name {
          font-size: 1.2em;
          font-weight: 600;
          color: var(--text-normal);
        }

        .beta-header-icon {
          color: var(--interactive-accent) !important;
          background: none !important;
          padding: 0 !important;
          margin-right: 8px !important;
        }

        .beta-notice-text {
          margin: 12px 0;
          color: var(--text-normal);
          line-height: 1.6;
          font-size: 0.95em;
        }

        .theme-dark .systemsculpt-beta-notice {
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
      `;
      containerEl.appendChild(style);
    }
  }
  async displayTokenBalance(containerEl) {
    try {
      const balance = await this.systemSculptService.getTokenBalance();
      containerEl.setText(`Available Credits: ${balance.toLocaleString()}`);
    } catch (error) {
      containerEl.setText("Unable to fetch credit balance");
      console.error("Failed to fetch token balance:", error);
    }
  }
  displayProPromotionSection(containerEl, isProActive) {
    if (!isProActive) {
      const proPromotionEl = containerEl.createEl("div", {
        cls: "systemsculpt-pro-promotion"
      });
      const headerContainer = proPromotionEl.createEl("div", {
        cls: "pro-promotion-header"
      });
      new import_obsidian11.Setting(headerContainer).setHeading().setName("Upgrade to Pro").addExtraButton((button) => {
        button.setIcon("sparkles").setDisabled(true).extraSettingsEl.addClass("pro-header-icon");
      });
      proPromotionEl.createEl("p", {
        text: "Transform your workflow with powerful AI features designed for serious productivity.",
        cls: "pro-promotion-text"
      });
      const benefitsList = proPromotionEl.createEl("ul", {
        cls: "pro-benefits-list"
      });
      [
        "Audio Recording & Instant Transcription",
        "Smart Document Processing",
        "Real-time Voice-to-Text in Notes & Chat",
        "Multi-format Support (PDF, Audio, Images)",
        "AI Templates & Custom Personalities",
        "Priority Access to New Features",
        "1-on-1 Support via Patreon DMs",
        "Support SystemSculpt's Development"
      ].forEach((benefit) => {
        benefitsList.createEl("li", { text: benefit });
      });
      new import_obsidian11.Setting(proPromotionEl).addButton((button) => button.setButtonText("Become a Patron").setCta().onClick(() => {
        window.open("https://patreon.com/SystemSculpt", "_blank");
      }));
    }
  }
  displayAdvancedTab(containerEl) {
    containerEl.dataset.tab = "advanced";
    new import_obsidian11.Setting(containerEl).setName("Development Mode").setDesc("Toggle between development and production API endpoints").addToggle((toggle) => toggle.setValue(this.plugin.settings.developmentMode).onChange(async (value) => {
      this.plugin.settings.developmentMode = value;
      this.plugin.settings.serverUrl = value ? "http://localhost:3001" : "https://api.systemsculpt.com";
      await this.plugin.saveSettings();
      new import_obsidian11.Notice(`Switched to ${value ? "development" : "production"} mode (${this.systemSculptService.baseUrl})`);
    }));
    const modelSetting = new import_obsidian11.Setting(containerEl).setName("AI Model").setDesc("Select which AI model to use for chat");
    modelSetting.addButton((button) => button.setButtonText("Select Model").onClick(async () => {
      button.setDisabled(true);
      try {
        const models = await this.systemSculptService.getModels();
        const modal = new ModelSelectionModal(this.app, this.plugin.settings.selectedModelId, async (modelId) => {
          this.plugin.settings.selectedModelId = modelId;
          await this.plugin.saveSettings();
          const modelDisplay = containerEl.querySelector(".systemsculpt-current-model");
          if (modelDisplay) {
            modelDisplay.setText(`Current model: ${modelId}`);
          }
        }, this.plugin);
        modal.open();
      } catch (error) {
        console.error("Error loading models:", error);
        showPopup(this.app, "Failed to load available models");
      } finally {
        button.setDisabled(false);
      }
    }));
    modelSetting.descEl.createEl("div", {
      text: `Current model: ${this.plugin.settings.selectedModelId}`,
      cls: "systemsculpt-current-model"
    });
    new import_obsidian11.Setting(containerEl).setName("Reset to Factory Settings").setDesc("Clear all custom settings and restore defaults for this plugin.").addButton((btn) => {
      btn.setButtonText("Reset\u2026").onClick(async () => {
        const confirm = await showPopup(this.app, "Reset to Factory Defaults", {
          description: "This will delete ALL saved settings and customizations for SystemSculpt, returning everything to default. Do you want to continue?",
          primaryButton: "Reset & Reload",
          secondaryButton: "Cancel"
        });
        if (!confirm || !confirm.confirmed) {
          return;
        }
        try {
          await this.plugin.getSettingsManager().updateSettings(DEFAULT_SETTINGS);
          window.location.reload();
        } catch (error) {
          console.error("Error resetting to factory settings:", error);
          showPopup(this.app, "Failed to reset: " + String(error));
        }
      });
    });
  }
  async displayDirectoriesTab(containerEl, isProActive) {
    containerEl.dataset.tab = "directories";
    containerEl.createEl("h3", { text: "Directory Settings" });
    this.createDirectorySetting(containerEl, "Chats Directory", "Select the directory for your chat history", "chatsDirectory", "SystemSculpt/Chats");
    this.createDirectorySetting(containerEl, "Recordings Directory", "Select the directory for your recordings", "recordingsDirectory", "SystemSculpt/Recordings");
    this.createDirectorySetting(containerEl, "System Prompts Directory", "Select the directory for your custom system prompts", "systemPromptsDirectory", "SystemSculpt/System Prompts");
    this.createDirectorySetting(containerEl, "Attachments Directory", "Select the directory for saved images and attachments", "attachmentsDirectory", "SystemSculpt/Attachments");
    this.createDirectorySetting(containerEl, "Extractions Directory", "Select the directory where extracted PDFs/docs will be placed", "extractionsDirectory", "SystemSculpt/Extractions");
    this.createDirectorySetting(containerEl, "Tasks Directory", "Select the directory for your task lists", "tasksDirectory", "SystemSculpt/Tasks");
  }
  createDirectorySetting(containerEl, name, desc, settingKey, placeholder) {
    new import_obsidian11.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      text.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
        await this.handleDirectoryChange(value, settingKey);
      });
      attachFolderSuggester(text.inputEl, async (selectedPath) => {
        if (this.validateDirectory(selectedPath)) {
          this.plugin.settings[settingKey] = selectedPath;
          text.setValue(selectedPath);
          await this.plugin.saveSettings();
        } else {
          showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
        }
      }, this.app);
      return text;
    });
  }
  displayChatTab(containerEl) {
    containerEl.dataset.tab = "chat";
    containerEl.createEl("h3", { text: "Chat Settings" });
    new import_obsidian11.Setting(containerEl).setName("Chat System Prompt").setDesc("Customize the system prompt used for all new chats").addButton((button) => {
      button.setButtonText("Edit Prompt").onClick(async () => {
        const result = await showSystemPromptModal(this.app, this.plugin.settings.systemPrompt, {
          onSave: async (newPrompt) => {
            this.plugin.settings.systemPrompt = newPrompt;
            await this.plugin.saveSettings();
          },
          systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
          mode: "default",
          customPromptFilePath: this.plugin.settings.systemPromptPath
        });
        if (result == null ? void 0 : result.content) {
          this.plugin.settings.systemPrompt = result.content;
          this.plugin.settings.systemPromptType = result.type;
          if ((result == null ? void 0 : result.type) === "custom" && (result == null ? void 0 : result.path)) {
            this.plugin.settings.systemPromptPath = result.path;
          } else {
            this.plugin.settings.systemPromptPath = "";
          }
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayRecorderTab(containerEl) {
    containerEl.dataset.tab = "recorder";
    containerEl.createEl("h3", { text: "Recording Settings" });
    const microphoneSetting = new import_obsidian11.Setting(containerEl).setName("Preferred Microphone").setDesc("Select your preferred microphone for recordings");
    const micSelect = microphoneSetting.controlEl.createEl("select", {
      cls: "systemsculpt-microphone-select"
    });
    micSelect.createEl("option", {
      value: "",
      text: "Loading microphones..."
    }).setAttribute("disabled", "true");
    micSelect.disabled = true;
    try {
      navigator.mediaDevices.enumerateDevices().then((devices) => {
        var _a;
        const microphones = devices.filter((device) => device.kind === "audioinput");
        micSelect.disabled = false;
        (_a = micSelect.firstElementChild) == null ? void 0 : _a.remove();
        microphones.forEach((mic) => {
          const option = micSelect.createEl("option", {
            value: mic.deviceId,
            text: mic.label || `Microphone ${mic.deviceId.slice(0, 8)}...`
          });
          if (mic.deviceId === this.plugin.settings.preferredMicrophoneId) {
            option.selected = true;
          }
        });
      }).catch((error) => {
        console.error("Error enumerating audio devices:", error);
        micSelect.createEl("option", {
          value: "",
          text: "Unable to list microphones"
        });
      });
    } catch (error) {
      console.error("Microphone initialization failed:", error);
    }
    micSelect.addEventListener("change", async () => {
      this.plugin.settings.preferredMicrophoneId = micSelect.value;
      await this.plugin.saveSettings();
    });
    new import_obsidian11.Setting(containerEl).setName("Auto-Transcribe Recordings").setDesc("Automatically transcribe recordings when they are completed").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoTranscribeRecordings).onChange(async (value) => {
      this.plugin.settings.autoTranscribeRecordings = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian11.Setting(containerEl).setName("Auto-Paste Transcription").setDesc("Automatically paste transcriptions into the active document").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoPasteTranscription).onChange(async (value) => {
      this.plugin.settings.autoPasteTranscription = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian11.Setting(containerEl).setName("Post-Processing").setDesc("Configure how transcriptions should be post-processed").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.postProcessingEnabled).setTooltip("Enable/disable post-processing").onChange(async (value) => {
        this.plugin.settings.postProcessingEnabled = value;
        await this.plugin.saveSettings();
      });
      return toggle;
    }).addButton((button) => {
      button.setButtonText("Edit Prompt").setTooltip("Configure the post-processing prompt").onClick(async () => {
        const { showPostProcessingPromptModal: showPostProcessingPromptModal2 } = await Promise.resolve().then(() => (init_PostProcessingPromptModal(), PostProcessingPromptModal_exports));
        const result = await showPostProcessingPromptModal2(this.app, this.plugin, this.plugin.settings.postProcessingPrompt);
        if (result) {
          this.plugin.settings.postProcessingPrompt = result.content;
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayTasksTab(containerEl) {
    containerEl.dataset.tab = "tasks";
    containerEl.createEl("h3", { text: "Tasks Settings" });
    new import_obsidian11.Setting(containerEl).setName("Auto-Move Completed Tasks").setDesc("Automatically move completed tasks to the bottom of the list").addToggle((toggle) => toggle.setValue(this.plugin.settings.moveCompletedTasksDown).onChange(async (value) => {
      this.plugin.settings.moveCompletedTasksDown = value;
      await this.plugin.saveSettings();
    }));
  }
};

// src/services/RecorderService.ts
var import_obsidian25 = __toModule(require("obsidian"));

// src/modals/AudioTranscriptionModal.ts
var import_obsidian12 = __toModule(require("obsidian"));

// src/services/TranscriptionService.ts
init_SystemSculptService();
var SUPPORTED_AUDIO_EXTENSIONS = ["wav", "m4a", "webm", "ogg", "mp3"];
var MIME_TYPE_MAP = {
  wav: "audio/wav",
  m4a: "audio/mp4",
  webm: "audio/webm",
  ogg: "audio/ogg;codecs=opus",
  mp3: "audio/mpeg"
};
var TranscriptionService = class {
  constructor(plugin) {
    this.isTranscribing = false;
    this.plugin = plugin;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!TranscriptionService.instance) {
      TranscriptionService.instance = new TranscriptionService(plugin);
    }
    return TranscriptionService.instance;
  }
  async parseErrorResponse(response) {
    try {
      const data = await response.json();
      if (data.error) {
        if (typeof data.error === "string") {
          return { message: data.error, data };
        }
        if (data.error.message) {
          return { message: data.error.message, data };
        }
        return { message: JSON.stringify(data.error), data };
      }
      return { message: response.statusText, data };
    } catch (e) {
      return { message: response.statusText };
    }
  }
  async transcribeFile(file, context) {
    var _a, _b, _c, _d;
    console.log("TranscriptionService.transcribeFile called with:", {
      fileName: file.name,
      context
    });
    if (this.isTranscribing) {
      throw new Error("Already transcribing a file");
    }
    const extension = file.extension.toLowerCase();
    if (!SUPPORTED_AUDIO_EXTENSIONS.includes(extension)) {
      throw new Error(`Unsupported file type: ${extension}`);
    }
    this.isTranscribing = true;
    (_a = context == null ? void 0 : context.onProgress) == null ? void 0 : _a.call(context, 0, "Reading audio file...");
    const arrayBuffer = await this.plugin.app.vault.readBinary(file);
    const blob = new Blob([arrayBuffer], {
      type: MIME_TYPE_MAP[extension]
    });
    const formData = new FormData();
    formData.append("file", blob, file.name);
    if (context == null ? void 0 : context.timestamped) {
      formData.append("timestamped", "true");
    }
    try {
      (_b = context == null ? void 0 : context.onProgress) == null ? void 0 : _b.call(context, 20, "Uploading audio...");
      const response = await fetch(`${this.sculptService.baseUrl}/api/v1/audio/transcriptions`, {
        method: "POST",
        headers: {
          "x-license-key": this.plugin.settings.licenseKey
        },
        body: formData
      });
      console.log("Raw server response:", {
        status: response.status,
        ok: response.ok,
        contentType: response.headers.get("content-type")
      });
      let data;
      if (!response.ok) {
        const { message: errorMessage, data: parsedData } = await this.parseErrorResponse(response);
        console.log("Error response parsed:", { errorMessage, parsedData });
        if (response.status === 400 && errorMessage === "Credits charged successfully") {
          console.log("Credits charged successfully, continuing with transcription...");
          data = parsedData;
        } else {
          throw new Error(`Failed to transcribe file: ${response.status} - ${errorMessage}`);
        }
      } else {
        const responseText = await response.text();
        console.log("Raw response text:", responseText);
        try {
          data = JSON.parse(responseText);
          console.log("Parsed response data:", data);
        } catch (e) {
          console.error("Failed to parse response JSON:", e);
          throw new Error("Invalid JSON response from server");
        }
      }
      (_c = context == null ? void 0 : context.onProgress) == null ? void 0 : _c.call(context, 60, "Processing audio...");
      console.log("Final data object:", {
        hasData: !!data,
        dataType: typeof data,
        keys: data ? Object.keys(data) : null,
        textType: (data == null ? void 0 : data.text) ? typeof data.text : null,
        textLength: (data == null ? void 0 : data.text) ? data.text.length : null,
        textPreview: (data == null ? void 0 : data.text) ? data.text.substring(0, 100) + "..." : null
      });
      if (!data || typeof data.text !== "string") {
        console.error("Invalid response data:", data);
        throw new Error("No transcription text received from server");
      }
      const trimmedText = data.text.trim();
      console.log("Trimmed text:", {
        length: trimmedText.length,
        preview: trimmedText.substring(0, 100) + "..."
      });
      if (!trimmedText) {
        console.error("Empty transcription text after trimming:", data);
        throw new Error("Empty transcription text received from server");
      }
      if (data.cost_info) {
        console.log("Transcription cost details:", {
          duration: `${data.cost_info.audio_duration_seconds}s (${data.cost_info.audio_duration_hours}h)`,
          raw_cost: `$${data.cost_info.raw_cost_usd.toFixed(4)}`,
          markup_rate: `${(data.cost_info.markup_rate * 100).toFixed(1)}%`,
          final_cost: `${data.cost_info.final_cost_credits} credits`,
          file_size: `${(data.cost_info.file_size_bytes / 1024 / 1024).toFixed(2)}MB`
        });
      }
      (_d = context == null ? void 0 : context.onProgress) == null ? void 0 : _d.call(context, 100, "Transcription complete!");
      return trimmedText;
    } catch (error) {
      console.error("Transcription error:", error);
      throw error;
    } finally {
      this.isTranscribing = false;
    }
  }
  unload() {
  }
};

// src/services/PostProcessingService.ts
init_SystemSculptService();
var PostProcessingService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.defaultModelId = null;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!PostProcessingService.instance) {
      PostProcessingService.instance = new PostProcessingService(plugin);
    }
    return PostProcessingService.instance;
  }
  async findDefaultModel() {
    if (this.defaultModelId)
      return this.defaultModelId;
    try {
      const models = await this.sculptService.getModels();
      const defaultModel = models.find((model) => {
        var _a;
        return (_a = model.name) == null ? void 0 : _a.match(/\(Default\)/i);
      });
      if (!defaultModel) {
        throw new Error("Default model not found");
      }
      this.defaultModelId = defaultModel.id;
      return defaultModel.id;
    } catch (error) {
      console.error("Error finding default model:", error);
      throw error;
    }
  }
  async processTranscription(text) {
    if (!this.plugin.settings.postProcessingEnabled) {
      return text;
    }
    try {
      const modelId = await this.findDefaultModel();
      const messages = [
        {
          role: "system",
          content: this.plugin.settings.postProcessingPrompt,
          message_id: crypto.randomUUID()
        },
        {
          role: "user",
          content: text,
          message_id: crypto.randomUUID()
        }
      ];
      let processedText = "";
      for await (const chunk of this.sculptService.streamMessage({
        messages,
        model: modelId,
        temperature: 0.3
      })) {
        if (chunk.content) {
          processedText += chunk.content;
        }
      }
      return processedText.trim();
    } catch (error) {
      console.error("Error post-processing transcription:", error);
      return text;
    }
  }
};

// src/modals/AudioTranscriptionModal.ts
var PersistentTranscriptionNotice = class extends import_obsidian12.Notice {
  constructor() {
    super("", 0);
    this.noticeEl.addClass("systemsculpt-transcription-notice");
    const progressContainer = this.noticeEl.createDiv("transcription-progress");
    const statusContainer = progressContainer.createDiv("transcription-status");
    this.statusIcon = statusContainer.createDiv("transcription-status-icon");
    this.statusText = statusContainer.createDiv("transcription-status-text");
    const progressBarContainer = progressContainer.createDiv("transcription-progress-bar-container");
    this.progressBar = progressBarContainer.createDiv("transcription-progress-bar");
    if (!document.getElementById("systemsculpt-transcription-notice-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-transcription-notice-styles";
      style.textContent = `
        .systemsculpt-transcription-notice {
          padding: 8px 12px !important;
          min-width: 260px;
        }

        .transcription-progress {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .transcription-status {
          display: flex;
          align-items: center;
          gap: 8px;
          color: var(--text-normal);
        }

        .transcription-status-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--text-accent);
        }

        .transcription-status-text {
          flex: 1;
          font-size: 14px;
        }

        .transcription-progress-bar-container {
          width: 100%;
          height: 4px;
          background: var(--background-modifier-border);
          border-radius: 2px;
          overflow: hidden;
        }

        .transcription-progress-bar {
          height: 100%;
          background: var(--text-accent);
          border-radius: 2px;
          transition: width 0.3s ease;
          width: 0%;
        }

        .notice-success .transcription-progress-bar {
          background: var(--text-success) !important;
        }

        .notice-error .transcription-progress-bar {
          background: var(--text-error) !important;
        }
      `;
      document.head.appendChild(style);
    }
  }
  updateProgress({ progress, status, icon }) {
    this.progressBar.style.width = `${progress}%`;
    this.statusText.setText(status);
    this.statusIcon.empty();
    (0, import_obsidian12.setIcon)(this.statusIcon, icon);
    this.noticeEl.removeClass("notice-success", "notice-error");
    if (progress === 100) {
      this.noticeEl.addClass("notice-success");
    } else if (progress === 0 && icon === "x-circle") {
      this.noticeEl.addClass("notice-error");
    }
  }
};
var AudioTranscriptionModal = class {
  constructor(app, options) {
    this.options = options;
    this.transcriptionService = TranscriptionService.getInstance(options.plugin);
    this.postProcessingService = PostProcessingService.getInstance(options.plugin);
  }
  open() {
    this.notice = new PersistentTranscriptionNotice();
    this.startTranscription();
  }
  async startTranscription() {
    try {
      this.notice.updateProgress({
        progress: 0,
        status: "Starting transcription...",
        icon: "mic"
      });
      const text = await this.transcriptionService.transcribeFile(this.options.file, {
        type: this.options.isChat ? "chat" : "note",
        timestamped: this.options.timestamped,
        onProgress: (progress, status) => {
          this.notice.updateProgress({
            progress,
            status,
            icon: "audio-lines"
          });
        }
      });
      if (!text) {
        throw new Error("Failed to get transcription text");
      }
      let finalText = text;
      let processedText = "";
      if (this.options.plugin.settings.postProcessingEnabled) {
        this.notice.updateProgress({
          progress: 80,
          status: "Post-processing transcription...",
          icon: "wand"
        });
        processedText = await this.postProcessingService.processTranscription(text);
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}

## Processed Transcription
${processedText}`;
      } else {
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}`;
      }
      if (this.options.onTranscriptionComplete) {
        this.options.onTranscriptionComplete(finalText);
      }
      await navigator.clipboard.writeText(finalText);
      this.notice.updateProgress({
        progress: 100,
        status: "Transcription complete!",
        icon: "check-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 2e3);
    } catch (error) {
      console.error("Transcription error:", error);
      this.notice.updateProgress({
        progress: 0,
        status: `Error: ${error instanceof Error ? error.message : String(error)}`,
        icon: "x-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 4e3);
    }
  }
};
async function showAudioTranscriptionModal(app, options) {
  const modal = new AudioTranscriptionModal(app, options);
  modal.open();
}

// src/views/ChatView.ts
var import_obsidian24 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/services/ChatStorageService.ts
var import_obsidian13 = __toModule(require("obsidian"));
var ChatStorageService = class {
  constructor(app, chatDirectory) {
    this.app = app;
    this.chatDirectory = chatDirectory;
  }
  async saveChat(chatId, messages, selectedModelId, contextFiles, customPromptFilePath, systemPromptType, systemPromptPath, title, tokenLimit, tokenLimitPercentage) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const contextFileObjects = contextFiles ? Array.from(contextFiles).map((path) => {
        const isExtraction = path.includes("/Extractions/");
        return {
          path,
          type: isExtraction ? "extraction" : "source"
        };
      }) : [];
      const metadata = {
        id: chatId,
        model: selectedModelId,
        created: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        title: title || "Untitled Chat",
        context_files: contextFileObjects,
        systemMessage: systemPromptType ? {
          type: systemPromptType,
          path: systemPromptType === "custom" && systemPromptPath ? `[[${systemPromptPath}]]` : void 0,
          tokenLimit,
          tokenLimitPercentage
        } : void 0
      };
      const content = `---
${(0, import_obsidian13.stringifyYaml)(metadata)}---

${messages.map((msg) => {
        const messageStart = `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`;
        return `${messageStart}
${msg.content}
<!-- SYSTEMSCULPT-MESSAGE-END -->`;
      }).join("\n\n")}`;
      await this.app.vault.adapter.mkdir(this.chatDirectory);
      await this.app.vault.adapter.write(filePath, content);
    } catch (error) {
      console.error("Failed to save chat:", error);
      throw new Error("Failed to save chat");
    }
  }
  async loadChats() {
    try {
      const files = await this.app.vault.adapter.list(this.chatDirectory);
      const chatFiles = files.files.filter((f) => f.endsWith(".md"));
      const chats = await Promise.all(chatFiles.map(async (filePath) => {
        const content = await this.app.vault.adapter.read(filePath);
        return this.parseMarkdownContent(content);
      }));
      return chats.filter((chat) => chat !== null);
    } catch (error) {
      console.error("Failed to load chats:", error);
      return [];
    }
  }
  async loadChat(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian13.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMarkdownContent(content);
    } catch (error) {
      console.error("Failed to load chat:", error);
      return null;
    }
  }
  generateMarkdownContent(metadata, messages) {
    const yamlMetadata = {
      systemsculpt_chat: true,
      ...metadata
    };
    const metadataSection = [
      "---",
      (0, import_obsidian13.stringifyYaml)(yamlMetadata).trim(),
      "---",
      ""
    ].join("\n");
    const messagesSection = messages.map((msg) => [
      `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`,
      msg.content,
      "<!-- SYSTEMSCULPT-MESSAGE-END -->",
      ""
    ].join("\n")).join("\n");
    return metadataSection + messagesSection;
  }
  parseMetadata(content) {
    try {
      const metadataMatch = content.match(/---\n([\s\S]*?)\n---/);
      if (!metadataMatch)
        return null;
      const parsed = (0, import_obsidian13.parseYaml)(metadataMatch[1]);
      if (!parsed || typeof parsed !== "object")
        return null;
      const {
        id,
        model,
        created,
        lastModified,
        title,
        context_files,
        systemMessage
      } = parsed;
      if (!id || !model || !created || !lastModified)
        return null;
      const processedContextFiles = context_files == null ? void 0 : context_files.map((file) => {
        if (typeof file === "string") {
          const isExtraction = file.includes("/Extractions/");
          return {
            path: file,
            type: isExtraction ? "extraction" : "source"
          };
        }
        return {
          path: file.path,
          type: file.type
        };
      });
      if (systemMessage == null ? void 0 : systemMessage.path) {
        systemMessage.path = systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      return {
        id,
        model,
        created,
        lastModified,
        title: title || "Untitled Chat",
        context_files: processedContextFiles || [],
        systemMessage
      };
    } catch (error) {
      console.error("Failed to parse metadata:", error);
      return null;
    }
  }
  async parseMarkdownContent(content) {
    var _a, _b, _c;
    try {
      const metadata = this.parseMetadata(content);
      if (!metadata)
        return null;
      const messages = [];
      const messageRegex = /<!-- SYSTEMSCULPT-MESSAGE-START role="(user|assistant)" message-id="([^"]+)" -->\n([\s\S]*?)\n<!-- SYSTEMSCULPT-MESSAGE-END -->/g;
      let msgMatch;
      while ((msgMatch = messageRegex.exec(content)) !== null) {
        const [, role, messageId, messageContent] = msgMatch;
        messages.push({
          role,
          content: messageContent.trim(),
          message_id: messageId
        });
      }
      const contextFiles = (_a = metadata.context_files) == null ? void 0 : _a.map((file) => typeof file === "string" ? file : file.path);
      return {
        id: metadata.id,
        messages,
        selectedModelId: metadata.model,
        lastModified: new Date(metadata.lastModified).getTime(),
        title: metadata.title,
        context_files: contextFiles,
        customPromptFilePath: (_b = metadata.systemMessage) == null ? void 0 : _b.path,
        tokenLimit: (_c = metadata.systemMessage) == null ? void 0 : _c.tokenLimit
      };
    } catch (error) {
      console.error("Failed to parse markdown content:", error);
      return null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async getMetadata(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian13.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMetadata(content);
    } catch (error) {
      console.error("Failed to get metadata:", error);
      return null;
    }
  }
};

// src/services/ScrollManagerService.ts
var import_obsidian14 = __toModule(require("obsidian"));
var ScrollManagerService = class {
  constructor(config) {
    this.state = {
      isAutoScrollEnabled: true,
      isUserScrolling: false,
      lastContentHeight: 0
    };
    this.handleScroll = (0, import_obsidian14.debounce)(() => {
      const isAtBottom = this.isScrolledToBottom();
      if (isAtBottom && !this.state.isAutoScrollEnabled) {
        this.enableAutoScroll();
      } else if (!isAtBottom && this.state.isAutoScrollEnabled) {
        this.disableAutoScroll();
      }
    }, 150);
    this.handleWheel = (e) => {
      if (e.deltaY < 0) {
        this.disableAutoScroll();
      }
    };
    this.handleTouchStart = () => {
      this.state.isUserScrolling = true;
    };
    this.handleTouchEnd = () => {
      this.state.isUserScrolling = false;
      if (this.isScrolledToBottom()) {
        this.enableAutoScroll();
      }
    };
    this.container = config.container;
    this.onScrollStateChange = config.onScrollStateChange;
    this.attachEventListeners();
  }
  attachEventListeners() {
    this.container.addEventListener("scroll", this.handleScroll);
    this.container.addEventListener("wheel", this.handleWheel);
    this.container.addEventListener("touchstart", this.handleTouchStart);
    this.container.addEventListener("touchend", this.handleTouchEnd);
  }
  isScrolledToBottom() {
    const { scrollHeight, scrollTop, clientHeight } = this.container;
    return Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
  }
  scrollToBottom() {
    if (!this.state.isAutoScrollEnabled)
      return;
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      this.container.scrollTo({
        top: this.container.scrollHeight,
        behavior: this.state.isUserScrolling ? "smooth" : "auto"
      });
      this.state.lastContentHeight = this.container.scrollHeight;
    });
  }
  enableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = true;
    this.state.isUserScrolling = false;
    this.state.lastContentHeight = this.container.scrollHeight;
    this.scrollToBottom();
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, true);
  }
  disableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = false;
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, false);
  }
  updateContentHeight() {
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      const currentHeight = this.container.scrollHeight;
      if (currentHeight !== this.state.lastContentHeight) {
        this.state.lastContentHeight = currentHeight;
        if (!this.container.scrollTop || this.isScrolledToBottom()) {
          this.scrollToBottom();
        }
      }
    });
  }
  cleanup() {
    this.container.removeEventListener("scroll", this.handleScroll);
    this.container.removeEventListener("wheel", this.handleWheel);
    this.container.removeEventListener("touchstart", this.handleTouchStart);
    this.container.removeEventListener("touchend", this.handleTouchEnd);
  }
};

// src/views/ChatView.ts
init_ui();
init_errors();

// src/views/components/DrawerComponent.ts
var import_obsidian15 = __toModule(require("obsidian"));
var DrawerComponent = class extends import_obsidian15.Component {
  constructor(options) {
    super();
    this.isMouseInProximity = false;
    this.hideTimeout = null;
    this.options = options;
    this.initializeDrawer();
    this.setupEventListeners();
  }
  initializeDrawer() {
    this.drawer = this.options.container.createEl("div", {
      cls: `systemsculpt-drawer ${this.options.cls || ""}`
    });
    this.header = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-header"
    });
    const titleEl = this.header.createEl("div", {
      cls: "systemsculpt-drawer-title"
    });
    titleEl.createSpan({ text: this.options.title });
    this.toggle = this.header.createSpan({
      cls: "systemsculpt-drawer-toggle",
      text: "\u25BC"
    });
    this.content = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-content"
    });
    this.setVisibility(false);
  }
  setupEventListeners() {
    this.drawer.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true, true);
    });
    this.content.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true, true);
    });
    this.drawer.addEventListener("mouseleave", (e) => {
      const rect = this.drawer.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY >= rect.bottom && e.clientY <= rect.bottom + buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.content.addEventListener("mouseleave", (e) => {
      const rect = this.content.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY <= rect.top && e.clientY >= rect.top - buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
  }
  clearHideTimeout() {
    if (this.hideTimeout) {
      clearTimeout(this.hideTimeout);
      this.hideTimeout = null;
    }
  }
  scheduleHide() {
    this.clearHideTimeout();
    this.hideTimeout = setTimeout(() => {
      if (!this.isMouseInProximity) {
        this.setVisibility(false);
      }
    }, 100);
  }
  setVisibility(visible, expanded = false) {
    this.content.style.opacity = visible ? "1" : "0";
    this.content.style.pointerEvents = visible ? "all" : "none";
    this.content.style.transform = `translateY(${visible ? "0" : "-8px"})`;
    this.toggle.style.transform = visible ? "rotate(0)" : "rotate(-90deg)";
    if (this.options.onVisibilityChange) {
      this.options.onVisibilityChange(visible);
    }
  }
  getContent() {
    return this.content;
  }
  getDrawer() {
    return this.drawer;
  }
  getHeader() {
    return this.header;
  }
  onunload() {
    this.clearHideTimeout();
    super.onunload();
  }
};

// src/views/components/MessageRenderer.ts
var import_obsidian16 = __toModule(require("obsidian"));
init_ui();
var MessageRenderer = class extends import_obsidian16.Component {
  constructor(app) {
    super();
    this.app = app;
  }
  async renderMessage({
    app,
    messageId,
    role,
    content
  }) {
    const messageEl = document.createElement("div");
    messageEl.classList.add("systemsculpt-message");
    messageEl.classList.add(`systemsculpt-${role}-message`);
    messageEl.dataset.messageId = messageId;
    const contentEl = messageEl.createEl("div", {
      cls: "systemsculpt-message-content"
    });
    if (typeof content === "string") {
      await import_obsidian16.MarkdownRenderer.renderMarkdown(content, contentEl, "", this);
    } else if (Array.isArray(content)) {
      const parts = content;
      for (const part of parts) {
        if (part.type === "text") {
          const p = contentEl.createEl("p");
          p.setText(part.text);
        } else if (part.type === "image_url") {
          const img = contentEl.createEl("img", {
            attr: { src: part.image_url.url }
          });
          img.classList.add("systemsculpt-message-image");
        }
      }
    } else {
      await import_obsidian16.MarkdownRenderer.renderMarkdown(String(content), contentEl, "", this);
    }
    this.setupImageHandlers(contentEl);
    return { messageEl, contentEl };
  }
  async renderMarkdownContent(content, containerEl) {
    containerEl.empty();
    const markdownWrapper = containerEl.createEl("div", {
      cls: "systemsculpt-markdown-wrapper"
    });
    const normalizedContent = content.replace(/\n{3,}/g, "\n\n");
    await import_obsidian16.MarkdownRenderer.renderMarkdown(normalizedContent, markdownWrapper, "", this);
    markdownWrapper.querySelectorAll("pre").forEach((preEl) => {
      var _a;
      const codeBlockWrapper = createEl("div", {
        cls: "systemsculpt-code-block-wrapper"
      });
      (_a = preEl.parentNode) == null ? void 0 : _a.replaceChild(codeBlockWrapper, preEl);
      codeBlockWrapper.appendChild(preEl);
    });
  }
  setupImageHandlers(containerEl) {
    containerEl.querySelectorAll("img").forEach((img) => {
      img.style.cursor = "pointer";
      img.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();
        const src = img.getAttribute("src");
        if (!src)
          return;
        if (src.startsWith("app://")) {
          const path = src.replace("app://local/", "");
          this.app.workspace.openLinkText(path, "", true);
        }
      });
    });
  }
  setToolbarVisibility(toolbar, visible, expanded = false) {
    toolbar.style.opacity = visible ? "1" : "0";
    toolbar.style.pointerEvents = visible ? "all" : "none";
    toolbar.style.transform = `translateY(calc(100% + ${expanded ? "4" : "8"}px))`;
  }
  addMessageButtonToolbar(messageEl, content, role, messageId) {
    const buttonToolbar = messageEl.createEl("div", {
      cls: "systemsculpt-message-button-toolbar"
    });
    const copyButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    copyButton.setAttribute("title", "Copy message to clipboard");
    (0, import_obsidian16.setIcon)(copyButton, "copy");
    copyButton.addEventListener("click", () => {
      navigator.clipboard.writeText(content);
      (0, import_obsidian16.setIcon)(copyButton, "check");
      copyButton.classList.add("success");
      setTimeout(() => {
        (0, import_obsidian16.setIcon)(copyButton, "copy");
        copyButton.classList.remove("success");
        this.setToolbarVisibility(buttonToolbar, false);
      }, 2e3);
    });
    if (role === "user") {
      const resubmitButton = buttonToolbar.createEl("button", {
        cls: "systemsculpt-message-button"
      });
      resubmitButton.setAttribute("title", "Resubmit this message");
      (0, import_obsidian16.setIcon)(resubmitButton, "rotate-ccw");
      resubmitButton.dataset.originalIcon = "rotate-ccw";
      resubmitButton.addEventListener("click", async (e) => {
        e.stopPropagation();
        const isConfirming = resubmitButton.dataset.confirming === "true";
        if (!isConfirming) {
          resubmitButton.dataset.confirming = "true";
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmit?" });
          resubmitButton.classList.add("confirming", "success");
          const timeoutId = setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian16.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 3e3);
          resubmitButton.dataset.timeoutId = timeoutId.toString();
        } else {
          const timeoutId = resubmitButton.dataset.timeoutId;
          if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
          }
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmitting..." });
          messageEl.dispatchEvent(new CustomEvent("resubmit", {
            bubbles: true,
            detail: { messageId, content }
          }));
          setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian16.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 1e3);
        }
      });
    }
    const editButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    editButton.setAttribute("title", "Edit this message");
    (0, import_obsidian16.setIcon)(editButton, "pencil");
    editButton.dataset.originalIcon = "pencil";
    editButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const currentContent = messageEl.dataset.content || content;
      const modal = new TextAreaModal(this.app, "Edit Message", currentContent, {
        primaryButton: "Save",
        secondaryButton: "Cancel",
        rows: 10
      });
      const newText = await modal.openAndGetValue();
      if (newText !== null && newText !== currentContent) {
        messageEl.dispatchEvent(new CustomEvent("edit", {
          bubbles: true,
          detail: {
            messageId,
            oldContent: currentContent,
            newContent: newText
          }
        }));
      }
    });
    const deleteButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button danger"
    });
    deleteButton.setAttribute("title", "Delete this message");
    (0, import_obsidian16.setIcon)(deleteButton, "trash");
    deleteButton.dataset.originalIcon = "trash";
    deleteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isConfirming = deleteButton.dataset.confirming === "true";
      if (!isConfirming) {
        deleteButton.dataset.confirming = "true";
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Delete?" });
        deleteButton.classList.add("confirming");
        const timeoutId = setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian16.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 3e3);
        deleteButton.dataset.timeoutId = timeoutId.toString();
      } else {
        const timeoutId = deleteButton.dataset.timeoutId;
        if (timeoutId) {
          clearTimeout(parseInt(timeoutId));
        }
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Deleting..." });
        messageEl.dispatchEvent(new CustomEvent("delete", {
          bubbles: true,
          detail: { messageId }
        }));
        setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian16.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 1e3);
      }
    });
    messageEl.addEventListener("mouseenter", () => {
      this.setToolbarVisibility(buttonToolbar, true, true);
    });
    messageEl.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !buttonToolbar.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
    buttonToolbar.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !messageEl.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
  }
  createReasoningContainer(messageEl) {
    const container = messageEl.createEl("div", {
      cls: "systemsculpt-reasoning-container"
    });
    const header = container.createEl("div", {
      cls: "systemsculpt-reasoning-header"
    });
    (0, import_obsidian16.setIcon)(header, "brain");
    header.createSpan({ text: "Reasoning" });
    header.addEventListener("click", () => {
      container.classList.toggle("collapsed");
    });
    const content = container.createEl("div", {
      cls: "systemsculpt-reasoning-content"
    });
    return { container, content };
  }
  updateReasoningContent(messageEl, reasoning, isComplete = false) {
    let container = messageEl.querySelector(".systemsculpt-reasoning-container");
    let content = messageEl.querySelector(".systemsculpt-reasoning-content");
    if (!container || !content) {
      const elements = this.createReasoningContainer(messageEl);
      container = elements.container;
      content = elements.content;
      messageEl.prepend(container);
    }
    content.textContent = reasoning;
    container.classList.add("visible");
    if (isComplete) {
      container.classList.add("collapsed");
    }
  }
};

// src/views/components/InputHandler.ts
var import_obsidian18 = __toModule(require("obsidian"));
init_errors();
init_ui();
init_ImageProcessor();

// src/services/TokenCounterService.ts
var import_obsidian17 = __toModule(require("obsidian"));
var TokenCounterService = class {
  constructor() {
    this.cache = new Map();
    this.fileCache = new Map();
    this.cacheSize = 1e3;
    this.handleFileModify = this.handleFileModify.bind(this);
    this.handleFileDelete = this.handleFileDelete.bind(this);
    this.handleFileRename = this.handleFileRename.bind(this);
  }
  handleFileModify(file) {
    if (file instanceof import_obsidian17.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileDelete(file) {
    if (file instanceof import_obsidian17.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileRename(file, oldPath) {
    if (file instanceof import_obsidian17.TFile) {
      this.fileCache.delete(oldPath);
    }
  }
  static getInstance() {
    if (!TokenCounterService.instance) {
      TokenCounterService.instance = new TokenCounterService();
    }
    return TokenCounterService.instance;
  }
  setApp(app) {
    this.app = app;
    this.app.vault.on("modify", this.handleFileModify);
    this.app.vault.on("delete", this.handleFileDelete);
    this.app.vault.on("rename", this.handleFileRename);
  }
  async getFileTokenCount(file) {
    const cached = this.fileCache.get(file.path);
    if (cached && cached.mtime === file.stat.mtime) {
      return cached.tokens;
    }
    const content = await this.app.vault.read(file);
    const tokens = this.approximateTokenCount(content);
    this.fileCache.set(file.path, {
      tokens,
      mtime: file.stat.mtime
    });
    return tokens;
  }
  approximateTokenCount(text) {
    if (!text)
      return 0;
    const cacheKey = `${text.slice(0, 100)}_${text.length}`;
    const cached = this.cache.get(cacheKey);
    if (cached !== void 0)
      return cached;
    text = text.replace(/\s+/g, " ").trim();
    let tokenCount = 0;
    const commonPatterns = [
      /^https?:\/\/\S+/gm,
      /[@#]\w+/g,
      /:[a-z_]+:/g,
      /[A-Z]{2,}/g,
      /\d{1,16}/g,
      /[.,!?;:(){}\[\]"']/g
    ];
    for (const pattern of commonPatterns) {
      const matches = text.match(pattern);
      if (matches) {
        tokenCount += matches.reduce((sum, match) => {
          if (match.startsWith("http")) {
            return sum + Math.ceil(match.length / 4);
          } else if (match.length <= 4) {
            return sum + 1;
          } else {
            return sum + Math.ceil(match.length / 3);
          }
        }, 0);
        text = text.replace(pattern, " ");
      }
    }
    const words = text.split(/\s+/).filter((w) => w.length > 0);
    for (const word of words) {
      let wordTokens = 1;
      if (word.length > 4) {
        wordTokens += Math.floor((word.length - 4) / 3);
      }
      if (/[a-z][A-Z]/.test(word)) {
        wordTokens += (word.match(/[A-Z]/g) || []).length;
      }
      const nonAscii = (word.match(/[^\x00-\x7F]/g) || []).length;
      if (nonAscii > 0) {
        wordTokens += Math.ceil(nonAscii * 1.5);
      }
      tokenCount += wordTokens;
    }
    tokenCount = Math.ceil(tokenCount * 1.1);
    this.cacheResult(cacheKey, tokenCount);
    return tokenCount;
  }
  cacheResult(key, value) {
    if (this.cache.size >= this.cacheSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
  clearCache() {
    this.cache.clear();
    this.fileCache.clear();
  }
  unload() {
    if (this.app) {
      this.app.vault.off("modify", this.handleFileModify);
      this.app.vault.off("delete", this.handleFileDelete);
      this.app.vault.off("rename", this.handleFileRename);
    }
  }
  formatTokenCount(count) {
    if (count === 0)
      return "";
    if (count < 100)
      return "< 100 tokens";
    if (count >= 1e3) {
      const inK = Math.ceil(count / 1e3);
      return `~${inK}K tokens`;
    } else {
      const inHundreds = Math.ceil(count / 100) * 100;
      return `~${inHundreds} tokens`;
    }
  }
};

// src/views/components/InputHandler.ts
var InputHandler = class extends import_obsidian18.Component {
  constructor(options) {
    super();
    this.isGenerating = false;
    this.renderTimeout = null;
    this.recorderVisualizer = null;
    this.isRecording = false;
    this.abortController = null;
    this.stopButton = null;
    this.tokenCountTimeout = null;
    this.webSearchEnabled = false;
    this.app = options.app;
    this.container = options.container;
    this.aiService = options.aiService;
    this.getMessages = options.getMessages;
    this.getSelectedModelId = options.getSelectedModelId;
    this.getContextFiles = options.getContextFiles;
    this.getSystemPrompt = options.getSystemPrompt;
    this.chatContainer = options.chatContainer;
    this.scrollManager = options.scrollManager;
    this.messageRenderer = options.messageRenderer;
    this.onMessageSubmit = options.onMessageSubmit;
    this.onAssistantResponse = options.onAssistantResponse;
    this.onContextFileAdd = options.onContextFileAdd;
    this.onError = options.onError;
    this.onAddContextFile = options.onAddContextFile;
    this.onEditSystemPrompt = options.onEditSystemPrompt;
    this.plugin = options.plugin;
    this.chatView = options.chatView;
    console.log("Initializing InputHandler with RecorderService");
    this.recorderService = RecorderService.getInstance(this.app, this.plugin, {
      isInChat: true,
      onTranscriptionComplete: (text) => {
        console.log("Received transcription, inserting at cursor position");
        this.insertTextAtCursor(text);
      }
    });
    const originalMessageSubmit = options.onMessageSubmit;
    this.onMessageSubmit = async (message) => {
      await originalMessageSubmit(message);
      await this.updateTokenCount().catch(console.error);
    };
    const originalAssistantResponse = options.onAssistantResponse;
    this.onAssistantResponse = async (message) => {
      await originalAssistantResponse(message);
      await this.updateTokenCount().catch(console.error);
    };
    this.tokenCounterService = TokenCounterService.getInstance();
    this.tokenCounterService.setApp(this.app);
    this.setupInput();
    setTimeout(() => {
      console.log("Running initial token count");
      console.log("Current messages:", this.getMessages().length);
      this.updateTokenCount().catch(console.error);
    }, 100);
  }
  setupInput() {
    this.inputContainer = this.container.createEl("div", {
      cls: "systemsculpt-input-container"
    });
    this.buttonGrid = this.inputContainer.createEl("div", {
      cls: "systemsculpt-button-grid"
    });
    const attachButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Add attachment" }
    });
    (0, import_obsidian18.setIcon)(attachButton, "paperclip");
    attachButton.addEventListener("click", (e) => {
      if (e.shiftKey) {
        this.handleDocumentUpload();
      } else {
        this.onAddContextFile();
      }
    });
    const settingsButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "System prompt settings" }
    });
    (0, import_obsidian18.setIcon)(settingsButton, "settings");
    settingsButton.addEventListener("click", () => {
      this.onEditSystemPrompt();
    });
    const webSearchButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Toggle web search" }
    });
    (0, import_obsidian18.setIcon)(webSearchButton, "globe");
    webSearchButton.addEventListener("click", () => {
      this.webSearchEnabled = !this.webSearchEnabled;
      webSearchButton.classList.toggle("is-enabled", this.webSearchEnabled);
    });
    const micButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-mic-button",
      attr: { "aria-label": "Record audio message" }
    });
    (0, import_obsidian18.setIcon)(micButton, "mic");
    micButton.addEventListener("click", this.handleMicClick.bind(this));
    const sendButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-send-button",
      attr: { "aria-label": "Send message" }
    });
    (0, import_obsidian18.setIcon)(sendButton, "send");
    sendButton.addEventListener("click", this.handleSendMessage.bind(this));
    this.stopButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-stop-button",
      attr: { "aria-label": "Stop generation" }
    });
    (0, import_obsidian18.setIcon)(this.stopButton, "square");
    this.stopButton.style.display = "none";
    this.stopButton.addEventListener("click", this.handleStopGeneration.bind(this));
    this.input = this.inputContainer.createEl("textarea", {
      cls: "systemsculpt-input systemsculpt-chat-input",
      attr: {
        rows: "1",
        placeholder: "Type a message..."
      }
    });
    this.tokenCounter = this.inputContainer.createEl("div", {
      cls: "systemsculpt-token-counter",
      text: "0 tokens"
    });
    this.input.addEventListener("keydown", this.handleKeyDown.bind(this));
    this.input.addEventListener("input", this.adjustInputHeight.bind(this));
    this.input.addEventListener("paste", this.handlePaste.bind(this));
    this.recorderService.onToggle((isRecording) => {
      this.isRecording = isRecording;
      const micButton2 = this.buttonGrid.querySelector(".systemsculpt-mic-button");
      if (micButton2) {
        micButton2.classList.toggle("active", isRecording);
      }
    });
    this.updateGeneratingState = () => {
      this.input.disabled = this.isGenerating;
      sendButton.disabled = this.isGenerating;
      micButton.disabled = this.isGenerating;
      attachButton.disabled = this.isGenerating;
      settingsButton.disabled = this.isGenerating;
      webSearchButton.disabled = this.isGenerating;
      if (this.stopButton) {
        this.stopButton.style.display = this.isGenerating ? "flex" : "none";
        sendButton.style.display = this.isGenerating ? "none" : "flex";
      }
      this.input.placeholder = this.isGenerating ? "Waiting for response..." : "Type a message...";
      this.input.classList.toggle("disabled", this.isGenerating);
      sendButton.classList.toggle("disabled", this.isGenerating);
      micButton.classList.toggle("disabled", this.isGenerating);
      attachButton.classList.toggle("disabled", this.isGenerating);
      settingsButton.classList.toggle("disabled", this.isGenerating);
      webSearchButton.classList.toggle("disabled", this.isGenerating);
    };
    this.input.addEventListener("input", () => {
      this.adjustInputHeight();
      if (this.tokenCountTimeout) {
        clearTimeout(this.tokenCountTimeout);
      }
      this.tokenCountTimeout = setTimeout(() => {
        this.updateTokenCount().catch(console.error);
      }, 300);
    });
    this.updateTokenCount().catch(console.error);
  }
  handleStopGeneration() {
    if (this.abortController) {
      this.abortController.abort();
      this.abortController = null;
      this.isGenerating = false;
      this.updateGeneratingState();
    }
  }
  async handleSendMessage() {
    var _a, _b;
    const content = this.input.value.trim();
    if (!content || this.isGenerating)
      return;
    const tokenLimit = (_b = (_a = this.chatView).getTokenLimit) == null ? void 0 : _b.call(_a);
    if (tokenLimit) {
      const text = this.input.value;
      const messages = this.getMessages();
      const inputTokens = this.tokenCounterService.approximateTokenCount(text);
      let historyTokens = 0;
      for (const message of messages) {
        const content2 = typeof message.content === "string" ? message.content : JSON.stringify(message.content);
        historyTokens += this.tokenCounterService.approximateTokenCount(content2);
        historyTokens += 4;
      }
      const totalTokens = inputTokens + historyTokens;
      if (totalTokens > tokenLimit) {
        showEnhancedNotice(`Cannot send message: Token limit of ${tokenLimit.toLocaleString()} exceeded`, "error");
        return;
      }
    }
    this.input.value = "";
    this.adjustInputHeight();
    try {
      const userMessageId = this.generateMessageId();
      const userMessage = {
        role: "user",
        content,
        message_id: userMessageId
      };
      const modelId = this.webSearchEnabled ? `${this.getSelectedModelId()}:online` : this.getSelectedModelId();
      await this.onMessageSubmit(userMessage);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      const { messageEl, contentEl } = this.createAssistantMessageContainer();
      messageEl.setAttribute("data-message-id", this.generateMessageId());
      messageEl.appendChild(contentEl);
      let fullResponse = "";
      let accumulatedReasoning = "";
      this.isGenerating = true;
      this.updateGeneratingState();
      const loadingEl = contentEl.createEl("span", {
        cls: "systemsculpt-loading",
        text: " \u25CF Thinking..."
      });
      this.chatContainer.appendChild(messageEl);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      this.abortController = new AbortController();
      const systemPrompt = this.getSystemPrompt();
      try {
        for await (const chunk of this.aiService.streamMessage({
          messages: this.getMessages(),
          model: modelId,
          contextFiles: this.getContextFiles(),
          systemPromptType: systemPrompt.type,
          systemPromptPath: systemPrompt.path,
          signal: this.abortController.signal
        })) {
          if (!fullResponse) {
            loadingEl.textContent = " \u25CF Generating...";
          }
          if (chunk.content) {
            fullResponse += chunk.content;
            await this.scheduleRender(fullResponse, contentEl);
            contentEl.appendChild(loadingEl);
          }
          if (chunk.reasoning) {
            accumulatedReasoning += chunk.reasoning;
            this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning);
          }
          this.scrollManager.updateContentHeight();
          this.scrollManager.scrollToBottom();
        }
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        if (accumulatedReasoning) {
          this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning, true);
        }
        const assistantMessage = {
          role: "assistant",
          content: fullResponse,
          message_id: messageEl.getAttribute("data-message-id") || this.generateMessageId()
        };
        await this.onAssistantResponse(assistantMessage);
        this.messageRenderer.addMessageButtonToolbar(messageEl, fullResponse, "assistant", assistantMessage.message_id);
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
        messageEl.addEventListener("delete", async (e) => {
          const { messageId } = e.detail;
          const messages = this.getMessages();
          const index = messages.findIndex((msg) => msg.message_id === messageId);
          if (index !== -1) {
            messageEl.remove();
            this.scrollManager.updateContentHeight();
          }
        });
      } catch (error) {
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        messageEl.remove();
        console.error("Chat message error:", {
          error,
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : void 0
        });
        this.onError(error);
      } finally {
        this.isGenerating = false;
        this.abortController = null;
        this.updateGeneratingState();
        this.focus();
      }
    } catch (error) {
      console.error("Outer message handling error:", {
        error,
        message: error instanceof Error ? error.message : String(error),
        stack: error instanceof Error ? error.stack : void 0
      });
      this.isGenerating = false;
      this.abortController = null;
      this.updateGeneratingState();
      this.focus();
      this.onError(error);
    }
  }
  handleMicClick() {
    if (this.isGenerating)
      return;
    this.toggleRecording();
  }
  async toggleRecording() {
    await this.recorderService.toggleRecording();
    this.input.focus();
  }
  async handlePaste(e) {
    var _a;
    const dt = e.clipboardData;
    if (!dt)
      return;
    const pastedText = (_a = dt.getData("text/plain")) != null ? _a : "";
    const allFiles = Array.from(dt.files);
    if (!allFiles.length && pastedText) {
      return;
    }
    e.preventDefault();
    if (!allFiles.length) {
      return;
    }
    for (const file of allFiles) {
      try {
        let extension = "bin";
        if (file.name && file.name.includes(".")) {
          const dotIdx = file.name.lastIndexOf(".");
          if (dotIdx >= 0) {
            extension = file.name.substring(dotIdx + 1).toLowerCase();
          }
        } else if (file.type) {
          const mimeParts = file.type.split("/");
          if (mimeParts.length === 2) {
            extension = mimeParts[1].toLowerCase().replace(/[^a-z0-9]/g, "");
          }
        }
        const now = new Date();
        const isoString = now.toISOString().replace(/[:.]/g, "-");
        const newFileName = `pasted-${isoString}.${extension}`;
        const arrayBuffer = await file.arrayBuffer();
        const attachmentsDir = this.plugin.settings.attachmentsDirectory || "Attachments";
        const finalPath = `${attachmentsDir}/${newFileName}`;
        await this.ensureDirectoryExists(attachmentsDir);
        await this.app.vault.createBinary(finalPath, arrayBuffer);
        const createdFile = this.app.vault.getAbstractFileByPath(finalPath);
        if (createdFile instanceof import_obsidian18.TFile) {
          await this.chatView.addFileToContext(createdFile);
          new import_obsidian18.Notice(`Pasted file saved & added to context: ${createdFile.name}`);
        } else {
          throw new Error("Failed to locate pasted file in vault.");
        }
      } catch (err) {
        console.error("Error handling pasted file:", err);
        new import_obsidian18.Notice(`Failed to handle pasted file: ${err}`);
      }
    }
    if (pastedText) {
      this.insertTextAtCursor(pastedText);
    }
  }
  async handleKeyDown(event) {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      await this.handleSendMessage();
    }
  }
  async handleImagePaste(clipboardData) {
    const file = clipboardData.files[0];
    if (!file || !file.type.startsWith("image/")) {
      throw new SystemSculptError("No image in clipboard", ERROR_CODES.NO_IMAGE, 400);
    }
    const base64 = await ImageProcessor.processClipboardImage(clipboardData);
    return base64;
  }
  adjustInputHeight() {
    if (!this.input)
      return;
    this.input.style.height = "auto";
    const newHeight = Math.min(Math.max(this.input.scrollHeight, 48), 200);
    this.input.style.height = newHeight + "px";
  }
  focus() {
    this.input.focus();
  }
  getValue() {
    return this.input.value;
  }
  setValue(value) {
    if (!this.input) {
      console.error("Input element not found in setValue");
      return;
    }
    try {
      this.input.value = value;
      const inputEvent = new Event("input", {
        bubbles: true,
        cancelable: true
      });
      this.input.dispatchEvent(inputEvent);
      this.adjustInputHeight();
      this.input.focus();
      this.input.setSelectionRange(value.length, value.length);
    } catch (error) {
      console.error("Error in setValue:", error);
      new import_obsidian18.Notice("\u274C Failed to set input value");
    }
  }
  unload() {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    this.recorderService.setVisualizerCanvas(null);
    if (this.recorderVisualizer) {
      this.recorderVisualizer.remove();
      this.recorderVisualizer = null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  createAssistantMessageContainer() {
    return {
      messageEl: createDiv({
        cls: "systemsculpt-message systemsculpt-assistant-message"
      }),
      contentEl: createDiv({ cls: "systemsculpt-message-content" })
    };
  }
  async scheduleRender(content, containerEl) {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    const currentHeight = containerEl.offsetHeight;
    const tempContainer = containerEl.querySelector(".temp-text") || containerEl.createEl("div", { cls: "temp-text" });
    tempContainer.style.visibility = "hidden";
    tempContainer.style.position = "absolute";
    tempContainer.style.width = containerEl.offsetWidth + "px";
    await this.messageRenderer.renderMarkdownContent(content, tempContainer);
    if (currentHeight !== tempContainer.offsetHeight) {
      await this.messageRenderer.renderMarkdownContent(content, containerEl);
    } else {
      const lastChild = containerEl.lastChild;
      if (lastChild && lastChild.nodeType === Node.TEXT_NODE) {
        lastChild.textContent = content;
      } else {
        containerEl.appendChild(document.createTextNode(content));
      }
    }
    tempContainer.remove();
    return Promise.resolve();
  }
  async handleDocumentUpload() {
    try {
      const files = this.app.vault.getFiles();
      if (!files.length) {
        new import_obsidian18.Notice("No files found to upload.");
        return;
      }
      const firstFile = files[0];
      const result = await this.aiService.uploadDocument(firstFile);
      new import_obsidian18.Notice(`Uploaded doc. ID: ${result.documentId}, status: ${result.status}`);
    } catch (error) {
      new import_obsidian18.Notice(`Error uploading doc: ${error}`);
    }
  }
  async updateTokenCount() {
    var _a, _b;
    const text = this.input.value;
    const messages = this.getMessages();
    const contextFiles = this.getContextFiles();
    const inputTokens = this.tokenCounterService.approximateTokenCount(text);
    let historyTokens = 0;
    for (const message of messages) {
      const content = typeof message.content === "string" ? message.content : JSON.stringify(message.content);
      const messageTokens = this.tokenCounterService.approximateTokenCount(content);
      historyTokens += messageTokens;
      historyTokens += 4;
    }
    let contextTokens = 0;
    for (const filePath of contextFiles) {
      if (filePath.startsWith("doc:"))
        continue;
      try {
        const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
        const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
        if (resolvedFile instanceof import_obsidian18.TFile) {
          if (!resolvedFile.extension.match(/^(md|txt|markdown)$/i)) {
            continue;
          }
          const fileTokens = await this.tokenCounterService.getFileTokenCount(resolvedFile);
          contextTokens += fileTokens;
          contextTokens += 4;
        }
      } catch (error) {
        console.warn("Failed to process context file for token count:", error);
      }
    }
    const totalTokens = inputTokens + historyTokens + contextTokens;
    const tokenLimit = (_b = (_a = this.chatView).getTokenLimit) == null ? void 0 : _b.call(_a);
    if (totalTokens === 0 && contextFiles.size === 0) {
      this.tokenCounter.textContent = "";
    } else {
      this.tokenCounter.textContent = this.tokenCounterService.formatTokenCount(totalTokens);
    }
    if (tokenLimit) {
      const warningThreshold = Math.floor(tokenLimit * 0.9);
      this.tokenCounter.classList.toggle("warning", totalTokens > warningThreshold);
      if (totalTokens > warningThreshold) {
        this.tokenCounter.textContent = `${totalTokens.toLocaleString()} / ${tokenLimit.toLocaleString()} tokens`;
      }
      const submitButton = this.container.querySelector(".systemsculpt-submit-button");
      if (submitButton) {
        const isOverLimit = totalTokens > tokenLimit;
        submitButton.disabled = isOverLimit;
        submitButton.title = isOverLimit ? `Exceeds token limit of ${tokenLimit.toLocaleString()}` : "";
      }
    } else {
      this.tokenCounter.classList.remove("warning");
    }
  }
  async ensureDirectoryExists(dirPath) {
    try {
      await this.app.vault.adapter.mkdir(dirPath);
    } catch (err) {
      if (!err.message.includes("already exists"))
        throw err;
    }
  }
  insertTextAtCursor(text) {
    const cursorPos = this.input.selectionStart;
    const currentValue = this.input.value;
    if (cursorPos !== null) {
      const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
      this.input.value = newValue;
      this.input.selectionStart = this.input.selectionEnd = cursorPos + text.length;
    } else {
      this.input.value = currentValue + text;
      this.input.selectionStart = this.input.selectionEnd = this.input.value.length;
    }
    this.input.dispatchEvent(new Event("input"));
    this.input.focus();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian21 = __toModule(require("obsidian"));

// src/modals/ContextSelectionModal.ts
var import_obsidian19 = __toModule(require("obsidian"));
var import_obsidian20 = __toModule(require("obsidian"));
var ContextSelectionModal = class extends import_obsidian19.Modal {
  constructor(app, onSelect) {
    super(app);
    this.tokenCounts = new Map();
    this.currentSearchResults = [];
    this.searchTimeout = null;
    this.selectedExtensions = new Set();
    this.extensionButtons = new Map();
    this.selectedFiles = new Set();
    this.selectedIndex = 0;
    this.resultElements = [];
    this.onSelect = onSelect;
    this.searchService = new SearchService();
    this.tokenCounter = TokenCounterService.getInstance();
    this.files = this.app.vault.getFiles();
    this.selectedExtensions.add("md");
  }
  getSearchFields(file) {
    return [
      { field: "title", text: file.basename, weight: 100 },
      { field: "path", text: file.path, weight: 75 },
      { field: "extension", text: file.extension, weight: 50 }
    ];
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
  highlightText(text, matches = []) {
    var _a;
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendText(text.slice(lastIndex, match.index));
      }
      const span = fragment.createSpan({
        cls: "systemsculpt-highlight",
        text: match[0]
      });
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  createLoadingIndicator() {
    const container = createDiv({ cls: "systemsculpt-context-loading" });
    (0, import_obsidian20.setIcon)(container, "loader-2");
    container.appendChild(createSpan({ text: "Loading..." }));
    return container;
  }
  createEmptyState() {
    const container = createDiv({ cls: "systemsculpt-context-empty" });
    (0, import_obsidian20.setIcon)(container, "search");
    container.appendChild(createSpan({ text: "No matching files found" }));
    return container;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  createCard(file, result) {
    var _a, _b, _c;
    const card = createDiv({ cls: "systemsculpt-context-card" });
    card.setAttribute("tabindex", "0");
    const cardContent = card.createDiv({ cls: "systemsculpt-card-content" });
    if (file.extension.match(/png|jpe?g|gif|svg|webp/i)) {
      const thumbContainer = cardContent.createDiv({
        cls: "systemsculpt-context-thumbnail"
      });
      (async () => {
        try {
          const arrayBuffer = await this.app.vault.readBinary(file);
          const blob = new Blob([arrayBuffer]);
          const objectUrl = URL.createObjectURL(blob);
          const img = thumbContainer.createEl("img", {
            cls: "systemsculpt-context-thumb-img",
            attr: { src: objectUrl }
          });
        } catch (err) {
          console.error("Error loading thumbnail:", err);
        }
      })();
    }
    if (this.selectedFiles.has(file)) {
      card.addClass("is-added");
      const checkIcon = card.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian20.setIcon)(checkIcon, "check");
    }
    const textContainer = cardContent.createDiv({
      cls: "systemsculpt-card-text"
    });
    const title = textContainer.createDiv({
      cls: "systemsculpt-context-title"
    });
    title.appendChild(this.highlightText(file.basename, result.matches.filter((m) => m.field === "title")));
    const path = textContainer.createDiv({ cls: "systemsculpt-context-path" });
    path.appendChild(this.highlightText(file.path, result.matches.filter((m) => m.field === "path")));
    const meta = textContainer.createDiv({ cls: "systemsculpt-context-meta" });
    const type = meta.createDiv({ cls: "systemsculpt-context-type" });
    type.setText(file.extension.toUpperCase());
    const metaGroup = meta.createDiv({
      cls: "systemsculpt-context-meta-group"
    });
    const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
    size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
    if (file.extension === "md" || file.extension === "txt") {
      const tokenCountEl = metaGroup.createDiv({
        cls: "systemsculpt-context-token-count"
      });
      const fileSize = (_c = (_b = file.stat) == null ? void 0 : _b.size) != null ? _c : 0;
      if (fileSize === 0) {
        tokenCountEl.setText("Empty");
      } else {
        const count = this.tokenCounts.get(file.path) || 0;
        tokenCountEl.setText(this.tokenCounter.formatTokenCount(count));
        if (!this.tokenCounts.has(file.path)) {
          this.updateTokenCount(file).then(() => {
            tokenCountEl.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
          });
        }
      }
    }
    card.addEventListener("click", () => {
      this.toggleFileSelection(file, card);
    });
    card.addEventListener("mouseenter", () => {
      const index = this.resultElements.indexOf(card);
      if (index >= 0) {
        this.selectedIndex = index;
        this.updateSelectedResult();
      }
    });
    return card;
  }
  updateSelectedResult() {
    this.resultElements.forEach((el, index) => {
      el.toggleClass("is-selected", index === this.selectedIndex && this.selectedIndex >= 0);
    });
    if (this.selectedIndex >= 0 && this.selectedIndex < this.resultElements.length) {
      this.resultElements[this.selectedIndex].scrollIntoView({
        behavior: "smooth",
        block: "nearest"
      });
    }
  }
  toggleFileSelection(file, cardEl) {
    var _a;
    if (this.selectedFiles.has(file)) {
      this.selectedFiles.delete(file);
      cardEl.removeClass("is-added");
      (_a = cardEl.querySelector(".systemsculpt-context-check")) == null ? void 0 : _a.remove();
    } else {
      this.selectedFiles.add(file);
      cardEl.addClass("is-added");
      const checkIcon = cardEl.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian20.setIcon)(checkIcon, "check");
    }
    this.updateActionButton();
  }
  updateActionButton() {
    const actionButton = this.containerEl.querySelector(".systemsculpt-context-action-button");
    if (actionButton) {
      const count = this.selectedFiles.size;
      actionButton.setText(count > 0 ? `Add ${count} selected file${count === 1 ? "" : "s"}` : "Select files to add as context");
      actionButton.toggleClass("is-active", count > 0);
    }
  }
  renderResults(searchResults) {
    this.resultsContainer.empty();
    this.resultElements = [];
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      this.emptyState.style.display = "flex";
      return;
    }
    this.emptyState.style.display = "none";
    const grid = this.resultsContainer.createDiv({
      cls: "systemsculpt-context-grid"
    });
    searchResults.forEach((result, index) => {
      const card = this.createCard(result.item, result);
      grid.appendChild(card);
      this.resultElements.push(card);
    });
  }
  getUniqueExtensions() {
    const extensions = new Set();
    this.files.forEach((file) => {
      if (file.extension) {
        extensions.add(file.extension.toLowerCase());
      }
    });
    return Array.from(extensions).sort();
  }
  createExtensionButton(extension) {
    const button = createDiv({
      cls: "systemsculpt-extension-button",
      text: extension.toUpperCase()
    });
    button.addEventListener("click", () => {
      if (this.selectedExtensions.has(extension)) {
        this.selectedExtensions.delete(extension);
        button.removeClass("is-selected");
      } else {
        this.selectedExtensions.add(extension);
        button.addClass("is-selected");
      }
      this.performSearch(this.searchInput.value);
    });
    return button;
  }
  performSearch(query) {
    let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
    results.sort((a, b) => {
      if (b.score !== a.score)
        return b.score - a.score;
      return a.item.basename.localeCompare(b.item.basename);
    });
    this.renderResults(results);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-context-modal");
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-context-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search files to add as context..."
    });
    const extensionContainer = contentEl.createDiv({
      cls: "systemsculpt-extension-container"
    });
    const extensions = this.getUniqueExtensions();
    extensions.forEach((ext) => {
      const button = this.createExtensionButton(ext);
      this.extensionButtons.set(ext, button);
      extensionContainer.appendChild(button);
    });
    const mdBtn = this.extensionButtons.get("md");
    if (mdBtn)
      mdBtn.addClass("is-selected");
    this.loadingIndicator = this.createLoadingIndicator();
    contentEl.appendChild(this.loadingIndicator);
    this.emptyState = this.createEmptyState();
    this.emptyState.style.display = "none";
    contentEl.appendChild(this.emptyState);
    const scrollContainer = contentEl.createDiv({
      cls: "systemsculpt-scroll-container"
    });
    this.resultsContainer = scrollContainer.createDiv();
    const actionContainer = contentEl.createDiv({
      cls: "systemsculpt-action-container"
    });
    const actionButton = actionContainer.createEl("button", {
      cls: "systemsculpt-context-action-button",
      text: "Select files to add as context"
    });
    actionButton.addEventListener("click", () => {
      if (this.selectedFiles.size > 0) {
        this.onSelect(Array.from(this.selectedFiles));
        this.close();
      }
    });
    this.updateActionButton();
    this.loadingIndicator.style.display = "flex";
    this.resultsContainer.empty();
    this.setupEventListeners();
    this.containerEl.addEventListener("keydown", (e) => {
      if (document.activeElement === this.searchInput)
        return;
      if (this.currentSearchResults.length === 0)
        return;
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey && this.selectedIndex === 0) {
          this.searchInput.focus();
          return;
        }
        if (e.shiftKey) {
          this.selectedIndex = (this.selectedIndex - 1 + this.resultElements.length) % this.resultElements.length;
        } else {
          this.selectedIndex = (this.selectedIndex + 1) % this.resultElements.length;
        }
        this.updateSelectedResult();
        return;
      }
      if (e.code === "Space") {
        e.preventDefault();
        const file = this.currentSearchResults[this.selectedIndex].item;
        const cardEl = this.resultElements[this.selectedIndex];
        this.toggleFileSelection(file, cardEl);
        return;
      }
      if (e.key === "Enter") {
        e.preventDefault();
        if (this.selectedFiles.size > 0) {
          this.onSelect(Array.from(this.selectedFiles));
          this.close();
        }
        return;
      }
    });
    this.searchInput.focus();
    this.performSearch("");
    this.loadingIndicator.style.display = "none";
  }
  setupEventListeners() {
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        e.stopPropagation();
        if (this.resultElements.length > 0) {
          if (e.shiftKey) {
            this.selectedIndex = this.resultElements.length - 1;
          } else {
            this.selectedIndex = 0;
          }
          this.updateSelectedResult();
          this.resultElements[this.selectedIndex].focus();
        }
      }
    });
    this.searchInput.addEventListener("focus", () => {
      this.selectedIndex = -1;
      this.updateSelectedResult();
    });
    this.searchInput.addEventListener("input", () => {
      if (this.searchTimeout) {
        window.clearTimeout(this.searchTimeout);
      }
      this.searchTimeout = window.setTimeout(() => {
        const query = this.searchInput.value;
        let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
        results.sort((a, b) => {
          if (b.score !== a.score)
            return b.score - a.score;
          return a.item.basename.localeCompare(b.item.basename);
        });
        this.renderResults(results);
      }, 150);
    });
  }
  onClose() {
    if (this.searchTimeout) {
      window.clearTimeout(this.searchTimeout);
    }
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian22 = __toModule(require("obsidian"));
var FileContextManager = class extends import_obsidian21.Component {
  constructor(options) {
    super();
    this.contextFiles = new Set();
    this.processingStatus = null;
    this.processingFiles = new Map();
    this.processingTimeouts = new Map();
    this.syncStatusEl = null;
    this.isSyncing = false;
    this.tokenCounts = new Map();
    this.app = options.app;
    this.onContextChange = options.onContextChange;
    this.sculptService = options.sculptService;
    this.plugin = options.plugin;
    this.tokenCounter = TokenCounterService.getInstance();
    this.drawer = new DrawerComponent({
      container: options.container,
      title: options.title || "Context Files"
    });
    this.contextPanel = this.drawer.getDrawer();
    this.setupContextPanel();
    this.initializeProcessingStatus();
  }
  initializeProcessingStatus() {
    this.processingStatus = this.contextPanel.createEl("div", {
      cls: "systemsculpt-processing-status"
    });
    this.processingStatus.style.display = "none";
  }
  updateProcessingStatus(file, status, icon, remove = false) {
    const fileId = file.path;
    let statusEl = this.processingFiles.get(fileId);
    const existingTimeout = this.processingTimeouts.get(fileId);
    if (existingTimeout) {
      clearTimeout(existingTimeout);
      this.processingTimeouts.delete(fileId);
    }
    if (!statusEl && !remove && this.processingStatus) {
      statusEl = this.processingStatus.createEl("div", {
        cls: "systemsculpt-file-status"
      });
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian21.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
      this.processingFiles.set(fileId, statusEl);
    } else if (statusEl && !remove) {
      statusEl.empty();
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian21.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
    } else if (statusEl && remove) {
      statusEl.remove();
      this.processingFiles.delete(fileId);
    }
    if (this.processingStatus) {
      this.processingStatus.style.display = this.processingFiles.size > 0 ? "block" : "none";
    }
    if (remove || status.includes("successfully") || status.includes("completed") || status.includes("Error:")) {
      const timeout = setTimeout(() => {
        this.updateProcessingStatus(file, "", "", true);
        this.processingTimeouts.delete(fileId);
      }, 3e3);
      this.processingTimeouts.set(fileId, timeout);
    }
  }
  setupContextPanel() {
    const titleEl = this.contextPanel.querySelector(".systemsculpt-drawer-title");
    if (!titleEl)
      return;
    const contextCount = titleEl.createSpan({
      cls: "systemsculpt-drawer-count",
      text: "0"
    });
    this.syncStatusEl = titleEl.createSpan({
      cls: "systemsculpt-sync-status synced"
    });
    (0, import_obsidian21.setIcon)(this.syncStatusEl, "check");
    const contextButton = titleEl.createEl("button", {
      cls: "systemsculpt-context-add-button"
    });
    (0, import_obsidian21.setIcon)(contextButton, "plus");
    contextButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.addContextFile();
    });
    this.updateContextPanel();
  }
  updateSyncStatus(syncing = false) {
    if (!this.syncStatusEl)
      return;
    this.isSyncing = syncing;
    this.syncStatusEl.empty();
    if (syncing) {
      this.syncStatusEl.removeClass("synced");
      this.syncStatusEl.addClass("syncing");
      (0, import_obsidian21.setIcon)(this.syncStatusEl, "loader-2");
    } else {
      this.syncStatusEl.removeClass("syncing");
      this.syncStatusEl.addClass("synced");
      (0, import_obsidian21.setIcon)(this.syncStatusEl, "check");
    }
  }
  async checkSyncStatus() {
    if (this.contextFiles.size === 0) {
      this.updateSyncStatus(false);
      return;
    }
    this.updateSyncStatus(true);
    this.updateSyncStatus(false);
  }
  updateContextPanel() {
    var _a;
    if (!this.contextPanel)
      return;
    const header = this.contextPanel.querySelector(".systemsculpt-drawer-header");
    const content = this.contextPanel.querySelector(".systemsculpt-drawer-content");
    const count = this.contextPanel.querySelector(".systemsculpt-drawer-count");
    if (!header || !content || !count)
      return;
    count.textContent = this.contextFiles.size.toString();
    content.empty();
    if (this.contextFiles.size === 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-empty",
        text: "No context files added yet. Click the plus button to add files in your chat."
      });
      return;
    }
    const categories = {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
    const documentGroups = new Map();
    const nonExtractedFiles = new Set();
    for (const filePath of this.contextFiles) {
      const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      if (cleanPath.includes("/Extractions/")) {
        const parts = cleanPath.split("/");
        const extractionDirIndex = parts.indexOf("Extractions");
        if (extractionDirIndex >= 0 && extractionDirIndex + 1 < parts.length) {
          const sourceDoc = parts[extractionDirIndex + 1];
          if (!documentGroups.has(sourceDoc)) {
            documentGroups.set(sourceDoc, new Set());
          }
          (_a = documentGroups.get(sourceDoc)) == null ? void 0 : _a.add(filePath);
        } else {
          nonExtractedFiles.add(filePath);
        }
      } else {
        nonExtractedFiles.add(filePath);
      }
    }
    this.categorizeFiles(Array.from(nonExtractedFiles), categories);
    for (const categoryKey of ["text", "images", "audio"]) {
      const category = categories[categoryKey];
      if (category.files.length > 0) {
        this.renderCategory(content, category);
      }
    }
    if (categories.documents.files.length > 0 || documentGroups.size > 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-category",
        text: "Documents"
      });
      this.renderFiles(content, categories.documents.files);
      for (const [sourceDoc, extractedFiles] of documentGroups) {
        content.createEl("div", {
          cls: "systemsculpt-drawer-category",
          text: `\u{1F4C4} ${sourceDoc} Extractions`
        });
        const extractedCategories = this.createCategories();
        this.categorizeFiles(Array.from(extractedFiles), extractedCategories);
        const textFiles = extractedCategories.text.files;
        if (textFiles.length > 0) {
          this.renderFiles(content, textFiles);
        }
        const imageFiles = extractedCategories.images.files;
        if (imageFiles.length > 0) {
          this.renderFiles(content, imageFiles);
        }
        const otherFiles = [
          ...extractedCategories.audio.files,
          ...extractedCategories.documents.files
        ];
        if (otherFiles.length > 0) {
          this.renderFiles(content, otherFiles);
        }
      }
    }
  }
  createCategories() {
    return {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
  }
  categorizeFiles(files, categories) {
    for (const filePath of files) {
      const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
      if (resolvedFile instanceof import_obsidian21.TFile) {
        const extension = resolvedFile.extension.toLowerCase();
        let categoryFound = false;
        for (const [category, info] of Object.entries(categories)) {
          if (info.extensions.includes(extension)) {
            info.files.push({ file: resolvedFile, path: filePath, linkText });
            categoryFound = true;
            break;
          }
        }
        if (!categoryFound) {
          categories.documents.files.push({
            file: resolvedFile,
            path: filePath,
            linkText
          });
        }
      }
    }
  }
  renderCategory(container, category) {
    if (category.files.length === 0)
      return;
    container.createEl("div", {
      cls: "systemsculpt-drawer-category",
      text: category.label
    });
    this.renderFiles(container, category.files);
  }
  renderFiles(container, files) {
    var _a;
    files.sort((a, b) => a.file.basename.localeCompare(b.file.basename));
    const imagePreview = document.body.createEl("img", {
      cls: "systemsculpt-preview systemsculpt-image-preview"
    });
    const markdownPreview = document.body.createDiv({
      cls: "systemsculpt-preview systemsculpt-markdown-preview"
    });
    let isMarkdownPreviewVisible = false;
    const handleWheel = (e) => {
      if (!isMarkdownPreviewVisible)
        return;
      e.preventDefault();
      const scrollAmount = e.deltaY;
      markdownPreview.scrollTop += scrollAmount;
    };
    document.addEventListener("wheel", handleWheel, { passive: false });
    this.register(() => {
      document.removeEventListener("wheel", handleWheel);
    });
    const calculatePreviewDimensions = (naturalWidth, naturalHeight, viewportWidth, viewportHeight) => {
      const maxWidth = Math.min(viewportWidth * 0.4, naturalWidth);
      const maxHeight = Math.min(viewportHeight * 0.6, naturalHeight);
      let width = naturalWidth;
      let height = naturalHeight;
      if (width > maxWidth) {
        width = maxWidth;
        height = naturalHeight * maxWidth / naturalWidth;
      }
      if (height > maxHeight) {
        height = maxHeight;
        width = naturalWidth * maxHeight / naturalHeight;
      }
      return { width, height };
    };
    const updatePreviewPosition = (e, previewEl) => {
      if (!previewEl)
        return;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const rect = previewEl.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      let x = e.clientX + 16;
      let y = e.clientY + 16;
      if (x + width > viewportWidth) {
        x = e.clientX - width - 16;
      }
      if (y + height > viewportHeight) {
        y = e.clientY - height - 16;
      }
      previewEl.style.left = `${x}px`;
      previewEl.style.top = `${y}px`;
    };
    this.register(() => {
      imagePreview.remove();
      markdownPreview.remove();
    });
    for (const { file, path, linkText } of files) {
      const item = container.createEl("div", {
        cls: "systemsculpt-drawer-item"
      });
      const pathEl = item.createEl("div", {
        cls: "systemsculpt-drawer-item-path"
      });
      const iconContainer = pathEl.createSpan({
        cls: "systemsculpt-file-icon"
      });
      const extension = file.extension.toLowerCase();
      let iconName = "file";
      const link = pathEl.createEl("a", {
        cls: "internal-link",
        text: file.basename,
        attr: {
          href: path,
          "data-href": path
        }
      });
      if (["md", "txt", "markdown"].includes(extension)) {
        iconName = "file-text";
        const showMarkdownPreview = async (e) => {
          try {
            const mdFile = this.app.vault.getAbstractFileByPath(file.path);
            if (mdFile instanceof import_obsidian21.TFile) {
              const content = await this.app.vault.read(mdFile);
              markdownPreview.empty();
              markdownPreview.createDiv({
                cls: "systemsculpt-preview-header",
                text: file.basename
              });
              const contentEl = markdownPreview.createDiv();
              await import_obsidian22.MarkdownRenderer.renderMarkdown(content.length > 4e3 ? content.slice(0, 4e3) + "\n\n---\n\n**Click to view full document** (showing first 4000 of " + content.length + " characters)" : content, contentEl, file.path, this);
              markdownPreview.classList.add("visible");
              isMarkdownPreviewVisible = true;
              updatePreviewPosition(e, markdownPreview);
            }
          } catch (error) {
            console.error("Failed to load markdown preview:", error);
          }
        };
        const hideMarkdownPreview = () => {
          markdownPreview.classList.remove("visible");
          markdownPreview.empty();
          isMarkdownPreviewVisible = false;
          markdownPreview.scrollTop = 0;
        };
        item.addEventListener("mouseenter", showMarkdownPreview);
        item.addEventListener("mouseleave", hideMarkdownPreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, markdownPreview));
        markdownPreview.addEventListener("mouseleave", hideMarkdownPreview);
        this.register(() => {
          markdownPreview.removeEventListener("mouseleave", hideMarkdownPreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideMarkdownPreview);
      } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        iconName = "image";
        const showImagePreview = async (e) => {
          try {
            const imageFile = this.app.vault.getAbstractFileByPath(file.path);
            if (imageFile instanceof import_obsidian21.TFile) {
              const arrayBuffer = await this.app.vault.readBinary(imageFile);
              const blob = new Blob([arrayBuffer]);
              const url = URL.createObjectURL(blob);
              imagePreview.src = url;
              imagePreview.onload = () => {
                URL.revokeObjectURL(url);
                imagePreview.classList.add("visible");
                const { width, height } = calculatePreviewDimensions(imagePreview.naturalWidth, imagePreview.naturalHeight, window.innerWidth, window.innerHeight);
                imagePreview.style.width = `${width}px`;
                imagePreview.style.height = `${height}px`;
                updatePreviewPosition(e, imagePreview);
              };
            }
          } catch (error) {
            console.error("Failed to load image preview:", error);
          }
        };
        const hideImagePreview = () => {
          imagePreview.classList.remove("visible");
          imagePreview.src = "";
          imagePreview.style.width = "";
          imagePreview.style.height = "";
        };
        item.addEventListener("mouseenter", showImagePreview);
        item.addEventListener("mouseleave", hideImagePreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, imagePreview));
        imagePreview.addEventListener("mouseleave", hideImagePreview);
        this.register(() => {
          imagePreview.removeEventListener("mouseleave", hideImagePreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideImagePreview);
      } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
        iconName = "audio-lines";
      } else if (["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"].includes(extension)) {
        iconName = "file";
      }
      (0, import_obsidian21.setIcon)(iconContainer, iconName);
      link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        this.app.workspace.openLinkText(linkText, "", true);
      });
      const meta = item.createDiv({ cls: "systemsculpt-context-meta" });
      const type = meta.createDiv({ cls: "systemsculpt-context-type" });
      type.setText(file.extension.toUpperCase());
      const metaGroup = meta.createDiv({
        cls: "systemsculpt-context-meta-group"
      });
      const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
      size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
      if (file.extension === "md" || file.extension === "txt") {
        const tokenCount = metaGroup.createDiv({
          cls: "systemsculpt-context-token-count"
        });
        const count = this.tokenCounts.get(file.path) || 0;
        tokenCount.setText(this.tokenCounter.formatTokenCount(count));
        if (!this.tokenCounts.has(file.path)) {
          this.updateTokenCount(file).then(() => {
            tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
          });
        }
      }
      const removeBtn = item.createEl("button", {
        cls: "systemsculpt-drawer-item-remove",
        text: "\xD7"
      });
      removeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        this.removeContextFile(path);
      });
    }
  }
  async addContextFile() {
    const modal = new ContextSelectionModal(this.app, async (files) => {
      for (const file of files) {
        try {
          await this.addFileToContext(file);
        } catch (error) {
          this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
          setTimeout(() => {
            this.updateProcessingStatus(file, "", "", true);
          }, 3e3);
        }
      }
    });
    modal.open();
  }
  async removeContextFile(filePath) {
    const normalizedPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    this.contextFiles.delete(filePath);
    this.contextFiles.delete(`[[${normalizedPath}]]`);
    this.updateContextPanel();
    await this.onContextChange();
  }
  async addFileToContext(file) {
    const extension = file.extension.toLowerCase();
    const docExtensions = ["pdf", "doc", "docx", "ppt", "pptx"];
    const audioExtensions = ["wav", "m4a", "webm", "ogg", "mp3"];
    if (docExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processDocumentFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else if (audioExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processAudioFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else {
      const wikiLink = `[[${file.path}]]`;
      this.contextFiles.add(wikiLink);
    }
    this.updateContextPanel();
    await this.onContextChange();
  }
  async processDocumentFile(file) {
    var _a, _b;
    this.updateProcessingStatus(file, "Uploading...", "upload");
    const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
    if (!cached) {
      this.updateProcessingStatus(file, "Processing...", "loader-2");
      const success = await this.pollUntilComplete(documentId);
      if (!success) {
        throw new Error("Document processing not completed in time.");
      }
    }
    this.updateProcessingStatus(file, "Downloading results...", "download");
    const extractionData = await this.downloadExtraction(documentId);
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
    await this.app.vault.createFolder(parentPath).catch(() => {
    });
    const extractedText = this.getExtractionMarkdown(extractionData);
    const newMdPath = `${parentPath}/${baseName}.md`;
    try {
      await this.app.vault.create(newMdPath, extractedText);
    } catch (error) {
      if (!(error instanceof Error) || !error.message.includes("already exists")) {
        throw error;
      }
    }
    const mdWikiLink = `[[${newMdPath}]]`;
    this.contextFiles.add(mdWikiLink);
    if (extractionData.images && typeof extractionData.images === "object") {
      for (const [filename, base64Data] of Object.entries(extractionData.images)) {
        const imagePath = `${parentPath}/${filename.replace(/[\\/:*?"<>|]/g, "-").trim()}`;
        try {
          await this.app.vault.createBinary(imagePath, this.decodeBase64(base64Data));
        } catch (error) {
          if (!(error instanceof Error) || !error.message.includes("already exists")) {
            throw error;
          }
        }
        const imageWikiLink = `[[${imagePath}]]`;
        this.contextFiles.add(imageWikiLink);
      }
    }
    this.updateProcessingStatus(file, "Added successfully!", "check-circle");
    return newMdPath;
  }
  getExtractionMarkdown(extractionData) {
    var _a, _b, _c;
    const text = (_a = extractionData == null ? void 0 : extractionData.text) != null ? _a : "";
    const metadata = (_b = extractionData == null ? void 0 : extractionData.metadata) != null ? _b : {};
    const pageCount = (_c = extractionData == null ? void 0 : extractionData.pageCount) != null ? _c : 0;
    return `# Document Extraction
Page Count: ${pageCount}

${text}

${metadata ? `
# Metadata
${JSON.stringify(metadata, null, 2)}` : ""}
`;
  }
  decodeBase64(base64String) {
    const binaryStr = window.atob(base64String);
    const len = binaryStr.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryStr.charCodeAt(i);
    }
    return bytes.buffer;
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  getContextFiles() {
    return this.contextFiles;
  }
  async setContextFiles(files) {
    this.contextFiles = new Set(files);
    this.updateContextPanel();
    await this.checkSyncStatus();
  }
  getContainer() {
    return this.contextPanel;
  }
  unload() {
    this.processingTimeouts.forEach((timeout) => {
      clearTimeout(timeout);
    });
    this.processingTimeouts.clear();
    this.processingFiles.forEach((statusEl) => {
      statusEl.remove();
    });
    this.processingFiles.clear();
    if (this.processingStatus) {
      this.processingStatus.style.display = "none";
    }
    this.drawer.unload();
  }
  async processAudioFile(file, timestamped = false) {
    var _a, _b;
    this.updateProcessingStatus(file, "Transcribing audio...", "loader-2");
    try {
      const transcriptionService = TranscriptionService.getInstance(this.plugin);
      const text = await transcriptionService.transcribeFile(file, {
        type: "note",
        timestamped,
        onProgress: (progress, status) => {
          this.updateProcessingStatus(file, status, "loader-2");
        }
      });
      const extractionFolder = this.sculptService.extractionsDirectory;
      const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
      const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
      await this.app.vault.createFolder(parentPath).catch(() => {
      });
      const outputPath = `${parentPath}/${baseName}.md`;
      const finalContent = `# Audio Transcription
Source: ${file.basename}
Transcribed: ${new Date().toISOString()}

${text}`;
      try {
        const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
        if (existingFile instanceof import_obsidian21.TFile) {
          await this.app.vault.modify(existingFile, finalContent);
        } else {
          await this.app.vault.create(outputPath, finalContent);
        }
      } catch (error) {
        console.error("File operation failed:", error);
        throw error;
      }
      this.updateProcessingStatus(file, "Added successfully!", "check-circle");
      return outputPath;
    } catch (error) {
      console.error("Audio transcription error:", error);
      this.updateProcessingStatus(file, `Error: ${error instanceof Error ? error.message : String(error)}`, "x-circle");
      throw error;
    }
  }
  async pollUntilComplete(documentId) {
    var _a, _b, _c;
    const maxTries = 50;
    for (let i = 0; i < maxTries; i++) {
      await this.sleep(3e3);
      const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}`;
      const resp = await fetch(url);
      if (!resp.ok)
        continue;
      const data = await resp.json();
      if (((_a = data == null ? void 0 : data.data) == null ? void 0 : _a.status) === "completed")
        return true;
      if (((_b = data == null ? void 0 : data.data) == null ? void 0 : _b.status) === "error") {
        throw new Error(((_c = data == null ? void 0 : data.data) == null ? void 0 : _c.error) || "Processing failed");
      }
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}/download`;
    const resp = await fetch(url);
    if (!resp.ok) {
      throw new Error(`Download extraction failed: ${resp.status}`);
    }
    const data = await resp.json();
    if (!data.success) {
      throw new Error(data.error || "Failed to download extraction");
    }
    return data.data.extractionResult;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
};

// src/views/ChatView.ts
init_SystemPromptService();

// src/modals/LoadChatModal.ts
var import_obsidian23 = __toModule(require("obsidian"));
init_SystemPromptService();
var LoadChatModal = class extends import_obsidian23.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.chatItems = [];
    this.selectedChatId = null;
    this.selectedCardIndex = 0;
    this.chatCards = [];
    this.currentSearchResults = [];
    this.isKeyboardNavActive = false;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.searchService = new SearchService();
    this.chatStorage = new ChatStorageService(app, plugin.settings.chatsDirectory);
  }
  async getSearchFields(item) {
    var _a, _b;
    const allContent = item.messages.map((msg) => this.getMessageContent(msg)).join("\n");
    const promptLabel = await this.getPromptLabel(item);
    const searchTerms = ((_b = (_a = this.searchInput) == null ? void 0 : _a.value) == null ? void 0 : _b.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const searchFields = [
      {
        field: "content",
        text: allContent,
        weight: 200
      },
      ...allContent.split(/[\s\-:\.]+/).map((part) => ({
        field: "content",
        text: part,
        weight: 100
      })),
      {
        field: "model",
        text: await this.getModelName(item.selectedModelId),
        weight: 180
      },
      {
        field: "prompt",
        text: promptLabel,
        weight: 180
      },
      ...promptLabel.split(/[\s\-_]+/).map((part) => ({
        field: "prompt",
        text: part,
        weight: 150
      }))
    ];
    if (searchTerms.length > 1) {
      const allContentLower = allContent.toLowerCase();
      for (let i = 0; i < searchTerms.length - 1; i++) {
        const term1 = searchTerms[i];
        const term2 = searchTerms[i + 1];
        let pos = 0;
        while ((pos = allContentLower.indexOf(term1, pos)) !== -1) {
          const nextPos = allContentLower.indexOf(term2, pos);
          if (nextPos !== -1 && nextPos - (pos + term1.length) < 30) {
            searchFields.push({
              field: "content",
              text: allContent.slice(pos, nextPos + term2.length),
              weight: 300
            });
          }
          pos++;
        }
      }
    }
    return searchFields;
  }
  getMessageContent(message) {
    if (typeof message.content === "string") {
      return message.content;
    }
    return "Image message";
  }
  findAllIndices(text, searchTerm) {
    const indices = [];
    let currentIndex = 0;
    text = text.toLowerCase();
    searchTerm = searchTerm.toLowerCase();
    while (currentIndex < text.length) {
      const index = text.indexOf(searchTerm, currentIndex);
      if (index === -1)
        break;
      indices.push(index);
      currentIndex = index + 1;
    }
    return indices;
  }
  getMessagePreview(messages, matches = []) {
    var _a, _b;
    if (!matches || matches.length === 0) {
      const lastMessage = messages[messages.length - 1];
      if (!lastMessage)
        return { text: "", previewStart: 0 };
      return { text: this.getMessageContent(lastMessage), previewStart: 0 };
    }
    const contentMatches = matches.filter((m) => m.field === "content");
    if (contentMatches.length === 0) {
      const lastMessage = messages[messages.length - 1];
      if (!lastMessage)
        return { text: "", previewStart: 0 };
      return { text: this.getMessageContent(lastMessage), previewStart: 0 };
    }
    const allContent = messages.map((msg) => this.getMessageContent(msg)).join("\n");
    const searchTerms = ((_b = (_a = this.searchInput) == null ? void 0 : _a.value) == null ? void 0 : _b.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const termIndices = [];
    const allContentLower = allContent.toLowerCase();
    searchTerms.forEach((term) => {
      const indices = this.findAllIndices(allContentLower, term);
      termIndices.push(...indices);
    });
    if (termIndices.length === 0) {
      const firstMatch = contentMatches[0];
      termIndices.push(firstMatch.indices[0]);
    }
    termIndices.sort((a, b) => a - b);
    const CONTEXT_SIZE = 75;
    let bestStart = termIndices[0];
    let bestEnd = termIndices[0];
    let bestSpan = Infinity;
    for (let i = 0; i < termIndices.length; i++) {
      const start = termIndices[i];
      const searchWindow = new Set();
      for (let j = i; j < termIndices.length; j++) {
        const end = termIndices[j];
        const span = end - start;
        const termAtPosition = searchTerms.find((term) => allContentLower.slice(termIndices[j]).startsWith(term));
        if (termAtPosition) {
          searchWindow.add(termAtPosition);
        }
        if (searchWindow.size === searchTerms.length && span < bestSpan) {
          bestStart = start;
          bestEnd = end;
          bestSpan = span;
        }
      }
    }
    const contextStart = Math.max(0, bestStart - CONTEXT_SIZE);
    const contextEnd = Math.min(allContent.length, bestEnd + CONTEXT_SIZE);
    let previewStart = contextStart;
    while (previewStart > 0 && !/[\s.!?\n]/.test(allContent[previewStart - 1])) {
      previewStart--;
    }
    let previewEnd = contextEnd;
    while (previewEnd < allContent.length && !/[\s.!?\n]/.test(allContent[previewEnd])) {
      previewEnd++;
    }
    let preview = allContent.slice(previewStart, previewEnd).trim();
    if (previewStart > 0)
      preview = "..." + preview;
    if (previewEnd < allContent.length)
      preview = preview + "...";
    return { text: preview, previewStart };
  }
  formatDate(timestamp) {
    return new Date(timestamp).toLocaleString();
  }
  openNewChat() {
    this.close();
    const leaf = this.app.workspace.getLeaf(true);
    leaf.setViewState({
      type: CHAT_VIEW_TYPE,
      state: {}
    });
    this.app.workspace.setActiveLeaf(leaf);
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-chat-modal");
    const loadingContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-loading"
    });
    loadingContainer.createSpan({ text: "Loading chats..." });
    try {
      const chats = await this.chatStorage.loadChats();
      this.chatItems = chats.sort((a, b) => b.lastModified - a.lastModified);
    } catch (error) {
      console.error("Failed to load chats:", error);
      this.chatItems = [];
    }
    contentEl.empty();
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search chats..."
    });
    this.searchInput.focus();
    this.chatGrid = contentEl.createDiv({ cls: "systemsculpt-chat-grid" });
    const initialResults = await Promise.all(this.chatItems.map(async (item) => ({
      item,
      matches: [],
      score: 0
    })));
    await this.renderChats(initialResults);
    this.searchInput.addEventListener("input", async () => {
      const query = this.searchInput.value;
      const results = await Promise.all(this.chatItems.map(async (item) => {
        const searchFields = await this.getSearchFields(item);
        const searchResult = this.searchService.search([item], query, () => searchFields)[0];
        return {
          item,
          matches: (searchResult == null ? void 0 : searchResult.matches) || [],
          score: (searchResult == null ? void 0 : searchResult.score) || 0
        };
      }));
      if (!query) {
        this.currentSearchResults = results.sort((a, b) => b.item.lastModified - a.item.lastModified);
        this.selectedCardIndex = 0;
        await this.renderChats(this.currentSearchResults);
        return;
      }
      const processedResults = results.filter((result) => result.matches.length > 0 && result.score > 0).map((result) => {
        let finalScore = result.score;
        const content = result.item.messages.map((msg) => this.getMessageContent(msg)).join("\n").toLowerCase();
        if (content.includes(query.toLowerCase())) {
          finalScore *= 2;
        }
        const wordBoundaryMatch = new RegExp(`\\b${query}`, "i").test(content);
        if (wordBoundaryMatch) {
          finalScore *= 1.5;
        }
        return {
          ...result,
          score: finalScore
        };
      });
      processedResults.sort((a, b) => {
        if (b.score !== a.score) {
          return b.score - a.score;
        }
        return b.item.lastModified - a.item.lastModified;
      });
      this.currentSearchResults = processedResults;
      this.selectedCardIndex = 0;
      await this.renderChats(processedResults);
    });
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (!this.isKeyboardNavActive) {
          this.isKeyboardNavActive = true;
          this.selectedCardIndex = 0;
          this.updateSelectedCard();
        } else {
          if (e.shiftKey) {
            this.selectedCardIndex = Math.max(0, this.selectedCardIndex - 1);
          } else {
            this.selectedCardIndex = Math.min(this.chatCards.length - 1, this.selectedCardIndex + 1);
          }
          this.updateSelectedCard();
        }
      } else if (e.key === "Enter" && this.chatCards.length > 0 && this.isKeyboardNavActive) {
        e.preventDefault();
        const selectedCard = this.chatCards[this.selectedCardIndex];
        if (selectedCard == null ? void 0 : selectedCard.dataset.chatId) {
          this.onSelect(selectedCard.dataset.chatId);
          this.close();
        }
      }
    });
    contentEl.addEventListener("click", () => {
      if (this.isKeyboardNavActive) {
        this.isKeyboardNavActive = false;
        this.updateSelectedCard();
      }
    });
    const buttonContainer = contentEl.createDiv({
      cls: "systemsculpt-button-container"
    });
    const newChatButton = buttonContainer.createEl("button", {
      cls: "systemsculpt-button",
      text: "Open New Chat Instead"
    });
    newChatButton.addEventListener("click", () => this.openNewChat());
  }
  async renderChats(searchResults) {
    this.chatGrid.empty();
    this.chatCards = [];
    this.selectedCardIndex = 0;
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      const emptyState = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-empty"
      });
      emptyState.setText(this.chatItems.length === 0 ? "No chat history found." : "No chats found matching your search.");
      return;
    }
    const sectionsContainer = this.chatGrid.createDiv({
      cls: "systemsculpt-chat-sections-container"
    });
    for (const result of searchResults) {
      await this.renderChatCard(result, sectionsContainer);
    }
  }
  async getModelName(modelId) {
    try {
      const models = await this.plugin.modelService.getModels();
      if (!models)
        return modelId;
      const model = models.find((m) => m.id === modelId || m.identifier && `${m.identifier.providerId}/${m.identifier.modelId}` === modelId);
      if (model == null ? void 0 : model.identifier) {
        return model.identifier.displayName || model.identifier.modelId;
      }
      return (model == null ? void 0 : model.name) || modelId;
    } catch (error) {
      console.error("Failed to get model name:", error);
      return modelId;
    }
  }
  async getPromptLabel(item) {
    var _a;
    if (item.customPromptFilePath) {
      return ((_a = item.customPromptFilePath.split("/").pop()) == null ? void 0 : _a.replace(/\.md$/, "")) || "Custom Prompt";
    }
    if (item.systemPromptType) {
      try {
        const systemPromptService = new SystemPromptService(this.app);
        const preset = await systemPromptService.getSystemPromptById(item.systemPromptType);
        if (preset) {
          return preset.label;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
      }
    }
    return "Default";
  }
  renderPreview(preview, item, matches = []) {
    var _a;
    const { text, previewStart } = this.getMessagePreview(item.messages, matches);
    const contentMatches = matches.filter((m) => m.field === "content");
    if (contentMatches.length > 0) {
      const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
      preview.appendChild(this.searchService.highlightText(text, contentMatches, searchQuery));
    } else {
      preview.createSpan({ text });
    }
  }
  async renderChatCard({ item, matches = [] }, container) {
    var _a;
    const isSelected = this.isKeyboardNavActive && this.chatCards.length === this.selectedCardIndex;
    const card = container.createDiv({
      cls: `systemsculpt-chat-card ${item.id === this.selectedChatId ? "selected" : ""} ${isSelected ? "systemsculpt-keyboard-selected" : ""}`
    });
    card.dataset.chatId = item.id;
    this.chatCards.push(card);
    const header = card.createDiv({ cls: "systemsculpt-chat-card-header" });
    const leftContainer = header.createDiv({
      cls: "systemsculpt-chat-header-left"
    });
    const modelBadge = leftContainer.createDiv({
      cls: "systemsculpt-chat-badge"
    });
    (0, import_obsidian23.setIcon)(modelBadge, "bot");
    const modelName = await this.getModelName(item.selectedModelId);
    const modelMatches = matches.filter((m) => m.field === "model");
    if (modelMatches.length > 0) {
      modelBadge.appendChild(this.highlightText(modelName, modelMatches));
    } else {
      modelBadge.appendText(modelName);
    }
    const promptBadge = leftContainer.createDiv({
      cls: "systemsculpt-chat-badge"
    });
    (0, import_obsidian23.setIcon)(promptBadge, "command");
    const promptLabel = await this.getPromptLabel(item);
    const promptMatches = matches.filter((m) => m.field === "prompt");
    if (promptMatches.length > 0) {
      promptBadge.appendChild(this.highlightText(promptLabel, promptMatches));
    } else {
      promptBadge.appendText(promptLabel);
    }
    if (item.context_files && item.context_files.length > 0) {
      const docBadge = leftContainer.createDiv({
        cls: "systemsculpt-chat-badge"
      });
      (0, import_obsidian23.setIcon)(docBadge, "file-text");
      docBadge.appendText(`${item.context_files.length} Document${item.context_files.length > 1 ? "s" : ""}`);
    }
    const preview = card.createDiv({
      cls: "systemsculpt-chat-preview"
    });
    if (((_a = this.searchInput) == null ? void 0 : _a.value) && matches.length > 0) {
      const { text } = this.getMessagePreview(item.messages, matches);
      const searchTerms = this.searchInput.value.toLowerCase().split(/\s+/);
      const textLower = text.toLowerCase();
      const termPositions = [];
      searchTerms.forEach((term) => {
        let index = textLower.indexOf(term);
        if (index >= 0) {
          termPositions.push({ term, index });
        }
      });
      termPositions.sort((a, b) => a.index - b.index);
      if (termPositions.length > 0) {
        const fragment = document.createDocumentFragment();
        let lastIndex = 0;
        termPositions.forEach(({ term, index }) => {
          if (index > lastIndex) {
            fragment.appendChild(document.createTextNode(text.slice(lastIndex, index)));
          }
          const highlight = document.createElement("span");
          highlight.className = "systemsculpt-search-highlight";
          highlight.textContent = text.slice(index, index + term.length);
          fragment.appendChild(highlight);
          lastIndex = index + term.length;
        });
        if (lastIndex < text.length) {
          fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
        }
        preview.appendChild(fragment);
      } else {
        preview.appendText(text);
      }
    } else {
      const lastMessage = item.messages[item.messages.length - 1];
      if (lastMessage) {
        preview.appendText(this.getMessageContent(lastMessage));
      }
    }
    const meta = card.createDiv({ cls: "systemsculpt-chat-meta" });
    const dateEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian23.setIcon)(dateEl, "calendar");
    dateEl.createSpan({
      text: this.formatDate(item.lastModified)
    });
    const messagesEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian23.setIcon)(messagesEl, "message-square");
    messagesEl.createSpan({
      text: `${item.messages.length} message${item.messages.length !== 1 ? "s" : ""}`
    });
    const titleEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian23.setIcon)(titleEl, "file");
    titleEl.createSpan({
      text: item.title
    });
    card.addEventListener("click", () => {
      this.onSelect(item.id);
      this.close();
    });
  }
  highlightText(text, matches = []) {
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const allIndices = new Set();
    matches.forEach((match) => {
      match.indices.forEach((idx) => allIndices.add(idx));
    });
    const sortedIndices = Array.from(allIndices).sort((a, b) => a - b);
    const ranges = [];
    let rangeStart = sortedIndices[0];
    let prev = sortedIndices[0];
    for (let i = 1; i <= sortedIndices.length; i++) {
      const curr = sortedIndices[i];
      if (curr !== prev + 1) {
        ranges.push([rangeStart, prev + 1]);
        rangeStart = curr;
      }
      prev = curr;
    }
    let lastIndex = 0;
    ranges.forEach(([start, end]) => {
      if (start > lastIndex) {
        fragment.appendText(text.slice(lastIndex, start));
      }
      const highlightedText = text.slice(start, end);
      const span = fragment.createSpan({
        cls: "systemsculpt-chat-highlight",
        text: highlightedText
      });
      lastIndex = end;
    });
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  updateSelectedCard() {
    this.chatCards.forEach((card, index) => {
      if (index === this.selectedCardIndex && this.isKeyboardNavActive) {
        card.classList.add("systemsculpt-keyboard-selected");
        card.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        card.classList.remove("systemsculpt-keyboard-selected");
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/ChatView.ts
var CHAT_VIEW_TYPE = "systemsculpt-chat-view";
var ChatView = class extends import_obsidian24.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.messages = [];
    this.currentModelName = "";
    this.isGenerating = false;
    this.refreshInterval = null;
    this.lastRefreshTime = 0;
    this.awaitingStateRestore = false;
    this.chatTitle = "Untitled Chat";
    this.plugin = plugin;
    this.aiService = SystemSculptService.getInstance(plugin.settings, this.app);
    this.chatStorage = new ChatStorageService(this.app, plugin.settings.chatsDirectory);
    this.selectedModelId = plugin.settings.selectedModelId;
    this.messages = [];
    this.lastRefreshTime = 0;
    this.isGenerating = false;
    this.awaitingStateRestore = true;
    this.messageRenderer = new MessageRenderer(this.app);
    this.systemPromptType = this.plugin.settings.systemPromptType || "general-use";
    if (this.systemPromptType === "custom" && this.plugin.settings.systemPromptPath) {
      this.systemPromptPath = this.plugin.settings.systemPromptPath;
    } else {
      this.systemPromptPath = void 0;
    }
    this.layoutChangeHandler = this.onLayoutChange.bind(this);
  }
  getViewType() {
    return CHAT_VIEW_TYPE;
  }
  getDisplayText() {
    const allChats = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (allChats.length <= 1) {
      return this.chatTitle;
    }
    const chatNumber = allChats.indexOf(this.leaf) + 1;
    return `${this.chatTitle} ${chatNumber}`;
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    container.addClass("systemsculpt-chat-container");
    this.setupDragAndDrop(container);
    const headerContainer = container.createEl("div", {
      cls: "systemsculpt-chat-header"
    });
    const topRow = headerContainer.createEl("div", {
      cls: "systemsculpt-chat-header-top"
    });
    this.modelIndicator = topRow.createEl("button", {
      cls: "systemsculpt-model-indicator",
      text: `Current Model: ${this.selectedModelId}`
    });
    this.updateModelIndicator();
    this.actionsDrawer = new DrawerComponent({
      container: topRow,
      title: "Actions"
    });
    const actionsContent = this.actionsDrawer.getContent();
    const openHistoryAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Open Chat History File"
    });
    openHistoryAction.addEventListener("click", () => {
      const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian24.TFile) {
        this.app.workspace.getLeaf().openFile(file);
      }
    });
    const loadDifferentChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Load A Different Chat"
    });
    loadDifferentChatAction.addEventListener("click", () => {
      const leaf = this.app.workspace.getLeaf(true);
      new LoadChatModal(this.app, async (chatId) => {
        const view = await leaf.setViewState({
          type: CHAT_VIEW_TYPE,
          state: { chatId }
        });
        this.app.workspace.setActiveLeaf(leaf);
      }, this.plugin).open();
    });
    const copyChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Copy Chat to Clipboard"
    });
    copyChatAction.addEventListener("click", async () => {
      await this.copyEntireChatToClipboard();
    });
    const deleteChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item systemsculpt-drawer-item-danger",
      text: "Delete This Chat"
    });
    deleteChatAction.addEventListener("click", async () => {
      const deleteConfirmed = await showPopup(this.app, "Are you sure you want to delete this chat?", {
        primaryButton: "Delete",
        secondaryButton: "Cancel"
      });
      if (deleteConfirmed == null ? void 0 : deleteConfirmed.confirmed) {
        const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
        const file = this.app.vault.getAbstractFileByPath(filePath);
        if (file instanceof import_obsidian24.TFile) {
          await this.app.vault.delete(file);
        }
        this.leaf.detach();
      }
    });
    const bottomRow = headerContainer.createEl("div", {
      cls: "systemsculpt-chat-header-bottom"
    });
    this.contextManager = new FileContextManager({
      app: this.app,
      container: bottomRow,
      onContextChange: async () => {
        await this.saveChat();
        await this.contextManager.checkSyncStatus();
      },
      sculptService: this.aiService,
      plugin: this.plugin
    });
    this.chatContainer = container.createEl("div", {
      cls: "systemsculpt-messages-container"
    });
    this.scrollManager = new ScrollManagerService({
      container: this.chatContainer
    });
    this.inputHandler = new InputHandler({
      app: this.app,
      container,
      aiService: this.aiService,
      getMessages: () => [...this.messages],
      getSelectedModelId: () => this.selectedModelId,
      getContextFiles: () => this.contextManager.getContextFiles(),
      getSystemPrompt: () => ({
        type: this.systemPromptType,
        path: this.systemPromptPath
      }),
      chatContainer: this.chatContainer,
      scrollManager: this.scrollManager,
      messageRenderer: this.messageRenderer,
      onMessageSubmit: async (message) => {
        this.messages.push(message);
        await this.saveChat();
        await this.addMessage(message.role, message.content, message.message_id);
      },
      onAssistantResponse: async (message) => {
        this.messages.push(message);
        await this.saveChat();
      },
      onContextFileAdd: async (wikilink) => {
        const files = this.contextManager.getContextFiles();
        files.add(wikilink);
        this.contextManager.setContextFiles(Array.from(files));
        await this.saveChat();
      },
      onError: (error) => this.handleError(error),
      onAddContextFile: () => {
        const contextButton = this.contextManager.getContainer().querySelector(".systemsculpt-context-add-button");
        if (contextButton instanceof HTMLElement) {
          contextButton.click();
        }
      },
      onEditSystemPrompt: () => {
        this.handleSystemPromptEdit();
      },
      plugin: this.plugin,
      chatView: this
    });
    this.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf === this.leaf) {
        this.checkForUpdates();
        this.inputHandler.focus();
      }
    });
    this.inputHandler.focus();
    await this.checkForUpdates();
    if (!this.awaitingStateRestore && this.messages.length === 0) {
      if (!this.chatId) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const hour = String(now.getHours()).padStart(2, "0");
        const minute = String(now.getMinutes()).padStart(2, "0");
        const second = String(now.getSeconds()).padStart(2, "0");
        this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
        this.chatTitle = `Chat ${now.toLocaleString()}`;
        await this.saveChat();
      }
    }
  }
  async loadMessages() {
    if (!this.chatContainer)
      return;
    const scrollTop = this.chatContainer.scrollTop;
    const scrollHeight = this.chatContainer.scrollHeight;
    const clientHeight = this.chatContainer.clientHeight;
    const wasAtBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
    this.chatContainer.empty();
    for (const message of this.messages) {
      await this.addMessage(message.role, message.content, message.message_id);
    }
    if (wasAtBottom) {
      this.scrollManager.scrollToBottom();
    } else {
      this.chatContainer.scrollTop = scrollTop;
    }
    if (this.inputHandler) {
      await this.inputHandler.updateTokenCount();
    }
  }
  async updateModelIndicator() {
    var _a;
    if (this.modelIndicator) {
      try {
        const models = await this.plugin.modelService.getModels();
        const currentModel = models.find((model) => model.id === this.selectedModelId);
        this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
        this.modelIndicator.empty();
        const prefix = this.modelIndicator.createSpan({
          text: "Current Model: "
        });
        const modelName = this.modelIndicator.createSpan({
          text: this.currentModelName || "Unknown Model"
        });
        const newModelIndicator = this.modelIndicator.cloneNode(true);
        (_a = this.modelIndicator.parentNode) == null ? void 0 : _a.replaceChild(newModelIndicator, this.modelIndicator);
        this.modelIndicator = newModelIndicator;
        this.modelIndicator.addEventListener("click", async () => {
          const modal = new ModelSelectionModal(this.app, this.selectedModelId, async (modelId) => {
            this.selectedModelId = modelId;
            const selectedModel = models.find((model) => model.id === modelId);
            this.currentModelName = (selectedModel == null ? void 0 : selectedModel.name) || modelId;
            await this.updateModelIndicator();
            showEnhancedNotice("Model changed successfully", "info");
            await this.saveChat();
            if (this.tokenLimitPercentage && (selectedModel == null ? void 0 : selectedModel.context_length)) {
              this.tokenLimit = Math.floor(this.tokenLimitPercentage / 100 * selectedModel.context_length);
              await this.saveChat();
            }
            this.focusInput();
          }, this.plugin);
          modal.open();
          try {
            modal.setModels(models);
          } catch (err) {
            console.error("Failed to set models:", err);
            showEnhancedNotice("Failed to fetch available models", "error");
          }
        });
      } catch (error) {
        console.error("Error updating model indicator:", error);
        this.currentModelName = this.selectedModelId;
        this.modelIndicator.empty();
        this.modelIndicator.createSpan({ text: "Current Model: " });
        this.modelIndicator.createSpan({ text: this.currentModelName });
      }
    }
  }
  async checkForUpdates() {
    if (this.isGenerating)
      return;
    try {
      const savedChats = await this.chatStorage.loadChats();
      const currentChat = savedChats.find((c) => c.id === this.chatId);
      if (!currentChat)
        return;
      const hasChanges = currentChat.messages.length !== this.messages.length || currentChat.selectedModelId !== this.selectedModelId || JSON.stringify(Array.from(this.contextManager.getContextFiles())) !== JSON.stringify(currentChat.context_files) || JSON.stringify(currentChat.messages) !== JSON.stringify(this.messages);
      if (hasChanges) {
        this.messages = currentChat.messages;
        this.selectedModelId = currentChat.selectedModelId;
        if (currentChat.context_files) {
          await this.contextManager.setContextFiles(currentChat.context_files);
        }
        await this.loadMessages();
        this.updateModelIndicator();
      } else {
        await this.contextManager.checkSyncStatus();
      }
    } catch (error) {
      console.error("Failed to check for updates:", error);
    }
  }
  async saveChat() {
    if (!this.chatId) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      const hour = String(now.getHours()).padStart(2, "0");
      const minute = String(now.getMinutes()).padStart(2, "0");
      const second = String(now.getSeconds()).padStart(2, "0");
      this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
      this.chatTitle = this.chatTitle || this.chatId;
    }
    try {
      await this.chatStorage.saveChat(this.chatId, this.messages, this.selectedModelId, this.contextManager.getContextFiles(), void 0, this.systemPromptType, this.systemPromptPath, this.chatTitle, this.tokenLimit, this.tokenLimitPercentage);
    } catch (error) {
      this.handleError("Failed to save chat");
    }
  }
  async handleError(error) {
    console.error("Chat error:", {
      error,
      message: typeof error === "string" ? error : error.message,
      code: error instanceof SystemSculptError ? error.code : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
    let errorMessage = typeof error === "string" ? error : error.message;
    if (error instanceof SystemSculptError && (error.code === "MODEL_UNAVAILABLE" || error.code === "MODEL_REQUEST_ERROR" || error.code === "QUOTA_EXCEEDED")) {
      showEnhancedNotice(errorMessage, "error", error);
      const modal = new ModelSelectionModal(this.app, this.selectedModelId, async (modelId) => {
        this.selectedModelId = modelId;
        this.updateModelIndicator();
        showEnhancedNotice("Model changed. You can now retry your message.", "info");
        this.focusInput();
      }, this.plugin);
      modal.open();
      try {
        const models = await this.plugin.modelService.getModels();
        modal.setModels(models);
      } catch (err) {
        console.error("Failed to fetch models:", err);
        showEnhancedNotice("Failed to fetch available models", "error", err);
      }
      const lastMessage = this.chatContainer.querySelector(".systemsculpt-message:last-child");
      if (lastMessage) {
        lastMessage.remove();
      }
      const lastUserMessage = [...this.messages].reverse().find((msg) => msg.role === "user");
      if (lastUserMessage) {
        const index = this.messages.findIndex((msg) => msg.message_id === lastUserMessage.message_id);
        if (index !== -1) {
          this.messages.splice(index);
          const allMessages = this.chatContainer.querySelectorAll(".systemsculpt-message");
          for (let i = index; i < allMessages.length; i++) {
            allMessages[i].remove();
          }
          this.inputHandler.setValue(typeof lastUserMessage.content === "string" ? lastUserMessage.content : JSON.stringify(lastUserMessage.content));
          this.inputHandler.focus();
        }
      }
    } else {
      showEnhancedNotice(errorMessage, "error", error);
    }
  }
  async onLayoutChange() {
    var _a;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian24.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.lastRefreshTime = 0;
      await this.checkForUpdates();
      this.inputHandler.focus();
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async handleSystemPromptEdit() {
    let currentContent = "";
    if (this.systemPromptType === "custom") {
      const file = this.app.vault.getAbstractFileByPath((this.systemPromptPath || "") + ".md");
      if (file instanceof import_obsidian24.TFile) {
        currentContent = await this.app.vault.read(file);
      } else {
        currentContent = this.plugin.settings.systemPrompt;
      }
    } else {
      const systemPromptService = new SystemPromptService(this.app);
      try {
        const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
        if (preset) {
          currentContent = preset.systemPrompt;
        } else {
          currentContent = this.plugin.settings.systemPrompt;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
        currentContent = this.plugin.settings.systemPrompt;
      }
    }
    let modelContextLength;
    try {
      const models = await this.plugin.modelService.getModels();
      const currentModel = models.find((model) => model.id === this.selectedModelId);
      if (currentModel) {
        modelContextLength = currentModel.context_length;
      }
    } catch (error) {
      console.error("Failed to get model context length:", error);
    }
    const result = await showSystemPromptModal(this.app, currentContent, {
      mode: "chat-specific",
      customPromptFilePath: this.systemPromptPath || this.plugin.settings.systemPromptPath,
      systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
      modelContextLength,
      tokenLimitPercentage: this.tokenLimitPercentage
    });
    if (result) {
      this.systemPromptType = result.type;
      if (result.type === "custom" && result.path) {
        this.systemPromptPath = result.path;
      } else {
        this.systemPromptPath = void 0;
      }
      this.tokenLimitPercentage = result.tokenLimitPercentage;
      this.tokenLimit = result.tokenLimit;
      await this.inputHandler.updateTokenCount();
      await this.saveChat();
    }
  }
  async addMessage(role, content, existingMessageId) {
    const messageId = existingMessageId || this.generateMessageId();
    const { messageEl, contentEl } = await this.messageRenderer.renderMessage({
      app: this.app,
      messageId,
      role,
      content
    });
    const contentStr = typeof content === "string" ? content : JSON.stringify(content);
    messageEl.dataset.content = contentStr;
    this.messageRenderer.addMessageButtonToolbar(messageEl, typeof content === "string" ? content : JSON.stringify(content), role, messageId);
    messageEl.addEventListener("resubmit", async (e) => {
      const { messageId: messageId2, content: content2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index);
        await this.saveChat();
        this.chatContainer.empty();
        for (const msg of this.messages) {
          await this.addMessage(msg.role, msg.content, msg.message_id);
        }
        this.inputHandler.setValue(content2);
        this.inputHandler.focus();
      }
    });
    messageEl.addEventListener("edit", async (e) => {
      const { messageId: messageId2, oldContent, newContent } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages[index].content = newContent;
        await this.saveChat();
        const { contentEl: newContentEl } = await this.messageRenderer.renderMessage({
          app: this.app,
          messageId: messageId2,
          role: this.messages[index].role,
          content: this.messages[index].content
        });
        const oldContentEl = messageEl.querySelector(".systemsculpt-message-content");
        if (oldContentEl && newContentEl) {
          oldContentEl.replaceWith(newContentEl);
          this.messageRenderer.setupImageHandlers(newContentEl);
        }
        const updatedStr = typeof this.messages[index].content === "string" ? this.messages[index].content : JSON.stringify(this.messages[index].content);
        messageEl.dataset.content = updatedStr;
      }
    });
    messageEl.addEventListener("delete", async (e) => {
      const { messageId: messageId2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index, 1);
        await this.saveChat();
        messageEl.remove();
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
      }
    });
    this.chatContainer.appendChild(messageEl);
    this.scrollManager.updateContentHeight();
    this.scrollManager.scrollToBottom();
  }
  getInputValue() {
    return this.inputHandler.getValue();
  }
  onunload() {
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
      this.refreshInterval = null;
    }
    this.scrollManager.cleanup();
    this.app.workspace.off("active-leaf-change", this.checkForUpdates.bind(this));
    this.actionsDrawer.unload();
    this.contextManager.unload();
    this.inputHandler.unload();
  }
  getState() {
    return {
      chatId: this.chatId,
      selectedModelId: this.selectedModelId
    };
  }
  async setState(state) {
    var _a;
    if (state.chatId) {
      await this.loadChatById(state.chatId);
    }
    this.awaitingStateRestore = false;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian24.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.inputHandler.focus();
    }
  }
  async loadChatById(chatId) {
    try {
      const chatData = await this.chatStorage.loadChat(chatId);
      if (!chatData) {
        this.handleError("Failed to load chat");
        return;
      }
      this.chatContainer.empty();
      this.messages = chatData.messages;
      this.chatId = chatData.id;
      this.selectedModelId = chatData.selectedModelId;
      this.chatTitle = chatData.title || "Untitled Chat";
      const metadata = await this.chatStorage.getMetadata(chatId);
      if (metadata == null ? void 0 : metadata.systemMessage) {
        this.systemPromptType = metadata.systemMessage.type;
        this.tokenLimit = metadata.systemMessage.tokenLimit;
        this.tokenLimitPercentage = metadata.systemMessage.tokenLimitPercentage;
        if (metadata.systemMessage.path) {
          this.systemPromptPath = metadata.systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
        }
      }
      try {
        const models = await this.plugin.modelService.getModels();
        const currentModel = models.find((model) => model.id === this.selectedModelId);
        this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
      } catch (error) {
        this.currentModelName = this.selectedModelId;
      }
      if (chatData.context_files) {
        await this.contextManager.setContextFiles(chatData.context_files);
      }
      for (const message of this.messages) {
        await this.addMessage(message.role, message.content, message.message_id);
      }
      this.updateModelIndicator();
      if (this.inputHandler) {
        await this.inputHandler.updateTokenCount();
      }
    } catch (error) {
      console.error("[SystemSculpt] Error in loadChatById:", error);
      this.handleError("Failed to load chat");
    }
  }
  async addFileToContext(file) {
    await this.contextManager.addFileToContext(file);
  }
  async copyEntireChatToClipboard() {
    try {
      let chatContent = "";
      if (this.systemPromptType) {
        let systemPromptContent = "";
        if (this.systemPromptType === "custom" && this.systemPromptPath) {
          const file = this.app.vault.getAbstractFileByPath(this.systemPromptPath + ".md");
          if (file instanceof import_obsidian24.TFile) {
            systemPromptContent = await this.app.vault.read(file);
          }
        } else {
          const systemPromptService = new SystemPromptService(this.app);
          try {
            const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
            if (preset) {
              systemPromptContent = preset.systemPrompt;
            }
          } catch (error) {
            console.error("Failed to fetch system prompt:", error);
          }
        }
        if (systemPromptContent) {
          chatContent += `System Prompt:
"""""
${systemPromptContent}
"""""

`;
        }
      }
      const contextFiles = this.contextManager.getContextFiles();
      if (contextFiles.size > 0) {
        chatContent += "Context Files:\n\n";
        for (const filePath of contextFiles) {
          if (!filePath.startsWith("doc:")) {
            const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1").replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
            const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
            if (resolvedFile instanceof import_obsidian24.TFile && !resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
              const content = await this.app.vault.read(resolvedFile);
              chatContent += `[${cleanPath}]
"""""
${content}
"""""

`;
            }
          }
        }
      }
      chatContent += "Chat History Thus Far:\n\n";
      for (const message of this.messages) {
        const role = message.role === "assistant" ? "A" : "User";
        if (typeof message.content === "string") {
          chatContent += `${role}:
"""""
${message.content}
"""""

`;
        }
      }
      await navigator.clipboard.writeText(chatContent);
      new import_obsidian24.Notice("\u2728 Chat copied to clipboard");
    } catch (error) {
      console.error("Failed to copy chat:", error);
      new import_obsidian24.Notice("\u274C Failed to copy chat to clipboard");
    }
  }
  getTokenLimit() {
    return this.tokenLimit;
  }
  focusInput() {
    this.inputHandler.focus();
  }
  setupDragAndDrop(container) {
    const overlay = container.createEl("div", {
      cls: "systemsculpt-drag-overlay"
    });
    const message = overlay.createEl("div", {
      cls: "systemsculpt-drag-message",
      text: "Drop files to add to context"
    });
    const MAX_FILES = 100;
    const parseObsidianUri = (uri) => {
      try {
        if (!uri.startsWith("obsidian://open"))
          return null;
        const url = new URL(uri);
        return decodeURIComponent(url.searchParams.get("file") || "");
      } catch (e) {
        console.error("[DragDrop] Error parsing URI:", uri, e);
        return null;
      }
    };
    const getFilesFromFolder = (folder) => {
      const files = [];
      const processFolder = (currentFolder) => {
        for (const child of currentFolder.children) {
          if (child instanceof import_obsidian24.TFile) {
            files.push(child);
          } else if (child instanceof import_obsidian24.TFolder) {
            processFolder(child);
          }
        }
      };
      processFolder(folder);
      const result = files.slice(0, MAX_FILES);
      return result;
    };
    const getFileCount = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        return 0;
      }
      const remainingSlots = MAX_FILES - currentContextSize;
      let newFileCount = 0;
      let filesToProcess = [];
      if (dt.items && dt.items.length > 0) {
        for (const item of Array.from(dt.items)) {
          if (item.type === "text/plain") {
            const text = await new Promise((resolve) => {
              item.getAsString(resolve);
            });
            const lines = text.split("\n").filter((line) => line.trim());
            for (const line of lines) {
              let filePath = line;
              let abstractFile = null;
              if (line.startsWith("obsidian://")) {
                filePath = parseObsidianUri(line) || line;
              }
              abstractFile = this.app.vault.getAbstractFileByPath(filePath);
              if (abstractFile instanceof import_obsidian24.TFolder) {
                filesToProcess.push(abstractFile);
              } else if (abstractFile instanceof import_obsidian24.TFile) {
                filesToProcess.push(abstractFile);
              } else if (!filePath.includes(".")) {
                const mdPath = `${filePath}.md`;
                const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                if (mdFile instanceof import_obsidian24.TFile) {
                  filesToProcess.push(mdFile);
                }
              }
            }
          }
        }
      }
      for (const item of filesToProcess) {
        if (item instanceof import_obsidian24.TFolder) {
          const folderFiles = getFilesFromFolder(item).length;
          newFileCount += folderFiles;
        } else if (item instanceof import_obsidian24.TFile) {
          newFileCount++;
        }
      }
      if (newFileCount === 0 && dt.types.includes("text/uri-list")) {
        const uriData = await new Promise((resolve) => {
          dt.items[1].getAsString(resolve);
        });
        const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
        for (const uri of uris) {
          const filePath = parseObsidianUri(uri);
          if (!filePath)
            continue;
          const abstractFile = this.app.vault.getAbstractFileByPath(filePath);
          if (abstractFile instanceof import_obsidian24.TFolder) {
            const folderFiles = getFilesFromFolder(abstractFile).length;
            newFileCount += folderFiles;
          } else if (abstractFile instanceof import_obsidian24.TFile) {
            newFileCount++;
          }
        }
      }
      const finalCount = Math.min(newFileCount, remainingSlots);
      return finalCount;
    };
    const updateMessage = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        message.textContent = `Cannot add more files (max ${MAX_FILES} reached)`;
        return;
      }
      const fileCount = await getFileCount(dt);
      if (fileCount > 0) {
        message.textContent = `Add ${fileCount} file${fileCount > 1 ? "s" : ""} to context (${currentContextSize + fileCount}/${MAX_FILES} total)`;
      } else {
        message.textContent = `Drop files to add to context (${currentContextSize}/${MAX_FILES})`;
      }
    };
    let dragCounter = 0;
    container.addEventListener("dragenter", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter++;
      if (dragCounter === 1) {
        container.addClass("systemsculpt-drag-active");
        if (e.dataTransfer) {
          updateMessage(e.dataTransfer);
        }
      }
    });
    container.addEventListener("dragleave", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter--;
      if (dragCounter === 0) {
        container.removeClass("systemsculpt-drag-active");
      }
    });
    container.addEventListener("dragover", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (e.dataTransfer) {
        await updateMessage(e.dataTransfer);
      }
    });
    container.addEventListener("drop", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter = 0;
      container.removeClass("systemsculpt-drag-active");
      const dt = e.dataTransfer;
      if (!dt) {
        return;
      }
      const startingContextSize = this.contextManager.getContextFiles().size;
      if (startingContextSize >= MAX_FILES) {
        new import_obsidian24.Notice(`Cannot add more files (max ${MAX_FILES} reached)`);
        return;
      }
      try {
        let filesToProcess = [];
        if (dt.items && dt.items.length > 0) {
          for (const item of Array.from(dt.items)) {
            if (item.type === "text/plain") {
              const text = await new Promise((resolve) => {
                item.getAsString(resolve);
              });
              const lines = text.split("\n").filter((line) => line.trim());
              for (const line of lines) {
                let filePath = line;
                let abstractFile = null;
                if (line.startsWith("obsidian://")) {
                  filePath = parseObsidianUri(line) || line;
                }
                abstractFile = this.app.vault.getAbstractFileByPath(filePath);
                if (abstractFile instanceof import_obsidian24.TFolder) {
                  filesToProcess.push(abstractFile);
                } else if (abstractFile instanceof import_obsidian24.TFile) {
                  filesToProcess.push(abstractFile);
                } else if (!filePath.includes(".")) {
                  const mdPath = `${filePath}.md`;
                  const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                  if (mdFile instanceof import_obsidian24.TFile) {
                    filesToProcess.push(mdFile);
                  }
                }
              }
            }
          }
        }
        if (filesToProcess.length === 0 && dt.types.includes("text/uri-list")) {
          const uriData = await new Promise((resolve) => {
            dt.items[1].getAsString(resolve);
          });
          const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
          for (const uri of uris) {
            const filePath = parseObsidianUri(uri);
            if (!filePath)
              continue;
            let abstractFile = this.app.vault.getAbstractFileByPath(filePath);
            if (abstractFile instanceof import_obsidian24.TFile || abstractFile instanceof import_obsidian24.TFolder) {
              filesToProcess.push(abstractFile);
            }
          }
        }
        let totalFilesAdded = 0;
        const remainingSlots = MAX_FILES - startingContextSize;
        for (const item of filesToProcess) {
          if (item instanceof import_obsidian24.TFolder) {
            const files = getFilesFromFolder(item);
            for (const file of files) {
              const currentContextSize = this.contextManager.getContextFiles().size;
              if (currentContextSize >= MAX_FILES) {
                new import_obsidian24.Notice(`File limit reached (${MAX_FILES} total)`);
                return;
              }
              try {
                await this.contextManager.addFileToContext(file);
                totalFilesAdded++;
                const updatedContextSize = this.contextManager.getContextFiles().size;
                new import_obsidian24.Notice(`Added ${file.name} to context (${updatedContextSize}/${MAX_FILES})`);
              } catch (error) {
                console.error("[DragDrop] Error adding file from folder:", {
                  file: file.path,
                  error
                });
              }
            }
          } else if (item instanceof import_obsidian24.TFile) {
            const currentContextSize = this.contextManager.getContextFiles().size;
            if (currentContextSize >= MAX_FILES) {
              new import_obsidian24.Notice(`File limit reached (${MAX_FILES} total)`);
              return;
            }
            await this.contextManager.addFileToContext(item);
            totalFilesAdded++;
            const updatedContextSize = this.contextManager.getContextFiles().size;
            new import_obsidian24.Notice(`Added ${item.name} to context (${updatedContextSize}/${MAX_FILES})`);
          }
        }
        const finalContextSize = this.contextManager.getContextFiles().size;
      } catch (error) {
        console.error("[DragDrop] Error processing drop:", error);
        new import_obsidian24.Notice("Failed to process dropped files");
      }
    });
  }
  getSelectedModelId() {
    return this.selectedModelId;
  }
  async setSelectedModelId(modelId) {
    this.selectedModelId = modelId;
    await this.updateModelIndicator();
    await this.saveChat();
    const models = await this.plugin.modelService.getModels();
    const selectedModel = models.find((model) => model.id === modelId);
    if (this.tokenLimitPercentage && (selectedModel == null ? void 0 : selectedModel.context_length)) {
      this.tokenLimit = Math.floor(this.tokenLimitPercentage / 100 * selectedModel.context_length);
      await this.saveChat();
    }
    this.focusInput();
  }
};

// src/services/RecorderService.ts
var RECORDING_FORMATS = [
  { mimeType: "audio/webm;codecs=opus", extension: "webm", sampleRate: 16e3 },
  { mimeType: "audio/webm", extension: "webm", sampleRate: 48e3 },
  { mimeType: "audio/ogg;codecs=opus", extension: "ogg", sampleRate: 48e3 },
  { mimeType: "audio/wav", extension: "wav", sampleRate: 48e3 }
];
var RecorderService = class {
  constructor(app, plugin, options = {}) {
    this.isRecording = false;
    this.onToggleCallbacks = new Set();
    this.mediaStream = null;
    this.mediaRecorder = null;
    this.chunks = [];
    this.selectedFormat = null;
    this.lastRecordedFilePath = null;
    this.audioContext = null;
    this.analyser = null;
    this.animationFrame = null;
    this.smoothingFactor = 0.4;
    this.visualizerCanvas = null;
    this.currentContext = null;
    this.recordingModal = null;
    this.dragCleanup = null;
    this.editorHandler = null;
    this.draw = () => {
      if (!this.isRecording || !this.analyser || !this.visualizerCanvas) {
        if (this.animationFrame) {
          cancelAnimationFrame(this.animationFrame);
          this.animationFrame = null;
        }
        return;
      }
      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
        this.animationFrame = null;
      }
      const bufferLength = this.analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      this.analyser.getByteFrequencyData(dataArray);
      const ctx = this.visualizerCanvas.getContext("2d");
      if (!ctx)
        return;
      ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      const rect = this.visualizerCanvas.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      const centerY = height / 2;
      const centerX = width / 2;
      const isMobile = width <= 400;
      const overlap = isMobile ? 3 : 5;
      const centerOverlapScale = isMobile ? 4 : 8;
      const amplitudeScale = isMobile ? 0.8 : 0.95;
      const edgeZoneScale = isMobile ? 0.15 : 0.2;
      const computedStyle = getComputedStyle(document.documentElement);
      let accentColor = computedStyle.getPropertyValue("--text-accent").trim();
      if (!accentColor) {
        accentColor = "#5871ef";
      }
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, accentColor);
      gradient.addColorStop(0.5, accentColor);
      gradient.addColorStop(1, accentColor);
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      const halfBufferLength = Math.floor(bufferLength / 2);
      const sliceWidth = width / 2 / halfBufferLength;
      const centerOverlap = sliceWidth * centerOverlapScale;
      const getEdgeTaper = (i, total) => {
        const edgeZone = total * edgeZoneScale;
        if (i < edgeZone) {
          return 0.3 + 0.7 * (i / edgeZone);
        } else if (i > total - edgeZone) {
          return 0.3 + 0.7 * ((total - i) / edgeZone);
        }
        return 1;
      };
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const value = dataArray[Math.abs(i)] / 255;
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        this.smoothedValues[index] = this.smoothedValues[index] * this.smoothingFactor + value * (1 - this.smoothingFactor);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      if (this.isRecording) {
        this.animationFrame = requestAnimationFrame(this.draw);
      }
    };
    this.app = app;
    this.plugin = plugin;
    this.smoothedValues = new Float32Array(128);
    this.updateContext(options);
    console.log("RecorderService initialized");
  }
  static getInstance(app, plugin, options = {}) {
    if (!RecorderService.instance) {
      console.log("Creating new RecorderService instance");
      RecorderService.instance = new RecorderService(app, plugin);
    }
    RecorderService.instance.updateContext(options);
    return RecorderService.instance;
  }
  getActiveViewInfo() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      return { isChat: false, viewIdentifier: "unknown" };
    }
    const viewState = activeLeaf.getViewState();
    const viewType = viewState.type;
    if (viewType === CHAT_VIEW_TYPE) {
      return { isChat: true, viewIdentifier: "chat" };
    }
    const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian25.MarkdownView);
    if (markdownView == null ? void 0 : markdownView.file) {
      return {
        isChat: false,
        viewIdentifier: `note-${markdownView.file.path}`
      };
    }
    return { isChat: false, viewIdentifier: "unknown" };
  }
  updateContext(options) {
    const { isChat } = this.getActiveViewInfo();
    this.currentContext = {
      isInChat: isChat,
      onTranscriptionComplete: options.onTranscriptionComplete
    };
  }
  insertTextIntoActiveView(text) {
    const { isChat } = this.getActiveViewInfo();
    if (isChat) {
      const chatView = this.app.workspace.getActiveViewOfType(ChatView);
      if (chatView) {
        const input = chatView.containerEl.querySelector(".systemsculpt-chat-input");
        if (input) {
          const cursorPos = input.selectionStart;
          const currentValue = input.value;
          if (cursorPos !== null) {
            const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
            input.value = newValue;
            input.selectionStart = input.selectionEnd = cursorPos + text.length;
          } else {
            input.value = currentValue + text;
            input.selectionStart = input.selectionEnd = input.value.length;
          }
          input.dispatchEvent(new Event("input"));
          input.focus();
          new import_obsidian25.Notice("\u2728 Transcription pasted into chat");
        } else {
          console.warn("Chat input element not found");
          new import_obsidian25.Notice("\u2728 Transcription copied to clipboard (no chat input)");
        }
      } else {
        console.warn("No active chat view found");
        new import_obsidian25.Notice("\u2728 Transcription copied to clipboard (no active chat)");
      }
    } else {
      const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian25.MarkdownView);
      if (!(markdownView == null ? void 0 : markdownView.editor)) {
        console.warn("No active markdown editor found");
        new import_obsidian25.Notice("\u2728 Transcription copied to clipboard (no active note)");
        return;
      }
      const editor = markdownView.editor;
      const cursor = editor.getCursor();
      const lineContent = editor.getLine(cursor.line);
      const textToInsert = text ? cursor.ch > 0 && lineContent.length > 0 ? "\n" + text : text : "";
      if (!textToInsert) {
        console.warn("No text to insert");
        return;
      }
      editor.replaceRange(textToInsert, cursor);
      const lines = textToInsert.split("\n");
      const lastLine = lines[lines.length - 1] || "";
      editor.setCursor({
        line: cursor.line + lines.length - 1,
        ch: lastLine.length
      });
      new import_obsidian25.Notice("\u2728 Transcription pasted into note");
    }
  }
  async transcribeLastRecording() {
    var _a, _b;
    if (!this.lastRecordedFilePath)
      return;
    try {
      const file = this.plugin.app.vault.getAbstractFileByPath(this.lastRecordedFilePath);
      if (!file || !(file instanceof import_obsidian25.TFile))
        return;
      const modal = new AudioTranscriptionModal(this.app, {
        file,
        isChat: (_b = (_a = this.currentContext) == null ? void 0 : _a.isInChat) != null ? _b : false,
        onTranscriptionComplete: (text) => {
          var _a2;
          if ((_a2 = this.currentContext) == null ? void 0 : _a2.onTranscriptionComplete) {
            this.currentContext.onTranscriptionComplete(text);
          } else {
            this.insertTextIntoActiveView(text);
          }
        },
        plugin: this.plugin
      });
      modal.open();
      try {
        await this.plugin.app.vault.delete(file);
      } catch (error) {
        console.warn("Failed to clean up recording file:", error);
      }
    } catch (error) {
      console.error("Auto-transcription failed:", error);
      new import_obsidian25.Notice("\u274C Failed to transcribe audio");
      throw error;
    }
  }
  createRecordingModal() {
    if (this.recordingModal) {
      if (this.dragCleanup) {
        this.dragCleanup();
        this.dragCleanup = null;
      }
      this.recordingModal.remove();
      this.recordingModal = null;
    }
    this.recordingModal = document.createElement("div");
    this.recordingModal.className = "systemsculpt-recorder-modal";
    const content = document.createElement("div");
    content.className = "systemsculpt-recorder-content";
    const liveIndicator = document.createElement("div");
    liveIndicator.className = "systemsculpt-recorder-live";
    liveIndicator.textContent = "\u25CF Live";
    content.appendChild(liveIndicator);
    const canvas = document.createElement("canvas");
    canvas.className = "systemsculpt-recorder-canvas";
    content.appendChild(canvas);
    this.recordingModal.appendChild(content);
    document.body.appendChild(this.recordingModal);
    this.dragCleanup = this.setupDraggable(this.recordingModal);
    this.setVisualizerCanvas(canvas);
  }
  setupDraggable(element) {
    let pos = { x: 0, y: 0 };
    const cleanup = () => {
      element.classList.remove("dragging");
    };
    const onMove = (clientX, clientY) => {
      const rect = element.getBoundingClientRect();
      pos.x = Math.min(Math.max(0, clientX - rect.width / 2), window.innerWidth - rect.width);
      pos.y = Math.min(Math.max(0, clientY - rect.height / 2), window.innerHeight - rect.height);
      element.style.bottom = "";
      element.style.right = "";
      element.style.left = `${pos.x}px`;
      element.style.top = `${pos.y}px`;
    };
    const onPointerDown = (e) => {
      if (e.button !== 0 && e.button !== -1)
        return;
      element.classList.add("dragging");
      element.setPointerCapture(e.pointerId);
      const rect = element.getBoundingClientRect();
      pos.x = rect.left;
      pos.y = rect.top;
      onMove(e.clientX, e.clientY);
    };
    const onPointerMove = (e) => {
      if (element.hasPointerCapture(e.pointerId)) {
        onMove(e.clientX, e.clientY);
      }
    };
    const onPointerUp = (e) => {
      cleanup();
      element.releasePointerCapture(e.pointerId);
    };
    element.addEventListener("pointerdown", onPointerDown);
    element.addEventListener("pointermove", onPointerMove);
    element.addEventListener("pointerup", onPointerUp);
    element.addEventListener("pointercancel", cleanup);
    return () => {
      element.removeEventListener("pointerdown", onPointerDown);
      element.removeEventListener("pointermove", onPointerMove);
      element.removeEventListener("pointerup", onPointerUp);
      element.removeEventListener("pointercancel", cleanup);
    };
  }
  async toggleRecording() {
    try {
      if (!this.isRecording) {
        const { isChat, viewIdentifier } = this.getActiveViewInfo();
        if (viewIdentifier === "unknown") {
          new import_obsidian25.Notice("\u26A0\uFE0F Please open a note or chat before recording");
          return;
        }
        console.log("Starting recording in view:", {
          isChat,
          viewIdentifier
        });
        this.updateContext({
          isInChat: isChat
        });
        this.createRecordingModal();
      }
      if (this.isRecording) {
        await this.stopRecording();
        if (this.recordingModal) {
          if (this.dragCleanup) {
            this.dragCleanup();
            this.dragCleanup = null;
          }
          this.recordingModal.remove();
          this.recordingModal = null;
        }
      } else {
        await this.startRecording();
        if (this.recordingModal) {
          this.recordingModal.classList.add("recording");
        }
      }
    } catch (error) {
      console.error("Error toggling recording:", error);
      new import_obsidian25.Notice("\u274C Failed to toggle recording");
    }
  }
  async ensureRecordingDirectory() {
    const dir = this.plugin.settings.recordingsDirectory;
    try {
      await this.plugin.app.vault.adapter.mkdir(dir);
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : "Unknown error";
      console.error("Failed to create recordings directory:", errorMessage);
      throw new Error(`Failed to create recordings directory: ${errorMessage}`);
    }
  }
  async detectSupportedFormat() {
    for (const format of RECORDING_FORMATS) {
      try {
        if (MediaRecorder.isTypeSupported(format.mimeType)) {
          console.log(`Selected recording format: ${format.mimeType}`);
          return format;
        }
      } catch (error) {
        console.warn(`Format ${format.mimeType} check failed:`, error);
      }
    }
    throw new Error("No supported audio recording format found");
  }
  generateFileName() {
    var _a;
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-").replace("T", "_").split(".")[0];
    return `${timestamp}.${((_a = this.selectedFormat) == null ? void 0 : _a.extension) || "audio"}`;
  }
  resetVisualizationState() {
    this.smoothedValues = new Float32Array(128);
    if (this.animationFrame) {
      cancelAnimationFrame(this.animationFrame);
      this.animationFrame = null;
    }
    if (this.analyser) {
      this.analyser.disconnect();
      this.analyser = null;
    }
    if (this.audioContext) {
      this.audioContext.close();
      this.audioContext = null;
    }
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
  }
  setupVisualization() {
    if (!this.mediaStream)
      return;
    this.audioContext = new AudioContext({
      sampleRate: 16e3,
      latencyHint: "interactive"
    });
    const source = this.audioContext.createMediaStreamSource(this.mediaStream);
    this.analyser = this.audioContext.createAnalyser();
    this.analyser.fftSize = 256;
    this.analyser.smoothingTimeConstant = 0.7;
    source.connect(this.analyser);
    if (this.visualizerCanvas) {
      this.updateCanvasSize();
      this.draw();
    }
  }
  setVisualizerCanvas(canvas) {
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
    if (!canvas) {
      this.resetVisualizationState();
    }
    this.visualizerCanvas = canvas;
    if (canvas && this.isRecording) {
      this.updateCanvasSize();
      if (!this.audioContext || !this.analyser) {
        this.setupVisualization();
      } else {
        this.draw();
      }
    }
  }
  updateCanvasSize() {
    if (!this.visualizerCanvas)
      return;
    const rect = this.visualizerCanvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    this.visualizerCanvas.width = rect.width * dpr;
    this.visualizerCanvas.height = rect.height * dpr;
    const ctx = this.visualizerCanvas.getContext("2d");
    if (ctx) {
      ctx.scale(dpr, dpr);
    }
  }
  async startRecording() {
    if (this.isRecording)
      return;
    this.resetVisualizationState();
    try {
      await this.ensureRecordingDirectory();
      const permissionResult = await navigator.permissions.query({
        name: "microphone"
      });
      if (permissionResult.state === "denied") {
        throw new Error("Microphone permission denied");
      }
      this.selectedFormat = await this.detectSupportedFormat();
      const audioConstraints = {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 16e3,
        channelCount: 1
      };
      if (this.plugin.settings.preferredMicrophoneId) {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const preferredDevice = devices.find((device) => device.kind === "audioinput" && device.deviceId === this.plugin.settings.preferredMicrophoneId);
          if (preferredDevice) {
            audioConstraints.deviceId = {
              exact: this.plugin.settings.preferredMicrophoneId
            };
          } else {
            this.plugin.settings.preferredMicrophoneId = "";
            await this.plugin.saveSettings();
            console.log("Preferred microphone not found, falling back to default");
          }
        } catch (error) {
          console.error("Error checking microphone devices:", error);
        }
      }
      this.mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: audioConstraints
      });
      this.mediaRecorder = new MediaRecorder(this.mediaStream, {
        mimeType: this.selectedFormat.mimeType
      });
      this.chunks = [];
      this.mediaRecorder.ondataavailable = async (e) => {
        var _a, _b;
        if (e.data.size > 0) {
          this.chunks.push({
            blob: e.data,
            sampleRate: (_b = (_a = this.selectedFormat) == null ? void 0 : _a.sampleRate) != null ? _b : 48e3
          });
        }
      };
      this.mediaRecorder.onstop = async () => {
        var _a;
        try {
          const fileName = this.generateFileName();
          const filePath = `${this.plugin.settings.recordingsDirectory}/${fileName}`;
          const blob = new Blob(this.chunks.map((chunk) => chunk.blob), { type: (_a = this.selectedFormat) == null ? void 0 : _a.mimeType });
          const arrayBuffer = await blob.arrayBuffer();
          await this.plugin.app.vault.adapter.writeBinary(filePath, arrayBuffer);
          this.lastRecordedFilePath = filePath;
          await this.transcribeLastRecording();
        } catch (error) {
          console.error("Failed to save recording:", error);
          new import_obsidian25.Notice("\u274C Failed to save recording");
        }
      };
      this.mediaRecorder.start(1e3);
      this.setupVisualization();
      this.isRecording = true;
      this.notifyListeners();
      if (this.visualizerCanvas) {
        this.draw();
      }
    } catch (error) {
      console.error("Recording error:", error);
      const errorMessage = error instanceof Error ? error.message : "Recording failed";
      throw error;
    }
  }
  async stopRecording() {
    if (!this.isRecording)
      return;
    if (this.mediaRecorder && this.mediaRecorder.state !== "inactive") {
      this.mediaRecorder.stop();
    }
    if (this.mediaStream) {
      this.mediaStream.getTracks().forEach((track) => track.stop());
      this.mediaStream = null;
    }
    this.resetVisualizationState();
    if (this.recordingModal) {
      this.recordingModal.classList.remove("recording");
    }
    this.mediaRecorder = null;
    this.isRecording = false;
    this.notifyListeners();
  }
  onToggle(callback) {
    this.onToggleCallbacks.add(callback);
  }
  notifyListeners() {
    this.onToggleCallbacks.forEach((cb) => cb(this.isRecording));
  }
  unload() {
    this.stopRecording();
    this.onToggleCallbacks.clear();
  }
};

// src/components/SystemSculptContextMenu.ts
var import_obsidian27 = __toModule(require("obsidian"));
init_api();

// src/modals/TextModificationModal.ts
var import_obsidian26 = __toModule(require("obsidian"));
init_SystemSculptService();
init_ui();
function generateUUID2() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var TextModificationModal = class extends import_obsidian26.Modal {
  constructor(app, options) {
    super(app);
    this.isGenerating = false;
    this.options = options;
    this.aiService = SystemSculptService.getInstance(DEFAULT_SETTINGS, app);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal");
    contentEl.addClass("systemsculpt-text-modification-modal");
    const headerEl = contentEl.createDiv("systemsculpt-modal-header");
    headerEl.createEl("h2", { text: "Modify Text" });
    const mainContent = contentEl.createDiv("systemsculpt-modal-content");
    const inputSection = mainContent.createDiv("systemsculpt-input-section");
    const inputLabel = inputSection.createEl("label", {
      text: "Modification Instructions"
    });
    this.inputArea = inputSection.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter instructions for how to modify the text..."
      }
    });
    const previewSection = mainContent.createDiv("systemsculpt-preview-section");
    const previewLabel = previewSection.createEl("label", { text: "Preview" });
    this.previewArea = previewSection.createDiv("systemsculpt-preview-content");
    this.previewArea.setText(this.options.initialText);
    const footerEl = contentEl.createDiv("systemsculpt-modal-footer");
    const cancelButton = footerEl.createEl("button", {
      cls: "systemsculpt-button",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => this.close());
    this.modifyButton = footerEl.createEl("button", {
      cls: "systemsculpt-button mod-cta",
      text: "Modify"
    });
    this.modifyButton.addEventListener("click", () => this.handleModify());
    this.inputArea.focus();
  }
  async handleModify() {
    if (this.isGenerating || !this.inputArea.value.trim())
      return;
    try {
      this.isGenerating = true;
      this.modifyButton.disabled = true;
      (0, import_obsidian26.setIcon)(this.modifyButton, "loader-2");
      this.modifyButton.addClass("loading");
      const instructions = this.inputArea.value.trim();
      const textToModify = this.options.initialText;
      let modifiedText = "";
      for await (const chunk of this.aiService.streamMessage({
        messages: [
          { role: "user", content: textToModify, message_id: generateUUID2() },
          { role: "user", content: instructions, message_id: generateUUID2() }
        ],
        model: "llama-3.3-70b-versatile",
        systemPromptType: "text_modification",
        onError: (error) => {
          showEnhancedNotice(`Failed to modify text: ${error}`, "error");
        }
      })) {
        modifiedText += chunk;
        this.previewArea.setText(modifiedText);
      }
      this.options.onModify(modifiedText);
      this.close();
    } catch (error) {
      console.error("Text modification failed:", error);
      showEnhancedNotice("Failed to modify text. Please try again.", "error");
    } finally {
      this.isGenerating = false;
      this.modifyButton.disabled = false;
      this.modifyButton.empty();
      this.modifyButton.setText("Modify");
      this.modifyButton.removeClass("loading");
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/components/SystemSculptContextMenu.ts
var SystemSculptContextMenu = class {
  constructor(app, sculptService, plugin) {
    this.statusBarItem = null;
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
    this.app = app;
    this.sculptService = sculptService;
    this.plugin = plugin;
    this.transcriptionService = TranscriptionService.getInstance(plugin);
    this.registerContextMenu();
    this.initializeStatusBar();
  }
  initializeStatusBar() {
    this.statusBarItem = this.app.workspace.containerEl.createDiv({
      cls: "systemsculpt-status-bar"
    });
    this.statusBarItem.style.display = "none";
  }
  registerContextMenu() {
    this.app.workspace.on("editor-menu", (menu, editor, view) => {
      if (!(view instanceof import_obsidian27.MarkdownView))
        return;
      const selection = editor.getSelection();
      if (!selection)
        return;
      menu.addItem((item) => {
        item.setTitle("SystemSculpt - Modify Text").setIcon("wand").onClick(async () => {
          const modal = new TextModificationModal(this.app, {
            initialText: selection,
            onModify: (modifiedText) => {
              editor.replaceSelection(modifiedText);
            }
          });
          modal.open();
        });
      });
    });
    this.app.workspace.on("file-menu", (menu, file) => {
      if (!(file instanceof import_obsidian27.TFile))
        return;
      const extension = file.extension.toLowerCase();
      if (["md", "txt", "markdown"].includes(extension) || ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"].includes(extension) || ["mp3", "wav", "m4a", "ogg", "webm"].includes(extension) || ["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Chat with File").setIcon("message-square").onClick(async () => {
            try {
              const leaf = this.app.workspace.getLeaf("tab");
              const view = new ChatView(leaf, this.plugin);
              await leaf.open(view);
              await new Promise((resolve) => setTimeout(resolve, 50));
              this.app.workspace.setActiveLeaf(leaf, { focus: true });
              await view.addFileToContext(file);
            } catch (error) {
              new import_obsidian27.Notice("Failed to open chat with file");
              console.error("Chat open error:", error);
            }
          });
        });
      }
      if (file.extension === "mp3" || file.extension === "wav" || file.extension === "webm") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio").setIcon("microphone").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, false);
            } catch (error) {
              new import_obsidian27.Notice("Failed to transcribe audio file");
              console.error("Transcription error:", error);
            }
          });
        });
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio (Timestamped)").setIcon("clock").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, true);
            } catch (error) {
              new import_obsidian27.Notice("Failed to transcribe audio file with timestamps");
              console.error("Timestamped transcription error:", error);
            }
          });
        });
      }
      if (file.extension === "pdf" || file.extension === "docx" || file.extension === "doc") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Convert to Markdown").setIcon("file-text").onClick(async () => {
            try {
              await this.handleDocumentConversion(file);
            } catch (error) {
              new import_obsidian27.Notice("Failed to convert document");
              console.error("Document conversion error:", error);
            }
          });
        });
      }
    });
  }
  async handleDocumentConversion(file) {
    this.createProgressModal();
    this.updateProgressModal(0, "Processing your document...", "loader-2");
    try {
      await this.sleep(1e3);
      this.updateProgressModal(10, "Uploading document...", "upload");
      const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
      if (cached) {
        this.updateProgressModal(50, "Found cached version", "check");
        const extractionData2 = await this.downloadExtraction(documentId);
        const extractionPath2 = await this.saveExtractionResults(file, extractionData2);
        this.updateProgressModal(100, "Processing complete!", "check-circle");
        this.showCompletionButtons(extractionPath2);
        return;
      }
      this.updateProgressModal(30, "Processing document...", "loader-2");
      const pollResult = await this.pollUntilComplete(documentId);
      if (!pollResult) {
        this.updateProgressModal(0, "Processing incomplete", "alert-circle");
        await this.sleep(3e3);
        this.closeProgressModal();
        return;
      }
      this.updateProgressModal(80, "Downloading results...", "download");
      const extractionData = await this.downloadExtraction(documentId);
      const extractionPath = await this.saveExtractionResults(file, extractionData);
      this.updateProgressModal(100, "Processing complete!", "check-circle");
      this.showCompletionButtons(extractionPath);
    } catch (e) {
      console.error("SystemSculpt error", e);
      this.updateProgressModal(0, `Error: ${e instanceof Error ? e.message : String(e)}`, "x-circle");
      await this.sleep(5e3);
      this.closeProgressModal();
    }
  }
  async handleAudioTranscription(file, timestamped) {
    try {
      await showAudioTranscriptionModal(this.app, {
        file,
        timestamped,
        plugin: this.plugin,
        onTranscriptionComplete: async (text) => {
          var _a;
          const baseName = file.basename;
          const fileExtension = timestamped ? "srt" : "md";
          const outputPath = `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}.${fileExtension}`;
          const content = timestamped ? text : text;
          let transcriptionFile;
          const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
          if (existingFile instanceof import_obsidian27.TFile) {
            await this.app.vault.modify(existingFile, content);
            transcriptionFile = existingFile;
          } else {
            transcriptionFile = await this.app.vault.create(outputPath, content);
          }
          const leaf = this.app.workspace.getLeaf("tab");
          await leaf.openFile(transcriptionFile);
          this.app.workspace.setActiveLeaf(leaf, { focus: true });
        }
      });
    } catch (error) {
      console.error("Audio transcription error:", error);
      throw error;
    }
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  createProgressModal() {
    if (this.progressModal)
      return;
    this.progressModal = document.createElement("div");
    this.progressModal.className = "systemsculpt-progress-modal";
    this.progressBar = this.progressModal.createDiv("systemsculpt-progress-bar");
    this.progressStatus = this.progressModal.createDiv("systemsculpt-progress-status");
    this.progressButtons = this.progressModal.createDiv("systemsculpt-progress-buttons");
    document.body.appendChild(this.progressModal);
  }
  updateProgressModal(progress, status, icon) {
    if (!this.progressModal || !this.progressBar || !this.progressStatus)
      return;
    this.progressBar.style.width = `${progress}%`;
    this.progressStatus.empty();
    (0, import_obsidian27.setIcon)(this.progressStatus, icon);
    this.progressStatus.createSpan({ text: status });
  }
  showCompletionButtons(extractionPath) {
    if (!this.progressButtons)
      return;
    this.progressButtons.empty();
    const viewButton = this.progressButtons.createEl("button", {
      text: "View Result",
      cls: "mod-cta"
    });
    viewButton.addEventListener("click", async () => {
      const file = this.app.vault.getAbstractFileByPath(extractionPath);
      if (file instanceof import_obsidian27.TFile) {
        await this.app.workspace.getLeaf().openFile(file);
      }
      this.closeProgressModal();
    });
    const closeButton = this.progressButtons.createEl("button", {
      text: "Close"
    });
    closeButton.addEventListener("click", () => {
      this.closeProgressModal();
    });
  }
  closeProgressModal() {
    if (this.progressModal && this.progressModal.parentNode) {
      this.progressModal.parentNode.removeChild(this.progressModal);
    }
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
  }
  async pollUntilComplete(documentId, maxAttempts = 30) {
    for (let i = 0; i < maxAttempts; i++) {
      const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.GET(documentId)}`, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      if (!response.ok) {
        throw new Error(`Failed to check status: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === "completed") {
        return true;
      } else if (data.status === "failed") {
        throw new Error(data.error || "Processing failed");
      }
      const progress = Math.min(30 + i / maxAttempts * 50, 80);
      this.updateProgressModal(progress, "Processing document...", "loader-2");
      await this.sleep(2e3);
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.DOWNLOAD(documentId)}`, {
      headers: {
        "Content-Type": "application/json"
      }
    });
    if (!response.ok) {
      throw new Error(`Failed to download extraction: ${response.statusText}`);
    }
    return response.json();
  }
  async saveExtractionResults(file, data) {
    var _a;
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = this.sanitizeFilename(file.basename);
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}`;
    await this.createFolder(parentPath);
    const extractionPath = this.normalizePath(`${parentPath}/${baseName}-extraction.md`);
    const content = this.formatExtractionContent(data);
    const existingFile = this.app.vault.getAbstractFileByPath(extractionPath);
    if (existingFile instanceof import_obsidian27.TFile) {
      await this.app.vault.modify(existingFile, content);
    } else {
      await this.app.vault.create(extractionPath, content);
    }
    return extractionPath;
  }
  sanitizeFilename(filename) {
    return filename.replace(/[^a-zA-Z0-9-_ ]/g, "");
  }
  normalizePath(path) {
    return path.replace(/\\/g, "/").replace(/\/+/g, "/");
  }
  async createFolder(path) {
    const normalizedPath = this.normalizePath(path);
    if (!(this.app.vault.getAbstractFileByPath(normalizedPath) instanceof import_obsidian27.TFolder)) {
      await this.app.vault.createFolder(normalizedPath);
    }
  }
  formatExtractionContent(data) {
    return `# ${data.title || "Document Extraction"}

${data.content || ""}

---
Extracted with SystemSculpt
`;
  }
};

// src/core/settings/SettingsManager.ts
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.settings = DEFAULT_SETTINGS;
  }
  async loadSettings() {
    const loadedData = await this.plugin.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
    if (this.settings.developmentMode) {
      this.settings.serverUrl = "http://localhost:3001";
    } else {
      this.settings.serverUrl = "https://api.systemsculpt.com";
    }
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
    this.plugin.aiService.updateSettings(this.settings);
  }
  getSettings() {
    return this.settings;
  }
  async updateSettings(newSettings) {
    if (newSettings.developmentMode !== void 0) {
      newSettings.serverUrl = newSettings.developmentMode ? "http://localhost:3001" : "https://api.systemsculpt.com";
    }
    this.settings = { ...this.settings, ...newSettings };
    await this.saveSettings();
  }
};

// src/core/license/LicenseManager.ts
var LicenseManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  async validateLicenseKey(force = false) {
    if (!this.plugin.settings.licenseKey) {
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
    try {
      const isValid = await this.plugin.aiService.validateLicense(force);
      this.plugin.settings.licenseValid = isValid;
      await this.plugin.saveSettings();
      return isValid;
    } catch (error) {
      console.error("License validation error:", error);
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
  }
};

// src/modals/JanitorModal.ts
var import_obsidian28 = __toModule(require("obsidian"));
init_ui();
var JanitorModal = class extends import_obsidian28.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  calculateSize(files) {
    const totalBytes = files.reduce((acc, file) => acc + file.stat.size, 0);
    if (totalBytes === 0) {
      return "empty";
    } else if (totalBytes < 1024) {
      return `${totalBytes} bytes`;
    } else if (totalBytes < 1024 * 1024) {
      return `${(totalBytes / 1024).toFixed(1)} KB`;
    } else if (totalBytes < 1024 * 1024 * 1024) {
      return `${(totalBytes / (1024 * 1024)).toFixed(1)} MB`;
    } else {
      return `${(totalBytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;
    }
  }
  getFilesInDirectory(directory) {
    return this.app.vault.getFiles().filter((file) => file.path.startsWith(directory));
  }
  disableButton(button) {
    button.disabled = true;
    button.addClass("mod-disabled");
    button.removeClass("mod-warning");
  }
  updateButtonState(button, files, type) {
    const size = this.calculateSize(files);
    const hasFiles = files.length > 0;
    if (hasFiles) {
      button.disabled = false;
      button.removeClass("mod-disabled");
      button.addClass("mod-warning");
      button.setText(`Clear All ${type} (${size})`);
    } else {
      button.disabled = true;
      button.addClass("mod-disabled");
      button.removeClass("mod-warning");
      button.setText(`No ${type}`);
    }
  }
  async cleanDirectory(directory) {
    if (!directory || directory === "/" || directory === "." || directory === "..") {
      throw new Error("Cannot delete root or system directories");
    }
    const files = this.getFilesInDirectory(directory);
    for (const file of files) {
      await this.app.vault.trash(file, true);
    }
    const folder = this.app.vault.getAbstractFileByPath(directory);
    if (folder instanceof import_obsidian28.TFolder) {
      const subdirs = folder.children.filter((child) => child instanceof import_obsidian28.TFolder).sort((a, b) => b.path.length - a.path.length);
      for (const subdir of subdirs) {
        if (subdir.children.length === 0) {
          await this.app.vault.trash(subdir, true);
        }
      }
      if (folder.children.length === 0) {
        await this.app.vault.trash(folder, true);
      }
    }
  }
  showFilePreview(files, type) {
    var _a, _b;
    const container = document.createElement("div");
    container.className = "systemsculpt-file-tree nav-folder";
    const summary = document.createElement("div");
    summary.className = "nav-folder-title";
    summary.textContent = `${files.length} ${type} (${this.calculateSize(files)})`;
    container.appendChild(summary);
    const sortedFiles = files.sort((a, b) => a.path.localeCompare(b.path));
    const filesByDir = new Map();
    for (const file of sortedFiles) {
      const dir = ((_a = file.parent) == null ? void 0 : _a.path) || "";
      if (!filesByDir.has(dir)) {
        filesByDir.set(dir, []);
      }
      (_b = filesByDir.get(dir)) == null ? void 0 : _b.push(file);
    }
    for (const [dir, dirFiles] of filesByDir) {
      if (dir) {
        const folderDiv = document.createElement("div");
        folderDiv.className = "nav-folder";
        const folderTitle = document.createElement("div");
        folderTitle.className = "nav-folder-title";
        (0, import_obsidian28.setIcon)(folderTitle, "folder");
        folderTitle.createSpan({ text: dir });
        folderDiv.appendChild(folderTitle);
        const folderContent = document.createElement("div");
        folderContent.className = "nav-folder-children";
        folderDiv.appendChild(folderContent);
        for (const file of dirFiles) {
          folderContent.appendChild(this.createFileItem(file));
        }
        container.appendChild(folderDiv);
      } else {
        for (const file of dirFiles) {
          container.appendChild(this.createFileItem(file));
        }
      }
    }
    return container;
  }
  createFileItem(file) {
    const fileDiv = document.createElement("div");
    fileDiv.className = "nav-file";
    const fileTitle = document.createElement("div");
    fileTitle.className = "nav-file-title";
    const extension = file.extension.toLowerCase();
    let iconName = "file";
    if (["md", "txt", "markdown"].includes(extension)) {
      iconName = "file-text";
    } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
      iconName = "image";
    } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
      iconName = "audio-lines";
    } else if (["pdf"].includes(extension)) {
      iconName = "file-text";
    }
    (0, import_obsidian28.setIcon)(fileTitle, iconName);
    fileTitle.createSpan({ text: file.name });
    const sizeSpan = document.createElement("span");
    sizeSpan.className = "nav-file-size";
    sizeSpan.textContent = this.calculateSize([file]);
    fileTitle.appendChild(sizeSpan);
    fileDiv.appendChild(fileTitle);
    return fileDiv;
  }
  async showConfirmationDialog(files, type, directory, button) {
    const confirmModal = new import_obsidian28.Modal(this.app);
    confirmModal.titleEl.setText(`Clear ${type}`);
    const content = confirmModal.contentEl;
    content.createDiv({
      cls: "systemsculpt-modal-description",
      text: `\u26A0\uFE0F WARNING: The following files will be moved to the Obsidian trash. You can restore them from the trash if needed.`
    });
    content.appendChild(this.showFilePreview(files, type));
    const buttonContainer = content.createDiv({
      cls: "systemsculpt-modal-buttons"
    });
    const cancelButton = buttonContainer.createEl("button", { text: "Cancel" });
    cancelButton.addEventListener("click", () => confirmModal.close());
    const confirmButton = buttonContainer.createEl("button", {
      cls: "mod-warning",
      text: "Move to Trash"
    });
    confirmButton.addEventListener("click", async () => {
      try {
        await this.cleanDirectory(directory);
        this.disableButton(button);
        button.setText(`No ${type}`);
        showPopup(this.app, `Successfully moved ${files.length} ${type.toLowerCase()} files (${this.calculateSize(files)}) to trash`, { title: "Success" });
      } catch (error) {
        console.error(`Error clearing ${type.toLowerCase()}:`, error);
        showPopup(this.app, `Failed to clear ${type.toLowerCase()}`, {
          title: "Error"
        });
      }
      confirmModal.close();
    });
    confirmModal.open();
  }
  async isEmptyFile(file) {
    if (file.stat.size === 0)
      return true;
    const extension = file.extension.toLowerCase();
    if (["md", "txt", "markdown"].includes(extension)) {
      const content = await this.app.vault.read(file);
      const contentWithoutFrontmatter = content.replace(/^---[\s\S]*?---/, "").trim();
      return !contentWithoutFrontmatter;
    }
    if ([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp",
      "svg",
      "mp3",
      "wav",
      "ogg",
      "m4a"
    ].includes(extension)) {
      return file.stat.size === 0;
    }
    if (file.path.includes("/Extractions/")) {
      const content = await this.app.vault.read(file);
      const hasOnlyHeaders = !content.replace(/^#.*$/gm, "").trim();
      const hasErrorMessage = content.includes("Error extracting") || content.includes("Processing failed");
      return hasOnlyHeaders || hasErrorMessage;
    }
    return false;
  }
  async getEmptyFiles() {
    const allFiles = this.app.vault.getFiles();
    const emptyFiles = [];
    for (const file of allFiles) {
      if (await this.isEmptyFile(file)) {
        emptyFiles.push(file);
      }
    }
    return emptyFiles;
  }
  async getEmptyFolders() {
    const emptyFolders = [];
    const checkFolder = (folder) => {
      const hasNonEmptyChildren = folder.children.some((child) => {
        if (child instanceof import_obsidian28.TFile) {
          return child.stat.size > 0;
        }
        if (child instanceof import_obsidian28.TFolder) {
          return !checkFolder(child);
        }
        return false;
      });
      if (!hasNonEmptyChildren) {
        emptyFolders.push(folder);
        return true;
      }
      return false;
    };
    const rootFolder = this.app.vault.getRoot();
    for (const child of rootFolder.children) {
      if (child instanceof import_obsidian28.TFolder) {
        checkFolder(child);
      }
    }
    return emptyFolders;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-janitor-modal");
    const titleEl = contentEl.createDiv({ cls: "systemsculpt-modal-title" });
    titleEl.setText("SystemSculpt Janitor");
    const descriptionEl = titleEl.createDiv({
      cls: "systemsculpt-modal-description"
    });
    descriptionEl.setText("Clean up and optimize your SystemSculpt workspace");
    const mainContent = contentEl.createDiv({
      cls: "systemsculpt-janitor-content"
    });
    const sectionsContainer = mainContent.createDiv({
      cls: "systemsculpt-sections-container"
    });
    this.createEmptyContentSection(sectionsContainer);
    this.createChatHistorySection(sectionsContainer);
    this.createExtractionsSection(sectionsContainer);
    this.createRecordingsSection(sectionsContainer);
  }
  async createEmptyContentSection(container) {
    const emptySection = this.createSection(container, "Empty Content", "Clean up empty files and folders");
    const emptyFiles = await this.getEmptyFiles();
    const emptyFolders = await this.getEmptyFolders();
    const totalEmpty = emptyFiles.length + emptyFolders.length;
    const clearEmptyButton = emptySection.createEl("button", {
      cls: "systemsculpt-button",
      text: totalEmpty > 0 ? `Clear Empty Content (${totalEmpty} items)` : "No Empty Content"
    });
    this.updateButtonState(clearEmptyButton, emptyFiles, "Empty Content");
    if (totalEmpty > 0) {
      clearEmptyButton.addEventListener("click", async () => {
        if (clearEmptyButton.disabled)
          return;
        const confirmModal = new import_obsidian28.Modal(this.app);
        confirmModal.titleEl.setText("Clear Empty Content");
        const content = confirmModal.contentEl;
        content.createDiv({
          cls: "systemsculpt-modal-description",
          text: `\u26A0\uFE0F WARNING: The following empty items will be moved to the Obsidian trash. You can restore them from the trash if needed.`
        });
        if (emptyFiles.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Files"
          });
          content.appendChild(this.showFilePreview(emptyFiles, "Empty Files"));
        }
        if (emptyFolders.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Folders"
          });
          const folderList = content.createDiv({
            cls: "systemsculpt-file-tree nav-folder"
          });
          for (const folder of emptyFolders) {
            const folderItem = folderList.createDiv({
              cls: "nav-folder-title"
            });
            (0, import_obsidian28.setIcon)(folderItem, "folder");
            folderItem.createSpan({ text: folder.path });
          }
        }
        const buttonContainer = content.createDiv({
          cls: "systemsculpt-modal-buttons"
        });
        const cancelButton = buttonContainer.createEl("button", {
          text: "Cancel"
        });
        cancelButton.addEventListener("click", () => confirmModal.close());
        const confirmButton = buttonContainer.createEl("button", {
          cls: "mod-warning",
          text: "Move to Trash"
        });
        confirmButton.addEventListener("click", async () => {
          try {
            for (const file of emptyFiles) {
              await this.app.vault.trash(file, true);
            }
            const sortedFolders = emptyFolders.sort((a, b) => b.path.length - a.path.length);
            for (const folder of sortedFolders) {
              await this.app.vault.trash(folder, true);
            }
            this.disableButton(clearEmptyButton);
            clearEmptyButton.setText("No Empty Content");
            showPopup(this.app, `Successfully moved ${totalEmpty} empty items to trash`, { title: "Success" });
          } catch (error) {
            console.error("Error clearing empty content:", error);
            showPopup(this.app, "Failed to clear empty content", {
              title: "Error"
            });
          }
          confirmModal.close();
        });
        confirmModal.open();
      });
    }
  }
  createChatHistorySection(container) {
    const historySection = this.createSection(container, "Chat History", "Delete all chat history and conversations permanently");
    const chatFiles = this.getFilesInDirectory(this.plugin.settings.chatsDirectory);
    const chatSize = this.calculateSize(chatFiles);
    const hasChatFiles = chatFiles.length > 0;
    const clearHistoryButton = historySection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasChatFiles ? `Clear All Chat History (${chatSize})` : "No Chat History"
    });
    this.updateButtonState(clearHistoryButton, chatFiles, "Chat History");
    if (hasChatFiles) {
      clearHistoryButton.addEventListener("click", async () => {
        if (clearHistoryButton.disabled)
          return;
        await this.showConfirmationDialog(chatFiles, "Chat History", this.plugin.settings.chatsDirectory, clearHistoryButton);
      });
    }
  }
  createExtractionsSection(container) {
    const extractionsSection = this.createSection(container, "Document Extractions", "Delete all extracted document content (PDFs, documents, etc.)");
    const extractionFiles = this.getFilesInDirectory(this.plugin.settings.extractionsDirectory);
    const extractionsSize = this.calculateSize(extractionFiles);
    const hasExtractionFiles = extractionFiles.length > 0;
    const clearExtractionsButton = extractionsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasExtractionFiles ? `Clear All Extractions (${extractionsSize})` : "No Extractions"
    });
    this.updateButtonState(clearExtractionsButton, extractionFiles, "Extractions");
    if (hasExtractionFiles) {
      clearExtractionsButton.addEventListener("click", async () => {
        if (clearExtractionsButton.disabled)
          return;
        await this.showConfirmationDialog(extractionFiles, "Extractions", this.plugin.settings.extractionsDirectory, clearExtractionsButton);
      });
    }
  }
  createRecordingsSection(container) {
    const recordingsSection = this.createSection(container, "Audio Recordings", "Delete all audio recordings (this won't affect transcriptions)");
    const recordingFiles = this.getFilesInDirectory(this.plugin.settings.recordingsDirectory);
    const recordingsSize = this.calculateSize(recordingFiles);
    const hasRecordingFiles = recordingFiles.length > 0;
    const clearRecordingsButton = recordingsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasRecordingFiles ? `Clear All Recordings (${recordingsSize})` : "No Recordings"
    });
    this.updateButtonState(clearRecordingsButton, recordingFiles, "Recordings");
    if (hasRecordingFiles) {
      clearRecordingsButton.addEventListener("click", async () => {
        if (clearRecordingsButton.disabled)
          return;
        await this.showConfirmationDialog(recordingFiles, "Recordings", this.plugin.settings.recordingsDirectory, clearRecordingsButton);
      });
    }
  }
  createSection(container, title, description) {
    const section = container.createDiv({
      cls: "systemsculpt-janitor-section"
    });
    const header = section.createDiv({ cls: "systemsculpt-section-header" });
    header.setText(title);
    const desc = section.createDiv({ cls: "systemsculpt-section-description" });
    desc.setText(description);
    return section;
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/core/plugin/ribbons.ts
var RibbonManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  initialize() {
    this.registerRibbonIcons();
  }
  registerRibbonIcons() {
    this.plugin.addRibbonIcon("message-square", "Open SystemSculpt Chat", async () => {
      await this.openChatView();
    });
    this.plugin.addRibbonIcon("history", "Open SystemSculpt Chat History", () => {
      this.openChatHistoryModal();
    });
    this.plugin.addRibbonIcon("trash", "Open SystemSculpt Janitor", () => {
      this.openJanitorModal();
    });
  }
  async openChatView() {
    const { workspace } = this.app;
    const leaf = workspace.getLeaf("tab");
    const view = new ChatView(leaf, this.plugin);
    await leaf.open(view);
    workspace.setActiveLeaf(leaf, { focus: true });
  }
  openChatHistoryModal() {
    const modal = new LoadChatModal(this.app, async (chatId) => {
      const leaf = this.app.workspace.getLeaf("tab");
      const view = new ChatView(leaf, this.plugin);
      await leaf.open(view);
      await view.loadChatById(chatId);
      this.app.workspace.setActiveLeaf(leaf, { focus: true });
    }, this.plugin);
    modal.open();
  }
  openJanitorModal() {
    new JanitorModal(this.app, this.plugin).open();
  }
};

// src/core/plugin/views.ts
var ViewManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  initialize() {
    this.registerView();
    this.ribbonManager.initialize();
    this.app.workspace.onLayoutReady(() => {
      this.restoreChatViews();
    });
  }
  async restoreChatViews() {
    const leaves = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (leaves.length === 0)
      return;
    for (const leaf of leaves) {
      const view = leaf.view;
      const state = leaf.getViewState();
      if (state && state.state && state.state.chatId) {
        await view.setState(state.state);
      }
    }
  }
  registerView() {
    this.plugin.registerView(CHAT_VIEW_TYPE, (leaf) => new ChatView(leaf, this.plugin));
  }
  unloadViews() {
    this.app.workspace.detachLeavesOfType(CHAT_VIEW_TYPE);
  }
};

// src/core/plugin/commands.ts
init_ui();
var CommandManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  registerCommands() {
    this.plugin.addCommand({
      id: "open-tasks-file",
      name: "Open Tasks File",
      callback: async () => {
        await this.plugin.tasksService.openOrCreateTasksFile();
      },
      hotkeys: [
        {
          modifiers: ["Mod"],
          key: "t"
        }
      ]
    });
    this.plugin.addCommand({
      id: "toggle-audio-recorder",
      name: "Toggle Audio Recorder",
      callback: () => {
        this.plugin.getRecorderService().toggleRecording();
      },
      hotkeys: [
        {
          modifiers: ["Mod"],
          key: "r"
        }
      ]
    });
    this.plugin.addCommand({
      id: "open-systemsculpt-chat",
      name: "Open SystemSculpt Chat",
      callback: async () => {
        await this.ribbonManager.openChatView();
      }
    });
    this.plugin.addCommand({
      id: "open-chat-history",
      name: "Open SystemSculpt Chat History",
      callback: () => {
        this.ribbonManager.openChatHistoryModal();
      }
    });
    this.plugin.addCommand({
      id: "open-systemsculpt-janitor",
      name: "Open SystemSculpt Janitor",
      callback: () => {
        this.ribbonManager.openJanitorModal();
      }
    });
    this.plugin.addCommand({
      id: "reload-obsidian",
      name: "Reload Obsidian",
      callback: () => {
        window.location.reload();
      }
    });
    this.plugin.addCommand({
      id: "open-systemsculpt-settings",
      name: "Open SystemSculpt AI Settings",
      callback: () => {
        this.app.setting.open();
        this.app.setting.openTabById(this.plugin.manifest.id);
      }
    });
    this.plugin.addCommand({
      id: "change-chat-model",
      name: "Change Chat Model",
      checkCallback: (checking) => {
        const chatView = this.app.workspace.getActiveViewOfType(ChatView);
        if (!chatView) {
          if (!checking) {
            showEnhancedNotice("You need to be within a SystemSculpt chatview to change the model.", "warning");
          }
          return false;
        }
        if (!checking) {
          void (async () => {
            try {
              const models = await this.plugin.modelService.getModels();
              const modal = new ModelSelectionModal(this.app, chatView.getSelectedModelId(), async (modelId) => {
                await chatView.setSelectedModelId(modelId);
                showEnhancedNotice("Model changed successfully", "info");
              }, this.plugin);
              modal.open();
            } catch (err) {
              console.error("Failed to open model selection:", err);
              showEnhancedNotice("Failed to fetch available models", "error");
            }
          })();
        }
        return true;
      }
    });
    this.plugin.addCommand({
      id: "chat-with-file",
      name: "Chat with File",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (!activeFile)
          return false;
        const extension = activeFile.extension.toLowerCase();
        const supportedExtensions = [
          "md",
          "txt",
          "markdown",
          "pdf",
          "doc",
          "docx",
          "ppt",
          "pptx",
          "xls",
          "xlsx",
          "mp3",
          "wav",
          "m4a",
          "ogg",
          "webm",
          "jpg",
          "jpeg",
          "png",
          "gif",
          "webp",
          "svg"
        ];
        if (!supportedExtensions.includes(extension))
          return false;
        if (!checking) {
          const leaf = this.app.workspace.getLeaf("tab");
          const view = new ChatView(leaf, this.plugin);
          leaf.open(view).then(async () => {
            await new Promise((resolve) => setTimeout(resolve, 50));
            this.app.workspace.setActiveLeaf(leaf, { focus: true });
            await view.addFileToContext(activeFile);
            view.focusInput();
          });
        }
        return true;
      }
    });
  }
};

// src/services/CustomProviderService.ts
var _CustomProviderService = class {
  constructor(plugin) {
    this.CACHE_DURATION = 30 * 60 * 1e3;
    this.plugin = plugin;
    this.logger = console;
  }
  async testConnection(provider) {
    const cached = _CustomProviderService.connectionTestCache.get(provider.id);
    if (cached && Date.now() - cached.result.timestamp < this.CACHE_DURATION) {
      return cached.result;
    }
    const existingPromise = _CustomProviderService.connectionTestPromises.get(provider.id);
    if (existingPromise) {
      return existingPromise;
    }
    const testPromise = this.performConnectionTest(provider);
    _CustomProviderService.connectionTestPromises.set(provider.id, testPromise);
    try {
      const result = await testPromise;
      if (result.success) {
        _CustomProviderService.connectionTestCache.set(provider.id, {
          result,
          timestamp: Date.now()
        });
      }
      return result;
    } finally {
      _CustomProviderService.connectionTestPromises.delete(provider.id);
    }
  }
  async performConnectionTest(provider) {
    try {
      const models = await this.getModels(provider);
      if (provider.endpoint.includes("openrouter.ai")) {
        await this.validateOpenRouterKey(provider, models);
      }
      return {
        success: true,
        models,
        timestamp: Date.now()
      };
    } catch (error) {
      this.logger.error("Connection test failed:", error);
      return {
        success: false,
        error: this.getErrorMessage(error),
        timestamp: Date.now()
      };
    }
  }
  async validateOpenRouterKey(provider, modelIds) {
    var _a;
    const headers = {
      "Content-Type": "application/json",
      Authorization: `Bearer ${provider.apiKey}`,
      "HTTP-Referer": "https://systemsculpt.com",
      "X-Title": "SystemSculpt AI"
    };
    const completionResponse = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers,
      body: JSON.stringify({
        model: "meta-llama/llama-3-8b-instruct:free",
        messages: [{ role: "user", content: "Hi" }],
        max_tokens: 1
      }),
      signal: AbortSignal.timeout(1e4)
    });
    if (!completionResponse.ok) {
      const errorData = await completionResponse.json().catch(() => ({}));
      if (completionResponse.status === 401) {
        throw new Error("Invalid API key. Please check your OpenRouter API key and try again.");
      } else if (completionResponse.status === 402) {
        throw new Error("Insufficient credits. Please add credits to your OpenRouter account.");
      } else if (completionResponse.status === 429) {
        throw new Error("Rate limit exceeded. Please try again in a few minutes.");
      }
      throw new Error(`API key validation failed: ${((_a = errorData.error) == null ? void 0 : _a.message) || completionResponse.statusText}`);
    }
  }
  async getModels(provider) {
    var _a, _b;
    const headers = {
      "Content-Type": "application/json"
    };
    if (provider.apiKey) {
      if (provider.endpoint.includes("openrouter.ai")) {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
        headers["HTTP-Referer"] = "https://systemsculpt.com";
        headers["X-Title"] = "SystemSculpt AI";
      } else {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
      }
    }
    let endpoint;
    if (provider.endpoint.includes("openrouter.ai")) {
      endpoint = "https://openrouter.ai/api/v1/models";
    } else {
      const baseUrl = provider.endpoint.replace(/\/+$/, "");
      endpoint = baseUrl.endsWith("/v1") ? `${baseUrl}/models` : baseUrl.endsWith("/v1/models") ? baseUrl : `${baseUrl}/v1/models`;
    }
    const response = await fetch(endpoint, {
      method: "GET",
      headers,
      signal: AbortSignal.timeout(1e4)
    });
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      if (response.status === 401) {
        throw new Error("Invalid API key. Please check your API key and try again.");
      } else if (response.status === 403) {
        throw new Error("Access denied. Please verify your API key has the correct permissions.");
      } else if (response.status === 404) {
        throw new Error("API endpoint not found. Please check the URL and try again.");
      }
      throw new Error(`HTTP error: ${((_a = errorData.error) == null ? void 0 : _a.message) || response.statusText}`);
    }
    const data = await response.json();
    return (((_b = data.data) == null ? void 0 : _b.map((model) => model.id)) || []).filter((id) => !id.toLowerCase().includes("whisper"));
  }
  getErrorMessage(error) {
    if (error instanceof Error) {
      if (error.name === "AbortError") {
        return "Connection timed out. Please check your internet connection and try again.";
      }
      return error.message;
    }
    return "An unexpected error occurred. Please try again or contact support if the issue persists.";
  }
};
var CustomProviderService = _CustomProviderService;
CustomProviderService.connectionTestCache = new Map();
CustomProviderService.connectionTestPromises = new Map();

// src/main.ts
init_SystemPromptService();

// src/services/TasksService.ts
var import_obsidian29 = __toModule(require("obsidian"));
var TasksService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.app = plugin.app;
    this.settings = plugin.settings;
    this.lastTaskFileReorder = 0;
    this.reorderDebounce = 0;
    this.registerTasksFileWatcher();
  }
  async openOrCreateTasksFile() {
    const tasksDir = this.settings.tasksDirectory;
    const fileName = `${tasksDir}/Tasks.md`;
    try {
      await this.app.vault.adapter.mkdir(tasksDir);
      if (!await this.app.vault.adapter.exists(fileName)) {
        await this.app.vault.create(fileName, `# Tasks

- [ ] Sample task
`);
      }
      const file = this.app.vault.getAbstractFileByPath(fileName);
      if (file instanceof import_obsidian29.TFile) {
        const existingLeaf = this.app.workspace.getLeavesOfType("markdown").find((leaf) => leaf.view.getState().file === file.path);
        if (existingLeaf) {
          this.app.workspace.setActiveLeaf(existingLeaf, { focus: true });
        } else {
          await this.app.workspace.getLeaf().openFile(file);
        }
      }
    } catch (error) {
      console.error("Failed to handle tasks file:", error);
      throw error;
    }
  }
  registerTasksFileWatcher() {
    this.plugin.registerEvent(this.app.vault.on("modify", async (file) => {
      const tasksDir = this.settings.tasksDirectory;
      if (file.path.startsWith(tasksDir) && file.path.endsWith(".md")) {
        await this.reorderCompletedTasks(file);
      }
    }));
  }
  async reorderCompletedTasks(file) {
    if (!this.settings.moveCompletedTasksDown) {
      return;
    }
    if (!file.path.startsWith(this.settings.tasksDirectory)) {
      return;
    }
    if (!file.path.endsWith(".md")) {
      return;
    }
    const original = await this.app.vault.read(file);
    const reordered = this.reorderContent(original);
    if (reordered !== original) {
      await this.app.vault.modify(file, reordered);
    }
  }
  reorderContent(content) {
    const lines = content.split("\n");
    const output = [];
    let listBuffer = [];
    const flushBuffer = () => {
      if (listBuffer.length > 0) {
        output.push(...this.reorderListBlock(listBuffer));
        listBuffer = [];
      }
    };
    for (const line of lines) {
      if (/^\s*-\s*\[[x\s]\]/.test(line)) {
        listBuffer.push(line);
      } else {
        flushBuffer();
        output.push(line);
      }
    }
    flushBuffer();
    return output.join("\n");
  }
  reorderListBlock(lines) {
    function getIndent(line) {
      const match = line.match(/^(\s*)/);
      return match ? match[1].length : 0;
    }
    const nodes = [];
    const stack = [];
    for (const line of lines) {
      const indent = getIndent(line);
      const node = { line, children: [], indent };
      while (stack.length > 0 && indent <= stack[stack.length - 1].indent) {
        stack.pop();
      }
      if (stack.length === 0) {
        nodes.push(node);
        stack.push(node);
      } else {
        stack[stack.length - 1].children.push(node);
        stack.push(node);
      }
    }
    function reorderNodes(nodes2) {
      for (const node of nodes2) {
        if (node.children.length > 0) {
          node.children = reorderNodes(node.children);
          node.children.sort((a, b) => {
            const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
            const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
            return aComplete - bComplete;
          });
        }
      }
      nodes2.sort((a, b) => {
        const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
        const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
        return aComplete - bComplete;
      });
      return nodes2;
    }
    const reorderedNodes = reorderNodes(nodes);
    const flattened = [];
    function flatten(nodes2) {
      for (const node of nodes2) {
        flattened.push(node.line);
        if (node.children.length > 0) {
          flatten(node.children);
        }
      }
    }
    flatten(reorderedNodes);
    return flattened;
  }
};

// src/services/ModelService.ts
var ModelService = class {
  constructor(plugin, customProviderService) {
    this.modelCache = null;
    this.lastCacheTime = 0;
    this.CACHE_DURATION = 30 * 60 * 1e3;
    this.loadingPromise = null;
    this.plugin = plugin;
    this.customProviderService = customProviderService;
  }
  static getInstance(plugin, customProviderService) {
    if (!ModelService.instance) {
      ModelService.instance = new ModelService(plugin, customProviderService);
    }
    return ModelService.instance;
  }
  async getModels() {
    if (this.modelCache && Date.now() - this.lastCacheTime < this.CACHE_DURATION) {
      return this.modelCache;
    }
    if (this.loadingPromise) {
      return this.loadingPromise;
    }
    this.loadingPromise = this.loadModels();
    try {
      const models = await this.loadingPromise;
      return models;
    } finally {
      this.loadingPromise = null;
    }
  }
  async loadModels() {
    try {
      const systemModels = await this.plugin.aiService.getModels();
      const customModels = await this.loadCustomProviderModels();
      const allModels = [...systemModels, ...customModels];
      const favoriteModels = this.plugin.settings.favoriteModels || [];
      for (const model of allModels) {
        model.isFavorite = favoriteModels.some((fav) => fav.modelId === model.id && fav.provider === model.provider);
      }
      this.modelCache = allModels;
      this.lastCacheTime = Date.now();
      return allModels;
    } catch (error) {
      console.error("Failed to load models:", error);
      return this.modelCache || [];
    }
  }
  async loadCustomProviderModels() {
    const { customProviders } = this.plugin.settings;
    const fetches = customProviders.filter((p) => p.isEnabled).map(async (p) => {
      try {
        const result = await this.customProviderService.testConnection(p);
        if (result.success && result.models) {
          return this.createCustomModels(p, result.models);
        }
      } catch (error) {
        console.error(`Failed to load models from ${p.name}:`, error);
      }
      return [];
    });
    const results = await Promise.all(fetches);
    return results.flat();
  }
  createCustomModels(provider, modelIds) {
    return modelIds.map((modelId) => ({
      id: modelId,
      name: modelId,
      provider: provider.name.toLowerCase(),
      isFavorite: false,
      context_length: 0,
      capabilities: [],
      pricing: {
        prompt: "0",
        completion: "0",
        image: "0",
        request: "0"
      },
      architecture: {
        modality: "text->text",
        tokenizer: "",
        instruct_type: null
      },
      description: `${provider.name} model`,
      identifier: {
        providerId: provider.name.toLowerCase(),
        modelId,
        displayName: modelId
      }
    }));
  }
  async toggleFavorite(model) {
    const isNowFavorite = !model.isFavorite;
    model.isFavorite = isNowFavorite;
    if (isNowFavorite) {
      this.plugin.settings.favoriteModels.push({
        provider: model.provider,
        modelId: model.id
      });
    } else {
      this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((fav) => !(fav.modelId === model.id && fav.provider === model.provider));
    }
    await this.plugin.saveSettings();
  }
};

// src/main.ts
var SystemSculptPlugin = class extends import_obsidian30.Plugin {
  constructor() {
    super(...arguments);
    this.initialValidationDone = false;
  }
  async onload() {
    this.settingsManager = new SettingsManager(this);
    await this.settingsManager.loadSettings();
    this.settings = this.settingsManager.getSettings();
    this.registerExtensions(["srt"], "markdown");
    this.customProviderService = new CustomProviderService(this);
    this.modelService = ModelService.getInstance(this, this.customProviderService);
    this.aiService = SystemSculptService.getInstance(this.settings, this.app);
    this.transcriptionService = TranscriptionService.getInstance(this);
    this.recorderService = RecorderService.getInstance(this.app, this);
    this.contextMenu = new SystemSculptContextMenu(this.app, this.aiService, this);
    SystemPromptService.setSystemSculptService(this.aiService);
    this.initialModels = this.modelService.getModels();
    this.settingsTab = new SystemSculptSettingTab(this.app, this);
    this.addSettingTab(this.settingsTab);
    this.licenseManager = new LicenseManager(this, this.app);
    this.tasksService = new TasksService(this);
    this.viewManager = new ViewManager(this, this.app);
    this.commandManager = new CommandManager(this, this.app);
    this.viewManager.initialize();
    this.commandManager.registerCommands();
    SystemPromptService.initializeCache().catch((error) => {
      console.error("Failed to initialize system prompts cache:", error);
    });
    try {
      await this.initialModels;
    } catch (error) {
      console.error("Failed to load initial models:", error);
    }
  }
  async onunload() {
    console.log("SystemSculpt AI plugin unloaded");
    this.recorderService.unload();
    this.transcriptionService.unload();
    this.viewManager.unloadViews();
  }
  async loadData() {
    return super.loadData();
  }
  async saveData(data) {
    return super.saveData(data);
  }
  async saveSettings() {
    await this.settingsManager.saveSettings();
  }
  getRecorderService() {
    return this.recorderService;
  }
  getTranscriptionService() {
    return this.transcriptionService;
  }
  getLicenseManager() {
    return this.licenseManager;
  }
  getSettingsManager() {
    return this.settingsManager;
  }
  getInitialModels() {
    return this.initialModels;
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2UudHMiLCAic3JjL3V0aWxzL2Vycm9ycy50cyIsICJzcmMvdXRpbHMvSW1hZ2VQcm9jZXNzb3IudHMiLCAic3JjL2NvbnN0YW50cy9hcGkudHMiLCAic3JjL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2UudHMiLCAic3JjL2NvcmUvdWkvY29tcG9uZW50cy9Mb2FkaW5nSW5kaWNhdG9yLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvQnV0dG9uLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9UZXh0QXJlYU1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9Qb3B1cE1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvTm90aWNlLnRzIiwgInNyYy9jb3JlL3VpL2luZGV4LnRzIiwgInNyYy9jb21wb25lbnRzL0ZpbGVTdWdnZXN0ZXIudHMiLCAic3JjL21vZGFscy9Qb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsLnRzIiwgInNyYy9tYWluLnRzIiwgInNyYy9tb2RhbHMvU2V0dGluZ3NUYWIudHMiLCAic3JjL3R5cGVzL2xsbS50cyIsICJzcmMvdHlwZXMudHMiLCAic3JjL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlLnRzIiwgInNyYy9tb2RhbHMvTW9kZWxTZWxlY3Rpb25IZWxwZXIudHMiLCAic3JjL21vZGFscy9DdXN0b21Qcm92aWRlck1vZGFsLnRzIiwgInNyYy9jb21wb25lbnRzL0ZvbGRlclN1Z2dlc3Rlci50cyIsICJzcmMvbW9kYWxzL1N5c3RlbVByb21wdE1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2UudHMiLCAic3JjL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbC50cyIsICJzcmMvc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1Bvc3RQcm9jZXNzaW5nU2VydmljZS50cyIsICJzcmMvdmlld3MvQ2hhdFZpZXcudHMiLCAic3JjL3NlcnZpY2VzL0NoYXRTdG9yYWdlU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2UudHMiLCAic3JjL3ZpZXdzL2NvbXBvbmVudHMvRHJhd2VyQ29tcG9uZW50LnRzIiwgInNyYy92aWV3cy9jb21wb25lbnRzL01lc3NhZ2VSZW5kZXJlci50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9JbnB1dEhhbmRsZXIudHMiLCAic3JjL3NlcnZpY2VzL1Rva2VuQ291bnRlclNlcnZpY2UudHMiLCAic3JjL3ZpZXdzL2NvbXBvbmVudHMvRmlsZUNvbnRleHRNYW5hZ2VyLnRzIiwgInNyYy9tb2RhbHMvQ29udGV4dFNlbGVjdGlvbk1vZGFsLnRzIiwgInNyYy9tb2RhbHMvTG9hZENoYXRNb2RhbC50cyIsICJzcmMvY29tcG9uZW50cy9TeXN0ZW1TY3VscHRDb250ZXh0TWVudS50cyIsICJzcmMvbW9kYWxzL1RleHRNb2RpZmljYXRpb25Nb2RhbC50cyIsICJzcmMvY29yZS9zZXR0aW5ncy9TZXR0aW5nc01hbmFnZXIudHMiLCAic3JjL2NvcmUvbGljZW5zZS9MaWNlbnNlTWFuYWdlci50cyIsICJzcmMvbW9kYWxzL0phbml0b3JNb2RhbC50cyIsICJzcmMvY29yZS9wbHVnaW4vcmliYm9ucy50cyIsICJzcmMvY29yZS9wbHVnaW4vdmlld3MudHMiLCAic3JjL2NvcmUvcGx1Z2luL2NvbW1hbmRzLnRzIiwgInNyYy9zZXJ2aWNlcy9DdXN0b21Qcm92aWRlclNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1Rhc2tzU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvTW9kZWxTZXJ2aWNlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFByZXNldCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcblxuaW50ZXJmYWNlIFN5c3RlbVByb21wdENhY2hlIHtcbiAgcHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBieUlkOiB7IFtrZXk6IHN0cmluZ106IFN5c3RlbVByb21wdFByZXNldCB9O1xufVxuXG5leHBvcnQgY2xhc3MgU3lzdGVtUHJvbXB0U2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGNhY2hlOiBTeXN0ZW1Qcm9tcHRDYWNoZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDQUNIRV9EVVJBVElPTiA9IDYwICogNjAgKiAxMDAwOyAvLyAxIGhvdXIgaW4gbWlsbGlzZWNvbmRzXG4gIHByaXZhdGUgc3RhdGljIGluaXRQcm9taXNlOiBQcm9taXNlPHZvaWQ+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc3RhdGljIGlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc3RhdGljIHN5c3RlbVNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCkge1xuICAgIC8vIFN0YXJ0IGNhY2hlIGluaXRpYWxpemF0aW9uIGlmIG5vdCBhbHJlYWR5IHN0YXJ0ZWRcbiAgICBpZiAoXG4gICAgICAhU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSAmJlxuICAgICAgIVN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsaXppbmdcbiAgICApIHtcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBzZXRTeXN0ZW1TY3VscHRTZXJ2aWNlKHNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UpIHtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UgPSBzZXJ2aWNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgaXNDYWNoZVZhbGlkKCk6IGJvb2xlYW4ge1xuICAgIGlmICghU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgcmV0dXJuIChcbiAgICAgIG5vdyAtIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUudGltZXN0YW1wIDxcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuQ0FDSEVfRFVSQVRJT05cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlQ2FjaGUocHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10pOiB2b2lkIHtcbiAgICBjb25zdCBieUlkOiB7IFtrZXk6IHN0cmluZ106IFN5c3RlbVByb21wdFByZXNldCB9ID0ge307XG4gICAgcHJvbXB0cy5mb3JFYWNoKChwcm9tcHQpID0+IHtcbiAgICAgIGJ5SWRbcHJvbXB0LmlkXSA9IHByb21wdDtcbiAgICB9KTtcblxuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSB7XG4gICAgICBwcm9tcHRzLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgYnlJZCxcbiAgICB9O1xuICB9XG5cbiAgLy8gSW5pdGlhbGl6ZSBjYWNoZSB3aXRob3V0IGJsb2NraW5nXG4gIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZUNhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlKSB7XG4gICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgICB9XG5cbiAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlN5c3RlbVNjdWxwdFNlcnZpY2Ugbm90IGluaXRpYWxpemVkXCIpKTtcbiAgICB9XG5cbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzSW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gZmV0Y2goXG4gICAgICBgJHtTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzYFxuICAgIClcbiAgICAgIC50aGVuKGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UudXBkYXRlQ2FjaGUoZGF0YS5wcm9tcHRzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbml0aWFsaXppbmcgc3lzdGVtIHByb21wdHMgY2FjaGU6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gQ2xlYXIgdGhlIHByb21pc2Ugc28gd2UgY2FuIHJldHJ5IGxhdGVyXG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgPSBudWxsO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0luaXRpYWxpemluZyA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgfVxuXG4gIC8vIEVuc3VyZSBjYWNoZSBpcyBpbml0aWFsaXplZCBiZWZvcmUgcHJvY2VlZGluZ1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZUNhY2hlSW5pdGlhbGl6ZWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkpIHJldHVybjtcblxuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlKSB7XG4gICAgICBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gIH1cblxuICBhc3luYyBnZXRTeXN0ZW1Qcm9tcHRzKCk6IFByb21pc2U8U3lzdGVtUHJvbXB0UHJlc2V0W10+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVDYWNoZUluaXRpYWxpemVkKCk7XG5cbiAgICAgIC8vIFJldHVybiBjYWNoZWQgZGF0YSBpZiB2YWxpZFxuICAgICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkgJiYgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5wcm9tcHRzO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBjYWNoZSBpcyBpbnZhbGlkIG9yIG1pc3NpbmcsIGZldGNoIGZyZXNoIGRhdGFcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke1N5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHNgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UudXBkYXRlQ2FjaGUoZGF0YS5wcm9tcHRzKTtcbiAgICAgIHJldHVybiBkYXRhLnByb21wdHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgLy8gSWYgY2FjaGUgZXhpc3RzIGJ1dCBleHBpcmVkLCByZXR1cm4gaXQgYXMgZmFsbGJhY2tcbiAgICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlKSB7XG4gICAgICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLnByb21wdHM7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTeXN0ZW1Qcm9tcHRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN5c3RlbVByb21wdFByZXNldCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVDYWNoZUluaXRpYWxpemVkKCk7XG5cbiAgICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgICBpZiAoXG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkgJiZcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8uYnlJZFtpZF1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5ieUlkW2lkXTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgY2FjaGUgaXMgbWlzc2luZyBvciBpbnZhbGlkLCBmZXRjaCBhbGwgcHJvbXB0cyB0byByZWZyZXNoIGNhY2hlXG4gICAgICBhd2FpdCB0aGlzLmdldFN5c3RlbVByb21wdHMoKTtcblxuICAgICAgLy8gUmV0dXJuIGZyb20gcmVmcmVzaGVkIGNhY2hlXG4gICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8uYnlJZFtpZF0gfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCAke2lkfTpgLCBlcnJvcik7XG4gICAgICAvLyBGYWxsYmFjayB0byBjYWNoZSBldmVuIGlmIGV4cGlyZWRcbiAgICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlPy5ieUlkW2lkXSkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5ieUlkW2lkXTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFN5c3RlbVByb21wdFRlbXBsYXRlKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke1N5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHMvdGVtcGxhdGVgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBkYXRhLnRlbXBsYXRlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gRm9yY2UgcmVmcmVzaCB0aGUgY2FjaGVcbiAgYXN5bmMgcmVmcmVzaENhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSBudWxsO1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgPSBudWxsO1xuICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gIH1cblxuICAvLyBDbGVhciB0aGUgY2FjaGVcbiAgc3RhdGljIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSA9IG51bGw7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSA9IG51bGw7XG4gIH1cbn1cbiIsICJleHBvcnQgY29uc3QgRVJST1JfQ09ERVMgPSB7XG4gIC8vIEF1dGhlbnRpY2F0aW9uIEVycm9yc1xuICBJTlZBTElEX0xJQ0VOU0U6IFwiSU5WQUxJRF9MSUNFTlNFXCIsXG4gIExJQ0VOU0VfRVhQSVJFRDogXCJMSUNFTlNFX0VYUElSRURcIixcbiAgTElDRU5TRV9ESVNBQkxFRDogXCJMSUNFTlNFX0RJU0FCTEVEXCIsXG4gIFBST19SRVFVSVJFRDogXCJQUk9fUkVRVUlSRURcIixcblxuICAvLyBNb2RlbCBFcnJvcnNcbiAgTU9ERUxfVU5BVkFJTEFCTEU6IFwiTU9ERUxfVU5BVkFJTEFCTEVcIixcbiAgTU9ERUxfUkVRVUVTVF9FUlJPUjogXCJNT0RFTF9SRVFVRVNUX0VSUk9SXCIsXG5cbiAgLy8gU3RyZWFtIEVycm9yc1xuICBTVFJFQU1fRVJST1I6IFwiU1RSRUFNX0VSUk9SXCIsXG4gIElOVkFMSURfUkVTUE9OU0U6IFwiSU5WQUxJRF9SRVNQT05TRVwiLFxuICBOT19JTUFHRTogXCJOT19JTUFHRVwiLFxuXG4gIC8vIEZpbGUgUHJvY2Vzc2luZyBFcnJvcnNcbiAgRklMRV9OT1RfRk9VTkQ6IFwiRklMRV9OT1RfRk9VTkRcIixcbiAgRklMRV9UT09fTEFSR0U6IFwiRklMRV9UT09fTEFSR0VcIixcbiAgVU5TVVBQT1JURURfRk9STUFUOiBcIlVOU1VQUE9SVEVEX0ZPUk1BVFwiLFxuICBQUk9DRVNTSU5HX0VSUk9SOiBcIlBST0NFU1NJTkdfRVJST1JcIixcblxuICAvLyBHZW5lcmljIEVycm9yc1xuICBVTktOT1dOX0VSUk9SOiBcIlVOS05PV05fRVJST1JcIixcbiAgUVVPVEFfRVhDRUVERUQ6IFwiUVVPVEFfRVhDRUVERURcIixcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIEVycm9yQ29kZSA9ICh0eXBlb2YgRVJST1JfQ09ERVMpW2tleW9mIHR5cGVvZiBFUlJPUl9DT0RFU107XG5cbnR5cGUgRXJyb3JNZXNzYWdlRnVuY3Rpb24gPSAobW9kZWw/OiBzdHJpbmcpID0+IHN0cmluZztcbnR5cGUgRXJyb3JNZXNzYWdlVmFsdWUgPSBzdHJpbmcgfCBFcnJvck1lc3NhZ2VGdW5jdGlvbjtcblxuZXhwb3J0IGNvbnN0IEVSUk9SX01FU1NBR0VTOiBSZWNvcmQ8RXJyb3JDb2RlLCBFcnJvck1lc3NhZ2VWYWx1ZT4gPSB7XG4gIFtFUlJPUl9DT0RFUy5JTlZBTElEX0xJQ0VOU0VdOlxuICAgIFwiSW52YWxpZCBsaWNlbnNlIGtleS4gUGxlYXNlIGNoZWNrIGFuZCB0cnkgYWdhaW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5MSUNFTlNFX0VYUElSRURdOiBcIllvdXIgbGljZW5zZSBoYXMgZXhwaXJlZC5cIixcbiAgW0VSUk9SX0NPREVTLkxJQ0VOU0VfRElTQUJMRURdOiBcIlRoaXMgbGljZW5zZSBoYXMgYmVlbiBkaXNhYmxlZC5cIixcbiAgW0VSUk9SX0NPREVTLlBST19SRVFVSVJFRF06XG4gICAgXCJUaGlzIGZlYXR1cmUgcmVxdWlyZXMgYSBQcm8gc3Vic2NyaXB0aW9uLiBQbGVhc2UgdXBncmFkZS5cIixcbiAgW0VSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFXTogKG1vZGVsPzogc3RyaW5nKSA9PlxuICAgIGBNb2RlbCAke21vZGVsIHx8IFwiXCJ9IGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZS5gLFxuICBbRVJST1JfQ09ERVMuTU9ERUxfUkVRVUVTVF9FUlJPUl06IChtb2RlbD86IHN0cmluZykgPT5cbiAgICBgTW9kZWwgJHttb2RlbCB8fCBcIlwifSBjYW5ub3QgcHJvY2VzcyB0aGlzIHJlcXVlc3QuYCxcbiAgW0VSUk9SX0NPREVTLlNUUkVBTV9FUlJPUl06IFwiU3RyZWFtaW5nIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIixcbiAgW0VSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0VdOlxuICAgIFwiSW52YWxpZCByZXNwb25zZSByZWNlaXZlZCBmcm9tIHNlcnZlci4gUGxlYXNlIHRyeSBhZ2Fpbi5cIixcbiAgW0VSUk9SX0NPREVTLlVOS05PV05fRVJST1JdOlxuICAgIFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQuXCIsXG4gIFtFUlJPUl9DT0RFUy5RVU9UQV9FWENFRURFRF06XG4gICAgXCJZb3UgaGF2ZSBleGNlZWRlZCB5b3VyIHF1b3RhLiBQbGVhc2UgdXBncmFkZSB5b3VyIHBsYW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5OT19JTUFHRV06IFwiTm8gaW1hZ2UgaW4gY2xpcGJvYXJkXCIsXG4gIFtFUlJPUl9DT0RFUy5GSUxFX05PVF9GT1VORF06IFwiRmlsZSBub3QgZm91bmRcIixcbiAgW0VSUk9SX0NPREVTLkZJTEVfVE9PX0xBUkdFXTogXCJGaWxlIHRvbyBsYXJnZSAobWF4IDEwTUIpXCIsXG4gIFtFUlJPUl9DT0RFUy5VTlNVUFBPUlRFRF9GT1JNQVRdOiBcIlVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0XCIsXG4gIFtFUlJPUl9DT0RFUy5QUk9DRVNTSU5HX0VSUk9SXTogXCJGYWlsZWQgdG8gcHJvY2VzcyBmaWxlXCIsXG59O1xuXG5leHBvcnQgY2xhc3MgU3lzdGVtU2N1bHB0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgY29kZTogRXJyb3JDb2RlID0gRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUixcbiAgICBwdWJsaWMgc3RhdHVzQ29kZTogbnVtYmVyID0gNTAwLFxuICAgIHB1YmxpYyBtZXRhZGF0YT86IHtcbiAgICAgIHByb3ZpZGVyPzogc3RyaW5nO1xuICAgICAgbW9kZWw/OiBzdHJpbmc7XG4gICAgICBzaG91bGRSZXN1Ym1pdD86IGJvb2xlYW47XG4gICAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgfVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIlN5c3RlbVNjdWxwdEVycm9yXCI7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShjb2RlOiBFcnJvckNvZGUsIG1vZGVsPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbWVzc2FnZSA9IEVSUk9SX01FU1NBR0VTW2NvZGVdO1xuICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiBtZXNzYWdlKG1vZGVsKTtcbiAgfVxuICByZXR1cm4gbWVzc2FnZTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuL2Vycm9yc1wiO1xuXG5leHBvcnQgY2xhc3MgSW1hZ2VQcm9jZXNzb3Ige1xuICBwcml2YXRlIHN0YXRpYyBNQVhfRklMRV9TSVpFID0gMTAgKiAxMDI0ICogMTAyNDsgXG4gIHByaXZhdGUgc3RhdGljIFNVUFBPUlRFRF9GT1JNQVRTID0gbmV3IFNldChbXG4gICAgXCJqcGdcIixcbiAgICBcImpwZWdcIixcbiAgICBcInBuZ1wiLFxuICAgIFwiZ2lmXCIsXG4gICAgXCJ3ZWJwXCIsXG4gIF0pO1xuXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzSW1hZ2UoZmlsZTogVEZpbGUsIGFwcDogQXBwKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcIkZpbGUgbm90IGZvdW5kXCIsIFwiRklMRV9OT1RfRk9VTkRcIiwgNDA0KTtcbiAgICB9XG5cbiAgICBcbiAgICBpZiAoZmlsZS5zdGF0LnNpemUgPiBJbWFnZVByb2Nlc3Nvci5NQVhfRklMRV9TSVpFKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiSW1hZ2UgdG9vIGxhcmdlIChtYXggMTBNQilcIixcbiAgICAgICAgXCJGSUxFX1RPT19MQVJHRVwiLFxuICAgICAgICA0MTNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgXG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoIUltYWdlUHJvY2Vzc29yLlNVUFBPUlRFRF9GT1JNQVRTLmhhcyhleHRlbnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiVW5zdXBwb3J0ZWQgaW1hZ2UgZm9ybWF0XCIsXG4gICAgICAgIFwiVU5TVVBQT1JURURfRk9STUFUXCIsXG4gICAgICAgIDQxNVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgXG4gICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuXG4gICAgICBcbiAgICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGRhdGFVcmwgPSByZWFkZXIucmVzdWx0IGFzIHN0cmluZztcbiAgICAgICAgICByZXNvbHZlKGRhdGFVcmwpO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChyZWFkZXIuZXJyb3IpO1xuXG4gICAgICAgIFxuICAgICAgICBjb25zdCB0eXBlID0gYGltYWdlLyR7ZXh0ZW5zaW9uID09PSBcImpwZ1wiID8gXCJqcGVnXCIgOiBleHRlbnNpb259YDtcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHsgdHlwZSB9KTtcblxuICAgICAgICBcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGJhc2U2NDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkltYWdlIHByb2Nlc3NpbmcgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiRmFpbGVkIHRvIHByb2Nlc3MgaW1hZ2VcIixcbiAgICAgICAgXCJQUk9DRVNTSU5HX0VSUk9SXCIsXG4gICAgICAgIDUwMFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgcHJvY2Vzc0NsaXBib2FyZEltYWdlKFxuICAgIGNsaXBib2FyZERhdGE6IERhdGFUcmFuc2ZlclxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZpbGUgPSBjbGlwYm9hcmREYXRhLmZpbGVzWzBdO1xuICAgIGlmICghZmlsZSB8fCAhZmlsZS50eXBlLnN0YXJ0c1dpdGgoXCJpbWFnZS9cIikpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcIk5vIGltYWdlIGluIGNsaXBib2FyZFwiLCBcIk5PX0lNQUdFXCIsIDQwMCk7XG4gICAgfVxuXG4gICAgaWYgKGZpbGUuc2l6ZSA+IHRoaXMuTUFYX0ZJTEVfU0laRSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIkltYWdlIHRvbyBsYXJnZSAobWF4IDEwTUIpXCIsXG4gICAgICAgIFwiRklMRV9UT09fTEFSR0VcIixcbiAgICAgICAgNDEzXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCBhcyBzdHJpbmcpO1xuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiByZWplY3QocmVhZGVyLmVycm9yKTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgIH0pO1xuICB9XG59XG4iLCAiLy8gQmFzZSBVUkwgZm9yIEFQSSByZXF1ZXN0c1xuZXhwb3J0IGNvbnN0IEFQSV9CQVNFX1VSTCA9XG4gIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIlxuICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjMwMDEvYXBpL3YxXCJcbiAgICA6IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbS9hcGkvdjFcIjtcblxuZXhwb3J0IGNvbnN0IFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTID0ge1xuICBMSUNFTlNFOiB7XG4gICAgVkFMSURBVEU6IChrZXk6IHN0cmluZykgPT4gYC9hcGkvdjEvbGljZW5zZS92YWxpZGF0ZS8ke2tleX1gLFxuICB9LFxuICBNT0RFTFM6IHtcbiAgICBMSVNUOiBcIi9hcGkvdjEvbW9kZWxzXCIsXG4gICAgR0VUOiAobW9kZWxJZDogc3RyaW5nKSA9PiBgL2FwaS92MS9tb2RlbHMvJHttb2RlbElkfWAsXG4gIH0sXG4gIENIQVQ6IHtcbiAgICBDT01QTEVUSU9OUzogXCIvYXBpL3YxL2NoYXQvY29tcGxldGlvbnNcIixcbiAgfSxcbiAgU1lTVEVNX1BST01QVFM6IHtcbiAgICBHRVQ6IChpZDogc3RyaW5nKSA9PiBgL2FwaS92MS9zeXN0ZW0tcHJvbXB0cy8ke2lkfWAsXG4gICAgTElTVDogXCIvYXBpL3YxL3N5c3RlbS1wcm9tcHRzXCIsXG4gIH0sXG4gIERPQ1VNRU5UUzoge1xuICAgIFBST0NFU1M6IFwiL2FwaS92MS9kb2N1bWVudHMvcHJvY2Vzc1wiLFxuICAgIEdFVDogKGlkOiBzdHJpbmcpID0+IGAvYXBpL3YxL2RvY3VtZW50cy8ke2lkfWAsXG4gICAgRE9XTkxPQUQ6IChpZDogc3RyaW5nKSA9PiBgL2FwaS92MS9kb2N1bWVudHMvJHtpZH0vZG93bmxvYWRgLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IE9QRU5ST1VURVJfQVBJX0VORFBPSU5UUyA9IHtcbiAgQ0hBVDoge1xuICAgIENPTVBMRVRJT046IFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gICAgTU9ERUxTOiBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvbW9kZWxzXCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQVBJX0VORFBPSU5UUyA9IHtcbiAgQ0hBVDoge1xuICAgIENPTVBMRVRJT046IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3YxL2NoYXQvY29tcGxldGlvbnNcIixcbiAgICBNT0RFTFM6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3YxL21vZGVsc1wiLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGludGVyZmFjZSBBcGlFcnJvckRldGFpbHMge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNvZGU6IHN0cmluZztcbiAgc3RhdHVzQ29kZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaVJlc3BvbnNlPFQ+IHtcbiAgc3RhdHVzOiBcInN1Y2Nlc3NcIiB8IFwiZXJyb3JcIjtcbiAgZGF0YTogVCB8IG51bGw7XG4gIGVycm9yPzogQXBpRXJyb3JEZXRhaWxzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExpY2Vuc2VWYWxpZGF0aW9uUmVzcG9uc2Uge1xuICBlbWFpbDogc3RyaW5nO1xuICBjcmVkaXRzX2JhbGFuY2U6IG51bWJlcjtcbiAgc3Vic2NyaXB0aW9uX3N0YXR1czogc3RyaW5nO1xuICBsaWNlbnNlX2tleTogc3RyaW5nO1xuICBpc19wcm86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9rZW5CYWxhbmNlUmVzcG9uc2Uge1xuICBiYWxhbmNlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tvdXRSZXNwb25zZSB7XG4gIGNoZWNrb3V0VXJsOiBzdHJpbmc7XG4gIHNlc3Npb25JZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9wZW5Sb3V0ZXJDb21wbGV0aW9uUmVzcG9uc2Uge1xuICBpZDogc3RyaW5nO1xuICBjaG9pY2VzOiBBcnJheTx7XG4gICAgbWVzc2FnZToge1xuICAgICAgcm9sZTogc3RyaW5nO1xuICAgICAgY29udGVudDogc3RyaW5nO1xuICAgIH07XG4gICAgZmluaXNoX3JlYXNvbjogc3RyaW5nO1xuICB9Pjtcbn1cblxuZXhwb3J0IGNvbnN0IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyA9IHtcbiAgREVGQVVMVDoge1xuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxuICBXSVRIX0xJQ0VOU0U6IChsaWNlbnNlS2V5OiBzdHJpbmcpID0+ICh7XG4gICAgLi4uU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLkRFRkFVTFQsXG4gICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2xpY2Vuc2VLZXl9YCxcbiAgfSksXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgT1BFTlJPVVRFUl9BUElfSEVBREVSUyA9IHtcbiAgREVGQVVMVDogKGFwaUtleTogc3RyaW5nKSA9PiAoe1xuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthcGlLZXl9YCxcbiAgICBcIkhUVFAtUmVmZXJlclwiOiBcImh0dHBzOi8vc3lzdGVtc2N1bHB0LmNvbVwiLFxuICAgIFwiWC1UaXRsZVwiOiBcIlN5c3RlbVNjdWxwdCBBUElcIixcbiAgfSksXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQVBJX0hFQURFUlMgPSB7XG4gIERFRkFVTFQ6IHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0gYXMgY29uc3Q7XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgcmVxdWVzdFVybCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIENoYXRNZXNzYWdlLFxuICBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bmssXG4gIFN5c3RlbVNjdWxwdFNldHRpbmdzLFxuICBDdXN0b21Qcm92aWRlcixcbn0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQge1xuICBTeXN0ZW1TY3VscHRFcnJvcixcbiAgRVJST1JfQ09ERVMsXG4gIEVycm9yQ29kZSxcbiAgZ2V0RXJyb3JNZXNzYWdlLFxufSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBJbWFnZVByb2Nlc3NvciB9IGZyb20gXCIuLi91dGlscy9JbWFnZVByb2Nlc3NvclwiO1xuaW1wb3J0IHtcbiAgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMsXG4gIFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyxcbiAgTGljZW5zZVZhbGlkYXRpb25SZXNwb25zZSxcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcblxuZnVuY3Rpb24gZ2VuZXJhdGVVVUlEKCk6IHN0cmluZyB7XG4gIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcbiAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwO1xuICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICB9KTtcbn1cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdFNlcnZpY2Uge1xuICBwcml2YXRlIGxpY2Vuc2VLZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHN0YXRpYyBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gIHByaXZhdGUgaXNJbnNpZGVUaGlua1RhZ3MgPSBmYWxzZTtcbiAgcHJpdmF0ZSBoYXNMb2dnZWREZXZNb2RlID0gZmFsc2U7IC8vIFRyYWNrIGlmIHdlJ3ZlIGxvZ2dlZCBkZXYgbW9kZSBzdGF0dXNcblxuICBwdWJsaWMgZ2V0IGJhc2VVcmwoKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IGxvZyBkZXYgbW9kZSBzdGF0dXMgb25jZVxuICAgIGlmICghdGhpcy5oYXNMb2dnZWREZXZNb2RlKSB7XG4gICAgICB0aGlzLmhhc0xvZ2dlZERldk1vZGUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIElmIGluIGRldmVsb3BtZW50IG1vZGUsIHVzZSBzZXJ2ZXJVcmwgKHdoaWNoIGRlZmF1bHRzIHRvIGxvY2FsaG9zdDozMDAxKVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Muc2VydmVyVXJsO1xuICAgIH1cblxuICAgIC8vIEluIHByb2R1Y3Rpb24sIHVzZSB0aGUgcHJvZHVjdGlvbiBVUkxcbiAgICByZXR1cm4gXCJodHRwczovL2FwaS5zeXN0ZW1zY3VscHQuY29tXCI7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGV4dHJhY3Rpb25zRGlyZWN0b3J5KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3MuZXh0cmFjdGlvbnNEaXJlY3RvcnkgPz8gXCJcIjtcbiAgfVxuXG4gIHByaXZhdGUgY29uc3RydWN0b3Ioc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzLCBhcHA6IEFwcCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLmxpY2Vuc2VLZXkgPSBzZXR0aW5ncy5saWNlbnNlS2V5O1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyxcbiAgICBhcHA6IEFwcFxuICApOiBTeXN0ZW1TY3VscHRTZXJ2aWNlIHtcbiAgICBpZiAoIVN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgU3lzdGVtU2N1bHB0U2VydmljZShzZXR0aW5ncywgYXBwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZS5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZS5saWNlbnNlS2V5ID0gc2V0dGluZ3MubGljZW5zZUtleTtcbiAgICB9XG4gICAgcmV0dXJuIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlU2V0dGluZ3Moc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzKTogdm9pZCB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMubGljZW5zZUtleSA9IHNldHRpbmdzLmxpY2Vuc2VLZXk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG1ha2VSZXF1ZXN0PFQ+KFxuICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgbWV0aG9kPzogc3RyaW5nO1xuICAgICAgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gICAgICBib2R5Pzogc3RyaW5nO1xuICAgICAgc2hvd05vdGljZXM/OiBib29sZWFuO1xuICAgICAgcmVxdWlyZXNQcm8/OiBib29sZWFuO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBpZiAob3B0aW9ucy5yZXF1aXJlc1BybyAmJiAhZW5kcG9pbnQuaW5jbHVkZXMoXCIvbGljZW5zZS92YWxpZGF0ZVwiKSkge1xuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaWNlbnNlKHRydWUpO1xuICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuUFJPX1JFUVVJUkVEKSxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5QUk9fUkVRVUlSRUQsXG4gICAgICAgICAgNDAzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaGVhZGVycyA9IHRoaXMubGljZW5zZUtleVxuICAgICAgPyBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSlcbiAgICAgIDogU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLkRFRkFVTFQ7XG5cbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9JHtlbmRwb2ludH1gO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7XG4gICAgICB1cmwsXG4gICAgICBtZXRob2Q6IG9wdGlvbnMubWV0aG9kIHx8IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLmhlYWRlcnMsXG4gICAgICAgIC4uLihvcHRpb25zLmhlYWRlcnMgfHwge30pLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IG9wdGlvbnMuYm9keSxcbiAgICAgIHRocm93OiBmYWxzZSxcbiAgICB9KTtcblxuICAgIGxldCBhcGlSZXNwb25zZTogYW55O1xuICAgIHRyeSB7XG4gICAgICBhcGlSZXNwb25zZSA9IHJlc3BvbnNlLmpzb247XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRSksXG4gICAgICAgIEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UsXG4gICAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgfHwgYXBpUmVzcG9uc2Uuc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgIHRoaXMuaGFuZGxlQXBpRXJyb3IoZW5kcG9pbnQsIHJlc3BvbnNlLCBhcGlSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIHJlc3BvbnNlIGlzIHdyYXBwZWQgaW4gYSBkYXRhIGZpZWxkLCByZXR1cm4gdGhhdCwgb3RoZXJ3aXNlIHJldHVybiB0aGUgd2hvbGUgcmVzcG9uc2VcbiAgICByZXR1cm4gKFxuICAgICAgYXBpUmVzcG9uc2UuZGF0YSAhPT0gdW5kZWZpbmVkID8gYXBpUmVzcG9uc2UuZGF0YSA6IGFwaVJlc3BvbnNlXG4gICAgKSBhcyBUO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVBcGlFcnJvcihcbiAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgIHJlc3BvbnNlOiB7IHN0YXR1czogbnVtYmVyIH0sXG4gICAgYXBpUmVzcG9uc2U6IGFueVxuICApOiBuZXZlciB7XG4gICAgaWYgKGFwaVJlc3BvbnNlLmVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvckNvZGUgPSAoYXBpUmVzcG9uc2UuZXJyb3IuY29kZSB8fFxuICAgICAgICBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SKSBhcyBFcnJvckNvZGU7XG4gICAgICBjb25zdCBzdGF0dXNDb2RlID0gYXBpUmVzcG9uc2UuZXJyb3Iuc3RhdHVzQ29kZSB8fCByZXNwb25zZS5zdGF0dXM7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBhcGlSZXNwb25zZS5lcnJvci5tb2RlbCk7XG5cbiAgICAgIGNvbnN0IG1ldGFkYXRhOiBTeXN0ZW1TY3VscHRFcnJvcltcIm1ldGFkYXRhXCJdID0ge307XG5cbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRSB8fFxuICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICkge1xuICAgICAgICBtZXRhZGF0YS5zaG91bGRSZXN1Ym1pdCA9IHRydWU7XG4gICAgICAgIG1ldGFkYXRhLm1vZGVsID0gYXBpUmVzcG9uc2UuZXJyb3IubW9kZWw7XG4gICAgICB9XG5cbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgIHN0YXR1c0NvZGUsXG4gICAgICAgIG1ldGFkYXRhXG4gICAgICApO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SKSxcbiAgICAgIEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IsXG4gICAgICByZXNwb25zZS5zdGF0dXNcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1FcnJvcihcbiAgICByZXNwb25zZTogUmVzcG9uc2UsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8bmV2ZXI+IHtcbiAgICAvLyBMb2cgcmF3IHJlc3BvbnNlIGZpcnN0XG4gICAgY29uc29sZS5lcnJvcihcIlN0cmVhbSBlcnJvciByZXNwb25zZTpcIiwge1xuICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgY29udGVudFR5cGU6IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpLFxuICAgICAgaXNDdXN0b21Qcm92aWRlcixcbiAgICB9KTtcblxuICAgIGxldCBlcnJvckNvZGU6IEVycm9yQ29kZSA9IEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUjtcbiAgICBsZXQgbWV0YWRhdGE6IFN5c3RlbVNjdWxwdEVycm9yW1wibWV0YWRhdGFcIl0gPSB7fTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU3RyZWFtIGVycm9yIGRhdGE6XCIsIGVycm9yRGF0YSk7XG5cbiAgICAgIC8vIEhhbmRsZSBjdXN0b20gcHJvdmlkZXIgZXJyb3JzXG4gICAgICBpZiAoaXNDdXN0b21Qcm92aWRlcikge1xuICAgICAgICAvLyBQcmVzZXJ2ZSByYXcgZXJyb3IgZGF0YVxuICAgICAgICBtZXRhZGF0YS5yYXdFcnJvciA9IGVycm9yRGF0YTtcbiAgICAgICAgbWV0YWRhdGEucHJvdmlkZXIgPSBcImN1c3RvbVwiO1xuXG4gICAgICAgIC8vIENvbW1vbiBlcnJvciBzdGF0dXMgY29kZXMgZm9yIE9wZW5BSS1jb21wYXRpYmxlIEFQSXNcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuSU5WQUxJRF9MSUNFTlNFO1xuICAgICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBcIkludmFsaWQgQVBJIGtleSBmb3IgY3VzdG9tIHByb3ZpZGVyXCIsXG4gICAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MjkpIHtcbiAgICAgICAgICBlcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5RVU9UQV9FWENFRURFRDtcbiAgICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHxcbiAgICAgICAgICAgICAgXCJSYXRlIGxpbWl0IGV4Y2VlZGVkIGZvciBjdXN0b20gcHJvdmlkZXJcIixcbiAgICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgIGVycm9yQ29kZSA9IEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFO1xuICAgICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBcIk1vZGVsIG5vdCBmb3VuZCBvciBlbmRwb2ludCBpbmNvcnJlY3RcIixcbiAgICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZvciBvdGhlciBlcnJvcnMsIHBhc3MgdGhyb3VnaCB0aGUgcHJvdmlkZXIncyBlcnJvciBtZXNzYWdlXG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvckRhdGEuZXJyb3IpIHtcbiAgICAgICAgZXJyb3JDb2RlID0gKGVycm9yRGF0YS5lcnJvci5jb2RlIHx8XG4gICAgICAgICAgRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SKSBhcyBFcnJvckNvZGU7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICAgKSB7XG4gICAgICAgICAgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgICBtb2RlbDogZXJyb3JEYXRhLmVycm9yLm1vZGVsLFxuICAgICAgICAgICAgc2hvdWxkUmVzdWJtaXQ6IHRydWUsXG4gICAgICAgICAgICByYXdFcnJvcjogZXJyb3JEYXRhLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBMb2cgcGFyc2UgZXJyb3JcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwYXJzaW5nIGVycm9yIHJlc3BvbnNlOlwiLCBlKTtcblxuICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIGVycm9yIHJlc3BvbnNlIG9yIGl0J3MgYWxyZWFkeSBhIFN5c3RlbVNjdWxwdEVycm9yLCB0aHJvdyBpdFxuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvcikge1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlIHVzZSBkZWZhdWx0IHN0cmVhbSBlcnJvclxuICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgIGdldEVycm9yTWVzc2FnZShlcnJvckNvZGUsIG1ldGFkYXRhLm1vZGVsKSxcbiAgICAgIGVycm9yQ29kZSxcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIG1ldGFkYXRhXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlTGljZW5zZShmb3JjZUNoZWNrID0gZmFsc2UpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMubGljZW5zZUtleSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8TGljZW5zZVZhbGlkYXRpb25SZXNwb25zZT4oXG4gICAgICAgIFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkxJQ0VOU0UuVkFMSURBVEUodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSksXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCByZWd1bGFyIG1vZGVsc1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PHsgbW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdIH0+KFxuICAgICAgICBcIi9hcGkvdjEvbW9kZWxzXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmICghcmVzcG9uc2UgfHwgIUFycmF5LmlzQXJyYXkocmVzcG9uc2UubW9kZWxzKSkge1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UpLFxuICAgICAgICAgIEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UsXG4gICAgICAgICAgNTAwXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBwcm92aWRlciB0byBzeXN0ZW1zY3VscHQgZm9yIG91ciBtb2RlbHNcbiAgICAgIGNvbnN0IHN5c3RlbXNjdWxwdE1vZGVscyA9IHJlc3BvbnNlLm1vZGVscy5tYXAoKG1vZGVsKSA9PiAoe1xuICAgICAgICAuLi5tb2RlbCxcbiAgICAgICAgcHJvdmlkZXI6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFJldHVybiBvbmx5IHN5c3RlbSBtb2RlbHNcbiAgICAgIHJldHVybiBzeXN0ZW1zY3VscHRNb2RlbHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFRva2VuQmFsYW5jZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGljZW5zZSh0cnVlKTtcbiAgICBpZiAoIWlzVmFsaWQpIHJldHVybiAwO1xuXG4gICAgLy8gcmUtdmFsaWRhdGUgdG8gZ2V0IGZyZXNoIGxpY2Vuc2UgZGF0YVxuICAgIGNvbnN0IGxpY2Vuc2VJbmZvID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDxMaWNlbnNlVmFsaWRhdGlvblJlc3BvbnNlPihcbiAgICAgIFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkxJQ0VOU0UuVkFMSURBVEUodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICBoZWFkZXJzOiBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSksXG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gbGljZW5zZUluZm8uY3JlZGl0c19iYWxhbmNlIHx8IDA7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldENvbnRleHRGaWxlQ29udGVudHMoXG4gICAgZmlsZVBhdGg6IHN0cmluZ1xuICApOiBQcm9taXNlPHN0cmluZyB8IG51bGwgfCB7IHR5cGU6IFwiaW1hZ2VcIjsgYmFzZTY0OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhbiB0aGUgd2lraS1saW5rIGZvcm1hdDogW1twYXRoXV0gLT4gcGF0aFxuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcblxuICAgICAgLy8gUmVtb3ZlIGFueSBtYXRoIGRpc3BsYXkgbWFya2VycyBpZiBwcmVzZW50XG4gICAgICBjb25zdCBjbGVhblBhdGggPSBsaW5rVGV4dC5yZXBsYWNlKFxuICAgICAgICAvXFwkYmVnaW46bWF0aDpkaXNwbGF5XFwkXFxbKC4qPylcXCRlbmQ6bWF0aDpkaXNwbGF5XFwkXS9nLFxuICAgICAgICBcIiQxXCJcbiAgICAgICk7XG5cbiAgICAgIC8vIFRyeSB0byByZXNvbHZlIHRoZSBmaWxlIHVzaW5nIHRoZSBjbGVhbmVkIHBhdGhcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIGNsZWFuUGF0aCxcbiAgICAgICAgXCJcIlxuICAgICAgKTtcblxuICAgICAgaWYgKHJlc29sdmVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGlmIChyZXNvbHZlZEZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9eKGpwZ3xqcGVnfHBuZ3xnaWZ8d2VicCkkL2kpKSB7XG4gICAgICAgICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgSW1hZ2VQcm9jZXNzb3IucHJvY2Vzc0ltYWdlKFxuICAgICAgICAgICAgcmVzb2x2ZWRGaWxlLFxuICAgICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB7IHR5cGU6IFwiaW1hZ2VcIiwgYmFzZTY0IH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQocmVzb2x2ZWRGaWxlKTtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGZpbGUgbm90IGZvdW5kLCB0cnkgcmVzb2x2aW5nIHdpdGhvdXQgdGhlIGZvbGRlciBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gY2xlYW5QYXRoLnNwbGl0KFwiL1wiKS5wb3AoKTtcbiAgICAgIGlmIChmaWxlTmFtZSkge1xuICAgICAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgICAgIGNvbnN0IG1hdGNoaW5nRmlsZSA9IGFsbEZpbGVzLmZpbmQoKGYpID0+IGYubmFtZSA9PT0gZmlsZU5hbWUpO1xuICAgICAgICBpZiAobWF0Y2hpbmdGaWxlKSB7XG4gICAgICAgICAgaWYgKG1hdGNoaW5nRmlsZS5leHRlbnNpb24ubWF0Y2goL14oanBnfGpwZWd8cG5nfGdpZnx3ZWJwKSQvaSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IEltYWdlUHJvY2Vzc29yLnByb2Nlc3NJbWFnZShcbiAgICAgICAgICAgICAgbWF0Y2hpbmdGaWxlLFxuICAgICAgICAgICAgICB0aGlzLmFwcFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6IFwiaW1hZ2VcIiwgYmFzZTY0IH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKG1hdGNoaW5nRmlsZSk7XG4gICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYnVpbGRDb250ZXh0TWVzc2FnZUZyb21GaWxlKFxuICAgIGZpbGVQYXRoOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxDaGF0TWVzc2FnZSB8IG51bGw+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0RmlsZUNvbnRlbnRzKGZpbGVQYXRoKTtcbiAgICBjb25zdCBkaXNwbGF5TmFtZSA9IGZpbGVQYXRoLnJlcGxhY2UoXG4gICAgICAvXFwkYmVnaW46bWF0aDpkaXNwbGF5XFwkXFxbKC4qPylcXCRlbmQ6bWF0aDpkaXNwbGF5XFwkXS9nLFxuICAgICAgXCIkMVwiXG4gICAgKTtcblxuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBgQ29udGV4dCBmcm9tICR7ZGlzcGxheU5hbWV9OlxcblxcbiR7Y29udGVudH1gLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmIChjb250ZW50LnR5cGUgPT09IFwiaW1hZ2VcIikge1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYSBcInR5cGU6aW1hZ2VfdXJsXCIgYXJyYXkgZW50cnk6XG4gICAgICAgIC8vIE9wdGlvbmFsbHkgcHJlZml4IHdpdGggYSBcInR5cGU6dGV4dFwiIGVudHJ5IGZvciBhbnkgbGFiZWwgb3IgbWVudGlvbiBvZiB0aGUgZmlsZVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgIHRleHQ6IGBDb250ZXh0IGZyb20gJHtkaXNwbGF5TmFtZX06XFxuXFxuYCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwiaW1hZ2VfdXJsXCIsXG4gICAgICAgICAgICAgIGltYWdlX3VybDoge1xuICAgICAgICAgICAgICAgIC8vIElmIHBvc3NpYmxlLCBwcmVmaXggd2l0aCBkYXRhOmltYWdlLzxleHQ+XG4gICAgICAgICAgICAgICAgdXJsOiBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7Y29udGVudC5iYXNlNjQucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgIC9eZGF0YTouKjtiYXNlNjQsLyxcbiAgICAgICAgICAgICAgICAgIFwiXCJcbiAgICAgICAgICAgICAgICApfWAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWVzc2FnZV9pZDogZ2VuZXJhdGVVVUlEKCksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcmVwYXJlTWVzc2FnZXNXaXRoQ29udGV4dChcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICBjb250ZXh0RmlsZXM6IFNldDxzdHJpbmc+LFxuICAgIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmcsXG4gICAgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZ1xuICApOiBQcm9taXNlPENoYXRNZXNzYWdlW10+IHtcbiAgICBjb25zdCBwcmVwYXJlZE1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW107XG5cbiAgICAvLyBBZGQgc3lzdGVtIG1lc3NhZ2UgZmlyc3RcbiAgICBsZXQgc3lzdGVtUHJvbXB0Q29udGVudDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGlmIChzeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHN5c3RlbVByb21wdFBhdGgpIHtcbiAgICAgIC8vIEZvciBjdXN0b20gcHJvbXB0cywgcmVhZCBmcm9tIHRoZSBmaWxlXG4gICAgICAvLyBUcnkgdG8gcmVzb2x2ZSB0aGUgZmlsZSB1c2luZyB0aGUgY2xlYW5lZCBwYXRoXG4gICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQocmVzb2x2ZWRGaWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIG5vdCBmb3VuZCwgdHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICBjb25zdCBmaWxlV2l0aEV4dCA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgICBgJHtzeXN0ZW1Qcm9tcHRQYXRofS5tZGBcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGZpbGVXaXRoRXh0IGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlV2l0aEV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVHJ5IGluIHRoZSBzeXN0ZW0gcHJvbXB0cyBkaXJlY3RvcnlcbiAgICAgICAgICBjb25zdCBmaWxlSW5TeXN0ZW1Qcm9tcHRzRGlyID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAgICAgYFN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0cy8ke3N5c3RlbVByb21wdFBhdGh9Lm1kYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGZpbGVJblN5c3RlbVByb21wdHNEaXIgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoXG4gICAgICAgICAgICAgIGZpbGVJblN5c3RlbVByb21wdHNEaXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzeXN0ZW1Qcm9tcHRUeXBlKSB7XG4gICAgICAvLyBGb3Igbm9uLWN1c3RvbSBwcm9tcHRzLCBmZXRjaCBmcm9tIHNlcnZlclxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0U2VydmljZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKHRoaXMuYXBwKTtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gYXdhaXQgc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKFxuICAgICAgICAgIHN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgZXJyb3IgYW5kIGNvbnRpbnVlIHdpdGhvdXQgc3lzdGVtIHByb21wdFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCBzeXN0ZW0gbWVzc2FnZSBpZiB3ZSBoYXZlIGNvbnRlbnRcbiAgICBpZiAoc3lzdGVtUHJvbXB0Q29udGVudCkge1xuICAgICAgcHJlcGFyZWRNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgY29udGVudDogc3lzdGVtUHJvbXB0Q29udGVudCxcbiAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgY29udGV4dCBmaWxlcyBhbmQgY29sbGVjdCBkb2N1bWVudCBJRHMgZm9yIHRoZSBzZXJ2ZXJcbiAgICBjb25zdCBkb2N1bWVudElkczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIGRvY3VtZW50IHJlZmVyZW5jZSAoc3RhcnRzIHdpdGggXCJkb2M6XCIpXG4gICAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIHtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IGZpbGVQYXRoLnN1YnN0cmluZyg0KTtcbiAgICAgICAgZG9jdW1lbnRJZHMucHVzaChkb2N1bWVudElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSByZWd1bGFyIGZpbGUgY29udGV4dHMgYXMgYmVmb3JlXG4gICAgICAgIGNvbnN0IGNvbnRleHRNZXNzYWdlID0gYXdhaXQgdGhpcy5idWlsZENvbnRleHRNZXNzYWdlRnJvbUZpbGUoZmlsZVBhdGgpO1xuICAgICAgICBpZiAoY29udGV4dE1lc3NhZ2UpIHtcbiAgICAgICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goY29udGV4dE1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGRvY3VtZW50IGNvbnRleHQgdG8gdGhlIGZpcnN0IG1lc3NhZ2UgaWYgd2UgaGF2ZSBkb2N1bWVudCBJRHNcbiAgICBpZiAoZG9jdW1lbnRJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmlyc3RNZXNzYWdlID0gbWVzc2FnZXNbMF07XG4gICAgICBpZiAoZmlyc3RNZXNzYWdlKSB7XG4gICAgICAgIGZpcnN0TWVzc2FnZS5kb2N1bWVudENvbnRleHQgPSB7IGRvY3VtZW50SWRzIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBhY3R1YWwgY2hhdCBtZXNzYWdlc1xuICAgIGZvciAoY29uc3QgbXNnIG9mIG1lc3NhZ2VzKSB7XG4gICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goe1xuICAgICAgICByb2xlOiBtc2cucm9sZSxcbiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IG1zZy5tZXNzYWdlX2lkIHx8IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICBkb2N1bWVudENvbnRleHQ6IG1zZy5kb2N1bWVudENvbnRleHQsXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGU6IG1zZy5zeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoOiBtc2cuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBwcmVwYXJlZE1lc3NhZ2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVEYXRhUHJlZml4KGxpbmU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFsaW5lPy50cmltKCkpIHJldHVybiBcIlwiO1xuICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgIC8vIFNraXAgc3BlY2lhbCBtZXNzYWdlc1xuICAgIGlmIChcbiAgICAgIHRyaW1tZWQgPT09IFwiZGF0YTpcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJkYXRhOiBcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJbRE9ORV1cIiB8fFxuICAgICAgdHJpbW1lZC5zdGFydHNXaXRoKFwiOiBPUEVOUk9VVEVSXCIpXG4gICAgKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJpbW1lZC5yZXBsYWNlKC9eKD86ZGF0YTpcXHMqKSsvLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNWYWxpZFN0cmVhbUV2ZW50KGRhdGE6IHN0cmluZywgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlKTogYm9vbGVhbiB7XG4gICAgaWYgKCFkYXRhKSByZXR1cm4gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIHJldHVybiAhIShcbiAgICAgICAgcGFyc2VkICYmXG4gICAgICAgIChwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fFxuICAgICAgICAgIHBhcnNlZC5jaG9pY2VzPy5bMF0/LmRlbHRhPy5yZWFzb25pbmcgfHxcbiAgICAgICAgICBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uZnVuY3Rpb25fY2FsbCB8fFxuICAgICAgICAgIHBhcnNlZC5lcnJvcilcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc1N0cmVhbUxpbmUoXG4gICAgbGluZTogc3RyaW5nLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoIWxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IHRoaXMubm9ybWFsaXplRGF0YVByZWZpeChsaW5lKTtcbiAgICByZXR1cm4gdGhpcy5pc1ZhbGlkU3RyZWFtRXZlbnQobm9ybWFsaXplZCwgaXNDdXN0b21Qcm92aWRlcilcbiAgICAgID8gbm9ybWFsaXplZFxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1FdmVudChcbiAgICBldmVudDogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8eyBjb250ZW50OiBzdHJpbmcgfCBudWxsOyByZWFzb25pbmc6IHN0cmluZyB8IG51bGwgfSB8IG51bGw+IHtcbiAgICBpZiAoIWV2ZW50KSByZXR1cm4gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFyc2VkOiBTeXN0ZW1TY3VscHRTdHJlYW1DaHVuaztcbiAgICAgIHRyeSB7XG4gICAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoZXZlbnQpO1xuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwYXJzZWQpIHJldHVybiBudWxsO1xuXG4gICAgICAvLyBIYW5kbGUgZXJyb3JzXG4gICAgICBpZiAocGFyc2VkLmVycm9yKSB7XG4gICAgICAgIGNvbnN0IGVycm9yQ29kZSA9IChwYXJzZWQuZXJyb3IuY29kZSB8fFxuICAgICAgICAgIEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUikgYXMgRXJyb3JDb2RlO1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBwYXJzZWQuZXJyb3IubWVzc2FnZSB8fCBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBtb2RlbCk7XG5cbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgc2hvdWxkUmVzdWJtaXQ6IGZhbHNlLFxuICAgICAgICAgIHJhd0Vycm9yOiBwYXJzZWQuZXJyb3IsXG4gICAgICAgICAgb3JpZ2luYWxFdmVudDogZXZlbnQsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICAgKSB7XG4gICAgICAgICAgbWV0YWRhdGEuc2hvdWxkUmVzdWJtaXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgcGFyc2VkLmVycm9yLnN0YXR1c0NvZGUgfHwgNTAwLFxuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fCBudWxsO1xuICAgICAgY29uc3QgcmVhc29uaW5nID0gcGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LnJlYXNvbmluZyB8fCBudWxsO1xuXG4gICAgICAvLyBJZiB3ZSdyZSBpbiB0aGluayBtb2RlLCBhbGwgY29udGVudCBzaG91bGQgYmUgdHJlYXRlZCBhcyByZWFzb25pbmcgdW50aWwgd2Ugc2VlIDwvdGhpbms+XG4gICAgICBpZiAodGhpcy5pc0luc2lkZVRoaW5rVGFncykge1xuICAgICAgICAvLyBDaGVjayBib3RoIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBmb3IgPC90aGluaz5cbiAgICAgICAgbGV0IGNvbWJpbmVkVGV4dCA9IFwiXCI7XG4gICAgICAgIGlmIChyZWFzb25pbmcpIGNvbWJpbmVkVGV4dCArPSByZWFzb25pbmc7XG4gICAgICAgIGlmIChjb250ZW50KSBjb21iaW5lZFRleHQgKz0gY29udGVudDtcblxuICAgICAgICBjb25zdCB0aGlua0VuZE1hdGNoID0gY29tYmluZWRUZXh0Lm1hdGNoKC8oLio/KVxccyo8XFwvdGhpbms+XFxzKiguKikvKTtcbiAgICAgICAgaWYgKHRoaW5rRW5kTWF0Y2gpIHtcbiAgICAgICAgICB0aGlzLmlzSW5zaWRlVGhpbmtUYWdzID0gZmFsc2U7XG4gICAgICAgICAgLy8gRXZlcnl0aGluZyBiZWZvcmUgPC90aGluaz4gaXMgcmVhc29uaW5nLCBldmVyeXRoaW5nIGFmdGVyIGlzIGNvbnRlbnRcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua0VuZE1hdGNoWzFdIHx8IFwiXCIsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlua0VuZE1hdGNoWzJdIHx8IFwiXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIG5vIDwvdGhpbms+IGZvdW5kLCBldmVyeXRoaW5nIGlzIHN0aWxsIHJlYXNvbmluZ1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgcmVhc29uaW5nOiBjb21iaW5lZFRleHQgfHwgbnVsbCxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGNvbnRlbnQgY29udGFpbnMgPHRoaW5rPlxuICAgICAgICBpZiAoY29udGVudCkge1xuICAgICAgICAgIGNvbnN0IHRoaW5rU3RhcnRNYXRjaCA9IGNvbnRlbnQubWF0Y2goLzx0aGluaz5cXHMqKC4qKS8pO1xuICAgICAgICAgIGlmICh0aGlua1N0YXJ0TWF0Y2gpIHtcbiAgICAgICAgICAgIHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY29udGVudDogbnVsbCxcbiAgICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua1N0YXJ0TWF0Y2hbMV0gfHwgXCJcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGNvbnRlbnQsIHJlYXNvbmluZyB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1N0cmVhbUNodW5rKFxuICAgIGNodW5rOiBVaW50OEFycmF5LFxuICAgIGJ1ZmZlcjogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8e1xuICAgIG5ld0J1ZmZlcjogc3RyaW5nO1xuICAgIGNvbnRlbnRzOiBzdHJpbmdbXTtcbiAgICByZWFzb25pbmdzOiBzdHJpbmdbXTtcbiAgfT4ge1xuICAgIGNvbnN0IGRlY29kZWQgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmRlY29kZXIuZGVjb2RlKGNodW5rLCB7IHN0cmVhbTogdHJ1ZSB9KTtcbiAgICBjb25zdCBmdWxsQ2h1bmsgPSBidWZmZXIgKyBkZWNvZGVkO1xuXG4gICAgY29uc3QgbGluZXMgPSBmdWxsQ2h1bmsuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3QgY29udGVudHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgcmVhc29uaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFByb2Nlc3MgYWxsIGxpbmVzIGV4Y2VwdCBwb3RlbnRpYWxseSBpbmNvbXBsZXRlIGxhc3QgbGluZVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICBjb25zdCBldmVudCA9IHRoaXMucHJvY2Vzc1N0cmVhbUxpbmUobGluZXNbaV0sIGlzQ3VzdG9tUHJvdmlkZXIpO1xuICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXZlbnQoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgaXNDdXN0b21Qcm92aWRlclxuICAgICAgICApO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5jb250ZW50KSBjb250ZW50cy5wdXNoKHJlc3VsdC5jb250ZW50KTtcbiAgICAgICAgICBpZiAocmVzdWx0LnJlYXNvbmluZykgcmVhc29uaW5ncy5wdXNoKHJlc3VsdC5yZWFzb25pbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gS2VlcCBsYXN0IGxpbmUgYXMgYnVmZmVyIGlmIG5vbi1lbXB0eVxuICAgIGNvbnN0IG5ld0J1ZmZlciA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLnRyaW0oKVxuICAgICAgPyBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXVxuICAgICAgOiBcIlwiO1xuXG4gICAgcmV0dXJuIHsgbmV3QnVmZmVyLCBjb250ZW50cywgcmVhc29uaW5ncyB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzdHJpcFByb3ZpZGVyUHJlZml4ZXMobW9kZWxJZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IHJlbW92ZSB0aGUgb3BlbnJvdXRlci8gcHJlZml4LCBrZWVwIHRoZSBwcm92aWRlciBpZGVudGlmaWVyXG4gICAgcmV0dXJuIG1vZGVsSWQucmVwbGFjZSgvXm9wZW5yb3V0ZXJcXC8vLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TW9kZWxJbmZvKG1vZGVsSWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlzQ3VzdG9tOiBib29sZWFuO1xuICAgIHByb3ZpZGVyPzogQ3VzdG9tUHJvdmlkZXI7XG4gICAgYWN0dWFsTW9kZWxJZDogc3RyaW5nO1xuICB9PiB7XG4gICAgLy8gRm9yIGN1c3RvbSBwcm92aWRlcnMsIGZpbmQgdGhlIGFjdGl2ZSBvbmVcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci50eXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICBjb25zdCBhY3RpdmVQcm92aWRlciA9IHRoaXMuc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgIChwKSA9PiBwLmlkID09PSB0aGlzLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLmlkICYmIHAuaXNFbmFibGVkXG4gICAgICApO1xuXG4gICAgICBpZiAoIWFjdGl2ZVByb3ZpZGVyKSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBgUHJvdmlkZXIgJHt0aGlzLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLm5hbWV9IG5vdCBmb3VuZCBvciBkaXNhYmxlZGAsXG4gICAgICAgICAgRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUsXG4gICAgICAgICAgNDA0XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQ3VzdG9tOiB0cnVlLFxuICAgICAgICBwcm92aWRlcjogYWN0aXZlUHJvdmlkZXIsXG4gICAgICAgIGFjdHVhbE1vZGVsSWQ6IG1vZGVsSWQsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIE5hdGl2ZSBTeXN0ZW1TY3VscHQgcHJvdmlkZXJcbiAgICByZXR1cm4ge1xuICAgICAgaXNDdXN0b206IGZhbHNlLFxuICAgICAgYWN0dWFsTW9kZWxJZDogdGhpcy5zdHJpcFByb3ZpZGVyUHJlZml4ZXMobW9kZWxJZCksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlQ3VzdG9tUHJvdmlkZXJDb21wbGV0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlcixcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICB0ZW1wZXJhdHVyZTogbnVtYmVyLFxuICAgIG1vZGVsSWQ6IHN0cmluZyxcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbFxuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgY29uc3QgZW5kcG9pbnQgPSBwcm92aWRlci5lbmRwb2ludC50cmltKCkucmVwbGFjZSgvXFwvJC8sIFwiXCIpO1xuICAgIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YCxcbiAgICB9O1xuXG4gICAgLy8gQWRkIE9wZW5Sb3V0ZXIgc3BlY2lmaWMgaGVhZGVycyBpZiBpdCdzIGFuIE9wZW5Sb3V0ZXIgZW5kcG9pbnRcbiAgICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpKSB7XG4gICAgICBoZWFkZXJzW1wiSFRUUC1SZWZlcmVyXCJdID0gXCJodHRwczovL3N5c3RlbXNjdWxwdC5jb21cIjtcbiAgICAgIGhlYWRlcnNbXCJYLVRpdGxlXCJdID0gXCJTeXN0ZW1TY3VscHQgQUlcIjtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgIG1vZGVsOiBtb2RlbElkLFxuICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzLm1hcCgobXNnKSA9PiAoe1xuICAgICAgICByb2xlOiBtc2cucm9sZSxcbiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsXG4gICAgICB9KSksXG4gICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgIC8vIE9ubHkgYWRkIGluY2x1ZGVfcmVhc29uaW5nIGZvciBPcGVuUm91dGVyIGVuZHBvaW50c1xuICAgICAgLi4uKGVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSAmJiB7XG4gICAgICAgIGluY2x1ZGVfcmVhc29uaW5nOiB0cnVlLFxuICAgICAgfSksXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7ZW5kcG9pbnR9L2NoYXQvY29tcGxldGlvbnNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICAgIHNpZ25hbCxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXJyb3IocmVzcG9uc2UsIHRydWUpO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIGFzeW5jICpzdHJlYW1NZXNzYWdlKHtcbiAgICBtZXNzYWdlcyxcbiAgICBtb2RlbCxcbiAgICB0ZW1wZXJhdHVyZSA9IDAuNyxcbiAgICBvbkVycm9yLFxuICAgIGNvbnRleHRGaWxlcyxcbiAgICBzeXN0ZW1Qcm9tcHRUeXBlLFxuICAgIHN5c3RlbVByb21wdFBhdGgsXG4gICAgc2lnbmFsLFxuICB9OiB7XG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgbW9kZWw6IHN0cmluZztcbiAgICB0ZW1wZXJhdHVyZT86IG51bWJlcjtcbiAgICBvbkVycm9yPzogKGVycm9yOiBzdHJpbmcpID0+IHZvaWQ7XG4gICAgY29udGV4dEZpbGVzPzogU2V0PHN0cmluZz47XG4gICAgc3lzdGVtUHJvbXB0VHlwZT86IHN0cmluZztcbiAgICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nO1xuICAgIHNpZ25hbD86IEFib3J0U2lnbmFsO1xuICB9KTogQXN5bmNHZW5lcmF0b3I8eyBjb250ZW50Pzogc3RyaW5nOyByZWFzb25pbmc/OiBzdHJpbmcgfSwgdm9pZCwgdW5rbm93bj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZXNldCB0aGluayB0YWcgc3RhdGUgYXQgc3RhcnQgb2Ygc3RyZWFtXG4gICAgICB0aGlzLmlzSW5zaWRlVGhpbmtUYWdzID0gZmFsc2U7XG5cbiAgICAgIGNvbnN0IHByZXBhcmVkTWVzc2FnZXMgPSBhd2FpdCB0aGlzLnByZXBhcmVNZXNzYWdlc1dpdGhDb250ZXh0KFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgY29udGV4dEZpbGVzIHx8IG5ldyBTZXQoKSxcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aFxuICAgICAgKTtcblxuICAgICAgLy8gR2V0IG1vZGVsIGluZm9cbiAgICAgIGNvbnN0IHsgaXNDdXN0b20sIHByb3ZpZGVyLCBhY3R1YWxNb2RlbElkIH0gPSBhd2FpdCB0aGlzLmdldE1vZGVsSW5mbyhcbiAgICAgICAgbW9kZWxcbiAgICAgICk7XG5cbiAgICAgIGxldCByZXNwb25zZTogUmVzcG9uc2U7XG5cbiAgICAgIGlmIChpc0N1c3RvbSAmJiBwcm92aWRlcikge1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMuaGFuZGxlQ3VzdG9tUHJvdmlkZXJDb21wbGV0aW9uKFxuICAgICAgICAgIHByb3ZpZGVyLFxuICAgICAgICAgIHByZXBhcmVkTWVzc2FnZXMsXG4gICAgICAgICAgdGVtcGVyYXR1cmUsXG4gICAgICAgICAgYWN0dWFsTW9kZWxJZCxcbiAgICAgICAgICBzaWduYWxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlZ3VsYXIgU3lzdGVtU2N1bHB0IEFQSSByZXF1ZXN0XG4gICAgICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgICAgIG1vZGVsOiBhY3R1YWxNb2RlbElkLFxuICAgICAgICAgIG1lc3NhZ2VzOiBwcmVwYXJlZE1lc3NhZ2VzLFxuICAgICAgICAgIHRlbXBlcmF0dXJlLFxuICAgICAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgICAgICBpbmNsdWRlX3JlYXNvbmluZzogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgIGAke3RoaXMuYmFzZVVybH0ke1NZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkNIQVQuQ09NUExFVElPTlN9YCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgQWNjZXB0OiBcInRleHQvZXZlbnQtc3RyZWFtXCIsXG4gICAgICAgICAgICAgIFwiQ2FjaGUtQ29udHJvbFwiOiBcIm5vLWNhY2hlXCIsXG4gICAgICAgICAgICAgIFwiWC1SZXF1ZXN0LUlEXCI6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgICAgICAgIFwieC1saWNlbnNlLWtleVwiOiB0aGlzLmxpY2Vuc2VLZXksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgICAgICAgc2lnbmFsLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVN0cmVhbUVycm9yKHJlc3BvbnNlLCAhIXByb3ZpZGVyKTtcbiAgICAgIH1cbiAgICAgIGlmICghcmVzcG9uc2UuYm9keSkge1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUiksXG4gICAgICAgICAgRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SLFxuICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpO1xuICAgICAgbGV0IGJ1ZmZlciA9IFwiXCI7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgY29uc3QgeyBkb25lLCB2YWx1ZSB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTtcblxuICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAvLyBQcm9jZXNzIGZpbmFsIGNodW5rIGlmIGFueVxuICAgICAgICAgICAgY29uc3QgZmluYWxDaHVuayA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZGVjb2Rlci5kZWNvZGUoKTtcbiAgICAgICAgICAgIGlmIChmaW5hbENodW5rKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5wcm9jZXNzU3RyZWFtTGluZShmaW5hbENodW5rKTtcbiAgICAgICAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5oYW5kbGVTdHJlYW1FdmVudChcbiAgICAgICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgICAgICAgICAhIXByb3ZpZGVyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnJlYXNvbmluZykge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzdWx0LmNvbnRlbnQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbmluZzogcmVzdWx0LnJlYXNvbmluZyB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBQcm9jZXNzIGNodW5rIGFuZCB5aWVsZCBjb250ZW50c1xuICAgICAgICAgIGNvbnN0IHsgbmV3QnVmZmVyLCBjb250ZW50cywgcmVhc29uaW5ncyB9ID1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc1N0cmVhbUNodW5rKHZhbHVlLCBidWZmZXIsIG1vZGVsLCAhIXByb3ZpZGVyKTtcbiAgICAgICAgICBidWZmZXIgPSBuZXdCdWZmZXI7XG5cbiAgICAgICAgICAvLyBZaWVsZCBib3RoIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBjaHVua3NcbiAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgaSA8IE1hdGgubWF4KGNvbnRlbnRzLmxlbmd0aCwgcmVhc29uaW5ncy5sZW5ndGgpO1xuICAgICAgICAgICAgaSsrXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRzW2ldLFxuICAgICAgICAgICAgICByZWFzb25pbmc6IHJlYXNvbmluZ3NbaV0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmVhZGVyLnJlbGVhc2VMb2NrKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIERPTUV4Y2VwdGlvbiAmJiBlcnJvci5uYW1lID09PSBcIkFib3J0RXJyb3JcIikge1xuICAgICAgICAvLyBIYW5kbGUgYWJvcnQgZ3JhY2VmdWxseVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAob25FcnJvcikge1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIDogZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yICYmXG4gICAgICAgICAgZXJyb3IuY29kZSA9PT0gRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SICYmXG4gICAgICAgICAgZXJyb3Iuc3RhdHVzQ29kZSA9PT0gNDAwXG4gICAgICAgICkge1xuICAgICAgICAgIGVycm9yTWVzc2FnZSArPVxuICAgICAgICAgICAgXCJcXG5QbGVhc2UgdHJ5IGFnYWluIGluIGEgZmV3IG1vbWVudHMuIElmIHRoZSBpc3N1ZSBwZXJzaXN0cywgdHJ5IHNlbGVjdGluZyBhIGRpZmZlcmVudCBtb2RlbC5cIjtcbiAgICAgICAgfVxuICAgICAgICBvbkVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBsb2FkcyBhIGZpbGUgdG8gdGhlIHNlcnZlciBmb3IgZG9jdW1lbnQgcHJvY2Vzc2luZy5cbiAgICogUmV0dXJucyB7ZG9jdW1lbnRJZCwgc3RhdHVzOiBcInF1ZXVlZFwiIHwgXCJwcm9jZXNzaW5nXCIgfCBcImNvbXBsZXRlZFwiLCBjYWNoZWQ/OiBib29sZWFufSBpZiBzdWNjZXNzZnVsLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHVwbG9hZERvY3VtZW50KFxuICAgIGZpbGU6IFRGaWxlXG4gICk6IFByb21pc2U8eyBkb2N1bWVudElkOiBzdHJpbmc7IHN0YXR1czogc3RyaW5nOyBjYWNoZWQ/OiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVhZCBmaWxlIGZyb20gdmF1bHRcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuXG4gICAgICAvLyBQcmVwYXJlIG11bHRpcGFydCBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGFdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIgfSk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGJsb2IsIGZpbGUubmFtZSk7XG5cbiAgICAgIC8vIE1ha2UgcmVxdWVzdCB0byAvYXBpL3YxL2RvY3VtZW50cy9wcm9jZXNzXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vYXBpL3YxL2RvY3VtZW50cy9wcm9jZXNzYCwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMubGljZW5zZUtleSxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVwbG9hZCBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwbG9hZHMgYW4gYXVkaW8gZmlsZSB0byB0aGUgc2VydmVyIGZvciBzcGVlY2gtdG8tdGV4dCBleHRyYWN0aW9uLlxuICAgKiBSZXR1cm5zIHtkb2N1bWVudElkLCBzdGF0dXM6IFwicXVldWVkXCJ8XCJwcm9jZXNzaW5nXCJ8XCJjb21wbGV0ZWRcIiwgY2FjaGVkPzogYm9vbGVhbn0gaWYgc3VjY2Vzc2Z1bC5cbiAgICovXG4gIHB1YmxpYyBhc3luYyB1cGxvYWRBdWRpbyhcbiAgICBmaWxlOiBURmlsZVxuICApOiBQcm9taXNlPHsgZG9jdW1lbnRJZDogc3RyaW5nOyBzdGF0dXM6IHN0cmluZzsgY2FjaGVkPzogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlYWQgZmlsZSBmcm9tIHZhdWx0XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZEJpbmFyeShmaWxlKTtcblxuICAgICAgLy8gUHJlcGFyZSBtdWx0aXBhcnQgZm9ybSBkYXRhXG4gICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwgeyB0eXBlOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiIH0pO1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBibG9iLCBmaWxlLm5hbWUpO1xuXG4gICAgICAvLyBNYWtlIHJlcXVlc3QgdG8gL2FwaS92MS9hdWRpby90cmFuc2NyaXB0aW9ucyBlbmRwb2ludFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7dGhpcy5iYXNlVXJsfS9hcGkvdjEvYXVkaW8vdHJhbnNjcmlwdGlvbnNgLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdWRpbyB1cGxvYWQgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBwcmVsb2FkTW9kZWxzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFJlbW92ZSBwcmVsb2FkaW5nIHNpbmNlIHdlJ3JlIG5vdCBjYWNoaW5nXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG59XG4iLCAiZXhwb3J0IGNvbnN0IGNyZWF0ZUxvYWRpbmdJbmRpY2F0b3IgPSAoKSA9PiB7XG4gIGNvbnN0IGluZGljYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGluZGljYXRvci5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCI7XG4gIGluZGljYXRvci50ZXh0Q29udGVudCA9IFwiXHUyNUNGXCI7XG4gIHJldHVybiBpbmRpY2F0b3I7XG59O1xuIiwgImV4cG9ydCBjb25zdCBjcmVhdGVCdXR0b24gPSAoXG4gIHRleHQ6IHN0cmluZyxcbiAgb25DbGljazogKCkgPT4gdm9pZCxcbiAgY2xhc3NOYW1lID0gXCJcIlxuKSA9PiB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIGJ1dHRvbi5jbGFzc05hbWUgPSBgc3lzdGVtc2N1bHB0LWJ1dHRvbiAke2NsYXNzTmFtZX1gO1xuICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xuICBidXR0b24ub25jbGljayA9IG9uQ2xpY2s7XG4gIHJldHVybiBidXR0b247XG59O1xuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGludGVyZmFjZSBUZXh0QXJlYU1vZGFsT3B0aW9ucyB7XG4gIHByaW1hcnlCdXR0b24/OiBzdHJpbmc7XG4gIHNlY29uZGFyeUJ1dHRvbj86IHN0cmluZztcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIHJvd3M/OiBudW1iZXI7XG4gIHByZXNldEJ1dHRvbnM/OiB7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICB2YWx1ZTogc3RyaW5nO1xuICB9W107XG59XG5cbmV4cG9ydCBjbGFzcyBUZXh0QXJlYU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHJlc3VsdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogc3RyaW5nIHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBwcml2YXRlIHRpdGxlOiBzdHJpbmcsXG4gICAgcHJpdmF0ZSBpbml0aWFsQ29udGVudDogc3RyaW5nLFxuICAgIHByaXZhdGUgb3B0aW9ucz86IFRleHRBcmVhTW9kYWxPcHRpb25zXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb2RhbEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsXCIsIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLW1vZGFsXCIpO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgdGhpcy50aXRsZUVsLnNldFRleHQodGhpcy50aXRsZSk7XG4gICAgdGhpcy50aXRsZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIpO1xuXG4gICAgY29uc3QgdGV4dEFyZWFDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIHByZXNldCBidXR0b25zIGlmIHRoZXkgZXhpc3RcbiAgICBpZiAodGhpcy5vcHRpb25zPy5wcmVzZXRCdXR0b25zICYmIHRoaXMub3B0aW9ucy5wcmVzZXRCdXR0b25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHByZXNldEJ1dHRvbkNvbnRhaW5lciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICAgKTtcblxuICAgICAgdGhpcy5vcHRpb25zLnByZXNldEJ1dHRvbnMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IHByZXNldEJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgICAgdGV4dDogcHJlc2V0LmxhYmVsLFxuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiLFxuICAgICAgICB9KTtcbiAgICAgICAgYnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHByZXNldC52YWx1ZTtcbiAgICAgICAgICAvLyBUcmlnZ2VyIHJlc2l6ZSBvYnNlcnZlclxuICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pO1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHJvd3M6IHRoaXMub3B0aW9ucz8ucm93cz8udG9TdHJpbmcoKSB8fCBcIjEwXCIsXG4gICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLm9wdGlvbnM/LnBsYWNlaG9sZGVyIHx8IFwiXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmluaXRpYWxDb250ZW50O1xuXG4gICAgLy8gQWRkIHJlc2l6ZSBvYnNlcnZlciB0byBoYW5kbGUgZHluYW1pYyBjb250ZW50XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGhpcy50ZXh0QXJlYS5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfSk7XG4gICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRleHRBcmVhKTtcblxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucz8uc2Vjb25kYXJ5QnV0dG9uKSB7XG4gICAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5QnV0dG9uLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgfSk7XG4gICAgICBzZWNvbmRhcnlCdXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogdGhpcy5vcHRpb25zPy5wcmltYXJ5QnV0dG9uIHx8IFwiU2F2ZVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIHByaW1hcnlCdXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy50ZXh0QXJlYS52YWx1ZTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgLy8gRm9jdXMgdGhlIHRleHRhcmVhIGFuZCBwbGFjZSBjdXJzb3IgYXQgdGhlIGVuZFxuICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICB0aGlzLnRleHRBcmVhLnNldFNlbGVjdGlvblJhbmdlKFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aFxuICAgICk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlKSB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuQW5kR2V0VmFsdWUoKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93VGV4dGFyZWFQb3B1cChcbiAgYXBwOiBBcHAsXG4gIHRpdGxlOiBzdHJpbmcsXG4gIGluaXRpYWxDb250ZW50OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiBUZXh0QXJlYU1vZGFsT3B0aW9uc1xuKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gIGNvbnN0IG1vZGFsID0gbmV3IFRleHRBcmVhTW9kYWwoYXBwLCB0aXRsZSwgaW5pdGlhbENvbnRlbnQsIG9wdGlvbnMpO1xuICByZXR1cm4gbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgUG9wdXBPcHRpb25zIHtcbiAgcHJpbWFyeUJ1dHRvbj86IHN0cmluZztcbiAgc2Vjb25kYXJ5QnV0dG9uPzogc3RyaW5nO1xuICB0aXRsZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGlucHV0cz86IHtcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gICAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICAgIGNsYXNzTmFtZT86IHN0cmluZztcbiAgICB2YWx1ZT86IHN0cmluZztcbiAgfVtdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hvd1BvcHVwKFxuICBhcHA6IEFwcCxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBvcHRpb25zPzogUG9wdXBPcHRpb25zXG4pOiBQcm9taXNlPHsgY29uZmlybWVkOiBib29sZWFuOyBpbnB1dHM/OiBzdHJpbmdbXSB9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKGFwcCk7XG4gICAgbW9kYWwubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiKTtcblxuICAgIC8vIE92ZXJyaWRlIHRoZSBkaXZpZGVyIHN0eWxpbmdcbiAgICBtb2RhbC5tb2RhbEVsLnN0eWxlLnNldFByb3BlcnR5KFwiLS1tb2RhbC1ib3JkZXItd2lkdGhcIiwgXCIwXCIpO1xuXG4gICAgLy8gU2V0IHRpdGxlIGFuZCBkZXNjcmlwdGlvblxuICAgIG1vZGFsLnRpdGxlRWwuc2V0VGV4dChvcHRpb25zPy50aXRsZSB8fCBcIlN5c3RlbVNjdWxwdCBBSVwiKTtcbiAgICBtb2RhbC50aXRsZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIpO1xuXG4gICAgLy8gQWRkIGRlc2NyaXB0aW9uIHRleHQgZGlyZWN0bHkgYWZ0ZXIgdGl0bGUgaWYgcHJvdmlkZWRcbiAgICBpZiAob3B0aW9ucz8uZGVzY3JpcHRpb24pIHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSBtb2RhbC50aXRsZUVsLmNyZWF0ZURpdigpO1xuICAgICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICAgIGRlc2NyaXB0aW9uRWwuc2V0VGV4dChvcHRpb25zLmRlc2NyaXB0aW9uKTtcbiAgICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmZvbnRTaXplID0gXCIwLjllbVwiO1xuICAgICAgZGVzY3JpcHRpb25FbC5zdHlsZS5tYXJnaW5Ub3AgPSBcIjAuMmVtXCI7XG4gICAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMWVtXCI7XG4gICAgfVxuXG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IG1vZGFsO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuICAgIGNvbnRlbnRFbC5zdHlsZS5wYWRkaW5nID0gXCIwXCI7XG5cbiAgICBjb25zdCBpbnB1dFZhbHVlczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIE9ubHkgc2hvdyBtZXNzYWdlIGlmIGl0J3Mgbm90IGVtcHR5IGFuZCBub3QgYmVpbmcgdXNlZCBhcyBhIHRpdGxlXG4gICAgaWYgKFxuICAgICAgbWVzc2FnZSAmJlxuICAgICAgbWVzc2FnZS50cmltKCkgJiZcbiAgICAgICghb3B0aW9ucz8udGl0bGUgfHwgbWVzc2FnZSAhPT0gb3B0aW9ucy50aXRsZSlcbiAgICApIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgICBcInN5c3RlbXNjdWxwdC1tZXNzYWdlLWNvbnRhaW5lclwiXG4gICAgICApO1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5tYXJnaW5Ub3AgPSBcIjFlbVwiO1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjAuNWVtXCI7XG4gICAgICBjb25zdCBtZXNzYWdlRWwgPSBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1tZXNzYWdlLXRleHRcIik7XG4gICAgICBtZXNzYWdlRWwuc2V0VGV4dChtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucz8uaW5wdXRzKSB7XG4gICAgICBjb25zdCBpbnB1dENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LWNvbnRhaW5lclwiXG4gICAgICApO1xuICAgICAgaW5wdXRDb250YWluZXIuc3R5bGUucGFkZGluZyA9IFwiMCAxZW1cIjtcblxuICAgICAgLy8gQWRkIGNvbnRhaW5lciBjbGFzcyBpZiB0aGlzIGlzIGEgcHJvbXB0IGNyZWF0aW9uIG1vZGFsXG4gICAgICBpZiAoXG4gICAgICAgIG9wdGlvbnMuaW5wdXRzLnNvbWUoKGlucHV0KSA9PlxuICAgICAgICAgIGlucHV0LmNsYXNzTmFtZT8uaW5jbHVkZXMoXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uXCIpXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICBpbnB1dENvbnRhaW5lci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tY29udGFpbmVyXCIpO1xuICAgICAgfVxuXG4gICAgICBvcHRpb25zLmlucHV0cy5mb3JFYWNoKChpbnB1dCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXRFbCA9IGlucHV0Q29udGFpbmVyLmNyZWF0ZUVsKFxuICAgICAgICAgIGlucHV0LnR5cGUgPT09IFwidGV4dGFyZWFcIiA/IFwidGV4dGFyZWFcIiA6IFwiaW5wdXRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlID09PSBcInRleHRhcmVhXCIgPyB1bmRlZmluZWQgOiBpbnB1dC50eXBlLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGlucHV0LnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgYXR0cjogaW5wdXQucmVxdWlyZWQgPyB7IHJlcXVpcmVkOiBcIlwiIH0gOiB7fSxcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIGlmIChpbnB1dC5jbGFzc05hbWUpIHtcbiAgICAgICAgICBpbnB1dEVsLmFkZENsYXNzKGlucHV0LmNsYXNzTmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW5wdXRFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgICAgICAgIGlucHV0RWwuc3R5bGUubWFyZ2luQm90dG9tID0gXCIwLjVlbVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHZhbHVlIGFmdGVyIGVsZW1lbnQgY3JlYXRpb25cbiAgICAgICAgaWYgKGlucHV0LnZhbHVlKSB7XG4gICAgICAgICAgaWYgKGlucHV0LnR5cGUgPT09IFwidGV4dGFyZWFcIikge1xuICAgICAgICAgICAgaW5wdXRFbC52YWx1ZSA9IGlucHV0LnZhbHVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnB1dEVsLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIGlucHV0LnZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5wdXRWYWx1ZXNbaW5kZXhdID0gaW5wdXQudmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgICAgaW5wdXRWYWx1ZXNbaW5kZXhdID0gaW5wdXRFbC52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICBidXR0b25Db250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gXCIxZW1cIjtcblxuICAgIGxldCB3YXNIYW5kbGVkID0gZmFsc2U7XG5cbiAgICBpZiAob3B0aW9ucz8uc2Vjb25kYXJ5QnV0dG9uKSB7XG4gICAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBvcHRpb25zLnNlY29uZGFyeUJ1dHRvbixcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIH0pO1xuICAgICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHdhc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICByZXNvbHZlKHsgY29uZmlybWVkOiBmYWxzZSB9KTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBvcHRpb25zPy5wcmltYXJ5QnV0dG9uIHx8IFwiQ2xvc2VcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhhbmRsZUNvbmZpcm0gPSAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxJbnB1dHNWYWxpZCA9ICFvcHRpb25zPy5pbnB1dHM/LnNvbWUoXG4gICAgICAgIChpbnB1dCwgaSkgPT4gaW5wdXQucmVxdWlyZWQgJiYgIWlucHV0VmFsdWVzW2ldXG4gICAgICApO1xuXG4gICAgICBpZiAoYWxsSW5wdXRzVmFsaWQpIHtcbiAgICAgICAgd2FzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgIGNvbmZpcm1lZDogdHJ1ZSxcbiAgICAgICAgICBpbnB1dHM6IG9wdGlvbnM/LmlucHV0cyA/IGlucHV0VmFsdWVzIDogdW5kZWZpbmVkLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlQ29uZmlybTtcblxuICAgIC8vIEhhbmRsZSBrZXlib2FyZCBldmVudHNcbiAgICBtb2RhbC5tb2RhbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZS5pc0NvbXBvc2luZyAmJiAhZS5zaGlmdEtleSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUNvbmZpcm0oKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB3YXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgcmVzb2x2ZSh7IGNvbmZpcm1lZDogZmFsc2UgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBtb2RhbC5vbkNsb3NlID0gKCkgPT4ge1xuICAgICAgaWYgKCF3YXNIYW5kbGVkKSB7XG4gICAgICAgIHJlc29sdmUoeyBjb25maXJtZWQ6IGZhbHNlIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBGb2N1cyB0aGUgZmlyc3QgaW5wdXQgaWYgaXQgZXhpc3RzXG4gICAgaWYgKG9wdGlvbnM/LmlucHV0cykge1xuICAgICAgY29uc3QgZmlyc3RJbnB1dCA9IGNvbnRlbnRFbC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG4gICAgICBpZiAoZmlyc3RJbnB1dCkge1xuICAgICAgICBmaXJzdElucHV0LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbW9kYWwub3BlbigpO1xuICB9KTtcbn1cbiIsICJpbXBvcnQgeyBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdEVycm9yIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2Vycm9yc1wiO1xuXG50eXBlIE5vdGljZVR5cGUgPSBcImluZm9cIiB8IFwiZXJyb3JcIiB8IFwid2FybmluZ1wiIHwgXCJzdWNjZXNzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBzaG93RW5oYW5jZWROb3RpY2UoXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgdHlwZT86IE5vdGljZVR5cGUsXG4gIGVycm9yPzogRXJyb3IgfCBTeXN0ZW1TY3VscHRFcnJvciB8IHVua25vd25cbikge1xuICAvLyBBbHdheXMgbG9nIGVycm9ycyB0byBjb25zb2xlIGlmIHByZXNlbnRcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIk5vdGljZSBlcnJvciBkZXRhaWxzOlwiLCB7XG4gICAgICBlcnJvcixcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQsXG4gICAgICBtZXRhZGF0YTogZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvciA/IGVycm9yLm1ldGFkYXRhIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICB9XG5cbiAgbGV0IGR1cmF0aW9uOiBudW1iZXI7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgZHVyYXRpb24gPSAxMDAwMDsgLy8gMTAgc2Vjb25kcyBmb3IgZXJyb3JzXG4gICAgICBicmVhaztcbiAgICBjYXNlIFwid2FybmluZ1wiOlxuICAgICAgZHVyYXRpb24gPSA1MDAwOyAvLyA1IHNlY29uZHMgZm9yIHdhcm5pbmdzXG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgZHVyYXRpb24gPSAzMDAwOyAvLyAzIHNlY29uZHMgZm9yIGluZm8gYW5kIHN1Y2Nlc3NcbiAgfVxuXG4gIGNvbnN0IG5vdGljZSA9IG5ldyBOb3RpY2UobWVzc2FnZSwgZHVyYXRpb24pO1xuICByZXR1cm4gbm90aWNlO1xufVxuIiwgImV4cG9ydCB7IGNyZWF0ZUxvYWRpbmdJbmRpY2F0b3IgfSBmcm9tIFwiLi9jb21wb25lbnRzL0xvYWRpbmdJbmRpY2F0b3JcIjtcbmV4cG9ydCB7IGNyZWF0ZUJ1dHRvbiB9IGZyb20gXCIuL2NvbXBvbmVudHMvQnV0dG9uXCI7XG5leHBvcnQge1xuICBUZXh0QXJlYU1vZGFsLFxuICB0eXBlIFRleHRBcmVhTW9kYWxPcHRpb25zLFxuICBzaG93VGV4dGFyZWFQb3B1cCxcbn0gZnJvbSBcIi4vbW9kYWxzL1RleHRBcmVhTW9kYWxcIjtcbmV4cG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuL21vZGFscy9Qb3B1cE1vZGFsXCI7XG5leHBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UgfSBmcm9tIFwiLi9jb21wb25lbnRzL05vdGljZVwiO1xuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIEFic3RyYWN0SW5wdXRTdWdnZXN0IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBGaWxlU3VnZ2VzdGVyIGV4dGVuZHMgQWJzdHJhY3RJbnB1dFN1Z2dlc3Q8c3RyaW5nPiB7XG4gIHByaXZhdGUgY29udGVudDogU2V0PHN0cmluZz47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICAgIHByaXZhdGUgb25TZWxlY3RDYjogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBkaXJlY3Rvcnk6IHN0cmluZ1xuICApIHtcbiAgICBzdXBlcihhcHAsIGlucHV0RWwpO1xuICAgIHRoaXMuY29udGVudCA9IGdldEZpbGVTdWdnZXN0aW9ucyhhcHAsIGRpcmVjdG9yeSk7XG4gIH1cblxuICBnZXRTdWdnZXN0aW9ucyhpbnB1dFN0cjogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGxvd2VyQ2FzZUlucHV0U3RyID0gaW5wdXRTdHIudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gWy4uLnRoaXMuY29udGVudF0uZmlsdGVyKChjb250ZW50KSA9PlxuICAgICAgY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyQ2FzZUlucHV0U3RyKVxuICAgICk7XG4gIH1cblxuICByZW5kZXJTdWdnZXN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgLy8gUmVtb3ZlIGFueSB0cmFpbGluZyBcIi5tZFwiIGV4dGVuc2lvbiB0byBhdm9pZCBjbHV0dGVyXG4gICAgbGV0IGRpc3BsYXkgPSBjb250ZW50LnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgIGVsLnNldFRleHQoZGlzcGxheSk7XG4gIH1cblxuICBzZWxlY3RTdWdnZXN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZXZ0OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMub25TZWxlY3RDYihjb250ZW50KTtcbiAgICB0aGlzLmlucHV0RWwudmFsdWUgPSBjb250ZW50LnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgIHRoaXMuaW5wdXRFbC5ibHVyKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlU3VnZ2VzdGlvbnMoYXBwOiBBcHAsIGRpcmVjdG9yeTogc3RyaW5nKTogU2V0PHN0cmluZz4ge1xuICBjb25zdCBmaWxlcyA9IGFwcC52YXVsdC5nZXRBbGxMb2FkZWRGaWxlcygpLmZpbHRlcigoZmlsZSk6IGZpbGUgaXMgVEZpbGUgPT4ge1xuICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybiBmYWxzZTtcbiAgICAvLyBPbmx5IGluY2x1ZGUgLm1kIGZpbGVzIGRpcmVjdGx5IGluIHRoZSBzcGVjaWZpZWQgZGlyZWN0b3J5IChub3QgaW4gc3ViZGlyZWN0b3JpZXMpXG4gICAgY29uc3QgZmlsZURpciA9IGZpbGUucGFyZW50Py5wYXRoO1xuICAgIHJldHVybiBmaWxlRGlyID09PSBkaXJlY3RvcnkgJiYgZmlsZS5leHRlbnNpb24gPT09IFwibWRcIjtcbiAgfSk7XG4gIHJldHVybiBuZXcgU2V0KGZpbGVzLm1hcCgoZmlsZSkgPT4gZmlsZS5wYXRoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhdHRhY2hGaWxlU3VnZ2VzdGVyKFxuICBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICBvblNlbGVjdDogKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB2b2lkLFxuICBhcHA6IEFwcCxcbiAgZGlyZWN0b3J5OiBzdHJpbmdcbik6IEZpbGVTdWdnZXN0ZXIge1xuICByZXR1cm4gbmV3IEZpbGVTdWdnZXN0ZXIoaW5wdXRFbCwgb25TZWxlY3QsIGFwcCwgZGlyZWN0b3J5KTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IGF0dGFjaEZpbGVTdWdnZXN0ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9GaWxlU3VnZ2VzdGVyXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBvc3RUcmFuc2NyaXB0aW9uUHJvbXB0VHlwZSB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47XG4gIHN5c3RlbVByb21wdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHtcbiAgY29udGVudDogc3RyaW5nO1xuICB0eXBlOiBcImdlbmVyYWxcIiB8IFwicmh5bWVcIiB8IFwiY3VzdG9tXCI7XG4gIHBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHJlc3VsdDogUG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGwpID0+IHZvaWQ7XG4gIHByaXZhdGUgdGV4dEFyZWE6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHByaXZhdGUgbG9hZGluZ0luZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY29udGVudENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcHJlc2V0QnV0dG9uQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21TZWN0aW9uOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21JbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBhY3RpdmVQcmVzZXQ6IHN0cmluZyB8IG51bGwgPSBcImdlbmVyYWxcIjsgLy8gRGVmYXVsdCB0byBnZW5lcmFsXG4gIHByaXZhdGUgcHJvbXB0czogUG9zdFRyYW5zY3JpcHRpb25Qcm9tcHRUeXBlW10gPSBbXTtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgcHJpdmF0ZSBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gICAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiBzdHJpbmcgPSBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiLFxuICAgIHByaXZhdGUgY3VycmVudEN1c3RvbVBhdGg/OiBzdHJpbmdcbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm1vZGFsRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWxcIiwgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtbW9kYWxcIik7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShwbHVnaW4uc2V0dGluZ3MsIGFwcCk7XG4gIH1cblxuICBwcml2YXRlIHNob3dMb2FkaW5nKHNob3c6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMubG9hZGluZ0luZGljYXRvciB8fCAhdGhpcy5jb250ZW50Q29udGFpbmVyKSByZXR1cm47XG5cbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgIHRoaXMuY29udGVudENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwibm9uZVwiIDogXCJibG9ja1wiO1xuICB9XG5cbiAgYXN5bmMgbG9hZFByb21wdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcodHJ1ZSk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3Bvc3QtdHJhbnNjcmlwdGlvbi1wcm9tcHRzYFxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvYWQgcHJvbXB0c1wiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICB0aGlzLnByb21wdHMgPSBkYXRhLmRhdGEucHJvbXB0cztcblxuICAgICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b25zIGFmdGVyIGxvYWRpbmcgZGF0YVxuICAgICAgdGhpcy5jcmVhdGVQcmVzZXRCdXR0b25zKCk7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIHBvc3QtdHJhbnNjcmlwdGlvbiBwcm9tcHRzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJGYWlsZWQgdG8gbG9hZCBwcm9tcHRzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVByZXNldEJ1dHRvbnMoKSB7XG4gICAgaWYgKCF0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgLy8gQ2xlYXIgZXhpc3RpbmcgYnV0dG9uc1xuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICAvLyBJbml0aWFsaXplIGFjdGl2ZSBwcmVzZXQgYmFzZWQgb24gY3VycmVudCBwcm9tcHQgYW5kIHBhdGhcbiAgICBpZiAodGhpcy5jdXJyZW50Q3VzdG9tUGF0aCkge1xuICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBcImN1c3RvbVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb21wdHMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICAgIGlmIChwcmVzZXQuc3lzdGVtUHJvbXB0ID09PSB0aGlzLmN1cnJlbnRQcm9tcHQpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IHByZXNldC5pZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b25zIGZvciBlYWNoIHByb21wdFxuICAgIHRoaXMucHJvbXB0cy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgdGV4dDogcHJlc2V0LmxhYmVsLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgdG9vbHRpcCB3aXRoIGRlc2NyaXB0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgaWYgKHByZXNldC5kZXNjcmlwdGlvbikge1xuICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBwcmVzZXQuZGVzY3JpcHRpb24pO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJoYXMtdG9vbHRpcFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IGluaXRpYWwgYWN0aXZlIHN0YXRlXG4gICAgICBpZiAocHJlc2V0LmlkID09PSB0aGlzLmFjdGl2ZVByZXNldCkge1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9ICFwcmVzZXQuaXNVc2VyQ29uZmlndXJhYmxlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAvLyBSZW1vdmUgYWN0aXZlIGNsYXNzIGZyb20gYWxsIGJ1dHRvbnNcbiAgICAgICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXJcbiAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiKVxuICAgICAgICAgIC5mb3JFYWNoKChidG4pID0+IGJ0bi5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKSk7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQuaWQ7XG5cbiAgICAgICAgLy8gU2hvdy9oaWRlIGN1c3RvbSBzZWN0aW9uXG4gICAgICAgIGlmIChwcmVzZXQuaWQgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICB0aGlzLmN1c3RvbUlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gIXByZXNldC5pc1VzZXJDb25maWd1cmFibGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gU2hvdyBjdXN0b20gc2VjdGlvbiBpZiBpdCdzIGFjdGl2ZVxuICAgIGlmICh0aGlzLmFjdGl2ZVByZXNldCA9PT0gXCJjdXN0b21cIikge1xuICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBpZiAodGhpcy5jdXJyZW50Q3VzdG9tUGF0aCkge1xuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gdGhpcy5jdXJyZW50Q3VzdG9tUGF0aDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWNvbnRlbnRcIik7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dChcIkVkaXQgUG9zdC1Qcm9jZXNzaW5nIFByb21wdFwiKTtcbiAgICB0aGlzLnRpdGxlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIik7XG5cbiAgICAvLyBBZGQgZGVzY3JpcHRpb25cbiAgICBjb25zdCBkZXNjcmlwdGlvbkVsID0gdGhpcy50aXRsZUVsLmNyZWF0ZURpdigpO1xuICAgIGRlc2NyaXB0aW9uRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtZGVzY3JpcHRpb25cIik7XG4gICAgZGVzY3JpcHRpb25FbC5zZXRUZXh0KFxuICAgICAgXCJDb25maWd1cmUgaG93IHlvdXIgdHJhbnNjcmlwdGlvbnMgc2hvdWxkIGJlIHBvc3QtcHJvY2Vzc2VkXCJcbiAgICApO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5mb250U2l6ZSA9IFwiMC45ZW1cIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLm1hcmdpblRvcCA9IFwiMC4yZW1cIjtcblxuICAgIC8vIENyZWF0ZSBsb2FkaW5nIGluZGljYXRvclxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtbG9hZGluZ1wiKTtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5wYWRkaW5nID0gXCIyMHB4XCI7XG4gICAgY29uc3QgbG9hZGluZ1RleHQgPSB0aGlzLmxvYWRpbmdJbmRpY2F0b3IuY3JlYXRlU3BhbigpO1xuICAgIGxvYWRpbmdUZXh0LnNldFRleHQoXCJMb2FkaW5nIHByb21wdHMuLi5cIik7XG5cbiAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXJcbiAgICB0aGlzLmNvbnRlbnRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY29udGVudC1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBjb25zdCB0ZXh0QXJlYUNvbnRhaW5lciA9IHRoaXMuY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbiBjb250YWluZXJcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGN1c3RvbSBzZWN0aW9uIChoaWRkZW4gYnkgZGVmYXVsdClcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24gPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tc2VjdGlvblwiXG4gICAgKTtcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgY3VzdG9tSW5wdXRDb250YWluZXIgPSB0aGlzLmN1c3RvbVNlY3Rpb24uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIGlucHV0IGFuZCBidXR0b25cbiAgICBjb25zdCBpbnB1dFdyYXBwZXIgPSBjdXN0b21JbnB1dENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1pbnB1dC13cmFwcGVyXCJcbiAgICApO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmdhcCA9IFwiOHB4XCI7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuXG4gICAgLy8gQWRkIHRoZSBzZWFyY2ggaW5wdXRcbiAgICB0aGlzLmN1c3RvbUlucHV0ID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2ggZm9yIGEgc3lzdGVtIHByb21wdCBmaWxlLi4uXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1pbnB1dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjcmVhdGUgbmV3IGJ1dHRvblxuICAgIGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IGlucHV0V3JhcHBlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNyZWF0ZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUucGFkZGluZyA9IFwiNHB4IDhweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICBzZXRJY29uKGNyZWF0ZUJ1dHRvbiwgXCJwbHVzXCIpO1xuXG4gICAgY3JlYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgdGVtcGxhdGVDb250ZW50ID0gXCJcIjtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9zeXN0ZW0tcHJvbXB0cy90ZW1wbGF0ZWBcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmZXRjaCB0ZW1wbGF0ZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB0ZW1wbGF0ZUNvbnRlbnQgPSBkYXRhLnRlbXBsYXRlO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGU6XCIsIGVycm9yKTtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIFwiRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGUuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgdGl0bGU6IFwiQ3JlYXRlIE5ldyBTeXN0ZW0gUHJvbXB0XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgIFwiRW50ZXIgYSB0aXRsZSBhbmQgY29udGVudCBmb3IgeW91ciBuZXcgc3lzdGVtIHByb21wdC4gVGhlIHRpdGxlIHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgYSBtYXJrZG93biBmaWxlIHRoYXQgeW91IGNhbiBjdXN0b21pemUgbGF0ZXIuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiQ3JlYXRlXCIsXG4gICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgaW5wdXRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJNeSBDdXN0b20gQXNzaXN0YW50XCIsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLXRpdGxlLWlucHV0XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRhcmVhXCIsXG4gICAgICAgICAgICB2YWx1ZTogdGVtcGxhdGVDb250ZW50LFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3lzdGVtc2N1bHB0LXByb21wdC1jcmVhdGlvbi1jb250ZW50XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3VsdD8uY29uZmlybWVkIHx8ICFyZXN1bHQuaW5wdXRzPy5bMF0gfHwgIXJlc3VsdC5pbnB1dHM/LlsxXSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFt0aXRsZSwgY29udGVudF0gPSByZXN1bHQuaW5wdXRzO1xuICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aXRsZS5yZXBsYWNlKC9bXmEtekEtWjAtOS1fIF0vZywgXCJcIikucmVwbGFjZSgvIC9nLCBcIi1cIik7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeX0vJHtmaWxlTmFtZX1gO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0XG4gICAgICAgICAgLmNyZWF0ZUZvbGRlcih0aGlzLnN5c3RlbVByb21wdHNEaXJlY3RvcnkpXG4gICAgICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgIC8qIERpcmVjdG9yeSBtaWdodCBhbHJlYWR5IGV4aXN0ICovXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBgIyAke3RpdGxlfVxcblxcbiR7Y29udGVudH1gO1xuICAgICAgICBjb25zdCBmaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoICsgXCIubWRcIiwgZmlsZUNvbnRlbnQpO1xuXG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgZmlsZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdGV4dGFyZWEgd2l0aCB0aGUgY29udGVudFxuICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBmaWxlQ29udGVudDtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIGlucHV0IHRvIHNob3cgdGhlIHNlbGVjdGVkIGZpbGVcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IGZpbGVQYXRoO1xuXG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTeXN0ZW0gcHJvbXB0IGZpbGUgY3JlYXRlZCBzdWNjZXNzZnVsbHkhXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBzeXN0ZW0gcHJvbXB0IGZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgIDogXCJGYWlsZWQgdG8gY3JlYXRlIHN5c3RlbSBwcm9tcHQgZmlsZVwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBdHRhY2ggZmlsZSBzdWdnZXN0ZXIgZm9yIGN1c3RvbSBwcm9tcHRzXG4gICAgYXR0YWNoRmlsZVN1Z2dlc3RlcihcbiAgICAgIHRoaXMuY3VzdG9tSW5wdXQsXG4gICAgICBhc3luYyAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHNlbGVjdGVkUGF0aCk7XG4gICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gY29udGVudDtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCB2YWx1ZSB3aXRob3V0IC5tZCBleHRlbnNpb25cbiAgICAgICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSBzZWxlY3RlZFBhdGgucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZWFkaW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGhpcy5hcHAsXG4gICAgICB0aGlzLnN5c3RlbVByb21wdHNEaXJlY3RvcnlcbiAgICApO1xuXG4gICAgdGhpcy50ZXh0QXJlYSA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZUVsKFwidGV4dGFyZWFcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYVwiLFxuICAgICAgYXR0cjoge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJFbnRlciBwb3N0LXByb2Nlc3NpbmcgcHJvbXB0XCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQ7XG5cbiAgICAvLyBBZGQgcmVzaXplIG9ic2VydmVyIHRvIGhhbmRsZSBkeW5hbWljIGNvbnRlbnRcbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSB0aGlzLnRleHRBcmVhLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICB9KTtcbiAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMudGV4dEFyZWEpO1xuXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVDYW5jZWw7XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiU2F2ZVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZVNhdmUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBhY3RpdmVQcmVzZXQgPSB0aGlzLnByb21wdHMuZmluZCgocCkgPT4gcC5pZCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpO1xuICAgICAgdGhpcy5yZXN1bHQgPSB7XG4gICAgICAgIGNvbnRlbnQ6IHRoaXMudGV4dEFyZWEudmFsdWUsXG4gICAgICAgIHR5cGU6IChhY3RpdmVQcmVzZXQ/LmlkIHx8IFwiY3VzdG9tXCIpIGFzIFwiZ2VuZXJhbFwiIHwgXCJyaHltZVwiIHwgXCJjdXN0b21cIixcbiAgICAgICAgcGF0aDpcbiAgICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9PT0gXCJjdXN0b21cIiA/IHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgOiB1bmRlZmluZWQsXG4gICAgICB9O1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlU2F2ZTtcblxuICAgIC8vIEhhbmRsZSBrZXlib2FyZCBldmVudHNcbiAgICB0aGlzLm1vZGFsRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZS5rZXkgPT09IFwiRW50ZXJcIiAmJlxuICAgICAgICAhZS5pc0NvbXBvc2luZyAmJlxuICAgICAgICAhZS5zaGlmdEtleSAmJlxuICAgICAgICBlLnRhcmdldCAhPT0gdGhpcy50ZXh0QXJlYVxuICAgICAgKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlU2F2ZSgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUNhbmNlbCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgdGhlIHRleHRhcmVhIGFuZCBwbGFjZSBjdXJzb3IgYXQgdGhlIGVuZFxuICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICB0aGlzLnRleHRBcmVhLnNldFNlbGVjdGlvblJhbmdlKFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aFxuICAgICk7XG5cbiAgICAvLyBTdGFydCBsb2FkaW5nIHByb21wdHMgYWZ0ZXIgVUkgaXMgc2V0IHVwXG4gICAgYXdhaXQgdGhpcy5sb2FkUHJvbXB0cygpO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucmVzb2x2ZVByb21pc2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHwgbnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwoXG4gIGFwcDogQXBwLFxuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgY3VycmVudFByb21wdDogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk/OiBzdHJpbmc7XG4gICAgY3VycmVudEN1c3RvbVBhdGg/OiBzdHJpbmc7XG4gIH1cbik6IFByb21pc2U8UG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gIGNvbnN0IG1vZGFsID0gbmV3IFBvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwoXG4gICAgYXBwLFxuICAgIHBsdWdpbixcbiAgICBjdXJyZW50UHJvbXB0LFxuICAgIG9wdGlvbnM/LnN5c3RlbVByb21wdHNEaXJlY3RvcnksXG4gICAgb3B0aW9ucz8uY3VycmVudEN1c3RvbVBhdGhcbiAgKTtcbiAgcmV0dXJuIGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xufVxuIiwgImltcG9ydCB7IFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwgfSBmcm9tIFwiLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiIH0gZnJvbSBcIi4vbW9kYWxzL1NldHRpbmdzVGFiXCI7XG5pbXBvcnQgeyBSZWNvcmRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdENvbnRleHRNZW51IH0gZnJvbSBcIi4vY29tcG9uZW50cy9TeXN0ZW1TY3VscHRDb250ZXh0TWVudVwiO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9zZXR0aW5ncy9TZXR0aW5nc01hbmFnZXJcIjtcbmltcG9ydCB7IExpY2Vuc2VNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9saWNlbnNlL0xpY2Vuc2VNYW5hZ2VyXCI7XG5pbXBvcnQgeyBWaWV3TWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL3ZpZXdzXCI7XG5pbXBvcnQgeyBDb21tYW5kTWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL2NvbW1hbmRzXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9DdXN0b21Qcm92aWRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBUYXNrc1NlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9UYXNrc1NlcnZpY2VcIjtcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL01vZGVsU2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTeXN0ZW1TY3VscHRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgc2V0dGluZ3NUYWI6IFN5c3RlbVNjdWxwdFNldHRpbmdUYWI7XG4gIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlO1xuICBwcml2YXRlIGluaXRpYWxWYWxpZGF0aW9uRG9uZSA9IGZhbHNlO1xuICBwcml2YXRlIHJlY29yZGVyU2VydmljZTogUmVjb3JkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlcjtcbiAgcHJpdmF0ZSBsaWNlbnNlTWFuYWdlcjogTGljZW5zZU1hbmFnZXI7XG4gIHB1YmxpYyB0YXNrc1NlcnZpY2U6IFRhc2tzU2VydmljZTtcbiAgcHJpdmF0ZSB2aWV3TWFuYWdlcjogVmlld01hbmFnZXI7XG4gIHByaXZhdGUgY29tbWFuZE1hbmFnZXI6IENvbW1hbmRNYW5hZ2VyO1xuICBwcml2YXRlIGNvbnRleHRNZW51OiBTeXN0ZW1TY3VscHRDb250ZXh0TWVudTtcbiAgcHVibGljIG1vZGVsU2VydmljZTogTW9kZWxTZXJ2aWNlO1xuICBwcml2YXRlIGluaXRpYWxNb2RlbHM6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT47XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIC8vIEluaXRpYWxpemUgc2V0dGluZ3MgZmlyc3QgYXMgb3RoZXIgc2VydmljZXMgZGVwZW5kIG9uIGl0XG4gICAgdGhpcy5zZXR0aW5nc01hbmFnZXIgPSBuZXcgU2V0dGluZ3NNYW5hZ2VyKHRoaXMpO1xuICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmxvYWRTZXR0aW5ncygpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5ncygpO1xuXG4gICAgLy8gUmVnaXN0ZXIgLnNydCBmaWxlcyB0byBiZSBoYW5kbGVkIGJ5IG1hcmtkb3duIGVkaXRvclxuICAgIHRoaXMucmVnaXN0ZXJFeHRlbnNpb25zKFtcInNydFwiXSwgXCJtYXJrZG93blwiKTtcblxuICAgIC8vIEluaXRpYWxpemUgY29yZSBzZXJ2aWNlcyBpbiB0aGUgY29ycmVjdCBvcmRlclxuICAgIHRoaXMuY3VzdG9tUHJvdmlkZXJTZXJ2aWNlID0gbmV3IEN1c3RvbVByb3ZpZGVyU2VydmljZSh0aGlzKTtcbiAgICB0aGlzLm1vZGVsU2VydmljZSA9IE1vZGVsU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZVxuICAgICk7XG4gICAgdGhpcy5haVNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuc2V0dGluZ3MsIHRoaXMuYXBwKTtcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcyk7XG4gICAgdGhpcy5yZWNvcmRlclNlcnZpY2UgPSBSZWNvcmRlclNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcy5hcHAsIHRoaXMpO1xuICAgIHRoaXMuY29udGV4dE1lbnUgPSBuZXcgU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUoXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHRoaXMuYWlTZXJ2aWNlLFxuICAgICAgdGhpc1xuICAgICk7XG5cbiAgICAvLyBTZXQgU3lzdGVtU2N1bHB0U2VydmljZSBpbiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5zZXRTeXN0ZW1TY3VscHRTZXJ2aWNlKHRoaXMuYWlTZXJ2aWNlKTtcblxuICAgIC8vIFN0YXJ0IGxvYWRpbmcgaW5pdGlhbCBtb2RlbHNcbiAgICB0aGlzLmluaXRpYWxNb2RlbHMgPSB0aGlzLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcblxuICAgIC8vIEluaXRpYWxpemUgVUkgY29tcG9uZW50c1xuICAgIHRoaXMuc2V0dGluZ3NUYWIgPSBuZXcgU3lzdGVtU2N1bHB0U2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcyk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKHRoaXMuc2V0dGluZ3NUYWIpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBtYW5hZ2Vyc1xuICAgIHRoaXMubGljZW5zZU1hbmFnZXIgPSBuZXcgTGljZW5zZU1hbmFnZXIodGhpcywgdGhpcy5hcHApO1xuICAgIHRoaXMudGFza3NTZXJ2aWNlID0gbmV3IFRhc2tzU2VydmljZSh0aGlzKTtcbiAgICB0aGlzLnZpZXdNYW5hZ2VyID0gbmV3IFZpZXdNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcbiAgICB0aGlzLmNvbW1hbmRNYW5hZ2VyID0gbmV3IENvbW1hbmRNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcblxuICAgIC8vIEluaXRpYWxpemUgdmlld3MgYW5kIGNvbW1hbmRzXG4gICAgdGhpcy52aWV3TWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgdGhpcy5jb21tYW5kTWFuYWdlci5yZWdpc3RlckNvbW1hbmRzKCk7XG5cbiAgICAvLyBTdGFydCBsb2FkaW5nIHN5c3RlbSBwcm9tcHRzIGNhY2hlIGluIHRoZSBiYWNrZ3JvdW5kXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBzeXN0ZW0gcHJvbXB0cyBjYWNoZTpcIiwgZXJyb3IpO1xuICAgIH0pO1xuXG4gICAgLy8gV2FpdCBmb3IgaW5pdGlhbCBtb2RlbHMgdG8gbG9hZFxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxNb2RlbHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBpbml0aWFsIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9udW5sb2FkKCkge1xuICAgIGNvbnNvbGUubG9nKFwiU3lzdGVtU2N1bHB0IEFJIHBsdWdpbiB1bmxvYWRlZFwiKTtcbiAgICB0aGlzLnJlY29yZGVyU2VydmljZS51bmxvYWQoKTtcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnVubG9hZCgpO1xuICAgIHRoaXMudmlld01hbmFnZXIudW5sb2FkVmlld3MoKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWREYXRhKCkge1xuICAgIHJldHVybiBzdXBlci5sb2FkRGF0YSgpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZURhdGEoZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIHN1cGVyLnNhdmVEYXRhKGRhdGEpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNhdmVTZXR0aW5ncygpO1xuICB9XG5cbiAgZ2V0UmVjb3JkZXJTZXJ2aWNlKCk6IFJlY29yZGVyU2VydmljZSB7XG4gICAgcmV0dXJuIHRoaXMucmVjb3JkZXJTZXJ2aWNlO1xuICB9XG5cbiAgZ2V0VHJhbnNjcmlwdGlvblNlcnZpY2UoKTogVHJhbnNjcmlwdGlvblNlcnZpY2Uge1xuICAgIHJldHVybiB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlO1xuICB9XG5cbiAgZ2V0TGljZW5zZU1hbmFnZXIoKTogTGljZW5zZU1hbmFnZXIge1xuICAgIHJldHVybiB0aGlzLmxpY2Vuc2VNYW5hZ2VyO1xuICB9XG5cbiAgZ2V0U2V0dGluZ3NNYW5hZ2VyKCk6IFNldHRpbmdzTWFuYWdlciB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3NNYW5hZ2VyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaW5pdGlhbCBtb2RlbHMgcHJvbWlzZSB0aGF0IHdhcyBzdGFydGVkIGR1cmluZyBwbHVnaW4gbG9hZFxuICAgKi9cbiAgcHVibGljIGdldEluaXRpYWxNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuaW5pdGlhbE1vZGVscztcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4vTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgYXR0YWNoRm9sZGVyU3VnZ2VzdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9sZGVyU3VnZ2VzdGVyXCI7XG5pbXBvcnQgeyByZXF1ZXN0VXJsIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93U3lzdGVtUHJvbXB0TW9kYWwgfSBmcm9tIFwiLi9TeXN0ZW1Qcm9tcHRNb2RhbFwiO1xuXG5leHBvcnQgY2xhc3MgU3lzdGVtU2N1bHB0U2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBzeXN0ZW1TY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIGRlYm91bmNlVGltZXI6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc3lzdGVtU2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBwbHVnaW4uc2V0dGluZ3MsXG4gICAgICB0aGlzLmFwcFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlRGlyZWN0b3J5KHBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmICghcGF0aCkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIChcbiAgICAgICFwYXRoLmluY2x1ZGVzKFwiLi5cIikgJiYgIXBhdGguc3RhcnRzV2l0aChcIi9cIikgJiYgIXBhdGguc3RhcnRzV2l0aChcIlxcXFxcIilcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVEaXJlY3RvcnlDaGFuZ2UoXG4gICAgdmFsdWU6IHN0cmluZyxcbiAgICBzZXR0aW5nS2V5OlxuICAgICAgfCBcImF0dGFjaG1lbnRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJyZWNvcmRpbmdzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJjaGF0c0RpcmVjdG9yeVwiXG4gICAgICB8IFwiZXh0cmFjdGlvbnNEaXJlY3RvcnlcIlxuICAgICAgfCBcInN5c3RlbVByb21wdHNEaXJlY3RvcnlcIlxuICAgICAgfCBcInRhc2tzRGlyZWN0b3J5XCJcbiAgKSB7XG4gICAgaWYgKCF0aGlzLnZhbGlkYXRlRGlyZWN0b3J5KHZhbHVlKSkge1xuICAgICAgc2hvd1BvcHVwKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgXCJJbnZhbGlkIGRpcmVjdG9yeSBwYXRoLiBQbGVhc2UgdXNlIHJlbGF0aXZlIHBhdGhzIHdpdGhvdXQgJy4uJyBvciBsZWFkaW5nIHNsYXNoZXMuXCJcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGVib3VuY2VUaW1lcikgY2xlYXJUaW1lb3V0KHRoaXMuZGVib3VuY2VUaW1lcik7XG5cbiAgICB0aGlzLmRlYm91bmNlVGltZXIgPSBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldID0gdmFsdWU7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICB9LCA1MDApO1xuICB9XG5cbiAgYXN5bmMgZGlzcGxheSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAvLyBNYWluIGNvbnRhaW5lciB3aXRoIHRhYnNcbiAgICBjb25zdCBtYWluQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3MtY29udGFpbmVyXCJcbiAgICApO1xuICAgIG1haW5Db250YWluZXIuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiU3lzdGVtU2N1bHB0IEFJIFNldHRpbmdzXCIgfSk7XG5cbiAgICAvLyBUYWIgbmF2aWdhdGlvblxuICAgIGNvbnN0IHRhYkNvbnRhaW5lciA9IG1haW5Db250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXNldHRpbmdzLXRhYnNcIik7XG4gICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IG1haW5Db250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3MtY29udGVudFwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0YWJzXG4gICAgY29uc3QgdGFicyA9IFtcbiAgICAgIHsgaWQ6IFwibGljZW5zZVwiLCBsYWJlbDogXCJMaWNlbnNlXCIgfSxcbiAgICAgIHsgaWQ6IFwiZGlyZWN0b3JpZXNcIiwgbGFiZWw6IFwiRGlyZWN0b3JpZXNcIiB9LFxuICAgICAgeyBpZDogXCJyZWNvcmRlclwiLCBsYWJlbDogXCJSZWNvcmRlclwiIH0sXG4gICAgICB7IGlkOiBcImNoYXRcIiwgbGFiZWw6IFwiQ2hhdFwiIH0sXG4gICAgICB7IGlkOiBcInRhc2tzXCIsIGxhYmVsOiBcIlRhc2tzXCIgfSxcbiAgICAgIHsgaWQ6IFwiYWR2YW5jZWRcIiwgbGFiZWw6IFwiQWR2YW5jZWRcIiB9LFxuICAgIF07XG5cbiAgICAvLyBBZGQgdGFiIGJ1dHRvbnNcbiAgICB0YWJzLmZvckVhY2goKHRhYikgPT4ge1xuICAgICAgY29uc3QgdGFiQnV0dG9uID0gdGFiQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10YWItYnV0dG9uXCIsXG4gICAgICAgIHRleHQ6IHRhYi5sYWJlbCxcbiAgICAgIH0pO1xuICAgICAgdGFiQnV0dG9uLmRhdGFzZXQudGFiID0gdGFiLmlkO1xuICAgICAgaWYgKHRhYi5pZCA9PT0gXCJsaWNlbnNlXCIpIHRhYkJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0YWIgY29udGVudCBzZWN0aW9uc1xuICAgIGNvbnN0IGlzUHJvQWN0aXZlID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID09PSB0cnVlO1xuICAgIGNvbnN0IGxpY2Vuc2VDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10YWItY29udGVudCBhY3RpdmVcIlxuICAgICk7XG4gICAgY29uc3QgZGlyZWN0b3JpZXNDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiXG4gICAgKTtcbiAgICBjb25zdCByZWNvcmRlckNvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCJcbiAgICApO1xuICAgIGNvbnN0IGNoYXRDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIik7XG4gICAgY29uc3QgdGFza3NDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIik7XG4gICAgY29uc3QgYWR2YW5jZWRDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBjb250ZW50IHRvIGVhY2ggdGFiXG4gICAgdGhpcy5kaXNwbGF5TGljZW5zZVRhYihsaWNlbnNlQ29udGVudCwgaXNQcm9BY3RpdmUpO1xuICAgIHRoaXMuZGlzcGxheURpcmVjdG9yaWVzVGFiKGRpcmVjdG9yaWVzQ29udGVudCwgaXNQcm9BY3RpdmUpO1xuICAgIHRoaXMuZGlzcGxheVJlY29yZGVyVGFiKHJlY29yZGVyQ29udGVudCk7XG4gICAgdGhpcy5kaXNwbGF5Q2hhdFRhYihjaGF0Q29udGVudCk7XG4gICAgdGhpcy5kaXNwbGF5VGFza3NUYWIodGFza3NDb250ZW50KTtcbiAgICB0aGlzLmRpc3BsYXlBZHZhbmNlZFRhYihhZHZhbmNlZENvbnRlbnQpO1xuXG4gICAgLy8gQWRkIHRhYiBjbGljayBoYW5kbGVyc1xuICAgIHRhYkNvbnRhaW5lclxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXRhYi1idXR0b25cIilcbiAgICAgIC5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgIGNvbnN0IHRhYklkID0gdGFyZ2V0LmRhdGFzZXQudGFiO1xuXG4gICAgICAgICAgLy8gUmVtb3ZlIGFjdGl2ZSBjbGFzc2VzXG4gICAgICAgICAgdGFiQ29udGFpbmVyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvblwiKVxuICAgICAgICAgICAgLmZvckVhY2goKGIpID0+IGIuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKSk7XG4gICAgICAgICAgY29udGVudENvbnRhaW5lclxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCIpXG4gICAgICAgICAgICAuZm9yRWFjaCgoYykgPT4gYy5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpKTtcblxuICAgICAgICAgIC8vIEFkZCBhY3RpdmUgY2xhc3NlcyB0byBzZWxlY3RlZCB0YWJcbiAgICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFiPVwiJHt0YWJJZH1cIl1gKVxuICAgICAgICAgICAgPy5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgLy8gQWRkIHN0eWxlcyBpZiBub3QgYWxyZWFkeSBhZGRlZFxuICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3Mtc3R5bGVzXCIpKSB7XG4gICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgICAgIHN0eWxlLmlkID0gXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3Mtc3R5bGVzXCI7XG4gICAgICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAgIC5zeXN0ZW1zY3VscHQtc2V0dGluZ3MtdGFicyB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICAgICAgZ2FwOiA0cHg7XG4gICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7XG4gICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICAgIHBhZGRpbmctYm90dG9tOiA4cHg7XG4gICAgICAgIG1heC13aWR0aDogMTAwJTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uIHtcbiAgICAgICAgYmFja2dyb3VuZDogbm9uZTtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgICBwYWRkaW5nOiA2cHggMTJweDtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG4gICAgICAgIGZvbnQtc2l6ZTogMC45ZW07XG4gICAgICAgIGZsZXg6IDEgMSBhdXRvO1xuICAgICAgICBtaW4td2lkdGg6IDEyMHB4O1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvbjpob3ZlciB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItaG92ZXIpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1idXR0b24uYWN0aXZlIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtb24tYWNjZW50KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItY29udGVudCB7XG4gICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICAgIG1heC13aWR0aDogMTAwJTtcbiAgICAgICAgb3ZlcmZsb3cteDogaGlkZGVuO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1jb250ZW50LmFjdGl2ZSB7XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICBwYWRkaW5nOiAwIDhweDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLyogTGljZW5zZSBUYWIgU3R5bGluZyAqL1xuICAgICAgLnN5c3RlbXNjdWxwdC1saWNlbnNlLWlucHV0IHtcbiAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgIG1heC13aWR0aDogNDAwcHg7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5wcm8tYmFkZ2Uge1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1vbi1hY2NlbnQpO1xuICAgICAgICBwYWRkaW5nOiAycHggOHB4O1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGZvbnQtc2l6ZTogMC44ZW07XG4gICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgICAgIG1hcmdpbi1sZWZ0OiA4cHg7XG4gICAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC50b2tlbi1iYWxhbmNlLXZhbHVlIHtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtYWNjZW50KTtcbiAgICAgICAgbWFyZ2luLWxlZnQ6IDhweDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnByby1mZWF0dXJlcy1ncmlkIC5zZXR0aW5nLWl0ZW0ge1xuICAgICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnktYWx0KTtcbiAgICAgICAgbWFyZ2luOiA0cHggMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnByby1iZW5lZml0cy1saXN0IHtcbiAgICAgICAgbWFyZ2luOiAxNnB4IDA7XG4gICAgICAgIHBhZGRpbmctbGVmdDogMjBweDtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWJlbmVmaXRzLWxpc3QgbGkge1xuICAgICAgICBtYXJnaW46IDhweCAwO1xuICAgICAgICBsaXN0LXN0eWxlLXR5cGU6ICdcdTIxOTInO1xuICAgICAgICBwYWRkaW5nLWxlZnQ6IDIwcHg7XG4gICAgICAgIHRleHQtaW5kZW50OiAtMTJweDtcbiAgICAgICAgd29yZC1icmVhazogYnJlYWstd29yZDtcbiAgICAgIH1cbiAgICBgO1xuICAgICAgbWFpbkNvbnRhaW5lci5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5TGljZW5zZVRhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQsIGlzUHJvQWN0aXZlOiBib29sZWFuKSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImxpY2Vuc2VcIjtcbiAgICBjb25zdCBsaWNlbnNlU2V0dGluZ0NvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWxpY2Vuc2Utc2V0dGluZ3NcIlxuICAgICk7XG5cbiAgICBsaWNlbnNlU2V0dGluZ0NvbnRhaW5lci5jcmVhdGVFbChcImgzXCIsIHtcbiAgICAgIHRleHQ6IFwiU3lzdGVtU2N1bHB0IExpY2Vuc2VcIixcbiAgICB9KTtcblxuICAgIC8vIExpY2Vuc2UgS2V5IFNlY3Rpb25cbiAgICBjb25zdCBsaWNlbnNlU2V0dGluZyA9IG5ldyBTZXR0aW5nKGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyKVxuICAgICAgLnNldE5hbWUoXCJMaWNlbnNlIEtleVwiKVxuICAgICAgLnNldERlc2MoXCJVbmxvY2sgUHJvIGZlYXR1cmVzIHdpdGggeW91ciBsaWNlbnNlIGtleVwiKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIlBhc3RlIGxpY2Vuc2Uga2V5XCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXkpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuaW5wdXRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1saWNlbnNlLWlucHV0XCIpO1xuICAgICAgICB0ZXh0LmlucHV0RWwudHlwZSA9IFwicGFzc3dvcmRcIjtcbiAgICAgICAgdGV4dC5pbnB1dEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBcIm1vbm9zcGFjZVwiO1xuICAgICAgICB0ZXh0LmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsICgpID0+IHtcbiAgICAgICAgICB0ZXh0LmlucHV0RWwudHlwZSA9IFwidGV4dFwiO1xuICAgICAgICAgIHRleHQuaW5wdXRFbC5zdHlsZS5mb250RmFtaWx5ID0gXCJpbmhlcml0XCI7XG4gICAgICAgIH0pO1xuICAgICAgICB0ZXh0LmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgKCkgPT4ge1xuICAgICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gXCJwYXNzd29yZFwiO1xuICAgICAgICAgIHRleHQuaW5wdXRFbC5zdHlsZS5mb250RmFtaWx5ID0gXCJtb25vc3BhY2VcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgfSlcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT4ge1xuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUoaXNQcm9BY3RpdmUpXG4gICAgICAgICAgLnNldFRvb2x0aXAoXG4gICAgICAgICAgICBpc1Byb0FjdGl2ZSA/IFwiRGlzYWJsZSBQcm8gZmVhdHVyZXNcIiA6IFwiRW5hYmxlIFBybyBmZWF0dXJlc1wiXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAvLyBPbmx5IHZhbGlkYXRlIHdoZW4gdG9nZ2xpbmcgT05cbiAgICAgICAgICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMucGx1Z2luXG4gICAgICAgICAgICAgICAgLmdldExpY2Vuc2VNYW5hZ2VyKClcbiAgICAgICAgICAgICAgICAudmFsaWRhdGVMaWNlbnNlS2V5KHRydWUpO1xuICAgICAgICAgICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHNob3dQb3B1cChcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgXCJJbnZhbGlkIGxpY2Vuc2Uga2V5IC0gUHJvIGZlYXR1cmVzIGRpc2FibGVkXCJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAoaXNQcm9BY3RpdmUpIHtcbiAgICAgICAgICB0b2dnbGUudG9nZ2xlRWwuYWRkQ2xhc3MoXCJtb2QtY3RhXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIGlmIChpc1Byb0FjdGl2ZSkge1xuICAgICAgY29uc3Qgc3RhdHVzU2V0dGluZyA9IG5ldyBTZXR0aW5nKGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyKVxuICAgICAgICAuc2V0TmFtZShcIlBybyBTdGF0dXNcIilcbiAgICAgICAgLnNldERlc2MoXCJBY3RpdmUgc3Vic2NyaXB0aW9uIFx1MjAyMiBQcmVtaXVtIGZlYXR1cmVzIGVuYWJsZWRcIik7XG5cbiAgICAgIHN0YXR1c1NldHRpbmcubmFtZUVsLmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwicHJvLWJhZGdlXCIsXG4gICAgICAgIHRleHQ6IFwiQUNUSVZFXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYmFsYW5jZUVsID0gY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJ0b2tlbi1iYWxhbmNlLXZhbHVlXCIsXG4gICAgICAgIHRleHQ6IFwiTG9hZGluZy4uLlwiLFxuICAgICAgfSk7XG5cbiAgICAgIHN0YXR1c1NldHRpbmcuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0SWNvbihcInNwYXJrbGVzXCIpXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJBdmFpbGFibGUgY3JlZGl0c1wiKVxuICAgICAgICAgIC5zZXREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgc3RhdHVzU2V0dGluZy5jb250cm9sRWwuYXBwZW5kQ2hpbGQoYmFsYW5jZUVsKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kaXNwbGF5VG9rZW5CYWxhbmNlKGJhbGFuY2VFbCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIFBybyBwcm9tb3Rpb24gc2VjdGlvbiBpZiBub3QgYWN0aXZlXG4gICAgdGhpcy5kaXNwbGF5UHJvUHJvbW90aW9uU2VjdGlvbihsaWNlbnNlU2V0dGluZ0NvbnRhaW5lciwgaXNQcm9BY3RpdmUpO1xuXG4gICAgLy8gQWRkIGJldGEgbm90aWNlIHNlY3Rpb25cbiAgICBjb25zdCBiZXRhTm90aWNlRWwgPSBsaWNlbnNlU2V0dGluZ0NvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJldGEtbm90aWNlXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBoZWFkZXJDb250YWluZXIgPSBiZXRhTm90aWNlRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcImJldGEtbm90aWNlLWhlYWRlclwiLFxuICAgIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoaGVhZGVyQ29udGFpbmVyKVxuICAgICAgLnNldEhlYWRpbmcoKVxuICAgICAgLnNldE5hbWUoXCJCZXRhIFRlc3RpbmcgUGhhc2VcIilcbiAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRJY29uKFwicm9ja2V0XCIpXG4gICAgICAgICAgLnNldERpc2FibGVkKHRydWUpXG4gICAgICAgICAgLmV4dHJhU2V0dGluZ3NFbC5hZGRDbGFzcyhcImJldGEtaGVhZGVyLWljb25cIik7XG4gICAgICB9KTtcblxuICAgIGJldGFOb3RpY2VFbC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgdGV4dDogXCJUaGFuayB5b3UgZm9yIHRyeWluZyBvdXQgU3lzdGVtU2N1bHB0ISBXaGlsZSBzb21lIGNvcmUgZmVhdHVyZXMgYXJlIGF2YWlsYWJsZSB0byBldmVyeW9uZSBkdXJpbmcgdGhpcyBiZXRhIHBoYXNlLCBjZXJ0YWluIGFkdmFuY2VkIGNhcGFiaWxpdGllcyBhcmUgY3VycmVudGx5IGxpbWl0ZWQgdG8gUGF0cmVvbiBtZW1iZXJzIHRvIGhlbHAgbWFuYWdlIHRoZSB0ZXN0aW5nIGdyb3VwIHNpemUuXCIsXG4gICAgICBjbHM6IFwiYmV0YS1ub3RpY2UtdGV4dFwiLFxuICAgIH0pO1xuXG4gICAgYmV0YU5vdGljZUVsLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBcIkFzIGEgc29sbyBkZXZlbG9wZXIsIHlvdXIgZmVlZGJhY2sgaXMgaW5jcmVkaWJseSB2YWx1YWJsZSBpbiBzaGFwaW5nIFN5c3RlbVNjdWxwdC4gRmVlbCBmcmVlIHRvIHRlc3QgdGhlIGF2YWlsYWJsZSBmZWF0dXJlcywgYW5kIGlmIHlvdSdkIGxpa2UgYWNjZXNzIHRvIHRoZSBmdWxsIGJldGEgZXhwZXJpZW5jZSwgY29uc2lkZXIgYmVjb21pbmcgYSBQYXRyZW9uIHN1cHBvcnRlciFcIixcbiAgICAgIGNsczogXCJiZXRhLW5vdGljZS10ZXh0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgc3R5bGVzIGlmIG5vdCBhbHJlYWR5IGFkZGVkXG4gICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN5c3RlbXNjdWxwdC1iZXRhLXN0eWxlc1wiKSkge1xuICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICBzdHlsZS5pZCA9IFwic3lzdGVtc2N1bHB0LWJldGEtc3R5bGVzXCI7XG4gICAgICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAgICAgLnN5c3RlbXNjdWxwdC1iZXRhLW5vdGljZSB7XG4gICAgICAgICAgbWFyZ2luLXRvcDogMzJweDtcbiAgICAgICAgICBwYWRkaW5nOiAyMHB4O1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgICAgICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLW5vdGljZS1oZWFkZXIge1xuICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtaGVhZGVyIC5zZXR0aW5nLWl0ZW0ge1xuICAgICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtbm90aWNlLWhlYWRlciAuc2V0dGluZy1pdGVtLW5hbWUge1xuICAgICAgICAgIGZvbnQtc2l6ZTogMS4yZW07XG4gICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtaGVhZGVyLWljb24ge1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpICFpbXBvcnRhbnQ7XG4gICAgICAgICAgYmFja2dyb3VuZDogbm9uZSAhaW1wb3J0YW50O1xuICAgICAgICAgIHBhZGRpbmc6IDAgIWltcG9ydGFudDtcbiAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDhweCAhaW1wb3J0YW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtbm90aWNlLXRleHQge1xuICAgICAgICAgIG1hcmdpbjogMTJweCAwO1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNjtcbiAgICAgICAgICBmb250LXNpemU6IDAuOTVlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIC50aGVtZS1kYXJrIC5zeXN0ZW1zY3VscHQtYmV0YS1ub3RpY2Uge1xuICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsIDAsIDAsIDAuMik7XG4gICAgICAgIH1cbiAgICAgIGA7XG4gICAgICBjb250YWluZXJFbC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkaXNwbGF5VG9rZW5CYWxhbmNlKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBiYWxhbmNlID0gYXdhaXQgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlLmdldFRva2VuQmFsYW5jZSgpO1xuICAgICAgY29udGFpbmVyRWwuc2V0VGV4dChgQXZhaWxhYmxlIENyZWRpdHM6ICR7YmFsYW5jZS50b0xvY2FsZVN0cmluZygpfWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb250YWluZXJFbC5zZXRUZXh0KFwiVW5hYmxlIHRvIGZldGNoIGNyZWRpdCBiYWxhbmNlXCIpO1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCB0b2tlbiBiYWxhbmNlOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5UHJvUHJvbW90aW9uU2VjdGlvbihcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXG4gICAgaXNQcm9BY3RpdmU6IGJvb2xlYW5cbiAgKSB7XG4gICAgaWYgKCFpc1Byb0FjdGl2ZSkge1xuICAgICAgY29uc3QgcHJvUHJvbW90aW9uRWwgPSBjb250YWluZXJFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvLXByb21vdGlvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IHByb1Byb21vdGlvbkVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInByby1wcm9tb3Rpb24taGVhZGVyXCIsXG4gICAgICB9KTtcblxuICAgICAgbmV3IFNldHRpbmcoaGVhZGVyQ29udGFpbmVyKVxuICAgICAgICAuc2V0SGVhZGluZygpXG4gICAgICAgIC5zZXROYW1lKFwiVXBncmFkZSB0byBQcm9cIilcbiAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgICBidXR0b25cbiAgICAgICAgICAgIC5zZXRJY29uKFwic3BhcmtsZXNcIilcbiAgICAgICAgICAgIC5zZXREaXNhYmxlZCh0cnVlKVxuICAgICAgICAgICAgLmV4dHJhU2V0dGluZ3NFbC5hZGRDbGFzcyhcInByby1oZWFkZXItaWNvblwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIHByb1Byb21vdGlvbkVsLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICAgIHRleHQ6IFwiVHJhbnNmb3JtIHlvdXIgd29ya2Zsb3cgd2l0aCBwb3dlcmZ1bCBBSSBmZWF0dXJlcyBkZXNpZ25lZCBmb3Igc2VyaW91cyBwcm9kdWN0aXZpdHkuXCIsXG4gICAgICAgIGNsczogXCJwcm8tcHJvbW90aW9uLXRleHRcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBiZW5lZml0c0xpc3QgPSBwcm9Qcm9tb3Rpb25FbC5jcmVhdGVFbChcInVsXCIsIHtcbiAgICAgICAgY2xzOiBcInByby1iZW5lZml0cy1saXN0XCIsXG4gICAgICB9KTtcblxuICAgICAgW1xuICAgICAgICBcIkF1ZGlvIFJlY29yZGluZyAmIEluc3RhbnQgVHJhbnNjcmlwdGlvblwiLFxuICAgICAgICBcIlNtYXJ0IERvY3VtZW50IFByb2Nlc3NpbmdcIixcbiAgICAgICAgXCJSZWFsLXRpbWUgVm9pY2UtdG8tVGV4dCBpbiBOb3RlcyAmIENoYXRcIixcbiAgICAgICAgXCJNdWx0aS1mb3JtYXQgU3VwcG9ydCAoUERGLCBBdWRpbywgSW1hZ2VzKVwiLFxuICAgICAgICBcIkFJIFRlbXBsYXRlcyAmIEN1c3RvbSBQZXJzb25hbGl0aWVzXCIsXG4gICAgICAgIFwiUHJpb3JpdHkgQWNjZXNzIHRvIE5ldyBGZWF0dXJlc1wiLFxuICAgICAgICBcIjEtb24tMSBTdXBwb3J0IHZpYSBQYXRyZW9uIERNc1wiLFxuICAgICAgICBcIlN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgRGV2ZWxvcG1lbnRcIixcbiAgICAgIF0uZm9yRWFjaCgoYmVuZWZpdCkgPT4ge1xuICAgICAgICBiZW5lZml0c0xpc3QuY3JlYXRlRWwoXCJsaVwiLCB7IHRleHQ6IGJlbmVmaXQgfSk7XG4gICAgICB9KTtcblxuICAgICAgbmV3IFNldHRpbmcocHJvUHJvbW90aW9uRWwpLmFkZEJ1dHRvbigoYnV0dG9uKSA9PlxuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkJlY29tZSBhIFBhdHJvblwiKVxuICAgICAgICAgIC5zZXRDdGEoKVxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKFwiaHR0cHM6Ly9wYXRyZW9uLmNvbS9TeXN0ZW1TY3VscHRcIiwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5QWR2YW5jZWRUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImFkdmFuY2VkXCI7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGV2ZWxvcG1lbnQgTW9kZVwiKVxuICAgICAgLnNldERlc2MoXCJUb2dnbGUgYmV0d2VlbiBkZXZlbG9wbWVudCBhbmQgcHJvZHVjdGlvbiBBUEkgZW5kcG9pbnRzXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXJ2ZXJVcmwgPSB2YWx1ZVxuICAgICAgICAgICAgICA/IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCJcbiAgICAgICAgICAgICAgOiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb21cIjtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgbmV3IE5vdGljZShcbiAgICAgICAgICAgICAgYFN3aXRjaGVkIHRvICR7dmFsdWUgPyBcImRldmVsb3BtZW50XCIgOiBcInByb2R1Y3Rpb25cIn0gbW9kZSAoJHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgICAgICAgICB9KWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBjb25zdCBtb2RlbFNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQUkgTW9kZWxcIilcbiAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHdoaWNoIEFJIG1vZGVsIHRvIHVzZSBmb3IgY2hhdFwiKTtcblxuICAgIG1vZGVsU2V0dGluZy5hZGRCdXR0b24oKGJ1dHRvbikgPT5cbiAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KFwiU2VsZWN0IE1vZGVsXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICBidXR0b24uc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgICAgICAgICAgY29uc3QgbW9kZWxEaXNwbGF5ID0gY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBcIi5zeXN0ZW1zY3VscHQtY3VycmVudC1tb2RlbFwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGlmIChtb2RlbERpc3BsYXkpIHtcbiAgICAgICAgICAgICAgICBtb2RlbERpc3BsYXkuc2V0VGV4dChgQ3VycmVudCBtb2RlbDogJHttb2RlbElkfWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gbG9hZCBhdmFpbGFibGUgbW9kZWxzXCIpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGJ1dHRvbi5zZXREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIG1vZGVsU2V0dGluZy5kZXNjRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgdGV4dDogYEN1cnJlbnQgbW9kZWw6ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkfWAsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1cnJlbnQtbW9kZWxcIixcbiAgICB9KTtcblxuICAgIC8vIEZpbmFsbHksIG1vdmUgdGhlIFwiUmVzZXQgdG8gRmFjdG9yeSBTZXR0aW5nc1wiIGJ1dHRvbiBoZXJlLCBhZnRlciBtb2RlbCBzZXR0aW5nc1xuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJSZXNldCB0byBGYWN0b3J5IFNldHRpbmdzXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJDbGVhciBhbGwgY3VzdG9tIHNldHRpbmdzIGFuZCByZXN0b3JlIGRlZmF1bHRzIGZvciB0aGlzIHBsdWdpbi5cIlxuICAgICAgKVxuICAgICAgLmFkZEJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KFwiUmVzZXRcdTIwMjZcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29uZmlybSA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgXCJSZXNldCB0byBGYWN0b3J5IERlZmF1bHRzXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICAgIFwiVGhpcyB3aWxsIGRlbGV0ZSBBTEwgc2F2ZWQgc2V0dGluZ3MgYW5kIGN1c3RvbWl6YXRpb25zIGZvciBTeXN0ZW1TY3VscHQsIHJldHVybmluZyBldmVyeXRoaW5nIHRvIGRlZmF1bHQuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlP1wiLFxuICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlJlc2V0ICYgUmVsb2FkXCIsXG4gICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghY29uZmlybSB8fCAhY29uZmlybS5jb25maXJtZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gT3ZlcndyaXRlIHRoZSB1c2VyJ3MgY3VycmVudCBzZXR0aW5ncyB3aXRoIG91ciBkZWZhdWx0IGZhY3RvcnkgdmFsdWVzOlxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICAgLmdldFNldHRpbmdzTWFuYWdlcigpXG4gICAgICAgICAgICAgIC51cGRhdGVTZXR0aW5ncyhERUZBVUxUX1NFVFRJTkdTKTtcblxuICAgICAgICAgICAgLy8gRmluYWxseSwgcmVsb2FkIE9ic2lkaWFuXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXNldHRpbmcgdG8gZmFjdG9yeSBzZXR0aW5nczpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIkZhaWxlZCB0byByZXNldDogXCIgKyBTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRpc3BsYXlEaXJlY3Rvcmllc1RhYihcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXG4gICAgaXNQcm9BY3RpdmU6IGJvb2xlYW5cbiAgKSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImRpcmVjdG9yaWVzXCI7XG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoM1wiLCB7IHRleHQ6IFwiRGlyZWN0b3J5IFNldHRpbmdzXCIgfSk7XG5cbiAgICAvLyBDb3JlIGRpcmVjdG9yaWVzIChhbHdheXMgYXZhaWxhYmxlKVxuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJDaGF0cyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgY2hhdCBoaXN0b3J5XCIsXG4gICAgICBcImNoYXRzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9DaGF0c1wiXG4gICAgKTtcblxuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJSZWNvcmRpbmdzIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSBmb3IgeW91ciByZWNvcmRpbmdzXCIsXG4gICAgICBcInJlY29yZGluZ3NEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L1JlY29yZGluZ3NcIlxuICAgICk7XG5cbiAgICAvLyBDaGFuZ2VkIHRvIFwiU3lzdGVtIFByb21wdHNcIlxuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJTeXN0ZW0gUHJvbXB0cyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgY3VzdG9tIHN5c3RlbSBwcm9tcHRzXCIsXG4gICAgICBcInN5c3RlbVByb21wdHNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCJcbiAgICApO1xuXG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIkF0dGFjaG1lbnRzIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSBmb3Igc2F2ZWQgaW1hZ2VzIGFuZCBhdHRhY2htZW50c1wiLFxuICAgICAgXCJhdHRhY2htZW50c0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvQXR0YWNobWVudHNcIlxuICAgICk7XG5cbiAgICAvLyBBbHdheXMgZGlzcGxheSB0aGVzZSBkaXJlY3Rvcmllc1xuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJFeHRyYWN0aW9ucyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3Rvcnkgd2hlcmUgZXh0cmFjdGVkIFBERnMvZG9jcyB3aWxsIGJlIHBsYWNlZFwiLFxuICAgICAgXCJleHRyYWN0aW9uc0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvRXh0cmFjdGlvbnNcIlxuICAgICk7XG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIlRhc2tzIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSBmb3IgeW91ciB0YXNrIGxpc3RzXCIsXG4gICAgICBcInRhc2tzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9UYXNrc1wiXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGRlc2M6IHN0cmluZyxcbiAgICBzZXR0aW5nS2V5OlxuICAgICAgfCBcImF0dGFjaG1lbnRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJyZWNvcmRpbmdzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJjaGF0c0RpcmVjdG9yeVwiXG4gICAgICB8IFwiZXh0cmFjdGlvbnNEaXJlY3RvcnlcIlxuICAgICAgfCBcInN5c3RlbVByb21wdHNEaXJlY3RvcnlcIlxuICAgICAgfCBcInRhc2tzRGlyZWN0b3J5XCIsXG4gICAgcGxhY2Vob2xkZXI6IHN0cmluZ1xuICApIHtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKG5hbWUpXG4gICAgICAuc2V0RGVzYyhkZXNjKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihwbGFjZWhvbGRlcilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVEaXJlY3RvcnlDaGFuZ2UodmFsdWUsIHNldHRpbmdLZXkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGF0dGFjaEZvbGRlclN1Z2dlc3RlcihcbiAgICAgICAgICB0ZXh0LmlucHV0RWwsXG4gICAgICAgICAgYXN5bmMgKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy52YWxpZGF0ZURpcmVjdG9yeShzZWxlY3RlZFBhdGgpKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldID0gc2VsZWN0ZWRQYXRoO1xuICAgICAgICAgICAgICB0ZXh0LnNldFZhbHVlKHNlbGVjdGVkUGF0aCk7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgIFwiSW52YWxpZCBkaXJlY3RvcnkgcGF0aC4gUGxlYXNlIHVzZSByZWxhdGl2ZSBwYXRocyB3aXRob3V0ICcuLicgb3IgbGVhZGluZyBzbGFzaGVzLlwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0aGlzLmFwcFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5Q2hhdFRhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwiY2hhdFwiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIkNoYXQgU2V0dGluZ3NcIiB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJDaGF0IFN5c3RlbSBQcm9tcHRcIilcbiAgICAgIC5zZXREZXNjKFwiQ3VzdG9taXplIHRoZSBzeXN0ZW0gcHJvbXB0IHVzZWQgZm9yIGFsbCBuZXcgY2hhdHNcIilcbiAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dChcIkVkaXQgUHJvbXB0XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dTeXN0ZW1Qcm9tcHRNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBvblNhdmU6IGFzeW5jIChuZXdQcm9tcHQpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBXZSdsbCBzdG9yZSB0aGUgbmV3UHJvbXB0IGluIHBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQgPSBuZXdQcm9tcHQ7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIC8vIGNoYW5nZWQgZmFsbGJhY2sgdG8gXCJTeXN0ZW0gUHJvbXB0c1wiXG4gICAgICAgICAgICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgbW9kZTogXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICAgIGN1c3RvbVByb21wdEZpbGVQYXRoOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAocmVzdWx0Py5jb250ZW50KSB7XG4gICAgICAgICAgICAvLyBJZiB1c2VyIGFjdHVhbGx5IGNsaWNrZWQgXCJTYXZlXCIgaW4gdGhlIG1vZGFsXG4gICAgICAgICAgICAvLyBTZXQgcGx1Z2luIHNldHRpbmdzIGFjY29yZGluZ2x5OlxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0ID0gcmVzdWx0LmNvbnRlbnQ7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlID0gcmVzdWx0LnR5cGU7XG4gICAgICAgICAgICBpZiAocmVzdWx0Py50eXBlID09PSBcImN1c3RvbVwiICYmIHJlc3VsdD8ucGF0aCkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoID0gcmVzdWx0LnBhdGg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidXR0b247XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheVJlY29yZGVyVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJyZWNvcmRlclwiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIlJlY29yZGluZyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgY29uc3QgbWljcm9waG9uZVNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUHJlZmVycmVkIE1pY3JvcGhvbmVcIilcbiAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHlvdXIgcHJlZmVycmVkIG1pY3JvcGhvbmUgZm9yIHJlY29yZGluZ3NcIik7XG5cbiAgICBjb25zdCBtaWNTZWxlY3QgPSBtaWNyb3Bob25lU2V0dGluZy5jb250cm9sRWwuY3JlYXRlRWwoXCJzZWxlY3RcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1taWNyb3Bob25lLXNlbGVjdFwiLFxuICAgIH0pO1xuXG4gICAgbWljU2VsZWN0XG4gICAgICAuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICB2YWx1ZTogXCJcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nIG1pY3JvcGhvbmVzLi4uXCIsXG4gICAgICB9KVxuICAgICAgLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcblxuICAgIG1pY1NlbGVjdC5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlc1xuICAgICAgICAuZW51bWVyYXRlRGV2aWNlcygpXG4gICAgICAgIC50aGVuKChkZXZpY2VzKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWljcm9waG9uZXMgPSBkZXZpY2VzLmZpbHRlcihcbiAgICAgICAgICAgIChkZXZpY2UpID0+IGRldmljZS5raW5kID09PSBcImF1ZGlvaW5wdXRcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgbWljU2VsZWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgbWljU2VsZWN0LmZpcnN0RWxlbWVudENoaWxkPy5yZW1vdmUoKTsgLy8gUmVtb3ZlIGxvYWRpbmcgbWVzc2FnZVxuICAgICAgICAgIG1pY3JvcGhvbmVzLmZvckVhY2goKG1pYykgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gbWljU2VsZWN0LmNyZWF0ZUVsKFwib3B0aW9uXCIsIHtcbiAgICAgICAgICAgICAgdmFsdWU6IG1pYy5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgdGV4dDogbWljLmxhYmVsIHx8IGBNaWNyb3Bob25lICR7bWljLmRldmljZUlkLnNsaWNlKDAsIDgpfS4uLmAsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChtaWMuZGV2aWNlSWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCkge1xuICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVudW1lcmF0aW5nIGF1ZGlvIGRldmljZXM6XCIsIGVycm9yKTtcbiAgICAgICAgICBtaWNTZWxlY3QuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIlVuYWJsZSB0byBsaXN0IG1pY3JvcGhvbmVzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTWljcm9waG9uZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICBtaWNTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQgPSBtaWNTZWxlY3QudmFsdWU7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBdXRvLVRyYW5zY3JpYmUgUmVjb3JkaW5nc1wiKVxuICAgICAgLnNldERlc2MoXCJBdXRvbWF0aWNhbGx5IHRyYW5zY3JpYmUgcmVjb3JkaW5ncyB3aGVuIHRoZXkgYXJlIGNvbXBsZXRlZFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9UcmFuc2NyaWJlUmVjb3JkaW5ncyA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQXV0by1QYXN0ZSBUcmFuc2NyaXB0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgcGFzdGUgdHJhbnNjcmlwdGlvbnMgaW50byB0aGUgYWN0aXZlIGRvY3VtZW50XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvUGFzdGVUcmFuc2NyaXB0aW9uKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9QYXN0ZVRyYW5zY3JpcHRpb24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgLy8gQWRkIG5ldyBwb3N0LXByb2Nlc3NpbmcgcHJvbXB0IHNldHRpbmdcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUG9zdC1Qcm9jZXNzaW5nXCIpXG4gICAgICAuc2V0RGVzYyhcIkNvbmZpZ3VyZSBob3cgdHJhbnNjcmlwdGlvbnMgc2hvdWxkIGJlIHBvc3QtcHJvY2Vzc2VkXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZClcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkVuYWJsZS9kaXNhYmxlIHBvc3QtcHJvY2Vzc2luZ1wiKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0b2dnbGU7XG4gICAgICB9KVxuICAgICAgLmFkZEJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiRWRpdCBQcm9tcHRcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkNvbmZpZ3VyZSB0aGUgcG9zdC1wcm9jZXNzaW5nIHByb21wdFwiKVxuICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2hvd1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwgfSA9IGF3YWl0IGltcG9ydChcbiAgICAgICAgICAgICAgXCIuL1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWxcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0ID0gcmVzdWx0LmNvbnRlbnQ7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlUYXNrc1RhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwidGFza3NcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJUYXNrcyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkF1dG8tTW92ZSBDb21wbGV0ZWQgVGFza3NcIilcbiAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSBtb3ZlIGNvbXBsZXRlZCB0YXNrcyB0byB0aGUgYm90dG9tIG9mIHRoZSBsaXN0XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb3ZlQ29tcGxldGVkVGFza3NEb3duKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vdmVDb21wbGV0ZWRUYXNrc0Rvd24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG59XG4iLCAiZXhwb3J0IGludGVyZmFjZSBNb2RlbEFyY2hpdGVjdHVyZSB7XG4gIG1vZGFsaXR5OiBzdHJpbmc7XG4gIHRva2VuaXplcjogc3RyaW5nO1xuICBpbnN0cnVjdF90eXBlOiBzdHJpbmcgfCBudWxsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVsUHJpY2luZyB7XG4gIHByb21wdDogc3RyaW5nO1xuICBjb21wbGV0aW9uOiBzdHJpbmc7XG4gIGltYWdlOiBzdHJpbmc7XG4gIHJlcXVlc3Q6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb3BQcm92aWRlciB7XG4gIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gIG1heF9jb21wbGV0aW9uX3Rva2VuczogbnVtYmVyIHwgbnVsbDtcbiAgaXNfbW9kZXJhdGVkOiBib29sZWFuO1xufVxuXG4vLyBOZXcgaW50ZXJmYWNlIGZvciBzdG9yaW5nIGZhdm9yaXRlIG1vZGVsc1xuZXhwb3J0IGludGVyZmFjZSBGYXZvcml0ZU1vZGVsIHtcbiAgcHJvdmlkZXI6IHN0cmluZztcbiAgbW9kZWxJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVsSWRlbnRpZmllciB7XG4gIHByb3ZpZGVySWQ6IHN0cmluZzsgLy8gZS5nLiBcIm9wZW5yb3V0ZXJcIiwgXCJzeXN0ZW1zY3VscHRcIlxuICBtb2RlbElkOiBzdHJpbmc7IC8vIGUuZy4gXCJncHQtNFwiLCBcIm1pc3RyYWwtN2JcIlxuICBkaXNwbGF5TmFtZT86IHN0cmluZzsgLy8gT3B0aW9uYWwgZGlzcGxheSBuYW1lIG92ZXJyaWRlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0TW9kZWwge1xuICBpZGVudGlmaWVyOiBNb2RlbElkZW50aWZpZXI7IC8vIE5ldyBzdHJ1Y3R1cmVkIGlkZW50aWZpZXJcbiAgaWQ6IHN0cmluZzsgLy8gS2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICBuYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gIGNhcGFiaWxpdGllczogc3RyaW5nW107XG4gIGFyY2hpdGVjdHVyZToge1xuICAgIG1vZGFsaXR5OiBzdHJpbmc7XG4gICAgdG9rZW5pemVyPzogc3RyaW5nO1xuICAgIGluc3RydWN0X3R5cGU/OiBzdHJpbmcgfCBudWxsO1xuICB9O1xuICBwcmljaW5nOiB7XG4gICAgcHJvbXB0OiBzdHJpbmc7XG4gICAgY29tcGxldGlvbjogc3RyaW5nO1xuICAgIGltYWdlOiBzdHJpbmc7XG4gICAgcmVxdWVzdDogc3RyaW5nO1xuICB9O1xuICBwcm92aWRlcjogc3RyaW5nO1xuICB0b3BfcHJvdmlkZXI/OiB7XG4gICAgY29udGV4dF9sZW5ndGg6IG51bWJlcjtcbiAgICBtYXhfY29tcGxldGlvbl90b2tlbnM6IG51bWJlciB8IG51bGw7XG4gICAgaXNfbW9kZXJhdGVkOiBib29sZWFuO1xuICB9O1xuICBpc0Zhdm9yaXRlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDdXN0b21Qcm92aWRlciB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZW5kcG9pbnQ6IHN0cmluZztcbiAgYXBpS2V5OiBzdHJpbmc7XG4gIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgbGFzdFRlc3RlZD86IG51bWJlcjsgLy8gVGltZXN0YW1wIG9mIGxhc3QgY29ubmVjdGlvbiB0ZXN0XG4gIGNhY2hlZE1vZGVscz86IHN0cmluZ1tdOyAvLyBDYWNoZWQgbGlzdCBvZiBtb2RlbCBJRHNcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3RpdmVQcm92aWRlciB7XG4gIGlkOiBzdHJpbmc7IC8vIFVuaXF1ZSBJRCBvZiB0aGUgcHJvdmlkZXJcbiAgbmFtZTogc3RyaW5nOyAvLyBEaXNwbGF5IG5hbWUgKGUuZy4sIFwiU3lzdGVtU2N1bHB0XCIsIFwiT2xsYW1hXCIsIGV0Yy4pXG4gIHR5cGU6IFwibmF0aXZlXCIgfCBcImN1c3RvbVwiOyAvLyBXaGV0aGVyIGl0J3MgdGhlIG5hdGl2ZSBTeXN0ZW1TY3VscHQgb3IgYSBjdXN0b20gcHJvdmlkZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbEZpbHRlclNldHRpbmdzIHtcbiAgc2hvd1Zpc2lvbk1vZGVsczogYm9vbGVhbjtcbiAgc2hvd1JlYXNvbmluZ01vZGVsczogYm9vbGVhbjtcbiAgc2hvd0NyZWF0aXZlTW9kZWxzOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9GSUxURVJfU0VUVElOR1M6IE1vZGVsRmlsdGVyU2V0dGluZ3MgPSB7XG4gIHNob3dWaXNpb25Nb2RlbHM6IGZhbHNlLFxuICBzaG93UmVhc29uaW5nTW9kZWxzOiBmYWxzZSxcbiAgc2hvd0NyZWF0aXZlTW9kZWxzOiBmYWxzZSxcbn07XG4iLCAiaW1wb3J0IHsgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZVwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vdmlld3MvY29tcG9uZW50cy9NZXNzYWdlUmVuZGVyZXJcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHR5cGUge1xuICBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgQ3VzdG9tUHJvdmlkZXIsXG4gIE1vZGVsRmlsdGVyU2V0dGluZ3MsXG4gIEFjdGl2ZVByb3ZpZGVyLFxuICBGYXZvcml0ZU1vZGVsLFxufSBmcm9tIFwiLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTIH0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5cbi8vIFJlLWV4cG9ydCBmb3IgY29udmVuaWVuY2VcbmV4cG9ydCB0eXBlIHtcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG4gIEN1c3RvbVByb3ZpZGVyLFxuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBBY3RpdmVQcm92aWRlcixcbiAgRmF2b3JpdGVNb2RlbCxcbn0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0U2V0dGluZ3Mge1xuICBsaWNlbnNlS2V5OiBzdHJpbmc7XG4gIGxpY2Vuc2VWYWxpZDogYm9vbGVhbjtcbiAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIGNoYXRzRGlyZWN0b3J5OiBzdHJpbmc7XG4gIGxhc3RWYWxpZGF0ZWQ6IG51bWJlcjtcbiAgLyoqXG4gICAqIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB3ZSdsbCBrZWVwIHN5c3RlbVByb21wdCBhcyB0aGUgbGFzdC1zYXZlZFxuICAgKiB1c2VyLWNob3NlbiB0ZXh0LiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgZGlyZWN0IHN0b3JhZ2UgaWYgdGhlIHVzZXJcbiAgICogcGlja3MgYSBwcmVzZXQgb3IgdHlwZWQgY29udGVudC4gQnV0IGlmIHN5c3RlbVByb21wdFR5cGUgaXMgXCJjdXN0b21cIixcbiAgICogd2UnbGwgcmVhZCBmcm9tIHN5c3RlbVByb21wdFBhdGguXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHQ6IHN0cmluZztcbiAgcmVjb3JkaW5nc0RpcmVjdG9yeTogc3RyaW5nO1xuICBkZXZlbG9wbWVudE1vZGU6IGJvb2xlYW47XG4gIHByZWZlcnJlZE1pY3JvcGhvbmVJZDogc3RyaW5nO1xuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IGJvb2xlYW47XG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IGJvb2xlYW47XG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OiBzdHJpbmc7XG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogYm9vbGVhbjtcbiAgc2hvd01vZGVsVG9vbHRpcHM6IGJvb2xlYW47XG4gIHNob3dWaXNpb25Nb2RlbHNPbmx5OiBib29sZWFuO1xuICBzaG93VG9wUGlja3NPbmx5OiBib29sZWFuO1xuICBzZWxlY3RlZFByb3ZpZGVyOiBzdHJpbmc7XG4gIHNlcnZlclVybDogc3RyaW5nO1xuICBhdHRhY2htZW50c0RpcmVjdG9yeTogc3RyaW5nO1xuICBleHRyYWN0aW9uc0RpcmVjdG9yeTogc3RyaW5nO1xuICAvLyBDaGFuZ2VkIGJlbG93IHRvIFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIgd2l0aCBhIHNwYWNlXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZztcbiAgdGFza3NEaXJlY3Rvcnk6IHN0cmluZztcbiAgbW92ZUNvbXBsZXRlZFRhc2tzRG93bjogYm9vbGVhbjtcblxuICAvKipcbiAgICogTkVXIEZJRUxEUzpcbiAgICogc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiXG4gICAqIHN5c3RlbVByb21wdFBhdGg6IHBhdGggdG8gdGhlIGZpbGUgdGhhdCBob2xkcyB0aGUgY3VzdG9tIHN5c3RlbSBwcm9tcHQgKGlmIGFueSkuXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHN5c3RlbVByb21wdFBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogQ3VzdG9tIHByb3ZpZGVyIHNldHRpbmdzXG4gICAqL1xuICBjdXN0b21Qcm92aWRlcnM6IEN1c3RvbVByb3ZpZGVyW107XG5cbiAgbW9kZWxGaWx0ZXJTZXR0aW5nczogTW9kZWxGaWx0ZXJTZXR0aW5ncztcblxuICBmYXZvcml0ZU1vZGVsczogRmF2b3JpdGVNb2RlbFtdO1xuXG4gIGFjdGl2ZVByb3ZpZGVyOiBBY3RpdmVQcm92aWRlcjtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFN5c3RlbVNjdWxwdFNldHRpbmdzID0ge1xuICBsaWNlbnNlS2V5OiBcIlwiLFxuICBsaWNlbnNlVmFsaWQ6IGZhbHNlLFxuICBzZWxlY3RlZE1vZGVsSWQ6IFwiZGVlcHNlZWsvZGVlcHNlZWstcjFcIixcbiAgY2hhdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0NoYXRzXCIsXG4gIGxhc3RWYWxpZGF0ZWQ6IDAsXG4gIC8vIFRoaXMgaXMgdGhlIGZhbGxiYWNrIHN5c3RlbSBwcm9tcHQgaWYgdGhlIHVzZXIgaGFzbid0IGNob3NlbiBhIGN1c3RvbSBvciBwcmVzZXRcbiAgc3lzdGVtUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50LiBZb3UgaGVscCB1c2VycyB3aXRoIHRoZWlyIHF1ZXN0aW9ucyBhbmQgdGFza3MgaW4gYSBjbGVhciBhbmQgY29uY2lzZSB3YXkuXCIsXG4gIHJlY29yZGluZ3NEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1JlY29yZGluZ3NcIixcbiAgZGV2ZWxvcG1lbnRNb2RlOiBmYWxzZSxcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBcIlwiLFxuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IHRydWUsXG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IHRydWUsXG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIHRyYW5zY3JpcHRpb24gcG9zdC1wcm9jZXNzb3IuIFlvdXIgdGFzayBpcyB0byBmaXggYW55IHRyYW5zY3JpcHRpb24gZXJyb3JzLCBjb3JyZWN0IGdyYW1tYXIgYW5kIHB1bmN0dWF0aW9uLCBhbmQgZW5zdXJlIHRoZSB0ZXh0IGlzIHByb3Blcmx5IGZvcm1hdHRlZC4gS2VlcCB0aGUgb3JpZ2luYWwgbWVhbmluZyBpbnRhY3Qgd2hpbGUgbWFraW5nIHRoZSB0ZXh0IG1vcmUgcmVhZGFibGUuXCIsXG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogZmFsc2UsXG4gIHNob3dNb2RlbFRvb2x0aXBzOiBmYWxzZSxcbiAgc2hvd1Zpc2lvbk1vZGVsc09ubHk6IGZhbHNlLFxuICBzaG93VG9wUGlja3NPbmx5OiBmYWxzZSxcbiAgc2VsZWN0ZWRQcm92aWRlcjogXCJhbGxcIixcbiAgc2VydmVyVXJsOiBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiLFxuICBhdHRhY2htZW50c0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvQXR0YWNobWVudHNcIixcbiAgZXh0cmFjdGlvbnNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0V4dHJhY3Rpb25zXCIsXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gIHRhc2tzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9UYXNrc1wiLFxuICBtb3ZlQ29tcGxldGVkVGFza3NEb3duOiB0cnVlLFxuXG4gIC8qKlxuICAgKiBORVcgRklFTERTIERFRkFVTFRTOlxuICAgKi9cbiAgc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiLFxuICBzeXN0ZW1Qcm9tcHRQYXRoOiBcIlwiLFxuXG4gIC8qKlxuICAgKiBDdXN0b20gcHJvdmlkZXIgZGVmYXVsdHNcbiAgICovXG4gIGN1c3RvbVByb3ZpZGVyczogW10sXG5cbiAgbW9kZWxGaWx0ZXJTZXR0aW5nczogREVGQVVMVF9GSUxURVJfU0VUVElOR1MsXG5cbiAgZmF2b3JpdGVNb2RlbHM6IFtdLFxuXG4gIGFjdGl2ZVByb3ZpZGVyOiB7XG4gICAgaWQ6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgbmFtZTogXCJTeXN0ZW1TY3VscHRcIixcbiAgICB0eXBlOiBcIm5hdGl2ZVwiLFxuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IFNFTlNJVElWRV9TRVRUSU5HUzogUGFydGlhbDxcbiAgUmVjb3JkPGtleW9mIFN5c3RlbVNjdWxwdFNldHRpbmdzLCBcIm5vbmVcIiB8IFwiYm90aFwiIHwgXCJ2YWx1ZVwiPlxuPiA9IHtcbiAgbGljZW5zZUtleTogXCJib3RoXCIsXG4gIHNlbGVjdGVkTW9kZWxJZDogXCJub25lXCIsXG4gIGNoYXRzRGlyZWN0b3J5OiBcIm5vbmVcIixcbiAgbGFzdFZhbGlkYXRlZDogXCJub25lXCIsXG4gIHN5c3RlbVByb21wdDogXCJub25lXCIsXG4gIHJlY29yZGluZ3NEaXJlY3Rvcnk6IFwibm9uZVwiLFxuICBkZXZlbG9wbWVudE1vZGU6IFwibm9uZVwiLFxuICBwcmVmZXJyZWRNaWNyb3Bob25lSWQ6IFwibm9uZVwiLFxuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IFwibm9uZVwiLFxuICBhdXRvUGFzdGVUcmFuc2NyaXB0aW9uOiBcIm5vbmVcIixcbiAgdGFza3NEaXJlY3Rvcnk6IFwibm9uZVwiLFxufTtcblxuZXhwb3J0IHR5cGUgQ2hhdFJvbGUgPSBcInVzZXJcIiB8IFwiYXNzaXN0YW50XCIgfCBcInN5c3RlbVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlQ29udGVudCB7XG4gIHR5cGU6IFwiaW1hZ2VfdXJsXCI7XG4gIGltYWdlX3VybDoge1xuICAgIHVybDogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRDb250ZW50IHtcbiAgdHlwZTogXCJ0ZXh0XCI7XG4gIHRleHQ6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgTXVsdGlQYXJ0Q29udGVudCA9IFRleHRDb250ZW50IHwgSW1hZ2VDb250ZW50O1xuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdEluZm8ge1xuICB0eXBlOiBzdHJpbmc7XG4gIHBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5wdXRIYW5kbGVyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIGdldE1lc3NhZ2VzOiAoKSA9PiBDaGF0TWVzc2FnZVtdO1xuICBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHN0cmluZztcbiAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiBTeXN0ZW1Qcm9tcHRJbmZvO1xuICBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIG1lc3NhZ2VSZW5kZXJlcjogTWVzc2FnZVJlbmRlcmVyO1xuICBvbk1lc3NhZ2VTdWJtaXQ6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkNvbnRleHRGaWxlQWRkOiAod2lraWxpbms6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25FcnJvcjogKGVycm9yOiBzdHJpbmcpID0+IHZvaWQ7XG4gIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHZvaWQ7XG4gIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4gdm9pZDtcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdE1lc3NhZ2Uge1xuICByb2xlOiBDaGF0Um9sZTtcbiAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xuICBtZXNzYWdlX2lkOiBzdHJpbmc7XG4gIGRvY3VtZW50Q29udGV4dD86IHtcbiAgICBkb2N1bWVudElkczogc3RyaW5nW107XG4gIH07XG4gIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmc7XG4gIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0UmVzcG9uc2Uge1xuICBpZDogc3RyaW5nO1xuICBjaG9pY2VzOiB7XG4gICAgbWVzc2FnZTogQ2hhdE1lc3NhZ2U7XG4gIH1bXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1TY3VscHRTdHJlYW1DaHVuayB7XG4gIGlkPzogc3RyaW5nO1xuICBjaG9pY2VzPzogQXJyYXk8e1xuICAgIGRlbHRhPzoge1xuICAgICAgY29udGVudD86IHN0cmluZztcbiAgICAgIHRleHQ/OiBzdHJpbmc7XG4gICAgICByZWFzb25pbmc/OiBzdHJpbmc7XG4gICAgfTtcbiAgfT47XG4gIGNvbXBsZXRpb24/OiBzdHJpbmc7XG4gIGRlbHRhPzoge1xuICAgIHRleHQ/OiBzdHJpbmc7XG4gICAgcmVhc29uaW5nPzogc3RyaW5nO1xuICB9O1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHN0YXR1c0NvZGU/OiBudW1iZXI7XG4gICAgbW9kZWw/OiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0UHJlc2V0IHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjtcbiAgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0VHlwZSB7XG4gIGlkOiBzdHJpbmc7IC8vIGUuZy4sIFwidGV4dF9tb2RpZmljYXRpb25cIlxuICBsYWJlbDogc3RyaW5nOyAvLyBlLmcuLCBcIlRleHQgTW9kaWZpY2F0aW9uXCJcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7IC8vIE9wdGlvbmFsIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGhpcyBwcm9tcHQgdHlwZSBkb2VzXG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjsgLy8gV2hldGhlciB1c2VyIGNhbiBjdXN0b21pemUgdGhlIHByb21wdFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRNb2RpZmljYXRpb25TdGF0ZSB7XG4gIG9yaWdpbmFsVGV4dDogc3RyaW5nO1xuICBtb2RpZmllZFRleHQ6IHN0cmluZztcbiAgaXNTdHJlYW1pbmc6IGJvb2xlYW47XG4gIHN0cmVhbUNvbXBsZXRlOiBib29sZWFuO1xuICBlcnJvcj86IHN0cmluZztcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCB9IGZyb20gXCIuLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7XG4gIFNlYXJjaFNlcnZpY2UsXG4gIFNlYXJjaE1hdGNoLFxuICBTZWFyY2hSZXN1bHQsXG4gIFNlYXJjaGFibGVGaWVsZCxcbn0gZnJvbSBcIi4uL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2VcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uSGVscGVyIH0gZnJvbSBcIi4vTW9kZWxTZWxlY3Rpb25IZWxwZXJcIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsIH0gZnJvbSBcIi4vQ3VzdG9tUHJvdmlkZXJNb2RhbFwiO1xuXG5leHBvcnQgY2xhc3MgTW9kZWxTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBhbGxNb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBvblNlbGVjdDogKG1vZGVsSWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBtb2RlbEdyaWQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2U7XG4gIHByaXZhdGUgc2VsZWN0ZWRDYXJkSW5kZXg6IG51bWJlciA9IC0xO1xuICBwcml2YXRlIG1vZGVsQ2FyZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgaXNDbG9zaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgaGVscGVyOiBNb2RlbFNlbGVjdGlvbkhlbHBlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBjdXJyZW50TW9kZWxJZDogc3RyaW5nLFxuICAgIG9uU2VsZWN0OiAobW9kZWxJZDogc3RyaW5nKSA9PiB2b2lkLFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBjdXJyZW50TW9kZWxJZDtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5sb2dnZXIgPSBjb25zb2xlO1xuICAgIHRoaXMuaGVscGVyID0gbmV3IE1vZGVsU2VsZWN0aW9uSGVscGVyKHBsdWdpbik7XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RlbC1zZWxlY3Rpb24tbW9kYWxcIik7XG5cbiAgICAgIC8vIENyZWF0ZSBVSSBlbGVtZW50c1xuICAgICAgdGhpcy5jcmVhdGVTZWFyY2hVSSgpO1xuICAgICAgdGhpcy5jcmVhdGVNb2RlbEdyaWQoKTtcbiAgICAgIHRoaXMuc2V0dXBTZWFyY2goKTtcblxuICAgICAgLy8gVXNlIHRoZSBwbHVnaW4ncyBpbml0aWFsIG1vZGVscyBwcm9taXNlXG4gICAgICB0aGlzLmFsbE1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLmdldEluaXRpYWxNb2RlbHMoKTtcblxuICAgICAgLy8gSW5pdGlhbCByZW5kZXJcbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJNb2RlbFNlbGVjdGlvbk1vZGFsOiBFcnJvciBpbiBvbk9wZW5cIiwgZXJyb3IpO1xuICAgICAgdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1lcnJvci1tZXNzYWdlXCIsXG4gICAgICAgIHRleHQ6IFwiRXJyb3IgbG9hZGluZyBtb2RlbCBzZWxlY3Rpb24gbW9kYWxcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmlzaWJsZU1vZGVscygpOiBTZWFyY2hSZXN1bHQ8U3lzdGVtU2N1bHB0TW9kZWw+W10ge1xuICAgIC8vIElmIHRoZXJlJ3Mgbm8gc2VhcmNoIHF1ZXJ5LCBqdXN0IHJldHVybiB0aGVtIGFsbCBzb3J0ZWQgYnkgcHJvdmlkZXJcbiAgICBpZiAoIXRoaXMuc2VhcmNoSW5wdXQgfHwgIXRoaXMuc2VhcmNoSW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbGxNb2RlbHMubWFwKChtKSA9PiAoeyBpdGVtOiBtLCBtYXRjaGVzOiBbXSwgc2NvcmU6IDAgfSkpO1xuICAgIH1cblxuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgICAvLyBBcHBseSBzZWFyY2ggYW5kIGZpbHRlclxuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgdGhpcy5hbGxNb2RlbHMsXG4gICAgICBxdWVyeSxcbiAgICAgIChtb2RlbCkgPT4gdGhpcy5nZXRTZWFyY2hhYmxlRmllbGRzKG1vZGVsKSxcbiAgICAgIHtcbiAgICAgICAgaW5pdGlhbFJlc3VsdHNMaW1pdDogMjUsXG4gICAgICAgIG1heEZpbHRlcmVkUmVzdWx0czogNTAsXG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIEZpbHRlciBvdXQgcmVzdWx0cyB3aXRoIG5vIG1hdGNoZXMgb3IgbG93IHNjb3Jlc1xuICAgIGNvbnN0IGZpbHRlcmVkUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKFxuICAgICAgKHJlc3VsdCkgPT4gcmVzdWx0Lm1hdGNoZXMubGVuZ3RoID4gMCAmJiByZXN1bHQuc2NvcmUgPiAwXG4gICAgKTtcblxuICAgIC8vIFNvcnQgcmVzdWx0cyBieSBzY29yZVxuICAgIHJldHVybiBmaWx0ZXJlZFJlc3VsdHMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZWFyY2hhYmxlRmllbGRzID0gKFxuICAgIG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbFxuICApOiBTZWFyY2hhYmxlRmllbGRbXSA9PiB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHsgZmllbGQ6IFwibmFtZVwiLCB0ZXh0OiBtb2RlbC5uYW1lLCB3ZWlnaHQ6IDIwMCB9LFxuICAgICAgLi4ubW9kZWwubmFtZS5zcGxpdCgvW1xcc1xcLTpcXC5dKy8pLm1hcCgocGFydCkgPT4gKHtcbiAgICAgICAgZmllbGQ6IFwibmFtZVwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDE1MCxcbiAgICAgIH0pKSxcbiAgICAgIC4uLihtb2RlbC5wcm92aWRlciA9PT0gXCJjdXN0b21cIlxuICAgICAgICA/IFt7IGZpZWxkOiBcInByb3ZpZGVyXCIsIHRleHQ6IG1vZGVsLmlkLnNwbGl0KFwiLVwiKVswXSwgd2VpZ2h0OiAxODAgfV1cbiAgICAgICAgOiBbXSksXG4gICAgICB7IGZpZWxkOiBcImRlc2NyaXB0aW9uXCIsIHRleHQ6IG1vZGVsLmRlc2NyaXB0aW9uIHx8IFwiXCIsIHdlaWdodDogNTAgfSxcbiAgICBdO1xuICB9O1xuXG4gIHByaXZhdGUgY3JlYXRlU2VhcmNoVUkoKSB7XG4gICAgY29uc3Qgc2VhcmNoQ29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VhcmNoLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBtb2RlbHMuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VhcmNoLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgcHJvdmlkZXJzIGJ1dHRvblxuICAgIGNvbnN0IHByb3ZpZGVyc0J1dHRvbiA9IHNlYXJjaENvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVycy1idXR0b25cIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHByb3ZpZGVyc0J1dHRvbi5jcmVhdGVTcGFuKCksIFwic2V0dGluZ3NcIik7XG4gICAgcHJvdmlkZXJzQnV0dG9uLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlByb3ZpZGVyc1wiIH0pO1xuXG4gICAgcHJvdmlkZXJzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcblxuICAgICAgLy8gT3BlbiBjdXN0b20gcHJvdmlkZXIgbWFuYWdlciBtb2RhbFxuICAgICAgY29uc3QgbWFuYWdlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAvLyBPbiBiYWNrXG4gICAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb25Nb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QsXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgbW9kZWxTZWxlY3Rpb25Nb2RhbC5vcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBtYW5hZ2VyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVNb2RlbEdyaWQoKSB7XG4gICAgdGhpcy5tb2RlbEdyaWQgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1ncmlkXCIsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwU2VhcmNoKCkge1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmdldFZpc2libGVNb2RlbHMoKTtcbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHJlc3VsdHMpO1xuICAgIH0pO1xuXG4gICAgLy8gS2V5Ym9hcmQgbmF2XG4gICAgdGhpcy5jb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IDw9IDBcbiAgICAgICAgICAgICAgPyB0aGlzLm1vZGVsQ2FyZHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggLSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPVxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA+PSB0aGlzLm1vZGVsQ2FyZHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgOiB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ICsgMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vZGVsQ2FyZHMuZm9yRWFjaCgoY2FyZCwgaSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBpID09PSB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4O1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnRvZ2dsZShcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiLCBpc1NlbGVjdGVkKTtcbiAgICAgICAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgICAgICAgY2FyZC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiBcInNtb290aFwiLCBibG9jazogXCJuZWFyZXN0XCIgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGNvbnN0IGhpZ2hsaWdodGVkQ2FyZCA9IHRoaXMubW9kZWxDYXJkc1t0aGlzLnNlbGVjdGVkQ2FyZEluZGV4XTtcbiAgICAgICAgaWYgKGhpZ2hsaWdodGVkQ2FyZCkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zdCBtb2RlbElkID0gaGlnaGxpZ2h0ZWRDYXJkLmRhdGFzZXQubW9kZWxJZDtcbiAgICAgICAgICBpZiAobW9kZWxJZCkge1xuICAgICAgICAgICAgdGhpcy5vblNlbGVjdChtb2RlbElkKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFBhc3NpdmUgc2Nyb2xsL3RvdWNoXG4gICAgdGhpcy5tb2RlbEdyaWQ/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcIndoZWVsXCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIGp1c3QgYSBuby1vcFxuICAgICAgfSxcbiAgICAgIHsgcGFzc2l2ZTogdHJ1ZSB9XG4gICAgKTtcbiAgICB0aGlzLm1vZGVsR3JpZD8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKCkgPT4ge30sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICB0aGlzLm1vZGVsR3JpZD8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCAoKSA9PiB7fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgYWxsIGN1cnJlbnRseSB2aXNpYmxlIG1vZGVscyBidXQgaW4gMiBzaW1wbGUgc2VjdGlvbnM6XG4gICAqIC0gU3lzdGVtU2N1bHB0IG1vZGVsc1xuICAgKiAtIEN1c3RvbSBwcm92aWRlciBtb2RlbHNcbiAgICovXG4gIHByaXZhdGUgcmVuZGVyTW9kZWxzKHNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxTeXN0ZW1TY3VscHRNb2RlbD5bXSkge1xuICAgIGlmICghdGhpcy5tb2RlbEdyaWQpIHJldHVybjtcblxuICAgIHRoaXMubW9kZWxHcmlkLmVtcHR5KCk7XG4gICAgdGhpcy5tb2RlbENhcmRzID0gW107XG5cbiAgICAvLyBDcmVhdGUgYSBsb29rdXAgZm9yIHNlYXJjaE1hdGNoZXNcbiAgICBjb25zdCBzck1hcCA9IG5ldyBNYXAoXG4gICAgICBzZWFyY2hSZXN1bHRzLm1hcCgoc3IpID0+IFtzci5pdGVtLmlkLCBzci5tYXRjaGVzIHx8IFtdXSlcbiAgICApO1xuXG4gICAgLy8gRmlyc3QsIHNlcGFyYXRlIGZhdm9yaXRlcyBmcm9tIG90aGVyIG1vZGVsc1xuICAgIGNvbnN0IGZhdm9yaXRlczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuICAgIGNvbnN0IG5vbkZhdm9yaXRlczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuXG4gICAgLy8gT25seSBwcm9jZXNzIG1vZGVscyB0aGF0IGFyZSBpbiBvdXIgc2VhcmNoIHJlc3VsdHNcbiAgICBjb25zdCB2aXNpYmxlTW9kZWxzID0gc2VhcmNoUmVzdWx0cy5tYXAoKHNyKSA9PiBzci5pdGVtKTtcbiAgICB2aXNpYmxlTW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICBpZiAobW9kZWwuaXNGYXZvcml0ZSkge1xuICAgICAgICBmYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub25GYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgZmF2b3JpdGVzIHNlY3Rpb24gaWYgdGhlcmUgYXJlIGFueSBmYXZvcml0ZXNcbiAgICBpZiAoZmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEFkZCBmYXZvcml0ZXMgaGVhZGVyXG4gICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLm1vZGVsR3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiLFxuICAgICAgfSk7XG4gICAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiRmF2b3JpdGVzXCIgfSk7XG5cbiAgICAgIC8vIFNvcnQgZmF2b3JpdGVzIGFscGhhYmV0aWNhbGx5XG4gICAgICBmYXZvcml0ZXMuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG5cbiAgICAgIC8vIFJlbmRlciBmYXZvcml0ZSBtb2RlbHNcbiAgICAgIGZhdm9yaXRlcy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gc3JNYXAuZ2V0KG1vZGVsLmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyTW9kZWxDYXJkKG1vZGVsLCBtYXRjaGVzKTtcbiAgICAgICAgaWYgKGNhcmQpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsR3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgICB0aGlzLm1vZGVsQ2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR3JvdXAgcmVtYWluaW5nIG1vZGVscyBieSBwcm92aWRlclxuICAgIGNvbnN0IG1vZGVsc0J5UHJvdmlkZXIgPSBuZXcgTWFwPHN0cmluZywgU3lzdGVtU2N1bHB0TW9kZWxbXT4oKTtcbiAgICBub25GYXZvcml0ZXMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gbW9kZWwucHJvdmlkZXI7XG4gICAgICBpZiAoIW1vZGVsc0J5UHJvdmlkZXIuaGFzKHByb3ZpZGVyKSkge1xuICAgICAgICBtb2RlbHNCeVByb3ZpZGVyLnNldChwcm92aWRlciwgW10pO1xuICAgICAgfVxuICAgICAgbW9kZWxzQnlQcm92aWRlci5nZXQocHJvdmlkZXIpPy5wdXNoKG1vZGVsKTtcbiAgICB9KTtcblxuICAgIC8vIFNvcnQgcHJvdmlkZXJzIHRvIGVuc3VyZSBzeXN0ZW1zY3VscHQgaXMgZmlyc3RcbiAgICBjb25zdCBzb3J0ZWRQcm92aWRlcnMgPSBBcnJheS5mcm9tKG1vZGVsc0J5UHJvdmlkZXIua2V5cygpKS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBpZiAoYSA9PT0gXCJzeXN0ZW1zY3VscHRcIikgcmV0dXJuIC0xO1xuICAgICAgaWYgKGIgPT09IFwic3lzdGVtc2N1bHB0XCIpIHJldHVybiAxO1xuICAgICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTtcbiAgICB9KTtcblxuICAgIC8vIFJlbmRlciBlYWNoIHByb3ZpZGVyIHNlY3Rpb25cbiAgICBzb3J0ZWRQcm92aWRlcnMuZm9yRWFjaCgocHJvdmlkZXIpID0+IHtcbiAgICAgIGNvbnN0IG1vZGVscyA9IG1vZGVsc0J5UHJvdmlkZXIuZ2V0KHByb3ZpZGVyKSB8fCBbXTtcblxuICAgICAgLy8gU2tpcCBlbXB0eSBwcm92aWRlcnNcbiAgICAgIGlmIChtb2RlbHMubGVuZ3RoID09PSAwKSByZXR1cm47XG5cbiAgICAgIC8vIFNvcnQgbW9kZWxzIGFscGhhYmV0aWNhbGx5XG4gICAgICBjb25zdCBzb3J0ZWRNb2RlbHMgPSBtb2RlbHMuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG5cbiAgICAgIC8vIEFkZCBwcm92aWRlciBoZWFkZXJcbiAgICAgIGNvbnN0IGhlYWRlciA9IHRoaXMubW9kZWxHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHByb3ZpZGVyTmFtZSA9XG4gICAgICAgIHByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiXG4gICAgICAgICAgPyBcIlN5c3RlbVNjdWxwdCBNb2RlbHNcIlxuICAgICAgICAgIDogYCR7cHJvdmlkZXIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm92aWRlci5zbGljZSgxKX0gTW9kZWxzYDtcbiAgICAgIGhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogcHJvdmlkZXJOYW1lIH0pO1xuXG4gICAgICAvLyBSZW5kZXIgbW9kZWxzIGZvciB0aGlzIHByb3ZpZGVyXG4gICAgICBzb3J0ZWRNb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChtb2RlbC5pZCkgfHwgW107XG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLnJlbmRlck1vZGVsQ2FyZChtb2RlbCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICAgICAgdGhpcy5tb2RlbENhcmRzLnB1c2goY2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gSWYgbm8gY2FyZHMgYXQgYWxsLCByZW5kZXIgdGhlIFwibm8gcmVzdWx0c1wiIGNhcmRcbiAgICBpZiAodGhpcy5tb2RlbENhcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3Qgbm9SZXN1bHRzQ2FyZCA9IHRoaXMucmVuZGVyTm9SZXN1bHRzQ2FyZCgpO1xuICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQobm9SZXN1bHRzQ2FyZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJOb1Jlc3VsdHNDYXJkKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1jYXJkXCIgfSk7XG5cbiAgICBjb25zdCBpY29uc0NvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uc1wiIH0pO1xuICAgIGNvbnN0IHNlYXJjaEljb24gPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1wcmljaW5nLWxvd1wiLFxuICAgIH0pO1xuICAgIHNldEljb24oc2VhcmNoSWNvbiwgXCJzZWFyY2hcIik7XG5cbiAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbmFtZVwiLFxuICAgICAgdGV4dDogXCJObyBtb2RlbHMgZm91bmRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogXCJObyBtb2RlbHMgbWF0Y2ggeW91ciBjdXJyZW50IHNlYXJjaCBjcml0ZXJpYS4gQ2xpY2sgaGVyZSB0byByZXNldCBhbGwgZmlsdGVycy5cIixcbiAgICB9KTtcblxuICAgIGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXRhaWxzXCIgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgICB0aGlzLnNlYXJjaElucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKFxuICAgICAgICB0aGlzLmFsbE1vZGVscy5tYXAoKG0pID0+ICh7IGl0ZW06IG0sIG1hdGNoZXM6IFtdLCBzY29yZTogMCB9KSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW9kZWxDYXJkKFxuICAgIG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNhcmQuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtbW9kZWwtY2FyZFwiO1xuICAgIGlmIChtb2RlbC5wcm92aWRlciAhPT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1tb2RlbC1jYXJkXCIpO1xuICAgIH1cbiAgICBjYXJkLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMFwiKTtcbiAgICBjYXJkLmRhdGFzZXQubW9kZWxJZCA9IG1vZGVsLmlkO1xuXG4gICAgLy8gRmF2b3JpdGUgc3RhclxuICAgIGNvbnN0IGZhdm9yaXRlQnV0dG9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LWZhdm9yaXRlLWJ1dHRvbiAke1xuICAgICAgICBtb2RlbC5pc0Zhdm9yaXRlID8gXCJpcy1mYXZvcml0ZVwiIDogXCJcIlxuICAgICAgfWAsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIFwiYXJpYS1sYWJlbFwiOiBtb2RlbC5pc0Zhdm9yaXRlXG4gICAgICAgICAgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiXG4gICAgICAgICAgOiBcIkFkZCB0byBmYXZvcml0ZXNcIixcbiAgICAgICAgcm9sZTogXCJidXR0b25cIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihmYXZvcml0ZUJ1dHRvbiwgXCJzdGFyXCIpO1xuXG4gICAgLy8gRmF2b3JpdGUgdG9nZ2xlXG4gICAgZmF2b3JpdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgaXNGYXZvcml0ZSA9ICFtb2RlbC5pc0Zhdm9yaXRlO1xuICAgICAgbW9kZWwuaXNGYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG5cbiAgICAgIGZhdm9yaXRlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpcy1mYXZvcml0ZVwiLCBpc0Zhdm9yaXRlKTtcbiAgICAgIGZhdm9yaXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcbiAgICAgICAgXCJhcmlhLWxhYmVsXCIsXG4gICAgICAgIGlzRmF2b3JpdGUgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiIDogXCJBZGQgdG8gZmF2b3JpdGVzXCJcbiAgICAgICk7XG5cbiAgICAgIC8vIEVuc3VyZSBhcnJheVxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzKSkge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9IFtdO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgb3IgcmVtb3ZlIGZyb20gc2V0dGluZ3NcbiAgICAgIGlmIChpc0Zhdm9yaXRlKSB7XG4gICAgICAgIGNvbnN0IG5ld0ZhdiA9IHsgcHJvdmlkZXI6IG1vZGVsLnByb3ZpZGVyLCBtb2RlbElkOiBtb2RlbC5pZCB9O1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLnNvbWUoXG4gICAgICAgICAgICAoZikgPT4gZi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmLnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlclxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMucHVzaChuZXdGYXYpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMuZmlsdGVyKFxuICAgICAgICAgICAgKGYpID0+ICEoZi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmLnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlcilcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgIC8vIFJlLXJlbmRlciB0byBtb3ZlIHRoZSBtb2RlbCB0byBpdHMgbmV3IHNlY3Rpb25cbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpKTtcbiAgICB9KTtcblxuICAgIC8vIFJlbmRlciBtYWluIGNvbnRlbnRcbiAgICBpZiAobW9kZWwucHJvdmlkZXIgIT09IFwic3lzdGVtc2N1bHB0XCIpIHtcbiAgICAgIC8vIEp1c3Qgc2hvdyBtb2RlbCBuYW1lIGZvciBjdXN0b20gcHJvdmlkZXJzXG4gICAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1tb2RlbC1uYW1lLWNvbnRhaW5lclwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG1vZGVsTmFtZSA9IG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tbW9kZWwtbmFtZVwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBuYW1lTWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcIm5hbWVcIik7XG4gICAgICBtb2RlbE5hbWUuYXBwZW5kKFxuICAgICAgICB0aGlzLmhlbHBlci5oaWdobGlnaHRUZXh0KFxuICAgICAgICAgIG1vZGVsLm5hbWUsXG4gICAgICAgICAgbmFtZU1hdGNoZXMsXG4gICAgICAgICAgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWVcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTm9ybWFsIHN5c3RlbSBtb2RlbCBjYXJkXG4gICAgICBjb25zdCBpY29uc0NvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uc1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNpbXBsZSBjb3N0IGluZGljYXRvclxuICAgICAgY29uc3QgY29tcGxldGlvblByaWNlID0gcGFyc2VGbG9hdChtb2RlbC5wcmljaW5nLmNvbXBsZXRpb24pICogMV8wMDBfMDAwO1xuICAgICAgY29uc3QgcHJpY2luZ0luZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvblwiLFxuICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgXCJhcmlhLWxhYmVsXCI6IGBBcHByb3ggfiQke2NvbXBsZXRpb25QcmljZS50b0ZpeGVkKFxuICAgICAgICAgICAgMlxuICAgICAgICAgICl9IHBlciBtaWxsaW9uIHRva2Vuc2AsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHNldEljb24ocHJpY2luZ0luZGljYXRvciwgXCJ3YWxsZXRcIik7XG5cbiAgICAgIC8vIGNhcGFiaWxpdHkgaWNvbnNcbiAgICAgIGlmIChtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwiZmFzdFwiKSkge1xuICAgICAgICBjb25zdCBzcGVlZEluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1zcGVlZC1pbmRpY2F0b3JcIixcbiAgICAgICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkJsYXppbmcgZmFzdCByZXNwb25zZXNcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbihzcGVlZEluZGljYXRvciwgXCJ6YXBcIik7XG4gICAgICB9XG4gICAgICBpZiAobW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInJlYXNvbmluZ1wiKSkge1xuICAgICAgICBjb25zdCByZWFzb25JbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtcmVhc29uaW5nLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQ29tcGxleCByZWFzb25pbmdcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbihyZWFzb25JbmRpY2F0b3IsIFwiYnJhaW5cIik7XG4gICAgICB9XG4gICAgICBpZiAobW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcImNyZWF0aXZlXCIpKSB7XG4gICAgICAgIGNvbnN0IGNyZWF0aXZlSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LWNyZWF0aXZlLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQ3JlYXRpdmUgd3JpdGluZ1wiIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJY29uKGNyZWF0aXZlSW5kaWNhdG9yLCBcImJydXNoXCIpO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGVsLmFyY2hpdGVjdHVyZT8ubW9kYWxpdHkgPT09IFwidGV4dCtpbWFnZS0+dGV4dFwiKSB7XG4gICAgICAgIGNvbnN0IHZpc2lvbkluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC12aXNpb24taW5kaWNhdG9yXCIsXG4gICAgICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJWaXNpb24vaW1hZ2UgaW5wdXRcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbih2aXNpb25JbmRpY2F0b3IsIFwiZXllXCIpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW5hbWUtY29udGFpbmVyXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG1vZGVsTmFtZSA9IG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lXCIsXG4gICAgICB9KTtcbiAgICAgIG1vZGVsTmFtZS5hcHBlbmQoXG4gICAgICAgIHRoaXMuaGVscGVyLmhpZ2hsaWdodFRleHQobW9kZWwubmFtZSwgbWF0Y2hlcywgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWUpXG4gICAgICApO1xuXG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXNjcmlwdGlvblwiLFxuICAgICAgfSk7XG4gICAgICBkZXNjcmlwdGlvbi5hcHBlbmQoXG4gICAgICAgIHRoaXMuaGVscGVyLmhpZ2hsaWdodFRleHQoXG4gICAgICAgICAgbW9kZWwuZGVzY3JpcHRpb24sXG4gICAgICAgICAgbWF0Y2hlcyxcbiAgICAgICAgICB0aGlzLnNlYXJjaElucHV0Py52YWx1ZVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBtb2RlbC5kZXNjcmlwdGlvbik7XG4gICAgICBkZXNjcmlwdGlvbi5hZGRDbGFzcyhcImhhcy10b29sdGlwXCIpO1xuXG4gICAgICBjb25zdCBkZXRhaWxzID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRldGFpbHNcIiB9KTtcbiAgICAgIGNvbnN0IGNvbnRleHRMZW5ndGggPSBkZXRhaWxzLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGV0YWlsXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnRleHRMZW5ndGguY3JlYXRlU3Bhbih7XG4gICAgICAgIHRleHQ6IFwiQ29udGV4dDogXCIsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZGV0YWlsLWxhYmVsXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnRleHRMZW5ndGguY3JlYXRlU3Bhbih7XG4gICAgICAgIHRleHQ6IGAke21vZGVsLmNvbnRleHRfbGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHRva2Vuc2AsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZGV0YWlsLXZhbHVlXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlclxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIElmIGN1c3RvbSwgcGljayB0aGF0IGFzIHByb3ZpZGVyXG4gICAgICBjb25zdCBjdXN0b21Qcm92aWRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maW5kKFxuICAgICAgICAocCkgPT4gcC5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1vZGVsLnByb3ZpZGVyLnRvTG93ZXJDYXNlKClcbiAgICAgICk7XG4gICAgICBpZiAoY3VzdG9tUHJvdmlkZXIpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIgPSB7XG4gICAgICAgICAgaWQ6IGN1c3RvbVByb3ZpZGVyLmlkLFxuICAgICAgICAgIG5hbWU6IGN1c3RvbVByb3ZpZGVyLm5hbWUsXG4gICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyID0ge1xuICAgICAgICAgIGlkOiBcInN5c3RlbXNjdWxwdFwiLFxuICAgICAgICAgIG5hbWU6IFwiU3lzdGVtU2N1bHB0XCIsXG4gICAgICAgICAgdHlwZTogXCJuYXRpdmVcIixcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgdGhpcy5vblNlbGVjdChtb2RlbC5pZCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICAvLyBLZXlib2FyZCBuYXZcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMub25TZWxlY3QobW9kZWwuaWQpO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm1vZGVsQ2FyZHMuZm9yRWFjaCgoYykgPT5cbiAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpXG4gICAgICApO1xuICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNhcmQ7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIHRoaXMuaXNDbG9zaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyB5b3UgdG8gcHJvZ3JhbW1hdGljYWxseSBzZXQgbW9kZWxzIGlmIG5lZWRlZCAob2xkIHVzYWdlKS5cbiAgICovXG4gIHB1YmxpYyBzZXRNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogdm9pZCB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KG1vZGVscykpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiSW52YWxpZCBtb2RlbHMgZGF0YVwiLCB7IG1vZGVscyB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5hbGxNb2RlbHMgPSBtb2RlbHM7XG4gICAgaWYgKHRoaXMubW9kZWxHcmlkKSB7XG4gICAgICB0aGlzLnJlbmRlck1vZGVscyh0aGlzLmdldFZpc2libGVNb2RlbHMoKSk7XG4gICAgfVxuICB9XG59XG4iLCAiZXhwb3J0IGludGVyZmFjZSBTZWFyY2hhYmxlRmllbGQge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkO1xuICB3ZWlnaHQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hNYXRjaCB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgaW5kaWNlczogbnVtYmVyW107XG4gIG1hdGNoUXVhbGl0eTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFJlc3VsdDxUPiB7XG4gIGl0ZW06IFQ7XG4gIG1hdGNoZXM6IFNlYXJjaE1hdGNoW107XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoVUlPcHRpb25zPFQ+IHtcbiAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50O1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgZ2V0SXRlbVRpdGxlOiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtRGVzY3JpcHRpb24/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtQmFkZ2U/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtQ29udGV4dD86IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIGdldEl0ZW1NZXRhPzogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgb25TZWxlY3Q6IChpdGVtOiBUKSA9PiB2b2lkO1xuICBpbml0aWFsUXVlcnk/OiBzdHJpbmc7XG4gIGluaXRpYWxSZXN1bHRzTGltaXQ/OiBudW1iZXI7XG4gIG1heEZpbHRlcmVkUmVzdWx0cz86IG51bWJlcjtcbiAgZW1wdHlTdGF0ZVRleHQ/OiBzdHJpbmc7XG4gIGlzTG9hZGluZz86IGJvb2xlYW47XG4gIGxvYWRpbmdTdGF0ZVRleHQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBTZWFyY2hTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX0lOSVRJQUxfUkVTVUxUU19MSU1JVCA9IDI1O1xuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfTUFYX0ZJTFRFUkVEX1JFU1VMVFMgPSA1MDtcblxuICBwdWJsaWMgc2VhcmNoPFQ+KFxuICAgIGl0ZW1zOiBUW10sXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBnZXRTZWFyY2hhYmxlRmllbGRzOiAoaXRlbTogVCkgPT4gU2VhcmNoYWJsZUZpZWxkW10sXG4gICAgb3B0aW9ucz86IHsgaW5pdGlhbFJlc3VsdHNMaW1pdD86IG51bWJlcjsgbWF4RmlsdGVyZWRSZXN1bHRzPzogbnVtYmVyIH1cbiAgKTogU2VhcmNoUmVzdWx0PFQ+W10ge1xuICAgIGNvbnN0IGluaXRpYWxMaW1pdCA9XG4gICAgICBvcHRpb25zPy5pbml0aWFsUmVzdWx0c0xpbWl0ID8/IHRoaXMuREVGQVVMVF9JTklUSUFMX1JFU1VMVFNfTElNSVQ7XG4gICAgY29uc3QgbWF4RmlsdGVyZWQgPVxuICAgICAgb3B0aW9ucz8ubWF4RmlsdGVyZWRSZXN1bHRzID8/IHRoaXMuREVGQVVMVF9NQVhfRklMVEVSRURfUkVTVUxUUztcblxuICAgIC8vIElmIG5vIHF1ZXJ5LCByZXR1cm4gaW5pdGlhbCBpdGVtcyB3aXRoIG5vIG1hdGNoZXNcbiAgICBpZiAoIXF1ZXJ5LnRyaW0oKSkge1xuICAgICAgcmV0dXJuIGl0ZW1zLnNsaWNlKDAsIGluaXRpYWxMaW1pdCkubWFwKChpdGVtKSA9PiAoe1xuICAgICAgICBpdGVtLFxuICAgICAgICBtYXRjaGVzOiBbXSxcbiAgICAgICAgc2NvcmU6IDAsXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgLy8gU3BsaXQgcXVlcnkgaW50byB0ZXJtc1xuICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gcXVlcnkudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKTtcblxuICAgIGNvbnN0IHNlYXJjaFJlc3VsdHMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IGdldFNlYXJjaGFibGVGaWVsZHMoaXRlbSk7XG4gICAgICBjb25zdCBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW107XG4gICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG5cbiAgICAgIGZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICBpZiAoIWZpZWxkLnRleHQpIHJldHVybjtcbiAgICAgICAgY29uc3QgZmllbGRUZXh0ID0gZmllbGQudGV4dDtcbiAgICAgICAgY29uc3QgZmllbGRUZXh0TG93ZXIgPSBmaWVsZFRleHQudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAvLyBDaGVjayBpZiBhbGwgdGVybXMgZXhpc3QgaW4gdGhpcyBmaWVsZCBmaXJzdFxuICAgICAgICBjb25zdCBhbGxUZXJtc0ZvdW5kID0gc2VhcmNoVGVybXMuZXZlcnkoKHRlcm0pID0+XG4gICAgICAgICAgZmllbGRUZXh0TG93ZXIuaW5jbHVkZXModGVybSlcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoYWxsVGVybXNGb3VuZCkge1xuICAgICAgICAgIC8vIEZpbmQgbWF0Y2hlcyBmb3IgZWFjaCB0ZXJtXG4gICAgICAgICAgc2VhcmNoVGVybXMuZm9yRWFjaCgodGVybSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSB0aGlzLmZpbmRNYXRjaGVzKGZpZWxkVGV4dCwgdGVybSk7XG4gICAgICAgICAgICBpZiAobWF0Y2guaW5kaWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIG1hdGNoZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkLmZpZWxkLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZpZWxkVGV4dCxcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBtYXRjaC5pbmRpY2VzLFxuICAgICAgICAgICAgICAgIG1hdGNoUXVhbGl0eTogbWF0Y2gucXVhbGl0eSxcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgbGV0IHNjb3JlID0gZmllbGQud2VpZ2h0ICogbWF0Y2gucXVhbGl0eTtcblxuICAgICAgICAgICAgICAvLyBBZGQgcHJveGltaXR5IGJvbnVzIGlmIHdlIGhhdmUgbXVsdGlwbGUgdGVybXNcbiAgICAgICAgICAgICAgaWYgKHNlYXJjaFRlcm1zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXJtUG9zaXRpb25zID0gc2VhcmNoVGVybXMubWFwKCh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBmaWVsZFRleHRMb3dlci5pbmRleE9mKHQpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkeCA+PSAwID8gaWR4IDogSW5maW5pdHk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBtYXhEaXN0YW5jZSA9XG4gICAgICAgICAgICAgICAgICBNYXRoLm1heCguLi50ZXJtUG9zaXRpb25zKSAtXG4gICAgICAgICAgICAgICAgICBNYXRoLm1pbiguLi50ZXJtUG9zaXRpb25zLmZpbHRlcigocCkgPT4gcCAhPT0gSW5maW5pdHkpKTtcbiAgICAgICAgICAgICAgICBpZiAobWF4RGlzdGFuY2UgPCA1MCkge1xuICAgICAgICAgICAgICAgICAgc2NvcmUgKj0gMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXRlbSxcbiAgICAgICAgbWF0Y2hlcyxcbiAgICAgICAgc2NvcmU6IHRvdGFsU2NvcmUsXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gRmlsdGVyIG91dCBpdGVtcyB3aXRoIG5vIG1hdGNoZXNcbiAgICBjb25zdCB2YWxpZFJlc3VsdHMgPSBzZWFyY2hSZXN1bHRzLmZpbHRlcigocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0Lm1hdGNoZXMubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIG1hdGNoZXMgZm9yIGFsbCB0ZXJtc1xuICAgICAgY29uc3QgZm91bmRUZXJtcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgcmVzdWx0Lm1hdGNoZXMuZm9yRWFjaCgobWF0Y2gpID0+IHtcbiAgICAgICAgY29uc3QgdGV4dCA9IG1hdGNoLnRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgc2VhcmNoVGVybXMuZm9yRWFjaCgodGVybSkgPT4ge1xuICAgICAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKHRlcm0pKSBmb3VuZFRlcm1zLmFkZCh0ZXJtKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGZvdW5kVGVybXMuc2l6ZSA9PT0gc2VhcmNoVGVybXMubGVuZ3RoO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHZhbGlkUmVzdWx0cy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSkuc2xpY2UoMCwgbWF4RmlsdGVyZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBmaW5kTWF0Y2hlcyhcbiAgICB0ZXh0OiBzdHJpbmcsXG4gICAgcXVlcnk6IHN0cmluZ1xuICApOiB7IGluZGljZXM6IG51bWJlcltdOyBxdWFsaXR5OiBudW1iZXIgfSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgY29uc3QgaW5kaWNlczogbnVtYmVyW10gPSBbXTtcbiAgICBsZXQgcXVhbGl0eSA9IDA7XG5cbiAgICAvLyBGb3Igc2luZ2xlIGNoYXJhY3RlciBxdWVyaWVzLCBvbmx5IG1hdGNoIHdvcmQgYm91bmRhcmllc1xuICAgIGlmIChub3JtYWxpemVkUXVlcnkubGVuZ3RoID09PSAxKSB7XG4gICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFxcXFxiJHtub3JtYWxpemVkUXVlcnl9XFxcXGJgLCBcImdpXCIpO1xuICAgICAgbGV0IG1hdGNoO1xuICAgICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAgIGluZGljZXMucHVzaChtYXRjaC5pbmRleCk7XG4gICAgICAgIHF1YWxpdHkgPSAxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgaW5kaWNlcywgcXVhbGl0eSB9O1xuICAgIH1cblxuICAgIC8vIEZpbmQgYWxsIG9jY3VycmVuY2VzIG9mIHRoZSBxdWVyeSBpbiB0aGUgdGV4dFxuICAgIGxldCBwb3MgPSAwO1xuICAgIHdoaWxlICgocG9zID0gbm9ybWFsaXplZFRleHQuaW5kZXhPZihub3JtYWxpemVkUXVlcnksIHBvcykpICE9PSAtMSkge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIHdvcmQgYm91bmRhcnkgbWF0Y2hcbiAgICAgIGNvbnN0IGJlZm9yZUNoYXIgPSBwb3MgPiAwID8gbm9ybWFsaXplZFRleHRbcG9zIC0gMV0gOiBcIiBcIjtcbiAgICAgIGNvbnN0IGFmdGVyQ2hhciA9XG4gICAgICAgIHBvcyArIG5vcm1hbGl6ZWRRdWVyeS5sZW5ndGggPCBub3JtYWxpemVkVGV4dC5sZW5ndGhcbiAgICAgICAgICA/IG5vcm1hbGl6ZWRUZXh0W3BvcyArIG5vcm1hbGl6ZWRRdWVyeS5sZW5ndGhdXG4gICAgICAgICAgOiBcIiBcIjtcblxuICAgICAgaWYgKFxuICAgICAgICAoL1xccy8udGVzdChiZWZvcmVDaGFyKSB8fCAvXFxXLy50ZXN0KGJlZm9yZUNoYXIpIHx8IHBvcyA9PT0gMCkgJiZcbiAgICAgICAgKC9cXHMvLnRlc3QoYWZ0ZXJDaGFyKSB8fFxuICAgICAgICAgIC9cXFcvLnRlc3QoYWZ0ZXJDaGFyKSB8fFxuICAgICAgICAgIHBvcyArIG5vcm1hbGl6ZWRRdWVyeS5sZW5ndGggPT09IG5vcm1hbGl6ZWRUZXh0Lmxlbmd0aClcbiAgICAgICkge1xuICAgICAgICAvLyBQZXJmZWN0IHdvcmQgYm91bmRhcnkgbWF0Y2hcbiAgICAgICAgcXVhbGl0eSA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQYXJ0aWFsIG1hdGNoXG4gICAgICAgIHF1YWxpdHkgPSAwLjg7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBhbGwgaW5kaWNlcyBmb3IgdGhpcyBtYXRjaFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub3JtYWxpemVkUXVlcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaW5kaWNlcy5wdXNoKHBvcyArIGkpO1xuICAgICAgfVxuXG4gICAgICBwb3MgKz0gMTsgLy8gTW92ZSBwYXN0IGN1cnJlbnQgbWF0Y2ggdG8gZmluZCBuZXh0XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaW5kaWNlczogWy4uLm5ldyBTZXQoaW5kaWNlcyldLnNvcnQoKGEsIGIpID0+IGEgLSBiKSwgcXVhbGl0eSB9O1xuICB9XG5cbiAgcHVibGljIGhpZ2hsaWdodFRleHQoXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXSxcbiAgICBzZWFyY2hRdWVyeT86IHN0cmluZ1xuICApOiBEb2N1bWVudEZyYWdtZW50IHtcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDAgfHwgIXNlYXJjaFF1ZXJ5KSB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgIGZyYWdtZW50LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgIHJldHVybiBmcmFnbWVudDtcbiAgICB9XG5cbiAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgIC8vIFVzZSB0aGUgYWN0dWFsIHNlYXJjaCBxdWVyeSBmb3IgaGlnaGxpZ2h0aW5nXG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgICAvLyBVc2UgcmVnZXggdG8gZmluZCB3aG9sZSB3b3JkIG9yIHBocmFzZSBtYXRjaGVzXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoJHtub3JtYWxpemVkUXVlcnl9KWAsIFwiZ2lcIik7XG4gICAgbGV0IGxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoO1xuXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyBBZGQgbm9uLWhpZ2hsaWdodGVkIHRleHQgYmVmb3JlIG1hdGNoXG4gICAgICBpZiAobWF0Y2guaW5kZXggPiBsYXN0SW5kZXgpIHtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zbGljZShsYXN0SW5kZXgsIG1hdGNoLmluZGV4KSlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGhpZ2hsaWdodGVkIG1hdGNoXG4gICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICBzcGFuLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXNlYXJjaC1oaWdobGlnaHRcIjtcbiAgICAgIHNwYW4udGV4dENvbnRlbnQgPSBtYXRjaFswXTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNwYW4pO1xuXG4gICAgICBsYXN0SW5kZXggPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmVtYWluaW5nIHRleHRcbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc2xpY2UobGFzdEluZGV4KSkpO1xuICAgIH1cblxuICAgIHJldHVybiBmcmFnbWVudDtcbiAgfVxufVxuIiwgImltcG9ydCB7XG4gIE1vZGVsRmlsdGVyU2V0dGluZ3MsXG4gIERFRkFVTFRfRklMVEVSX1NFVFRJTkdTLFxuICBTeXN0ZW1TY3VscHRNb2RlbCxcbn0gZnJvbSBcIi4uL3R5cGVzL2xsbVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgU2VhcmNoTWF0Y2ggfSBmcm9tIFwiLi4vc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRpZXJJbmZvIHtcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBjbGFzc05hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFRJRVJfSU5GTzogeyBba2V5OiBzdHJpbmddOiBUaWVySW5mbyB9ID0ge1xuICBmYXZvcml0ZXM6IHtcbiAgICBuYW1lOiBcIkZhdm9yaXRlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIllvdXIgZmF2b3JpdGUgbW9kZWxzIGZvciBxdWljayBhY2Nlc3NcIixcbiAgICBjbGFzc05hbWU6IFwiZmF2b3JpdGVcIixcbiAgfSxcbiAgZXNzZW50aWFsOiB7XG4gICAgbmFtZTogXCJFc3NlbnRpYWxcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiQnVkZ2V0LWZyaWVuZGx5LCBncmVhdCBmb3IgZGFpbHkgdGFza3MsIGluY2x1ZGVzIHZpc2lvbiBhbmQgcmVhc29uaW5nIGNhcGFiaWxpdGllcywgZXhjZWxsZW50IHZhbHVlXCIsXG4gICAgY2xhc3NOYW1lOiBcImVzc2VudGlhbFwiLFxuICB9LFxuICBhZHZhbmNlZDoge1xuICAgIG5hbWU6IFwiQWR2YW5jZWRcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiQmFsYW5jZWQgcGVyZm9ybWFuY2UsIGVuaGFuY2VkIGNhcGFiaWxpdGllcywgaWRlYWwgZm9yIGNvbXBsZXggdGFza3MsIGVmZmljaWVudCByZXNvdXJjZSB1c2FnZVwiLFxuICAgIGNsYXNzTmFtZTogXCJhZHZhbmNlZFwiLFxuICB9LFxuICBwcm9mZXNzaW9uYWw6IHtcbiAgICBuYW1lOiBcIlByb2Zlc3Npb25hbFwiLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgXCJNYXhpbXVtIHBlcmZvcm1hbmNlLCBhZHZhbmNlZCBmZWF0dXJlcywgc3BlY2lhbGl6ZWQgd29ya2Zsb3dzLCBlbnRlcnByaXNlLWdyYWRlIGNhcGFiaWxpdGllc1wiLFxuICAgIGNsYXNzTmFtZTogXCJwcm9mZXNzaW9uYWxcIixcbiAgfSxcbiAgY3VzdG9tOiB7XG4gICAgbmFtZTogXCJDdXN0b20gTW9kZWxzXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIllvdXIgcGVyc29uYWxseSBjb25maWd1cmVkIG1vZGVscyBmcm9tIGN1c3RvbSBwcm92aWRlcnMsIGFsbG93aW5nIGZ1bGwgY29udHJvbCBvdmVyIG1vZGVsIHNlbGVjdGlvblwiLFxuICAgIGNsYXNzTmFtZTogXCJjdXN0b21cIixcbiAgfSxcbiAgLy8gRmFsbGJhY2sgZm9yIGFueSB1bmtub3duIHRpZXJcbiAgZGVmYXVsdDoge1xuICAgIG5hbWU6IFwiTW9kZWxzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQXZhaWxhYmxlIG1vZGVsc1wiLFxuICAgIGNsYXNzTmFtZTogXCJkZWZhdWx0XCIsXG4gIH0sXG59O1xuXG5leHBvcnQgY2xhc3MgTW9kZWxTZWxlY3Rpb25IZWxwZXIge1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBmaWx0ZXJTZXR0aW5nczogTW9kZWxGaWx0ZXJTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICAvLyBJbml0aWFsaXplIHdpdGggc2F2ZWQgc2V0dGluZ3Mgb3IgZGVmYXVsdHNcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzIH07XG4gIH1cblxuICBnZXRGaWx0ZXJTZXR0aW5ncygpOiBNb2RlbEZpbHRlclNldHRpbmdzIHtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXJTZXR0aW5ncztcbiAgfVxuXG4gIGFzeW5jIHNldEZpbHRlclNldHRpbmcoa2V5OiBrZXlvZiBNb2RlbEZpbHRlclNldHRpbmdzLCB2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuZmlsdGVyU2V0dGluZ3Nba2V5XSA9IHZhbHVlO1xuICAgIC8vIFVwZGF0ZSBwbHVnaW4gc2V0dGluZ3MgYW5kIHNhdmVcbiAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLmZpbHRlclNldHRpbmdzIH07XG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBhc3luYyByZXNldEZpbHRlclNldHRpbmdzKCkge1xuICAgIHRoaXMuZmlsdGVyU2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfRklMVEVSX1NFVFRJTkdTIH07XG4gICAgLy8gVXBkYXRlIHBsdWdpbiBzZXR0aW5ncyBhbmQgc2F2ZVxuICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vZGVsRmlsdGVyU2V0dGluZ3MgPSB7IC4uLnRoaXMuZmlsdGVyU2V0dGluZ3MgfTtcbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgfVxuXG4gIGZvcm1hdFByaWNlKHByaWNlOiBudW1iZXIgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBpZiAocHJpY2UgPT09IG51bGwgfHwgcHJpY2UgPT09IHVuZGVmaW5lZCB8fCBwcmljZSA9PT0gXCIwXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiRnJlZVwiO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBudW1lcmljUHJpY2UgPVxuICAgICAgICB0eXBlb2YgcHJpY2UgPT09IFwic3RyaW5nXCIgPyBwYXJzZUZsb2F0KHByaWNlKSA6IHByaWNlO1xuXG4gICAgICBpZiAoaXNOYU4obnVtZXJpY1ByaWNlKSB8fCBudW1lcmljUHJpY2UgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFwiRnJlZVwiO1xuICAgICAgfVxuXG4gICAgICAvLyBNdWx0aXBseSBieSAxLDAwMCwwMDAgdG8gY29udmVydCBmcm9tIHBlciB0b2tlbiB0byBwZXIgMU0gdG9rZW5zXG4gICAgICBjb25zdCBwcmljZVBlck1pbGxpb24gPSBudW1lcmljUHJpY2UgKiAxMDAwMDAwO1xuXG4gICAgICAvLyBBbHdheXMgc2hvdyBleGFjdGx5IDIgZGVjaW1hbCBwbGFjZXNcbiAgICAgIHJldHVybiBgJCR7cHJpY2VQZXJNaWxsaW9uLnRvRml4ZWQoMil9YDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJNb2RlbFNlbGVjdGlvbkhlbHBlcjogRXJyb3IgZm9ybWF0dGluZyBwcmljZVwiLCB7XG4gICAgICAgIHByaWNlLFxuICAgICAgICBlcnJvcixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFwiUHJpY2UgZXJyb3JcIjtcbiAgICB9XG4gIH1cblxuICBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW10sXG4gICAgc2VhcmNoUXVlcnk/OiBzdHJpbmdcbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwIHx8ICFzZWFyY2hRdWVyeSkge1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgICAvLyBVc2UgcmVnZXggdG8gZmluZCB3aG9sZSB3b3JkIG9yIHBocmFzZSBtYXRjaGVzXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoJHtub3JtYWxpemVkUXVlcnl9KWAsIFwiZ2lcIik7XG4gICAgbGV0IGxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoO1xuXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyBBZGQgbm9uLWhpZ2hsaWdodGVkIHRleHQgYmVmb3JlIG1hdGNoXG4gICAgICBpZiAobWF0Y2guaW5kZXggPiBsYXN0SW5kZXgpIHtcbiAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcbiAgICAgICAgICB0ZXh0LnNsaWNlKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpXG4gICAgICAgICk7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGhpZ2hsaWdodGVkIG1hdGNoXG4gICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICBzcGFuLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LW1vZGVsLWhpZ2hsaWdodFwiO1xuICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IG1hdGNoWzBdO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7XG5cbiAgICAgIGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGV4dE5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiBmcmFnbWVudDtcbiAgfVxuXG4gIHNvcnRNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogU3lzdGVtU2N1bHB0TW9kZWxbXSB7XG4gICAgLy8gQ3JlYXRlIHRpZXIgZ3JvdXBzIGluY2x1ZGluZyBmYXZvcml0ZXNcbiAgICBjb25zdCB0aWVycyA9IHtcbiAgICAgIGZhdm9yaXRlczogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGVzc2VudGlhbDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGFkdmFuY2VkOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgICAgcHJvZmVzc2lvbmFsOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgICAgY3VzdG9tOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgIH07XG5cbiAgICAvLyBGaXJzdCBwYXNzOiBkaXN0cmlidXRlIG1vZGVscyB0byB0aGVpciByZXNwZWN0aXZlIHRpZXJzXG4gICAgbW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAvLyBGYXZvcml0ZWQgbW9kZWxzIE9OTFkgZ28gdG8gZmF2b3JpdGVzIHRpZXJcbiAgICAgIGlmIChtb2RlbC5pc0Zhdm9yaXRlKSB7XG4gICAgICAgIHRpZXJzLmZhdm9yaXRlcy5wdXNoKG1vZGVsKTtcbiAgICAgICAgcmV0dXJuOyAvLyBTa2lwIGFkZGluZyB0byBvdGhlciB0aWVyc1xuICAgICAgfVxuXG4gICAgICAvLyBOb24tZmF2b3JpdGVzIGdvIHRvIHRoZWlyIHJlc3BlY3RpdmUgdGllcnNcbiAgICAgIGlmIChtb2RlbC5wcm92aWRlciA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICB0aWVycy5jdXN0b20ucHVzaChtb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU29ydCBtb2RlbHMgd2l0aGluIGVhY2ggdGllciBieSBuYW1lXG4gICAgT2JqZWN0LnZhbHVlcyh0aWVycykuZm9yRWFjaCgodGllck1vZGVscykgPT4ge1xuICAgICAgdGllck1vZGVscy5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcbiAgICB9KTtcblxuICAgIC8vIENvbWJpbmUgdGllcnMgaW4gdGhlIGNvcnJlY3Qgb3JkZXIsIG9ubHkgaW5jbHVkaW5nIG5vbi1lbXB0eSB0aWVyc1xuICAgIGNvbnN0IHNvcnRlZE1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuXG4gICAgLy8gRmF2b3JpdGVzIGFsd2F5cyBmaXJzdCAoaWYgYW55IGV4aXN0KVxuICAgIGlmICh0aWVycy5mYXZvcml0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuZmF2b3JpdGVzKTtcbiAgICB9XG5cbiAgICAvLyBUaGVuIHRoZSBzdGFuZGFyZCB0aWVycyBpbiBvcmRlclxuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmVzc2VudGlhbCk7XG4gICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuYWR2YW5jZWQpO1xuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLnByb2Zlc3Npb25hbCk7XG5cbiAgICAvLyBDdXN0b20gbW9kZWxzIGxhc3RcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5jdXN0b20pO1xuXG4gICAgcmV0dXJuIHNvcnRlZE1vZGVscztcbiAgfVxuXG4gIGZpbHRlck1vZGVscyhtb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10pOiBTeXN0ZW1TY3VscHRNb2RlbFtdIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIG1vZGVscy5maWx0ZXIoKG1vZGVsKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaGFzVmlzaW9uQ2FwYWJpbGl0eSA9XG4gICAgICAgICAgICBtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwidmlzaW9uXCIpIHx8IGZhbHNlO1xuICAgICAgICAgIGNvbnN0IGhhc1JlYXNvbmluZ0NhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInJlYXNvbmluZ1wiKSB8fCBmYWxzZTtcbiAgICAgICAgICBjb25zdCBoYXNDcmVhdGl2ZUNhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcImNyZWF0aXZlXCIpIHx8IGZhbHNlO1xuXG4gICAgICAgICAgLy8gSWYgbm8gZmlsdGVycyBhcmUgYWN0aXZlLCBzaG93IGFsbCBtb2RlbHNcbiAgICAgICAgICBpZiAoIU9iamVjdC52YWx1ZXModGhpcy5maWx0ZXJTZXR0aW5ncykuc29tZSgodmFsdWUpID0+IHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hlY2sgZWFjaCBhY3RpdmUgZmlsdGVyXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICghdGhpcy5maWx0ZXJTZXR0aW5ncy5zaG93VmlzaW9uTW9kZWxzIHx8IGhhc1Zpc2lvbkNhcGFiaWxpdHkpICYmXG4gICAgICAgICAgICAoIXRoaXMuZmlsdGVyU2V0dGluZ3Muc2hvd1JlYXNvbmluZ01vZGVscyB8fFxuICAgICAgICAgICAgICBoYXNSZWFzb25pbmdDYXBhYmlsaXR5KSAmJlxuICAgICAgICAgICAgKCF0aGlzLmZpbHRlclNldHRpbmdzLnNob3dDcmVhdGl2ZU1vZGVscyB8fCBoYXNDcmVhdGl2ZUNhcGFiaWxpdHkpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGZpbHRlcmluZyBpbmRpdmlkdWFsIG1vZGVsXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGluIGZpbHRlck1vZGVsc1wiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbW9kZWxzO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIE5vdGljZSwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwic3JjL21haW5cIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyIH0gZnJvbSBcInNyYy90eXBlcy9sbG1cIjtcblxuZXhwb3J0IGNsYXNzIEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBvbkJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBvbkJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLm9uQmFjayA9IG9uQmFjaztcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvdmlkZXJDYXJkKHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlciwgY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGNhcmQgPSBjb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkXCIpO1xuXG4gICAgLy8gSGVhZGVyIHdpdGggbmFtZSBhbmQgYWN0aW9uc1xuICAgIGNvbnN0IGhlYWRlciA9IGNhcmQuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWhlYWRlclwiKTtcbiAgICBoZWFkZXIuY3JlYXRlRWwoXCJoM1wiLCB7XG4gICAgICB0ZXh0OiBwcm92aWRlci5uYW1lLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1uYW1lXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhY3Rpb25zID0gaGVhZGVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWFjdGlvbnNcIlxuICAgICk7XG5cbiAgICAvLyBEZWxldGUgYnV0dG9uXG4gICAgY29uc3QgZGVsZXRlQnRuID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWFjdGlvbiBkZWxldGVcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGRlbGV0ZUJ0biwgXCJ0cmFzaC0yXCIpO1xuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIFJlbW92ZSBwcm92aWRlclxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzID1cbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbHRlcihcbiAgICAgICAgICAocCkgPT4gcC5pZCAhPT0gcHJvdmlkZXIuaWRcbiAgICAgICAgKTtcblxuICAgICAgLy8gU2F2ZSBzZXR0aW5nc1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgIC8vIFJlLXJlbmRlciBsaXN0XG4gICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgIH0pO1xuXG4gICAgLy8gRGV0YWlscyBzZWN0aW9uXG4gICAgY29uc3QgZGV0YWlscyA9IGNhcmQuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbHNcIik7XG5cbiAgICAvLyBUeXBlXG4gICAgY29uc3QgdHlwZURldGFpbCA9IGRldGFpbHMuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtZGV0YWlsXCJcbiAgICApO1xuICAgIHNldEljb24odHlwZURldGFpbC5jcmVhdGVTcGFuKCksIFwiYm94XCIpO1xuICAgIHR5cGVEZXRhaWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBcIk9wZW5BSSBDb21wYXRpYmxlXCIsXG4gICAgfSk7XG5cbiAgICAvLyBFbmRwb2ludFxuICAgIGNvbnN0IGVuZHBvaW50RGV0YWlsID0gZGV0YWlscy5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1kZXRhaWxcIlxuICAgICk7XG4gICAgc2V0SWNvbihlbmRwb2ludERldGFpbC5jcmVhdGVTcGFuKCksIFwibGlua1wiKTtcbiAgICBlbmRwb2ludERldGFpbC5jcmVhdGVTcGFuKHsgdGV4dDogcHJvdmlkZXIuZW5kcG9pbnQgfSk7XG5cbiAgICAvLyBTdGF0dXNcbiAgICBjb25zdCBzdGF0dXNEZXRhaWwgPSBkZXRhaWxzLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbFwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0b2dnbGUgY29udGFpbmVyXG4gICAgY29uc3QgdG9nZ2xlQ29udGFpbmVyID0gc3RhdHVzRGV0YWlsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci10b2dnbGUtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgbGFiZWxcbiAgICB0b2dnbGVDb250YWluZXIuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBwcm92aWRlci5pc0VuYWJsZWQgPyBcIkVuYWJsZWRcIiA6IFwiRGlzYWJsZWRcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXRvZ2dsZS1sYWJlbFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRvZ2dsZSBzd2l0Y2hcbiAgICBjb25zdCB0b2dnbGUgPSB0b2dnbGVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYGNoZWNrYm94LWNvbnRhaW5lciAke3Byb3ZpZGVyLmlzRW5hYmxlZCA/IFwiaXMtZW5hYmxlZFwiIDogXCJcIn1gLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSB0b2dnbGUgdHJhY2sgYW5kIHRodW1iXG4gICAgdG9nZ2xlLmNyZWF0ZURpdih7IGNsczogXCJjaGVja2JveC10b2dnbGVcIiB9KTtcblxuICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIGZvciBzdGF0dXMgdG9nZ2xlXG4gICAgdG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgLy8gSWYgYWxyZWFkeSBlbmFibGVkLCBqdXN0IGRpc2FibGVcbiAgICAgIGlmIChwcm92aWRlci5pc0VuYWJsZWQpIHtcbiAgICAgICAgcHJvdmlkZXIuaXNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGVuYWJsaW5nLCB0ZXN0IGNvbm5lY3Rpb24gZmlyc3RcbiAgICAgIHRvZ2dsZS5hZGRDbGFzcyhcInRlc3RpbmdcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24oXG4gICAgICAgIHByb3ZpZGVyXG4gICAgICApO1xuICAgICAgdG9nZ2xlLnJlbW92ZUNsYXNzKFwidGVzdGluZ1wiKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHByb3ZpZGVyLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvciBub3RpY2VcbiAgICAgICAgbmV3IE5vdGljZShcbiAgICAgICAgICBgRmFpbGVkIHRvIGVuYWJsZSAke3Byb3ZpZGVyLm5hbWV9OiAke1xuICAgICAgICAgICAgcmVzdWx0LmVycm9yIHx8IFwiQ29ubmVjdGlvbiBmYWlsZWRcIlxuICAgICAgICAgIH1gLFxuICAgICAgICAgIDUwMDBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvdmlkZXJMaXN0KCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgLy8gQ2xlYXIgZXhpc3RpbmcgY29udGVudFxuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1tb2RhbFwiKTtcblxuICAgIC8vIENyZWF0ZSBoZWFkZXIgd2l0aCBiYWNrIGJ1dHRvblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1oZWFkZXJcIlxuICAgICk7XG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJhY2tcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGJhY2tCdXR0b24uY3JlYXRlU3BhbigpLCBcImFycm93LWxlZnRcIik7XG4gICAgYmFja0J1dHRvbi5jcmVhdGVTcGFuKHsgdGV4dDogXCJCYWNrIHRvIE1vZGVsc1wiIH0pO1xuXG4gICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIGhlYWRlci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDdXN0b20gUHJvdmlkZXJzXCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXJcbiAgICBjb25zdCBjb250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGNvbnRlbnQuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItbGlzdFwiXG4gICAgKTtcblxuICAgIC8vIEdldCBwcm92aWRlcnMgZnJvbSBzZXR0aW5nc1xuICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycztcblxuICAgIGlmIChwcm92aWRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBTaG93IGVtcHR5IHN0YXRlXG4gICAgICBjb25zdCBlbXB0eVN0YXRlID0gbGlzdENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWVtcHR5XCJcbiAgICAgICk7XG4gICAgICBjb25zdCBlbXB0eUljb24gPSBlbXB0eVN0YXRlLmNyZWF0ZURpdihcbiAgICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItZW1wdHktaWNvblwiXG4gICAgICApO1xuICAgICAgc2V0SWNvbihlbXB0eUljb24sIFwic2VydmVyLW9mZlwiKTtcbiAgICAgIGVtcHR5U3RhdGUuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1lbXB0eS10ZXh0XCIsXG4gICAgICAgIHRleHQ6IFwiTm8gY3VzdG9tIHByb3ZpZGVycyBhZGRlZCB5ZXRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZW5kZXIgcHJvdmlkZXIgY2FyZHNcbiAgICAgIHByb3ZpZGVycy5mb3JFYWNoKChwcm92aWRlcikgPT4ge1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyQ2FyZChwcm92aWRlciwgbGlzdENvbnRhaW5lcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYWN0aW9ucyBjb250YWluZXJcbiAgICBjb25zdCBhY3Rpb25zID0gY29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGJ1dHRvblxuICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1idXR0b24gc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJ1dHRvbi1wcmltYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkFkZCBQcm92aWRlclwiLFxuICAgIH0pO1xuICAgIHNldEljb24oYWRkQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJwbHVzXCIpO1xuXG4gICAgYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICBjb25zdCBjdXN0b21Qcm92aWRlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICB0aGlzLm9uQmFja1xuICAgICAgICAgICk7XG4gICAgICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGN1c3RvbVByb3ZpZGVyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIHRoaXMucmVuZGVyUHJvdmlkZXJMaXN0KCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBvbkJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBvbkJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLm9uQmFjayA9IG9uQmFjaztcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1vZGFsXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGhlYWRlciB3aXRoIGJhY2sgYnV0dG9uXG4gICAgY29uc3QgaGVhZGVyID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItaGVhZGVyXCIpO1xuXG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1iYWNrXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihiYWNrQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJhcnJvdy1sZWZ0XCIpO1xuICAgIGJhY2tCdXR0b24uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQmFjayB0byBQcm92aWRlcnNcIiB9KTtcblxuICAgIGJhY2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIHRoaXMub25CYWNrKCk7XG4gICAgfSk7XG5cbiAgICBoZWFkZXIuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQWRkIEN1c3RvbSBQcm92aWRlclwiIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGZvcm0gY29udGFpbmVyXG4gICAgY29uc3QgZm9ybSA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm1cIik7XG5cbiAgICAvLyBQcm92aWRlciBOYW1lXG4gICAgY29uc3QgbmFtZUdyb3VwID0gZm9ybS5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tZ3JvdXBcIik7XG4gICAgbmFtZUdyb3VwLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIlByb3ZpZGVyIE5hbWVcIiB9KTtcbiAgICBjb25zdCBuYW1lSW5wdXQgPSBuYW1lR3JvdXAuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcImUuZy4sIExNIFN0dWRpbywgT3BlbkFJXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIG1heGxlbmd0aDogXCIyNVwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEFkZCBpbnB1dCBydWxlcyBmb3IgcHJvdmlkZXIgbmFtZVxuICAgIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBuYW1lSW5wdXQudmFsdWU7XG5cbiAgICAgIC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyIG9mIGVhY2ggd29yZFxuICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgIC5tYXAoKHdvcmQpID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKVxuICAgICAgICAuam9pbihcIiBcIik7XG5cbiAgICAgIC8vIE9ubHkgdXBkYXRlIGlmIHRoZSB2YWx1ZSBoYXMgY2hhbmdlZCB0byBwcmV2ZW50IGN1cnNvciBqdW1waW5nXG4gICAgICBpZiAoZm9ybWF0dGVkVmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IGZvcm1hdHRlZFZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRW5kcG9pbnQgVVJMXG4gICAgY29uc3QgdXJsR3JvdXAgPSBmb3JtLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1ncm91cFwiKTtcbiAgICB1cmxHcm91cC5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogXCJBUEkgRW5kcG9pbnQgVVJMXCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnNcbiAgICBjb25zdCBwcmVzZXRDb250YWluZXIgPSB1cmxHcm91cC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0c1wiXG4gICAgKTtcbiAgICBwcmVzZXRDb250YWluZXIuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUXVpY2sgU2V0dXA6XCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnMgY29udGFpbmVyXG4gICAgY29uc3QgcHJlc2V0QnV0dG9ucyA9IHByZXNldENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0LWJ1dHRvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgT2xsYW1hIHByZXNldFxuICAgIGNvbnN0IG9sbGFtYUJ1dHRvbiA9IHByZXNldEJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJPbGxhbWFcIixcbiAgICB9KTtcblxuICAgIG9sbGFtYUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJPbGxhbWFcIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwOi8vbG9jYWxob3N0OjExNDM0L3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBMTSBTdHVkaW8gcHJlc2V0XG4gICAgY29uc3QgbG1TdHVkaW9CdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiTE0gU3R1ZGlvXCIsXG4gICAgfSk7XG5cbiAgICBsbVN0dWRpb0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJMTSBTdHVkaW9cIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwOi8vbG9jYWxob3N0OjEyMzQvdjFcIjtcbiAgICAgIGFwaUtleUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIE9wZW5Sb3V0ZXIgcHJlc2V0XG4gICAgY29uc3Qgb3BlblJvdXRlckJ1dHRvbiA9IHByZXNldEJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJPcGVuUm91dGVyXCIsXG4gICAgfSk7XG5cbiAgICBvcGVuUm91dGVyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSBcIk9wZW5Sb3V0ZXJcIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBHcm9xIHByZXNldFxuICAgIGNvbnN0IGdyb3FCdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiR3JvcVwiLFxuICAgIH0pO1xuXG4gICAgZ3JvcUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJHcm9xXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cHM6Ly9hcGkuZ3JvcS5jb20vb3BlbmFpL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHVybElucHV0ID0gdXJsR3JvdXAuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcImh0dHBzOi8veW91ci1hcGktZW5kcG9pbnQuY29tXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgZXJyb3IgbWVzc2FnZSBjb250YWluZXJcbiAgICBjb25zdCB1cmxFcnJvciA9IHVybEdyb3VwLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvciBzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiLFxuICAgICAgdGV4dDogXCIgXCIsIC8vIFNwYWNlIHRvIG1haW50YWluIGhlaWdodFxuICAgIH0pO1xuXG4gICAgLy8gVVJMIHZhbGlkYXRpb24gZnVuY3Rpb25cbiAgICBjb25zdCB2YWxpZGF0ZUVuZHBvaW50VXJsID0gKFxuICAgICAgdXJsOiBzdHJpbmdcbiAgICApOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0gPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgICAgICBjb25zdCBpc0xvY2FsID1cbiAgICAgICAgICBwYXJzZWRVcmwuaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIgfHxcbiAgICAgICAgICBwYXJzZWRVcmwuaG9zdG5hbWUgPT09IFwiMTI3LjAuMC4xXCI7XG5cbiAgICAgICAgaWYgKGlzTG9jYWwgJiYgcGFyc2VkVXJsLnByb3RvY29sICE9PSBcImh0dHA6XCIpIHtcbiAgICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiTG9jYWwgZW5kcG9pbnRzIG11c3QgdXNlIEhUVFBcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpc0xvY2FsICYmIHBhcnNlZFVybC5wcm90b2NvbCAhPT0gXCJodHRwczpcIikge1xuICAgICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJSZW1vdGUgZW5kcG9pbnRzIG11c3QgdXNlIEhUVFBTXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0xvY2FsICYmICFwYXJzZWRVcmwucG9ydCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBcIkxvY2FsIGVuZHBvaW50cyByZXF1aXJlIGEgcG9ydCBudW1iZXJcIixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogdHJ1ZSB9O1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIFVSTCBmb3JtYXRcIiB9O1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBBUEkgS2V5XG4gICAgY29uc3QgYXBpS2V5R3JvdXAgPSBmb3JtLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1mb3JtLWdyb3VwXCJcbiAgICApO1xuICAgIGFwaUtleUdyb3VwLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIkFQSSBLZXkgKE9wdGlvbmFsKVwiIH0pO1xuICAgIGNvbnN0IGFwaUtleUlucHV0ID0gYXBpS2V5R3JvdXAuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJFbnRlciB5b3VyIEFQSSBrZXlcIixcbiAgICB9KTtcblxuICAgIC8vIEZ1bmN0aW9uIHRvIHJlc2V0IHZhbGlkYXRpb24gc3RhdGVcbiAgICBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoKSA9PiB7XG4gICAgICBpc0Nvbm5lY3Rpb25UZXN0ZWQgPSBmYWxzZTtcbiAgICAgIHRlc3RSZXN1bHQgPSBudWxsO1xuICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoXCJ0ZXN0XCIpO1xuICAgICAgdXJsRXJyb3IuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiKTtcbiAgICAgIHVybEVycm9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1zdWNjZXNzXCIpO1xuICAgIH07XG5cbiAgICAvLyBBZGQgY2hhbmdlIGxpc3RlbmVycyB0byBhbGwgaW5wdXRzXG4gICAgbmFtZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCByZXNldFZhbGlkYXRpb24pO1xuICAgIHVybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCByZXNldFZhbGlkYXRpb24pO1xuICAgIGFwaUtleUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCByZXNldFZhbGlkYXRpb24pO1xuXG4gICAgLy8gQWRkIGlucHV0IHJ1bGVzIGZvciBwcm92aWRlciBuYW1lXG4gICAgbmFtZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG5hbWVJbnB1dC52YWx1ZTtcblxuICAgICAgLy8gQ2FwaXRhbGl6ZSBmaXJzdCBsZXR0ZXIgb2YgZWFjaCB3b3JkXG4gICAgICBjb25zdCBmb3JtYXR0ZWRWYWx1ZSA9IHZhbHVlXG4gICAgICAgIC5zcGxpdChcIiBcIilcbiAgICAgICAgLm1hcCgod29yZCkgPT4gd29yZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSkpXG4gICAgICAgIC5qb2luKFwiIFwiKTtcblxuICAgICAgLy8gT25seSB1cGRhdGUgaWYgdGhlIHZhbHVlIGhhcyBjaGFuZ2VkIHRvIHByZXZlbnQgY3Vyc29yIGp1bXBpbmdcbiAgICAgIGlmIChmb3JtYXR0ZWRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gZm9ybWF0dGVkVmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgZm9ybSBhY3Rpb25zIGNvbnRhaW5lclxuICAgIGNvbnN0IGZvcm1BY3Rpb25zID0gZm9ybS5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIGNhbmNlbCBidXR0b24gZmlyc3QgKG9uIHRoZSBsZWZ0KVxuICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGZvcm1BY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbiBzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgfSk7XG5cbiAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIHRoaXMub25CYWNrKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGVzdC9zYXZlIGJ1dHRvbiAob24gdGhlIHJpZ2h0KVxuICAgIGNvbnN0IGFjdGlvbkJ1dHRvbiA9IGZvcm1BY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbiBzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1wcmltYXJ5XCIsXG4gICAgICB0ZXh0OiBcIlRlc3QgQ29ubmVjdGlvblwiLFxuICAgIH0pO1xuXG4gICAgbGV0IGlzQ29ubmVjdGlvblRlc3RlZCA9IGZhbHNlO1xuICAgIGxldCB0ZXN0UmVzdWx0OiB7IHN1Y2Nlc3M6IGJvb2xlYW47IG1vZGVscz86IHN0cmluZ1tdIH0gfCBudWxsID0gbnVsbDtcblxuICAgIC8vIEZ1bmN0aW9uIHRvIGNyZWF0ZSBhIHByb3ZpZGVyIG9iamVjdCBmcm9tIGZvcm0gZGF0YVxuICAgIGNvbnN0IGNyZWF0ZVByb3ZpZGVyRnJvbUZvcm0gPSAoKTogQ3VzdG9tUHJvdmlkZXIgPT4gKHtcbiAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgbmFtZTogbmFtZUlucHV0LnZhbHVlLnRyaW0oKSxcbiAgICAgIGVuZHBvaW50OiB1cmxJbnB1dC52YWx1ZS50cmltKCksXG4gICAgICBhcGlLZXk6IGFwaUtleUlucHV0LnZhbHVlLnRyaW0oKSxcbiAgICAgIGlzRW5hYmxlZDogdHJ1ZSxcbiAgICAgIGxhc3RUZXN0ZWQ6IERhdGUubm93KCksXG4gICAgfSk7XG5cbiAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgYnV0dG9uIHN0YXRlXG4gICAgY29uc3QgdXBkYXRlQnV0dG9uU3RhdGUgPSAoXG4gICAgICBzdGF0ZTogXCJ0ZXN0XCIgfCBcInRlc3RpbmdcIiB8IFwicmV0cnlcIiB8IFwic2F2ZVwiXG4gICAgKSA9PiB7XG4gICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgIGNhc2UgXCJ0ZXN0XCI6XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXCJUZXN0IENvbm5lY3Rpb25cIik7XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGVzdGluZ1wiOlxuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFwiVGVzdGluZy4uLlwiKTtcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmV0cnlcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlRyeSBBZ2FpblwiKTtcbiAgICAgICAgICBhY3Rpb25CdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzYXZlXCI6XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXCJTYXZlIFByb3ZpZGVyXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGlucHV0c1xuICAgIGNvbnN0IHZhbGlkYXRlRm9ybSA9ICgpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0gPT4ge1xuICAgICAgLy8gQ2hlY2sgbmFtZVxuICAgICAgaWYgKCFuYW1lSW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJQcm92aWRlciBuYW1lIGlzIHJlcXVpcmVkXCIgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgVVJMXG4gICAgICBjb25zdCB1cmxWYWxpZGF0aW9uID0gdmFsaWRhdGVFbmRwb2ludFVybCh1cmxJbnB1dC52YWx1ZSk7XG4gICAgICBpZiAoIXVybFZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICByZXR1cm4gdXJsVmFsaWRhdGlvbjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgQVBJIGtleSAocmVxdWlyZWQgZm9yIG5vbi1sb2NhbCBlbmRwb2ludHMpXG4gICAgICBjb25zdCBpc0xvY2FsID1cbiAgICAgICAgdXJsSW5wdXQudmFsdWUuaW5jbHVkZXMoXCJsb2NhbGhvc3RcIikgfHxcbiAgICAgICAgdXJsSW5wdXQudmFsdWUuaW5jbHVkZXMoXCIxMjcuMC4wLjFcIik7XG4gICAgICBpZiAoIWlzTG9jYWwgJiYgIWFwaUtleUlucHV0LnZhbHVlLnRyaW0oKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBcIkFQSSBrZXkgaXMgcmVxdWlyZWQgZm9yIHJlbW90ZSBlbmRwb2ludHNcIixcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogdHJ1ZSB9O1xuICAgIH07XG5cbiAgICAvLyBIYW5kbGUgYnV0dG9uIGNsaWNrXG4gICAgYWN0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdGVGb3JtKCk7XG5cbiAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgIC8vIFNob3cgZXJyb3JcbiAgICAgICAgdXJsRXJyb3IudGV4dENvbnRlbnQgPSB2YWxpZGF0aW9uLmVycm9yIHx8IFwiSW52YWxpZCBmb3JtIGRhdGFcIjtcbiAgICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzQ29ubmVjdGlvblRlc3RlZCkge1xuICAgICAgICAvLyBUZXN0IGNvbm5lY3Rpb25cbiAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoXCJ0ZXN0aW5nXCIpO1xuXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gY3JlYXRlUHJvdmlkZXJGcm9tRm9ybSgpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24oXG4gICAgICAgICAgcHJvdmlkZXJcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICBpc0Nvbm5lY3Rpb25UZXN0ZWQgPSB0cnVlO1xuICAgICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKFwic2F2ZVwiKTtcbiAgICAgICAgICB0ZXN0UmVzdWx0ID0gcmVzdWx0O1xuXG4gICAgICAgICAgLy8gU2hvdyBzdWNjZXNzIG1lc3NhZ2VcbiAgICAgICAgICB1cmxFcnJvci50ZXh0Q29udGVudCA9IGBDb25uZWN0aW9uIHN1Y2Nlc3NmdWwhIEZvdW5kICR7XG4gICAgICAgICAgICByZXN1bHQubW9kZWxzPy5sZW5ndGggfHwgMFxuICAgICAgICAgIH0gbW9kZWxzLmA7XG4gICAgICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiKTtcbiAgICAgICAgICB1cmxFcnJvci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItc3VjY2Vzc1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInJldHJ5XCIpO1xuXG4gICAgICAgICAgLy8gU2hvdyBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgdXJsRXJyb3IudGV4dENvbnRlbnQgPSByZXN1bHQuZXJyb3IgfHwgXCJDb25uZWN0aW9uIGZhaWxlZFwiO1xuICAgICAgICAgIHVybEVycm9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvci1oaWRkZW5cIik7XG4gICAgICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXN1Y2Nlc3NcIik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNhdmUgcHJvdmlkZXJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBjcmVhdGVQcm92aWRlckZyb21Gb3JtKCk7XG5cbiAgICAgICAgLy8gQWRkIHRvIHNldHRpbmdzXG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycyA9IFtcbiAgICAgICAgICAuLi50aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMsXG4gICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgIF07XG5cbiAgICAgICAgLy8gU2F2ZSBzZXR0aW5nc1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblxuICAgICAgICAvLyBDbG9zZSBhbmQgZ28gYmFja1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIHRoaXMub25CYWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURm9sZGVyLCBBYnN0cmFjdElucHV0U3VnZ2VzdCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgRm9sZGVyU3VnZ2VzdGVyIGV4dGVuZHMgQWJzdHJhY3RJbnB1dFN1Z2dlc3Q8c3RyaW5nPiB7XG4gIHByaXZhdGUgY29udGVudDogU2V0PHN0cmluZz47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICAgIHByaXZhdGUgb25TZWxlY3RDYjogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgYXBwOiBBcHBcbiAgKSB7XG4gICAgc3VwZXIoYXBwLCBpbnB1dEVsKTtcbiAgICB0aGlzLmNvbnRlbnQgPSBnZXRGb2xkZXJTdWdnZXN0aW9ucyhhcHApO1xuICB9XG5cbiAgZ2V0U3VnZ2VzdGlvbnMoaW5wdXRTdHI6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBsb3dlckNhc2VJbnB1dFN0ciA9IGlucHV0U3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIFsuLi50aGlzLmNvbnRlbnRdLmZpbHRlcigoY29udGVudCkgPT5cbiAgICAgIGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlckNhc2VJbnB1dFN0cilcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyU3VnZ2VzdGlvbihjb250ZW50OiBzdHJpbmcsIGVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGVsLnNldFRleHQoY29udGVudCk7XG4gIH1cblxuICBzZWxlY3RTdWdnZXN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZXZ0OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMub25TZWxlY3RDYihjb250ZW50KTtcbiAgICB0aGlzLmlucHV0RWwudmFsdWUgPSBjb250ZW50O1xuICAgIHRoaXMuaW5wdXRFbC5ibHVyKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb2xkZXJTdWdnZXN0aW9ucyhhcHA6IEFwcCk6IFNldDxzdHJpbmc+IHtcbiAgY29uc3QgZm9sZGVycyA9IGFwcC52YXVsdFxuICAgIC5nZXRBbGxMb2FkZWRGaWxlcygpXG4gICAgLmZpbHRlcigoZmlsZSkgPT4gZmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIGFzIFRGb2xkZXJbXTtcbiAgcmV0dXJuIG5ldyBTZXQoZm9sZGVycy5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLnBhdGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaEZvbGRlclN1Z2dlc3RlcihcbiAgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudCxcbiAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4gdm9pZCxcbiAgYXBwOiBBcHBcbik6IEZvbGRlclN1Z2dlc3RlciB7XG4gIHJldHVybiBuZXcgRm9sZGVyU3VnZ2VzdGVyKGlucHV0RWwsIG9uU2VsZWN0LCBhcHApO1xufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFRGaWxlLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBhdHRhY2hGaWxlU3VnZ2VzdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRmlsZVN1Z2dlc3RlclwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0UHJlc2V0IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5cbmZ1bmN0aW9uIHNhbml0aXplRmlsZU5hbWUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIG5hbWUucmVwbGFjZSgvW15hLXpBLVowLTktXyBdL2csIFwiXCIpLnJlcGxhY2UoLyAvZywgXCItXCIpO1xufVxuXG5mdW5jdGlvbiBnZXRTeXN0ZW1Qcm9tcHRQYXRoKGRpcmVjdG9yeTogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGAke2RpcmVjdG9yeX0vJHtmaWxlTmFtZX0ubWRgO1xufVxuXG5leHBvcnQgdHlwZSBTeXN0ZW1Qcm9tcHRNb2RlID0gXCJkZWZhdWx0XCIgfCBcImNoYXQtc3BlY2lmaWNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnMge1xuICBvblNhdmU/OiAobmV3UHJvbXB0OiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk/OiBzdHJpbmc7XG4gIG1vZGU6IFN5c3RlbVByb21wdE1vZGU7XG4gIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICBtb2RlbENvbnRleHRMZW5ndGg/OiBudW1iZXI7XG4gIHRva2VuTGltaXRQZXJjZW50YWdlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdFJlc3VsdCB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiO1xuICBwYXRoPzogc3RyaW5nO1xuICB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVByb21wdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHJlc3VsdDogU3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogU3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21JbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21TZWN0aW9uOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvcHRpb25zOiBTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnM7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0U2VydmljZTogU3lzdGVtUHJvbXB0U2VydmljZTtcbiAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRzOiBTeXN0ZW1Qcm9tcHRQcmVzZXRbXSA9IFtdO1xuICBwcml2YXRlIHRva2VuTGltaXRJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVzZXRCdXR0b25Db250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGFjdGl2ZVByZXNldDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gICAgb3B0aW9uczogU3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb2RhbEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsXCIsIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLW1vZGFsXCIpO1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OlxuICAgICAgICBvcHRpb25zLnN5c3RlbVByb21wdHNEaXJlY3RvcnkgPz8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIixcbiAgICB9O1xuICAgIHRoaXMuc3lzdGVtUHJvbXB0U2VydmljZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKGFwcCk7XG4gIH1cblxuICBwcml2YXRlIHNob3dMb2FkaW5nKHNob3c6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMubG9hZGluZ0luZGljYXRvciB8fCAhdGhpcy5jb250ZW50Q29udGFpbmVyKSByZXR1cm47XG5cbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgIHRoaXMuY29udGVudENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwibm9uZVwiIDogXCJibG9ja1wiO1xuICB9XG5cbiAgYXN5bmMgbG9hZFN5c3RlbVByb21wdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcodHJ1ZSk7XG4gICAgICB0aGlzLnN5c3RlbVByb21wdHMgPSBhd2FpdCB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0cygpO1xuXG4gICAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgYWZ0ZXIgbG9hZGluZyBkYXRhXG4gICAgICB0aGlzLmNyZWF0ZVByZXNldEJ1dHRvbnMoKTtcblxuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRmFpbGVkIHRvIGxvYWQgc3lzdGVtIHByb21wdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJlc2V0QnV0dG9ucygpIHtcbiAgICBpZiAoIXRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICAvLyBDbGVhciBleGlzdGluZyBidXR0b25zXG4gICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuZW1wdHkoKTtcblxuICAgIC8vIEluaXRpYWxpemUgYWN0aXZlIHByZXNldCBiYXNlZCBvbiBjdXJyZW50IHByb21wdFxuICAgIHRoaXMuc3lzdGVtUHJvbXB0cy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgIGlmIChwcmVzZXQuc3lzdGVtUHJvbXB0ID09PSB0aGlzLmN1cnJlbnRQcm9tcHQpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQubGFiZWw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJZiBubyBwcmVzZXQgbWF0Y2hlcywgY2hlY2sgZm9yIGdlbmVyYWwtdXNlIG1hdGNoXG4gICAgaWYgKCF0aGlzLmFjdGl2ZVByZXNldCAmJiB0aGlzLmN1cnJlbnRQcm9tcHQpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBcImdlbmVyYWwtdXNlXCIgcHJvbXB0IHRleHQgZXhhY3RseSBtYXRjaGVzIHRoZSB1c2VyJ3MgY3VycmVudCBwcm9tcHRcbiAgICAgIGNvbnN0IGdlbmVyYWxVc2VQcmVzZXQgPSB0aGlzLnN5c3RlbVByb21wdHMuZmluZChcbiAgICAgICAgKHApID0+IHAuaWQgPT09IFwiZ2VuZXJhbC11c2VcIlxuICAgICAgKTtcbiAgICAgIGlmIChcbiAgICAgICAgZ2VuZXJhbFVzZVByZXNldCAmJlxuICAgICAgICBnZW5lcmFsVXNlUHJlc2V0LnN5c3RlbVByb21wdC50cmltKCkgPT09IHRoaXMuY3VycmVudFByb21wdC50cmltKClcbiAgICAgICkge1xuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IGdlbmVyYWxVc2VQcmVzZXQubGFiZWw7IC8vIGUuZy4gXCJHZW5lcmFsLXVzZVwiXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGYWxsIGJhY2sgdG8gZ2VuZXJhbC11c2UgYW5kIHVzZSBpdHMgc3lzdGVtIHByb21wdFxuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IFwiR2VuZXJhbC11c2VcIjtcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEgJiYgZ2VuZXJhbFVzZVByZXNldCkge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBnZW5lcmFsVXNlUHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9ucyBmb3IgZWFjaCBzeXN0ZW0gcHJvbXB0XG4gICAgY29uc3QgcHJlc2V0QnV0dG9ucyA9IFtcbiAgICAgIC4uLnRoaXMuc3lzdGVtUHJvbXB0cyxcbiAgICAgIC8vIE9ubHkgYWRkIGN1c3RvbSBpZiBpdCdzIG5vdCBhbHJlYWR5IGluIHN5c3RlbVByb21wdHNcbiAgICAgIC4uLighdGhpcy5zeXN0ZW1Qcm9tcHRzLnNvbWUoKHApID0+IHAuaWQgPT09IFwiY3VzdG9tXCIpXG4gICAgICAgID8gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJjdXN0b21cIixcbiAgICAgICAgICAgICAgbGFiZWw6IFwiQ3VzdG9tXCIsXG4gICAgICAgICAgICAgIGlzVXNlckNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgc3lzdGVtUHJvbXB0OiBcIlwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdXG4gICAgICAgIDogW10pLFxuICAgIF0ubWFwKChwcmVzZXQpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgdGV4dDogcHJlc2V0LmxhYmVsLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTZXQgaW5pdGlhbCBhY3RpdmUgc3RhdGVcbiAgICAgIGlmIChwcmVzZXQubGFiZWwgPT09IHRoaXMuYWN0aXZlUHJlc2V0KSB7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHByZXNldC5sYWJlbCA9PT0gXCJDdXN0b21cIikge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAvLyBSZW1vdmUgYWN0aXZlIGNsYXNzIGZyb20gYWxsIGJ1dHRvbnNcbiAgICAgICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXJcbiAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiKVxuICAgICAgICAgIC5mb3JFYWNoKChidG4pID0+IGJ0bi5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKSk7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQubGFiZWw7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRleHQgYXJlYSBhbmQgY3VzdG9tIHNlY3Rpb24gYmFzZWQgb24gcHJlc2V0XG4gICAgICAgIGlmIChwcmVzZXQubGFiZWwgPT09IFwiQ3VzdG9tXCIpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICB0aGlzLmN1c3RvbUlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gIXByZXNldC5pc1VzZXJDb25maWd1cmFibGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtY29udGVudFwiKTtcblxuICAgIC8vIENyZWF0ZSBsb2FkaW5nIGluZGljYXRvclxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtbG9hZGluZ1wiKTtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5wYWRkaW5nID0gXCIyMHB4XCI7XG4gICAgY29uc3QgbG9hZGluZ1RleHQgPSB0aGlzLmxvYWRpbmdJbmRpY2F0b3IuY3JlYXRlU3BhbigpO1xuICAgIGxvYWRpbmdUZXh0LnNldFRleHQoXCJMb2FkaW5nIHN5c3RlbSBwcm9tcHRzLi4uXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGNvbnRlbnQgY29udGFpbmVyXG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWNvbnRlbnQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gU2V0IHRpdGxlIGFuZCBkZXNjcmlwdGlvbiBiYXNlZCBvbiBtb2RlXG4gICAgY29uc3QgdGl0bGUgPVxuICAgICAgdGhpcy5vcHRpb25zLm1vZGUgPT09IFwiZGVmYXVsdFwiXG4gICAgICAgID8gXCJFZGl0IERlZmF1bHQgU3lzdGVtIFByb21wdFwiXG4gICAgICAgIDogXCJDaGF0IFZpZXcgU2V0dGluZ3NcIjtcblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uID1cbiAgICAgIHRoaXMub3B0aW9ucy5tb2RlID09PSBcImRlZmF1bHRcIlxuICAgICAgICA/IFwiQ2hhbmdlcyB3aWxsIGFwcGx5IGFzIHRoZSBkZWZhdWx0IGZvciBhbGwgbmV3IGNoYXQgdmlld3NcIlxuICAgICAgICA6IFwiQ29uZmlndXJlIHNldHRpbmdzIGZvciB0aGlzIHNwZWNpZmljIGNoYXQgdmlld1wiO1xuXG4gICAgLy8gQWRkIHRpdGxlXG4gICAgdGhpcy50aXRsZUVsLnNldFRleHQodGl0bGUpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvbiB0ZXh0IGRpcmVjdGx5IGFmdGVyIHRpdGxlXG4gICAgY29uc3QgZGVzY3JpcHRpb25FbCA9IHRoaXMudGl0bGVFbC5jcmVhdGVEaXYoKTtcbiAgICBkZXNjcmlwdGlvbkVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIpO1xuICAgIGRlc2NyaXB0aW9uRWwuc2V0VGV4dChkZXNjcmlwdGlvbik7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmZvbnRTaXplID0gXCIwLjllbVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUubWFyZ2luVG9wID0gXCIwLjJlbVwiO1xuXG4gICAgY29uc3QgdGV4dEFyZWFDb250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b24gY29udGFpbmVyIGJ1dCBkb24ndCBwb3B1bGF0ZSB5ZXRcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGN1c3RvbSBzZWN0aW9uIChoaWRkZW4gYnkgZGVmYXVsdClcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24gPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tc2VjdGlvblwiXG4gICAgKTtcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgY3VzdG9tSW5wdXRDb250YWluZXIgPSB0aGlzLmN1c3RvbVNlY3Rpb24uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIGlucHV0IGFuZCBidXR0b25cbiAgICBjb25zdCBpbnB1dFdyYXBwZXIgPSBjdXN0b21JbnB1dENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1pbnB1dC13cmFwcGVyXCJcbiAgICApO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmdhcCA9IFwiOHB4XCI7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuXG4gICAgLy8gQWRkIHRoZSBzZWFyY2ggaW5wdXRcbiAgICB0aGlzLmN1c3RvbUlucHV0ID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2ggZm9yIGEgc3lzdGVtIHByb21wdCBmaWxlLi4uXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1pbnB1dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjcmVhdGUgbmV3IGJ1dHRvblxuICAgIGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IGlucHV0V3JhcHBlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNyZWF0ZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUucGFkZGluZyA9IFwiNHB4IDhweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICBzZXRJY29uKGNyZWF0ZUJ1dHRvbiwgXCJwbHVzXCIpO1xuXG4gICAgY3JlYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgdGVtcGxhdGVDb250ZW50ID0gXCJcIjtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRlbXBsYXRlQ29udGVudCA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5zeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdFRlbXBsYXRlKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJDcmVhdGUgTmV3IFN5c3RlbSBQcm9tcHRcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJFbnRlciBhIHRpdGxlIGFuZCBjb250ZW50IGZvciB5b3VyIG5ldyBzeXN0ZW0gcHJvbXB0LiBUaGUgdGl0bGUgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIG1hcmtkb3duIGZpbGUgdGhhdCB5b3UgY2FuIGN1c3RvbWl6ZSBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJDcmVhdGVcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIk15IEN1c3RvbSBBc3Npc3RhbnRcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tdGl0bGUtaW5wdXRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgICAgIHZhbHVlOiB0ZW1wbGF0ZUNvbnRlbnQsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLWNvbnRlbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzdWx0Py5jb25maXJtZWQgfHwgIXJlc3VsdC5pbnB1dHM/LlswXSB8fCAhcmVzdWx0LmlucHV0cz8uWzFdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3RpdGxlLCBjb250ZW50XSA9IHJlc3VsdC5pbnB1dHM7XG4gICAgICBjb25zdCBwcm9tcHRzRGlyZWN0b3J5ID1cbiAgICAgICAgdGhpcy5vcHRpb25zLnN5c3RlbVByb21wdHNEaXJlY3RvcnkgPz8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIjtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gc2FuaXRpemVGaWxlTmFtZSh0aXRsZSk7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGdldFN5c3RlbVByb21wdFBhdGgocHJvbXB0c0RpcmVjdG9yeSwgZmlsZU5hbWUpO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwcm9tcHRzRGlyZWN0b3J5KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgLyogRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QgKi9cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBgIyAke3RpdGxlfVxcblxcbiR7Y29udGVudH1gO1xuICAgICAgICBjb25zdCBmaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSB0ZXh0YXJlYSB3aXRoIHRoZSBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGZpbGVDb250ZW50O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgZmlsZVxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gZmlsZVBhdGg7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN5c3RlbSBwcm9tcHQgZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuXG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICA6IFwiRmFpbGVkIHRvIGNyZWF0ZSBzeXN0ZW0gcHJvbXB0IGZpbGUuIFBsZWFzZSB0cnkgYWdhaW4uXCI7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZXJyb3JNZXNzYWdlLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBPbmx5IGF0dGFjaCBmaWxlIHN1Z2dlc3RlciBhZnRlciBpbnB1dCBpcyBjcmVhdGVkXG4gICAgaWYgKHRoaXMuY3VzdG9tSW5wdXQpIHtcbiAgICAgIGF0dGFjaEZpbGVTdWdnZXN0ZXIoXG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQsXG4gICAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHNlbGVjdGVkUGF0aCk7XG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBjb250ZW50O1xuICAgICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCB2YWx1ZSB3aXRob3V0IC5tZCBleHRlbnNpb25cbiAgICAgICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHNlbGVjdGVkUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5vcHRpb25zLnN5c3RlbVByb21wdHNEaXJlY3RvcnkgPz8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHN5c3RlbSBwcm9tcHRcIixcbiAgICAgICAgcmVhZE9ubHk6IHRoaXMuYWN0aXZlUHJlc2V0ICE9PSBcIkN1c3RvbVwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gdGhpcy5jdXJyZW50UHJvbXB0O1xuXG4gICAgLy8gQWRkIHRva2VuIGxpbWl0IHNlY3Rpb24gb25seSBmb3IgY2hhdC1zcGVjaWZpYyBtb2RlLCBhZnRlciB0aGUgdGV4dGFyZWFcbiAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09IFwiY2hhdC1zcGVjaWZpY1wiKSB7XG4gICAgICBjb25zdCB0b2tlbkxpbWl0Q29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1jb250YWluZXJcIixcbiAgICAgIH0pO1xuICAgICAgdG9rZW5MaW1pdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgICB0b2tlbkxpbWl0Q29udGFpbmVyLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJmbGV4LWVuZFwiO1xuICAgICAgdG9rZW5MaW1pdENvbnRhaW5lci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcbiAgICAgIHRva2VuTGltaXRDb250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gXCIxcmVtXCI7XG4gICAgICB0b2tlbkxpbWl0Q29udGFpbmVyLnN0eWxlLmdhcCA9IFwiOHB4XCI7XG5cbiAgICAgIGNvbnN0IHRva2VuTGltaXRXcmFwcGVyID0gdG9rZW5MaW1pdENvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LXdyYXBwZXJcIixcbiAgICAgIH0pO1xuICAgICAgdG9rZW5MaW1pdFdyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgdG9rZW5MaW1pdFdyYXBwZXIuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwiY29sdW1uXCI7XG4gICAgICB0b2tlbkxpbWl0V3JhcHBlci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJmbGV4LWVuZFwiO1xuICAgICAgdG9rZW5MaW1pdFdyYXBwZXIuc3R5bGUud2lkdGggPSBcIjUwJVwiO1xuXG4gICAgICBjb25zdCB0b2tlbkxpbWl0TGFiZWwgPSB0b2tlbkxpbWl0V3JhcHBlci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWxhYmVsXCIsXG4gICAgICAgIHRleHQ6IFwiQ29udGV4dCBUb2tlbiBMaW1pdFwiLFxuICAgICAgfSk7XG4gICAgICB0b2tlbkxpbWl0TGFiZWwuc3R5bGUuZm9udFdlaWdodCA9IFwiNTAwXCI7XG4gICAgICB0b2tlbkxpbWl0TGFiZWwuc3R5bGUubWFyZ2luQm90dG9tID0gXCI0cHhcIjtcbiAgICAgIHRva2VuTGltaXRMYWJlbC5zdHlsZS5mb250U2l6ZSA9IFwiMTRweFwiO1xuXG4gICAgICBjb25zdCBpbnB1dFdyYXBwZXIgPSB0b2tlbkxpbWl0V3JhcHBlci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWlucHV0LXdyYXBwZXJcIixcbiAgICAgIH0pO1xuICAgICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIGlucHV0V3JhcHBlci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcbiAgICAgIGlucHV0V3JhcHBlci5zdHlsZS5nYXAgPSBcIjRweFwiO1xuICAgICAgaW5wdXRXcmFwcGVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cbiAgICAgIHRoaXMudG9rZW5MaW1pdElucHV0ID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgICB0eXBlOiBcInJhbmdlXCIsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtaW5wdXRcIixcbiAgICAgICAgYXR0cjoge1xuICAgICAgICAgIG1pbjogXCIwXCIsXG4gICAgICAgICAgbWF4OiBcIjEwMFwiLFxuICAgICAgICAgIHN0ZXA6IFwiMVwiLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLm9wdGlvbnMudG9rZW5MaW1pdFBlcmNlbnRhZ2U/LnRvU3RyaW5nKCkgfHwgXCIwXCIsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHRoaXMudG9rZW5MaW1pdElucHV0LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cbiAgICAgIGNvbnN0IHZhbHVlRGlzcGxheSA9IGlucHV0V3JhcHBlci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWRpc3BsYXlcIixcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnRva2VuTGltaXRQZXJjZW50YWdlXG4gICAgICAgICAgPyB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoXG4gICAgICAgICAgICA/IGAke01hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgKCh0aGlzLm9wdGlvbnMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgLyAxMDApICpcbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGgpIC9cbiAgICAgICAgICAgICAgICAgIDEwMDBcbiAgICAgICAgICAgICAgKX1LYFxuICAgICAgICAgICAgOiBgJHt0aGlzLm9wdGlvbnMudG9rZW5MaW1pdFBlcmNlbnRhZ2V9JWBcbiAgICAgICAgICA6IFwiXHUyMjFFXCIsXG4gICAgICB9KTtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS5taW5XaWR0aCA9IFwiNDVweFwiO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLnRleHRBbGlnbiA9IFwicmlnaHRcIjtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS5mb250VmFyaWFudE51bWVyaWMgPSBcInRhYnVsYXItbnVtc1wiO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLmZvbnRTaXplID0gXCIxNHB4XCI7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUuZm9udFdlaWdodCA9IFwiNTAwXCI7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtYWNjZW50KVwiO1xuXG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHRva2VuTGltaXRXcmFwcGVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtZGVzY3JpcHRpb25cIixcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aFxuICAgICAgICAgID8gYE1vZGVsIG1heDogJHtNYXRoLmZsb29yKFxuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoIC8gMTAwMFxuICAgICAgICAgICAgKX1LIHRva2Vuc2BcbiAgICAgICAgICA6IFwiU2V0IHRvIDAlIGZvciBubyBsaW1pdFwiLFxuICAgICAgfSk7XG4gICAgICBkZXNjcmlwdGlvbi5zdHlsZS5mb250U2l6ZSA9IFwiMTJweFwiO1xuICAgICAgZGVzY3JpcHRpb24uc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgICBkZXNjcmlwdGlvbi5zdHlsZS5tYXJnaW5Ub3AgPSBcIjRweFwiO1xuXG4gICAgICAvLyBVcGRhdGUgZGlzcGxheSB3aGVuIHNsaWRlciBjaGFuZ2VzXG4gICAgICB0aGlzLnRva2VuTGltaXRJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHBhcnNlSW50KChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSwgMTApO1xuICAgICAgICBpZiAocGVyY2VudGFnZSA9PT0gMCkge1xuICAgICAgICAgIHZhbHVlRGlzcGxheS5zZXRUZXh0KFwiXHUyMjFFXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCB0b2tlbnMgPSBNYXRoLmZsb29yKFxuICAgICAgICAgICAgKChwZXJjZW50YWdlIC8gMTAwKSAqIHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGgpIC8gMTAwMFxuICAgICAgICAgICk7XG4gICAgICAgICAgdmFsdWVEaXNwbGF5LnNldFRleHQoYCR7dG9rZW5zfUtgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWx1ZURpc3BsYXkuc2V0VGV4dChgJHtwZXJjZW50YWdlfSVgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSWYgXCJDdXN0b21cIiBpcyBhY3RpdmUsIGZpbGwgdGhlIGN1c3RvbUlucHV0IHdpdGggdGhlIHVzZXItcHJvdmlkZWQgcGF0aFxuICAgIGlmICh0aGlzLmFjdGl2ZVByZXNldCA9PT0gXCJDdXN0b21cIiAmJiB0aGlzLm9wdGlvbnMuY3VzdG9tUHJvbXB0RmlsZVBhdGgpIHtcbiAgICAgIC8vIFJlbW92ZSBhbnkgZXhpc3RpbmcgcmVsYXRpdmUgbGluayBtYXJrZXJzXG4gICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gdGhpcy5vcHRpb25zLmN1c3RvbVByb21wdEZpbGVQYXRoLnJlcGxhY2UoXG4gICAgICAgIC9eXFxbXFxbKC4qPylcXF1cXF0kLyxcbiAgICAgICAgXCIkMVwiXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZCByZXNpemUgb2JzZXJ2ZXIgdG8gaGFuZGxlIGR5bmFtaWMgY29udGVudFxuICAgIGNvbnN0IHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMudGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgIH0pO1xuICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy50ZXh0QXJlYSk7XG5cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdCA9IG51bGw7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBzZWNvbmRhcnlCdXR0b24ub25jbGljayA9IGhhbmRsZUNhbmNlbDtcblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJTYXZlXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlU2F2ZSA9ICgpID0+IHtcbiAgICAgIC8vIEZpbmQgd2hpY2ggcHJlc2V0IGlzIGFjdGl2ZVxuICAgICAgY29uc3QgYWN0aXZlQnV0dG9uID0gdGhpcy5tb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiLnN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uLmFjdGl2ZVwiXG4gICAgICApO1xuICAgICAgY29uc3QgYWN0aXZlUHJlc2V0TGFiZWwgPSBhY3RpdmVCdXR0b24/LnRleHRDb250ZW50ID8/IFwiXCI7XG5cbiAgICAgIGxldCByZXN1bHQ6IFN5c3RlbVByb21wdFJlc3VsdDtcblxuICAgICAgaWYgKGFjdGl2ZVByZXNldExhYmVsID09PSBcIkN1c3RvbVwiICYmIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUpIHtcbiAgICAgICAgLy8gUmVtb3ZlIC5tZCBleHRlbnNpb24gYW5kIGNvbnZlcnQgdG8gcmVsYXRpdmUgbGluayBmb3JtYXRcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3VzdG9tSW5wdXQudmFsdWUucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICBjb250ZW50OiB0aGlzLnRleHRBcmVhLnZhbHVlLFxuICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IHRoaXMuc3lzdGVtUHJvbXB0cy5maW5kKFxuICAgICAgICAgIChwKSA9PiBwLmxhYmVsID09PSBhY3RpdmVQcmVzZXRMYWJlbFxuICAgICAgICApO1xuICAgICAgICBpZiAocHJlc2V0KSB7XG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgY29udGVudDogcHJlc2V0LnN5c3RlbVByb21wdCxcbiAgICAgICAgICAgIHR5cGU6IHByZXNldC5pZCBhcyBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjayB0byBjdXJyZW50IGNvbnRlbnQgaWYgbm8gcHJlc2V0IGZvdW5kXG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgY29udGVudDogdGhpcy50ZXh0QXJlYS52YWx1ZSxcbiAgICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG9rZW4gbGltaXQgaWYgaW4gY2hhdC1zcGVjaWZpYyBtb2RlIGFuZCBhIHZhbHVlIGlzIHNldFxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm9wdGlvbnMubW9kZSA9PT0gXCJjaGF0LXNwZWNpZmljXCIgJiZcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0SW5wdXQ/LnZhbHVlXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHBhcnNlSW50KHRoaXMudG9rZW5MaW1pdElucHV0LnZhbHVlLCAxMCk7XG4gICAgICAgIGlmIChwZXJjZW50YWdlID4gMCkge1xuICAgICAgICAgIC8vIFN0b3JlIHRoZSBwZXJjZW50YWdlIHZhbHVlIGRpcmVjdGx5XG4gICAgICAgICAgcmVzdWx0LnRva2VuTGltaXRQZXJjZW50YWdlID0gcGVyY2VudGFnZTtcbiAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgbW9kZWwgY29udGV4dCBsZW5ndGgsIGFsc28gY2FsY3VsYXRlIGFuZCBzdG9yZSB0aGUgYWN0dWFsIHRva2VuIGxpbWl0XG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3VsdC50b2tlbkxpbWl0ID0gTWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgKHBlcmNlbnRhZ2UgLyAxMDApICogdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBwcmltYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVTYXZlO1xuXG4gICAgLy8gSGFuZGxlIGtleWJvYXJkIGV2ZW50c1xuICAgIHRoaXMubW9kYWxFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgLy8gT25seSBoYW5kbGUgRW50ZXIgaWYgbm90IGluIHRleHRhcmVhICh3aGVyZSB3ZSB3YW50IHRvIGFsbG93IG5ld2xpbmVzKVxuICAgICAgaWYgKFxuICAgICAgICBlLmtleSA9PT0gXCJFbnRlclwiICYmXG4gICAgICAgICFlLmlzQ29tcG9zaW5nICYmXG4gICAgICAgICFlLnNoaWZ0S2V5ICYmXG4gICAgICAgIGUudGFyZ2V0ICE9PSB0aGlzLnRleHRBcmVhXG4gICAgICApIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVTYXZlKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlQ2FuY2VsKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGb2N1cyB0aGUgdGV4dGFyZWEgYW5kIHBsYWNlIGN1cnNvciBhdCB0aGUgZW5kXG4gICAgdGhpcy50ZXh0QXJlYS5mb2N1cygpO1xuICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UoXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aCxcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoXG4gICAgKTtcblxuICAgIC8vIFN0YXJ0IGxvYWRpbmcgcHJvbXB0cyBhZnRlciBVSSBpcyBzZXQgdXBcbiAgICBhd2FpdCB0aGlzLmxvYWRTeXN0ZW1Qcm9tcHRzKCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8U3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd1N5c3RlbVByb21wdE1vZGFsKFxuICBhcHA6IEFwcCxcbiAgY3VycmVudFByb21wdDogc3RyaW5nLFxuICBvcHRpb25zPzogUGFydGlhbDxTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnM+XG4pOiBQcm9taXNlPFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucyA9IHtcbiAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiLFxuICAgIG1vZGU6IFwiZGVmYXVsdFwiLFxuICAgIG1vZGVsQ29udGV4dExlbmd0aDogdW5kZWZpbmVkLFxuICB9O1xuXG4gIGNvbnN0IG1vZGFsID0gbmV3IFN5c3RlbVByb21wdE1vZGFsKGFwcCwgY3VycmVudFByb21wdCwge1xuICAgIC4uLmRlZmF1bHRPcHRpb25zLFxuICAgIC4uLm9wdGlvbnMsXG4gIH0pO1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcblxuICBpZiAocmVzdWx0ICE9PSBudWxsICYmIG9wdGlvbnM/Lm9uU2F2ZSkge1xuICAgIGF3YWl0IG9wdGlvbnMub25TYXZlKHJlc3VsdC5jb250ZW50KTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNYXJrZG93blZpZXcsIE5vdGljZSwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHtcbiAgVHJhbnNjcmlwdGlvblNlcnZpY2UsXG4gIHR5cGUgVHJhbnNjcmlwdGlvbkNvbnRleHQsXG59IGZyb20gXCIuL1RyYW5zY3JpcHRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCB9IGZyb20gXCIuLi9tb2RhbHMvQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWxcIjtcbmltcG9ydCB7IENIQVRfVklFV19UWVBFLCBDaGF0VmlldyB9IGZyb20gXCIuLi92aWV3cy9DaGF0Vmlld1wiO1xuXG4vLyBFZGl0b3JIYW5kbGVyIGludGVyZmFjZSBhbmQgaW1wbGVtZW50YXRpb25zXG5pbnRlcmZhY2UgRWRpdG9ySGFuZGxlciB7XG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKTogdm9pZDtcbn1cblxuY2xhc3MgTWFya2Rvd25FZGl0b3JIYW5kbGVyIGltcGxlbWVudHMgRWRpdG9ySGFuZGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHApIHt9XG5cbiAgaW5zZXJ0VGV4dCh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICBpZiAoIWFjdGl2ZVZpZXc/LmVkaXRvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiTm8gYWN0aXZlIG1hcmtkb3duIGVkaXRvciBmb3VuZCBmb3IgcGFzdGluZ1wiKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChubyBhY3RpdmUgbm90ZSlcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZWRpdG9yID0gYWN0aXZlVmlldy5lZGl0b3I7XG4gICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3Vyc29yLmxpbmUpO1xuXG4gICAgY29uc3QgdGV4dFRvSW5zZXJ0ID0gdGV4dFxuICAgICAgPyBjdXJzb3IuY2ggPiAwICYmIGxpbmVDb250ZW50Lmxlbmd0aCA+IDBcbiAgICAgICAgPyBcIlxcblwiICsgdGV4dFxuICAgICAgICA6IHRleHRcbiAgICAgIDogXCJcIjtcblxuICAgIGlmICghdGV4dFRvSW5zZXJ0KSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyB0ZXh0IHRvIGluc2VydFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlZGl0b3IucmVwbGFjZVJhbmdlKHRleHRUb0luc2VydCwgY3Vyc29yKTtcbiAgICBjb25zdCBsaW5lcyA9IHRleHRUb0luc2VydC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBsYXN0TGluZSA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdIHx8IFwiXCI7XG5cbiAgICBlZGl0b3Iuc2V0Q3Vyc29yKHtcbiAgICAgIGxpbmU6IGN1cnNvci5saW5lICsgbGluZXMubGVuZ3RoIC0gMSxcbiAgICAgIGNoOiBsYXN0TGluZS5sZW5ndGgsXG4gICAgfSk7XG5cbiAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gcGFzdGVkIGludG8gbm90ZVwiKTtcbiAgfVxufVxuXG5jbGFzcyBDaGF0RWRpdG9ySGFuZGxlciBpbXBsZW1lbnRzIEVkaXRvckhhbmRsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiAoKHRleHQ6IHN0cmluZykgPT4gdm9pZCkgfCB1bmRlZmluZWRcbiAgKSB7fVxuXG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgIHRoaXMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUodGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIGNoYXQgaGFuZGxlciBmb3VuZCBmb3IgdHJhbnNjcmlwdGlvblwiKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChjaGF0IGhhbmRsZXIgbWlzc2luZylcIik7XG4gICAgfVxuICB9XG59XG5cbi8vIFByaW9yaXRpemVkIE1JTUUgdHlwZXMgZm9yIHJlY29yZGluZ1xuY29uc3QgUkVDT1JESU5HX0ZPUk1BVFMgPSBbXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vd2VibTtjb2RlY3M9b3B1c1wiLCBleHRlbnNpb246IFwid2VibVwiLCBzYW1wbGVSYXRlOiAxNjAwMCB9LCAvLyBPcHRpbWFsIGZvciBzcGVlY2gsIHNtYWxsIHNpemVcbiAgeyBtaW1lVHlwZTogXCJhdWRpby93ZWJtXCIsIGV4dGVuc2lvbjogXCJ3ZWJtXCIsIHNhbXBsZVJhdGU6IDQ4MDAwIH0sIC8vIEZhbGxiYWNrIHdpdGggZGVmYXVsdCBjb2RlY1xuICB7IG1pbWVUeXBlOiBcImF1ZGlvL29nZztjb2RlY3M9b3B1c1wiLCBleHRlbnNpb246IFwib2dnXCIsIHNhbXBsZVJhdGU6IDQ4MDAwIH0sIC8vIEFsdGVybmF0aXZlIE9wdXMgY29udGFpbmVyXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vd2F2XCIsIGV4dGVuc2lvbjogXCJ3YXZcIiwgc2FtcGxlUmF0ZTogNDgwMDAgfSwgLy8gTGFzdCByZXNvcnQgZmFsbGJhY2tcbl0gYXMgY29uc3Q7XG5cbmludGVyZmFjZSBBdWRpb0NodW5rIHtcbiAgYmxvYjogQmxvYjtcbiAgc2FtcGxlUmF0ZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgUmVjb3JkZXJPcHRpb25zIHtcbiAgaXNJbkNoYXQ/OiBib29sZWFuO1xuICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZT86ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmludGVyZmFjZSBSZWNvcmRpbmdDb250ZXh0IHtcbiAgaXNJbkNoYXQ6IGJvb2xlYW47XG4gIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlPzogKHRleHQ6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFJlY29yZGVyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBSZWNvcmRlclNlcnZpY2U7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBvblRvZ2dsZUNhbGxiYWNrczogU2V0PChpc1JlY29yZGluZzogYm9vbGVhbikgPT4gdm9pZD4gPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgbWVkaWFTdHJlYW06IE1lZGlhU3RyZWFtIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbWVkaWFSZWNvcmRlcjogTWVkaWFSZWNvcmRlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGNodW5rczogQXVkaW9DaHVua1tdID0gW107XG4gIHByaXZhdGUgc2VsZWN0ZWRGb3JtYXQ6ICh0eXBlb2YgUkVDT1JESU5HX0ZPUk1BVFMpW251bWJlcl0gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBsYXN0UmVjb3JkZWRGaWxlUGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhbmFseXNlcjogQW5hbHlzZXJOb2RlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYW5pbWF0aW9uRnJhbWU6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNtb290aGVkVmFsdWVzOiBGbG9hdDMyQXJyYXk7XG4gIHByaXZhdGUgcmVhZG9ubHkgc21vb3RoaW5nRmFjdG9yID0gMC40O1xuICBwcml2YXRlIHZpc3VhbGl6ZXJDYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY3VycmVudENvbnRleHQ6IFJlY29yZGluZ0NvbnRleHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWNvcmRpbmdNb2RhbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkcmFnQ2xlYW51cDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZWRpdG9ySGFuZGxlcjogRWRpdG9ySGFuZGxlciB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgb3B0aW9uczogUmVjb3JkZXJPcHRpb25zID0ge31cbiAgKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zbW9vdGhlZFZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkoMTI4KTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHQob3B0aW9ucyk7XG4gICAgY29uc29sZS5sb2coXCJSZWNvcmRlclNlcnZpY2UgaW5pdGlhbGl6ZWRcIik7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgb3B0aW9uczogUmVjb3JkZXJPcHRpb25zID0ge31cbiAgKTogUmVjb3JkZXJTZXJ2aWNlIHtcbiAgICBpZiAoIVJlY29yZGVyU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgY29uc29sZS5sb2coXCJDcmVhdGluZyBuZXcgUmVjb3JkZXJTZXJ2aWNlIGluc3RhbmNlXCIpO1xuICAgICAgUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFJlY29yZGVyU2VydmljZShhcHAsIHBsdWdpbik7XG4gICAgfVxuXG4gICAgLy8gQWx3YXlzIHVwZGF0ZSBjb250ZXh0IHdoZW4gZ2V0SW5zdGFuY2UgaXMgY2FsbGVkXG4gICAgUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlLnVwZGF0ZUNvbnRleHQob3B0aW9ucyk7XG4gICAgcmV0dXJuIFJlY29yZGVyU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QWN0aXZlVmlld0luZm8oKTogeyBpc0NoYXQ6IGJvb2xlYW47IHZpZXdJZGVudGlmaWVyOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgYWN0aXZlTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVMZWFmO1xuICAgIGlmICghYWN0aXZlTGVhZikge1xuICAgICAgcmV0dXJuIHsgaXNDaGF0OiBmYWxzZSwgdmlld0lkZW50aWZpZXI6IFwidW5rbm93blwiIH07XG4gICAgfVxuXG4gICAgY29uc3Qgdmlld1N0YXRlID0gYWN0aXZlTGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICBjb25zdCB2aWV3VHlwZSA9IHZpZXdTdGF0ZS50eXBlO1xuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIGNoYXQgdmlld1xuICAgIGlmICh2aWV3VHlwZSA9PT0gQ0hBVF9WSUVXX1RZUEUpIHtcbiAgICAgIHJldHVybiB7IGlzQ2hhdDogdHJ1ZSwgdmlld0lkZW50aWZpZXI6IFwiY2hhdFwiIH07XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIG1hcmtkb3duIHZpZXdcbiAgICBjb25zdCBtYXJrZG93blZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgIGlmIChtYXJrZG93blZpZXc/LmZpbGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQ2hhdDogZmFsc2UsXG4gICAgICAgIHZpZXdJZGVudGlmaWVyOiBgbm90ZS0ke21hcmtkb3duVmlldy5maWxlLnBhdGh9YCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaXNDaGF0OiBmYWxzZSwgdmlld0lkZW50aWZpZXI6IFwidW5rbm93blwiIH07XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUNvbnRleHQob3B0aW9uczogUmVjb3JkZXJPcHRpb25zKSB7XG4gICAgY29uc3QgeyBpc0NoYXQgfSA9IHRoaXMuZ2V0QWN0aXZlVmlld0luZm8oKTtcbiAgICB0aGlzLmN1cnJlbnRDb250ZXh0ID0ge1xuICAgICAgaXNJbkNoYXQ6IGlzQ2hhdCxcbiAgICAgIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiBvcHRpb25zLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGluc2VydFRleHRJbnRvQWN0aXZlVmlldyh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCB7IGlzQ2hhdCB9ID0gdGhpcy5nZXRBY3RpdmVWaWV3SW5mbygpO1xuXG4gICAgaWYgKGlzQ2hhdCkge1xuICAgICAgY29uc3QgY2hhdFZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShDaGF0Vmlldyk7XG4gICAgICBpZiAoY2hhdFZpZXcpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBjaGF0Vmlldy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLnN5c3RlbXNjdWxwdC1jaGF0LWlucHV0XCJcbiAgICAgICAgKSBhcyBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICBjb25zdCBjdXJzb3JQb3MgPSBpbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuICAgICAgICAgIGlmIChjdXJzb3JQb3MgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEluc2VydCBhdCBjdXJzb3IgcG9zaXRpb25cbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID1cbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKDAsIGN1cnNvclBvcykgK1xuICAgICAgICAgICAgICB0ZXh0ICtcbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKGN1cnNvclBvcyk7XG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgLy8gTW92ZSBjdXJzb3IgdG8gZW5kIG9mIGluc2VydGVkIHRleHRcbiAgICAgICAgICAgIGlucHV0LnNlbGVjdGlvblN0YXJ0ID0gaW5wdXQuc2VsZWN0aW9uRW5kID0gY3Vyc29yUG9zICsgdGV4dC5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEFwcGVuZCB0byBlbmQgaWYgbm8gY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGN1cnJlbnRWYWx1ZSArIHRleHQ7XG4gICAgICAgICAgICBpbnB1dC5zZWxlY3Rpb25TdGFydCA9IGlucHV0LnNlbGVjdGlvbkVuZCA9IGlucHV0LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUcmlnZ2VyIGlucHV0IGV2ZW50IGZvciBoZWlnaHQgYWRqdXN0bWVudCBhbmQgdG9rZW4gY291bnRpbmdcbiAgICAgICAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcbiAgICAgICAgICAvLyBGb2N1cyB0aGUgaW5wdXQgYWZ0ZXIgaW5zZXJ0aW9uXG4gICAgICAgICAgaW5wdXQuZm9jdXMoKTtcblxuICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBwYXN0ZWQgaW50byBjaGF0XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcIkNoYXQgaW5wdXQgZWxlbWVudCBub3QgZm91bmRcIik7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKG5vIGNoYXQgaW5wdXQpXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJObyBhY3RpdmUgY2hhdCB2aWV3IGZvdW5kXCIpO1xuICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gYWN0aXZlIGNoYXQpXCIpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtYXJrZG93blZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgaWYgKCFtYXJrZG93blZpZXc/LmVkaXRvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJObyBhY3RpdmUgbWFya2Rvd24gZWRpdG9yIGZvdW5kXCIpO1xuICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gYWN0aXZlIG5vdGUpXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVkaXRvciA9IG1hcmtkb3duVmlldy5lZGl0b3I7XG4gICAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgICBjb25zdCBsaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKTtcbiAgICAgIGNvbnN0IHRleHRUb0luc2VydCA9IHRleHRcbiAgICAgICAgPyBjdXJzb3IuY2ggPiAwICYmIGxpbmVDb250ZW50Lmxlbmd0aCA+IDBcbiAgICAgICAgICA/IFwiXFxuXCIgKyB0ZXh0XG4gICAgICAgICAgOiB0ZXh0XG4gICAgICAgIDogXCJcIjtcblxuICAgICAgaWYgKCF0ZXh0VG9JbnNlcnQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiTm8gdGV4dCB0byBpbnNlcnRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZSh0ZXh0VG9JbnNlcnQsIGN1cnNvcik7XG4gICAgICBjb25zdCBsaW5lcyA9IHRleHRUb0luc2VydC5zcGxpdChcIlxcblwiKTtcbiAgICAgIGNvbnN0IGxhc3RMaW5lID0gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0gfHwgXCJcIjtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3Ioe1xuICAgICAgICBsaW5lOiBjdXJzb3IubGluZSArIGxpbmVzLmxlbmd0aCAtIDEsXG4gICAgICAgIGNoOiBsYXN0TGluZS5sZW5ndGgsXG4gICAgICB9KTtcblxuICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIHBhc3RlZCBpbnRvIG5vdGVcIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2NyaWJlTGFzdFJlY29yZGluZygpIHtcbiAgICBpZiAoIXRoaXMubGFzdFJlY29yZGVkRmlsZVBhdGgpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgdGhpcy5sYXN0UmVjb3JkZWRGaWxlUGF0aFxuICAgICAgKTtcbiAgICAgIGlmICghZmlsZSB8fCAhKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcblxuICAgICAgY29uc3QgbW9kYWwgPSBuZXcgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwodGhpcy5hcHAsIHtcbiAgICAgICAgZmlsZSxcbiAgICAgICAgaXNDaGF0OiB0aGlzLmN1cnJlbnRDb250ZXh0Py5pc0luQ2hhdCA/PyBmYWxzZSxcbiAgICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6ICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29udGV4dD8ub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRleHQub25UcmFuc2NyaXB0aW9uQ29tcGxldGUodGV4dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0VGV4dEludG9BY3RpdmVWaWV3KHRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgIH0pO1xuICAgICAgbW9kYWwub3BlbigpO1xuXG4gICAgICAvLyBDbGVhbiB1cCB0aGUgcmVjb3JkaW5nIGZpbGVcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5kZWxldGUoZmlsZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gY2xlYW4gdXAgcmVjb3JkaW5nIGZpbGU6XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1dG8tdHJhbnNjcmlwdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3NEMgRmFpbGVkIHRvIHRyYW5zY3JpYmUgYXVkaW9cIik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVJlY29yZGluZ01vZGFsKCk6IHZvaWQge1xuICAgIC8vIENsZWFudXAgYW55IG9sZCBpbnN0YW5jZVxuICAgIGlmICh0aGlzLnJlY29yZGluZ01vZGFsKSB7XG4gICAgICBpZiAodGhpcy5kcmFnQ2xlYW51cCkge1xuICAgICAgICB0aGlzLmRyYWdDbGVhbnVwKCk7XG4gICAgICAgIHRoaXMuZHJhZ0NsZWFudXAgPSBudWxsO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5yZW1vdmUoKTtcbiAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0aGUgbmV3IGZsb2F0aW5nIG1vZGFsXG4gICAgdGhpcy5yZWNvcmRpbmdNb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1tb2RhbFwiO1xuXG4gICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGVudC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1jb250ZW50XCI7XG5cbiAgICBjb25zdCBsaXZlSW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBsaXZlSW5kaWNhdG9yLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXJlY29yZGVyLWxpdmVcIjtcbiAgICBsaXZlSW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJcdTI1Q0YgTGl2ZVwiO1xuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQobGl2ZUluZGljYXRvcik7XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhcy5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1jYW52YXNcIjtcbiAgICBjb250ZW50LmFwcGVuZENoaWxkKGNhbnZhcyk7XG5cbiAgICB0aGlzLnJlY29yZGluZ01vZGFsLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5yZWNvcmRpbmdNb2RhbCk7XG5cbiAgICB0aGlzLmRyYWdDbGVhbnVwID0gdGhpcy5zZXR1cERyYWdnYWJsZSh0aGlzLnJlY29yZGluZ01vZGFsKTtcbiAgICB0aGlzLnNldFZpc3VhbGl6ZXJDYW52YXMoY2FudmFzKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBEcmFnZ2FibGUoZWxlbWVudDogSFRNTEVsZW1lbnQpOiAoKSA9PiB2b2lkIHtcbiAgICAvLyBUcmFjayBwb3NpdGlvbiBzdGF0ZVxuICAgIGxldCBwb3MgPSB7IHg6IDAsIHk6IDAgfTtcblxuICAgIC8vIENsZWFuIGV2ZW50IGhhbmRsaW5nXG4gICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImRyYWdnaW5nXCIpO1xuICAgIH07XG5cbiAgICAvLyBTaW1wbGUgbW92ZSBoYW5kbGVyIHdpdGggYm91bmRzIGNoZWNraW5nXG4gICAgY29uc3Qgb25Nb3ZlID0gKGNsaWVudFg6IG51bWJlciwgY2xpZW50WTogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHBvcy54ID0gTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KDAsIGNsaWVudFggLSByZWN0LndpZHRoIC8gMiksXG4gICAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC0gcmVjdC53aWR0aFxuICAgICAgKTtcbiAgICAgIHBvcy55ID0gTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KDAsIGNsaWVudFkgLSByZWN0LmhlaWdodCAvIDIpLFxuICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHQgLSByZWN0LmhlaWdodFxuICAgICAgKTtcblxuICAgICAgLy8gUmVtb3ZlIGJvdHRvbS9yaWdodCBwb3NpdGlvbmluZyB3aGVuIGRyYWdnaW5nIHN0YXJ0c1xuICAgICAgZWxlbWVudC5zdHlsZS5ib3R0b20gPSBcIlwiO1xuICAgICAgZWxlbWVudC5zdHlsZS5yaWdodCA9IFwiXCI7XG5cbiAgICAgIC8vIEFwcGx5IG5ldyBwb3NpdGlvblxuICAgICAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7cG9zLnh9cHhgO1xuICAgICAgZWxlbWVudC5zdHlsZS50b3AgPSBgJHtwb3MueX1weGA7XG4gICAgfTtcblxuICAgIC8vIFBvaW50ZXIgZXZlbnQgaGFuZGxlcnNcbiAgICBjb25zdCBvblBvaW50ZXJEb3duID0gKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xuICAgICAgLy8gT25seSBoYW5kbGUgbGVmdCBjbGljayBvciB0b3VjaFxuICAgICAgaWYgKGUuYnV0dG9uICE9PSAwICYmIGUuYnV0dG9uICE9PSAtMSkgcmV0dXJuO1xuXG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkcmFnZ2luZ1wiKTtcbiAgICAgIGVsZW1lbnQuc2V0UG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpO1xuXG4gICAgICAvLyBTZXQgaW5pdGlhbCBwb3NpdGlvbiBiYXNlZCBvbiBjdXJyZW50IGxvY2F0aW9uXG4gICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHBvcy54ID0gcmVjdC5sZWZ0O1xuICAgICAgcG9zLnkgPSByZWN0LnRvcDtcblxuICAgICAgLy8gSW5pdGlhbCBtb3ZlIHRvIHByZXZlbnQganVtcHNcbiAgICAgIG9uTW92ZShlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uUG9pbnRlck1vdmUgPSAoZTogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5oYXNQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCkpIHtcbiAgICAgICAgb25Nb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgb25Qb2ludGVyVXAgPSAoZTogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICBjbGVhbnVwKCk7XG4gICAgICBlbGVtZW50LnJlbGVhc2VQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7XG4gICAgfTtcblxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBvblBvaW50ZXJEb3duKTtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLCBvblBvaW50ZXJNb3ZlKTtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIiwgb25Qb2ludGVyVXApO1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIiwgY2xlYW51cCk7XG5cbiAgICAvLyBDbGVhbnVwIGZ1bmN0aW9uIGZvciByZW1vdmluZyBsaXN0ZW5lcnNcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcmRvd25cIiwgb25Qb2ludGVyRG93bik7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLCBvblBvaW50ZXJNb3ZlKTtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBvblBvaW50ZXJVcCk7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsIGNsZWFudXApO1xuICAgIH07XG4gIH1cblxuICBhc3luYyB0b2dnbGVSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGhpcy5pc1JlY29yZGluZykge1xuICAgICAgICBjb25zdCB7IGlzQ2hhdCwgdmlld0lkZW50aWZpZXIgfSA9IHRoaXMuZ2V0QWN0aXZlVmlld0luZm8oKTtcblxuICAgICAgICBpZiAodmlld0lkZW50aWZpZXIgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1MjZBMFx1RkUwRiBQbGVhc2Ugb3BlbiBhIG5vdGUgb3IgY2hhdCBiZWZvcmUgcmVjb3JkaW5nXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgcmVjb3JkaW5nIGluIHZpZXc6XCIsIHtcbiAgICAgICAgICBpc0NoYXQsXG4gICAgICAgICAgdmlld0lkZW50aWZpZXIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBjb250ZXh0IHdpdGggY3VycmVudCB2aWV3IGluZm9cbiAgICAgICAgdGhpcy51cGRhdGVDb250ZXh0KHtcbiAgICAgICAgICBpc0luQ2hhdDogaXNDaGF0LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBbHdheXMgY3JlYXRlIHRoZSBkcmFnZ2FibGUgbW9kYWxcbiAgICAgICAgdGhpcy5jcmVhdGVSZWNvcmRpbmdNb2RhbCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc1JlY29yZGluZykge1xuICAgICAgICBhd2FpdCB0aGlzLnN0b3BSZWNvcmRpbmcoKTtcblxuICAgICAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgICAgIGlmICh0aGlzLmRyYWdDbGVhbnVwKSB7XG4gICAgICAgICAgICB0aGlzLmRyYWdDbGVhbnVwKCk7XG4gICAgICAgICAgICB0aGlzLmRyYWdDbGVhbnVwID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5yZW1vdmUoKTtcbiAgICAgICAgICB0aGlzLnJlY29yZGluZ01vZGFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydFJlY29yZGluZygpO1xuICAgICAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuY2xhc3NMaXN0LmFkZChcInJlY29yZGluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdG9nZ2xpbmcgcmVjb3JkaW5nOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byB0b2dnbGUgcmVjb3JkaW5nXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlUmVjb3JkaW5nRGlyZWN0b3J5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRpciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3Rvcnk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKGRpcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCI7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSByZWNvcmRpbmdzIGRpcmVjdG9yeTpcIiwgZXJyb3JNZXNzYWdlKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSByZWNvcmRpbmdzIGRpcmVjdG9yeTogJHtlcnJvck1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RTdXBwb3J0ZWRGb3JtYXQoKTogUHJvbWlzZTxcbiAgICAodHlwZW9mIFJFQ09SRElOR19GT1JNQVRTKVtudW1iZXJdXG4gID4ge1xuICAgIGZvciAoY29uc3QgZm9ybWF0IG9mIFJFQ09SRElOR19GT1JNQVRTKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoZm9ybWF0Lm1pbWVUeXBlKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBTZWxlY3RlZCByZWNvcmRpbmcgZm9ybWF0OiAke2Zvcm1hdC5taW1lVHlwZX1gKTtcbiAgICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYEZvcm1hdCAke2Zvcm1hdC5taW1lVHlwZX0gY2hlY2sgZmFpbGVkOmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gc3VwcG9ydGVkIGF1ZGlvIHJlY29yZGluZyBmb3JtYXQgZm91bmRcIik7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlRmlsZU5hbWUoKTogc3RyaW5nIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5vd1xuICAgICAgLnRvSVNPU3RyaW5nKClcbiAgICAgIC5yZXBsYWNlKC9bOi5dL2csIFwiLVwiKVxuICAgICAgLnJlcGxhY2UoXCJUXCIsIFwiX1wiKVxuICAgICAgLnNwbGl0KFwiLlwiKVswXTtcbiAgICByZXR1cm4gYCR7dGltZXN0YW1wfS4ke3RoaXMuc2VsZWN0ZWRGb3JtYXQ/LmV4dGVuc2lvbiB8fCBcImF1ZGlvXCJ9YDtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTogdm9pZCB7XG4gICAgLy8gUmVzZXQgc21vb3RoZWQgdmFsdWVzXG4gICAgdGhpcy5zbW9vdGhlZFZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkoMTI4KTtcblxuICAgIC8vIENhbmNlbCBhbnkgb25nb2luZyBhbmltYXRpb25cbiAgICBpZiAodGhpcy5hbmltYXRpb25GcmFtZSkge1xuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25GcmFtZSk7XG4gICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBQcm9wZXJseSBkaXNjb25uZWN0IGFuZCBudWxsIG91dCBhbmFseXplclxuICAgIGlmICh0aGlzLmFuYWx5c2VyKSB7XG4gICAgICB0aGlzLmFuYWx5c2VyLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuYW5hbHlzZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENsb3NlIGFuZCBudWxsIG91dCBhdWRpbyBjb250ZXh0XG4gICAgaWYgKHRoaXMuYXVkaW9Db250ZXh0KSB7XG4gICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jbG9zZSgpO1xuICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGNhbnZhcyBpZiBpdCBleGlzdHNcbiAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgaWYgKGN0eCkge1xuICAgICAgICBjdHguY2xlYXJSZWN0KFxuICAgICAgICAgIDAsXG4gICAgICAgICAgMCxcbiAgICAgICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMud2lkdGgsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBWaXN1YWxpemF0aW9uKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tZWRpYVN0cmVhbSkgcmV0dXJuO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyBhdWRpbyBjb250ZXh0XG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KHtcbiAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgbGF0ZW5jeUhpbnQ6IFwiaW50ZXJhY3RpdmVcIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBhbmQgY29ubmVjdCBtZWRpYSBzdHJlYW0gc291cmNlXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UodGhpcy5tZWRpYVN0cmVhbSk7XG5cbiAgICAvLyBDcmVhdGUgYW5kIGNvbmZpZ3VyZSBhbmFseXplclxuICAgIHRoaXMuYW5hbHlzZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVBbmFseXNlcigpO1xuICAgIHRoaXMuYW5hbHlzZXIuZmZ0U2l6ZSA9IDI1NjtcbiAgICB0aGlzLmFuYWx5c2VyLnNtb290aGluZ1RpbWVDb25zdGFudCA9IDAuNztcblxuICAgIC8vIENvbm5lY3Qgc291cmNlIHRvIGFuYWx5emVyXG4gICAgc291cmNlLmNvbm5lY3QodGhpcy5hbmFseXNlcik7XG5cbiAgICAvLyBTdGFydCB2aXN1YWxpemF0aW9uIGlmIGNhbnZhcyBleGlzdHNcbiAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNhbnZhc1NpemUoKTtcbiAgICAgIHRoaXMuZHJhdygpO1xuICAgIH1cbiAgfVxuXG4gIHNldFZpc3VhbGl6ZXJDYW52YXMoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCB8IG51bGwpOiB2b2lkIHtcbiAgICAvLyBDbGVhbiB1cCBvbGQgY2FudmFzXG4gICAgaWYgKHRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGlmIChjdHgpIHtcbiAgICAgICAgY3R4LmNsZWFyUmVjdChcbiAgICAgICAgICAwLFxuICAgICAgICAgIDAsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoLFxuICAgICAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy5oZWlnaHRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXNldCBzdGF0ZSBpZiByZW1vdmluZyBjYW52YXNcbiAgICBpZiAoIWNhbnZhcykge1xuICAgICAgdGhpcy5yZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpO1xuICAgIH1cblxuICAgIHRoaXMudmlzdWFsaXplckNhbnZhcyA9IGNhbnZhcztcblxuICAgIC8vIEluaXRpYWxpemUgbmV3IGNhbnZhcyBpZiByZWNvcmRpbmdcbiAgICBpZiAoY2FudmFzICYmIHRoaXMuaXNSZWNvcmRpbmcpIHtcbiAgICAgIHRoaXMudXBkYXRlQ2FudmFzU2l6ZSgpO1xuICAgICAgLy8gUmVpbml0aWFsaXplIHZpc3VhbGl6YXRpb24gaWYgbmVlZGVkXG4gICAgICBpZiAoIXRoaXMuYXVkaW9Db250ZXh0IHx8ICF0aGlzLmFuYWx5c2VyKSB7XG4gICAgICAgIHRoaXMuc2V0dXBWaXN1YWxpemF0aW9uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUNhbnZhc1NpemUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHJldHVybjtcblxuICAgIGNvbnN0IHJlY3QgPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblxuICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy53aWR0aCA9IHJlY3Qud2lkdGggKiBkcHI7XG4gICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodCA9IHJlY3QuaGVpZ2h0ICogZHByO1xuXG4gICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBpZiAoY3R4KSB7XG4gICAgICBjdHguc2NhbGUoZHByLCBkcHIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc3RhcnRSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuaXNSZWNvcmRpbmcpIHJldHVybjtcblxuICAgIC8vIFJlc2V0IGFsbCB2aXN1YWxpemF0aW9uIHN0YXRlIGJlZm9yZSBzdGFydGluZ1xuICAgIHRoaXMucmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmVuc3VyZVJlY29yZGluZ0RpcmVjdG9yeSgpO1xuXG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB3ZSBoYXZlIHBlcm1pc3Npb25cbiAgICAgIGNvbnN0IHBlcm1pc3Npb25SZXN1bHQgPSBhd2FpdCBuYXZpZ2F0b3IucGVybWlzc2lvbnMucXVlcnkoe1xuICAgICAgICBuYW1lOiBcIm1pY3JvcGhvbmVcIiBhcyBQZXJtaXNzaW9uTmFtZSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocGVybWlzc2lvblJlc3VsdC5zdGF0ZSA9PT0gXCJkZW5pZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaWNyb3Bob25lIHBlcm1pc3Npb24gZGVuaWVkXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZXRlY3Qgc3VwcG9ydGVkIGZvcm1hdCBiZWZvcmUgc3RhcnRpbmdcbiAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtYXQgPSBhd2FpdCB0aGlzLmRldGVjdFN1cHBvcnRlZEZvcm1hdCgpO1xuXG4gICAgICBjb25zdCBhdWRpb0NvbnN0cmFpbnRzOiBNZWRpYVRyYWNrQ29uc3RyYWludHMgPSB7XG4gICAgICAgIGVjaG9DYW5jZWxsYXRpb246IHRydWUsXG4gICAgICAgIG5vaXNlU3VwcHJlc3Npb246IHRydWUsXG4gICAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgICBjaGFubmVsQ291bnQ6IDEsIC8vIE1vbm8gZm9yIHNwZWVjaFxuICAgICAgfTtcblxuICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGRldmljZXMgPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKTtcbiAgICAgICAgICBjb25zdCBwcmVmZXJyZWREZXZpY2UgPSBkZXZpY2VzLmZpbmQoXG4gICAgICAgICAgICAoZGV2aWNlKSA9PlxuICAgICAgICAgICAgICBkZXZpY2Uua2luZCA9PT0gXCJhdWRpb2lucHV0XCIgJiZcbiAgICAgICAgICAgICAgZGV2aWNlLmRldmljZUlkID09PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKHByZWZlcnJlZERldmljZSkge1xuICAgICAgICAgICAgYXVkaW9Db25zdHJhaW50cy5kZXZpY2VJZCA9IHtcbiAgICAgICAgICAgICAgZXhhY3Q6IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCA9IFwiXCI7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICBcIlByZWZlcnJlZCBtaWNyb3Bob25lIG5vdCBmb3VuZCwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHRcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoZWNraW5nIG1pY3JvcGhvbmUgZGV2aWNlczpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcXVlc3QgbWVkaWEgc3RyZWFtXG4gICAgICB0aGlzLm1lZGlhU3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICBhdWRpbzogYXVkaW9Db25zdHJhaW50cyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgbWVkaWEgcmVjb3JkZXJcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlciA9IG5ldyBNZWRpYVJlY29yZGVyKHRoaXMubWVkaWFTdHJlYW0sIHtcbiAgICAgICAgbWltZVR5cGU6IHRoaXMuc2VsZWN0ZWRGb3JtYXQubWltZVR5cGUsXG4gICAgICB9KTtcblxuICAgICAgLy8gU2V0IHVwIGRhdGEgaGFuZGxpbmdcbiAgICAgIHRoaXMuY2h1bmtzID0gW107XG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIub25kYXRhYXZhaWxhYmxlID0gYXN5bmMgKGU6IEJsb2JFdmVudCkgPT4ge1xuICAgICAgICBpZiAoZS5kYXRhLnNpemUgPiAwKSB7XG4gICAgICAgICAgdGhpcy5jaHVua3MucHVzaCh7XG4gICAgICAgICAgICBibG9iOiBlLmRhdGEsXG4gICAgICAgICAgICBzYW1wbGVSYXRlOiB0aGlzLnNlbGVjdGVkRm9ybWF0Py5zYW1wbGVSYXRlID8/IDQ4MDAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBIYW5kbGUgcmVjb3JkaW5nIHN0b3BcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5vbnN0b3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gU2F2ZSB0aGUgcmVjb3JkaW5nXG4gICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLmdlbmVyYXRlRmlsZU5hbWUoKTtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3Rvcnl9LyR7ZmlsZU5hbWV9YDtcblxuICAgICAgICAgIC8vIENvbWJpbmUgYWxsIGNodW5rcyBpbnRvIGEgc2luZ2xlIGJsb2JcbiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoXG4gICAgICAgICAgICB0aGlzLmNodW5rcy5tYXAoKGNodW5rKSA9PiBjaHVuay5ibG9iKSxcbiAgICAgICAgICAgIHsgdHlwZTogdGhpcy5zZWxlY3RlZEZvcm1hdD8ubWltZVR5cGUgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IGJsb2IgdG8gYXJyYXkgYnVmZmVyXG4gICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgICAgICAvLyBTYXZlIHRvIGZpbGVcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuYWRhcHRlci53cml0ZUJpbmFyeShcbiAgICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgICAgYXJyYXlCdWZmZXJcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gU3RvcmUgdGhlIHBhdGggZm9yIHRyYW5zY3JpcHRpb25cbiAgICAgICAgICB0aGlzLmxhc3RSZWNvcmRlZEZpbGVQYXRoID0gZmlsZVBhdGg7XG5cbiAgICAgICAgICAvLyBTdGFydCB0cmFuc2NyaXB0aW9uXG4gICAgICAgICAgYXdhaXQgdGhpcy50cmFuc2NyaWJlTGFzdFJlY29yZGluZygpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSByZWNvcmRpbmc6XCIsIGVycm9yKTtcbiAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byBzYXZlIHJlY29yZGluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gU3RhcnQgcmVjb3JkaW5nIHdpdGggYSBzbWFsbGVyIHRpbWVzbGljZSBmb3IgbW9yZSBmcmVxdWVudCBvbmRhdGFhdmFpbGFibGUgZXZlbnRzXG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhcnQoMTAwMCk7XG5cbiAgICAgIC8vIFNldCB1cCB2aXN1YWxpemF0aW9uIGNoYWluXG4gICAgICB0aGlzLnNldHVwVmlzdWFsaXphdGlvbigpO1xuXG4gICAgICB0aGlzLmlzUmVjb3JkaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKCk7XG5cbiAgICAgIC8vIFN0YXJ0IHZpc3VhbGl6YXRpb24gaW1tZWRpYXRlbHlcbiAgICAgIGlmICh0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWNvcmRpbmcgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJSZWNvcmRpbmcgZmFpbGVkXCI7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHN0b3BSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzUmVjb3JkaW5nKSByZXR1cm47XG5cbiAgICAvLyBTdG9wIG1lZGlhIHJlY29yZGVyIGZpcnN0XG4gICAgaWYgKHRoaXMubWVkaWFSZWNvcmRlciAmJiB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgIT09IFwiaW5hY3RpdmVcIikge1xuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0b3AoKTtcbiAgICB9XG5cbiAgICAvLyBTdG9wIGFsbCBtZWRpYSB0cmFja3NcbiAgICBpZiAodGhpcy5tZWRpYVN0cmVhbSkge1xuICAgICAgdGhpcy5tZWRpYVN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4gdHJhY2suc3RvcCgpKTtcbiAgICAgIHRoaXMubWVkaWFTdHJlYW0gPSBudWxsO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IGFsbCB2aXN1YWxpemF0aW9uIHN0YXRlXG4gICAgdGhpcy5yZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpO1xuXG4gICAgLy8gUmVtb3ZlIHJlY29yZGluZyBjbGFzcyBmcm9tIG1vZGFsXG4gICAgaWYgKHRoaXMucmVjb3JkaW5nTW9kYWwpIHtcbiAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcInJlY29yZGluZ1wiKTtcbiAgICB9XG5cbiAgICB0aGlzLm1lZGlhUmVjb3JkZXIgPSBudWxsO1xuICAgIHRoaXMuaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3ID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5pc1JlY29yZGluZyB8fCAhdGhpcy5hbmFseXNlciB8fCAhdGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICBpZiAodGhpcy5hbmltYXRpb25GcmFtZSkge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIGFuaW1hdGlvbiBmcmFtZSBiZWZvcmUgc3RhcnRpbmcgbmV3IG9uZVxuICAgIGlmICh0aGlzLmFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcbiAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYW5hbHlzZXIuZnJlcXVlbmN5QmluQ291bnQ7XG4gICAgY29uc3QgZGF0YUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyTGVuZ3RoKTtcbiAgICB0aGlzLmFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7XG5cbiAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSByZXR1cm47XG5cbiAgICAvLyBDbGVhciB0aGUgY2FudmFzIGJlZm9yZSBkcmF3aW5nXG4gICAgY3R4LmNsZWFyUmVjdChcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoLFxuICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodFxuICAgICk7XG5cbiAgICBjb25zdCByZWN0ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHdpZHRoID0gcmVjdC53aWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSByZWN0LmhlaWdodDtcbiAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjtcbiAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHJlc3BvbnNpdmUgdmFsdWVzIGJhc2VkIG9uIHNjcmVlbiB3aWR0aFxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2lkdGggPD0gNDAwO1xuICAgIGNvbnN0IG92ZXJsYXAgPSBpc01vYmlsZSA/IDMgOiA1OyAvLyBSZWR1Y2VkIG92ZXJsYXAgcG9pbnRzIGZvciBtb2JpbGVcbiAgICBjb25zdCBjZW50ZXJPdmVybGFwU2NhbGUgPSBpc01vYmlsZSA/IDQgOiA4OyAvLyBSZWR1Y2VkIGNlbnRlciBvdmVybGFwIGZvciBtb2JpbGVcbiAgICBjb25zdCBhbXBsaXR1ZGVTY2FsZSA9IGlzTW9iaWxlID8gMC44IDogMC45NTsgLy8gU2xpZ2h0bHkgcmVkdWNlZCBhbXBsaXR1ZGUgZm9yIG1vYmlsZVxuICAgIGNvbnN0IGVkZ2Vab25lU2NhbGUgPSBpc01vYmlsZSA/IDAuMTUgOiAwLjI7IC8vIEFkanVzdGVkIGVkZ2UgdGFwZXIgem9uZSBmb3IgbW9iaWxlXG5cbiAgICAvLyBHZXQgdGhlIGNvbXB1dGVkIGFjY2VudCBjb2xvciB3aXRoIGZhbGxiYWNrXG4gICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTtcbiAgICBsZXQgYWNjZW50Q29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLXRleHQtYWNjZW50XCIpLnRyaW0oKTtcbiAgICBpZiAoIWFjY2VudENvbG9yKSB7XG4gICAgICBhY2NlbnRDb2xvciA9IFwiIzU4NzFlZlwiO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBncmFkaWVudFxuICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIGhlaWdodCk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIGFjY2VudENvbG9yKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCBhY2NlbnRDb2xvcik7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIGFjY2VudENvbG9yKTtcbiAgICBjdHguZmlsbFN0eWxlID0gZ3JhZGllbnQ7XG5cbiAgICAvLyBEcmF3IHRoZSB3YXZlZm9ybVxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKGNlbnRlclgsIGNlbnRlclkpO1xuXG4gICAgY29uc3QgaGFsZkJ1ZmZlckxlbmd0aCA9IE1hdGguZmxvb3IoYnVmZmVyTGVuZ3RoIC8gMik7XG4gICAgY29uc3Qgc2xpY2VXaWR0aCA9IHdpZHRoIC8gMiAvIGhhbGZCdWZmZXJMZW5ndGg7XG4gICAgY29uc3QgY2VudGVyT3ZlcmxhcCA9IHNsaWNlV2lkdGggKiBjZW50ZXJPdmVybGFwU2NhbGU7XG5cbiAgICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGVkZ2UgdGFwZXJcbiAgICBjb25zdCBnZXRFZGdlVGFwZXIgPSAoaTogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBlZGdlWm9uZSA9IHRvdGFsICogZWRnZVpvbmVTY2FsZTtcbiAgICAgIGlmIChpIDwgZWRnZVpvbmUpIHtcbiAgICAgICAgcmV0dXJuIDAuMyArIDAuNyAqIChpIC8gZWRnZVpvbmUpO1xuICAgICAgfSBlbHNlIGlmIChpID4gdG90YWwgLSBlZGdlWm9uZSkge1xuICAgICAgICByZXR1cm4gMC4zICsgMC43ICogKCh0b3RhbCAtIGkpIC8gZWRnZVpvbmUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDE7XG4gICAgfTtcblxuICAgIC8vIERyYXcgcmlnaHQgc2lkZSAodG9wIGhhbGYpXG4gICAgZm9yIChsZXQgaSA9IC1vdmVybGFwOyBpIDwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXA7IGkrKykge1xuICAgICAgY29uc3QgdmFsdWUgPSBkYXRhQXJyYXlbTWF0aC5hYnMoaSldIC8gMjU1LjA7XG4gICAgICBjb25zdCBpbmRleCA9IE1hdGgubWluKE1hdGguYWJzKGkpLCBoYWxmQnVmZmVyTGVuZ3RoIC0gMSk7XG4gICAgICB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSA9XG4gICAgICAgIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogdGhpcy5zbW9vdGhpbmdGYWN0b3IgK1xuICAgICAgICB2YWx1ZSAqICgxIC0gdGhpcy5zbW9vdGhpbmdGYWN0b3IpO1xuXG4gICAgICBjb25zdCB4ID0gY2VudGVyWCArIGkgKiBzbGljZVdpZHRoIC0gY2VudGVyT3ZlcmxhcDtcbiAgICAgIGNvbnN0IHRhcGVyID0gZ2V0RWRnZVRhcGVyKGkgKyBvdmVybGFwLCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAqIDIpO1xuICAgICAgY29uc3QgeSA9XG4gICAgICAgIGNlbnRlclkgLSB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIGNlbnRlclkgKiBhbXBsaXR1ZGVTY2FsZSAqIHRhcGVyO1xuICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICB9XG5cbiAgICAvLyBEcmF3IHJpZ2h0IHNpZGUgKGJvdHRvbSBoYWxmKVxuICAgIGZvciAobGV0IGkgPSBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAtIDE7IGkgPj0gLW92ZXJsYXA7IGktLSkge1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihNYXRoLmFicyhpKSwgaGFsZkJ1ZmZlckxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgeCA9IGNlbnRlclggKyBpICogc2xpY2VXaWR0aCAtIGNlbnRlck92ZXJsYXA7XG4gICAgICBjb25zdCB0YXBlciA9IGdldEVkZ2VUYXBlcihpICsgb3ZlcmxhcCwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgKiAyKTtcbiAgICAgIGNvbnN0IHkgPVxuICAgICAgICBjZW50ZXJZICsgdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiBjZW50ZXJZICogYW1wbGl0dWRlU2NhbGUgKiB0YXBlcjtcbiAgICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBsZWZ0IHNpZGUgKGJvdHRvbSBoYWxmKVxuICAgIGZvciAobGV0IGkgPSAtb3ZlcmxhcDsgaSA8IGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwOyBpKyspIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYIC0gaSAqIHNsaWNlV2lkdGggKyBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSArIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIC8vIERyYXcgbGVmdCBzaWRlICh0b3AgaGFsZilcbiAgICBmb3IgKGxldCBpID0gaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgLSAxOyBpID49IC1vdmVybGFwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYIC0gaSAqIHNsaWNlV2lkdGggKyBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSAtIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguZmlsbCgpO1xuXG4gICAgLy8gU2NoZWR1bGUgbmV4dCBmcmFtZSBvbmx5IGlmIHN0aWxsIHJlY29yZGluZ1xuICAgIGlmICh0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhdyk7XG4gICAgfVxuICB9O1xuXG4gIG9uVG9nZ2xlKGNhbGxiYWNrOiAoaXNSZWNvcmRpbmc6IGJvb2xlYW4pID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG9nZ2xlQ2FsbGJhY2tzLmFkZChjYWxsYmFjayk7XG4gIH1cblxuICBwcml2YXRlIG5vdGlmeUxpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG9nZ2xlQ2FsbGJhY2tzLmZvckVhY2goKGNiKSA9PiBjYih0aGlzLmlzUmVjb3JkaW5nKSk7XG4gIH1cblxuICB1bmxvYWQoKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wUmVjb3JkaW5nKCk7XG4gICAgdGhpcy5vblRvZ2dsZUNhbGxiYWNrcy5jbGVhcigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvUG9zdFByb2Nlc3NpbmdTZXJ2aWNlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXVkaW9UcmFuc2NyaXB0aW9uUHJvZ3Jlc3Mge1xuICBwcm9ncmVzczogbnVtYmVyO1xuICBzdGF0dXM6IHN0cmluZztcbiAgaWNvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnMge1xuICBmaWxlOiBURmlsZTtcbiAgdGltZXN0YW1wZWQ/OiBib29sZWFuO1xuICBpc0NoYXQ/OiBib29sZWFuO1xuICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZT86ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xufVxuXG5jbGFzcyBQZXJzaXN0ZW50VHJhbnNjcmlwdGlvbk5vdGljZSBleHRlbmRzIE5vdGljZSB7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHN0YXR1c1RleHQ6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHN0YXR1c0ljb246IEhUTUxEaXZFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFwiXCIsIDApOyAvLyBOZXZlciBhdXRvLWhpZGVcbiAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlXCIpO1xuXG4gICAgLy8gQ3JlYXRlIHByb2dyZXNzIGNvbnRhaW5lclxuICAgIGNvbnN0IHByb2dyZXNzQ29udGFpbmVyID0gdGhpcy5ub3RpY2VFbC5jcmVhdGVEaXYoXCJ0cmFuc2NyaXB0aW9uLXByb2dyZXNzXCIpO1xuXG4gICAgLy8gQWRkIHN0YXR1cyBjb250YWluZXIgd2l0aCBpY29uIGFuZCB0ZXh0XG4gICAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gcHJvZ3Jlc3NDb250YWluZXIuY3JlYXRlRGl2KFwidHJhbnNjcmlwdGlvbi1zdGF0dXNcIik7XG4gICAgdGhpcy5zdGF0dXNJY29uID0gc3RhdHVzQ29udGFpbmVyLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tc3RhdHVzLWljb25cIik7XG4gICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzQ29udGFpbmVyLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tc3RhdHVzLXRleHRcIik7XG5cbiAgICAvLyBBZGQgcHJvZ3Jlc3MgYmFyXG4gICAgY29uc3QgcHJvZ3Jlc3NCYXJDb250YWluZXIgPSBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzQmFyID0gcHJvZ3Jlc3NCYXJDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJ0cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhclwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlLXN0eWxlc1wiKSkge1xuICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICBzdHlsZS5pZCA9IFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlLXN0eWxlc1wiO1xuICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgICAgIC5zeXN0ZW1zY3VscHQtdHJhbnNjcmlwdGlvbi1ub3RpY2Uge1xuICAgICAgICAgIHBhZGRpbmc6IDhweCAxMnB4ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgbWluLXdpZHRoOiAyNjBweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzIHtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgICAgICAgZ2FwOiA4cHg7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1zdGF0dXMge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBnYXA6IDhweDtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tc3RhdHVzLWljb24ge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tc3RhdHVzLXRleHQge1xuICAgICAgICAgIGZsZXg6IDE7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lciB7XG4gICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgaGVpZ2h0OiA0cHg7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyIHtcbiAgICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgICAgICAgICB0cmFuc2l0aW9uOiB3aWR0aCAwLjNzIGVhc2U7XG4gICAgICAgICAgd2lkdGg6IDAlO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5vdGljZS1zdWNjZXNzIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1zdWNjZXNzKSAhaW1wb3J0YW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLm5vdGljZS1lcnJvciAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtZXJyb3IpICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cbiAgICAgIGA7XG4gICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVQcm9ncmVzcyh7IHByb2dyZXNzLCBzdGF0dXMsIGljb24gfTogQXVkaW9UcmFuc2NyaXB0aW9uUHJvZ3Jlc3MpIHtcbiAgICB0aGlzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7cHJvZ3Jlc3N9JWA7XG4gICAgdGhpcy5zdGF0dXNUZXh0LnNldFRleHQoc3RhdHVzKTtcbiAgICB0aGlzLnN0YXR1c0ljb24uZW1wdHkoKTtcbiAgICBzZXRJY29uKHRoaXMuc3RhdHVzSWNvbiwgaWNvbik7XG5cbiAgICAvLyBVcGRhdGUgbm90aWNlIGNsYXNzIGJhc2VkIG9uIHN0YXR1c1xuICAgIHRoaXMubm90aWNlRWwucmVtb3ZlQ2xhc3MoXCJub3RpY2Utc3VjY2Vzc1wiLCBcIm5vdGljZS1lcnJvclwiKTtcbiAgICBpZiAocHJvZ3Jlc3MgPT09IDEwMCkge1xuICAgICAgdGhpcy5ub3RpY2VFbC5hZGRDbGFzcyhcIm5vdGljZS1zdWNjZXNzXCIpO1xuICAgIH0gZWxzZSBpZiAocHJvZ3Jlc3MgPT09IDAgJiYgaWNvbiA9PT0gXCJ4LWNpcmNsZVwiKSB7XG4gICAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwibm90aWNlLWVycm9yXCIpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwge1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBwb3N0UHJvY2Vzc2luZ1NlcnZpY2U6IFBvc3RQcm9jZXNzaW5nU2VydmljZTtcbiAgcHJpdmF0ZSBvcHRpb25zOiBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zO1xuICBwcml2YXRlIG5vdGljZTogUGVyc2lzdGVudFRyYW5zY3JpcHRpb25Ob3RpY2U7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG9wdGlvbnM6IEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnMpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2UgPSBUcmFuc2NyaXB0aW9uU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIG9wdGlvbnMucGx1Z2luXG4gICAgKTtcbiAgICB0aGlzLnBvc3RQcm9jZXNzaW5nU2VydmljZSA9IFBvc3RQcm9jZXNzaW5nU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIG9wdGlvbnMucGx1Z2luXG4gICAgKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5ub3RpY2UgPSBuZXcgUGVyc2lzdGVudFRyYW5zY3JpcHRpb25Ob3RpY2UoKTtcbiAgICB0aGlzLnN0YXJ0VHJhbnNjcmlwdGlvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdGFydFRyYW5zY3JpcHRpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNob3cgaW5pdGlhbCBzdGF0dXNcbiAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgIHN0YXR1czogXCJTdGFydGluZyB0cmFuc2NyaXB0aW9uLi4uXCIsXG4gICAgICAgIGljb246IFwibWljXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2UudHJhbnNjcmliZUZpbGUoXG4gICAgICAgIHRoaXMub3B0aW9ucy5maWxlLFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogdGhpcy5vcHRpb25zLmlzQ2hhdCA/IFwiY2hhdFwiIDogXCJub3RlXCIsXG4gICAgICAgICAgdGltZXN0YW1wZWQ6IHRoaXMub3B0aW9ucy50aW1lc3RhbXBlZCxcbiAgICAgICAgICBvblByb2dyZXNzOiAocHJvZ3Jlc3MsIHN0YXR1cykgPT4ge1xuICAgICAgICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICAgICAgICBwcm9ncmVzcyxcbiAgICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgICBpY29uOiBcImF1ZGlvLWxpbmVzXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCB0cmFuc2NyaXB0aW9uIHRleHRcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIHBvc3QtcHJvY2Vzc2luZyBpcyBlbmFibGVkLCBwcm9jZXNzIHRoZSB0ZXh0XG4gICAgICBsZXQgZmluYWxUZXh0ID0gdGV4dDtcbiAgICAgIGxldCBwcm9jZXNzZWRUZXh0ID0gXCJcIjtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCkge1xuICAgICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgICAgcHJvZ3Jlc3M6IDgwLFxuICAgICAgICAgIHN0YXR1czogXCJQb3N0LXByb2Nlc3NpbmcgdHJhbnNjcmlwdGlvbi4uLlwiLFxuICAgICAgICAgIGljb246IFwid2FuZFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcHJvY2Vzc2VkVGV4dCA9IGF3YWl0IHRoaXMucG9zdFByb2Nlc3NpbmdTZXJ2aWNlLnByb2Nlc3NUcmFuc2NyaXB0aW9uKFxuICAgICAgICAgIHRleHRcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBGb3JtYXQgdGhlIGZpbmFsIHRleHQgd2l0aCBib3RoIHZlcnNpb25zXG4gICAgICAgIGZpbmFsVGV4dCA9IGAjIEF1ZGlvIFRyYW5zY3JpcHRpb25cblNvdXJjZTogJHt0aGlzLm9wdGlvbnMuZmlsZS5iYXNlbmFtZX1cblRyYW5zY3JpYmVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cblxuIyMgUmF3IFRyYW5zY3JpcHRpb25cbiR7dGV4dH1cblxuIyMgUHJvY2Vzc2VkIFRyYW5zY3JpcHRpb25cbiR7cHJvY2Vzc2VkVGV4dH1gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgcG9zdC1wcm9jZXNzaW5nIGlzIGRpc2FibGVkLCBqdXN0IHNob3cgdGhlIHJhdyB0cmFuc2NyaXB0aW9uXG4gICAgICAgIGZpbmFsVGV4dCA9IGAjIEF1ZGlvIFRyYW5zY3JpcHRpb25cblNvdXJjZTogJHt0aGlzLm9wdGlvbnMuZmlsZS5iYXNlbmFtZX1cblRyYW5zY3JpYmVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cblxuIyMgUmF3IFRyYW5zY3JpcHRpb25cbiR7dGV4dH1gO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxsIHRoZSBjb21wbGV0aW9uIGNhbGxiYWNrIGlmIHByb3ZpZGVkXG4gICAgICBpZiAodGhpcy5vcHRpb25zLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5vblRyYW5zY3JpcHRpb25Db21wbGV0ZShmaW5hbFRleHQpO1xuICAgICAgfVxuXG4gICAgICAvLyBDb3B5IHRleHQgdG8gY2xpcGJvYXJkXG4gICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChmaW5hbFRleHQpO1xuXG4gICAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZVxuICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICBwcm9ncmVzczogMTAwLFxuICAgICAgICBzdGF0dXM6IFwiVHJhbnNjcmlwdGlvbiBjb21wbGV0ZSFcIixcbiAgICAgICAgaWNvbjogXCJjaGVjay1jaXJjbGVcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBIaWRlIG5vdGljZSBhZnRlciBzdWNjZXNzXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5ub3RpY2UuaGlkZSgpO1xuICAgICAgfSwgMjAwMCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUcmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgICBzdGF0dXM6IGBFcnJvcjogJHtcbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcbiAgICAgICAgfWAsXG4gICAgICAgIGljb246IFwieC1jaXJjbGVcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBIaWRlIG5vdGljZSBhZnRlciBlcnJvclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMubm90aWNlLmhpZGUoKTtcbiAgICAgIH0sIDQwMDApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsKFxuICBhcHA6IEFwcCxcbiAgb3B0aW9uczogQXVkaW9UcmFuc2NyaXB0aW9uT3B0aW9uc1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IG1vZGFsID0gbmV3IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsKGFwcCwgb3B0aW9ucyk7XG4gIG1vZGFsLm9wZW4oKTtcbn1cbiIsICJpbXBvcnQgeyBQbHVnaW4sIE5vdGljZSwgTWVudSwgVEZpbGUsIE1hcmtkb3duVmlldyB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyB9IGZyb20gXCIuLi9jb25zdGFudHMvYXBpXCI7XG5cbi8vIE1hdGNoIHNlcnZlci1zaWRlIGNvbmZpZ3VyYXRpb25cbmNvbnN0IFNVUFBPUlRFRF9BVURJT19FWFRFTlNJT05TID0gW1wid2F2XCIsIFwibTRhXCIsIFwid2VibVwiLCBcIm9nZ1wiLCBcIm1wM1wiXTtcbmNvbnN0IE1JTUVfVFlQRV9NQVAgPSB7XG4gIHdhdjogXCJhdWRpby93YXZcIixcbiAgbTRhOiBcImF1ZGlvL21wNFwiLFxuICB3ZWJtOiBcImF1ZGlvL3dlYm1cIixcbiAgb2dnOiBcImF1ZGlvL29nZztjb2RlY3M9b3B1c1wiLFxuICBtcDM6IFwiYXVkaW8vbXBlZ1wiLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0aW9uQ29udGV4dCB7XG4gIHR5cGU6IFwibm90ZVwiIHwgXCJjaGF0XCI7XG4gIHRpbWVzdGFtcGVkPzogYm9vbGVhbjtcbiAgb25Qcm9ncmVzcz86IChwcm9ncmVzczogbnVtYmVyLCBzdGF0dXM6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFRyYW5zY3JpcHRpb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFBsdWdpbiAmIHsgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzIH07XG4gIHByaXZhdGUgaXNUcmFuc2NyaWJpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFRyYW5zY3JpcHRpb25TZXJ2aWNlO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihwbHVnaW46IFBsdWdpbiAmIHsgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzIH0pIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgcGx1Z2luLnNldHRpbmdzLFxuICAgICAgcGx1Z2luLmFwcFxuICAgICk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgcGx1Z2luOiBQbHVnaW4gJiB7IHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9XG4gICk6IFRyYW5zY3JpcHRpb25TZXJ2aWNlIHtcbiAgICBpZiAoIVRyYW5zY3JpcHRpb25TZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBUcmFuc2NyaXB0aW9uU2VydmljZS5pbnN0YW5jZSA9IG5ldyBUcmFuc2NyaXB0aW9uU2VydmljZShwbHVnaW4pO1xuICAgIH1cbiAgICByZXR1cm4gVHJhbnNjcmlwdGlvblNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBhcnNlRXJyb3JSZXNwb25zZShcbiAgICByZXNwb25zZTogUmVzcG9uc2VcbiAgKTogUHJvbWlzZTx7IG1lc3NhZ2U6IHN0cmluZzsgZGF0YT86IGFueSB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBpZiAoZGF0YS5lcnJvcikge1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEuZXJyb3IgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICByZXR1cm4geyBtZXNzYWdlOiBkYXRhLmVycm9yLCBkYXRhIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuZXJyb3IubWVzc2FnZSkge1xuICAgICAgICAgIHJldHVybiB7IG1lc3NhZ2U6IGRhdGEuZXJyb3IubWVzc2FnZSwgZGF0YSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IG1lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KGRhdGEuZXJyb3IpLCBkYXRhIH07XG4gICAgICB9XG4gICAgICByZXR1cm4geyBtZXNzYWdlOiByZXNwb25zZS5zdGF0dXNUZXh0LCBkYXRhIH07XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogcmVzcG9uc2Uuc3RhdHVzVGV4dCB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHRyYW5zY3JpYmVGaWxlKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIGNvbnRleHQ/OiBUcmFuc2NyaXB0aW9uQ29udGV4dFxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnNvbGUubG9nKFwiVHJhbnNjcmlwdGlvblNlcnZpY2UudHJhbnNjcmliZUZpbGUgY2FsbGVkIHdpdGg6XCIsIHtcbiAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUsXG4gICAgICBjb250ZXh0LFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuaXNUcmFuc2NyaWJpbmcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgdHJhbnNjcmliaW5nIGEgZmlsZVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgIGlmICghU1VQUE9SVEVEX0FVRElPX0VYVEVOU0lPTlMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBmaWxlIHR5cGU6ICR7ZXh0ZW5zaW9ufWApO1xuICAgIH1cblxuICAgIHRoaXMuaXNUcmFuc2NyaWJpbmcgPSB0cnVlO1xuXG4gICAgLy8gUmVwb3J0IGluaXRpYWwgcHJvZ3Jlc3NcbiAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMCwgXCJSZWFkaW5nIGF1ZGlvIGZpbGUuLi5cIik7XG5cbiAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdLCB7XG4gICAgICB0eXBlOiBNSU1FX1RZUEVfTUFQW2V4dGVuc2lvbiBhcyBrZXlvZiB0eXBlb2YgTUlNRV9UWVBFX01BUF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgYmxvYiwgZmlsZS5uYW1lKTtcbiAgICBpZiAoY29udGV4dD8udGltZXN0YW1wZWQpIHtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcInRpbWVzdGFtcGVkXCIsIFwidHJ1ZVwiKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gUmVwb3J0IHVwbG9hZCBwcm9ncmVzc1xuICAgICAgY29udGV4dD8ub25Qcm9ncmVzcz8uKDIwLCBcIlVwbG9hZGluZyBhdWRpby4uLlwiKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9hdWRpby90cmFuc2NyaXB0aW9uc2AsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwieC1saWNlbnNlLWtleVwiOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiUmF3IHNlcnZlciByZXNwb25zZTpcIiwge1xuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgb2s6IHJlc3BvbnNlLm9rLFxuICAgICAgICBjb250ZW50VHlwZTogcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJjb250ZW50LXR5cGVcIiksXG4gICAgICB9KTtcblxuICAgICAgbGV0IGRhdGE6IGFueTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsIGRhdGE6IHBhcnNlZERhdGEgfSA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXJzZUVycm9yUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHJlc3BvbnNlIHBhcnNlZDpcIiwgeyBlcnJvck1lc3NhZ2UsIHBhcnNlZERhdGEgfSk7XG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZTogQ1JFRElUX1VQREFURSBpcyBhY3R1YWxseSBhIHN1Y2Nlc3NcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwICYmXG4gICAgICAgICAgZXJyb3JNZXNzYWdlID09PSBcIkNyZWRpdHMgY2hhcmdlZCBzdWNjZXNzZnVsbHlcIlxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBDb250aW51ZSBwcm9jZXNzaW5nIC0gdGhpcyBpcyBub3QgYWN0dWFsbHkgYW4gZXJyb3JcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIFwiQ3JlZGl0cyBjaGFyZ2VkIHN1Y2Nlc3NmdWxseSwgY29udGludWluZyB3aXRoIHRyYW5zY3JpcHRpb24uLi5cIlxuICAgICAgICAgICk7XG4gICAgICAgICAgZGF0YSA9IHBhcnNlZERhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhaWxlZCB0byB0cmFuc2NyaWJlIGZpbGU6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7ZXJyb3JNZXNzYWdlfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUmF3IHJlc3BvbnNlIHRleHQ6XCIsIHJlc3BvbnNlVGV4dCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlBhcnNlZCByZXNwb25zZSBkYXRhOlwiLCBkYXRhKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgcmVzcG9uc2UgSlNPTjpcIiwgZSk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBKU09OIHJlc3BvbnNlIGZyb20gc2VydmVyXCIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcG9ydCBwcm9jZXNzaW5nIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oNjAsIFwiUHJvY2Vzc2luZyBhdWRpby4uLlwiKTtcblxuICAgICAgY29uc29sZS5sb2coXCJGaW5hbCBkYXRhIG9iamVjdDpcIiwge1xuICAgICAgICBoYXNEYXRhOiAhIWRhdGEsXG4gICAgICAgIGRhdGFUeXBlOiB0eXBlb2YgZGF0YSxcbiAgICAgICAga2V5czogZGF0YSA/IE9iamVjdC5rZXlzKGRhdGEpIDogbnVsbCxcbiAgICAgICAgdGV4dFR5cGU6IGRhdGE/LnRleHQgPyB0eXBlb2YgZGF0YS50ZXh0IDogbnVsbCxcbiAgICAgICAgdGV4dExlbmd0aDogZGF0YT8udGV4dCA/IGRhdGEudGV4dC5sZW5ndGggOiBudWxsLFxuICAgICAgICB0ZXh0UHJldmlldzogZGF0YT8udGV4dCA/IGRhdGEudGV4dC5zdWJzdHJpbmcoMCwgMTAwKSArIFwiLi4uXCIgOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIHZhbGlkIHRyYW5zY3JpcHRpb24gdGV4dFxuICAgICAgaWYgKCFkYXRhIHx8IHR5cGVvZiBkYXRhLnRleHQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgcmVzcG9uc2UgZGF0YTpcIiwgZGF0YSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHRyYW5zY3JpcHRpb24gdGV4dCByZWNlaXZlZCBmcm9tIHNlcnZlclwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGV4dCBpcyBub3QgZW1wdHkgYWZ0ZXIgdHJpbW1pbmdcbiAgICAgIGNvbnN0IHRyaW1tZWRUZXh0ID0gZGF0YS50ZXh0LnRyaW0oKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiVHJpbW1lZCB0ZXh0OlwiLCB7XG4gICAgICAgIGxlbmd0aDogdHJpbW1lZFRleHQubGVuZ3RoLFxuICAgICAgICBwcmV2aWV3OiB0cmltbWVkVGV4dC5zdWJzdHJpbmcoMCwgMTAwKSArIFwiLi4uXCIsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF0cmltbWVkVGV4dCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRW1wdHkgdHJhbnNjcmlwdGlvbiB0ZXh0IGFmdGVyIHRyaW1taW5nOlwiLCBkYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW1wdHkgdHJhbnNjcmlwdGlvbiB0ZXh0IHJlY2VpdmVkIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBMb2cgY29zdCBpbmZvcm1hdGlvbiBpZiBhdmFpbGFibGVcbiAgICAgIGlmIChkYXRhLmNvc3RfaW5mbykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlRyYW5zY3JpcHRpb24gY29zdCBkZXRhaWxzOlwiLCB7XG4gICAgICAgICAgZHVyYXRpb246IGAke2RhdGEuY29zdF9pbmZvLmF1ZGlvX2R1cmF0aW9uX3NlY29uZHN9cyAoJHtkYXRhLmNvc3RfaW5mby5hdWRpb19kdXJhdGlvbl9ob3Vyc31oKWAsXG4gICAgICAgICAgcmF3X2Nvc3Q6IGAkJHtkYXRhLmNvc3RfaW5mby5yYXdfY29zdF91c2QudG9GaXhlZCg0KX1gLFxuICAgICAgICAgIG1hcmt1cF9yYXRlOiBgJHsoZGF0YS5jb3N0X2luZm8ubWFya3VwX3JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWAsXG4gICAgICAgICAgZmluYWxfY29zdDogYCR7ZGF0YS5jb3N0X2luZm8uZmluYWxfY29zdF9jcmVkaXRzfSBjcmVkaXRzYCxcbiAgICAgICAgICBmaWxlX3NpemU6IGAkeyhkYXRhLmNvc3RfaW5mby5maWxlX3NpemVfYnl0ZXMgLyAxMDI0IC8gMTAyNCkudG9GaXhlZChcbiAgICAgICAgICAgIDJcbiAgICAgICAgICApfU1CYCxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcG9ydCBjb21wbGV0aW9uIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMTAwLCBcIlRyYW5zY3JpcHRpb24gY29tcGxldGUhXCIpO1xuXG4gICAgICByZXR1cm4gdHJpbW1lZFRleHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUcmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc1RyYW5zY3JpYmluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHVubG9hZCgpIHtcbiAgICAvLyBOb3RoaW5nIHRvIHVubG9hZCBjdXJyZW50bHlcbiAgfVxufVxuIiwgImltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUG9zdFByb2Nlc3NpbmdTZXJ2aWNlO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZGVmYXVsdE1vZGVsSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBwbHVnaW4uc2V0dGluZ3MsXG4gICAgICBwbHVnaW4uYXBwXG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbik6IFBvc3RQcm9jZXNzaW5nU2VydmljZSB7XG4gICAgaWYgKCFQb3N0UHJvY2Vzc2luZ1NlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFBvc3RQcm9jZXNzaW5nU2VydmljZS5pbnN0YW5jZSA9IG5ldyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UocGx1Z2luKTtcbiAgICB9XG4gICAgcmV0dXJuIFBvc3RQcm9jZXNzaW5nU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZmluZERlZmF1bHRNb2RlbCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICh0aGlzLmRlZmF1bHRNb2RlbElkKSByZXR1cm4gdGhpcy5kZWZhdWx0TW9kZWxJZDtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICBjb25zdCBkZWZhdWx0TW9kZWwgPSBtb2RlbHMuZmluZCgobW9kZWwpID0+XG4gICAgICAgIG1vZGVsLm5hbWU/Lm1hdGNoKC9cXChEZWZhdWx0XFwpL2kpXG4gICAgICApO1xuICAgICAgaWYgKCFkZWZhdWx0TW9kZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGVmYXVsdCBtb2RlbCBub3QgZm91bmRcIik7XG4gICAgICB9XG4gICAgICB0aGlzLmRlZmF1bHRNb2RlbElkID0gZGVmYXVsdE1vZGVsLmlkO1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbC5pZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZpbmRpbmcgZGVmYXVsdCBtb2RlbDpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcHJvY2Vzc1RyYW5zY3JpcHRpb24odGV4dDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vZGVsSWQgPSBhd2FpdCB0aGlzLmZpbmREZWZhdWx0TW9kZWwoKTtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ1Byb21wdCxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogdGV4dCxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbGV0IHByb2Nlc3NlZFRleHQgPSBcIlwiO1xuICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiB0aGlzLnNjdWxwdFNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuMywgLy8gTG93ZXIgdGVtcGVyYXR1cmUgZm9yIG1vcmUgY29uc2lzdGVudCBvdXRwdXRcbiAgICAgIH0pKSB7XG4gICAgICAgIGlmIChjaHVuay5jb250ZW50KSB7XG4gICAgICAgICAgcHJvY2Vzc2VkVGV4dCArPSBjaHVuay5jb250ZW50O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwcm9jZXNzZWRUZXh0LnRyaW0oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHBvc3QtcHJvY2Vzc2luZyB0cmFuc2NyaXB0aW9uOlwiLCBlcnJvcik7XG4gICAgICAvLyBPbiBlcnJvciwgcmV0dXJuIG9yaWdpbmFsIHRleHRcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEl0ZW1WaWV3LCBXb3Jrc3BhY2VMZWFmLCBURmlsZSwgVEZvbGRlciwgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBDaGF0Um9sZSwgTXVsdGlQYXJ0Q29udGVudCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgQ2hhdFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL0NoYXRTdG9yYWdlU2VydmljZVwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuLi9tb2RhbHMvTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlLCBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBEcmF3ZXJDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnRzL0RyYXdlckNvbXBvbmVudFwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9NZXNzYWdlUmVuZGVyZXJcIjtcbmltcG9ydCB7IElucHV0SGFuZGxlciB9IGZyb20gXCIuL2NvbXBvbmVudHMvSW5wdXRIYW5kbGVyXCI7XG5pbXBvcnQgeyBGaWxlQ29udGV4dE1hbmFnZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL0ZpbGVDb250ZXh0TWFuYWdlclwiO1xuaW1wb3J0IHsgc2hvd1N5c3RlbVByb21wdE1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9TeXN0ZW1Qcm9tcHRNb2RhbFwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBMb2FkQ2hhdE1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9Mb2FkQ2hhdE1vZGFsXCI7XG5cbmV4cG9ydCBjb25zdCBDSEFUX1ZJRVdfVFlQRSA9IFwic3lzdGVtc2N1bHB0LWNoYXQtdmlld1wiO1xuXG5leHBvcnQgY2xhc3MgQ2hhdFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gIHByaXZhdGUgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXTtcbiAgcHJpdmF0ZSBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgY2hhdFN0b3JhZ2U6IENoYXRTdG9yYWdlU2VydmljZTtcbiAgcHJpdmF0ZSBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBpbnB1dEhhbmRsZXI6IElucHV0SGFuZGxlcjtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBjaGF0SWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBtb2RlbEluZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VycmVudE1vZGVsTmFtZTogc3RyaW5nID0gXCJcIjtcbiAgcHJpdmF0ZSBpc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBjb250ZXh0TWFuYWdlcjogRmlsZUNvbnRleHRNYW5hZ2VyO1xuICBwcml2YXRlIHJlZnJlc2hJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBsYXN0UmVmcmVzaFRpbWUgPSAwO1xuICBwcml2YXRlIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBwcml2YXRlIGxheW91dENoYW5nZUhhbmRsZXI6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgYXdhaXRpbmdTdGF0ZVJlc3RvcmUgPSBmYWxzZTtcbiAgcHJpdmF0ZSBhY3Rpb25zRHJhd2VyOiBEcmF3ZXJDb21wb25lbnQ7XG4gIHByaXZhdGUgbWVzc2FnZVJlbmRlcmVyOiBNZXNzYWdlUmVuZGVyZXI7XG4gIC8qKlxuICAgKiBzeXN0ZW1Qcm9tcHRUeXBlIGFuZCBzeXN0ZW1Qcm9tcHRQYXRoIGFyZSB0aGUgZGVmYXVsdCBzeXN0ZW0gcHJvbXB0IGZvciB0aGlzIGNoYXRcbiAgICogaWYgdGhlIHVzZXIgaGFzIG5vdCBvdmVycmlkZGVuIHRoZW0geWV0LlxuICAgKi9cbiAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICBwcml2YXRlIGNoYXRUaXRsZTogc3RyaW5nID0gXCJVbnRpdGxlZCBDaGF0XCI7XG4gIHByaXZhdGUgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IobGVhZjogV29ya3NwYWNlTGVhZiwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICBzdXBlcihsZWFmKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luLnNldHRpbmdzLCB0aGlzLmFwcCk7XG4gICAgdGhpcy5jaGF0U3RvcmFnZSA9IG5ldyBDaGF0U3RvcmFnZVNlcnZpY2UoXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBwbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkO1xuICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICB0aGlzLmxhc3RSZWZyZXNoVGltZSA9IDA7XG4gICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmF3YWl0aW5nU3RhdGVSZXN0b3JlID0gdHJ1ZTtcbiAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlciA9IG5ldyBNZXNzYWdlUmVuZGVyZXIodGhpcy5hcHApO1xuXG4gICAgLy8gSW5zdGVhZCBvZiBtYXRjaGluZyBwcmVzZXRzLCByZWFkIGZyb20gcGx1Z2luIHNldHRpbmdzOlxuICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlIHx8IFwiZ2VuZXJhbC11c2VcIjtcbiAgICBpZiAoXG4gICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGhcbiAgICApIHtcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB0aGlzLmxheW91dENoYW5nZUhhbmRsZXIgPSB0aGlzLm9uTGF5b3V0Q2hhbmdlLmJpbmQodGhpcyk7XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBDSEFUX1ZJRVdfVFlQRTtcbiAgfVxuXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XG4gICAgY29uc3QgYWxsQ2hhdHMgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKENIQVRfVklFV19UWVBFKTtcblxuICAgIC8vIElmIHRoZXJlJ3Mgb25seSBvbmUgY2hhdCwganVzdCBzaG93IHRoZSB0aXRsZVxuICAgIGlmIChhbGxDaGF0cy5sZW5ndGggPD0gMSkge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhdFRpdGxlO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlIGFyZSBtdWx0aXBsZSBjaGF0cywgYXBwZW5kIGEgbnVtYmVyXG4gICAgY29uc3QgY2hhdE51bWJlciA9IGFsbENoYXRzLmluZGV4T2YodGhpcy5sZWFmKSArIDE7XG4gICAgcmV0dXJuIGAke3RoaXMuY2hhdFRpdGxlfSAke2NoYXROdW1iZXJ9YDtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jaGF0LWNvbnRhaW5lclwiKTtcblxuICAgIC8vIEFkZCBkcmFnIGFuZCBkcm9wIGV2ZW50IGhhbmRsZXJzXG4gICAgdGhpcy5zZXR1cERyYWdBbmREcm9wKGNvbnRhaW5lcik7XG5cbiAgICBjb25zdCBoZWFkZXJDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdG9wUm93ID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1oZWFkZXItdG9wXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLm1vZGVsSW5kaWNhdG9yID0gdG9wUm93LmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5kaWNhdG9yXCIsXG4gICAgICB0ZXh0OiBgQ3VycmVudCBNb2RlbDogJHt0aGlzLnNlbGVjdGVkTW9kZWxJZH1gLFxuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuXG4gICAgdGhpcy5hY3Rpb25zRHJhd2VyID0gbmV3IERyYXdlckNvbXBvbmVudCh7XG4gICAgICBjb250YWluZXI6IHRvcFJvdyxcbiAgICAgIHRpdGxlOiBcIkFjdGlvbnNcIixcbiAgICB9KTtcbiAgICBjb25zdCBhY3Rpb25zQ29udGVudCA9IHRoaXMuYWN0aW9uc0RyYXdlci5nZXRDb250ZW50KCk7XG5cbiAgICBjb25zdCBvcGVuSGlzdG9yeUFjdGlvbiA9IGFjdGlvbnNDb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW1cIixcbiAgICAgIHRleHQ6IFwiT3BlbiBDaGF0IEhpc3RvcnkgRmlsZVwiLFxuICAgIH0pO1xuICAgIG9wZW5IaXN0b3J5QWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5fS8ke3RoaXMuY2hhdElkfS5tZGA7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShmaWxlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGxvYWREaWZmZXJlbnRDaGF0QWN0aW9uID0gYWN0aW9uc0NvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgdGV4dDogXCJMb2FkIEEgRGlmZmVyZW50IENoYXRcIixcbiAgICB9KTtcbiAgICBsb2FkRGlmZmVyZW50Q2hhdEFjdGlvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIG5ldyBsZWFmL3RhYlxuICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKHRydWUpO1xuICAgICAgLy8gT3BlbiBMb2FkQ2hhdE1vZGFsIHdpdGggY2FsbGJhY2sgdG8gbG9hZCBzZWxlY3RlZCBjaGF0IGluIG5ldyBsZWFmXG4gICAgICBuZXcgTG9hZENoYXRNb2RhbChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIGFzeW5jIChjaGF0SWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IHZpZXcgPSBhd2FpdCBsZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICAgICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgICAgICAgIHN0YXRlOiB7IGNoYXRJZCB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIEFjdGl2YXRlIHRoZSBuZXcgbGVhZlxuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYpO1xuICAgICAgICB9LFxuICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgKS5vcGVuKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb3B5Q2hhdEFjdGlvbiA9IGFjdGlvbnNDb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW1cIixcbiAgICAgIHRleHQ6IFwiQ29weSBDaGF0IHRvIENsaXBib2FyZFwiLFxuICAgIH0pO1xuICAgIGNvcHlDaGF0QWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCB0aGlzLmNvcHlFbnRpcmVDaGF0VG9DbGlwYm9hcmQoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlbGV0ZUNoYXRBY3Rpb24gPSBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtIHN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbS1kYW5nZXJcIixcbiAgICAgIHRleHQ6IFwiRGVsZXRlIFRoaXMgQ2hhdFwiLFxuICAgIH0pO1xuICAgIGRlbGV0ZUNoYXRBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbGV0ZUNvbmZpcm1lZCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGNoYXQ/XCIsXG4gICAgICAgIHtcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkRlbGV0ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKGRlbGV0ZUNvbmZpcm1lZD8uY29uZmlybWVkKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdHNEaXJlY3Rvcnl9LyR7dGhpcy5jaGF0SWR9Lm1kYDtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5kZWxldGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZWFmLmRldGFjaCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgYm90dG9tUm93ID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1oZWFkZXItYm90dG9tXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRleHRNYW5hZ2VyID0gbmV3IEZpbGVDb250ZXh0TWFuYWdlcih7XG4gICAgICBhcHA6IHRoaXMuYXBwLFxuICAgICAgY29udGFpbmVyOiBib3R0b21Sb3csXG4gICAgICBvbkNvbnRleHRDaGFuZ2U6IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmNoZWNrU3luY1N0YXR1cygpO1xuICAgICAgfSxcbiAgICAgIHNjdWxwdFNlcnZpY2U6IHRoaXMuYWlTZXJ2aWNlLFxuICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICB9KTtcblxuICAgIHRoaXMuY2hhdENvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2VzLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyID0gbmV3IFNjcm9sbE1hbmFnZXJTZXJ2aWNlKHtcbiAgICAgIGNvbnRhaW5lcjogdGhpcy5jaGF0Q29udGFpbmVyLFxuICAgIH0pO1xuXG4gICAgdGhpcy5pbnB1dEhhbmRsZXIgPSBuZXcgSW5wdXRIYW5kbGVyKHtcbiAgICAgIGFwcDogdGhpcy5hcHAsXG4gICAgICBjb250YWluZXIsXG4gICAgICBhaVNlcnZpY2U6IHRoaXMuYWlTZXJ2aWNlLFxuICAgICAgZ2V0TWVzc2FnZXM6ICgpID0+IFsuLi50aGlzLm1lc3NhZ2VzXSxcbiAgICAgIGdldFNlbGVjdGVkTW9kZWxJZDogKCkgPT4gdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICBnZXRDb250ZXh0RmlsZXM6ICgpID0+IHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCksXG4gICAgICBnZXRTeXN0ZW1Qcm9tcHQ6ICgpID0+ICh7XG4gICAgICAgIHR5cGU6IHRoaXMuc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgcGF0aDogdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgfSksXG4gICAgICBjaGF0Q29udGFpbmVyOiB0aGlzLmNoYXRDb250YWluZXIsXG4gICAgICBzY3JvbGxNYW5hZ2VyOiB0aGlzLnNjcm9sbE1hbmFnZXIsXG4gICAgICBtZXNzYWdlUmVuZGVyZXI6IHRoaXMubWVzc2FnZVJlbmRlcmVyLFxuICAgICAgb25NZXNzYWdlU3VibWl0OiBhc3luYyAobWVzc2FnZSkgPT4ge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGRNZXNzYWdlKFxuICAgICAgICAgIG1lc3NhZ2Uucm9sZSxcbiAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQsXG4gICAgICAgICAgbWVzc2FnZS5tZXNzYWdlX2lkXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgb25Bc3Npc3RhbnRSZXNwb25zZTogYXN5bmMgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICB9LFxuICAgICAgb25Db250ZXh0RmlsZUFkZDogYXN5bmMgKHdpa2lsaW5rKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKTtcbiAgICAgICAgZmlsZXMuYWRkKHdpa2lsaW5rKTtcbiAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5zZXRDb250ZXh0RmlsZXMoQXJyYXkuZnJvbShmaWxlcykpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICB9LFxuICAgICAgb25FcnJvcjogKGVycm9yKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycm9yKSxcbiAgICAgIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHtcbiAgICAgICAgY29uc3QgY29udGV4dEJ1dHRvbiA9IHRoaXMuY29udGV4dE1hbmFnZXJcbiAgICAgICAgICAuZ2V0Q29udGFpbmVyKClcbiAgICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtY29udGV4dC1hZGQtYnV0dG9uXCIpO1xuICAgICAgICBpZiAoY29udGV4dEJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgY29udGV4dEJ1dHRvbi5jbGljaygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25FZGl0U3lzdGVtUHJvbXB0OiAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlU3lzdGVtUHJvbXB0RWRpdCgpO1xuICAgICAgfSxcbiAgICAgIHBsdWdpbjogdGhpcy5wbHVnaW4sXG4gICAgICBjaGF0VmlldzogdGhpcyxcbiAgICB9KTtcblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLCAobGVhZikgPT4ge1xuICAgICAgaWYgKGxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgICB0aGlzLmNoZWNrRm9yVXBkYXRlcygpO1xuICAgICAgICAvLyBGb2N1cyBpbnB1dCB3aGVuIHRoaXMgdmlldyBiZWNvbWVzIGFjdGl2ZVxuICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgc2V0dXBcbiAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuXG4gICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcblxuICAgIGlmICghdGhpcy5hd2FpdGluZ1N0YXRlUmVzdG9yZSAmJiB0aGlzLm1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKCF0aGlzLmNoYXRJZCkge1xuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKG5vdy5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICBjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICBjb25zdCBob3VyID0gU3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IG1pbnV0ZSA9IFN0cmluZyhub3cuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IHNlY29uZCA9IFN0cmluZyhub3cuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIHRoaXMuY2hhdElkID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9ICR7aG91cn0tJHttaW51dGV9LSR7c2Vjb25kfWA7XG4gICAgICAgIHRoaXMuY2hhdFRpdGxlID0gYENoYXQgJHtub3cudG9Mb2NhbGVTdHJpbmcoKX1gO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2FkTWVzc2FnZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNoYXRDb250YWluZXIpIHJldHVybjtcblxuICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRoaXMuY2hhdENvbnRhaW5lci5zY3JvbGxUb3A7XG4gICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gdGhpcy5jaGF0Q29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICBjb25zdCBjbGllbnRIZWlnaHQgPSB0aGlzLmNoYXRDb250YWluZXIuY2xpZW50SGVpZ2h0O1xuICAgIGNvbnN0IHdhc0F0Qm90dG9tID0gTWF0aC5hYnMoc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wIC0gY2xpZW50SGVpZ2h0KSA8IDEwO1xuXG4gICAgdGhpcy5jaGF0Q29udGFpbmVyLmVtcHR5KCk7XG4gICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIHRoaXMubWVzc2FnZXMpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRkTWVzc2FnZShtZXNzYWdlLnJvbGUsIG1lc3NhZ2UuY29udGVudCwgbWVzc2FnZS5tZXNzYWdlX2lkKTtcbiAgICB9XG5cbiAgICBpZiAod2FzQXRCb3R0b20pIHtcbiAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoYXRDb250YWluZXIuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xuICAgIH1cblxuICAgIC8vIFRyaWdnZXIgdG9rZW4gY291bnQgdXBkYXRlIGFmdGVyIG1lc3NhZ2VzIGFyZSBsb2FkZWRcbiAgICBpZiAodGhpcy5pbnB1dEhhbmRsZXIpIHtcbiAgICAgIGF3YWl0IHRoaXMuaW5wdXRIYW5kbGVyLnVwZGF0ZVRva2VuQ291bnQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLm1vZGVsSW5kaWNhdG9yKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBBbHdheXMgZmV0Y2ggZnJlc2ggbW9kZWwgZGF0YSB0byBlbnN1cmUgd2UgaGF2ZSB0aGUgbGF0ZXN0IG5hbWVcbiAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICBjb25zdCBjdXJyZW50TW9kZWwgPSBtb2RlbHMuZmluZChcbiAgICAgICAgICAobW9kZWwpID0+IG1vZGVsLmlkID09PSB0aGlzLnNlbGVjdGVkTW9kZWxJZFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBtb2RlbCBuYW1lXG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IGN1cnJlbnRNb2RlbD8ubmFtZSB8fCB0aGlzLnNlbGVjdGVkTW9kZWxJZDtcblxuICAgICAgICAvLyBDcmVhdGUgdGhlIGluZGljYXRvciBlbGVtZW50c1xuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmVtcHR5KCk7XG4gICAgICAgIGNvbnN0IHByZWZpeCA9IHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7XG4gICAgICAgICAgdGV4dDogXCJDdXJyZW50IE1vZGVsOiBcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG1vZGVsTmFtZSA9IHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7XG4gICAgICAgICAgdGV4dDogdGhpcy5jdXJyZW50TW9kZWxOYW1lIHx8IFwiVW5rbm93biBNb2RlbFwiLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDbG9uZSBhbmQgcmVwbGFjZSB0byBlbnN1cmUgY2xlYW4gZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGNvbnN0IG5ld01vZGVsSW5kaWNhdG9yID0gdGhpcy5tb2RlbEluZGljYXRvci5jbG9uZU5vZGUoXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnBhcmVudE5vZGU/LnJlcGxhY2VDaGlsZChcbiAgICAgICAgICBuZXdNb2RlbEluZGljYXRvcixcbiAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IgPSBuZXdNb2RlbEluZGljYXRvcjtcblxuICAgICAgICAvLyBBZGQgY2xpY2sgaGFuZGxlclxuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICBhc3luYyAobW9kZWxJZCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG5cbiAgICAgICAgICAgICAgLy8gVXBkYXRlIG1vZGVsIG5hbWUgaW1tZWRpYXRlbHkgYWZ0ZXIgc2VsZWN0aW9uXG4gICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTW9kZWwgPSBtb2RlbHMuZmluZChcbiAgICAgICAgICAgICAgICAobW9kZWwpID0+IG1vZGVsLmlkID09PSBtb2RlbElkXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHNlbGVjdGVkTW9kZWw/Lm5hbWUgfHwgbW9kZWxJZDtcblxuICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIFVJXG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiTW9kZWwgY2hhbmdlZCBzdWNjZXNzZnVsbHlcIiwgXCJpbmZvXCIpO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAgICAgICAgICAgLy8gUmVjYWxjdWxhdGUgdG9rZW4gbGltaXQgaWYgbmVlZGVkXG4gICAgICAgICAgICAgIGlmICh0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlICYmIHNlbGVjdGVkTW9kZWw/LmNvbnRleHRfbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b2tlbkxpbWl0ID0gTWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgICAgICh0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlIC8gMTAwKSAqXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkTW9kZWwuY29udGV4dF9sZW5ndGhcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIG1vZGVsIHNlbGVjdGlvblxuICAgICAgICAgICAgICB0aGlzLmZvY3VzSW5wdXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG1vZGFsLnNldE1vZGVscyhtb2RlbHMpOyAvLyBVc2UgYWxyZWFkeSBmZXRjaGVkIG1vZGVsc1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzZXQgbW9kZWxzOlwiLCBlcnIpO1xuICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIG1vZGVsIGluZGljYXRvcjpcIiwgZXJyb3IpO1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtb2RlbCBJRCBpZiBuYW1lIGZldGNoIGZhaWxzXG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmVtcHR5KCk7XG4gICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IHRoaXMuY3VycmVudE1vZGVsTmFtZSB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNoZWNrRm9yVXBkYXRlcygpIHtcbiAgICBpZiAodGhpcy5pc0dlbmVyYXRpbmcpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzYXZlZENoYXRzID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5sb2FkQ2hhdHMoKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRDaGF0ID0gc2F2ZWRDaGF0cy5maW5kKChjKSA9PiBjLmlkID09PSB0aGlzLmNoYXRJZCk7XG5cbiAgICAgIGlmICghY3VycmVudENoYXQpIHJldHVybjtcblxuICAgICAgY29uc3QgaGFzQ2hhbmdlcyA9XG4gICAgICAgIGN1cnJlbnRDaGF0Lm1lc3NhZ2VzLmxlbmd0aCAhPT0gdGhpcy5tZXNzYWdlcy5sZW5ndGggfHxcbiAgICAgICAgY3VycmVudENoYXQuc2VsZWN0ZWRNb2RlbElkICE9PSB0aGlzLnNlbGVjdGVkTW9kZWxJZCB8fFxuICAgICAgICBKU09OLnN0cmluZ2lmeShBcnJheS5mcm9tKHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkpKSAhPT1cbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2hhdC5jb250ZXh0X2ZpbGVzKSB8fFxuICAgICAgICBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2hhdC5tZXNzYWdlcykgIT09IEpTT04uc3RyaW5naWZ5KHRoaXMubWVzc2FnZXMpO1xuXG4gICAgICBpZiAoaGFzQ2hhbmdlcykge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gY3VycmVudENoYXQubWVzc2FnZXM7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gY3VycmVudENoYXQuc2VsZWN0ZWRNb2RlbElkO1xuXG4gICAgICAgIGlmIChjdXJyZW50Q2hhdC5jb250ZXh0X2ZpbGVzKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5zZXRDb250ZXh0RmlsZXMoY3VycmVudENoYXQuY29udGV4dF9maWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRNZXNzYWdlcygpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFdmVuIGlmIHRoZXJlIGFyZSBubyBjaGFuZ2VzLCBjaGVjayBzeW5jIHN0YXR1cyBvZiBjb250ZXh0IGZpbGVzXG4gICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuY2hlY2tTeW5jU3RhdHVzKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZm9yIHVwZGF0ZXM6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVDaGF0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5jaGF0SWQpIHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG4gICAgICBjb25zdCBtb250aCA9IFN0cmluZyhub3cuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIGNvbnN0IGRheSA9IFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICBjb25zdCBob3VyID0gU3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICBjb25zdCBtaW51dGUgPSBTdHJpbmcobm93LmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3Qgc2Vjb25kID0gU3RyaW5nKG5vdy5nZXRTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIHRoaXMuY2hhdElkID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9ICR7aG91cn0tJHttaW51dGV9LSR7c2Vjb25kfWA7XG4gICAgICB0aGlzLmNoYXRUaXRsZSA9IHRoaXMuY2hhdFRpdGxlIHx8IHRoaXMuY2hhdElkO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNoYXRTdG9yYWdlLnNhdmVDaGF0KFxuICAgICAgICB0aGlzLmNoYXRJZCxcbiAgICAgICAgdGhpcy5tZXNzYWdlcyxcbiAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgIHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCksXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICB0aGlzLnN5c3RlbVByb21wdFBhdGgsXG4gICAgICAgIHRoaXMuY2hhdFRpdGxlLFxuICAgICAgICB0aGlzLnRva2VuTGltaXQsXG4gICAgICAgIHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2VcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBjaGF0XCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRXJyb3IoZXJyb3I6IHN0cmluZyB8IFN5c3RlbVNjdWxwdEVycm9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gTG9nIGVycm9yIGZpcnN0XG4gICAgY29uc29sZS5lcnJvcihcIkNoYXQgZXJyb3I6XCIsIHtcbiAgICAgIGVycm9yLFxuICAgICAgbWVzc2FnZTogdHlwZW9mIGVycm9yID09PSBcInN0cmluZ1wiID8gZXJyb3IgOiBlcnJvci5tZXNzYWdlLFxuICAgICAgY29kZTogZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvciA/IGVycm9yLmNvZGUgOiB1bmRlZmluZWQsXG4gICAgICBtZXRhZGF0YTogZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvciA/IGVycm9yLm1ldGFkYXRhIDogdW5kZWZpbmVkLFxuICAgIH0pO1xuXG4gICAgbGV0IGVycm9yTWVzc2FnZSA9IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3IubWVzc2FnZTtcblxuICAgIGlmIChcbiAgICAgIGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgJiZcbiAgICAgIChlcnJvci5jb2RlID09PSBcIk1PREVMX1VOQVZBSUxBQkxFXCIgfHxcbiAgICAgICAgZXJyb3IuY29kZSA9PT0gXCJNT0RFTF9SRVFVRVNUX0VSUk9SXCIgfHxcbiAgICAgICAgZXJyb3IuY29kZSA9PT0gXCJRVU9UQV9FWENFRURFRFwiKVxuICAgICkge1xuICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKGVycm9yTWVzc2FnZSwgXCJlcnJvclwiLCBlcnJvcik7XG5cbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG4gICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFxuICAgICAgICAgICAgXCJNb2RlbCBjaGFuZ2VkLiBZb3UgY2FuIG5vdyByZXRyeSB5b3VyIG1lc3NhZ2UuXCIsXG4gICAgICAgICAgICBcImluZm9cIlxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBtb2RlbCBzZWxlY3Rpb25cbiAgICAgICAgICB0aGlzLmZvY3VzSW5wdXQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICk7XG5cbiAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgbW9kYWwuc2V0TW9kZWxzKG1vZGVscyk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBtb2RlbHM6XCIsIGVycik7XG4gICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byBmZXRjaCBhdmFpbGFibGUgbW9kZWxzXCIsIFwiZXJyb3JcIiwgZXJyKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGFzdE1lc3NhZ2UgPSB0aGlzLmNoYXRDb250YWluZXIucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuc3lzdGVtc2N1bHB0LW1lc3NhZ2U6bGFzdC1jaGlsZFwiXG4gICAgICApO1xuICAgICAgaWYgKGxhc3RNZXNzYWdlKSB7XG4gICAgICAgIGxhc3RNZXNzYWdlLnJlbW92ZSgpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBbLi4udGhpcy5tZXNzYWdlc11cbiAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAuZmluZCgobXNnKSA9PiBtc2cucm9sZSA9PT0gXCJ1c2VyXCIpO1xuICAgICAgaWYgKGxhc3RVc2VyTWVzc2FnZSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMubWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgICAgIChtc2cpID0+IG1zZy5tZXNzYWdlX2lkID09PSBsYXN0VXNlck1lc3NhZ2UubWVzc2FnZV9pZFxuICAgICAgICApO1xuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaW5kZXgpO1xuXG4gICAgICAgICAgY29uc3QgYWxsTWVzc2FnZXMgPSB0aGlzLmNoYXRDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgIFwiLnN5c3RlbXNjdWxwdC1tZXNzYWdlXCJcbiAgICAgICAgICApO1xuICAgICAgICAgIGZvciAobGV0IGkgPSBpbmRleDsgaSA8IGFsbE1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhbGxNZXNzYWdlc1tpXS5yZW1vdmUoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5zZXRWYWx1ZShcbiAgICAgICAgICAgIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgICA/IGxhc3RVc2VyTWVzc2FnZS5jb250ZW50XG4gICAgICAgICAgICAgIDogSlNPTi5zdHJpbmdpZnkobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNob3dFbmhhbmNlZE5vdGljZShlcnJvck1lc3NhZ2UsIFwiZXJyb3JcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgb25MYXlvdXRDaGFuZ2UoKSB7XG4gICAgaWYgKHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKEl0ZW1WaWV3KT8ubGVhZiA9PT0gdGhpcy5sZWFmKSB7XG4gICAgICB0aGlzLmxhc3RSZWZyZXNoVGltZSA9IDA7XG4gICAgICBhd2FpdCB0aGlzLmNoZWNrRm9yVXBkYXRlcygpO1xuICAgICAgLy8gRm9jdXMgaW5wdXQgd2hlbiB0aGlzIHZpZXcgaXMgYWN0aXZlIGFmdGVyIGxheW91dCBjaGFuZ2VcbiAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lc3NhZ2VJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTeXN0ZW1Qcm9tcHRFZGl0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFJldHJpZXZlIHRoZSBjdXJyZW50IHByb21wdCBmcm9tIHBsdWdpbiBzZXR0aW5ncyBpZiBzeXN0ZW1Qcm9tcHRUeXBlIGlzIFwiY3VzdG9tXCJcbiAgICAvLyBlbHNlIGZhbGxiYWNrIHRvIHRoZSBjb250ZW50IGZyb20gdGhlIHN0b3JlZCB0ZXh0IG9yIHByZXNldC5cbiAgICBsZXQgY3VycmVudENvbnRlbnQgPSBcIlwiO1xuICAgIGlmICh0aGlzLnN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIC8vIEF0dGVtcHQgdG8gcmVhZCBmcm9tIGZpbGUgdXNpbmcgY2hhdCdzIHN5c3RlbVByb21wdFBhdGg6XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAodGhpcy5zeXN0ZW1Qcm9tcHRQYXRoIHx8IFwiXCIpICsgXCIubWRcIlxuICAgICAgKTtcbiAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgY3VycmVudENvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmFsbGJhY2sgdG8gcGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFxuICAgICAgICBjdXJyZW50Q29udGVudCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgd2UgaGF2ZSBhIGtub3duIHByZXNldCwgd2UgbG9hZCB0aGF0IHZhbHVlIGZyb20gdGhlIHNlcnZlclxuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0U2VydmljZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKHRoaXMuYXBwKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIGN1cnJlbnRDb250ZW50ID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXJyZW50Q29udGVudCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdDtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0OlwiLCBlcnJvcik7XG4gICAgICAgIGN1cnJlbnRDb250ZW50ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEdldCB0aGUgY3VycmVudCBtb2RlbCdzIGNvbnRleHQgbGVuZ3RoXG4gICAgbGV0IG1vZGVsQ29udGV4dExlbmd0aDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICBjb25zdCBjdXJyZW50TW9kZWwgPSBtb2RlbHMuZmluZChcbiAgICAgICAgKG1vZGVsKSA9PiBtb2RlbC5pZCA9PT0gdGhpcy5zZWxlY3RlZE1vZGVsSWRcbiAgICAgICk7XG4gICAgICBpZiAoY3VycmVudE1vZGVsKSB7XG4gICAgICAgIG1vZGVsQ29udGV4dExlbmd0aCA9IGN1cnJlbnRNb2RlbC5jb250ZXh0X2xlbmd0aDtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgbW9kZWwgY29udGV4dCBsZW5ndGg6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93U3lzdGVtUHJvbXB0TW9kYWwodGhpcy5hcHAsIGN1cnJlbnRDb250ZW50LCB7XG4gICAgICBtb2RlOiBcImNoYXQtc3BlY2lmaWNcIixcbiAgICAgIGN1c3RvbVByb21wdEZpbGVQYXRoOlxuICAgICAgICB0aGlzLnN5c3RlbVByb21wdFBhdGggfHwgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdHNEaXJlY3RvcnksXG4gICAgICBtb2RlbENvbnRleHRMZW5ndGgsXG4gICAgICB0b2tlbkxpbWl0UGVyY2VudGFnZTogdGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSxcbiAgICB9KTtcblxuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIC8vIFVwZGF0ZSBsb2NhbCBzdGF0ZXNcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9IHJlc3VsdC50eXBlO1xuICAgICAgaWYgKHJlc3VsdC50eXBlID09PSBcImN1c3RvbVwiICYmIHJlc3VsdC5wYXRoKSB7XG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHJlc3VsdC5wYXRoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICAvLyBTdG9yZSBib3RoIHRoZSBwZXJjZW50YWdlIGFuZCBjYWxjdWxhdGVkIHRva2VuIGxpbWl0XG4gICAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlID0gcmVzdWx0LnRva2VuTGltaXRQZXJjZW50YWdlO1xuICAgICAgdGhpcy50b2tlbkxpbWl0ID0gcmVzdWx0LnRva2VuTGltaXQ7XG5cbiAgICAgIC8vIFVwZGF0ZSB0b2tlbiBjb3VudCBkaXNwbGF5IGltbWVkaWF0ZWx5XG4gICAgICBhd2FpdCB0aGlzLmlucHV0SGFuZGxlci51cGRhdGVUb2tlbkNvdW50KCk7XG5cbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGFkZE1lc3NhZ2UoXG4gICAgcm9sZTogQ2hhdFJvbGUsXG4gICAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdLFxuICAgIGV4aXN0aW5nTWVzc2FnZUlkPzogc3RyaW5nXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1lc3NhZ2VJZCA9IGV4aXN0aW5nTWVzc2FnZUlkIHx8IHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKTtcblxuICAgIGNvbnN0IHsgbWVzc2FnZUVsLCBjb250ZW50RWwgfSA9IGF3YWl0IHRoaXMubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1lc3NhZ2Uoe1xuICAgICAgYXBwOiB0aGlzLmFwcCxcbiAgICAgIG1lc3NhZ2VJZCxcbiAgICAgIHJvbGUsXG4gICAgICBjb250ZW50LFxuICAgIH0pO1xuXG4gICAgLy8gU3RvcmUgY3VycmVudCBjb250ZW50IGluIGRhdGFzZXQgZm9yIGVhc3kgcmV0cmlldmFsXG4gICAgY29uc3QgY29udGVudFN0ciA9XG4gICAgICB0eXBlb2YgY29udGVudCA9PT0gXCJzdHJpbmdcIiA/IGNvbnRlbnQgOiBKU09OLnN0cmluZ2lmeShjb250ZW50KTtcbiAgICBtZXNzYWdlRWwuZGF0YXNldC5jb250ZW50ID0gY29udGVudFN0cjtcblxuICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLmFkZE1lc3NhZ2VCdXR0b25Ub29sYmFyKFxuICAgICAgbWVzc2FnZUVsLFxuICAgICAgdHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIgPyBjb250ZW50IDogSlNPTi5zdHJpbmdpZnkoY29udGVudCksXG4gICAgICByb2xlLFxuICAgICAgbWVzc2FnZUlkXG4gICAgKTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwicmVzdWJtaXRcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG1lc3NhZ2VJZCwgY29udGVudCB9ID0gZS5kZXRhaWw7XG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMubWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkXG4gICAgICApO1xuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLnNwbGljZShpbmRleCk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcblxuICAgICAgICB0aGlzLmNoYXRDb250YWluZXIuZW1wdHkoKTtcbiAgICAgICAgZm9yIChjb25zdCBtc2cgb2YgdGhpcy5tZXNzYWdlcykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWRkTWVzc2FnZShtc2cucm9sZSwgbXNnLmNvbnRlbnQsIG1zZy5tZXNzYWdlX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLnNldFZhbHVlKGNvbnRlbnQpO1xuICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJlZGl0XCIsIGFzeW5jIChlOiBDdXN0b21FdmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBtZXNzYWdlSWQsIG9sZENvbnRlbnQsIG5ld0NvbnRlbnQgfSA9IGUuZGV0YWlsO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBtZXNzYWdlIGNvbnRlbnRcbiAgICAgICAgdGhpcy5tZXNzYWdlc1tpbmRleF0uY29udGVudCA9IG5ld0NvbnRlbnQ7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcblxuICAgICAgICAvLyBSZS1yZW5kZXIgSU4gUExBQ0UgYnkgdXBkYXRpbmcgZXhpc3RpbmcgbWVzc2FnZSBlbGVtZW50XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsOiBuZXdDb250ZW50RWwgfSA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5tZXNzYWdlUmVuZGVyZXIucmVuZGVyTWVzc2FnZSh7XG4gICAgICAgICAgICBhcHA6IHRoaXMuYXBwLFxuICAgICAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICAgICAgcm9sZTogdGhpcy5tZXNzYWdlc1tpbmRleF0ucm9sZSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVwbGFjZSBqdXN0IHRoZSBjb250ZW50IHBvcnRpb24gdG8gbWFpbnRhaW4gcG9zaXRpb25cbiAgICAgICAgY29uc3Qgb2xkQ29udGVudEVsID0gbWVzc2FnZUVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgXCIuc3lzdGVtc2N1bHB0LW1lc3NhZ2UtY29udGVudFwiXG4gICAgICAgICk7XG4gICAgICAgIGlmIChvbGRDb250ZW50RWwgJiYgbmV3Q29udGVudEVsKSB7XG4gICAgICAgICAgb2xkQ29udGVudEVsLnJlcGxhY2VXaXRoKG5ld0NvbnRlbnRFbCk7XG4gICAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIuc2V0dXBJbWFnZUhhbmRsZXJzKG5ld0NvbnRlbnRFbCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgZGF0YXNldCB3aXRoIG5ldyBjb250ZW50XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRTdHIgPVxuICAgICAgICAgIHR5cGVvZiB0aGlzLm1lc3NhZ2VzW2luZGV4XS5jb250ZW50ID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICA/IHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnRcbiAgICAgICAgICAgIDogSlNPTi5zdHJpbmdpZnkodGhpcy5tZXNzYWdlc1tpbmRleF0uY29udGVudCk7XG4gICAgICAgIG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgPSB1cGRhdGVkU3RyO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJkZWxldGVcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG1lc3NhZ2VJZCB9ID0gZS5kZXRhaWw7XG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMubWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkXG4gICAgICApO1xuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWwpO1xuICAgIHRoaXMuc2Nyb2xsTWFuYWdlci51cGRhdGVDb250ZW50SGVpZ2h0KCk7XG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gIH1cblxuICBwcml2YXRlIGdldElucHV0VmFsdWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dEhhbmRsZXIuZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIGlmICh0aGlzLnJlZnJlc2hJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlZnJlc2hJbnRlcnZhbCk7XG4gICAgICB0aGlzLnJlZnJlc2hJbnRlcnZhbCA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5jbGVhbnVwKCk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZihcbiAgICAgIFwiYWN0aXZlLWxlYWYtY2hhbmdlXCIsXG4gICAgICB0aGlzLmNoZWNrRm9yVXBkYXRlcy5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLmFjdGlvbnNEcmF3ZXIudW5sb2FkKCk7XG4gICAgdGhpcy5jb250ZXh0TWFuYWdlci51bmxvYWQoKTtcbiAgICB0aGlzLmlucHV0SGFuZGxlci51bmxvYWQoKTtcbiAgfVxuXG4gIGdldFN0YXRlKCk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNoYXRJZDogdGhpcy5jaGF0SWQsXG4gICAgICBzZWxlY3RlZE1vZGVsSWQ6IHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgIH07XG4gIH1cblxuICBhc3luYyBzZXRTdGF0ZShzdGF0ZTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHN0YXRlLmNoYXRJZCkge1xuICAgICAgYXdhaXQgdGhpcy5sb2FkQ2hhdEJ5SWQoc3RhdGUuY2hhdElkKTtcbiAgICB9XG4gICAgdGhpcy5hd2FpdGluZ1N0YXRlUmVzdG9yZSA9IGZhbHNlO1xuICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIHN0YXRlIHJlc3RvcmUgaWYgdGhpcyB2aWV3IGlzIGFjdGl2ZVxuICAgIGlmICh0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShJdGVtVmlldyk/LmxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkQ2hhdEJ5SWQoY2hhdElkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2hhdERhdGEgPSBhd2FpdCB0aGlzLmNoYXRTdG9yYWdlLmxvYWRDaGF0KGNoYXRJZCk7XG4gICAgICBpZiAoIWNoYXREYXRhKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBjaGF0XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2hhdENvbnRhaW5lci5lbXB0eSgpO1xuICAgICAgdGhpcy5tZXNzYWdlcyA9IGNoYXREYXRhLm1lc3NhZ2VzO1xuICAgICAgdGhpcy5jaGF0SWQgPSBjaGF0RGF0YS5pZDtcbiAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gY2hhdERhdGEuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgdGhpcy5jaGF0VGl0bGUgPSBjaGF0RGF0YS50aXRsZSB8fCBcIlVudGl0bGVkIENoYXRcIjtcblxuICAgICAgLy8gVXBkYXRlIHN5c3RlbSBwcm9tcHQgc2V0dGluZ3MgZnJvbSBtZXRhZGF0YVxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCB0aGlzLmNoYXRTdG9yYWdlLmdldE1ldGFkYXRhKGNoYXRJZCk7XG4gICAgICBpZiAobWV0YWRhdGE/LnN5c3RlbU1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS50eXBlO1xuICAgICAgICB0aGlzLnRva2VuTGltaXQgPSBtZXRhZGF0YS5zeXN0ZW1NZXNzYWdlLnRva2VuTGltaXQ7XG4gICAgICAgIHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgPSBtZXRhZGF0YS5zeXN0ZW1NZXNzYWdlLnRva2VuTGltaXRQZXJjZW50YWdlO1xuICAgICAgICBpZiAobWV0YWRhdGEuc3lzdGVtTWVzc2FnZS5wYXRoKSB7XG4gICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS5wYXRoLnJlcGxhY2UoXG4gICAgICAgICAgICAvXlxcW1xcWyguKj8pXFxdXFxdJC8sXG4gICAgICAgICAgICBcIiQxXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgY29uc3QgY3VycmVudE1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgICAgKG1vZGVsKSA9PiBtb2RlbC5pZCA9PT0gdGhpcy5zZWxlY3RlZE1vZGVsSWRcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jdXJyZW50TW9kZWxOYW1lID0gY3VycmVudE1vZGVsPy5uYW1lIHx8IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50TW9kZWxOYW1lID0gdGhpcy5zZWxlY3RlZE1vZGVsSWQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChjaGF0RGF0YS5jb250ZXh0X2ZpbGVzKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKGNoYXREYXRhLmNvbnRleHRfZmlsZXMpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgdGhpcy5tZXNzYWdlcykge1xuICAgICAgICBhd2FpdCB0aGlzLmFkZE1lc3NhZ2UoXG4gICAgICAgICAgbWVzc2FnZS5yb2xlLFxuICAgICAgICAgIG1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICBtZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuXG4gICAgICAvLyBUcmlnZ2VyIHRva2VuIGNvdW50IHVwZGF0ZSBhZnRlciBjaGF0IGlzIGZ1bGx5IGxvYWRlZFxuICAgICAgaWYgKHRoaXMuaW5wdXRIYW5kbGVyKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5wdXRIYW5kbGVyLnVwZGF0ZVRva2VuQ291bnQoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIltTeXN0ZW1TY3VscHRdIEVycm9yIGluIGxvYWRDaGF0QnlJZDpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRcIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWRkRmlsZVRvQ29udGV4dChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY29weUVudGlyZUNoYXRUb0NsaXBib2FyZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IGNoYXRDb250ZW50ID0gXCJcIjtcblxuICAgICAgLy8gQWRkIHN5c3RlbSBwcm9tcHQgaWYgZXhpc3RzXG4gICAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlKSB7XG4gICAgICAgIGxldCBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9PT0gXCJjdXN0b21cIiAmJiB0aGlzLnN5c3RlbVByb21wdFBhdGgpIHtcbiAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoICsgXCIubWRcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0OlwiLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzeXN0ZW1Qcm9tcHRDb250ZW50KSB7XG4gICAgICAgICAgY2hhdENvbnRlbnQgKz0gYFN5c3RlbSBQcm9tcHQ6XFxuXCJcIlwiXCJcIlxcbiR7c3lzdGVtUHJvbXB0Q29udGVudH1cXG5cIlwiXCJcIlwiXFxuXFxuYDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgY29udGV4dCBmaWxlc1xuICAgICAgY29uc3QgY29udGV4dEZpbGVzID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKTtcbiAgICAgIGlmIChjb250ZXh0RmlsZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgY2hhdENvbnRlbnQgKz0gXCJDb250ZXh0IEZpbGVzOlxcblxcblwiO1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgICAgIGlmICghZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIHtcbiAgICAgICAgICAgIC8vIFNraXAgZG9jdW1lbnQgcmVmZXJlbmNlc1xuICAgICAgICAgICAgLy8gQ2xlYW4gdGhlIHdpa2ktbGluayBmb3JtYXQgYW5kIG1hdGggZGlzcGxheSBtYXJrZXJzXG4gICAgICAgICAgICBjb25zdCBjbGVhblBhdGggPSBmaWxlUGF0aFxuICAgICAgICAgICAgICAucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIilcbiAgICAgICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgL1xcJGJlZ2luOm1hdGg6ZGlzcGxheVxcJFxcWyguKj8pXFwkZW5kOm1hdGg6ZGlzcGxheVxcJF0vZyxcbiAgICAgICAgICAgICAgICBcIiQxXCJcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgYW5kIHJlYWQgdGhlIGZpbGVcbiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgICAgICAgIGNsZWFuUGF0aCxcbiAgICAgICAgICAgICAgXCJcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgcmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUgJiZcbiAgICAgICAgICAgICAgIXJlc29sdmVkRmlsZS5leHRlbnNpb24ubWF0Y2goL14oanBnfGpwZWd8cG5nfGdpZnx3ZWJwKSQvaSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChyZXNvbHZlZEZpbGUpO1xuICAgICAgICAgICAgICBjaGF0Q29udGVudCArPSBgWyR7Y2xlYW5QYXRofV1cXG5cIlwiXCJcIlwiXFxuJHtjb250ZW50fVxcblwiXCJcIlwiXCJcXG5cXG5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgY2hhdCBtZXNzYWdlc1xuICAgICAgY2hhdENvbnRlbnQgKz0gXCJDaGF0IEhpc3RvcnkgVGh1cyBGYXI6XFxuXFxuXCI7XG4gICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgdGhpcy5tZXNzYWdlcykge1xuICAgICAgICBjb25zdCByb2xlID0gbWVzc2FnZS5yb2xlID09PSBcImFzc2lzdGFudFwiID8gXCJBXCIgOiBcIlVzZXJcIjtcbiAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBjaGF0Q29udGVudCArPSBgJHtyb2xlfTpcXG5cIlwiXCJcIlwiXFxuJHttZXNzYWdlLmNvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ29weSB0byBjbGlwYm9hcmRcbiAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNoYXRDb250ZW50KTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggQ2hhdCBjb3BpZWQgdG8gY2xpcGJvYXJkXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNvcHkgY2hhdDpcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gY29weSBjaGF0IHRvIGNsaXBib2FyZFwiKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0VG9rZW5MaW1pdCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnRva2VuTGltaXQ7XG4gIH1cblxuICBwdWJsaWMgZm9jdXNJbnB1dCgpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cERyYWdBbmREcm9wKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAvLyBDcmVhdGUgb3ZlcmxheSBlbGVtZW50c1xuICAgIGNvbnN0IG92ZXJsYXkgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmFnLW92ZXJsYXlcIixcbiAgICB9KTtcbiAgICBjb25zdCBtZXNzYWdlID0gb3ZlcmxheS5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYWctbWVzc2FnZVwiLFxuICAgICAgdGV4dDogXCJEcm9wIGZpbGVzIHRvIGFkZCB0byBjb250ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBNQVhfRklMRVMgPSAxMDA7XG5cbiAgICAvLyBQYXJzZSBPYnNpZGlhbiBVUkkgdG8gZ2V0IGZpbGUgcGF0aFxuICAgIGNvbnN0IHBhcnNlT2JzaWRpYW5VcmkgPSAodXJpOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghdXJpLnN0YXJ0c1dpdGgoXCJvYnNpZGlhbjovL29wZW5cIikpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHVyaSk7XG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJmaWxlXCIpIHx8IFwiXCIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW0RyYWdEcm9wXSBFcnJvciBwYXJzaW5nIFVSSTpcIiwgdXJpLCBlKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEdldCBmaWxlcyBmcm9tIGZvbGRlciByZWN1cnNpdmVseVxuICAgIGNvbnN0IGdldEZpbGVzRnJvbUZvbGRlciA9IChmb2xkZXI6IFRGb2xkZXIpOiBURmlsZVtdID0+IHtcbiAgICAgIGNvbnN0IGZpbGVzOiBURmlsZVtdID0gW107XG4gICAgICBjb25zdCBwcm9jZXNzRm9sZGVyID0gKGN1cnJlbnRGb2xkZXI6IFRGb2xkZXIpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjdXJyZW50Rm9sZGVyLmNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGZpbGVzLnB1c2goY2hpbGQpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICBwcm9jZXNzRm9sZGVyKGNoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBwcm9jZXNzRm9sZGVyKGZvbGRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbGVzLnNsaWNlKDAsIE1BWF9GSUxFUyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICAvLyBHZXQgZmlsZSBjb3VudCBmcm9tIGRhdGEgdHJhbnNmZXJcbiAgICBjb25zdCBnZXRGaWxlQ291bnQgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2Zlcik6IFByb21pc2U8bnVtYmVyPiA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50Q29udGV4dFNpemUgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG5cbiAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZW1haW5pbmdTbG90cyA9IE1BWF9GSUxFUyAtIGN1cnJlbnRDb250ZXh0U2l6ZTtcblxuICAgICAgbGV0IG5ld0ZpbGVDb3VudCA9IDA7XG4gICAgICBsZXQgZmlsZXNUb1Byb2Nlc3M6IChURmlsZSB8IFRGb2xkZXIpW10gPSBbXTtcblxuICAgICAgLy8gVHJ5IHRvIGdldCBmaWxlcyBmcm9tIHRleHQvcGxhaW4gKGZvbGRlciBkcm9wcylcbiAgICAgIGlmIChkdC5pdGVtcyAmJiBkdC5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICBpdGVtLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFNwbGl0IGJ5IG5ld2xpbmVzIGluIGNhc2Ugb2YgbXVsdGlwbGUgVVJJc1xuICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgICAgbGV0IGZpbGVQYXRoID0gbGluZTtcbiAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIE9ic2lkaWFuIFVSSSBmaXJzdFxuICAgICAgICAgICAgICBpZiAobGluZS5zdGFydHNXaXRoKFwib2JzaWRpYW46Ly9cIikpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkobGluZSkgfHwgbGluZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFRyeSB0byBnZXQgdGhlIGZpbGVcbiAgICAgICAgICAgICAgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICghZmlsZVBhdGguaW5jbHVkZXMoXCIuXCIpKSB7XG4gICAgICAgICAgICAgICAgLy8gVHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgIGNvbnN0IG1kUGF0aCA9IGAke2ZpbGVQYXRofS5tZGA7XG4gICAgICAgICAgICAgICAgY29uc3QgbWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG1kUGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKG1kRmlsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENvdW50IGZpbGVzIGZyb20gdGhlIHByb2Nlc3NlZCBpdGVtc1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGZpbGVzVG9Qcm9jZXNzKSB7XG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgIGNvbnN0IGZvbGRlckZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGl0ZW0pLmxlbmd0aDtcbiAgICAgICAgICBuZXdGaWxlQ291bnQgKz0gZm9sZGVyRmlsZXM7XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgbmV3RmlsZUNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gSWYgbm8gZmlsZXMgZm91bmQgeWV0LCB0cnkgVVJJIGxpc3RcbiAgICAgIGlmIChuZXdGaWxlQ291bnQgPT09IDAgJiYgZHQudHlwZXMuaW5jbHVkZXMoXCJ0ZXh0L3VyaS1saXN0XCIpKSB7XG4gICAgICAgIGNvbnN0IHVyaURhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgZHQuaXRlbXNbMV0uZ2V0QXNTdHJpbmcocmVzb2x2ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHVyaXMgPSB1cmlEYXRhXG4gICAgICAgICAgLnNwbGl0KFwib2JzaWRpYW46Ly9vcGVuXCIpXG4gICAgICAgICAgLmZpbHRlcigodXJpKSA9PiB1cmkudHJpbSgpKVxuICAgICAgICAgIC5tYXAoKHVyaSkgPT4gXCJvYnNpZGlhbjovL29wZW5cIiArIHVyaS50cmltKCkpO1xuXG4gICAgICAgIGZvciAoY29uc3QgdXJpIG9mIHVyaXMpIHtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkodXJpKTtcbiAgICAgICAgICBpZiAoIWZpbGVQYXRoKSBjb250aW51ZTtcblxuICAgICAgICAgIGNvbnN0IGFic3RyYWN0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlckZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGFic3RyYWN0RmlsZSkubGVuZ3RoO1xuICAgICAgICAgICAgbmV3RmlsZUNvdW50ICs9IGZvbGRlckZpbGVzO1xuICAgICAgICAgIH0gZWxzZSBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIG5ld0ZpbGVDb3VudCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBmaW5hbENvdW50ID0gTWF0aC5taW4obmV3RmlsZUNvdW50LCByZW1haW5pbmdTbG90cyk7XG4gICAgICByZXR1cm4gZmluYWxDb3VudDtcbiAgICB9O1xuXG4gICAgLy8gVXBkYXRlIG1lc3NhZ2UgY29udGVudFxuICAgIGNvbnN0IHVwZGF0ZU1lc3NhZ2UgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2ZlcikgPT4ge1xuICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgaWYgKGN1cnJlbnRDb250ZXh0U2l6ZSA+PSBNQVhfRklMRVMpIHtcbiAgICAgICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGBDYW5ub3QgYWRkIG1vcmUgZmlsZXMgKG1heCAke01BWF9GSUxFU30gcmVhY2hlZClgO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpbGVDb3VudCA9IGF3YWl0IGdldEZpbGVDb3VudChkdCk7XG4gICAgICBpZiAoZmlsZUNvdW50ID4gMCkge1xuICAgICAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gYEFkZCAke2ZpbGVDb3VudH0gZmlsZSR7XG4gICAgICAgICAgZmlsZUNvdW50ID4gMSA/IFwic1wiIDogXCJcIlxuICAgICAgICB9IHRvIGNvbnRleHQgKCR7Y3VycmVudENvbnRleHRTaXplICsgZmlsZUNvdW50fS8ke01BWF9GSUxFU30gdG90YWwpYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBgRHJvcCBmaWxlcyB0byBhZGQgdG8gY29udGV4dCAoJHtjdXJyZW50Q29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBUcmFjayBkcmFnIHN0YXRlXG4gICAgbGV0IGRyYWdDb3VudGVyID0gMDtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VudGVyXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZHJhZ0NvdW50ZXIrKztcbiAgICAgIGlmIChkcmFnQ291bnRlciA9PT0gMSkge1xuICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtZHJhZy1hY3RpdmVcIik7XG4gICAgICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICAgIHVwZGF0ZU1lc3NhZ2UoZS5kYXRhVHJhbnNmZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyLS07XG4gICAgICBpZiAoZHJhZ0NvdW50ZXIgPT09IDApIHtcbiAgICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWRyYWctYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICBhd2FpdCB1cGRhdGVNZXNzYWdlKGUuZGF0YVRyYW5zZmVyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyID0gMDtcbiAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1kcmFnLWFjdGl2ZVwiKTtcblxuICAgICAgY29uc3QgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIGlmICghZHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdGFydGluZ0NvbnRleHRTaXplID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgaWYgKHN0YXJ0aW5nQ29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIG5ldyBOb3RpY2UoYENhbm5vdCBhZGQgbW9yZSBmaWxlcyAobWF4ICR7TUFYX0ZJTEVTfSByZWFjaGVkKWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBmaWxlc1RvUHJvY2VzczogKFRGaWxlIHwgVEZvbGRlcilbXSA9IFtdO1xuXG4gICAgICAgIC8vIEZpcnN0IHRyeSB0byBoYW5kbGUgaXQgYXMgYSBmb2xkZXIgZHJvcFxuICAgICAgICBpZiAoZHQuaXRlbXMgJiYgZHQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICBpdGVtLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvLyBTcGxpdCBieSBuZXdsaW5lcyBpbiBjYXNlIG9mIG11bHRpcGxlIFVSSXNcbiAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpO1xuXG4gICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgICAgIGxldCBmaWxlUGF0aCA9IGxpbmU7XG4gICAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgT2JzaWRpYW4gVVJJIGZpcnN0XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcIm9ic2lkaWFuOi8vXCIpKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkobGluZSkgfHwgbGluZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZ2V0IHRoZSBmaWxlXG4gICAgICAgICAgICAgICAgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgICAgICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgICAgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZpbGVQYXRoLmluY2x1ZGVzKFwiLlwiKSkge1xuICAgICAgICAgICAgICAgICAgLy8gVHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgICAgY29uc3QgbWRQYXRoID0gYCR7ZmlsZVBhdGh9Lm1kYDtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1kRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChtZFBhdGgpO1xuICAgICAgICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2gobWRGaWxlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBubyBmb2xkZXJzIGZvdW5kLCB0cnkgaGFuZGxpbmcgYXMgVVJJIGxpc3RcbiAgICAgICAgaWYgKGZpbGVzVG9Qcm9jZXNzLmxlbmd0aCA9PT0gMCAmJiBkdC50eXBlcy5pbmNsdWRlcyhcInRleHQvdXJpLWxpc3RcIikpIHtcbiAgICAgICAgICBjb25zdCB1cmlEYXRhID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgZHQuaXRlbXNbMV0uZ2V0QXNTdHJpbmcocmVzb2x2ZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCB1cmlzID0gdXJpRGF0YVxuICAgICAgICAgICAgLnNwbGl0KFwib2JzaWRpYW46Ly9vcGVuXCIpXG4gICAgICAgICAgICAuZmlsdGVyKCh1cmkpID0+IHVyaS50cmltKCkpXG4gICAgICAgICAgICAubWFwKCh1cmkpID0+IFwib2JzaWRpYW46Ly9vcGVuXCIgKyB1cmkudHJpbSgpKTtcblxuICAgICAgICAgIGZvciAoY29uc3QgdXJpIG9mIHVyaXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGFyc2VPYnNpZGlhblVyaSh1cmkpO1xuICAgICAgICAgICAgaWYgKCFmaWxlUGF0aCkgY29udGludWU7XG5cbiAgICAgICAgICAgIGxldCBhYnN0cmFjdEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlIHx8XG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXJcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdGFsRmlsZXNBZGRlZCA9IDA7XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1Nsb3RzID0gTUFYX0ZJTEVTIC0gc3RhcnRpbmdDb250ZXh0U2l6ZTtcblxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZmlsZXNUb1Byb2Nlc3MpIHtcbiAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGl0ZW0pO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID1cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgRmlsZSBsaW1pdCByZWFjaGVkICgke01BWF9GSUxFU30gdG90YWwpYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmFkZEZpbGVUb0NvbnRleHQoZmlsZSk7XG4gICAgICAgICAgICAgICAgdG90YWxGaWxlc0FkZGVkKys7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbnRleHRTaXplID1cbiAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgICAgICAgYEFkZGVkICR7ZmlsZS5uYW1lfSB0byBjb250ZXh0ICgke3VwZGF0ZWRDb250ZXh0U2l6ZX0vJHtNQVhfRklMRVN9KWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbRHJhZ0Ryb3BdIEVycm9yIGFkZGluZyBmaWxlIGZyb20gZm9sZGVyOlwiLCB7XG4gICAgICAgICAgICAgICAgICBmaWxlOiBmaWxlLnBhdGgsXG4gICAgICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29udGV4dFNpemUgPVxuICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICBpZiAoY3VycmVudENvbnRleHRTaXplID49IE1BWF9GSUxFUykge1xuICAgICAgICAgICAgICBuZXcgTm90aWNlKGBGaWxlIGxpbWl0IHJlYWNoZWQgKCR7TUFYX0ZJTEVTfSB0b3RhbClgKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmFkZEZpbGVUb0NvbnRleHQoaXRlbSk7XG4gICAgICAgICAgICB0b3RhbEZpbGVzQWRkZWQrKztcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRDb250ZXh0U2l6ZSA9XG4gICAgICAgICAgICAgIHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgICAgICAgIGBBZGRlZCAke2l0ZW0ubmFtZX0gdG8gY29udGV4dCAoJHt1cGRhdGVkQ29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbmFsQ29udGV4dFNpemUgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW0RyYWdEcm9wXSBFcnJvciBwcm9jZXNzaW5nIGRyb3A6XCIsIGVycm9yKTtcbiAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byBwcm9jZXNzIGRyb3BwZWQgZmlsZXNcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgbW9kZWwgSUQgZm9yIHRoaXMgY2hhdCB2aWV3XG4gICAqL1xuICBwdWJsaWMgZ2V0U2VsZWN0ZWRNb2RlbElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbW9kZWwgSUQgZm9yIHRoaXMgY2hhdCB2aWV3IGFuZCB1cGRhdGUgdGhlIFVJXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0U2VsZWN0ZWRNb2RlbElkKG1vZGVsSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICBhd2FpdCB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG4gICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuXG4gICAgLy8gUmVjYWxjdWxhdGUgdG9rZW4gbGltaXQgaWYgbmVlZGVkXG4gICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgIGNvbnN0IHNlbGVjdGVkTW9kZWwgPSBtb2RlbHMuZmluZCgobW9kZWwpID0+IG1vZGVsLmlkID09PSBtb2RlbElkKTtcbiAgICBpZiAodGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSAmJiBzZWxlY3RlZE1vZGVsPy5jb250ZXh0X2xlbmd0aCkge1xuICAgICAgdGhpcy50b2tlbkxpbWl0ID0gTWF0aC5mbG9vcihcbiAgICAgICAgKHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgLyAxMDApICogc2VsZWN0ZWRNb2RlbC5jb250ZXh0X2xlbmd0aFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICB9XG5cbiAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBtb2RlbCBzZWxlY3Rpb25cbiAgICB0aGlzLmZvY3VzSW5wdXQoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIHBhcnNlWWFtbCwgc3RyaW5naWZ5WWFtbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UsIENoYXRSb2xlLCBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuaW50ZXJmYWNlIENvbnRleHRGaWxlIHtcbiAgcGF0aDogc3RyaW5nO1xuICB0eXBlOiBcInNvdXJjZVwiIHwgXCJleHRyYWN0aW9uXCI7XG59XG5cbmludGVyZmFjZSBDaGF0TWV0YWRhdGEge1xuICBpZDogc3RyaW5nO1xuICBtb2RlbDogc3RyaW5nO1xuICBjcmVhdGVkOiBzdHJpbmc7XG4gIGxhc3RNb2RpZmllZDogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBjb250ZXh0X2ZpbGVzPzogQ29udGV4dEZpbGVbXTtcbiAgc3lzdGVtTWVzc2FnZT86IHtcbiAgICB0eXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICAgIHRva2VuTGltaXRQZXJjZW50YWdlPzogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQ2hhdFN0b3JhZ2VTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBjaGF0RGlyZWN0b3J5OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGNoYXREaXJlY3Rvcnk6IHN0cmluZykge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMuY2hhdERpcmVjdG9yeSA9IGNoYXREaXJlY3Rvcnk7XG4gIH1cblxuICBhc3luYyBzYXZlQ2hhdChcbiAgICBjaGF0SWQ6IHN0cmluZyxcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZyxcbiAgICBjb250ZXh0RmlsZXM/OiBTZXQ8c3RyaW5nPixcbiAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZyxcbiAgICBzeXN0ZW1Qcm9tcHRUeXBlPzogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiLFxuICAgIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmcsXG4gICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgdG9rZW5MaW1pdD86IG51bWJlcixcbiAgICB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLmNoYXREaXJlY3Rvcnl9LyR7Y2hhdElkfS5tZGA7XG5cbiAgICAgIC8vIENvbnZlcnQgU2V0PHN0cmluZz4gdG8gQ29udGV4dEZpbGVbXVxuICAgICAgY29uc3QgY29udGV4dEZpbGVPYmplY3RzID0gY29udGV4dEZpbGVzXG4gICAgICAgID8gQXJyYXkuZnJvbShjb250ZXh0RmlsZXMpLm1hcCgocGF0aCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhbiBleHRyYWN0aW9uIGJ5IGxvb2tpbmcgYXQgdGhlIHBhdGhcbiAgICAgICAgICAgIGNvbnN0IGlzRXh0cmFjdGlvbiA9IHBhdGguaW5jbHVkZXMoXCIvRXh0cmFjdGlvbnMvXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgICAgdHlwZTogaXNFeHRyYWN0aW9uXG4gICAgICAgICAgICAgICAgPyAoXCJleHRyYWN0aW9uXCIgYXMgY29uc3QpXG4gICAgICAgICAgICAgICAgOiAoXCJzb3VyY2VcIiBhcyBjb25zdCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pXG4gICAgICAgIDogW107XG5cbiAgICAgIGNvbnN0IG1ldGFkYXRhOiBDaGF0TWV0YWRhdGEgPSB7XG4gICAgICAgIGlkOiBjaGF0SWQsXG4gICAgICAgIG1vZGVsOiBzZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiB0aXRsZSB8fCBcIlVudGl0bGVkIENoYXRcIixcbiAgICAgICAgY29udGV4dF9maWxlczogY29udGV4dEZpbGVPYmplY3RzLFxuICAgICAgICBzeXN0ZW1NZXNzYWdlOiBzeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIHR5cGU6IHN5c3RlbVByb21wdFR5cGUsXG4gICAgICAgICAgICAgIHBhdGg6XG4gICAgICAgICAgICAgICAgc3lzdGVtUHJvbXB0VHlwZSA9PT0gXCJjdXN0b21cIiAmJiBzeXN0ZW1Qcm9tcHRQYXRoXG4gICAgICAgICAgICAgICAgICA/IGBbWyR7c3lzdGVtUHJvbXB0UGF0aH1dXWBcbiAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB0b2tlbkxpbWl0LFxuICAgICAgICAgICAgICB0b2tlbkxpbWl0UGVyY2VudGFnZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgLS0tXFxuJHtzdHJpbmdpZnlZYW1sKG1ldGFkYXRhKX0tLS1cXG5cXG4ke21lc3NhZ2VzXG4gICAgICAgIC5tYXAoKG1zZykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VTdGFydCA9IGA8IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLVNUQVJUIHJvbGU9XCIke21zZy5yb2xlfVwiIG1lc3NhZ2UtaWQ9XCIke21zZy5tZXNzYWdlX2lkfVwiIC0tPmA7XG4gICAgICAgICAgcmV0dXJuIGAke21lc3NhZ2VTdGFydH1cXG4ke21zZy5jb250ZW50fVxcbjwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtRU5EIC0tPmA7XG4gICAgICAgIH0pXG4gICAgICAgIC5qb2luKFwiXFxuXFxuXCIpfWA7XG5cbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIubWtkaXIodGhpcy5jaGF0RGlyZWN0b3J5KTtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIud3JpdGUoZmlsZVBhdGgsIGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgY2hhdDpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHNhdmUgY2hhdFwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkQ2hhdHMoKTogUHJvbWlzZTxcbiAgICB7XG4gICAgICBpZDogc3RyaW5nO1xuICAgICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgICAgIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIGNvbnRleHRfZmlsZXM/OiBzdHJpbmdbXTtcbiAgICAgIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICAgIH1bXVxuICA+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmxpc3QodGhpcy5jaGF0RGlyZWN0b3J5KTtcbiAgICAgIGNvbnN0IGNoYXRGaWxlcyA9IGZpbGVzLmZpbGVzLmZpbHRlcigoZikgPT4gZi5lbmRzV2l0aChcIi5tZFwiKSk7XG5cbiAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIGNoYXRGaWxlcy5tYXAoYXN5bmMgKGZpbGVQYXRoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIucmVhZChmaWxlUGF0aCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VNYXJrZG93bkNvbnRlbnQoY29udGVudCk7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gY2hhdHMuZmlsdGVyKFxuICAgICAgICAoY2hhdCk6IGNoYXQgaXMgTm9uTnVsbGFibGU8dHlwZW9mIGNoYXQ+ID0+IGNoYXQgIT09IG51bGxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBjaGF0czpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRDaGF0KGNoYXRJZDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgaWQ6IHN0cmluZztcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgICBsYXN0TW9kaWZpZWQ6IG51bWJlcjtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRleHRfZmlsZXM/OiBzdHJpbmdbXTtcbiAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZztcbiAgICB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICB9IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuY2hhdERpcmVjdG9yeX0vJHtjaGF0SWR9Lm1kYDtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlTWFya2Rvd25Db250ZW50KGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdDpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1hcmtkb3duQ29udGVudChcbiAgICBtZXRhZGF0YTogQ2hhdE1ldGFkYXRhLFxuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgeWFtbE1ldGFkYXRhID0ge1xuICAgICAgc3lzdGVtc2N1bHB0X2NoYXQ6IHRydWUsXG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICB9O1xuXG4gICAgY29uc3QgbWV0YWRhdGFTZWN0aW9uID0gW1xuICAgICAgXCItLS1cIixcbiAgICAgIHN0cmluZ2lmeVlhbWwoeWFtbE1ldGFkYXRhKS50cmltKCksXG4gICAgICBcIi0tLVwiLFxuICAgICAgXCJcIixcbiAgICBdLmpvaW4oXCJcXG5cIik7XG5cbiAgICBjb25zdCBtZXNzYWdlc1NlY3Rpb24gPSBtZXNzYWdlc1xuICAgICAgLm1hcCgobXNnKSA9PlxuICAgICAgICBbXG4gICAgICAgICAgYDwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtU1RBUlQgcm9sZT1cIiR7bXNnLnJvbGV9XCIgbWVzc2FnZS1pZD1cIiR7bXNnLm1lc3NhZ2VfaWR9XCIgLS0+YCxcbiAgICAgICAgICBtc2cuY29udGVudCxcbiAgICAgICAgICBcIjwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtRU5EIC0tPlwiLFxuICAgICAgICAgIFwiXCIsXG4gICAgICAgIF0uam9pbihcIlxcblwiKVxuICAgICAgKVxuICAgICAgLmpvaW4oXCJcXG5cIik7XG5cbiAgICByZXR1cm4gbWV0YWRhdGFTZWN0aW9uICsgbWVzc2FnZXNTZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZU1ldGFkYXRhKGNvbnRlbnQ6IHN0cmluZyk6IENoYXRNZXRhZGF0YSB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtZXRhZGF0YU1hdGNoID0gY29udGVudC5tYXRjaCgvLS0tXFxuKFtcXHNcXFNdKj8pXFxuLS0tLyk7XG4gICAgICBpZiAoIW1ldGFkYXRhTWF0Y2gpIHJldHVybiBudWxsO1xuXG4gICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVlhbWwobWV0YWRhdGFNYXRjaFsxXSk7XG4gICAgICBpZiAoIXBhcnNlZCB8fCB0eXBlb2YgcGFyc2VkICE9PSBcIm9iamVjdFwiKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3Qge1xuICAgICAgICBpZCxcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIGNyZWF0ZWQsXG4gICAgICAgIGxhc3RNb2RpZmllZCxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIGNvbnRleHRfZmlsZXMsXG4gICAgICAgIHN5c3RlbU1lc3NhZ2UsXG4gICAgICB9ID0gcGFyc2VkO1xuICAgICAgaWYgKCFpZCB8fCAhbW9kZWwgfHwgIWNyZWF0ZWQgfHwgIWxhc3RNb2RpZmllZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgIC8vIENvbnZlcnQgb2xkIGZvcm1hdCAoc3RyaW5nW10pIHRvIG5ldyBmb3JtYXQgKENvbnRleHRGaWxlW10pXG4gICAgICBjb25zdCBwcm9jZXNzZWRDb250ZXh0RmlsZXMgPSBjb250ZXh0X2ZpbGVzPy5tYXAoXG4gICAgICAgIChmaWxlOiBzdHJpbmcgfCBDb250ZXh0RmlsZSkgPT4ge1xuICAgICAgICAgIGlmICh0eXBlb2YgZmlsZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgLy8gTGVnYWN5IGZvcm1hdCAtIGNvbnZlcnQgdG8gbmV3IGZvcm1hdFxuICAgICAgICAgICAgY29uc3QgaXNFeHRyYWN0aW9uID0gZmlsZS5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIik7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBwYXRoOiBmaWxlLFxuICAgICAgICAgICAgICB0eXBlOiBpc0V4dHJhY3Rpb25cbiAgICAgICAgICAgICAgICA/IChcImV4dHJhY3Rpb25cIiBhcyBjb25zdClcbiAgICAgICAgICAgICAgICA6IChcInNvdXJjZVwiIGFzIGNvbnN0KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoOiBmaWxlLnBhdGgsXG4gICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgLy8gQ2xlYW4gdXAgc3lzdGVtIG1lc3NhZ2UgcGF0aCBpZiBpdCBleGlzdHNcbiAgICAgIGlmIChzeXN0ZW1NZXNzYWdlPy5wYXRoKSB7XG4gICAgICAgIHN5c3RlbU1lc3NhZ2UucGF0aCA9IHN5c3RlbU1lc3NhZ2UucGF0aC5yZXBsYWNlKFxuICAgICAgICAgIC9eXFxbXFxbKC4qPylcXF1cXF0kLyxcbiAgICAgICAgICBcIiQxXCJcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQsXG4gICAgICAgIG1vZGVsLFxuICAgICAgICBjcmVhdGVkLFxuICAgICAgICBsYXN0TW9kaWZpZWQsXG4gICAgICAgIHRpdGxlOiB0aXRsZSB8fCBcIlVudGl0bGVkIENoYXRcIixcbiAgICAgICAgY29udGV4dF9maWxlczogcHJvY2Vzc2VkQ29udGV4dEZpbGVzIHx8IFtdLFxuICAgICAgICBzeXN0ZW1NZXNzYWdlLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSBtZXRhZGF0YTpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwYXJzZU1hcmtkb3duQ29udGVudChjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICBpZDogc3RyaW5nO1xuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICAgIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICAgIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICAgIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gIH0gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5wYXJzZU1ldGFkYXRhKGNvbnRlbnQpO1xuICAgICAgaWYgKCFtZXRhZGF0YSkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW107XG5cbiAgICAgIC8vIFBhcnNlIHVzZXIgYW5kIGFzc2lzdGFudCBtZXNzYWdlc1xuICAgICAgY29uc3QgbWVzc2FnZVJlZ2V4ID1cbiAgICAgICAgLzwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtU1RBUlQgcm9sZT1cIih1c2VyfGFzc2lzdGFudClcIiBtZXNzYWdlLWlkPVwiKFteXCJdKylcIiAtLT5cXG4oW1xcc1xcU10qPylcXG48IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLUVORCAtLT4vZztcblxuICAgICAgbGV0IG1zZ01hdGNoO1xuICAgICAgd2hpbGUgKChtc2dNYXRjaCA9IG1lc3NhZ2VSZWdleC5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBbLCByb2xlLCBtZXNzYWdlSWQsIG1lc3NhZ2VDb250ZW50XSA9IG1zZ01hdGNoO1xuICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICByb2xlOiByb2xlIGFzIENoYXRSb2xlLFxuICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VDb250ZW50LnRyaW0oKSxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBtZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDb252ZXJ0IENvbnRleHRGaWxlW10gdG8gc3RyaW5nW10gZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IGNvbnRleHRGaWxlcyA9IG1ldGFkYXRhLmNvbnRleHRfZmlsZXM/Lm1hcCgoZmlsZSkgPT5cbiAgICAgICAgdHlwZW9mIGZpbGUgPT09IFwic3RyaW5nXCIgPyBmaWxlIDogZmlsZS5wYXRoXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogbWV0YWRhdGEuaWQsXG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBzZWxlY3RlZE1vZGVsSWQ6IG1ldGFkYXRhLm1vZGVsLFxuICAgICAgICBsYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKG1ldGFkYXRhLmxhc3RNb2RpZmllZCkuZ2V0VGltZSgpLFxuICAgICAgICB0aXRsZTogbWV0YWRhdGEudGl0bGUsXG4gICAgICAgIGNvbnRleHRfZmlsZXM6IGNvbnRleHRGaWxlcyxcbiAgICAgICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg6IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2U/LnBhdGgsXG4gICAgICAgIHRva2VuTGltaXQ6IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2U/LnRva2VuTGltaXQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIG1hcmtkb3duIGNvbnRlbnQ6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVNZXNzYWdlSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIChjKSA9PiB7XG4gICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwO1xuICAgICAgY29uc3QgdiA9IGMgPT09IFwieFwiID8gciA6IChyICYgMHgzKSB8IDB4ODtcbiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdldE1ldGFkYXRhKGNoYXRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0TWV0YWRhdGEgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5jaGF0RGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VNZXRhZGF0YShjb250ZW50KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgbWV0YWRhdGE6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmludGVyZmFjZSBTY3JvbGxTdGF0ZSB7XG4gIGlzQXV0b1Njcm9sbEVuYWJsZWQ6IGJvb2xlYW47XG4gIGlzVXNlclNjcm9sbGluZzogYm9vbGVhbjtcbiAgbGFzdENvbnRlbnRIZWlnaHQ6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFNjcm9sbENvbmZpZyB7XG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIG9uU2Nyb2xsU3RhdGVDaGFuZ2U/OiAoaXNBdXRvU2Nyb2xsRW5hYmxlZDogYm9vbGVhbikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFNjcm9sbE1hbmFnZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0ZTogU2Nyb2xsU3RhdGUgPSB7XG4gICAgaXNBdXRvU2Nyb2xsRW5hYmxlZDogdHJ1ZSxcbiAgICBpc1VzZXJTY3JvbGxpbmc6IGZhbHNlLFxuICAgIGxhc3RDb250ZW50SGVpZ2h0OiAwLFxuICB9O1xuICBwcml2YXRlIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgb25TY3JvbGxTdGF0ZUNoYW5nZT86IChpc0F1dG9TY3JvbGxFbmFibGVkOiBib29sZWFuKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogU2Nyb2xsQ29uZmlnKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb25maWcuY29udGFpbmVyO1xuICAgIHRoaXMub25TY3JvbGxTdGF0ZUNoYW5nZSA9IGNvbmZpZy5vblNjcm9sbFN0YXRlQ2hhbmdlO1xuICAgIHRoaXMuYXR0YWNoRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoRXZlbnRMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7XG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIndoZWVsXCIsIHRoaXMuaGFuZGxlV2hlZWwpO1xuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHRoaXMuaGFuZGxlVG91Y2hTdGFydCk7XG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIHRoaXMuaGFuZGxlVG91Y2hFbmQpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTY3JvbGwgPSBkZWJvdW5jZSgoKSA9PiB7XG4gICAgY29uc3QgaXNBdEJvdHRvbSA9IHRoaXMuaXNTY3JvbGxlZFRvQm90dG9tKCk7XG4gICAgaWYgKGlzQXRCb3R0b20gJiYgIXRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCkge1xuICAgICAgdGhpcy5lbmFibGVBdXRvU2Nyb2xsKCk7XG4gICAgfSBlbHNlIGlmICghaXNBdEJvdHRvbSAmJiB0aGlzLnN0YXRlLmlzQXV0b1Njcm9sbEVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGlzYWJsZUF1dG9TY3JvbGwoKTtcbiAgICB9XG4gIH0sIDE1MCk7XG5cbiAgcHJpdmF0ZSBoYW5kbGVXaGVlbCA9IChlOiBXaGVlbEV2ZW50KSA9PiB7XG4gICAgaWYgKGUuZGVsdGFZIDwgMCkge1xuICAgICAgdGhpcy5kaXNhYmxlQXV0b1Njcm9sbCgpO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIGhhbmRsZVRvdWNoU3RhcnQgPSAoKSA9PiB7XG4gICAgdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPSB0cnVlO1xuICB9O1xuXG4gIHByaXZhdGUgaGFuZGxlVG91Y2hFbmQgPSAoKSA9PiB7XG4gICAgdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5pc1Njcm9sbGVkVG9Cb3R0b20oKSkge1xuICAgICAgdGhpcy5lbmFibGVBdXRvU2Nyb2xsKCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgaXNTY3JvbGxlZFRvQm90dG9tKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgc2Nyb2xsSGVpZ2h0LCBzY3JvbGxUb3AsIGNsaWVudEhlaWdodCB9ID0gdGhpcy5jb250YWluZXI7XG4gICAgcmV0dXJuIE1hdGguYWJzKHNjcm9sbEhlaWdodCAtIHNjcm9sbFRvcCAtIGNsaWVudEhlaWdodCkgPCAxMDtcbiAgfVxuXG4gIHB1YmxpYyBzY3JvbGxUb0JvdHRvbSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCkgcmV0dXJuO1xuXG4gICAgLy8gRm9yY2UgbGF5b3V0IHJlY2FsY3VsYXRpb24gdG8gZW5zdXJlIHByb3BlciBzY3JvbGxpbmdcbiAgICAvLyBUaGlzIGlzIG5lZWRlZCBlc3BlY2lhbGx5IGZvciB0aGUgZmlyc3QgbWVzc2FnZSB3aGVuIHRoZXJlJ3Mgbm8gc2Nyb2xsYmFyIHlldFxuICAgIHZvaWQgdGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0O1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvKHtcbiAgICAgICAgdG9wOiB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQsXG4gICAgICAgIGJlaGF2aW9yOiB0aGlzLnN0YXRlLmlzVXNlclNjcm9sbGluZyA/IFwic21vb3RoXCIgOiBcImF1dG9cIixcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zdGF0ZS5sYXN0Q29udGVudEhlaWdodCA9IHRoaXMuY29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZW5hYmxlQXV0b1Njcm9sbCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlLmlzQXV0b1Njcm9sbEVuYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMuc3RhdGUuaXNVc2VyU2Nyb2xsaW5nID0gZmFsc2U7XG4gICAgdGhpcy5zdGF0ZS5sYXN0Q29udGVudEhlaWdodCA9IHRoaXMuY29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgdGhpcy5vblNjcm9sbFN0YXRlQ2hhbmdlPy4odHJ1ZSk7XG4gIH1cblxuICBwcml2YXRlIGRpc2FibGVBdXRvU2Nyb2xsKCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMub25TY3JvbGxTdGF0ZUNoYW5nZT8uKGZhbHNlKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVDb250ZW50SGVpZ2h0KCk6IHZvaWQge1xuICAgIC8vIEZvcmNlIGxheW91dCByZWNhbGN1bGF0aW9uXG4gICAgdm9pZCB0aGlzLmNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudEhlaWdodCA9IHRoaXMuY29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICAgIGlmIChjdXJyZW50SGVpZ2h0ICE9PSB0aGlzLnN0YXRlLmxhc3RDb250ZW50SGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuc3RhdGUubGFzdENvbnRlbnRIZWlnaHQgPSBjdXJyZW50SGVpZ2h0O1xuICAgICAgICAvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCBjb250ZW50IChubyBzY3JvbGwgeWV0KSBvciB3ZSdyZSBhbHJlYWR5IGF0IGJvdHRvbVxuICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCB8fCB0aGlzLmlzU2Nyb2xsZWRUb0JvdHRvbSgpKSB7XG4gICAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY2xlYW51cCgpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgdGhpcy5oYW5kbGVXaGVlbCk7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdGhpcy5oYW5kbGVUb3VjaFN0YXJ0KTtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5oYW5kbGVUb3VjaEVuZCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGludGVyZmFjZSBEcmF3ZXJPcHRpb25zIHtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgdGl0bGU6IHN0cmluZztcbiAgY2xzPzogc3RyaW5nO1xuICBvblZpc2liaWxpdHlDaGFuZ2U/OiAodmlzaWJsZTogYm9vbGVhbikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIERyYXdlckNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgZHJhd2VyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBoZWFkZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGNvbnRlbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHRvZ2dsZTogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgaXNNb3VzZUluUHJveGltaXR5ID0gZmFsc2U7XG4gIHByaXZhdGUgaGlkZVRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb3B0aW9uczogRHJhd2VyT3B0aW9ucztcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBEcmF3ZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuaW5pdGlhbGl6ZURyYXdlcigpO1xuICAgIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRHJhd2VyKCk6IHZvaWQge1xuICAgIHRoaXMuZHJhd2VyID0gdGhpcy5vcHRpb25zLmNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtZHJhd2VyICR7dGhpcy5vcHRpb25zLmNscyB8fCBcIlwifWAsXG4gICAgfSk7XG5cbiAgICB0aGlzLmhlYWRlciA9IHRoaXMuZHJhd2VyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWhlYWRlclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGl0bGVFbCA9IHRoaXMuaGVhZGVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLXRpdGxlXCIsXG4gICAgfSk7XG4gICAgdGl0bGVFbC5jcmVhdGVTcGFuKHsgdGV4dDogdGhpcy5vcHRpb25zLnRpdGxlIH0pO1xuXG4gICAgdGhpcy50b2dnbGUgPSB0aGlzLmhlYWRlci5jcmVhdGVTcGFuKHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLXRvZ2dsZVwiLFxuICAgICAgdGV4dDogXCJcdTI1QkNcIixcbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudCA9IHRoaXMuZHJhd2VyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNvbnRlbnRcIixcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0VmlzaWJpbGl0eShmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5kcmF3ZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSB0cnVlO1xuICAgICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgICB0aGlzLnNldFZpc2liaWxpdHkodHJ1ZSwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSB0cnVlO1xuICAgICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgICB0aGlzLnNldFZpc2liaWxpdHkodHJ1ZSwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmRyYXdlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgcmVjdCA9IHRoaXMuZHJhd2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgYnVmZmVyID0gMjU7XG5cbiAgICAgIGlmIChcbiAgICAgICAgZS5jbGllbnRZID49IHJlY3QuYm90dG9tICYmXG4gICAgICAgIGUuY2xpZW50WSA8PSByZWN0LmJvdHRvbSArIGJ1ZmZlciAmJlxuICAgICAgICBlLmNsaWVudFggPj0gcmVjdC5sZWZ0ICYmXG4gICAgICAgIGUuY2xpZW50WCA8PSByZWN0LnJpZ2h0XG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmlzTW91c2VJblByb3hpbWl0eSA9IGZhbHNlO1xuICAgICAgdGhpcy5zY2hlZHVsZUhpZGUoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgcmVjdCA9IHRoaXMuY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IDI1O1xuXG4gICAgICBpZiAoXG4gICAgICAgIGUuY2xpZW50WSA8PSByZWN0LnRvcCAmJlxuICAgICAgICBlLmNsaWVudFkgPj0gcmVjdC50b3AgLSBidWZmZXIgJiZcbiAgICAgICAgZS5jbGllbnRYID49IHJlY3QubGVmdCAmJlxuICAgICAgICBlLmNsaWVudFggPD0gcmVjdC5yaWdodFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NoZWR1bGVIaWRlKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFySGlkZVRpbWVvdXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGlkZVRpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmhpZGVUaW1lb3V0KTtcbiAgICAgIHRoaXMuaGlkZVRpbWVvdXQgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2NoZWR1bGVIaWRlKCk6IHZvaWQge1xuICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgIHRoaXMuaGlkZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkpIHtcbiAgICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCAxMDApO1xuICB9XG5cbiAgcHVibGljIHNldFZpc2liaWxpdHkodmlzaWJsZTogYm9vbGVhbiwgZXhwYW5kZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgIHRoaXMuY29udGVudC5zdHlsZS5vcGFjaXR5ID0gdmlzaWJsZSA/IFwiMVwiIDogXCIwXCI7XG4gICAgdGhpcy5jb250ZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSB2aXNpYmxlID8gXCJhbGxcIiA6IFwibm9uZVwiO1xuICAgIHRoaXMuY29udGVudC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgke3Zpc2libGUgPyBcIjBcIiA6IFwiLThweFwifSlgO1xuICAgIHRoaXMudG9nZ2xlLnN0eWxlLnRyYW5zZm9ybSA9IHZpc2libGUgPyBcInJvdGF0ZSgwKVwiIDogXCJyb3RhdGUoLTkwZGVnKVwiO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5vblZpc2liaWxpdHlDaGFuZ2UpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5vblZpc2liaWxpdHlDaGFuZ2UodmlzaWJsZSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldENvbnRlbnQoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0RHJhd2VyKCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5kcmF3ZXI7XG4gIH1cblxuICBwdWJsaWMgZ2V0SGVhZGVyKCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5oZWFkZXI7XG4gIH1cblxuICBvbnVubG9hZCgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFySGlkZVRpbWVvdXQoKTtcbiAgICBzdXBlci5vbnVubG9hZCgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgTWFya2Rvd25SZW5kZXJlciwgVEZpbGUsIEFwcCwgQ29tcG9uZW50LCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0Um9sZSwgSW1hZ2VDb250ZW50LCBNdWx0aVBhcnRDb250ZW50IH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAsIFRleHRBcmVhTW9kYWwgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VSZW5kZXJPcHRpb25zIHtcbiAgYXBwOiBBcHA7XG4gIG1lc3NhZ2VJZDogc3RyaW5nO1xuICByb2xlOiBDaGF0Um9sZTtcbiAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xufVxuXG5leHBvcnQgY2xhc3MgTWVzc2FnZVJlbmRlcmVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVuZGVyTWVzc2FnZSh7XG4gICAgYXBwLFxuICAgIG1lc3NhZ2VJZCxcbiAgICByb2xlLFxuICAgIGNvbnRlbnQsXG4gIH06IHtcbiAgICBhcHA6IEFwcDtcbiAgICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgICByb2xlOiBDaGF0Um9sZTtcbiAgICBjb250ZW50OiBzdHJpbmcgfCBNdWx0aVBhcnRDb250ZW50W107XG4gIH0pOiBQcm9taXNlPHsgbWVzc2FnZUVsOiBIVE1MRWxlbWVudDsgY29udGVudEVsOiBIVE1MRWxlbWVudCB9PiB7XG4gICAgY29uc3QgbWVzc2FnZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtZXNzYWdlRWwuY2xhc3NMaXN0LmFkZChcInN5c3RlbXNjdWxwdC1tZXNzYWdlXCIpO1xuICAgIG1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKGBzeXN0ZW1zY3VscHQtJHtyb2xlfS1tZXNzYWdlYCk7XG4gICAgbWVzc2FnZUVsLmRhdGFzZXQubWVzc2FnZUlkID0gbWVzc2FnZUlkO1xuXG4gICAgY29uc3QgY29udGVudEVsID0gbWVzc2FnZUVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIC8vIEV4aXN0aW5nIHBhdGg6IHRyZWF0IGl0IGFzIG1hcmtkb3duIHRleHRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oY29udGVudCwgY29udGVudEVsLCBcIlwiLCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudCBhcyBNdWx0aVBhcnRDb250ZW50W107XG4gICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHtcbiAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAvLyBTaW1wbGUgdGV4dCBzbmlwcGV0XG4gICAgICAgICAgY29uc3QgcCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcInBcIik7XG4gICAgICAgICAgcC5zZXRUZXh0KHBhcnQudGV4dCk7XG4gICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBcImltYWdlX3VybFwiKSB7XG4gICAgICAgICAgLy8gSW5zZXJ0IHRoZSA8aW1nPlxuICAgICAgICAgIGNvbnN0IGltZyA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImltZ1wiLCB7XG4gICAgICAgICAgICBhdHRyOiB7IHNyYzogcGFydC5pbWFnZV91cmwudXJsIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaW1nLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1pbWFnZVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjayBpZiBuZWVkZWRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgIFN0cmluZyhjb250ZW50KSxcbiAgICAgICAgY29udGVudEVsLFxuICAgICAgICBcIlwiLFxuICAgICAgICB0aGlzXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnNldHVwSW1hZ2VIYW5kbGVycyhjb250ZW50RWwpO1xuXG4gICAgcmV0dXJuIHsgbWVzc2FnZUVsLCBjb250ZW50RWwgfTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZW5kZXJNYXJrZG93bkNvbnRlbnQoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29uc3QgbWFya2Rvd25XcmFwcGVyID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tYXJrZG93bi13cmFwcGVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvXFxuezMsfS9nLCBcIlxcblxcblwiKTtcblxuICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICBub3JtYWxpemVkQ29udGVudCxcbiAgICAgIG1hcmtkb3duV3JhcHBlcixcbiAgICAgIFwiXCIsXG4gICAgICB0aGlzXG4gICAgKTtcblxuICAgIG1hcmtkb3duV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKFwicHJlXCIpLmZvckVhY2goKHByZUVsKSA9PiB7XG4gICAgICBjb25zdCBjb2RlQmxvY2tXcmFwcGVyID0gY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvZGUtYmxvY2std3JhcHBlclwiLFxuICAgICAgfSk7XG5cbiAgICAgIHByZUVsLnBhcmVudE5vZGU/LnJlcGxhY2VDaGlsZChjb2RlQmxvY2tXcmFwcGVyLCBwcmVFbCk7XG4gICAgICBjb2RlQmxvY2tXcmFwcGVyLmFwcGVuZENoaWxkKHByZUVsKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXR1cEltYWdlSGFuZGxlcnMoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29udGFpbmVyRWwucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKS5mb3JFYWNoKChpbWcpID0+IHtcbiAgICAgIGltZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGNvbnN0IHNyYyA9IGltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gICAgICAgIGlmICghc3JjKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHNyYy5zdGFydHNXaXRoKFwiYXBwOi8vXCIpKSB7XG4gICAgICAgICAgY29uc3QgcGF0aCA9IHNyYy5yZXBsYWNlKFwiYXBwOi8vbG9jYWwvXCIsIFwiXCIpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQocGF0aCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb29sYmFyVmlzaWJpbGl0eShcbiAgICB0b29sYmFyOiBIVE1MRWxlbWVudCxcbiAgICB2aXNpYmxlOiBib29sZWFuLFxuICAgIGV4cGFuZGVkOiBib29sZWFuID0gZmFsc2VcbiAgKTogdm9pZCB7XG4gICAgdG9vbGJhci5zdHlsZS5vcGFjaXR5ID0gdmlzaWJsZSA/IFwiMVwiIDogXCIwXCI7XG4gICAgdG9vbGJhci5zdHlsZS5wb2ludGVyRXZlbnRzID0gdmlzaWJsZSA/IFwiYWxsXCIgOiBcIm5vbmVcIjtcbiAgICB0b29sYmFyLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKGNhbGMoMTAwJSArICR7XG4gICAgICBleHBhbmRlZCA/IFwiNFwiIDogXCI4XCJcbiAgICB9cHgpKWA7XG4gIH1cblxuICBwdWJsaWMgYWRkTWVzc2FnZUJ1dHRvblRvb2xiYXIoXG4gICAgbWVzc2FnZUVsOiBIVE1MRWxlbWVudCxcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgcm9sZTogQ2hhdFJvbGUsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmdcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYnV0dG9uVG9vbGJhciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uLXRvb2xiYXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvcHlCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb3B5QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiQ29weSBtZXNzYWdlIHRvIGNsaXBib2FyZFwiKTtcbiAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICBjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb250ZW50KTtcbiAgICAgIHNldEljb24oY29weUJ1dHRvbiwgXCJjaGVja1wiKTtcbiAgICAgIGNvcHlCdXR0b24uY2xhc3NMaXN0LmFkZChcInN1Y2Nlc3NcIik7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICAgICAgY29weUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic3VjY2Vzc1wiKTtcbiAgICAgICAgdGhpcy5zZXRUb29sYmFyVmlzaWJpbGl0eShidXR0b25Ub29sYmFyLCBmYWxzZSk7XG4gICAgICB9LCAyMDAwKTtcbiAgICB9KTtcblxuICAgIGlmIChyb2xlID09PSBcInVzZXJcIikge1xuICAgICAgY29uc3QgcmVzdWJtaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlLWJ1dHRvblwiLFxuICAgICAgfSk7XG4gICAgICByZXN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlJlc3VibWl0IHRoaXMgbWVzc2FnZVwiKTtcbiAgICAgIHNldEljb24ocmVzdWJtaXRCdXR0b24sIFwicm90YXRlLWNjd1wiKTtcbiAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJyb3RhdGUtY2N3XCI7XG5cbiAgICAgIHJlc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBpc0NvbmZpcm1pbmcgPSByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPT09IFwidHJ1ZVwiO1xuXG4gICAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJ0cnVlXCI7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0P1wiIH0pO1xuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcblxuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZCA9IHRpbWVvdXRJZC50b1N0cmluZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHJlc3VibWl0QnV0dG9uLmRhdGFzZXQudGltZW91dElkO1xuICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0dGluZy4uLlwiIH0pO1xuXG4gICAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJyZXN1Ym1pdFwiLCB7XG4gICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQsIGNvbnRlbnQgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFuIFwiRWRpdFwiIGJ1dHRvblxuICAgIGNvbnN0IGVkaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBlZGl0QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRWRpdCB0aGlzIG1lc3NhZ2VcIik7XG4gICAgc2V0SWNvbihlZGl0QnV0dG9uLCBcInBlbmNpbFwiKTtcbiAgICBlZGl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJwZW5jaWxcIjtcblxuICAgIC8vIEhhbmRsZSBjbGljayBcdTIxOTIgb3BlbiBhbiBlZGl0aW5nIG1vZGFsXG4gICAgZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIFVzZSBleGlzdGluZyB0ZXh0LWFyZWEgbW9kYWwgZm9yIGVkaXRpbmdcbiAgICAgIC8vIEdldCBjdXJyZW50IGNvbnRlbnQgZnJvbSBkYXRhc2V0IHdoaWNoIGlzIGFsd2F5cyB1cC10by1kYXRlXG4gICAgICBjb25zdCBjdXJyZW50Q29udGVudCA9IG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgfHwgY29udGVudDtcbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IFRleHRBcmVhTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkVkaXQgTWVzc2FnZVwiLFxuICAgICAgICBjdXJyZW50Q29udGVudCxcbiAgICAgICAge1xuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiU2F2ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICByb3dzOiAxMCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgbmV3VGV4dCA9IGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xuICAgICAgaWYgKG5ld1RleHQgIT09IG51bGwgJiYgbmV3VGV4dCAhPT0gY3VycmVudENvbnRlbnQpIHtcbiAgICAgICAgLy8gRGlzcGF0Y2ggZWRpdCBldmVudCB3aXRoIG9sZCBhbmQgbmV3IGNvbnRlbnRcbiAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KFwiZWRpdFwiLCB7XG4gICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgZGV0YWlsOiB7XG4gICAgICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICAgICAgb2xkQ29udGVudDogY3VycmVudENvbnRlbnQsXG4gICAgICAgICAgICAgIG5ld0NvbnRlbnQ6IG5ld1RleHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZWxldGVCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b24gZGFuZ2VyXCIsXG4gICAgfSk7XG4gICAgZGVsZXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRGVsZXRlIHRoaXMgbWVzc2FnZVwiKTtcbiAgICBzZXRJY29uKGRlbGV0ZUJ1dHRvbiwgXCJ0cmFzaFwiKTtcbiAgICBkZWxldGVCdXR0b24uZGF0YXNldC5vcmlnaW5hbEljb24gPSBcInRyYXNoXCI7XG5cbiAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgaXNDb25maXJtaW5nID0gZGVsZXRlQnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9PT0gXCJ0cnVlXCI7XG5cbiAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcInRydWVcIjtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmVtcHR5KCk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIkRlbGV0ZT9cIiB9KTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIpO1xuXG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDMwMDApO1xuICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC50aW1lb3V0SWQgPSB0aW1lb3V0SWQudG9TdHJpbmcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZDtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGVCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNyZWF0ZUVsKFwic3BhblwiLCB7IHRleHQ6IFwiRGVsZXRpbmcuLi5cIiB9KTtcblxuICAgICAgICBtZXNzYWdlRWwuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJkZWxldGVcIiwge1xuICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQgfSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgdHJ1ZSwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgIWUucmVsYXRlZFRhcmdldCB8fFxuICAgICAgICAhYnV0dG9uVG9vbGJhci5jb250YWlucyhlLnJlbGF0ZWRUYXJnZXQgYXMgTm9kZSlcbiAgICAgICkge1xuICAgICAgICB0aGlzLnNldFRvb2xiYXJWaXNpYmlsaXR5KGJ1dHRvblRvb2xiYXIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGJ1dHRvblRvb2xiYXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFtZXNzYWdlRWwuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0IGFzIE5vZGUpKSB7XG4gICAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVJlYXNvbmluZ0NvbnRhaW5lcihtZXNzYWdlRWw6IEhUTUxFbGVtZW50KToge1xuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgY29udGVudDogSFRNTEVsZW1lbnQ7XG4gIH0ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1oZWFkZXJcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGhlYWRlciwgXCJicmFpblwiKTtcbiAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiUmVhc29uaW5nXCIgfSk7XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlciB0byB0b2dnbGUgY29sbGFwc2VcbiAgICBoZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKFwiY29sbGFwc2VkXCIpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBjb250YWluZXIsIGNvbnRlbnQgfTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVSZWFzb25pbmdDb250ZW50KFxuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQsXG4gICAgcmVhc29uaW5nOiBzdHJpbmcsXG4gICAgaXNDb21wbGV0ZTogYm9vbGVhbiA9IGZhbHNlXG4gICk6IHZvaWQge1xuICAgIGxldCBjb250YWluZXIgPSBtZXNzYWdlRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGFpbmVyXCJcbiAgICApO1xuICAgIGxldCBjb250ZW50ID0gbWVzc2FnZUVsLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIpO1xuXG4gICAgaWYgKCFjb250YWluZXIgfHwgIWNvbnRlbnQpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5jcmVhdGVSZWFzb25pbmdDb250YWluZXIobWVzc2FnZUVsKTtcbiAgICAgIGNvbnRhaW5lciA9IGVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgICAgIGNvbnRlbnQgPSBlbGVtZW50cy5jb250ZW50O1xuICAgICAgbWVzc2FnZUVsLnByZXBlbmQoY29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBjb250ZW50LnRleHRDb250ZW50ID0gcmVhc29uaW5nO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcblxuICAgIC8vIEF1dG8tY29sbGFwc2Ugd2hlbiBzdHJlYW1pbmcgaXMgY29tcGxldGVcbiAgICBpZiAoaXNDb21wbGV0ZSkge1xuICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJjb2xsYXBzZWRcIik7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgc2V0SWNvbiwgQ29tcG9uZW50LCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBTeXN0ZW1Qcm9tcHRJbmZvIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IEVSUk9SX0NPREVTLCBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuLi8uLi91dGlscy9lcnJvcnNcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSB9IGZyb20gXCIuLi8uLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBJbWFnZVByb2Nlc3NvciB9IGZyb20gXCIuLi8uLi91dGlscy9JbWFnZVByb2Nlc3NvclwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB7IE1lc3NhZ2VSZW5kZXJlciB9IGZyb20gXCIuL01lc3NhZ2VSZW5kZXJlclwiO1xuaW1wb3J0IHsgUmVjb3JkZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1JlY29yZGVyU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBUb2tlbkNvdW50ZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1Rva2VuQ291bnRlclNlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbnB1dEhhbmRsZXJPcHRpb25zIHtcbiAgYXBwOiBBcHA7XG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgZ2V0TWVzc2FnZXM6ICgpID0+IENoYXRNZXNzYWdlW107XG4gIGdldFNlbGVjdGVkTW9kZWxJZDogKCkgPT4gc3RyaW5nO1xuICBnZXRDb250ZXh0RmlsZXM6ICgpID0+IFNldDxzdHJpbmc+O1xuICBnZXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IFN5c3RlbVByb21wdEluZm87XG4gIGNoYXRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBzY3JvbGxNYW5hZ2VyOiBTY3JvbGxNYW5hZ2VyU2VydmljZTtcbiAgbWVzc2FnZVJlbmRlcmVyOiBNZXNzYWdlUmVuZGVyZXI7XG4gIG9uTWVzc2FnZVN1Ym1pdDogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkFzc2lzdGFudFJlc3BvbnNlOiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIG9uQ29udGV4dEZpbGVBZGQ6ICh3aWtpbGluazogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkVycm9yOiAoZXJyb3I6IHN0cmluZyB8IFN5c3RlbVNjdWxwdEVycm9yKSA9PiB2b2lkO1xuICBvbkFkZENvbnRleHRGaWxlOiAoKSA9PiB2b2lkO1xuICBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHZvaWQ7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBjaGF0VmlldzogYW55O1xufVxuXG5leHBvcnQgY2xhc3MgSW5wdXRIYW5kbGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBnZXRNZXNzYWdlczogKCkgPT4gQ2hhdE1lc3NhZ2VbXTtcbiAgcHJpdmF0ZSBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHN0cmluZztcbiAgcHJpdmF0ZSBnZXRDb250ZXh0RmlsZXM6ICgpID0+IFNldDxzdHJpbmc+O1xuICBwcml2YXRlIGdldFN5c3RlbVByb21wdDogKCkgPT4gU3lzdGVtUHJvbXB0SW5mbztcbiAgcHJpdmF0ZSBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBzY3JvbGxNYW5hZ2VyOiBTY3JvbGxNYW5hZ2VyU2VydmljZTtcbiAgcHJpdmF0ZSBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgcHJpdmF0ZSBvbk1lc3NhZ2VTdWJtaXQ6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgcHJpdmF0ZSBvbkFzc2lzdGFudFJlc3BvbnNlOiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgb25Db250ZXh0RmlsZUFkZDogKHdpa2lsaW5rOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgb25FcnJvcjogKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcikgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvbkFkZENvbnRleHRGaWxlOiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBpbnB1dDogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBpc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSByZW5kZXJUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlY29yZGVyU2VydmljZTogUmVjb3JkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGlucHV0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBidXR0b25HcmlkOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSByZWNvcmRlclZpc3VhbGl6ZXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSB1cGRhdGVHZW5lcmF0aW5nU3RhdGU6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgYWJvcnRDb250cm9sbGVyOiBBYm9ydENvbnRyb2xsZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzdG9wQnV0dG9uOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHRva2VuQ291bnRlcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgdG9rZW5Db3VudGVyU2VydmljZTogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50VGltZW91dDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBjaGF0VmlldzogYW55O1xuICBwcml2YXRlIHdlYlNlYXJjaEVuYWJsZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBJbnB1dEhhbmRsZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmFwcCA9IG9wdGlvbnMuYXBwO1xuICAgIHRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XG4gICAgdGhpcy5haVNlcnZpY2UgPSBvcHRpb25zLmFpU2VydmljZTtcbiAgICB0aGlzLmdldE1lc3NhZ2VzID0gb3B0aW9ucy5nZXRNZXNzYWdlcztcbiAgICB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCA9IG9wdGlvbnMuZ2V0U2VsZWN0ZWRNb2RlbElkO1xuICAgIHRoaXMuZ2V0Q29udGV4dEZpbGVzID0gb3B0aW9ucy5nZXRDb250ZXh0RmlsZXM7XG4gICAgdGhpcy5nZXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLmdldFN5c3RlbVByb21wdDtcbiAgICB0aGlzLmNoYXRDb250YWluZXIgPSBvcHRpb25zLmNoYXRDb250YWluZXI7XG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyID0gb3B0aW9ucy5zY3JvbGxNYW5hZ2VyO1xuICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyID0gb3B0aW9ucy5tZXNzYWdlUmVuZGVyZXI7XG4gICAgdGhpcy5vbk1lc3NhZ2VTdWJtaXQgPSBvcHRpb25zLm9uTWVzc2FnZVN1Ym1pdDtcbiAgICB0aGlzLm9uQXNzaXN0YW50UmVzcG9uc2UgPSBvcHRpb25zLm9uQXNzaXN0YW50UmVzcG9uc2U7XG4gICAgdGhpcy5vbkNvbnRleHRGaWxlQWRkID0gb3B0aW9ucy5vbkNvbnRleHRGaWxlQWRkO1xuICAgIHRoaXMub25FcnJvciA9IG9wdGlvbnMub25FcnJvcjtcbiAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUgPSBvcHRpb25zLm9uQWRkQ29udGV4dEZpbGU7XG4gICAgdGhpcy5vbkVkaXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLm9uRWRpdFN5c3RlbVByb21wdDtcbiAgICB0aGlzLnBsdWdpbiA9IG9wdGlvbnMucGx1Z2luO1xuICAgIHRoaXMuY2hhdFZpZXcgPSBvcHRpb25zLmNoYXRWaWV3O1xuXG4gICAgY29uc29sZS5sb2coXCJJbml0aWFsaXppbmcgSW5wdXRIYW5kbGVyIHdpdGggUmVjb3JkZXJTZXJ2aWNlXCIpO1xuICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlID0gUmVjb3JkZXJTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwge1xuICAgICAgaXNJbkNoYXQ6IHRydWUsXG4gICAgICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlY2VpdmVkIHRyYW5zY3JpcHRpb24sIGluc2VydGluZyBhdCBjdXJzb3IgcG9zaXRpb25cIik7XG4gICAgICAgIHRoaXMuaW5zZXJ0VGV4dEF0Q3Vyc29yKHRleHQpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdyYXAgdGhlIG1lc3NhZ2UgaGFuZGxlcnMgdG8gaW5jbHVkZSB0b2tlbiBjb3VudGluZ1xuICAgIGNvbnN0IG9yaWdpbmFsTWVzc2FnZVN1Ym1pdCA9IG9wdGlvbnMub25NZXNzYWdlU3VibWl0O1xuICAgIHRoaXMub25NZXNzYWdlU3VibWl0ID0gYXN5bmMgKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiB7XG4gICAgICBhd2FpdCBvcmlnaW5hbE1lc3NhZ2VTdWJtaXQobWVzc2FnZSk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb3JpZ2luYWxBc3Npc3RhbnRSZXNwb25zZSA9IG9wdGlvbnMub25Bc3Npc3RhbnRSZXNwb25zZTtcbiAgICB0aGlzLm9uQXNzaXN0YW50UmVzcG9uc2UgPSBhc3luYyAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IHtcbiAgICAgIGF3YWl0IG9yaWdpbmFsQXNzaXN0YW50UmVzcG9uc2UobWVzc2FnZSk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9O1xuXG4gICAgdGhpcy50b2tlbkNvdW50ZXJTZXJ2aWNlID0gVG9rZW5Db3VudGVyU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5zZXRBcHAodGhpcy5hcHApO1xuXG4gICAgdGhpcy5zZXR1cElucHV0KCk7XG5cbiAgICAvLyBJbml0aWFsIHRva2VuIGNvdW50IGFmdGVyIHNldHVwXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIlJ1bm5pbmcgaW5pdGlhbCB0b2tlbiBjb3VudFwiKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ3VycmVudCBtZXNzYWdlczpcIiwgdGhpcy5nZXRNZXNzYWdlcygpLmxlbmd0aCk7XG4gICAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9LCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cElucHV0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5idXR0b25HcmlkID0gdGhpcy5pbnB1dENvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1ncmlkXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdHRhY2hCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkFkZCBhdHRhY2htZW50XCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKGF0dGFjaEJ1dHRvbiwgXCJwYXBlcmNsaXBcIik7XG4gICAgYXR0YWNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgLy8gU0hJRlQtY2xpY2sgPT4gZGlyZWN0IHVwbG9hZCB0byBzZXJ2ZXJcbiAgICAgICAgdGhpcy5oYW5kbGVEb2N1bWVudFVwbG9hZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciBjbGljayA9PiBhZGQgY29udGV4dCBmaWxlIGFzIGJlZm9yZVxuICAgICAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHNldHRpbmdzQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJTeXN0ZW0gcHJvbXB0IHNldHRpbmdzXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKHNldHRpbmdzQnV0dG9uLCBcInNldHRpbmdzXCIpO1xuICAgIHNldHRpbmdzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uRWRpdFN5c3RlbVByb21wdCgpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgd2ViU2VhcmNoQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJUb2dnbGUgd2ViIHNlYXJjaFwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbih3ZWJTZWFyY2hCdXR0b24sIFwiZ2xvYmVcIik7XG4gICAgd2ViU2VhcmNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLndlYlNlYXJjaEVuYWJsZWQgPSAhdGhpcy53ZWJTZWFyY2hFbmFibGVkO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpcy1lbmFibGVkXCIsIHRoaXMud2ViU2VhcmNoRW5hYmxlZCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBtaWNCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1taWMtYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIlJlY29yZCBhdWRpbyBtZXNzYWdlXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKG1pY0J1dHRvbiwgXCJtaWNcIik7XG4gICAgbWljQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhhbmRsZU1pY0NsaWNrLmJpbmQodGhpcykpO1xuXG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b24gc3lzdGVtc2N1bHB0LXNlbmQtYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIlNlbmQgbWVzc2FnZVwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihzZW5kQnV0dG9uLCBcInNlbmRcIik7XG4gICAgc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVTZW5kTWVzc2FnZS5iaW5kKHRoaXMpKTtcblxuICAgIC8vIENyZWF0ZSBzdG9wIGJ1dHRvbiAoaGlkZGVuIGJ5IGRlZmF1bHQpXG4gICAgdGhpcy5zdG9wQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvbiBzeXN0ZW1zY3VscHQtc3RvcC1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiU3RvcCBnZW5lcmF0aW9uXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKHRoaXMuc3RvcEJ1dHRvbiwgXCJzcXVhcmVcIik7XG4gICAgdGhpcy5zdG9wQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB0aGlzLnN0b3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgIFwiY2xpY2tcIixcbiAgICAgIHRoaXMuaGFuZGxlU3RvcEdlbmVyYXRpb24uYmluZCh0aGlzKVxuICAgICk7XG5cbiAgICB0aGlzLmlucHV0ID0gdGhpcy5pbnB1dENvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQgc3lzdGVtc2N1bHB0LWNoYXQtaW5wdXRcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcm93czogXCIxXCIsXG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlR5cGUgYSBtZXNzYWdlLi4uXCIsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRva2VuIGNvdW50ZXIgZWxlbWVudFxuICAgIHRoaXMudG9rZW5Db3VudGVyID0gdGhpcy5pbnB1dENvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWNvdW50ZXJcIixcbiAgICAgIHRleHQ6IFwiMCB0b2tlbnNcIixcbiAgICB9KTtcblxuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcykpO1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHRoaXMuYWRqdXN0SW5wdXRIZWlnaHQuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwicGFzdGVcIiwgdGhpcy5oYW5kbGVQYXN0ZS5iaW5kKHRoaXMpKTtcblxuICAgIC8vIFNpbXBsaWZpZWQgcmVjb3JkZXIgaGFuZGxpbmdcbiAgICB0aGlzLnJlY29yZGVyU2VydmljZS5vblRvZ2dsZSgoaXNSZWNvcmRpbmcpID0+IHtcbiAgICAgIHRoaXMuaXNSZWNvcmRpbmcgPSBpc1JlY29yZGluZztcbiAgICAgIGNvbnN0IG1pY0J1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIi5zeXN0ZW1zY3VscHQtbWljLWJ1dHRvblwiXG4gICAgICApO1xuICAgICAgaWYgKG1pY0J1dHRvbikge1xuICAgICAgICBtaWNCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBpc1JlY29yZGluZyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBVcGRhdGUgVUkgd2hlbiBnZW5lcmF0aW5nIHN0YXRlIGNoYW5nZXNcbiAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSA9ICgpID0+IHtcbiAgICAgIHRoaXMuaW5wdXQuZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIHNlbmRCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIG1pY0J1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgYXR0YWNoQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBzZXR0aW5nc0J1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG5cbiAgICAgIGlmICh0aGlzLnN0b3BCdXR0b24pIHtcbiAgICAgICAgdGhpcy5zdG9wQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmlzR2VuZXJhdGluZyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgICAgIHNlbmRCdXR0b24uc3R5bGUuZGlzcGxheSA9IHRoaXMuaXNHZW5lcmF0aW5nID8gXCJub25lXCIgOiBcImZsZXhcIjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuaXNHZW5lcmF0aW5nXG4gICAgICAgID8gXCJXYWl0aW5nIGZvciByZXNwb25zZS4uLlwiXG4gICAgICAgIDogXCJUeXBlIGEgbWVzc2FnZS4uLlwiO1xuXG4gICAgICAvLyBUb2dnbGUgZGlzYWJsZWQgY2xhc3Nlc1xuICAgICAgdGhpcy5pbnB1dC5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgc2VuZEJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgbWljQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICBhdHRhY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIHNldHRpbmdzQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICB3ZWJTZWFyY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICB9O1xuXG4gICAgLy8gQWRkIGlucHV0IGV2ZW50IGxpc3RlbmVyIGZvciB0b2tlbiBjb3VudGluZ1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIHRoaXMuYWRqdXN0SW5wdXRIZWlnaHQoKTtcbiAgICAgIC8vIERlYm91bmNlIHRva2VuIGNvdW50aW5nIHRvIGF2b2lkIGV4Y2Vzc2l2ZSBmaWxlIHJlYWRzXG4gICAgICBpZiAodGhpcy50b2tlbkNvdW50VGltZW91dCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50b2tlbkNvdW50VGltZW91dCk7XG4gICAgICB9XG4gICAgICB0aGlzLnRva2VuQ291bnRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlVG9rZW5Db3VudCgpLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgICAgfSwgMzAwKTtcbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWwgdG9rZW4gY291bnRcbiAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU3RvcEdlbmVyYXRpb24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuYWJvcnRDb250cm9sbGVyKSB7XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMudXBkYXRlR2VuZXJhdGluZ1N0YXRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTZW5kTWVzc2FnZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250ZW50ID0gdGhpcy5pbnB1dC52YWx1ZS50cmltKCk7XG4gICAgaWYgKCFjb250ZW50IHx8IHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG5cbiAgICAvLyBDaGVjayB0b2tlbiBsaW1pdCBiZWZvcmUgcHJvY2VlZGluZ1xuICAgIGNvbnN0IHRva2VuTGltaXQgPSB0aGlzLmNoYXRWaWV3LmdldFRva2VuTGltaXQ/LigpO1xuICAgIGlmICh0b2tlbkxpbWl0KSB7XG4gICAgICBjb25zdCB0ZXh0ID0gdGhpcy5pbnB1dC52YWx1ZTtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gdGhpcy5nZXRNZXNzYWdlcygpO1xuICAgICAgY29uc3QgaW5wdXRUb2tlbnMgPSB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuYXBwcm94aW1hdGVUb2tlbkNvdW50KHRleHQpO1xuICAgICAgbGV0IGhpc3RvcnlUb2tlbnMgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9XG4gICAgICAgICAgdHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgPyBtZXNzYWdlLmNvbnRlbnRcbiAgICAgICAgICAgIDogSlNPTi5zdHJpbmdpZnkobWVzc2FnZS5jb250ZW50KTtcbiAgICAgICAgaGlzdG9yeVRva2VucyArPVxuICAgICAgICAgIHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG4gICAgICAgIGhpc3RvcnlUb2tlbnMgKz0gNDsgLy8gb3ZlcmhlYWRcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG90YWxUb2tlbnMgPSBpbnB1dFRva2VucyArIGhpc3RvcnlUb2tlbnM7XG4gICAgICBpZiAodG90YWxUb2tlbnMgPiB0b2tlbkxpbWl0KSB7XG4gICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICBgQ2Fubm90IHNlbmQgbWVzc2FnZTogVG9rZW4gbGltaXQgb2YgJHt0b2tlbkxpbWl0LnRvTG9jYWxlU3RyaW5nKCl9IGV4Y2VlZGVkYCxcbiAgICAgICAgICBcImVycm9yXCJcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSBcIlwiO1xuICAgIHRoaXMuYWRqdXN0SW5wdXRIZWlnaHQoKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgdXNlciBtZXNzYWdlXG4gICAgICBjb25zdCB1c2VyTWVzc2FnZUlkID0gdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpO1xuICAgICAgY29uc3QgdXNlck1lc3NhZ2U6IENoYXRNZXNzYWdlID0ge1xuICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgY29udGVudCxcbiAgICAgICAgbWVzc2FnZV9pZDogdXNlck1lc3NhZ2VJZCxcbiAgICAgIH07XG5cbiAgICAgIC8vIE1vZGlmeSB0aGUgbW9kZWwgSUQgaWYgd2ViIHNlYXJjaCBpcyBlbmFibGVkXG4gICAgICBjb25zdCBtb2RlbElkID0gdGhpcy53ZWJTZWFyY2hFbmFibGVkXG4gICAgICAgID8gYCR7dGhpcy5nZXRTZWxlY3RlZE1vZGVsSWQoKX06b25saW5lYFxuICAgICAgICA6IHRoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkKCk7XG5cbiAgICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2UgYW5kIHByZXBhcmUgZm9yIGFzc2lzdGFudCByZXNwb25zZVxuICAgICAgYXdhaXQgdGhpcy5vbk1lc3NhZ2VTdWJtaXQodXNlck1lc3NhZ2UpO1xuXG4gICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgIC8vIFByZXBhcmUgYXNzaXN0YW50IG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICBjb25zdCB7IG1lc3NhZ2VFbCwgY29udGVudEVsIH0gPSB0aGlzLmNyZWF0ZUFzc2lzdGFudE1lc3NhZ2VDb250YWluZXIoKTtcbiAgICAgIG1lc3NhZ2VFbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLW1lc3NhZ2UtaWRcIiwgdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpKTtcbiAgICAgIG1lc3NhZ2VFbC5hcHBlbmRDaGlsZChjb250ZW50RWwpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHJlc3BvbnNlIGhhbmRsaW5nXG4gICAgICBsZXQgZnVsbFJlc3BvbnNlID0gXCJcIjtcbiAgICAgIGxldCBhY2N1bXVsYXRlZFJlYXNvbmluZyA9IFwiXCI7XG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuXG4gICAgICBjb25zdCBsb2FkaW5nRWwgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJzcGFuXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIsXG4gICAgICAgIHRleHQ6IFwiIFx1MjVDRiBUaGlua2luZy4uLlwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCB0byBET00gYW5kIHNjcm9sbFxuICAgICAgdGhpcy5jaGF0Q29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VFbCk7XG4gICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgYWJvcnQgY29udHJvbGxlciBmb3IgdGhpcyByZXF1ZXN0XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcblxuICAgICAgLy8gR2V0IHN5c3RlbSBwcm9tcHQgaW5mb1xuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gdGhpcy5nZXRTeXN0ZW1Qcm9tcHQoKTtcblxuICAgICAgLy8gU3RyZWFtIHRoZSByZXNwb25zZVxuICAgICAgdHJ5IHtcbiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiB0aGlzLmFpU2VydmljZS5zdHJlYW1NZXNzYWdlKHtcbiAgICAgICAgICBtZXNzYWdlczogdGhpcy5nZXRNZXNzYWdlcygpLFxuICAgICAgICAgIG1vZGVsOiBtb2RlbElkLFxuICAgICAgICAgIGNvbnRleHRGaWxlczogdGhpcy5nZXRDb250ZXh0RmlsZXMoKSxcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlOiBzeXN0ZW1Qcm9tcHQudHlwZSxcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoOiBzeXN0ZW1Qcm9tcHQucGF0aCxcbiAgICAgICAgICBzaWduYWw6IHRoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbCxcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICBpZiAoIWZ1bGxSZXNwb25zZSkge1xuICAgICAgICAgICAgbG9hZGluZ0VsLnRleHRDb250ZW50ID0gXCIgXHUyNUNGIEdlbmVyYXRpbmcuLi5cIjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBIYW5kbGUgY29udGVudCBhbmQgcmVhc29uaW5nIGNodW5rc1xuICAgICAgICAgIGlmIChjaHVuay5jb250ZW50KSB7XG4gICAgICAgICAgICBmdWxsUmVzcG9uc2UgKz0gY2h1bmsuY29udGVudDtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2NoZWR1bGVSZW5kZXIoZnVsbFJlc3BvbnNlLCBjb250ZW50RWwpO1xuICAgICAgICAgICAgY29udGVudEVsLmFwcGVuZENoaWxkKGxvYWRpbmdFbCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNodW5rLnJlYXNvbmluZykge1xuICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmcgKz0gY2h1bmsucmVhc29uaW5nO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIudXBkYXRlUmVhc29uaW5nQ29udGVudChcbiAgICAgICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgICAgICBhY2N1bXVsYXRlZFJlYXNvbmluZ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBFbnN1cmUgcHJvcGVyIHNjcm9sbCBhZnRlciBlYWNoIGNodW5rXG4gICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsaXplIGFzc2lzdGFudCByZXNwb25zZVxuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGxvYWRpbmdFbC5yZW1vdmUoKTtcblxuICAgICAgICAvLyBVcGRhdGUgcmVhc29uaW5nIG9uZSBmaW5hbCB0aW1lIHdpdGggaXNDb21wbGV0ZT10cnVlIHRvIHRyaWdnZXIgYXV0by1jb2xsYXBzZVxuICAgICAgICBpZiAoYWNjdW11bGF0ZWRSZWFzb25pbmcpIHtcbiAgICAgICAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlci51cGRhdGVSZWFzb25pbmdDb250ZW50KFxuICAgICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmcsXG4gICAgICAgICAgICB0cnVlIC8vIE1hcmsgYXMgY29tcGxldGUgdG8gdHJpZ2dlciBhdXRvLWNvbGxhcHNlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFzc2lzdGFudE1lc3NhZ2U6IENoYXRNZXNzYWdlID0ge1xuICAgICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgICAgY29udGVudDogZnVsbFJlc3BvbnNlLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6XG4gICAgICAgICAgICBtZXNzYWdlRWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1tZXNzYWdlLWlkXCIpIHx8XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlTWVzc2FnZUlkKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgYXdhaXQgdGhpcy5vbkFzc2lzdGFudFJlc3BvbnNlKGFzc2lzdGFudE1lc3NhZ2UpO1xuXG4gICAgICAgIC8vIEFkZCBtZXNzYWdlIHRvb2xiYXIgYWZ0ZXIgcmVzcG9uc2UgaXMgY29tcGxldGVcbiAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIuYWRkTWVzc2FnZUJ1dHRvblRvb2xiYXIoXG4gICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgIGZ1bGxSZXNwb25zZSxcbiAgICAgICAgICBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIGFzc2lzdGFudE1lc3NhZ2UubWVzc2FnZV9pZFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEZpbmFsIHNjcm9sbCB0byBib3R0b20gYWZ0ZXIgdG9vbGJhciBpcyBhZGRlZFxuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcblxuICAgICAgICAvLyBIYW5kbGUgbWVzc2FnZSB0b29sYmFyIGV2ZW50c1xuICAgICAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImRlbGV0ZVwiLCBhc3luYyAoZTogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgICAgICBjb25zdCB7IG1lc3NhZ2VJZCB9ID0gZS5kZXRhaWw7XG4gICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLmdldE1lc3NhZ2VzKCk7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBtZXNzYWdlcy5maW5kSW5kZXgoXG4gICAgICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBtZXNzYWdlRWwucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGxvYWRpbmdFbC5yZW1vdmUoKTtcbiAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuXG4gICAgICAgIC8vIExvZyBhbGwgZXJyb3JzIHRvIGNvbnNvbGUgZmlyc3RcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNoYXQgbWVzc2FnZSBlcnJvcjpcIiwge1xuICAgICAgICAgIGVycm9yLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZW1vdmUgZXJyb3IgZmlsdGVyaW5nIC0gYWx3YXlzIHNob3cgZXJyb3JzXG4gICAgICAgIHRoaXMub25FcnJvcihlcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMudXBkYXRlR2VuZXJhdGluZ1N0YXRlKCk7XG4gICAgICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIGl0J3MgcmUtZW5hYmxlZFxuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIExvZyBvdXRlciBlcnJvciBhcyB3ZWxsXG4gICAgICBjb25zb2xlLmVycm9yKFwiT3V0ZXIgbWVzc2FnZSBoYW5kbGluZyBlcnJvcjpcIiwge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuICAgICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgaXQncyByZS1lbmFibGVkXG4gICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB0aGlzLm9uRXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlTWljQ2xpY2soKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG4gICAgdGhpcy50b2dnbGVSZWNvcmRpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdG9nZ2xlUmVjb3JkaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucmVjb3JkZXJTZXJ2aWNlLnRvZ2dsZVJlY29yZGluZygpO1xuICAgIC8vIEtlZXAgZm9jdXMvY3Vyc29yIGluIGNoYXRcbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVBhc3RlKGU6IENsaXBib2FyZEV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZHQgPSBlLmNsaXBib2FyZERhdGE7XG4gICAgaWYgKCFkdCkgcmV0dXJuO1xuXG4gICAgLy8gUmV0cmlldmUgYW55IHBsYWluIHRleHRcbiAgICBjb25zdCBwYXN0ZWRUZXh0ID0gZHQuZ2V0RGF0YShcInRleHQvcGxhaW5cIikgPz8gXCJcIjtcblxuICAgIC8vIFJldHJpZXZlIGZpbGVzXG4gICAgY29uc3QgYWxsRmlsZXMgPSBBcnJheS5mcm9tKGR0LmZpbGVzKTtcblxuICAgIC8vIElmIHdlIGhhdmUgbm8gZmlsZXMgYnV0IGRvIGhhdmUgdGV4dCwgbGV0IHRoZSBub3JtYWwgcGFzdGUgaGFwcGVuXG4gICAgaWYgKCFhbGxGaWxlcy5sZW5ndGggJiYgcGFzdGVkVGV4dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHdlIGhhdmUgZmlsZXMgKGFuZCBwb3NzaWJseSBhbHNvIHRleHQpLCBwcmV2ZW50IGRlZmF1bHQgc28gd2UgY2FuIGhhbmRsZSB0aGVtXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgaWYgKCFhbGxGaWxlcy5sZW5ndGgpIHtcbiAgICAgIC8vIElmIG5vIGZpbGVzIGF0IGFsbCwgYnV0IGNvZGUgaGFzIG5vdCByZXR1cm5lZCB5ZXQsIGl0IG1lYW5zIHRoZXJlJ3Mgbm8gdGV4dCBlaXRoZXJcbiAgICAgIC8vIEp1c3QgcmV0dXJuIHNvIHdlIGRvbid0IGJyZWFrIGRlZmF1bHQgYmVoYXZpb3IgaW4gYSBjb3JuZXIgY2FzZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgYWxsIGZpbGVzIGluIHRoZSBjbGlwYm9hcmRcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgYWxsRmlsZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIERlcml2ZSBleHRlbnNpb24gZnJvbSBmaWxlbmFtZSBvciBNSU1FIHR5cGVcbiAgICAgICAgbGV0IGV4dGVuc2lvbiA9IFwiYmluXCI7XG4gICAgICAgIGlmIChmaWxlLm5hbWUgJiYgZmlsZS5uYW1lLmluY2x1ZGVzKFwiLlwiKSkge1xuICAgICAgICAgIGNvbnN0IGRvdElkeCA9IGZpbGUubmFtZS5sYXN0SW5kZXhPZihcIi5cIik7XG4gICAgICAgICAgaWYgKGRvdElkeCA+PSAwKSB7XG4gICAgICAgICAgICBleHRlbnNpb24gPSBmaWxlLm5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZpbGUudHlwZSkge1xuICAgICAgICAgIGNvbnN0IG1pbWVQYXJ0cyA9IGZpbGUudHlwZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgaWYgKG1pbWVQYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgIGV4dGVuc2lvbiA9IG1pbWVQYXJ0c1sxXS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XS9nLCBcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCdWlsZCBhIHRpbWVzdGFtcC1iYXNlZCBmaWxlIG5hbWVcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaXNvU3RyaW5nID0gbm93LnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvWzouXS9nLCBcIi1cIik7XG4gICAgICAgIGNvbnN0IG5ld0ZpbGVOYW1lID0gYHBhc3RlZC0ke2lzb1N0cmluZ30uJHtleHRlbnNpb259YDtcblxuICAgICAgICAvLyBSZWFkIHRoZSBjbGlwYm9hcmQgZmlsZSBhcyBiaW5hcnlcbiAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIGF0dGFjaG1lbnRzIHBhdGggZnJvbSBwbHVnaW4gc2V0dGluZ3NcbiAgICAgICAgY29uc3QgYXR0YWNobWVudHNEaXIgPVxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF0dGFjaG1lbnRzRGlyZWN0b3J5IHx8IFwiQXR0YWNobWVudHNcIjtcbiAgICAgICAgY29uc3QgZmluYWxQYXRoID0gYCR7YXR0YWNobWVudHNEaXJ9LyR7bmV3RmlsZU5hbWV9YDtcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVEaXJlY3RvcnlFeGlzdHMoYXR0YWNobWVudHNEaXIpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZmlsZSBpbiB0aGUgdmF1bHRcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlQmluYXJ5KGZpbmFsUGF0aCwgYXJyYXlCdWZmZXIpO1xuXG4gICAgICAgIC8vIEF0dGVtcHQgdG8gbG9hZCB0aGUgbmV3bHkgY3JlYXRlZCBmaWxlXG4gICAgICAgIGNvbnN0IGNyZWF0ZWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbmFsUGF0aCk7XG4gICAgICAgIGlmIChjcmVhdGVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgLy8gQWRkIHRvIHRoaXMgY2hhdCdzIGNvbnRleHRcbiAgICAgICAgICBhd2FpdCB0aGlzLmNoYXRWaWV3LmFkZEZpbGVUb0NvbnRleHQoY3JlYXRlZEZpbGUpO1xuICAgICAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgICAgICBgUGFzdGVkIGZpbGUgc2F2ZWQgJiBhZGRlZCB0byBjb250ZXh0OiAke2NyZWF0ZWRGaWxlLm5hbWV9YFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvY2F0ZSBwYXN0ZWQgZmlsZSBpbiB2YXVsdC5cIik7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaGFuZGxpbmcgcGFzdGVkIGZpbGU6XCIsIGVycik7XG4gICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBoYW5kbGUgcGFzdGVkIGZpbGU6ICR7ZXJyfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZpbmFsbHksIGlmIHRoZXJlJ3MgYWxzbyB0ZXh0IGluIHRoZSBzYW1lIHBhc3RlIGV2ZW50LCBpbnNlcnQgdGhhdCBhZnRlciBmaWxlIGhhbmRsaW5nXG4gICAgaWYgKHBhc3RlZFRleHQpIHtcbiAgICAgIHRoaXMuaW5zZXJ0VGV4dEF0Q3Vyc29yKHBhc3RlZFRleHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVNlbmRNZXNzYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVJbWFnZVBhc3RlKGNsaXBib2FyZERhdGE6IERhdGFUcmFuc2Zlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZmlsZSA9IGNsaXBib2FyZERhdGEuZmlsZXNbMF07XG4gICAgaWYgKCFmaWxlIHx8ICFmaWxlLnR5cGUuc3RhcnRzV2l0aChcImltYWdlL1wiKSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIk5vIGltYWdlIGluIGNsaXBib2FyZFwiLFxuICAgICAgICBFUlJPUl9DT0RFUy5OT19JTUFHRSxcbiAgICAgICAgNDAwXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IEltYWdlUHJvY2Vzc29yLnByb2Nlc3NDbGlwYm9hcmRJbWFnZShjbGlwYm9hcmREYXRhKTtcbiAgICByZXR1cm4gYmFzZTY0O1xuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3RJbnB1dEhlaWdodCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQpIHJldHVybjtcblxuICAgIHRoaXMuaW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgY29uc3QgbmV3SGVpZ2h0ID0gTWF0aC5taW4oTWF0aC5tYXgodGhpcy5pbnB1dC5zY3JvbGxIZWlnaHQsIDQ4KSwgMjAwKTsgLy8gTWluIDQ4cHgsIG1heCAyMDBweFxuICAgIHRoaXMuaW5wdXQuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0ICsgXCJweFwiO1xuICB9XG5cbiAgcHVibGljIGZvY3VzKCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnB1dCBlbGVtZW50IG5vdCBmb3VuZCBpbiBzZXRWYWx1ZVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gU2V0IHRoZSB2YWx1ZSBkaXJlY3RseVxuICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHZhbHVlO1xuXG4gICAgICAvLyBUcmlnZ2VyIGlucHV0IGV2ZW50IGZvciBhbnkgbGlzdGVuZXJzXG4gICAgICBjb25zdCBpbnB1dEV2ZW50ID0gbmV3IEV2ZW50KFwiaW5wdXRcIiwge1xuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICBjYW5jZWxhYmxlOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICB0aGlzLmlucHV0LmRpc3BhdGNoRXZlbnQoaW5wdXRFdmVudCk7XG5cbiAgICAgIC8vIEFkanVzdCBoZWlnaHQgYWZ0ZXIgdmFsdWUgaXMgc2V0XG4gICAgICB0aGlzLmFkanVzdElucHV0SGVpZ2h0KCk7XG5cbiAgICAgIC8vIEZvY3VzIHRoZSBpbnB1dCBhbmQgbW92ZSBjdXJzb3IgdG8gZW5kXG4gICAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gICAgICB0aGlzLmlucHV0LnNldFNlbGVjdGlvblJhbmdlKHZhbHVlLmxlbmd0aCwgdmFsdWUubGVuZ3RoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIHNldFZhbHVlOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byBzZXQgaW5wdXQgdmFsdWVcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVubG9hZCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yZW5kZXJUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5yZW5kZXJUaW1lb3V0KTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHJlY29yZGVyIHNlcnZpY2UgY2xlYW51cFxuICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlLnNldFZpc3VhbGl6ZXJDYW52YXMobnVsbCk7XG4gICAgaWYgKHRoaXMucmVjb3JkZXJWaXN1YWxpemVyKSB7XG4gICAgICB0aGlzLnJlY29yZGVyVmlzdWFsaXplci5yZW1vdmUoKTtcbiAgICAgIHRoaXMucmVjb3JkZXJWaXN1YWxpemVyID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWVzc2FnZUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCAoYykgPT4ge1xuICAgICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUFzc2lzdGFudE1lc3NhZ2VDb250YWluZXIoKToge1xuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQ7XG4gICAgY29udGVudEVsOiBIVE1MRWxlbWVudDtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2VFbDogY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlIHN5c3RlbXNjdWxwdC1hc3Npc3RhbnQtbWVzc2FnZVwiLFxuICAgICAgfSksXG4gICAgICBjb250ZW50RWw6IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIgfSksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2NoZWR1bGVSZW5kZXIoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5yZW5kZXJUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5yZW5kZXJUaW1lb3V0KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBoZWlnaHRcbiAgICBjb25zdCBjdXJyZW50SGVpZ2h0ID0gY29udGFpbmVyRWwub2Zmc2V0SGVpZ2h0O1xuXG4gICAgLy8gVXBkYXRlIHRleHQgaW4gYSB0ZW1wb3JhcnkgY29udGFpbmVyIHRvIGNoZWNrIGhlaWdodFxuICAgIGNvbnN0IHRlbXBDb250YWluZXIgPVxuICAgICAgKGNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC10ZXh0XCIpIGFzIEhUTUxFbGVtZW50KSB8fFxuICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwidGVtcC10ZXh0XCIgfSk7XG4gICAgdGVtcENvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICB0ZW1wQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHRlbXBDb250YWluZXIuc3R5bGUud2lkdGggPSBjb250YWluZXJFbC5vZmZzZXRXaWR0aCArIFwicHhcIjtcbiAgICBhd2FpdCB0aGlzLm1lc3NhZ2VSZW5kZXJlci5yZW5kZXJNYXJrZG93bkNvbnRlbnQoY29udGVudCwgdGVtcENvbnRhaW5lcik7XG5cbiAgICAvLyBJZiBoZWlnaHQgY2hhbmdlZCwgZG8gYSBmdWxsIHJlbmRlclxuICAgIGlmIChjdXJyZW50SGVpZ2h0ICE9PSB0ZW1wQ29udGFpbmVyLm9mZnNldEhlaWdodCkge1xuICAgICAgYXdhaXQgdGhpcy5tZXNzYWdlUmVuZGVyZXIucmVuZGVyTWFya2Rvd25Db250ZW50KGNvbnRlbnQsIGNvbnRhaW5lckVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3RoZXJ3aXNlIGp1c3QgdXBkYXRlIHRoZSB2aXNpYmxlIHRleHRcbiAgICAgIGNvbnN0IGxhc3RDaGlsZCA9IGNvbnRhaW5lckVsLmxhc3RDaGlsZDtcbiAgICAgIGlmIChsYXN0Q2hpbGQgJiYgbGFzdENoaWxkLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xuICAgICAgICBsYXN0Q2hpbGQudGV4dENvbnRlbnQgPSBjb250ZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29udGVudCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFuIHVwXG4gICAgdGVtcENvbnRhaW5lci5yZW1vdmUoKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZURvY3VtZW50VXBsb2FkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgICBpZiAoIWZpbGVzLmxlbmd0aCkge1xuICAgICAgICBuZXcgTm90aWNlKFwiTm8gZmlsZXMgZm91bmQgdG8gdXBsb2FkLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaXJzdEZpbGUgPSBmaWxlc1swXTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWlTZXJ2aWNlLnVwbG9hZERvY3VtZW50KGZpcnN0RmlsZSk7XG4gICAgICBuZXcgTm90aWNlKFxuICAgICAgICBgVXBsb2FkZWQgZG9jLiBJRDogJHtyZXN1bHQuZG9jdW1lbnRJZH0sIHN0YXR1czogJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5ldyBOb3RpY2UoYEVycm9yIHVwbG9hZGluZyBkb2M6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHVwZGF0ZVRva2VuQ291bnQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdGV4dCA9IHRoaXMuaW5wdXQudmFsdWU7XG4gICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLmdldE1lc3NhZ2VzKCk7XG4gICAgY29uc3QgY29udGV4dEZpbGVzID0gdGhpcy5nZXRDb250ZXh0RmlsZXMoKTtcblxuICAgIC8vIENhbGN1bGF0ZSB0b2tlbnMgZm9yIGN1cnJlbnQgaW5wdXRcbiAgICBjb25zdCBpbnB1dFRva2VucyA9IHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5hcHByb3hpbWF0ZVRva2VuQ291bnQodGV4dCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdG9rZW5zIGZvciBtZXNzYWdlIGhpc3RvcnlcbiAgICBsZXQgaGlzdG9yeVRva2VucyA9IDA7XG4gICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7XG4gICAgICBjb25zdCBjb250ZW50ID1cbiAgICAgICAgdHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgID8gbWVzc2FnZS5jb250ZW50XG4gICAgICAgICAgOiBKU09OLnN0cmluZ2lmeShtZXNzYWdlLmNvbnRlbnQpO1xuICAgICAgY29uc3QgbWVzc2FnZVRva2VucyA9XG4gICAgICAgIHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG4gICAgICBoaXN0b3J5VG9rZW5zICs9IG1lc3NhZ2VUb2tlbnM7XG4gICAgICAvLyBBZGQgb3ZlcmhlYWQgZm9yIG1lc3NhZ2UgbWV0YWRhdGEgKHJvbGUsIGV0YylcbiAgICAgIGhpc3RvcnlUb2tlbnMgKz0gNDtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgdG9rZW5zIGZvciBjb250ZXh0IGZpbGVzXG4gICAgbGV0IGNvbnRleHRUb2tlbnMgPSAwO1xuXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBjb250ZXh0RmlsZXMpIHtcbiAgICAgIGlmIChmaWxlUGF0aC5zdGFydHNXaXRoKFwiZG9jOlwiKSkgY29udGludWU7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGxpbmtUZXh0ID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgICAgbGlua1RleHQsXG4gICAgICAgICAgXCJcIlxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXNvbHZlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIC8vIE9ubHkgY291bnQgdG9rZW5zIGZvciB0ZXh0IGFuZCBtYXJrZG93biBmaWxlc1xuICAgICAgICAgIGlmICghcmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi5tYXRjaCgvXihtZHx0eHR8bWFya2Rvd24pJC9pKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVXNlIHRoZSBjYWNoZWQgZmlsZSB0b2tlbiBjb3VudGluZ1xuICAgICAgICAgIGNvbnN0IGZpbGVUb2tlbnMgPSBhd2FpdCB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuZ2V0RmlsZVRva2VuQ291bnQoXG4gICAgICAgICAgICByZXNvbHZlZEZpbGVcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnRleHRUb2tlbnMgKz0gZmlsZVRva2VucztcbiAgICAgICAgICBjb250ZXh0VG9rZW5zICs9IDQ7IC8vIG92ZXJoZWFkXG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBwcm9jZXNzIGNvbnRleHQgZmlsZSBmb3IgdG9rZW4gY291bnQ6XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgdG90YWwgdG9rZW5zXG4gICAgY29uc3QgdG90YWxUb2tlbnMgPSBpbnB1dFRva2VucyArIGhpc3RvcnlUb2tlbnMgKyBjb250ZXh0VG9rZW5zO1xuXG4gICAgLy8gR2V0IHRva2VuIGxpbWl0IGZyb20gQ2hhdFZpZXdcbiAgICBjb25zdCB0b2tlbkxpbWl0ID0gKHRoaXMuY2hhdFZpZXcgYXMgYW55KS5nZXRUb2tlbkxpbWl0Py4oKTtcblxuICAgIC8vIFVwZGF0ZSBkaXNwbGF5IHdpdGggYXBwcm94aW1hdGUgY291bnQgYW5kIHdhcm5pbmcgc3RhdGVcbiAgICAvLyBPbmx5IGhpZGUgdGhlIGNvdW50ZXIgaWYgdGhlcmUgYXJlIG5vIHRva2VucyBBTkQgbm8gY29udGV4dCBmaWxlc1xuICAgIGlmICh0b3RhbFRva2VucyA9PT0gMCAmJiBjb250ZXh0RmlsZXMuc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy50b2tlbkNvdW50ZXIudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRva2VuQ291bnRlci50ZXh0Q29udGVudCA9XG4gICAgICAgIHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5mb3JtYXRUb2tlbkNvdW50KHRvdGFsVG9rZW5zKTtcbiAgICB9XG5cbiAgICAvLyBTaG93IHdhcm5pbmcgaWYgb3ZlciB0b2tlbiBsaW1pdCBvciBhcHByb2FjaGluZyBpdCAoOTAlKVxuICAgIGlmICh0b2tlbkxpbWl0KSB7XG4gICAgICBjb25zdCB3YXJuaW5nVGhyZXNob2xkID0gTWF0aC5mbG9vcih0b2tlbkxpbWl0ICogMC45KTtcbiAgICAgIHRoaXMudG9rZW5Db3VudGVyLmNsYXNzTGlzdC50b2dnbGUoXG4gICAgICAgIFwid2FybmluZ1wiLFxuICAgICAgICB0b3RhbFRva2VucyA+IHdhcm5pbmdUaHJlc2hvbGRcbiAgICAgICk7XG5cbiAgICAgIC8vIEFkZCBleGFjdCBjb3VudCBhbmQgbGltaXQgd2hlbiBhcHByb2FjaGluZy9leGNlZWRpbmcgbGltaXRcbiAgICAgIGlmICh0b3RhbFRva2VucyA+IHdhcm5pbmdUaHJlc2hvbGQpIHtcbiAgICAgICAgdGhpcy50b2tlbkNvdW50ZXIudGV4dENvbnRlbnQgPSBgJHt0b3RhbFRva2Vucy50b0xvY2FsZVN0cmluZygpfSAvICR7dG9rZW5MaW1pdC50b0xvY2FsZVN0cmluZygpfSB0b2tlbnNgO1xuICAgICAgfVxuXG4gICAgICAvLyBEaXNhYmxlIGlucHV0IGlmIG92ZXIgbGltaXRcbiAgICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiLnN5c3RlbXNjdWxwdC1zdWJtaXQtYnV0dG9uXCJcbiAgICAgICkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICBpZiAoc3VibWl0QnV0dG9uKSB7XG4gICAgICAgIGNvbnN0IGlzT3ZlckxpbWl0ID0gdG90YWxUb2tlbnMgPiB0b2tlbkxpbWl0O1xuICAgICAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBpc092ZXJMaW1pdDtcbiAgICAgICAgc3VibWl0QnV0dG9uLnRpdGxlID0gaXNPdmVyTGltaXRcbiAgICAgICAgICA/IGBFeGNlZWRzIHRva2VuIGxpbWl0IG9mICR7dG9rZW5MaW1pdC50b0xvY2FsZVN0cmluZygpfWBcbiAgICAgICAgICA6IFwiXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5vIGxpbWl0IHNldCAtIGRvbid0IHNob3cgd2FybmluZyBzaW5jZSB3ZSBoYXZlIGluZmluaXRlIGNvbnRleHRcbiAgICAgIHRoaXMudG9rZW5Db3VudGVyLmNsYXNzTGlzdC5yZW1vdmUoXCJ3YXJuaW5nXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlRGlyZWN0b3J5RXhpc3RzKGRpclBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKGRpclBhdGgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpKSB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnRUZXh0QXRDdXJzb3IodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgY3Vyc29yUG9zID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlO1xuXG4gICAgaWYgKGN1cnNvclBvcyAhPT0gbnVsbCkge1xuICAgICAgLy8gSW5zZXJ0IGF0IGN1cnNvciBwb3NpdGlvblxuICAgICAgY29uc3QgbmV3VmFsdWUgPVxuICAgICAgICBjdXJyZW50VmFsdWUuc2xpY2UoMCwgY3Vyc29yUG9zKSArIHRleHQgKyBjdXJyZW50VmFsdWUuc2xpY2UoY3Vyc29yUG9zKTtcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgIC8vIE1vdmUgY3Vyc29yIHRvIGVuZCBvZiBpbnNlcnRlZCB0ZXh0XG4gICAgICB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25FbmQgPVxuICAgICAgICBjdXJzb3JQb3MgKyB0ZXh0Lmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXBwZW5kIHRvIGVuZCBpZiBubyBjdXJzb3IgcG9zaXRpb25cbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsdWUgKyB0ZXh0O1xuICAgICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uRW5kID1cbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gVHJpZ2dlciBpbnB1dCBldmVudCBmb3IgaGVpZ2h0IGFkanVzdG1lbnQgYW5kIHRva2VuIGNvdW50aW5nXG4gICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcblxuICAgIC8vIEZvY3VzIHRoZSBpbnB1dCBhZnRlciBpbnNlcnRpb25cbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBFdmVudHMgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIEZpbGVUb2tlbkNhY2hlIHtcbiAgdG9rZW5zOiBudW1iZXI7XG4gIG10aW1lOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBUb2tlbkNvdW50ZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFRva2VuQ291bnRlclNlcnZpY2U7XG4gIHByaXZhdGUgY2FjaGU6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgZmlsZUNhY2hlOiBNYXA8c3RyaW5nLCBGaWxlVG9rZW5DYWNoZT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FjaGVTaXplID0gMTAwMDtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIEJpbmQgdGhlIGV2ZW50IGhhbmRsZXJzXG4gICAgdGhpcy5oYW5kbGVGaWxlTW9kaWZ5ID0gdGhpcy5oYW5kbGVGaWxlTW9kaWZ5LmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVGaWxlRGVsZXRlID0gdGhpcy5oYW5kbGVGaWxlRGVsZXRlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVGaWxlUmVuYW1lID0gdGhpcy5oYW5kbGVGaWxlUmVuYW1lLmJpbmQodGhpcyk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVNb2RpZnkoZmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICB0aGlzLmZpbGVDYWNoZS5kZWxldGUoZmlsZS5wYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVEZWxldGUoZmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICB0aGlzLmZpbGVDYWNoZS5kZWxldGUoZmlsZS5wYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVSZW5hbWUoZmlsZTogVEZpbGUsIG9sZFBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHRoaXMuZmlsZUNhY2hlLmRlbGV0ZShvbGRQYXRoKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogVG9rZW5Db3VudGVyU2VydmljZSB7XG4gICAgaWYgKCFUb2tlbkNvdW50ZXJTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBUb2tlbkNvdW50ZXJTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFRva2VuQ291bnRlclNlcnZpY2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIFRva2VuQ291bnRlclNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBzZXRBcHAoYXBwOiBBcHApOiB2b2lkIHtcbiAgICB0aGlzLmFwcCA9IGFwcDtcblxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLmFwcC52YXVsdC5vbihcIm1vZGlmeVwiLCB0aGlzLmhhbmRsZUZpbGVNb2RpZnkpO1xuICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwiZGVsZXRlXCIsIHRoaXMuaGFuZGxlRmlsZURlbGV0ZSk7XG4gICAgdGhpcy5hcHAudmF1bHQub24oXCJyZW5hbWVcIiwgdGhpcy5oYW5kbGVGaWxlUmVuYW1lKTtcbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGEgdmFsaWQgY2FjaGVkIGNvdW50XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5maWxlQ2FjaGUuZ2V0KGZpbGUucGF0aCk7XG4gICAgaWYgKGNhY2hlZCAmJiBjYWNoZWQubXRpbWUgPT09IGZpbGUuc3RhdC5tdGltZSkge1xuICAgICAgcmV0dXJuIGNhY2hlZC50b2tlbnM7XG4gICAgfVxuXG4gICAgLy8gUmVhZCBhbmQgY291bnQgdG9rZW5zXG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgY29uc3QgdG9rZW5zID0gdGhpcy5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG5cbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0IHdpdGggdGhlIGN1cnJlbnQgbXRpbWVcbiAgICB0aGlzLmZpbGVDYWNoZS5zZXQoZmlsZS5wYXRoLCB7XG4gICAgICB0b2tlbnMsXG4gICAgICBtdGltZTogZmlsZS5zdGF0Lm10aW1lLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRva2VucztcbiAgfVxuXG4gIGFwcHJveGltYXRlVG9rZW5Db3VudCh0ZXh0OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGlmICghdGV4dCkgcmV0dXJuIDA7XG5cbiAgICAvLyBDYWNoZSBjaGVja1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7dGV4dC5zbGljZSgwLCAxMDApfV8ke3RleHQubGVuZ3RofWA7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5jYWNoZS5nZXQoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGNhY2hlZDtcblxuICAgIC8vIFByZS1wcm9jZXNzIHRleHQgZm9yIG1vcmUgYWNjdXJhdGUgY291bnRpbmdcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XG5cbiAgICBsZXQgdG9rZW5Db3VudCA9IDA7XG5cbiAgICAvLyBDb3VudCBzcGVjaWFsIHBhdHRlcm5zIHRoYXQgY29tbW9ubHkgbWFwIHRvIHNpbmdsZSB0b2tlbnNcbiAgICBjb25zdCBjb21tb25QYXR0ZXJucyA9IFtcbiAgICAgIC9eaHR0cHM/OlxcL1xcL1xcUysvZ20sIC8vIFVSTHNcbiAgICAgIC9bQCNdXFx3Ky9nLCAvLyBNZW50aW9ucyBhbmQgaGFzaHRhZ3NcbiAgICAgIC86W2Etel9dKzovZywgLy8gRW1vamkgY29kZXNcbiAgICAgIC9bQS1aXXsyLH0vZywgLy8gQWNyb255bXNcbiAgICAgIC9cXGR7MSwxNn0vZywgLy8gTnVtYmVyc1xuICAgICAgL1suLCE/OzooKXt9XFxbXFxdXCInXS9nLCAvLyBDb21tb24gcHVuY3R1YXRpb25cbiAgICBdO1xuXG4gICAgLy8gUmVtb3ZlIGFuZCBjb3VudCBzcGVjaWFsIHBhdHRlcm5zIGZpcnN0XG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGNvbW1vblBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaGVzID0gdGV4dC5tYXRjaChwYXR0ZXJuKTtcbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIHRva2VuQ291bnQgKz0gbWF0Y2hlcy5yZWR1Y2UoKHN1bSwgbWF0Y2gpID0+IHtcbiAgICAgICAgICAvLyBBZGp1c3QgdG9rZW4gY291bnQgYmFzZWQgb24gcGF0dGVybiB0eXBlIGFuZCBsZW5ndGhcbiAgICAgICAgICBpZiAobWF0Y2guc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBzdW0gKyBNYXRoLmNlaWwobWF0Y2gubGVuZ3RoIC8gNCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPD0gNCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIDE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzdW0gKyBNYXRoLmNlaWwobWF0Y2gubGVuZ3RoIC8gMyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShwYXR0ZXJuLCBcIiBcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BsaXQgcmVtYWluaW5nIHRleHQgYW5kIGNvdW50XG4gICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9cXHMrLykuZmlsdGVyKCh3KSA9PiB3Lmxlbmd0aCA+IDApO1xuICAgIGZvciAoY29uc3Qgd29yZCBvZiB3b3Jkcykge1xuICAgICAgLy8gQmFzZSB0b2tlbiBjb3VudFxuICAgICAgbGV0IHdvcmRUb2tlbnMgPSAxO1xuXG4gICAgICAvLyBBZGp1c3QgZm9yIHdvcmQgbGVuZ3RoIChtb3N0IG1vZGVscyBzcGxpdCBsb25nIHdvcmRzKVxuICAgICAgaWYgKHdvcmQubGVuZ3RoID4gNCkge1xuICAgICAgICB3b3JkVG9rZW5zICs9IE1hdGguZmxvb3IoKHdvcmQubGVuZ3RoIC0gNCkgLyAzKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRqdXN0IGZvciBtaXhlZCBjYXNlIChwb3RlbnRpYWwgc3Vid29yZCB0b2tlbnMpXG4gICAgICBpZiAoL1thLXpdW0EtWl0vLnRlc3Qod29yZCkpIHtcbiAgICAgICAgd29yZFRva2VucyArPSAod29yZC5tYXRjaCgvW0EtWl0vZykgfHwgW10pLmxlbmd0aDtcbiAgICAgIH1cblxuICAgICAgLy8gQWRqdXN0IGZvciBub24tQVNDSUkgY2hhcmFjdGVyc1xuICAgICAgY29uc3Qgbm9uQXNjaWkgPSAod29yZC5tYXRjaCgvW15cXHgwMC1cXHg3Rl0vZykgfHwgW10pLmxlbmd0aDtcbiAgICAgIGlmIChub25Bc2NpaSA+IDApIHtcbiAgICAgICAgd29yZFRva2VucyArPSBNYXRoLmNlaWwobm9uQXNjaWkgKiAxLjUpO1xuICAgICAgfVxuXG4gICAgICB0b2tlbkNvdW50ICs9IHdvcmRUb2tlbnM7XG4gICAgfVxuXG4gICAgLy8gQWRkIDEwJSBzYWZldHkgbWFyZ2luIGZvciBvdmVyZXN0aW1hdGlvblxuICAgIHRva2VuQ291bnQgPSBNYXRoLmNlaWwodG9rZW5Db3VudCAqIDEuMSk7XG5cbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgdGhpcy5jYWNoZVJlc3VsdChjYWNoZUtleSwgdG9rZW5Db3VudCk7XG5cbiAgICByZXR1cm4gdG9rZW5Db3VudDtcbiAgfVxuXG4gIHByaXZhdGUgY2FjaGVSZXN1bHQoa2V5OiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jYWNoZS5zaXplID49IHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMuY2FjaGUua2V5cygpLm5leHQoKS52YWx1ZTtcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGZpcnN0S2V5KTtcbiAgICB9XG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB2YWx1ZSk7XG4gIH1cblxuICBjbGVhckNhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgICB0aGlzLmZpbGVDYWNoZS5jbGVhcigpO1xuICB9XG5cbiAgdW5sb2FkKCk6IHZvaWQge1xuICAgIC8vIENsZWFuIHVwIGV2ZW50IGxpc3RlbmVycyB3aGVuIHBsdWdpbiBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLmFwcCkge1xuICAgICAgdGhpcy5hcHAudmF1bHQub2ZmKFwibW9kaWZ5XCIsIHRoaXMuaGFuZGxlRmlsZU1vZGlmeSk7XG4gICAgICB0aGlzLmFwcC52YXVsdC5vZmYoXCJkZWxldGVcIiwgdGhpcy5oYW5kbGVGaWxlRGVsZXRlKTtcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9mZihcInJlbmFtZVwiLCB0aGlzLmhhbmRsZUZpbGVSZW5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGZvcm1hdFRva2VuQ291bnQoY291bnQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGNvdW50ID09PSAwKSByZXR1cm4gXCJcIjtcbiAgICBpZiAoY291bnQgPCAxMDApIHJldHVybiBcIjwgMTAwIHRva2Vuc1wiO1xuICAgIGlmIChjb3VudCA+PSAxMDAwKSB7XG4gICAgICAvLyBSb3VuZCB1cCB0byBuZWFyZXN0IHRob3VzYW5kXG4gICAgICBjb25zdCBpbksgPSBNYXRoLmNlaWwoY291bnQgLyAxMDAwKTtcbiAgICAgIHJldHVybiBgfiR7aW5LfUsgdG9rZW5zYDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUm91bmQgdXAgdG8gbmVhcmVzdCBodW5kcmVkXG4gICAgICBjb25zdCBpbkh1bmRyZWRzID0gTWF0aC5jZWlsKGNvdW50IC8gMTAwKSAqIDEwMDtcbiAgICAgIHJldHVybiBgfiR7aW5IdW5kcmVkc30gdG9rZW5zYDtcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBzZXRJY29uLCBDb21wb25lbnQgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IERyYXdlckNvbXBvbmVudCB9IGZyb20gXCIuL0RyYXdlckNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQ29udGV4dFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Db250ZXh0U2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgTWFya2Rvd25SZW5kZXJlciB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IFRva2VuQ291bnRlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvVG9rZW5Db3VudGVyU2VydmljZVwiO1xuaW1wb3J0IHsgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5cbmludGVyZmFjZSBDb250ZXh0RmlsZSB7XG4gIHBhdGg6IHN0cmluZztcbiAgdHlwZTogXCJzb3VyY2VcIiB8IFwiZXh0cmFjdGlvblwiO1xufVxuXG5pbnRlcmZhY2UgQ2F0ZWdvcnlGaWxlIHtcbiAgZmlsZTogVEZpbGU7XG4gIHBhdGg6IHN0cmluZztcbiAgbGlua1RleHQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIENhdGVnb3J5IHtcbiAgbGFiZWw6IHN0cmluZztcbiAgZmlsZXM6IENhdGVnb3J5RmlsZVtdO1xuICBleHRlbnNpb25zOiBzdHJpbmdbXTtcbn1cblxuaW50ZXJmYWNlIEZpbGVDb250ZXh0TWFuYWdlck9wdGlvbnMge1xuICBhcHA6IEFwcDtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgdGl0bGU/OiBzdHJpbmc7XG4gIG9uQ29udGV4dENoYW5nZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcGx1Z2luOiBhbnk7XG59XG5cbmV4cG9ydCBjbGFzcyBGaWxlQ29udGV4dE1hbmFnZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIGNvbnRleHRGaWxlcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICBwcml2YXRlIGRyYXdlcjogRHJhd2VyQ29tcG9uZW50O1xuICBwcml2YXRlIGNvbnRleHRQYW5lbDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgb25Db250ZXh0Q2hhbmdlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIHByb2Nlc3NpbmdTdGF0dXM6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvY2Vzc2luZ0ZpbGVzID0gbmV3IE1hcDxzdHJpbmcsIEhUTUxFbGVtZW50PigpO1xuICBwcml2YXRlIHByb2Nlc3NpbmdUaW1lb3V0cyA9IG5ldyBNYXA8c3RyaW5nLCBOb2RlSlMuVGltZW91dD4oKTtcbiAgcHJpdmF0ZSBzeW5jU3RhdHVzRWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaXNTeW5jaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBwbHVnaW46IGFueTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50ZXI6IFRva2VuQ291bnRlclNlcnZpY2U7XG4gIHByaXZhdGUgdG9rZW5Db3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEZpbGVDb250ZXh0TWFuYWdlck9wdGlvbnMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYXBwID0gb3B0aW9ucy5hcHA7XG4gICAgdGhpcy5vbkNvbnRleHRDaGFuZ2UgPSBvcHRpb25zLm9uQ29udGV4dENoYW5nZTtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBvcHRpb25zLnNjdWxwdFNlcnZpY2U7XG4gICAgdGhpcy5wbHVnaW4gPSBvcHRpb25zLnBsdWdpbjtcbiAgICB0aGlzLnRva2VuQ291bnRlciA9IFRva2VuQ291bnRlclNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcblxuICAgIHRoaXMuZHJhd2VyID0gbmV3IERyYXdlckNvbXBvbmVudCh7XG4gICAgICBjb250YWluZXI6IG9wdGlvbnMuY29udGFpbmVyLFxuICAgICAgdGl0bGU6IG9wdGlvbnMudGl0bGUgfHwgXCJDb250ZXh0IEZpbGVzXCIsXG4gICAgfSk7XG4gICAgdGhpcy5jb250ZXh0UGFuZWwgPSB0aGlzLmRyYXdlci5nZXREcmF3ZXIoKTtcblxuICAgIHRoaXMuc2V0dXBDb250ZXh0UGFuZWwoKTtcbiAgICB0aGlzLmluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCkge1xuICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cyA9IHRoaXMuY29udGV4dFBhbmVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvY2Vzc2luZy1zdGF0dXNcIixcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIHN0YXR1czogc3RyaW5nLFxuICAgIGljb246IHN0cmluZyxcbiAgICByZW1vdmU6IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICBjb25zdCBmaWxlSWQgPSBmaWxlLnBhdGg7XG4gICAgbGV0IHN0YXR1c0VsID0gdGhpcy5wcm9jZXNzaW5nRmlsZXMuZ2V0KGZpbGVJZCk7XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZW91dCBmb3IgdGhpcyBmaWxlXG4gICAgY29uc3QgZXhpc3RpbmdUaW1lb3V0ID0gdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZ2V0KGZpbGVJZCk7XG4gICAgaWYgKGV4aXN0aW5nVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGV4aXN0aW5nVGltZW91dCk7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICB9XG5cbiAgICBpZiAoIXN0YXR1c0VsICYmICFyZW1vdmUgJiYgdGhpcy5wcm9jZXNzaW5nU3RhdHVzKSB7XG4gICAgICBzdGF0dXNFbCA9IHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZmlsZS1zdGF0dXNcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG5cbiAgICAgIHN0YXR1c0VsLmNyZWF0ZVNwYW4oe1xuICAgICAgICB0ZXh0OiBgJHtmaWxlLmJhc2VuYW1lfTogJHtzdGF0dXN9YCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtdGV4dFwiLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLnNldChmaWxlSWQsIHN0YXR1c0VsKTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1c0VsICYmICFyZW1vdmUpIHtcbiAgICAgIHN0YXR1c0VsLmVtcHR5KCk7XG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG4gICAgICBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogYCR7ZmlsZS5iYXNlbmFtZX06ICR7c3RhdHVzfWAsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLXRleHRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc3RhdHVzRWwgJiYgcmVtb3ZlKSB7XG4gICAgICBzdGF0dXNFbC5yZW1vdmUoKTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmRlbGV0ZShmaWxlSWQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnByb2Nlc3NpbmdTdGF0dXMpIHtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5zdHlsZS5kaXNwbGF5ID1cbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuc2l6ZSA+IDAgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGlzIGlzIGEgc3VjY2VzcyBvciBlcnJvciBtZXNzYWdlLCBvciBleHBsaWNpdCByZW1vdmFsIHJlcXVlc3RlZCwgc2V0IGEgdGltZW91dCB0byByZW1vdmUgaXRcbiAgICBpZiAoXG4gICAgICByZW1vdmUgfHxcbiAgICAgIHN0YXR1cy5pbmNsdWRlcyhcInN1Y2Nlc3NmdWxseVwiKSB8fFxuICAgICAgc3RhdHVzLmluY2x1ZGVzKFwiY29tcGxldGVkXCIpIHx8XG4gICAgICBzdGF0dXMuaW5jbHVkZXMoXCJFcnJvcjpcIilcbiAgICApIHtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICAgIH0sIDMwMDApO1xuICAgICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuc2V0KGZpbGVJZCwgdGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cENvbnRleHRQYW5lbCgpOiB2b2lkIHtcbiAgICBjb25zdCB0aXRsZUVsID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItdGl0bGVcIlxuICAgICk7XG4gICAgaWYgKCF0aXRsZUVsKSByZXR1cm47XG5cbiAgICBjb25zdCBjb250ZXh0Q291bnQgPSB0aXRsZUVsLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY291bnRcIixcbiAgICAgIHRleHQ6IFwiMFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHN5bmMgc3RhdHVzIGVsZW1lbnRcbiAgICB0aGlzLnN5bmNTdGF0dXNFbCA9IHRpdGxlRWwuY3JlYXRlU3Bhbih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXN5bmMtc3RhdHVzIHN5bmNlZFwiLFxuICAgIH0pO1xuICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwiY2hlY2tcIik7XG5cbiAgICBjb25zdCBjb250ZXh0QnV0dG9uID0gdGl0bGVFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtYWRkLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIHNldEljb24oY29udGV4dEJ1dHRvbiwgXCJwbHVzXCIpO1xuICAgIGNvbnRleHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5hZGRDb250ZXh0RmlsZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU3luY1N0YXR1cyhzeW5jaW5nOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoIXRoaXMuc3luY1N0YXR1c0VsKSByZXR1cm47XG5cbiAgICB0aGlzLmlzU3luY2luZyA9IHN5bmNpbmc7XG4gICAgdGhpcy5zeW5jU3RhdHVzRWwuZW1wdHkoKTtcblxuICAgIGlmIChzeW5jaW5nKSB7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5yZW1vdmVDbGFzcyhcInN5bmNlZFwiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwibG9hZGVyLTJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLnJlbW92ZUNsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2VkXCIpO1xuICAgICAgc2V0SWNvbih0aGlzLnN5bmNTdGF0dXNFbCwgXCJjaGVja1wiKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY2hlY2tTeW5jU3RhdHVzKCkge1xuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlU3luY1N0YXR1cyh0cnVlKTtcbiAgICAvLyBObyBuZWVkIHRvIHNpbXVsYXRlLCBqdXN0IHVwZGF0ZSBzdGF0dXNcbiAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDb250ZXh0UGFuZWwoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNvbnRleHRQYW5lbCkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVhZGVyID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItaGVhZGVyXCJcbiAgICApO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmNvbnRleHRQYW5lbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuc3lzdGVtc2N1bHB0LWRyYXdlci1jb250ZW50XCJcbiAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtZHJhd2VyLWNvdW50XCIpO1xuXG4gICAgaWYgKCFoZWFkZXIgfHwgIWNvbnRlbnQgfHwgIWNvdW50KSByZXR1cm47XG5cbiAgICBjb3VudC50ZXh0Q29udGVudCA9IHRoaXMuY29udGV4dEZpbGVzLnNpemUudG9TdHJpbmcoKTtcblxuICAgIGNvbnRlbnQuZW1wdHkoKTtcblxuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICBjb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItZW1wdHlcIixcbiAgICAgICAgdGV4dDogXCJObyBjb250ZXh0IGZpbGVzIGFkZGVkIHlldC4gQ2xpY2sgdGhlIHBsdXMgYnV0dG9uIHRvIGFkZCBmaWxlcyBpbiB5b3VyIGNoYXQuXCIsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT4gPSB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIGxhYmVsOiBcIlRleHQgRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtZFwiLCBcInR4dFwiLCBcIm1hcmtkb3duXCJdLFxuICAgICAgfSxcbiAgICAgIGltYWdlczoge1xuICAgICAgICBsYWJlbDogXCJJbWFnZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJqcGdcIiwgXCJqcGVnXCIsIFwicG5nXCIsIFwiZ2lmXCIsIFwid2VicFwiLCBcInN2Z1wiXSxcbiAgICAgIH0sXG4gICAgICBhdWRpbzoge1xuICAgICAgICBsYWJlbDogXCJBdWRpbyBGaWxlc1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXSxcbiAgICAgIH0sXG4gICAgICBkb2N1bWVudHM6IHtcbiAgICAgICAgbGFiZWw6IFwiRG9jdW1lbnRzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wiZG9jXCIsIFwiZG9jeFwiLCBcInBwdFwiLCBcInBwdHhcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwicGRmXCJdLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgLy8gR3JvdXAgZXh0cmFjdGVkIGZpbGVzIGJ5IHRoZWlyIHNvdXJjZSBkb2N1bWVudFxuICAgIGNvbnN0IGRvY3VtZW50R3JvdXBzID0gbmV3IE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+PigpO1xuICAgIGNvbnN0IG5vbkV4dHJhY3RlZEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIHRoaXMuY29udGV4dEZpbGVzKSB7XG4gICAgICBjb25zdCBjbGVhblBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcblxuICAgICAgaWYgKGNsZWFuUGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIikpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBjbGVhblBhdGguc3BsaXQoXCIvXCIpO1xuICAgICAgICBjb25zdCBleHRyYWN0aW9uRGlySW5kZXggPSBwYXJ0cy5pbmRleE9mKFwiRXh0cmFjdGlvbnNcIik7XG4gICAgICAgIGlmIChleHRyYWN0aW9uRGlySW5kZXggPj0gMCAmJiBleHRyYWN0aW9uRGlySW5kZXggKyAxIDwgcGFydHMubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3Qgc291cmNlRG9jID0gcGFydHNbZXh0cmFjdGlvbkRpckluZGV4ICsgMV07XG4gICAgICAgICAgaWYgKCFkb2N1bWVudEdyb3Vwcy5oYXMoc291cmNlRG9jKSkge1xuICAgICAgICAgICAgZG9jdW1lbnRHcm91cHMuc2V0KHNvdXJjZURvYywgbmV3IFNldCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZG9jdW1lbnRHcm91cHMuZ2V0KHNvdXJjZURvYyk/LmFkZChmaWxlUGF0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaXJzdCwgY2F0ZWdvcml6ZSBub24tZXh0cmFjdGVkIGZpbGVzXG4gICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShub25FeHRyYWN0ZWRGaWxlcyksIGNhdGVnb3JpZXMpO1xuXG4gICAgLy8gUmVuZGVyIHJlZ3VsYXIgY2F0ZWdvcmllcyBmaXJzdFxuICAgIGZvciAoY29uc3QgY2F0ZWdvcnlLZXkgb2YgW1widGV4dFwiLCBcImltYWdlc1wiLCBcImF1ZGlvXCJdKSB7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGNhdGVnb3JpZXNbY2F0ZWdvcnlLZXldO1xuICAgICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5yZW5kZXJDYXRlZ29yeShjb250ZW50LCBjYXRlZ29yeSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZG9jdW1lbnRzIGNhdGVnb3J5XG4gICAgaWYgKGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLmxlbmd0aCA+IDAgfHwgZG9jdW1lbnRHcm91cHMuc2l6ZSA+IDApIHtcbiAgICAgIC8vIE1haW4gXCJEb2N1bWVudHNcIiBjYXRlZ29yeSBoZWFkZXJcbiAgICAgIGNvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1jYXRlZ29yeVwiLFxuICAgICAgICB0ZXh0OiBcIkRvY3VtZW50c1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEZpcnN0IHJlbmRlciBzdGFuZGFsb25lIGRvY3VtZW50c1xuICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBjYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyk7XG5cbiAgICAgIC8vIFRoZW4gcmVuZGVyIGVhY2ggZG9jdW1lbnQgZ3JvdXAgYXMgYSBzdWJjYXRlZ29yeVxuICAgICAgZm9yIChjb25zdCBbc291cmNlRG9jLCBleHRyYWN0ZWRGaWxlc10gb2YgZG9jdW1lbnRHcm91cHMpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgc3ViY2F0ZWdvcnkgZm9yIHRoaXMgZG9jdW1lbnRcbiAgICAgICAgY29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY2F0ZWdvcnlcIixcbiAgICAgICAgICB0ZXh0OiBgXHVEODNEXHVEQ0M0ICR7c291cmNlRG9jfSBFeHRyYWN0aW9uc2AsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhdGVnb3JpemUgZXh0cmFjdGVkIGZpbGVzXG4gICAgICAgIGNvbnN0IGV4dHJhY3RlZENhdGVnb3JpZXMgPSB0aGlzLmNyZWF0ZUNhdGVnb3JpZXMoKTtcbiAgICAgICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShleHRyYWN0ZWRGaWxlcyksIGV4dHJhY3RlZENhdGVnb3JpZXMpO1xuXG4gICAgICAgIC8vIEZpcnN0IHJlbmRlciB0ZXh0IGZpbGVzIChtZCwgdHh0LCBtYXJrZG93bilcbiAgICAgICAgY29uc3QgdGV4dEZpbGVzID0gZXh0cmFjdGVkQ2F0ZWdvcmllcy50ZXh0LmZpbGVzO1xuICAgICAgICBpZiAodGV4dEZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZpbGVzKGNvbnRlbnQsIHRleHRGaWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGVuIHJlbmRlciBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VGaWxlcyA9IGV4dHJhY3RlZENhdGVnb3JpZXMuaW1hZ2VzLmZpbGVzO1xuICAgICAgICBpZiAoaW1hZ2VGaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBpbWFnZUZpbGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsbHkgcmVuZGVyIGFueSBvdGhlciB0eXBlcyBpZiB0aGV5IGV4aXN0XG4gICAgICAgIGNvbnN0IG90aGVyRmlsZXMgPSBbXG4gICAgICAgICAgLi4uZXh0cmFjdGVkQ2F0ZWdvcmllcy5hdWRpby5maWxlcyxcbiAgICAgICAgICAuLi5leHRyYWN0ZWRDYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyxcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKG90aGVyRmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGVudCwgb3RoZXJGaWxlcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNhdGVnb3JpZXMoKTogUmVjb3JkPHN0cmluZywgQ2F0ZWdvcnk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgdGV4dDoge1xuICAgICAgICBsYWJlbDogXCJUZXh0IEZpbGVzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXSxcbiAgICAgIH0sXG4gICAgICBpbWFnZXM6IHtcbiAgICAgICAgbGFiZWw6IFwiSW1hZ2VzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0sXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgbGFiZWw6IFwiQXVkaW8gRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJvZ2dcIiwgXCJtNGFcIl0sXG4gICAgICB9LFxuICAgICAgZG9jdW1lbnRzOiB7XG4gICAgICAgIGxhYmVsOiBcIkRvY3VtZW50c1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcInBkZlwiXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUZpbGVzKFxuICAgIGZpbGVzOiBzdHJpbmdbXSxcbiAgICBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT5cbiAgKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIGxpbmtUZXh0LFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gcmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQgY2F0ZWdvcnlGb3VuZCA9IGZhbHNlO1xuXG4gICAgICAgIGZvciAoY29uc3QgW2NhdGVnb3J5LCBpbmZvXSBvZiBPYmplY3QuZW50cmllcyhjYXRlZ29yaWVzKSkge1xuICAgICAgICAgIGlmIChpbmZvLmV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgaW5mby5maWxlcy5wdXNoKHsgZmlsZTogcmVzb2x2ZWRGaWxlLCBwYXRoOiBmaWxlUGF0aCwgbGlua1RleHQgfSk7XG4gICAgICAgICAgICBjYXRlZ29yeUZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY2F0ZWdvcnlGb3VuZCkge1xuICAgICAgICAgIGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLnB1c2goe1xuICAgICAgICAgICAgZmlsZTogcmVzb2x2ZWRGaWxlLFxuICAgICAgICAgICAgcGF0aDogZmlsZVBhdGgsXG4gICAgICAgICAgICBsaW5rVGV4dCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyQ2F0ZWdvcnkoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgY2F0ZWdvcnk6IENhdGVnb3J5KTogdm9pZCB7XG4gICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNhdGVnb3J5XCIsXG4gICAgICB0ZXh0OiBjYXRlZ29yeS5sYWJlbCxcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGFpbmVyLCBjYXRlZ29yeS5maWxlcyk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckZpbGVzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGZpbGVzOiBDYXRlZ29yeUZpbGVbXSk6IHZvaWQge1xuICAgIGZpbGVzLnNvcnQoKGEsIGIpID0+IGEuZmlsZS5iYXNlbmFtZS5sb2NhbGVDb21wYXJlKGIuZmlsZS5iYXNlbmFtZSkpO1xuXG4gICAgLy8gQ3JlYXRlIHByZXZpZXcgZWxlbWVudHMgb25jZSBhbmQgcmV1c2VcbiAgICBjb25zdCBpbWFnZVByZXZpZXcgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZUVsKFwiaW1nXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldyBzeXN0ZW1zY3VscHQtaW1hZ2UtcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWFya2Rvd25QcmV2aWV3ID0gZG9jdW1lbnQuYm9keS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmV2aWV3IHN5c3RlbXNjdWxwdC1tYXJrZG93bi1wcmV2aWV3XCIsXG4gICAgfSk7XG5cbiAgICAvLyBUcmFjayBpZiBtYXJrZG93biBwcmV2aWV3IGlzIHZpc2libGVcbiAgICBsZXQgaXNNYXJrZG93blByZXZpZXdWaXNpYmxlID0gZmFsc2U7XG5cbiAgICAvLyBIYW5kbGUgd2hlZWwgZXZlbnRzIGZvciBtYXJrZG93biBwcmV2aWV3IHNjcm9sbGluZ1xuICAgIGNvbnN0IGhhbmRsZVdoZWVsID0gKGU6IFdoZWVsRXZlbnQpID0+IHtcbiAgICAgIGlmICghaXNNYXJrZG93blByZXZpZXdWaXNpYmxlKSByZXR1cm47XG5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHNjcm9sbEFtb3VudCA9IGUuZGVsdGFZO1xuICAgICAgbWFya2Rvd25QcmV2aWV3LnNjcm9sbFRvcCArPSBzY3JvbGxBbW91bnQ7XG4gICAgfTtcblxuICAgIC8vIEFkZCB3aGVlbCBldmVudCBsaXN0ZW5lciB0byBkb2N1bWVudFxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcblxuICAgIC8vIENsZWFuIHVwIHdoZWVsIGV2ZW50IGxpc3RlbmVyIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjYWxjdWxhdGVQcmV2aWV3RGltZW5zaW9ucyA9IChcbiAgICAgIG5hdHVyYWxXaWR0aDogbnVtYmVyLFxuICAgICAgbmF0dXJhbEhlaWdodDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRXaWR0aDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlclxuICAgICkgPT4ge1xuICAgICAgLy8gTWF4aW11bSBzaXplIHNob3VsZCBiZSBhIHBlcmNlbnRhZ2Ugb2Ygdmlld3BvcnRcbiAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4odmlld3BvcnRXaWR0aCAqIDAuNCwgbmF0dXJhbFdpZHRoKTsgLy8gNDAlIG9mIHZpZXdwb3J0IHdpZHRoXG4gICAgICBjb25zdCBtYXhIZWlnaHQgPSBNYXRoLm1pbih2aWV3cG9ydEhlaWdodCAqIDAuNiwgbmF0dXJhbEhlaWdodCk7IC8vIDYwJSBvZiB2aWV3cG9ydCBoZWlnaHRcblxuICAgICAgLy8gQ2FsY3VsYXRlIGRpbWVuc2lvbnMgbWFpbnRhaW5pbmcgYXNwZWN0IHJhdGlvXG4gICAgICBsZXQgd2lkdGggPSBuYXR1cmFsV2lkdGg7XG4gICAgICBsZXQgaGVpZ2h0ID0gbmF0dXJhbEhlaWdodDtcblxuICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgd2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgaGVpZ2h0ID0gKG5hdHVyYWxIZWlnaHQgKiBtYXhXaWR0aCkgLyBuYXR1cmFsV2lkdGg7XG4gICAgICB9XG5cbiAgICAgIGlmIChoZWlnaHQgPiBtYXhIZWlnaHQpIHtcbiAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICAgICAgICB3aWR0aCA9IChuYXR1cmFsV2lkdGggKiBtYXhIZWlnaHQpIC8gbmF0dXJhbEhlaWdodDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9O1xuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVQcmV2aWV3UG9zaXRpb24gPSAoZTogTW91c2VFdmVudCwgcHJldmlld0VsOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgaWYgKCFwcmV2aWV3RWwpIHJldHVybjtcblxuICAgICAgLy8gR2V0IHZpZXdwb3J0IGRpbWVuc2lvbnNcbiAgICAgIGNvbnN0IHZpZXdwb3J0V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgIGNvbnN0IHZpZXdwb3J0SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAvLyBHZXQgcHJldmlldyBkaW1lbnNpb25zXG4gICAgICBjb25zdCByZWN0ID0gcHJldmlld0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3Qgd2lkdGggPSByZWN0LndpZHRoO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwb3NpdGlvblxuICAgICAgbGV0IHggPSBlLmNsaWVudFggKyAxNjsgLy8gRGVmYXVsdCBvZmZzZXQgZnJvbSBjdXJzb3JcbiAgICAgIGxldCB5ID0gZS5jbGllbnRZICsgMTY7XG5cbiAgICAgIC8vIENoZWNrIGlmIHByZXZpZXcgd291bGQgZ28gb2ZmIHNjcmVlblxuICAgICAgaWYgKHggKyB3aWR0aCA+IHZpZXdwb3J0V2lkdGgpIHtcbiAgICAgICAgeCA9IGUuY2xpZW50WCAtIHdpZHRoIC0gMTY7IC8vIFNob3cgb24gbGVmdCBzaWRlIG9mIGN1cnNvclxuICAgICAgfVxuICAgICAgaWYgKHkgKyBoZWlnaHQgPiB2aWV3cG9ydEhlaWdodCkge1xuICAgICAgICB5ID0gZS5jbGllbnRZIC0gaGVpZ2h0IC0gMTY7IC8vIFNob3cgYWJvdmUgY3Vyc29yXG4gICAgICB9XG5cbiAgICAgIHByZXZpZXdFbC5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7XG4gICAgICBwcmV2aWV3RWwuc3R5bGUudG9wID0gYCR7eX1weGA7XG4gICAgfTtcblxuICAgIC8vIENsZWFuIHVwIHByZXZpZXdzIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGltYWdlUHJldmlldy5yZW1vdmUoKTtcbiAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgeyBmaWxlLCBwYXRoLCBsaW5rVGV4dCB9IG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBpdGVtID0gY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHBhdGhFbCA9IGl0ZW0uY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtLXBhdGhcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uQ29udGFpbmVyID0gcGF0aEVsLmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtaWNvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgaWNvbk5hbWUgPSBcImZpbGVcIjtcblxuICAgICAgLy8gQ3JlYXRlIGxpbmsgZmlyc3Qgc28gd2UgY2FuIHJlZmVyZW5jZSBpdCBmb3IgaG92ZXIgZXZlbnRzXG4gICAgICBjb25zdCBsaW5rID0gcGF0aEVsLmNyZWF0ZUVsKFwiYVwiLCB7XG4gICAgICAgIGNsczogXCJpbnRlcm5hbC1saW5rXCIsXG4gICAgICAgIHRleHQ6IGZpbGUuYmFzZW5hbWUsXG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBocmVmOiBwYXRoLFxuICAgICAgICAgIFwiZGF0YS1ocmVmXCI6IHBhdGgsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIGZvciBtYXJrZG93biBmaWxlc1xuICAgICAgICBjb25zdCBzaG93TWFya2Rvd25QcmV2aWV3ID0gYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGUucGF0aCk7XG4gICAgICAgICAgICBpZiAobWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQobWRGaWxlKTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgaGVhZGVyIHdpdGggZmlsZW5hbWVcbiAgICAgICAgICAgICAgbWFya2Rvd25QcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldy1oZWFkZXJcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBmaWxlLmJhc2VuYW1lLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXIgYW5kIHJlbmRlciBtYXJrZG93blxuICAgICAgICAgICAgICBjb25zdCBjb250ZW50RWwgPSBtYXJrZG93blByZXZpZXcuY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBmaXJzdCA0MDAwIGNoYXJhY3RlcnMgd2l0aCBtZXNzYWdlIGlmIGxvbmdlclxuICAgICAgICAgICAgICAgIGNvbnRlbnQubGVuZ3RoID4gNDAwMFxuICAgICAgICAgICAgICAgICAgPyBjb250ZW50LnNsaWNlKDAsIDQwMDApICtcbiAgICAgICAgICAgICAgICAgICAgICBcIlxcblxcbi0tLVxcblxcbioqQ2xpY2sgdG8gdmlldyBmdWxsIGRvY3VtZW50KiogKHNob3dpbmcgZmlyc3QgNDAwMCBvZiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudC5sZW5ndGggK1xuICAgICAgICAgICAgICAgICAgICAgIFwiIGNoYXJhY3RlcnMpXCJcbiAgICAgICAgICAgICAgICAgIDogY29udGVudCxcbiAgICAgICAgICAgICAgICBjb250ZW50RWwsXG4gICAgICAgICAgICAgICAgZmlsZS5wYXRoLFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBtYXJrZG93blByZXZpZXcuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XG4gICAgICAgICAgICAgIGlzTWFya2Rvd25QcmV2aWV3VmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBtYXJrZG93blByZXZpZXcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgbWFya2Rvd24gcHJldmlldzpcIiwgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoaWRlTWFya2Rvd25QcmV2aWV3ID0gKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuZW1wdHkoKTtcbiAgICAgICAgICBpc01hcmtkb3duUHJldmlld1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAvLyBSZXNldCBzY3JvbGwgcG9zaXRpb24gd2hlbiBoaWRpbmdcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBZGQgaG92ZXIgaGFuZGxlcnMgdG8gdGhlIGVudGlyZSBpdGVtIGNvbnRhaW5lclxuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIHNob3dNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgKGUpID0+XG4gICAgICAgICAgdXBkYXRlUHJldmlld1Bvc2l0aW9uKGUsIG1hcmtkb3duUHJldmlldylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBZGQgbW91c2VsZWF2ZSBoYW5kbGVyIHRvIHRoZSBwcmV2aWV3IGl0c2VsZlxuICAgICAgICBtYXJrZG93blByZXZpZXcuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZU1hcmtkb3duUHJldmlldyk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIHByZXZpZXcncyBtb3VzZWxlYXZlIGhhbmRsZXIgb24gdW5sb2FkXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgXCJtb3VzZWxlYXZlXCIsXG4gICAgICAgICAgICBoaWRlTWFya2Rvd25QcmV2aWV3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9yY2UgdGhlIHByZXZpZXcgdG8gaGlkZSB3aGVuZXZlciB0aGUgcG9pbnRlciBsZWF2ZXMgdGhlIHdob2xlIHBhbmVsXG4gICAgICAgIHRoaXMuY29udGV4dFBhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJpbWFnZVwiO1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBoYW5kbGVycyBmb3IgaW1hZ2VzXG4gICAgICAgIGNvbnN0IHNob3dJbWFnZVByZXZpZXcgPSBhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGlmIChpbWFnZUZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoaW1hZ2VGaWxlKTtcbiAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0pO1xuICAgICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5zcmMgPSB1cmw7XG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb24gYW5kIHNpemUgaW1tZWRpYXRlbHkgYWZ0ZXIgaW1hZ2UgbG9hZHNcbiAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbGN1bGF0ZVByZXZpZXdEaW1lbnNpb25zKFxuICAgICAgICAgICAgICAgICAgaW1hZ2VQcmV2aWV3Lm5hdHVyYWxXaWR0aCxcbiAgICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5uYXR1cmFsSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgd2luZG93LmlubmVyV2lkdGgsXG4gICAgICAgICAgICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDtcbiAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3UG9zaXRpb24oZSwgaW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGltYWdlIHByZXZpZXc6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaGlkZUltYWdlUHJldmlldyA9ICgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnNyYyA9IFwiXCI7XG4gICAgICAgICAgLy8gUmVzZXQgZGltZW5zaW9uc1xuICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IFwiXCI7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnN0eWxlLmhlaWdodCA9IFwiXCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIHRvIHRoZSBlbnRpcmUgaXRlbSBjb250YWluZXJcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBzaG93SW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIChlKSA9PlxuICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBpbWFnZVByZXZpZXcpXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQWRkIG1vdXNlbGVhdmUgaGFuZGxlciB0byB0aGUgcHJldmlldyBpdHNlbGZcbiAgICAgICAgaW1hZ2VQcmV2aWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVJbWFnZVByZXZpZXcpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSBwcmV2aWV3J3MgbW91c2VsZWF2ZSBoYW5kbGVyIG9uIHVubG9hZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZUltYWdlUHJldmlldyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvcmNlIHRoZSBwcmV2aWV3IHRvIGhpZGUgd2hlbmV2ZXIgdGhlIHBvaW50ZXIgbGVhdmVzIHRoZSB3aG9sZSBwYW5lbFxuICAgICAgICB0aGlzLmNvbnRleHRQYW5lbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgIH0gZWxzZSBpZiAoW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgaWNvbk5hbWUgPSBcImF1ZGlvLWxpbmVzXCI7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBbXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJwZGZcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJmaWxlXCI7XG4gICAgICB9XG5cbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgaWNvbk5hbWUpO1xuXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQobGlua1RleHQsIFwiXCIsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG1ldGEgPSBpdGVtLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tZXRhXCIgfSk7XG5cbiAgICAgIGNvbnN0IHR5cGUgPSBtZXRhLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10eXBlXCIgfSk7XG4gICAgICB0eXBlLnNldFRleHQoZmlsZS5leHRlbnNpb24udG9VcHBlckNhc2UoKSk7XG5cbiAgICAgIGNvbnN0IG1ldGFHcm91cCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1ldGEtZ3JvdXBcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzaXplID0gbWV0YUdyb3VwLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1zaXplXCIgfSk7XG4gICAgICBzaXplLnNldFRleHQodGhpcy5mb3JtYXRGaWxlU2l6ZShmaWxlLnN0YXQ/LnNpemUgfHwgMCkpO1xuXG4gICAgICBpZiAoZmlsZS5leHRlbnNpb24gPT09IFwibWRcIiB8fCBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ0eHRcIikge1xuICAgICAgICBjb25zdCB0b2tlbkNvdW50ID0gbWV0YUdyb3VwLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXRva2VuLWNvdW50XCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMudG9rZW5Db3VudHMuZ2V0KGZpbGUucGF0aCkgfHwgMDtcbiAgICAgICAgdG9rZW5Db3VudC5zZXRUZXh0KHRoaXMudG9rZW5Db3VudGVyLmZvcm1hdFRva2VuQ291bnQoY291bnQpKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgdG9rZW4gY291bnQgaWYgbm90IGFscmVhZHkgZG9uZVxuICAgICAgICBpZiAoIXRoaXMudG9rZW5Db3VudHMuaGFzKGZpbGUucGF0aCkpIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoZmlsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQoXG4gICAgICAgICAgICAgIHRoaXMudG9rZW5Db3VudGVyLmZvcm1hdFRva2VuQ291bnQoXG4gICAgICAgICAgICAgICAgdGhpcy50b2tlbkNvdW50cy5nZXQoZmlsZS5wYXRoKSB8fCAwXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTW92ZSByZW1vdmUgYnV0dG9uIHRvIHRoZSBlbmRcbiAgICAgIGNvbnN0IHJlbW92ZUJ0biA9IGl0ZW0uY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtLXJlbW92ZVwiLFxuICAgICAgICB0ZXh0OiBcIlx1MDBEN1wiLFxuICAgICAgfSk7XG5cbiAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZW1vdmVDb250ZXh0RmlsZShwYXRoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYWRkQ29udGV4dEZpbGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgQ29udGV4dFNlbGVjdGlvbk1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICBhc3luYyAoZmlsZXM6IFRGaWxlW10pID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICBgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBtb2RhbC5vcGVuKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbW92ZUNvbnRleHRGaWxlKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IGZpbGVQYXRoLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpO1xuICAgIHRoaXMuY29udGV4dEZpbGVzLmRlbGV0ZShmaWxlUGF0aCk7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMuZGVsZXRlKGBbWyR7bm9ybWFsaXplZFBhdGh9XV1gKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHRQYW5lbCgpO1xuICAgIGF3YWl0IHRoaXMub25Db250ZXh0Q2hhbmdlKCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgYWRkRmlsZVRvQ29udGV4dChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZG9jRXh0ZW5zaW9ucyA9IFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCJdO1xuICAgIGNvbnN0IGF1ZGlvRXh0ZW5zaW9ucyA9IFtcIndhdlwiLCBcIm00YVwiLCBcIndlYm1cIiwgXCJvZ2dcIiwgXCJtcDNcIl07XG5cbiAgICAvLyBJZiBmaWxlIGlzIGRvYy1saWtlLCBmdWxseSBwcm9jZXNzIGludG8gZXh0cmFjdGVkIC5tZCBhbmQgcmVmZXJlbmNlIHRoYXRcbiAgICBpZiAoZG9jRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NEb2N1bWVudEZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGF1ZGlvRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NBdWRpb0ZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3JpZ2luYWwgbG9naWMgZm9yIG5vcm1hbCBmaWxlXG4gICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7ZmlsZS5wYXRofV1dYDtcbiAgICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZCh3aWtpTGluayk7XG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgICBhd2FpdCB0aGlzLm9uQ29udGV4dENoYW5nZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzRG9jdW1lbnRGaWxlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSB1cGxvYWRpbmdcbiAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJVcGxvYWRpbmcuLi5cIiwgXCJ1cGxvYWRcIik7XG4gICAgY29uc3QgeyBkb2N1bWVudElkLCBzdGF0dXMsIGNhY2hlZCB9ID1cbiAgICAgIGF3YWl0IHRoaXMuc2N1bHB0U2VydmljZS51cGxvYWREb2N1bWVudChmaWxlKTtcblxuICAgIC8vIElmIGRvY3VtZW50IGlzIGNhY2hlZCwgc2tpcCBwb2xsXG4gICAgaWYgKCFjYWNoZWQpIHtcbiAgICAgIC8vIEluZGljYXRlIHdlJ3JlIHByb2Nlc3NpbmdcbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlByb2Nlc3NpbmcuLi5cIiwgXCJsb2FkZXItMlwiKTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLnBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQpO1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvY3VtZW50IHByb2Nlc3Npbmcgbm90IGNvbXBsZXRlZCBpbiB0aW1lLlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSBkb3dubG9hZGluZyByZXN1bHRzXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiRG93bmxvYWRpbmcgcmVzdWx0cy4uLlwiLCBcImRvd25sb2FkXCIpO1xuICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG5cbiAgICAvLyBDcmVhdGUgc3ViZm9sZGVyIGFuZCAubWQgd2l0aCBleHRyYWN0ZWQgdGV4dCAoc2FtZSBhcyBTeXN0ZW1TY3VscHRDb250ZXh0TWVudSlcbiAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgIGNvbnN0IGJhc2VOYW1lID0gZmlsZS5iYXNlbmFtZS5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgXCItXCIpLnRyaW0oKTtcblxuICAgIC8vIElmIHVzZXIgcHJvdmlkZWQgYSBkaXJlY3RvcnksIGUuZy4gXCJNeUV4dHJhY3Rpb25zXCIsIGJ1aWxkIHBhdGggdGhlcmVcbiAgICAvLyBPdGhlcndpc2UsIGZhbGxiYWNrIHRvIG9yaWdpbmFsOiBmaWxlLnBhcmVudC5wYXRoXG4gICAgY29uc3QgcGFyZW50UGF0aCA9IGV4dHJhY3Rpb25Gb2xkZXJcbiAgICAgID8gYCR7ZXh0cmFjdGlvbkZvbGRlcn0vJHtiYXNlTmFtZX1gXG4gICAgICA6IGAke2ZpbGUucGFyZW50Py5wYXRoID8/IFwiXCJ9LyR7YmFzZU5hbWV9YDtcblxuICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKS5jYXRjaCgoKSA9PiB7XG4gICAgICAvKiBmb2xkZXIgbWF5IGV4aXN0ICovXG4gICAgfSk7XG5cbiAgICBjb25zdCBleHRyYWN0ZWRUZXh0ID0gdGhpcy5nZXRFeHRyYWN0aW9uTWFya2Rvd24oZXh0cmFjdGlvbkRhdGEpO1xuICAgIGNvbnN0IG5ld01kUGF0aCA9IGAke3BhcmVudFBhdGh9LyR7YmFzZU5hbWV9Lm1kYDtcblxuICAgIC8vIFRyeSB0byBjcmVhdGUgdGhlIG1hcmtkb3duIGZpbGUsIGlmIGl0IGV4aXN0cywgd2UnbGwgdXNlIHRoZSBleGlzdGluZyBvbmVcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKG5ld01kUGF0aCwgZXh0cmFjdGVkVGV4dCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZpbGUgZXhpc3RzLCB0aGF0J3Mgb2theSAtIHdlJ2xsIHVzZSBpdFxuICAgICAgaWYgKFxuICAgICAgICAhKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHx8XG4gICAgICAgICFlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiYWxyZWFkeSBleGlzdHNcIilcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgaWYgaXQncyBub3QgYSBcImZpbGUgZXhpc3RzXCIgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgdGhlIG1hcmtkb3duIGZpbGUgdG8gY29udGV4dFxuICAgIGNvbnN0IG1kV2lraUxpbmsgPSBgW1ske25ld01kUGF0aH1dXWA7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMuYWRkKG1kV2lraUxpbmspO1xuXG4gICAgLy8gSGFuZGxlIGltYWdlcyBhbmQgYWRkIHRoZW0gdG8gY29udGV4dFxuICAgIGlmIChleHRyYWN0aW9uRGF0YS5pbWFnZXMgJiYgdHlwZW9mIGV4dHJhY3Rpb25EYXRhLmltYWdlcyA9PT0gXCJvYmplY3RcIikge1xuICAgICAgZm9yIChjb25zdCBbZmlsZW5hbWUsIGJhc2U2NERhdGFdIG9mIE9iamVjdC5lbnRyaWVzKFxuICAgICAgICBleHRyYWN0aW9uRGF0YS5pbWFnZXNcbiAgICAgICkpIHtcbiAgICAgICAgY29uc3QgaW1hZ2VQYXRoID0gYCR7cGFyZW50UGF0aH0vJHtmaWxlbmFtZVxuICAgICAgICAgIC5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgXCItXCIpXG4gICAgICAgICAgLnRyaW0oKX1gO1xuXG4gICAgICAgIC8vIFRyeSB0byBjcmVhdGUgdGhlIGltYWdlIGZpbGUsIGlmIGl0IGV4aXN0cywgd2UnbGwgdXNlIHRoZSBleGlzdGluZyBvbmVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVCaW5hcnkoXG4gICAgICAgICAgICBpbWFnZVBhdGgsXG4gICAgICAgICAgICB0aGlzLmRlY29kZUJhc2U2NChiYXNlNjREYXRhIGFzIHN0cmluZylcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIC8vIEZpbGUgZXhpc3RzLCB0aGF0J3Mgb2theSAtIHdlJ2xsIHVzZSBpdFxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikgfHxcbiAgICAgICAgICAgICFlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiYWxyZWFkeSBleGlzdHNcIilcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyBpZiBpdCdzIG5vdCBhIFwiZmlsZSBleGlzdHNcIiBlcnJvclxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBlYWNoIGltYWdlIHRvIGNvbnRleHRcbiAgICAgICAgY29uc3QgaW1hZ2VXaWtpTGluayA9IGBbWyR7aW1hZ2VQYXRofV1dYDtcbiAgICAgICAgdGhpcy5jb250ZXh0RmlsZXMuYWRkKGltYWdlV2lraUxpbmspO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgcGF0aCB0byB0aGUgbmV3bHkgY3JlYXRlZCAubWRcbiAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJBZGRlZCBzdWNjZXNzZnVsbHkhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgIHJldHVybiBuZXdNZFBhdGg7XG4gIH1cblxuICBwcml2YXRlIGdldEV4dHJhY3Rpb25NYXJrZG93bihleHRyYWN0aW9uRGF0YTogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCB0ZXh0ID0gZXh0cmFjdGlvbkRhdGE/LnRleHQgPz8gXCJcIjtcbiAgICBjb25zdCBtZXRhZGF0YSA9IGV4dHJhY3Rpb25EYXRhPy5tZXRhZGF0YSA/PyB7fTtcbiAgICBjb25zdCBwYWdlQ291bnQgPSBleHRyYWN0aW9uRGF0YT8ucGFnZUNvdW50ID8/IDA7XG4gICAgcmV0dXJuIGAjIERvY3VtZW50IEV4dHJhY3Rpb25cblBhZ2UgQ291bnQ6ICR7cGFnZUNvdW50fVxuXG4ke3RleHR9XG5cbiR7bWV0YWRhdGEgPyBgXFxuIyBNZXRhZGF0YVxcbiR7SlNPTi5zdHJpbmdpZnkobWV0YWRhdGEsIG51bGwsIDIpfWAgOiBcIlwifVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZGVjb2RlQmFzZTY0KGJhc2U2NFN0cmluZzogc3RyaW5nKTogQXJyYXlCdWZmZXIge1xuICAgIGNvbnN0IGJpbmFyeVN0ciA9IHdpbmRvdy5hdG9iKGJhc2U2NFN0cmluZyk7XG4gICAgY29uc3QgbGVuID0gYmluYXJ5U3RyLmxlbmd0aDtcbiAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzLmJ1ZmZlcjtcbiAgfVxuXG4gIHByaXZhdGUgc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgZ2V0Q29udGV4dEZpbGVzKCk6IFNldDxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0RmlsZXM7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2V0Q29udGV4dEZpbGVzKGZpbGVzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuY29udGV4dEZpbGVzID0gbmV3IFNldChmaWxlcyk7XG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgICBhd2FpdCB0aGlzLmNoZWNrU3luY1N0YXR1cygpO1xuICB9XG5cbiAgZ2V0Q29udGFpbmVyKCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0UGFuZWw7XG4gIH1cblxuICB1bmxvYWQoKTogdm9pZCB7XG4gICAgLy8gQ2xlYXIgYWxsIHByb2Nlc3NpbmcgdGltZW91dHNcbiAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5mb3JFYWNoKCh0aW1lb3V0KSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgfSk7XG4gICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuY2xlYXIoKTtcblxuICAgIC8vIENsZWFyIGFsbCBwcm9jZXNzaW5nIHN0YXR1c2VzXG4gICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuZm9yRWFjaCgoc3RhdHVzRWwpID0+IHtcbiAgICAgIHN0YXR1c0VsLnJlbW92ZSgpO1xuICAgIH0pO1xuICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmNsZWFyKCk7XG5cbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nU3RhdHVzKSB7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cblxuICAgIHRoaXMuZHJhd2VyLnVubG9hZCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzQXVkaW9GaWxlKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIHRpbWVzdGFtcGVkOiBib29sZWFuID0gZmFsc2VcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSB0cmFuc2NyaWJpbmdcbiAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJUcmFuc2NyaWJpbmcgYXVkaW8uLi5cIiwgXCJsb2FkZXItMlwiKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgVHJhbnNjcmlwdGlvblNlcnZpY2UgZGlyZWN0bHlcbiAgICAgIGNvbnN0IHRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICAgIHRoaXMucGx1Z2luXG4gICAgICApO1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHRyYW5zY3JpcHRpb25TZXJ2aWNlLnRyYW5zY3JpYmVGaWxlKGZpbGUsIHtcbiAgICAgICAgdHlwZTogXCJub3RlXCIsXG4gICAgICAgIHRpbWVzdGFtcGVkLFxuICAgICAgICBvblByb2dyZXNzOiAocHJvZ3Jlc3MsIHN0YXR1cykgPT4ge1xuICAgICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBzdGF0dXMsIFwibG9hZGVyLTJcIik7XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIHN1YmZvbGRlciArIC5tZCB3aXRoIHRyYW5zY3JpYmVkIHRleHRcbiAgICAgIGNvbnN0IGV4dHJhY3Rpb25Gb2xkZXIgPSB0aGlzLnNjdWxwdFNlcnZpY2UuZXh0cmFjdGlvbnNEaXJlY3Rvcnk7XG4gICAgICBjb25zdCBiYXNlTmFtZSA9IGZpbGUuYmFzZW5hbWUucmVwbGFjZSgvW1xcXFwvOio/XCI8PnxdL2csIFwiLVwiKS50cmltKCk7XG4gICAgICBjb25zdCBwYXJlbnRQYXRoID0gZXh0cmFjdGlvbkZvbGRlclxuICAgICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgICA6IGAke2ZpbGUucGFyZW50Py5wYXRoID8/IFwiXCJ9LyR7YmFzZU5hbWV9YDtcblxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKHBhcmVudFBhdGgpLmNhdGNoKCgpID0+IHt9KTtcblxuICAgICAgY29uc3Qgb3V0cHV0UGF0aCA9IGAke3BhcmVudFBhdGh9LyR7YmFzZU5hbWV9Lm1kYDtcbiAgICAgIGNvbnN0IGZpbmFsQ29udGVudCA9IGAjIEF1ZGlvIFRyYW5zY3JpcHRpb25cblNvdXJjZTogJHtmaWxlLmJhc2VuYW1lfVxuVHJhbnNjcmliZWQ6ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4ke3RleHR9YDtcblxuICAgICAgLy8gVHJ5IGNyZWF0aW5nIHRoZSAubWRcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChvdXRwdXRQYXRoKTtcbiAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGV4aXN0aW5nRmlsZSwgZmluYWxDb250ZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUob3V0cHV0UGF0aCwgZmluYWxDb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZpbGUgb3BlcmF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiQWRkZWQgc3VjY2Vzc2Z1bGx5IVwiLCBcImNoZWNrLWNpcmNsZVwiKTtcbiAgICAgIHJldHVybiBvdXRwdXRQYXRoO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQXVkaW8gdHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICBmaWxlLFxuICAgICAgICBgRXJyb3I6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIFwieC1jaXJjbGVcIlxuICAgICAgKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcG9sbFVudGlsQ29tcGxldGUoZG9jdW1lbnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgbWF4VHJpZXMgPSA1MDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1heFRyaWVzOyBpKyspIHtcbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMzAwMCk7XG4gICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL2RvY3VtZW50cy8ke2RvY3VtZW50SWR9YDtcbiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgICAgaWYgKCFyZXNwLm9rKSBjb250aW51ZTtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwLmpzb24oKTtcbiAgICAgIGlmIChkYXRhPy5kYXRhPy5zdGF0dXMgPT09IFwiY29tcGxldGVkXCIpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGRhdGE/LmRhdGE/LnN0YXR1cyA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhPy5kYXRhPy5lcnJvciB8fCBcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRvd25sb2FkRXh0cmFjdGlvbihkb2N1bWVudElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL2RvY3VtZW50cy8ke2RvY3VtZW50SWR9L2Rvd25sb2FkYDtcbiAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICBpZiAoIXJlc3Aub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRG93bmxvYWQgZXh0cmFjdGlvbiBmYWlsZWQ6ICR7cmVzcC5zdGF0dXN9YCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwLmpzb24oKTtcbiAgICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IgfHwgXCJGYWlsZWQgdG8gZG93bmxvYWQgZXh0cmFjdGlvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEuZGF0YS5leHRyYWN0aW9uUmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuQ291bnRlci5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNhbGN1bGF0aW5nIHRva2VucyBmb3IgZmlsZTpcIiwgZmlsZS5wYXRoLCBlcnJvcik7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVRva2VuQ291bnQoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb3VudCA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlKTtcbiAgICB0aGlzLnRva2VuQ291bnRzLnNldChmaWxlLnBhdGgsIGNvdW50KTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGJ5dGVzIDwgMTAyNCkgcmV0dXJuIGJ5dGVzICsgXCIgQlwiO1xuICAgIGNvbnN0IGtiID0gYnl0ZXMgLyAxMDI0O1xuICAgIGlmIChrYiA8IDEwMjQpIHJldHVybiBrYi50b0ZpeGVkKDEpICsgXCIgS0JcIjtcbiAgICBjb25zdCBtYiA9IGtiIC8gMTAyNDtcbiAgICByZXR1cm4gbWIudG9GaXhlZCgxKSArIFwiIE1CXCI7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSB9IGZyb20gXCJzcmMvc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVG9rZW5Db3VudGVyU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9Ub2tlbkNvdW50ZXJTZXJ2aWNlXCI7XG5cbmludGVyZmFjZSBTZWFyY2hNYXRjaCB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgaW5kaWNlczogbnVtYmVyW107XG4gIG1hdGNoUXVhbGl0eTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU2VhcmNoUmVzdWx0PFQ+IHtcbiAgaXRlbTogVDtcbiAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXTtcbiAgc2NvcmU6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIENvbnRleHRDYXJkIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgcGF0aDogc3RyaW5nO1xuICBzaXplOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIENvbnRleHRTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlO1xuICBwcml2YXRlIHRva2VuQ291bnRlcjogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChmaWxlczogVEZpbGVbXSkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBmaWxlczogVEZpbGVbXTtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSByZXN1bHRzQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXJyZW50U2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PFRGaWxlPltdID0gW107XG4gIHByaXZhdGUgbG9hZGluZ0luZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgZW1wdHlTdGF0ZTogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoVGltZW91dDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2VsZWN0ZWRFeHRlbnNpb25zOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBleHRlbnNpb25CdXR0b25zOiBNYXA8c3RyaW5nLCBIVE1MRWxlbWVudD4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgc2VsZWN0ZWRGaWxlczogU2V0PFRGaWxlPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBzZWxlY3RlZEluZGV4ID0gMDtcbiAgcHJpdmF0ZSByZXN1bHRFbGVtZW50czogSFRNTEVsZW1lbnRbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblNlbGVjdDogKGZpbGVzOiBURmlsZVtdKSA9PiB2b2lkKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgICB0aGlzLnRva2VuQ291bnRlciA9IFRva2VuQ291bnRlclNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcbiAgICB0aGlzLmZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKTtcbiAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5hZGQoXCJtZFwiKTsgLy8gRGVmYXVsdCB0byBNYXJrZG93biBmaWx0ZXJcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VhcmNoRmllbGRzKGZpbGU6IFRGaWxlKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHsgZmllbGQ6IFwidGl0bGVcIiwgdGV4dDogZmlsZS5iYXNlbmFtZSwgd2VpZ2h0OiAxMDAgfSxcbiAgICAgIHsgZmllbGQ6IFwicGF0aFwiLCB0ZXh0OiBmaWxlLnBhdGgsIHdlaWdodDogNzUgfSxcbiAgICAgIHsgZmllbGQ6IFwiZXh0ZW5zaW9uXCIsIHRleHQ6IGZpbGUuZXh0ZW5zaW9uLCB3ZWlnaHQ6IDUwIH0sXG4gICAgXTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGJ5dGVzIDwgMTAyNCkgcmV0dXJuIGJ5dGVzICsgXCIgQlwiO1xuICAgIGNvbnN0IGtiID0gYnl0ZXMgLyAxMDI0O1xuICAgIGlmIChrYiA8IDEwMjQpIHJldHVybiBrYi50b0ZpeGVkKDEpICsgXCIgS0JcIjtcbiAgICBjb25zdCBtYiA9IGtiIC8gMTAyNDtcbiAgICByZXR1cm4gbWIudG9GaXhlZCgxKSArIFwiIE1CXCI7XG4gIH1cblxuICBwcml2YXRlIGhpZ2hsaWdodFRleHQoXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXVxuICApOiBEb2N1bWVudEZyYWdtZW50IHtcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoKTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dCk7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBjcmVhdGVGcmFnbWVudCgpO1xuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dD8udmFsdWUgfHwgXCJcIjtcblxuICAgIC8vIFVzZSByZWdleCB0byBmaW5kIHdob2xlIHdvcmQgb3IgcGhyYXNlIG1hdGNoZXNcbiAgICBjb25zdCBub3JtYWxpemVkUXVlcnkgPSBzZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYCgke25vcm1hbGl6ZWRRdWVyeX0pYCwgXCJnaVwiKTtcbiAgICBsZXQgbGFzdEluZGV4ID0gMDtcbiAgICBsZXQgbWF0Y2g7XG5cbiAgICB3aGlsZSAoKG1hdGNoID0gcmVnZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcbiAgICAgIC8vIEFkZCBub24taGlnaGxpZ2h0ZWQgdGV4dCBiZWZvcmUgbWF0Y2hcbiAgICAgIGlmIChtYXRjaC5pbmRleCA+IGxhc3RJbmRleCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4LCBtYXRjaC5pbmRleCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgaGlnaGxpZ2h0ZWQgbWF0Y2hcbiAgICAgIGNvbnN0IHNwYW4gPSBmcmFnbWVudC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1oaWdobGlnaHRcIixcbiAgICAgICAgdGV4dDogbWF0Y2hbMF0sXG4gICAgICB9KTtcblxuICAgICAgbGFzdEluZGV4ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgfVxuXG4gICAgaWYgKGxhc3RJbmRleCA8IHRleHQubGVuZ3RoKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZyYWdtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVMb2FkaW5nSW5kaWNhdG9yKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbG9hZGluZ1wiIH0pO1xuICAgIHNldEljb24oY29udGFpbmVyLCBcImxvYWRlci0yXCIpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVTcGFuKHsgdGV4dDogXCJMb2FkaW5nLi4uXCIgfSkpO1xuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUVtcHR5U3RhdGUoKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1lbXB0eVwiIH0pO1xuICAgIHNldEljb24oY29udGFpbmVyLCBcInNlYXJjaFwiKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlU3Bhbih7IHRleHQ6IFwiTm8gbWF0Y2hpbmcgZmlsZXMgZm91bmRcIiB9KSk7XG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiIHx8IGZpbGUuZXh0ZW5zaW9uID09PSBcInR4dFwiKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICByZXR1cm4gdGhpcy50b2tlbkNvdW50ZXIuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxjdWxhdGluZyB0b2tlbnMgZm9yIGZpbGU6XCIsIGZpbGUucGF0aCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZSk7XG4gICAgdGhpcy50b2tlbkNvdW50cy5zZXQoZmlsZS5wYXRoLCBjb3VudCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNhcmQoZmlsZTogVEZpbGUsIHJlc3VsdDogU2VhcmNoUmVzdWx0PFRGaWxlPik6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWNhcmRcIiB9KTtcbiAgICBjYXJkLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMFwiKTtcbiAgICBjb25zdCBjYXJkQ29udGVudCA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jYXJkLWNvbnRlbnRcIiB9KTtcblxuICAgIC8vIEFkZCB0aHVtYm5haWwgZm9yIGltYWdlIGZpbGVzXG4gICAgaWYgKGZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9wbmd8anBlP2d8Z2lmfHN2Z3x3ZWJwL2kpKSB7XG4gICAgICBjb25zdCB0aHVtYkNvbnRhaW5lciA9IGNhcmRDb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10aHVtYm5haWxcIixcbiAgICAgIH0pO1xuXG4gICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZEJpbmFyeShmaWxlKTtcbiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2FycmF5QnVmZmVyXSk7XG4gICAgICAgICAgY29uc3Qgb2JqZWN0VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcblxuICAgICAgICAgIGNvbnN0IGltZyA9IHRodW1iQ29udGFpbmVyLmNyZWF0ZUVsKFwiaW1nXCIsIHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10aHVtYi1pbWdcIixcbiAgICAgICAgICAgIGF0dHI6IHsgc3JjOiBvYmplY3RVcmwgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgdGh1bWJuYWlsOlwiLCBlcnIpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuaGFzKGZpbGUpKSB7XG4gICAgICBjYXJkLmFkZENsYXNzKFwiaXMtYWRkZWRcIik7XG4gICAgICBjb25zdCBjaGVja0ljb24gPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1jaGVja1wiIH0pO1xuICAgICAgc2V0SWNvbihjaGVja0ljb24sIFwiY2hlY2tcIik7XG4gICAgfVxuXG4gICAgY29uc3QgdGV4dENvbnRhaW5lciA9IGNhcmRDb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNhcmQtdGV4dFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGl0bGUgPSB0ZXh0Q29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdGl0bGVcIixcbiAgICB9KTtcbiAgICB0aXRsZS5hcHBlbmRDaGlsZChcbiAgICAgIHRoaXMuaGlnaGxpZ2h0VGV4dChcbiAgICAgICAgZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgcmVzdWx0Lm1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcInRpdGxlXCIpXG4gICAgICApXG4gICAgKTtcblxuICAgIGNvbnN0IHBhdGggPSB0ZXh0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1wYXRoXCIgfSk7XG4gICAgcGF0aC5hcHBlbmRDaGlsZChcbiAgICAgIHRoaXMuaGlnaGxpZ2h0VGV4dChcbiAgICAgICAgZmlsZS5wYXRoLFxuICAgICAgICByZXN1bHQubWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwicGF0aFwiKVxuICAgICAgKVxuICAgICk7XG5cbiAgICBjb25zdCBtZXRhID0gdGV4dENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbWV0YVwiIH0pO1xuXG4gICAgY29uc3QgdHlwZSA9IG1ldGEuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXR5cGVcIiB9KTtcbiAgICB0eXBlLnNldFRleHQoZmlsZS5leHRlbnNpb24udG9VcHBlckNhc2UoKSk7XG5cbiAgICBjb25zdCBtZXRhR3JvdXAgPSBtZXRhLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbWV0YS1ncm91cFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2l6ZSA9IG1ldGFHcm91cC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZVwiIH0pO1xuICAgIHNpemUuc2V0VGV4dCh0aGlzLmZvcm1hdEZpbGVTaXplKGZpbGUuc3RhdD8uc2l6ZSB8fCAwKSk7XG5cbiAgICBpZiAoZmlsZS5leHRlbnNpb24gPT09IFwibWRcIiB8fCBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ0eHRcIikge1xuICAgICAgY29uc3QgdG9rZW5Db3VudEVsID0gbWV0YUdyb3VwLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10b2tlbi1jb3VudFwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBmaWxlU2l6ZSA9IGZpbGUuc3RhdD8uc2l6ZSA/PyAwO1xuXG4gICAgICBpZiAoZmlsZVNpemUgPT09IDApIHtcbiAgICAgICAgdG9rZW5Db3VudEVsLnNldFRleHQoXCJFbXB0eVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy50b2tlbkNvdW50cy5nZXQoZmlsZS5wYXRoKSB8fCAwO1xuICAgICAgICB0b2tlbkNvdW50RWwuc2V0VGV4dCh0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KGNvdW50KSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLnRva2VuQ291bnRzLmhhcyhmaWxlLnBhdGgpKSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVUb2tlbkNvdW50KGZpbGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdG9rZW5Db3VudEVsLnNldFRleHQoXG4gICAgICAgICAgICAgIHRoaXMudG9rZW5Db3VudGVyLmZvcm1hdFRva2VuQ291bnQoXG4gICAgICAgICAgICAgICAgdGhpcy50b2tlbkNvdW50cy5nZXQoZmlsZS5wYXRoKSB8fCAwXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLnRvZ2dsZUZpbGVTZWxlY3Rpb24oZmlsZSwgY2FyZCk7XG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZXN1bHRFbGVtZW50cy5pbmRleE9mKGNhcmQpO1xuICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBjYXJkO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFJlc3VsdCgpIHtcbiAgICB0aGlzLnJlc3VsdEVsZW1lbnRzLmZvckVhY2goKGVsLCBpbmRleCkgPT4ge1xuICAgICAgZWwudG9nZ2xlQ2xhc3MoXG4gICAgICAgIFwiaXMtc2VsZWN0ZWRcIixcbiAgICAgICAgaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRJbmRleCAmJiB0aGlzLnNlbGVjdGVkSW5kZXggPj0gMFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA+PSAwICYmXG4gICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPCB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aFxuICAgICkge1xuICAgICAgdGhpcy5yZXN1bHRFbGVtZW50c1t0aGlzLnNlbGVjdGVkSW5kZXhdLnNjcm9sbEludG9WaWV3KHtcbiAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgIGJsb2NrOiBcIm5lYXJlc3RcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdG9nZ2xlRmlsZVNlbGVjdGlvbihmaWxlOiBURmlsZSwgY2FyZEVsOiBIVE1MRWxlbWVudCkge1xuICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuaGFzKGZpbGUpKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRmlsZXMuZGVsZXRlKGZpbGUpO1xuICAgICAgY2FyZEVsLnJlbW92ZUNsYXNzKFwiaXMtYWRkZWRcIik7XG4gICAgICBjYXJkRWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtY29udGV4dC1jaGVja1wiKT8ucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcy5hZGQoZmlsZSk7XG4gICAgICBjYXJkRWwuYWRkQ2xhc3MoXCJpcy1hZGRlZFwiKTtcbiAgICAgIGNvbnN0IGNoZWNrSWNvbiA9IGNhcmRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtY2hlY2tcIiB9KTtcbiAgICAgIHNldEljb24oY2hlY2tJY29uLCBcImNoZWNrXCIpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUFjdGlvbkJ1dHRvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVBY3Rpb25CdXR0b24oKSB7XG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gdGhpcy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuc3lzdGVtc2N1bHB0LWNvbnRleHQtYWN0aW9uLWJ1dHRvblwiXG4gICAgKTtcbiAgICBpZiAoYWN0aW9uQnV0dG9uKSB7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXMuc2VsZWN0ZWRGaWxlcy5zaXplO1xuICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXG4gICAgICAgIGNvdW50ID4gMFxuICAgICAgICAgID8gYEFkZCAke2NvdW50fSBzZWxlY3RlZCBmaWxlJHtjb3VudCA9PT0gMSA/IFwiXCIgOiBcInNcIn1gXG4gICAgICAgICAgOiBcIlNlbGVjdCBmaWxlcyB0byBhZGQgYXMgY29udGV4dFwiXG4gICAgICApO1xuICAgICAgYWN0aW9uQnV0dG9uLnRvZ2dsZUNsYXNzKFwiaXMtYWN0aXZlXCIsIGNvdW50ID4gMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJSZXN1bHRzKHNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxURmlsZT5bXSkge1xuICAgIHRoaXMucmVzdWx0c0NvbnRhaW5lci5lbXB0eSgpO1xuICAgIHRoaXMucmVzdWx0RWxlbWVudHMgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzID0gc2VhcmNoUmVzdWx0cztcblxuICAgIGlmIChzZWFyY2hSZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5lbXB0eVN0YXRlLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgZ3JpZCA9IHRoaXMucmVzdWx0c0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWdyaWRcIixcbiAgICB9KTtcblxuICAgIHNlYXJjaFJlc3VsdHMuZm9yRWFjaCgocmVzdWx0LCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IHRoaXMuY3JlYXRlQ2FyZChyZXN1bHQuaXRlbSwgcmVzdWx0KTtcbiAgICAgIGdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICB0aGlzLnJlc3VsdEVsZW1lbnRzLnB1c2goY2FyZCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFVuaXF1ZUV4dGVuc2lvbnMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGV4dGVuc2lvbnMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICB0aGlzLmZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbikge1xuICAgICAgICBleHRlbnNpb25zLmFkZChmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShleHRlbnNpb25zKS5zb3J0KCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUV4dGVuc2lvbkJ1dHRvbihleHRlbnNpb246IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBidXR0b24gPSBjcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24tYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBleHRlbnNpb24udG9VcHBlckNhc2UoKSxcbiAgICB9KTtcblxuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmhhcyhleHRlbnNpb24pKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmRlbGV0ZShleHRlbnNpb24pO1xuICAgICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJpcy1zZWxlY3RlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmFkZChleHRlbnNpb24pO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJpcy1zZWxlY3RlZFwiKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wZXJmb3JtU2VhcmNoKHRoaXMuc2VhcmNoSW5wdXQudmFsdWUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGJ1dHRvbjtcbiAgfVxuXG4gIHByaXZhdGUgcGVyZm9ybVNlYXJjaChxdWVyeTogc3RyaW5nKSB7XG4gICAgbGV0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgdGhpcy5maWxlcy5maWx0ZXIoXG4gICAgICAgIChmaWxlKSA9PlxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLnNpemUgPT09IDAgfHxcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5oYXMoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSlcbiAgICAgICksXG4gICAgICBxdWVyeSxcbiAgICAgIChmaWxlKSA9PiB0aGlzLmdldFNlYXJjaEZpZWxkcyhmaWxlKVxuICAgICk7XG5cbiAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICByZXR1cm4gYS5pdGVtLmJhc2VuYW1lLmxvY2FsZUNvbXBhcmUoYi5pdGVtLmJhc2VuYW1lKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyUmVzdWx0cyhyZXN1bHRzKTtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tb2RhbFwiKTtcblxuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXNlYXJjaFwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmaWxlcyB0byBhZGQgYXMgY29udGV4dC4uLlwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZXh0ZW5zaW9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGV4dGVuc2lvbnMgPSB0aGlzLmdldFVuaXF1ZUV4dGVuc2lvbnMoKTtcbiAgICBleHRlbnNpb25zLmZvckVhY2goKGV4dCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5jcmVhdGVFeHRlbnNpb25CdXR0b24oZXh0KTtcbiAgICAgIHRoaXMuZXh0ZW5zaW9uQnV0dG9ucy5zZXQoZXh0LCBidXR0b24pO1xuICAgICAgZXh0ZW5zaW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgfSk7XG5cbiAgICAvLyBNYXJrIE1EIGJ1dHRvbiBhcyBzZWxlY3RlZCBieSBkZWZhdWx0XG4gICAgY29uc3QgbWRCdG4gPSB0aGlzLmV4dGVuc2lvbkJ1dHRvbnMuZ2V0KFwibWRcIik7XG4gICAgaWYgKG1kQnRuKSBtZEJ0bi5hZGRDbGFzcyhcImlzLXNlbGVjdGVkXCIpO1xuXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gdGhpcy5jcmVhdGVMb2FkaW5nSW5kaWNhdG9yKCk7XG4gICAgY29udGVudEVsLmFwcGVuZENoaWxkKHRoaXMubG9hZGluZ0luZGljYXRvcik7XG5cbiAgICB0aGlzLmVtcHR5U3RhdGUgPSB0aGlzLmNyZWF0ZUVtcHR5U3RhdGUoKTtcbiAgICB0aGlzLmVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIGNvbnRlbnRFbC5hcHBlbmRDaGlsZCh0aGlzLmVtcHR5U3RhdGUpO1xuXG4gICAgY29uc3Qgc2Nyb2xsQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNjcm9sbC1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICB0aGlzLnJlc3VsdHNDb250YWluZXIgPSBzY3JvbGxDb250YWluZXIuY3JlYXRlRGl2KCk7XG5cbiAgICBjb25zdCBhY3Rpb25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYWN0aW9uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gYWN0aW9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1hY3Rpb24tYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBcIlNlbGVjdCBmaWxlcyB0byBhZGQgYXMgY29udGV4dFwiLFxuICAgIH0pO1xuXG4gICAgYWN0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICAgIHRoaXMub25TZWxlY3QoQXJyYXkuZnJvbSh0aGlzLnNlbGVjdGVkRmlsZXMpKTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVBY3Rpb25CdXR0b24oKTtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgdGhpcy5yZXN1bHRzQ29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLnNlYXJjaElucHV0KSByZXR1cm47XG4gICAgICBpZiAodGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAoZS5zaGlmdEtleSAmJiB0aGlzLnNlbGVjdGVkSW5kZXggPT09IDApIHtcbiAgICAgICAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPVxuICAgICAgICAgICAgKHRoaXMuc2VsZWN0ZWRJbmRleCAtIDEgKyB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCkgJVxuICAgICAgICAgICAgdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID1cbiAgICAgICAgICAgICh0aGlzLnNlbGVjdGVkSW5kZXggKyAxKSAlIHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoZS5jb2RlID09PSBcIlNwYWNlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLml0ZW07XG4gICAgICAgIGNvbnN0IGNhcmRFbCA9IHRoaXMucmVzdWx0RWxlbWVudHNbdGhpcy5zZWxlY3RlZEluZGV4XTtcbiAgICAgICAgdGhpcy50b2dnbGVGaWxlU2VsZWN0aW9uKGZpbGUsIGNhcmRFbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICAgICAgdGhpcy5vblNlbGVjdChBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRGaWxlcykpO1xuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG5cbiAgICB0aGlzLnBlcmZvcm1TZWFyY2goXCJcIik7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGlmICh0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgLy8gU0hJRlQrVGFiID0+IGZvY3VzIGxhc3QgcmVzdWx0XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG5vcm1hbCBUYWIgPT4gZm9jdXMgZmlyc3QgcmVzdWx0XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUmVzdWx0KCk7XG4gICAgICAgICAgdGhpcy5yZXN1bHRFbGVtZW50c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJlc3VsdCgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VhcmNoVGltZW91dCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoVGltZW91dCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2VhcmNoVGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlO1xuXG4gICAgICAgIGxldCByZXN1bHRzID0gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaChcbiAgICAgICAgICB0aGlzLmZpbGVzLmZpbHRlcihcbiAgICAgICAgICAgIChmaWxlKSA9PlxuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5zaXplID09PSAwIHx8XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmhhcyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICksXG4gICAgICAgICAgcXVlcnksXG4gICAgICAgICAgKGZpbGUpID0+IHRoaXMuZ2V0U2VhcmNoRmllbGRzKGZpbGUpXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgICAgICAgICByZXR1cm4gYS5pdGVtLmJhc2VuYW1lLmxvY2FsZUNvbXBhcmUoYi5pdGVtLmJhc2VuYW1lKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJSZXN1bHRzKHJlc3VsdHMpO1xuICAgICAgfSwgMTUwKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgaWYgKHRoaXMuc2VhcmNoVGltZW91dCkge1xuICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnNlYXJjaFRpbWVvdXQpO1xuICAgIH1cbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDaGF0U3RvcmFnZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7IENIQVRfVklFV19UWVBFIH0gZnJvbSBcIi4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5cbmludGVyZmFjZSBDaGF0SGlzdG9yeUl0ZW0ge1xuICBpZDogc3RyaW5nO1xuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICB0aXRsZTogc3RyaW5nO1xuICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU2VhcmNoTWF0Y2gge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIGluZGljZXM6IG51bWJlcltdO1xuICBtYXRjaFF1YWxpdHk6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFNlYXJjaFJlc3VsdDxUPiB7XG4gIGl0ZW06IFQ7XG4gIG1hdGNoZXM6IFNlYXJjaE1hdGNoW107XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBMb2FkQ2hhdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIGNoYXRJdGVtczogQ2hhdEhpc3RvcnlJdGVtW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENoYXRJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChjaGF0SWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjaGF0R3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENhcmRJbmRleDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBjaGF0Q2FyZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBjdXJyZW50U2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PENoYXRIaXN0b3J5SXRlbT5bXSA9IFtdO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGlzS2V5Ym9hcmROYXZBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBjaGF0U3RvcmFnZTogQ2hhdFN0b3JhZ2VTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIG9uU2VsZWN0OiAoY2hhdElkOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgICB0aGlzLmNoYXRTdG9yYWdlID0gbmV3IENoYXRTdG9yYWdlU2VydmljZShcbiAgICAgIGFwcCxcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFNlYXJjaEZpZWxkcyhpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pIHtcbiAgICBjb25zdCBhbGxDb250ZW50ID0gaXRlbS5tZXNzYWdlc1xuICAgICAgLm1hcCgobXNnKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIGNvbnN0IHByb21wdExhYmVsID0gYXdhaXQgdGhpcy5nZXRQcm9tcHRMYWJlbChpdGVtKTtcblxuICAgIC8vIEdldCBhbGwgc2VhcmNoIHRlcm1zIGlmIHRoZXJlJ3MgYSBzZWFyY2hcbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9XG4gICAgICB0aGlzLnNlYXJjaElucHV0Py52YWx1ZT8udG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKSB8fCBbXTtcblxuICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IFtcbiAgICAgIC8vIE1haW4gY29udGVudCBmaWVsZCB3aXRoIGhpZ2hlc3Qgd2VpZ2h0XG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcImNvbnRlbnRcIixcbiAgICAgICAgdGV4dDogYWxsQ29udGVudCxcbiAgICAgICAgd2VpZ2h0OiAyMDAsXG4gICAgICB9LFxuXG4gICAgICAvLyBJbmRpdmlkdWFsIG1lc3NhZ2UgcGFydHMgZm9yIHBhcnRpYWwgbWF0Y2hlc1xuICAgICAgLi4uYWxsQ29udGVudC5zcGxpdCgvW1xcc1xcLTpcXC5dKy8pLm1hcCgocGFydCkgPT4gKHtcbiAgICAgICAgZmllbGQ6IFwiY29udGVudFwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDEwMCxcbiAgICAgIH0pKSxcblxuICAgICAgLy8gTW9kZWwgbmFtZSBhcyBzZWFyY2hhYmxlIGZpZWxkXG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcIm1vZGVsXCIsXG4gICAgICAgIHRleHQ6IGF3YWl0IHRoaXMuZ2V0TW9kZWxOYW1lKGl0ZW0uc2VsZWN0ZWRNb2RlbElkKSxcbiAgICAgICAgd2VpZ2h0OiAxODAsXG4gICAgICB9LFxuXG4gICAgICAvLyBQcm9tcHQgbmFtZSBhcyBzZWFyY2hhYmxlIGZpZWxkXG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcInByb21wdFwiLFxuICAgICAgICB0ZXh0OiBwcm9tcHRMYWJlbCxcbiAgICAgICAgd2VpZ2h0OiAxODAsXG4gICAgICB9LFxuXG4gICAgICAvLyBJbmRpdmlkdWFsIHByb21wdCBwYXJ0c1xuICAgICAgLi4ucHJvbXB0TGFiZWwuc3BsaXQoL1tcXHNcXC1fXSsvKS5tYXAoKHBhcnQpID0+ICh7XG4gICAgICAgIGZpZWxkOiBcInByb21wdFwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDE1MCxcbiAgICAgIH0pKSxcbiAgICBdO1xuXG4gICAgLy8gSWYgd2UgaGF2ZSBtdWx0aXBsZSBzZWFyY2ggdGVybXMsIGFkZCBhZGRpdGlvbmFsIGZpZWxkcyBmb3IgbXVsdGktdGVybSBtYXRjaGVzXG4gICAgaWYgKHNlYXJjaFRlcm1zLmxlbmd0aCA+IDEpIHtcbiAgICAgIC8vIExvb2sgZm9yIGNvbnNlY3V0aXZlIHRlcm1zXG4gICAgICBjb25zdCBhbGxDb250ZW50TG93ZXIgPSBhbGxDb250ZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlYXJjaFRlcm1zLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICBjb25zdCB0ZXJtMSA9IHNlYXJjaFRlcm1zW2ldO1xuICAgICAgICBjb25zdCB0ZXJtMiA9IHNlYXJjaFRlcm1zW2kgKyAxXTtcblxuICAgICAgICAvLyBGaW5kIGFsbCBvY2N1cnJlbmNlcyBvZiBmaXJzdCB0ZXJtXG4gICAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgICB3aGlsZSAoKHBvcyA9IGFsbENvbnRlbnRMb3dlci5pbmRleE9mKHRlcm0xLCBwb3MpKSAhPT0gLTEpIHtcbiAgICAgICAgICAvLyBMb29rIGZvciBzZWNvbmQgdGVybSB3aXRoaW4gcmVhc29uYWJsZSBkaXN0YW5jZVxuICAgICAgICAgIGNvbnN0IG5leHRQb3MgPSBhbGxDb250ZW50TG93ZXIuaW5kZXhPZih0ZXJtMiwgcG9zKTtcbiAgICAgICAgICBpZiAobmV4dFBvcyAhPT0gLTEgJiYgbmV4dFBvcyAtIChwb3MgKyB0ZXJtMS5sZW5ndGgpIDwgMzApIHtcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgcGhyYXNlIGFzIGEgaGlnaC13ZWlnaHQgZmllbGRcbiAgICAgICAgICAgIHNlYXJjaEZpZWxkcy5wdXNoKHtcbiAgICAgICAgICAgICAgZmllbGQ6IFwiY29udGVudFwiLFxuICAgICAgICAgICAgICB0ZXh0OiBhbGxDb250ZW50LnNsaWNlKHBvcywgbmV4dFBvcyArIHRlcm0yLmxlbmd0aCksXG4gICAgICAgICAgICAgIHdlaWdodDogMzAwLCAvLyBIaWdoZXIgd2VpZ2h0IGZvciBuZWFyYnkgdGVybXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb3MrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzZWFyY2hGaWVsZHM7XG4gIH1cblxuICBwcml2YXRlIGdldE1lc3NhZ2VDb250ZW50KG1lc3NhZ2U6IENoYXRNZXNzYWdlKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG1lc3NhZ2UuY29udGVudDtcbiAgICB9XG4gICAgLy8gRm9yIGltYWdlIGNvbnRlbnQsIHdlJ2xsIHJldHVybiBhIHBsYWNlaG9sZGVyXG4gICAgcmV0dXJuIFwiSW1hZ2UgbWVzc2FnZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSBmaW5kQWxsSW5kaWNlcyh0ZXh0OiBzdHJpbmcsIHNlYXJjaFRlcm06IHN0cmluZyk6IG51bWJlcltdIHtcbiAgICBjb25zdCBpbmRpY2VzOiBudW1iZXJbXSA9IFtdO1xuICAgIGxldCBjdXJyZW50SW5kZXggPSAwO1xuICAgIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKTtcblxuICAgIHdoaWxlIChjdXJyZW50SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgY29uc3QgaW5kZXggPSB0ZXh0LmluZGV4T2Yoc2VhcmNoVGVybSwgY3VycmVudEluZGV4KTtcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIGJyZWFrO1xuICAgICAgaW5kaWNlcy5wdXNoKGluZGV4KTtcbiAgICAgIGN1cnJlbnRJbmRleCA9IGluZGV4ICsgMTsgLy8gTW92ZSBwYXN0IGN1cnJlbnQgbWF0Y2ggdG8gZmluZCBuZXh0XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNZXNzYWdlUHJldmlldyhcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogeyB0ZXh0OiBzdHJpbmc7IHByZXZpZXdTdGFydDogbnVtYmVyIH0ge1xuICAgIC8vIElmIG5vIG1hdGNoZXMsIHNob3cgdGhlIGxhc3QgbWVzc2FnZSBhcyBkZWZhdWx0IHByZXZpZXdcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gbWVzc2FnZXNbbWVzc2FnZXMubGVuZ3RoIC0gMV07XG4gICAgICBpZiAoIWxhc3RNZXNzYWdlKSByZXR1cm4geyB0ZXh0OiBcIlwiLCBwcmV2aWV3U3RhcnQ6IDAgfTtcbiAgICAgIHJldHVybiB7IHRleHQ6IHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobGFzdE1lc3NhZ2UpLCBwcmV2aWV3U3RhcnQ6IDAgfTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIGNvbnRlbnQgbWF0Y2hlc1xuICAgIGNvbnN0IGNvbnRlbnRNYXRjaGVzID0gbWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwiY29udGVudFwiKTtcbiAgICBpZiAoY29udGVudE1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IG1lc3NhZ2VzW21lc3NhZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKCFsYXN0TWVzc2FnZSkgcmV0dXJuIHsgdGV4dDogXCJcIiwgcHJldmlld1N0YXJ0OiAwIH07XG4gICAgICByZXR1cm4geyB0ZXh0OiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KGxhc3RNZXNzYWdlKSwgcHJldmlld1N0YXJ0OiAwIH07XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBtZXNzYWdlIGNvbnRlbnQgd2hlcmUgdGhlIG1hdGNoIG9jY3Vyc1xuICAgIGNvbnN0IGFsbENvbnRlbnQgPSBtZXNzYWdlc1xuICAgICAgLm1hcCgobXNnKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIC8vIEdldCBhbGwgc2VhcmNoIHRlcm1zXG4gICAgY29uc3Qgc2VhcmNoVGVybXMgPVxuICAgICAgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWU/LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbikgfHwgW107XG5cbiAgICAvLyBGaW5kIGFsbCBpbmRpY2VzIGZvciBlYWNoIHNlYXJjaCB0ZXJtXG4gICAgY29uc3QgdGVybUluZGljZXM6IG51bWJlcltdID0gW107XG4gICAgY29uc3QgYWxsQ29udGVudExvd2VyID0gYWxsQ29udGVudC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgc2VhcmNoVGVybXMuZm9yRWFjaCgodGVybSkgPT4ge1xuICAgICAgY29uc3QgaW5kaWNlcyA9IHRoaXMuZmluZEFsbEluZGljZXMoYWxsQ29udGVudExvd2VyLCB0ZXJtKTtcbiAgICAgIHRlcm1JbmRpY2VzLnB1c2goLi4uaW5kaWNlcyk7XG4gICAgfSk7XG5cbiAgICBpZiAodGVybUluZGljZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBGYWxsYmFjayB0byBmaXJzdCBtYXRjaCBpZiBubyB0ZXJtcyBmb3VuZCBkaXJlY3RseVxuICAgICAgY29uc3QgZmlyc3RNYXRjaCA9IGNvbnRlbnRNYXRjaGVzWzBdO1xuICAgICAgdGVybUluZGljZXMucHVzaChmaXJzdE1hdGNoLmluZGljZXNbMF0pO1xuICAgIH1cblxuICAgIC8vIFNvcnQgaW5kaWNlcyB0byBmaW5kIHRoZSBjbG9zZXN0IGNsdXN0ZXIgb2YgbWF0Y2hlc1xuICAgIHRlcm1JbmRpY2VzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcblxuICAgIC8vIEZpbmQgdGhlIGJlc3QgY2x1c3RlciBvZiBtYXRjaGVzIHRoYXQgY29udGFpbnMgYWxsIHNlYXJjaCB0ZXJtc1xuICAgIGNvbnN0IENPTlRFWFRfU0laRSA9IDc1O1xuICAgIGxldCBiZXN0U3RhcnQgPSB0ZXJtSW5kaWNlc1swXTtcbiAgICBsZXQgYmVzdEVuZCA9IHRlcm1JbmRpY2VzWzBdO1xuICAgIGxldCBiZXN0U3BhbiA9IEluZmluaXR5O1xuXG4gICAgLy8gRm9yIGVhY2ggc3RhcnRpbmcgcG9zaXRpb24sIHRyeSB0byBmaW5kIHRoZSBzbWFsbGVzdCB3aW5kb3cgdGhhdCBjb250YWlucyBhbGwgdGVybXNcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRlcm1JbmRpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdGFydCA9IHRlcm1JbmRpY2VzW2ldO1xuICAgICAgY29uc3Qgc2VhcmNoV2luZG93ID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICAgIC8vIExvb2sgYWhlYWQgdG8gZmluZCBhIHdpbmRvdyBjb250YWluaW5nIGFsbCBzZWFyY2ggdGVybXNcbiAgICAgIGZvciAobGV0IGogPSBpOyBqIDwgdGVybUluZGljZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgZW5kID0gdGVybUluZGljZXNbal07XG4gICAgICAgIGNvbnN0IHNwYW4gPSBlbmQgLSBzdGFydDtcblxuICAgICAgICAvLyBBZGQgdGhlIHRlcm0gYXQgdGhpcyBwb3NpdGlvbiB0byBvdXIgd2luZG93XG4gICAgICAgIGNvbnN0IHRlcm1BdFBvc2l0aW9uID0gc2VhcmNoVGVybXMuZmluZCgodGVybSkgPT5cbiAgICAgICAgICBhbGxDb250ZW50TG93ZXIuc2xpY2UodGVybUluZGljZXNbal0pLnN0YXJ0c1dpdGgodGVybSlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRlcm1BdFBvc2l0aW9uKSB7XG4gICAgICAgICAgc2VhcmNoV2luZG93LmFkZCh0ZXJtQXRQb3NpdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGFsbCB0ZXJtcyBhbmQgdGhpcyBzcGFuIGlzIGJldHRlciB0aGFuIG91ciBiZXN0IHNvIGZhclxuICAgICAgICBpZiAoc2VhcmNoV2luZG93LnNpemUgPT09IHNlYXJjaFRlcm1zLmxlbmd0aCAmJiBzcGFuIDwgYmVzdFNwYW4pIHtcbiAgICAgICAgICBiZXN0U3RhcnQgPSBzdGFydDtcbiAgICAgICAgICBiZXN0RW5kID0gZW5kO1xuICAgICAgICAgIGJlc3RTcGFuID0gc3BhbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgcHJldmlldyB3aW5kb3cgYXJvdW5kIHRoZSBiZXN0IGNsdXN0ZXJcbiAgICBjb25zdCBjb250ZXh0U3RhcnQgPSBNYXRoLm1heCgwLCBiZXN0U3RhcnQgLSBDT05URVhUX1NJWkUpO1xuICAgIGNvbnN0IGNvbnRleHRFbmQgPSBNYXRoLm1pbihhbGxDb250ZW50Lmxlbmd0aCwgYmVzdEVuZCArIENPTlRFWFRfU0laRSk7XG5cbiAgICAvLyBGaW5kIGNsZWFuIHdvcmQgYm91bmRhcmllc1xuICAgIGxldCBwcmV2aWV3U3RhcnQgPSBjb250ZXh0U3RhcnQ7XG4gICAgd2hpbGUgKFxuICAgICAgcHJldmlld1N0YXJ0ID4gMCAmJlxuICAgICAgIS9bXFxzLiE/XFxuXS8udGVzdChhbGxDb250ZW50W3ByZXZpZXdTdGFydCAtIDFdKVxuICAgICkge1xuICAgICAgcHJldmlld1N0YXJ0LS07XG4gICAgfVxuXG4gICAgbGV0IHByZXZpZXdFbmQgPSBjb250ZXh0RW5kO1xuICAgIHdoaWxlIChcbiAgICAgIHByZXZpZXdFbmQgPCBhbGxDb250ZW50Lmxlbmd0aCAmJlxuICAgICAgIS9bXFxzLiE/XFxuXS8udGVzdChhbGxDb250ZW50W3ByZXZpZXdFbmRdKVxuICAgICkge1xuICAgICAgcHJldmlld0VuZCsrO1xuICAgIH1cblxuICAgIGxldCBwcmV2aWV3ID0gYWxsQ29udGVudC5zbGljZShwcmV2aWV3U3RhcnQsIHByZXZpZXdFbmQpLnRyaW0oKTtcblxuICAgIC8vIEFkZCBlbGxpcHNpcyBpZiB3ZSdyZSBub3QgYXQgdGhlIHN0YXJ0L2VuZFxuICAgIGlmIChwcmV2aWV3U3RhcnQgPiAwKSBwcmV2aWV3ID0gXCIuLi5cIiArIHByZXZpZXc7XG4gICAgaWYgKHByZXZpZXdFbmQgPCBhbGxDb250ZW50Lmxlbmd0aCkgcHJldmlldyA9IHByZXZpZXcgKyBcIi4uLlwiO1xuXG4gICAgcmV0dXJuIHsgdGV4dDogcHJldmlldywgcHJldmlld1N0YXJ0OiBwcmV2aWV3U3RhcnQgfTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RGF0ZSh0aW1lc3RhbXA6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHRpbWVzdGFtcCkudG9Mb2NhbGVTdHJpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbk5ld0NoYXQoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICAgIC8vIENyZWF0ZSBuZXcgbGVhZiBhbmQgc2V0IGl0IHRvIGNoYXQgdmlld1xuICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKTtcbiAgICBsZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIHN0YXRlOiB7fSxcbiAgICB9KTtcbiAgICAvLyBBY3RpdmF0ZSB0aGUgbmV3IGxlYWZcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGFzeW5jIG9uT3BlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY2hhdC1tb2RhbFwiKTtcblxuICAgIC8vIEFkZCBsb2FkaW5nIHN0YXRlXG4gICAgY29uc3QgbG9hZGluZ0NvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWxvYWRpbmdcIixcbiAgICB9KTtcbiAgICBsb2FkaW5nQ29udGFpbmVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkxvYWRpbmcgY2hhdHMuLi5cIiB9KTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjaGF0cyA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXRzKCk7XG4gICAgICAvLyBTb3J0IGNoYXRzIGJ5IGxhc3QgbW9kaWZpZWQgZGF0ZSAobmV3ZXN0IGZpcnN0KVxuICAgICAgdGhpcy5jaGF0SXRlbXMgPSBjaGF0cy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmNoYXRJdGVtcyA9IFtdO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGxvYWRpbmcgc3RhdGVcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlYXJjaFwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBjaGF0cy4uLlwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcblxuICAgIHRoaXMuY2hhdEdyaWQgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWdyaWRcIiB9KTtcblxuICAgIC8vIEluaXRpYWwgcmVuZGVyIHdpdGggYXN5bmMgc2VhcmNoIGZpZWxkc1xuICAgIGNvbnN0IGluaXRpYWxSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB0aGlzLmNoYXRJdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+ICh7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIG1hdGNoZXM6IFtdLFxuICAgICAgICBzY29yZTogMCxcbiAgICAgIH0pKVxuICAgICk7XG4gICAgYXdhaXQgdGhpcy5yZW5kZXJDaGF0cyhpbml0aWFsUmVzdWx0cyk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQudmFsdWU7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIHRoaXMuY2hhdEl0ZW1zLm1hcChhc3luYyAoaXRlbSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IGF3YWl0IHRoaXMuZ2V0U2VhcmNoRmllbGRzKGl0ZW0pO1xuICAgICAgICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICAgICAgICBbaXRlbV0sXG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgICgpID0+IHNlYXJjaEZpZWxkc1xuICAgICAgICAgIClbMF07XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICBtYXRjaGVzOiBzZWFyY2hSZXN1bHQ/Lm1hdGNoZXMgfHwgW10sXG4gICAgICAgICAgICBzY29yZTogc2VhcmNoUmVzdWx0Py5zY29yZSB8fCAwLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBpZiAoIXF1ZXJ5KSB7XG4gICAgICAgIC8vIFdoZW4gbm8gc2VhcmNoIHF1ZXJ5LCBtYWludGFpbiB0aGUgZGF0ZSBzb3J0IG9yZGVyXG4gICAgICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSByZXN1bHRzLnNvcnQoXG4gICAgICAgICAgKGEsIGIpID0+IGIuaXRlbS5sYXN0TW9kaWZpZWQgLSBhLml0ZW0ubGFzdE1vZGlmaWVkXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRzKHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbHRlciBvdXQgcmVzdWx0cyB3aXRoIG5vIG1hdGNoZXMgb3IgdmVyeSBsb3cgc2NvcmVzXG4gICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcmVzdWx0c1xuICAgICAgICAuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5tYXRjaGVzLmxlbmd0aCA+IDAgJiYgcmVzdWx0LnNjb3JlID4gMClcbiAgICAgICAgLm1hcCgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgbGV0IGZpbmFsU2NvcmUgPSByZXN1bHQuc2NvcmU7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IHJlc3VsdC5pdGVtLm1lc3NhZ2VzXG4gICAgICAgICAgICAubWFwKChtc2c6IENoYXRNZXNzYWdlKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAgICAgICAuam9pbihcIlxcblwiKVxuICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICBpZiAoY29udGVudC5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgZmluYWxTY29yZSAqPSAyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHdvcmRCb3VuZGFyeU1hdGNoID0gbmV3IFJlZ0V4cChgXFxcXGIke3F1ZXJ5fWAsIFwiaVwiKS50ZXN0KFxuICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdvcmRCb3VuZGFyeU1hdGNoKSB7XG4gICAgICAgICAgICBmaW5hbFNjb3JlICo9IDEuNTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgc2NvcmU6IGZpbmFsU2NvcmUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIFNvcnQgYnkgc2NvcmUgZmlyc3QsIHRoZW4gYnkgZGF0ZSBmb3IgZXF1YWwgc2NvcmVzXG4gICAgICBwcm9jZXNzZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHtcbiAgICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGIuaXRlbS5sYXN0TW9kaWZpZWQgLSBhLml0ZW0ubGFzdE1vZGlmaWVkO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSBwcm9jZXNzZWRSZXN1bHRzO1xuICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRzKHByb2Nlc3NlZFJlc3VsdHMpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwO1xuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSBNYXRoLm1heCgwLCB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IC0gMSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSBNYXRoLm1pbihcbiAgICAgICAgICAgICAgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCArIDFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoID4gMCAmJlxuICAgICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmVcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkQ2FyZCA9IHRoaXMuY2hhdENhcmRzW3RoaXMuc2VsZWN0ZWRDYXJkSW5kZXhdO1xuICAgICAgICBpZiAoc2VsZWN0ZWRDYXJkPy5kYXRhc2V0LmNoYXRJZCkge1xuICAgICAgICAgIHRoaXMub25TZWxlY3Qoc2VsZWN0ZWRDYXJkLmRhdGFzZXQuY2hhdElkKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIHRvIGRpc2FibGUga2V5Ym9hcmQgbmF2aWdhdGlvbiB3aGVuIG1vdXNlIGlzIHVzZWRcbiAgICBjb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIG5ldyBjaGF0IGJ1dHRvbiBjb250YWluZXIgYXQgdGhlIGJvdHRvbVxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgY29uc3QgbmV3Q2hhdEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJPcGVuIE5ldyBDaGF0IEluc3RlYWRcIixcbiAgICB9KTtcbiAgICBuZXdDaGF0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLm9wZW5OZXdDaGF0KCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJDaGF0cyhzZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8Q2hhdEhpc3RvcnlJdGVtPltdKSB7XG4gICAgdGhpcy5jaGF0R3JpZC5lbXB0eSgpO1xuICAgIHRoaXMuY2hhdENhcmRzID0gW107XG4gICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyA9IHNlYXJjaFJlc3VsdHM7XG5cbiAgICBpZiAoc2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1lbXB0eVwiLFxuICAgICAgfSk7XG4gICAgICBlbXB0eVN0YXRlLnNldFRleHQoXG4gICAgICAgIHRoaXMuY2hhdEl0ZW1zLmxlbmd0aCA9PT0gMFxuICAgICAgICAgID8gXCJObyBjaGF0IGhpc3RvcnkgZm91bmQuXCJcbiAgICAgICAgICA6IFwiTm8gY2hhdHMgZm91bmQgbWF0Y2hpbmcgeW91ciBzZWFyY2guXCJcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGNvbnRhaW5lciBmb3IgYWxsIGNoYXRzXG4gICAgY29uc3Qgc2VjdGlvbnNDb250YWluZXIgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtc2VjdGlvbnMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgY2hhdCBjYXJkc1xuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHNlYXJjaFJlc3VsdHMpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVuZGVyQ2hhdENhcmQocmVzdWx0LCBzZWN0aW9uc0NvbnRhaW5lcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRNb2RlbE5hbWUobW9kZWxJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgaWYgKCFtb2RlbHMpIHJldHVybiBtb2RlbElkO1xuXG4gICAgICBjb25zdCBtb2RlbCA9IG1vZGVscy5maW5kKFxuICAgICAgICAobToge1xuICAgICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgICAgaWRlbnRpZmllcj86IHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHN0cmluZztcbiAgICAgICAgICAgIG1vZGVsSWQ6IHN0cmluZztcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lPzogc3RyaW5nO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pID0+XG4gICAgICAgICAgbS5pZCA9PT0gbW9kZWxJZCB8fFxuICAgICAgICAgIChtLmlkZW50aWZpZXIgJiZcbiAgICAgICAgICAgIGAke20uaWRlbnRpZmllci5wcm92aWRlcklkfS8ke20uaWRlbnRpZmllci5tb2RlbElkfWAgPT09IG1vZGVsSWQpXG4gICAgICApO1xuXG4gICAgICBpZiAobW9kZWw/LmlkZW50aWZpZXIpIHtcbiAgICAgICAgcmV0dXJuIG1vZGVsLmlkZW50aWZpZXIuZGlzcGxheU5hbWUgfHwgbW9kZWwuaWRlbnRpZmllci5tb2RlbElkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbW9kZWw/Lm5hbWUgfHwgbW9kZWxJZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgbW9kZWwgbmFtZTpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG1vZGVsSWQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRQcm9tcHRMYWJlbChpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmIChpdGVtLmN1c3RvbVByb21wdEZpbGVQYXRoKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBpdGVtLmN1c3RvbVByb21wdEZpbGVQYXRoLnNwbGl0KFwiL1wiKS5wb3AoKT8ucmVwbGFjZSgvXFwubWQkLywgXCJcIikgfHxcbiAgICAgICAgXCJDdXN0b20gUHJvbXB0XCJcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChpdGVtLnN5c3RlbVByb21wdFR5cGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICBpdGVtLnN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHJldHVybiBwcmVzZXQubGFiZWw7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJEZWZhdWx0XCI7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByZXZpZXcoXG4gICAgcHJldmlldzogSFRNTEVsZW1lbnQsXG4gICAgaXRlbTogQ2hhdEhpc3RvcnlJdGVtLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXVxuICApIHtcbiAgICBjb25zdCB7IHRleHQsIHByZXZpZXdTdGFydCB9ID0gdGhpcy5nZXRNZXNzYWdlUHJldmlldyhcbiAgICAgIGl0ZW0ubWVzc2FnZXMsXG4gICAgICBtYXRjaGVzXG4gICAgKTtcblxuICAgIC8vIEdldCBhbGwgY29udGVudCBtYXRjaGVzIGZvciBoaWdobGlnaHRpbmdcbiAgICBjb25zdCBjb250ZW50TWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcImNvbnRlbnRcIik7XG5cbiAgICBpZiAoY29udGVudE1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gR2V0IHRoZSBhY3R1YWwgc2VhcmNoIHF1ZXJ5IGZyb20gdGhlIHNlYXJjaCBpbnB1dFxuICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB0aGlzLnNlYXJjaElucHV0Py52YWx1ZSB8fCBcIlwiO1xuICAgICAgcHJldmlldy5hcHBlbmRDaGlsZChcbiAgICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLmhpZ2hsaWdodFRleHQodGV4dCwgY29udGVudE1hdGNoZXMsIHNlYXJjaFF1ZXJ5KVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldmlldy5jcmVhdGVTcGFuKHsgdGV4dCB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlckNoYXRDYXJkKFxuICAgIHsgaXRlbSwgbWF0Y2hlcyA9IFtdIH06IFNlYXJjaFJlc3VsdDxDaGF0SGlzdG9yeUl0ZW0+LFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnRcbiAgKSB7XG4gICAgY29uc3QgaXNTZWxlY3RlZCA9XG4gICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgJiZcbiAgICAgIHRoaXMuY2hhdENhcmRzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleDtcblxuICAgIGNvbnN0IGNhcmQgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1jaGF0LWNhcmQgJHtcbiAgICAgICAgaXRlbS5pZCA9PT0gdGhpcy5zZWxlY3RlZENoYXRJZCA/IFwic2VsZWN0ZWRcIiA6IFwiXCJcbiAgICAgIH0gJHtpc1NlbGVjdGVkID8gXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIiA6IFwiXCJ9YCxcbiAgICB9KTtcblxuICAgIGNhcmQuZGF0YXNldC5jaGF0SWQgPSBpdGVtLmlkO1xuICAgIHRoaXMuY2hhdENhcmRzLnB1c2goY2FyZCk7XG5cbiAgICBjb25zdCBoZWFkZXIgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1jYXJkLWhlYWRlclwiIH0pO1xuXG4gICAgY29uc3QgbGVmdENvbnRhaW5lciA9IGhlYWRlci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlci1sZWZ0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgbW9kZWwgYmFkZ2Ugd2l0aCBuYW1lIGluc3RlYWQgb2YgSURcbiAgICBjb25zdCBtb2RlbEJhZGdlID0gbGVmdENvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihtb2RlbEJhZGdlLCBcImJvdFwiKTtcbiAgICBjb25zdCBtb2RlbE5hbWUgPSBhd2FpdCB0aGlzLmdldE1vZGVsTmFtZShpdGVtLnNlbGVjdGVkTW9kZWxJZCk7XG4gICAgY29uc3QgbW9kZWxNYXRjaGVzID0gbWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwibW9kZWxcIik7XG4gICAgaWYgKG1vZGVsTWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICBtb2RlbEJhZGdlLmFwcGVuZENoaWxkKHRoaXMuaGlnaGxpZ2h0VGV4dChtb2RlbE5hbWUsIG1vZGVsTWF0Y2hlcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtb2RlbEJhZGdlLmFwcGVuZFRleHQobW9kZWxOYW1lKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcHJvbXB0IGJhZGdlXG4gICAgY29uc3QgcHJvbXB0QmFkZ2UgPSBsZWZ0Q29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtYmFkZ2VcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHByb21wdEJhZGdlLCBcImNvbW1hbmRcIik7XG4gICAgY29uc3QgcHJvbXB0TGFiZWwgPSBhd2FpdCB0aGlzLmdldFByb21wdExhYmVsKGl0ZW0pO1xuICAgIGNvbnN0IHByb21wdE1hdGNoZXMgPSBtYXRjaGVzLmZpbHRlcigobSkgPT4gbS5maWVsZCA9PT0gXCJwcm9tcHRcIik7XG4gICAgaWYgKHByb21wdE1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgcHJvbXB0QmFkZ2UuYXBwZW5kQ2hpbGQodGhpcy5oaWdobGlnaHRUZXh0KHByb21wdExhYmVsLCBwcm9tcHRNYXRjaGVzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb21wdEJhZGdlLmFwcGVuZFRleHQocHJvbXB0TGFiZWwpO1xuICAgIH1cblxuICAgIC8vIEFkZCBkb2N1bWVudCBjb250ZXh0IGJhZGdlIGlmIHByZXNlbnRcbiAgICBpZiAoaXRlbS5jb250ZXh0X2ZpbGVzICYmIGl0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBkb2NCYWRnZSA9IGxlZnRDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIsXG4gICAgICB9KTtcbiAgICAgIHNldEljb24oZG9jQmFkZ2UsIFwiZmlsZS10ZXh0XCIpO1xuICAgICAgZG9jQmFkZ2UuYXBwZW5kVGV4dChcbiAgICAgICAgYCR7aXRlbS5jb250ZXh0X2ZpbGVzLmxlbmd0aH0gRG9jdW1lbnQke1xuICAgICAgICAgIGl0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwiXG4gICAgICAgIH1gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZpZXcgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlICYmIG1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyB0ZXh0IH0gPSB0aGlzLmdldE1lc3NhZ2VQcmV2aWV3KGl0ZW0ubWVzc2FnZXMsIG1hdGNoZXMpO1xuXG4gICAgICAvLyBHZXQgYWxsIHNlYXJjaCB0ZXJtc1xuICAgICAgY29uc3Qgc2VhcmNoVGVybXMgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKTtcbiAgICAgIGNvbnN0IHRleHRMb3dlciA9IHRleHQudG9Mb3dlckNhc2UoKTtcblxuICAgICAgLy8gRmluZCBhbGwgdGVybSBwb3NpdGlvbnMgaW4gdGhlIHByZXZpZXcgdGV4dFxuICAgICAgY29uc3QgdGVybVBvc2l0aW9uczogQXJyYXk8eyB0ZXJtOiBzdHJpbmc7IGluZGV4OiBudW1iZXIgfT4gPSBbXTtcbiAgICAgIHNlYXJjaFRlcm1zLmZvckVhY2goKHRlcm0pID0+IHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGV4dExvd2VyLmluZGV4T2YodGVybSk7XG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgdGVybVBvc2l0aW9ucy5wdXNoKHsgdGVybSwgaW5kZXggfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBTb3J0IHBvc2l0aW9ucyBieSBpbmRleFxuICAgICAgdGVybVBvc2l0aW9ucy5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7XG5cbiAgICAgIGlmICh0ZXJtUG9zaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGxldCBsYXN0SW5kZXggPSAwO1xuXG4gICAgICAgIC8vIFByb2Nlc3MgZWFjaCB0ZXJtIGluIG9yZGVyXG4gICAgICAgIHRlcm1Qb3NpdGlvbnMuZm9yRWFjaCgoeyB0ZXJtLCBpbmRleCB9KSA9PiB7XG4gICAgICAgICAgLy8gQWRkIHRleHQgYmVmb3JlIHRoaXMgdGVybVxuICAgICAgICAgIGlmIChpbmRleCA+IGxhc3RJbmRleCkge1xuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc2xpY2UobGFzdEluZGV4LCBpbmRleCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCB0ZXJtXG4gICAgICAgICAgY29uc3QgaGlnaGxpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgICAgaGlnaGxpZ2h0LmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXNlYXJjaC1oaWdobGlnaHRcIjtcbiAgICAgICAgICBoaWdobGlnaHQudGV4dENvbnRlbnQgPSB0ZXh0LnNsaWNlKGluZGV4LCBpbmRleCArIHRlcm0ubGVuZ3RoKTtcbiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChoaWdobGlnaHQpO1xuXG4gICAgICAgICAgbGFzdEluZGV4ID0gaW5kZXggKyB0ZXJtLmxlbmd0aDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIGFueSByZW1haW5pbmcgdGV4dFxuICAgICAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByZXZpZXcuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJldmlldy5hcHBlbmRUZXh0KHRleHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBObyBzZWFyY2ggLSBzaG93IGxhc3QgbWVzc2FnZVxuICAgICAgY29uc3QgbGFzdE1lc3NhZ2UgPSBpdGVtLm1lc3NhZ2VzW2l0ZW0ubWVzc2FnZXMubGVuZ3RoIC0gMV07XG4gICAgICBpZiAobGFzdE1lc3NhZ2UpIHtcbiAgICAgICAgcHJldmlldy5hcHBlbmRUZXh0KHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobGFzdE1lc3NhZ2UpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBtZXRhID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtbWV0YVwiIH0pO1xuXG4gICAgY29uc3QgZGF0ZUVsID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWluZm9cIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGRhdGVFbCwgXCJjYWxlbmRhclwiKTtcbiAgICBkYXRlRWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiB0aGlzLmZvcm1hdERhdGUoaXRlbS5sYXN0TW9kaWZpZWQpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWVzc2FnZXNFbCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihtZXNzYWdlc0VsLCBcIm1lc3NhZ2Utc3F1YXJlXCIpO1xuICAgIG1lc3NhZ2VzRWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBgJHtpdGVtLm1lc3NhZ2VzLmxlbmd0aH0gbWVzc2FnZSR7XG4gICAgICAgIGl0ZW0ubWVzc2FnZXMubGVuZ3RoICE9PSAxID8gXCJzXCIgOiBcIlwiXG4gICAgICB9YCxcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aXRsZSBpbmZvXG4gICAgY29uc3QgdGl0bGVFbCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbih0aXRsZUVsLCBcImZpbGVcIik7XG4gICAgdGl0bGVFbC5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IGl0ZW0udGl0bGUsXG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uU2VsZWN0KGl0ZW0uaWQpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGNyZWF0ZUZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQpO1xuICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoKTtcblxuICAgIGNvbnN0IGFsbEluZGljZXMgPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICBtYXRjaGVzLmZvckVhY2goKG1hdGNoKSA9PiB7XG4gICAgICBtYXRjaC5pbmRpY2VzLmZvckVhY2goKGlkeCkgPT4gYWxsSW5kaWNlcy5hZGQoaWR4KSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzb3J0ZWRJbmRpY2VzID0gQXJyYXkuZnJvbShhbGxJbmRpY2VzKS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG5cbiAgICBjb25zdCByYW5nZXM6IEFycmF5PFtudW1iZXIsIG51bWJlcl0+ID0gW107XG4gICAgbGV0IHJhbmdlU3RhcnQgPSBzb3J0ZWRJbmRpY2VzWzBdO1xuICAgIGxldCBwcmV2ID0gc29ydGVkSW5kaWNlc1swXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNvcnRlZEluZGljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGN1cnIgPSBzb3J0ZWRJbmRpY2VzW2ldO1xuICAgICAgaWYgKGN1cnIgIT09IHByZXYgKyAxKSB7XG4gICAgICAgIHJhbmdlcy5wdXNoKFtyYW5nZVN0YXJ0LCBwcmV2ICsgMV0pO1xuICAgICAgICByYW5nZVN0YXJ0ID0gY3VycjtcbiAgICAgIH1cbiAgICAgIHByZXYgPSBjdXJyO1xuICAgIH1cblxuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIHJhbmdlcy5mb3JFYWNoKChbc3RhcnQsIGVuZF0pID0+IHtcbiAgICAgIGlmIChzdGFydCA+IGxhc3RJbmRleCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4LCBzdGFydCkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBoaWdobGlnaHRlZFRleHQgPSB0ZXh0LnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgY29uc3Qgc3BhbiA9IGZyYWdtZW50LmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGlnaGxpZ2h0XCIsXG4gICAgICAgIHRleHQ6IGhpZ2hsaWdodGVkVGV4dCxcbiAgICAgIH0pO1xuXG4gICAgICBsYXN0SW5kZXggPSBlbmQ7XG4gICAgfSk7XG5cbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dC5zbGljZShsYXN0SW5kZXgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkQ2FyZCgpIHtcbiAgICB0aGlzLmNoYXRDYXJkcy5mb3JFYWNoKChjYXJkLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ICYmIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSkge1xuICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIik7XG4gICAgICAgIGNhcmQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogXCJzbW9vdGhcIiwgYmxvY2s6IFwibmVhcmVzdFwiIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7XG4gIEFwcCxcbiAgTWVudSxcbiAgTm90aWNlLFxuICBURmlsZSxcbiAgVEZvbGRlcixcbiAgVmF1bHQsXG4gIHNldEljb24sXG4gIE1hcmtkb3duVmlldyxcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1RyYW5zY3JpcHRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL1RleHRNb2RpZmljYXRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5cbi8vIEZvciBhIHR5cGljYWwgT2JzaWRpYW4gcGx1Z2luLCB5b3UnZCBpbml0aWFsaXplIHRoaXMgaW4geW91ciBtYWluIHBsdWdpbiBjbGFzcy5cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdENvbnRleHRNZW51IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzdGF0dXNCYXJJdGVtOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzTW9kYWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NTdGF0dXM6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCdXR0b25zOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gc2N1bHB0U2VydmljZTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dE1lbnUoKTtcbiAgICB0aGlzLmluaXRpYWxpemVTdGF0dXNCYXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVN0YXR1c0JhcigpIHtcbiAgICB0aGlzLnN0YXR1c0Jhckl0ZW0gPSB0aGlzLmFwcC53b3Jrc3BhY2UuY29udGFpbmVyRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLWJhclwiLFxuICAgIH0pO1xuICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ29udGV4dE1lbnUoKSB7XG4gICAgLy8gUmVnaXN0ZXIgdGhlIGVkaXRvciBtZW51IGV2ZW50IGZvciB0ZXh0IG1vZGlmaWNhdGlvblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImVkaXRvci1tZW51XCIsIChtZW51LCBlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgIGlmICghKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIGlmICghc2VsZWN0aW9uKSByZXR1cm47XG5cbiAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtXG4gICAgICAgICAgLnNldFRpdGxlKFwiU3lzdGVtU2N1bHB0IC0gTW9kaWZ5IFRleHRcIilcbiAgICAgICAgICAuc2V0SWNvbihcIndhbmRcIilcbiAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwodGhpcy5hcHAsIHtcbiAgICAgICAgICAgICAgaW5pdGlhbFRleHQ6IHNlbGVjdGlvbixcbiAgICAgICAgICAgICAgb25Nb2RpZnk6IChtb2RpZmllZFRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihtb2RpZmllZFRleHQpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIHRoZSBmaWxlIG1lbnUgZXZlbnQgZm9yIGF1ZGlvIGZpbGVzXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiZmlsZS1tZW51XCIsIChtZW51LCBmaWxlKSA9PiB7XG4gICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIC8vIEFkZCBcIkNoYXQgd2l0aCBGaWxlXCIgZm9yIGFsbCBzdXBwb3J0ZWQgZmlsZSB0eXBlc1xuICAgICAgaWYgKFxuICAgICAgICAvLyBUZXh0IGZpbGVzXG4gICAgICAgIFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSB8fFxuICAgICAgICAvLyBEb2N1bWVudHMgKHdpbGwgYmUgYXV0by1leHRyYWN0ZWQpXG4gICAgICAgIFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiXS5pbmNsdWRlcyhcbiAgICAgICAgICBleHRlbnNpb25cbiAgICAgICAgKSB8fFxuICAgICAgICAvLyBBdWRpbyBmaWxlcyAod2lsbCBiZSBhdXRvLXRyYW5zY3JpYmVkKVxuICAgICAgICBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJtNGFcIiwgXCJvZ2dcIiwgXCJ3ZWJtXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikgfHxcbiAgICAgICAgLy8gSW1hZ2VzIChmb3IgdmlzaW9uIG1vZGVscylcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENoYXQgd2l0aCBGaWxlXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcIm1lc3NhZ2Utc3F1YXJlXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdmlldy5hZGRGaWxlVG9Db250ZXh0KGZpbGUpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gb3BlbiBjaGF0IHdpdGggZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2hhdCBvcGVuIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGF1ZGlvIGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIm1wM1wiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndhdlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndlYm1cIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIFRyYW5zY3JpYmUgQXVkaW9cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwibWljcm9waG9uZVwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQXVkaW9UcmFuc2NyaXB0aW9uKGZpbGUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIHRyYW5zY3JpYmUgYXVkaW8gZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5ldyBtZW51IGl0ZW0gZm9yIHRpbWVzdGFtcGVkIHRyYW5zY3JpcHRpb25cbiAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XG4gICAgICAgICAgaXRlbVxuICAgICAgICAgICAgLnNldFRpdGxlKFwiU3lzdGVtU2N1bHB0IC0gVHJhbnNjcmliZSBBdWRpbyAoVGltZXN0YW1wZWQpXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcImNsb2NrXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oZmlsZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byB0cmFuc2NyaWJlIGF1ZGlvIGZpbGUgd2l0aCB0aW1lc3RhbXBzXCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaW1lc3RhbXBlZCB0cmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGRvY3VtZW50IGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcInBkZlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcImRvY3hcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJkb2NcIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENvbnZlcnQgdG8gTWFya2Rvd25cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwiZmlsZS10ZXh0XCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVEb2N1bWVudENvbnZlcnNpb24oZmlsZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byBjb252ZXJ0IGRvY3VtZW50XCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEb2N1bWVudCBjb252ZXJzaW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRG9jdW1lbnRDb252ZXJzaW9uKGZpbGU6IFRGaWxlKSB7XG4gICAgdGhpcy5jcmVhdGVQcm9ncmVzc01vZGFsKCk7XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDAsIFwiUHJvY2Vzc2luZyB5b3VyIGRvY3VtZW50Li4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gU21hbGwgZGVsYXkgdG8gZW5zdXJlIHVzZXJzIHNlZSB0aGUgaW5pdGlhbCBwcm9jZXNzaW5nIG1lc3NhZ2VcbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwMCk7XG5cbiAgICAgIC8vIFNob3cgdXBsb2FkIHN0YXR1c1xuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDEwLCBcIlVwbG9hZGluZyBkb2N1bWVudC4uLlwiLCBcInVwbG9hZFwiKTtcblxuICAgICAgLy8gVXBsb2FkIHRoZSBmaWxlXG4gICAgICBjb25zdCB7IGRvY3VtZW50SWQsIHN0YXR1cywgY2FjaGVkIH0gPVxuICAgICAgICBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UudXBsb2FkRG9jdW1lbnQoZmlsZSk7XG5cbiAgICAgIGlmIChjYWNoZWQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDUwLCBcIkZvdW5kIGNhY2hlZCB2ZXJzaW9uXCIsIFwiY2hlY2tcIik7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgICAgZmlsZSxcbiAgICAgICAgICBleHRyYWN0aW9uRGF0YVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgICB0aGlzLnNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDMwLCBcIlByb2Nlc3NpbmcgZG9jdW1lbnQuLi5cIiwgXCJsb2FkZXItMlwiKTtcblxuICAgICAgLy8gUG9sbCBmb3Igc3RhdHVzIHVudGlsIGNvbXBsZXRlZFxuICAgICAgY29uc3QgcG9sbFJlc3VsdCA9IGF3YWl0IHRoaXMucG9sbFVudGlsQ29tcGxldGUoZG9jdW1lbnRJZCk7XG5cbiAgICAgIGlmICghcG9sbFJlc3VsdCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMCwgXCJQcm9jZXNzaW5nIGluY29tcGxldGVcIiwgXCJhbGVydC1jaXJjbGVcIik7XG4gICAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMzAwMCk7XG4gICAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDgwLCBcIkRvd25sb2FkaW5nIHJlc3VsdHMuLi5cIiwgXCJkb3dubG9hZFwiKTtcblxuICAgICAgLy8gRG93bmxvYWQgZXh0cmFjdGlvblxuICAgICAgY29uc3QgZXh0cmFjdGlvbkRhdGEgPSBhd2FpdCB0aGlzLmRvd25sb2FkRXh0cmFjdGlvbihkb2N1bWVudElkKTtcbiAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgIGZpbGUsXG4gICAgICAgIGV4dHJhY3Rpb25EYXRhXG4gICAgICApO1xuXG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgdGhpcy5zaG93Q29tcGxldGlvbkJ1dHRvbnMoZXh0cmFjdGlvblBhdGgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTeXN0ZW1TY3VscHQgZXJyb3JcIiwgZSk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoXG4gICAgICAgIDAsXG4gICAgICAgIGBFcnJvcjogJHtlIGluc3RhbmNlb2YgRXJyb3IgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSl9YCxcbiAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy5zbGVlcCg1MDAwKTtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oXG4gICAgZmlsZTogVEZpbGUsXG4gICAgdGltZXN0YW1wZWQ6IGJvb2xlYW5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNob3dBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCh0aGlzLmFwcCwge1xuICAgICAgICBmaWxlLFxuICAgICAgICB0aW1lc3RhbXBlZCxcbiAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6IGFzeW5jICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAvLyBDcmVhdGUgdGhlIG91dHB1dCBmaWxlXG4gICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lO1xuICAgICAgICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSB0aW1lc3RhbXBlZCA/IFwic3J0XCIgOiBcIm1kXCI7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0UGF0aCA9IGAke1xuICAgICAgICAgICAgZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIlxuICAgICAgICAgIH0vJHtiYXNlTmFtZX0uJHtmaWxlRXh0ZW5zaW9ufWA7XG5cbiAgICAgICAgICAvLyBGb3IgU1JUIGZpbGVzLCB1c2UgcmF3IHRleHQuIEZvciBNRCBmaWxlcywgdGhlIHRleHQgaXMgYWxyZWFkeSBmb3JtYXR0ZWRcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGltZXN0YW1wZWQgPyB0ZXh0IDogdGV4dDtcblxuICAgICAgICAgIC8vIENyZWF0ZSBvciB1cGRhdGUgdGhlIGZpbGVcbiAgICAgICAgICBsZXQgdHJhbnNjcmlwdGlvbkZpbGU6IFRGaWxlO1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChvdXRwdXRQYXRoKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgdHJhbnNjcmlwdGlvbkZpbGUgPSBleGlzdGluZ0ZpbGU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyYW5zY3JpcHRpb25GaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKFxuICAgICAgICAgICAgICBvdXRwdXRQYXRoLFxuICAgICAgICAgICAgICBjb250ZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIE9wZW4gdGhlIHRyYW5zY3JpcHRpb24gZmlsZSBpbiBhIG5ldyBsZWFmXG4gICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUodHJhbnNjcmlwdGlvbkZpbGUpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1ZGlvIHRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcm9ncmVzc01vZGFsKCkge1xuICAgIGlmICh0aGlzLnByb2dyZXNzTW9kYWwpIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NNb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5wcm9ncmVzc01vZGFsLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLW1vZGFsXCI7XG5cbiAgICB0aGlzLnByb2dyZXNzQmFyID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLWJhclwiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLXN0YXR1c1wiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzQnV0dG9ucyA9IHRoaXMucHJvZ3Jlc3NNb2RhbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1idXR0b25zXCJcbiAgICApO1xuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9ncmVzc01vZGFsKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nLCBpY29uOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMucHJvZ3Jlc3NNb2RhbCB8fCAhdGhpcy5wcm9ncmVzc0JhciB8fCAhdGhpcy5wcm9ncmVzc1N0YXR1cylcbiAgICAgIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBgJHtwcm9ncmVzc30lYDtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmVtcHR5KCk7XG4gICAgc2V0SWNvbih0aGlzLnByb2dyZXNzU3RhdHVzLCBpY29uKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmNyZWF0ZVNwYW4oeyB0ZXh0OiBzdGF0dXMgfSk7XG4gIH1cblxuICBwcml2YXRlIHNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnByb2dyZXNzQnV0dG9ucykgcmV0dXJuO1xuXG4gICAgdGhpcy5wcm9ncmVzc0J1dHRvbnMuZW1wdHkoKTtcblxuICAgIC8vIFZpZXcgYnV0dG9uXG4gICAgY29uc3Qgdmlld0J1dHRvbiA9IHRoaXMucHJvZ3Jlc3NCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiVmlldyBSZXN1bHRcIixcbiAgICAgIGNsczogXCJtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgdmlld0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChleHRyYWN0aW9uUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xvc2UgYnV0dG9uXG4gICAgY29uc3QgY2xvc2VCdXR0b24gPSB0aGlzLnByb2dyZXNzQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNsb3NlXCIsXG4gICAgfSk7XG4gICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlUHJvZ3Jlc3NNb2RhbCgpIHtcbiAgICBpZiAodGhpcy5wcm9ncmVzc01vZGFsICYmIHRoaXMucHJvZ3Jlc3NNb2RhbC5wYXJlbnROb2RlKSB7XG4gICAgICB0aGlzLnByb2dyZXNzTW9kYWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICAgIH1cbiAgICB0aGlzLnByb2dyZXNzTW9kYWwgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NTdGF0dXMgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCdXR0b25zID0gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcG9sbFVudGlsQ29tcGxldGUoXG4gICAgZG9jdW1lbnRJZDogc3RyaW5nLFxuICAgIG1heEF0dGVtcHRzID0gMzBcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhBdHRlbXB0czsgaSsrKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtcbiAgICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgICB9JHtTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5ET0NVTUVOVFMuR0VUKGRvY3VtZW50SWQpfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNoZWNrIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvciB8fCBcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYmFzZWQgb24gYXR0ZW1wdCBudW1iZXJcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oMzAgKyAoaSAvIG1heEF0dGVtcHRzKSAqIDUwLCA4MCk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwocHJvZ3Jlc3MsIFwiUHJvY2Vzc2luZyBkb2N1bWVudC4uLlwiLCBcImxvYWRlci0yXCIpO1xuXG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDIwMDApO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGAke1xuICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuRE9DVU1FTlRTLkRPV05MT0FEKGRvY3VtZW50SWQpfWAsXG4gICAgICB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZG93bmxvYWQgZXh0cmFjdGlvbjogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVFeHRyYWN0aW9uUmVzdWx0cyhmaWxlOiBURmlsZSwgZGF0YTogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgIGNvbnN0IGJhc2VOYW1lID0gdGhpcy5zYW5pdGl6ZUZpbGVuYW1lKGZpbGUuYmFzZW5hbWUpO1xuICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCB8fCBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICAvLyBDcmVhdGUgdGhlIHRhcmdldCBmb2xkZXJcbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKTtcblxuICAgIC8vIENyZWF0ZSBleHRyYWN0aW9uIGZpbGUgcGF0aFxuICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKFxuICAgICAgYCR7cGFyZW50UGF0aH0vJHtiYXNlTmFtZX0tZXh0cmFjdGlvbi5tZGBcbiAgICApO1xuXG4gICAgLy8gU2F2ZSB0aGUgZXh0cmFjdGlvbiBjb250ZW50XG4gICAgY29uc3QgY29udGVudCA9IHRoaXMuZm9ybWF0RXh0cmFjdGlvbkNvbnRlbnQoZGF0YSk7XG4gICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGV4dHJhY3Rpb25QYXRoKTtcbiAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZXh0cmFjdGlvblBhdGgsIGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBleHRyYWN0aW9uUGF0aDtcbiAgfVxuXG4gIHByaXZhdGUgc2FuaXRpemVGaWxlbmFtZShmaWxlbmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZmlsZW5hbWUucmVwbGFjZSgvW15hLXpBLVowLTktXyBdL2csIFwiXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVQYXRoKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFxcXC9nLCBcIi9cIikucmVwbGFjZSgvXFwvKy9nLCBcIi9cIik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUZvbGRlcihwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICBpZiAoXG4gICAgICAhKHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChub3JtYWxpemVkUGF0aCkgaW5zdGFuY2VvZiBURm9sZGVyKVxuICAgICkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKG5vcm1hbGl6ZWRQYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEV4dHJhY3Rpb25Db250ZW50KGRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAjICR7ZGF0YS50aXRsZSB8fCBcIkRvY3VtZW50IEV4dHJhY3Rpb25cIn1cblxuJHtkYXRhLmNvbnRlbnQgfHwgXCJcIn1cblxuLS0tXG5FeHRyYWN0ZWQgd2l0aCBTeXN0ZW1TY3VscHRcbmA7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpOiBzdHJpbmcge1xuICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dE1vZGlmaWNhdGlvbk1vZGFsT3B0aW9ucyB7XG4gIGluaXRpYWxUZXh0OiBzdHJpbmc7XG4gIG9uTW9kaWZ5OiAobW9kaWZpZWRUZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgaW5wdXRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIHByZXZpZXdBcmVhOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBtb2RpZnlCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICBwcml2YXRlIG9wdGlvbnM6IFRleHRNb2RpZmljYXRpb25Nb2RhbE9wdGlvbnM7XG4gIHByaXZhdGUgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIGlzR2VuZXJhdGluZyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvcHRpb25zOiBUZXh0TW9kaWZpY2F0aW9uTW9kYWxPcHRpb25zKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuYWlTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShERUZBVUxUX1NFVFRJTkdTLCBhcHApO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtdGV4dC1tb2RpZmljYXRpb24tbW9kYWxcIik7XG5cbiAgICAvLyBDcmVhdGUgaGVhZGVyXG4gICAgY29uc3QgaGVhZGVyRWwgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LW1vZGFsLWhlYWRlclwiKTtcbiAgICBoZWFkZXJFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJNb2RpZnkgVGV4dFwiIH0pO1xuXG4gICAgLy8gQ3JlYXRlIG1haW4gY29udGVudCBhcmVhIHdpdGggc3BsaXQgdmlld1xuICAgIGNvbnN0IG1haW5Db250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgLy8gTGVmdCBzaWRlIC0gSW5wdXRcbiAgICBjb25zdCBpbnB1dFNlY3Rpb24gPSBtYWluQ29udGVudC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtaW5wdXQtc2VjdGlvblwiKTtcbiAgICBjb25zdCBpbnB1dExhYmVsID0gaW5wdXRTZWN0aW9uLmNyZWF0ZUVsKFwibGFiZWxcIiwge1xuICAgICAgdGV4dDogXCJNb2RpZmljYXRpb24gSW5zdHJ1Y3Rpb25zXCIsXG4gICAgfSk7XG4gICAgdGhpcy5pbnB1dEFyZWEgPSBpbnB1dFNlY3Rpb24uY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIGluc3RydWN0aW9ucyBmb3IgaG93IHRvIG1vZGlmeSB0aGUgdGV4dC4uLlwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFJpZ2h0IHNpZGUgLSBQcmV2aWV3XG4gICAgY29uc3QgcHJldmlld1NlY3Rpb24gPSBtYWluQ29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcmV2aWV3LXNlY3Rpb25cIlxuICAgICk7XG4gICAgY29uc3QgcHJldmlld0xhYmVsID0gcHJldmlld1NlY3Rpb24uY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUHJldmlld1wiIH0pO1xuICAgIHRoaXMucHJldmlld0FyZWEgPSBwcmV2aWV3U2VjdGlvbi5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtcHJldmlldy1jb250ZW50XCIpO1xuICAgIHRoaXMucHJldmlld0FyZWEuc2V0VGV4dCh0aGlzLm9wdGlvbnMuaW5pdGlhbFRleHQpO1xuXG4gICAgLy8gRm9vdGVyIHdpdGggYnV0dG9uc1xuICAgIGNvbnN0IGZvb3RlckVsID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1tb2RhbC1mb290ZXJcIik7XG5cbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBmb290ZXJFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICB9KTtcbiAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG5cbiAgICB0aGlzLm1vZGlmeUJ1dHRvbiA9IGZvb3RlckVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICAgIHRleHQ6IFwiTW9kaWZ5XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgdGhpcy5tb2RpZnlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuaGFuZGxlTW9kaWZ5KCkpO1xuXG4gICAgLy8gRm9jdXMgaW5wdXRcbiAgICB0aGlzLmlucHV0QXJlYS5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVNb2RpZnkoKSB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nIHx8ICF0aGlzLmlucHV0QXJlYS52YWx1ZS50cmltKCkpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLm1vZGlmeUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBzZXRJY29uKHRoaXMubW9kaWZ5QnV0dG9uLCBcImxvYWRlci0yXCIpO1xuICAgICAgdGhpcy5tb2RpZnlCdXR0b24uYWRkQ2xhc3MoXCJsb2FkaW5nXCIpO1xuXG4gICAgICAvLyBHZXQgdGhlIG1vZGlmaWNhdGlvbiBpbnN0cnVjdGlvbnMgYW5kIHRleHRcbiAgICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IHRoaXMuaW5wdXRBcmVhLnZhbHVlLnRyaW0oKTtcbiAgICAgIGNvbnN0IHRleHRUb01vZGlmeSA9IHRoaXMub3B0aW9ucy5pbml0aWFsVGV4dDtcblxuICAgICAgLy8gQ3JlYXRlIGEgdmFyaWFibGUgdG8gc3RvcmUgdGhlIG1vZGlmaWVkIHRleHRcbiAgICAgIGxldCBtb2RpZmllZFRleHQgPSBcIlwiO1xuXG4gICAgICAvLyBTdHJlYW0gdGhlIHJlc3BvbnNlIGZyb20gdGhlIEFJIHNlcnZpY2VcbiAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgdGhpcy5haVNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogdGV4dFRvTW9kaWZ5LCBtZXNzYWdlX2lkOiBnZW5lcmF0ZVVVSUQoKSB9LFxuICAgICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IGluc3RydWN0aW9ucywgbWVzc2FnZV9pZDogZ2VuZXJhdGVVVUlEKCkgfSxcbiAgICAgICAgXSxcbiAgICAgICAgbW9kZWw6IFwibGxhbWEtMy4zLTcwYi12ZXJzYXRpbGVcIixcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZTogXCJ0ZXh0X21vZGlmaWNhdGlvblwiLFxuICAgICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoYEZhaWxlZCB0byBtb2RpZnkgdGV4dDogJHtlcnJvcn1gLCBcImVycm9yXCIpO1xuICAgICAgICB9LFxuICAgICAgfSkpIHtcbiAgICAgICAgbW9kaWZpZWRUZXh0ICs9IGNodW5rO1xuICAgICAgICB0aGlzLnByZXZpZXdBcmVhLnNldFRleHQobW9kaWZpZWRUZXh0KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsbCB0aGUgY2FsbGJhY2sgd2l0aCB0aGUgbW9kaWZpZWQgdGV4dFxuICAgICAgdGhpcy5vcHRpb25zLm9uTW9kaWZ5KG1vZGlmaWVkVGV4dCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUZXh0IG1vZGlmaWNhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byBtb2RpZnkgdGV4dC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIiwgXCJlcnJvclwiKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMubW9kaWZ5QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm1vZGlmeUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgdGhpcy5tb2RpZnlCdXR0b24uc2V0VGV4dChcIk1vZGlmeVwiKTtcbiAgICAgIHRoaXMubW9kaWZ5QnV0dG9uLnJlbW92ZUNsYXNzKFwibG9hZGluZ1wiKTtcbiAgICB9XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIFNldHRpbmdzTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBERUZBVUxUX1NFVFRJTkdTO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSBhd2FpdCB0aGlzLnBsdWdpbi5sb2FkRGF0YSgpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBsb2FkZWREYXRhKTtcblxuICAgIC8vIEVuc3VyZSBzZXJ2ZXIgVVJMIG1hdGNoZXMgZGV2ZWxvcG1lbnQgbW9kZVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy5zZXJ2ZXJVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldHRpbmdzLnNlcnZlclVybCA9IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB0aGlzLnBsdWdpbi5haVNlcnZpY2UudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBnZXRTZXR0aW5ncygpOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTZXR0aW5ncyhuZXdTZXR0aW5nczogUGFydGlhbDxTeXN0ZW1TY3VscHRTZXR0aW5ncz4pIHtcbiAgICAvLyBJZiBkZXZlbG9wbWVudCBtb2RlIGlzIGJlaW5nIGNoYW5nZWQsIHVwZGF0ZSB0aGUgc2VydmVyIFVSTCBhY2NvcmRpbmdseVxuICAgIGlmIChuZXdTZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3U2V0dGluZ3Muc2VydmVyVXJsID0gbmV3U2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlXG4gICAgICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjMwMDFcIlxuICAgICAgICA6IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgIH1cbiAgICB0aGlzLnNldHRpbmdzID0geyAuLi50aGlzLnNldHRpbmdzLCAuLi5uZXdTZXR0aW5ncyB9O1xuICAgIGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL3VpXCI7XG5cbmV4cG9ydCBjbGFzcyBMaWNlbnNlTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBhc3luYyB2YWxpZGF0ZUxpY2Vuc2VLZXkoZm9yY2UgPSBmYWxzZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSkge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gZmFsc2U7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMucGx1Z2luLmFpU2VydmljZS52YWxpZGF0ZUxpY2Vuc2UoZm9yY2UpO1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gaXNWYWxpZDtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMaWNlbnNlIHZhbGlkYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVEZpbGUsIFRGb2xkZXIsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5cbmV4cG9ydCBjbGFzcyBKYW5pdG9yTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU2l6ZShmaWxlczogVEZpbGVbXSk6IHN0cmluZyB7XG4gICAgY29uc3QgdG90YWxCeXRlcyA9IGZpbGVzLnJlZHVjZSgoYWNjLCBmaWxlKSA9PiBhY2MgKyBmaWxlLnN0YXQuc2l6ZSwgMCk7XG4gICAgaWYgKHRvdGFsQnl0ZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBcImVtcHR5XCI7XG4gICAgfSBlbHNlIGlmICh0b3RhbEJ5dGVzIDwgMTAyNCkge1xuICAgICAgcmV0dXJuIGAke3RvdGFsQnl0ZXN9IGJ5dGVzYDtcbiAgICB9IGVsc2UgaWYgKHRvdGFsQnl0ZXMgPCAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gMTAyNCkudG9GaXhlZCgxKX0gS0JgO1xuICAgIH0gZWxzZSBpZiAodG90YWxCeXRlcyA8IDEwMjQgKiAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgxKX0gTUJgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7KHRvdGFsQnl0ZXMgLyAoMTAyNCAqIDEwMjQgKiAxMDI0KSkudG9GaXhlZCgxKX0gR0JgO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RmlsZXNJbkRpcmVjdG9yeShkaXJlY3Rvcnk6IHN0cmluZyk6IFRGaWxlW10ge1xuICAgIHJldHVybiB0aGlzLmFwcC52YXVsdFxuICAgICAgLmdldEZpbGVzKClcbiAgICAgIC5maWx0ZXIoKGZpbGUpID0+IGZpbGUucGF0aC5zdGFydHNXaXRoKGRpcmVjdG9yeSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNhYmxlQnV0dG9uKGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQpIHtcbiAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJtb2Qtd2FybmluZ1wiKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQnV0dG9uU3RhdGUoXG4gICAgYnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudCxcbiAgICBmaWxlczogVEZpbGVbXSxcbiAgICB0eXBlOiBzdHJpbmdcbiAgKSB7XG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuY2FsY3VsYXRlU2l6ZShmaWxlcyk7XG4gICAgY29uc3QgaGFzRmlsZXMgPSBmaWxlcy5sZW5ndGggPiAwO1xuXG4gICAgaWYgKGhhc0ZpbGVzKSB7XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC13YXJuaW5nXCIpO1xuICAgICAgYnV0dG9uLnNldFRleHQoYENsZWFyIEFsbCAke3R5cGV9ICgke3NpemV9KWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgYnV0dG9uLmFkZENsYXNzKFwibW9kLWRpc2FibGVkXCIpO1xuICAgICAgYnV0dG9uLnJlbW92ZUNsYXNzKFwibW9kLXdhcm5pbmdcIik7XG4gICAgICBidXR0b24uc2V0VGV4dChgTm8gJHt0eXBlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2xlYW5EaXJlY3RvcnkoZGlyZWN0b3J5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBTYWZldHkgY2hlY2s6IHByZXZlbnQgZGVsZXRpb24gb2Ygcm9vdCBvciBzeXN0ZW0gZGlyZWN0b3JpZXNcbiAgICBpZiAoXG4gICAgICAhZGlyZWN0b3J5IHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiL1wiIHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiLlwiIHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiLi5cIlxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlbGV0ZSByb290IG9yIHN5c3RlbSBkaXJlY3Rvcmllc1wiKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgYWxsIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShkaXJlY3RvcnkpO1xuXG4gICAgLy8gTW92ZSBmaWxlcyB0byB0cmFzaFxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZmlsZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLy8gQWZ0ZXIgZmlsZXMgYXJlIG1vdmVkIHRvIHRyYXNoLCBjbGVhbiB1cCBlbXB0eSBkaXJlY3Rvcmllc1xuICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChkaXJlY3RvcnkpO1xuICAgIGlmIChmb2xkZXIgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAvLyBHZXQgYWxsIHN1YmRpcmVjdG9yaWVzXG4gICAgICBjb25zdCBzdWJkaXJzID0gZm9sZGVyLmNoaWxkcmVuXG4gICAgICAgIC5maWx0ZXIoKGNoaWxkKTogY2hpbGQgaXMgVEZvbGRlciA9PiBjaGlsZCBpbnN0YW5jZW9mIFRGb2xkZXIpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLnBhdGgubGVuZ3RoIC0gYS5wYXRoLmxlbmd0aCk7IC8vIFNvcnQgYnkgcGF0aCBsZW5ndGggZGVzY2VuZGluZyB0byBkZWxldGUgZGVlcGVzdCBmaXJzdFxuXG4gICAgICAvLyBEZWxldGUgc3ViZGlyZWN0b3JpZXMgaWYgdGhleSdyZSBlbXB0eVxuICAgICAgZm9yIChjb25zdCBzdWJkaXIgb2Ygc3ViZGlycykge1xuICAgICAgICBpZiAoc3ViZGlyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKHN1YmRpciwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlIHRoZSBtYWluIGRpcmVjdG9yeSBpZiBpdCdzIGVtcHR5XG4gICAgICBpZiAoZm9sZGVyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC50cmFzaChmb2xkZXIsIHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvd0ZpbGVQcmV2aWV3KGZpbGVzOiBURmlsZVtdLCB0eXBlOiBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtZmlsZS10cmVlIG5hdi1mb2xkZXJcIjtcblxuICAgIC8vIEFkZCBzdW1tYXJ5IHRleHRcbiAgICBjb25zdCBzdW1tYXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBzdW1tYXJ5LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlci10aXRsZVwiO1xuICAgIHN1bW1hcnkudGV4dENvbnRlbnQgPSBgJHtmaWxlcy5sZW5ndGh9ICR7dHlwZX0gKCR7dGhpcy5jYWxjdWxhdGVTaXplKFxuICAgICAgZmlsZXNcbiAgICApfSlgO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdW1tYXJ5KTtcblxuICAgIC8vIFNvcnQgZmlsZXMgYnkgcGF0aCBmb3IgYmV0dGVyIG9yZ2FuaXphdGlvblxuICAgIGNvbnN0IHNvcnRlZEZpbGVzID0gZmlsZXMuc29ydCgoYSwgYikgPT4gYS5wYXRoLmxvY2FsZUNvbXBhcmUoYi5wYXRoKSk7XG5cbiAgICAvLyBHcm91cCBmaWxlcyBieSBkaXJlY3RvcnlcbiAgICBjb25zdCBmaWxlc0J5RGlyID0gbmV3IE1hcDxzdHJpbmcsIFRGaWxlW10+KCk7XG4gICAgZm9yIChjb25zdCBmaWxlIG9mIHNvcnRlZEZpbGVzKSB7XG4gICAgICBjb25zdCBkaXIgPSBmaWxlLnBhcmVudD8ucGF0aCB8fCBcIlwiO1xuICAgICAgaWYgKCFmaWxlc0J5RGlyLmhhcyhkaXIpKSB7XG4gICAgICAgIGZpbGVzQnlEaXIuc2V0KGRpciwgW10pO1xuICAgICAgfVxuICAgICAgZmlsZXNCeURpci5nZXQoZGlyKT8ucHVzaChmaWxlKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZmlsZSB0cmVlXG4gICAgZm9yIChjb25zdCBbZGlyLCBkaXJGaWxlc10gb2YgZmlsZXNCeURpcikge1xuICAgICAgaWYgKGRpcikge1xuICAgICAgICBjb25zdCBmb2xkZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJEaXYuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyXCI7XG5cbiAgICAgICAgY29uc3QgZm9sZGVyVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJUaXRsZS5jbGFzc05hbWUgPSBcIm5hdi1mb2xkZXItdGl0bGVcIjtcbiAgICAgICAgc2V0SWNvbihmb2xkZXJUaXRsZSwgXCJmb2xkZXJcIik7XG4gICAgICAgIGZvbGRlclRpdGxlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBkaXIgfSk7XG4gICAgICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJUaXRsZSk7XG5cbiAgICAgICAgY29uc3QgZm9sZGVyQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGZvbGRlckNvbnRlbnQuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyLWNoaWxkcmVuXCI7XG4gICAgICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJDb250ZW50KTtcblxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZGlyRmlsZXMpIHtcbiAgICAgICAgICBmb2xkZXJDb250ZW50LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRmlsZUl0ZW0oZmlsZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZvbGRlckRpdik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWxlcyBpbiByb290XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBkaXJGaWxlcykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUZpbGVJdGVtKGZpbGUpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUZpbGVJdGVtKGZpbGU6IFRGaWxlKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGZpbGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGZpbGVEaXYuY2xhc3NOYW1lID0gXCJuYXYtZmlsZVwiO1xuXG4gICAgY29uc3QgZmlsZVRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBmaWxlVGl0bGUuY2xhc3NOYW1lID0gXCJuYXYtZmlsZS10aXRsZVwiO1xuXG4gICAgLy8gU2V0IGFwcHJvcHJpYXRlIGljb24gYmFzZWQgb24gZmlsZSB0eXBlXG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgaWNvbk5hbWUgPSBcImZpbGVcIjtcbiAgICBpZiAoW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIFtcImpwZ1wiLCBcImpwZWdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJ3ZWJwXCIsIFwic3ZnXCJdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICApIHtcbiAgICAgIGljb25OYW1lID0gXCJpbWFnZVwiO1xuICAgIH0gZWxzZSBpZiAoW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIGljb25OYW1lID0gXCJhdWRpby1saW5lc1wiO1xuICAgIH0gZWxzZSBpZiAoW1wicGRmXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIGljb25OYW1lID0gXCJmaWxlLXRleHRcIjtcbiAgICB9XG4gICAgc2V0SWNvbihmaWxlVGl0bGUsIGljb25OYW1lKTtcblxuICAgIC8vIEZpbGUgbmFtZVxuICAgIGZpbGVUaXRsZS5jcmVhdGVTcGFuKHsgdGV4dDogZmlsZS5uYW1lIH0pO1xuXG4gICAgLy8gRmlsZSBzaXplXG4gICAgY29uc3Qgc2l6ZVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBzaXplU3Bhbi5jbGFzc05hbWUgPSBcIm5hdi1maWxlLXNpemVcIjtcbiAgICBzaXplU3Bhbi50ZXh0Q29udGVudCA9IHRoaXMuY2FsY3VsYXRlU2l6ZShbZmlsZV0pO1xuICAgIGZpbGVUaXRsZS5hcHBlbmRDaGlsZChzaXplU3Bhbik7XG5cbiAgICBmaWxlRGl2LmFwcGVuZENoaWxkKGZpbGVUaXRsZSk7XG4gICAgcmV0dXJuIGZpbGVEaXY7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgZmlsZXM6IFRGaWxlW10sXG4gICAgdHlwZTogc3RyaW5nLFxuICAgIGRpcmVjdG9yeTogc3RyaW5nLFxuICAgIGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnRcbiAgKSB7XG4gICAgY29uc3QgY29uZmlybU1vZGFsID0gbmV3IE1vZGFsKHRoaXMuYXBwKTtcbiAgICBjb25maXJtTW9kYWwudGl0bGVFbC5zZXRUZXh0KGBDbGVhciAke3R5cGV9YCk7XG5cbiAgICBjb25zdCBjb250ZW50ID0gY29uZmlybU1vZGFsLmNvbnRlbnRFbDtcbiAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBgXHUyNkEwXHVGRTBGIFdBUk5JTkc6IFRoZSBmb2xsb3dpbmcgZmlsZXMgd2lsbCBiZSBtb3ZlZCB0byB0aGUgT2JzaWRpYW4gdHJhc2guIFlvdSBjYW4gcmVzdG9yZSB0aGVtIGZyb20gdGhlIHRyYXNoIGlmIG5lZWRlZC5gLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGZpbGUgcHJldmlldyBsaXN0XG4gICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLnNob3dGaWxlUHJldmlldyhmaWxlcywgdHlwZSkpO1xuXG4gICAgLy8gQWRkIGJ1dHRvbnNcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWJ1dHRvbnNcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiQ2FuY2VsXCIgfSk7XG4gICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjb25maXJtTW9kYWwuY2xvc2UoKSk7XG5cbiAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJtb2Qtd2FybmluZ1wiLFxuICAgICAgdGV4dDogXCJNb3ZlIHRvIFRyYXNoXCIsXG4gICAgfSk7XG4gICAgY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGVhbkRpcmVjdG9yeShkaXJlY3RvcnkpO1xuICAgICAgICB0aGlzLmRpc2FibGVCdXR0b24oYnV0dG9uKTtcbiAgICAgICAgYnV0dG9uLnNldFRleHQoYE5vICR7dHlwZX1gKTtcblxuICAgICAgICBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgYFN1Y2Nlc3NmdWxseSBtb3ZlZCAke1xuICAgICAgICAgICAgZmlsZXMubGVuZ3RoXG4gICAgICAgICAgfSAke3R5cGUudG9Mb3dlckNhc2UoKX0gZmlsZXMgKCR7dGhpcy5jYWxjdWxhdGVTaXplKFxuICAgICAgICAgICAgZmlsZXNcbiAgICAgICAgICApfSkgdG8gdHJhc2hgLFxuICAgICAgICAgIHsgdGl0bGU6IFwiU3VjY2Vzc1wiIH1cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNsZWFyaW5nICR7dHlwZS50b0xvd2VyQ2FzZSgpfTpgLCBlcnJvcik7XG4gICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgYEZhaWxlZCB0byBjbGVhciAke3R5cGUudG9Mb3dlckNhc2UoKX1gLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25maXJtTW9kYWwuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGlzRW1wdHlGaWxlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gQ2hlY2sgZmlsZSBzaXplIGZpcnN0XG4gICAgaWYgKGZpbGUuc3RhdC5zaXplID09PSAwKSByZXR1cm4gdHJ1ZTtcblxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAvLyBGb3IgbWFya2Rvd24gZmlsZXMsIGNoZWNrIGNvbnRlbnRcbiAgICBpZiAoW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIC8vIFJlbW92ZSBmcm9udG1hdHRlciBhbmQgY2hlY2sgaWYgcmVtYWluaW5nIGNvbnRlbnQgaXMgZW1wdHlcbiAgICAgIGNvbnN0IGNvbnRlbnRXaXRob3V0RnJvbnRtYXR0ZXIgPSBjb250ZW50XG4gICAgICAgIC5yZXBsYWNlKC9eLS0tW1xcc1xcU10qPy0tLS8sIFwiXCIpXG4gICAgICAgIC50cmltKCk7XG4gICAgICByZXR1cm4gIWNvbnRlbnRXaXRob3V0RnJvbnRtYXR0ZXI7XG4gICAgfVxuXG4gICAgLy8gRm9yIGltYWdlcyBhbmQgYmluYXJ5IGZpbGVzLCBqdXN0IGNoZWNrIHNpemVcbiAgICBpZiAoXG4gICAgICBbXG4gICAgICAgIFwianBnXCIsXG4gICAgICAgIFwianBlZ1wiLFxuICAgICAgICBcInBuZ1wiLFxuICAgICAgICBcImdpZlwiLFxuICAgICAgICBcIndlYnBcIixcbiAgICAgICAgXCJzdmdcIixcbiAgICAgICAgXCJtcDNcIixcbiAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgXCJtNGFcIixcbiAgICAgIF0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICkge1xuICAgICAgcmV0dXJuIGZpbGUuc3RhdC5zaXplID09PSAwO1xuICAgIH1cblxuICAgIC8vIEZvciBleHRyYWN0aW9ucywgY2hlY2sgaWYgaXQncyBqdXN0IGhlYWRlcnMgb3IgZXJyb3IgbWVzc2FnZXNcbiAgICBpZiAoZmlsZS5wYXRoLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKSkge1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICBjb25zdCBoYXNPbmx5SGVhZGVycyA9ICFjb250ZW50LnJlcGxhY2UoL14jLiokL2dtLCBcIlwiKS50cmltKCk7XG4gICAgICBjb25zdCBoYXNFcnJvck1lc3NhZ2UgPVxuICAgICAgICBjb250ZW50LmluY2x1ZGVzKFwiRXJyb3IgZXh0cmFjdGluZ1wiKSB8fFxuICAgICAgICBjb250ZW50LmluY2x1ZGVzKFwiUHJvY2Vzc2luZyBmYWlsZWRcIik7XG4gICAgICByZXR1cm4gaGFzT25seUhlYWRlcnMgfHwgaGFzRXJyb3JNZXNzYWdlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RW1wdHlGaWxlcygpOiBQcm9taXNlPFRGaWxlW10+IHtcbiAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgY29uc3QgZW1wdHlGaWxlczogVEZpbGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4gICAgICBpZiAoYXdhaXQgdGhpcy5pc0VtcHR5RmlsZShmaWxlKSkge1xuICAgICAgICBlbXB0eUZpbGVzLnB1c2goZmlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVtcHR5RmlsZXM7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEVtcHR5Rm9sZGVycygpOiBQcm9taXNlPFRGb2xkZXJbXT4ge1xuICAgIGNvbnN0IGVtcHR5Rm9sZGVyczogVEZvbGRlcltdID0gW107XG4gICAgY29uc3QgY2hlY2tGb2xkZXIgPSAoZm9sZGVyOiBURm9sZGVyKTogYm9vbGVhbiA9PiB7XG4gICAgICAvLyBDaGVjayBpZiBmb2xkZXIgaGFzIGFueSBub24tZW1wdHkgY2hpbGRyZW5cbiAgICAgIGNvbnN0IGhhc05vbkVtcHR5Q2hpbGRyZW4gPSBmb2xkZXIuY2hpbGRyZW4uc29tZSgoY2hpbGQpID0+IHtcbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGQuc3RhdC5zaXplID4gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgcmV0dXJuICFjaGVja0ZvbGRlcihjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghaGFzTm9uRW1wdHlDaGlsZHJlbikge1xuICAgICAgICBlbXB0eUZvbGRlcnMucHVzaChmb2xkZXIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgY29uc3Qgcm9vdEZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldFJvb3QoKTtcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHJvb3RGb2xkZXIuY2hpbGRyZW4pIHtcbiAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgY2hlY2tGb2xkZXIoY2hpbGQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbXB0eUZvbGRlcnM7XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWphbml0b3ItbW9kYWxcIik7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICBjb25zdCB0aXRsZUVsID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIiB9KTtcbiAgICB0aXRsZUVsLnNldFRleHQoXCJTeXN0ZW1TY3VscHQgSmFuaXRvclwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aXRsZUVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIsXG4gICAgfSk7XG4gICAgZGVzY3JpcHRpb25FbC5zZXRUZXh0KFwiQ2xlYW4gdXAgYW5kIG9wdGltaXplIHlvdXIgU3lzdGVtU2N1bHB0IHdvcmtzcGFjZVwiKTtcblxuICAgIC8vIENyZWF0ZSBtYWluIGNvbnRlbnQgY29udGFpbmVyXG4gICAgY29uc3QgbWFpbkNvbnRlbnQgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtamFuaXRvci1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgc2VjdGlvbnMgY29udGFpbmVyXG4gICAgY29uc3Qgc2VjdGlvbnNDb250YWluZXIgPSBtYWluQ29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9ucy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBFbXB0eSBDb250ZW50IFNlY3Rpb25cbiAgICB0aGlzLmNyZWF0ZUVtcHR5Q29udGVudFNlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIENoYXQgSGlzdG9yeSBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVDaGF0SGlzdG9yeVNlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIEV4dHJhY3Rpb25zIFNlY3Rpb25cbiAgICB0aGlzLmNyZWF0ZUV4dHJhY3Rpb25zU2VjdGlvbihzZWN0aW9uc0NvbnRhaW5lcik7XG5cbiAgICAvLyBBZGQgUmVjb3JkaW5ncyBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVSZWNvcmRpbmdzU2VjdGlvbihzZWN0aW9uc0NvbnRhaW5lcik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUVtcHR5Q29udGVudFNlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGVtcHR5U2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiRW1wdHkgQ29udGVudFwiLFxuICAgICAgXCJDbGVhbiB1cCBlbXB0eSBmaWxlcyBhbmQgZm9sZGVyc1wiXG4gICAgKTtcblxuICAgIGNvbnN0IGVtcHR5RmlsZXMgPSBhd2FpdCB0aGlzLmdldEVtcHR5RmlsZXMoKTtcbiAgICBjb25zdCBlbXB0eUZvbGRlcnMgPSBhd2FpdCB0aGlzLmdldEVtcHR5Rm9sZGVycygpO1xuICAgIGNvbnN0IHRvdGFsRW1wdHkgPSBlbXB0eUZpbGVzLmxlbmd0aCArIGVtcHR5Rm9sZGVycy5sZW5ndGg7XG5cbiAgICBjb25zdCBjbGVhckVtcHR5QnV0dG9uID0gZW1wdHlTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OlxuICAgICAgICB0b3RhbEVtcHR5ID4gMFxuICAgICAgICAgID8gYENsZWFyIEVtcHR5IENvbnRlbnQgKCR7dG90YWxFbXB0eX0gaXRlbXMpYFxuICAgICAgICAgIDogXCJObyBFbXB0eSBDb250ZW50XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG5cbiAgICB0aGlzLnVwZGF0ZUJ1dHRvblN0YXRlKGNsZWFyRW1wdHlCdXR0b24sIGVtcHR5RmlsZXMsIFwiRW1wdHkgQ29udGVudFwiKTtcblxuICAgIGlmICh0b3RhbEVtcHR5ID4gMCkge1xuICAgICAgY2xlYXJFbXB0eUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJFbXB0eUJ1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhIHByZXZpZXcgdGhhdCBpbmNsdWRlcyBib3RoIGZpbGVzIGFuZCBmb2xkZXJzXG4gICAgICAgIGNvbnN0IGNvbmZpcm1Nb2RhbCA9IG5ldyBNb2RhbCh0aGlzLmFwcCk7XG4gICAgICAgIGNvbmZpcm1Nb2RhbC50aXRsZUVsLnNldFRleHQoXCJDbGVhciBFbXB0eSBDb250ZW50XCIpO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb25maXJtTW9kYWwuY29udGVudEVsO1xuICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgICAgICAgIHRleHQ6IGBcdTI2QTBcdUZFMEYgV0FSTklORzogVGhlIGZvbGxvd2luZyBlbXB0eSBpdGVtcyB3aWxsIGJlIG1vdmVkIHRvIHRoZSBPYnNpZGlhbiB0cmFzaC4gWW91IGNhbiByZXN0b3JlIHRoZW0gZnJvbSB0aGUgdHJhc2ggaWYgbmVlZGVkLmAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNob3cgZW1wdHkgZmlsZXNcbiAgICAgICAgaWYgKGVtcHR5RmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1oZWFkZXJcIixcbiAgICAgICAgICAgIHRleHQ6IFwiRW1wdHkgRmlsZXNcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHRoaXMuc2hvd0ZpbGVQcmV2aWV3KGVtcHR5RmlsZXMsIFwiRW1wdHkgRmlsZXNcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyBlbXB0eSBmb2xkZXJzXG4gICAgICAgIGlmIChlbXB0eUZvbGRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1oZWFkZXJcIixcbiAgICAgICAgICAgIHRleHQ6IFwiRW1wdHkgRm9sZGVyc1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGZvbGRlckxpc3QgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtdHJlZSBuYXYtZm9sZGVyXCIsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBlbXB0eUZvbGRlcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlckl0ZW0gPSBmb2xkZXJMaXN0LmNyZWF0ZURpdih7XG4gICAgICAgICAgICAgIGNsczogXCJuYXYtZm9sZGVyLXRpdGxlXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNldEljb24oZm9sZGVySXRlbSwgXCJmb2xkZXJcIik7XG4gICAgICAgICAgICBmb2xkZXJJdGVtLmNyZWF0ZVNwYW4oeyB0ZXh0OiBmb2xkZXIucGF0aCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgYnV0dG9uc1xuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1idXR0b25zXCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY29uZmlybU1vZGFsLmNsb3NlKCkpO1xuXG4gICAgICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICAgIGNsczogXCJtb2Qtd2FybmluZ1wiLFxuICAgICAgICAgIHRleHQ6IFwiTW92ZSB0byBUcmFzaFwiLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIERlbGV0ZSBlbXB0eSBmaWxlcyBmaXJzdFxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGVtcHR5RmlsZXMpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZmlsZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRoZW4gZGVsZXRlIGVtcHR5IGZvbGRlcnMgKGRlZXBlc3QgZmlyc3QpXG4gICAgICAgICAgICBjb25zdCBzb3J0ZWRGb2xkZXJzID0gZW1wdHlGb2xkZXJzLnNvcnQoXG4gICAgICAgICAgICAgIChhLCBiKSA9PiBiLnBhdGgubGVuZ3RoIC0gYS5wYXRoLmxlbmd0aFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIHNvcnRlZEZvbGRlcnMpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZm9sZGVyLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKGNsZWFyRW1wdHlCdXR0b24pO1xuICAgICAgICAgICAgY2xlYXJFbXB0eUJ1dHRvbi5zZXRUZXh0KFwiTm8gRW1wdHkgQ29udGVudFwiKTtcblxuICAgICAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgYFN1Y2Nlc3NmdWxseSBtb3ZlZCAke3RvdGFsRW1wdHl9IGVtcHR5IGl0ZW1zIHRvIHRyYXNoYCxcbiAgICAgICAgICAgICAgeyB0aXRsZTogXCJTdWNjZXNzXCIgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNsZWFyaW5nIGVtcHR5IGNvbnRlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gY2xlYXIgZW1wdHkgY29udGVudFwiLCB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uZmlybU1vZGFsLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNoYXRIaXN0b3J5U2VjdGlvbihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgaGlzdG9yeVNlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkNoYXQgSGlzdG9yeVwiLFxuICAgICAgXCJEZWxldGUgYWxsIGNoYXQgaGlzdG9yeSBhbmQgY29udmVyc2F0aW9ucyBwZXJtYW5lbnRseVwiXG4gICAgKTtcblxuICAgIGNvbnN0IGNoYXRGaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5XG4gICAgKTtcbiAgICBjb25zdCBjaGF0U2l6ZSA9IHRoaXMuY2FsY3VsYXRlU2l6ZShjaGF0RmlsZXMpO1xuICAgIGNvbnN0IGhhc0NoYXRGaWxlcyA9IGNoYXRGaWxlcy5sZW5ndGggPiAwO1xuXG4gICAgY29uc3QgY2xlYXJIaXN0b3J5QnV0dG9uID0gaGlzdG9yeVNlY3Rpb24uY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIHRleHQ6IGhhc0NoYXRGaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgQ2hhdCBIaXN0b3J5ICgke2NoYXRTaXplfSlgXG4gICAgICAgIDogXCJObyBDaGF0IEhpc3RvcnlcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoY2xlYXJIaXN0b3J5QnV0dG9uLCBjaGF0RmlsZXMsIFwiQ2hhdCBIaXN0b3J5XCIpO1xuXG4gICAgaWYgKGhhc0NoYXRGaWxlcykge1xuICAgICAgY2xlYXJIaXN0b3J5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChjbGVhckhpc3RvcnlCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgYXdhaXQgdGhpcy5zaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgICAgICAgIGNoYXRGaWxlcyxcbiAgICAgICAgICBcIkNoYXQgSGlzdG9yeVwiLFxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5LFxuICAgICAgICAgIGNsZWFySGlzdG9yeUJ1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFeHRyYWN0aW9uc1NlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGV4dHJhY3Rpb25zU2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiRG9jdW1lbnQgRXh0cmFjdGlvbnNcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBleHRyYWN0ZWQgZG9jdW1lbnQgY29udGVudCAoUERGcywgZG9jdW1lbnRzLCBldGMuKVwiXG4gICAgKTtcblxuICAgIGNvbnN0IGV4dHJhY3Rpb25GaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4dHJhY3Rpb25zRGlyZWN0b3J5XG4gICAgKTtcbiAgICBjb25zdCBleHRyYWN0aW9uc1NpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoZXh0cmFjdGlvbkZpbGVzKTtcbiAgICBjb25zdCBoYXNFeHRyYWN0aW9uRmlsZXMgPSBleHRyYWN0aW9uRmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFyRXh0cmFjdGlvbnNCdXR0b24gPSBleHRyYWN0aW9uc1NlY3Rpb24uY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIHRleHQ6IGhhc0V4dHJhY3Rpb25GaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgRXh0cmFjdGlvbnMgKCR7ZXh0cmFjdGlvbnNTaXplfSlgXG4gICAgICAgIDogXCJObyBFeHRyYWN0aW9uc1wiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShcbiAgICAgIGNsZWFyRXh0cmFjdGlvbnNCdXR0b24sXG4gICAgICBleHRyYWN0aW9uRmlsZXMsXG4gICAgICBcIkV4dHJhY3Rpb25zXCJcbiAgICApO1xuXG4gICAgaWYgKGhhc0V4dHJhY3Rpb25GaWxlcykge1xuICAgICAgY2xlYXJFeHRyYWN0aW9uc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJFeHRyYWN0aW9uc0J1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuICAgICAgICBhd2FpdCB0aGlzLnNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgICAgICAgZXh0cmFjdGlvbkZpbGVzLFxuICAgICAgICAgIFwiRXh0cmFjdGlvbnNcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHRyYWN0aW9uc0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhckV4dHJhY3Rpb25zQnV0dG9uXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVJlY29yZGluZ3NTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWNvcmRpbmdzU2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiQXVkaW8gUmVjb3JkaW5nc1wiLFxuICAgICAgXCJEZWxldGUgYWxsIGF1ZGlvIHJlY29yZGluZ3MgKHRoaXMgd29uJ3QgYWZmZWN0IHRyYW5zY3JpcHRpb25zKVwiXG4gICAgKTtcblxuICAgIGNvbnN0IHJlY29yZGluZ0ZpbGVzID0gdGhpcy5nZXRGaWxlc0luRGlyZWN0b3J5KFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgcmVjb3JkaW5nc1NpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUocmVjb3JkaW5nRmlsZXMpO1xuICAgIGNvbnN0IGhhc1JlY29yZGluZ0ZpbGVzID0gcmVjb3JkaW5nRmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFyUmVjb3JkaW5nc0J1dHRvbiA9IHJlY29yZGluZ3NTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNSZWNvcmRpbmdGaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgUmVjb3JkaW5ncyAoJHtyZWNvcmRpbmdzU2l6ZX0pYFxuICAgICAgICA6IFwiTm8gUmVjb3JkaW5nc1wiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShjbGVhclJlY29yZGluZ3NCdXR0b24sIHJlY29yZGluZ0ZpbGVzLCBcIlJlY29yZGluZ3NcIik7XG5cbiAgICBpZiAoaGFzUmVjb3JkaW5nRmlsZXMpIHtcbiAgICAgIGNsZWFyUmVjb3JkaW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJSZWNvcmRpbmdzQnV0dG9uLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIGF3YWl0IHRoaXMuc2hvd0NvbmZpcm1hdGlvbkRpYWxvZyhcbiAgICAgICAgICByZWNvcmRpbmdGaWxlcyxcbiAgICAgICAgICBcIlJlY29yZGluZ3NcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWNvcmRpbmdzRGlyZWN0b3J5LFxuICAgICAgICAgIGNsZWFyUmVjb3JkaW5nc0J1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTZWN0aW9uKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gICk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBzZWN0aW9uID0gY29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWphbml0b3Itc2VjdGlvblwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgaGVhZGVyID0gc2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIgfSk7XG4gICAgaGVhZGVyLnNldFRleHQodGl0bGUpO1xuXG4gICAgY29uc3QgZGVzYyA9IHNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWRlc2NyaXB0aW9uXCIgfSk7XG4gICAgZGVzYy5zZXRUZXh0KGRlc2NyaXB0aW9uKTtcblxuICAgIHJldHVybiBzZWN0aW9uO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IEphbml0b3JNb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvSmFuaXRvck1vZGFsXCI7XG5pbXBvcnQgeyBMb2FkQ2hhdE1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Mb2FkQ2hhdE1vZGFsXCI7XG5cbmV4cG9ydCBjbGFzcyBSaWJib25NYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgYXBwOiBBcHApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSByaWJib24gbWFuYWdlciBhbmQgcmVnaXN0ZXIgYWxsIHJpYmJvbiBpY29uc1xuICAgKi9cbiAgaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyUmliYm9uSWNvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhbGwgcmliYm9uIGljb25zIGluIHRoZSBjb3JyZWN0IG9yZGVyOlxuICAgKiAxLiBTeXN0ZW1TY3VscHQgQ2hhdFxuICAgKiAyLiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XG4gICAqIDMuIFN5c3RlbVNjdWxwdCBKYW5pdG9yXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyUmliYm9uSWNvbnMoKSB7XG4gICAgLy8gMS4gU3lzdGVtU2N1bHB0IENoYXRcbiAgICB0aGlzLnBsdWdpbi5hZGRSaWJib25JY29uKFxuICAgICAgXCJtZXNzYWdlLXNxdWFyZVwiLFxuICAgICAgXCJPcGVuIFN5c3RlbVNjdWxwdCBDaGF0XCIsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMub3BlbkNoYXRWaWV3KCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIDIuIENoYXQgSGlzdG9yeVxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXG4gICAgICBcImhpc3RvcnlcIixcbiAgICAgIFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMub3BlbkNoYXRIaXN0b3J5TW9kYWwoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gMy4gSmFuaXRvclxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXCJ0cmFzaFwiLCBcIk9wZW4gU3lzdGVtU2N1bHB0IEphbml0b3JcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vcGVuSmFuaXRvck1vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogT3BlbiBhIG5ldyBTeXN0ZW1TY3VscHQgQ2hhdCB2aWV3IGluIGEgbmV3IHRhYlxuICAgKi9cbiAgcHVibGljIGFzeW5jIG9wZW5DaGF0VmlldygpIHtcbiAgICBjb25zdCB7IHdvcmtzcGFjZSB9ID0gdGhpcy5hcHA7XG4gICAgY29uc3QgbGVhZiA9IHdvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICB3b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBDaGF0IEhpc3RvcnkgbW9kYWxcbiAgICovXG4gIHB1YmxpYyBvcGVuQ2hhdEhpc3RvcnlNb2RhbCgpIHtcbiAgICBjb25zdCBtb2RhbCA9IG5ldyBMb2FkQ2hhdE1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICBhc3luYyAoY2hhdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICAgICAgY29uc3QgdmlldyA9IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbik7XG4gICAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgICAgYXdhaXQgdmlldy5sb2FkQ2hhdEJ5SWQoY2hhdElkKTtcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcbiAgICAgIH0sXG4gICAgICB0aGlzLnBsdWdpblxuICAgICk7XG4gICAgbW9kYWwub3BlbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBKYW5pdG9yIG1vZGFsXG4gICAqL1xuICBwdWJsaWMgb3Blbkphbml0b3JNb2RhbCgpIHtcbiAgICBuZXcgSmFuaXRvck1vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbikub3BlbigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBDaGF0VmlldywgQ0hBVF9WSUVXX1RZUEUgfSBmcm9tIFwiLi4vLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IFJpYmJvbk1hbmFnZXIgfSBmcm9tIFwiLi9yaWJib25zXCI7XG5cbmV4cG9ydCBjbGFzcyBWaWV3TWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgcmliYm9uTWFuYWdlcjogUmliYm9uTWFuYWdlcjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgYXBwOiBBcHApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLnJpYmJvbk1hbmFnZXIgPSBuZXcgUmliYm9uTWFuYWdlcihwbHVnaW4sIGFwcCk7XG4gIH1cblxuICBpbml0aWFsaXplKCkge1xuICAgIHRoaXMucmVnaXN0ZXJWaWV3KCk7XG4gICAgdGhpcy5yaWJib25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XG4gICAgICB0aGlzLnJlc3RvcmVDaGF0Vmlld3MoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHJlc3RvcmVDaGF0Vmlld3MoKSB7XG4gICAgY29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShDSEFUX1ZJRVdfVFlQRSk7XG5cbiAgICBpZiAobGVhdmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xuICAgICAgY29uc3QgdmlldyA9IGxlYWYudmlldyBhcyBDaGF0VmlldztcbiAgICAgIGNvbnN0IHN0YXRlID0gbGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5zdGF0ZSAmJiBzdGF0ZS5zdGF0ZS5jaGF0SWQpIHtcbiAgICAgICAgYXdhaXQgdmlldy5zZXRTdGF0ZShzdGF0ZS5zdGF0ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJWaWV3KCkge1xuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyVmlldyhcbiAgICAgIENIQVRfVklFV19UWVBFLFxuICAgICAgKGxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbilcbiAgICApO1xuICB9XG5cbiAgdW5sb2FkVmlld3MoKSB7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZShDSEFUX1ZJRVdfVFlQRSk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IFJpYmJvbk1hbmFnZXIgfSBmcm9tIFwiLi9yaWJib25zXCI7XG5pbXBvcnQgeyBDaGF0VmlldyB9IGZyb20gXCIuLi8uLi92aWV3cy9DaGF0Vmlld1wiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlIH0gZnJvbSBcIi4uLy4uL2NvcmUvdWlcIjtcblxuZXhwb3J0IGNsYXNzIENvbW1hbmRNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSByaWJib25NYW5hZ2VyOiBSaWJib25NYW5hZ2VyO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBhcHA6IEFwcCkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMucmliYm9uTWFuYWdlciA9IG5ldyBSaWJib25NYW5hZ2VyKHBsdWdpbiwgYXBwKTtcbiAgfVxuXG4gIHJlZ2lzdGVyQ29tbWFuZHMoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXRhc2tzLWZpbGVcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBUYXNrcyBGaWxlXCIsXG4gICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi50YXNrc1NlcnZpY2Uub3Blbk9yQ3JlYXRlVGFza3NGaWxlKCk7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW1xuICAgICAgICB7XG4gICAgICAgICAgbW9kaWZpZXJzOiBbXCJNb2RcIl0sXG4gICAgICAgICAga2V5OiBcInRcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcInRvZ2dsZS1hdWRpby1yZWNvcmRlclwiLFxuICAgICAgbmFtZTogXCJUb2dnbGUgQXVkaW8gUmVjb3JkZXJcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucGx1Z2luLmdldFJlY29yZGVyU2VydmljZSgpLnRvZ2dsZVJlY29yZGluZygpO1xuICAgICAgfSxcbiAgICAgIGhvdGtleXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG1vZGlmaWVyczogW1wiTW9kXCJdLFxuICAgICAgICAgIGtleTogXCJyXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1jaGF0XCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IENoYXRcIixcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMucmliYm9uTWFuYWdlci5vcGVuQ2hhdFZpZXcoKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tY2hhdC1oaXN0b3J5XCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IENoYXQgSGlzdG9yeVwiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5yaWJib25NYW5hZ2VyLm9wZW5DaGF0SGlzdG9yeU1vZGFsKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1qYW5pdG9yXCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IEphbml0b3JcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucmliYm9uTWFuYWdlci5vcGVuSmFuaXRvck1vZGFsKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJyZWxvYWQtb2JzaWRpYW5cIixcbiAgICAgIG5hbWU6IFwiUmVsb2FkIE9ic2lkaWFuXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1zZXR0aW5nc1wiLFxuICAgICAgbmFtZTogXCJPcGVuIFN5c3RlbVNjdWxwdCBBSSBTZXR0aW5nc1wiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIHRoaXMgaXMgYSBidWcgaW4gdGhlIE9ic2lkaWFuIEFQSVxuICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLm9wZW4oKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIHRoaXMgaXMgYSBidWcgaW4gdGhlIE9ic2lkaWFuIEFQSVxuICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLm9wZW5UYWJCeUlkKHRoaXMucGx1Z2luLm1hbmlmZXN0LmlkKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNoYW5nZS1jaGF0LW1vZGVsXCIsXG4gICAgICBuYW1lOiBcIkNoYW5nZSBDaGF0IE1vZGVsXCIsXG4gICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgY29uc3QgY2hhdFZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShDaGF0Vmlldyk7XG4gICAgICAgIGlmICghY2hhdFZpZXcpIHtcbiAgICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXG4gICAgICAgICAgICAgIFwiWW91IG5lZWQgdG8gYmUgd2l0aGluIGEgU3lzdGVtU2N1bHB0IGNoYXR2aWV3IHRvIGNoYW5nZSB0aGUgbW9kZWwuXCIsXG4gICAgICAgICAgICAgIFwid2FybmluZ1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgIGNoYXRWaWV3LmdldFNlbGVjdGVkTW9kZWxJZCgpLFxuICAgICAgICAgICAgICAgIGFzeW5jIChtb2RlbElkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBhd2FpdCBjaGF0Vmlldy5zZXRTZWxlY3RlZE1vZGVsSWQobW9kZWxJZCk7XG4gICAgICAgICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJNb2RlbCBjaGFuZ2VkIHN1Y2Nlc3NmdWxseVwiLCBcImluZm9cIik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIG9wZW4gbW9kZWwgc2VsZWN0aW9uOlwiLCBlcnIpO1xuICAgICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggYXZhaWxhYmxlIG1vZGVsc1wiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjaGF0LXdpdGgtZmlsZVwiLFxuICAgICAgbmFtZTogXCJDaGF0IHdpdGggRmlsZVwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICAgICAgICBpZiAoIWFjdGl2ZUZpbGUpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhY3RpdmVGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBzdXBwb3J0ZWRFeHRlbnNpb25zID0gW1xuICAgICAgICAgIC8vIFRleHQgZmlsZXNcbiAgICAgICAgICBcIm1kXCIsXG4gICAgICAgICAgXCJ0eHRcIixcbiAgICAgICAgICBcIm1hcmtkb3duXCIsXG4gICAgICAgICAgLy8gRG9jdW1lbnRzXG4gICAgICAgICAgXCJwZGZcIixcbiAgICAgICAgICBcImRvY1wiLFxuICAgICAgICAgIFwiZG9jeFwiLFxuICAgICAgICAgIFwicHB0XCIsXG4gICAgICAgICAgXCJwcHR4XCIsXG4gICAgICAgICAgXCJ4bHNcIixcbiAgICAgICAgICBcInhsc3hcIixcbiAgICAgICAgICAvLyBBdWRpbyBmaWxlc1xuICAgICAgICAgIFwibXAzXCIsXG4gICAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgICBcIm00YVwiLFxuICAgICAgICAgIFwib2dnXCIsXG4gICAgICAgICAgXCJ3ZWJtXCIsXG4gICAgICAgICAgLy8gSW1hZ2VzXG4gICAgICAgICAgXCJqcGdcIixcbiAgICAgICAgICBcImpwZWdcIixcbiAgICAgICAgICBcInBuZ1wiLFxuICAgICAgICAgIFwiZ2lmXCIsXG4gICAgICAgICAgXCJ3ZWJwXCIsXG4gICAgICAgICAgXCJzdmdcIixcbiAgICAgICAgXTtcblxuICAgICAgICBpZiAoIXN1cHBvcnRlZEV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoXCJ0YWJcIik7XG4gICAgICAgICAgY29uc3QgdmlldyA9IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbik7XG4gICAgICAgICAgbGVhZi5vcGVuKHZpZXcpLnRoZW4oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgICAgICBhd2FpdCB2aWV3LmFkZEZpbGVUb0NvbnRleHQoYWN0aXZlRmlsZSk7XG4gICAgICAgICAgICB2aWV3LmZvY3VzSW5wdXQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEN1c3RvbVByb3ZpZGVyIH0gZnJvbSBcInNyYy90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcInNyYy9tYWluXCI7XG5cbmludGVyZmFjZSBUZXN0Q29ubmVjdGlvblJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yPzogc3RyaW5nO1xuICBtb2RlbHM/OiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBPcGVuUm91dGVyTW9kZWwge1xuICBpZDogc3RyaW5nO1xuICBwcmljaW5nOiB7XG4gICAgcHJvbXB0OiBzdHJpbmc7XG4gICAgY29tcGxldGlvbjogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgc3RhdGljIGNvbm5lY3Rpb25UZXN0Q2FjaGU6IE1hcDxcbiAgICBzdHJpbmcsXG4gICAge1xuICAgICAgcmVzdWx0OiBUZXN0Q29ubmVjdGlvblJlc3VsdDtcbiAgICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICAgIH1cbiAgPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBzdGF0aWMgY29ubmVjdGlvblRlc3RQcm9taXNlczogTWFwPFxuICAgIHN0cmluZyxcbiAgICBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PlxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IENBQ0hFX0RVUkFUSU9OID0gMzAgKiA2MCAqIDEwMDA7IC8vIDMwIG1pbnV0ZXNcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IGNvbm5lY3Rpb24gdG8gYSBwcm92aWRlciBieSBhdHRlbXB0aW5nIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcbiAgICogRm9yIE9wZW5Sb3V0ZXIsIHdlIGFsc28gdmFsaWRhdGUgdGhlIEFQSSBrZXkgYnkgbWFraW5nIGEgbWluaW1hbCBjb21wbGV0aW9uIHJlcXVlc3RcbiAgICovXG4gIGFzeW5jIHRlc3RDb25uZWN0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlclxuICApOiBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PiB7XG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RDYWNoZS5nZXQocHJvdmlkZXIuaWQpO1xuICAgIGlmIChjYWNoZWQgJiYgRGF0ZS5ub3coKSAtIGNhY2hlZC5yZXN1bHQudGltZXN0YW1wIDwgdGhpcy5DQUNIRV9EVVJBVElPTikge1xuICAgICAgcmV0dXJuIGNhY2hlZC5yZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSB0ZXN0aW5nIHRoaXMgcHJvdmlkZXJcbiAgICBjb25zdCBleGlzdGluZ1Byb21pc2UgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5nZXQoXG4gICAgICBwcm92aWRlci5pZFxuICAgICk7XG4gICAgaWYgKGV4aXN0aW5nUHJvbWlzZSkge1xuICAgICAgcmV0dXJuIGV4aXN0aW5nUHJvbWlzZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBuZXcgdGVzdFxuICAgIGNvbnN0IHRlc3RQcm9taXNlID0gdGhpcy5wZXJmb3JtQ29ubmVjdGlvblRlc3QocHJvdmlkZXIpO1xuICAgIEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdFByb21pc2VzLnNldChwcm92aWRlci5pZCwgdGVzdFByb21pc2UpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RQcm9taXNlO1xuICAgICAgLy8gQ2FjaGUgc3VjY2Vzc2Z1bCByZXN1bHRzXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlLmNvbm5lY3Rpb25UZXN0Q2FjaGUuc2V0KHByb3ZpZGVyLmlkLCB7XG4gICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5kZWxldGUocHJvdmlkZXIuaWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gYWN0dWFsbHkgcGVyZm9ybSB0aGUgY29ubmVjdGlvbiB0ZXN0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1Db25uZWN0aW9uVGVzdChcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXJcbiAgKTogUHJvbWlzZTxUZXN0Q29ubmVjdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLmdldE1vZGVscyhwcm92aWRlcik7XG5cbiAgICAgIC8vIEZvciBPcGVuUm91dGVyLCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBBUEkga2V5IGJ5IG1ha2luZyBhIHRlc3QgY29tcGxldGlvblxuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnZhbGlkYXRlT3BlblJvdXRlcktleShwcm92aWRlciwgbW9kZWxzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbW9kZWxzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIkNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6XCIsIGVycm9yKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB0aGlzLmdldEVycm9yTWVzc2FnZShlcnJvciksXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIE9wZW5Sb3V0ZXIgQVBJIGtleSBieSBtYWtpbmcgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZU9wZW5Sb3V0ZXJLZXkoXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyLFxuICAgIG1vZGVsSWRzOiBzdHJpbmdbXVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cHJvdmlkZXIuYXBpS2V5fWAsXG4gICAgICBcIkhUVFAtUmVmZXJlclwiOiBcImh0dHBzOi8vc3lzdGVtc2N1bHB0LmNvbVwiLFxuICAgICAgXCJYLVRpdGxlXCI6IFwiU3lzdGVtU2N1bHB0IEFJXCIsXG4gICAgfTtcblxuICAgIC8vIE1ha2UgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdCB3aXRoIHRoZSBmcmVlIG1vZGVsXG4gICAgY29uc3QgY29tcGxldGlvblJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6IFwibWV0YS1sbGFtYS9sbGFtYS0zLThiLWluc3RydWN0OmZyZWVcIixcbiAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IFwiSGlcIiB9XSxcbiAgICAgICAgICBtYXhfdG9rZW5zOiAxLFxuICAgICAgICB9KSxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDEwMDAwKSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFjb21wbGV0aW9uUmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IGNvbXBsZXRpb25SZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkludmFsaWQgQVBJIGtleS4gUGxlYXNlIGNoZWNrIHlvdXIgT3BlblJvdXRlciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkluc3VmZmljaWVudCBjcmVkaXRzLiBQbGVhc2UgYWRkIGNyZWRpdHMgdG8geW91ciBPcGVuUm91dGVyIGFjY291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlJhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gaW4gYSBmZXcgbWludXRlcy5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQVBJIGtleSB2YWxpZGF0aW9uIGZhaWxlZDogJHtcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgY29tcGxldGlvblJlc3BvbnNlLnN0YXR1c1RleHRcbiAgICAgICAgfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSBhIHByb3ZpZGVyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldE1vZGVscyhwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH07XG5cbiAgICAvLyBBZGQgQVBJIGtleSBpZiBwcmVzZW50XG4gICAgaWYgKHByb3ZpZGVyLmFwaUtleSkge1xuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgICAgaGVhZGVyc1tcIkhUVFAtUmVmZXJlclwiXSA9IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCI7IC8vIFJlcXVpcmVkIGJ5IE9wZW5Sb3V0ZXJcbiAgICAgICAgaGVhZGVyc1tcIlgtVGl0bGVcIl0gPSBcIlN5c3RlbVNjdWxwdCBBSVwiOyAvLyBSZXF1aXJlZCBieSBPcGVuUm91dGVyXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEaWZmZXJlbnQgZW5kcG9pbnRzIGJhc2VkIG9uIHByb3ZpZGVyIHR5cGUgYW5kIFVSTFxuICAgIGxldCBlbmRwb2ludDogc3RyaW5nO1xuICAgIGlmIChwcm92aWRlci5lbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIikpIHtcbiAgICAgIGVuZHBvaW50ID0gXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL21vZGVsc1wiOyAvLyBPcGVuUm91dGVyIGhhcyBhIHNwZWNpZmljIG1vZGVscyBlbmRwb2ludFxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3IgT3BlbkFJLWNvbXBhdGlibGUgZW5kcG9pbnRzLCBlbnN1cmUgd2UncmUgdXNpbmcgdGhlIC92MS9tb2RlbHMgcGF0aFxuICAgICAgY29uc3QgYmFzZVVybCA9IHByb3ZpZGVyLmVuZHBvaW50LnJlcGxhY2UoL1xcLyskLywgXCJcIik7IC8vIFJlbW92ZSB0cmFpbGluZyBzbGFzaGVzXG4gICAgICBlbmRwb2ludCA9IGJhc2VVcmwuZW5kc1dpdGgoXCIvdjFcIilcbiAgICAgICAgPyBgJHtiYXNlVXJsfS9tb2RlbHNgXG4gICAgICAgIDogYmFzZVVybC5lbmRzV2l0aChcIi92MS9tb2RlbHNcIilcbiAgICAgICAgPyBiYXNlVXJsXG4gICAgICAgIDogYCR7YmFzZVVybH0vdjEvbW9kZWxzYDtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgLy8gQWRkIHRpbWVvdXRcbiAgICAgIHNpZ25hbDogQWJvcnRTaWduYWwudGltZW91dCgxMDAwMCksIC8vIDEwIHNlY29uZCB0aW1lb3V0XG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBBUEkga2V5LiBQbGVhc2UgY2hlY2sgeW91ciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQWNjZXNzIGRlbmllZC4gUGxlYXNlIHZlcmlmeSB5b3VyIEFQSSBrZXkgaGFzIHRoZSBjb3JyZWN0IHBlcm1pc3Npb25zLlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkFQSSBlbmRwb2ludCBub3QgZm91bmQuIFBsZWFzZSBjaGVjayB0aGUgVVJMIGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEhUVFAgZXJyb3I6ICR7ZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgLy8gQWxsIHByb3ZpZGVycyB1c2UgT3BlbkFJIGZvcm1hdDogeyBkYXRhOiBbeyBpZDogc3RyaW5nLCAuLi4gfV0gfVxuICAgIHJldHVybiAoZGF0YS5kYXRhPy5tYXAoKG1vZGVsOiBhbnkpID0+IG1vZGVsLmlkKSB8fCBbXSkuZmlsdGVyKFxuICAgICAgKGlkOiBzdHJpbmcpID0+ICFpZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwid2hpc3BlclwiKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgdXNlci1mcmllbmRseSBlcnJvciBtZXNzYWdlIGZyb20gYW4gZXJyb3Igb2JqZWN0XG4gICAqL1xuICBwcml2YXRlIGdldEVycm9yTWVzc2FnZShlcnJvcjogYW55KTogc3RyaW5nIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgaWYgKGVycm9yLm5hbWUgPT09IFwiQWJvcnRFcnJvclwiKSB7XG4gICAgICAgIHJldHVybiBcIkNvbm5lY3Rpb24gdGltZWQgb3V0LiBQbGVhc2UgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCB0cnkgYWdhaW4uXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiB0aGUgZXJyb3IgbWVzc2FnZSBkaXJlY3RseSBzaW5jZSB3ZSd2ZSBhbHJlYWR5IG1hZGUgaXQgdXNlci1mcmllbmRseVxuICAgICAgLy8gaW4gdmFsaWRhdGVPcGVuUm91dGVyS2V5IGFuZCBnZXRNb2RlbHMgbWV0aG9kc1xuICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQgaWYgdGhlIGlzc3VlIHBlcnNpc3RzLlwiO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIFRhc2tzU2VydmljZSB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzO1xuXG4gIHByaXZhdGUgbGFzdFRhc2tGaWxlUmVvcmRlcjogbnVtYmVyO1xuICBwcml2YXRlIHJlb3JkZXJEZWJvdW5jZTogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIC8vIEluaXRpYWxpemUgYXBwIGFuZCBzZXR0aW5ncyBmaXJzdFxuICAgIHRoaXMuYXBwID0gcGx1Z2luLmFwcDtcbiAgICB0aGlzLnNldHRpbmdzID0gcGx1Z2luLnNldHRpbmdzO1xuXG4gICAgLy8gVHJhY2sgbGFzdCByZW9yZGVyIHRvIHByZXZlbnQgaW1tZWRpYXRlIHJlLWVkaXRzIGNhdXNpbmcgaW5maW5pdGUgbG9vcHM6XG4gICAgdGhpcy5sYXN0VGFza0ZpbGVSZW9yZGVyID0gMDtcbiAgICB0aGlzLnJlb3JkZXJEZWJvdW5jZSA9IDA7IC8vIE5vIGRlbGF5IC0gcHJvY2VzcyBpbW1lZGlhdGVseVxuXG4gICAgLy8gUmVnaXN0ZXIgZXZlbnQgZm9yIGRldGVjdGluZyBjaGFuZ2VzIHRvIHRoZSB0YXNrcyBmaWxlOlxuICAgIHRoaXMucmVnaXN0ZXJUYXNrc0ZpbGVXYXRjaGVyKCk7XG4gIH1cblxuICBhc3luYyBvcGVuT3JDcmVhdGVUYXNrc0ZpbGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdGFza3NEaXIgPSB0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5O1xuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7dGFza3NEaXJ9L1Rhc2tzLm1kYDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2Rpcih0YXNrc0Rpcik7XG5cbiAgICAgIC8vIENyZWF0ZSBkZWZhdWx0IFRhc2tzLm1kIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgIGlmICghKGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKGZpbGVOYW1lKSkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVOYW1lLCBgIyBUYXNrc1xcblxcbi0gWyBdIFNhbXBsZSB0YXNrXFxuYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9wZW4gdGhlIGZpbGVcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZU5hbWUpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGlzIGFscmVhZHkgb3BlbiBpbiBhbnkgbGVhZlxuICAgICAgICBjb25zdCBleGlzdGluZ0xlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2VcbiAgICAgICAgICAuZ2V0TGVhdmVzT2ZUeXBlKFwibWFya2Rvd25cIilcbiAgICAgICAgICAuZmluZCgobGVhZikgPT4gbGVhZi52aWV3LmdldFN0YXRlKCkuZmlsZSA9PT0gZmlsZS5wYXRoKTtcblxuICAgICAgICBpZiAoZXhpc3RpbmdMZWFmKSB7XG4gICAgICAgICAgLy8gRm9jdXMgZXhpc3RpbmcgdGFiXG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYoZXhpc3RpbmdMZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE9wZW4gaW4gbmV3IHRhYlxuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBoYW5kbGUgdGFza3MgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlclRhc2tzRmlsZVdhdGNoZXIoKTogdm9pZCB7XG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwibW9kaWZ5XCIsIGFzeW5jIChmaWxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHRhc2tzRGlyID0gdGhpcy5zZXR0aW5ncy50YXNrc0RpcmVjdG9yeTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG1vZGlmaWVkIGZpbGUgaXMgYSBtYXJrZG93biBmaWxlIHdpdGhpbiB0aGUgdGFza3MgZGlyZWN0b3J5XG4gICAgICAgIGlmIChmaWxlLnBhdGguc3RhcnRzV2l0aCh0YXNrc0RpcikgJiYgZmlsZS5wYXRoLmVuZHNXaXRoKFwiLm1kXCIpKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZW9yZGVyQ29tcGxldGVkVGFza3MoZmlsZSBhcyBURmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVvcmRlckNvbXBsZXRlZFRhc2tzKGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSWYgbW92aW5nIGNvbXBsZXRlZCB0YXNrcyBkb3duIGlzIGRpc2FibGVkLCBkbyBub3RoaW5nXG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLm1vdmVDb21wbGV0ZWRUYXNrc0Rvd24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTa2lwIGlmIGZpbGUgaXMgbm90IGluIHRhc2tzIGRpcmVjdG9yeVxuICAgIGlmICghZmlsZS5wYXRoLnN0YXJ0c1dpdGgodGhpcy5zZXR0aW5ncy50YXNrc0RpcmVjdG9yeSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTa2lwIGlmIG5vdCBhIG1hcmtkb3duIGZpbGVcbiAgICBpZiAoIWZpbGUucGF0aC5lbmRzV2l0aChcIi5tZFwiKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG9yaWdpbmFsID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICBjb25zdCByZW9yZGVyZWQgPSB0aGlzLnJlb3JkZXJDb250ZW50KG9yaWdpbmFsKTtcbiAgICAvLyBJZiBubyBjaGFuZ2UsIGRvIG5vdGhpbmcgdG8gcHJldmVudCBhbiBlbmRsZXNzIG1vZGlmeSBsb29wXG4gICAgaWYgKHJlb3JkZXJlZCAhPT0gb3JpZ2luYWwpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCByZW9yZGVyZWQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVvcmRlckNvbnRlbnQoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3Qgb3V0cHV0OiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBsaXN0QnVmZmVyOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgY29uc3QgZmx1c2hCdWZmZXIgPSAoKSA9PiB7XG4gICAgICBpZiAobGlzdEJ1ZmZlci5sZW5ndGggPiAwKSB7XG4gICAgICAgIG91dHB1dC5wdXNoKC4uLnRoaXMucmVvcmRlckxpc3RCbG9jayhsaXN0QnVmZmVyKSk7XG4gICAgICAgIGxpc3RCdWZmZXIgPSBbXTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAvLyBJZiB0aGUgbGluZSBpcyBhIHRhc2sgbGlzdCBpdGVtLCBhZGQgdG8gb3VyIGJ1ZmZlcjsgb3RoZXJ3aXNlIGZsdXNoIGl0LlxuICAgICAgaWYgKC9eXFxzKi1cXHMqXFxbW3hcXHNdXFxdLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgIGxpc3RCdWZmZXIucHVzaChsaW5lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZsdXNoQnVmZmVyKCk7XG4gICAgICAgIG91dHB1dC5wdXNoKGxpbmUpO1xuICAgICAgfVxuICAgIH1cbiAgICBmbHVzaEJ1ZmZlcigpO1xuICAgIHJldHVybiBvdXRwdXQuam9pbihcIlxcblwiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaXZlbiBhIGNvbnRpZ3VvdXMgYmxvY2sgb2YgdGFzayBsaW5lcywgYnVpbGQgYSB0cmVlIGJhc2VkIG9uIGluZGVudCBsZXZlbHNcbiAgICogYW5kIHRoZW4gcmVjdXJzaXZlbHkgcmVvcmRlciBlYWNoIGdyb3VwIHNvIHRoYXQgd2l0aGluIGVhY2ggZ3JvdXAsIGluY29tcGxldGVcbiAgICogdGFza3MgYXBwZWFyIGFib3ZlIGNvbXBsZXRlZCB0YXNrcyB3aGlsZSBrZWVwaW5nIG5lc3RlZCBzdWJ0YXNrcyB3aXRoIHRoZWlyIHBhcmVudC5cbiAgICovXG4gIHByaXZhdGUgcmVvcmRlckxpc3RCbG9jayhsaW5lczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgdHlwZSBUYXNrTm9kZSA9IHtcbiAgICAgIGxpbmU6IHN0cmluZztcbiAgICAgIGNoaWxkcmVuOiBUYXNrTm9kZVtdO1xuICAgICAgaW5kZW50OiBudW1iZXI7XG4gICAgfTtcblxuICAgIC8vIEhlbHBlcjogY291bnQgbGVhZGluZyB3aGl0ZXNwYWNlIChpbmRlbnRhdGlvbilcbiAgICBmdW5jdGlvbiBnZXRJbmRlbnQobGluZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKS8pO1xuICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0ubGVuZ3RoIDogMDtcbiAgICB9XG5cbiAgICAvLyBCdWlsZCB0aGUgdHJlZTogZWFjaCB0YXNrIGJlY29tZXMgYSBub2RlLCBhbmQgc3Vic2VxdWVudCBsaW5lcyB3aXRoIGdyZWF0ZXIgaW5kZW50IGJlY29tZSBpdHMgY2hpbGRyZW4uXG4gICAgY29uc3Qgbm9kZXM6IFRhc2tOb2RlW10gPSBbXTtcbiAgICBjb25zdCBzdGFjazogVGFza05vZGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBjb25zdCBpbmRlbnQgPSBnZXRJbmRlbnQobGluZSk7XG4gICAgICBjb25zdCBub2RlOiBUYXNrTm9kZSA9IHsgbGluZSwgY2hpbGRyZW46IFtdLCBpbmRlbnQgfTtcbiAgICAgIC8vIFBvcCBmcm9tIHRoZSBzdGFjayB1bnRpbCBmaW5kaW5nIGEgbm9kZSB3aXRoIGxvd2VyIGluZGVudGF0aW9uXG4gICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBpbmRlbnQgPD0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uaW5kZW50KSB7XG4gICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgfVxuICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICBzdGFjay5wdXNoKG5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWRkIGFzIGEgY2hpbGQgb2YgdGhlIG5vZGUgYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2tcbiAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgc3RhY2sucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZWN1cnNpdmVseSByZW9yZGVyIG5vZGVzIGJ5IG1vdmluZyBjb21wbGV0ZWQgdGFza3MgKHRob3NlIHdob3NlIGNoZWNrYm94IGlzIFt4XSkgYmVsb3cgaW5jb21wbGV0ZSBvbmVzLlxuICAgIGZ1bmN0aW9uIHJlb3JkZXJOb2Rlcyhub2RlczogVGFza05vZGVbXSk6IFRhc2tOb2RlW10ge1xuICAgICAgLy8gRmlyc3QsIHByb2Nlc3MgY2hpbGRyZW4gcmVjdXJzaXZlbHkuXG4gICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIG5vZGUuY2hpbGRyZW4gPSByZW9yZGVyTm9kZXMobm9kZS5jaGlsZHJlbik7XG4gICAgICAgICAgLy8gU29ydCBjaGlsZHJlbiBzbyB0aGF0IGluY29tcGxldGUgdGFza3MgY29tZSBiZWZvcmUgY29tcGxldGUgb25lcy5cbiAgICAgICAgICBub2RlLmNoaWxkcmVuLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFDb21wbGV0ZSA9IC9eXFxzKi1cXHMqXFxbeFxcXS9pLnRlc3QoYS5saW5lKSA/IDEgOiAwO1xuICAgICAgICAgICAgY29uc3QgYkNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChiLmxpbmUpID8gMSA6IDA7XG4gICAgICAgICAgICByZXR1cm4gYUNvbXBsZXRlIC0gYkNvbXBsZXRlO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBUaGVuIHNvcnQgdGhlIGN1cnJlbnQgbGV2ZWwgb2Ygbm9kZXMgc2ltaWxhcmx5LlxuICAgICAgbm9kZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCBhQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGEubGluZSkgPyAxIDogMDtcbiAgICAgICAgY29uc3QgYkNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChiLmxpbmUpID8gMSA6IDA7XG4gICAgICAgIHJldHVybiBhQ29tcGxldGUgLSBiQ29tcGxldGU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBub2RlcztcbiAgICB9XG5cbiAgICBjb25zdCByZW9yZGVyZWROb2RlcyA9IHJlb3JkZXJOb2Rlcyhub2Rlcyk7XG5cbiAgICAvLyBGbGF0dGVuIHRoZSB0cmVlIGJhY2sgdG8gYW4gYXJyYXkgb2YgbGluZXNcbiAgICBjb25zdCBmbGF0dGVuZWQ6IHN0cmluZ1tdID0gW107XG4gICAgZnVuY3Rpb24gZmxhdHRlbihub2RlczogVGFza05vZGVbXSkge1xuICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKSB7XG4gICAgICAgIGZsYXR0ZW5lZC5wdXNoKG5vZGUubGluZSk7XG4gICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmbGF0dGVuKG5vZGUuY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZsYXR0ZW4ocmVvcmRlcmVkTm9kZXMpO1xuICAgIHJldHVybiBmbGF0dGVuZWQ7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCwgQ3VzdG9tUHJvdmlkZXIsIEZhdm9yaXRlTW9kZWwgfSBmcm9tIFwiLi4vdHlwZXMvbGxtXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlclNlcnZpY2UgfSBmcm9tIFwiLi9DdXN0b21Qcm92aWRlclNlcnZpY2VcIjtcblxuZXhwb3J0IGNsYXNzIE1vZGVsU2VydmljZSB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2U7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBNb2RlbFNlcnZpY2U7XG4gIHByaXZhdGUgbW9kZWxDYWNoZTogU3lzdGVtU2N1bHB0TW9kZWxbXSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGxhc3RDYWNoZVRpbWU6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgcmVhZG9ubHkgQ0FDSEVfRFVSQVRJT04gPSAzMCAqIDYwICogMTAwMDsgLy8gMzAgbWludXRlc1xuICBwcml2YXRlIGxvYWRpbmdQcm9taXNlOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcbiAgICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBjdXN0b21Qcm92aWRlclNlcnZpY2U6IEN1c3RvbVByb3ZpZGVyU2VydmljZVxuICApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSA9IGN1c3RvbVByb3ZpZGVyU2VydmljZTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShcbiAgICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBjdXN0b21Qcm92aWRlclNlcnZpY2U6IEN1c3RvbVByb3ZpZGVyU2VydmljZVxuICApOiBNb2RlbFNlcnZpY2Uge1xuICAgIGlmICghTW9kZWxTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBNb2RlbFNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgTW9kZWxTZXJ2aWNlKHBsdWdpbiwgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIE1vZGVsU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIG1vZGVscyAoc3lzdGVtIGFuZCBjdXN0b20pIHdpdGggY2FjaGluZy5cbiAgICogVGhpcyBzaG91bGQgYmUgdGhlIG9ubHkgbWV0aG9kIHVzZWQgdG8gZ2V0IG1vZGVscyB0aHJvdWdob3V0IHRoZSBhcHAuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0TW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIC8vIFJldHVybiBjYWNoZSBpZiBhdmFpbGFibGUgYW5kIG5vdCBleHBpcmVkXG4gICAgaWYgKFxuICAgICAgdGhpcy5tb2RlbENhY2hlICYmXG4gICAgICBEYXRlLm5vdygpIC0gdGhpcy5sYXN0Q2FjaGVUaW1lIDwgdGhpcy5DQUNIRV9EVVJBVElPTlxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWxDYWNoZTtcbiAgICB9XG5cbiAgICAvLyBJZiBhbHJlYWR5IGxvYWRpbmcsIHJldHVybiB0aGUgZXhpc3RpbmcgcHJvbWlzZVxuICAgIGlmICh0aGlzLmxvYWRpbmdQcm9taXNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkaW5nUHJvbWlzZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBuZXcgbG9hZFxuICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSB0aGlzLmxvYWRNb2RlbHMoKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5sb2FkaW5nUHJvbWlzZTtcbiAgICAgIHJldHVybiBtb2RlbHM7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gYWN0dWFsbHkgbG9hZCB0aGUgbW9kZWxzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIExvYWQgc3lzdGVtIG1vZGVscyAobm93IG9ubHkgcmV0dXJucyBzeXN0ZW0gbW9kZWxzKVxuICAgICAgY29uc3Qgc3lzdGVtTW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4uYWlTZXJ2aWNlLmdldE1vZGVscygpO1xuXG4gICAgICAvLyBMb2FkIGN1c3RvbSBwcm92aWRlciBtb2RlbHMgKHdpdGggY2FjaGluZylcbiAgICAgIGNvbnN0IGN1c3RvbU1vZGVscyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbVByb3ZpZGVyTW9kZWxzKCk7XG5cbiAgICAgIC8vIENvbWJpbmUgYWxsIG1vZGVsc1xuICAgICAgY29uc3QgYWxsTW9kZWxzID0gWy4uLnN5c3RlbU1vZGVscywgLi4uY3VzdG9tTW9kZWxzXTtcblxuICAgICAgLy8gU2V0IGZhdm9yaXRlIHN0YXR1c1xuICAgICAgY29uc3QgZmF2b3JpdGVNb2RlbHMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyB8fCBbXTtcbiAgICAgIGZvciAoY29uc3QgbW9kZWwgb2YgYWxsTW9kZWxzKSB7XG4gICAgICAgIG1vZGVsLmlzRmF2b3JpdGUgPSBmYXZvcml0ZU1vZGVscy5zb21lKFxuICAgICAgICAgIChmYXYpID0+IGZhdi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmYXYucHJvdmlkZXIgPT09IG1vZGVsLnByb3ZpZGVyXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBjYWNoZVxuICAgICAgdGhpcy5tb2RlbENhY2hlID0gYWxsTW9kZWxzO1xuICAgICAgdGhpcy5sYXN0Q2FjaGVUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgcmV0dXJuIGFsbE1vZGVscztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgICAgLy8gUmV0dXJuIGNhY2hlIGlmIGF2YWlsYWJsZSwgZXZlbiBpZiBleHBpcmVkXG4gICAgICByZXR1cm4gdGhpcy5tb2RlbENhY2hlIHx8IFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIG1vZGVscyBmcm9tIGN1c3RvbSBwcm92aWRlcnMgd2l0aCBjYWNoaW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRDdXN0b21Qcm92aWRlck1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICBjb25zdCB7IGN1c3RvbVByb3ZpZGVycyB9ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG5cbiAgICBjb25zdCBmZXRjaGVzID0gY3VzdG9tUHJvdmlkZXJzXG4gICAgICAuZmlsdGVyKChwKSA9PiBwLmlzRW5hYmxlZClcbiAgICAgIC5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUZXN0IGNvbm5lY3Rpb24gYW5kIGdldCBtb2RlbHMgLSBjYWNoaW5nIGlzIGhhbmRsZWQgYnkgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24ocCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIHJlc3VsdC5tb2RlbHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUN1c3RvbU1vZGVscyhwLCByZXN1bHQubW9kZWxzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgbW9kZWxzIGZyb20gJHtwLm5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChmZXRjaGVzKTtcbiAgICByZXR1cm4gcmVzdWx0cy5mbGF0KCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIFN5c3RlbVNjdWxwdE1vZGVsIG9iamVjdHMgZnJvbSBjdXN0b20gcHJvdmlkZXIgbW9kZWwgSURzXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZUN1c3RvbU1vZGVscyhcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIsXG4gICAgbW9kZWxJZHM6IHN0cmluZ1tdXG4gICk6IFN5c3RlbVNjdWxwdE1vZGVsW10ge1xuICAgIHJldHVybiBtb2RlbElkcy5tYXAoKG1vZGVsSWQpID0+ICh7XG4gICAgICBpZDogbW9kZWxJZCxcbiAgICAgIG5hbWU6IG1vZGVsSWQsXG4gICAgICBwcm92aWRlcjogcHJvdmlkZXIubmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgaXNGYXZvcml0ZTogZmFsc2UsXG4gICAgICBjb250ZXh0X2xlbmd0aDogMCxcbiAgICAgIGNhcGFiaWxpdGllczogW10sXG4gICAgICBwcmljaW5nOiB7XG4gICAgICAgIHByb21wdDogXCIwXCIsXG4gICAgICAgIGNvbXBsZXRpb246IFwiMFwiLFxuICAgICAgICBpbWFnZTogXCIwXCIsXG4gICAgICAgIHJlcXVlc3Q6IFwiMFwiLFxuICAgICAgfSxcbiAgICAgIGFyY2hpdGVjdHVyZToge1xuICAgICAgICBtb2RhbGl0eTogXCJ0ZXh0LT50ZXh0XCIsXG4gICAgICAgIHRva2VuaXplcjogXCJcIixcbiAgICAgICAgaW5zdHJ1Y3RfdHlwZTogbnVsbCxcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbjogYCR7cHJvdmlkZXIubmFtZX0gbW9kZWxgLFxuICAgICAgaWRlbnRpZmllcjoge1xuICAgICAgICBwcm92aWRlcklkOiBwcm92aWRlci5uYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgIG1vZGVsSWQ6IG1vZGVsSWQsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBtb2RlbElkLFxuICAgICAgfSxcbiAgICB9KSk7XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlIGZhdm9yaXRlIHN0YXR1cyBmb3IgYSBtb2RlbFxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRvZ2dsZUZhdm9yaXRlKG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGlzTm93RmF2b3JpdGUgPSAhbW9kZWwuaXNGYXZvcml0ZTtcbiAgICBtb2RlbC5pc0Zhdm9yaXRlID0gaXNOb3dGYXZvcml0ZTtcblxuICAgIC8vIFVwZGF0ZSBwbHVnaW4gc2V0dGluZ3NcbiAgICBpZiAoaXNOb3dGYXZvcml0ZSkge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMucHVzaCh7XG4gICAgICAgIHByb3ZpZGVyOiBtb2RlbC5wcm92aWRlcixcbiAgICAgICAgbW9kZWxJZDogbW9kZWwuaWQsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMgPVxuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5maWx0ZXIoXG4gICAgICAgICAgKGZhdikgPT5cbiAgICAgICAgICAgICEoZmF2Lm1vZGVsSWQgPT09IG1vZGVsLmlkICYmIGZhdi5wcm92aWRlciA9PT0gbW9kZWwucHJvdmlkZXIpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBVU87QUFWUDtBQUFBO0FBVU8saUNBQTBCO0FBQUEsTUFPL0IsWUFBb0IsS0FBVTtBQUFWO0FBRWxCLFlBQ0UsQ0FBQyxxQkFBb0IsZUFDckIsQ0FBQyxxQkFBb0IsZ0JBQ3JCO0FBQ0EsK0JBQW9CO0FBQUE7QUFBQTtBQUFBLGFBSVYsdUJBQXVCLFNBQThCO0FBQ2pFLDZCQUFvQixzQkFBc0I7QUFBQTtBQUFBLGFBRzdCLGVBQXdCO0FBQ3JDLFlBQUksQ0FBQyxxQkFBb0I7QUFBTyxpQkFBTztBQUN2QyxjQUFNLE1BQU0sS0FBSztBQUNqQixlQUNFLE1BQU0scUJBQW9CLE1BQU0sWUFDaEMscUJBQW9CO0FBQUE7QUFBQSxhQUlULFlBQVksU0FBcUM7QUFDOUQsY0FBTSxPQUE4QztBQUNwRCxnQkFBUSxRQUFRLENBQUMsV0FBVztBQUMxQixlQUFLLE9BQU8sTUFBTTtBQUFBO0FBR3BCLDZCQUFvQixRQUFRO0FBQUEsVUFDMUI7QUFBQSxVQUNBLFdBQVcsS0FBSztBQUFBLFVBQ2hCO0FBQUE7QUFBQTtBQUFBLGFBS1Usa0JBQWlDO0FBQzdDLFlBQUkscUJBQW9CLGFBQWE7QUFDbkMsaUJBQU8scUJBQW9CO0FBQUE7QUFHN0IsWUFBSSxDQUFDLHFCQUFvQixxQkFBcUI7QUFDNUMsaUJBQU8sUUFBUSxPQUFPLElBQUksTUFBTTtBQUFBO0FBR2xDLDZCQUFvQixpQkFBaUI7QUFDckMsNkJBQW9CLGNBQWMsTUFDaEMsR0FBRyxxQkFBb0Isb0JBQW9CLGlDQUUxQyxLQUFLLE9BQU8sYUFBYTtBQUN4QixjQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGtCQUFNLElBQUksTUFDUixtQ0FBbUMsU0FBUztBQUFBO0FBR2hELGdCQUFNLE9BQU8sTUFBTSxTQUFTO0FBQzVCLCtCQUFvQixZQUFZLEtBQUs7QUFBQSxXQUV0QyxNQUFNLENBQUMsVUFBVTtBQUNoQixrQkFBUSxNQUFNLDRDQUE0QztBQUUxRCwrQkFBb0IsY0FBYztBQUFBLFdBRW5DLFFBQVEsTUFBTTtBQUNiLCtCQUFvQixpQkFBaUI7QUFBQTtBQUd6QyxlQUFPLHFCQUFvQjtBQUFBO0FBQUEsWUFJZix5QkFBd0M7QUFDcEQsWUFBSSxxQkFBb0I7QUFBZ0I7QUFFeEMsWUFBSSxxQkFBb0IsYUFBYTtBQUNuQyxnQkFBTSxxQkFBb0I7QUFDMUI7QUFBQTtBQUdGLGNBQU0scUJBQW9CO0FBQUE7QUFBQSxZQUd0QixtQkFBa0Q7QUFDdEQsWUFBSTtBQUNGLGdCQUFNLEtBQUs7QUFHWCxjQUFJLHFCQUFvQixrQkFBa0IscUJBQW9CLE9BQU87QUFDbkUsbUJBQU8scUJBQW9CLE1BQU07QUFBQTtBQUluQyxnQkFBTSxXQUFXLE1BQU0sTUFDckIsR0FBRyxxQkFBb0Isb0JBQW9CO0FBRTdDLGNBQUksQ0FBQyxTQUFTLElBQUk7QUFDaEIsa0JBQU0sSUFBSSxNQUNSLG1DQUFtQyxTQUFTO0FBQUE7QUFHaEQsZ0JBQU0sT0FBTyxNQUFNLFNBQVM7QUFFNUIsK0JBQW9CLFlBQVksS0FBSztBQUNyQyxpQkFBTyxLQUFLO0FBQUEsaUJBQ0wsT0FBUDtBQUNBLGtCQUFRLE1BQU0sa0NBQWtDO0FBRWhELGNBQUkscUJBQW9CLE9BQU87QUFDN0IsbUJBQU8scUJBQW9CLE1BQU07QUFBQTtBQUVuQyxnQkFBTTtBQUFBO0FBQUE7QUFBQSxZQUlKLG9CQUFvQixJQUFnRDtBQXBJNUU7QUFxSUksWUFBSTtBQUNGLGdCQUFNLEtBQUs7QUFHWCxjQUNFLHFCQUFvQixrQkFDcEIsNEJBQW9CLFVBQXBCLG1CQUEyQixLQUFLLE1BQ2hDO0FBQ0EsbUJBQU8scUJBQW9CLE1BQU0sS0FBSztBQUFBO0FBSXhDLGdCQUFNLEtBQUs7QUFHWCxpQkFBTyw0QkFBb0IsVUFBcEIsbUJBQTJCLEtBQUssUUFBTztBQUFBLGlCQUN2QyxPQUFQO0FBQ0Esa0JBQVEsTUFBTSxnQ0FBZ0MsT0FBTztBQUVyRCxjQUFJLDJCQUFvQixVQUFwQixtQkFBMkIsS0FBSyxLQUFLO0FBQ3ZDLG1CQUFPLHFCQUFvQixNQUFNLEtBQUs7QUFBQTtBQUV4QyxnQkFBTTtBQUFBO0FBQUE7QUFBQSxZQUlKLDBCQUEyQztBQUMvQyxZQUFJO0FBQ0YsZ0JBQU0sV0FBVyxNQUFNLE1BQ3JCLEdBQUcscUJBQW9CLG9CQUFvQjtBQUU3QyxjQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGtCQUFNLElBQUksTUFDUiwyQ0FBMkMsU0FBUztBQUFBO0FBR3hELGdCQUFNLE9BQU8sTUFBTSxTQUFTO0FBQzVCLGlCQUFPLEtBQUs7QUFBQSxpQkFDTCxPQUFQO0FBQ0Esa0JBQVEsTUFBTSwwQ0FBMEM7QUFDeEQsZ0JBQU07QUFBQTtBQUFBO0FBQUEsWUFLSixlQUE4QjtBQUNsQyw2QkFBb0IsUUFBUTtBQUM1Qiw2QkFBb0IsY0FBYztBQUNsQyxjQUFNLHFCQUFvQjtBQUFBO0FBQUEsYUFJckIsYUFBbUI7QUFDeEIsNkJBQW9CLFFBQVE7QUFDNUIsNkJBQW9CLGNBQWM7QUFBQTtBQUFBO0FBakwvQjtBQUNVLElBRFYsb0JBQ1UsUUFBa0M7QUFDekIsSUFGbkIsb0JBRW1CLGlCQUFpQixLQUFLLEtBQUs7QUFDcEMsSUFIVixvQkFHVSxjQUFvQztBQUNwQyxJQUpWLG9CQUlVLGlCQUFpQjtBQUFBO0FBQUE7OztBQzREM0IseUJBQXlCLE1BQWlCLE9BQXdCO0FBQ3ZFLFFBQU0sVUFBVSxlQUFlO0FBQy9CLE1BQUksT0FBTyxZQUFZLFlBQVk7QUFDakMsV0FBTyxRQUFRO0FBQUE7QUFFakIsU0FBTztBQUFBO0FBL0VULElBQWEsYUFnQ0EsZ0JBeUJOO0FBekRQO0FBQUE7QUFBTyxJQUFNLGNBQWM7QUFBQSxNQUV6QixpQkFBaUI7QUFBQSxNQUNqQixpQkFBaUI7QUFBQSxNQUNqQixrQkFBa0I7QUFBQSxNQUNsQixjQUFjO0FBQUEsTUFHZCxtQkFBbUI7QUFBQSxNQUNuQixxQkFBcUI7QUFBQSxNQUdyQixjQUFjO0FBQUEsTUFDZCxrQkFBa0I7QUFBQSxNQUNsQixVQUFVO0FBQUEsTUFHVixnQkFBZ0I7QUFBQSxNQUNoQixnQkFBZ0I7QUFBQSxNQUNoQixvQkFBb0I7QUFBQSxNQUNwQixrQkFBa0I7QUFBQSxNQUdsQixlQUFlO0FBQUEsTUFDZixnQkFBZ0I7QUFBQTtBQVFYLElBQU0saUJBQXVEO0FBQUEsT0FDakUsWUFBWSxrQkFDWDtBQUFBLE9BQ0QsWUFBWSxrQkFBa0I7QUFBQSxPQUM5QixZQUFZLG1CQUFtQjtBQUFBLE9BQy9CLFlBQVksZUFDWDtBQUFBLE9BQ0QsWUFBWSxvQkFBb0IsQ0FBQyxVQUNoQyxTQUFTLFNBQVM7QUFBQSxPQUNuQixZQUFZLHNCQUFzQixDQUFDLFVBQ2xDLFNBQVMsU0FBUztBQUFBLE9BQ25CLFlBQVksZUFBZTtBQUFBLE9BQzNCLFlBQVksbUJBQ1g7QUFBQSxPQUNELFlBQVksZ0JBQ1g7QUFBQSxPQUNELFlBQVksaUJBQ1g7QUFBQSxPQUNELFlBQVksV0FBVztBQUFBLE9BQ3ZCLFlBQVksaUJBQWlCO0FBQUEsT0FDN0IsWUFBWSxpQkFBaUI7QUFBQSxPQUM3QixZQUFZLHFCQUFxQjtBQUFBLE9BQ2pDLFlBQVksbUJBQW1CO0FBQUE7QUFHM0Isc0NBQWdDLE1BQU07QUFBQSxNQUMzQyxZQUNFLFNBQ08sT0FBa0IsWUFBWSxlQUM5QixhQUFxQixLQUNyQixVQU1QO0FBQ0EsY0FBTTtBQVRDO0FBQ0E7QUFDQTtBQVFQLGFBQUssT0FBTztBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUN0RWhCLElBR087QUFIUDtBQUFBO0FBQ0E7QUFFTyw0QkFBcUI7QUFBQSxtQkFVYixhQUFhLE1BQWEsS0FBMkI7QUFFaEUsWUFBSSxDQUFDLE1BQU07QUFDVCxnQkFBTSxJQUFJLGtCQUFrQixrQkFBa0Isa0JBQWtCO0FBQUE7QUFJbEUsWUFBSSxLQUFLLEtBQUssT0FBTyxnQkFBZSxlQUFlO0FBQ2pELGdCQUFNLElBQUksa0JBQ1IsOEJBQ0Esa0JBQ0E7QUFBQTtBQUtKLGNBQU0sWUFBWSxLQUFLLFVBQVU7QUFDakMsWUFBSSxDQUFDLGdCQUFlLGtCQUFrQixJQUFJLFlBQVk7QUFDcEQsZ0JBQU0sSUFBSSxrQkFDUiw0QkFDQSxzQkFDQTtBQUFBO0FBSUosWUFBSTtBQUVGLGdCQUFNLGNBQWMsTUFBTSxJQUFJLE1BQU0sV0FBVztBQUcvQyxnQkFBTSxTQUFTLE1BQU0sSUFBSSxRQUFnQixDQUFDLFNBQVMsV0FBVztBQUM1RCxrQkFBTSxTQUFTLElBQUk7QUFDbkIsbUJBQU8sU0FBUyxNQUFNO0FBRXBCLG9CQUFNLFVBQVUsT0FBTztBQUN2QixzQkFBUTtBQUFBO0FBRVYsbUJBQU8sVUFBVSxNQUFNLE9BQU8sT0FBTztBQUdyQyxrQkFBTSxPQUFPLFNBQVMsY0FBYyxRQUFRLFNBQVM7QUFDckQsa0JBQU0sT0FBTyxJQUFJLEtBQUssQ0FBQyxjQUFjLEVBQUU7QUFHdkMsbUJBQU8sY0FBYztBQUFBO0FBR3ZCLGlCQUFPO0FBQUEsaUJBQ0EsT0FBUDtBQUNBLGtCQUFRLE1BQU0sNEJBQTRCO0FBQzFDLGdCQUFNLElBQUksa0JBQ1IsMkJBQ0Esb0JBQ0E7QUFBQTtBQUFBO0FBQUEsbUJBS08sc0JBQ1gsZUFDaUI7QUFDakIsY0FBTSxPQUFPLGNBQWMsTUFBTTtBQUNqQyxZQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxXQUFXLFdBQVc7QUFDNUMsZ0JBQU0sSUFBSSxrQkFBa0IseUJBQXlCLFlBQVk7QUFBQTtBQUduRSxZQUFJLEtBQUssT0FBTyxLQUFLLGVBQWU7QUFDbEMsZ0JBQU0sSUFBSSxrQkFDUiw4QkFDQSxrQkFDQTtBQUFBO0FBSUosZUFBTyxJQUFJLFFBQVEsQ0FBQyxTQUFTLFdBQVc7QUFDdEMsZ0JBQU0sU0FBUyxJQUFJO0FBQ25CLGlCQUFPLFNBQVMsTUFBTSxRQUFRLE9BQU87QUFDckMsaUJBQU8sVUFBVSxNQUFNLE9BQU8sT0FBTztBQUNyQyxpQkFBTyxjQUFjO0FBQUE7QUFBQTtBQUFBO0FBeEZwQjtBQUNVLElBRFYsZUFDVSxnQkFBZ0IsS0FBSyxPQUFPO0FBQzVCLElBRlYsZUFFVSxvQkFBb0IsSUFBSSxJQUFJO0FBQUEsTUFDekM7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUE7QUFBQTtBQUFBOzs7QUNWSixJQUNhLGNBS0EsNEJBNEVBO0FBbEZiO0FBQUE7QUFDTyxJQUFNLGVBQ1gsT0FBTyxTQUFTLGFBQWEsY0FDekIsaUNBQ0E7QUFFQyxJQUFNLDZCQUE2QjtBQUFBLE1BQ3hDLFNBQVM7QUFBQSxRQUNQLFVBQVUsQ0FBQyxRQUFnQiw0QkFBNEI7QUFBQTtBQUFBLE1BRXpELFFBQVE7QUFBQSxRQUNOLE1BQU07QUFBQSxRQUNOLEtBQUssQ0FBQyxZQUFvQixrQkFBa0I7QUFBQTtBQUFBLE1BRTlDLE1BQU07QUFBQSxRQUNKLGFBQWE7QUFBQTtBQUFBLE1BRWYsZ0JBQWdCO0FBQUEsUUFDZCxLQUFLLENBQUMsT0FBZSwwQkFBMEI7QUFBQSxRQUMvQyxNQUFNO0FBQUE7QUFBQSxNQUVSLFdBQVc7QUFBQSxRQUNULFNBQVM7QUFBQSxRQUNULEtBQUssQ0FBQyxPQUFlLHFCQUFxQjtBQUFBLFFBQzFDLFVBQVUsQ0FBQyxPQUFlLHFCQUFxQjtBQUFBO0FBQUE7QUEwRDVDLElBQU0sMkJBQTJCO0FBQUEsTUFDdEMsU0FBUztBQUFBLFFBQ1AsZ0JBQWdCO0FBQUE7QUFBQSxNQUVsQixjQUFjLENBQUMsZUFBd0I7QUFBQSxXQUNsQyx5QkFBeUI7QUFBQSxRQUM1QixlQUFlLFVBQVU7QUFBQTtBQUFBO0FBQUE7QUFBQTs7O0FDbEU3Qix3QkFBZ0M7QUFDOUIsU0FBTyx1Q0FBdUMsUUFBUSxTQUFTLFNBQVUsR0FBRztBQUMxRSxVQUFNLElBQUssS0FBSyxXQUFXLEtBQU07QUFDakMsVUFBTSxJQUFJLE1BQU0sTUFBTSxJQUFLLElBQUksSUFBTztBQUN0QyxXQUFPLEVBQUUsU0FBUztBQUFBO0FBQUE7QUExQnRCLHFCQThCTztBQTlCUDtBQUFBO0FBQUEsc0JBQXVDO0FBQ3ZDO0FBUUE7QUFNQTtBQUNBO0FBY08saUNBQTBCO0FBQUEsTUE0QnZCLFlBQVksVUFBZ0MsS0FBVTtBQXRCdEQsaUNBQW9CO0FBQ3BCLGdDQUFtQjtBQXNCekIsYUFBSyxXQUFXO0FBQ2hCLGFBQUssYUFBYSxTQUFTO0FBQzNCLGFBQUssTUFBTTtBQUFBO0FBQUEsVUF0QkYsVUFBa0I7QUFFM0IsWUFBSSxDQUFDLEtBQUssa0JBQWtCO0FBQzFCLGVBQUssbUJBQW1CO0FBQUE7QUFJMUIsWUFBSSxLQUFLLFNBQVMsaUJBQWlCO0FBQ2pDLGlCQUFPLEtBQUssU0FBUztBQUFBO0FBSXZCLGVBQU87QUFBQTtBQUFBLFVBR0UsdUJBQStCO0FBdEQ1QztBQXVESSxlQUFPLFdBQUssU0FBUyx5QkFBZCxZQUFzQztBQUFBO0FBQUEsYUFTeEMsWUFDTCxVQUNBLEtBQ3FCO0FBQ3JCLFlBQUksQ0FBQyxxQkFBb0IsVUFBVTtBQUNqQywrQkFBb0IsV0FBVyxJQUFJLHFCQUFvQixVQUFVO0FBQUEsZUFDNUQ7QUFDTCwrQkFBb0IsU0FBUyxXQUFXO0FBQ3hDLCtCQUFvQixTQUFTLGFBQWEsU0FBUztBQUFBO0FBRXJELGVBQU8scUJBQW9CO0FBQUE7QUFBQSxNQUd0QixlQUFlLFVBQXNDO0FBQzFELGFBQUssV0FBVztBQUNoQixhQUFLLGFBQWEsU0FBUztBQUFBO0FBQUEsWUFHZixZQUNaLFVBQ0EsVUFNSSxJQUNRO0FBQ1osWUFBSSxRQUFRLGVBQWUsQ0FBQyxTQUFTLFNBQVMsc0JBQXNCO0FBQ2xFLGdCQUFNLFVBQVUsTUFBTSxLQUFLLGdCQUFnQjtBQUMzQyxjQUFJLENBQUMsU0FBUztBQUNaLGtCQUFNLElBQUksa0JBQ1IsZ0JBQWdCLFlBQVksZUFDNUIsWUFBWSxjQUNaO0FBQUE7QUFBQTtBQUtOLGNBQU0sVUFBVSxLQUFLLGFBQ2pCLHlCQUF5QixhQUFhLEtBQUssY0FDM0MseUJBQXlCO0FBRTdCLGNBQU0sTUFBTSxHQUFHLEtBQUssVUFBVTtBQUM5QixjQUFNLFdBQVcsTUFBTSxnQ0FBVztBQUFBLFVBQ2hDO0FBQUEsVUFDQSxRQUFRLFFBQVEsVUFBVTtBQUFBLFVBQzFCLFNBQVM7QUFBQSxlQUNKO0FBQUEsZUFDQyxRQUFRLFdBQVc7QUFBQTtBQUFBLFVBRXpCLE1BQU0sUUFBUTtBQUFBLFVBQ2QsT0FBTztBQUFBO0FBR1QsWUFBSTtBQUNKLFlBQUk7QUFDRix3QkFBYyxTQUFTO0FBQUEsaUJBQ2hCLEdBQVA7QUFDQSxnQkFBTSxJQUFJLGtCQUNSLGdCQUFnQixZQUFZLG1CQUM1QixZQUFZLGtCQUNaLFNBQVM7QUFBQTtBQUliLFlBQUksU0FBUyxXQUFXLE9BQU8sWUFBWSxXQUFXLFNBQVM7QUFDN0QsZUFBSyxlQUFlLFVBQVUsVUFBVTtBQUFBO0FBSTFDLGVBQ0UsWUFBWSxTQUFTLFNBQVksWUFBWSxPQUFPO0FBQUE7QUFBQSxNQUloRCxlQUNOLFVBQ0EsVUFDQSxhQUNPO0FBQ1AsWUFBSSxZQUFZLE9BQU87QUFDckIsZ0JBQU0sWUFBYSxZQUFZLE1BQU0sUUFDbkMsWUFBWTtBQUNkLGdCQUFNLGFBQWEsWUFBWSxNQUFNLGNBQWMsU0FBUztBQUM1RCxnQkFBTSxlQUFlLGdCQUFnQixXQUFXLFlBQVksTUFBTTtBQUVsRSxnQkFBTSxXQUEwQztBQUVoRCxjQUNFLGNBQWMsWUFBWSxxQkFDMUIsY0FBYyxZQUFZLHFCQUMxQjtBQUNBLHFCQUFTLGlCQUFpQjtBQUMxQixxQkFBUyxRQUFRLFlBQVksTUFBTTtBQUFBO0FBR3JDLGdCQUFNLElBQUksa0JBQ1IsY0FDQSxXQUNBLFlBQ0E7QUFBQTtBQUlKLGNBQU0sSUFBSSxrQkFDUixnQkFBZ0IsWUFBWSxnQkFDNUIsWUFBWSxlQUNaLFNBQVM7QUFBQTtBQUFBLFlBSUMsa0JBQ1osVUFDQSxtQkFBbUIsT0FDSDtBQW5McEI7QUFxTEksZ0JBQVEsTUFBTSwwQkFBMEI7QUFBQSxVQUN0QyxRQUFRLFNBQVM7QUFBQSxVQUNqQixZQUFZLFNBQVM7QUFBQSxVQUNyQixhQUFhLFNBQVMsUUFBUSxJQUFJO0FBQUEsVUFDbEM7QUFBQTtBQUdGLFlBQUksWUFBdUIsWUFBWTtBQUN2QyxZQUFJLFdBQTBDO0FBRTlDLFlBQUk7QUFDRixnQkFBTSxZQUFZLE1BQU0sU0FBUztBQUNqQyxrQkFBUSxNQUFNLHNCQUFzQjtBQUdwQyxjQUFJLGtCQUFrQjtBQUVwQixxQkFBUyxXQUFXO0FBQ3BCLHFCQUFTLFdBQVc7QUFHcEIsZ0JBQUksU0FBUyxXQUFXLEtBQUs7QUFDM0IsMEJBQVksWUFBWTtBQUN4QixvQkFBTSxJQUFJLGtCQUNSLGlCQUFVLFVBQVYsbUJBQWlCLFlBQVcsdUNBQzVCLFdBQ0EsU0FBUyxRQUNUO0FBQUEsdUJBRU8sU0FBUyxXQUFXLEtBQUs7QUFDbEMsMEJBQVksWUFBWTtBQUN4QixvQkFBTSxJQUFJLGtCQUNSLGlCQUFVLFVBQVYsbUJBQWlCLFlBQ2YsMkNBQ0YsV0FDQSxTQUFTLFFBQ1Q7QUFBQSx1QkFFTyxTQUFTLFdBQVcsS0FBSztBQUNsQywwQkFBWSxZQUFZO0FBQ3hCLG9CQUFNLElBQUksa0JBQ1IsaUJBQVUsVUFBVixtQkFBaUIsWUFBVyx5Q0FDNUIsV0FDQSxTQUFTLFFBQ1Q7QUFBQTtBQUtKLGtCQUFNLElBQUksa0JBQ1IsaUJBQVUsVUFBVixtQkFBaUIsWUFBVyxTQUFTLFlBQ3JDLFdBQ0EsU0FBUyxRQUNUO0FBQUE7QUFJSixjQUFJLFVBQVUsT0FBTztBQUNuQix3QkFBYSxVQUFVLE1BQU0sUUFDM0IsWUFBWTtBQUVkLGdCQUNFLGNBQWMsWUFBWSxxQkFDMUIsY0FBYyxZQUFZLHFCQUMxQjtBQUNBLHlCQUFXO0FBQUEsZ0JBQ1QsT0FBTyxVQUFVLE1BQU07QUFBQSxnQkFDdkIsZ0JBQWdCO0FBQUEsZ0JBQ2hCLFVBQVU7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFJVCxHQUFQO0FBRUEsa0JBQVEsTUFBTSxpQ0FBaUM7QUFHL0MsY0FBSSxhQUFhLG1CQUFtQjtBQUNsQyxrQkFBTTtBQUFBO0FBR1Isc0JBQVksWUFBWTtBQUFBO0FBRzFCLGNBQU0sSUFBSSxrQkFDUixnQkFBZ0IsV0FBVyxTQUFTLFFBQ3BDLFdBQ0EsU0FBUyxRQUNUO0FBQUE7QUFBQSxZQUlFLGdCQUFnQixhQUFhLE9BQXlCO0FBQzFELFlBQUksQ0FBQyxLQUFLO0FBQVksaUJBQU87QUFFN0IsWUFBSTtBQUNGLGdCQUFNLEtBQUssWUFDVCwyQkFBMkIsUUFBUSxTQUFTLEtBQUssYUFDakQ7QUFBQSxZQUNFLFFBQVE7QUFBQSxZQUNSLFNBQVMseUJBQXlCLGFBQWEsS0FBSztBQUFBO0FBR3hELGlCQUFPO0FBQUEsaUJBQ0QsR0FBTjtBQUNBLGlCQUFPO0FBQUE7QUFBQTtBQUFBLFlBSUwsWUFBMEM7QUFDOUMsWUFBSTtBQUVGLGdCQUFNLFdBQVcsTUFBTSxLQUFLLFlBQzFCLGtCQUNBO0FBQUEsWUFDRSxRQUFRO0FBQUE7QUFJWixjQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sUUFBUSxTQUFTLFNBQVM7QUFDaEQsa0JBQU0sSUFBSSxrQkFDUixnQkFBZ0IsWUFBWSxtQkFDNUIsWUFBWSxrQkFDWjtBQUFBO0FBS0osZ0JBQU0scUJBQXFCLFNBQVMsT0FBTyxJQUFJLENBQUMsVUFBVztBQUFBLGVBQ3REO0FBQUEsWUFDSCxVQUFVO0FBQUE7QUFJWixpQkFBTztBQUFBLGlCQUNBLE9BQVA7QUFDQSxnQkFBTTtBQUFBO0FBQUE7QUFBQSxZQUlKLGtCQUFtQztBQUN2QyxjQUFNLFVBQVUsTUFBTSxLQUFLLGdCQUFnQjtBQUMzQyxZQUFJLENBQUM7QUFBUyxpQkFBTztBQUdyQixjQUFNLGNBQWMsTUFBTSxLQUFLLFlBQzdCLDJCQUEyQixRQUFRLFNBQVMsS0FBSyxhQUNqRDtBQUFBLFVBQ0UsUUFBUTtBQUFBLFVBQ1IsU0FBUyx5QkFBeUIsYUFBYSxLQUFLO0FBQUE7QUFHeEQsZUFBTyxZQUFZLG1CQUFtQjtBQUFBO0FBQUEsWUFHMUIsdUJBQ1osVUFDNEQ7QUFDNUQsWUFBSTtBQUVGLGdCQUFNLFdBQVcsU0FBUyxRQUFRLG1CQUFtQjtBQUdyRCxnQkFBTSxZQUFZLFNBQVMsUUFDekIsdURBQ0E7QUFJRixnQkFBTSxlQUFlLEtBQUssSUFBSSxjQUFjLHFCQUMxQyxXQUNBO0FBR0YsY0FBSSx3QkFBd0IsdUJBQU87QUFDakMsZ0JBQUksYUFBYSxVQUFVLE1BQU0sK0JBQStCO0FBQzlELG9CQUFNLFNBQVMsTUFBTSxlQUFlLGFBQ2xDLGNBQ0EsS0FBSztBQUVQLHFCQUFPLEVBQUUsTUFBTSxTQUFTO0FBQUE7QUFFMUIsa0JBQU0sVUFBVSxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUs7QUFDMUMsbUJBQU87QUFBQTtBQUlULGdCQUFNLFdBQVcsVUFBVSxNQUFNLEtBQUs7QUFDdEMsY0FBSSxVQUFVO0FBQ1osa0JBQU0sV0FBVyxLQUFLLElBQUksTUFBTTtBQUNoQyxrQkFBTSxlQUFlLFNBQVMsS0FBSyxDQUFDLE1BQU0sRUFBRSxTQUFTO0FBQ3JELGdCQUFJLGNBQWM7QUFDaEIsa0JBQUksYUFBYSxVQUFVLE1BQU0sK0JBQStCO0FBQzlELHNCQUFNLFNBQVMsTUFBTSxlQUFlLGFBQ2xDLGNBQ0EsS0FBSztBQUVQLHVCQUFPLEVBQUUsTUFBTSxTQUFTO0FBQUE7QUFFMUIsb0JBQU0sVUFBVSxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUs7QUFDMUMscUJBQU87QUFBQTtBQUFBO0FBSVgsaUJBQU87QUFBQSxpQkFDQSxPQUFQO0FBQ0EsaUJBQU87QUFBQTtBQUFBO0FBQUEsWUFJRyw0QkFDWixVQUM2QjtBQUM3QixjQUFNLFVBQVUsTUFBTSxLQUFLLHVCQUF1QjtBQUNsRCxjQUFNLGNBQWMsU0FBUyxRQUMzQix1REFDQTtBQUdGLFlBQUksU0FBUztBQUNYLGNBQUksT0FBTyxZQUFZLFVBQVU7QUFDL0IsbUJBQU87QUFBQSxjQUNMLE1BQU07QUFBQSxjQUNOLFNBQVMsZ0JBQWdCO0FBQUE7QUFBQSxFQUFtQjtBQUFBLGNBQzVDLFlBQVk7QUFBQTtBQUFBLHFCQUVMLFFBQVEsU0FBUyxTQUFTO0FBR25DLG1CQUFPO0FBQUEsY0FDTCxNQUFNO0FBQUEsY0FDTixTQUFTO0FBQUEsZ0JBQ1A7QUFBQSxrQkFDRSxNQUFNO0FBQUEsa0JBQ04sTUFBTSxnQkFBZ0I7QUFBQTtBQUFBO0FBQUE7QUFBQSxnQkFFeEI7QUFBQSxrQkFDRSxNQUFNO0FBQUEsa0JBQ04sV0FBVztBQUFBLG9CQUVULEtBQUsseUJBQXlCLFFBQVEsT0FBTyxRQUMzQyxvQkFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGNBS1IsWUFBWTtBQUFBO0FBQUE7QUFBQTtBQUlsQixlQUFPO0FBQUE7QUFBQSxZQUdLLDJCQUNaLFVBQ0EsY0FDQSxrQkFDQSxrQkFDd0I7QUFDeEIsY0FBTSxtQkFBa0M7QUFHeEMsWUFBSTtBQUNKLFlBQUkscUJBQXFCLFlBQVksa0JBQWtCO0FBR3JELGdCQUFNLGVBQWUsS0FBSyxJQUFJLGNBQWMscUJBQzFDLGtCQUNBO0FBR0YsY0FBSSx3QkFBd0IsdUJBQU87QUFDakMsa0NBQXNCLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUFBLGlCQUMzQztBQUVMLGtCQUFNLGNBQWMsS0FBSyxJQUFJLE1BQU0sc0JBQ2pDLEdBQUc7QUFFTCxnQkFBSSx1QkFBdUIsdUJBQU87QUFDaEMsb0NBQXNCLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUFBLG1CQUMzQztBQUVMLG9CQUFNLHlCQUF5QixLQUFLLElBQUksTUFBTSxzQkFDNUMsK0JBQStCO0FBRWpDLGtCQUFJLGtDQUFrQyx1QkFBTztBQUMzQyxzQ0FBc0IsTUFBTSxLQUFLLElBQUksTUFBTSxLQUN6QztBQUFBO0FBQUE7QUFBQTtBQUFBLG1CQUtDLGtCQUFrQjtBQUUzQixjQUFJO0FBQ0Ysa0JBQU0sc0JBQXNCLElBQUksb0JBQW9CLEtBQUs7QUFDekQsa0JBQU0sU0FBUyxNQUFNLG9CQUFvQixvQkFDdkM7QUFFRixnQkFBSSxRQUFRO0FBQ1Ysb0NBQXNCLE9BQU87QUFBQTtBQUFBLG1CQUV4QixPQUFQO0FBQUE7QUFBQTtBQU1KLFlBQUkscUJBQXFCO0FBQ3ZCLDJCQUFpQixLQUFLO0FBQUEsWUFDcEIsTUFBTTtBQUFBLFlBQ04sU0FBUztBQUFBLFlBQ1QsWUFBWSxPQUFPO0FBQUEsWUFDbkI7QUFBQSxZQUNBO0FBQUE7QUFBQTtBQUtKLGNBQU0sY0FBd0I7QUFDOUIsbUJBQVcsWUFBWSxjQUFjO0FBRW5DLGNBQUksU0FBUyxXQUFXLFNBQVM7QUFDL0Isa0JBQU0sYUFBYSxTQUFTLFVBQVU7QUFDdEMsd0JBQVksS0FBSztBQUFBLGlCQUNaO0FBRUwsa0JBQU0saUJBQWlCLE1BQU0sS0FBSyw0QkFBNEI7QUFDOUQsZ0JBQUksZ0JBQWdCO0FBQ2xCLCtCQUFpQixLQUFLO0FBQUE7QUFBQTtBQUFBO0FBTTVCLFlBQUksWUFBWSxTQUFTLEdBQUc7QUFDMUIsZ0JBQU0sZUFBZSxTQUFTO0FBQzlCLGNBQUksY0FBYztBQUNoQix5QkFBYSxrQkFBa0IsRUFBRTtBQUFBO0FBQUE7QUFLckMsbUJBQVcsT0FBTyxVQUFVO0FBQzFCLDJCQUFpQixLQUFLO0FBQUEsWUFDcEIsTUFBTSxJQUFJO0FBQUEsWUFDVixTQUFTLElBQUk7QUFBQSxZQUNiLFlBQVksSUFBSSxjQUFjO0FBQUEsWUFDOUIsaUJBQWlCLElBQUk7QUFBQSxZQUNyQixrQkFBa0IsSUFBSTtBQUFBLFlBQ3RCLGtCQUFrQixJQUFJO0FBQUE7QUFBQTtBQUkxQixlQUFPO0FBQUE7QUFBQSxNQUdELG9CQUFvQixNQUFzQjtBQUNoRCxZQUFJLENBQUMsOEJBQU07QUFBUSxpQkFBTztBQUMxQixjQUFNLFVBQVUsS0FBSztBQUdyQixZQUNFLFlBQVksV0FDWixZQUFZLFlBQ1osWUFBWSxZQUNaLFFBQVEsV0FBVyxpQkFDbkI7QUFDQSxpQkFBTztBQUFBO0FBR1QsZUFBTyxRQUFRLFFBQVEsa0JBQWtCO0FBQUE7QUFBQSxNQUduQyxtQkFBbUIsTUFBYyxtQkFBbUIsT0FBZ0I7QUE1aUI5RTtBQTZpQkksWUFBSSxDQUFDO0FBQU0saUJBQU87QUFDbEIsWUFBSTtBQUNGLGdCQUFNLFNBQVMsS0FBSyxNQUFNO0FBRzFCLGlCQUFPLENBQUMsQ0FDTixXQUNDLDJCQUFPLFlBQVAsbUJBQWlCLE9BQWpCLG1CQUFxQixVQUFyQixtQkFBNEIsWUFDM0IsMEJBQU8sWUFBUCxtQkFBaUIsT0FBakIsbUJBQXFCLFVBQXJCLG1CQUE0QixjQUM1QiwwQkFBTyxZQUFQLG1CQUFpQixPQUFqQixtQkFBcUIsVUFBckIsbUJBQTRCLGtCQUM1QixPQUFPO0FBQUEsaUJBRUosR0FBUDtBQUNBLGlCQUFPO0FBQUE7QUFBQTtBQUFBLE1BSUgsa0JBQ04sTUFDQSxtQkFBbUIsT0FDSjtBQUNmLFlBQUksQ0FBQyxLQUFLLE9BQU8sV0FBVyxVQUFVO0FBQ3BDLGlCQUFPO0FBQUE7QUFHVCxjQUFNLGFBQWEsS0FBSyxvQkFBb0I7QUFDNUMsZUFBTyxLQUFLLG1CQUFtQixZQUFZLG9CQUN2QyxhQUNBO0FBQUE7QUFBQSxZQUdRLGtCQUNaLE9BQ0EsT0FDQSxtQkFBbUIsT0FDbUQ7QUFobEIxRTtBQWlsQkksWUFBSSxDQUFDO0FBQU8saUJBQU87QUFFbkIsWUFBSTtBQUNGLGNBQUk7QUFDSixjQUFJO0FBQ0YscUJBQVMsS0FBSyxNQUFNO0FBQUEsbUJBQ2IsWUFBUDtBQUNBLG1CQUFPO0FBQUE7QUFHVCxjQUFJLENBQUM7QUFBUSxtQkFBTztBQUdwQixjQUFJLE9BQU8sT0FBTztBQUNoQixrQkFBTSxZQUFhLE9BQU8sTUFBTSxRQUM5QixZQUFZO0FBQ2QsZ0JBQUksZUFDRixPQUFPLE1BQU0sV0FBVyxnQkFBZ0IsV0FBVztBQUVyRCxrQkFBTSxXQUFXO0FBQUEsY0FDZjtBQUFBLGNBQ0EsZ0JBQWdCO0FBQUEsY0FDaEIsVUFBVSxPQUFPO0FBQUEsY0FDakIsZUFBZTtBQUFBO0FBR2pCLGdCQUNFLGNBQWMsWUFBWSxxQkFDMUIsY0FBYyxZQUFZLHFCQUMxQjtBQUNBLHVCQUFTLGlCQUFpQjtBQUFBO0FBRzVCLGtCQUFNLElBQUksa0JBQ1IsY0FDQSxXQUNBLE9BQU8sTUFBTSxjQUFjLEtBQzNCO0FBQUE7QUFLSixnQkFBTSxVQUFVLDBCQUFPLFlBQVAsbUJBQWlCLE9BQWpCLG1CQUFxQixVQUFyQixtQkFBNEIsWUFBVztBQUN2RCxnQkFBTSxZQUFZLDBCQUFPLFlBQVAsbUJBQWlCLE9BQWpCLG1CQUFxQixVQUFyQixtQkFBNEIsY0FBYTtBQUczRCxjQUFJLEtBQUssbUJBQW1CO0FBRTFCLGdCQUFJLGVBQWU7QUFDbkIsZ0JBQUk7QUFBVyw4QkFBZ0I7QUFDL0IsZ0JBQUk7QUFBUyw4QkFBZ0I7QUFFN0Isa0JBQU0sZ0JBQWdCLGFBQWEsTUFBTTtBQUN6QyxnQkFBSSxlQUFlO0FBQ2pCLG1CQUFLLG9CQUFvQjtBQUV6QixxQkFBTztBQUFBLGdCQUNMLFdBQVcsY0FBYyxNQUFNO0FBQUEsZ0JBQy9CLFNBQVMsY0FBYyxNQUFNO0FBQUE7QUFBQTtBQUtqQyxtQkFBTztBQUFBLGNBQ0wsU0FBUztBQUFBLGNBQ1QsV0FBVyxnQkFBZ0I7QUFBQTtBQUFBLGlCQUV4QjtBQUVMLGdCQUFJLFNBQVM7QUFDWCxvQkFBTSxrQkFBa0IsUUFBUSxNQUFNO0FBQ3RDLGtCQUFJLGlCQUFpQjtBQUNuQixxQkFBSyxvQkFBb0I7QUFDekIsdUJBQU87QUFBQSxrQkFDTCxTQUFTO0FBQUEsa0JBQ1QsV0FBVyxnQkFBZ0IsTUFBTTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTXpDLGlCQUFPLEVBQUUsU0FBUztBQUFBLGlCQUNYLEdBQVA7QUFDQSxjQUFJLGFBQWEsbUJBQW1CO0FBQ2xDLGtCQUFNO0FBQUE7QUFFUixpQkFBTztBQUFBO0FBQUE7QUFBQSxZQUlHLG1CQUNaLE9BQ0EsUUFDQSxPQUNBLG1CQUFtQixPQUtsQjtBQUNELGNBQU0sVUFBVSxxQkFBb0IsUUFBUSxPQUFPLE9BQU8sRUFBRSxRQUFRO0FBQ3BFLGNBQU0sWUFBWSxTQUFTO0FBRTNCLGNBQU0sUUFBUSxVQUFVLE1BQU07QUFDOUIsY0FBTSxXQUFxQjtBQUMzQixjQUFNLGFBQXVCO0FBRzdCLGlCQUFTLElBQUksR0FBRyxJQUFJLE1BQU0sU0FBUyxHQUFHLEtBQUs7QUFDekMsZ0JBQU0sUUFBUSxLQUFLLGtCQUFrQixNQUFNLElBQUk7QUFDL0MsY0FBSSxPQUFPO0FBQ1Qsa0JBQU0sU0FBUyxNQUFNLEtBQUssa0JBQ3hCLE9BQ0EsT0FDQTtBQUVGLGdCQUFJLFFBQVE7QUFDVixrQkFBSSxPQUFPO0FBQVMseUJBQVMsS0FBSyxPQUFPO0FBQ3pDLGtCQUFJLE9BQU87QUFBVywyQkFBVyxLQUFLLE9BQU87QUFBQTtBQUFBO0FBQUE7QUFNbkQsY0FBTSxZQUFZLE1BQU0sTUFBTSxTQUFTLEdBQUcsU0FDdEMsTUFBTSxNQUFNLFNBQVMsS0FDckI7QUFFSixlQUFPLEVBQUUsV0FBVyxVQUFVO0FBQUE7QUFBQSxNQUd4QixzQkFBc0IsU0FBeUI7QUFFckQsZUFBTyxRQUFRLFFBQVEsaUJBQWlCO0FBQUE7QUFBQSxZQUc1QixhQUFhLFNBSXhCO0FBRUQsWUFBSSxLQUFLLFNBQVMsZUFBZSxTQUFTLFVBQVU7QUFDbEQsZ0JBQU0saUJBQWlCLEtBQUssU0FBUyxnQkFBZ0IsS0FDbkQsQ0FBQyxNQUFNLEVBQUUsT0FBTyxLQUFLLFNBQVMsZUFBZSxNQUFNLEVBQUU7QUFHdkQsY0FBSSxDQUFDLGdCQUFnQjtBQUNuQixrQkFBTSxJQUFJLGtCQUNSLFlBQVksS0FBSyxTQUFTLGVBQWUsOEJBQ3pDLFlBQVksbUJBQ1o7QUFBQTtBQUlKLGlCQUFPO0FBQUEsWUFDTCxVQUFVO0FBQUEsWUFDVixVQUFVO0FBQUEsWUFDVixlQUFlO0FBQUE7QUFBQTtBQUtuQixlQUFPO0FBQUEsVUFDTCxVQUFVO0FBQUEsVUFDVixlQUFlLEtBQUssc0JBQXNCO0FBQUE7QUFBQTtBQUFBLFlBSWhDLCtCQUNaLFVBQ0EsVUFDQSxhQUNBLFNBQ0EsUUFDbUI7QUFDbkIsY0FBTSxXQUFXLFNBQVMsU0FBUyxPQUFPLFFBQVEsT0FBTztBQUN6RCxjQUFNLFVBQWtDO0FBQUEsVUFDdEMsZ0JBQWdCO0FBQUEsVUFDaEIsZUFBZSxVQUFVLFNBQVM7QUFBQTtBQUlwQyxZQUFJLFNBQVMsU0FBUyxrQkFBa0I7QUFDdEMsa0JBQVEsa0JBQWtCO0FBQzFCLGtCQUFRLGFBQWE7QUFBQTtBQUd2QixjQUFNLGNBQWM7QUFBQSxVQUNsQixPQUFPO0FBQUEsVUFDUCxVQUFVLFNBQVMsSUFBSSxDQUFDLFFBQVM7QUFBQSxZQUMvQixNQUFNLElBQUk7QUFBQSxZQUNWLFNBQVMsSUFBSTtBQUFBO0FBQUEsVUFFZjtBQUFBLFVBQ0EsUUFBUTtBQUFBLGFBRUosU0FBUyxTQUFTLG9CQUFvQjtBQUFBLFlBQ3hDLG1CQUFtQjtBQUFBO0FBQUE7QUFJdkIsY0FBTSxXQUFXLE1BQU0sTUFBTSxHQUFHLDZCQUE2QjtBQUFBLFVBQzNELFFBQVE7QUFBQSxVQUNSO0FBQUEsVUFDQSxNQUFNLEtBQUssVUFBVTtBQUFBLFVBQ3JCO0FBQUE7QUFHRixZQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGdCQUFNLEtBQUssa0JBQWtCLFVBQVU7QUFBQTtBQUd6QyxlQUFPO0FBQUE7QUFBQSxhQUdGLGNBQWM7QUFBQSxRQUNuQjtBQUFBLFFBQ0E7QUFBQSxRQUNBLGNBQWM7QUFBQSxRQUNkO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFNBVTBFO0FBQzFFLFlBQUk7QUFFRixlQUFLLG9CQUFvQjtBQUV6QixnQkFBTSxtQkFBbUIsTUFBTSxLQUFLLDJCQUNsQyxVQUNBLGdCQUFnQixJQUFJLE9BQ3BCLGtCQUNBO0FBSUYsZ0JBQU0sRUFBRSxVQUFVLFVBQVUsa0JBQWtCLE1BQU0sS0FBSyxhQUN2RDtBQUdGLGNBQUk7QUFFSixjQUFJLFlBQVksVUFBVTtBQUN4Qix1QkFBVyxNQUFNLEtBQUssK0JBQ3BCLFVBQ0Esa0JBQ0EsYUFDQSxlQUNBO0FBQUEsaUJBRUc7QUFFTCxrQkFBTSxjQUFjO0FBQUEsY0FDbEIsT0FBTztBQUFBLGNBQ1AsVUFBVTtBQUFBLGNBQ1Y7QUFBQSxjQUNBLFFBQVE7QUFBQSxjQUNSLG1CQUFtQjtBQUFBO0FBR3JCLHVCQUFXLE1BQU0sTUFDZixHQUFHLEtBQUssVUFBVSwyQkFBMkIsS0FBSyxlQUNsRDtBQUFBLGNBQ0UsUUFBUTtBQUFBLGNBQ1IsU0FBUztBQUFBLGdCQUNQLGdCQUFnQjtBQUFBLGdCQUNoQixRQUFRO0FBQUEsZ0JBQ1IsaUJBQWlCO0FBQUEsZ0JBQ2pCLGdCQUFnQixPQUFPO0FBQUEsZ0JBQ3ZCLGlCQUFpQixLQUFLO0FBQUE7QUFBQSxjQUV4QixNQUFNLEtBQUssVUFBVTtBQUFBLGNBQ3JCO0FBQUE7QUFBQTtBQUtOLGNBQUksQ0FBQyxTQUFTLElBQUk7QUFDaEIsa0JBQU0sS0FBSyxrQkFBa0IsVUFBVSxDQUFDLENBQUM7QUFBQTtBQUUzQyxjQUFJLENBQUMsU0FBUyxNQUFNO0FBQ2xCLGtCQUFNLElBQUksa0JBQ1IsZ0JBQWdCLFlBQVksZUFDNUIsWUFBWSxjQUNaLFNBQVM7QUFBQTtBQUliLGdCQUFNLFNBQVMsU0FBUyxLQUFLO0FBQzdCLGNBQUksU0FBUztBQUViLGNBQUk7QUFDRixtQkFBTyxNQUFNO0FBQ1gsb0JBQU0sRUFBRSxNQUFNLFVBQVUsTUFBTSxPQUFPO0FBRXJDLGtCQUFJLE1BQU07QUFFUixzQkFBTSxhQUFhLHFCQUFvQixRQUFRO0FBQy9DLG9CQUFJLFlBQVk7QUFDZCx3QkFBTSxRQUFRLEtBQUssa0JBQWtCO0FBQ3JDLHNCQUFJLE9BQU87QUFDVCwwQkFBTSxTQUFTLE1BQU0sS0FBSyxrQkFDeEIsT0FDQSxPQUNBLENBQUMsQ0FBQztBQUVKLHdCQUFJLFFBQVE7QUFDViwwQkFBSSxPQUFPLFdBQVcsT0FBTyxXQUFXO0FBQ3RDLDhCQUFNO0FBQUEsMEJBQ0osU0FBUyxPQUFPLFdBQVc7QUFBQSwwQkFDM0IsV0FBVyxPQUFPLGFBQWE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTXpDO0FBQUE7QUFJRixvQkFBTSxFQUFFLFdBQVcsVUFBVSxlQUMzQixNQUFNLEtBQUssbUJBQW1CLE9BQU8sUUFBUSxPQUFPLENBQUMsQ0FBQztBQUN4RCx1QkFBUztBQUdULHVCQUNNLElBQUksR0FDUixJQUFJLEtBQUssSUFBSSxTQUFTLFFBQVEsV0FBVyxTQUN6QyxLQUNBO0FBQ0Esc0JBQU07QUFBQSxrQkFDSixTQUFTLFNBQVM7QUFBQSxrQkFDbEIsV0FBVyxXQUFXO0FBQUE7QUFBQTtBQUFBO0FBQUEsb0JBSTVCO0FBQ0EsbUJBQU87QUFBQTtBQUFBLGlCQUVGLE9BQVA7QUFDQSxjQUFJLGlCQUFpQixnQkFBZ0IsTUFBTSxTQUFTLGNBQWM7QUFFaEU7QUFBQTtBQUVGLGNBQUksU0FBUztBQUNYLGdCQUFJLGVBQ0YsaUJBQWlCLFFBQ2IsTUFBTSxVQUNOLGdCQUFnQixZQUFZO0FBRWxDLGdCQUNFLGlCQUFpQixxQkFDakIsTUFBTSxTQUFTLFlBQVksZ0JBQzNCLE1BQU0sZUFBZSxLQUNyQjtBQUNBLDhCQUNFO0FBQUE7QUFFSixvQkFBUTtBQUFBO0FBRVYsZ0JBQU07QUFBQTtBQUFBO0FBQUEsWUFRRyxlQUNYLE1BQ21FO0FBQ25FLFlBQUk7QUFFRixnQkFBTSxPQUFPLE1BQU0sS0FBSyxJQUFJLE1BQU0sV0FBVztBQUc3QyxnQkFBTSxXQUFXLElBQUk7QUFDckIsZ0JBQU0sT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsTUFBTTtBQUN0QyxtQkFBUyxPQUFPLFFBQVEsTUFBTSxLQUFLO0FBR25DLGdCQUFNLFdBQVcsTUFBTSxNQUFNLEdBQUcsS0FBSyxvQ0FBb0M7QUFBQSxZQUN2RSxRQUFRO0FBQUEsWUFDUixTQUFTO0FBQUEsY0FDUCxpQkFBaUIsS0FBSztBQUFBO0FBQUEsWUFFeEIsTUFBTTtBQUFBO0FBR1IsY0FBSSxDQUFDLFNBQVMsSUFBSTtBQUNoQixrQkFBTSxJQUFJLE1BQU0sa0JBQWtCLFNBQVM7QUFBQTtBQUU3QyxpQkFBTyxNQUFNLFNBQVM7QUFBQSxpQkFDZixPQUFQO0FBQ0EsZ0JBQU07QUFBQTtBQUFBO0FBQUEsWUFRRyxZQUNYLE1BQ21FO0FBQ25FLFlBQUk7QUFFRixnQkFBTSxPQUFPLE1BQU0sS0FBSyxJQUFJLE1BQU0sV0FBVztBQUc3QyxnQkFBTSxXQUFXLElBQUk7QUFDckIsZ0JBQU0sT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsTUFBTTtBQUN0QyxtQkFBUyxPQUFPLFFBQVEsTUFBTSxLQUFLO0FBR25DLGdCQUFNLFdBQVcsTUFBTSxNQUNyQixHQUFHLEtBQUssdUNBQ1I7QUFBQSxZQUNFLFFBQVE7QUFBQSxZQUNSLE1BQU07QUFBQTtBQUdWLGNBQUksQ0FBQyxTQUFTLElBQUk7QUFDaEIsa0JBQU0sSUFBSSxNQUFNLHdCQUF3QixTQUFTO0FBQUE7QUFFbkQsZ0JBQU0sU0FBUyxNQUFNLFNBQVM7QUFDOUIsaUJBQU87QUFBQSxpQkFDQSxPQUFQO0FBQ0EsZ0JBQU07QUFBQTtBQUFBO0FBQUEsWUFJRyxnQkFBK0I7QUFFMUMsZUFBTyxRQUFRO0FBQUE7QUFBQTtBQWgvQlo7QUFLVSxJQUxWLG9CQUtVLFVBQVUsSUFBSTtBQUFBO0FBQUE7OztBQ25DL0I7QUFBQTtBQUFBO0FBQUE7OztBQ0FBO0FBQUE7QUFBQTtBQUFBOzs7QUNBQSxzQkFhTztBQWJQO0FBQUE7QUFBQSx1QkFBMkI7QUFhcEIsa0NBQTRCLHVCQUFNO0FBQUEsTUFLdkMsWUFDRSxLQUNRLE9BQ0EsZ0JBQ0EsU0FDUjtBQUNBLGNBQU07QUFKRTtBQUNBO0FBQ0E7QUFSRixzQkFBd0I7QUFXOUIsYUFBSyxRQUFRLFNBQVMsc0JBQXNCO0FBQUE7QUFBQSxNQUc5QyxTQUFTO0FBNUJYO0FBNkJJLGNBQU0sRUFBRSxjQUFjO0FBQ3RCLGtCQUFVO0FBQ1Ysa0JBQVUsU0FBUztBQUVuQixhQUFLLFFBQVEsUUFBUSxLQUFLO0FBQzFCLGFBQUssUUFBUSxTQUFTO0FBRXRCLGNBQU0sb0JBQW9CLFVBQVUsVUFDbEM7QUFJRixZQUFJLFlBQUssWUFBTCxtQkFBYyxrQkFBaUIsS0FBSyxRQUFRLGNBQWMsU0FBUyxHQUFHO0FBQ3hFLGdCQUFNLHdCQUF3QixrQkFBa0IsVUFDOUM7QUFHRixlQUFLLFFBQVEsY0FBYyxRQUFRLENBQUMsV0FBVztBQUM3QyxrQkFBTSxTQUFTLHNCQUFzQixTQUFTLFVBQVU7QUFBQSxjQUN0RCxNQUFNLE9BQU87QUFBQSxjQUNiLEtBQUs7QUFBQTtBQUVQLG1CQUFPLFVBQVUsTUFBTTtBQUNyQixtQkFBSyxTQUFTLFFBQVEsT0FBTztBQUU3QixvQkFBTSxRQUFRLElBQUksTUFBTSxTQUFTLEVBQUUsU0FBUztBQUM1QyxtQkFBSyxTQUFTLGNBQWM7QUFBQTtBQUFBO0FBQUE7QUFLbEMsYUFBSyxXQUFXLGtCQUFrQixTQUFTLFlBQVk7QUFBQSxVQUNyRCxLQUFLO0FBQUEsVUFDTCxNQUFNO0FBQUEsWUFDSixNQUFNLGtCQUFLLFlBQUwsbUJBQWMsU0FBZCxtQkFBb0IsZUFBYztBQUFBLFlBQ3hDLGFBQWEsWUFBSyxZQUFMLG1CQUFjLGdCQUFlO0FBQUE7QUFBQTtBQUc5QyxhQUFLLFNBQVMsUUFBUSxLQUFLO0FBRzNCLGNBQU0saUJBQWlCLElBQUksZUFBZSxNQUFNO0FBQzlDLGVBQUssU0FBUyxNQUFNLFNBQVM7QUFDN0IsZUFBSyxTQUFTLE1BQU0sU0FBUyxLQUFLLFNBQVMsZUFBZTtBQUFBO0FBRTVELHVCQUFlLFFBQVEsS0FBSztBQUU1QixjQUFNLGtCQUFrQixVQUFVLFVBQ2hDO0FBR0YsWUFBSSxXQUFLLFlBQUwsbUJBQWMsaUJBQWlCO0FBQ2pDLGdCQUFNLGtCQUFrQixnQkFBZ0IsU0FBUyxVQUFVO0FBQUEsWUFDekQsTUFBTSxLQUFLLFFBQVE7QUFBQSxZQUNuQixLQUFLO0FBQUE7QUFFUCwwQkFBZ0IsVUFBVSxNQUFNO0FBQzlCLGlCQUFLLFNBQVM7QUFDZCxpQkFBSztBQUFBO0FBQUE7QUFJVCxjQUFNLGdCQUFnQixnQkFBZ0IsU0FBUyxVQUFVO0FBQUEsVUFDdkQsTUFBTSxZQUFLLFlBQUwsbUJBQWMsa0JBQWlCO0FBQUEsVUFDckMsS0FBSztBQUFBO0FBRVAsc0JBQWMsVUFBVSxNQUFNO0FBQzVCLGVBQUssU0FBUyxLQUFLLFNBQVM7QUFDNUIsZUFBSztBQUFBO0FBSVAsYUFBSyxTQUFTO0FBQ2QsYUFBSyxTQUFTLGtCQUNaLEtBQUssU0FBUyxNQUFNLFFBQ3BCLEtBQUssU0FBUyxNQUFNO0FBQUE7QUFBQSxNQUl4QixVQUFVO0FBQ1IsY0FBTSxFQUFFLGNBQWM7QUFDdEIsa0JBQVU7QUFDVixZQUFJLEtBQUssZ0JBQWdCO0FBQ3ZCLGVBQUssZUFBZSxLQUFLO0FBQUE7QUFBQTtBQUFBLFlBSXZCLGtCQUEwQztBQUM5QyxlQUFPLElBQUksUUFBUSxDQUFDLFlBQVk7QUFDOUIsZUFBSyxpQkFBaUI7QUFDdEIsZUFBSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztBQ3ZHSixtQkFDTCxLQUNBLFNBQ0EsU0FDb0Q7QUFDcEQsU0FBTyxJQUFJLFFBQVEsQ0FBQyxZQUFZO0FBQzlCLFVBQU0sUUFBUSxJQUFJLHVCQUFNO0FBQ3hCLFVBQU0sUUFBUSxTQUFTO0FBR3ZCLFVBQU0sUUFBUSxNQUFNLFlBQVksd0JBQXdCO0FBR3hELFVBQU0sUUFBUSxRQUFRLG9DQUFTLFVBQVM7QUFDeEMsVUFBTSxRQUFRLFNBQVM7QUFHdkIsUUFBSSxtQ0FBUyxhQUFhO0FBQ3hCLFlBQU0sZ0JBQWdCLE1BQU0sUUFBUTtBQUNwQyxvQkFBYyxTQUFTO0FBQ3ZCLG9CQUFjLFFBQVEsUUFBUTtBQUM5QixvQkFBYyxNQUFNLFFBQVE7QUFDNUIsb0JBQWMsTUFBTSxXQUFXO0FBQy9CLG9CQUFjLE1BQU0sWUFBWTtBQUNoQyxvQkFBYyxNQUFNLGVBQWU7QUFBQTtBQUdyQyxVQUFNLEVBQUUsY0FBYztBQUN0QixjQUFVO0FBQ1YsY0FBVSxTQUFTO0FBQ25CLGNBQVUsTUFBTSxVQUFVO0FBRTFCLFVBQU0sY0FBd0I7QUFHOUIsUUFDRSxXQUNBLFFBQVEsVUFDUCxFQUFDLG9DQUFTLFVBQVMsWUFBWSxRQUFRLFFBQ3hDO0FBQ0EsWUFBTSxtQkFBbUIsVUFBVSxVQUNqQztBQUVGLHVCQUFpQixNQUFNLFlBQVk7QUFDbkMsdUJBQWlCLE1BQU0sZUFBZTtBQUN0QyxZQUFNLFlBQVksaUJBQWlCLFVBQVU7QUFDN0MsZ0JBQVUsUUFBUTtBQUFBO0FBR3BCLFFBQUksbUNBQVMsUUFBUTtBQUNuQixZQUFNLGlCQUFpQixVQUFVLFVBQy9CO0FBRUYscUJBQWUsTUFBTSxVQUFVO0FBRy9CLFVBQ0UsUUFBUSxPQUFPLEtBQUssQ0FBQyxVQUFPO0FBekVwQztBQTBFVSwyQkFBTSxjQUFOLG1CQUFpQixTQUFTO0FBQUEsVUFFNUI7QUFDQSx1QkFBZSxTQUFTO0FBQUE7QUFHMUIsY0FBUSxPQUFPLFFBQVEsQ0FBQyxPQUFPLFVBQVU7QUFDdkMsY0FBTSxVQUFVLGVBQWUsU0FDN0IsTUFBTSxTQUFTLGFBQWEsYUFBYSxTQUN6QztBQUFBLFVBQ0UsTUFBTSxNQUFNLFNBQVMsYUFBYSxTQUFZLE1BQU07QUFBQSxVQUNwRCxhQUFhLE1BQU07QUFBQSxVQUNuQixNQUFNLE1BQU0sV0FBVyxFQUFFLFVBQVUsT0FBTztBQUFBO0FBRzlDLFlBQUksTUFBTSxXQUFXO0FBQ25CLGtCQUFRLFNBQVMsTUFBTTtBQUFBLGVBQ2xCO0FBQ0wsa0JBQVEsTUFBTSxRQUFRO0FBQ3RCLGtCQUFRLE1BQU0sZUFBZTtBQUFBO0FBSS9CLFlBQUksTUFBTSxPQUFPO0FBQ2YsY0FBSSxNQUFNLFNBQVMsWUFBWTtBQUM3QixvQkFBUSxRQUFRLE1BQU07QUFBQSxpQkFDakI7QUFDTCxvQkFBUSxhQUFhLFNBQVMsTUFBTTtBQUFBO0FBRXRDLHNCQUFZLFNBQVMsTUFBTTtBQUFBO0FBRzdCLGdCQUFRLGlCQUFpQixTQUFTLE1BQU07QUFDdEMsc0JBQVksU0FBUyxRQUFRO0FBQUE7QUFBQTtBQUFBO0FBS25DLFVBQU0sa0JBQWtCLFVBQVUsVUFDaEM7QUFFRixvQkFBZ0IsTUFBTSxZQUFZO0FBRWxDLFFBQUksYUFBYTtBQUVqQixRQUFJLG1DQUFTLGlCQUFpQjtBQUM1QixZQUFNLGtCQUFrQixnQkFBZ0IsU0FBUyxVQUFVO0FBQUEsUUFDekQsTUFBTSxRQUFRO0FBQUEsUUFDZCxLQUFLO0FBQUE7QUFFUCxzQkFBZ0IsVUFBVSxNQUFNO0FBQzlCLHFCQUFhO0FBQ2IsY0FBTTtBQUNOLGdCQUFRLEVBQUUsV0FBVztBQUFBO0FBQUE7QUFJekIsVUFBTSxnQkFBZ0IsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLE1BQ3ZELE1BQU0sb0NBQVMsa0JBQWlCO0FBQUEsTUFDaEMsS0FBSztBQUFBO0FBR1AsVUFBTSxnQkFBZ0IsTUFBTTtBQXhJaEM7QUF5SU0sWUFBTSxpQkFBaUIsQ0FBQywwQ0FBUyxXQUFULG1CQUFpQixLQUN2QyxDQUFDLE9BQU8sTUFBTSxNQUFNLFlBQVksQ0FBQyxZQUFZO0FBRy9DLFVBQUksZ0JBQWdCO0FBQ2xCLHFCQUFhO0FBQ2IsY0FBTTtBQUNOLGdCQUFRO0FBQUEsVUFDTixXQUFXO0FBQUEsVUFDWCxRQUFRLG9DQUFTLFVBQVMsY0FBYztBQUFBO0FBQUE7QUFBQTtBQUs5QyxrQkFBYyxVQUFVO0FBR3hCLFVBQU0sUUFBUSxpQkFBaUIsV0FBVyxDQUFDLE1BQXFCO0FBQzlELFVBQUksRUFBRSxRQUFRLFdBQVcsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxFQUFFLFVBQVU7QUFDdEQsVUFBRTtBQUNGO0FBQUEsaUJBQ1MsRUFBRSxRQUFRLFVBQVU7QUFDN0IsVUFBRTtBQUNGLHFCQUFhO0FBQ2IsY0FBTTtBQUNOLGdCQUFRLEVBQUUsV0FBVztBQUFBO0FBQUE7QUFJekIsVUFBTSxVQUFVLE1BQU07QUFDcEIsVUFBSSxDQUFDLFlBQVk7QUFDZixnQkFBUSxFQUFFLFdBQVc7QUFBQTtBQUFBO0FBS3pCLFFBQUksbUNBQVMsUUFBUTtBQUNuQixZQUFNLGFBQWEsVUFBVSxjQUFjO0FBQzNDLFVBQUksWUFBWTtBQUNkLG1CQUFXO0FBQUE7QUFBQTtBQUlmLFVBQU07QUFBQTtBQUFBO0FBcExWO0FBQUE7QUFBQTtBQUFBLHVCQUEyQjtBQUFBO0FBQUE7OztBQ0twQiw0QkFDTCxTQUNBLE1BQ0EsT0FDQTtBQUVBLE1BQUksT0FBTztBQUNULFlBQVEsTUFBTSx5QkFBeUI7QUFBQSxNQUNyQztBQUFBLE1BQ0EsU0FBUyxpQkFBaUIsUUFBUSxNQUFNLFVBQVUsT0FBTztBQUFBLE1BQ3pELE9BQU8saUJBQWlCLFFBQVEsTUFBTSxRQUFRO0FBQUEsTUFDOUMsVUFBVSxpQkFBaUIsb0JBQW9CLE1BQU0sV0FBVztBQUFBO0FBQUE7QUFJcEUsTUFBSTtBQUNKLFVBQVE7QUFBQSxTQUNEO0FBQ0gsaUJBQVc7QUFDWDtBQUFBLFNBQ0c7QUFDSCxpQkFBVztBQUNYO0FBQUE7QUFFQSxpQkFBVztBQUFBO0FBR2YsUUFBTSxTQUFTLElBQUksd0JBQU8sU0FBUztBQUNuQyxTQUFPO0FBQUE7QUFqQ1Q7QUFBQTtBQUFBO0FBQUEsdUJBQXVCO0FBQ3ZCO0FBQUE7QUFBQTs7O0FDREE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFBQTtBQUFBOzs7QUM0Qk8sNEJBQTRCLEtBQVUsV0FBZ0M7QUFDM0UsUUFBTSxRQUFRLElBQUksTUFBTSxvQkFBb0IsT0FBTyxDQUFDLFNBQXdCO0FBckM5RTtBQXNDSSxRQUFJLENBQUUsaUJBQWdCO0FBQVEsYUFBTztBQUVyQyxVQUFNLFVBQVUsV0FBSyxXQUFMLG1CQUFhO0FBQzdCLFdBQU8sWUFBWSxhQUFhLEtBQUssY0FBYztBQUFBO0FBRXJELFNBQU8sSUFBSSxJQUFJLE1BQU0sSUFBSSxDQUFDLFNBQVMsS0FBSztBQUFBO0FBR25DLDZCQUNMLFNBQ0EsVUFDQSxLQUNBLFdBQ2U7QUFDZixTQUFPLElBQUksY0FBYyxTQUFTLFVBQVUsS0FBSztBQUFBO0FBcERuRCxzQkFFTztBQUZQO0FBQUE7QUFBQSx1QkFBaUQ7QUFFMUMsa0NBQTRCLHNDQUE2QjtBQUFBLE1BRzlELFlBQ1UsU0FDQSxZQUNSLEtBQ1EsV0FDUjtBQUNBLGNBQU0sS0FBSztBQUxIO0FBQ0E7QUFFQTtBQUdSLGFBQUssVUFBVSxtQkFBbUIsS0FBSztBQUFBO0FBQUEsTUFHekMsZUFBZSxVQUE0QjtBQUN6QyxjQUFNLG9CQUFvQixTQUFTO0FBQ25DLGVBQU8sQ0FBQyxHQUFHLEtBQUssU0FBUyxPQUFPLENBQUMsWUFDL0IsUUFBUSxjQUFjLFNBQVM7QUFBQTtBQUFBLE1BSW5DLGlCQUFpQixTQUFpQixJQUF1QjtBQUV2RCxZQUFJLFVBQVUsUUFBUSxRQUFRLFNBQVM7QUFDdkMsV0FBRyxRQUFRO0FBQUE7QUFBQSxNQUdiLGlCQUFpQixTQUFpQixLQUF1QztBQUN2RSxhQUFLLFdBQVc7QUFDaEIsYUFBSyxRQUFRLFFBQVEsUUFBUSxRQUFRLFNBQVM7QUFDOUMsYUFBSyxRQUFRO0FBQ2IsYUFBSztBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUNoQ1Q7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQSthQSw2Q0FDRSxLQUNBLFFBQ0EsZUFDQSxTQUk0QztBQUM1QyxRQUFNLFFBQVEsSUFBSSwwQkFDaEIsS0FDQSxRQUNBLGVBQ0EsbUNBQVMsd0JBQ1QsbUNBQVM7QUFFWCxTQUFPLE1BQU0sTUFBTTtBQUFBO0FBL2JyQix1QkFxQk87QUFyQlA7QUFBQTtBQUFBLHdCQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFrQk8sOENBQXdDLHdCQUFNO0FBQUEsTUFhbkQsWUFDRSxLQUNRLFFBQ0EsZUFDQSx5QkFBaUMsK0JBQ2pDLG1CQUNSO0FBQ0EsY0FBTTtBQUxFO0FBQ0E7QUFDQTtBQUNBO0FBakJGLHNCQUE0QztBQVE1Qyw0QkFBOEI7QUFDOUIsdUJBQXlDO0FBVy9DLGFBQUssUUFBUSxTQUFTLHNCQUFzQjtBQUM1QyxhQUFLLGdCQUFnQixvQkFBb0IsWUFBWSxPQUFPLFVBQVU7QUFBQTtBQUFBLE1BR2hFLFlBQVksTUFBZTtBQUNqQyxZQUFJLENBQUMsS0FBSyxvQkFBb0IsQ0FBQyxLQUFLO0FBQWtCO0FBRXRELGFBQUssaUJBQWlCLE1BQU0sVUFBVSxPQUFPLFNBQVM7QUFDdEQsYUFBSyxpQkFBaUIsTUFBTSxVQUFVLE9BQU8sU0FBUztBQUFBO0FBQUEsWUFHbEQsY0FBYztBQUNsQixZQUFJO0FBQ0YsZUFBSyxZQUFZO0FBQ2pCLGdCQUFNLFdBQVcsTUFBTSxNQUNyQixHQUFHLEtBQUssY0FBYztBQUV4QixjQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGtCQUFNLElBQUksTUFBTTtBQUFBO0FBRWxCLGdCQUFNLE9BQU8sTUFBTSxTQUFTO0FBQzVCLGVBQUssVUFBVSxLQUFLLEtBQUs7QUFHekIsZUFBSztBQUNMLGVBQUssWUFBWTtBQUFBLGlCQUNWLE9BQVA7QUFDQSxrQkFBUSxNQUFNLDhDQUE4QztBQUM1RCxlQUFLLFlBQVk7QUFDakIsZ0JBQU0sVUFBVSxLQUFLLEtBQUssSUFBSTtBQUFBLFlBQzVCLE9BQU87QUFBQSxZQUNQLGFBQWE7QUFBQSxZQUNiLGVBQWU7QUFBQTtBQUFBO0FBQUE7QUFBQSxNQUtiLHNCQUFzQjtBQUM1QixZQUFJLENBQUMsS0FBSztBQUF1QjtBQUdqQyxhQUFLLHNCQUFzQjtBQUczQixZQUFJLEtBQUssbUJBQW1CO0FBQzFCLGVBQUssZUFBZTtBQUFBLGVBQ2Y7QUFDTCxlQUFLLFFBQVEsUUFBUSxDQUFDLFdBQVc7QUFDL0IsZ0JBQUksT0FBTyxpQkFBaUIsS0FBSyxlQUFlO0FBQzlDLG1CQUFLLGVBQWUsT0FBTztBQUFBO0FBQUE7QUFBQTtBQU1qQyxhQUFLLFFBQVEsUUFBUSxDQUFDLFdBQVc7QUFDL0IsZ0JBQU0sU0FBUyxLQUFLLHNCQUFzQixTQUFTLFVBQVU7QUFBQSxZQUMzRCxNQUFNLE9BQU87QUFBQSxZQUNiLEtBQUs7QUFBQTtBQUlQLGNBQUksT0FBTyxhQUFhO0FBQ3RCLG1CQUFPLGFBQWEsY0FBYyxPQUFPO0FBQ3pDLG1CQUFPLFNBQVM7QUFBQTtBQUlsQixjQUFJLE9BQU8sT0FBTyxLQUFLLGNBQWM7QUFDbkMsbUJBQU8sU0FBUztBQUNoQixnQkFBSSxLQUFLLFVBQVU7QUFDakIsbUJBQUssU0FBUyxRQUFRLE9BQU87QUFDN0IsbUJBQUssU0FBUyxXQUFXLENBQUMsT0FBTztBQUFBO0FBQUE7QUFJckMsaUJBQU8sVUFBVSxNQUFNO0FBRXJCLGlCQUFLLHNCQUNGLGlCQUFpQiwrQkFDakIsUUFBUSxDQUFDLFFBQVEsSUFBSSxZQUFZO0FBQ3BDLG1CQUFPLFNBQVM7QUFDaEIsaUJBQUssZUFBZSxPQUFPO0FBRzNCLGdCQUFJLE9BQU8sT0FBTyxVQUFVO0FBQzFCLG1CQUFLLGNBQWMsTUFBTSxVQUFVO0FBQ25DLG1CQUFLLFlBQVk7QUFDakIsa0JBQUksS0FBSyxVQUFVO0FBQ2pCLHFCQUFLLFNBQVMsV0FBVztBQUFBO0FBQUEsbUJBRXRCO0FBQ0wsbUJBQUssY0FBYyxNQUFNLFVBQVU7QUFDbkMsa0JBQUksS0FBSyxVQUFVO0FBQ2pCLHFCQUFLLFNBQVMsUUFBUSxPQUFPO0FBQzdCLHFCQUFLLFNBQVMsV0FBVyxDQUFDLE9BQU87QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU96QyxZQUFJLEtBQUssaUJBQWlCLFVBQVU7QUFDbEMsZUFBSyxjQUFjLE1BQU0sVUFBVTtBQUNuQyxjQUFJLEtBQUssbUJBQW1CO0FBQzFCLGlCQUFLLFlBQVksUUFBUSxLQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUEsWUFLOUIsU0FBUztBQUNiLGNBQU0sRUFBRSxjQUFjO0FBQ3RCLGtCQUFVO0FBQ1Ysa0JBQVUsU0FBUztBQUduQixhQUFLLFFBQVEsUUFBUTtBQUNyQixhQUFLLFFBQVEsU0FBUztBQUd0QixjQUFNLGdCQUFnQixLQUFLLFFBQVE7QUFDbkMsc0JBQWMsU0FBUztBQUN2QixzQkFBYyxRQUNaO0FBRUYsc0JBQWMsTUFBTSxRQUFRO0FBQzVCLHNCQUFjLE1BQU0sV0FBVztBQUMvQixzQkFBYyxNQUFNLFlBQVk7QUFHaEMsYUFBSyxtQkFBbUIsVUFBVSxVQUFVO0FBQzVDLGFBQUssaUJBQWlCLE1BQU0sVUFBVTtBQUN0QyxhQUFLLGlCQUFpQixNQUFNLGlCQUFpQjtBQUM3QyxhQUFLLGlCQUFpQixNQUFNLGFBQWE7QUFDekMsYUFBSyxpQkFBaUIsTUFBTSxVQUFVO0FBQ3RDLGNBQU0sY0FBYyxLQUFLLGlCQUFpQjtBQUMxQyxvQkFBWSxRQUFRO0FBR3BCLGFBQUssbUJBQW1CLFVBQVUsVUFDaEM7QUFHRixjQUFNLG9CQUFvQixLQUFLLGlCQUFpQixVQUM5QztBQUlGLGFBQUssd0JBQXdCLGtCQUFrQixVQUM3QztBQUlGLGFBQUssZ0JBQWdCLGtCQUFrQixVQUNyQztBQUVGLGFBQUssY0FBYyxNQUFNLFVBQVU7QUFFbkMsY0FBTSx1QkFBdUIsS0FBSyxjQUFjLFVBQzlDO0FBSUYsY0FBTSxlQUFlLHFCQUFxQixVQUN4QztBQUVGLHFCQUFhLE1BQU0sVUFBVTtBQUM3QixxQkFBYSxNQUFNLE1BQU07QUFDekIscUJBQWEsTUFBTSxhQUFhO0FBR2hDLGFBQUssY0FBYyxhQUFhLFNBQVMsU0FBUztBQUFBLFVBQ2hELE1BQU07QUFBQSxVQUNOLGFBQWE7QUFBQSxVQUNiLEtBQUs7QUFBQTtBQUlQLGNBQU0sZ0JBQWUsYUFBYSxTQUFTLFVBQVU7QUFBQSxVQUNuRCxLQUFLO0FBQUE7QUFFUCxzQkFBYSxNQUFNLFVBQVU7QUFDN0Isc0JBQWEsTUFBTSxlQUFlO0FBQ2xDLHNCQUFhLE1BQU0sU0FBUztBQUM1Qix1Q0FBUSxlQUFjO0FBRXRCLHNCQUFhLGlCQUFpQixTQUFTLFlBQVk7QUFwT3ZEO0FBcU9NLGNBQUksa0JBQWtCO0FBQ3RCLGNBQUk7QUFDRixrQkFBTSxXQUFXLE1BQU0sTUFDckIsR0FBRyxLQUFLLGNBQWM7QUFFeEIsZ0JBQUksQ0FBQyxTQUFTLElBQUk7QUFDaEIsb0JBQU0sSUFBSSxNQUFNO0FBQUE7QUFFbEIsa0JBQU0sT0FBTyxNQUFNLFNBQVM7QUFDNUIsOEJBQWtCLEtBQUs7QUFBQSxtQkFDaEIsT0FBUDtBQUNBLG9CQUFRLE1BQU0sMENBQTBDO0FBQ3hELGtCQUFNLFVBQVUsS0FBSyxLQUFLLElBQUk7QUFBQSxjQUM1QixPQUFPO0FBQUEsY0FDUCxhQUNFO0FBQUEsY0FDRixlQUFlO0FBQUE7QUFFakI7QUFBQTtBQUdGLGdCQUFNLFNBQVMsTUFBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsWUFDM0MsT0FBTztBQUFBLFlBQ1AsYUFDRTtBQUFBLFlBQ0YsZUFBZTtBQUFBLFlBQ2YsaUJBQWlCO0FBQUEsWUFDakIsUUFBUTtBQUFBLGNBQ047QUFBQSxnQkFDRSxNQUFNO0FBQUEsZ0JBQ04sYUFBYTtBQUFBLGdCQUNiLFVBQVU7QUFBQSxnQkFDVixXQUFXO0FBQUE7QUFBQSxjQUViO0FBQUEsZ0JBQ0UsTUFBTTtBQUFBLGdCQUNOLE9BQU87QUFBQSxnQkFDUCxVQUFVO0FBQUEsZ0JBQ1YsV0FBVztBQUFBO0FBQUE7QUFBQTtBQUtqQixjQUFJLENBQUMsa0NBQVEsY0FBYSxDQUFDLGNBQU8sV0FBUCxtQkFBZ0IsT0FBTSxDQUFDLGNBQU8sV0FBUCxtQkFBZ0IsS0FBSTtBQUNwRTtBQUFBO0FBR0YsZ0JBQU0sQ0FBQyxPQUFPLFdBQVcsT0FBTztBQUNoQyxnQkFBTSxXQUFXLE1BQU0sUUFBUSxvQkFBb0IsSUFBSSxRQUFRLE1BQU07QUFDckUsZ0JBQU0sV0FBVyxHQUFHLEtBQUssMEJBQTBCO0FBRW5ELGNBQUk7QUFFRixrQkFBTSxLQUFLLElBQUksTUFDWixhQUFhLEtBQUssd0JBQ2xCLE1BQU0sTUFBTTtBQUFBO0FBSWYsa0JBQU0sY0FBYyxLQUFLO0FBQUE7QUFBQSxFQUFZO0FBQ3JDLGtCQUFNLE9BQU8sTUFBTSxLQUFLLElBQUksTUFBTSxPQUFPLFdBQVcsT0FBTztBQUUzRCxnQkFBSSxDQUFDLE1BQU07QUFDVCxvQkFBTSxJQUFJLE1BQU07QUFBQTtBQUlsQixnQkFBSSxLQUFLLFVBQVU7QUFDakIsbUJBQUssU0FBUyxRQUFRO0FBQ3RCLG1CQUFLLFNBQVMsV0FBVztBQUFBO0FBSTNCLGlCQUFLLFlBQVksUUFBUTtBQUV6QixrQkFBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsY0FDNUIsT0FBTztBQUFBLGNBQ1AsYUFBYTtBQUFBLGNBQ2IsZUFBZTtBQUFBO0FBQUEsbUJBRVYsT0FBUDtBQUNBLG9CQUFRLE1BQU0sc0NBQXNDO0FBQ3BELGtCQUFNLFVBQVUsS0FBSyxLQUFLLElBQUk7QUFBQSxjQUM1QixPQUFPO0FBQUEsY0FDUCxhQUNFLGlCQUFpQixRQUNiLE1BQU0sVUFDTjtBQUFBLGNBQ04sZUFBZTtBQUFBO0FBQUE7QUFBQTtBQU1yQiw0QkFDRSxLQUFLLGFBQ0wsT0FBTyxpQkFBeUI7QUFDOUIsY0FBSTtBQUNGLGtCQUFNLE9BQU8sS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBQ2xELGdCQUFJLGdCQUFnQix5QkFBTztBQUN6QixvQkFBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyxtQkFBSyxTQUFTLFFBQVE7QUFDdEIsbUJBQUssU0FBUyxXQUFXO0FBRXpCLG1CQUFLLFlBQVksUUFBUSxhQUFhLFFBQVEsU0FBUztBQUFBO0FBQUEsbUJBRWxELE9BQVA7QUFDQSxvQkFBUSxNQUFNLHFDQUFxQztBQUFBO0FBQUEsV0FHdkQsS0FBSyxLQUNMLEtBQUs7QUFHUCxhQUFLLFdBQVcsa0JBQWtCLFNBQVMsWUFBWTtBQUFBLFVBQ3JELEtBQUs7QUFBQSxVQUNMLE1BQU07QUFBQSxZQUNKLGFBQWE7QUFBQTtBQUFBO0FBR2pCLGFBQUssU0FBUyxRQUFRLEtBQUs7QUFHM0IsY0FBTSxpQkFBaUIsSUFBSSxlQUFlLE1BQU07QUFDOUMsZUFBSyxTQUFTLE1BQU0sU0FBUztBQUM3QixlQUFLLFNBQVMsTUFBTSxTQUFTLEtBQUssU0FBUyxlQUFlO0FBQUE7QUFFNUQsdUJBQWUsUUFBUSxLQUFLO0FBRTVCLGNBQU0sa0JBQWtCLEtBQUssaUJBQWlCLFVBQzVDO0FBR0YsY0FBTSxrQkFBa0IsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLFVBQ3pELE1BQU07QUFBQSxVQUNOLEtBQUs7QUFBQTtBQUVQLGNBQU0sZUFBZSxNQUFNO0FBQ3pCLGVBQUssU0FBUztBQUNkLGVBQUs7QUFBQTtBQUVQLHdCQUFnQixVQUFVO0FBRTFCLGNBQU0sZ0JBQWdCLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxVQUN2RCxNQUFNO0FBQUEsVUFDTixLQUFLO0FBQUE7QUFFUCxjQUFNLGFBQWEsTUFBTTtBQUN2QixnQkFBTSxlQUFlLEtBQUssUUFBUSxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sS0FBSztBQUM1RCxlQUFLLFNBQVM7QUFBQSxZQUNaLFNBQVMsS0FBSyxTQUFTO0FBQUEsWUFDdkIsTUFBTyw4Q0FBYyxPQUFNO0FBQUEsWUFDM0IsTUFDRSxLQUFLLGlCQUFpQixXQUFXLEtBQUssWUFBWSxRQUFRO0FBQUE7QUFFOUQsZUFBSztBQUFBO0FBRVAsc0JBQWMsVUFBVTtBQUd4QixhQUFLLFFBQVEsaUJBQWlCLFdBQVcsQ0FBQyxNQUFxQjtBQUM3RCxjQUNFLEVBQUUsUUFBUSxXQUNWLENBQUMsRUFBRSxlQUNILENBQUMsRUFBRSxZQUNILEVBQUUsV0FBVyxLQUFLLFVBQ2xCO0FBQ0EsY0FBRTtBQUNGO0FBQUEscUJBQ1MsRUFBRSxRQUFRLFVBQVU7QUFDN0IsY0FBRTtBQUNGO0FBQUE7QUFBQTtBQUtKLGFBQUssU0FBUztBQUNkLGFBQUssU0FBUyxrQkFDWixLQUFLLFNBQVMsTUFBTSxRQUNwQixLQUFLLFNBQVMsTUFBTTtBQUl0QixjQUFNLEtBQUs7QUFBQTtBQUFBLE1BR2IsVUFBVTtBQUNSLGNBQU0sRUFBRSxjQUFjO0FBQ3RCLGtCQUFVO0FBQ1YsWUFBSSxLQUFLLG1CQUFtQixVQUFhLEtBQUssbUJBQW1CLE1BQU07QUFDckUsZUFBSyxlQUFlLEtBQUs7QUFBQTtBQUFBO0FBQUEsWUFJdkIsa0JBQThEO0FBQ2xFLGVBQU8sSUFBSSxRQUFRLENBQUMsWUFBWTtBQUM5QixlQUFLLGlCQUFpQjtBQUN0QixlQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7O0FDMWFYO0FBQUE7QUFBQTtBQUFBLHdCQUF1QjtBQUd2Qjs7O0FDSEEsd0JBQXVEO0FBRXZEOzs7QUM4RU8sSUFBTSwwQkFBK0M7QUFBQSxFQUMxRCxrQkFBa0I7QUFBQSxFQUNsQixxQkFBcUI7QUFBQSxFQUNyQixvQkFBb0I7QUFBQTs7O0FDUmYsSUFBTSxtQkFBeUM7QUFBQSxFQUNwRCxZQUFZO0FBQUEsRUFDWixjQUFjO0FBQUEsRUFDZCxpQkFBaUI7QUFBQSxFQUNqQixnQkFBZ0I7QUFBQSxFQUNoQixlQUFlO0FBQUEsRUFFZixjQUNFO0FBQUEsRUFDRixxQkFBcUI7QUFBQSxFQUNyQixpQkFBaUI7QUFBQSxFQUNqQix1QkFBdUI7QUFBQSxFQUN2QiwwQkFBMEI7QUFBQSxFQUMxQix3QkFBd0I7QUFBQSxFQUN4QixzQkFDRTtBQUFBLEVBQ0YsdUJBQXVCO0FBQUEsRUFDdkIsbUJBQW1CO0FBQUEsRUFDbkIsc0JBQXNCO0FBQUEsRUFDdEIsa0JBQWtCO0FBQUEsRUFDbEIsa0JBQWtCO0FBQUEsRUFDbEIsV0FBVztBQUFBLEVBQ1gsc0JBQXNCO0FBQUEsRUFDdEIsc0JBQXNCO0FBQUEsRUFDdEIsd0JBQXdCO0FBQUEsRUFDeEIsZ0JBQWdCO0FBQUEsRUFDaEIsd0JBQXdCO0FBQUEsRUFLeEIsa0JBQWtCO0FBQUEsRUFDbEIsa0JBQWtCO0FBQUEsRUFLbEIsaUJBQWlCO0FBQUEsRUFFakIscUJBQXFCO0FBQUEsRUFFckIsZ0JBQWdCO0FBQUEsRUFFaEIsZ0JBQWdCO0FBQUEsSUFDZCxJQUFJO0FBQUEsSUFDSixNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUE7QUFBQTs7O0FGckhWOzs7QUdKQSx1QkFBb0M7OztBQ29DN0IsMEJBQW9CO0FBQUEsRUFBcEIsY0FwQ1A7QUFxQ21CLHlDQUFnQztBQUNoQyx3Q0FBK0I7QUFBQTtBQUFBLEVBRXpDLE9BQ0wsT0FDQSxPQUNBLHFCQUNBLFNBQ21CO0FBN0N2QjtBQThDSSxVQUFNLGVBQ0oseUNBQVMsd0JBQVQsWUFBZ0MsS0FBSztBQUN2QyxVQUFNLGNBQ0oseUNBQVMsdUJBQVQsWUFBK0IsS0FBSztBQUd0QyxRQUFJLENBQUMsTUFBTSxRQUFRO0FBQ2pCLGFBQU8sTUFBTSxNQUFNLEdBQUcsY0FBYyxJQUFJLENBQUMsU0FBVTtBQUFBLFFBQ2pEO0FBQUEsUUFDQSxTQUFTO0FBQUEsUUFDVCxPQUFPO0FBQUE7QUFBQTtBQUtYLFVBQU0sY0FBYyxNQUFNLGNBQWMsTUFBTSxPQUFPLE9BQU87QUFFNUQsVUFBTSxnQkFBZ0IsTUFBTSxJQUFJLENBQUMsU0FBUztBQUN4QyxZQUFNLFNBQVMsb0JBQW9CO0FBQ25DLFlBQU0sVUFBeUI7QUFDL0IsVUFBSSxhQUFhO0FBRWpCLGFBQU8sUUFBUSxDQUFDLFVBQVU7QUFDeEIsWUFBSSxDQUFDLE1BQU07QUFBTTtBQUNqQixjQUFNLFlBQVksTUFBTTtBQUN4QixjQUFNLGlCQUFpQixVQUFVO0FBR2pDLGNBQU0sZ0JBQWdCLFlBQVksTUFBTSxDQUFDLFNBQ3ZDLGVBQWUsU0FBUztBQUcxQixZQUFJLGVBQWU7QUFFakIsc0JBQVksUUFBUSxDQUFDLFNBQVM7QUFDNUIsa0JBQU0sUUFBUSxLQUFLLFlBQVksV0FBVztBQUMxQyxnQkFBSSxNQUFNLFFBQVEsU0FBUyxHQUFHO0FBQzVCLHNCQUFRLEtBQUs7QUFBQSxnQkFDWCxPQUFPLE1BQU07QUFBQSxnQkFDYixNQUFNO0FBQUEsZ0JBQ04sU0FBUyxNQUFNO0FBQUEsZ0JBQ2YsY0FBYyxNQUFNO0FBQUE7QUFHdEIsa0JBQUksUUFBUSxNQUFNLFNBQVMsTUFBTTtBQUdqQyxrQkFBSSxZQUFZLFNBQVMsR0FBRztBQUMxQixzQkFBTSxnQkFBZ0IsWUFBWSxJQUFJLENBQUMsTUFBTTtBQUMzQyx3QkFBTSxNQUFNLGVBQWUsUUFBUTtBQUNuQyx5QkFBTyxPQUFPLElBQUksTUFBTTtBQUFBO0FBRzFCLHNCQUFNLGNBQ0osS0FBSyxJQUFJLEdBQUcsaUJBQ1osS0FBSyxJQUFJLEdBQUcsY0FBYyxPQUFPLENBQUMsTUFBTSxNQUFNO0FBQ2hELG9CQUFJLGNBQWMsSUFBSTtBQUNwQiwyQkFBUztBQUFBO0FBQUE7QUFJYiw0QkFBYztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTXRCLGFBQU87QUFBQSxRQUNMO0FBQUEsUUFDQTtBQUFBLFFBQ0EsT0FBTztBQUFBO0FBQUE7QUFLWCxVQUFNLGVBQWUsY0FBYyxPQUFPLENBQUMsV0FBVztBQUNwRCxVQUFJLE9BQU8sUUFBUSxXQUFXO0FBQUcsZUFBTztBQUd4QyxZQUFNLGFBQWEsSUFBSTtBQUN2QixhQUFPLFFBQVEsUUFBUSxDQUFDLFVBQVU7QUFDaEMsY0FBTSxPQUFPLE1BQU0sS0FBSztBQUN4QixvQkFBWSxRQUFRLENBQUMsU0FBUztBQUM1QixjQUFJLEtBQUssU0FBUztBQUFPLHVCQUFXLElBQUk7QUFBQTtBQUFBO0FBSTVDLGFBQU8sV0FBVyxTQUFTLFlBQVk7QUFBQTtBQUd6QyxXQUFPLGFBQWEsS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLE1BQU0sR0FBRztBQUFBO0FBQUEsRUFHekQsWUFDTixNQUNBLE9BQ3dDO0FBQ3hDLFVBQU0saUJBQWlCLEtBQUs7QUFDNUIsVUFBTSxrQkFBa0IsTUFBTSxjQUFjO0FBQzVDLFVBQU0sVUFBb0I7QUFDMUIsUUFBSSxVQUFVO0FBR2QsUUFBSSxnQkFBZ0IsV0FBVyxHQUFHO0FBQ2hDLFlBQU0sUUFBUSxJQUFJLE9BQU8sTUFBTSxzQkFBc0I7QUFDckQsVUFBSTtBQUNKLGFBQVEsU0FBUSxNQUFNLEtBQUssV0FBVyxNQUFNO0FBQzFDLGdCQUFRLEtBQUssTUFBTTtBQUNuQixrQkFBVTtBQUFBO0FBRVosYUFBTyxFQUFFLFNBQVM7QUFBQTtBQUlwQixRQUFJLE1BQU07QUFDVixXQUFRLE9BQU0sZUFBZSxRQUFRLGlCQUFpQixVQUFVLElBQUk7QUFFbEUsWUFBTSxhQUFhLE1BQU0sSUFBSSxlQUFlLE1BQU0sS0FBSztBQUN2RCxZQUFNLFlBQ0osTUFBTSxnQkFBZ0IsU0FBUyxlQUFlLFNBQzFDLGVBQWUsTUFBTSxnQkFBZ0IsVUFDckM7QUFFTixVQUNHLE1BQUssS0FBSyxlQUFlLEtBQUssS0FBSyxlQUFlLFFBQVEsTUFDMUQsTUFBSyxLQUFLLGNBQ1QsS0FBSyxLQUFLLGNBQ1YsTUFBTSxnQkFBZ0IsV0FBVyxlQUFlLFNBQ2xEO0FBRUEsa0JBQVU7QUFBQSxhQUNMO0FBRUwsa0JBQVU7QUFBQTtBQUlaLGVBQVMsSUFBSSxHQUFHLElBQUksZ0JBQWdCLFFBQVEsS0FBSztBQUMvQyxnQkFBUSxLQUFLLE1BQU07QUFBQTtBQUdyQixhQUFPO0FBQUE7QUFHVCxXQUFPLEVBQUUsU0FBUyxDQUFDLEdBQUcsSUFBSSxJQUFJLFVBQVUsS0FBSyxDQUFDLEdBQUcsTUFBTSxJQUFJLElBQUk7QUFBQTtBQUFBLEVBRzFELGNBQ0wsTUFDQSxVQUF5QixJQUN6QixhQUNrQjtBQUNsQixRQUFJLENBQUMsV0FBVyxRQUFRLFdBQVcsS0FBSyxDQUFDLGFBQWE7QUFDcEQsWUFBTSxZQUFXLFNBQVM7QUFDMUIsZ0JBQVMsY0FBYztBQUN2QixhQUFPO0FBQUE7QUFHVCxVQUFNLFdBQVcsU0FBUztBQUcxQixVQUFNLGtCQUFrQixZQUFZLGNBQWM7QUFHbEQsVUFBTSxRQUFRLElBQUksT0FBTyxJQUFJLG9CQUFvQjtBQUNqRCxRQUFJLFlBQVk7QUFDaEIsUUFBSTtBQUVKLFdBQVEsU0FBUSxNQUFNLEtBQUssV0FBVyxNQUFNO0FBRTFDLFVBQUksTUFBTSxRQUFRLFdBQVc7QUFDM0IsaUJBQVMsWUFDUCxTQUFTLGVBQWUsS0FBSyxNQUFNLFdBQVcsTUFBTTtBQUFBO0FBS3hELFlBQU0sT0FBTyxTQUFTLGNBQWM7QUFDcEMsV0FBSyxZQUFZO0FBQ2pCLFdBQUssY0FBYyxNQUFNO0FBQ3pCLGVBQVMsWUFBWTtBQUVyQixrQkFBWSxNQUFNLFFBQVEsTUFBTSxHQUFHO0FBQUE7QUFJckMsUUFBSSxZQUFZLEtBQUssUUFBUTtBQUMzQixlQUFTLFlBQVksU0FBUyxlQUFlLEtBQUssTUFBTTtBQUFBO0FBRzFELFdBQU87QUFBQTtBQUFBOzs7QUN4TEosaUNBQTJCO0FBQUEsRUFLaEMsWUFBWSxRQUE0QjtBQUN0QyxTQUFLLFNBQVM7QUFDZCxTQUFLLFNBQVM7QUFFZCxTQUFLLGlCQUFpQixLQUFLLEtBQUssT0FBTyxTQUFTO0FBQUE7QUFBQSxFQUdsRCxvQkFBeUM7QUFDdkMsV0FBTyxLQUFLO0FBQUE7QUFBQSxRQUdSLGlCQUFpQixLQUFnQyxPQUFnQjtBQUNyRSxTQUFLLGVBQWUsT0FBTztBQUUzQixTQUFLLE9BQU8sU0FBUyxzQkFBc0IsS0FBSyxLQUFLO0FBQ3JELFVBQU0sS0FBSyxPQUFPO0FBQUE7QUFBQSxRQUdkLHNCQUFzQjtBQUMxQixTQUFLLGlCQUFpQixLQUFLO0FBRTNCLFNBQUssT0FBTyxTQUFTLHNCQUFzQixLQUFLLEtBQUs7QUFDckQsVUFBTSxLQUFLLE9BQU87QUFBQTtBQUFBLEVBR3BCLFlBQVksT0FBZ0M7QUFDMUMsUUFBSTtBQUNGLFVBQUksVUFBVSxRQUFRLFVBQVUsVUFBYSxVQUFVLEtBQUs7QUFDMUQsZUFBTztBQUFBO0FBR1QsWUFBTSxlQUNKLE9BQU8sVUFBVSxXQUFXLFdBQVcsU0FBUztBQUVsRCxVQUFJLE1BQU0saUJBQWlCLGlCQUFpQixHQUFHO0FBQzdDLGVBQU87QUFBQTtBQUlULFlBQU0sa0JBQWtCLGVBQWU7QUFHdkMsYUFBTyxJQUFJLGdCQUFnQixRQUFRO0FBQUEsYUFDNUIsT0FBUDtBQUNBLFdBQUssT0FBTyxNQUFNLGdEQUFnRDtBQUFBLFFBQ2hFO0FBQUEsUUFDQTtBQUFBO0FBRUYsYUFBTztBQUFBO0FBQUE7QUFBQSxFQUlYLGNBQ0UsTUFDQSxVQUF5QixJQUN6QixhQUNrQjtBQUNsQixRQUFJLENBQUMsV0FBVyxRQUFRLFdBQVcsS0FBSyxDQUFDLGFBQWE7QUFDcEQsWUFBTSxZQUFXLFNBQVM7QUFDMUIsZ0JBQVMsY0FBYztBQUN2QixhQUFPO0FBQUE7QUFHVCxVQUFNLFdBQVcsU0FBUztBQUMxQixVQUFNLGtCQUFrQixZQUFZLGNBQWM7QUFHbEQsVUFBTSxRQUFRLElBQUksT0FBTyxJQUFJLG9CQUFvQjtBQUNqRCxRQUFJLFlBQVk7QUFDaEIsUUFBSTtBQUVKLFdBQVEsU0FBUSxNQUFNLEtBQUssV0FBVyxNQUFNO0FBRTFDLFVBQUksTUFBTSxRQUFRLFdBQVc7QUFDM0IsY0FBTSxXQUFXLFNBQVMsZUFDeEIsS0FBSyxNQUFNLFdBQVcsTUFBTTtBQUU5QixpQkFBUyxZQUFZO0FBQUE7QUFJdkIsWUFBTSxPQUFPLFNBQVMsY0FBYztBQUNwQyxXQUFLLFlBQVk7QUFDakIsV0FBSyxjQUFjLE1BQU07QUFDekIsZUFBUyxZQUFZO0FBRXJCLGtCQUFZLE1BQU0sUUFBUSxNQUFNLEdBQUc7QUFBQTtBQUdyQyxRQUFJLFlBQVksS0FBSyxRQUFRO0FBQzNCLFlBQU0sV0FBVyxTQUFTLGVBQWUsS0FBSyxNQUFNO0FBQ3BELGVBQVMsWUFBWTtBQUFBO0FBR3ZCLFdBQU87QUFBQTtBQUFBLEVBR1QsV0FBVyxRQUFrRDtBQUUzRCxVQUFNLFFBQVE7QUFBQSxNQUNaLFdBQVc7QUFBQSxNQUNYLFdBQVc7QUFBQSxNQUNYLFVBQVU7QUFBQSxNQUNWLGNBQWM7QUFBQSxNQUNkLFFBQVE7QUFBQTtBQUlWLFdBQU8sUUFBUSxDQUFDLFVBQVU7QUFFeEIsVUFBSSxNQUFNLFlBQVk7QUFDcEIsY0FBTSxVQUFVLEtBQUs7QUFDckI7QUFBQTtBQUlGLFVBQUksTUFBTSxhQUFhLFVBQVU7QUFDL0IsY0FBTSxPQUFPLEtBQUs7QUFBQSxhQUNiO0FBQUE7QUFBQTtBQUtULFdBQU8sT0FBTyxPQUFPLFFBQVEsQ0FBQyxlQUFlO0FBQzNDLGlCQUFXLEtBQUssQ0FBQyxHQUFHLE1BQU0sRUFBRSxLQUFLLGNBQWMsRUFBRTtBQUFBO0FBSW5ELFVBQU0sZUFBb0M7QUFHMUMsUUFBSSxNQUFNLFVBQVUsU0FBUyxHQUFHO0FBQzlCLG1CQUFhLEtBQUssR0FBRyxNQUFNO0FBQUE7QUFJN0IsaUJBQWEsS0FBSyxHQUFHLE1BQU07QUFDM0IsaUJBQWEsS0FBSyxHQUFHLE1BQU07QUFDM0IsaUJBQWEsS0FBSyxHQUFHLE1BQU07QUFHM0IsaUJBQWEsS0FBSyxHQUFHLE1BQU07QUFFM0IsV0FBTztBQUFBO0FBQUEsRUFHVCxhQUFhLFFBQWtEO0FBQzdELFFBQUk7QUFDRixhQUFPLE9BQU8sT0FBTyxDQUFDLFVBQVU7QUE3TXRDO0FBOE1RLFlBQUk7QUFDRixnQkFBTSxzQkFDSixhQUFNLGlCQUFOLG1CQUFvQixTQUFTLGNBQWE7QUFDNUMsZ0JBQU0seUJBQ0osYUFBTSxpQkFBTixtQkFBb0IsU0FBUyxpQkFBZ0I7QUFDL0MsZ0JBQU0sd0JBQ0osYUFBTSxpQkFBTixtQkFBb0IsU0FBUyxnQkFBZTtBQUc5QyxjQUFJLENBQUMsT0FBTyxPQUFPLEtBQUssZ0JBQWdCLEtBQUssQ0FBQyxVQUFVLFFBQVE7QUFDOUQsbUJBQU87QUFBQTtBQUlULGlCQUNHLEVBQUMsS0FBSyxlQUFlLG9CQUFvQix3QkFDekMsRUFBQyxLQUFLLGVBQWUsdUJBQ3BCLDJCQUNELEVBQUMsS0FBSyxlQUFlLHNCQUFzQjtBQUFBLGlCQUV2QyxPQUFQO0FBQ0EsZUFBSyxPQUFPLE1BQ1YsMERBQ0E7QUFBQSxZQUNFO0FBQUEsWUFDQTtBQUFBO0FBR0osaUJBQU87QUFBQTtBQUFBO0FBQUEsYUFHSixPQUFQO0FBQ0EsV0FBSyxPQUFPLE1BQU0sK0NBQStDO0FBQ2pFLGFBQU87QUFBQTtBQUFBO0FBQUE7OztBQy9PYix1QkFBNEM7QUFJckMsK0NBQXlDLHVCQUFNO0FBQUEsRUFLcEQsWUFBWSxLQUFVLFFBQTRCLFFBQW9CO0FBQ3BFLFVBQU07QUFDTixTQUFLLFNBQVM7QUFDZCxTQUFLLFNBQVM7QUFDZCxTQUFLLFNBQVM7QUFBQTtBQUFBLEVBR1IsbUJBQW1CLFVBQTBCLFdBQXdCO0FBQzNFLFVBQU0sT0FBTyxVQUFVLFVBQVU7QUFHakMsVUFBTSxTQUFTLEtBQUssVUFBVTtBQUM5QixXQUFPLFNBQVMsTUFBTTtBQUFBLE1BQ3BCLE1BQU0sU0FBUztBQUFBLE1BQ2YsS0FBSztBQUFBO0FBR1AsVUFBTSxVQUFVLE9BQU8sVUFDckI7QUFJRixVQUFNLFlBQVksUUFBUSxTQUFTLFVBQVU7QUFBQSxNQUMzQyxLQUFLO0FBQUE7QUFFUCxrQ0FBUSxXQUFXO0FBQ25CLGNBQVUsaUJBQWlCLFNBQVMsT0FBTyxNQUFNO0FBQy9DLFFBQUU7QUFHRixXQUFLLE9BQU8sU0FBUyxrQkFDbkIsS0FBSyxPQUFPLFNBQVMsZ0JBQWdCLE9BQ25DLENBQUMsTUFBTSxFQUFFLE9BQU8sU0FBUztBQUk3QixZQUFNLEtBQUssT0FBTztBQUdsQixXQUFLO0FBQUE7QUFJUCxVQUFNLFVBQVUsS0FBSyxVQUFVO0FBRy9CLFVBQU0sYUFBYSxRQUFRLFVBQ3pCO0FBRUYsa0NBQVEsV0FBVyxjQUFjO0FBQ2pDLGVBQVcsV0FBVztBQUFBLE1BQ3BCLE1BQU07QUFBQTtBQUlSLFVBQU0saUJBQWlCLFFBQVEsVUFDN0I7QUFFRixrQ0FBUSxlQUFlLGNBQWM7QUFDckMsbUJBQWUsV0FBVyxFQUFFLE1BQU0sU0FBUztBQUczQyxVQUFNLGVBQWUsUUFBUSxVQUMzQjtBQUlGLFVBQU0sa0JBQWtCLGFBQWEsVUFBVTtBQUFBLE1BQzdDLEtBQUs7QUFBQTtBQUlQLG9CQUFnQixXQUFXO0FBQUEsTUFDekIsTUFBTSxTQUFTLFlBQVksWUFBWTtBQUFBLE1BQ3ZDLEtBQUs7QUFBQTtBQUlQLFVBQU0sU0FBUyxnQkFBZ0IsVUFBVTtBQUFBLE1BQ3ZDLEtBQUssc0JBQXNCLFNBQVMsWUFBWSxlQUFlO0FBQUE7QUFJakUsV0FBTyxVQUFVLEVBQUUsS0FBSztBQUd4QixXQUFPLGlCQUFpQixTQUFTLE9BQU8sTUFBTTtBQUM1QyxRQUFFO0FBR0YsVUFBSSxTQUFTLFdBQVc7QUFDdEIsaUJBQVMsWUFBWTtBQUNyQixjQUFNLEtBQUssT0FBTztBQUNsQixhQUFLO0FBQ0w7QUFBQTtBQUlGLGFBQU8sU0FBUztBQUNoQixZQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sc0JBQXNCLGVBQ3JEO0FBRUYsYUFBTyxZQUFZO0FBRW5CLFVBQUksT0FBTyxTQUFTO0FBQ2xCLGlCQUFTLFlBQVk7QUFDckIsY0FBTSxLQUFLLE9BQU87QUFDbEIsYUFBSztBQUFBLGFBQ0E7QUFFTCxZQUFJLHdCQUNGLG9CQUFvQixTQUFTLFNBQzNCLE9BQU8sU0FBUyx1QkFFbEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU1BLHFCQUFxQjtBQUMzQixVQUFNLEVBQUUsY0FBYztBQUd0QixjQUFVO0FBQ1YsY0FBVSxTQUFTO0FBR25CLFVBQU0sU0FBUyxVQUFVLFVBQ3ZCO0FBRUYsVUFBTSxhQUFhLE9BQU8sU0FBUyxVQUFVO0FBQUEsTUFDM0MsS0FBSztBQUFBO0FBRVAsa0NBQVEsV0FBVyxjQUFjO0FBQ2pDLGVBQVcsV0FBVyxFQUFFLE1BQU07QUFFOUIsZUFBVyxpQkFBaUIsU0FBUyxNQUFNO0FBQ3pDLFdBQUs7QUFDTCxXQUFLO0FBQUE7QUFHUCxXQUFPLFNBQVMsTUFBTSxFQUFFLE1BQU07QUFHOUIsVUFBTSxVQUFVLFVBQVUsVUFDeEI7QUFFRixVQUFNLGdCQUFnQixRQUFRLFVBQzVCO0FBSUYsVUFBTSxZQUFZLEtBQUssT0FBTyxTQUFTO0FBRXZDLFFBQUksVUFBVSxXQUFXLEdBQUc7QUFFMUIsWUFBTSxhQUFhLGNBQWMsVUFDL0I7QUFFRixZQUFNLFlBQVksV0FBVyxVQUMzQjtBQUVGLG9DQUFRLFdBQVc7QUFDbkIsaUJBQVcsVUFBVTtBQUFBLFFBQ25CLEtBQUs7QUFBQSxRQUNMLE1BQU07QUFBQTtBQUFBLFdBRUg7QUFFTCxnQkFBVSxRQUFRLENBQUMsYUFBYTtBQUM5QixhQUFLLG1CQUFtQixVQUFVO0FBQUE7QUFBQTtBQUt0QyxVQUFNLFVBQVUsUUFBUSxVQUN0QjtBQUlGLFVBQU0sWUFBWSxRQUFRLFNBQVMsVUFBVTtBQUFBLE1BQzNDLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLGtDQUFRLFVBQVUsY0FBYztBQUVoQyxjQUFVLGlCQUFpQixTQUFTLE1BQU07QUFDeEMsV0FBSztBQUNMLFlBQU0sc0JBQXNCLElBQUksb0JBQzlCLEtBQUssS0FDTCxLQUFLLFFBQ0wsTUFBTTtBQUNKLGNBQU0sZUFBZSxJQUFJLDJCQUN2QixLQUFLLEtBQ0wsS0FBSyxRQUNMLEtBQUs7QUFFUCxxQkFBYTtBQUFBO0FBR2pCLDBCQUFvQjtBQUFBO0FBQUE7QUFBQSxFQUl4QixTQUFTO0FBQ1AsU0FBSztBQUFBO0FBQUEsRUFHUCxVQUFVO0FBQ1IsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUFBO0FBQUE7QUFJUCx3Q0FBa0MsdUJBQU07QUFBQSxFQUs3QyxZQUFZLEtBQVUsUUFBNEIsUUFBb0I7QUFDcEUsVUFBTTtBQUNOLFNBQUssU0FBUztBQUNkLFNBQUssU0FBUztBQUNkLFNBQUssU0FBUztBQUFBO0FBQUEsRUFHaEIsU0FBUztBQUNQLFVBQU0sRUFBRSxjQUFjO0FBQ3RCLGNBQVU7QUFDVixjQUFVLFNBQVM7QUFHbkIsVUFBTSxTQUFTLFVBQVUsVUFBVTtBQUVuQyxVQUFNLGFBQWEsT0FBTyxTQUFTLFVBQVU7QUFBQSxNQUMzQyxLQUFLO0FBQUE7QUFFUCxrQ0FBUSxXQUFXLGNBQWM7QUFDakMsZUFBVyxXQUFXLEVBQUUsTUFBTTtBQUU5QixlQUFXLGlCQUFpQixTQUFTLE1BQU07QUFDekMsV0FBSztBQUNMLFdBQUs7QUFBQTtBQUdQLFdBQU8sU0FBUyxNQUFNLEVBQUUsTUFBTTtBQUc5QixVQUFNLE9BQU8sVUFBVSxVQUFVO0FBR2pDLFVBQU0sWUFBWSxLQUFLLFVBQVU7QUFDakMsY0FBVSxTQUFTLFNBQVMsRUFBRSxNQUFNO0FBQ3BDLFVBQU0sWUFBWSxVQUFVLFNBQVMsU0FBUztBQUFBLE1BQzVDLE1BQU07QUFBQSxNQUNOLGFBQWE7QUFBQSxNQUNiLE1BQU07QUFBQSxRQUNKLFdBQVc7QUFBQTtBQUFBO0FBS2YsY0FBVSxpQkFBaUIsU0FBUyxNQUFNO0FBQ3hDLFlBQU0sUUFBUSxVQUFVO0FBR3hCLFlBQU0saUJBQWlCLE1BQ3BCLE1BQU0sS0FDTixJQUFJLENBQUMsU0FBUyxLQUFLLE9BQU8sR0FBRyxnQkFBZ0IsS0FBSyxNQUFNLElBQ3hELEtBQUs7QUFHUixVQUFJLG1CQUFtQixPQUFPO0FBQzVCLGtCQUFVLFFBQVE7QUFBQTtBQUFBO0FBS3RCLFVBQU0sV0FBVyxLQUFLLFVBQVU7QUFDaEMsYUFBUyxTQUFTLFNBQVMsRUFBRSxNQUFNO0FBR25DLFVBQU0sa0JBQWtCLFNBQVMsVUFDL0I7QUFFRixvQkFBZ0IsU0FBUyxTQUFTLEVBQUUsTUFBTTtBQUcxQyxVQUFNLGdCQUFnQixnQkFBZ0IsVUFDcEM7QUFJRixVQUFNLGVBQWUsY0FBYyxTQUFTLFVBQVU7QUFBQSxNQUNwRCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixpQkFBYSxpQkFBaUIsU0FBUyxNQUFNO0FBQzNDLGdCQUFVLFFBQVE7QUFDbEIsZUFBUyxRQUFRO0FBQ2pCLGtCQUFZLFFBQVE7QUFDcEI7QUFBQTtBQUlGLFVBQU0saUJBQWlCLGNBQWMsU0FBUyxVQUFVO0FBQUEsTUFDdEQsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBR1IsbUJBQWUsaUJBQWlCLFNBQVMsTUFBTTtBQUM3QyxnQkFBVSxRQUFRO0FBQ2xCLGVBQVMsUUFBUTtBQUNqQixrQkFBWSxRQUFRO0FBQ3BCO0FBQUE7QUFJRixVQUFNLG1CQUFtQixjQUFjLFNBQVMsVUFBVTtBQUFBLE1BQ3hELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUdSLHFCQUFpQixpQkFBaUIsU0FBUyxNQUFNO0FBQy9DLGdCQUFVLFFBQVE7QUFDbEIsZUFBUyxRQUFRO0FBQ2pCLGtCQUFZLFFBQVE7QUFDcEI7QUFBQTtBQUlGLFVBQU0sYUFBYSxjQUFjLFNBQVMsVUFBVTtBQUFBLE1BQ2xELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUdSLGVBQVcsaUJBQWlCLFNBQVMsTUFBTTtBQUN6QyxnQkFBVSxRQUFRO0FBQ2xCLGVBQVMsUUFBUTtBQUNqQixrQkFBWSxRQUFRO0FBQ3BCO0FBQUE7QUFHRixVQUFNLFdBQVcsU0FBUyxTQUFTLFNBQVM7QUFBQSxNQUMxQyxNQUFNO0FBQUEsTUFDTixhQUFhO0FBQUE7QUFJZixVQUFNLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDbEMsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBSVIsVUFBTSxzQkFBc0IsQ0FDMUIsUUFDeUM7QUFDekMsVUFBSTtBQUNGLGNBQU0sWUFBWSxJQUFJLElBQUk7QUFDMUIsY0FBTSxVQUNKLFVBQVUsYUFBYSxlQUN2QixVQUFVLGFBQWE7QUFFekIsWUFBSSxXQUFXLFVBQVUsYUFBYSxTQUFTO0FBQzdDLGlCQUFPLEVBQUUsU0FBUyxPQUFPLE9BQU87QUFBQTtBQUdsQyxZQUFJLENBQUMsV0FBVyxVQUFVLGFBQWEsVUFBVTtBQUMvQyxpQkFBTyxFQUFFLFNBQVMsT0FBTyxPQUFPO0FBQUE7QUFHbEMsWUFBSSxXQUFXLENBQUMsVUFBVSxNQUFNO0FBQzlCLGlCQUFPO0FBQUEsWUFDTCxTQUFTO0FBQUEsWUFDVCxPQUFPO0FBQUE7QUFBQTtBQUlYLGVBQU8sRUFBRSxTQUFTO0FBQUEsZUFDWixHQUFOO0FBQ0EsZUFBTyxFQUFFLFNBQVMsT0FBTyxPQUFPO0FBQUE7QUFBQTtBQUtwQyxVQUFNLGNBQWMsS0FBSyxVQUN2QjtBQUVGLGdCQUFZLFNBQVMsU0FBUyxFQUFFLE1BQU07QUFDdEMsVUFBTSxjQUFjLFlBQVksU0FBUyxTQUFTO0FBQUEsTUFDaEQsTUFBTTtBQUFBLE1BQ04sYUFBYTtBQUFBO0FBSWYsVUFBTSxrQkFBa0IsTUFBTTtBQUM1QiwyQkFBcUI7QUFDckIsbUJBQWE7QUFDYix3QkFBa0I7QUFDbEIsZUFBUyxTQUFTO0FBQ2xCLGVBQVMsWUFBWTtBQUFBO0FBSXZCLGNBQVUsaUJBQWlCLFNBQVM7QUFDcEMsYUFBUyxpQkFBaUIsU0FBUztBQUNuQyxnQkFBWSxpQkFBaUIsU0FBUztBQUd0QyxjQUFVLGlCQUFpQixTQUFTLE1BQU07QUFDeEMsWUFBTSxRQUFRLFVBQVU7QUFHeEIsWUFBTSxpQkFBaUIsTUFDcEIsTUFBTSxLQUNOLElBQUksQ0FBQyxTQUFTLEtBQUssT0FBTyxHQUFHLGdCQUFnQixLQUFLLE1BQU0sSUFDeEQsS0FBSztBQUdSLFVBQUksbUJBQW1CLE9BQU87QUFDNUIsa0JBQVUsUUFBUTtBQUFBO0FBQUE7QUFLdEIsVUFBTSxjQUFjLEtBQUssVUFDdkI7QUFJRixVQUFNLGVBQWUsWUFBWSxTQUFTLFVBQVU7QUFBQSxNQUNsRCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixpQkFBYSxpQkFBaUIsU0FBUyxNQUFNO0FBQzNDLFdBQUs7QUFDTCxXQUFLO0FBQUE7QUFJUCxVQUFNLGVBQWUsWUFBWSxTQUFTLFVBQVU7QUFBQSxNQUNsRCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixRQUFJLHFCQUFxQjtBQUN6QixRQUFJLGFBQTZEO0FBR2pFLFVBQU0seUJBQXlCLE1BQXVCO0FBQUEsTUFDcEQsSUFBSSxPQUFPO0FBQUEsTUFDWCxNQUFNLFVBQVUsTUFBTTtBQUFBLE1BQ3RCLFVBQVUsU0FBUyxNQUFNO0FBQUEsTUFDekIsUUFBUSxZQUFZLE1BQU07QUFBQSxNQUMxQixXQUFXO0FBQUEsTUFDWCxZQUFZLEtBQUs7QUFBQTtBQUluQixVQUFNLG9CQUFvQixDQUN4QixVQUNHO0FBQ0gsY0FBUTtBQUFBLGFBQ0Q7QUFDSCx1QkFBYSxRQUFRO0FBQ3JCLHVCQUFhLGdCQUFnQjtBQUM3QjtBQUFBLGFBQ0c7QUFDSCx1QkFBYSxRQUFRO0FBQ3JCLHVCQUFhLGFBQWEsWUFBWTtBQUN0QztBQUFBLGFBQ0c7QUFDSCx1QkFBYSxRQUFRO0FBQ3JCLHVCQUFhLGdCQUFnQjtBQUM3QjtBQUFBLGFBQ0c7QUFDSCx1QkFBYSxRQUFRO0FBQ3JCLHVCQUFhLGdCQUFnQjtBQUM3QjtBQUFBO0FBQUE7QUFLTixVQUFNLGVBQWUsTUFBNEM7QUFFL0QsVUFBSSxDQUFDLFVBQVUsTUFBTSxRQUFRO0FBQzNCLGVBQU8sRUFBRSxTQUFTLE9BQU8sT0FBTztBQUFBO0FBSWxDLFlBQU0sZ0JBQWdCLG9CQUFvQixTQUFTO0FBQ25ELFVBQUksQ0FBQyxjQUFjLFNBQVM7QUFDMUIsZUFBTztBQUFBO0FBSVQsWUFBTSxVQUNKLFNBQVMsTUFBTSxTQUFTLGdCQUN4QixTQUFTLE1BQU0sU0FBUztBQUMxQixVQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksTUFBTSxRQUFRO0FBQ3pDLGVBQU87QUFBQSxVQUNMLFNBQVM7QUFBQSxVQUNULE9BQU87QUFBQTtBQUFBO0FBSVgsYUFBTyxFQUFFLFNBQVM7QUFBQTtBQUlwQixpQkFBYSxpQkFBaUIsU0FBUyxZQUFZO0FBM2dCdkQ7QUE0Z0JNLFlBQU0sYUFBYTtBQUVuQixVQUFJLENBQUMsV0FBVyxTQUFTO0FBRXZCLGlCQUFTLGNBQWMsV0FBVyxTQUFTO0FBQzNDLGlCQUFTLFlBQVk7QUFDckI7QUFBQTtBQUdGLFVBQUksQ0FBQyxvQkFBb0I7QUFFdkIsMEJBQWtCO0FBRWxCLGNBQU0sV0FBVztBQUNqQixjQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sc0JBQXNCLGVBQ3JEO0FBR0YsWUFBSSxPQUFPLFNBQVM7QUFDbEIsK0JBQXFCO0FBQ3JCLDRCQUFrQjtBQUNsQix1QkFBYTtBQUdiLG1CQUFTLGNBQWMsZ0NBQ3JCLGNBQU8sV0FBUCxtQkFBZSxXQUFVO0FBRTNCLG1CQUFTLFlBQVk7QUFDckIsbUJBQVMsU0FBUztBQUFBLGVBQ2I7QUFDTCw0QkFBa0I7QUFHbEIsbUJBQVMsY0FBYyxPQUFPLFNBQVM7QUFDdkMsbUJBQVMsWUFBWTtBQUNyQixtQkFBUyxZQUFZO0FBQUE7QUFBQSxhQUVsQjtBQUVMLGNBQU0sV0FBVztBQUdqQixhQUFLLE9BQU8sU0FBUyxrQkFBa0I7QUFBQSxVQUNyQyxHQUFHLEtBQUssT0FBTyxTQUFTO0FBQUEsVUFDeEI7QUFBQTtBQUlGLGNBQU0sS0FBSyxPQUFPO0FBR2xCLGFBQUs7QUFDTCxhQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLWCxVQUFVO0FBQ1IsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUFBO0FBQUE7OztBSDNqQlAsd0NBQWtDLHVCQUFNO0FBQUEsRUFjN0MsWUFDRSxLQUNBLGdCQUNBLFVBQ0EsUUFDQTtBQUNBLFVBQU07QUFuQkEscUJBQWlDO0FBTWpDLDZCQUE0QjtBQUM1QixzQkFBNEI7QUFHNUIscUJBQXFCO0FBdUVyQiwrQkFBc0IsQ0FDNUIsVUFDc0I7QUFDdEIsYUFBTztBQUFBLFFBQ0wsRUFBRSxPQUFPLFFBQVEsTUFBTSxNQUFNLE1BQU0sUUFBUTtBQUFBLFFBQzNDLEdBQUcsTUFBTSxLQUFLLE1BQU0sY0FBYyxJQUFJLENBQUMsU0FBVTtBQUFBLFVBQy9DLE9BQU87QUFBQSxVQUNQLE1BQU07QUFBQSxVQUNOLFFBQVE7QUFBQTtBQUFBLFFBRVYsR0FBSSxNQUFNLGFBQWEsV0FDbkIsQ0FBQyxFQUFFLE9BQU8sWUFBWSxNQUFNLE1BQU0sR0FBRyxNQUFNLEtBQUssSUFBSSxRQUFRLFNBQzVEO0FBQUEsUUFDSixFQUFFLE9BQU8sZUFBZSxNQUFNLE1BQU0sZUFBZSxJQUFJLFFBQVE7QUFBQTtBQUFBO0FBMUVqRSxTQUFLLGtCQUFrQjtBQUN2QixTQUFLLFdBQVc7QUFDaEIsU0FBSyxTQUFTO0FBQ2QsU0FBSyxTQUFTO0FBQ2QsU0FBSyxTQUFTLElBQUkscUJBQXFCO0FBQ3ZDLFNBQUssZ0JBQWdCLElBQUk7QUFBQTtBQUFBLFFBR3JCLFNBQVM7QUFDYixRQUFJO0FBQ0YsWUFBTSxFQUFFLGNBQWM7QUFDdEIsZ0JBQVU7QUFDVixnQkFBVSxTQUFTO0FBR25CLFdBQUs7QUFDTCxXQUFLO0FBQ0wsV0FBSztBQUdMLFdBQUssWUFBWSxNQUFNLEtBQUssT0FBTztBQUduQyxXQUFLLGFBQWEsS0FBSztBQUFBLGFBQ2hCLE9BQVA7QUFDQSxXQUFLLE9BQU8sTUFBTSx3Q0FBd0M7QUFDMUQsV0FBSyxVQUFVLFVBQVU7QUFBQSxRQUN2QixLQUFLO0FBQUEsUUFDTCxNQUFNO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLSixtQkFBc0Q7QUFFNUQsUUFBSSxDQUFDLEtBQUssZUFBZSxDQUFDLEtBQUssWUFBWSxNQUFNLFFBQVE7QUFDdkQsYUFBTyxLQUFLLFVBQVUsSUFBSSxDQUFDLE1BQU8sR0FBRSxNQUFNLEdBQUcsU0FBUyxJQUFJLE9BQU87QUFBQTtBQUduRSxVQUFNLFFBQVEsS0FBSyxZQUFZLE1BQU07QUFHckMsVUFBTSxVQUFVLEtBQUssY0FBYyxPQUNqQyxLQUFLLFdBQ0wsT0FDQSxDQUFDLFVBQVUsS0FBSyxvQkFBb0IsUUFDcEM7QUFBQSxNQUNFLHFCQUFxQjtBQUFBLE1BQ3JCLG9CQUFvQjtBQUFBO0FBS3hCLFVBQU0sa0JBQWtCLFFBQVEsT0FDOUIsQ0FBQyxXQUFXLE9BQU8sUUFBUSxTQUFTLEtBQUssT0FBTyxRQUFRO0FBSTFELFdBQU8sZ0JBQWdCLEtBQUssQ0FBQyxHQUFHLE1BQU0sRUFBRSxRQUFRLEVBQUU7QUFBQTtBQUFBLEVBb0I1QyxpQkFBaUI7QUFDdkIsVUFBTSxrQkFBa0IsS0FBSyxVQUFVLFVBQVU7QUFBQSxNQUMvQyxLQUFLO0FBQUE7QUFJUCxTQUFLLGNBQWMsZ0JBQWdCLFNBQVMsU0FBUztBQUFBLE1BQ25ELE1BQU07QUFBQSxNQUNOLGFBQWE7QUFBQSxNQUNiLEtBQUs7QUFBQTtBQUlQLFVBQU0sa0JBQWtCLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxNQUN6RCxLQUFLO0FBQUE7QUFFUCxrQ0FBUSxnQkFBZ0IsY0FBYztBQUN0QyxvQkFBZ0IsV0FBVyxFQUFFLE1BQU07QUFFbkMsb0JBQWdCLGlCQUFpQixTQUFTLENBQUMsTUFBTTtBQUMvQyxRQUFFO0FBQ0YsV0FBSztBQUdMLFlBQU0sZUFBZSxJQUFJLDJCQUN2QixLQUFLLEtBQ0wsS0FBSyxRQUNMLE1BQU07QUFFSixjQUFNLHNCQUFzQixJQUFJLG9CQUM5QixLQUFLLEtBQ0wsS0FBSyxpQkFDTCxLQUFLLFVBQ0wsS0FBSztBQUVQLDRCQUFvQjtBQUFBO0FBR3hCLG1CQUFhO0FBQUE7QUFBQTtBQUFBLEVBSVQsa0JBQWtCO0FBQ3hCLFNBQUssWUFBWSxLQUFLLFVBQVUsVUFBVTtBQUFBLE1BQ3hDLEtBQUs7QUFBQTtBQUFBO0FBQUEsRUFJRCxjQUFjO0FBL0p4QjtBQWdLSSxTQUFLLFlBQVksaUJBQWlCLFNBQVMsTUFBTTtBQUMvQyxZQUFNLFVBQVUsS0FBSztBQUNyQixXQUFLLGFBQWE7QUFBQTtBQUlwQixTQUFLLFVBQVUsaUJBQWlCLFdBQVcsQ0FBQyxNQUFxQjtBQUMvRCxVQUFJLEVBQUUsUUFBUSxPQUFPO0FBQ25CLFVBQUU7QUFDRixZQUFJLEVBQUUsVUFBVTtBQUNkLGVBQUssb0JBQ0gsS0FBSyxxQkFBcUIsSUFDdEIsS0FBSyxXQUFXLFNBQVMsSUFDekIsS0FBSyxvQkFBb0I7QUFBQSxlQUMxQjtBQUNMLGVBQUssb0JBQ0gsS0FBSyxxQkFBcUIsS0FBSyxXQUFXLFNBQVMsSUFDL0MsSUFDQSxLQUFLLG9CQUFvQjtBQUFBO0FBRWpDLGFBQUssV0FBVyxRQUFRLENBQUMsTUFBTSxNQUFNO0FBQ25DLGdCQUFNLGFBQWEsTUFBTSxLQUFLO0FBQzlCLGVBQUssVUFBVSxPQUFPLGtDQUFrQztBQUN4RCxjQUFJLFlBQVk7QUFDZCxpQkFBSyxlQUFlLEVBQUUsVUFBVSxVQUFVLE9BQU87QUFBQTtBQUFBO0FBR3JELGFBQUssWUFBWTtBQUFBLGlCQUNSLEVBQUUsUUFBUSxTQUFTO0FBQzVCLGNBQU0sa0JBQWtCLEtBQUssV0FBVyxLQUFLO0FBQzdDLFlBQUksaUJBQWlCO0FBQ25CLFlBQUU7QUFDRixnQkFBTSxVQUFVLGdCQUFnQixRQUFRO0FBQ3hDLGNBQUksU0FBUztBQUNYLGlCQUFLLFNBQVM7QUFDZCxpQkFBSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBT2IsZUFBSyxjQUFMLG1CQUFnQixpQkFDZCxTQUNBLE1BQU07QUFBQSxPQUdOLEVBQUUsU0FBUztBQUViLGVBQUssY0FBTCxtQkFBZ0IsaUJBQWlCLGNBQWMsTUFBTTtBQUFBLE9BQUksRUFBRSxTQUFTO0FBQ3BFLGVBQUssY0FBTCxtQkFBZ0IsaUJBQWlCLGFBQWEsTUFBTTtBQUFBLE9BQUksRUFBRSxTQUFTO0FBQUE7QUFBQSxFQVE3RCxhQUFhLGVBQWtEO0FBQ3JFLFFBQUksQ0FBQyxLQUFLO0FBQVc7QUFFckIsU0FBSyxVQUFVO0FBQ2YsU0FBSyxhQUFhO0FBR2xCLFVBQU0sUUFBUSxJQUFJLElBQ2hCLGNBQWMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssSUFBSSxHQUFHLFdBQVc7QUFJdkQsVUFBTSxZQUFpQztBQUN2QyxVQUFNLGVBQW9DO0FBRzFDLFVBQU0sZ0JBQWdCLGNBQWMsSUFBSSxDQUFDLE9BQU8sR0FBRztBQUNuRCxrQkFBYyxRQUFRLENBQUMsVUFBVTtBQUMvQixVQUFJLE1BQU0sWUFBWTtBQUNwQixrQkFBVSxLQUFLO0FBQUEsYUFDVjtBQUNMLHFCQUFhLEtBQUs7QUFBQTtBQUFBO0FBS3RCLFFBQUksVUFBVSxTQUFTLEdBQUc7QUFFeEIsWUFBTSxTQUFTLEtBQUssVUFBVSxVQUFVO0FBQUEsUUFDdEMsS0FBSztBQUFBO0FBRVAsYUFBTyxXQUFXLEVBQUUsTUFBTTtBQUcxQixnQkFBVSxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsS0FBSyxjQUFjLEVBQUU7QUFHaEQsZ0JBQVUsUUFBUSxDQUFDLFVBQVU7QUFDM0IsY0FBTSxVQUFVLE1BQU0sSUFBSSxNQUFNLE9BQU87QUFDdkMsY0FBTSxPQUFPLEtBQUssZ0JBQWdCLE9BQU87QUFDekMsWUFBSSxNQUFNO0FBQ1IsZUFBSyxVQUFVLFlBQVk7QUFDM0IsZUFBSyxXQUFXLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFNM0IsVUFBTSxtQkFBbUIsSUFBSTtBQUM3QixpQkFBYSxRQUFRLENBQUMsVUFBVTtBQTNRcEM7QUE0UU0sWUFBTSxXQUFXLE1BQU07QUFDdkIsVUFBSSxDQUFDLGlCQUFpQixJQUFJLFdBQVc7QUFDbkMseUJBQWlCLElBQUksVUFBVTtBQUFBO0FBRWpDLDZCQUFpQixJQUFJLGNBQXJCLG1CQUFnQyxLQUFLO0FBQUE7QUFJdkMsVUFBTSxrQkFBa0IsTUFBTSxLQUFLLGlCQUFpQixRQUFRLEtBQUssQ0FBQyxHQUFHLE1BQU07QUFDekUsVUFBSSxNQUFNO0FBQWdCLGVBQU87QUFDakMsVUFBSSxNQUFNO0FBQWdCLGVBQU87QUFDakMsYUFBTyxFQUFFLGNBQWM7QUFBQTtBQUl6QixvQkFBZ0IsUUFBUSxDQUFDLGFBQWE7QUFDcEMsWUFBTSxTQUFTLGlCQUFpQixJQUFJLGFBQWE7QUFHakQsVUFBSSxPQUFPLFdBQVc7QUFBRztBQUd6QixZQUFNLGVBQWUsT0FBTyxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsS0FBSyxjQUFjLEVBQUU7QUFHbEUsWUFBTSxTQUFTLEtBQUssVUFBVSxVQUFVO0FBQUEsUUFDdEMsS0FBSztBQUFBO0FBRVAsWUFBTSxlQUNKLGFBQWEsaUJBQ1Qsd0JBQ0EsR0FBRyxTQUFTLE9BQU8sR0FBRyxnQkFBZ0IsU0FBUyxNQUFNO0FBQzNELGFBQU8sV0FBVyxFQUFFLE1BQU07QUFHMUIsbUJBQWEsUUFBUSxDQUFDLFVBQVU7QUFDOUIsY0FBTSxVQUFVLE1BQU0sSUFBSSxNQUFNLE9BQU87QUFDdkMsY0FBTSxPQUFPLEtBQUssZ0JBQWdCLE9BQU87QUFDekMsWUFBSSxNQUFNO0FBQ1IsZUFBSyxVQUFVLFlBQVk7QUFDM0IsZUFBSyxXQUFXLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFNM0IsUUFBSSxLQUFLLFdBQVcsV0FBVyxHQUFHO0FBQ2hDLFlBQU0sZ0JBQWdCLEtBQUs7QUFDM0IsV0FBSyxVQUFVLFlBQVk7QUFBQTtBQUFBO0FBQUEsRUFJdkIsc0JBQW1DO0FBQ3pDLFVBQU0sT0FBTyxVQUFVLEVBQUUsS0FBSztBQUU5QixVQUFNLGlCQUFpQixLQUFLLFVBQVUsRUFBRSxLQUFLO0FBQzdDLFVBQU0sYUFBYSxlQUFlLFVBQVU7QUFBQSxNQUMxQyxLQUFLO0FBQUE7QUFFUCxrQ0FBUSxZQUFZO0FBRXBCLFVBQU0sZ0JBQWdCLEtBQUssVUFBVTtBQUFBLE1BQ25DLEtBQUs7QUFBQTtBQUVQLGtCQUFjLFVBQVU7QUFBQSxNQUN0QixLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixVQUFNLGNBQWMsS0FBSyxVQUFVO0FBQUEsTUFDakMsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBR1IsU0FBSyxVQUFVLEVBQUUsS0FBSztBQUV0QixTQUFLLGlCQUFpQixTQUFTLE1BQU07QUFDbkMsVUFBSSxLQUFLLGFBQWE7QUFDcEIsYUFBSyxZQUFZLFFBQVE7QUFBQTtBQUUzQixXQUFLLGFBQ0gsS0FBSyxVQUFVLElBQUksQ0FBQyxNQUFPLEdBQUUsTUFBTSxHQUFHLFNBQVMsSUFBSSxPQUFPO0FBQUE7QUFJOUQsV0FBTztBQUFBO0FBQUEsRUFHRCxnQkFDTixPQUNBLFVBQXlCLElBQ1o7QUF2V2pCO0FBd1dJLFVBQU0sT0FBTyxTQUFTLGNBQWM7QUFDcEMsU0FBSyxZQUFZO0FBQ2pCLFFBQUksTUFBTSxhQUFhLGdCQUFnQjtBQUNyQyxXQUFLLFVBQVUsSUFBSTtBQUFBO0FBRXJCLFNBQUssYUFBYSxZQUFZO0FBQzlCLFNBQUssUUFBUSxVQUFVLE1BQU07QUFHN0IsVUFBTSxpQkFBaUIsS0FBSyxVQUFVO0FBQUEsTUFDcEMsS0FBSyxnQ0FDSCxNQUFNLGFBQWEsZ0JBQWdCO0FBQUEsTUFFckMsTUFBTTtBQUFBLFFBQ0osY0FBYyxNQUFNLGFBQ2hCLDBCQUNBO0FBQUEsUUFDSixNQUFNO0FBQUE7QUFBQTtBQUdWLGtDQUFRLGdCQUFnQjtBQUd4QixtQkFBZSxpQkFBaUIsU0FBUyxPQUFPLE1BQU07QUFDcEQsUUFBRTtBQUNGLFlBQU0sYUFBYSxDQUFDLE1BQU07QUFDMUIsWUFBTSxhQUFhO0FBRW5CLHFCQUFlLFVBQVUsT0FBTyxlQUFlO0FBQy9DLHFCQUFlLGFBQ2IsY0FDQSxhQUFhLDBCQUEwQjtBQUl6QyxVQUFJLENBQUMsTUFBTSxRQUFRLEtBQUssT0FBTyxTQUFTLGlCQUFpQjtBQUN2RCxhQUFLLE9BQU8sU0FBUyxpQkFBaUI7QUFBQTtBQUl4QyxVQUFJLFlBQVk7QUFDZCxjQUFNLFNBQVMsRUFBRSxVQUFVLE1BQU0sVUFBVSxTQUFTLE1BQU07QUFDMUQsWUFDRSxDQUFDLEtBQUssT0FBTyxTQUFTLGVBQWUsS0FDbkMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxNQUFNLE1BQU0sRUFBRSxhQUFhLE1BQU0sV0FFeEQ7QUFDQSxlQUFLLE9BQU8sU0FBUyxlQUFlLEtBQUs7QUFBQTtBQUFBLGFBRXRDO0FBQ0wsYUFBSyxPQUFPLFNBQVMsaUJBQ25CLEtBQUssT0FBTyxTQUFTLGVBQWUsT0FDbEMsQ0FBQyxNQUFNLENBQUUsR0FBRSxZQUFZLE1BQU0sTUFBTSxFQUFFLGFBQWEsTUFBTTtBQUFBO0FBRzlELFlBQU0sS0FBSyxPQUFPO0FBR2xCLFdBQUssYUFBYSxLQUFLO0FBQUE7QUFJekIsUUFBSSxNQUFNLGFBQWEsZ0JBQWdCO0FBRXJDLFlBQU0sZ0JBQWdCLEtBQUssVUFBVTtBQUFBLFFBQ25DLEtBQUs7QUFBQTtBQUdQLFlBQU0sWUFBWSxjQUFjLFVBQVU7QUFBQSxRQUN4QyxLQUFLO0FBQUE7QUFFUCxZQUFNLGNBQWMsUUFBUSxPQUFPLENBQUMsTUFBTSxFQUFFLFVBQVU7QUFDdEQsZ0JBQVUsT0FDUixLQUFLLE9BQU8sY0FDVixNQUFNLE1BQ04sYUFDQSxXQUFLLGdCQUFMLG1CQUFrQjtBQUFBLFdBR2pCO0FBRUwsWUFBTSxpQkFBaUIsS0FBSyxVQUFVO0FBQUEsUUFDcEMsS0FBSztBQUFBO0FBSVAsWUFBTSxrQkFBa0IsV0FBVyxNQUFNLFFBQVEsY0FBYztBQUMvRCxZQUFNLG1CQUFtQixlQUFlLFVBQVU7QUFBQSxRQUNoRCxLQUFLO0FBQUEsUUFDTCxNQUFNO0FBQUEsVUFDSixjQUFjLFlBQVksZ0JBQWdCLFFBQ3hDO0FBQUE7QUFBQTtBQUlOLG9DQUFRLGtCQUFrQjtBQUcxQixVQUFJLFlBQU0saUJBQU4sbUJBQW9CLFNBQVMsU0FBUztBQUN4QyxjQUFNLGlCQUFpQixlQUFlLFVBQVU7QUFBQSxVQUM5QyxLQUFLO0FBQUEsVUFDTCxNQUFNLEVBQUUsY0FBYztBQUFBO0FBRXhCLHNDQUFRLGdCQUFnQjtBQUFBO0FBRTFCLFVBQUksWUFBTSxpQkFBTixtQkFBb0IsU0FBUyxjQUFjO0FBQzdDLGNBQU0sa0JBQWtCLGVBQWUsVUFBVTtBQUFBLFVBQy9DLEtBQUs7QUFBQSxVQUNMLE1BQU0sRUFBRSxjQUFjO0FBQUE7QUFFeEIsc0NBQVEsaUJBQWlCO0FBQUE7QUFFM0IsVUFBSSxZQUFNLGlCQUFOLG1CQUFvQixTQUFTLGFBQWE7QUFDNUMsY0FBTSxvQkFBb0IsZUFBZSxVQUFVO0FBQUEsVUFDakQsS0FBSztBQUFBLFVBQ0wsTUFBTSxFQUFFLGNBQWM7QUFBQTtBQUV4QixzQ0FBUSxtQkFBbUI7QUFBQTtBQUU3QixVQUFJLGFBQU0saUJBQU4sbUJBQW9CLGNBQWEsb0JBQW9CO0FBQ3ZELGNBQU0sa0JBQWtCLGVBQWUsVUFBVTtBQUFBLFVBQy9DLEtBQUs7QUFBQSxVQUNMLE1BQU0sRUFBRSxjQUFjO0FBQUE7QUFFeEIsc0NBQVEsaUJBQWlCO0FBQUE7QUFHM0IsWUFBTSxnQkFBZ0IsS0FBSyxVQUFVO0FBQUEsUUFDbkMsS0FBSztBQUFBO0FBRVAsWUFBTSxZQUFZLGNBQWMsVUFBVTtBQUFBLFFBQ3hDLEtBQUs7QUFBQTtBQUVQLGdCQUFVLE9BQ1IsS0FBSyxPQUFPLGNBQWMsTUFBTSxNQUFNLFNBQVMsV0FBSyxnQkFBTCxtQkFBa0I7QUFHbkUsWUFBTSxjQUFjLEtBQUssVUFBVTtBQUFBLFFBQ2pDLEtBQUs7QUFBQTtBQUVQLGtCQUFZLE9BQ1YsS0FBSyxPQUFPLGNBQ1YsTUFBTSxhQUNOLFNBQ0EsV0FBSyxnQkFBTCxtQkFBa0I7QUFHdEIsa0JBQVksYUFBYSxjQUFjLE1BQU07QUFDN0Msa0JBQVksU0FBUztBQUVyQixZQUFNLFVBQVUsS0FBSyxVQUFVLEVBQUUsS0FBSztBQUN0QyxZQUFNLGdCQUFnQixRQUFRLFVBQVU7QUFBQSxRQUN0QyxLQUFLO0FBQUE7QUFFUCxvQkFBYyxXQUFXO0FBQUEsUUFDdkIsTUFBTTtBQUFBLFFBQ04sS0FBSztBQUFBO0FBRVAsb0JBQWMsV0FBVztBQUFBLFFBQ3ZCLE1BQU0sR0FBRyxNQUFNLGVBQWU7QUFBQSxRQUM5QixLQUFLO0FBQUE7QUFBQTtBQUtULFNBQUssaUJBQWlCLFNBQVMsWUFBWTtBQUV6QyxZQUFNLGlCQUFpQixLQUFLLE9BQU8sU0FBUyxnQkFBZ0IsS0FDMUQsQ0FBQyxNQUFNLEVBQUUsS0FBSyxrQkFBa0IsTUFBTSxTQUFTO0FBRWpELFVBQUksZ0JBQWdCO0FBQ2xCLGFBQUssT0FBTyxTQUFTLGlCQUFpQjtBQUFBLFVBQ3BDLElBQUksZUFBZTtBQUFBLFVBQ25CLE1BQU0sZUFBZTtBQUFBLFVBQ3JCLE1BQU07QUFBQTtBQUFBLGFBRUg7QUFDTCxhQUFLLE9BQU8sU0FBUyxpQkFBaUI7QUFBQSxVQUNwQyxJQUFJO0FBQUEsVUFDSixNQUFNO0FBQUEsVUFDTixNQUFNO0FBQUE7QUFBQTtBQUdWLFlBQU0sS0FBSyxPQUFPO0FBQ2xCLFdBQUssU0FBUyxNQUFNO0FBQ3BCLFdBQUs7QUFBQTtBQUlQLFNBQUssaUJBQWlCLFdBQVcsQ0FBQyxNQUFxQjtBQUNyRCxVQUFJLEVBQUUsUUFBUSxTQUFTO0FBQ3JCLFVBQUU7QUFDRixhQUFLLFNBQVMsTUFBTTtBQUNwQixhQUFLO0FBQUE7QUFBQTtBQUlULFNBQUssaUJBQWlCLFNBQVMsTUFBTTtBQUNuQyxXQUFLLFdBQVcsUUFBUSxDQUFDLE1BQ3ZCLEVBQUUsVUFBVSxPQUFPO0FBRXJCLFdBQUssVUFBVSxJQUFJO0FBQ25CLFdBQUssWUFBWTtBQUFBO0FBR25CLFdBQU87QUFBQTtBQUFBLEVBR1QsVUFBVTtBQUNSLFNBQUssWUFBWTtBQUNqQixTQUFLLFVBQVU7QUFBQTtBQUFBLEVBTVYsVUFBVSxRQUFtQztBQUNsRCxRQUFJLENBQUMsTUFBTSxRQUFRLFNBQVM7QUFDMUIsV0FBSyxPQUFPLE1BQU0sdUJBQXVCLEVBQUU7QUFDM0M7QUFBQTtBQUVGLFNBQUssWUFBWTtBQUNqQixRQUFJLEtBQUssV0FBVztBQUNsQixXQUFLLGFBQWEsS0FBSztBQUFBO0FBQUE7QUFBQTs7O0FJdmtCN0IsdUJBQW1EO0FBRTVDLG9DQUE4QixzQ0FBNkI7QUFBQSxFQUdoRSxZQUNVLFNBQ0EsWUFDUixLQUNBO0FBQ0EsVUFBTSxLQUFLO0FBSkg7QUFDQTtBQUlSLFNBQUssVUFBVSxxQkFBcUI7QUFBQTtBQUFBLEVBR3RDLGVBQWUsVUFBNEI7QUFDekMsVUFBTSxvQkFBb0IsU0FBUztBQUNuQyxXQUFPLENBQUMsR0FBRyxLQUFLLFNBQVMsT0FBTyxDQUFDLFlBQy9CLFFBQVEsY0FBYyxTQUFTO0FBQUE7QUFBQSxFQUluQyxpQkFBaUIsU0FBaUIsSUFBdUI7QUFDdkQsT0FBRyxRQUFRO0FBQUE7QUFBQSxFQUdiLGlCQUFpQixTQUFpQixLQUF1QztBQUN2RSxTQUFLLFdBQVc7QUFDaEIsU0FBSyxRQUFRLFFBQVE7QUFDckIsU0FBSyxRQUFRO0FBQ2IsU0FBSztBQUFBO0FBQUE7QUFJRiw4QkFBOEIsS0FBdUI7QUFDMUQsUUFBTSxVQUFVLElBQUksTUFDakIsb0JBQ0EsT0FBTyxDQUFDLFNBQVMsZ0JBQWdCO0FBQ3BDLFNBQU8sSUFBSSxJQUFJLFFBQVEsSUFBSSxDQUFDLFdBQVcsT0FBTztBQUFBO0FBR3pDLCtCQUNMLFNBQ0EsVUFDQSxLQUNpQjtBQUNqQixTQUFPLElBQUksZ0JBQWdCLFNBQVMsVUFBVTtBQUFBOzs7QUM3Q2hELHVCQUEyQztBQUMzQztBQUVBO0FBQ0E7QUFFQSwwQkFBMEIsTUFBc0I7QUFDOUMsU0FBTyxLQUFLLFFBQVEsb0JBQW9CLElBQUksUUFBUSxNQUFNO0FBQUE7QUFHNUQsNkJBQTZCLFdBQW1CLFVBQTBCO0FBQ3hFLFNBQU8sR0FBRyxhQUFhO0FBQUE7QUFzQmxCLHNDQUFnQyx1QkFBTTtBQUFBLEVBZTNDLFlBQ0UsS0FDUSxlQUNSLFNBQ0E7QUFDQSxVQUFNO0FBSEU7QUFoQkYsa0JBQW9DO0FBT3BDLHlCQUFzQztBQUt0Qyx3QkFBOEI7QUE5Q3hDO0FBc0RJLFNBQUssUUFBUSxTQUFTLHNCQUFzQjtBQUM1QyxTQUFLLFVBQVU7QUFBQSxTQUNWO0FBQUEsTUFDSCx3QkFDRSxjQUFRLDJCQUFSLFlBQWtDO0FBQUE7QUFFdEMsU0FBSyxzQkFBc0IsSUFBSSxvQkFBb0I7QUFBQTtBQUFBLEVBRzdDLFlBQVksTUFBZTtBQUNqQyxRQUFJLENBQUMsS0FBSyxvQkFBb0IsQ0FBQyxLQUFLO0FBQWtCO0FBRXRELFNBQUssaUJBQWlCLE1BQU0sVUFBVSxPQUFPLFNBQVM7QUFDdEQsU0FBSyxpQkFBaUIsTUFBTSxVQUFVLE9BQU8sU0FBUztBQUFBO0FBQUEsUUFHbEQsb0JBQW9CO0FBQ3hCLFFBQUk7QUFDRixXQUFLLFlBQVk7QUFDakIsV0FBSyxnQkFBZ0IsTUFBTSxLQUFLLG9CQUFvQjtBQUdwRCxXQUFLO0FBRUwsV0FBSyxZQUFZO0FBQUEsYUFDVixPQUFQO0FBQ0EsY0FBUSxNQUFNLGtDQUFrQztBQUNoRCxXQUFLLFlBQVk7QUFDakIsWUFBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsUUFDNUIsT0FBTztBQUFBLFFBQ1AsYUFBYTtBQUFBLFFBQ2IsZUFBZTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS2Isc0JBQXNCO0FBQzVCLFFBQUksQ0FBQyxLQUFLO0FBQXVCO0FBR2pDLFNBQUssc0JBQXNCO0FBRzNCLFNBQUssY0FBYyxRQUFRLENBQUMsV0FBVztBQUNyQyxVQUFJLE9BQU8saUJBQWlCLEtBQUssZUFBZTtBQUM5QyxhQUFLLGVBQWUsT0FBTztBQUFBO0FBQUE7QUFLL0IsUUFBSSxDQUFDLEtBQUssZ0JBQWdCLEtBQUssZUFBZTtBQUU1QyxZQUFNLG1CQUFtQixLQUFLLGNBQWMsS0FDMUMsQ0FBQyxNQUFNLEVBQUUsT0FBTztBQUVsQixVQUNFLG9CQUNBLGlCQUFpQixhQUFhLFdBQVcsS0FBSyxjQUFjLFFBQzVEO0FBQ0EsYUFBSyxlQUFlLGlCQUFpQjtBQUFBLGFBQ2hDO0FBRUwsYUFBSyxlQUFlO0FBQ3BCLFlBQUksS0FBSyxZQUFZLGtCQUFrQjtBQUNyQyxlQUFLLFNBQVMsUUFBUSxpQkFBaUI7QUFBQTtBQUFBO0FBQUE7QUFNN0MsVUFBTSxnQkFBZ0I7QUFBQSxNQUNwQixHQUFHLEtBQUs7QUFBQSxNQUVSLEdBQUksQ0FBQyxLQUFLLGNBQWMsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLFlBQ3pDO0FBQUEsUUFDRTtBQUFBLFVBQ0UsSUFBSTtBQUFBLFVBQ0osT0FBTztBQUFBLFVBQ1Asb0JBQW9CO0FBQUEsVUFDcEIsY0FBYztBQUFBO0FBQUEsVUFHbEI7QUFBQSxNQUNKLElBQUksQ0FBQyxXQUFXO0FBQ2hCLFlBQU0sU0FBUyxLQUFLLHNCQUFzQixTQUFTLFVBQVU7QUFBQSxRQUMzRCxNQUFNLE9BQU87QUFBQSxRQUNiLEtBQUs7QUFBQTtBQUlQLFVBQUksT0FBTyxVQUFVLEtBQUssY0FBYztBQUN0QyxlQUFPLFNBQVM7QUFDaEIsWUFBSSxPQUFPLFVBQVUsVUFBVTtBQUM3QixlQUFLLGNBQWMsTUFBTSxVQUFVO0FBQUE7QUFBQTtBQUl2QyxhQUFPLFVBQVUsTUFBTTtBQUVyQixhQUFLLHNCQUNGLGlCQUFpQiwrQkFDakIsUUFBUSxDQUFDLFFBQVEsSUFBSSxZQUFZO0FBQ3BDLGVBQU8sU0FBUztBQUNoQixhQUFLLGVBQWUsT0FBTztBQUczQixZQUFJLE9BQU8sVUFBVSxVQUFVO0FBQzdCLGVBQUssY0FBYyxNQUFNLFVBQVU7QUFDbkMsZUFBSyxZQUFZO0FBQ2pCLGNBQUksS0FBSyxVQUFVO0FBQ2pCLGlCQUFLLFNBQVMsV0FBVztBQUFBO0FBQUEsZUFFdEI7QUFDTCxlQUFLLGNBQWMsTUFBTSxVQUFVO0FBQ25DLGNBQUksS0FBSyxVQUFVO0FBQ2pCLGlCQUFLLFNBQVMsUUFBUSxPQUFPO0FBQzdCLGlCQUFLLFNBQVMsV0FBVyxDQUFDLE9BQU87QUFBQTtBQUFBO0FBQUE7QUFJdkMsYUFBTztBQUFBO0FBQUE7QUFBQSxRQUlMLFNBQVM7QUFsTGpCO0FBbUxJLFVBQU0sRUFBRSxjQUFjO0FBQ3RCLGNBQVU7QUFDVixjQUFVLFNBQVM7QUFHbkIsU0FBSyxtQkFBbUIsVUFBVSxVQUFVO0FBQzVDLFNBQUssaUJBQWlCLE1BQU0sVUFBVTtBQUN0QyxTQUFLLGlCQUFpQixNQUFNLGlCQUFpQjtBQUM3QyxTQUFLLGlCQUFpQixNQUFNLGFBQWE7QUFDekMsU0FBSyxpQkFBaUIsTUFBTSxVQUFVO0FBQ3RDLFVBQU0sY0FBYyxLQUFLLGlCQUFpQjtBQUMxQyxnQkFBWSxRQUFRO0FBR3BCLFNBQUssbUJBQW1CLFVBQVUsVUFDaEM7QUFJRixVQUFNLFFBQ0osS0FBSyxRQUFRLFNBQVMsWUFDbEIsK0JBQ0E7QUFFTixVQUFNLGNBQ0osS0FBSyxRQUFRLFNBQVMsWUFDbEIsNkRBQ0E7QUFHTixTQUFLLFFBQVEsUUFBUTtBQUNyQixTQUFLLFFBQVEsU0FBUztBQUd0QixVQUFNLGdCQUFnQixLQUFLLFFBQVE7QUFDbkMsa0JBQWMsU0FBUztBQUN2QixrQkFBYyxRQUFRO0FBQ3RCLGtCQUFjLE1BQU0sUUFBUTtBQUM1QixrQkFBYyxNQUFNLFdBQVc7QUFDL0Isa0JBQWMsTUFBTSxZQUFZO0FBRWhDLFVBQU0sb0JBQW9CLEtBQUssaUJBQWlCLFVBQzlDO0FBSUYsU0FBSyx3QkFBd0Isa0JBQWtCLFVBQzdDO0FBSUYsU0FBSyxnQkFBZ0Isa0JBQWtCLFVBQ3JDO0FBRUYsU0FBSyxjQUFjLE1BQU0sVUFBVTtBQUVuQyxVQUFNLHVCQUF1QixLQUFLLGNBQWMsVUFDOUM7QUFJRixVQUFNLGVBQWUscUJBQXFCLFVBQ3hDO0FBRUYsaUJBQWEsTUFBTSxVQUFVO0FBQzdCLGlCQUFhLE1BQU0sTUFBTTtBQUN6QixpQkFBYSxNQUFNLGFBQWE7QUFHaEMsU0FBSyxjQUFjLGFBQWEsU0FBUyxTQUFTO0FBQUEsTUFDaEQsTUFBTTtBQUFBLE1BQ04sYUFBYTtBQUFBLE1BQ2IsS0FBSztBQUFBO0FBSVAsVUFBTSxnQkFBZSxhQUFhLFNBQVMsVUFBVTtBQUFBLE1BQ25ELEtBQUs7QUFBQTtBQUVQLGtCQUFhLE1BQU0sVUFBVTtBQUM3QixrQkFBYSxNQUFNLGVBQWU7QUFDbEMsa0JBQWEsTUFBTSxTQUFTO0FBQzVCLGtDQUFRLGVBQWM7QUFFdEIsa0JBQWEsaUJBQWlCLFNBQVMsWUFBWTtBQXZRdkQ7QUF3UU0sVUFBSSxrQkFBa0I7QUFDdEIsVUFBSTtBQUNGLDBCQUNFLE1BQU0sS0FBSyxvQkFBb0I7QUFBQSxlQUMxQixPQUFQO0FBQ0EsZ0JBQVEsTUFBTSwwQ0FBMEM7QUFDeEQsY0FBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsVUFDNUIsT0FBTztBQUFBLFVBQ1AsYUFDRTtBQUFBLFVBQ0YsZUFBZTtBQUFBO0FBRWpCO0FBQUE7QUFHRixZQUFNLFNBQVMsTUFBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsUUFDM0MsT0FBTztBQUFBLFFBQ1AsYUFDRTtBQUFBLFFBQ0YsZUFBZTtBQUFBLFFBQ2YsaUJBQWlCO0FBQUEsUUFDakIsUUFBUTtBQUFBLFVBQ047QUFBQSxZQUNFLE1BQU07QUFBQSxZQUNOLGFBQWE7QUFBQSxZQUNiLFVBQVU7QUFBQSxZQUNWLFdBQVc7QUFBQTtBQUFBLFVBRWI7QUFBQSxZQUNFLE1BQU07QUFBQSxZQUNOLE9BQU87QUFBQSxZQUNQLFVBQVU7QUFBQSxZQUNWLFdBQVc7QUFBQTtBQUFBO0FBQUE7QUFLakIsVUFBSSxDQUFDLGtDQUFRLGNBQWEsQ0FBQyxlQUFPLFdBQVAsb0JBQWdCLE9BQU0sQ0FBQyxlQUFPLFdBQVAsb0JBQWdCLEtBQUk7QUFDcEU7QUFBQTtBQUdGLFlBQU0sQ0FBQyxRQUFPLFdBQVcsT0FBTztBQUNoQyxZQUFNLG1CQUNKLFdBQUssUUFBUSwyQkFBYixZQUF1QztBQUN6QyxZQUFNLFdBQVcsaUJBQWlCO0FBQ2xDLFlBQU0sV0FBVyxvQkFBb0Isa0JBQWtCO0FBRXZELFVBQUk7QUFFRixjQUFNLEtBQUssSUFBSSxNQUFNLGFBQWEsa0JBQWtCLE1BQU0sTUFBTTtBQUFBO0FBSWhFLGNBQU0sY0FBYyxLQUFLO0FBQUE7QUFBQSxFQUFZO0FBQ3JDLGNBQU0sT0FBTyxNQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sVUFBVTtBQUVuRCxZQUFJLENBQUMsTUFBTTtBQUNULGdCQUFNLElBQUksTUFBTTtBQUFBO0FBSWxCLFlBQUksS0FBSyxVQUFVO0FBQ2pCLGVBQUssU0FBUyxRQUFRO0FBQ3RCLGVBQUssU0FBUyxXQUFXO0FBQUE7QUFJM0IsYUFBSyxZQUFZLFFBQVE7QUFFekIsY0FBTSxVQUFVLEtBQUssS0FBSyxJQUFJO0FBQUEsVUFDNUIsT0FBTztBQUFBLFVBQ1AsYUFBYTtBQUFBLFVBQ2IsZUFBZTtBQUFBO0FBQUEsZUFFVixPQUFQO0FBQ0EsZ0JBQVEsTUFBTSxzQ0FBc0M7QUFFcEQsY0FBTSxlQUNKLGlCQUFpQixRQUNiLE1BQU0sVUFDTjtBQUVOLGNBQU0sVUFBVSxLQUFLLEtBQUssSUFBSTtBQUFBLFVBQzVCLE9BQU87QUFBQSxVQUNQLGFBQWE7QUFBQSxVQUNiLGVBQWU7QUFBQTtBQUFBO0FBQUE7QUFNckIsUUFBSSxLQUFLLGFBQWE7QUFDcEIsMEJBQ0UsS0FBSyxhQUNMLE9BQU8saUJBQXlCO0FBQzlCLFlBQUk7QUFDRixnQkFBTSxPQUFPLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUNsRCxjQUFJLFFBQVEsZ0JBQWdCLHdCQUFPO0FBQ2pDLGtCQUFNLFVBQVUsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLO0FBQzFDLGlCQUFLLFNBQVMsUUFBUTtBQUN0QixpQkFBSyxTQUFTLFdBQVc7QUFFekIsaUJBQUssWUFBWSxRQUFRLGFBQWEsUUFBUSxTQUFTO0FBQUE7QUFBQSxpQkFFbEQsT0FBUDtBQUNBLGtCQUFRLE1BQU0scUNBQXFDO0FBQUE7QUFBQSxTQUd2RCxLQUFLLEtBQ0wsV0FBSyxRQUFRLDJCQUFiLFlBQXVDO0FBQUE7QUFJM0MsU0FBSyxXQUFXLGtCQUFrQixTQUFTLFlBQVk7QUFBQSxNQUNyRCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUEsUUFDSixhQUFhO0FBQUEsUUFDYixVQUFVLEtBQUssaUJBQWlCO0FBQUE7QUFBQTtBQUdwQyxTQUFLLFNBQVMsUUFBUSxLQUFLO0FBRzNCLFFBQUksS0FBSyxRQUFRLFNBQVMsaUJBQWlCO0FBQ3pDLFlBQU0sc0JBQXNCLGtCQUFrQixVQUFVO0FBQUEsUUFDdEQsS0FBSztBQUFBO0FBRVAsMEJBQW9CLE1BQU0sVUFBVTtBQUNwQywwQkFBb0IsTUFBTSxpQkFBaUI7QUFDM0MsMEJBQW9CLE1BQU0sYUFBYTtBQUN2QywwQkFBb0IsTUFBTSxZQUFZO0FBQ3RDLDBCQUFvQixNQUFNLE1BQU07QUFFaEMsWUFBTSxvQkFBb0Isb0JBQW9CLFVBQVU7QUFBQSxRQUN0RCxLQUFLO0FBQUE7QUFFUCx3QkFBa0IsTUFBTSxVQUFVO0FBQ2xDLHdCQUFrQixNQUFNLGdCQUFnQjtBQUN4Qyx3QkFBa0IsTUFBTSxhQUFhO0FBQ3JDLHdCQUFrQixNQUFNLFFBQVE7QUFFaEMsWUFBTSxrQkFBa0Isa0JBQWtCLFVBQVU7QUFBQSxRQUNsRCxLQUFLO0FBQUEsUUFDTCxNQUFNO0FBQUE7QUFFUixzQkFBZ0IsTUFBTSxhQUFhO0FBQ25DLHNCQUFnQixNQUFNLGVBQWU7QUFDckMsc0JBQWdCLE1BQU0sV0FBVztBQUVqQyxZQUFNLGdCQUFlLGtCQUFrQixVQUFVO0FBQUEsUUFDL0MsS0FBSztBQUFBO0FBRVAsb0JBQWEsTUFBTSxVQUFVO0FBQzdCLG9CQUFhLE1BQU0sYUFBYTtBQUNoQyxvQkFBYSxNQUFNLE1BQU07QUFDekIsb0JBQWEsTUFBTSxRQUFRO0FBRTNCLFdBQUssa0JBQWtCLGNBQWEsU0FBUyxTQUFTO0FBQUEsUUFDcEQsTUFBTTtBQUFBLFFBQ04sS0FBSztBQUFBLFFBQ0wsTUFBTTtBQUFBLFVBQ0osS0FBSztBQUFBLFVBQ0wsS0FBSztBQUFBLFVBQ0wsTUFBTTtBQUFBLFVBQ04sT0FBTyxZQUFLLFFBQVEseUJBQWIsbUJBQW1DLGVBQWM7QUFBQTtBQUFBO0FBRzVELFdBQUssZ0JBQWdCLE1BQU0sUUFBUTtBQUVuQyxZQUFNLGVBQWUsY0FBYSxVQUFVO0FBQUEsUUFDMUMsS0FBSztBQUFBLFFBQ0wsTUFBTSxLQUFLLFFBQVEsdUJBQ2YsS0FBSyxRQUFRLHFCQUNYLEdBQUcsS0FBSyxNQUNKLEtBQUssUUFBUSx1QkFBdUIsTUFDcEMsS0FBSyxRQUFRLHFCQUNiLFVBRUosR0FBRyxLQUFLLFFBQVEsMEJBQ2xCO0FBQUE7QUFFTixtQkFBYSxNQUFNLFdBQVc7QUFDOUIsbUJBQWEsTUFBTSxZQUFZO0FBQy9CLG1CQUFhLE1BQU0scUJBQXFCO0FBQ3hDLG1CQUFhLE1BQU0sV0FBVztBQUM5QixtQkFBYSxNQUFNLGFBQWE7QUFDaEMsbUJBQWEsTUFBTSxRQUFRO0FBRTNCLFlBQU0sZUFBYyxrQkFBa0IsVUFBVTtBQUFBLFFBQzlDLEtBQUs7QUFBQSxRQUNMLE1BQU0sS0FBSyxRQUFRLHFCQUNmLGNBQWMsS0FBSyxNQUNqQixLQUFLLFFBQVEscUJBQXFCLGlCQUVwQztBQUFBO0FBRU4sbUJBQVksTUFBTSxXQUFXO0FBQzdCLG1CQUFZLE1BQU0sUUFBUTtBQUMxQixtQkFBWSxNQUFNLFlBQVk7QUFHOUIsV0FBSyxnQkFBZ0IsaUJBQWlCLFNBQVMsQ0FBQyxNQUFNO0FBQ3BELGNBQU0sYUFBYSxTQUFVLEVBQUUsT0FBNEIsT0FBTztBQUNsRSxZQUFJLGVBQWUsR0FBRztBQUNwQix1QkFBYSxRQUFRO0FBQUEsbUJBQ1osS0FBSyxRQUFRLG9CQUFvQjtBQUMxQyxnQkFBTSxTQUFTLEtBQUssTUFDaEIsYUFBYSxNQUFPLEtBQUssUUFBUSxxQkFBc0I7QUFFM0QsdUJBQWEsUUFBUSxHQUFHO0FBQUEsZUFDbkI7QUFDTCx1QkFBYSxRQUFRLEdBQUc7QUFBQTtBQUFBO0FBQUE7QUFNOUIsUUFBSSxLQUFLLGlCQUFpQixZQUFZLEtBQUssUUFBUSxzQkFBc0I7QUFFdkUsV0FBSyxZQUFZLFFBQVEsS0FBSyxRQUFRLHFCQUFxQixRQUN6RCxtQkFDQTtBQUFBO0FBS0osVUFBTSxpQkFBaUIsSUFBSSxlQUFlLE1BQU07QUFDOUMsV0FBSyxTQUFTLE1BQU0sU0FBUztBQUM3QixXQUFLLFNBQVMsTUFBTSxTQUFTLEtBQUssU0FBUyxlQUFlO0FBQUE7QUFFNUQsbUJBQWUsUUFBUSxLQUFLO0FBRTVCLFVBQU0sa0JBQWtCLEtBQUssaUJBQWlCLFVBQzVDO0FBR0YsVUFBTSxrQkFBa0IsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLE1BQ3pELE1BQU07QUFBQSxNQUNOLEtBQUs7QUFBQTtBQUVQLFVBQU0sZUFBZSxNQUFNO0FBQ3pCLFdBQUssU0FBUztBQUNkLFdBQUs7QUFBQTtBQUVQLG9CQUFnQixVQUFVO0FBRTFCLFVBQU0sZ0JBQWdCLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxNQUN2RCxNQUFNO0FBQUEsTUFDTixLQUFLO0FBQUE7QUFFUCxVQUFNLGFBQWEsTUFBTTtBQWxnQjdCO0FBb2dCTSxZQUFNLGVBQWUsS0FBSyxRQUFRLGNBQ2hDO0FBRUYsWUFBTSxvQkFBb0Isb0RBQWMsZ0JBQWQsYUFBNkI7QUFFdkQsVUFBSTtBQUVKLFVBQUksc0JBQXNCLFlBQVksS0FBSyxZQUFZLE9BQU87QUFFNUQsY0FBTSxPQUFPLEtBQUssWUFBWSxNQUFNLFFBQVEsU0FBUztBQUNyRCxpQkFBUztBQUFBLFVBQ1AsU0FBUyxLQUFLLFNBQVM7QUFBQSxVQUN2QixNQUFNO0FBQUEsVUFDTjtBQUFBO0FBQUEsYUFFRztBQUNMLGNBQU0sU0FBUyxLQUFLLGNBQWMsS0FDaEMsQ0FBQyxNQUFNLEVBQUUsVUFBVTtBQUVyQixZQUFJLFFBQVE7QUFDVixtQkFBUztBQUFBLFlBQ1AsU0FBUyxPQUFPO0FBQUEsWUFDaEIsTUFBTSxPQUFPO0FBQUE7QUFBQSxlQUVWO0FBRUwsbUJBQVM7QUFBQSxZQUNQLFNBQVMsS0FBSyxTQUFTO0FBQUEsWUFDdkIsTUFBTTtBQUFBO0FBQUE7QUFBQTtBQU1aLFVBQ0UsS0FBSyxRQUFRLFNBQVMsbUJBQ3RCLGFBQUssb0JBQUwsb0JBQXNCLFFBQ3RCO0FBQ0EsY0FBTSxhQUFhLFNBQVMsS0FBSyxnQkFBZ0IsT0FBTztBQUN4RCxZQUFJLGFBQWEsR0FBRztBQUVsQixpQkFBTyx1QkFBdUI7QUFFOUIsY0FBSSxLQUFLLFFBQVEsb0JBQW9CO0FBQ25DLG1CQUFPLGFBQWEsS0FBSyxNQUN0QixhQUFhLE1BQU8sS0FBSyxRQUFRO0FBQUE7QUFBQTtBQUFBO0FBTTFDLFdBQUssU0FBUztBQUNkLFdBQUs7QUFBQTtBQUVQLGtCQUFjLFVBQVU7QUFHeEIsU0FBSyxRQUFRLGlCQUFpQixXQUFXLENBQUMsTUFBcUI7QUFFN0QsVUFDRSxFQUFFLFFBQVEsV0FDVixDQUFDLEVBQUUsZUFDSCxDQUFDLEVBQUUsWUFDSCxFQUFFLFdBQVcsS0FBSyxVQUNsQjtBQUNBLFVBQUU7QUFDRjtBQUFBLGlCQUNTLEVBQUUsUUFBUSxVQUFVO0FBQzdCLFVBQUU7QUFDRjtBQUFBO0FBQUE7QUFLSixTQUFLLFNBQVM7QUFDZCxTQUFLLFNBQVMsa0JBQ1osS0FBSyxTQUFTLE1BQU0sUUFDcEIsS0FBSyxTQUFTLE1BQU07QUFJdEIsVUFBTSxLQUFLO0FBQUE7QUFBQSxFQUdiLFVBQVU7QUFDUixVQUFNLEVBQUUsY0FBYztBQUN0QixjQUFVO0FBQ1YsUUFBSSxLQUFLLG1CQUFtQixVQUFhLEtBQUssbUJBQW1CLE1BQU07QUFDckUsV0FBSyxlQUFlLEtBQUs7QUFBQTtBQUFBO0FBQUEsUUFJdkIsa0JBQXNEO0FBQzFELFdBQU8sSUFBSSxRQUFRLENBQUMsWUFBWTtBQUM5QixXQUFLLGlCQUFpQjtBQUN0QixXQUFLO0FBQUE7QUFBQTtBQUFBO0FBS1gscUNBQ0UsS0FDQSxlQUNBLFNBQ29DO0FBQ3BDLFFBQU0saUJBQTJDO0FBQUEsSUFDL0Msd0JBQXdCO0FBQUEsSUFDeEIsTUFBTTtBQUFBLElBQ04sb0JBQW9CO0FBQUE7QUFHdEIsUUFBTSxRQUFRLElBQUksa0JBQWtCLEtBQUssZUFBZTtBQUFBLE9BQ25EO0FBQUEsT0FDQTtBQUFBO0FBRUwsUUFBTSxTQUFTLE1BQU0sTUFBTTtBQUUzQixNQUFJLFdBQVcsUUFBUSxvQ0FBUyxTQUFRO0FBQ3RDLFVBQU0sUUFBUSxPQUFPLE9BQU87QUFBQTtBQUc5QixTQUFPO0FBQUE7OztBUm5uQkYsMkNBQXFDLG1DQUFpQjtBQUFBLEVBSzNELFlBQVksS0FBVSxRQUE0QjtBQUNoRCxVQUFNLEtBQUs7QUFITCx5QkFBdUM7QUFJN0MsU0FBSyxTQUFTO0FBQ2QsU0FBSyxzQkFBc0Isb0JBQW9CLFlBQzdDLE9BQU8sVUFDUCxLQUFLO0FBQUE7QUFBQSxFQUlELGtCQUFrQixNQUF1QjtBQUMvQyxRQUFJLENBQUM7QUFBTSxhQUFPO0FBQ2xCLFdBQ0UsQ0FBQyxLQUFLLFNBQVMsU0FBUyxDQUFDLEtBQUssV0FBVyxRQUFRLENBQUMsS0FBSyxXQUFXO0FBQUE7QUFBQSxRQUl4RCxzQkFDWixPQUNBLFlBT0E7QUFDQSxRQUFJLENBQUMsS0FBSyxrQkFBa0IsUUFBUTtBQUNsQyxnQkFDRSxLQUFLLEtBQ0w7QUFFRjtBQUFBO0FBR0YsUUFBSSxLQUFLO0FBQWUsbUJBQWEsS0FBSztBQUUxQyxTQUFLLGdCQUFnQixXQUFXLFlBQVk7QUFDMUMsV0FBSyxPQUFPLFNBQVMsY0FBYztBQUNuQyxZQUFNLEtBQUssT0FBTztBQUFBLE9BQ2pCO0FBQUE7QUFBQSxRQUdDLFVBQXlCO0FBQzdCLFVBQU0sRUFBRSxnQkFBZ0I7QUFDeEIsZ0JBQVk7QUFHWixVQUFNLGdCQUFnQixZQUFZLFVBQ2hDO0FBRUYsa0JBQWMsU0FBUyxNQUFNLEVBQUUsTUFBTTtBQUdyQyxVQUFNLGVBQWUsY0FBYyxVQUFVO0FBQzdDLFVBQU0sbUJBQW1CLGNBQWMsVUFDckM7QUFJRixVQUFNLE9BQU87QUFBQSxNQUNYLEVBQUUsSUFBSSxXQUFXLE9BQU87QUFBQSxNQUN4QixFQUFFLElBQUksZUFBZSxPQUFPO0FBQUEsTUFDNUIsRUFBRSxJQUFJLFlBQVksT0FBTztBQUFBLE1BQ3pCLEVBQUUsSUFBSSxRQUFRLE9BQU87QUFBQSxNQUNyQixFQUFFLElBQUksU0FBUyxPQUFPO0FBQUEsTUFDdEIsRUFBRSxJQUFJLFlBQVksT0FBTztBQUFBO0FBSTNCLFNBQUssUUFBUSxDQUFDLFFBQVE7QUFDcEIsWUFBTSxZQUFZLGFBQWEsU0FBUyxVQUFVO0FBQUEsUUFDaEQsS0FBSztBQUFBLFFBQ0wsTUFBTSxJQUFJO0FBQUE7QUFFWixnQkFBVSxRQUFRLE1BQU0sSUFBSTtBQUM1QixVQUFJLElBQUksT0FBTztBQUFXLGtCQUFVLFNBQVM7QUFBQTtBQUkvQyxVQUFNLGNBQWMsS0FBSyxPQUFPLFNBQVMsaUJBQWlCO0FBQzFELFVBQU0saUJBQWlCLGlCQUFpQixVQUN0QztBQUVGLFVBQU0scUJBQXFCLGlCQUFpQixVQUMxQztBQUVGLFVBQU0sa0JBQWtCLGlCQUFpQixVQUN2QztBQUVGLFVBQU0sY0FBYyxpQkFBaUIsVUFBVTtBQUMvQyxVQUFNLGVBQWUsaUJBQWlCLFVBQVU7QUFDaEQsVUFBTSxrQkFBa0IsaUJBQWlCLFVBQ3ZDO0FBSUYsU0FBSyxrQkFBa0IsZ0JBQWdCO0FBQ3ZDLFNBQUssc0JBQXNCLG9CQUFvQjtBQUMvQyxTQUFLLG1CQUFtQjtBQUN4QixTQUFLLGVBQWU7QUFDcEIsU0FBSyxnQkFBZ0I7QUFDckIsU0FBSyxtQkFBbUI7QUFHeEIsaUJBQ0csaUJBQWlCLDRCQUNqQixRQUFRLENBQUMsV0FBVztBQUNuQixhQUFPLGlCQUFpQixTQUFTLENBQUMsTUFBTTtBQTFIaEQ7QUEySFUsY0FBTSxTQUFTLEVBQUU7QUFDakIsY0FBTSxRQUFRLE9BQU8sUUFBUTtBQUc3QixxQkFDRyxpQkFBaUIsNEJBQ2pCLFFBQVEsQ0FBQyxNQUFNLEVBQUUsVUFBVSxPQUFPO0FBQ3JDLHlCQUNHLGlCQUFpQiw2QkFDakIsUUFBUSxDQUFDLE1BQU0sRUFBRSxVQUFVLE9BQU87QUFHckMsZUFBTyxVQUFVLElBQUk7QUFDckIsK0JBQ0csY0FBYyxjQUFjLGVBRC9CLG1CQUVJLFVBQVUsSUFBSTtBQUFBO0FBQUE7QUFLeEIsUUFBSSxDQUFDLFNBQVMsZUFBZSxpQ0FBaUM7QUFDNUQsWUFBTSxRQUFRLFNBQVMsY0FBYztBQUNyQyxZQUFNLEtBQUs7QUFDWCxZQUFNLGNBQWM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXlGcEIsb0JBQWMsWUFBWTtBQUFBO0FBQUE7QUFBQSxFQUl0QixrQkFBa0IsYUFBMEIsYUFBc0I7QUFDeEUsZ0JBQVksUUFBUSxNQUFNO0FBQzFCLFVBQU0sMEJBQTBCLFlBQVksVUFDMUM7QUFHRiw0QkFBd0IsU0FBUyxNQUFNO0FBQUEsTUFDckMsTUFBTTtBQUFBO0FBSVIsVUFBTSxpQkFBaUIsSUFBSSwwQkFBUSx5QkFDaEMsUUFBUSxlQUNSLFFBQVEsNkNBQ1IsUUFBUSxDQUFDLFNBQVM7QUFDakIsV0FDRyxlQUFlLHFCQUNmLFNBQVMsS0FBSyxPQUFPLFNBQVMsWUFDOUIsU0FBUyxPQUFPLFVBQVU7QUFDekIsYUFBSyxPQUFPLFNBQVMsYUFBYTtBQUNsQyxjQUFNLEtBQUssT0FBTztBQUFBLFNBRW5CLFFBQVEsU0FBUztBQUNwQixXQUFLLFFBQVEsT0FBTztBQUNwQixXQUFLLFFBQVEsTUFBTSxhQUFhO0FBQ2hDLFdBQUssUUFBUSxpQkFBaUIsU0FBUyxNQUFNO0FBQzNDLGFBQUssUUFBUSxPQUFPO0FBQ3BCLGFBQUssUUFBUSxNQUFNLGFBQWE7QUFBQTtBQUVsQyxXQUFLLFFBQVEsaUJBQWlCLFFBQVEsTUFBTTtBQUMxQyxhQUFLLFFBQVEsT0FBTztBQUNwQixhQUFLLFFBQVEsTUFBTSxhQUFhO0FBQUE7QUFFbEMsYUFBTztBQUFBLE9BRVIsVUFBVSxDQUFDLFdBQVc7QUFDckIsYUFDRyxTQUFTLGFBQ1QsV0FDQyxjQUFjLHlCQUF5Qix1QkFFeEMsU0FBUyxPQUFPLFVBQVU7QUFDekIsWUFBSSxPQUFPO0FBRVQsZ0JBQU0sVUFBVSxNQUFNLEtBQUssT0FDeEIsb0JBQ0EsbUJBQW1CO0FBQ3RCLGNBQUksQ0FBQyxTQUFTO0FBQ1osbUJBQU8sU0FBUztBQUNoQixzQkFDRSxLQUFLLEtBQ0w7QUFBQTtBQUFBLGVBR0M7QUFDTCxlQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLGdCQUFNLEtBQUssT0FBTztBQUFBO0FBRXBCLGFBQUs7QUFBQTtBQUdULFVBQUksYUFBYTtBQUNmLGVBQU8sU0FBUyxTQUFTO0FBQUE7QUFBQTtBQUkvQixRQUFJLGFBQWE7QUFDZixZQUFNLGdCQUFnQixJQUFJLDBCQUFRLHlCQUMvQixRQUFRLGNBQ1IsUUFBUTtBQUVYLG9CQUFjLE9BQU8sV0FBVztBQUFBLFFBQzlCLEtBQUs7QUFBQSxRQUNMLE1BQU07QUFBQTtBQUdSLFlBQU0sWUFBWSxXQUFXO0FBQUEsUUFDM0IsS0FBSztBQUFBLFFBQ0wsTUFBTTtBQUFBO0FBR1Isb0JBQWMsZUFBZSxDQUFDLFdBQVc7QUFDdkMsZUFDRyxRQUFRLFlBQ1IsV0FBVyxxQkFDWCxZQUFZO0FBQ2Ysc0JBQWMsVUFBVSxZQUFZO0FBQUE7QUFFdEMsV0FBSyxvQkFBb0I7QUFBQTtBQUkzQixTQUFLLDJCQUEyQix5QkFBeUI7QUFHekQsVUFBTSxlQUFlLHdCQUF3QixTQUFTLE9BQU87QUFBQSxNQUMzRCxLQUFLO0FBQUE7QUFHUCxVQUFNLGtCQUFrQixhQUFhLFNBQVMsT0FBTztBQUFBLE1BQ25ELEtBQUs7QUFBQTtBQUdQLFFBQUksMEJBQVEsaUJBQ1QsYUFDQSxRQUFRLHNCQUNSLGVBQWUsQ0FBQyxXQUFXO0FBQzFCLGFBQ0csUUFBUSxVQUNSLFlBQVksTUFDWixnQkFBZ0IsU0FBUztBQUFBO0FBR2hDLGlCQUFhLFNBQVMsS0FBSztBQUFBLE1BQ3pCLE1BQU07QUFBQSxNQUNOLEtBQUs7QUFBQTtBQUdQLGlCQUFhLFNBQVMsS0FBSztBQUFBLE1BQ3pCLE1BQU07QUFBQSxNQUNOLEtBQUs7QUFBQTtBQUlQLFFBQUksQ0FBQyxTQUFTLGVBQWUsNkJBQTZCO0FBQ3hELFlBQU0sUUFBUSxTQUFTLGNBQWM7QUFDckMsWUFBTSxLQUFLO0FBQ1gsWUFBTSxjQUFjO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTBDcEIsa0JBQVksWUFBWTtBQUFBO0FBQUE7QUFBQSxRQUlkLG9CQUFvQixhQUEwQjtBQUMxRCxRQUFJO0FBQ0YsWUFBTSxVQUFVLE1BQU0sS0FBSyxvQkFBb0I7QUFDL0Msa0JBQVksUUFBUSxzQkFBc0IsUUFBUTtBQUFBLGFBQzNDLE9BQVA7QUFDQSxrQkFBWSxRQUFRO0FBQ3BCLGNBQVEsTUFBTSxrQ0FBa0M7QUFBQTtBQUFBO0FBQUEsRUFJNUMsMkJBQ04sYUFDQSxhQUNBO0FBQ0EsUUFBSSxDQUFDLGFBQWE7QUFDaEIsWUFBTSxpQkFBaUIsWUFBWSxTQUFTLE9BQU87QUFBQSxRQUNqRCxLQUFLO0FBQUE7QUFHUCxZQUFNLGtCQUFrQixlQUFlLFNBQVMsT0FBTztBQUFBLFFBQ3JELEtBQUs7QUFBQTtBQUdQLFVBQUksMEJBQVEsaUJBQ1QsYUFDQSxRQUFRLGtCQUNSLGVBQWUsQ0FBQyxXQUFXO0FBQzFCLGVBQ0csUUFBUSxZQUNSLFlBQVksTUFDWixnQkFBZ0IsU0FBUztBQUFBO0FBR2hDLHFCQUFlLFNBQVMsS0FBSztBQUFBLFFBQzNCLE1BQU07QUFBQSxRQUNOLEtBQUs7QUFBQTtBQUdQLFlBQU0sZUFBZSxlQUFlLFNBQVMsTUFBTTtBQUFBLFFBQ2pELEtBQUs7QUFBQTtBQUdQO0FBQUEsUUFDRTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBLFFBQVEsQ0FBQyxZQUFZO0FBQ3JCLHFCQUFhLFNBQVMsTUFBTSxFQUFFLE1BQU07QUFBQTtBQUd0QyxVQUFJLDBCQUFRLGdCQUFnQixVQUFVLENBQUMsV0FDckMsT0FDRyxjQUFjLG1CQUNkLFNBQ0EsUUFBUSxNQUFNO0FBQ2IsZUFBTyxLQUFLLG9DQUFvQztBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTWxELG1CQUFtQixhQUEwQjtBQUNuRCxnQkFBWSxRQUFRLE1BQU07QUFFMUIsUUFBSSwwQkFBUSxhQUNULFFBQVEsb0JBQ1IsUUFBUSwyREFDUixVQUFVLENBQUMsV0FDVixPQUNHLFNBQVMsS0FBSyxPQUFPLFNBQVMsaUJBQzlCLFNBQVMsT0FBTyxVQUFVO0FBQ3pCLFdBQUssT0FBTyxTQUFTLGtCQUFrQjtBQUN2QyxXQUFLLE9BQU8sU0FBUyxZQUFZLFFBQzdCLDBCQUNBO0FBQ0osWUFBTSxLQUFLLE9BQU87QUFDbEIsVUFBSSx5QkFDRixlQUFlLFFBQVEsZ0JBQWdCLHNCQUNyQyxLQUFLLG9CQUFvQjtBQUFBO0FBTXJDLFVBQU0sZUFBZSxJQUFJLDBCQUFRLGFBQzlCLFFBQVEsWUFDUixRQUFRO0FBRVgsaUJBQWEsVUFBVSxDQUFDLFdBQ3RCLE9BQU8sY0FBYyxnQkFBZ0IsUUFBUSxZQUFZO0FBQ3ZELGFBQU8sWUFBWTtBQUNuQixVQUFJO0FBQ0YsY0FBTSxTQUFTLE1BQU0sS0FBSyxvQkFBb0I7QUFDOUMsY0FBTSxRQUFRLElBQUksb0JBQ2hCLEtBQUssS0FDTCxLQUFLLE9BQU8sU0FBUyxpQkFDckIsT0FBTyxZQUFvQjtBQUN6QixlQUFLLE9BQU8sU0FBUyxrQkFBa0I7QUFDdkMsZ0JBQU0sS0FBSyxPQUFPO0FBRWxCLGdCQUFNLGVBQWUsWUFBWSxjQUMvQjtBQUVGLGNBQUksY0FBYztBQUNoQix5QkFBYSxRQUFRLGtCQUFrQjtBQUFBO0FBQUEsV0FHM0MsS0FBSztBQUdQLGNBQU07QUFBQSxlQUNDLE9BQVA7QUFDQSxnQkFBUSxNQUFNLHlCQUF5QjtBQUN2QyxrQkFBVSxLQUFLLEtBQUs7QUFBQSxnQkFDcEI7QUFDQSxlQUFPLFlBQVk7QUFBQTtBQUFBO0FBS3pCLGlCQUFhLE9BQU8sU0FBUyxPQUFPO0FBQUEsTUFDbEMsTUFBTSxrQkFBa0IsS0FBSyxPQUFPLFNBQVM7QUFBQSxNQUM3QyxLQUFLO0FBQUE7QUFJUCxRQUFJLDBCQUFRLGFBQ1QsUUFBUSw2QkFDUixRQUNDLG1FQUVELFVBQVUsQ0FBQyxRQUFRO0FBQ2xCLFVBQUksY0FBYyxlQUFVLFFBQVEsWUFBWTtBQUM5QyxjQUFNLFVBQVUsTUFBTSxVQUNwQixLQUFLLEtBQ0wsNkJBQ0E7QUFBQSxVQUNFLGFBQ0U7QUFBQSxVQUNGLGVBQWU7QUFBQSxVQUNmLGlCQUFpQjtBQUFBO0FBR3JCLFlBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxXQUFXO0FBQ2xDO0FBQUE7QUFHRixZQUFJO0FBRUYsZ0JBQU0sS0FBSyxPQUNSLHFCQUNBLGVBQWU7QUFHbEIsaUJBQU8sU0FBUztBQUFBLGlCQUNULE9BQVA7QUFDQSxrQkFBUSxNQUFNLHdDQUF3QztBQUN0RCxvQkFBVSxLQUFLLEtBQUssc0JBQXNCLE9BQU87QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLFFBTTdDLHNCQUNaLGFBQ0EsYUFDQTtBQUNBLGdCQUFZLFFBQVEsTUFBTTtBQUMxQixnQkFBWSxTQUFTLE1BQU0sRUFBRSxNQUFNO0FBR25DLFNBQUssdUJBQ0gsYUFDQSxtQkFDQSw4Q0FDQSxrQkFDQTtBQUdGLFNBQUssdUJBQ0gsYUFDQSx3QkFDQSw0Q0FDQSx1QkFDQTtBQUlGLFNBQUssdUJBQ0gsYUFDQSw0QkFDQSx1REFDQSwwQkFDQTtBQUdGLFNBQUssdUJBQ0gsYUFDQSx5QkFDQSx5REFDQSx3QkFDQTtBQUlGLFNBQUssdUJBQ0gsYUFDQSx5QkFDQSxpRUFDQSx3QkFDQTtBQUVGLFNBQUssdUJBQ0gsYUFDQSxtQkFDQSw0Q0FDQSxrQkFDQTtBQUFBO0FBQUEsRUFJSSx1QkFDTixhQUNBLE1BQ0EsTUFDQSxZQU9BLGFBQ0E7QUFDQSxRQUFJLDBCQUFRLGFBQ1QsUUFBUSxNQUNSLFFBQVEsTUFDUixRQUFRLENBQUMsU0FBUztBQUNqQixXQUNHLGVBQWUsYUFDZixTQUFTLEtBQUssT0FBTyxTQUFTLGFBQzlCLFNBQVMsT0FBTyxVQUFVO0FBQ3pCLGNBQU0sS0FBSyxzQkFBc0IsT0FBTztBQUFBO0FBRzVDLDRCQUNFLEtBQUssU0FDTCxPQUFPLGlCQUF5QjtBQUM5QixZQUFJLEtBQUssa0JBQWtCLGVBQWU7QUFDeEMsZUFBSyxPQUFPLFNBQVMsY0FBYztBQUNuQyxlQUFLLFNBQVM7QUFDZCxnQkFBTSxLQUFLLE9BQU87QUFBQSxlQUNiO0FBQ0wsb0JBQ0UsS0FBSyxLQUNMO0FBQUE7QUFBQSxTQUlOLEtBQUs7QUFFUCxhQUFPO0FBQUE7QUFBQTtBQUFBLEVBSUwsZUFBZSxhQUEwQjtBQUMvQyxnQkFBWSxRQUFRLE1BQU07QUFDMUIsZ0JBQVksU0FBUyxNQUFNLEVBQUUsTUFBTTtBQUVuQyxRQUFJLDBCQUFRLGFBQ1QsUUFBUSxzQkFDUixRQUFRLHNEQUNSLFVBQVUsQ0FBQyxXQUFXO0FBQ3JCLGFBQU8sY0FBYyxlQUFlLFFBQVEsWUFBWTtBQUN0RCxjQUFNLFNBQVMsTUFBTSxzQkFDbkIsS0FBSyxLQUNMLEtBQUssT0FBTyxTQUFTLGNBQ3JCO0FBQUEsVUFDRSxRQUFRLE9BQU8sY0FBYztBQUUzQixpQkFBSyxPQUFPLFNBQVMsZUFBZTtBQUNwQyxrQkFBTSxLQUFLLE9BQU87QUFBQTtBQUFBLFVBR3BCLHdCQUNFLEtBQUssT0FBTyxTQUFTO0FBQUEsVUFDdkIsTUFBTTtBQUFBLFVBQ04sc0JBQXNCLEtBQUssT0FBTyxTQUFTO0FBQUE7QUFJL0MsWUFBSSxpQ0FBUSxTQUFTO0FBR25CLGVBQUssT0FBTyxTQUFTLGVBQWUsT0FBTztBQUMzQyxlQUFLLE9BQU8sU0FBUyxtQkFBbUIsT0FBTztBQUMvQyxjQUFJLGtDQUFRLFVBQVMsWUFBWSxrQ0FBUSxPQUFNO0FBQzdDLGlCQUFLLE9BQU8sU0FBUyxtQkFBbUIsT0FBTztBQUFBLGlCQUMxQztBQUNMLGlCQUFLLE9BQU8sU0FBUyxtQkFBbUI7QUFBQTtBQUUxQyxnQkFBTSxLQUFLLE9BQU87QUFBQTtBQUFBO0FBR3RCLGFBQU87QUFBQTtBQUFBO0FBQUEsRUFJTCxtQkFBbUIsYUFBMEI7QUFDbkQsZ0JBQVksUUFBUSxNQUFNO0FBQzFCLGdCQUFZLFNBQVMsTUFBTSxFQUFFLE1BQU07QUFFbkMsVUFBTSxvQkFBb0IsSUFBSSwwQkFBUSxhQUNuQyxRQUFRLHdCQUNSLFFBQVE7QUFFWCxVQUFNLFlBQVksa0JBQWtCLFVBQVUsU0FBUyxVQUFVO0FBQUEsTUFDL0QsS0FBSztBQUFBO0FBR1AsY0FDRyxTQUFTLFVBQVU7QUFBQSxNQUNsQixPQUFPO0FBQUEsTUFDUCxNQUFNO0FBQUEsT0FFUCxhQUFhLFlBQVk7QUFFNUIsY0FBVSxXQUFXO0FBRXJCLFFBQUk7QUFDRixnQkFBVSxhQUNQLG1CQUNBLEtBQUssQ0FBQyxZQUFZO0FBN3VCM0I7QUE4dUJVLGNBQU0sY0FBYyxRQUFRLE9BQzFCLENBQUMsV0FBVyxPQUFPLFNBQVM7QUFFOUIsa0JBQVUsV0FBVztBQUNyQix3QkFBVSxzQkFBVixtQkFBNkI7QUFDN0Isb0JBQVksUUFBUSxDQUFDLFFBQVE7QUFDM0IsZ0JBQU0sU0FBUyxVQUFVLFNBQVMsVUFBVTtBQUFBLFlBQzFDLE9BQU8sSUFBSTtBQUFBLFlBQ1gsTUFBTSxJQUFJLFNBQVMsY0FBYyxJQUFJLFNBQVMsTUFBTSxHQUFHO0FBQUE7QUFFekQsY0FBSSxJQUFJLGFBQWEsS0FBSyxPQUFPLFNBQVMsdUJBQXVCO0FBQy9ELG1CQUFPLFdBQVc7QUFBQTtBQUFBO0FBQUEsU0FJdkIsTUFBTSxDQUFDLFVBQVU7QUFDaEIsZ0JBQVEsTUFBTSxvQ0FBb0M7QUFDbEQsa0JBQVUsU0FBUyxVQUFVO0FBQUEsVUFDM0IsT0FBTztBQUFBLFVBQ1AsTUFBTTtBQUFBO0FBQUE7QUFBQSxhQUdMLE9BQVA7QUFDQSxjQUFRLE1BQU0scUNBQXFDO0FBQUE7QUFHckQsY0FBVSxpQkFBaUIsVUFBVSxZQUFZO0FBQy9DLFdBQUssT0FBTyxTQUFTLHdCQUF3QixVQUFVO0FBQ3ZELFlBQU0sS0FBSyxPQUFPO0FBQUE7QUFHcEIsUUFBSSwwQkFBUSxhQUNULFFBQVEsOEJBQ1IsUUFBUSwrREFDUixVQUFVLENBQUMsV0FDVixPQUNHLFNBQVMsS0FBSyxPQUFPLFNBQVMsMEJBQzlCLFNBQVMsT0FBTyxVQUFVO0FBQ3pCLFdBQUssT0FBTyxTQUFTLDJCQUEyQjtBQUNoRCxZQUFNLEtBQUssT0FBTztBQUFBO0FBSTFCLFFBQUksMEJBQVEsYUFDVCxRQUFRLDRCQUNSLFFBQVEsK0RBQ1IsVUFBVSxDQUFDLFdBQ1YsT0FDRyxTQUFTLEtBQUssT0FBTyxTQUFTLHdCQUM5QixTQUFTLE9BQU8sVUFBVTtBQUN6QixXQUFLLE9BQU8sU0FBUyx5QkFBeUI7QUFDOUMsWUFBTSxLQUFLLE9BQU87QUFBQTtBQUsxQixRQUFJLDBCQUFRLGFBQ1QsUUFBUSxtQkFDUixRQUFRLHlEQUNSLFVBQVUsQ0FBQyxXQUFXO0FBQ3JCLGFBQ0csU0FBUyxLQUFLLE9BQU8sU0FBUyx1QkFDOUIsV0FBVyxrQ0FDWCxTQUFTLE9BQU8sVUFBVTtBQUN6QixhQUFLLE9BQU8sU0FBUyx3QkFBd0I7QUFDN0MsY0FBTSxLQUFLLE9BQU87QUFBQTtBQUV0QixhQUFPO0FBQUEsT0FFUixVQUFVLENBQUMsV0FBVztBQUNyQixhQUNHLGNBQWMsZUFDZCxXQUFXLHdDQUNYLFFBQVEsWUFBWTtBQUNuQixjQUFNLEVBQUUsa0VBQWtDLE1BQU07QUFHaEQsY0FBTSxTQUFTLE1BQU0sK0JBQ25CLEtBQUssS0FDTCxLQUFLLFFBQ0wsS0FBSyxPQUFPLFNBQVM7QUFHdkIsWUFBSSxRQUFRO0FBQ1YsZUFBSyxPQUFPLFNBQVMsdUJBQXVCLE9BQU87QUFDbkQsZ0JBQU0sS0FBSyxPQUFPO0FBQUE7QUFBQTtBQUd4QixhQUFPO0FBQUE7QUFBQTtBQUFBLEVBSUwsZ0JBQWdCLGFBQTBCO0FBQ2hELGdCQUFZLFFBQVEsTUFBTTtBQUMxQixnQkFBWSxTQUFTLE1BQU0sRUFBRSxNQUFNO0FBRW5DLFFBQUksMEJBQVEsYUFDVCxRQUFRLDZCQUNSLFFBQVEsZ0VBQ1IsVUFBVSxDQUFDLFdBQ1YsT0FDRyxTQUFTLEtBQUssT0FBTyxTQUFTLHdCQUM5QixTQUFTLE9BQU8sVUFBVTtBQUN6QixXQUFLLE9BQU8sU0FBUyx5QkFBeUI7QUFDOUMsWUFBTSxLQUFLLE9BQU87QUFBQTtBQUFBO0FBQUE7OztBU3QxQjlCLHdCQUFpRDs7O0FDQWpELHdCQUE0Qzs7O0FDQzVDO0FBS0EsSUFBTSw2QkFBNkIsQ0FBQyxPQUFPLE9BQU8sUUFBUSxPQUFPO0FBQ2pFLElBQU0sZ0JBQWdCO0FBQUEsRUFDcEIsS0FBSztBQUFBLEVBQ0wsS0FBSztBQUFBLEVBQ0wsTUFBTTtBQUFBLEVBQ04sS0FBSztBQUFBLEVBQ0wsS0FBSztBQUFBO0FBU0EsaUNBQTJCO0FBQUEsRUFNeEIsWUFBWSxRQUFxRDtBQUpqRSwwQkFBMEI7QUFLaEMsU0FBSyxTQUFTO0FBQ2QsU0FBSyxnQkFBZ0Isb0JBQW9CLFlBQ3ZDLE9BQU8sVUFDUCxPQUFPO0FBQUE7QUFBQSxTQUlKLFlBQ0wsUUFDc0I7QUFDdEIsUUFBSSxDQUFDLHFCQUFxQixVQUFVO0FBQ2xDLDJCQUFxQixXQUFXLElBQUkscUJBQXFCO0FBQUE7QUFFM0QsV0FBTyxxQkFBcUI7QUFBQTtBQUFBLFFBR2hCLG1CQUNaLFVBQzBDO0FBQzFDLFFBQUk7QUFDRixZQUFNLE9BQU8sTUFBTSxTQUFTO0FBQzVCLFVBQUksS0FBSyxPQUFPO0FBQ2QsWUFBSSxPQUFPLEtBQUssVUFBVSxVQUFVO0FBQ2xDLGlCQUFPLEVBQUUsU0FBUyxLQUFLLE9BQU87QUFBQTtBQUVoQyxZQUFJLEtBQUssTUFBTSxTQUFTO0FBQ3RCLGlCQUFPLEVBQUUsU0FBUyxLQUFLLE1BQU0sU0FBUztBQUFBO0FBRXhDLGVBQU8sRUFBRSxTQUFTLEtBQUssVUFBVSxLQUFLLFFBQVE7QUFBQTtBQUVoRCxhQUFPLEVBQUUsU0FBUyxTQUFTLFlBQVk7QUFBQSxhQUNoQyxHQUFQO0FBQ0EsYUFBTyxFQUFFLFNBQVMsU0FBUztBQUFBO0FBQUE7QUFBQSxRQUl6QixlQUNKLE1BQ0EsU0FDaUI7QUFuRXJCO0FBb0VJLFlBQVEsSUFBSSxvREFBb0Q7QUFBQSxNQUM5RCxVQUFVLEtBQUs7QUFBQSxNQUNmO0FBQUE7QUFHRixRQUFJLEtBQUssZ0JBQWdCO0FBQ3ZCLFlBQU0sSUFBSSxNQUFNO0FBQUE7QUFHbEIsVUFBTSxZQUFZLEtBQUssVUFBVTtBQUNqQyxRQUFJLENBQUMsMkJBQTJCLFNBQVMsWUFBWTtBQUNuRCxZQUFNLElBQUksTUFBTSwwQkFBMEI7QUFBQTtBQUc1QyxTQUFLLGlCQUFpQjtBQUd0Qiw2Q0FBUyxlQUFULGlDQUFzQixHQUFHO0FBRXpCLFVBQU0sY0FBYyxNQUFNLEtBQUssT0FBTyxJQUFJLE1BQU0sV0FBVztBQUMzRCxVQUFNLE9BQU8sSUFBSSxLQUFLLENBQUMsY0FBYztBQUFBLE1BQ25DLE1BQU0sY0FBYztBQUFBO0FBR3RCLFVBQU0sV0FBVyxJQUFJO0FBQ3JCLGFBQVMsT0FBTyxRQUFRLE1BQU0sS0FBSztBQUNuQyxRQUFJLG1DQUFTLGFBQWE7QUFDeEIsZUFBUyxPQUFPLGVBQWU7QUFBQTtBQUdqQyxRQUFJO0FBRUYsK0NBQVMsZUFBVCxpQ0FBc0IsSUFBSTtBQUUxQixZQUFNLFdBQVcsTUFBTSxNQUNyQixHQUFHLEtBQUssY0FBYyx1Q0FDdEI7QUFBQSxRQUNFLFFBQVE7QUFBQSxRQUNSLFNBQVM7QUFBQSxVQUNQLGlCQUFpQixLQUFLLE9BQU8sU0FBUztBQUFBO0FBQUEsUUFFeEMsTUFBTTtBQUFBO0FBSVYsY0FBUSxJQUFJLHdCQUF3QjtBQUFBLFFBQ2xDLFFBQVEsU0FBUztBQUFBLFFBQ2pCLElBQUksU0FBUztBQUFBLFFBQ2IsYUFBYSxTQUFTLFFBQVEsSUFBSTtBQUFBO0FBR3BDLFVBQUk7QUFDSixVQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGNBQU0sRUFBRSxTQUFTLGNBQWMsTUFBTSxlQUNuQyxNQUFNLEtBQUssbUJBQW1CO0FBQ2hDLGdCQUFRLElBQUksMEJBQTBCLEVBQUUsY0FBYztBQUV0RCxZQUNFLFNBQVMsV0FBVyxPQUNwQixpQkFBaUIsZ0NBQ2pCO0FBRUEsa0JBQVEsSUFDTjtBQUVGLGlCQUFPO0FBQUEsZUFDRjtBQUNMLGdCQUFNLElBQUksTUFDUiw4QkFBOEIsU0FBUyxZQUFZO0FBQUE7QUFBQSxhQUdsRDtBQUNMLGNBQU0sZUFBZSxNQUFNLFNBQVM7QUFDcEMsZ0JBQVEsSUFBSSxzQkFBc0I7QUFDbEMsWUFBSTtBQUNGLGlCQUFPLEtBQUssTUFBTTtBQUNsQixrQkFBUSxJQUFJLHlCQUF5QjtBQUFBLGlCQUM5QixHQUFQO0FBQ0Esa0JBQVEsTUFBTSxrQ0FBa0M7QUFDaEQsZ0JBQU0sSUFBSSxNQUFNO0FBQUE7QUFBQTtBQUtwQiwrQ0FBUyxlQUFULGlDQUFzQixJQUFJO0FBRTFCLGNBQVEsSUFBSSxzQkFBc0I7QUFBQSxRQUNoQyxTQUFTLENBQUMsQ0FBQztBQUFBLFFBQ1gsVUFBVSxPQUFPO0FBQUEsUUFDakIsTUFBTSxPQUFPLE9BQU8sS0FBSyxRQUFRO0FBQUEsUUFDakMsVUFBVSw4QkFBTSxRQUFPLE9BQU8sS0FBSyxPQUFPO0FBQUEsUUFDMUMsWUFBWSw4QkFBTSxRQUFPLEtBQUssS0FBSyxTQUFTO0FBQUEsUUFDNUMsYUFBYSw4QkFBTSxRQUFPLEtBQUssS0FBSyxVQUFVLEdBQUcsT0FBTyxRQUFRO0FBQUE7QUFJbEUsVUFBSSxDQUFDLFFBQVEsT0FBTyxLQUFLLFNBQVMsVUFBVTtBQUMxQyxnQkFBUSxNQUFNLDBCQUEwQjtBQUN4QyxjQUFNLElBQUksTUFBTTtBQUFBO0FBSWxCLFlBQU0sY0FBYyxLQUFLLEtBQUs7QUFDOUIsY0FBUSxJQUFJLGlCQUFpQjtBQUFBLFFBQzNCLFFBQVEsWUFBWTtBQUFBLFFBQ3BCLFNBQVMsWUFBWSxVQUFVLEdBQUcsT0FBTztBQUFBO0FBRzNDLFVBQUksQ0FBQyxhQUFhO0FBQ2hCLGdCQUFRLE1BQU0sNENBQTRDO0FBQzFELGNBQU0sSUFBSSxNQUFNO0FBQUE7QUFJbEIsVUFBSSxLQUFLLFdBQVc7QUFDbEIsZ0JBQVEsSUFBSSwrQkFBK0I7QUFBQSxVQUN6QyxVQUFVLEdBQUcsS0FBSyxVQUFVLDRCQUE0QixLQUFLLFVBQVU7QUFBQSxVQUN2RSxVQUFVLElBQUksS0FBSyxVQUFVLGFBQWEsUUFBUTtBQUFBLFVBQ2xELGFBQWEsR0FBSSxNQUFLLFVBQVUsY0FBYyxLQUFLLFFBQVE7QUFBQSxVQUMzRCxZQUFZLEdBQUcsS0FBSyxVQUFVO0FBQUEsVUFDOUIsV0FBVyxHQUFJLE1BQUssVUFBVSxrQkFBa0IsT0FBTyxNQUFNLFFBQzNEO0FBQUE7QUFBQTtBQU1OLCtDQUFTLGVBQVQsaUNBQXNCLEtBQUs7QUFFM0IsYUFBTztBQUFBLGFBQ0EsT0FBUDtBQUNBLGNBQVEsTUFBTSx3QkFBd0I7QUFDdEMsWUFBTTtBQUFBLGNBQ047QUFDQSxXQUFLLGlCQUFpQjtBQUFBO0FBQUE7QUFBQSxFQUkxQixTQUFTO0FBQUE7QUFBQTs7O0FDOU1YO0FBSU8sa0NBQTRCO0FBQUEsRUFLekIsWUFBb0IsUUFBNEI7QUFBNUI7QUFGcEIsMEJBQWdDO0FBR3RDLFNBQUssZ0JBQWdCLG9CQUFvQixZQUN2QyxPQUFPLFVBQ1AsT0FBTztBQUFBO0FBQUEsU0FJSixZQUFZLFFBQW1EO0FBQ3BFLFFBQUksQ0FBQyxzQkFBc0IsVUFBVTtBQUNuQyw0QkFBc0IsV0FBVyxJQUFJLHNCQUFzQjtBQUFBO0FBRTdELFdBQU8sc0JBQXNCO0FBQUE7QUFBQSxRQUdqQixtQkFBb0M7QUFDaEQsUUFBSSxLQUFLO0FBQWdCLGFBQU8sS0FBSztBQUVyQyxRQUFJO0FBQ0YsWUFBTSxTQUFTLE1BQU0sS0FBSyxjQUFjO0FBQ3hDLFlBQU0sZUFBZSxPQUFPLEtBQUssQ0FBQyxVQUFPO0FBNUIvQztBQTZCUSwyQkFBTSxTQUFOLG1CQUFZLE1BQU07QUFBQTtBQUVwQixVQUFJLENBQUMsY0FBYztBQUNqQixjQUFNLElBQUksTUFBTTtBQUFBO0FBRWxCLFdBQUssaUJBQWlCLGFBQWE7QUFDbkMsYUFBTyxhQUFhO0FBQUEsYUFDYixPQUFQO0FBQ0EsY0FBUSxNQUFNLGdDQUFnQztBQUM5QyxZQUFNO0FBQUE7QUFBQTtBQUFBLFFBSUoscUJBQXFCLE1BQStCO0FBQ3hELFFBQUksQ0FBQyxLQUFLLE9BQU8sU0FBUyx1QkFBdUI7QUFDL0MsYUFBTztBQUFBO0FBR1QsUUFBSTtBQUNGLFlBQU0sVUFBVSxNQUFNLEtBQUs7QUFDM0IsWUFBTSxXQUEwQjtBQUFBLFFBQzlCO0FBQUEsVUFDRSxNQUFNO0FBQUEsVUFDTixTQUFTLEtBQUssT0FBTyxTQUFTO0FBQUEsVUFDOUIsWUFBWSxPQUFPO0FBQUE7QUFBQSxRQUVyQjtBQUFBLFVBQ0UsTUFBTTtBQUFBLFVBQ04sU0FBUztBQUFBLFVBQ1QsWUFBWSxPQUFPO0FBQUE7QUFBQTtBQUl2QixVQUFJLGdCQUFnQjtBQUNwQix1QkFBaUIsU0FBUyxLQUFLLGNBQWMsY0FBYztBQUFBLFFBQ3pEO0FBQUEsUUFDQSxPQUFPO0FBQUEsUUFDUCxhQUFhO0FBQUEsVUFDWDtBQUNGLFlBQUksTUFBTSxTQUFTO0FBQ2pCLDJCQUFpQixNQUFNO0FBQUE7QUFBQTtBQUkzQixhQUFPLGNBQWM7QUFBQSxhQUNkLE9BQVA7QUFDQSxjQUFRLE1BQU0sd0NBQXdDO0FBRXRELGFBQU87QUFBQTtBQUFBO0FBQUE7OztBRjFEYixrREFBNEMseUJBQU87QUFBQSxFQUtqRCxjQUFjO0FBQ1osVUFBTSxJQUFJO0FBQ1YsU0FBSyxTQUFTLFNBQVM7QUFHdkIsVUFBTSxvQkFBb0IsS0FBSyxTQUFTLFVBQVU7QUFHbEQsVUFBTSxrQkFBa0Isa0JBQWtCLFVBQVU7QUFDcEQsU0FBSyxhQUFhLGdCQUFnQixVQUFVO0FBQzVDLFNBQUssYUFBYSxnQkFBZ0IsVUFBVTtBQUc1QyxVQUFNLHVCQUF1QixrQkFBa0IsVUFDN0M7QUFFRixTQUFLLGNBQWMscUJBQXFCLFVBQ3RDO0FBSUYsUUFBSSxDQUFDLFNBQVMsZUFBZSw2Q0FBNkM7QUFDeEUsWUFBTSxRQUFRLFNBQVMsY0FBYztBQUNyQyxZQUFNLEtBQUs7QUFDWCxZQUFNLGNBQWM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF1RHBCLGVBQVMsS0FBSyxZQUFZO0FBQUE7QUFBQTtBQUFBLEVBSTlCLGVBQWUsRUFBRSxVQUFVLFFBQVEsUUFBb0M7QUFDckUsU0FBSyxZQUFZLE1BQU0sUUFBUSxHQUFHO0FBQ2xDLFNBQUssV0FBVyxRQUFRO0FBQ3hCLFNBQUssV0FBVztBQUNoQixtQ0FBUSxLQUFLLFlBQVk7QUFHekIsU0FBSyxTQUFTLFlBQVksa0JBQWtCO0FBQzVDLFFBQUksYUFBYSxLQUFLO0FBQ3BCLFdBQUssU0FBUyxTQUFTO0FBQUEsZUFDZCxhQUFhLEtBQUssU0FBUyxZQUFZO0FBQ2hELFdBQUssU0FBUyxTQUFTO0FBQUE7QUFBQTtBQUFBO0FBS3RCLG9DQUE4QjtBQUFBLEVBTW5DLFlBQVksS0FBVSxTQUFvQztBQUN4RCxTQUFLLFVBQVU7QUFDZixTQUFLLHVCQUF1QixxQkFBcUIsWUFDL0MsUUFBUTtBQUVWLFNBQUssd0JBQXdCLHNCQUFzQixZQUNqRCxRQUFRO0FBQUE7QUFBQSxFQUlaLE9BQU87QUFDTCxTQUFLLFNBQVMsSUFBSTtBQUNsQixTQUFLO0FBQUE7QUFBQSxRQUdPLHFCQUFxQjtBQUNqQyxRQUFJO0FBRUYsV0FBSyxPQUFPLGVBQWU7QUFBQSxRQUN6QixVQUFVO0FBQUEsUUFDVixRQUFRO0FBQUEsUUFDUixNQUFNO0FBQUE7QUFHUixZQUFNLE9BQU8sTUFBTSxLQUFLLHFCQUFxQixlQUMzQyxLQUFLLFFBQVEsTUFDYjtBQUFBLFFBQ0UsTUFBTSxLQUFLLFFBQVEsU0FBUyxTQUFTO0FBQUEsUUFDckMsYUFBYSxLQUFLLFFBQVE7QUFBQSxRQUMxQixZQUFZLENBQUMsVUFBVSxXQUFXO0FBQ2hDLGVBQUssT0FBTyxlQUFlO0FBQUEsWUFDekI7QUFBQSxZQUNBO0FBQUEsWUFDQSxNQUFNO0FBQUE7QUFBQTtBQUFBO0FBTWQsVUFBSSxDQUFDLE1BQU07QUFDVCxjQUFNLElBQUksTUFBTTtBQUFBO0FBSWxCLFVBQUksWUFBWTtBQUNoQixVQUFJLGdCQUFnQjtBQUNwQixVQUFJLEtBQUssUUFBUSxPQUFPLFNBQVMsdUJBQXVCO0FBQ3RELGFBQUssT0FBTyxlQUFlO0FBQUEsVUFDekIsVUFBVTtBQUFBLFVBQ1YsUUFBUTtBQUFBLFVBQ1IsTUFBTTtBQUFBO0FBRVIsd0JBQWdCLE1BQU0sS0FBSyxzQkFBc0IscUJBQy9DO0FBSUYsb0JBQVk7QUFBQSxVQUNWLEtBQUssUUFBUSxLQUFLO0FBQUEsZUFDYixJQUFJLE9BQU87QUFBQTtBQUFBO0FBQUEsRUFHeEI7QUFBQTtBQUFBO0FBQUEsRUFHQTtBQUFBLGFBQ1c7QUFFTCxvQkFBWTtBQUFBLFVBQ1YsS0FBSyxRQUFRLEtBQUs7QUFBQSxlQUNiLElBQUksT0FBTztBQUFBO0FBQUE7QUFBQSxFQUd4QjtBQUFBO0FBSUksVUFBSSxLQUFLLFFBQVEseUJBQXlCO0FBQ3hDLGFBQUssUUFBUSx3QkFBd0I7QUFBQTtBQUl2QyxZQUFNLFVBQVUsVUFBVSxVQUFVO0FBR3BDLFdBQUssT0FBTyxlQUFlO0FBQUEsUUFDekIsVUFBVTtBQUFBLFFBQ1YsUUFBUTtBQUFBLFFBQ1IsTUFBTTtBQUFBO0FBSVIsaUJBQVcsTUFBTTtBQUNmLGFBQUssT0FBTztBQUFBLFNBQ1g7QUFBQSxhQUNJLE9BQVA7QUFDQSxjQUFRLE1BQU0sd0JBQXdCO0FBQ3RDLFdBQUssT0FBTyxlQUFlO0FBQUEsUUFDekIsVUFBVTtBQUFBLFFBQ1YsUUFBUSxVQUNOLGlCQUFpQixRQUFRLE1BQU0sVUFBVSxPQUFPO0FBQUEsUUFFbEQsTUFBTTtBQUFBO0FBSVIsaUJBQVcsTUFBTTtBQUNmLGFBQUssT0FBTztBQUFBLFNBQ1g7QUFBQTtBQUFBO0FBQUE7QUFLVCwyQ0FDRSxLQUNBLFNBQ2U7QUFDZixRQUFNLFFBQVEsSUFBSSx3QkFBd0IsS0FBSztBQUMvQyxRQUFNO0FBQUE7OztBR3ZQUix3QkFBZ0U7QUFDaEU7OztBQ0RBLHdCQUFxRDtBQXVCOUMsK0JBQXlCO0FBQUEsRUFJOUIsWUFBWSxLQUFVLGVBQXVCO0FBQzNDLFNBQUssTUFBTTtBQUNYLFNBQUssZ0JBQWdCO0FBQUE7QUFBQSxRQUdqQixTQUNKLFFBQ0EsVUFDQSxpQkFDQSxjQUNBLHNCQUNBLGtCQUNBLGtCQUNBLE9BQ0EsWUFDQSxzQkFDZTtBQUNmLFFBQUk7QUFDRixZQUFNLFdBQVcsR0FBRyxLQUFLLGlCQUFpQjtBQUcxQyxZQUFNLHFCQUFxQixlQUN2QixNQUFNLEtBQUssY0FBYyxJQUFJLENBQUMsU0FBUztBQUVyQyxjQUFNLGVBQWUsS0FBSyxTQUFTO0FBQ25DLGVBQU87QUFBQSxVQUNMO0FBQUEsVUFDQSxNQUFNLGVBQ0QsZUFDQTtBQUFBO0FBQUEsV0FHVDtBQUVKLFlBQU0sV0FBeUI7QUFBQSxRQUM3QixJQUFJO0FBQUEsUUFDSixPQUFPO0FBQUEsUUFDUCxTQUFTLElBQUksT0FBTztBQUFBLFFBQ3BCLGNBQWMsSUFBSSxPQUFPO0FBQUEsUUFDekIsT0FBTyxTQUFTO0FBQUEsUUFDaEIsZUFBZTtBQUFBLFFBQ2YsZUFBZSxtQkFDWDtBQUFBLFVBQ0UsTUFBTTtBQUFBLFVBQ04sTUFDRSxxQkFBcUIsWUFBWSxtQkFDN0IsS0FBSyx1QkFDTDtBQUFBLFVBQ047QUFBQSxVQUNBO0FBQUEsWUFFRjtBQUFBO0FBR04sWUFBTSxVQUFVO0FBQUEsRUFBUSxxQ0FBYztBQUFBO0FBQUEsRUFBbUIsU0FDdEQsSUFBSSxDQUFDLFFBQVE7QUFDWixjQUFNLGVBQWUseUNBQXlDLElBQUkscUJBQXFCLElBQUk7QUFDM0YsZUFBTyxHQUFHO0FBQUEsRUFBaUIsSUFBSTtBQUFBO0FBQUEsU0FFaEMsS0FBSztBQUVSLFlBQU0sS0FBSyxJQUFJLE1BQU0sUUFBUSxNQUFNLEtBQUs7QUFDeEMsWUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLE1BQU0sVUFBVTtBQUFBLGFBQ3RDLE9BQVA7QUFDQSxjQUFRLE1BQU0sd0JBQXdCO0FBQ3RDLFlBQU0sSUFBSSxNQUFNO0FBQUE7QUFBQTtBQUFBLFFBSWQsWUFVSjtBQUNBLFFBQUk7QUFDRixZQUFNLFFBQVEsTUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLEtBQUssS0FBSztBQUNyRCxZQUFNLFlBQVksTUFBTSxNQUFNLE9BQU8sQ0FBQyxNQUFNLEVBQUUsU0FBUztBQUV2RCxZQUFNLFFBQVEsTUFBTSxRQUFRLElBQzFCLFVBQVUsSUFBSSxPQUFPLGFBQWE7QUFDaEMsY0FBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sUUFBUSxLQUFLO0FBQ2xELGVBQU8sS0FBSyxxQkFBcUI7QUFBQTtBQUlyQyxhQUFPLE1BQU0sT0FDWCxDQUFDLFNBQTJDLFNBQVM7QUFBQSxhQUVoRCxPQUFQO0FBQ0EsY0FBUSxNQUFNLHlCQUF5QjtBQUN2QyxhQUFPO0FBQUE7QUFBQTtBQUFBLFFBSUwsU0FBUyxRQVNMO0FBQ1IsUUFBSTtBQUNGLFlBQU0sV0FBVyxHQUFHLEtBQUssaUJBQWlCO0FBQzFDLFlBQU0sT0FBTyxLQUFLLElBQUksTUFBTSxzQkFBc0I7QUFFbEQsVUFBSSxDQUFFLGlCQUFnQiwwQkFBUTtBQUM1QixlQUFPO0FBQUE7QUFHVCxZQUFNLFVBQVUsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLO0FBQzFDLGFBQU8sS0FBSyxxQkFBcUI7QUFBQSxhQUMxQixPQUFQO0FBQ0EsY0FBUSxNQUFNLHdCQUF3QjtBQUN0QyxhQUFPO0FBQUE7QUFBQTtBQUFBLEVBSUgsd0JBQ04sVUFDQSxVQUNRO0FBQ1IsVUFBTSxlQUFlO0FBQUEsTUFDbkIsbUJBQW1CO0FBQUEsU0FDaEI7QUFBQTtBQUdMLFVBQU0sa0JBQWtCO0FBQUEsTUFDdEI7QUFBQSxNQUNBLHFDQUFjLGNBQWM7QUFBQSxNQUM1QjtBQUFBLE1BQ0E7QUFBQSxNQUNBLEtBQUs7QUFFUCxVQUFNLGtCQUFrQixTQUNyQixJQUFJLENBQUMsUUFDSjtBQUFBLE1BQ0UseUNBQXlDLElBQUkscUJBQXFCLElBQUk7QUFBQSxNQUN0RSxJQUFJO0FBQUEsTUFDSjtBQUFBLE1BQ0E7QUFBQSxNQUNBLEtBQUssT0FFUixLQUFLO0FBRVIsV0FBTyxrQkFBa0I7QUFBQTtBQUFBLEVBR25CLGNBQWMsU0FBc0M7QUFDMUQsUUFBSTtBQUNGLFlBQU0sZ0JBQWdCLFFBQVEsTUFBTTtBQUNwQyxVQUFJLENBQUM7QUFBZSxlQUFPO0FBRTNCLFlBQU0sU0FBUyxpQ0FBVSxjQUFjO0FBQ3ZDLFVBQUksQ0FBQyxVQUFVLE9BQU8sV0FBVztBQUFVLGVBQU87QUFFbEQsWUFBTTtBQUFBLFFBQ0o7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxVQUNFO0FBQ0osVUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO0FBQWMsZUFBTztBQUd2RCxZQUFNLHdCQUF3QiwrQ0FBZSxJQUMzQyxDQUFDLFNBQStCO0FBQzlCLFlBQUksT0FBTyxTQUFTLFVBQVU7QUFFNUIsZ0JBQU0sZUFBZSxLQUFLLFNBQVM7QUFDbkMsaUJBQU87QUFBQSxZQUNMLE1BQU07QUFBQSxZQUNOLE1BQU0sZUFDRCxlQUNBO0FBQUE7QUFBQTtBQUdULGVBQU87QUFBQSxVQUNMLE1BQU0sS0FBSztBQUFBLFVBQ1gsTUFBTSxLQUFLO0FBQUE7QUFBQTtBQU1qQixVQUFJLCtDQUFlLE1BQU07QUFDdkIsc0JBQWMsT0FBTyxjQUFjLEtBQUssUUFDdEMsbUJBQ0E7QUFBQTtBQUlKLGFBQU87QUFBQSxRQUNMO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQSxPQUFPLFNBQVM7QUFBQSxRQUNoQixlQUFlLHlCQUF5QjtBQUFBLFFBQ3hDO0FBQUE7QUFBQSxhQUVLLE9BQVA7QUFDQSxjQUFRLE1BQU0sNkJBQTZCO0FBQzNDLGFBQU87QUFBQTtBQUFBO0FBQUEsUUFJRyxxQkFBcUIsU0FTekI7QUE5UFo7QUErUEksUUFBSTtBQUNGLFlBQU0sV0FBVyxLQUFLLGNBQWM7QUFDcEMsVUFBSSxDQUFDO0FBQVUsZUFBTztBQUV0QixZQUFNLFdBQTBCO0FBR2hDLFlBQU0sZUFDSjtBQUVGLFVBQUk7QUFDSixhQUFRLFlBQVcsYUFBYSxLQUFLLGNBQWMsTUFBTTtBQUN2RCxjQUFNLENBQUMsRUFBRSxNQUFNLFdBQVcsa0JBQWtCO0FBQzVDLGlCQUFTLEtBQUs7QUFBQSxVQUNaO0FBQUEsVUFDQSxTQUFTLGVBQWU7QUFBQSxVQUN4QixZQUFZO0FBQUE7QUFBQTtBQUtoQixZQUFNLGVBQWUsZUFBUyxrQkFBVCxtQkFBd0IsSUFBSSxDQUFDLFNBQ2hELE9BQU8sU0FBUyxXQUFXLE9BQU8sS0FBSztBQUd6QyxhQUFPO0FBQUEsUUFDTCxJQUFJLFNBQVM7QUFBQSxRQUNiO0FBQUEsUUFDQSxpQkFBaUIsU0FBUztBQUFBLFFBQzFCLGNBQWMsSUFBSSxLQUFLLFNBQVMsY0FBYztBQUFBLFFBQzlDLE9BQU8sU0FBUztBQUFBLFFBQ2hCLGVBQWU7QUFBQSxRQUNmLHNCQUFzQixlQUFTLGtCQUFULG1CQUF3QjtBQUFBLFFBQzlDLFlBQVksZUFBUyxrQkFBVCxtQkFBd0I7QUFBQTtBQUFBLGFBRS9CLE9BQVA7QUFDQSxjQUFRLE1BQU0scUNBQXFDO0FBQ25ELGFBQU87QUFBQTtBQUFBO0FBQUEsRUFJSCxvQkFBNEI7QUFDbEMsV0FBTyx1Q0FBdUMsUUFBUSxTQUFTLENBQUMsTUFBTTtBQUNwRSxZQUFNLElBQUssS0FBSyxXQUFXLEtBQU07QUFDakMsWUFBTSxJQUFJLE1BQU0sTUFBTSxJQUFLLElBQUksSUFBTztBQUN0QyxhQUFPLEVBQUUsU0FBUztBQUFBO0FBQUE7QUFBQSxRQUloQixZQUFZLFFBQThDO0FBQzlELFFBQUk7QUFDRixZQUFNLFdBQVcsR0FBRyxLQUFLLGlCQUFpQjtBQUMxQyxZQUFNLE9BQU8sS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBRWxELFVBQUksQ0FBRSxpQkFBZ0IsMEJBQVE7QUFDNUIsZUFBTztBQUFBO0FBR1QsWUFBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyxhQUFPLEtBQUssY0FBYztBQUFBLGFBQ25CLE9BQVA7QUFDQSxjQUFRLE1BQU0sMkJBQTJCO0FBQ3pDLGFBQU87QUFBQTtBQUFBO0FBQUE7OztBQzdUYix3QkFBeUI7QUFhbEIsaUNBQTJCO0FBQUEsRUFTaEMsWUFBWSxRQUFzQjtBQVIxQixpQkFBcUI7QUFBQSxNQUMzQixxQkFBcUI7QUFBQSxNQUNyQixpQkFBaUI7QUFBQSxNQUNqQixtQkFBbUI7QUFBQTtBQWtCYix3QkFBZSxnQ0FBUyxNQUFNO0FBQ3BDLFlBQU0sYUFBYSxLQUFLO0FBQ3hCLFVBQUksY0FBYyxDQUFDLEtBQUssTUFBTSxxQkFBcUI7QUFDakQsYUFBSztBQUFBLGlCQUNJLENBQUMsY0FBYyxLQUFLLE1BQU0scUJBQXFCO0FBQ3hELGFBQUs7QUFBQTtBQUFBLE9BRU47QUFFSyx1QkFBYyxDQUFDLE1BQWtCO0FBQ3ZDLFVBQUksRUFBRSxTQUFTLEdBQUc7QUFDaEIsYUFBSztBQUFBO0FBQUE7QUFJRCw0QkFBbUIsTUFBTTtBQUMvQixXQUFLLE1BQU0sa0JBQWtCO0FBQUE7QUFHdkIsMEJBQWlCLE1BQU07QUFDN0IsV0FBSyxNQUFNLGtCQUFrQjtBQUM3QixVQUFJLEtBQUssc0JBQXNCO0FBQzdCLGFBQUs7QUFBQTtBQUFBO0FBbENQLFNBQUssWUFBWSxPQUFPO0FBQ3hCLFNBQUssc0JBQXNCLE9BQU87QUFDbEMsU0FBSztBQUFBO0FBQUEsRUFHQyx1QkFBNkI7QUFDbkMsU0FBSyxVQUFVLGlCQUFpQixVQUFVLEtBQUs7QUFDL0MsU0FBSyxVQUFVLGlCQUFpQixTQUFTLEtBQUs7QUFDOUMsU0FBSyxVQUFVLGlCQUFpQixjQUFjLEtBQUs7QUFDbkQsU0FBSyxVQUFVLGlCQUFpQixZQUFZLEtBQUs7QUFBQTtBQUFBLEVBNkIzQyxxQkFBOEI7QUFDcEMsVUFBTSxFQUFFLGNBQWMsV0FBVyxpQkFBaUIsS0FBSztBQUN2RCxXQUFPLEtBQUssSUFBSSxlQUFlLFlBQVksZ0JBQWdCO0FBQUE7QUFBQSxFQUd0RCxpQkFBdUI7QUFDNUIsUUFBSSxDQUFDLEtBQUssTUFBTTtBQUFxQjtBQUlyQyxTQUFLLEtBQUssVUFBVTtBQUVwQiwwQkFBc0IsTUFBTTtBQUMxQixXQUFLLFVBQVUsU0FBUztBQUFBLFFBQ3RCLEtBQUssS0FBSyxVQUFVO0FBQUEsUUFDcEIsVUFBVSxLQUFLLE1BQU0sa0JBQWtCLFdBQVc7QUFBQTtBQUVwRCxXQUFLLE1BQU0sb0JBQW9CLEtBQUssVUFBVTtBQUFBO0FBQUE7QUFBQSxFQUkxQyxtQkFBeUI7QUFsRm5DO0FBbUZJLFNBQUssTUFBTSxzQkFBc0I7QUFDakMsU0FBSyxNQUFNLGtCQUFrQjtBQUM3QixTQUFLLE1BQU0sb0JBQW9CLEtBQUssVUFBVTtBQUM5QyxTQUFLO0FBQ0wsZUFBSyx3QkFBTCw4QkFBMkI7QUFBQTtBQUFBLEVBR3JCLG9CQUEwQjtBQTFGcEM7QUEyRkksU0FBSyxNQUFNLHNCQUFzQjtBQUNqQyxlQUFLLHdCQUFMLDhCQUEyQjtBQUFBO0FBQUEsRUFHdEIsc0JBQTRCO0FBRWpDLFNBQUssS0FBSyxVQUFVO0FBRXBCLDBCQUFzQixNQUFNO0FBQzFCLFlBQU0sZ0JBQWdCLEtBQUssVUFBVTtBQUNyQyxVQUFJLGtCQUFrQixLQUFLLE1BQU0sbUJBQW1CO0FBQ2xELGFBQUssTUFBTSxvQkFBb0I7QUFFL0IsWUFBSSxDQUFDLEtBQUssVUFBVSxhQUFhLEtBQUssc0JBQXNCO0FBQzFELGVBQUs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTU4sVUFBZ0I7QUFDckIsU0FBSyxVQUFVLG9CQUFvQixVQUFVLEtBQUs7QUFDbEQsU0FBSyxVQUFVLG9CQUFvQixTQUFTLEtBQUs7QUFDakQsU0FBSyxVQUFVLG9CQUFvQixjQUFjLEtBQUs7QUFDdEQsU0FBSyxVQUFVLG9CQUFvQixZQUFZLEtBQUs7QUFBQTtBQUFBOzs7QUY1R3hEO0FBQ0E7OztBR1JBLHdCQUEwQjtBQVNuQixvQ0FBOEIsNEJBQVU7QUFBQSxFQVM3QyxZQUFZLFNBQXdCO0FBQ2xDO0FBTE0sOEJBQXFCO0FBQ3JCLHVCQUFxQztBQUszQyxTQUFLLFVBQVU7QUFDZixTQUFLO0FBQ0wsU0FBSztBQUFBO0FBQUEsRUFHQyxtQkFBeUI7QUFDL0IsU0FBSyxTQUFTLEtBQUssUUFBUSxVQUFVLFNBQVMsT0FBTztBQUFBLE1BQ25ELEtBQUssdUJBQXVCLEtBQUssUUFBUSxPQUFPO0FBQUE7QUFHbEQsU0FBSyxTQUFTLEtBQUssT0FBTyxTQUFTLE9BQU87QUFBQSxNQUN4QyxLQUFLO0FBQUE7QUFHUCxVQUFNLFVBQVUsS0FBSyxPQUFPLFNBQVMsT0FBTztBQUFBLE1BQzFDLEtBQUs7QUFBQTtBQUVQLFlBQVEsV0FBVyxFQUFFLE1BQU0sS0FBSyxRQUFRO0FBRXhDLFNBQUssU0FBUyxLQUFLLE9BQU8sV0FBVztBQUFBLE1BQ25DLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUdSLFNBQUssVUFBVSxLQUFLLE9BQU8sU0FBUyxPQUFPO0FBQUEsTUFDekMsS0FBSztBQUFBO0FBR1AsU0FBSyxjQUFjO0FBQUE7QUFBQSxFQUdiLHNCQUE0QjtBQUNsQyxTQUFLLE9BQU8saUJBQWlCLGNBQWMsTUFBTTtBQUMvQyxXQUFLLHFCQUFxQjtBQUMxQixXQUFLO0FBQ0wsV0FBSyxjQUFjLE1BQU07QUFBQTtBQUczQixTQUFLLFFBQVEsaUJBQWlCLGNBQWMsTUFBTTtBQUNoRCxXQUFLLHFCQUFxQjtBQUMxQixXQUFLO0FBQ0wsV0FBSyxjQUFjLE1BQU07QUFBQTtBQUczQixTQUFLLE9BQU8saUJBQWlCLGNBQWMsQ0FBQyxNQUFNO0FBQ2hELFlBQU0sT0FBTyxLQUFLLE9BQU87QUFDekIsWUFBTSxTQUFTO0FBRWYsVUFDRSxFQUFFLFdBQVcsS0FBSyxVQUNsQixFQUFFLFdBQVcsS0FBSyxTQUFTLFVBQzNCLEVBQUUsV0FBVyxLQUFLLFFBQ2xCLEVBQUUsV0FBVyxLQUFLLE9BQ2xCO0FBQ0E7QUFBQTtBQUdGLFdBQUsscUJBQXFCO0FBQzFCLFdBQUs7QUFBQTtBQUdQLFNBQUssUUFBUSxpQkFBaUIsY0FBYyxDQUFDLE1BQU07QUFDakQsWUFBTSxPQUFPLEtBQUssUUFBUTtBQUMxQixZQUFNLFNBQVM7QUFFZixVQUNFLEVBQUUsV0FBVyxLQUFLLE9BQ2xCLEVBQUUsV0FBVyxLQUFLLE1BQU0sVUFDeEIsRUFBRSxXQUFXLEtBQUssUUFDbEIsRUFBRSxXQUFXLEtBQUssT0FDbEI7QUFDQTtBQUFBO0FBR0YsV0FBSyxxQkFBcUI7QUFDMUIsV0FBSztBQUFBO0FBQUE7QUFBQSxFQUlELG1CQUF5QjtBQUMvQixRQUFJLEtBQUssYUFBYTtBQUNwQixtQkFBYSxLQUFLO0FBQ2xCLFdBQUssY0FBYztBQUFBO0FBQUE7QUFBQSxFQUlmLGVBQXFCO0FBQzNCLFNBQUs7QUFDTCxTQUFLLGNBQWMsV0FBVyxNQUFNO0FBQ2xDLFVBQUksQ0FBQyxLQUFLLG9CQUFvQjtBQUM1QixhQUFLLGNBQWM7QUFBQTtBQUFBLE9BRXBCO0FBQUE7QUFBQSxFQUdFLGNBQWMsU0FBa0IsV0FBb0IsT0FBYTtBQUN0RSxTQUFLLFFBQVEsTUFBTSxVQUFVLFVBQVUsTUFBTTtBQUM3QyxTQUFLLFFBQVEsTUFBTSxnQkFBZ0IsVUFBVSxRQUFRO0FBQ3JELFNBQUssUUFBUSxNQUFNLFlBQVksY0FBYyxVQUFVLE1BQU07QUFDN0QsU0FBSyxPQUFPLE1BQU0sWUFBWSxVQUFVLGNBQWM7QUFFdEQsUUFBSSxLQUFLLFFBQVEsb0JBQW9CO0FBQ25DLFdBQUssUUFBUSxtQkFBbUI7QUFBQTtBQUFBO0FBQUEsRUFJN0IsYUFBMEI7QUFDL0IsV0FBTyxLQUFLO0FBQUE7QUFBQSxFQUdQLFlBQXlCO0FBQzlCLFdBQU8sS0FBSztBQUFBO0FBQUEsRUFHUCxZQUF5QjtBQUM5QixXQUFPLEtBQUs7QUFBQTtBQUFBLEVBR2QsV0FBaUI7QUFDZixTQUFLO0FBQ0wsVUFBTTtBQUFBO0FBQUE7OztBQzVJVix3QkFBaUU7QUFFakU7QUFTTyxvQ0FBOEIsNEJBQVU7QUFBQSxFQUc3QyxZQUFZLEtBQVU7QUFDcEI7QUFDQSxTQUFLLE1BQU07QUFBQTtBQUFBLFFBR0EsY0FBYztBQUFBLElBQ3pCO0FBQUEsSUFDQTtBQUFBLElBQ0E7QUFBQSxJQUNBO0FBQUEsS0FNOEQ7QUFDOUQsVUFBTSxZQUFZLFNBQVMsY0FBYztBQUN6QyxjQUFVLFVBQVUsSUFBSTtBQUN4QixjQUFVLFVBQVUsSUFBSSxnQkFBZ0I7QUFDeEMsY0FBVSxRQUFRLFlBQVk7QUFFOUIsVUFBTSxZQUFZLFVBQVUsU0FBUyxPQUFPO0FBQUEsTUFDMUMsS0FBSztBQUFBO0FBR1AsUUFBSSxPQUFPLFlBQVksVUFBVTtBQUUvQixZQUFNLG1DQUFpQixlQUFlLFNBQVMsV0FBVyxJQUFJO0FBQUEsZUFDckQsTUFBTSxRQUFRLFVBQVU7QUFDakMsWUFBTSxRQUFRO0FBQ2QsaUJBQVcsUUFBUSxPQUFPO0FBQ3hCLFlBQUksS0FBSyxTQUFTLFFBQVE7QUFFeEIsZ0JBQU0sSUFBSSxVQUFVLFNBQVM7QUFDN0IsWUFBRSxRQUFRLEtBQUs7QUFBQSxtQkFDTixLQUFLLFNBQVMsYUFBYTtBQUVwQyxnQkFBTSxNQUFNLFVBQVUsU0FBUyxPQUFPO0FBQUEsWUFDcEMsTUFBTSxFQUFFLEtBQUssS0FBSyxVQUFVO0FBQUE7QUFFOUIsY0FBSSxVQUFVLElBQUk7QUFBQTtBQUFBO0FBQUEsV0FHakI7QUFFTCxZQUFNLG1DQUFpQixlQUNyQixPQUFPLFVBQ1AsV0FDQSxJQUNBO0FBQUE7QUFHSixTQUFLLG1CQUFtQjtBQUV4QixXQUFPLEVBQUUsV0FBVztBQUFBO0FBQUEsUUFHVCxzQkFDWCxTQUNBLGFBQ2U7QUFDZixnQkFBWTtBQUVaLFVBQU0sa0JBQWtCLFlBQVksU0FBUyxPQUFPO0FBQUEsTUFDbEQsS0FBSztBQUFBO0FBR1AsVUFBTSxvQkFBb0IsUUFBUSxRQUFRLFdBQVc7QUFFckQsVUFBTSxtQ0FBaUIsZUFDckIsbUJBQ0EsaUJBQ0EsSUFDQTtBQUdGLG9CQUFnQixpQkFBaUIsT0FBTyxRQUFRLENBQUMsVUFBVTtBQTFGL0Q7QUEyRk0sWUFBTSxtQkFBbUIsU0FBUyxPQUFPO0FBQUEsUUFDdkMsS0FBSztBQUFBO0FBR1Asa0JBQU0sZUFBTixtQkFBa0IsYUFBYSxrQkFBa0I7QUFDakQsdUJBQWlCLFlBQVk7QUFBQTtBQUFBO0FBQUEsRUFJMUIsbUJBQW1CLGFBQWdDO0FBQ3hELGdCQUFZLGlCQUFpQixPQUFPLFFBQVEsQ0FBQyxRQUFRO0FBQ25ELFVBQUksTUFBTSxTQUFTO0FBQ25CLFVBQUksaUJBQWlCLFNBQVMsT0FBTyxNQUFNO0FBQ3pDLFVBQUU7QUFDRixVQUFFO0FBRUYsY0FBTSxNQUFNLElBQUksYUFBYTtBQUM3QixZQUFJLENBQUM7QUFBSztBQUVWLFlBQUksSUFBSSxXQUFXLFdBQVc7QUFDNUIsZ0JBQU0sT0FBTyxJQUFJLFFBQVEsZ0JBQWdCO0FBQ3pDLGVBQUssSUFBSSxVQUFVLGFBQWEsTUFBTSxJQUFJO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU0xQyxxQkFDTixTQUNBLFNBQ0EsV0FBb0IsT0FDZDtBQUNOLFlBQVEsTUFBTSxVQUFVLFVBQVUsTUFBTTtBQUN4QyxZQUFRLE1BQU0sZ0JBQWdCLFVBQVUsUUFBUTtBQUNoRCxZQUFRLE1BQU0sWUFBWSwwQkFDeEIsV0FBVyxNQUFNO0FBQUE7QUFBQSxFQUlkLHdCQUNMLFdBQ0EsU0FDQSxNQUNBLFdBQ007QUFDTixVQUFNLGdCQUFnQixVQUFVLFNBQVMsT0FBTztBQUFBLE1BQzlDLEtBQUs7QUFBQTtBQUdQLFVBQU0sYUFBYSxjQUFjLFNBQVMsVUFBVTtBQUFBLE1BQ2xELEtBQUs7QUFBQTtBQUVQLGVBQVcsYUFBYSxTQUFTO0FBQ2pDLG1DQUFRLFlBQVk7QUFDcEIsZUFBVyxpQkFBaUIsU0FBUyxNQUFNO0FBQ3pDLGdCQUFVLFVBQVUsVUFBVTtBQUM5QixxQ0FBUSxZQUFZO0FBQ3BCLGlCQUFXLFVBQVUsSUFBSTtBQUV6QixpQkFBVyxNQUFNO0FBQ2YsdUNBQVEsWUFBWTtBQUNwQixtQkFBVyxVQUFVLE9BQU87QUFDNUIsYUFBSyxxQkFBcUIsZUFBZTtBQUFBLFNBQ3hDO0FBQUE7QUFHTCxRQUFJLFNBQVMsUUFBUTtBQUNuQixZQUFNLGlCQUFpQixjQUFjLFNBQVMsVUFBVTtBQUFBLFFBQ3RELEtBQUs7QUFBQTtBQUVQLHFCQUFlLGFBQWEsU0FBUztBQUNyQyxxQ0FBUSxnQkFBZ0I7QUFDeEIscUJBQWUsUUFBUSxlQUFlO0FBRXRDLHFCQUFlLGlCQUFpQixTQUFTLE9BQU8sTUFBTTtBQUNwRCxVQUFFO0FBQ0YsY0FBTSxlQUFlLGVBQWUsUUFBUSxlQUFlO0FBRTNELFlBQUksQ0FBQyxjQUFjO0FBQ2pCLHlCQUFlLFFBQVEsYUFBYTtBQUNwQyx5QkFBZTtBQUNmLHlCQUFlLFNBQVMsUUFBUSxFQUFFLE1BQU07QUFDeEMseUJBQWUsVUFBVSxJQUFJLGNBQWM7QUFFM0MsZ0JBQU0sWUFBWSxXQUFXLE1BQU07QUFDakMsMkJBQWU7QUFDZixrQkFBTSxlQUNKLGVBQWUsUUFBUSxnQkFBZ0I7QUFDekMsMkNBQVEsZ0JBQWdCO0FBQ3hCLDJCQUFlLFVBQVUsT0FBTyxjQUFjO0FBQzlDLDJCQUFlLFFBQVEsYUFBYTtBQUFBLGFBQ25DO0FBQ0gseUJBQWUsUUFBUSxZQUFZLFVBQVU7QUFBQSxlQUN4QztBQUNMLGdCQUFNLFlBQVksZUFBZSxRQUFRO0FBQ3pDLGNBQUksV0FBVztBQUNiLHlCQUFhLFNBQVM7QUFBQTtBQUV4Qix5QkFBZTtBQUNmLHlCQUFlLFNBQVMsUUFBUSxFQUFFLE1BQU07QUFFeEMsb0JBQVUsY0FDUixJQUFJLFlBQVksWUFBWTtBQUFBLFlBQzFCLFNBQVM7QUFBQSxZQUNULFFBQVEsRUFBRSxXQUFXO0FBQUE7QUFJekIscUJBQVcsTUFBTTtBQUNmLDJCQUFlO0FBQ2Ysa0JBQU0sZUFDSixlQUFlLFFBQVEsZ0JBQWdCO0FBQ3pDLDJDQUFRLGdCQUFnQjtBQUN4QiwyQkFBZSxVQUFVLE9BQU8sY0FBYztBQUM5QywyQkFBZSxRQUFRLGFBQWE7QUFBQSxhQUNuQztBQUFBO0FBQUE7QUFBQTtBQU1ULFVBQU0sYUFBYSxjQUFjLFNBQVMsVUFBVTtBQUFBLE1BQ2xELEtBQUs7QUFBQTtBQUVQLGVBQVcsYUFBYSxTQUFTO0FBQ2pDLG1DQUFRLFlBQVk7QUFDcEIsZUFBVyxRQUFRLGVBQWU7QUFHbEMsZUFBVyxpQkFBaUIsU0FBUyxPQUFPLE1BQU07QUFDaEQsUUFBRTtBQUlGLFlBQU0saUJBQWlCLFVBQVUsUUFBUSxXQUFXO0FBQ3BELFlBQU0sUUFBUSxJQUFJLGNBQ2hCLEtBQUssS0FDTCxnQkFDQSxnQkFDQTtBQUFBLFFBQ0UsZUFBZTtBQUFBLFFBQ2YsaUJBQWlCO0FBQUEsUUFDakIsTUFBTTtBQUFBO0FBSVYsWUFBTSxVQUFVLE1BQU0sTUFBTTtBQUM1QixVQUFJLFlBQVksUUFBUSxZQUFZLGdCQUFnQjtBQUVsRCxrQkFBVSxjQUNSLElBQUksWUFBWSxRQUFRO0FBQUEsVUFDdEIsU0FBUztBQUFBLFVBQ1QsUUFBUTtBQUFBLFlBQ047QUFBQSxZQUNBLFlBQVk7QUFBQSxZQUNaLFlBQVk7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU90QixVQUFNLGVBQWUsY0FBYyxTQUFTLFVBQVU7QUFBQSxNQUNwRCxLQUFLO0FBQUE7QUFFUCxpQkFBYSxhQUFhLFNBQVM7QUFDbkMsbUNBQVEsY0FBYztBQUN0QixpQkFBYSxRQUFRLGVBQWU7QUFFcEMsaUJBQWEsaUJBQWlCLFNBQVMsT0FBTyxNQUFNO0FBQ2xELFFBQUU7QUFDRixZQUFNLGVBQWUsYUFBYSxRQUFRLGVBQWU7QUFFekQsVUFBSSxDQUFDLGNBQWM7QUFDakIscUJBQWEsUUFBUSxhQUFhO0FBQ2xDLHFCQUFhO0FBQ2IscUJBQWEsU0FBUyxRQUFRLEVBQUUsTUFBTTtBQUN0QyxxQkFBYSxVQUFVLElBQUk7QUFFM0IsY0FBTSxZQUFZLFdBQVcsTUFBTTtBQUNqQyx1QkFBYTtBQUNiLGdCQUFNLGVBQWUsYUFBYSxRQUFRLGdCQUFnQjtBQUMxRCx5Q0FBUSxjQUFjO0FBQ3RCLHVCQUFhLFVBQVUsT0FBTztBQUM5Qix1QkFBYSxRQUFRLGFBQWE7QUFBQSxXQUNqQztBQUNILHFCQUFhLFFBQVEsWUFBWSxVQUFVO0FBQUEsYUFDdEM7QUFDTCxjQUFNLFlBQVksYUFBYSxRQUFRO0FBQ3ZDLFlBQUksV0FBVztBQUNiLHVCQUFhLFNBQVM7QUFBQTtBQUV4QixxQkFBYTtBQUNiLHFCQUFhLFNBQVMsUUFBUSxFQUFFLE1BQU07QUFFdEMsa0JBQVUsY0FDUixJQUFJLFlBQVksVUFBVTtBQUFBLFVBQ3hCLFNBQVM7QUFBQSxVQUNULFFBQVEsRUFBRTtBQUFBO0FBSWQsbUJBQVcsTUFBTTtBQUNmLHVCQUFhO0FBQ2IsZ0JBQU0sZUFBZSxhQUFhLFFBQVEsZ0JBQWdCO0FBQzFELHlDQUFRLGNBQWM7QUFDdEIsdUJBQWEsVUFBVSxPQUFPO0FBQzlCLHVCQUFhLFFBQVEsYUFBYTtBQUFBLFdBQ2pDO0FBQUE7QUFBQTtBQUlQLGNBQVUsaUJBQWlCLGNBQWMsTUFBTTtBQUM3QyxXQUFLLHFCQUFxQixlQUFlLE1BQU07QUFBQTtBQUdqRCxjQUFVLGlCQUFpQixjQUFjLENBQUMsTUFBa0I7QUFDMUQsVUFDRSxDQUFDLEVBQUUsaUJBQ0gsQ0FBQyxjQUFjLFNBQVMsRUFBRSxnQkFDMUI7QUFDQSxhQUFLLHFCQUFxQixlQUFlO0FBQUE7QUFBQTtBQUk3QyxrQkFBYyxpQkFBaUIsY0FBYyxDQUFDLE1BQWtCO0FBQzlELFVBQUksQ0FBQyxFQUFFLGlCQUFpQixDQUFDLFVBQVUsU0FBUyxFQUFFLGdCQUF3QjtBQUNwRSxhQUFLLHFCQUFxQixlQUFlO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLeEMseUJBQXlCLFdBRzlCO0FBQ0EsVUFBTSxZQUFZLFVBQVUsU0FBUyxPQUFPO0FBQUEsTUFDMUMsS0FBSztBQUFBO0FBR1AsVUFBTSxTQUFTLFVBQVUsU0FBUyxPQUFPO0FBQUEsTUFDdkMsS0FBSztBQUFBO0FBRVAsbUNBQVEsUUFBUTtBQUNoQixXQUFPLFdBQVcsRUFBRSxNQUFNO0FBRzFCLFdBQU8saUJBQWlCLFNBQVMsTUFBTTtBQUNyQyxnQkFBVSxVQUFVLE9BQU87QUFBQTtBQUc3QixVQUFNLFVBQVUsVUFBVSxTQUFTLE9BQU87QUFBQSxNQUN4QyxLQUFLO0FBQUE7QUFHUCxXQUFPLEVBQUUsV0FBVztBQUFBO0FBQUEsRUFHZix1QkFDTCxXQUNBLFdBQ0EsYUFBc0IsT0FDaEI7QUFDTixRQUFJLFlBQVksVUFBVSxjQUN4QjtBQUVGLFFBQUksVUFBVSxVQUFVLGNBQWM7QUFFdEMsUUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTO0FBQzFCLFlBQU0sV0FBVyxLQUFLLHlCQUF5QjtBQUMvQyxrQkFBWSxTQUFTO0FBQ3JCLGdCQUFVLFNBQVM7QUFDbkIsZ0JBQVUsUUFBUTtBQUFBO0FBR3BCLFlBQVEsY0FBYztBQUN0QixjQUFVLFVBQVUsSUFBSTtBQUd4QixRQUFJLFlBQVk7QUFDZCxnQkFBVSxVQUFVLElBQUk7QUFBQTtBQUFBO0FBQUE7OztBQ25YOUIsd0JBQXVEO0FBR3ZEO0FBQ0E7QUFDQTs7O0FDTEEsd0JBQW1DO0FBTzVCLGdDQUEwQjtBQUFBLEVBT3ZCLGNBQWM7QUFMZCxpQkFBNkIsSUFBSTtBQUNqQyxxQkFBeUMsSUFBSTtBQUM3QyxxQkFBWTtBQUtsQixTQUFLLG1CQUFtQixLQUFLLGlCQUFpQixLQUFLO0FBQ25ELFNBQUssbUJBQW1CLEtBQUssaUJBQWlCLEtBQUs7QUFDbkQsU0FBSyxtQkFBbUIsS0FBSyxpQkFBaUIsS0FBSztBQUFBO0FBQUEsRUFHN0MsaUJBQWlCLE1BQW1CO0FBQzFDLFFBQUksZ0JBQWdCLHlCQUFPO0FBQ3pCLFdBQUssVUFBVSxPQUFPLEtBQUs7QUFBQTtBQUFBO0FBQUEsRUFJdkIsaUJBQWlCLE1BQW1CO0FBQzFDLFFBQUksZ0JBQWdCLHlCQUFPO0FBQ3pCLFdBQUssVUFBVSxPQUFPLEtBQUs7QUFBQTtBQUFBO0FBQUEsRUFJdkIsaUJBQWlCLE1BQWEsU0FBdUI7QUFDM0QsUUFBSSxnQkFBZ0IseUJBQU87QUFDekIsV0FBSyxVQUFVLE9BQU87QUFBQTtBQUFBO0FBQUEsU0FJbkIsY0FBbUM7QUFDeEMsUUFBSSxDQUFDLG9CQUFvQixVQUFVO0FBQ2pDLDBCQUFvQixXQUFXLElBQUk7QUFBQTtBQUVyQyxXQUFPLG9CQUFvQjtBQUFBO0FBQUEsRUFHN0IsT0FBTyxLQUFnQjtBQUNyQixTQUFLLE1BQU07QUFHWCxTQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsS0FBSztBQUNqQyxTQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsS0FBSztBQUNqQyxTQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsS0FBSztBQUFBO0FBQUEsUUFHN0Isa0JBQWtCLE1BQThCO0FBRXBELFVBQU0sU0FBUyxLQUFLLFVBQVUsSUFBSSxLQUFLO0FBQ3ZDLFFBQUksVUFBVSxPQUFPLFVBQVUsS0FBSyxLQUFLLE9BQU87QUFDOUMsYUFBTyxPQUFPO0FBQUE7QUFJaEIsVUFBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyxVQUFNLFNBQVMsS0FBSyxzQkFBc0I7QUFHMUMsU0FBSyxVQUFVLElBQUksS0FBSyxNQUFNO0FBQUEsTUFDNUI7QUFBQSxNQUNBLE9BQU8sS0FBSyxLQUFLO0FBQUE7QUFHbkIsV0FBTztBQUFBO0FBQUEsRUFHVCxzQkFBc0IsTUFBc0I7QUFDMUMsUUFBSSxDQUFDO0FBQU0sYUFBTztBQUdsQixVQUFNLFdBQVcsR0FBRyxLQUFLLE1BQU0sR0FBRyxRQUFRLEtBQUs7QUFDL0MsVUFBTSxTQUFTLEtBQUssTUFBTSxJQUFJO0FBQzlCLFFBQUksV0FBVztBQUFXLGFBQU87QUFHakMsV0FBTyxLQUFLLFFBQVEsUUFBUSxLQUFLO0FBRWpDLFFBQUksYUFBYTtBQUdqQixVQUFNLGlCQUFpQjtBQUFBLE1BQ3JCO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQTtBQUlGLGVBQVcsV0FBVyxnQkFBZ0I7QUFDcEMsWUFBTSxVQUFVLEtBQUssTUFBTTtBQUMzQixVQUFJLFNBQVM7QUFDWCxzQkFBYyxRQUFRLE9BQU8sQ0FBQyxLQUFLLFVBQVU7QUFFM0MsY0FBSSxNQUFNLFdBQVcsU0FBUztBQUM1QixtQkFBTyxNQUFNLEtBQUssS0FBSyxNQUFNLFNBQVM7QUFBQSxxQkFDN0IsTUFBTSxVQUFVLEdBQUc7QUFDNUIsbUJBQU8sTUFBTTtBQUFBLGlCQUNSO0FBQ0wsbUJBQU8sTUFBTSxLQUFLLEtBQUssTUFBTSxTQUFTO0FBQUE7QUFBQSxXQUV2QztBQUNILGVBQU8sS0FBSyxRQUFRLFNBQVM7QUFBQTtBQUFBO0FBS2pDLFVBQU0sUUFBUSxLQUFLLE1BQU0sT0FBTyxPQUFPLENBQUMsTUFBTSxFQUFFLFNBQVM7QUFDekQsZUFBVyxRQUFRLE9BQU87QUFFeEIsVUFBSSxhQUFhO0FBR2pCLFVBQUksS0FBSyxTQUFTLEdBQUc7QUFDbkIsc0JBQWMsS0FBSyxNQUFPLE1BQUssU0FBUyxLQUFLO0FBQUE7QUFJL0MsVUFBSSxhQUFhLEtBQUssT0FBTztBQUMzQixzQkFBZSxNQUFLLE1BQU0sYUFBYSxJQUFJO0FBQUE7QUFJN0MsWUFBTSxXQUFZLE1BQUssTUFBTSxvQkFBb0IsSUFBSTtBQUNyRCxVQUFJLFdBQVcsR0FBRztBQUNoQixzQkFBYyxLQUFLLEtBQUssV0FBVztBQUFBO0FBR3JDLG9CQUFjO0FBQUE7QUFJaEIsaUJBQWEsS0FBSyxLQUFLLGFBQWE7QUFHcEMsU0FBSyxZQUFZLFVBQVU7QUFFM0IsV0FBTztBQUFBO0FBQUEsRUFHRCxZQUFZLEtBQWEsT0FBcUI7QUFDcEQsUUFBSSxLQUFLLE1BQU0sUUFBUSxLQUFLLFdBQVc7QUFDckMsWUFBTSxXQUFXLEtBQUssTUFBTSxPQUFPLE9BQU87QUFDMUMsV0FBSyxNQUFNLE9BQU87QUFBQTtBQUVwQixTQUFLLE1BQU0sSUFBSSxLQUFLO0FBQUE7QUFBQSxFQUd0QixhQUFtQjtBQUNqQixTQUFLLE1BQU07QUFDWCxTQUFLLFVBQVU7QUFBQTtBQUFBLEVBR2pCLFNBQWU7QUFFYixRQUFJLEtBQUssS0FBSztBQUNaLFdBQUssSUFBSSxNQUFNLElBQUksVUFBVSxLQUFLO0FBQ2xDLFdBQUssSUFBSSxNQUFNLElBQUksVUFBVSxLQUFLO0FBQ2xDLFdBQUssSUFBSSxNQUFNLElBQUksVUFBVSxLQUFLO0FBQUE7QUFBQTtBQUFBLEVBSXRDLGlCQUFpQixPQUF1QjtBQUN0QyxRQUFJLFVBQVU7QUFBRyxhQUFPO0FBQ3hCLFFBQUksUUFBUTtBQUFLLGFBQU87QUFDeEIsUUFBSSxTQUFTLEtBQU07QUFFakIsWUFBTSxNQUFNLEtBQUssS0FBSyxRQUFRO0FBQzlCLGFBQU8sSUFBSTtBQUFBLFdBQ047QUFFTCxZQUFNLGFBQWEsS0FBSyxLQUFLLFFBQVEsT0FBTztBQUM1QyxhQUFPLElBQUk7QUFBQTtBQUFBO0FBQUE7OztBRHJKVixpQ0FBMkIsNEJBQVU7QUFBQSxFQW1DMUMsWUFBWSxTQUE4QjtBQUN4QztBQWxCTSx3QkFBZTtBQUNmLHlCQUF1QztBQUt2Qyw4QkFBeUM7QUFDekMsdUJBQWM7QUFFZCwyQkFBMEM7QUFDMUMsc0JBQWlDO0FBR2pDLDZCQUEyQztBQUUzQyw0QkFBbUI7QUFJekIsU0FBSyxNQUFNLFFBQVE7QUFDbkIsU0FBSyxZQUFZLFFBQVE7QUFDekIsU0FBSyxZQUFZLFFBQVE7QUFDekIsU0FBSyxjQUFjLFFBQVE7QUFDM0IsU0FBSyxxQkFBcUIsUUFBUTtBQUNsQyxTQUFLLGtCQUFrQixRQUFRO0FBQy9CLFNBQUssa0JBQWtCLFFBQVE7QUFDL0IsU0FBSyxnQkFBZ0IsUUFBUTtBQUM3QixTQUFLLGdCQUFnQixRQUFRO0FBQzdCLFNBQUssa0JBQWtCLFFBQVE7QUFDL0IsU0FBSyxrQkFBa0IsUUFBUTtBQUMvQixTQUFLLHNCQUFzQixRQUFRO0FBQ25DLFNBQUssbUJBQW1CLFFBQVE7QUFDaEMsU0FBSyxVQUFVLFFBQVE7QUFDdkIsU0FBSyxtQkFBbUIsUUFBUTtBQUNoQyxTQUFLLHFCQUFxQixRQUFRO0FBQ2xDLFNBQUssU0FBUyxRQUFRO0FBQ3RCLFNBQUssV0FBVyxRQUFRO0FBRXhCLFlBQVEsSUFBSTtBQUNaLFNBQUssa0JBQWtCLGdCQUFnQixZQUFZLEtBQUssS0FBSyxLQUFLLFFBQVE7QUFBQSxNQUN4RSxVQUFVO0FBQUEsTUFDVix5QkFBeUIsQ0FBQyxTQUFpQjtBQUN6QyxnQkFBUSxJQUFJO0FBQ1osYUFBSyxtQkFBbUI7QUFBQTtBQUFBO0FBSzVCLFVBQU0sd0JBQXdCLFFBQVE7QUFDdEMsU0FBSyxrQkFBa0IsT0FBTyxZQUF5QjtBQUNyRCxZQUFNLHNCQUFzQjtBQUM1QixZQUFNLEtBQUssbUJBQW1CLE1BQU0sUUFBUTtBQUFBO0FBRzlDLFVBQU0sNEJBQTRCLFFBQVE7QUFDMUMsU0FBSyxzQkFBc0IsT0FBTyxZQUF5QjtBQUN6RCxZQUFNLDBCQUEwQjtBQUNoQyxZQUFNLEtBQUssbUJBQW1CLE1BQU0sUUFBUTtBQUFBO0FBRzlDLFNBQUssc0JBQXNCLG9CQUFvQjtBQUMvQyxTQUFLLG9CQUFvQixPQUFPLEtBQUs7QUFFckMsU0FBSztBQUdMLGVBQVcsTUFBTTtBQUNmLGNBQVEsSUFBSTtBQUNaLGNBQVEsSUFBSSxxQkFBcUIsS0FBSyxjQUFjO0FBQ3BELFdBQUssbUJBQW1CLE1BQU0sUUFBUTtBQUFBLE9BQ3JDO0FBQUE7QUFBQSxFQUdHLGFBQW1CO0FBQ3pCLFNBQUssaUJBQWlCLEtBQUssVUFBVSxTQUFTLE9BQU87QUFBQSxNQUNuRCxLQUFLO0FBQUE7QUFHUCxTQUFLLGFBQWEsS0FBSyxlQUFlLFNBQVMsT0FBTztBQUFBLE1BQ3BELEtBQUs7QUFBQTtBQUdQLFVBQU0sZUFBZSxLQUFLLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDdEQsS0FBSztBQUFBLE1BQ0wsTUFBTSxFQUFFLGNBQWM7QUFBQTtBQUV4QixtQ0FBUSxjQUFjO0FBQ3RCLGlCQUFhLGlCQUFpQixTQUFTLENBQUMsTUFBTTtBQUM1QyxVQUFJLEVBQUUsVUFBVTtBQUVkLGFBQUs7QUFBQSxhQUNBO0FBRUwsYUFBSztBQUFBO0FBQUE7QUFJVCxVQUFNLGlCQUFpQixLQUFLLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDeEQsS0FBSztBQUFBLE1BQ0wsTUFBTSxFQUFFLGNBQWM7QUFBQTtBQUV4QixtQ0FBUSxnQkFBZ0I7QUFDeEIsbUJBQWUsaUJBQWlCLFNBQVMsTUFBTTtBQUM3QyxXQUFLO0FBQUE7QUFHUCxVQUFNLGtCQUFrQixLQUFLLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDekQsS0FBSztBQUFBLE1BQ0wsTUFBTSxFQUFFLGNBQWM7QUFBQTtBQUV4QixtQ0FBUSxpQkFBaUI7QUFDekIsb0JBQWdCLGlCQUFpQixTQUFTLE1BQU07QUFDOUMsV0FBSyxtQkFBbUIsQ0FBQyxLQUFLO0FBQzlCLHNCQUFnQixVQUFVLE9BQU8sY0FBYyxLQUFLO0FBQUE7QUFHdEQsVUFBTSxZQUFZLEtBQUssV0FBVyxTQUFTLFVBQVU7QUFBQSxNQUNuRCxLQUFLO0FBQUEsTUFDTCxNQUFNLEVBQUUsY0FBYztBQUFBO0FBRXhCLG1DQUFRLFdBQVc7QUFDbkIsY0FBVSxpQkFBaUIsU0FBUyxLQUFLLGVBQWUsS0FBSztBQUU3RCxVQUFNLGFBQWEsS0FBSyxXQUFXLFNBQVMsVUFBVTtBQUFBLE1BQ3BELEtBQUs7QUFBQSxNQUNMLE1BQU0sRUFBRSxjQUFjO0FBQUE7QUFFeEIsbUNBQVEsWUFBWTtBQUNwQixlQUFXLGlCQUFpQixTQUFTLEtBQUssa0JBQWtCLEtBQUs7QUFHakUsU0FBSyxhQUFhLEtBQUssV0FBVyxTQUFTLFVBQVU7QUFBQSxNQUNuRCxLQUFLO0FBQUEsTUFDTCxNQUFNLEVBQUUsY0FBYztBQUFBO0FBRXhCLG1DQUFRLEtBQUssWUFBWTtBQUN6QixTQUFLLFdBQVcsTUFBTSxVQUFVO0FBQ2hDLFNBQUssV0FBVyxpQkFDZCxTQUNBLEtBQUsscUJBQXFCLEtBQUs7QUFHakMsU0FBSyxRQUFRLEtBQUssZUFBZSxTQUFTLFlBQVk7QUFBQSxNQUNwRCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUEsUUFDSixNQUFNO0FBQUEsUUFDTixhQUFhO0FBQUE7QUFBQTtBQUtqQixTQUFLLGVBQWUsS0FBSyxlQUFlLFNBQVMsT0FBTztBQUFBLE1BQ3RELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUdSLFNBQUssTUFBTSxpQkFBaUIsV0FBVyxLQUFLLGNBQWMsS0FBSztBQUMvRCxTQUFLLE1BQU0saUJBQWlCLFNBQVMsS0FBSyxrQkFBa0IsS0FBSztBQUNqRSxTQUFLLE1BQU0saUJBQWlCLFNBQVMsS0FBSyxZQUFZLEtBQUs7QUFHM0QsU0FBSyxnQkFBZ0IsU0FBUyxDQUFDLGdCQUFnQjtBQUM3QyxXQUFLLGNBQWM7QUFDbkIsWUFBTSxhQUFZLEtBQUssV0FBVyxjQUNoQztBQUVGLFVBQUksWUFBVztBQUNiLG1CQUFVLFVBQVUsT0FBTyxVQUFVO0FBQUE7QUFBQTtBQUt6QyxTQUFLLHdCQUF3QixNQUFNO0FBQ2pDLFdBQUssTUFBTSxXQUFXLEtBQUs7QUFDM0IsaUJBQVcsV0FBVyxLQUFLO0FBQzNCLGdCQUFVLFdBQVcsS0FBSztBQUMxQixtQkFBYSxXQUFXLEtBQUs7QUFDN0IscUJBQWUsV0FBVyxLQUFLO0FBQy9CLHNCQUFnQixXQUFXLEtBQUs7QUFFaEMsVUFBSSxLQUFLLFlBQVk7QUFDbkIsYUFBSyxXQUFXLE1BQU0sVUFBVSxLQUFLLGVBQWUsU0FBUztBQUM3RCxtQkFBVyxNQUFNLFVBQVUsS0FBSyxlQUFlLFNBQVM7QUFBQTtBQUcxRCxXQUFLLE1BQU0sY0FBYyxLQUFLLGVBQzFCLDRCQUNBO0FBR0osV0FBSyxNQUFNLFVBQVUsT0FBTyxZQUFZLEtBQUs7QUFDN0MsaUJBQVcsVUFBVSxPQUFPLFlBQVksS0FBSztBQUM3QyxnQkFBVSxVQUFVLE9BQU8sWUFBWSxLQUFLO0FBQzVDLG1CQUFhLFVBQVUsT0FBTyxZQUFZLEtBQUs7QUFDL0MscUJBQWUsVUFBVSxPQUFPLFlBQVksS0FBSztBQUNqRCxzQkFBZ0IsVUFBVSxPQUFPLFlBQVksS0FBSztBQUFBO0FBSXBELFNBQUssTUFBTSxpQkFBaUIsU0FBUyxNQUFNO0FBQ3pDLFdBQUs7QUFFTCxVQUFJLEtBQUssbUJBQW1CO0FBQzFCLHFCQUFhLEtBQUs7QUFBQTtBQUVwQixXQUFLLG9CQUFvQixXQUFXLE1BQU07QUFDeEMsYUFBSyxtQkFBbUIsTUFBTSxRQUFRO0FBQUEsU0FDckM7QUFBQTtBQUlMLFNBQUssbUJBQW1CLE1BQU0sUUFBUTtBQUFBO0FBQUEsRUFHaEMsdUJBQTZCO0FBQ25DLFFBQUksS0FBSyxpQkFBaUI7QUFDeEIsV0FBSyxnQkFBZ0I7QUFDckIsV0FBSyxrQkFBa0I7QUFDdkIsV0FBSyxlQUFlO0FBQ3BCLFdBQUs7QUFBQTtBQUFBO0FBQUEsUUFJSyxvQkFBbUM7QUFsUm5EO0FBbVJJLFVBQU0sVUFBVSxLQUFLLE1BQU0sTUFBTTtBQUNqQyxRQUFJLENBQUMsV0FBVyxLQUFLO0FBQWM7QUFHbkMsVUFBTSxhQUFhLGlCQUFLLFVBQVMsa0JBQWQ7QUFDbkIsUUFBSSxZQUFZO0FBQ2QsWUFBTSxPQUFPLEtBQUssTUFBTTtBQUN4QixZQUFNLFdBQVcsS0FBSztBQUN0QixZQUFNLGNBQWMsS0FBSyxvQkFBb0Isc0JBQXNCO0FBQ25FLFVBQUksZ0JBQWdCO0FBRXBCLGlCQUFXLFdBQVcsVUFBVTtBQUM5QixjQUFNLFdBQ0osT0FBTyxRQUFRLFlBQVksV0FDdkIsUUFBUSxVQUNSLEtBQUssVUFBVSxRQUFRO0FBQzdCLHlCQUNFLEtBQUssb0JBQW9CLHNCQUFzQjtBQUNqRCx5QkFBaUI7QUFBQTtBQUduQixZQUFNLGNBQWMsY0FBYztBQUNsQyxVQUFJLGNBQWMsWUFBWTtBQUM1QiwyQkFDRSx1Q0FBdUMsV0FBVyw2QkFDbEQ7QUFFRjtBQUFBO0FBQUE7QUFJSixTQUFLLE1BQU0sUUFBUTtBQUNuQixTQUFLO0FBRUwsUUFBSTtBQUVGLFlBQU0sZ0JBQWdCLEtBQUs7QUFDM0IsWUFBTSxjQUEyQjtBQUFBLFFBQy9CLE1BQU07QUFBQSxRQUNOO0FBQUEsUUFDQSxZQUFZO0FBQUE7QUFJZCxZQUFNLFVBQVUsS0FBSyxtQkFDakIsR0FBRyxLQUFLLGdDQUNSLEtBQUs7QUFHVCxZQUFNLEtBQUssZ0JBQWdCO0FBRTNCLFdBQUssY0FBYztBQUNuQixXQUFLLGNBQWM7QUFHbkIsWUFBTSxFQUFFLFdBQVcsY0FBYyxLQUFLO0FBQ3RDLGdCQUFVLGFBQWEsbUJBQW1CLEtBQUs7QUFDL0MsZ0JBQVUsWUFBWTtBQUd0QixVQUFJLGVBQWU7QUFDbkIsVUFBSSx1QkFBdUI7QUFDM0IsV0FBSyxlQUFlO0FBQ3BCLFdBQUs7QUFFTCxZQUFNLFlBQVksVUFBVSxTQUFTLFFBQVE7QUFBQSxRQUMzQyxLQUFLO0FBQUEsUUFDTCxNQUFNO0FBQUE7QUFJUixXQUFLLGNBQWMsWUFBWTtBQUMvQixXQUFLLGNBQWM7QUFDbkIsV0FBSyxjQUFjO0FBR25CLFdBQUssa0JBQWtCLElBQUk7QUFHM0IsWUFBTSxlQUFlLEtBQUs7QUFHMUIsVUFBSTtBQUNGLHlCQUFpQixTQUFTLEtBQUssVUFBVSxjQUFjO0FBQUEsVUFDckQsVUFBVSxLQUFLO0FBQUEsVUFDZixPQUFPO0FBQUEsVUFDUCxjQUFjLEtBQUs7QUFBQSxVQUNuQixrQkFBa0IsYUFBYTtBQUFBLFVBQy9CLGtCQUFrQixhQUFhO0FBQUEsVUFDL0IsUUFBUSxLQUFLLGdCQUFnQjtBQUFBLFlBQzNCO0FBQ0YsY0FBSSxDQUFDLGNBQWM7QUFDakIsc0JBQVUsY0FBYztBQUFBO0FBSTFCLGNBQUksTUFBTSxTQUFTO0FBQ2pCLDRCQUFnQixNQUFNO0FBQ3RCLGtCQUFNLEtBQUssZUFBZSxjQUFjO0FBQ3hDLHNCQUFVLFlBQVk7QUFBQTtBQUd4QixjQUFJLE1BQU0sV0FBVztBQUNuQixvQ0FBd0IsTUFBTTtBQUM5QixpQkFBSyxnQkFBZ0IsdUJBQ25CLFdBQ0E7QUFBQTtBQUtKLGVBQUssY0FBYztBQUNuQixlQUFLLGNBQWM7QUFBQTtBQUlyQixhQUFLLGVBQWU7QUFDcEIsYUFBSyxrQkFBa0I7QUFDdkIsa0JBQVU7QUFHVixZQUFJLHNCQUFzQjtBQUN4QixlQUFLLGdCQUFnQix1QkFDbkIsV0FDQSxzQkFDQTtBQUFBO0FBSUosY0FBTSxtQkFBZ0M7QUFBQSxVQUNwQyxNQUFNO0FBQUEsVUFDTixTQUFTO0FBQUEsVUFDVCxZQUNFLFVBQVUsYUFBYSxzQkFDdkIsS0FBSztBQUFBO0FBR1QsY0FBTSxLQUFLLG9CQUFvQjtBQUcvQixhQUFLLGdCQUFnQix3QkFDbkIsV0FDQSxjQUNBLGFBQ0EsaUJBQWlCO0FBSW5CLGFBQUssY0FBYztBQUNuQixhQUFLLGNBQWM7QUFHbkIsa0JBQVUsaUJBQWlCLFVBQVUsT0FBTyxNQUFtQjtBQUM3RCxnQkFBTSxFQUFFLGNBQWMsRUFBRTtBQUN4QixnQkFBTSxXQUFXLEtBQUs7QUFDdEIsZ0JBQU0sUUFBUSxTQUFTLFVBQ3JCLENBQUMsUUFBUSxJQUFJLGVBQWU7QUFFOUIsY0FBSSxVQUFVLElBQUk7QUFDaEIsc0JBQVU7QUFDVixpQkFBSyxjQUFjO0FBQUE7QUFBQTtBQUFBLGVBR2hCLE9BQVA7QUFDQSxhQUFLLGVBQWU7QUFDcEIsYUFBSyxrQkFBa0I7QUFDdkIsa0JBQVU7QUFDVixrQkFBVTtBQUdWLGdCQUFRLE1BQU0sdUJBQXVCO0FBQUEsVUFDbkM7QUFBQSxVQUNBLFNBQVMsaUJBQWlCLFFBQVEsTUFBTSxVQUFVLE9BQU87QUFBQSxVQUN6RCxPQUFPLGlCQUFpQixRQUFRLE1BQU0sUUFBUTtBQUFBO0FBSWhELGFBQUssUUFBUTtBQUFBLGdCQUNiO0FBQ0EsYUFBSyxlQUFlO0FBQ3BCLGFBQUssa0JBQWtCO0FBQ3ZCLGFBQUs7QUFFTCxhQUFLO0FBQUE7QUFBQSxhQUVBLE9BQVA7QUFFQSxjQUFRLE1BQU0saUNBQWlDO0FBQUEsUUFDN0M7QUFBQSxRQUNBLFNBQVMsaUJBQWlCLFFBQVEsTUFBTSxVQUFVLE9BQU87QUFBQSxRQUN6RCxPQUFPLGlCQUFpQixRQUFRLE1BQU0sUUFBUTtBQUFBO0FBR2hELFdBQUssZUFBZTtBQUNwQixXQUFLLGtCQUFrQjtBQUN2QixXQUFLO0FBRUwsV0FBSztBQUNMLFdBQUssUUFBUTtBQUFBO0FBQUE7QUFBQSxFQUlULGlCQUF1QjtBQUM3QixRQUFJLEtBQUs7QUFBYztBQUN2QixTQUFLO0FBQUE7QUFBQSxRQUdPLGtCQUFpQztBQUM3QyxVQUFNLEtBQUssZ0JBQWdCO0FBRTNCLFNBQUssTUFBTTtBQUFBO0FBQUEsUUFHQyxZQUFZLEdBQWtDO0FBeGU5RDtBQXllSSxVQUFNLEtBQUssRUFBRTtBQUNiLFFBQUksQ0FBQztBQUFJO0FBR1QsVUFBTSxhQUFhLFNBQUcsUUFBUSxrQkFBWCxZQUE0QjtBQUcvQyxVQUFNLFdBQVcsTUFBTSxLQUFLLEdBQUc7QUFHL0IsUUFBSSxDQUFDLFNBQVMsVUFBVSxZQUFZO0FBQ2xDO0FBQUE7QUFJRixNQUFFO0FBRUYsUUFBSSxDQUFDLFNBQVMsUUFBUTtBQUdwQjtBQUFBO0FBSUYsZUFBVyxRQUFRLFVBQVU7QUFDM0IsVUFBSTtBQUVGLFlBQUksWUFBWTtBQUNoQixZQUFJLEtBQUssUUFBUSxLQUFLLEtBQUssU0FBUyxNQUFNO0FBQ3hDLGdCQUFNLFNBQVMsS0FBSyxLQUFLLFlBQVk7QUFDckMsY0FBSSxVQUFVLEdBQUc7QUFDZix3QkFBWSxLQUFLLEtBQUssVUFBVSxTQUFTLEdBQUc7QUFBQTtBQUFBLG1CQUVyQyxLQUFLLE1BQU07QUFDcEIsZ0JBQU0sWUFBWSxLQUFLLEtBQUssTUFBTTtBQUNsQyxjQUFJLFVBQVUsV0FBVyxHQUFHO0FBQzFCLHdCQUFZLFVBQVUsR0FBRyxjQUFjLFFBQVEsY0FBYztBQUFBO0FBQUE7QUFLakUsY0FBTSxNQUFNLElBQUk7QUFDaEIsY0FBTSxZQUFZLElBQUksY0FBYyxRQUFRLFNBQVM7QUFDckQsY0FBTSxjQUFjLFVBQVUsYUFBYTtBQUczQyxjQUFNLGNBQWMsTUFBTSxLQUFLO0FBRy9CLGNBQU0saUJBQ0osS0FBSyxPQUFPLFNBQVMsd0JBQXdCO0FBQy9DLGNBQU0sWUFBWSxHQUFHLGtCQUFrQjtBQUN2QyxjQUFNLEtBQUssc0JBQXNCO0FBR2pDLGNBQU0sS0FBSyxJQUFJLE1BQU0sYUFBYSxXQUFXO0FBRzdDLGNBQU0sY0FBYyxLQUFLLElBQUksTUFBTSxzQkFBc0I7QUFDekQsWUFBSSx1QkFBdUIseUJBQU87QUFFaEMsZ0JBQU0sS0FBSyxTQUFTLGlCQUFpQjtBQUNyQyxjQUFJLHlCQUNGLHlDQUF5QyxZQUFZO0FBQUEsZUFFbEQ7QUFDTCxnQkFBTSxJQUFJLE1BQU07QUFBQTtBQUFBLGVBRVgsS0FBUDtBQUNBLGdCQUFRLE1BQU0sK0JBQStCO0FBQzdDLFlBQUkseUJBQU8saUNBQWlDO0FBQUE7QUFBQTtBQUtoRCxRQUFJLFlBQVk7QUFDZCxXQUFLLG1CQUFtQjtBQUFBO0FBQUE7QUFBQSxRQUlkLGNBQWMsT0FBcUM7QUFDL0QsUUFBSSxNQUFNLFFBQVEsV0FBVyxDQUFDLE1BQU0sVUFBVTtBQUM1QyxZQUFNO0FBQ04sWUFBTSxLQUFLO0FBQUE7QUFBQTtBQUFBLFFBSUQsaUJBQWlCLGVBQThDO0FBQzNFLFVBQU0sT0FBTyxjQUFjLE1BQU07QUFDakMsUUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEtBQUssV0FBVyxXQUFXO0FBQzVDLFlBQU0sSUFBSSxrQkFDUix5QkFDQSxZQUFZLFVBQ1o7QUFBQTtBQUlKLFVBQU0sU0FBUyxNQUFNLGVBQWUsc0JBQXNCO0FBQzFELFdBQU87QUFBQTtBQUFBLEVBR0Qsb0JBQTBCO0FBQ2hDLFFBQUksQ0FBQyxLQUFLO0FBQU87QUFFakIsU0FBSyxNQUFNLE1BQU0sU0FBUztBQUMxQixVQUFNLFlBQVksS0FBSyxJQUFJLEtBQUssSUFBSSxLQUFLLE1BQU0sY0FBYyxLQUFLO0FBQ2xFLFNBQUssTUFBTSxNQUFNLFNBQVMsWUFBWTtBQUFBO0FBQUEsRUFHakMsUUFBYztBQUNuQixTQUFLLE1BQU07QUFBQTtBQUFBLEVBR04sV0FBbUI7QUFDeEIsV0FBTyxLQUFLLE1BQU07QUFBQTtBQUFBLEVBR2IsU0FBUyxPQUFxQjtBQUNuQyxRQUFJLENBQUMsS0FBSyxPQUFPO0FBQ2YsY0FBUSxNQUFNO0FBQ2Q7QUFBQTtBQUdGLFFBQUk7QUFFRixXQUFLLE1BQU0sUUFBUTtBQUduQixZQUFNLGFBQWEsSUFBSSxNQUFNLFNBQVM7QUFBQSxRQUNwQyxTQUFTO0FBQUEsUUFDVCxZQUFZO0FBQUE7QUFFZCxXQUFLLE1BQU0sY0FBYztBQUd6QixXQUFLO0FBR0wsV0FBSyxNQUFNO0FBQ1gsV0FBSyxNQUFNLGtCQUFrQixNQUFNLFFBQVEsTUFBTTtBQUFBLGFBQzFDLE9BQVA7QUFDQSxjQUFRLE1BQU0sc0JBQXNCO0FBQ3BDLFVBQUkseUJBQU87QUFBQTtBQUFBO0FBQUEsRUFJUixTQUFlO0FBQ3BCLFFBQUksS0FBSyxlQUFlO0FBQ3RCLG1CQUFhLEtBQUs7QUFBQTtBQUdwQixTQUFLLGdCQUFnQixvQkFBb0I7QUFDekMsUUFBSSxLQUFLLG9CQUFvQjtBQUMzQixXQUFLLG1CQUFtQjtBQUN4QixXQUFLLHFCQUFxQjtBQUFBO0FBQUE7QUFBQSxFQUl0QixvQkFBNEI7QUFDbEMsV0FBTyx1Q0FBdUMsUUFBUSxTQUFTLENBQUMsTUFBTTtBQUNwRSxZQUFNLElBQUssS0FBSyxXQUFXLEtBQU07QUFDakMsWUFBTSxJQUFJLE1BQU0sTUFBTSxJQUFLLElBQUksSUFBTztBQUN0QyxhQUFPLEVBQUUsU0FBUztBQUFBO0FBQUE7QUFBQSxFQUlkLGtDQUdOO0FBQ0EsV0FBTztBQUFBLE1BQ0wsV0FBVyxVQUFVO0FBQUEsUUFDbkIsS0FBSztBQUFBO0FBQUEsTUFFUCxXQUFXLFVBQVUsRUFBRSxLQUFLO0FBQUE7QUFBQTtBQUFBLFFBSWxCLGVBQ1osU0FDQSxhQUNlO0FBQ2YsUUFBSSxLQUFLLGVBQWU7QUFDdEIsbUJBQWEsS0FBSztBQUFBO0FBSXBCLFVBQU0sZ0JBQWdCLFlBQVk7QUFHbEMsVUFBTSxnQkFDSCxZQUFZLGNBQWMsaUJBQzNCLFlBQVksU0FBUyxPQUFPLEVBQUUsS0FBSztBQUNyQyxrQkFBYyxNQUFNLGFBQWE7QUFDakMsa0JBQWMsTUFBTSxXQUFXO0FBQy9CLGtCQUFjLE1BQU0sUUFBUSxZQUFZLGNBQWM7QUFDdEQsVUFBTSxLQUFLLGdCQUFnQixzQkFBc0IsU0FBUztBQUcxRCxRQUFJLGtCQUFrQixjQUFjLGNBQWM7QUFDaEQsWUFBTSxLQUFLLGdCQUFnQixzQkFBc0IsU0FBUztBQUFBLFdBQ3JEO0FBRUwsWUFBTSxZQUFZLFlBQVk7QUFDOUIsVUFBSSxhQUFhLFVBQVUsYUFBYSxLQUFLLFdBQVc7QUFDdEQsa0JBQVUsY0FBYztBQUFBLGFBQ25CO0FBQ0wsb0JBQVksWUFBWSxTQUFTLGVBQWU7QUFBQTtBQUFBO0FBS3BELGtCQUFjO0FBQ2QsV0FBTyxRQUFRO0FBQUE7QUFBQSxRQUdILHVCQUFzQztBQUNsRCxRQUFJO0FBQ0YsWUFBTSxRQUFRLEtBQUssSUFBSSxNQUFNO0FBQzdCLFVBQUksQ0FBQyxNQUFNLFFBQVE7QUFDakIsWUFBSSx5QkFBTztBQUNYO0FBQUE7QUFHRixZQUFNLFlBQVksTUFBTTtBQUN4QixZQUFNLFNBQVMsTUFBTSxLQUFLLFVBQVUsZUFBZTtBQUNuRCxVQUFJLHlCQUNGLHFCQUFxQixPQUFPLHVCQUF1QixPQUFPO0FBQUEsYUFFckQsT0FBUDtBQUNBLFVBQUkseUJBQU8sd0JBQXdCO0FBQUE7QUFBQTtBQUFBLFFBSTFCLG1CQUFrQztBQW50QmpEO0FBb3RCSSxVQUFNLE9BQU8sS0FBSyxNQUFNO0FBQ3hCLFVBQU0sV0FBVyxLQUFLO0FBQ3RCLFVBQU0sZUFBZSxLQUFLO0FBRzFCLFVBQU0sY0FBYyxLQUFLLG9CQUFvQixzQkFBc0I7QUFHbkUsUUFBSSxnQkFBZ0I7QUFDcEIsZUFBVyxXQUFXLFVBQVU7QUFDOUIsWUFBTSxVQUNKLE9BQU8sUUFBUSxZQUFZLFdBQ3ZCLFFBQVEsVUFDUixLQUFLLFVBQVUsUUFBUTtBQUM3QixZQUFNLGdCQUNKLEtBQUssb0JBQW9CLHNCQUFzQjtBQUNqRCx1QkFBaUI7QUFFakIsdUJBQWlCO0FBQUE7QUFJbkIsUUFBSSxnQkFBZ0I7QUFFcEIsZUFBVyxZQUFZLGNBQWM7QUFDbkMsVUFBSSxTQUFTLFdBQVc7QUFBUztBQUVqQyxVQUFJO0FBQ0YsY0FBTSxXQUFXLFNBQVMsUUFBUSxtQkFBbUI7QUFDckQsY0FBTSxlQUFlLEtBQUssSUFBSSxjQUFjLHFCQUMxQyxVQUNBO0FBR0YsWUFBSSx3QkFBd0IseUJBQU87QUFFakMsY0FBSSxDQUFDLGFBQWEsVUFBVSxNQUFNLHlCQUF5QjtBQUN6RDtBQUFBO0FBSUYsZ0JBQU0sYUFBYSxNQUFNLEtBQUssb0JBQW9CLGtCQUNoRDtBQUVGLDJCQUFpQjtBQUNqQiwyQkFBaUI7QUFBQTtBQUFBLGVBRVosT0FBUDtBQUNBLGdCQUFRLEtBQUssbURBQW1EO0FBQUE7QUFBQTtBQUtwRSxVQUFNLGNBQWMsY0FBYyxnQkFBZ0I7QUFHbEQsVUFBTSxhQUFjLGlCQUFLLFVBQWlCLGtCQUF0QjtBQUlwQixRQUFJLGdCQUFnQixLQUFLLGFBQWEsU0FBUyxHQUFHO0FBQ2hELFdBQUssYUFBYSxjQUFjO0FBQUEsV0FDM0I7QUFDTCxXQUFLLGFBQWEsY0FDaEIsS0FBSyxvQkFBb0IsaUJBQWlCO0FBQUE7QUFJOUMsUUFBSSxZQUFZO0FBQ2QsWUFBTSxtQkFBbUIsS0FBSyxNQUFNLGFBQWE7QUFDakQsV0FBSyxhQUFhLFVBQVUsT0FDMUIsV0FDQSxjQUFjO0FBSWhCLFVBQUksY0FBYyxrQkFBa0I7QUFDbEMsYUFBSyxhQUFhLGNBQWMsR0FBRyxZQUFZLHNCQUFzQixXQUFXO0FBQUE7QUFJbEYsWUFBTSxlQUFlLEtBQUssVUFBVSxjQUNsQztBQUVGLFVBQUksY0FBYztBQUNoQixjQUFNLGNBQWMsY0FBYztBQUNsQyxxQkFBYSxXQUFXO0FBQ3hCLHFCQUFhLFFBQVEsY0FDakIsMEJBQTBCLFdBQVcscUJBQ3JDO0FBQUE7QUFBQSxXQUVEO0FBRUwsV0FBSyxhQUFhLFVBQVUsT0FBTztBQUFBO0FBQUE7QUFBQSxRQUl6QixzQkFBc0IsU0FBZ0M7QUFDbEUsUUFBSTtBQUNGLFlBQU0sS0FBSyxJQUFJLE1BQU0sUUFBUSxNQUFNO0FBQUEsYUFDNUIsS0FBUDtBQUNBLFVBQUksQ0FBQyxJQUFJLFFBQVEsU0FBUztBQUFtQixjQUFNO0FBQUE7QUFBQTtBQUFBLEVBSS9DLG1CQUFtQixNQUFvQjtBQUM3QyxVQUFNLFlBQVksS0FBSyxNQUFNO0FBQzdCLFVBQU0sZUFBZSxLQUFLLE1BQU07QUFFaEMsUUFBSSxjQUFjLE1BQU07QUFFdEIsWUFBTSxXQUNKLGFBQWEsTUFBTSxHQUFHLGFBQWEsT0FBTyxhQUFhLE1BQU07QUFDL0QsV0FBSyxNQUFNLFFBQVE7QUFFbkIsV0FBSyxNQUFNLGlCQUFpQixLQUFLLE1BQU0sZUFDckMsWUFBWSxLQUFLO0FBQUEsV0FDZDtBQUVMLFdBQUssTUFBTSxRQUFRLGVBQWU7QUFDbEMsV0FBSyxNQUFNLGlCQUFpQixLQUFLLE1BQU0sZUFDckMsS0FBSyxNQUFNLE1BQU07QUFBQTtBQUlyQixTQUFLLE1BQU0sY0FBYyxJQUFJLE1BQU07QUFHbkMsU0FBSyxNQUFNO0FBQUE7QUFBQTs7O0FFcDFCZix3QkFBK0M7OztBQ0EvQyx3QkFBa0M7QUFFbEMsd0JBQXdCO0FBdUJqQiwwQ0FBb0Msd0JBQU07QUFBQSxFQWtCL0MsWUFBWSxLQUFVLFVBQW9DO0FBQ3hELFVBQU07QUFoQkEsdUJBQWMsSUFBSTtBQUtsQixnQ0FBOEM7QUFHOUMseUJBQStCO0FBQy9CLDhCQUFrQyxJQUFJO0FBQ3RDLDRCQUE2QyxJQUFJO0FBQ2pELHlCQUE0QixJQUFJO0FBQ2hDLHlCQUFnQjtBQUNoQiwwQkFBZ0M7QUFJdEMsU0FBSyxXQUFXO0FBQ2hCLFNBQUssZ0JBQWdCLElBQUk7QUFDekIsU0FBSyxlQUFlLG9CQUFvQjtBQUN4QyxTQUFLLFFBQVEsS0FBSyxJQUFJLE1BQU07QUFDNUIsU0FBSyxtQkFBbUIsSUFBSTtBQUFBO0FBQUEsRUFHdEIsZ0JBQWdCLE1BQWE7QUFDbkMsV0FBTztBQUFBLE1BQ0wsRUFBRSxPQUFPLFNBQVMsTUFBTSxLQUFLLFVBQVUsUUFBUTtBQUFBLE1BQy9DLEVBQUUsT0FBTyxRQUFRLE1BQU0sS0FBSyxNQUFNLFFBQVE7QUFBQSxNQUMxQyxFQUFFLE9BQU8sYUFBYSxNQUFNLEtBQUssV0FBVyxRQUFRO0FBQUE7QUFBQTtBQUFBLEVBSWhELGVBQWUsT0FBdUI7QUFDNUMsUUFBSSxRQUFRO0FBQU0sYUFBTyxRQUFRO0FBQ2pDLFVBQU0sS0FBSyxRQUFRO0FBQ25CLFFBQUksS0FBSztBQUFNLGFBQU8sR0FBRyxRQUFRLEtBQUs7QUFDdEMsVUFBTSxLQUFLLEtBQUs7QUFDaEIsV0FBTyxHQUFHLFFBQVEsS0FBSztBQUFBO0FBQUEsRUFHakIsY0FDTixNQUNBLFVBQXlCLElBQ1A7QUF2RXRCO0FBd0VJLFFBQUksQ0FBQyxXQUFXLFFBQVEsV0FBVyxHQUFHO0FBQ3BDLFlBQU0sWUFBVztBQUNqQixnQkFBUyxXQUFXO0FBQ3BCLGFBQU87QUFBQTtBQUdULFVBQU0sV0FBVztBQUNqQixVQUFNLGNBQWMsWUFBSyxnQkFBTCxtQkFBa0IsVUFBUztBQUcvQyxVQUFNLGtCQUFrQixZQUFZLGNBQWM7QUFDbEQsVUFBTSxRQUFRLElBQUksT0FBTyxJQUFJLG9CQUFvQjtBQUNqRCxRQUFJLFlBQVk7QUFDaEIsUUFBSTtBQUVKLFdBQVEsU0FBUSxNQUFNLEtBQUssV0FBVyxNQUFNO0FBRTFDLFVBQUksTUFBTSxRQUFRLFdBQVc7QUFDM0IsaUJBQVMsV0FBVyxLQUFLLE1BQU0sV0FBVyxNQUFNO0FBQUE7QUFJbEQsWUFBTSxPQUFPLFNBQVMsV0FBVztBQUFBLFFBQy9CLEtBQUs7QUFBQSxRQUNMLE1BQU0sTUFBTTtBQUFBO0FBR2Qsa0JBQVksTUFBTSxRQUFRLE1BQU0sR0FBRztBQUFBO0FBR3JDLFFBQUksWUFBWSxLQUFLLFFBQVE7QUFDM0IsZUFBUyxXQUFXLEtBQUssTUFBTTtBQUFBO0FBR2pDLFdBQU87QUFBQTtBQUFBLEVBR0QseUJBQXNDO0FBQzVDLFVBQU0sWUFBWSxVQUFVLEVBQUUsS0FBSztBQUNuQyxtQ0FBUSxXQUFXO0FBQ25CLGNBQVUsWUFBWSxXQUFXLEVBQUUsTUFBTTtBQUN6QyxXQUFPO0FBQUE7QUFBQSxFQUdELG1CQUFnQztBQUN0QyxVQUFNLFlBQVksVUFBVSxFQUFFLEtBQUs7QUFDbkMsbUNBQVEsV0FBVztBQUNuQixjQUFVLFlBQVksV0FBVyxFQUFFLE1BQU07QUFDekMsV0FBTztBQUFBO0FBQUEsUUFHSyxvQkFBb0IsTUFBOEI7QUFDOUQsUUFBSTtBQUNGLFVBQUksS0FBSyxjQUFjLFFBQVEsS0FBSyxjQUFjLE9BQU87QUFDdkQsY0FBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyxlQUFPLEtBQUssYUFBYSxzQkFBc0I7QUFBQTtBQUVqRCxhQUFPO0FBQUEsYUFDQSxPQUFQO0FBQ0EsY0FBUSxNQUFNLHNDQUFzQyxLQUFLLE1BQU07QUFDL0QsYUFBTztBQUFBO0FBQUE7QUFBQSxRQUlHLGlCQUFpQixNQUE0QjtBQUN6RCxVQUFNLFFBQVEsTUFBTSxLQUFLLG9CQUFvQjtBQUM3QyxTQUFLLFlBQVksSUFBSSxLQUFLLE1BQU07QUFBQTtBQUFBLEVBRzFCLFdBQVcsTUFBYSxRQUEwQztBQTdJNUU7QUE4SUksVUFBTSxPQUFPLFVBQVUsRUFBRSxLQUFLO0FBQzlCLFNBQUssYUFBYSxZQUFZO0FBQzlCLFVBQU0sY0FBYyxLQUFLLFVBQVUsRUFBRSxLQUFLO0FBRzFDLFFBQUksS0FBSyxVQUFVLE1BQU0sNEJBQTRCO0FBQ25ELFlBQU0saUJBQWlCLFlBQVksVUFBVTtBQUFBLFFBQzNDLEtBQUs7QUFBQTtBQUdQLE1BQUMsYUFBWTtBQUNYLFlBQUk7QUFDRixnQkFBTSxjQUFjLE1BQU0sS0FBSyxJQUFJLE1BQU0sV0FBVztBQUNwRCxnQkFBTSxPQUFPLElBQUksS0FBSyxDQUFDO0FBQ3ZCLGdCQUFNLFlBQVksSUFBSSxnQkFBZ0I7QUFFdEMsZ0JBQU0sTUFBTSxlQUFlLFNBQVMsT0FBTztBQUFBLFlBQ3pDLEtBQUs7QUFBQSxZQUNMLE1BQU0sRUFBRSxLQUFLO0FBQUE7QUFBQSxpQkFFUixLQUFQO0FBQ0Esa0JBQVEsTUFBTSw0QkFBNEI7QUFBQTtBQUFBO0FBQUE7QUFLaEQsUUFBSSxLQUFLLGNBQWMsSUFBSSxPQUFPO0FBQ2hDLFdBQUssU0FBUztBQUNkLFlBQU0sWUFBWSxLQUFLLFVBQVUsRUFBRSxLQUFLO0FBQ3hDLHFDQUFRLFdBQVc7QUFBQTtBQUdyQixVQUFNLGdCQUFnQixZQUFZLFVBQVU7QUFBQSxNQUMxQyxLQUFLO0FBQUE7QUFHUCxVQUFNLFFBQVEsY0FBYyxVQUFVO0FBQUEsTUFDcEMsS0FBSztBQUFBO0FBRVAsVUFBTSxZQUNKLEtBQUssY0FDSCxLQUFLLFVBQ0wsT0FBTyxRQUFRLE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVTtBQUk3QyxVQUFNLE9BQU8sY0FBYyxVQUFVLEVBQUUsS0FBSztBQUM1QyxTQUFLLFlBQ0gsS0FBSyxjQUNILEtBQUssTUFDTCxPQUFPLFFBQVEsT0FBTyxDQUFDLE1BQU0sRUFBRSxVQUFVO0FBSTdDLFVBQU0sT0FBTyxjQUFjLFVBQVUsRUFBRSxLQUFLO0FBRTVDLFVBQU0sT0FBTyxLQUFLLFVBQVUsRUFBRSxLQUFLO0FBQ25DLFNBQUssUUFBUSxLQUFLLFVBQVU7QUFFNUIsVUFBTSxZQUFZLEtBQUssVUFBVTtBQUFBLE1BQy9CLEtBQUs7QUFBQTtBQUdQLFVBQU0sT0FBTyxVQUFVLFVBQVUsRUFBRSxLQUFLO0FBQ3hDLFNBQUssUUFBUSxLQUFLLGVBQWUsWUFBSyxTQUFMLG1CQUFXLFNBQVE7QUFFcEQsUUFBSSxLQUFLLGNBQWMsUUFBUSxLQUFLLGNBQWMsT0FBTztBQUN2RCxZQUFNLGVBQWUsVUFBVSxVQUFVO0FBQUEsUUFDdkMsS0FBSztBQUFBO0FBRVAsWUFBTSxXQUFXLGlCQUFLLFNBQUwsbUJBQVcsU0FBWCxZQUFtQjtBQUVwQyxVQUFJLGFBQWEsR0FBRztBQUNsQixxQkFBYSxRQUFRO0FBQUEsYUFDaEI7QUFDTCxjQUFNLFFBQVEsS0FBSyxZQUFZLElBQUksS0FBSyxTQUFTO0FBQ2pELHFCQUFhLFFBQVEsS0FBSyxhQUFhLGlCQUFpQjtBQUV4RCxZQUFJLENBQUMsS0FBSyxZQUFZLElBQUksS0FBSyxPQUFPO0FBQ3BDLGVBQUssaUJBQWlCLE1BQU0sS0FBSyxNQUFNO0FBQ3JDLHlCQUFhLFFBQ1gsS0FBSyxhQUFhLGlCQUNoQixLQUFLLFlBQVksSUFBSSxLQUFLLFNBQVM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVEvQyxTQUFLLGlCQUFpQixTQUFTLE1BQU07QUFDbkMsV0FBSyxvQkFBb0IsTUFBTTtBQUFBO0FBR2pDLFNBQUssaUJBQWlCLGNBQWMsTUFBTTtBQUN4QyxZQUFNLFFBQVEsS0FBSyxlQUFlLFFBQVE7QUFDMUMsVUFBSSxTQUFTLEdBQUc7QUFDZCxhQUFLLGdCQUFnQjtBQUNyQixhQUFLO0FBQUE7QUFBQTtBQUlULFdBQU87QUFBQTtBQUFBLEVBR0QsdUJBQXVCO0FBQzdCLFNBQUssZUFBZSxRQUFRLENBQUMsSUFBSSxVQUFVO0FBQ3pDLFNBQUcsWUFDRCxlQUNBLFVBQVUsS0FBSyxpQkFBaUIsS0FBSyxpQkFBaUI7QUFBQTtBQUkxRCxRQUNFLEtBQUssaUJBQWlCLEtBQ3RCLEtBQUssZ0JBQWdCLEtBQUssZUFBZSxRQUN6QztBQUNBLFdBQUssZUFBZSxLQUFLLGVBQWUsZUFBZTtBQUFBLFFBQ3JELFVBQVU7QUFBQSxRQUNWLE9BQU87QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtMLG9CQUFvQixNQUFhLFFBQXFCO0FBMVFoRTtBQTJRSSxRQUFJLEtBQUssY0FBYyxJQUFJLE9BQU87QUFDaEMsV0FBSyxjQUFjLE9BQU87QUFDMUIsYUFBTyxZQUFZO0FBQ25CLG1CQUFPLGNBQWMsbUNBQXJCLG1CQUFxRDtBQUFBLFdBQ2hEO0FBQ0wsV0FBSyxjQUFjLElBQUk7QUFDdkIsYUFBTyxTQUFTO0FBQ2hCLFlBQU0sWUFBWSxPQUFPLFVBQVUsRUFBRSxLQUFLO0FBQzFDLHFDQUFRLFdBQVc7QUFBQTtBQUVyQixTQUFLO0FBQUE7QUFBQSxFQUdDLHFCQUFxQjtBQUMzQixVQUFNLGVBQWUsS0FBSyxZQUFZLGNBQ3BDO0FBRUYsUUFBSSxjQUFjO0FBQ2hCLFlBQU0sUUFBUSxLQUFLLGNBQWM7QUFDakMsbUJBQWEsUUFDWCxRQUFRLElBQ0osT0FBTyxzQkFBc0IsVUFBVSxJQUFJLEtBQUssUUFDaEQ7QUFFTixtQkFBYSxZQUFZLGFBQWEsUUFBUTtBQUFBO0FBQUE7QUFBQSxFQUkxQyxjQUFjLGVBQXNDO0FBQzFELFNBQUssaUJBQWlCO0FBQ3RCLFNBQUssaUJBQWlCO0FBQ3RCLFNBQUssdUJBQXVCO0FBRTVCLFFBQUksY0FBYyxXQUFXLEdBQUc7QUFDOUIsV0FBSyxXQUFXLE1BQU0sVUFBVTtBQUNoQztBQUFBO0FBR0YsU0FBSyxXQUFXLE1BQU0sVUFBVTtBQUVoQyxVQUFNLE9BQU8sS0FBSyxpQkFBaUIsVUFBVTtBQUFBLE1BQzNDLEtBQUs7QUFBQTtBQUdQLGtCQUFjLFFBQVEsQ0FBQyxRQUFRLFVBQVU7QUFDdkMsWUFBTSxPQUFPLEtBQUssV0FBVyxPQUFPLE1BQU07QUFDMUMsV0FBSyxZQUFZO0FBQ2pCLFdBQUssZUFBZSxLQUFLO0FBQUE7QUFBQTtBQUFBLEVBSXJCLHNCQUFnQztBQUN0QyxVQUFNLGFBQWEsSUFBSTtBQUN2QixTQUFLLE1BQU0sUUFBUSxDQUFDLFNBQVM7QUFDM0IsVUFBSSxLQUFLLFdBQVc7QUFDbEIsbUJBQVcsSUFBSSxLQUFLLFVBQVU7QUFBQTtBQUFBO0FBR2xDLFdBQU8sTUFBTSxLQUFLLFlBQVk7QUFBQTtBQUFBLEVBR3hCLHNCQUFzQixXQUFnQztBQUM1RCxVQUFNLFNBQVMsVUFBVTtBQUFBLE1BQ3ZCLEtBQUs7QUFBQSxNQUNMLE1BQU0sVUFBVTtBQUFBO0FBR2xCLFdBQU8saUJBQWlCLFNBQVMsTUFBTTtBQUNyQyxVQUFJLEtBQUssbUJBQW1CLElBQUksWUFBWTtBQUMxQyxhQUFLLG1CQUFtQixPQUFPO0FBQy9CLGVBQU8sWUFBWTtBQUFBLGFBQ2Q7QUFDTCxhQUFLLG1CQUFtQixJQUFJO0FBQzVCLGVBQU8sU0FBUztBQUFBO0FBR2xCLFdBQUssY0FBYyxLQUFLLFlBQVk7QUFBQTtBQUd0QyxXQUFPO0FBQUE7QUFBQSxFQUdELGNBQWMsT0FBZTtBQUNuQyxRQUFJLFVBQVUsS0FBSyxjQUFjLE9BQy9CLEtBQUssTUFBTSxPQUNULENBQUMsU0FDQyxLQUFLLG1CQUFtQixTQUFTLEtBQ2pDLEtBQUssbUJBQW1CLElBQUksS0FBSyxVQUFVLGlCQUUvQyxPQUNBLENBQUMsU0FBUyxLQUFLLGdCQUFnQjtBQUdqQyxZQUFRLEtBQUssQ0FBQyxHQUFHLE1BQU07QUFDckIsVUFBSSxFQUFFLFVBQVUsRUFBRTtBQUFPLGVBQU8sRUFBRSxRQUFRLEVBQUU7QUFDNUMsYUFBTyxFQUFFLEtBQUssU0FBUyxjQUFjLEVBQUUsS0FBSztBQUFBO0FBRzlDLFNBQUssY0FBYztBQUFBO0FBQUEsRUFHckIsU0FBUztBQUNQLFVBQU0sRUFBRSxjQUFjO0FBQ3RCLGNBQVU7QUFDVixjQUFVLFNBQVM7QUFFbkIsVUFBTSxrQkFBa0IsVUFBVSxVQUFVO0FBQUEsTUFDMUMsS0FBSztBQUFBO0FBRVAsU0FBSyxjQUFjLGdCQUFnQixTQUFTLFNBQVM7QUFBQSxNQUNuRCxNQUFNO0FBQUEsTUFDTixhQUFhO0FBQUE7QUFHZixVQUFNLHFCQUFxQixVQUFVLFVBQVU7QUFBQSxNQUM3QyxLQUFLO0FBQUE7QUFHUCxVQUFNLGFBQWEsS0FBSztBQUN4QixlQUFXLFFBQVEsQ0FBQyxRQUFRO0FBQzFCLFlBQU0sU0FBUyxLQUFLLHNCQUFzQjtBQUMxQyxXQUFLLGlCQUFpQixJQUFJLEtBQUs7QUFDL0IseUJBQW1CLFlBQVk7QUFBQTtBQUlqQyxVQUFNLFFBQVEsS0FBSyxpQkFBaUIsSUFBSTtBQUN4QyxRQUFJO0FBQU8sWUFBTSxTQUFTO0FBRTFCLFNBQUssbUJBQW1CLEtBQUs7QUFDN0IsY0FBVSxZQUFZLEtBQUs7QUFFM0IsU0FBSyxhQUFhLEtBQUs7QUFDdkIsU0FBSyxXQUFXLE1BQU0sVUFBVTtBQUNoQyxjQUFVLFlBQVksS0FBSztBQUUzQixVQUFNLGtCQUFrQixVQUFVLFVBQVU7QUFBQSxNQUMxQyxLQUFLO0FBQUE7QUFFUCxTQUFLLG1CQUFtQixnQkFBZ0I7QUFFeEMsVUFBTSxrQkFBa0IsVUFBVSxVQUFVO0FBQUEsTUFDMUMsS0FBSztBQUFBO0FBR1AsVUFBTSxlQUFlLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxNQUN0RCxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixpQkFBYSxpQkFBaUIsU0FBUyxNQUFNO0FBQzNDLFVBQUksS0FBSyxjQUFjLE9BQU8sR0FBRztBQUMvQixhQUFLLFNBQVMsTUFBTSxLQUFLLEtBQUs7QUFDOUIsYUFBSztBQUFBO0FBQUE7QUFJVCxTQUFLO0FBRUwsU0FBSyxpQkFBaUIsTUFBTSxVQUFVO0FBQ3RDLFNBQUssaUJBQWlCO0FBRXRCLFNBQUs7QUFFTCxTQUFLLFlBQVksaUJBQWlCLFdBQVcsQ0FBQyxNQUFxQjtBQUNqRSxVQUFJLFNBQVMsa0JBQWtCLEtBQUs7QUFBYTtBQUNqRCxVQUFJLEtBQUsscUJBQXFCLFdBQVc7QUFBRztBQUU1QyxVQUFJLEVBQUUsUUFBUSxPQUFPO0FBQ25CLFVBQUU7QUFFRixZQUFJLEVBQUUsWUFBWSxLQUFLLGtCQUFrQixHQUFHO0FBQzFDLGVBQUssWUFBWTtBQUNqQjtBQUFBO0FBR0YsWUFBSSxFQUFFLFVBQVU7QUFDZCxlQUFLLGdCQUNGLE1BQUssZ0JBQWdCLElBQUksS0FBSyxlQUFlLFVBQzlDLEtBQUssZUFBZTtBQUFBLGVBQ2pCO0FBQ0wsZUFBSyxnQkFDRixNQUFLLGdCQUFnQixLQUFLLEtBQUssZUFBZTtBQUFBO0FBRW5ELGFBQUs7QUFDTDtBQUFBO0FBR0YsVUFBSSxFQUFFLFNBQVMsU0FBUztBQUN0QixVQUFFO0FBQ0YsY0FBTSxPQUFPLEtBQUsscUJBQXFCLEtBQUssZUFBZTtBQUMzRCxjQUFNLFNBQVMsS0FBSyxlQUFlLEtBQUs7QUFDeEMsYUFBSyxvQkFBb0IsTUFBTTtBQUMvQjtBQUFBO0FBR0YsVUFBSSxFQUFFLFFBQVEsU0FBUztBQUNyQixVQUFFO0FBQ0YsWUFBSSxLQUFLLGNBQWMsT0FBTyxHQUFHO0FBQy9CLGVBQUssU0FBUyxNQUFNLEtBQUssS0FBSztBQUM5QixlQUFLO0FBQUE7QUFFUDtBQUFBO0FBQUE7QUFJSixTQUFLLFlBQVk7QUFFakIsU0FBSyxjQUFjO0FBQ25CLFNBQUssaUJBQWlCLE1BQU0sVUFBVTtBQUFBO0FBQUEsRUFHaEMsc0JBQXNCO0FBQzVCLFNBQUssWUFBWSxpQkFBaUIsV0FBVyxDQUFDLE1BQU07QUFDbEQsVUFBSSxFQUFFLFFBQVEsT0FBTztBQUNuQixVQUFFO0FBQ0YsVUFBRTtBQUVGLFlBQUksS0FBSyxlQUFlLFNBQVMsR0FBRztBQUNsQyxjQUFJLEVBQUUsVUFBVTtBQUVkLGlCQUFLLGdCQUFnQixLQUFLLGVBQWUsU0FBUztBQUFBLGlCQUM3QztBQUVMLGlCQUFLLGdCQUFnQjtBQUFBO0FBRXZCLGVBQUs7QUFDTCxlQUFLLGVBQWUsS0FBSyxlQUFlO0FBQUE7QUFBQTtBQUFBO0FBSzlDLFNBQUssWUFBWSxpQkFBaUIsU0FBUyxNQUFNO0FBQy9DLFdBQUssZ0JBQWdCO0FBQ3JCLFdBQUs7QUFBQTtBQUdQLFNBQUssWUFBWSxpQkFBaUIsU0FBUyxNQUFNO0FBQy9DLFVBQUksS0FBSyxlQUFlO0FBQ3RCLGVBQU8sYUFBYSxLQUFLO0FBQUE7QUFHM0IsV0FBSyxnQkFBZ0IsT0FBTyxXQUFXLE1BQU07QUFDM0MsY0FBTSxRQUFRLEtBQUssWUFBWTtBQUUvQixZQUFJLFVBQVUsS0FBSyxjQUFjLE9BQy9CLEtBQUssTUFBTSxPQUNULENBQUMsU0FDQyxLQUFLLG1CQUFtQixTQUFTLEtBQ2pDLEtBQUssbUJBQW1CLElBQUksS0FBSyxVQUFVLGlCQUUvQyxPQUNBLENBQUMsU0FBUyxLQUFLLGdCQUFnQjtBQUdqQyxnQkFBUSxLQUFLLENBQUMsR0FBRyxNQUFNO0FBQ3JCLGNBQUksRUFBRSxVQUFVLEVBQUU7QUFBTyxtQkFBTyxFQUFFLFFBQVEsRUFBRTtBQUM1QyxpQkFBTyxFQUFFLEtBQUssU0FBUyxjQUFjLEVBQUUsS0FBSztBQUFBO0FBRzlDLGFBQUssY0FBYztBQUFBLFNBQ2xCO0FBQUE7QUFBQTtBQUFBLEVBSVAsVUFBVTtBQUNSLFFBQUksS0FBSyxlQUFlO0FBQ3RCLGFBQU8sYUFBYSxLQUFLO0FBQUE7QUFFM0IsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUFBO0FBQUE7OztBRHJoQmQsd0JBQWlDO0FBK0IxQix1Q0FBaUMsNEJBQVU7QUFBQSxFQWdCaEQsWUFBWSxTQUFvQztBQUM5QztBQWZNLHdCQUFlLElBQUk7QUFJbkIsNEJBQXVDO0FBQ3ZDLDJCQUFrQixJQUFJO0FBQ3RCLDhCQUFxQixJQUFJO0FBQ3pCLHdCQUFtQztBQUNuQyxxQkFBWTtBQUlaLHVCQUFjLElBQUk7QUFJeEIsU0FBSyxNQUFNLFFBQVE7QUFDbkIsU0FBSyxrQkFBa0IsUUFBUTtBQUMvQixTQUFLLGdCQUFnQixRQUFRO0FBQzdCLFNBQUssU0FBUyxRQUFRO0FBQ3RCLFNBQUssZUFBZSxvQkFBb0I7QUFFeEMsU0FBSyxTQUFTLElBQUksZ0JBQWdCO0FBQUEsTUFDaEMsV0FBVyxRQUFRO0FBQUEsTUFDbkIsT0FBTyxRQUFRLFNBQVM7QUFBQTtBQUUxQixTQUFLLGVBQWUsS0FBSyxPQUFPO0FBRWhDLFNBQUs7QUFDTCxTQUFLO0FBQUE7QUFBQSxFQUdDLDZCQUE2QjtBQUNuQyxTQUFLLG1CQUFtQixLQUFLLGFBQWEsU0FBUyxPQUFPO0FBQUEsTUFDeEQsS0FBSztBQUFBO0FBRVAsU0FBSyxpQkFBaUIsTUFBTSxVQUFVO0FBQUE7QUFBQSxFQUdoQyx1QkFDTixNQUNBLFFBQ0EsTUFDQSxTQUFrQixPQUNsQjtBQUNBLFVBQU0sU0FBUyxLQUFLO0FBQ3BCLFFBQUksV0FBVyxLQUFLLGdCQUFnQixJQUFJO0FBR3hDLFVBQU0sa0JBQWtCLEtBQUssbUJBQW1CLElBQUk7QUFDcEQsUUFBSSxpQkFBaUI7QUFDbkIsbUJBQWE7QUFDYixXQUFLLG1CQUFtQixPQUFPO0FBQUE7QUFHakMsUUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEtBQUssa0JBQWtCO0FBQ2pELGlCQUFXLEtBQUssaUJBQWlCLFNBQVMsT0FBTztBQUFBLFFBQy9DLEtBQUs7QUFBQTtBQUdQLFlBQU0sU0FBUyxTQUFTLFdBQVc7QUFBQSxRQUNqQyxLQUFLO0FBQUE7QUFFUCxxQ0FBUSxRQUFRO0FBRWhCLGVBQVMsV0FBVztBQUFBLFFBQ2xCLE1BQU0sR0FBRyxLQUFLLGFBQWE7QUFBQSxRQUMzQixLQUFLO0FBQUE7QUFHUCxXQUFLLGdCQUFnQixJQUFJLFFBQVE7QUFBQSxlQUN4QixZQUFZLENBQUMsUUFBUTtBQUM5QixlQUFTO0FBQ1QsWUFBTSxTQUFTLFNBQVMsV0FBVztBQUFBLFFBQ2pDLEtBQUs7QUFBQTtBQUVQLHFDQUFRLFFBQVE7QUFDaEIsZUFBUyxXQUFXO0FBQUEsUUFDbEIsTUFBTSxHQUFHLEtBQUssYUFBYTtBQUFBLFFBQzNCLEtBQUs7QUFBQTtBQUFBLGVBRUUsWUFBWSxRQUFRO0FBQzdCLGVBQVM7QUFDVCxXQUFLLGdCQUFnQixPQUFPO0FBQUE7QUFHOUIsUUFBSSxLQUFLLGtCQUFrQjtBQUN6QixXQUFLLGlCQUFpQixNQUFNLFVBQzFCLEtBQUssZ0JBQWdCLE9BQU8sSUFBSSxVQUFVO0FBQUE7QUFJOUMsUUFDRSxVQUNBLE9BQU8sU0FBUyxtQkFDaEIsT0FBTyxTQUFTLGdCQUNoQixPQUFPLFNBQVMsV0FDaEI7QUFDQSxZQUFNLFVBQVUsV0FBVyxNQUFNO0FBQy9CLGFBQUssdUJBQXVCLE1BQU0sSUFBSSxJQUFJO0FBQzFDLGFBQUssbUJBQW1CLE9BQU87QUFBQSxTQUM5QjtBQUNILFdBQUssbUJBQW1CLElBQUksUUFBUTtBQUFBO0FBQUE7QUFBQSxFQUloQyxvQkFBMEI7QUFDaEMsVUFBTSxVQUFVLEtBQUssYUFBYSxjQUNoQztBQUVGLFFBQUksQ0FBQztBQUFTO0FBRWQsVUFBTSxlQUFlLFFBQVEsV0FBVztBQUFBLE1BQ3RDLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUlSLFNBQUssZUFBZSxRQUFRLFdBQVc7QUFBQSxNQUNyQyxLQUFLO0FBQUE7QUFFUCxtQ0FBUSxLQUFLLGNBQWM7QUFFM0IsVUFBTSxnQkFBZ0IsUUFBUSxTQUFTLFVBQVU7QUFBQSxNQUMvQyxLQUFLO0FBQUE7QUFFUCxtQ0FBUSxlQUFlO0FBQ3ZCLGtCQUFjLGlCQUFpQixTQUFTLENBQUMsTUFBTTtBQUM3QyxRQUFFO0FBQ0YsV0FBSztBQUFBO0FBR1AsU0FBSztBQUFBO0FBQUEsRUFHQyxpQkFBaUIsVUFBbUIsT0FBTztBQUNqRCxRQUFJLENBQUMsS0FBSztBQUFjO0FBRXhCLFNBQUssWUFBWTtBQUNqQixTQUFLLGFBQWE7QUFFbEIsUUFBSSxTQUFTO0FBQ1gsV0FBSyxhQUFhLFlBQVk7QUFDOUIsV0FBSyxhQUFhLFNBQVM7QUFDM0IscUNBQVEsS0FBSyxjQUFjO0FBQUEsV0FDdEI7QUFDTCxXQUFLLGFBQWEsWUFBWTtBQUM5QixXQUFLLGFBQWEsU0FBUztBQUMzQixxQ0FBUSxLQUFLLGNBQWM7QUFBQTtBQUFBO0FBQUEsUUFJbEIsa0JBQWtCO0FBQzdCLFFBQUksS0FBSyxhQUFhLFNBQVMsR0FBRztBQUNoQyxXQUFLLGlCQUFpQjtBQUN0QjtBQUFBO0FBR0YsU0FBSyxpQkFBaUI7QUFFdEIsU0FBSyxpQkFBaUI7QUFBQTtBQUFBLEVBR2hCLHFCQUEyQjtBQXhNckM7QUF5TUksUUFBSSxDQUFDLEtBQUs7QUFBYztBQUV4QixVQUFNLFNBQVMsS0FBSyxhQUFhLGNBQy9CO0FBRUYsVUFBTSxVQUFVLEtBQUssYUFBYSxjQUNoQztBQUVGLFVBQU0sUUFBUSxLQUFLLGFBQWEsY0FBYztBQUU5QyxRQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQztBQUFPO0FBRW5DLFVBQU0sY0FBYyxLQUFLLGFBQWEsS0FBSztBQUUzQyxZQUFRO0FBRVIsUUFBSSxLQUFLLGFBQWEsU0FBUyxHQUFHO0FBQ2hDLGNBQVEsU0FBUyxPQUFPO0FBQUEsUUFDdEIsS0FBSztBQUFBLFFBQ0wsTUFBTTtBQUFBO0FBRVI7QUFBQTtBQUdGLFVBQU0sYUFBdUM7QUFBQSxNQUMzQyxNQUFNO0FBQUEsUUFDSixPQUFPO0FBQUEsUUFDUCxPQUFPO0FBQUEsUUFDUCxZQUFZLENBQUMsTUFBTSxPQUFPO0FBQUE7QUFBQSxNQUU1QixRQUFRO0FBQUEsUUFDTixPQUFPO0FBQUEsUUFDUCxPQUFPO0FBQUEsUUFDUCxZQUFZLENBQUMsT0FBTyxRQUFRLE9BQU8sT0FBTyxRQUFRO0FBQUE7QUFBQSxNQUVwRCxPQUFPO0FBQUEsUUFDTCxPQUFPO0FBQUEsUUFDUCxPQUFPO0FBQUEsUUFDUCxZQUFZLENBQUMsT0FBTyxPQUFPLE9BQU87QUFBQTtBQUFBLE1BRXBDLFdBQVc7QUFBQSxRQUNULE9BQU87QUFBQSxRQUNQLE9BQU87QUFBQSxRQUNQLFlBQVksQ0FBQyxPQUFPLFFBQVEsT0FBTyxRQUFRLE9BQU8sUUFBUTtBQUFBO0FBQUE7QUFLOUQsVUFBTSxpQkFBaUIsSUFBSTtBQUMzQixVQUFNLG9CQUFvQixJQUFJO0FBRTlCLGVBQVcsWUFBWSxLQUFLLGNBQWM7QUFDeEMsWUFBTSxZQUFZLFNBQVMsUUFBUSxtQkFBbUI7QUFFdEQsVUFBSSxVQUFVLFNBQVMsa0JBQWtCO0FBQ3ZDLGNBQU0sUUFBUSxVQUFVLE1BQU07QUFDOUIsY0FBTSxxQkFBcUIsTUFBTSxRQUFRO0FBQ3pDLFlBQUksc0JBQXNCLEtBQUsscUJBQXFCLElBQUksTUFBTSxRQUFRO0FBQ3BFLGdCQUFNLFlBQVksTUFBTSxxQkFBcUI7QUFDN0MsY0FBSSxDQUFDLGVBQWUsSUFBSSxZQUFZO0FBQ2xDLDJCQUFlLElBQUksV0FBVyxJQUFJO0FBQUE7QUFFcEMsK0JBQWUsSUFBSSxlQUFuQixtQkFBK0IsSUFBSTtBQUFBLGVBQzlCO0FBQ0wsNEJBQWtCLElBQUk7QUFBQTtBQUFBLGFBRW5CO0FBQ0wsMEJBQWtCLElBQUk7QUFBQTtBQUFBO0FBSzFCLFNBQUssZ0JBQWdCLE1BQU0sS0FBSyxvQkFBb0I7QUFHcEQsZUFBVyxlQUFlLENBQUMsUUFBUSxVQUFVLFVBQVU7QUFDckQsWUFBTSxXQUFXLFdBQVc7QUFDNUIsVUFBSSxTQUFTLE1BQU0sU0FBUyxHQUFHO0FBQzdCLGFBQUssZUFBZSxTQUFTO0FBQUE7QUFBQTtBQUtqQyxRQUFJLFdBQVcsVUFBVSxNQUFNLFNBQVMsS0FBSyxlQUFlLE9BQU8sR0FBRztBQUVwRSxjQUFRLFNBQVMsT0FBTztBQUFBLFFBQ3RCLEtBQUs7QUFBQSxRQUNMLE1BQU07QUFBQTtBQUlSLFdBQUssWUFBWSxTQUFTLFdBQVcsVUFBVTtBQUcvQyxpQkFBVyxDQUFDLFdBQVcsbUJBQW1CLGdCQUFnQjtBQUV4RCxnQkFBUSxTQUFTLE9BQU87QUFBQSxVQUN0QixLQUFLO0FBQUEsVUFDTCxNQUFNLGFBQU07QUFBQTtBQUlkLGNBQU0sc0JBQXNCLEtBQUs7QUFDakMsYUFBSyxnQkFBZ0IsTUFBTSxLQUFLLGlCQUFpQjtBQUdqRCxjQUFNLFlBQVksb0JBQW9CLEtBQUs7QUFDM0MsWUFBSSxVQUFVLFNBQVMsR0FBRztBQUN4QixlQUFLLFlBQVksU0FBUztBQUFBO0FBSTVCLGNBQU0sYUFBYSxvQkFBb0IsT0FBTztBQUM5QyxZQUFJLFdBQVcsU0FBUyxHQUFHO0FBQ3pCLGVBQUssWUFBWSxTQUFTO0FBQUE7QUFJNUIsY0FBTSxhQUFhO0FBQUEsVUFDakIsR0FBRyxvQkFBb0IsTUFBTTtBQUFBLFVBQzdCLEdBQUcsb0JBQW9CLFVBQVU7QUFBQTtBQUVuQyxZQUFJLFdBQVcsU0FBUyxHQUFHO0FBQ3pCLGVBQUssWUFBWSxTQUFTO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU0xQixtQkFBNkM7QUFDbkQsV0FBTztBQUFBLE1BQ0wsTUFBTTtBQUFBLFFBQ0osT0FBTztBQUFBLFFBQ1AsT0FBTztBQUFBLFFBQ1AsWUFBWSxDQUFDLE1BQU0sT0FBTztBQUFBO0FBQUEsTUFFNUIsUUFBUTtBQUFBLFFBQ04sT0FBTztBQUFBLFFBQ1AsT0FBTztBQUFBLFFBQ1AsWUFBWSxDQUFDLE9BQU8sUUFBUSxPQUFPLE9BQU8sUUFBUTtBQUFBO0FBQUEsTUFFcEQsT0FBTztBQUFBLFFBQ0wsT0FBTztBQUFBLFFBQ1AsT0FBTztBQUFBLFFBQ1AsWUFBWSxDQUFDLE9BQU8sT0FBTyxPQUFPO0FBQUE7QUFBQSxNQUVwQyxXQUFXO0FBQUEsUUFDVCxPQUFPO0FBQUEsUUFDUCxPQUFPO0FBQUEsUUFDUCxZQUFZLENBQUMsT0FBTyxRQUFRLE9BQU8sUUFBUSxPQUFPLFFBQVE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUt4RCxnQkFDTixPQUNBLFlBQ007QUFDTixlQUFXLFlBQVksT0FBTztBQUM1QixZQUFNLFdBQVcsU0FBUyxRQUFRLG1CQUFtQjtBQUNyRCxZQUFNLGVBQWUsS0FBSyxJQUFJLGNBQWMscUJBQzFDLFVBQ0E7QUFHRixVQUFJLHdCQUF3Qix5QkFBTztBQUNqQyxjQUFNLFlBQVksYUFBYSxVQUFVO0FBQ3pDLFlBQUksZ0JBQWdCO0FBRXBCLG1CQUFXLENBQUMsVUFBVSxTQUFTLE9BQU8sUUFBUSxhQUFhO0FBQ3pELGNBQUksS0FBSyxXQUFXLFNBQVMsWUFBWTtBQUN2QyxpQkFBSyxNQUFNLEtBQUssRUFBRSxNQUFNLGNBQWMsTUFBTSxVQUFVO0FBQ3RELDRCQUFnQjtBQUNoQjtBQUFBO0FBQUE7QUFJSixZQUFJLENBQUMsZUFBZTtBQUNsQixxQkFBVyxVQUFVLE1BQU0sS0FBSztBQUFBLFlBQzlCLE1BQU07QUFBQSxZQUNOLE1BQU07QUFBQSxZQUNOO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT0YsZUFBZSxXQUF3QixVQUEwQjtBQUN2RSxRQUFJLFNBQVMsTUFBTSxXQUFXO0FBQUc7QUFFakMsY0FBVSxTQUFTLE9BQU87QUFBQSxNQUN4QixLQUFLO0FBQUEsTUFDTCxNQUFNLFNBQVM7QUFBQTtBQUdqQixTQUFLLFlBQVksV0FBVyxTQUFTO0FBQUE7QUFBQSxFQUcvQixZQUFZLFdBQXdCLE9BQTZCO0FBaFozRTtBQWlaSSxVQUFNLEtBQUssQ0FBQyxHQUFHLE1BQU0sRUFBRSxLQUFLLFNBQVMsY0FBYyxFQUFFLEtBQUs7QUFHMUQsVUFBTSxlQUFlLFNBQVMsS0FBSyxTQUFTLE9BQU87QUFBQSxNQUNqRCxLQUFLO0FBQUE7QUFHUCxVQUFNLGtCQUFrQixTQUFTLEtBQUssVUFBVTtBQUFBLE1BQzlDLEtBQUs7QUFBQTtBQUlQLFFBQUksMkJBQTJCO0FBRy9CLFVBQU0sY0FBYyxDQUFDLE1BQWtCO0FBQ3JDLFVBQUksQ0FBQztBQUEwQjtBQUUvQixRQUFFO0FBQ0YsWUFBTSxlQUFlLEVBQUU7QUFDdkIsc0JBQWdCLGFBQWE7QUFBQTtBQUkvQixhQUFTLGlCQUFpQixTQUFTLGFBQWEsRUFBRSxTQUFTO0FBRzNELFNBQUssU0FBUyxNQUFNO0FBQ2xCLGVBQVMsb0JBQW9CLFNBQVM7QUFBQTtBQUd4QyxVQUFNLDZCQUE2QixDQUNqQyxjQUNBLGVBQ0EsZUFDQSxtQkFDRztBQUVILFlBQU0sV0FBVyxLQUFLLElBQUksZ0JBQWdCLEtBQUs7QUFDL0MsWUFBTSxZQUFZLEtBQUssSUFBSSxpQkFBaUIsS0FBSztBQUdqRCxVQUFJLFFBQVE7QUFDWixVQUFJLFNBQVM7QUFFYixVQUFJLFFBQVEsVUFBVTtBQUNwQixnQkFBUTtBQUNSLGlCQUFVLGdCQUFnQixXQUFZO0FBQUE7QUFHeEMsVUFBSSxTQUFTLFdBQVc7QUFDdEIsaUJBQVM7QUFDVCxnQkFBUyxlQUFlLFlBQWE7QUFBQTtBQUd2QyxhQUFPLEVBQUUsT0FBTztBQUFBO0FBR2xCLFVBQU0sd0JBQXdCLENBQUMsR0FBZSxjQUEyQjtBQUN2RSxVQUFJLENBQUM7QUFBVztBQUdoQixZQUFNLGdCQUFnQixPQUFPO0FBQzdCLFlBQU0saUJBQWlCLE9BQU87QUFHOUIsWUFBTSxPQUFPLFVBQVU7QUFDdkIsWUFBTSxRQUFRLEtBQUs7QUFDbkIsWUFBTSxTQUFTLEtBQUs7QUFHcEIsVUFBSSxJQUFJLEVBQUUsVUFBVTtBQUNwQixVQUFJLElBQUksRUFBRSxVQUFVO0FBR3BCLFVBQUksSUFBSSxRQUFRLGVBQWU7QUFDN0IsWUFBSSxFQUFFLFVBQVUsUUFBUTtBQUFBO0FBRTFCLFVBQUksSUFBSSxTQUFTLGdCQUFnQjtBQUMvQixZQUFJLEVBQUUsVUFBVSxTQUFTO0FBQUE7QUFHM0IsZ0JBQVUsTUFBTSxPQUFPLEdBQUc7QUFDMUIsZ0JBQVUsTUFBTSxNQUFNLEdBQUc7QUFBQTtBQUkzQixTQUFLLFNBQVMsTUFBTTtBQUNsQixtQkFBYTtBQUNiLHNCQUFnQjtBQUFBO0FBR2xCLGVBQVcsRUFBRSxNQUFNLE1BQU0sY0FBYyxPQUFPO0FBQzVDLFlBQU0sT0FBTyxVQUFVLFNBQVMsT0FBTztBQUFBLFFBQ3JDLEtBQUs7QUFBQTtBQUdQLFlBQU0sU0FBUyxLQUFLLFNBQVMsT0FBTztBQUFBLFFBQ2xDLEtBQUs7QUFBQTtBQUdQLFlBQU0sZ0JBQWdCLE9BQU8sV0FBVztBQUFBLFFBQ3RDLEtBQUs7QUFBQTtBQUdQLFlBQU0sWUFBWSxLQUFLLFVBQVU7QUFDakMsVUFBSSxXQUFXO0FBR2YsWUFBTSxPQUFPLE9BQU8sU0FBUyxLQUFLO0FBQUEsUUFDaEMsS0FBSztBQUFBLFFBQ0wsTUFBTSxLQUFLO0FBQUEsUUFDWCxNQUFNO0FBQUEsVUFDSixNQUFNO0FBQUEsVUFDTixhQUFhO0FBQUE7QUFBQTtBQUlqQixVQUFJLENBQUMsTUFBTSxPQUFPLFlBQVksU0FBUyxZQUFZO0FBQ2pELG1CQUFXO0FBR1gsY0FBTSxzQkFBc0IsT0FBTyxNQUFrQjtBQUNuRCxjQUFJO0FBQ0Ysa0JBQU0sU0FBUyxLQUFLLElBQUksTUFBTSxzQkFBc0IsS0FBSztBQUN6RCxnQkFBSSxrQkFBa0IseUJBQU87QUFDM0Isb0JBQU0sVUFBVSxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUs7QUFHMUMsOEJBQWdCO0FBQ2hCLDhCQUFnQixVQUFVO0FBQUEsZ0JBQ3hCLEtBQUs7QUFBQSxnQkFDTCxNQUFNLEtBQUs7QUFBQTtBQUliLG9CQUFNLFlBQVksZ0JBQWdCO0FBQ2xDLG9CQUFNLG1DQUFpQixlQUVyQixRQUFRLFNBQVMsTUFDYixRQUFRLE1BQU0sR0FBRyxPQUNmLHVFQUNBLFFBQVEsU0FDUixpQkFDRixTQUNKLFdBQ0EsS0FBSyxNQUNMO0FBR0YsOEJBQWdCLFVBQVUsSUFBSTtBQUM5Qix5Q0FBMkI7QUFDM0Isb0NBQXNCLEdBQUc7QUFBQTtBQUFBLG1CQUVwQixPQUFQO0FBQ0Esb0JBQVEsTUFBTSxvQ0FBb0M7QUFBQTtBQUFBO0FBSXRELGNBQU0sc0JBQXNCLE1BQU07QUFDaEMsMEJBQWdCLFVBQVUsT0FBTztBQUNqQywwQkFBZ0I7QUFDaEIscUNBQTJCO0FBRTNCLDBCQUFnQixZQUFZO0FBQUE7QUFJOUIsYUFBSyxpQkFBaUIsY0FBYztBQUNwQyxhQUFLLGlCQUFpQixjQUFjO0FBQ3BDLGFBQUssaUJBQWlCLGFBQWEsQ0FBQyxNQUNsQyxzQkFBc0IsR0FBRztBQUkzQix3QkFBZ0IsaUJBQWlCLGNBQWM7QUFHL0MsYUFBSyxTQUFTLE1BQU07QUFDbEIsMEJBQWdCLG9CQUNkLGNBQ0E7QUFBQTtBQUtKLGFBQUssYUFBYSxpQkFBaUIsY0FBYztBQUFBLGlCQUVqRCxDQUFDLE9BQU8sUUFBUSxPQUFPLE9BQU8sUUFBUSxPQUFPLFNBQVMsWUFDdEQ7QUFDQSxtQkFBVztBQUdYLGNBQU0sbUJBQW1CLE9BQU8sTUFBa0I7QUFDaEQsY0FBSTtBQUNGLGtCQUFNLFlBQVksS0FBSyxJQUFJLE1BQU0sc0JBQXNCLEtBQUs7QUFDNUQsZ0JBQUkscUJBQXFCLHlCQUFPO0FBQzlCLG9CQUFNLGNBQWMsTUFBTSxLQUFLLElBQUksTUFBTSxXQUFXO0FBQ3BELG9CQUFNLE9BQU8sSUFBSSxLQUFLLENBQUM7QUFDdkIsb0JBQU0sTUFBTSxJQUFJLGdCQUFnQjtBQUVoQywyQkFBYSxNQUFNO0FBQ25CLDJCQUFhLFNBQVMsTUFBTTtBQUMxQixvQkFBSSxnQkFBZ0I7QUFDcEIsNkJBQWEsVUFBVSxJQUFJO0FBRTNCLHNCQUFNLEVBQUUsT0FBTyxXQUFXLDJCQUN4QixhQUFhLGNBQ2IsYUFBYSxlQUNiLE9BQU8sWUFDUCxPQUFPO0FBRVQsNkJBQWEsTUFBTSxRQUFRLEdBQUc7QUFDOUIsNkJBQWEsTUFBTSxTQUFTLEdBQUc7QUFDL0Isc0NBQXNCLEdBQUc7QUFBQTtBQUFBO0FBQUEsbUJBR3RCLE9BQVA7QUFDQSxvQkFBUSxNQUFNLGlDQUFpQztBQUFBO0FBQUE7QUFJbkQsY0FBTSxtQkFBbUIsTUFBTTtBQUM3Qix1QkFBYSxVQUFVLE9BQU87QUFDOUIsdUJBQWEsTUFBTTtBQUVuQix1QkFBYSxNQUFNLFFBQVE7QUFDM0IsdUJBQWEsTUFBTSxTQUFTO0FBQUE7QUFJOUIsYUFBSyxpQkFBaUIsY0FBYztBQUNwQyxhQUFLLGlCQUFpQixjQUFjO0FBQ3BDLGFBQUssaUJBQWlCLGFBQWEsQ0FBQyxNQUNsQyxzQkFBc0IsR0FBRztBQUkzQixxQkFBYSxpQkFBaUIsY0FBYztBQUc1QyxhQUFLLFNBQVMsTUFBTTtBQUNsQix1QkFBYSxvQkFBb0IsY0FBYztBQUFBO0FBSWpELGFBQUssYUFBYSxpQkFBaUIsY0FBYztBQUFBLGlCQUN4QyxDQUFDLE9BQU8sT0FBTyxPQUFPLE9BQU8sU0FBUyxZQUFZO0FBQzNELG1CQUFXO0FBQUEsaUJBRVgsQ0FBQyxPQUFPLFFBQVEsT0FBTyxRQUFRLE9BQU8sUUFBUSxPQUFPLFNBQVMsWUFDOUQ7QUFDQSxtQkFBVztBQUFBO0FBR2IscUNBQVEsZUFBZTtBQUV2QixXQUFLLGlCQUFpQixTQUFTLENBQUMsTUFBTTtBQUNwQyxVQUFFO0FBQ0YsVUFBRTtBQUNGLGFBQUssSUFBSSxVQUFVLGFBQWEsVUFBVSxJQUFJO0FBQUE7QUFHaEQsWUFBTSxPQUFPLEtBQUssVUFBVSxFQUFFLEtBQUs7QUFFbkMsWUFBTSxPQUFPLEtBQUssVUFBVSxFQUFFLEtBQUs7QUFDbkMsV0FBSyxRQUFRLEtBQUssVUFBVTtBQUU1QixZQUFNLFlBQVksS0FBSyxVQUFVO0FBQUEsUUFDL0IsS0FBSztBQUFBO0FBR1AsWUFBTSxPQUFPLFVBQVUsVUFBVSxFQUFFLEtBQUs7QUFDeEMsV0FBSyxRQUFRLEtBQUssZUFBZSxZQUFLLFNBQUwsbUJBQVcsU0FBUTtBQUVwRCxVQUFJLEtBQUssY0FBYyxRQUFRLEtBQUssY0FBYyxPQUFPO0FBQ3ZELGNBQU0sYUFBYSxVQUFVLFVBQVU7QUFBQSxVQUNyQyxLQUFLO0FBQUE7QUFFUCxjQUFNLFFBQVEsS0FBSyxZQUFZLElBQUksS0FBSyxTQUFTO0FBQ2pELG1CQUFXLFFBQVEsS0FBSyxhQUFhLGlCQUFpQjtBQUd0RCxZQUFJLENBQUMsS0FBSyxZQUFZLElBQUksS0FBSyxPQUFPO0FBQ3BDLGVBQUssaUJBQWlCLE1BQU0sS0FBSyxNQUFNO0FBQ3JDLHVCQUFXLFFBQ1QsS0FBSyxhQUFhLGlCQUNoQixLQUFLLFlBQVksSUFBSSxLQUFLLFNBQVM7QUFBQTtBQUFBO0FBQUE7QUFRN0MsWUFBTSxZQUFZLEtBQUssU0FBUyxVQUFVO0FBQUEsUUFDeEMsS0FBSztBQUFBLFFBQ0wsTUFBTTtBQUFBO0FBR1IsZ0JBQVUsaUJBQWlCLFNBQVMsQ0FBQyxNQUFNO0FBQ3pDLFVBQUU7QUFDRixhQUFLLGtCQUFrQjtBQUFBO0FBQUE7QUFBQTtBQUFBLFFBS2YsaUJBQWdDO0FBQzVDLFVBQU0sUUFBUSxJQUFJLHNCQUNoQixLQUFLLEtBQ0wsT0FBTyxVQUFtQjtBQUN4QixpQkFBVyxRQUFRLE9BQU87QUFDeEIsWUFBSTtBQUNGLGdCQUFNLEtBQUssaUJBQWlCO0FBQUEsaUJBQ3JCLE9BQVA7QUFDQSxlQUFLLHVCQUNILE1BQ0EsVUFBVSxNQUFNLFdBQ2hCO0FBRUYscUJBQVcsTUFBTTtBQUNmLGlCQUFLLHVCQUF1QixNQUFNLElBQUksSUFBSTtBQUFBLGFBQ3pDO0FBQUE7QUFBQTtBQUFBO0FBS1gsVUFBTTtBQUFBO0FBQUEsUUFHTSxrQkFBa0IsVUFBaUM7QUFDL0QsVUFBTSxpQkFBaUIsU0FBUyxRQUFRLG1CQUFtQjtBQUMzRCxTQUFLLGFBQWEsT0FBTztBQUN6QixTQUFLLGFBQWEsT0FBTyxLQUFLO0FBQzlCLFNBQUs7QUFDTCxVQUFNLEtBQUs7QUFBQTtBQUFBLFFBR0EsaUJBQWlCLE1BQTRCO0FBQ3hELFVBQU0sWUFBWSxLQUFLLFVBQVU7QUFDakMsVUFBTSxnQkFBZ0IsQ0FBQyxPQUFPLE9BQU8sUUFBUSxPQUFPO0FBQ3BELFVBQU0sa0JBQWtCLENBQUMsT0FBTyxPQUFPLFFBQVEsT0FBTztBQUd0RCxRQUFJLGNBQWMsU0FBUyxZQUFZO0FBQ3JDLFVBQUk7QUFDRixjQUFNLFlBQVksTUFBTSxLQUFLLG9CQUFvQjtBQUNqRCxjQUFNLFdBQVcsS0FBSztBQUN0QixhQUFLLGFBQWEsSUFBSTtBQUFBLGVBQ2YsT0FBUDtBQUNBLGFBQUssdUJBQ0gsTUFDQSxVQUFVLE1BQU0sV0FDaEI7QUFBQTtBQUFBLGVBR0ssZ0JBQWdCLFNBQVMsWUFBWTtBQUM5QyxVQUFJO0FBQ0YsY0FBTSxZQUFZLE1BQU0sS0FBSyxpQkFBaUI7QUFDOUMsY0FBTSxXQUFXLEtBQUs7QUFDdEIsYUFBSyxhQUFhLElBQUk7QUFBQSxlQUNmLE9BQVA7QUFDQSxhQUFLLHVCQUNILE1BQ0EsVUFBVSxNQUFNLFdBQ2hCO0FBQUE7QUFBQSxXQUdDO0FBRUwsWUFBTSxXQUFXLEtBQUssS0FBSztBQUMzQixXQUFLLGFBQWEsSUFBSTtBQUFBO0FBR3hCLFNBQUs7QUFDTCxVQUFNLEtBQUs7QUFBQTtBQUFBLFFBR0Msb0JBQW9CLE1BQThCO0FBM3dCbEU7QUE2d0JJLFNBQUssdUJBQXVCLE1BQU0sZ0JBQWdCO0FBQ2xELFVBQU0sRUFBRSxZQUFZLFFBQVEsV0FDMUIsTUFBTSxLQUFLLGNBQWMsZUFBZTtBQUcxQyxRQUFJLENBQUMsUUFBUTtBQUVYLFdBQUssdUJBQXVCLE1BQU0saUJBQWlCO0FBQ25ELFlBQU0sVUFBVSxNQUFNLEtBQUssa0JBQWtCO0FBQzdDLFVBQUksQ0FBQyxTQUFTO0FBQ1osY0FBTSxJQUFJLE1BQU07QUFBQTtBQUFBO0FBS3BCLFNBQUssdUJBQXVCLE1BQU0sMEJBQTBCO0FBQzVELFVBQU0saUJBQWlCLE1BQU0sS0FBSyxtQkFBbUI7QUFHckQsVUFBTSxtQkFBbUIsS0FBSyxjQUFjO0FBQzVDLFVBQU0sV0FBVyxLQUFLLFNBQVMsUUFBUSxpQkFBaUIsS0FBSztBQUk3RCxVQUFNLGFBQWEsbUJBQ2YsR0FBRyxvQkFBb0IsYUFDdkIsR0FBRyxpQkFBSyxXQUFMLG1CQUFhLFNBQWIsWUFBcUIsTUFBTTtBQUVsQyxVQUFNLEtBQUssSUFBSSxNQUFNLGFBQWEsWUFBWSxNQUFNLE1BQU07QUFBQTtBQUkxRCxVQUFNLGdCQUFnQixLQUFLLHNCQUFzQjtBQUNqRCxVQUFNLFlBQVksR0FBRyxjQUFjO0FBR25DLFFBQUk7QUFDRixZQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sV0FBVztBQUFBLGFBQ2hDLE9BQVA7QUFFQSxVQUNFLENBQUUsa0JBQWlCLFVBQ25CLENBQUMsTUFBTSxRQUFRLFNBQVMsbUJBQ3hCO0FBQ0EsY0FBTTtBQUFBO0FBQUE7QUFLVixVQUFNLGFBQWEsS0FBSztBQUN4QixTQUFLLGFBQWEsSUFBSTtBQUd0QixRQUFJLGVBQWUsVUFBVSxPQUFPLGVBQWUsV0FBVyxVQUFVO0FBQ3RFLGlCQUFXLENBQUMsVUFBVSxlQUFlLE9BQU8sUUFDMUMsZUFBZSxTQUNkO0FBQ0QsY0FBTSxZQUFZLEdBQUcsY0FBYyxTQUNoQyxRQUFRLGlCQUFpQixLQUN6QjtBQUdILFlBQUk7QUFDRixnQkFBTSxLQUFLLElBQUksTUFBTSxhQUNuQixXQUNBLEtBQUssYUFBYTtBQUFBLGlCQUViLE9BQVA7QUFFQSxjQUNFLENBQUUsa0JBQWlCLFVBQ25CLENBQUMsTUFBTSxRQUFRLFNBQVMsbUJBQ3hCO0FBQ0Esa0JBQU07QUFBQTtBQUFBO0FBS1YsY0FBTSxnQkFBZ0IsS0FBSztBQUMzQixhQUFLLGFBQWEsSUFBSTtBQUFBO0FBQUE7QUFLMUIsU0FBSyx1QkFBdUIsTUFBTSx1QkFBdUI7QUFDekQsV0FBTztBQUFBO0FBQUEsRUFHRCxzQkFBc0IsZ0JBQTZCO0FBcjJCN0Q7QUFzMkJJLFVBQU0sT0FBTyx1REFBZ0IsU0FBaEIsWUFBd0I7QUFDckMsVUFBTSxXQUFXLHVEQUFnQixhQUFoQixZQUE0QjtBQUM3QyxVQUFNLFlBQVksdURBQWdCLGNBQWhCLFlBQTZCO0FBQy9DLFdBQU87QUFBQSxjQUNHO0FBQUE7QUFBQSxFQUVaO0FBQUE7QUFBQSxFQUVBLFdBQVc7QUFBQTtBQUFBLEVBQWlCLEtBQUssVUFBVSxVQUFVLE1BQU0sT0FBTztBQUFBO0FBQUE7QUFBQSxFQUkxRCxhQUFhLGNBQW1DO0FBQ3RELFVBQU0sWUFBWSxPQUFPLEtBQUs7QUFDOUIsVUFBTSxNQUFNLFVBQVU7QUFDdEIsVUFBTSxRQUFRLElBQUksV0FBVztBQUM3QixhQUFTLElBQUksR0FBRyxJQUFJLEtBQUssS0FBSztBQUM1QixZQUFNLEtBQUssVUFBVSxXQUFXO0FBQUE7QUFFbEMsV0FBTyxNQUFNO0FBQUE7QUFBQSxFQUdQLE1BQU0sSUFBMkI7QUFDdkMsV0FBTyxJQUFJLFFBQVEsQ0FBQyxZQUFZLFdBQVcsU0FBUztBQUFBO0FBQUEsRUFHdEQsa0JBQStCO0FBQzdCLFdBQU8sS0FBSztBQUFBO0FBQUEsUUFHRCxnQkFBZ0IsT0FBZ0M7QUFDM0QsU0FBSyxlQUFlLElBQUksSUFBSTtBQUM1QixTQUFLO0FBQ0wsVUFBTSxLQUFLO0FBQUE7QUFBQSxFQUdiLGVBQTRCO0FBQzFCLFdBQU8sS0FBSztBQUFBO0FBQUEsRUFHZCxTQUFlO0FBRWIsU0FBSyxtQkFBbUIsUUFBUSxDQUFDLFlBQVk7QUFDM0MsbUJBQWE7QUFBQTtBQUVmLFNBQUssbUJBQW1CO0FBR3hCLFNBQUssZ0JBQWdCLFFBQVEsQ0FBQyxhQUFhO0FBQ3pDLGVBQVM7QUFBQTtBQUVYLFNBQUssZ0JBQWdCO0FBRXJCLFFBQUksS0FBSyxrQkFBa0I7QUFDekIsV0FBSyxpQkFBaUIsTUFBTSxVQUFVO0FBQUE7QUFHeEMsU0FBSyxPQUFPO0FBQUE7QUFBQSxRQUdBLGlCQUNaLE1BQ0EsY0FBdUIsT0FDTjtBQXI2QnJCO0FBdTZCSSxTQUFLLHVCQUF1QixNQUFNLHlCQUF5QjtBQUUzRCxRQUFJO0FBRUYsWUFBTSx1QkFBdUIscUJBQXFCLFlBQ2hELEtBQUs7QUFFUCxZQUFNLE9BQU8sTUFBTSxxQkFBcUIsZUFBZSxNQUFNO0FBQUEsUUFDM0QsTUFBTTtBQUFBLFFBQ047QUFBQSxRQUNBLFlBQVksQ0FBQyxVQUFVLFdBQVc7QUFDaEMsZUFBSyx1QkFBdUIsTUFBTSxRQUFRO0FBQUE7QUFBQTtBQUs5QyxZQUFNLG1CQUFtQixLQUFLLGNBQWM7QUFDNUMsWUFBTSxXQUFXLEtBQUssU0FBUyxRQUFRLGlCQUFpQixLQUFLO0FBQzdELFlBQU0sYUFBYSxtQkFDZixHQUFHLG9CQUFvQixhQUN2QixHQUFHLGlCQUFLLFdBQUwsbUJBQWEsU0FBYixZQUFxQixNQUFNO0FBRWxDLFlBQU0sS0FBSyxJQUFJLE1BQU0sYUFBYSxZQUFZLE1BQU0sTUFBTTtBQUFBO0FBRTFELFlBQU0sYUFBYSxHQUFHLGNBQWM7QUFDcEMsWUFBTSxlQUFlO0FBQUEsVUFDakIsS0FBSztBQUFBLGVBQ0EsSUFBSSxPQUFPO0FBQUE7QUFBQSxFQUV4QjtBQUdJLFVBQUk7QUFDRixjQUFNLGVBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBQzFELFlBQUksd0JBQXdCLHlCQUFPO0FBQ2pDLGdCQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sY0FBYztBQUFBLGVBQ3JDO0FBQ0wsZ0JBQU0sS0FBSyxJQUFJLE1BQU0sT0FBTyxZQUFZO0FBQUE7QUFBQSxlQUVuQyxPQUFQO0FBQ0EsZ0JBQVEsTUFBTSwwQkFBMEI7QUFDeEMsY0FBTTtBQUFBO0FBR1IsV0FBSyx1QkFBdUIsTUFBTSx1QkFBdUI7QUFDekQsYUFBTztBQUFBLGFBQ0EsT0FBUDtBQUNBLGNBQVEsTUFBTSw4QkFBOEI7QUFDNUMsV0FBSyx1QkFDSCxNQUNBLFVBQVUsaUJBQWlCLFFBQVEsTUFBTSxVQUFVLE9BQU8sVUFDMUQ7QUFFRixZQUFNO0FBQUE7QUFBQTtBQUFBLFFBSUksa0JBQWtCLFlBQXNDO0FBaCtCeEU7QUFpK0JJLFVBQU0sV0FBVztBQUNqQixhQUFTLElBQUksR0FBRyxJQUFJLFVBQVUsS0FBSztBQUNqQyxZQUFNLEtBQUssTUFBTTtBQUNqQixZQUFNLE1BQU0sR0FBRyxLQUFLLGNBQWMsNEJBQTRCO0FBQzlELFlBQU0sT0FBTyxNQUFNLE1BQU07QUFDekIsVUFBSSxDQUFDLEtBQUs7QUFBSTtBQUNkLFlBQU0sT0FBTyxNQUFNLEtBQUs7QUFDeEIsVUFBSSxvQ0FBTSxTQUFOLG1CQUFZLFlBQVc7QUFBYSxlQUFPO0FBQy9DLFVBQUksb0NBQU0sU0FBTixtQkFBWSxZQUFXLFNBQVM7QUFDbEMsY0FBTSxJQUFJLE1BQU0sb0NBQU0sU0FBTixtQkFBWSxVQUFTO0FBQUE7QUFBQTtBQUd6QyxXQUFPO0FBQUE7QUFBQSxRQUdLLG1CQUFtQixZQUFvQjtBQUNuRCxVQUFNLE1BQU0sR0FBRyxLQUFLLGNBQWMsNEJBQTRCO0FBQzlELFVBQU0sT0FBTyxNQUFNLE1BQU07QUFDekIsUUFBSSxDQUFDLEtBQUssSUFBSTtBQUNaLFlBQU0sSUFBSSxNQUFNLCtCQUErQixLQUFLO0FBQUE7QUFFdEQsVUFBTSxPQUFPLE1BQU0sS0FBSztBQUN4QixRQUFJLENBQUMsS0FBSyxTQUFTO0FBQ2pCLFlBQU0sSUFBSSxNQUFNLEtBQUssU0FBUztBQUFBO0FBRWhDLFdBQU8sS0FBSyxLQUFLO0FBQUE7QUFBQSxRQUdMLG9CQUFvQixNQUE4QjtBQUM5RCxRQUFJO0FBQ0YsVUFBSSxLQUFLLGNBQWMsUUFBUSxLQUFLLGNBQWMsT0FBTztBQUN2RCxjQUFNLFVBQVUsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLO0FBQzFDLGVBQU8sS0FBSyxhQUFhLHNCQUFzQjtBQUFBO0FBRWpELGFBQU87QUFBQSxhQUNBLE9BQVA7QUFDQSxjQUFRLE1BQU0sc0NBQXNDLEtBQUssTUFBTTtBQUMvRCxhQUFPO0FBQUE7QUFBQTtBQUFBLFFBSUcsaUJBQWlCLE1BQTRCO0FBQ3pELFVBQU0sUUFBUSxNQUFNLEtBQUssb0JBQW9CO0FBQzdDLFNBQUssWUFBWSxJQUFJLEtBQUssTUFBTTtBQUFBO0FBQUEsRUFHMUIsZUFBZSxPQUF1QjtBQUM1QyxRQUFJLFFBQVE7QUFBTSxhQUFPLFFBQVE7QUFDakMsVUFBTSxLQUFLLFFBQVE7QUFDbkIsUUFBSSxLQUFLO0FBQU0sYUFBTyxHQUFHLFFBQVEsS0FBSztBQUN0QyxVQUFNLEtBQUssS0FBSztBQUNoQixXQUFPLEdBQUcsUUFBUSxLQUFLO0FBQUE7QUFBQTs7O0FQdGdDM0I7OztBU2RBLHdCQUEyQztBQUszQztBQTJCTyxrQ0FBNEIsd0JBQU07QUFBQSxFQWN2QyxZQUNFLEtBQ0EsVUFDQSxRQUNBO0FBQ0EsVUFBTTtBQWxCQSxxQkFBK0I7QUFDL0IsMEJBQWdDO0FBS2hDLDZCQUE0QjtBQUM1QixxQkFBMkI7QUFDM0IsZ0NBQXdEO0FBRXhELCtCQUErQjtBQVNyQyxTQUFLLFdBQVc7QUFDaEIsU0FBSyxTQUFTO0FBQ2QsU0FBSyxnQkFBZ0IsSUFBSTtBQUN6QixTQUFLLGNBQWMsSUFBSSxtQkFDckIsS0FDQSxPQUFPLFNBQVM7QUFBQTtBQUFBLFFBSU4sZ0JBQWdCLE1BQXVCO0FBN0R2RDtBQThESSxVQUFNLGFBQWEsS0FBSyxTQUNyQixJQUFJLENBQUMsUUFBUSxLQUFLLGtCQUFrQixNQUNwQyxLQUFLO0FBRVIsVUFBTSxjQUFjLE1BQU0sS0FBSyxlQUFlO0FBRzlDLFVBQU0sY0FDSixrQkFBSyxnQkFBTCxtQkFBa0IsVUFBbEIsbUJBQXlCLGNBQWMsTUFBTSxPQUFPLE9BQU8sYUFBWTtBQUV6RSxVQUFNLGVBQWU7QUFBQSxNQUVuQjtBQUFBLFFBQ0UsT0FBTztBQUFBLFFBQ1AsTUFBTTtBQUFBLFFBQ04sUUFBUTtBQUFBO0FBQUEsTUFJVixHQUFHLFdBQVcsTUFBTSxjQUFjLElBQUksQ0FBQyxTQUFVO0FBQUEsUUFDL0MsT0FBTztBQUFBLFFBQ1AsTUFBTTtBQUFBLFFBQ04sUUFBUTtBQUFBO0FBQUEsTUFJVjtBQUFBLFFBQ0UsT0FBTztBQUFBLFFBQ1AsTUFBTSxNQUFNLEtBQUssYUFBYSxLQUFLO0FBQUEsUUFDbkMsUUFBUTtBQUFBO0FBQUEsTUFJVjtBQUFBLFFBQ0UsT0FBTztBQUFBLFFBQ1AsTUFBTTtBQUFBLFFBQ04sUUFBUTtBQUFBO0FBQUEsTUFJVixHQUFHLFlBQVksTUFBTSxZQUFZLElBQUksQ0FBQyxTQUFVO0FBQUEsUUFDOUMsT0FBTztBQUFBLFFBQ1AsTUFBTTtBQUFBLFFBQ04sUUFBUTtBQUFBO0FBQUE7QUFLWixRQUFJLFlBQVksU0FBUyxHQUFHO0FBRTFCLFlBQU0sa0JBQWtCLFdBQVc7QUFDbkMsZUFBUyxJQUFJLEdBQUcsSUFBSSxZQUFZLFNBQVMsR0FBRyxLQUFLO0FBQy9DLGNBQU0sUUFBUSxZQUFZO0FBQzFCLGNBQU0sUUFBUSxZQUFZLElBQUk7QUFHOUIsWUFBSSxNQUFNO0FBQ1YsZUFBUSxPQUFNLGdCQUFnQixRQUFRLE9BQU8sVUFBVSxJQUFJO0FBRXpELGdCQUFNLFVBQVUsZ0JBQWdCLFFBQVEsT0FBTztBQUMvQyxjQUFJLFlBQVksTUFBTSxVQUFXLE9BQU0sTUFBTSxVQUFVLElBQUk7QUFFekQseUJBQWEsS0FBSztBQUFBLGNBQ2hCLE9BQU87QUFBQSxjQUNQLE1BQU0sV0FBVyxNQUFNLEtBQUssVUFBVSxNQUFNO0FBQUEsY0FDNUMsUUFBUTtBQUFBO0FBQUE7QUFHWjtBQUFBO0FBQUE7QUFBQTtBQUtOLFdBQU87QUFBQTtBQUFBLEVBR0Qsa0JBQWtCLFNBQThCO0FBQ3RELFFBQUksT0FBTyxRQUFRLFlBQVksVUFBVTtBQUN2QyxhQUFPLFFBQVE7QUFBQTtBQUdqQixXQUFPO0FBQUE7QUFBQSxFQUdELGVBQWUsTUFBYyxZQUE4QjtBQUNqRSxVQUFNLFVBQW9CO0FBQzFCLFFBQUksZUFBZTtBQUNuQixXQUFPLEtBQUs7QUFDWixpQkFBYSxXQUFXO0FBRXhCLFdBQU8sZUFBZSxLQUFLLFFBQVE7QUFDakMsWUFBTSxRQUFRLEtBQUssUUFBUSxZQUFZO0FBQ3ZDLFVBQUksVUFBVTtBQUFJO0FBQ2xCLGNBQVEsS0FBSztBQUNiLHFCQUFlLFFBQVE7QUFBQTtBQUV6QixXQUFPO0FBQUE7QUFBQSxFQUdELGtCQUNOLFVBQ0EsVUFBeUIsSUFDZTtBQXBLNUM7QUFzS0ksUUFBSSxDQUFDLFdBQVcsUUFBUSxXQUFXLEdBQUc7QUFDcEMsWUFBTSxjQUFjLFNBQVMsU0FBUyxTQUFTO0FBQy9DLFVBQUksQ0FBQztBQUFhLGVBQU8sRUFBRSxNQUFNLElBQUksY0FBYztBQUNuRCxhQUFPLEVBQUUsTUFBTSxLQUFLLGtCQUFrQixjQUFjLGNBQWM7QUFBQTtBQUlwRSxVQUFNLGlCQUFpQixRQUFRLE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVTtBQUN6RCxRQUFJLGVBQWUsV0FBVyxHQUFHO0FBQy9CLFlBQU0sY0FBYyxTQUFTLFNBQVMsU0FBUztBQUMvQyxVQUFJLENBQUM7QUFBYSxlQUFPLEVBQUUsTUFBTSxJQUFJLGNBQWM7QUFDbkQsYUFBTyxFQUFFLE1BQU0sS0FBSyxrQkFBa0IsY0FBYyxjQUFjO0FBQUE7QUFJcEUsVUFBTSxhQUFhLFNBQ2hCLElBQUksQ0FBQyxRQUFRLEtBQUssa0JBQWtCLE1BQ3BDLEtBQUs7QUFHUixVQUFNLGNBQ0osa0JBQUssZ0JBQUwsbUJBQWtCLFVBQWxCLG1CQUF5QixjQUFjLE1BQU0sT0FBTyxPQUFPLGFBQVk7QUFHekUsVUFBTSxjQUF3QjtBQUM5QixVQUFNLGtCQUFrQixXQUFXO0FBRW5DLGdCQUFZLFFBQVEsQ0FBQyxTQUFTO0FBQzVCLFlBQU0sVUFBVSxLQUFLLGVBQWUsaUJBQWlCO0FBQ3JELGtCQUFZLEtBQUssR0FBRztBQUFBO0FBR3RCLFFBQUksWUFBWSxXQUFXLEdBQUc7QUFFNUIsWUFBTSxhQUFhLGVBQWU7QUFDbEMsa0JBQVksS0FBSyxXQUFXLFFBQVE7QUFBQTtBQUl0QyxnQkFBWSxLQUFLLENBQUMsR0FBRyxNQUFNLElBQUk7QUFHL0IsVUFBTSxlQUFlO0FBQ3JCLFFBQUksWUFBWSxZQUFZO0FBQzVCLFFBQUksVUFBVSxZQUFZO0FBQzFCLFFBQUksV0FBVztBQUdmLGFBQVMsSUFBSSxHQUFHLElBQUksWUFBWSxRQUFRLEtBQUs7QUFDM0MsWUFBTSxRQUFRLFlBQVk7QUFDMUIsWUFBTSxlQUFlLElBQUk7QUFHekIsZUFBUyxJQUFJLEdBQUcsSUFBSSxZQUFZLFFBQVEsS0FBSztBQUMzQyxjQUFNLE1BQU0sWUFBWTtBQUN4QixjQUFNLE9BQU8sTUFBTTtBQUduQixjQUFNLGlCQUFpQixZQUFZLEtBQUssQ0FBQyxTQUN2QyxnQkFBZ0IsTUFBTSxZQUFZLElBQUksV0FBVztBQUVuRCxZQUFJLGdCQUFnQjtBQUNsQix1QkFBYSxJQUFJO0FBQUE7QUFJbkIsWUFBSSxhQUFhLFNBQVMsWUFBWSxVQUFVLE9BQU8sVUFBVTtBQUMvRCxzQkFBWTtBQUNaLG9CQUFVO0FBQ1YscUJBQVc7QUFBQTtBQUFBO0FBQUE7QUFNakIsVUFBTSxlQUFlLEtBQUssSUFBSSxHQUFHLFlBQVk7QUFDN0MsVUFBTSxhQUFhLEtBQUssSUFBSSxXQUFXLFFBQVEsVUFBVTtBQUd6RCxRQUFJLGVBQWU7QUFDbkIsV0FDRSxlQUFlLEtBQ2YsQ0FBQyxZQUFZLEtBQUssV0FBVyxlQUFlLEtBQzVDO0FBQ0E7QUFBQTtBQUdGLFFBQUksYUFBYTtBQUNqQixXQUNFLGFBQWEsV0FBVyxVQUN4QixDQUFDLFlBQVksS0FBSyxXQUFXLGNBQzdCO0FBQ0E7QUFBQTtBQUdGLFFBQUksVUFBVSxXQUFXLE1BQU0sY0FBYyxZQUFZO0FBR3pELFFBQUksZUFBZTtBQUFHLGdCQUFVLFFBQVE7QUFDeEMsUUFBSSxhQUFhLFdBQVc7QUFBUSxnQkFBVSxVQUFVO0FBRXhELFdBQU8sRUFBRSxNQUFNLFNBQVM7QUFBQTtBQUFBLEVBR2xCLFdBQVcsV0FBMkI7QUFDNUMsV0FBTyxJQUFJLEtBQUssV0FBVztBQUFBO0FBQUEsRUFHckIsY0FBYztBQUNwQixTQUFLO0FBRUwsVUFBTSxPQUFPLEtBQUssSUFBSSxVQUFVLFFBQVE7QUFDeEMsU0FBSyxhQUFhO0FBQUEsTUFDaEIsTUFBTTtBQUFBLE1BQ04sT0FBTztBQUFBO0FBR1QsU0FBSyxJQUFJLFVBQVUsY0FBYztBQUFBO0FBQUEsUUFHcEIsU0FBd0I7QUFDckMsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUNWLGNBQVUsU0FBUztBQUduQixVQUFNLG1CQUFtQixVQUFVLFVBQVU7QUFBQSxNQUMzQyxLQUFLO0FBQUE7QUFFUCxxQkFBaUIsV0FBVyxFQUFFLE1BQU07QUFFcEMsUUFBSTtBQUNGLFlBQU0sUUFBUSxNQUFNLEtBQUssWUFBWTtBQUVyQyxXQUFLLFlBQVksTUFBTSxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsZUFBZSxFQUFFO0FBQUEsYUFDbEQsT0FBUDtBQUNBLGNBQVEsTUFBTSx5QkFBeUI7QUFDdkMsV0FBSyxZQUFZO0FBQUE7QUFJbkIsY0FBVTtBQUVWLFVBQU0sa0JBQWtCLFVBQVUsVUFBVTtBQUFBLE1BQzFDLEtBQUs7QUFBQTtBQUVQLFNBQUssY0FBYyxnQkFBZ0IsU0FBUyxTQUFTO0FBQUEsTUFDbkQsTUFBTTtBQUFBLE1BQ04sYUFBYTtBQUFBO0FBRWYsU0FBSyxZQUFZO0FBRWpCLFNBQUssV0FBVyxVQUFVLFVBQVUsRUFBRSxLQUFLO0FBRzNDLFVBQU0saUJBQWlCLE1BQU0sUUFBUSxJQUNuQyxLQUFLLFVBQVUsSUFBSSxPQUFPLFNBQVU7QUFBQSxNQUNsQztBQUFBLE1BQ0EsU0FBUztBQUFBLE1BQ1QsT0FBTztBQUFBO0FBR1gsVUFBTSxLQUFLLFlBQVk7QUFFdkIsU0FBSyxZQUFZLGlCQUFpQixTQUFTLFlBQVk7QUFDckQsWUFBTSxRQUFRLEtBQUssWUFBWTtBQUMvQixZQUFNLFVBQVUsTUFBTSxRQUFRLElBQzVCLEtBQUssVUFBVSxJQUFJLE9BQU8sU0FBUztBQUNqQyxjQUFNLGVBQWUsTUFBTSxLQUFLLGdCQUFnQjtBQUNoRCxjQUFNLGVBQWUsS0FBSyxjQUFjLE9BQ3RDLENBQUMsT0FDRCxPQUNBLE1BQU0sY0FDTjtBQUNGLGVBQU87QUFBQSxVQUNMO0FBQUEsVUFDQSxTQUFTLDhDQUFjLFlBQVc7QUFBQSxVQUNsQyxPQUFPLDhDQUFjLFVBQVM7QUFBQTtBQUFBO0FBS3BDLFVBQUksQ0FBQyxPQUFPO0FBRVYsYUFBSyx1QkFBdUIsUUFBUSxLQUNsQyxDQUFDLEdBQUcsTUFBTSxFQUFFLEtBQUssZUFBZSxFQUFFLEtBQUs7QUFFekMsYUFBSyxvQkFBb0I7QUFDekIsY0FBTSxLQUFLLFlBQVksS0FBSztBQUM1QjtBQUFBO0FBSUYsWUFBTSxtQkFBbUIsUUFDdEIsT0FBTyxDQUFDLFdBQVcsT0FBTyxRQUFRLFNBQVMsS0FBSyxPQUFPLFFBQVEsR0FDL0QsSUFBSSxDQUFDLFdBQVc7QUFDZixZQUFJLGFBQWEsT0FBTztBQUN4QixjQUFNLFVBQVUsT0FBTyxLQUFLLFNBQ3pCLElBQUksQ0FBQyxRQUFxQixLQUFLLGtCQUFrQixNQUNqRCxLQUFLLE1BQ0w7QUFFSCxZQUFJLFFBQVEsU0FBUyxNQUFNLGdCQUFnQjtBQUN6Qyx3QkFBYztBQUFBO0FBR2hCLGNBQU0sb0JBQW9CLElBQUksT0FBTyxNQUFNLFNBQVMsS0FBSyxLQUN2RDtBQUVGLFlBQUksbUJBQW1CO0FBQ3JCLHdCQUFjO0FBQUE7QUFHaEIsZUFBTztBQUFBLGFBQ0Y7QUFBQSxVQUNILE9BQU87QUFBQTtBQUFBO0FBS2IsdUJBQWlCLEtBQUssQ0FBQyxHQUFHLE1BQU07QUFDOUIsWUFBSSxFQUFFLFVBQVUsRUFBRSxPQUFPO0FBQ3ZCLGlCQUFPLEVBQUUsUUFBUSxFQUFFO0FBQUE7QUFFckIsZUFBTyxFQUFFLEtBQUssZUFBZSxFQUFFLEtBQUs7QUFBQTtBQUd0QyxXQUFLLHVCQUF1QjtBQUM1QixXQUFLLG9CQUFvQjtBQUN6QixZQUFNLEtBQUssWUFBWTtBQUFBO0FBR3pCLFNBQUssWUFBWSxpQkFBaUIsV0FBVyxDQUFDLE1BQU07QUFDbEQsVUFBSSxFQUFFLFFBQVEsT0FBTztBQUNuQixVQUFFO0FBQ0YsWUFBSSxDQUFDLEtBQUsscUJBQXFCO0FBQzdCLGVBQUssc0JBQXNCO0FBQzNCLGVBQUssb0JBQW9CO0FBQ3pCLGVBQUs7QUFBQSxlQUNBO0FBQ0wsY0FBSSxFQUFFLFVBQVU7QUFDZCxpQkFBSyxvQkFBb0IsS0FBSyxJQUFJLEdBQUcsS0FBSyxvQkFBb0I7QUFBQSxpQkFDekQ7QUFDTCxpQkFBSyxvQkFBb0IsS0FBSyxJQUM1QixLQUFLLFVBQVUsU0FBUyxHQUN4QixLQUFLLG9CQUFvQjtBQUFBO0FBRzdCLGVBQUs7QUFBQTtBQUFBLGlCQUdQLEVBQUUsUUFBUSxXQUNWLEtBQUssVUFBVSxTQUFTLEtBQ3hCLEtBQUsscUJBQ0w7QUFDQSxVQUFFO0FBQ0YsY0FBTSxlQUFlLEtBQUssVUFBVSxLQUFLO0FBQ3pDLFlBQUksNkNBQWMsUUFBUSxRQUFRO0FBQ2hDLGVBQUssU0FBUyxhQUFhLFFBQVE7QUFDbkMsZUFBSztBQUFBO0FBQUE7QUFBQTtBQU1YLGNBQVUsaUJBQWlCLFNBQVMsTUFBTTtBQUN4QyxVQUFJLEtBQUsscUJBQXFCO0FBQzVCLGFBQUssc0JBQXNCO0FBQzNCLGFBQUs7QUFBQTtBQUFBO0FBS1QsVUFBTSxrQkFBa0IsVUFBVSxVQUFVO0FBQUEsTUFDMUMsS0FBSztBQUFBO0FBRVAsVUFBTSxnQkFBZ0IsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLE1BQ3ZELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLGtCQUFjLGlCQUFpQixTQUFTLE1BQU0sS0FBSztBQUFBO0FBQUEsUUFHdkMsWUFBWSxlQUFnRDtBQUN4RSxTQUFLLFNBQVM7QUFDZCxTQUFLLFlBQVk7QUFDakIsU0FBSyxvQkFBb0I7QUFDekIsU0FBSyx1QkFBdUI7QUFFNUIsUUFBSSxjQUFjLFdBQVcsR0FBRztBQUM5QixZQUFNLGFBQWEsS0FBSyxTQUFTLFVBQVU7QUFBQSxRQUN6QyxLQUFLO0FBQUE7QUFFUCxpQkFBVyxRQUNULEtBQUssVUFBVSxXQUFXLElBQ3RCLDJCQUNBO0FBRU47QUFBQTtBQUlGLFVBQU0sb0JBQW9CLEtBQUssU0FBUyxVQUFVO0FBQUEsTUFDaEQsS0FBSztBQUFBO0FBSVAsZUFBVyxVQUFVLGVBQWU7QUFDbEMsWUFBTSxLQUFLLGVBQWUsUUFBUTtBQUFBO0FBQUE7QUFBQSxRQUl4QixhQUFhLFNBQWtDO0FBQzNELFFBQUk7QUFDRixZQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sYUFBYTtBQUM5QyxVQUFJLENBQUM7QUFBUSxlQUFPO0FBRXBCLFlBQU0sUUFBUSxPQUFPLEtBQ25CLENBQUMsTUFRQyxFQUFFLE9BQU8sV0FDUixFQUFFLGNBQ0QsR0FBRyxFQUFFLFdBQVcsY0FBYyxFQUFFLFdBQVcsY0FBYztBQUcvRCxVQUFJLCtCQUFPLFlBQVk7QUFDckIsZUFBTyxNQUFNLFdBQVcsZUFBZSxNQUFNLFdBQVc7QUFBQTtBQUcxRCxhQUFPLGdDQUFPLFNBQVE7QUFBQSxhQUNmLE9BQVA7QUFDQSxjQUFRLE1BQU0sNkJBQTZCO0FBQzNDLGFBQU87QUFBQTtBQUFBO0FBQUEsUUFJRyxlQUFlLE1BQXdDO0FBNWZ2RTtBQTZmSSxRQUFJLEtBQUssc0JBQXNCO0FBQzdCLGFBQ0UsWUFBSyxxQkFBcUIsTUFBTSxLQUFLLFVBQXJDLG1CQUE0QyxRQUFRLFNBQVMsUUFDN0Q7QUFBQTtBQUdKLFFBQUksS0FBSyxrQkFBa0I7QUFDekIsVUFBSTtBQUNGLGNBQU0sc0JBQXNCLElBQUksb0JBQW9CLEtBQUs7QUFDekQsY0FBTSxTQUFTLE1BQU0sb0JBQW9CLG9CQUN2QyxLQUFLO0FBRVAsWUFBSSxRQUFRO0FBQ1YsaUJBQU8sT0FBTztBQUFBO0FBQUEsZUFFVCxPQUFQO0FBQ0EsZ0JBQVEsTUFBTSxrQ0FBa0M7QUFBQTtBQUFBO0FBR3BELFdBQU87QUFBQTtBQUFBLEVBR0QsY0FDTixTQUNBLE1BQ0EsVUFBeUIsSUFDekI7QUF2aEJKO0FBd2hCSSxVQUFNLEVBQUUsTUFBTSxpQkFBaUIsS0FBSyxrQkFDbEMsS0FBSyxVQUNMO0FBSUYsVUFBTSxpQkFBaUIsUUFBUSxPQUFPLENBQUMsTUFBTSxFQUFFLFVBQVU7QUFFekQsUUFBSSxlQUFlLFNBQVMsR0FBRztBQUU3QixZQUFNLGNBQWMsWUFBSyxnQkFBTCxtQkFBa0IsVUFBUztBQUMvQyxjQUFRLFlBQ04sS0FBSyxjQUFjLGNBQWMsTUFBTSxnQkFBZ0I7QUFBQSxXQUVwRDtBQUNMLGNBQVEsV0FBVyxFQUFFO0FBQUE7QUFBQTtBQUFBLFFBSVgsZUFDWixFQUFFLE1BQU0sVUFBVSxNQUNsQixXQUNBO0FBOWlCSjtBQStpQkksVUFBTSxhQUNKLEtBQUssdUJBQ0wsS0FBSyxVQUFVLFdBQVcsS0FBSztBQUVqQyxVQUFNLE9BQU8sVUFBVSxVQUFVO0FBQUEsTUFDL0IsS0FBSywwQkFDSCxLQUFLLE9BQU8sS0FBSyxpQkFBaUIsYUFBYSxNQUM3QyxhQUFhLG1DQUFtQztBQUFBO0FBR3RELFNBQUssUUFBUSxTQUFTLEtBQUs7QUFDM0IsU0FBSyxVQUFVLEtBQUs7QUFFcEIsVUFBTSxTQUFTLEtBQUssVUFBVSxFQUFFLEtBQUs7QUFFckMsVUFBTSxnQkFBZ0IsT0FBTyxVQUFVO0FBQUEsTUFDckMsS0FBSztBQUFBO0FBSVAsVUFBTSxhQUFhLGNBQWMsVUFBVTtBQUFBLE1BQ3pDLEtBQUs7QUFBQTtBQUVQLG1DQUFRLFlBQVk7QUFDcEIsVUFBTSxZQUFZLE1BQU0sS0FBSyxhQUFhLEtBQUs7QUFDL0MsVUFBTSxlQUFlLFFBQVEsT0FBTyxDQUFDLE1BQU0sRUFBRSxVQUFVO0FBQ3ZELFFBQUksYUFBYSxTQUFTLEdBQUc7QUFDM0IsaUJBQVcsWUFBWSxLQUFLLGNBQWMsV0FBVztBQUFBLFdBQ2hEO0FBQ0wsaUJBQVcsV0FBVztBQUFBO0FBSXhCLFVBQU0sY0FBYyxjQUFjLFVBQVU7QUFBQSxNQUMxQyxLQUFLO0FBQUE7QUFFUCxtQ0FBUSxhQUFhO0FBQ3JCLFVBQU0sY0FBYyxNQUFNLEtBQUssZUFBZTtBQUM5QyxVQUFNLGdCQUFnQixRQUFRLE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVTtBQUN4RCxRQUFJLGNBQWMsU0FBUyxHQUFHO0FBQzVCLGtCQUFZLFlBQVksS0FBSyxjQUFjLGFBQWE7QUFBQSxXQUNuRDtBQUNMLGtCQUFZLFdBQVc7QUFBQTtBQUl6QixRQUFJLEtBQUssaUJBQWlCLEtBQUssY0FBYyxTQUFTLEdBQUc7QUFDdkQsWUFBTSxXQUFXLGNBQWMsVUFBVTtBQUFBLFFBQ3ZDLEtBQUs7QUFBQTtBQUVQLHFDQUFRLFVBQVU7QUFDbEIsZUFBUyxXQUNQLEdBQUcsS0FBSyxjQUFjLGtCQUNwQixLQUFLLGNBQWMsU0FBUyxJQUFJLE1BQU07QUFBQTtBQUs1QyxVQUFNLFVBQVUsS0FBSyxVQUFVO0FBQUEsTUFDN0IsS0FBSztBQUFBO0FBR1AsUUFBSSxZQUFLLGdCQUFMLG1CQUFrQixVQUFTLFFBQVEsU0FBUyxHQUFHO0FBQ2pELFlBQU0sRUFBRSxTQUFTLEtBQUssa0JBQWtCLEtBQUssVUFBVTtBQUd2RCxZQUFNLGNBQWMsS0FBSyxZQUFZLE1BQU0sY0FBYyxNQUFNO0FBQy9ELFlBQU0sWUFBWSxLQUFLO0FBR3ZCLFlBQU0sZ0JBQXdEO0FBQzlELGtCQUFZLFFBQVEsQ0FBQyxTQUFTO0FBQzVCLFlBQUksUUFBUSxVQUFVLFFBQVE7QUFDOUIsWUFBSSxTQUFTLEdBQUc7QUFDZCx3QkFBYyxLQUFLLEVBQUUsTUFBTTtBQUFBO0FBQUE7QUFLL0Isb0JBQWMsS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRTtBQUV6QyxVQUFJLGNBQWMsU0FBUyxHQUFHO0FBQzVCLGNBQU0sV0FBVyxTQUFTO0FBQzFCLFlBQUksWUFBWTtBQUdoQixzQkFBYyxRQUFRLENBQUMsRUFBRSxNQUFNLFlBQVk7QUFFekMsY0FBSSxRQUFRLFdBQVc7QUFDckIscUJBQVMsWUFDUCxTQUFTLGVBQWUsS0FBSyxNQUFNLFdBQVc7QUFBQTtBQUtsRCxnQkFBTSxZQUFZLFNBQVMsY0FBYztBQUN6QyxvQkFBVSxZQUFZO0FBQ3RCLG9CQUFVLGNBQWMsS0FBSyxNQUFNLE9BQU8sUUFBUSxLQUFLO0FBQ3ZELG1CQUFTLFlBQVk7QUFFckIsc0JBQVksUUFBUSxLQUFLO0FBQUE7QUFJM0IsWUFBSSxZQUFZLEtBQUssUUFBUTtBQUMzQixtQkFBUyxZQUFZLFNBQVMsZUFBZSxLQUFLLE1BQU07QUFBQTtBQUcxRCxnQkFBUSxZQUFZO0FBQUEsYUFDZjtBQUNMLGdCQUFRLFdBQVc7QUFBQTtBQUFBLFdBRWhCO0FBRUwsWUFBTSxjQUFjLEtBQUssU0FBUyxLQUFLLFNBQVMsU0FBUztBQUN6RCxVQUFJLGFBQWE7QUFDZixnQkFBUSxXQUFXLEtBQUssa0JBQWtCO0FBQUE7QUFBQTtBQUk5QyxVQUFNLE9BQU8sS0FBSyxVQUFVLEVBQUUsS0FBSztBQUVuQyxVQUFNLFNBQVMsS0FBSyxVQUFVO0FBQUEsTUFDNUIsS0FBSztBQUFBO0FBRVAsbUNBQVEsUUFBUTtBQUNoQixXQUFPLFdBQVc7QUFBQSxNQUNoQixNQUFNLEtBQUssV0FBVyxLQUFLO0FBQUE7QUFHN0IsVUFBTSxhQUFhLEtBQUssVUFBVTtBQUFBLE1BQ2hDLEtBQUs7QUFBQTtBQUVQLG1DQUFRLFlBQVk7QUFDcEIsZUFBVyxXQUFXO0FBQUEsTUFDcEIsTUFBTSxHQUFHLEtBQUssU0FBUyxpQkFDckIsS0FBSyxTQUFTLFdBQVcsSUFBSSxNQUFNO0FBQUE7QUFLdkMsVUFBTSxVQUFVLEtBQUssVUFBVTtBQUFBLE1BQzdCLEtBQUs7QUFBQTtBQUVQLG1DQUFRLFNBQVM7QUFDakIsWUFBUSxXQUFXO0FBQUEsTUFDakIsTUFBTSxLQUFLO0FBQUE7QUFHYixTQUFLLGlCQUFpQixTQUFTLE1BQU07QUFDbkMsV0FBSyxTQUFTLEtBQUs7QUFDbkIsV0FBSztBQUFBO0FBQUE7QUFBQSxFQUlELGNBQ04sTUFDQSxVQUF5QixJQUNQO0FBQ2xCLFFBQUksQ0FBQyxXQUFXLFFBQVEsV0FBVyxHQUFHO0FBQ3BDLFlBQU0sWUFBVztBQUNqQixnQkFBUyxXQUFXO0FBQ3BCLGFBQU87QUFBQTtBQUdULFVBQU0sV0FBVztBQUVqQixVQUFNLGFBQWEsSUFBSTtBQUN2QixZQUFRLFFBQVEsQ0FBQyxVQUFVO0FBQ3pCLFlBQU0sUUFBUSxRQUFRLENBQUMsUUFBUSxXQUFXLElBQUk7QUFBQTtBQUdoRCxVQUFNLGdCQUFnQixNQUFNLEtBQUssWUFBWSxLQUFLLENBQUMsR0FBRyxNQUFNLElBQUk7QUFFaEUsVUFBTSxTQUFrQztBQUN4QyxRQUFJLGFBQWEsY0FBYztBQUMvQixRQUFJLE9BQU8sY0FBYztBQUV6QixhQUFTLElBQUksR0FBRyxLQUFLLGNBQWMsUUFBUSxLQUFLO0FBQzlDLFlBQU0sT0FBTyxjQUFjO0FBQzNCLFVBQUksU0FBUyxPQUFPLEdBQUc7QUFDckIsZUFBTyxLQUFLLENBQUMsWUFBWSxPQUFPO0FBQ2hDLHFCQUFhO0FBQUE7QUFFZixhQUFPO0FBQUE7QUFHVCxRQUFJLFlBQVk7QUFDaEIsV0FBTyxRQUFRLENBQUMsQ0FBQyxPQUFPLFNBQVM7QUFDL0IsVUFBSSxRQUFRLFdBQVc7QUFDckIsaUJBQVMsV0FBVyxLQUFLLE1BQU0sV0FBVztBQUFBO0FBRzVDLFlBQU0sa0JBQWtCLEtBQUssTUFBTSxPQUFPO0FBQzFDLFlBQU0sT0FBTyxTQUFTLFdBQVc7QUFBQSxRQUMvQixLQUFLO0FBQUEsUUFDTCxNQUFNO0FBQUE7QUFHUixrQkFBWTtBQUFBO0FBR2QsUUFBSSxZQUFZLEtBQUssUUFBUTtBQUMzQixlQUFTLFdBQVcsS0FBSyxNQUFNO0FBQUE7QUFHakMsV0FBTztBQUFBO0FBQUEsRUFHRCxxQkFBcUI7QUFDM0IsU0FBSyxVQUFVLFFBQVEsQ0FBQyxNQUFNLFVBQVU7QUFDdEMsVUFBSSxVQUFVLEtBQUsscUJBQXFCLEtBQUsscUJBQXFCO0FBQ2hFLGFBQUssVUFBVSxJQUFJO0FBQ25CLGFBQUssZUFBZSxFQUFFLFVBQVUsVUFBVSxPQUFPO0FBQUEsYUFDNUM7QUFDTCxhQUFLLFVBQVUsT0FBTztBQUFBO0FBQUE7QUFBQTtBQUFBLEVBSzVCLFVBQVU7QUFDUixVQUFNLEVBQUUsY0FBYztBQUN0QixjQUFVO0FBQUE7QUFBQTs7O0FUNXZCUCxJQUFNLGlCQUFpQjtBQUV2Qiw2QkFBdUIsMkJBQVM7QUFBQSxFQThCckMsWUFBWSxNQUFxQixRQUE0QjtBQUMzRCxVQUFNO0FBOUJBLG9CQUEwQjtBQVMxQiw0QkFBMkI7QUFDM0Isd0JBQWU7QUFFZiwyQkFBeUM7QUFDekMsMkJBQWtCO0FBR2xCLGdDQUF1QjtBQVV2QixxQkFBb0I7QUFLMUIsU0FBSyxTQUFTO0FBQ2QsU0FBSyxZQUFZLG9CQUFvQixZQUFZLE9BQU8sVUFBVSxLQUFLO0FBQ3ZFLFNBQUssY0FBYyxJQUFJLG1CQUNyQixLQUFLLEtBQ0wsT0FBTyxTQUFTO0FBRWxCLFNBQUssa0JBQWtCLE9BQU8sU0FBUztBQUN2QyxTQUFLLFdBQVc7QUFDaEIsU0FBSyxrQkFBa0I7QUFDdkIsU0FBSyxlQUFlO0FBQ3BCLFNBQUssdUJBQXVCO0FBQzVCLFNBQUssa0JBQWtCLElBQUksZ0JBQWdCLEtBQUs7QUFHaEQsU0FBSyxtQkFDSCxLQUFLLE9BQU8sU0FBUyxvQkFBb0I7QUFDM0MsUUFDRSxLQUFLLHFCQUFxQixZQUMxQixLQUFLLE9BQU8sU0FBUyxrQkFDckI7QUFDQSxXQUFLLG1CQUFtQixLQUFLLE9BQU8sU0FBUztBQUFBLFdBQ3hDO0FBQ0wsV0FBSyxtQkFBbUI7QUFBQTtBQUcxQixTQUFLLHNCQUFzQixLQUFLLGVBQWUsS0FBSztBQUFBO0FBQUEsRUFHdEQsY0FBc0I7QUFDcEIsV0FBTztBQUFBO0FBQUEsRUFHVCxpQkFBeUI7QUFDdkIsVUFBTSxXQUFXLEtBQUssSUFBSSxVQUFVLGdCQUFnQjtBQUdwRCxRQUFJLFNBQVMsVUFBVSxHQUFHO0FBQ3hCLGFBQU8sS0FBSztBQUFBO0FBSWQsVUFBTSxhQUFhLFNBQVMsUUFBUSxLQUFLLFFBQVE7QUFDakQsV0FBTyxHQUFHLEtBQUssYUFBYTtBQUFBO0FBQUEsUUFHeEIsU0FBd0I7QUFDNUIsVUFBTSxZQUFZLEtBQUssWUFBWSxTQUFTO0FBQzVDLGNBQVU7QUFDVixjQUFVLFNBQVM7QUFHbkIsU0FBSyxpQkFBaUI7QUFFdEIsVUFBTSxrQkFBa0IsVUFBVSxTQUFTLE9BQU87QUFBQSxNQUNoRCxLQUFLO0FBQUE7QUFHUCxVQUFNLFNBQVMsZ0JBQWdCLFNBQVMsT0FBTztBQUFBLE1BQzdDLEtBQUs7QUFBQTtBQUdQLFNBQUssaUJBQWlCLE9BQU8sU0FBUyxVQUFVO0FBQUEsTUFDOUMsS0FBSztBQUFBLE1BQ0wsTUFBTSxrQkFBa0IsS0FBSztBQUFBO0FBRy9CLFNBQUs7QUFFTCxTQUFLLGdCQUFnQixJQUFJLGdCQUFnQjtBQUFBLE1BQ3ZDLFdBQVc7QUFBQSxNQUNYLE9BQU87QUFBQTtBQUVULFVBQU0saUJBQWlCLEtBQUssY0FBYztBQUUxQyxVQUFNLG9CQUFvQixlQUFlLFNBQVMsT0FBTztBQUFBLE1BQ3ZELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLHNCQUFrQixpQkFBaUIsU0FBUyxNQUFNO0FBQ2hELFlBQU0sV0FBVyxHQUFHLEtBQUssT0FBTyxTQUFTLGtCQUFrQixLQUFLO0FBQ2hFLFlBQU0sT0FBTyxLQUFLLElBQUksTUFBTSxzQkFBc0I7QUFDbEQsVUFBSSxnQkFBZ0IseUJBQU87QUFDekIsYUFBSyxJQUFJLFVBQVUsVUFBVSxTQUFTO0FBQUE7QUFBQTtBQUkxQyxVQUFNLDBCQUEwQixlQUFlLFNBQVMsT0FBTztBQUFBLE1BQzdELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLDRCQUF3QixpQkFBaUIsU0FBUyxNQUFNO0FBRXRELFlBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxRQUFRO0FBRXhDLFVBQUksY0FDRixLQUFLLEtBQ0wsT0FBTyxXQUFtQjtBQUN4QixjQUFNLE9BQU8sTUFBTSxLQUFLLGFBQWE7QUFBQSxVQUNuQyxNQUFNO0FBQUEsVUFDTixPQUFPLEVBQUU7QUFBQTtBQUdYLGFBQUssSUFBSSxVQUFVLGNBQWM7QUFBQSxTQUVuQyxLQUFLLFFBQ0w7QUFBQTtBQUdKLFVBQU0saUJBQWlCLGVBQWUsU0FBUyxPQUFPO0FBQUEsTUFDcEQsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBRVIsbUJBQWUsaUJBQWlCLFNBQVMsWUFBWTtBQUNuRCxZQUFNLEtBQUs7QUFBQTtBQUdiLFVBQU0sbUJBQW1CLGVBQWUsU0FBUyxPQUFPO0FBQUEsTUFDdEQsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBRVIscUJBQWlCLGlCQUFpQixTQUFTLFlBQVk7QUFDckQsWUFBTSxrQkFBa0IsTUFBTSxVQUM1QixLQUFLLEtBQ0wsOENBQ0E7QUFBQSxRQUNFLGVBQWU7QUFBQSxRQUNmLGlCQUFpQjtBQUFBO0FBSXJCLFVBQUksbURBQWlCLFdBQVc7QUFDOUIsY0FBTSxXQUFXLEdBQUcsS0FBSyxPQUFPLFNBQVMsa0JBQWtCLEtBQUs7QUFDaEUsY0FBTSxPQUFPLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUNsRCxZQUFJLGdCQUFnQix5QkFBTztBQUN6QixnQkFBTSxLQUFLLElBQUksTUFBTSxPQUFPO0FBQUE7QUFFOUIsYUFBSyxLQUFLO0FBQUE7QUFBQTtBQUlkLFVBQU0sWUFBWSxnQkFBZ0IsU0FBUyxPQUFPO0FBQUEsTUFDaEQsS0FBSztBQUFBO0FBR1AsU0FBSyxpQkFBaUIsSUFBSSxtQkFBbUI7QUFBQSxNQUMzQyxLQUFLLEtBQUs7QUFBQSxNQUNWLFdBQVc7QUFBQSxNQUNYLGlCQUFpQixZQUFZO0FBQzNCLGNBQU0sS0FBSztBQUNYLGNBQU0sS0FBSyxlQUFlO0FBQUE7QUFBQSxNQUU1QixlQUFlLEtBQUs7QUFBQSxNQUNwQixRQUFRLEtBQUs7QUFBQTtBQUdmLFNBQUssZ0JBQWdCLFVBQVUsU0FBUyxPQUFPO0FBQUEsTUFDN0MsS0FBSztBQUFBO0FBR1AsU0FBSyxnQkFBZ0IsSUFBSSxxQkFBcUI7QUFBQSxNQUM1QyxXQUFXLEtBQUs7QUFBQTtBQUdsQixTQUFLLGVBQWUsSUFBSSxhQUFhO0FBQUEsTUFDbkMsS0FBSyxLQUFLO0FBQUEsTUFDVjtBQUFBLE1BQ0EsV0FBVyxLQUFLO0FBQUEsTUFDaEIsYUFBYSxNQUFNLENBQUMsR0FBRyxLQUFLO0FBQUEsTUFDNUIsb0JBQW9CLE1BQU0sS0FBSztBQUFBLE1BQy9CLGlCQUFpQixNQUFNLEtBQUssZUFBZTtBQUFBLE1BQzNDLGlCQUFpQixNQUFPO0FBQUEsUUFDdEIsTUFBTSxLQUFLO0FBQUEsUUFDWCxNQUFNLEtBQUs7QUFBQTtBQUFBLE1BRWIsZUFBZSxLQUFLO0FBQUEsTUFDcEIsZUFBZSxLQUFLO0FBQUEsTUFDcEIsaUJBQWlCLEtBQUs7QUFBQSxNQUN0QixpQkFBaUIsT0FBTyxZQUFZO0FBQ2xDLGFBQUssU0FBUyxLQUFLO0FBQ25CLGNBQU0sS0FBSztBQUNYLGNBQU0sS0FBSyxXQUNULFFBQVEsTUFDUixRQUFRLFNBQ1IsUUFBUTtBQUFBO0FBQUEsTUFHWixxQkFBcUIsT0FBTyxZQUFZO0FBQ3RDLGFBQUssU0FBUyxLQUFLO0FBQ25CLGNBQU0sS0FBSztBQUFBO0FBQUEsTUFFYixrQkFBa0IsT0FBTyxhQUFhO0FBQ3BDLGNBQU0sUUFBUSxLQUFLLGVBQWU7QUFDbEMsY0FBTSxJQUFJO0FBQ1YsYUFBSyxlQUFlLGdCQUFnQixNQUFNLEtBQUs7QUFDL0MsY0FBTSxLQUFLO0FBQUE7QUFBQSxNQUViLFNBQVMsQ0FBQyxVQUFVLEtBQUssWUFBWTtBQUFBLE1BQ3JDLGtCQUFrQixNQUFNO0FBQ3RCLGNBQU0sZ0JBQWdCLEtBQUssZUFDeEIsZUFDQSxjQUFjO0FBQ2pCLFlBQUkseUJBQXlCLGFBQWE7QUFDeEMsd0JBQWM7QUFBQTtBQUFBO0FBQUEsTUFHbEIsb0JBQW9CLE1BQU07QUFDeEIsYUFBSztBQUFBO0FBQUEsTUFFUCxRQUFRLEtBQUs7QUFBQSxNQUNiLFVBQVU7QUFBQTtBQUdaLFNBQUssSUFBSSxVQUFVLEdBQUcsc0JBQXNCLENBQUMsU0FBUztBQUNwRCxVQUFJLFNBQVMsS0FBSyxNQUFNO0FBQ3RCLGFBQUs7QUFFTCxhQUFLLGFBQWE7QUFBQTtBQUFBO0FBS3RCLFNBQUssYUFBYTtBQUVsQixVQUFNLEtBQUs7QUFFWCxRQUFJLENBQUMsS0FBSyx3QkFBd0IsS0FBSyxTQUFTLFdBQVcsR0FBRztBQUM1RCxVQUFJLENBQUMsS0FBSyxRQUFRO0FBQ2hCLGNBQU0sTUFBTSxJQUFJO0FBQ2hCLGNBQU0sT0FBTyxJQUFJO0FBQ2pCLGNBQU0sUUFBUSxPQUFPLElBQUksYUFBYSxHQUFHLFNBQVMsR0FBRztBQUNyRCxjQUFNLE1BQU0sT0FBTyxJQUFJLFdBQVcsU0FBUyxHQUFHO0FBQzlDLGNBQU0sT0FBTyxPQUFPLElBQUksWUFBWSxTQUFTLEdBQUc7QUFDaEQsY0FBTSxTQUFTLE9BQU8sSUFBSSxjQUFjLFNBQVMsR0FBRztBQUNwRCxjQUFNLFNBQVMsT0FBTyxJQUFJLGNBQWMsU0FBUyxHQUFHO0FBQ3BELGFBQUssU0FBUyxHQUFHLFFBQVEsU0FBUyxPQUFPLFFBQVEsVUFBVTtBQUMzRCxhQUFLLFlBQVksUUFBUSxJQUFJO0FBQzdCLGNBQU0sS0FBSztBQUFBO0FBQUE7QUFBQTtBQUFBLFFBS0gsZUFBOEI7QUFDMUMsUUFBSSxDQUFDLEtBQUs7QUFBZTtBQUV6QixVQUFNLFlBQVksS0FBSyxjQUFjO0FBQ3JDLFVBQU0sZUFBZSxLQUFLLGNBQWM7QUFDeEMsVUFBTSxlQUFlLEtBQUssY0FBYztBQUN4QyxVQUFNLGNBQWMsS0FBSyxJQUFJLGVBQWUsWUFBWSxnQkFBZ0I7QUFFeEUsU0FBSyxjQUFjO0FBQ25CLGVBQVcsV0FBVyxLQUFLLFVBQVU7QUFDbkMsWUFBTSxLQUFLLFdBQVcsUUFBUSxNQUFNLFFBQVEsU0FBUyxRQUFRO0FBQUE7QUFHL0QsUUFBSSxhQUFhO0FBQ2YsV0FBSyxjQUFjO0FBQUEsV0FDZDtBQUNMLFdBQUssY0FBYyxZQUFZO0FBQUE7QUFJakMsUUFBSSxLQUFLLGNBQWM7QUFDckIsWUFBTSxLQUFLLGFBQWE7QUFBQTtBQUFBO0FBQUEsUUFJZCx1QkFBc0M7QUE3VHREO0FBOFRJLFFBQUksS0FBSyxnQkFBZ0I7QUFDdkIsVUFBSTtBQUVGLGNBQU0sU0FBUyxNQUFNLEtBQUssT0FBTyxhQUFhO0FBQzlDLGNBQU0sZUFBZSxPQUFPLEtBQzFCLENBQUMsVUFBVSxNQUFNLE9BQU8sS0FBSztBQUkvQixhQUFLLG1CQUFtQiw4Q0FBYyxTQUFRLEtBQUs7QUFHbkQsYUFBSyxlQUFlO0FBQ3BCLGNBQU0sU0FBUyxLQUFLLGVBQWUsV0FBVztBQUFBLFVBQzVDLE1BQU07QUFBQTtBQUVSLGNBQU0sWUFBWSxLQUFLLGVBQWUsV0FBVztBQUFBLFVBQy9DLE1BQU0sS0FBSyxvQkFBb0I7QUFBQTtBQUlqQyxjQUFNLG9CQUFvQixLQUFLLGVBQWUsVUFDNUM7QUFFRixtQkFBSyxlQUFlLGVBQXBCLG1CQUFnQyxhQUM5QixtQkFDQSxLQUFLO0FBRVAsYUFBSyxpQkFBaUI7QUFHdEIsYUFBSyxlQUFlLGlCQUFpQixTQUFTLFlBQVk7QUFDeEQsZ0JBQU0sUUFBUSxJQUFJLG9CQUNoQixLQUFLLEtBQ0wsS0FBSyxpQkFDTCxPQUFPLFlBQVk7QUFDakIsaUJBQUssa0JBQWtCO0FBR3ZCLGtCQUFNLGdCQUFnQixPQUFPLEtBQzNCLENBQUMsVUFBVSxNQUFNLE9BQU87QUFFMUIsaUJBQUssbUJBQW1CLGdEQUFlLFNBQVE7QUFHL0Msa0JBQU0sS0FBSztBQUNYLCtCQUFtQiw4QkFBOEI7QUFDakQsa0JBQU0sS0FBSztBQUdYLGdCQUFJLEtBQUssd0JBQXdCLGdEQUFlLGlCQUFnQjtBQUM5RCxtQkFBSyxhQUFhLEtBQUssTUFDcEIsS0FBSyx1QkFBdUIsTUFDM0IsY0FBYztBQUVsQixvQkFBTSxLQUFLO0FBQUE7QUFJYixpQkFBSztBQUFBLGFBRVAsS0FBSztBQUdQLGdCQUFNO0FBQ04sY0FBSTtBQUNGLGtCQUFNLFVBQVU7QUFBQSxtQkFDVCxLQUFQO0FBQ0Esb0JBQVEsTUFBTSx5QkFBeUI7QUFDdkMsK0JBQW1CLG9DQUFvQztBQUFBO0FBQUE7QUFBQSxlQUdwRCxPQUFQO0FBQ0EsZ0JBQVEsTUFBTSxtQ0FBbUM7QUFFakQsYUFBSyxtQkFBbUIsS0FBSztBQUM3QixhQUFLLGVBQWU7QUFDcEIsYUFBSyxlQUFlLFdBQVcsRUFBRSxNQUFNO0FBQ3ZDLGFBQUssZUFBZSxXQUFXLEVBQUUsTUFBTSxLQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFLcEMsa0JBQWtCO0FBQzlCLFFBQUksS0FBSztBQUFjO0FBRXZCLFFBQUk7QUFDRixZQUFNLGFBQWEsTUFBTSxLQUFLLFlBQVk7QUFDMUMsWUFBTSxjQUFjLFdBQVcsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLEtBQUs7QUFFekQsVUFBSSxDQUFDO0FBQWE7QUFFbEIsWUFBTSxhQUNKLFlBQVksU0FBUyxXQUFXLEtBQUssU0FBUyxVQUM5QyxZQUFZLG9CQUFvQixLQUFLLG1CQUNyQyxLQUFLLFVBQVUsTUFBTSxLQUFLLEtBQUssZUFBZSx3QkFDNUMsS0FBSyxVQUFVLFlBQVksa0JBQzdCLEtBQUssVUFBVSxZQUFZLGNBQWMsS0FBSyxVQUFVLEtBQUs7QUFFL0QsVUFBSSxZQUFZO0FBQ2QsYUFBSyxXQUFXLFlBQVk7QUFDNUIsYUFBSyxrQkFBa0IsWUFBWTtBQUVuQyxZQUFJLFlBQVksZUFBZTtBQUM3QixnQkFBTSxLQUFLLGVBQWUsZ0JBQWdCLFlBQVk7QUFBQTtBQUd4RCxjQUFNLEtBQUs7QUFDWCxhQUFLO0FBQUEsYUFDQTtBQUVMLGNBQU0sS0FBSyxlQUFlO0FBQUE7QUFBQSxhQUVyQixPQUFQO0FBQ0EsY0FBUSxNQUFNLGdDQUFnQztBQUFBO0FBQUE7QUFBQSxRQUlwQyxXQUEwQjtBQUN0QyxRQUFJLENBQUMsS0FBSyxRQUFRO0FBQ2hCLFlBQU0sTUFBTSxJQUFJO0FBQ2hCLFlBQU0sT0FBTyxJQUFJO0FBQ2pCLFlBQU0sUUFBUSxPQUFPLElBQUksYUFBYSxHQUFHLFNBQVMsR0FBRztBQUNyRCxZQUFNLE1BQU0sT0FBTyxJQUFJLFdBQVcsU0FBUyxHQUFHO0FBQzlDLFlBQU0sT0FBTyxPQUFPLElBQUksWUFBWSxTQUFTLEdBQUc7QUFDaEQsWUFBTSxTQUFTLE9BQU8sSUFBSSxjQUFjLFNBQVMsR0FBRztBQUNwRCxZQUFNLFNBQVMsT0FBTyxJQUFJLGNBQWMsU0FBUyxHQUFHO0FBQ3BELFdBQUssU0FBUyxHQUFHLFFBQVEsU0FBUyxPQUFPLFFBQVEsVUFBVTtBQUMzRCxXQUFLLFlBQVksS0FBSyxhQUFhLEtBQUs7QUFBQTtBQUcxQyxRQUFJO0FBQ0YsWUFBTSxLQUFLLFlBQVksU0FDckIsS0FBSyxRQUNMLEtBQUssVUFDTCxLQUFLLGlCQUNMLEtBQUssZUFBZSxtQkFDcEIsUUFDQSxLQUFLLGtCQUNMLEtBQUssa0JBQ0wsS0FBSyxXQUNMLEtBQUssWUFDTCxLQUFLO0FBQUEsYUFFQSxPQUFQO0FBQ0EsV0FBSyxZQUFZO0FBQUE7QUFBQTtBQUFBLFFBSVAsWUFBWSxPQUFrRDtBQUUxRSxZQUFRLE1BQU0sZUFBZTtBQUFBLE1BQzNCO0FBQUEsTUFDQSxTQUFTLE9BQU8sVUFBVSxXQUFXLFFBQVEsTUFBTTtBQUFBLE1BQ25ELE1BQU0saUJBQWlCLG9CQUFvQixNQUFNLE9BQU87QUFBQSxNQUN4RCxVQUFVLGlCQUFpQixvQkFBb0IsTUFBTSxXQUFXO0FBQUE7QUFHbEUsUUFBSSxlQUFlLE9BQU8sVUFBVSxXQUFXLFFBQVEsTUFBTTtBQUU3RCxRQUNFLGlCQUFpQixxQkFDaEIsT0FBTSxTQUFTLHVCQUNkLE1BQU0sU0FBUyx5QkFDZixNQUFNLFNBQVMsbUJBQ2pCO0FBQ0EseUJBQW1CLGNBQWMsU0FBUztBQUUxQyxZQUFNLFFBQVEsSUFBSSxvQkFDaEIsS0FBSyxLQUNMLEtBQUssaUJBQ0wsT0FBTyxZQUFvQjtBQUN6QixhQUFLLGtCQUFrQjtBQUN2QixhQUFLO0FBQ0wsMkJBQ0Usa0RBQ0E7QUFJRixhQUFLO0FBQUEsU0FFUCxLQUFLO0FBR1AsWUFBTTtBQUNOLFVBQUk7QUFDRixjQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sYUFBYTtBQUM5QyxjQUFNLFVBQVU7QUFBQSxlQUNULEtBQVA7QUFDQSxnQkFBUSxNQUFNLDJCQUEyQjtBQUN6QywyQkFBbUIsb0NBQW9DLFNBQVM7QUFBQTtBQUdsRSxZQUFNLGNBQWMsS0FBSyxjQUFjLGNBQ3JDO0FBRUYsVUFBSSxhQUFhO0FBQ2Ysb0JBQVk7QUFBQTtBQUdkLFlBQU0sa0JBQWtCLENBQUMsR0FBRyxLQUFLLFVBQzlCLFVBQ0EsS0FBSyxDQUFDLFFBQVEsSUFBSSxTQUFTO0FBQzlCLFVBQUksaUJBQWlCO0FBQ25CLGNBQU0sUUFBUSxLQUFLLFNBQVMsVUFDMUIsQ0FBQyxRQUFRLElBQUksZUFBZSxnQkFBZ0I7QUFFOUMsWUFBSSxVQUFVLElBQUk7QUFDaEIsZUFBSyxTQUFTLE9BQU87QUFFckIsZ0JBQU0sY0FBYyxLQUFLLGNBQWMsaUJBQ3JDO0FBRUYsbUJBQVMsSUFBSSxPQUFPLElBQUksWUFBWSxRQUFRLEtBQUs7QUFDL0Msd0JBQVksR0FBRztBQUFBO0FBR2pCLGVBQUssYUFBYSxTQUNoQixPQUFPLGdCQUFnQixZQUFZLFdBQy9CLGdCQUFnQixVQUNoQixLQUFLLFVBQVUsZ0JBQWdCO0FBRXJDLGVBQUssYUFBYTtBQUFBO0FBQUE7QUFBQSxXQUdqQjtBQUNMLHlCQUFtQixjQUFjLFNBQVM7QUFBQTtBQUFBO0FBQUEsUUFJaEMsaUJBQWlCO0FBcmlCakM7QUFzaUJJLFFBQUksWUFBSyxJQUFJLFVBQVUsb0JBQW9CLGdDQUF2QyxtQkFBa0QsVUFBUyxLQUFLLE1BQU07QUFDeEUsV0FBSyxrQkFBa0I7QUFDdkIsWUFBTSxLQUFLO0FBRVgsV0FBSyxhQUFhO0FBQUE7QUFBQTtBQUFBLEVBSWQsb0JBQTRCO0FBQ2xDLFdBQU8sdUNBQXVDLFFBQVEsU0FBUyxDQUFDLE1BQU07QUFDcEUsWUFBTSxJQUFLLEtBQUssV0FBVyxLQUFNO0FBQ2pDLFlBQU0sSUFBSSxNQUFNLE1BQU0sSUFBSyxJQUFJLElBQU87QUFDdEMsYUFBTyxFQUFFLFNBQVM7QUFBQTtBQUFBO0FBQUEsUUFJUix5QkFBd0M7QUFHcEQsUUFBSSxpQkFBaUI7QUFDckIsUUFBSSxLQUFLLHFCQUFxQixVQUFVO0FBRXRDLFlBQU0sT0FBTyxLQUFLLElBQUksTUFBTSxzQkFDekIsTUFBSyxvQkFBb0IsTUFBTTtBQUVsQyxVQUFJLGdCQUFnQix5QkFBTztBQUN6Qix5QkFBaUIsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLO0FBQUEsYUFDdEM7QUFFTCx5QkFBaUIsS0FBSyxPQUFPLFNBQVM7QUFBQTtBQUFBLFdBRW5DO0FBRUwsWUFBTSxzQkFBc0IsSUFBSSxvQkFBb0IsS0FBSztBQUN6RCxVQUFJO0FBQ0YsY0FBTSxTQUFTLE1BQU0sb0JBQW9CLG9CQUN2QyxLQUFLO0FBRVAsWUFBSSxRQUFRO0FBQ1YsMkJBQWlCLE9BQU87QUFBQSxlQUNuQjtBQUNMLDJCQUFpQixLQUFLLE9BQU8sU0FBUztBQUFBO0FBQUEsZUFFakMsT0FBUDtBQUNBLGdCQUFRLE1BQU0sa0NBQWtDO0FBQ2hELHlCQUFpQixLQUFLLE9BQU8sU0FBUztBQUFBO0FBQUE7QUFLMUMsUUFBSTtBQUNKLFFBQUk7QUFDRixZQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sYUFBYTtBQUM5QyxZQUFNLGVBQWUsT0FBTyxLQUMxQixDQUFDLFVBQVUsTUFBTSxPQUFPLEtBQUs7QUFFL0IsVUFBSSxjQUFjO0FBQ2hCLDZCQUFxQixhQUFhO0FBQUE7QUFBQSxhQUU3QixPQUFQO0FBQ0EsY0FBUSxNQUFNLHVDQUF1QztBQUFBO0FBR3ZELFVBQU0sU0FBUyxNQUFNLHNCQUFzQixLQUFLLEtBQUssZ0JBQWdCO0FBQUEsTUFDbkUsTUFBTTtBQUFBLE1BQ04sc0JBQ0UsS0FBSyxvQkFBb0IsS0FBSyxPQUFPLFNBQVM7QUFBQSxNQUNoRCx3QkFBd0IsS0FBSyxPQUFPLFNBQVM7QUFBQSxNQUM3QztBQUFBLE1BQ0Esc0JBQXNCLEtBQUs7QUFBQTtBQUc3QixRQUFJLFFBQVE7QUFFVixXQUFLLG1CQUFtQixPQUFPO0FBQy9CLFVBQUksT0FBTyxTQUFTLFlBQVksT0FBTyxNQUFNO0FBQzNDLGFBQUssbUJBQW1CLE9BQU87QUFBQSxhQUMxQjtBQUNMLGFBQUssbUJBQW1CO0FBQUE7QUFJMUIsV0FBSyx1QkFBdUIsT0FBTztBQUNuQyxXQUFLLGFBQWEsT0FBTztBQUd6QixZQUFNLEtBQUssYUFBYTtBQUV4QixZQUFNLEtBQUs7QUFBQTtBQUFBO0FBQUEsUUFJRCxXQUNaLE1BQ0EsU0FDQSxtQkFDZTtBQUNmLFVBQU0sWUFBWSxxQkFBcUIsS0FBSztBQUU1QyxVQUFNLEVBQUUsV0FBVyxjQUFjLE1BQU0sS0FBSyxnQkFBZ0IsY0FBYztBQUFBLE1BQ3hFLEtBQUssS0FBSztBQUFBLE1BQ1Y7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBO0FBSUYsVUFBTSxhQUNKLE9BQU8sWUFBWSxXQUFXLFVBQVUsS0FBSyxVQUFVO0FBQ3pELGNBQVUsUUFBUSxVQUFVO0FBRTVCLFNBQUssZ0JBQWdCLHdCQUNuQixXQUNBLE9BQU8sWUFBWSxXQUFXLFVBQVUsS0FBSyxVQUFVLFVBQ3ZELE1BQ0E7QUFHRixjQUFVLGlCQUFpQixZQUFZLE9BQU8sTUFBbUI7QUFDL0QsWUFBTSxFQUFFLHVCQUFXLHNCQUFZLEVBQUU7QUFDakMsWUFBTSxRQUFRLEtBQUssU0FBUyxVQUMxQixDQUFDLFFBQVEsSUFBSSxlQUFlO0FBRTlCLFVBQUksVUFBVSxJQUFJO0FBQ2hCLGFBQUssU0FBUyxPQUFPO0FBQ3JCLGNBQU0sS0FBSztBQUVYLGFBQUssY0FBYztBQUNuQixtQkFBVyxPQUFPLEtBQUssVUFBVTtBQUMvQixnQkFBTSxLQUFLLFdBQVcsSUFBSSxNQUFNLElBQUksU0FBUyxJQUFJO0FBQUE7QUFHbkQsYUFBSyxhQUFhLFNBQVM7QUFDM0IsYUFBSyxhQUFhO0FBQUE7QUFBQTtBQUl0QixjQUFVLGlCQUFpQixRQUFRLE9BQU8sTUFBbUI7QUFDM0QsWUFBTSxFQUFFLHVCQUFXLFlBQVksZUFBZSxFQUFFO0FBQ2hELFlBQU0sUUFBUSxLQUFLLFNBQVMsVUFDMUIsQ0FBQyxRQUFRLElBQUksZUFBZTtBQUU5QixVQUFJLFVBQVUsSUFBSTtBQUVoQixhQUFLLFNBQVMsT0FBTyxVQUFVO0FBQy9CLGNBQU0sS0FBSztBQUdYLGNBQU0sRUFBRSxXQUFXLGlCQUNqQixNQUFNLEtBQUssZ0JBQWdCLGNBQWM7QUFBQSxVQUN2QyxLQUFLLEtBQUs7QUFBQSxVQUNWO0FBQUEsVUFDQSxNQUFNLEtBQUssU0FBUyxPQUFPO0FBQUEsVUFDM0IsU0FBUyxLQUFLLFNBQVMsT0FBTztBQUFBO0FBSWxDLGNBQU0sZUFBZSxVQUFVLGNBQzdCO0FBRUYsWUFBSSxnQkFBZ0IsY0FBYztBQUNoQyx1QkFBYSxZQUFZO0FBQ3pCLGVBQUssZ0JBQWdCLG1CQUFtQjtBQUFBO0FBSTFDLGNBQU0sYUFDSixPQUFPLEtBQUssU0FBUyxPQUFPLFlBQVksV0FDcEMsS0FBSyxTQUFTLE9BQU8sVUFDckIsS0FBSyxVQUFVLEtBQUssU0FBUyxPQUFPO0FBQzFDLGtCQUFVLFFBQVEsVUFBVTtBQUFBO0FBQUE7QUFJaEMsY0FBVSxpQkFBaUIsVUFBVSxPQUFPLE1BQW1CO0FBQzdELFlBQU0sRUFBRSwwQkFBYyxFQUFFO0FBQ3hCLFlBQU0sUUFBUSxLQUFLLFNBQVMsVUFDMUIsQ0FBQyxRQUFRLElBQUksZUFBZTtBQUU5QixVQUFJLFVBQVUsSUFBSTtBQUNoQixhQUFLLFNBQVMsT0FBTyxPQUFPO0FBQzVCLGNBQU0sS0FBSztBQUNYLGtCQUFVO0FBQ1YsYUFBSyxjQUFjO0FBQ25CLGFBQUssY0FBYztBQUFBO0FBQUE7QUFJdkIsU0FBSyxjQUFjLFlBQVk7QUFDL0IsU0FBSyxjQUFjO0FBQ25CLFNBQUssY0FBYztBQUFBO0FBQUEsRUFHYixnQkFBd0I7QUFDOUIsV0FBTyxLQUFLLGFBQWE7QUFBQTtBQUFBLEVBRzNCLFdBQVc7QUFDVCxRQUFJLEtBQUssaUJBQWlCO0FBQ3hCLG9CQUFjLEtBQUs7QUFDbkIsV0FBSyxrQkFBa0I7QUFBQTtBQUV6QixTQUFLLGNBQWM7QUFDbkIsU0FBSyxJQUFJLFVBQVUsSUFDakIsc0JBQ0EsS0FBSyxnQkFBZ0IsS0FBSztBQUU1QixTQUFLLGNBQWM7QUFDbkIsU0FBSyxlQUFlO0FBQ3BCLFNBQUssYUFBYTtBQUFBO0FBQUEsRUFHcEIsV0FBZ0I7QUFDZCxXQUFPO0FBQUEsTUFDTCxRQUFRLEtBQUs7QUFBQSxNQUNiLGlCQUFpQixLQUFLO0FBQUE7QUFBQTtBQUFBLFFBSXBCLFNBQVMsT0FBMkI7QUFqd0I1QztBQWt3QkksUUFBSSxNQUFNLFFBQVE7QUFDaEIsWUFBTSxLQUFLLGFBQWEsTUFBTTtBQUFBO0FBRWhDLFNBQUssdUJBQXVCO0FBRTVCLFFBQUksWUFBSyxJQUFJLFVBQVUsb0JBQW9CLGdDQUF2QyxtQkFBa0QsVUFBUyxLQUFLLE1BQU07QUFDeEUsV0FBSyxhQUFhO0FBQUE7QUFBQTtBQUFBLFFBSWhCLGFBQWEsUUFBK0I7QUFDaEQsUUFBSTtBQUNGLFlBQU0sV0FBVyxNQUFNLEtBQUssWUFBWSxTQUFTO0FBQ2pELFVBQUksQ0FBQyxVQUFVO0FBQ2IsYUFBSyxZQUFZO0FBQ2pCO0FBQUE7QUFHRixXQUFLLGNBQWM7QUFDbkIsV0FBSyxXQUFXLFNBQVM7QUFDekIsV0FBSyxTQUFTLFNBQVM7QUFDdkIsV0FBSyxrQkFBa0IsU0FBUztBQUNoQyxXQUFLLFlBQVksU0FBUyxTQUFTO0FBR25DLFlBQU0sV0FBVyxNQUFNLEtBQUssWUFBWSxZQUFZO0FBQ3BELFVBQUkscUNBQVUsZUFBZTtBQUMzQixhQUFLLG1CQUFtQixTQUFTLGNBQWM7QUFDL0MsYUFBSyxhQUFhLFNBQVMsY0FBYztBQUN6QyxhQUFLLHVCQUF1QixTQUFTLGNBQWM7QUFDbkQsWUFBSSxTQUFTLGNBQWMsTUFBTTtBQUMvQixlQUFLLG1CQUFtQixTQUFTLGNBQWMsS0FBSyxRQUNsRCxtQkFDQTtBQUFBO0FBQUE7QUFLTixVQUFJO0FBQ0YsY0FBTSxTQUFTLE1BQU0sS0FBSyxPQUFPLGFBQWE7QUFDOUMsY0FBTSxlQUFlLE9BQU8sS0FDMUIsQ0FBQyxVQUFVLE1BQU0sT0FBTyxLQUFLO0FBRS9CLGFBQUssbUJBQW1CLDhDQUFjLFNBQVEsS0FBSztBQUFBLGVBQzVDLE9BQVA7QUFDQSxhQUFLLG1CQUFtQixLQUFLO0FBQUE7QUFHL0IsVUFBSSxTQUFTLGVBQWU7QUFDMUIsY0FBTSxLQUFLLGVBQWUsZ0JBQWdCLFNBQVM7QUFBQTtBQUdyRCxpQkFBVyxXQUFXLEtBQUssVUFBVTtBQUNuQyxjQUFNLEtBQUssV0FDVCxRQUFRLE1BQ1IsUUFBUSxTQUNSLFFBQVE7QUFBQTtBQUlaLFdBQUs7QUFHTCxVQUFJLEtBQUssY0FBYztBQUNyQixjQUFNLEtBQUssYUFBYTtBQUFBO0FBQUEsYUFFbkIsT0FBUDtBQUNBLGNBQVEsTUFBTSx5Q0FBeUM7QUFDdkQsV0FBSyxZQUFZO0FBQUE7QUFBQTtBQUFBLFFBSWYsaUJBQWlCLE1BQTRCO0FBQ2pELFVBQU0sS0FBSyxlQUFlLGlCQUFpQjtBQUFBO0FBQUEsUUFHL0IsNEJBQTJDO0FBQ3ZELFFBQUk7QUFDRixVQUFJLGNBQWM7QUFHbEIsVUFBSSxLQUFLLGtCQUFrQjtBQUN6QixZQUFJLHNCQUFzQjtBQUMxQixZQUFJLEtBQUsscUJBQXFCLFlBQVksS0FBSyxrQkFBa0I7QUFDL0QsZ0JBQU0sT0FBTyxLQUFLLElBQUksTUFBTSxzQkFDMUIsS0FBSyxtQkFBbUI7QUFFMUIsY0FBSSxnQkFBZ0IseUJBQU87QUFDekIsa0NBQXNCLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUFBO0FBQUEsZUFFN0M7QUFDTCxnQkFBTSxzQkFBc0IsSUFBSSxvQkFBb0IsS0FBSztBQUN6RCxjQUFJO0FBQ0Ysa0JBQU0sU0FBUyxNQUFNLG9CQUFvQixvQkFDdkMsS0FBSztBQUVQLGdCQUFJLFFBQVE7QUFDVixvQ0FBc0IsT0FBTztBQUFBO0FBQUEsbUJBRXhCLE9BQVA7QUFDQSxvQkFBUSxNQUFNLGtDQUFrQztBQUFBO0FBQUE7QUFHcEQsWUFBSSxxQkFBcUI7QUFDdkIseUJBQWU7QUFBQTtBQUFBLEVBQTBCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUs3QyxZQUFNLGVBQWUsS0FBSyxlQUFlO0FBQ3pDLFVBQUksYUFBYSxPQUFPLEdBQUc7QUFDekIsdUJBQWU7QUFDZixtQkFBVyxZQUFZLGNBQWM7QUFDbkMsY0FBSSxDQUFDLFNBQVMsV0FBVyxTQUFTO0FBR2hDLGtCQUFNLFlBQVksU0FDZixRQUFRLG1CQUFtQixNQUMzQixRQUNDLHVEQUNBO0FBSUosa0JBQU0sZUFBZSxLQUFLLElBQUksY0FBYyxxQkFDMUMsV0FDQTtBQUVGLGdCQUNFLHdCQUF3QiwyQkFDeEIsQ0FBQyxhQUFhLFVBQVUsTUFBTSwrQkFDOUI7QUFDQSxvQkFBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyw2QkFBZSxJQUFJO0FBQUE7QUFBQSxFQUFzQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBT2pELHFCQUFlO0FBQ2YsaUJBQVcsV0FBVyxLQUFLLFVBQVU7QUFDbkMsY0FBTSxPQUFPLFFBQVEsU0FBUyxjQUFjLE1BQU07QUFDbEQsWUFBSSxPQUFPLFFBQVEsWUFBWSxVQUFVO0FBQ3ZDLHlCQUFlLEdBQUc7QUFBQTtBQUFBLEVBQWlCLFFBQVE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSy9DLFlBQU0sVUFBVSxVQUFVLFVBQVU7QUFDcEMsVUFBSSx5QkFBTztBQUFBLGFBQ0osT0FBUDtBQUNBLGNBQVEsTUFBTSx3QkFBd0I7QUFDdEMsVUFBSSx5QkFBTztBQUFBO0FBQUE7QUFBQSxFQUlSLGdCQUFvQztBQUN6QyxXQUFPLEtBQUs7QUFBQTtBQUFBLEVBR1AsYUFBbUI7QUFDeEIsU0FBSyxhQUFhO0FBQUE7QUFBQSxFQUdaLGlCQUFpQixXQUE4QjtBQUVyRCxVQUFNLFVBQVUsVUFBVSxTQUFTLE9BQU87QUFBQSxNQUN4QyxLQUFLO0FBQUE7QUFFUCxVQUFNLFVBQVUsUUFBUSxTQUFTLE9BQU87QUFBQSxNQUN0QyxLQUFLO0FBQUEsTUFDTCxNQUFNO0FBQUE7QUFHUixVQUFNLFlBQVk7QUFHbEIsVUFBTSxtQkFBbUIsQ0FBQyxRQUErQjtBQUN2RCxVQUFJO0FBQ0YsWUFBSSxDQUFDLElBQUksV0FBVztBQUFvQixpQkFBTztBQUMvQyxjQUFNLE1BQU0sSUFBSSxJQUFJO0FBQ3BCLGVBQU8sbUJBQW1CLElBQUksYUFBYSxJQUFJLFdBQVc7QUFBQSxlQUNuRCxHQUFQO0FBQ0EsZ0JBQVEsTUFBTSxpQ0FBaUMsS0FBSztBQUNwRCxlQUFPO0FBQUE7QUFBQTtBQUtYLFVBQU0scUJBQXFCLENBQUMsV0FBNkI7QUFDdkQsWUFBTSxRQUFpQjtBQUN2QixZQUFNLGdCQUFnQixDQUFDLGtCQUEyQjtBQUNoRCxtQkFBVyxTQUFTLGNBQWMsVUFBVTtBQUMxQyxjQUFJLGlCQUFpQix5QkFBTztBQUMxQixrQkFBTSxLQUFLO0FBQUEscUJBQ0YsaUJBQWlCLDJCQUFTO0FBQ25DLDBCQUFjO0FBQUE7QUFBQTtBQUFBO0FBSXBCLG9CQUFjO0FBRWQsWUFBTSxTQUFTLE1BQU0sTUFBTSxHQUFHO0FBQzlCLGFBQU87QUFBQTtBQUlULFVBQU0sZUFBZSxPQUFPLE9BQXNDO0FBQ2hFLFlBQU0scUJBQXFCLEtBQUssZUFBZSxrQkFBa0I7QUFFakUsVUFBSSxzQkFBc0IsV0FBVztBQUNuQyxlQUFPO0FBQUE7QUFHVCxZQUFNLGlCQUFpQixZQUFZO0FBRW5DLFVBQUksZUFBZTtBQUNuQixVQUFJLGlCQUFzQztBQUcxQyxVQUFJLEdBQUcsU0FBUyxHQUFHLE1BQU0sU0FBUyxHQUFHO0FBQ25DLG1CQUFXLFFBQVEsTUFBTSxLQUFLLEdBQUcsUUFBUTtBQUN2QyxjQUFJLEtBQUssU0FBUyxjQUFjO0FBQzlCLGtCQUFNLE9BQU8sTUFBTSxJQUFJLFFBQWdCLENBQUMsWUFBWTtBQUNsRCxtQkFBSyxZQUFZO0FBQUE7QUFJbkIsa0JBQU0sUUFBUSxLQUFLLE1BQU0sTUFBTSxPQUFPLENBQUMsU0FBUyxLQUFLO0FBRXJELHVCQUFXLFFBQVEsT0FBTztBQUN4QixrQkFBSSxXQUFXO0FBQ2Ysa0JBQUksZUFBZTtBQUduQixrQkFBSSxLQUFLLFdBQVcsZ0JBQWdCO0FBQ2xDLDJCQUFXLGlCQUFpQixTQUFTO0FBQUE7QUFJdkMsNkJBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBRXBELGtCQUFJLHdCQUF3QiwyQkFBUztBQUNuQywrQkFBZSxLQUFLO0FBQUEseUJBQ1gsd0JBQXdCLHlCQUFPO0FBQ3hDLCtCQUFlLEtBQUs7QUFBQSx5QkFDWCxDQUFDLFNBQVMsU0FBUyxNQUFNO0FBRWxDLHNCQUFNLFNBQVMsR0FBRztBQUNsQixzQkFBTSxTQUFTLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUNwRCxvQkFBSSxrQkFBa0IseUJBQU87QUFDM0IsaUNBQWUsS0FBSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVNoQyxpQkFBVyxRQUFRLGdCQUFnQjtBQUNqQyxZQUFJLGdCQUFnQiwyQkFBUztBQUMzQixnQkFBTSxjQUFjLG1CQUFtQixNQUFNO0FBQzdDLDBCQUFnQjtBQUFBLG1CQUNQLGdCQUFnQix5QkFBTztBQUNoQztBQUFBO0FBQUE7QUFLSixVQUFJLGlCQUFpQixLQUFLLEdBQUcsTUFBTSxTQUFTLGtCQUFrQjtBQUM1RCxjQUFNLFVBQVUsTUFBTSxJQUFJLFFBQWdCLENBQUMsWUFBWTtBQUNyRCxhQUFHLE1BQU0sR0FBRyxZQUFZO0FBQUE7QUFHMUIsY0FBTSxPQUFPLFFBQ1YsTUFBTSxtQkFDTixPQUFPLENBQUMsUUFBUSxJQUFJLFFBQ3BCLElBQUksQ0FBQyxRQUFRLG9CQUFvQixJQUFJO0FBRXhDLG1CQUFXLE9BQU8sTUFBTTtBQUN0QixnQkFBTSxXQUFXLGlCQUFpQjtBQUNsQyxjQUFJLENBQUM7QUFBVTtBQUVmLGdCQUFNLGVBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBQzFELGNBQUksd0JBQXdCLDJCQUFTO0FBQ25DLGtCQUFNLGNBQWMsbUJBQW1CLGNBQWM7QUFDckQsNEJBQWdCO0FBQUEscUJBQ1Asd0JBQXdCLHlCQUFPO0FBQ3hDO0FBQUE7QUFBQTtBQUFBO0FBS04sWUFBTSxhQUFhLEtBQUssSUFBSSxjQUFjO0FBQzFDLGFBQU87QUFBQTtBQUlULFVBQU0sZ0JBQWdCLE9BQU8sT0FBcUI7QUFDaEQsWUFBTSxxQkFBcUIsS0FBSyxlQUFlLGtCQUFrQjtBQUNqRSxVQUFJLHNCQUFzQixXQUFXO0FBQ25DLGdCQUFRLGNBQWMsOEJBQThCO0FBQ3BEO0FBQUE7QUFHRixZQUFNLFlBQVksTUFBTSxhQUFhO0FBQ3JDLFVBQUksWUFBWSxHQUFHO0FBQ2pCLGdCQUFRLGNBQWMsT0FBTyxpQkFDM0IsWUFBWSxJQUFJLE1BQU0sa0JBQ1IscUJBQXFCLGFBQWE7QUFBQSxhQUM3QztBQUNMLGdCQUFRLGNBQWMsaUNBQWlDLHNCQUFzQjtBQUFBO0FBQUE7QUFLakYsUUFBSSxjQUFjO0FBRWxCLGNBQVUsaUJBQWlCLGFBQWEsQ0FBQyxNQUFNO0FBQzdDLFFBQUU7QUFDRixRQUFFO0FBQ0Y7QUFDQSxVQUFJLGdCQUFnQixHQUFHO0FBQ3JCLGtCQUFVLFNBQVM7QUFDbkIsWUFBSSxFQUFFLGNBQWM7QUFDbEIsd0JBQWMsRUFBRTtBQUFBO0FBQUE7QUFBQTtBQUt0QixjQUFVLGlCQUFpQixhQUFhLENBQUMsTUFBTTtBQUM3QyxRQUFFO0FBQ0YsUUFBRTtBQUNGO0FBQ0EsVUFBSSxnQkFBZ0IsR0FBRztBQUNyQixrQkFBVSxZQUFZO0FBQUE7QUFBQTtBQUkxQixjQUFVLGlCQUFpQixZQUFZLE9BQU8sTUFBTTtBQUNsRCxRQUFFO0FBQ0YsUUFBRTtBQUNGLFVBQUksRUFBRSxjQUFjO0FBQ2xCLGNBQU0sY0FBYyxFQUFFO0FBQUE7QUFBQTtBQUkxQixjQUFVLGlCQUFpQixRQUFRLE9BQU8sTUFBTTtBQUM5QyxRQUFFO0FBQ0YsUUFBRTtBQUNGLG9CQUFjO0FBQ2QsZ0JBQVUsWUFBWTtBQUV0QixZQUFNLEtBQUssRUFBRTtBQUNiLFVBQUksQ0FBQyxJQUFJO0FBQ1A7QUFBQTtBQUdGLFlBQU0sc0JBQXNCLEtBQUssZUFBZSxrQkFBa0I7QUFDbEUsVUFBSSx1QkFBdUIsV0FBVztBQUNwQyxZQUFJLHlCQUFPLDhCQUE4QjtBQUN6QztBQUFBO0FBR0YsVUFBSTtBQUNGLFlBQUksaUJBQXNDO0FBRzFDLFlBQUksR0FBRyxTQUFTLEdBQUcsTUFBTSxTQUFTLEdBQUc7QUFDbkMscUJBQVcsUUFBUSxNQUFNLEtBQUssR0FBRyxRQUFRO0FBQ3ZDLGdCQUFJLEtBQUssU0FBUyxjQUFjO0FBQzlCLG9CQUFNLE9BQU8sTUFBTSxJQUFJLFFBQWdCLENBQUMsWUFBWTtBQUNsRCxxQkFBSyxZQUFZO0FBQUE7QUFJbkIsb0JBQU0sUUFBUSxLQUFLLE1BQU0sTUFBTSxPQUFPLENBQUMsU0FBUyxLQUFLO0FBRXJELHlCQUFXLFFBQVEsT0FBTztBQUN4QixvQkFBSSxXQUFXO0FBQ2Ysb0JBQUksZUFBZTtBQUduQixvQkFBSSxLQUFLLFdBQVcsZ0JBQWdCO0FBQ2xDLDZCQUFXLGlCQUFpQixTQUFTO0FBQUE7QUFJdkMsK0JBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBRXBELG9CQUFJLHdCQUF3QiwyQkFBUztBQUNuQyxpQ0FBZSxLQUFLO0FBQUEsMkJBQ1gsd0JBQXdCLHlCQUFPO0FBQ3hDLGlDQUFlLEtBQUs7QUFBQSwyQkFDWCxDQUFDLFNBQVMsU0FBUyxNQUFNO0FBRWxDLHdCQUFNLFNBQVMsR0FBRztBQUNsQix3QkFBTSxTQUFTLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUNwRCxzQkFBSSxrQkFBa0IseUJBQU87QUFDM0IsbUNBQWUsS0FBSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVNoQyxZQUFJLGVBQWUsV0FBVyxLQUFLLEdBQUcsTUFBTSxTQUFTLGtCQUFrQjtBQUNyRSxnQkFBTSxVQUFVLE1BQU0sSUFBSSxRQUFnQixDQUFDLFlBQVk7QUFDckQsZUFBRyxNQUFNLEdBQUcsWUFBWTtBQUFBO0FBRzFCLGdCQUFNLE9BQU8sUUFDVixNQUFNLG1CQUNOLE9BQU8sQ0FBQyxRQUFRLElBQUksUUFDcEIsSUFBSSxDQUFDLFFBQVEsb0JBQW9CLElBQUk7QUFFeEMscUJBQVcsT0FBTyxNQUFNO0FBQ3RCLGtCQUFNLFdBQVcsaUJBQWlCO0FBQ2xDLGdCQUFJLENBQUM7QUFBVTtBQUVmLGdCQUFJLGVBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBRXhELGdCQUNFLHdCQUF3QiwyQkFDeEIsd0JBQXdCLDJCQUN4QjtBQUNBLDZCQUFlLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFLMUIsWUFBSSxrQkFBa0I7QUFDdEIsY0FBTSxpQkFBaUIsWUFBWTtBQUVuQyxtQkFBVyxRQUFRLGdCQUFnQjtBQUNqQyxjQUFJLGdCQUFnQiwyQkFBUztBQUMzQixrQkFBTSxRQUFRLG1CQUFtQjtBQUVqQyx1QkFBVyxRQUFRLE9BQU87QUFDeEIsb0JBQU0scUJBQ0osS0FBSyxlQUFlLGtCQUFrQjtBQUN4QyxrQkFBSSxzQkFBc0IsV0FBVztBQUNuQyxvQkFBSSx5QkFBTyx1QkFBdUI7QUFDbEM7QUFBQTtBQUdGLGtCQUFJO0FBQ0Ysc0JBQU0sS0FBSyxlQUFlLGlCQUFpQjtBQUMzQztBQUNBLHNCQUFNLHFCQUNKLEtBQUssZUFBZSxrQkFBa0I7QUFDeEMsb0JBQUkseUJBQ0YsU0FBUyxLQUFLLG9CQUFvQixzQkFBc0I7QUFBQSx1QkFFbkQsT0FBUDtBQUNBLHdCQUFRLE1BQU0sNkNBQTZDO0FBQUEsa0JBQ3pELE1BQU0sS0FBSztBQUFBLGtCQUNYO0FBQUE7QUFBQTtBQUFBO0FBQUEscUJBSUcsZ0JBQWdCLHlCQUFPO0FBQ2hDLGtCQUFNLHFCQUNKLEtBQUssZUFBZSxrQkFBa0I7QUFDeEMsZ0JBQUksc0JBQXNCLFdBQVc7QUFDbkMsa0JBQUkseUJBQU8sdUJBQXVCO0FBQ2xDO0FBQUE7QUFHRixrQkFBTSxLQUFLLGVBQWUsaUJBQWlCO0FBQzNDO0FBQ0Esa0JBQU0scUJBQ0osS0FBSyxlQUFlLGtCQUFrQjtBQUN4QyxnQkFBSSx5QkFDRixTQUFTLEtBQUssb0JBQW9CLHNCQUFzQjtBQUFBO0FBQUE7QUFLOUQsY0FBTSxtQkFBbUIsS0FBSyxlQUFlLGtCQUFrQjtBQUFBLGVBQ3hELE9BQVA7QUFDQSxnQkFBUSxNQUFNLHFDQUFxQztBQUNuRCxZQUFJLHlCQUFPO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFRVixxQkFBNkI7QUFDbEMsV0FBTyxLQUFLO0FBQUE7QUFBQSxRQU1ELG1CQUFtQixTQUFnQztBQUM5RCxTQUFLLGtCQUFrQjtBQUN2QixVQUFNLEtBQUs7QUFDWCxVQUFNLEtBQUs7QUFHWCxVQUFNLFNBQVMsTUFBTSxLQUFLLE9BQU8sYUFBYTtBQUM5QyxVQUFNLGdCQUFnQixPQUFPLEtBQUssQ0FBQyxVQUFVLE1BQU0sT0FBTztBQUMxRCxRQUFJLEtBQUssd0JBQXdCLGdEQUFlLGlCQUFnQjtBQUM5RCxXQUFLLGFBQWEsS0FBSyxNQUNwQixLQUFLLHVCQUF1QixNQUFPLGNBQWM7QUFFcEQsWUFBTSxLQUFLO0FBQUE7QUFJYixTQUFLO0FBQUE7QUFBQTs7O0FKbHNDVCxJQUFNLG9CQUFvQjtBQUFBLEVBQ3hCLEVBQUUsVUFBVSwwQkFBMEIsV0FBVyxRQUFRLFlBQVk7QUFBQSxFQUNyRSxFQUFFLFVBQVUsY0FBYyxXQUFXLFFBQVEsWUFBWTtBQUFBLEVBQ3pELEVBQUUsVUFBVSx5QkFBeUIsV0FBVyxPQUFPLFlBQVk7QUFBQSxFQUNuRSxFQUFFLFVBQVUsYUFBYSxXQUFXLE9BQU8sWUFBWTtBQUFBO0FBa0JsRCw0QkFBc0I7QUFBQSxFQXNCbkIsWUFDTixLQUNBLFFBQ0EsVUFBMkIsSUFDM0I7QUF2Qk0sdUJBQWM7QUFDZCw2QkFBeUQsSUFBSTtBQUU3RCx1QkFBa0M7QUFDbEMseUJBQXNDO0FBQ3RDLGtCQUF1QjtBQUN2QiwwQkFBNEQ7QUFDNUQsZ0NBQXNDO0FBQ3RDLHdCQUFvQztBQUNwQyxvQkFBZ0M7QUFDaEMsMEJBQWdDO0FBRXZCLDJCQUFrQjtBQUMzQiw0QkFBNkM7QUFDN0MsMEJBQTBDO0FBQzFDLDBCQUFxQztBQUNyQyx1QkFBbUM7QUFDbkMseUJBQXNDO0FBeW5CdEMsZ0JBQU8sTUFBTTtBQUNuQixVQUFJLENBQUMsS0FBSyxlQUFlLENBQUMsS0FBSyxZQUFZLENBQUMsS0FBSyxrQkFBa0I7QUFDakUsWUFBSSxLQUFLLGdCQUFnQjtBQUN2QiwrQkFBcUIsS0FBSztBQUMxQixlQUFLLGlCQUFpQjtBQUFBO0FBRXhCO0FBQUE7QUFJRixVQUFJLEtBQUssZ0JBQWdCO0FBQ3ZCLDZCQUFxQixLQUFLO0FBQzFCLGFBQUssaUJBQWlCO0FBQUE7QUFHeEIsWUFBTSxlQUFlLEtBQUssU0FBUztBQUNuQyxZQUFNLFlBQVksSUFBSSxXQUFXO0FBQ2pDLFdBQUssU0FBUyxxQkFBcUI7QUFFbkMsWUFBTSxNQUFNLEtBQUssaUJBQWlCLFdBQVc7QUFDN0MsVUFBSSxDQUFDO0FBQUs7QUFHVixVQUFJLFVBQ0YsR0FDQSxHQUNBLEtBQUssaUJBQWlCLE9BQ3RCLEtBQUssaUJBQWlCO0FBR3hCLFlBQU0sT0FBTyxLQUFLLGlCQUFpQjtBQUNuQyxZQUFNLFFBQVEsS0FBSztBQUNuQixZQUFNLFNBQVMsS0FBSztBQUNwQixZQUFNLFVBQVUsU0FBUztBQUN6QixZQUFNLFVBQVUsUUFBUTtBQUd4QixZQUFNLFdBQVcsU0FBUztBQUMxQixZQUFNLFVBQVUsV0FBVyxJQUFJO0FBQy9CLFlBQU0scUJBQXFCLFdBQVcsSUFBSTtBQUMxQyxZQUFNLGlCQUFpQixXQUFXLE1BQU07QUFDeEMsWUFBTSxnQkFBZ0IsV0FBVyxPQUFPO0FBR3hDLFlBQU0sZ0JBQWdCLGlCQUFpQixTQUFTO0FBQ2hELFVBQUksY0FBYyxjQUFjLGlCQUFpQixpQkFBaUI7QUFDbEUsVUFBSSxDQUFDLGFBQWE7QUFDaEIsc0JBQWM7QUFBQTtBQUloQixZQUFNLFdBQVcsSUFBSSxxQkFBcUIsR0FBRyxHQUFHLEdBQUc7QUFDbkQsZUFBUyxhQUFhLEdBQUc7QUFDekIsZUFBUyxhQUFhLEtBQUs7QUFDM0IsZUFBUyxhQUFhLEdBQUc7QUFDekIsVUFBSSxZQUFZO0FBR2hCLFVBQUk7QUFDSixVQUFJLE9BQU8sU0FBUztBQUVwQixZQUFNLG1CQUFtQixLQUFLLE1BQU0sZUFBZTtBQUNuRCxZQUFNLGFBQWEsUUFBUSxJQUFJO0FBQy9CLFlBQU0sZ0JBQWdCLGFBQWE7QUFHbkMsWUFBTSxlQUFlLENBQUMsR0FBVyxVQUFrQjtBQUNqRCxjQUFNLFdBQVcsUUFBUTtBQUN6QixZQUFJLElBQUksVUFBVTtBQUNoQixpQkFBTyxNQUFNLE1BQU8sS0FBSTtBQUFBLG1CQUNmLElBQUksUUFBUSxVQUFVO0FBQy9CLGlCQUFPLE1BQU0sTUFBUSxVQUFRLEtBQUs7QUFBQTtBQUVwQyxlQUFPO0FBQUE7QUFJVCxlQUFTLElBQUksQ0FBQyxTQUFTLElBQUksbUJBQW1CLFNBQVMsS0FBSztBQUMxRCxjQUFNLFFBQVEsVUFBVSxLQUFLLElBQUksTUFBTTtBQUN2QyxjQUFNLFFBQVEsS0FBSyxJQUFJLEtBQUssSUFBSSxJQUFJLG1CQUFtQjtBQUN2RCxhQUFLLGVBQWUsU0FDbEIsS0FBSyxlQUFlLFNBQVMsS0FBSyxrQkFDbEMsUUFBUyxLQUFJLEtBQUs7QUFFcEIsY0FBTSxJQUFJLFVBQVUsSUFBSSxhQUFhO0FBQ3JDLGNBQU0sUUFBUSxhQUFhLElBQUksU0FBUyxtQkFBbUIsVUFBVTtBQUNyRSxjQUFNLElBQ0osVUFBVSxLQUFLLGVBQWUsU0FBUyxVQUFVLGlCQUFpQjtBQUNwRSxZQUFJLE9BQU8sR0FBRztBQUFBO0FBSWhCLGVBQVMsSUFBSSxtQkFBbUIsVUFBVSxHQUFHLEtBQUssQ0FBQyxTQUFTLEtBQUs7QUFDL0QsY0FBTSxRQUFRLEtBQUssSUFBSSxLQUFLLElBQUksSUFBSSxtQkFBbUI7QUFDdkQsY0FBTSxJQUFJLFVBQVUsSUFBSSxhQUFhO0FBQ3JDLGNBQU0sUUFBUSxhQUFhLElBQUksU0FBUyxtQkFBbUIsVUFBVTtBQUNyRSxjQUFNLElBQ0osVUFBVSxLQUFLLGVBQWUsU0FBUyxVQUFVLGlCQUFpQjtBQUNwRSxZQUFJLE9BQU8sR0FBRztBQUFBO0FBSWhCLGVBQVMsSUFBSSxDQUFDLFNBQVMsSUFBSSxtQkFBbUIsU0FBUyxLQUFLO0FBQzFELGNBQU0sUUFBUSxLQUFLLElBQUksS0FBSyxJQUFJLElBQUksbUJBQW1CO0FBQ3ZELGNBQU0sSUFBSSxVQUFVLElBQUksYUFBYTtBQUNyQyxjQUFNLFFBQVEsYUFBYSxJQUFJLFNBQVMsbUJBQW1CLFVBQVU7QUFDckUsY0FBTSxJQUNKLFVBQVUsS0FBSyxlQUFlLFNBQVMsVUFBVSxpQkFBaUI7QUFDcEUsWUFBSSxPQUFPLEdBQUc7QUFBQTtBQUloQixlQUFTLElBQUksbUJBQW1CLFVBQVUsR0FBRyxLQUFLLENBQUMsU0FBUyxLQUFLO0FBQy9ELGNBQU0sUUFBUSxLQUFLLElBQUksS0FBSyxJQUFJLElBQUksbUJBQW1CO0FBQ3ZELGNBQU0sSUFBSSxVQUFVLElBQUksYUFBYTtBQUNyQyxjQUFNLFFBQVEsYUFBYSxJQUFJLFNBQVMsbUJBQW1CLFVBQVU7QUFDckUsY0FBTSxJQUNKLFVBQVUsS0FBSyxlQUFlLFNBQVMsVUFBVSxpQkFBaUI7QUFDcEUsWUFBSSxPQUFPLEdBQUc7QUFBQTtBQUdoQixVQUFJO0FBQ0osVUFBSTtBQUdKLFVBQUksS0FBSyxhQUFhO0FBQ3BCLGFBQUssaUJBQWlCLHNCQUFzQixLQUFLO0FBQUE7QUFBQTtBQWh2Qm5ELFNBQUssTUFBTTtBQUNYLFNBQUssU0FBUztBQUNkLFNBQUssaUJBQWlCLElBQUksYUFBYTtBQUN2QyxTQUFLLGNBQWM7QUFDbkIsWUFBUSxJQUFJO0FBQUE7QUFBQSxTQUdQLFlBQ0wsS0FDQSxRQUNBLFVBQTJCLElBQ1Y7QUFDakIsUUFBSSxDQUFDLGdCQUFnQixVQUFVO0FBQzdCLGNBQVEsSUFBSTtBQUNaLHNCQUFnQixXQUFXLElBQUksZ0JBQWdCLEtBQUs7QUFBQTtBQUl0RCxvQkFBZ0IsU0FBUyxjQUFjO0FBQ3ZDLFdBQU8sZ0JBQWdCO0FBQUE7QUFBQSxFQUdqQixvQkFBaUU7QUFDdkUsVUFBTSxhQUFhLEtBQUssSUFBSSxVQUFVO0FBQ3RDLFFBQUksQ0FBQyxZQUFZO0FBQ2YsYUFBTyxFQUFFLFFBQVEsT0FBTyxnQkFBZ0I7QUFBQTtBQUcxQyxVQUFNLFlBQVksV0FBVztBQUM3QixVQUFNLFdBQVcsVUFBVTtBQUczQixRQUFJLGFBQWEsZ0JBQWdCO0FBQy9CLGFBQU8sRUFBRSxRQUFRLE1BQU0sZ0JBQWdCO0FBQUE7QUFJekMsVUFBTSxlQUFlLEtBQUssSUFBSSxVQUFVLG9CQUFvQjtBQUM1RCxRQUFJLDZDQUFjLE1BQU07QUFDdEIsYUFBTztBQUFBLFFBQ0wsUUFBUTtBQUFBLFFBQ1IsZ0JBQWdCLFFBQVEsYUFBYSxLQUFLO0FBQUE7QUFBQTtBQUk5QyxXQUFPLEVBQUUsUUFBUSxPQUFPLGdCQUFnQjtBQUFBO0FBQUEsRUFHbEMsY0FBYyxTQUEwQjtBQUM5QyxVQUFNLEVBQUUsV0FBVyxLQUFLO0FBQ3hCLFNBQUssaUJBQWlCO0FBQUEsTUFDcEIsVUFBVTtBQUFBLE1BQ1YseUJBQXlCLFFBQVE7QUFBQTtBQUFBO0FBQUEsRUFJN0IseUJBQXlCLE1BQW9CO0FBQ25ELFVBQU0sRUFBRSxXQUFXLEtBQUs7QUFFeEIsUUFBSSxRQUFRO0FBQ1YsWUFBTSxXQUFXLEtBQUssSUFBSSxVQUFVLG9CQUFvQjtBQUN4RCxVQUFJLFVBQVU7QUFDWixjQUFNLFFBQVEsU0FBUyxZQUFZLGNBQ2pDO0FBRUYsWUFBSSxPQUFPO0FBQ1QsZ0JBQU0sWUFBWSxNQUFNO0FBQ3hCLGdCQUFNLGVBQWUsTUFBTTtBQUUzQixjQUFJLGNBQWMsTUFBTTtBQUV0QixrQkFBTSxXQUNKLGFBQWEsTUFBTSxHQUFHLGFBQ3RCLE9BQ0EsYUFBYSxNQUFNO0FBQ3JCLGtCQUFNLFFBQVE7QUFFZCxrQkFBTSxpQkFBaUIsTUFBTSxlQUFlLFlBQVksS0FBSztBQUFBLGlCQUN4RDtBQUVMLGtCQUFNLFFBQVEsZUFBZTtBQUM3QixrQkFBTSxpQkFBaUIsTUFBTSxlQUFlLE1BQU0sTUFBTTtBQUFBO0FBSTFELGdCQUFNLGNBQWMsSUFBSSxNQUFNO0FBRTlCLGdCQUFNO0FBRU4sY0FBSSx5QkFBTztBQUFBLGVBQ047QUFDTCxrQkFBUSxLQUFLO0FBQ2IsY0FBSSx5QkFBTztBQUFBO0FBQUEsYUFFUjtBQUNMLGdCQUFRLEtBQUs7QUFDYixZQUFJLHlCQUFPO0FBQUE7QUFBQSxXQUVSO0FBQ0wsWUFBTSxlQUFlLEtBQUssSUFBSSxVQUFVLG9CQUFvQjtBQUM1RCxVQUFJLENBQUMsOENBQWMsU0FBUTtBQUN6QixnQkFBUSxLQUFLO0FBQ2IsWUFBSSx5QkFBTztBQUNYO0FBQUE7QUFHRixZQUFNLFNBQVMsYUFBYTtBQUM1QixZQUFNLFNBQVMsT0FBTztBQUN0QixZQUFNLGNBQWMsT0FBTyxRQUFRLE9BQU87QUFDMUMsWUFBTSxlQUFlLE9BQ2pCLE9BQU8sS0FBSyxLQUFLLFlBQVksU0FBUyxJQUNwQyxPQUFPLE9BQ1AsT0FDRjtBQUVKLFVBQUksQ0FBQyxjQUFjO0FBQ2pCLGdCQUFRLEtBQUs7QUFDYjtBQUFBO0FBR0YsYUFBTyxhQUFhLGNBQWM7QUFDbEMsWUFBTSxRQUFRLGFBQWEsTUFBTTtBQUNqQyxZQUFNLFdBQVcsTUFBTSxNQUFNLFNBQVMsTUFBTTtBQUM1QyxhQUFPLFVBQVU7QUFBQSxRQUNmLE1BQU0sT0FBTyxPQUFPLE1BQU0sU0FBUztBQUFBLFFBQ25DLElBQUksU0FBUztBQUFBO0FBR2YsVUFBSSx5QkFBTztBQUFBO0FBQUE7QUFBQSxRQUlELDBCQUEwQjtBQTFQMUM7QUEyUEksUUFBSSxDQUFDLEtBQUs7QUFBc0I7QUFFaEMsUUFBSTtBQUNGLFlBQU0sT0FBTyxLQUFLLE9BQU8sSUFBSSxNQUFNLHNCQUNqQyxLQUFLO0FBRVAsVUFBSSxDQUFDLFFBQVEsQ0FBRSxpQkFBZ0I7QUFBUTtBQUV2QyxZQUFNLFFBQVEsSUFBSSx3QkFBd0IsS0FBSyxLQUFLO0FBQUEsUUFDbEQ7QUFBQSxRQUNBLFFBQVEsaUJBQUssbUJBQUwsbUJBQXFCLGFBQXJCLFlBQWlDO0FBQUEsUUFDekMseUJBQXlCLENBQUMsU0FBaUI7QUF0UW5EO0FBdVFVLGNBQUksWUFBSyxtQkFBTCxvQkFBcUIseUJBQXlCO0FBQ2hELGlCQUFLLGVBQWUsd0JBQXdCO0FBQUEsaUJBQ3ZDO0FBQ0wsaUJBQUsseUJBQXlCO0FBQUE7QUFBQTtBQUFBLFFBR2xDLFFBQVEsS0FBSztBQUFBO0FBRWYsWUFBTTtBQUdOLFVBQUk7QUFDRixjQUFNLEtBQUssT0FBTyxJQUFJLE1BQU0sT0FBTztBQUFBLGVBQzVCLE9BQVA7QUFDQSxnQkFBUSxLQUFLLHNDQUFzQztBQUFBO0FBQUEsYUFFOUMsT0FBUDtBQUNBLGNBQVEsTUFBTSw4QkFBOEI7QUFDNUMsVUFBSSx5QkFBTztBQUNYLFlBQU07QUFBQTtBQUFBO0FBQUEsRUFJRix1QkFBNkI7QUFFbkMsUUFBSSxLQUFLLGdCQUFnQjtBQUN2QixVQUFJLEtBQUssYUFBYTtBQUNwQixhQUFLO0FBQ0wsYUFBSyxjQUFjO0FBQUE7QUFFckIsV0FBSyxlQUFlO0FBQ3BCLFdBQUssaUJBQWlCO0FBQUE7QUFJeEIsU0FBSyxpQkFBaUIsU0FBUyxjQUFjO0FBQzdDLFNBQUssZUFBZSxZQUFZO0FBRWhDLFVBQU0sVUFBVSxTQUFTLGNBQWM7QUFDdkMsWUFBUSxZQUFZO0FBRXBCLFVBQU0sZ0JBQWdCLFNBQVMsY0FBYztBQUM3QyxrQkFBYyxZQUFZO0FBQzFCLGtCQUFjLGNBQWM7QUFDNUIsWUFBUSxZQUFZO0FBRXBCLFVBQU0sU0FBUyxTQUFTLGNBQWM7QUFDdEMsV0FBTyxZQUFZO0FBQ25CLFlBQVEsWUFBWTtBQUVwQixTQUFLLGVBQWUsWUFBWTtBQUNoQyxhQUFTLEtBQUssWUFBWSxLQUFLO0FBRS9CLFNBQUssY0FBYyxLQUFLLGVBQWUsS0FBSztBQUM1QyxTQUFLLG9CQUFvQjtBQUFBO0FBQUEsRUFHbkIsZUFBZSxTQUFrQztBQUV2RCxRQUFJLE1BQU0sRUFBRSxHQUFHLEdBQUcsR0FBRztBQUdyQixVQUFNLFVBQVUsTUFBTTtBQUNwQixjQUFRLFVBQVUsT0FBTztBQUFBO0FBSTNCLFVBQU0sU0FBUyxDQUFDLFNBQWlCLFlBQW9CO0FBQ25ELFlBQU0sT0FBTyxRQUFRO0FBQ3JCLFVBQUksSUFBSSxLQUFLLElBQ1gsS0FBSyxJQUFJLEdBQUcsVUFBVSxLQUFLLFFBQVEsSUFDbkMsT0FBTyxhQUFhLEtBQUs7QUFFM0IsVUFBSSxJQUFJLEtBQUssSUFDWCxLQUFLLElBQUksR0FBRyxVQUFVLEtBQUssU0FBUyxJQUNwQyxPQUFPLGNBQWMsS0FBSztBQUk1QixjQUFRLE1BQU0sU0FBUztBQUN2QixjQUFRLE1BQU0sUUFBUTtBQUd0QixjQUFRLE1BQU0sT0FBTyxHQUFHLElBQUk7QUFDNUIsY0FBUSxNQUFNLE1BQU0sR0FBRyxJQUFJO0FBQUE7QUFJN0IsVUFBTSxnQkFBZ0IsQ0FBQyxNQUFvQjtBQUV6QyxVQUFJLEVBQUUsV0FBVyxLQUFLLEVBQUUsV0FBVztBQUFJO0FBRXZDLGNBQVEsVUFBVSxJQUFJO0FBQ3RCLGNBQVEsa0JBQWtCLEVBQUU7QUFHNUIsWUFBTSxPQUFPLFFBQVE7QUFDckIsVUFBSSxJQUFJLEtBQUs7QUFDYixVQUFJLElBQUksS0FBSztBQUdiLGFBQU8sRUFBRSxTQUFTLEVBQUU7QUFBQTtBQUd0QixVQUFNLGdCQUFnQixDQUFDLE1BQW9CO0FBQ3pDLFVBQUksUUFBUSxrQkFBa0IsRUFBRSxZQUFZO0FBQzFDLGVBQU8sRUFBRSxTQUFTLEVBQUU7QUFBQTtBQUFBO0FBSXhCLFVBQU0sY0FBYyxDQUFDLE1BQW9CO0FBQ3ZDO0FBQ0EsY0FBUSxzQkFBc0IsRUFBRTtBQUFBO0FBSWxDLFlBQVEsaUJBQWlCLGVBQWU7QUFDeEMsWUFBUSxpQkFBaUIsZUFBZTtBQUN4QyxZQUFRLGlCQUFpQixhQUFhO0FBQ3RDLFlBQVEsaUJBQWlCLGlCQUFpQjtBQUcxQyxXQUFPLE1BQU07QUFDWCxjQUFRLG9CQUFvQixlQUFlO0FBQzNDLGNBQVEsb0JBQW9CLGVBQWU7QUFDM0MsY0FBUSxvQkFBb0IsYUFBYTtBQUN6QyxjQUFRLG9CQUFvQixpQkFBaUI7QUFBQTtBQUFBO0FBQUEsUUFJM0Msa0JBQWlDO0FBQ3JDLFFBQUk7QUFDRixVQUFJLENBQUMsS0FBSyxhQUFhO0FBQ3JCLGNBQU0sRUFBRSxRQUFRLG1CQUFtQixLQUFLO0FBRXhDLFlBQUksbUJBQW1CLFdBQVc7QUFDaEMsY0FBSSx5QkFBTztBQUNYO0FBQUE7QUFHRixnQkFBUSxJQUFJLCtCQUErQjtBQUFBLFVBQ3pDO0FBQUEsVUFDQTtBQUFBO0FBSUYsYUFBSyxjQUFjO0FBQUEsVUFDakIsVUFBVTtBQUFBO0FBSVosYUFBSztBQUFBO0FBR1AsVUFBSSxLQUFLLGFBQWE7QUFDcEIsY0FBTSxLQUFLO0FBRVgsWUFBSSxLQUFLLGdCQUFnQjtBQUN2QixjQUFJLEtBQUssYUFBYTtBQUNwQixpQkFBSztBQUNMLGlCQUFLLGNBQWM7QUFBQTtBQUVyQixlQUFLLGVBQWU7QUFDcEIsZUFBSyxpQkFBaUI7QUFBQTtBQUFBLGFBRW5CO0FBQ0wsY0FBTSxLQUFLO0FBQ1gsWUFBSSxLQUFLLGdCQUFnQjtBQUN2QixlQUFLLGVBQWUsVUFBVSxJQUFJO0FBQUE7QUFBQTtBQUFBLGFBRy9CLE9BQVA7QUFDQSxjQUFRLE1BQU0sNkJBQTZCO0FBQzNDLFVBQUkseUJBQU87QUFBQTtBQUFBO0FBQUEsUUFJRCwyQkFBMEM7QUFDdEQsVUFBTSxNQUFNLEtBQUssT0FBTyxTQUFTO0FBQ2pDLFFBQUk7QUFDRixZQUFNLEtBQUssT0FBTyxJQUFJLE1BQU0sUUFBUSxNQUFNO0FBQUEsYUFDbkMsT0FBUDtBQUNBLFlBQU0sZUFDSixpQkFBaUIsUUFBUSxNQUFNLFVBQVU7QUFDM0MsY0FBUSxNQUFNLDBDQUEwQztBQUN4RCxZQUFNLElBQUksTUFBTSwwQ0FBMEM7QUFBQTtBQUFBO0FBQUEsUUFJaEQsd0JBRVo7QUFDQSxlQUFXLFVBQVUsbUJBQW1CO0FBQ3RDLFVBQUk7QUFDRixZQUFJLGNBQWMsZ0JBQWdCLE9BQU8sV0FBVztBQUNsRCxrQkFBUSxJQUFJLDhCQUE4QixPQUFPO0FBQ2pELGlCQUFPO0FBQUE7QUFBQSxlQUVGLE9BQVA7QUFDQSxnQkFBUSxLQUFLLFVBQVUsT0FBTywwQkFBMEI7QUFBQTtBQUFBO0FBRzVELFVBQU0sSUFBSSxNQUFNO0FBQUE7QUFBQSxFQUdWLG1CQUEyQjtBQXBkckM7QUFxZEksVUFBTSxNQUFNLElBQUk7QUFDaEIsVUFBTSxZQUFZLElBQ2YsY0FDQSxRQUFRLFNBQVMsS0FDakIsUUFBUSxLQUFLLEtBQ2IsTUFBTSxLQUFLO0FBQ2QsV0FBTyxHQUFHLGFBQWEsWUFBSyxtQkFBTCxtQkFBcUIsY0FBYTtBQUFBO0FBQUEsRUFHbkQsMEJBQWdDO0FBRXRDLFNBQUssaUJBQWlCLElBQUksYUFBYTtBQUd2QyxRQUFJLEtBQUssZ0JBQWdCO0FBQ3ZCLDJCQUFxQixLQUFLO0FBQzFCLFdBQUssaUJBQWlCO0FBQUE7QUFJeEIsUUFBSSxLQUFLLFVBQVU7QUFDakIsV0FBSyxTQUFTO0FBQ2QsV0FBSyxXQUFXO0FBQUE7QUFJbEIsUUFBSSxLQUFLLGNBQWM7QUFDckIsV0FBSyxhQUFhO0FBQ2xCLFdBQUssZUFBZTtBQUFBO0FBSXRCLFFBQUksS0FBSyxrQkFBa0I7QUFDekIsWUFBTSxNQUFNLEtBQUssaUJBQWlCLFdBQVc7QUFDN0MsVUFBSSxLQUFLO0FBQ1AsWUFBSSxVQUNGLEdBQ0EsR0FDQSxLQUFLLGlCQUFpQixPQUN0QixLQUFLLGlCQUFpQjtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTXRCLHFCQUEyQjtBQUNqQyxRQUFJLENBQUMsS0FBSztBQUFhO0FBR3ZCLFNBQUssZUFBZSxJQUFJLGFBQWE7QUFBQSxNQUNuQyxZQUFZO0FBQUEsTUFDWixhQUFhO0FBQUE7QUFJZixVQUFNLFNBQVMsS0FBSyxhQUFhLHdCQUF3QixLQUFLO0FBRzlELFNBQUssV0FBVyxLQUFLLGFBQWE7QUFDbEMsU0FBSyxTQUFTLFVBQVU7QUFDeEIsU0FBSyxTQUFTLHdCQUF3QjtBQUd0QyxXQUFPLFFBQVEsS0FBSztBQUdwQixRQUFJLEtBQUssa0JBQWtCO0FBQ3pCLFdBQUs7QUFDTCxXQUFLO0FBQUE7QUFBQTtBQUFBLEVBSVQsb0JBQW9CLFFBQXdDO0FBRTFELFFBQUksS0FBSyxrQkFBa0I7QUFDekIsWUFBTSxNQUFNLEtBQUssaUJBQWlCLFdBQVc7QUFDN0MsVUFBSSxLQUFLO0FBQ1AsWUFBSSxVQUNGLEdBQ0EsR0FDQSxLQUFLLGlCQUFpQixPQUN0QixLQUFLLGlCQUFpQjtBQUFBO0FBQUE7QUFNNUIsUUFBSSxDQUFDLFFBQVE7QUFDWCxXQUFLO0FBQUE7QUFHUCxTQUFLLG1CQUFtQjtBQUd4QixRQUFJLFVBQVUsS0FBSyxhQUFhO0FBQzlCLFdBQUs7QUFFTCxVQUFJLENBQUMsS0FBSyxnQkFBZ0IsQ0FBQyxLQUFLLFVBQVU7QUFDeEMsYUFBSztBQUFBLGFBQ0E7QUFDTCxhQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLSCxtQkFBeUI7QUFDL0IsUUFBSSxDQUFDLEtBQUs7QUFBa0I7QUFFNUIsVUFBTSxPQUFPLEtBQUssaUJBQWlCO0FBQ25DLFVBQU0sTUFBTSxPQUFPLG9CQUFvQjtBQUV2QyxTQUFLLGlCQUFpQixRQUFRLEtBQUssUUFBUTtBQUMzQyxTQUFLLGlCQUFpQixTQUFTLEtBQUssU0FBUztBQUU3QyxVQUFNLE1BQU0sS0FBSyxpQkFBaUIsV0FBVztBQUM3QyxRQUFJLEtBQUs7QUFDUCxVQUFJLE1BQU0sS0FBSztBQUFBO0FBQUE7QUFBQSxRQUlMLGlCQUFnQztBQUM1QyxRQUFJLEtBQUs7QUFBYTtBQUd0QixTQUFLO0FBRUwsUUFBSTtBQUNGLFlBQU0sS0FBSztBQUdYLFlBQU0sbUJBQW1CLE1BQU0sVUFBVSxZQUFZLE1BQU07QUFBQSxRQUN6RCxNQUFNO0FBQUE7QUFHUixVQUFJLGlCQUFpQixVQUFVLFVBQVU7QUFDdkMsY0FBTSxJQUFJLE1BQU07QUFBQTtBQUlsQixXQUFLLGlCQUFpQixNQUFNLEtBQUs7QUFFakMsWUFBTSxtQkFBMEM7QUFBQSxRQUM5QyxrQkFBa0I7QUFBQSxRQUNsQixrQkFBa0I7QUFBQSxRQUNsQixZQUFZO0FBQUEsUUFDWixjQUFjO0FBQUE7QUFHaEIsVUFBSSxLQUFLLE9BQU8sU0FBUyx1QkFBdUI7QUFDOUMsWUFBSTtBQUNGLGdCQUFNLFVBQVUsTUFBTSxVQUFVLGFBQWE7QUFDN0MsZ0JBQU0sa0JBQWtCLFFBQVEsS0FDOUIsQ0FBQyxXQUNDLE9BQU8sU0FBUyxnQkFDaEIsT0FBTyxhQUFhLEtBQUssT0FBTyxTQUFTO0FBRzdDLGNBQUksaUJBQWlCO0FBQ25CLDZCQUFpQixXQUFXO0FBQUEsY0FDMUIsT0FBTyxLQUFLLE9BQU8sU0FBUztBQUFBO0FBQUEsaUJBRXpCO0FBQ0wsaUJBQUssT0FBTyxTQUFTLHdCQUF3QjtBQUM3QyxrQkFBTSxLQUFLLE9BQU87QUFDbEIsb0JBQVEsSUFDTjtBQUFBO0FBQUEsaUJBR0csT0FBUDtBQUNBLGtCQUFRLE1BQU0sc0NBQXNDO0FBQUE7QUFBQTtBQUt4RCxXQUFLLGNBQWMsTUFBTSxVQUFVLGFBQWEsYUFBYTtBQUFBLFFBQzNELE9BQU87QUFBQTtBQUlULFdBQUssZ0JBQWdCLElBQUksY0FBYyxLQUFLLGFBQWE7QUFBQSxRQUN2RCxVQUFVLEtBQUssZUFBZTtBQUFBO0FBSWhDLFdBQUssU0FBUztBQUNkLFdBQUssY0FBYyxrQkFBa0IsT0FBTyxNQUFpQjtBQTlvQm5FO0FBK29CUSxZQUFJLEVBQUUsS0FBSyxPQUFPLEdBQUc7QUFDbkIsZUFBSyxPQUFPLEtBQUs7QUFBQSxZQUNmLE1BQU0sRUFBRTtBQUFBLFlBQ1IsWUFBWSxpQkFBSyxtQkFBTCxtQkFBcUIsZUFBckIsWUFBbUM7QUFBQTtBQUFBO0FBQUE7QUFNckQsV0FBSyxjQUFjLFNBQVMsWUFBWTtBQXhwQjlDO0FBeXBCUSxZQUFJO0FBRUYsZ0JBQU0sV0FBVyxLQUFLO0FBQ3RCLGdCQUFNLFdBQVcsR0FBRyxLQUFLLE9BQU8sU0FBUyx1QkFBdUI7QUFHaEUsZ0JBQU0sT0FBTyxJQUFJLEtBQ2YsS0FBSyxPQUFPLElBQUksQ0FBQyxVQUFVLE1BQU0sT0FDakMsRUFBRSxNQUFNLFdBQUssbUJBQUwsbUJBQXFCO0FBSS9CLGdCQUFNLGNBQWMsTUFBTSxLQUFLO0FBRy9CLGdCQUFNLEtBQUssT0FBTyxJQUFJLE1BQU0sUUFBUSxZQUNsQyxVQUNBO0FBSUYsZUFBSyx1QkFBdUI7QUFHNUIsZ0JBQU0sS0FBSztBQUFBLGlCQUNKLE9BQVA7QUFDQSxrQkFBUSxNQUFNLDZCQUE2QjtBQUMzQyxjQUFJLHlCQUFPO0FBQUE7QUFBQTtBQUtmLFdBQUssY0FBYyxNQUFNO0FBR3pCLFdBQUs7QUFFTCxXQUFLLGNBQWM7QUFDbkIsV0FBSztBQUdMLFVBQUksS0FBSyxrQkFBa0I7QUFDekIsYUFBSztBQUFBO0FBQUEsYUFFQSxPQUFQO0FBQ0EsY0FBUSxNQUFNLG9CQUFvQjtBQUNsQyxZQUFNLGVBQ0osaUJBQWlCLFFBQVEsTUFBTSxVQUFVO0FBQzNDLFlBQU07QUFBQTtBQUFBO0FBQUEsUUFJSSxnQkFBK0I7QUFDM0MsUUFBSSxDQUFDLEtBQUs7QUFBYTtBQUd2QixRQUFJLEtBQUssaUJBQWlCLEtBQUssY0FBYyxVQUFVLFlBQVk7QUFDakUsV0FBSyxjQUFjO0FBQUE7QUFJckIsUUFBSSxLQUFLLGFBQWE7QUFDcEIsV0FBSyxZQUFZLFlBQVksUUFBUSxDQUFDLFVBQVUsTUFBTTtBQUN0RCxXQUFLLGNBQWM7QUFBQTtBQUlyQixTQUFLO0FBR0wsUUFBSSxLQUFLLGdCQUFnQjtBQUN2QixXQUFLLGVBQWUsVUFBVSxPQUFPO0FBQUE7QUFHdkMsU0FBSyxnQkFBZ0I7QUFDckIsU0FBSyxjQUFjO0FBQ25CLFNBQUs7QUFBQTtBQUFBLEVBcUlQLFNBQVMsVUFBZ0Q7QUFDdkQsU0FBSyxrQkFBa0IsSUFBSTtBQUFBO0FBQUEsRUFHckIsa0JBQXdCO0FBQzlCLFNBQUssa0JBQWtCLFFBQVEsQ0FBQyxPQUFPLEdBQUcsS0FBSztBQUFBO0FBQUEsRUFHakQsU0FBZTtBQUNiLFNBQUs7QUFDTCxTQUFLLGtCQUFrQjtBQUFBO0FBQUE7OztBY3AzQjNCLHdCQVNPO0FBRVA7OztBQ1hBLHdCQUFvQztBQUNwQztBQUNBO0FBR0EseUJBQWdDO0FBQzlCLFNBQU8sdUNBQXVDLFFBQVEsU0FBUyxTQUFVLEdBQUc7QUFDMUUsVUFBTSxJQUFLLEtBQUssV0FBVyxLQUFNO0FBQ2pDLFVBQU0sSUFBSSxNQUFNLE1BQU0sSUFBSyxJQUFJLElBQU87QUFDdEMsV0FBTyxFQUFFLFNBQVM7QUFBQTtBQUFBO0FBU2YsMENBQW9DLHdCQUFNO0FBQUEsRUFRL0MsWUFBWSxLQUFVLFNBQXVDO0FBQzNELFVBQU07QUFIQSx3QkFBZTtBQUlyQixTQUFLLFVBQVU7QUFDZixTQUFLLFlBQVksb0JBQW9CLFlBQVksa0JBQWtCO0FBQUE7QUFBQSxFQUdyRSxTQUFTO0FBQ1AsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUNWLGNBQVUsU0FBUztBQUNuQixjQUFVLFNBQVM7QUFHbkIsVUFBTSxXQUFXLFVBQVUsVUFBVTtBQUNyQyxhQUFTLFNBQVMsTUFBTSxFQUFFLE1BQU07QUFHaEMsVUFBTSxjQUFjLFVBQVUsVUFBVTtBQUd4QyxVQUFNLGVBQWUsWUFBWSxVQUFVO0FBQzNDLFVBQU0sYUFBYSxhQUFhLFNBQVMsU0FBUztBQUFBLE1BQ2hELE1BQU07QUFBQTtBQUVSLFNBQUssWUFBWSxhQUFhLFNBQVMsWUFBWTtBQUFBLE1BQ2pELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQSxRQUNKLGFBQWE7QUFBQTtBQUFBO0FBS2pCLFVBQU0saUJBQWlCLFlBQVksVUFDakM7QUFFRixVQUFNLGVBQWUsZUFBZSxTQUFTLFNBQVMsRUFBRSxNQUFNO0FBQzlELFNBQUssY0FBYyxlQUFlLFVBQVU7QUFDNUMsU0FBSyxZQUFZLFFBQVEsS0FBSyxRQUFRO0FBR3RDLFVBQU0sV0FBVyxVQUFVLFVBQVU7QUFFckMsVUFBTSxlQUFlLFNBQVMsU0FBUyxVQUFVO0FBQUEsTUFDL0MsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBO0FBRVIsaUJBQWEsaUJBQWlCLFNBQVMsTUFBTSxLQUFLO0FBRWxELFNBQUssZUFBZSxTQUFTLFNBQVMsVUFBVTtBQUFBLE1BQzlDLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLFNBQUssYUFBYSxpQkFBaUIsU0FBUyxNQUFNLEtBQUs7QUFHdkQsU0FBSyxVQUFVO0FBQUE7QUFBQSxRQUdILGVBQWU7QUFDM0IsUUFBSSxLQUFLLGdCQUFnQixDQUFDLEtBQUssVUFBVSxNQUFNO0FBQVE7QUFFdkQsUUFBSTtBQUNGLFdBQUssZUFBZTtBQUNwQixXQUFLLGFBQWEsV0FBVztBQUM3QixxQ0FBUSxLQUFLLGNBQWM7QUFDM0IsV0FBSyxhQUFhLFNBQVM7QUFHM0IsWUFBTSxlQUFlLEtBQUssVUFBVSxNQUFNO0FBQzFDLFlBQU0sZUFBZSxLQUFLLFFBQVE7QUFHbEMsVUFBSSxlQUFlO0FBR25CLHVCQUFpQixTQUFTLEtBQUssVUFBVSxjQUFjO0FBQUEsUUFDckQsVUFBVTtBQUFBLFVBQ1IsRUFBRSxNQUFNLFFBQVEsU0FBUyxjQUFjLFlBQVk7QUFBQSxVQUNuRCxFQUFFLE1BQU0sUUFBUSxTQUFTLGNBQWMsWUFBWTtBQUFBO0FBQUEsUUFFckQsT0FBTztBQUFBLFFBQ1Asa0JBQWtCO0FBQUEsUUFDbEIsU0FBUyxDQUFDLFVBQVU7QUFDbEIsNkJBQW1CLDBCQUEwQixTQUFTO0FBQUE7QUFBQSxVQUV0RDtBQUNGLHdCQUFnQjtBQUNoQixhQUFLLFlBQVksUUFBUTtBQUFBO0FBSTNCLFdBQUssUUFBUSxTQUFTO0FBQ3RCLFdBQUs7QUFBQSxhQUNFLE9BQVA7QUFDQSxjQUFRLE1BQU0sNkJBQTZCO0FBQzNDLHlCQUFtQiw0Q0FBNEM7QUFBQSxjQUMvRDtBQUNBLFdBQUssZUFBZTtBQUNwQixXQUFLLGFBQWEsV0FBVztBQUM3QixXQUFLLGFBQWE7QUFDbEIsV0FBSyxhQUFhLFFBQVE7QUFDMUIsV0FBSyxhQUFhLFlBQVk7QUFBQTtBQUFBO0FBQUEsRUFJbEMsVUFBVTtBQUNSLFVBQU0sRUFBRSxjQUFjO0FBQ3RCLGNBQVU7QUFBQTtBQUFBOzs7QURoSFAsb0NBQThCO0FBQUEsRUFXbkMsWUFDRSxLQUNBLGVBQ0EsUUFDQTtBQVhNLHlCQUFvQztBQUNwQyx5QkFBb0M7QUFDcEMsdUJBQWtDO0FBQ2xDLDBCQUFxQztBQUNyQywyQkFBc0M7QUFRNUMsU0FBSyxNQUFNO0FBQ1gsU0FBSyxnQkFBZ0I7QUFDckIsU0FBSyxTQUFTO0FBQ2QsU0FBSyx1QkFBdUIscUJBQXFCLFlBQVk7QUFDN0QsU0FBSztBQUNMLFNBQUs7QUFBQTtBQUFBLEVBR0Msc0JBQXNCO0FBQzVCLFNBQUssZ0JBQWdCLEtBQUssSUFBSSxVQUFVLFlBQVksVUFBVTtBQUFBLE1BQzVELEtBQUs7QUFBQTtBQUVQLFNBQUssY0FBYyxNQUFNLFVBQVU7QUFBQTtBQUFBLEVBRzdCLHNCQUFzQjtBQUU1QixTQUFLLElBQUksVUFBVSxHQUFHLGVBQWUsQ0FBQyxNQUFNLFFBQVEsU0FBUztBQUMzRCxVQUFJLENBQUUsaUJBQWdCO0FBQWU7QUFFckMsWUFBTSxZQUFZLE9BQU87QUFDekIsVUFBSSxDQUFDO0FBQVc7QUFFaEIsV0FBSyxRQUFRLENBQUMsU0FBUztBQUNyQixhQUNHLFNBQVMsOEJBQ1QsUUFBUSxRQUNSLFFBQVEsWUFBWTtBQUNuQixnQkFBTSxRQUFRLElBQUksc0JBQXNCLEtBQUssS0FBSztBQUFBLFlBQ2hELGFBQWE7QUFBQSxZQUNiLFVBQVUsQ0FBQyxpQkFBaUI7QUFDMUIscUJBQU8saUJBQWlCO0FBQUE7QUFBQTtBQUc1QixnQkFBTTtBQUFBO0FBQUE7QUFBQTtBQU1kLFNBQUssSUFBSSxVQUFVLEdBQUcsYUFBYSxDQUFDLE1BQU0sU0FBUztBQUNqRCxVQUFJLENBQUUsaUJBQWdCO0FBQVE7QUFFOUIsWUFBTSxZQUFZLEtBQUssVUFBVTtBQUdqQyxVQUVFLENBQUMsTUFBTSxPQUFPLFlBQVksU0FBUyxjQUVuQyxDQUFDLE9BQU8sT0FBTyxRQUFRLE9BQU8sUUFBUSxPQUFPLFFBQVEsU0FDbkQsY0FHRixDQUFDLE9BQU8sT0FBTyxPQUFPLE9BQU8sUUFBUSxTQUFTLGNBRTlDLENBQUMsT0FBTyxRQUFRLE9BQU8sT0FBTyxRQUFRLE9BQU8sU0FBUyxZQUN0RDtBQUNBLGFBQUssUUFBUSxDQUFDLFNBQVM7QUFDckIsZUFDRyxTQUFTLGlDQUNULFFBQVEsa0JBQ1IsUUFBUSxZQUFZO0FBQ25CLGdCQUFJO0FBQ0Ysb0JBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxRQUFRO0FBQ3hDLG9CQUFNLE9BQU8sSUFBSSxTQUFTLE1BQU0sS0FBSztBQUNyQyxvQkFBTSxLQUFLLEtBQUs7QUFDaEIsb0JBQU0sSUFBSSxRQUFRLENBQUMsWUFBWSxXQUFXLFNBQVM7QUFDbkQsbUJBQUssSUFBSSxVQUFVLGNBQWMsTUFBTSxFQUFFLE9BQU87QUFDaEQsb0JBQU0sS0FBSyxpQkFBaUI7QUFBQSxxQkFDckIsT0FBUDtBQUNBLGtCQUFJLHlCQUFPO0FBQ1gsc0JBQVEsTUFBTSxvQkFBb0I7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU81QyxVQUNFLEtBQUssY0FBYyxTQUNuQixLQUFLLGNBQWMsU0FDbkIsS0FBSyxjQUFjLFFBQ25CO0FBQ0EsYUFBSyxRQUFRLENBQUMsU0FBUztBQUNyQixlQUNHLFNBQVMsbUNBQ1QsUUFBUSxjQUNSLFFBQVEsWUFBWTtBQUNuQixnQkFBSTtBQUNGLG9CQUFNLEtBQUsseUJBQXlCLE1BQU07QUFBQSxxQkFDbkMsT0FBUDtBQUNBLGtCQUFJLHlCQUFPO0FBQ1gsc0JBQVEsTUFBTSx3QkFBd0I7QUFBQTtBQUFBO0FBQUE7QUFNOUMsYUFBSyxRQUFRLENBQUMsU0FBUztBQUNyQixlQUNHLFNBQVMsaURBQ1QsUUFBUSxTQUNSLFFBQVEsWUFBWTtBQUNuQixnQkFBSTtBQUNGLG9CQUFNLEtBQUsseUJBQXlCLE1BQU07QUFBQSxxQkFDbkMsT0FBUDtBQUNBLGtCQUFJLHlCQUFPO0FBQ1gsc0JBQVEsTUFBTSxvQ0FBb0M7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU81RCxVQUNFLEtBQUssY0FBYyxTQUNuQixLQUFLLGNBQWMsVUFDbkIsS0FBSyxjQUFjLE9BQ25CO0FBQ0EsYUFBSyxRQUFRLENBQUMsU0FBUztBQUNyQixlQUNHLFNBQVMsc0NBQ1QsUUFBUSxhQUNSLFFBQVEsWUFBWTtBQUNuQixnQkFBSTtBQUNGLG9CQUFNLEtBQUsseUJBQXlCO0FBQUEscUJBQzdCLE9BQVA7QUFDQSxrQkFBSSx5QkFBTztBQUNYLHNCQUFRLE1BQU0sOEJBQThCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFRNUMseUJBQXlCLE1BQWE7QUFDbEQsU0FBSztBQUNMLFNBQUssb0JBQW9CLEdBQUcsK0JBQStCO0FBRTNELFFBQUk7QUFFRixZQUFNLEtBQUssTUFBTTtBQUdqQixXQUFLLG9CQUFvQixJQUFJLHlCQUF5QjtBQUd0RCxZQUFNLEVBQUUsWUFBWSxRQUFRLFdBQzFCLE1BQU0sS0FBSyxjQUFjLGVBQWU7QUFFMUMsVUFBSSxRQUFRO0FBQ1YsYUFBSyxvQkFBb0IsSUFBSSx3QkFBd0I7QUFDckQsY0FBTSxrQkFBaUIsTUFBTSxLQUFLLG1CQUFtQjtBQUNyRCxjQUFNLGtCQUFpQixNQUFNLEtBQUssc0JBQ2hDLE1BQ0E7QUFFRixhQUFLLG9CQUFvQixLQUFLLHdCQUF3QjtBQUN0RCxhQUFLLHNCQUFzQjtBQUMzQjtBQUFBO0FBR0YsV0FBSyxvQkFBb0IsSUFBSSwwQkFBMEI7QUFHdkQsWUFBTSxhQUFhLE1BQU0sS0FBSyxrQkFBa0I7QUFFaEQsVUFBSSxDQUFDLFlBQVk7QUFDZixhQUFLLG9CQUFvQixHQUFHLHlCQUF5QjtBQUNyRCxjQUFNLEtBQUssTUFBTTtBQUNqQixhQUFLO0FBQ0w7QUFBQTtBQUdGLFdBQUssb0JBQW9CLElBQUksMEJBQTBCO0FBR3ZELFlBQU0saUJBQWlCLE1BQU0sS0FBSyxtQkFBbUI7QUFDckQsWUFBTSxpQkFBaUIsTUFBTSxLQUFLLHNCQUNoQyxNQUNBO0FBR0YsV0FBSyxvQkFBb0IsS0FBSyx3QkFBd0I7QUFDdEQsV0FBSyxzQkFBc0I7QUFBQSxhQUNwQixHQUFQO0FBQ0EsY0FBUSxNQUFNLHNCQUFzQjtBQUNwQyxXQUFLLG9CQUNILEdBQ0EsVUFBVSxhQUFhLFFBQVEsRUFBRSxVQUFVLE9BQU8sTUFDbEQ7QUFFRixZQUFNLEtBQUssTUFBTTtBQUNqQixXQUFLO0FBQUE7QUFBQTtBQUFBLFFBSUsseUJBQ1osTUFDQSxhQUNlO0FBQ2YsUUFBSTtBQUNGLFlBQU0sNEJBQTRCLEtBQUssS0FBSztBQUFBLFFBQzFDO0FBQUEsUUFDQTtBQUFBLFFBQ0EsUUFBUSxLQUFLO0FBQUEsUUFDYix5QkFBeUIsT0FBTyxTQUFpQjtBQXJQekQ7QUF1UFUsZ0JBQU0sV0FBVyxLQUFLO0FBQ3RCLGdCQUFNLGdCQUFnQixjQUFjLFFBQVE7QUFDNUMsZ0JBQU0sYUFBYSxHQUNqQixZQUFLLFdBQUwsbUJBQWEsU0FBUSxNQUNuQixZQUFZO0FBR2hCLGdCQUFNLFVBQVUsY0FBYyxPQUFPO0FBR3JDLGNBQUk7QUFDSixnQkFBTSxlQUFlLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUMxRCxjQUFJLHdCQUF3Qix5QkFBTztBQUNqQyxrQkFBTSxLQUFLLElBQUksTUFBTSxPQUFPLGNBQWM7QUFDMUMsZ0NBQW9CO0FBQUEsaUJBQ2Y7QUFDTCxnQ0FBb0IsTUFBTSxLQUFLLElBQUksTUFBTSxPQUN2QyxZQUNBO0FBQUE7QUFLSixnQkFBTSxPQUFPLEtBQUssSUFBSSxVQUFVLFFBQVE7QUFDeEMsZ0JBQU0sS0FBSyxTQUFTO0FBQ3BCLGVBQUssSUFBSSxVQUFVLGNBQWMsTUFBTSxFQUFFLE9BQU87QUFBQTtBQUFBO0FBQUEsYUFHN0MsT0FBUDtBQUNBLGNBQVEsTUFBTSw4QkFBOEI7QUFDNUMsWUFBTTtBQUFBO0FBQUE7QUFBQSxFQUlGLE1BQU0sSUFBMkI7QUFDdkMsV0FBTyxJQUFJLFFBQVEsQ0FBQyxZQUFZLFdBQVcsU0FBUztBQUFBO0FBQUEsRUFHOUMsc0JBQXNCO0FBQzVCLFFBQUksS0FBSztBQUFlO0FBRXhCLFNBQUssZ0JBQWdCLFNBQVMsY0FBYztBQUM1QyxTQUFLLGNBQWMsWUFBWTtBQUUvQixTQUFLLGNBQWMsS0FBSyxjQUFjLFVBQ3BDO0FBRUYsU0FBSyxpQkFBaUIsS0FBSyxjQUFjLFVBQ3ZDO0FBRUYsU0FBSyxrQkFBa0IsS0FBSyxjQUFjLFVBQ3hDO0FBR0YsYUFBUyxLQUFLLFlBQVksS0FBSztBQUFBO0FBQUEsRUFHekIsb0JBQW9CLFVBQWtCLFFBQWdCLE1BQWM7QUFDMUUsUUFBSSxDQUFDLEtBQUssaUJBQWlCLENBQUMsS0FBSyxlQUFlLENBQUMsS0FBSztBQUNwRDtBQUVGLFNBQUssWUFBWSxNQUFNLFFBQVEsR0FBRztBQUNsQyxTQUFLLGVBQWU7QUFDcEIsbUNBQVEsS0FBSyxnQkFBZ0I7QUFDN0IsU0FBSyxlQUFlLFdBQVcsRUFBRSxNQUFNO0FBQUE7QUFBQSxFQUdqQyxzQkFBc0IsZ0JBQXdCO0FBQ3BELFFBQUksQ0FBQyxLQUFLO0FBQWlCO0FBRTNCLFNBQUssZ0JBQWdCO0FBR3JCLFVBQU0sYUFBYSxLQUFLLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxNQUN6RCxNQUFNO0FBQUEsTUFDTixLQUFLO0FBQUE7QUFFUCxlQUFXLGlCQUFpQixTQUFTLFlBQVk7QUFDL0MsWUFBTSxPQUFPLEtBQUssSUFBSSxNQUFNLHNCQUFzQjtBQUNsRCxVQUFJLGdCQUFnQix5QkFBTztBQUN6QixjQUFNLEtBQUssSUFBSSxVQUFVLFVBQVUsU0FBUztBQUFBO0FBRTlDLFdBQUs7QUFBQTtBQUlQLFVBQU0sY0FBYyxLQUFLLGdCQUFnQixTQUFTLFVBQVU7QUFBQSxNQUMxRCxNQUFNO0FBQUE7QUFFUixnQkFBWSxpQkFBaUIsU0FBUyxNQUFNO0FBQzFDLFdBQUs7QUFBQTtBQUFBO0FBQUEsRUFJRCxxQkFBcUI7QUFDM0IsUUFBSSxLQUFLLGlCQUFpQixLQUFLLGNBQWMsWUFBWTtBQUN2RCxXQUFLLGNBQWMsV0FBVyxZQUFZLEtBQUs7QUFBQTtBQUVqRCxTQUFLLGdCQUFnQjtBQUNyQixTQUFLLGNBQWM7QUFDbkIsU0FBSyxpQkFBaUI7QUFDdEIsU0FBSyxrQkFBa0I7QUFBQTtBQUFBLFFBR1gsa0JBQ1osWUFDQSxjQUFjLElBQ0k7QUFDbEIsYUFBUyxJQUFJLEdBQUcsSUFBSSxhQUFhLEtBQUs7QUFDcEMsWUFBTSxXQUFXLE1BQU0sTUFDckIsR0FDRSxLQUFLLGNBQWMsVUFDbEIsMkJBQTJCLFVBQVUsSUFBSSxlQUM1QztBQUFBLFFBQ0UsU0FBUztBQUFBLFVBQ1AsZ0JBQWdCO0FBQUE7QUFBQTtBQUt0QixVQUFJLENBQUMsU0FBUyxJQUFJO0FBQ2hCLGNBQU0sSUFBSSxNQUFNLDJCQUEyQixTQUFTO0FBQUE7QUFHdEQsWUFBTSxPQUFPLE1BQU0sU0FBUztBQUM1QixVQUFJLEtBQUssV0FBVyxhQUFhO0FBQy9CLGVBQU87QUFBQSxpQkFDRSxLQUFLLFdBQVcsVUFBVTtBQUNuQyxjQUFNLElBQUksTUFBTSxLQUFLLFNBQVM7QUFBQTtBQUloQyxZQUFNLFdBQVcsS0FBSyxJQUFJLEtBQU0sSUFBSSxjQUFlLElBQUk7QUFDdkQsV0FBSyxvQkFBb0IsVUFBVSwwQkFBMEI7QUFFN0QsWUFBTSxLQUFLLE1BQU07QUFBQTtBQUduQixXQUFPO0FBQUE7QUFBQSxRQUdLLG1CQUFtQixZQUFrQztBQUNqRSxVQUFNLFdBQVcsTUFBTSxNQUNyQixHQUNFLEtBQUssY0FBYyxVQUNsQiwyQkFBMkIsVUFBVSxTQUFTLGVBQ2pEO0FBQUEsTUFDRSxTQUFTO0FBQUEsUUFDUCxnQkFBZ0I7QUFBQTtBQUFBO0FBS3RCLFFBQUksQ0FBQyxTQUFTLElBQUk7QUFDaEIsWUFBTSxJQUFJLE1BQU0sa0NBQWtDLFNBQVM7QUFBQTtBQUc3RCxXQUFPLFNBQVM7QUFBQTtBQUFBLFFBR0osc0JBQXNCLE1BQWEsTUFBNEI7QUF2Wi9FO0FBd1pJLFVBQU0sbUJBQW1CLEtBQUssY0FBYztBQUM1QyxVQUFNLFdBQVcsS0FBSyxpQkFBaUIsS0FBSztBQUM1QyxVQUFNLGFBQWEsbUJBQ2YsR0FBRyxvQkFBb0IsYUFDdkIsR0FBRyxZQUFLLFdBQUwsbUJBQWEsU0FBUSxNQUFNO0FBR2xDLFVBQU0sS0FBSyxhQUFhO0FBR3hCLFVBQU0saUJBQWlCLEtBQUssY0FDMUIsR0FBRyxjQUFjO0FBSW5CLFVBQU0sVUFBVSxLQUFLLHdCQUF3QjtBQUM3QyxVQUFNLGVBQWUsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBQzFELFFBQUksd0JBQXdCLHlCQUFPO0FBQ2pDLFlBQU0sS0FBSyxJQUFJLE1BQU0sT0FBTyxjQUFjO0FBQUEsV0FDckM7QUFDTCxZQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sZ0JBQWdCO0FBQUE7QUFHOUMsV0FBTztBQUFBO0FBQUEsRUFHRCxpQkFBaUIsVUFBMEI7QUFDakQsV0FBTyxTQUFTLFFBQVEsb0JBQW9CO0FBQUE7QUFBQSxFQUd0QyxjQUFjLE1BQXNCO0FBQzFDLFdBQU8sS0FBSyxRQUFRLE9BQU8sS0FBSyxRQUFRLFFBQVE7QUFBQTtBQUFBLFFBR3BDLGFBQWEsTUFBNkI7QUFDdEQsVUFBTSxpQkFBaUIsS0FBSyxjQUFjO0FBQzFDLFFBQ0UsQ0FBRSxNQUFLLElBQUksTUFBTSxzQkFBc0IsMkJBQTJCLDRCQUNsRTtBQUNBLFlBQU0sS0FBSyxJQUFJLE1BQU0sYUFBYTtBQUFBO0FBQUE7QUFBQSxFQUk5Qix3QkFBd0IsTUFBbUI7QUFDakQsV0FBTyxLQUFLLEtBQUssU0FBUztBQUFBO0FBQUEsRUFFNUIsS0FBSyxXQUFXO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUVuY1gsNEJBQXNCO0FBQUEsRUFJM0IsWUFBWSxRQUE0QjtBQUN0QyxTQUFLLFNBQVM7QUFDZCxTQUFLLFdBQVc7QUFBQTtBQUFBLFFBR1osZUFBZTtBQUNuQixVQUFNLGFBQWEsTUFBTSxLQUFLLE9BQU87QUFDckMsU0FBSyxXQUFXLE9BQU8sT0FBTyxJQUFJLGtCQUFrQjtBQUdwRCxRQUFJLEtBQUssU0FBUyxpQkFBaUI7QUFDakMsV0FBSyxTQUFTLFlBQVk7QUFBQSxXQUNyQjtBQUNMLFdBQUssU0FBUyxZQUFZO0FBQUE7QUFBQTtBQUFBLFFBSXhCLGVBQWU7QUFDbkIsVUFBTSxLQUFLLE9BQU8sU0FBUyxLQUFLO0FBQ2hDLFNBQUssT0FBTyxVQUFVLGVBQWUsS0FBSztBQUFBO0FBQUEsRUFHNUMsY0FBb0M7QUFDbEMsV0FBTyxLQUFLO0FBQUE7QUFBQSxRQUdSLGVBQWUsYUFBNEM7QUFFL0QsUUFBSSxZQUFZLG9CQUFvQixRQUFXO0FBQzdDLGtCQUFZLFlBQVksWUFBWSxrQkFDaEMsMEJBQ0E7QUFBQTtBQUVOLFNBQUssV0FBVyxLQUFLLEtBQUssYUFBYTtBQUN2QyxVQUFNLEtBQUs7QUFBQTtBQUFBOzs7QUNyQ1IsMkJBQXFCO0FBQUEsRUFJMUIsWUFBWSxRQUE0QixLQUFVO0FBQ2hELFNBQUssU0FBUztBQUNkLFNBQUssTUFBTTtBQUFBO0FBQUEsUUFHUCxtQkFBbUIsUUFBUSxPQUF5QjtBQUN4RCxRQUFJLENBQUMsS0FBSyxPQUFPLFNBQVMsWUFBWTtBQUNwQyxXQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLFlBQU0sS0FBSyxPQUFPO0FBQ2xCLGFBQU87QUFBQTtBQUdULFFBQUk7QUFDRixZQUFNLFVBQVUsTUFBTSxLQUFLLE9BQU8sVUFBVSxnQkFBZ0I7QUFDNUQsV0FBSyxPQUFPLFNBQVMsZUFBZTtBQUNwQyxZQUFNLEtBQUssT0FBTztBQUNsQixhQUFPO0FBQUEsYUFDQSxPQUFQO0FBQ0EsY0FBUSxNQUFNLDZCQUE2QjtBQUMzQyxXQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLFlBQU0sS0FBSyxPQUFPO0FBQ2xCLGFBQU87QUFBQTtBQUFBO0FBQUE7OztBQzdCYix3QkFBb0Q7QUFFcEQ7QUFFTyxpQ0FBMkIsd0JBQU07QUFBQSxFQUd0QyxZQUFZLEtBQVUsUUFBNEI7QUFDaEQsVUFBTTtBQUNOLFNBQUssU0FBUztBQUFBO0FBQUEsRUFHUixjQUFjLE9BQXdCO0FBQzVDLFVBQU0sYUFBYSxNQUFNLE9BQU8sQ0FBQyxLQUFLLFNBQVMsTUFBTSxLQUFLLEtBQUssTUFBTTtBQUNyRSxRQUFJLGVBQWUsR0FBRztBQUNwQixhQUFPO0FBQUEsZUFDRSxhQUFhLE1BQU07QUFDNUIsYUFBTyxHQUFHO0FBQUEsZUFDRCxhQUFhLE9BQU8sTUFBTTtBQUNuQyxhQUFPLEdBQUksY0FBYSxNQUFNLFFBQVE7QUFBQSxlQUM3QixhQUFhLE9BQU8sT0FBTyxNQUFNO0FBQzFDLGFBQU8sR0FBSSxjQUFjLFFBQU8sT0FBTyxRQUFRO0FBQUEsV0FDMUM7QUFDTCxhQUFPLEdBQUksY0FBYyxRQUFPLE9BQU8sT0FBTyxRQUFRO0FBQUE7QUFBQTtBQUFBLEVBSWxELG9CQUFvQixXQUE0QjtBQUN0RCxXQUFPLEtBQUssSUFBSSxNQUNiLFdBQ0EsT0FBTyxDQUFDLFNBQVMsS0FBSyxLQUFLLFdBQVc7QUFBQTtBQUFBLEVBR25DLGNBQWMsUUFBMkI7QUFDL0MsV0FBTyxXQUFXO0FBQ2xCLFdBQU8sU0FBUztBQUNoQixXQUFPLFlBQVk7QUFBQTtBQUFBLEVBR2Isa0JBQ04sUUFDQSxPQUNBLE1BQ0E7QUFDQSxVQUFNLE9BQU8sS0FBSyxjQUFjO0FBQ2hDLFVBQU0sV0FBVyxNQUFNLFNBQVM7QUFFaEMsUUFBSSxVQUFVO0FBQ1osYUFBTyxXQUFXO0FBQ2xCLGFBQU8sWUFBWTtBQUNuQixhQUFPLFNBQVM7QUFDaEIsYUFBTyxRQUFRLGFBQWEsU0FBUztBQUFBLFdBQ2hDO0FBQ0wsYUFBTyxXQUFXO0FBQ2xCLGFBQU8sU0FBUztBQUNoQixhQUFPLFlBQVk7QUFDbkIsYUFBTyxRQUFRLE1BQU07QUFBQTtBQUFBO0FBQUEsUUFJWCxlQUFlLFdBQWtDO0FBRTdELFFBQ0UsQ0FBQyxhQUNELGNBQWMsT0FDZCxjQUFjLE9BQ2QsY0FBYyxNQUNkO0FBQ0EsWUFBTSxJQUFJLE1BQU07QUFBQTtBQUlsQixVQUFNLFFBQVEsS0FBSyxvQkFBb0I7QUFHdkMsZUFBVyxRQUFRLE9BQU87QUFDeEIsWUFBTSxLQUFLLElBQUksTUFBTSxNQUFNLE1BQU07QUFBQTtBQUluQyxVQUFNLFNBQVMsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBQ3BELFFBQUksa0JBQWtCLDJCQUFTO0FBRTdCLFlBQU0sVUFBVSxPQUFPLFNBQ3BCLE9BQU8sQ0FBQyxVQUE0QixpQkFBaUIsMkJBQ3JELEtBQUssQ0FBQyxHQUFHLE1BQU0sRUFBRSxLQUFLLFNBQVMsRUFBRSxLQUFLO0FBR3pDLGlCQUFXLFVBQVUsU0FBUztBQUM1QixZQUFJLE9BQU8sU0FBUyxXQUFXLEdBQUc7QUFDaEMsZ0JBQU0sS0FBSyxJQUFJLE1BQU0sTUFBTSxRQUFRO0FBQUE7QUFBQTtBQUt2QyxVQUFJLE9BQU8sU0FBUyxXQUFXLEdBQUc7QUFDaEMsY0FBTSxLQUFLLElBQUksTUFBTSxNQUFNLFFBQVE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtqQyxnQkFBZ0IsT0FBZ0IsTUFBMkI7QUFyR3JFO0FBc0dJLFVBQU0sWUFBWSxTQUFTLGNBQWM7QUFDekMsY0FBVSxZQUFZO0FBR3RCLFVBQU0sVUFBVSxTQUFTLGNBQWM7QUFDdkMsWUFBUSxZQUFZO0FBQ3BCLFlBQVEsY0FBYyxHQUFHLE1BQU0sVUFBVSxTQUFTLEtBQUssY0FDckQ7QUFFRixjQUFVLFlBQVk7QUFHdEIsVUFBTSxjQUFjLE1BQU0sS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLEtBQUssY0FBYyxFQUFFO0FBR2hFLFVBQU0sYUFBYSxJQUFJO0FBQ3ZCLGVBQVcsUUFBUSxhQUFhO0FBQzlCLFlBQU0sTUFBTSxZQUFLLFdBQUwsbUJBQWEsU0FBUTtBQUNqQyxVQUFJLENBQUMsV0FBVyxJQUFJLE1BQU07QUFDeEIsbUJBQVcsSUFBSSxLQUFLO0FBQUE7QUFFdEIsdUJBQVcsSUFBSSxTQUFmLG1CQUFxQixLQUFLO0FBQUE7QUFJNUIsZUFBVyxDQUFDLEtBQUssYUFBYSxZQUFZO0FBQ3hDLFVBQUksS0FBSztBQUNQLGNBQU0sWUFBWSxTQUFTLGNBQWM7QUFDekMsa0JBQVUsWUFBWTtBQUV0QixjQUFNLGNBQWMsU0FBUyxjQUFjO0FBQzNDLG9CQUFZLFlBQVk7QUFDeEIsdUNBQVEsYUFBYTtBQUNyQixvQkFBWSxXQUFXLEVBQUUsTUFBTTtBQUMvQixrQkFBVSxZQUFZO0FBRXRCLGNBQU0sZ0JBQWdCLFNBQVMsY0FBYztBQUM3QyxzQkFBYyxZQUFZO0FBQzFCLGtCQUFVLFlBQVk7QUFFdEIsbUJBQVcsUUFBUSxVQUFVO0FBQzNCLHdCQUFjLFlBQVksS0FBSyxlQUFlO0FBQUE7QUFHaEQsa0JBQVUsWUFBWTtBQUFBLGFBQ2pCO0FBRUwsbUJBQVcsUUFBUSxVQUFVO0FBQzNCLG9CQUFVLFlBQVksS0FBSyxlQUFlO0FBQUE7QUFBQTtBQUFBO0FBS2hELFdBQU87QUFBQTtBQUFBLEVBR0QsZUFBZSxNQUEwQjtBQUMvQyxVQUFNLFVBQVUsU0FBUyxjQUFjO0FBQ3ZDLFlBQVEsWUFBWTtBQUVwQixVQUFNLFlBQVksU0FBUyxjQUFjO0FBQ3pDLGNBQVUsWUFBWTtBQUd0QixVQUFNLFlBQVksS0FBSyxVQUFVO0FBQ2pDLFFBQUksV0FBVztBQUNmLFFBQUksQ0FBQyxNQUFNLE9BQU8sWUFBWSxTQUFTLFlBQVk7QUFDakQsaUJBQVc7QUFBQSxlQUVYLENBQUMsT0FBTyxRQUFRLE9BQU8sT0FBTyxRQUFRLE9BQU8sU0FBUyxZQUN0RDtBQUNBLGlCQUFXO0FBQUEsZUFDRixDQUFDLE9BQU8sT0FBTyxPQUFPLE9BQU8sU0FBUyxZQUFZO0FBQzNELGlCQUFXO0FBQUEsZUFDRixDQUFDLE9BQU8sU0FBUyxZQUFZO0FBQ3RDLGlCQUFXO0FBQUE7QUFFYixtQ0FBUSxXQUFXO0FBR25CLGNBQVUsV0FBVyxFQUFFLE1BQU0sS0FBSztBQUdsQyxVQUFNLFdBQVcsU0FBUyxjQUFjO0FBQ3hDLGFBQVMsWUFBWTtBQUNyQixhQUFTLGNBQWMsS0FBSyxjQUFjLENBQUM7QUFDM0MsY0FBVSxZQUFZO0FBRXRCLFlBQVEsWUFBWTtBQUNwQixXQUFPO0FBQUE7QUFBQSxRQUdLLHVCQUNaLE9BQ0EsTUFDQSxXQUNBLFFBQ0E7QUFDQSxVQUFNLGVBQWUsSUFBSSx3QkFBTSxLQUFLO0FBQ3BDLGlCQUFhLFFBQVEsUUFBUSxTQUFTO0FBRXRDLFVBQU0sVUFBVSxhQUFhO0FBQzdCLFlBQVEsVUFBVTtBQUFBLE1BQ2hCLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUlSLFlBQVEsWUFBWSxLQUFLLGdCQUFnQixPQUFPO0FBR2hELFVBQU0sa0JBQWtCLFFBQVEsVUFBVTtBQUFBLE1BQ3hDLEtBQUs7QUFBQTtBQUdQLFVBQU0sZUFBZSxnQkFBZ0IsU0FBUyxVQUFVLEVBQUUsTUFBTTtBQUNoRSxpQkFBYSxpQkFBaUIsU0FBUyxNQUFNLGFBQWE7QUFFMUQsVUFBTSxnQkFBZ0IsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLE1BQ3ZELEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLGtCQUFjLGlCQUFpQixTQUFTLFlBQVk7QUFDbEQsVUFBSTtBQUNGLGNBQU0sS0FBSyxlQUFlO0FBQzFCLGFBQUssY0FBYztBQUNuQixlQUFPLFFBQVEsTUFBTTtBQUVyQixrQkFDRSxLQUFLLEtBQ0wsc0JBQ0UsTUFBTSxVQUNKLEtBQUssd0JBQXdCLEtBQUssY0FDcEMsb0JBRUYsRUFBRSxPQUFPO0FBQUEsZUFFSixPQUFQO0FBQ0EsZ0JBQVEsTUFBTSxrQkFBa0IsS0FBSyxrQkFBa0I7QUFDdkQsa0JBQVUsS0FBSyxLQUFLLG1CQUFtQixLQUFLLGlCQUFpQjtBQUFBLFVBQzNELE9BQU87QUFBQTtBQUFBO0FBR1gsbUJBQWE7QUFBQTtBQUdmLGlCQUFhO0FBQUE7QUFBQSxRQUdELFlBQVksTUFBK0I7QUFFdkQsUUFBSSxLQUFLLEtBQUssU0FBUztBQUFHLGFBQU87QUFFakMsVUFBTSxZQUFZLEtBQUssVUFBVTtBQUdqQyxRQUFJLENBQUMsTUFBTSxPQUFPLFlBQVksU0FBUyxZQUFZO0FBQ2pELFlBQU0sVUFBVSxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUs7QUFFMUMsWUFBTSw0QkFBNEIsUUFDL0IsUUFBUSxtQkFBbUIsSUFDM0I7QUFDSCxhQUFPLENBQUM7QUFBQTtBQUlWLFFBQ0U7QUFBQSxNQUNFO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQSxTQUFTLFlBQ1g7QUFDQSxhQUFPLEtBQUssS0FBSyxTQUFTO0FBQUE7QUFJNUIsUUFBSSxLQUFLLEtBQUssU0FBUyxrQkFBa0I7QUFDdkMsWUFBTSxVQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSztBQUMxQyxZQUFNLGlCQUFpQixDQUFDLFFBQVEsUUFBUSxXQUFXLElBQUk7QUFDdkQsWUFBTSxrQkFDSixRQUFRLFNBQVMsdUJBQ2pCLFFBQVEsU0FBUztBQUNuQixhQUFPLGtCQUFrQjtBQUFBO0FBRzNCLFdBQU87QUFBQTtBQUFBLFFBR0ssZ0JBQWtDO0FBQzlDLFVBQU0sV0FBVyxLQUFLLElBQUksTUFBTTtBQUNoQyxVQUFNLGFBQXNCO0FBRTVCLGVBQVcsUUFBUSxVQUFVO0FBQzNCLFVBQUksTUFBTSxLQUFLLFlBQVksT0FBTztBQUNoQyxtQkFBVyxLQUFLO0FBQUE7QUFBQTtBQUlwQixXQUFPO0FBQUE7QUFBQSxRQUdLLGtCQUFzQztBQUNsRCxVQUFNLGVBQTBCO0FBQ2hDLFVBQU0sY0FBYyxDQUFDLFdBQTZCO0FBRWhELFlBQU0sc0JBQXNCLE9BQU8sU0FBUyxLQUFLLENBQUMsVUFBVTtBQUMxRCxZQUFJLGlCQUFpQix5QkFBTztBQUMxQixpQkFBTyxNQUFNLEtBQUssT0FBTztBQUFBO0FBRTNCLFlBQUksaUJBQWlCLDJCQUFTO0FBQzVCLGlCQUFPLENBQUMsWUFBWTtBQUFBO0FBRXRCLGVBQU87QUFBQTtBQUdULFVBQUksQ0FBQyxxQkFBcUI7QUFDeEIscUJBQWEsS0FBSztBQUNsQixlQUFPO0FBQUE7QUFFVCxhQUFPO0FBQUE7QUFHVCxVQUFNLGFBQWEsS0FBSyxJQUFJLE1BQU07QUFDbEMsZUFBVyxTQUFTLFdBQVcsVUFBVTtBQUN2QyxVQUFJLGlCQUFpQiwyQkFBUztBQUM1QixvQkFBWTtBQUFBO0FBQUE7QUFJaEIsV0FBTztBQUFBO0FBQUEsRUFHVCxTQUFTO0FBQ1AsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUNWLGNBQVUsU0FBUztBQUduQixVQUFNLFVBQVUsVUFBVSxVQUFVLEVBQUUsS0FBSztBQUMzQyxZQUFRLFFBQVE7QUFHaEIsVUFBTSxnQkFBZ0IsUUFBUSxVQUFVO0FBQUEsTUFDdEMsS0FBSztBQUFBO0FBRVAsa0JBQWMsUUFBUTtBQUd0QixVQUFNLGNBQWMsVUFBVSxVQUFVO0FBQUEsTUFDdEMsS0FBSztBQUFBO0FBSVAsVUFBTSxvQkFBb0IsWUFBWSxVQUFVO0FBQUEsTUFDOUMsS0FBSztBQUFBO0FBSVAsU0FBSywwQkFBMEI7QUFHL0IsU0FBSyx5QkFBeUI7QUFHOUIsU0FBSyx5QkFBeUI7QUFHOUIsU0FBSyx3QkFBd0I7QUFBQTtBQUFBLFFBR2pCLDBCQUEwQixXQUF3QjtBQUM5RCxVQUFNLGVBQWUsS0FBSyxjQUN4QixXQUNBLGlCQUNBO0FBR0YsVUFBTSxhQUFhLE1BQU0sS0FBSztBQUM5QixVQUFNLGVBQWUsTUFBTSxLQUFLO0FBQ2hDLFVBQU0sYUFBYSxXQUFXLFNBQVMsYUFBYTtBQUVwRCxVQUFNLG1CQUFtQixhQUFhLFNBQVMsVUFBVTtBQUFBLE1BQ3ZELEtBQUs7QUFBQSxNQUNMLE1BQ0UsYUFBYSxJQUNULHdCQUF3QixzQkFDeEI7QUFBQTtBQUdSLFNBQUssa0JBQWtCLGtCQUFrQixZQUFZO0FBRXJELFFBQUksYUFBYSxHQUFHO0FBQ2xCLHVCQUFpQixpQkFBaUIsU0FBUyxZQUFZO0FBQ3JELFlBQUksaUJBQWlCO0FBQVU7QUFHL0IsY0FBTSxlQUFlLElBQUksd0JBQU0sS0FBSztBQUNwQyxxQkFBYSxRQUFRLFFBQVE7QUFFN0IsY0FBTSxVQUFVLGFBQWE7QUFDN0IsZ0JBQVEsVUFBVTtBQUFBLFVBQ2hCLEtBQUs7QUFBQSxVQUNMLE1BQU07QUFBQTtBQUlSLFlBQUksV0FBVyxTQUFTLEdBQUc7QUFDekIsa0JBQVEsVUFBVTtBQUFBLFlBQ2hCLEtBQUs7QUFBQSxZQUNMLE1BQU07QUFBQTtBQUVSLGtCQUFRLFlBQVksS0FBSyxnQkFBZ0IsWUFBWTtBQUFBO0FBSXZELFlBQUksYUFBYSxTQUFTLEdBQUc7QUFDM0Isa0JBQVEsVUFBVTtBQUFBLFlBQ2hCLEtBQUs7QUFBQSxZQUNMLE1BQU07QUFBQTtBQUVSLGdCQUFNLGFBQWEsUUFBUSxVQUFVO0FBQUEsWUFDbkMsS0FBSztBQUFBO0FBR1AscUJBQVcsVUFBVSxjQUFjO0FBQ2pDLGtCQUFNLGFBQWEsV0FBVyxVQUFVO0FBQUEsY0FDdEMsS0FBSztBQUFBO0FBRVAsMkNBQVEsWUFBWTtBQUNwQix1QkFBVyxXQUFXLEVBQUUsTUFBTSxPQUFPO0FBQUE7QUFBQTtBQUt6QyxjQUFNLGtCQUFrQixRQUFRLFVBQVU7QUFBQSxVQUN4QyxLQUFLO0FBQUE7QUFHUCxjQUFNLGVBQWUsZ0JBQWdCLFNBQVMsVUFBVTtBQUFBLFVBQ3RELE1BQU07QUFBQTtBQUVSLHFCQUFhLGlCQUFpQixTQUFTLE1BQU0sYUFBYTtBQUUxRCxjQUFNLGdCQUFnQixnQkFBZ0IsU0FBUyxVQUFVO0FBQUEsVUFDdkQsS0FBSztBQUFBLFVBQ0wsTUFBTTtBQUFBO0FBR1Isc0JBQWMsaUJBQWlCLFNBQVMsWUFBWTtBQUNsRCxjQUFJO0FBRUYsdUJBQVcsUUFBUSxZQUFZO0FBQzdCLG9CQUFNLEtBQUssSUFBSSxNQUFNLE1BQU0sTUFBTTtBQUFBO0FBSW5DLGtCQUFNLGdCQUFnQixhQUFhLEtBQ2pDLENBQUMsR0FBRyxNQUFNLEVBQUUsS0FBSyxTQUFTLEVBQUUsS0FBSztBQUVuQyx1QkFBVyxVQUFVLGVBQWU7QUFDbEMsb0JBQU0sS0FBSyxJQUFJLE1BQU0sTUFBTSxRQUFRO0FBQUE7QUFHckMsaUJBQUssY0FBYztBQUNuQiw2QkFBaUIsUUFBUTtBQUV6QixzQkFDRSxLQUFLLEtBQ0wsc0JBQXNCLG1DQUN0QixFQUFFLE9BQU87QUFBQSxtQkFFSixPQUFQO0FBQ0Esb0JBQVEsTUFBTSxpQ0FBaUM7QUFDL0Msc0JBQVUsS0FBSyxLQUFLLGlDQUFpQztBQUFBLGNBQ25ELE9BQU87QUFBQTtBQUFBO0FBR1gsdUJBQWE7QUFBQTtBQUdmLHFCQUFhO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLWCx5QkFBeUIsV0FBd0I7QUFDdkQsVUFBTSxpQkFBaUIsS0FBSyxjQUMxQixXQUNBLGdCQUNBO0FBR0YsVUFBTSxZQUFZLEtBQUssb0JBQ3JCLEtBQUssT0FBTyxTQUFTO0FBRXZCLFVBQU0sV0FBVyxLQUFLLGNBQWM7QUFDcEMsVUFBTSxlQUFlLFVBQVUsU0FBUztBQUV4QyxVQUFNLHFCQUFxQixlQUFlLFNBQVMsVUFBVTtBQUFBLE1BQzNELEtBQUs7QUFBQSxNQUNMLE1BQU0sZUFDRiwyQkFBMkIsY0FDM0I7QUFBQTtBQUdOLFNBQUssa0JBQWtCLG9CQUFvQixXQUFXO0FBRXRELFFBQUksY0FBYztBQUNoQix5QkFBbUIsaUJBQWlCLFNBQVMsWUFBWTtBQUN2RCxZQUFJLG1CQUFtQjtBQUFVO0FBQ2pDLGNBQU0sS0FBSyx1QkFDVCxXQUNBLGdCQUNBLEtBQUssT0FBTyxTQUFTLGdCQUNyQjtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTUEseUJBQXlCLFdBQXdCO0FBQ3ZELFVBQU0scUJBQXFCLEtBQUssY0FDOUIsV0FDQSx3QkFDQTtBQUdGLFVBQU0sa0JBQWtCLEtBQUssb0JBQzNCLEtBQUssT0FBTyxTQUFTO0FBRXZCLFVBQU0sa0JBQWtCLEtBQUssY0FBYztBQUMzQyxVQUFNLHFCQUFxQixnQkFBZ0IsU0FBUztBQUVwRCxVQUFNLHlCQUF5QixtQkFBbUIsU0FBUyxVQUFVO0FBQUEsTUFDbkUsS0FBSztBQUFBLE1BQ0wsTUFBTSxxQkFDRiwwQkFBMEIscUJBQzFCO0FBQUE7QUFHTixTQUFLLGtCQUNILHdCQUNBLGlCQUNBO0FBR0YsUUFBSSxvQkFBb0I7QUFDdEIsNkJBQXVCLGlCQUFpQixTQUFTLFlBQVk7QUFDM0QsWUFBSSx1QkFBdUI7QUFBVTtBQUNyQyxjQUFNLEtBQUssdUJBQ1QsaUJBQ0EsZUFDQSxLQUFLLE9BQU8sU0FBUyxzQkFDckI7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU1BLHdCQUF3QixXQUF3QjtBQUN0RCxVQUFNLG9CQUFvQixLQUFLLGNBQzdCLFdBQ0Esb0JBQ0E7QUFHRixVQUFNLGlCQUFpQixLQUFLLG9CQUMxQixLQUFLLE9BQU8sU0FBUztBQUV2QixVQUFNLGlCQUFpQixLQUFLLGNBQWM7QUFDMUMsVUFBTSxvQkFBb0IsZUFBZSxTQUFTO0FBRWxELFVBQU0sd0JBQXdCLGtCQUFrQixTQUFTLFVBQVU7QUFBQSxNQUNqRSxLQUFLO0FBQUEsTUFDTCxNQUFNLG9CQUNGLHlCQUF5QixvQkFDekI7QUFBQTtBQUdOLFNBQUssa0JBQWtCLHVCQUF1QixnQkFBZ0I7QUFFOUQsUUFBSSxtQkFBbUI7QUFDckIsNEJBQXNCLGlCQUFpQixTQUFTLFlBQVk7QUFDMUQsWUFBSSxzQkFBc0I7QUFBVTtBQUNwQyxjQUFNLEtBQUssdUJBQ1QsZ0JBQ0EsY0FDQSxLQUFLLE9BQU8sU0FBUyxxQkFDckI7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU1BLGNBQ04sV0FDQSxPQUNBLGFBQ2E7QUFDYixVQUFNLFVBQVUsVUFBVSxVQUFVO0FBQUEsTUFDbEMsS0FBSztBQUFBO0FBR1AsVUFBTSxTQUFTLFFBQVEsVUFBVSxFQUFFLEtBQUs7QUFDeEMsV0FBTyxRQUFRO0FBRWYsVUFBTSxPQUFPLFFBQVEsVUFBVSxFQUFFLEtBQUs7QUFDdEMsU0FBSyxRQUFRO0FBRWIsV0FBTztBQUFBO0FBQUEsRUFHVCxVQUFVO0FBQ1IsVUFBTSxFQUFFLGNBQWM7QUFDdEIsY0FBVTtBQUFBO0FBQUE7OztBQzFtQlAsMEJBQW9CO0FBQUEsRUFJekIsWUFBWSxRQUE0QixLQUFVO0FBQ2hELFNBQUssU0FBUztBQUNkLFNBQUssTUFBTTtBQUFBO0FBQUEsRUFNYixhQUFhO0FBQ1gsU0FBSztBQUFBO0FBQUEsRUFTQyxzQkFBc0I7QUFFNUIsU0FBSyxPQUFPLGNBQ1Ysa0JBQ0EsMEJBQ0EsWUFBWTtBQUNWLFlBQU0sS0FBSztBQUFBO0FBS2YsU0FBSyxPQUFPLGNBQ1YsV0FDQSxrQ0FDQSxNQUFNO0FBQ0osV0FBSztBQUFBO0FBS1QsU0FBSyxPQUFPLGNBQWMsU0FBUyw2QkFBNkIsTUFBTTtBQUNwRSxXQUFLO0FBQUE7QUFBQTtBQUFBLFFBT0ksZUFBZTtBQUMxQixVQUFNLEVBQUUsY0FBYyxLQUFLO0FBQzNCLFVBQU0sT0FBTyxVQUFVLFFBQVE7QUFDL0IsVUFBTSxPQUFPLElBQUksU0FBUyxNQUFNLEtBQUs7QUFDckMsVUFBTSxLQUFLLEtBQUs7QUFDaEIsY0FBVSxjQUFjLE1BQU0sRUFBRSxPQUFPO0FBQUE7QUFBQSxFQU1sQyx1QkFBdUI7QUFDNUIsVUFBTSxRQUFRLElBQUksY0FDaEIsS0FBSyxLQUNMLE9BQU8sV0FBVztBQUNoQixZQUFNLE9BQU8sS0FBSyxJQUFJLFVBQVUsUUFBUTtBQUN4QyxZQUFNLE9BQU8sSUFBSSxTQUFTLE1BQU0sS0FBSztBQUNyQyxZQUFNLEtBQUssS0FBSztBQUNoQixZQUFNLEtBQUssYUFBYTtBQUN4QixXQUFLLElBQUksVUFBVSxjQUFjLE1BQU0sRUFBRSxPQUFPO0FBQUEsT0FFbEQsS0FBSztBQUVQLFVBQU07QUFBQTtBQUFBLEVBTUQsbUJBQW1CO0FBQ3hCLFFBQUksYUFBYSxLQUFLLEtBQUssS0FBSyxRQUFRO0FBQUE7QUFBQTs7O0FDakZyQyx3QkFBa0I7QUFBQSxFQUt2QixZQUFZLFFBQTRCLEtBQVU7QUFDaEQsU0FBSyxTQUFTO0FBQ2QsU0FBSyxNQUFNO0FBQ1gsU0FBSyxnQkFBZ0IsSUFBSSxjQUFjLFFBQVE7QUFBQTtBQUFBLEVBR2pELGFBQWE7QUFDWCxTQUFLO0FBQ0wsU0FBSyxjQUFjO0FBQ25CLFNBQUssSUFBSSxVQUFVLGNBQWMsTUFBTTtBQUNyQyxXQUFLO0FBQUE7QUFBQTtBQUFBLFFBSUgsbUJBQW1CO0FBQ3ZCLFVBQU0sU0FBUyxLQUFLLElBQUksVUFBVSxnQkFBZ0I7QUFFbEQsUUFBSSxPQUFPLFdBQVc7QUFBRztBQUV6QixlQUFXLFFBQVEsUUFBUTtBQUN6QixZQUFNLE9BQU8sS0FBSztBQUNsQixZQUFNLFFBQVEsS0FBSztBQUNuQixVQUFJLFNBQVMsTUFBTSxTQUFTLE1BQU0sTUFBTSxRQUFRO0FBQzlDLGNBQU0sS0FBSyxTQUFTLE1BQU07QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtoQyxlQUFlO0FBQ2IsU0FBSyxPQUFPLGFBQ1YsZ0JBQ0EsQ0FBQyxTQUF3QixJQUFJLFNBQVMsTUFBTSxLQUFLO0FBQUE7QUFBQSxFQUlyRCxjQUFjO0FBQ1osU0FBSyxJQUFJLFVBQVUsbUJBQW1CO0FBQUE7QUFBQTs7O0FDekMxQztBQUVPLDJCQUFxQjtBQUFBLEVBSzFCLFlBQVksUUFBNEIsS0FBVTtBQUNoRCxTQUFLLFNBQVM7QUFDZCxTQUFLLE1BQU07QUFDWCxTQUFLLGdCQUFnQixJQUFJLGNBQWMsUUFBUTtBQUFBO0FBQUEsRUFHakQsbUJBQW1CO0FBQ2pCLFNBQUssT0FBTyxXQUFXO0FBQUEsTUFDckIsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ3BCLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQTtBQUFBLE1BRWpDLFNBQVM7QUFBQSxRQUNQO0FBQUEsVUFDRSxXQUFXLENBQUM7QUFBQSxVQUNaLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFLWCxTQUFLLE9BQU8sV0FBVztBQUFBLE1BQ3JCLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTTtBQUNkLGFBQUssT0FBTyxxQkFBcUI7QUFBQTtBQUFBLE1BRW5DLFNBQVM7QUFBQSxRQUNQO0FBQUEsVUFDRSxXQUFXLENBQUM7QUFBQSxVQUNaLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFLWCxTQUFLLE9BQU8sV0FBVztBQUFBLE1BQ3JCLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNwQixjQUFNLEtBQUssY0FBYztBQUFBO0FBQUE7QUFJN0IsU0FBSyxPQUFPLFdBQVc7QUFBQSxNQUNyQixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU07QUFDZCxhQUFLLGNBQWM7QUFBQTtBQUFBO0FBSXZCLFNBQUssT0FBTyxXQUFXO0FBQUEsTUFDckIsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxNQUFNO0FBQ2QsYUFBSyxjQUFjO0FBQUE7QUFBQTtBQUl2QixTQUFLLE9BQU8sV0FBVztBQUFBLE1BQ3JCLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTTtBQUNkLGVBQU8sU0FBUztBQUFBO0FBQUE7QUFJcEIsU0FBSyxPQUFPLFdBQVc7QUFBQSxNQUNyQixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU07QUFFZCxhQUFLLElBQUksUUFBUTtBQUVqQixhQUFLLElBQUksUUFBUSxZQUFZLEtBQUssT0FBTyxTQUFTO0FBQUE7QUFBQTtBQUl0RCxTQUFLLE9BQU8sV0FBVztBQUFBLE1BQ3JCLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLGVBQWUsQ0FBQyxhQUFzQjtBQUNwQyxjQUFNLFdBQVcsS0FBSyxJQUFJLFVBQVUsb0JBQW9CO0FBQ3hELFlBQUksQ0FBQyxVQUFVO0FBQ2IsY0FBSSxDQUFDLFVBQVU7QUFDYiwrQkFDRSxzRUFDQTtBQUFBO0FBR0osaUJBQU87QUFBQTtBQUdULFlBQUksQ0FBQyxVQUFVO0FBQ2IsZUFBTSxhQUFZO0FBQ2hCLGdCQUFJO0FBQ0Ysb0JBQU0sU0FBUyxNQUFNLEtBQUssT0FBTyxhQUFhO0FBQzlDLG9CQUFNLFFBQVEsSUFBSSxvQkFDaEIsS0FBSyxLQUNMLFNBQVMsc0JBQ1QsT0FBTyxZQUFZO0FBQ2pCLHNCQUFNLFNBQVMsbUJBQW1CO0FBQ2xDLG1DQUFtQiw4QkFBOEI7QUFBQSxpQkFFbkQsS0FBSztBQUdQLG9CQUFNO0FBQUEscUJBQ0MsS0FBUDtBQUNBLHNCQUFRLE1BQU0sbUNBQW1DO0FBQ2pELGlDQUFtQixvQ0FBb0M7QUFBQTtBQUFBO0FBQUE7QUFJN0QsZUFBTztBQUFBO0FBQUE7QUFJWCxTQUFLLE9BQU8sV0FBVztBQUFBLE1BQ3JCLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLGVBQWUsQ0FBQyxhQUFzQjtBQUNwQyxjQUFNLGFBQWEsS0FBSyxJQUFJLFVBQVU7QUFDdEMsWUFBSSxDQUFDO0FBQVksaUJBQU87QUFFeEIsY0FBTSxZQUFZLFdBQVcsVUFBVTtBQUN2QyxjQUFNLHNCQUFzQjtBQUFBLFVBRTFCO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQSxVQUVBO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsVUFFQTtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQSxVQUVBO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsVUFDQTtBQUFBLFVBQ0E7QUFBQTtBQUdGLFlBQUksQ0FBQyxvQkFBb0IsU0FBUztBQUFZLGlCQUFPO0FBRXJELFlBQUksQ0FBQyxVQUFVO0FBQ2IsZ0JBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxRQUFRO0FBQ3hDLGdCQUFNLE9BQU8sSUFBSSxTQUFTLE1BQU0sS0FBSztBQUNyQyxlQUFLLEtBQUssTUFBTSxLQUFLLFlBQVk7QUFDL0Isa0JBQU0sSUFBSSxRQUFRLENBQUMsWUFBWSxXQUFXLFNBQVM7QUFDbkQsaUJBQUssSUFBSSxVQUFVLGNBQWMsTUFBTSxFQUFFLE9BQU87QUFDaEQsa0JBQU0sS0FBSyxpQkFBaUI7QUFDNUIsaUJBQUs7QUFBQTtBQUFBO0FBSVQsZUFBTztBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUNqS1IsbUNBQTRCO0FBQUEsRUFnQmpDLFlBQVksUUFBNEI7QUFGdkIsMEJBQWlCLEtBQUssS0FBSztBQUcxQyxTQUFLLFNBQVM7QUFDZCxTQUFLLFNBQVM7QUFBQTtBQUFBLFFBT1YsZUFDSixVQUMrQjtBQUUvQixVQUFNLFNBQVMsdUJBQXNCLG9CQUFvQixJQUFJLFNBQVM7QUFDdEUsUUFBSSxVQUFVLEtBQUssUUFBUSxPQUFPLE9BQU8sWUFBWSxLQUFLLGdCQUFnQjtBQUN4RSxhQUFPLE9BQU87QUFBQTtBQUloQixVQUFNLGtCQUFrQix1QkFBc0IsdUJBQXVCLElBQ25FLFNBQVM7QUFFWCxRQUFJLGlCQUFpQjtBQUNuQixhQUFPO0FBQUE7QUFJVCxVQUFNLGNBQWMsS0FBSyxzQkFBc0I7QUFDL0MsMkJBQXNCLHVCQUF1QixJQUFJLFNBQVMsSUFBSTtBQUU5RCxRQUFJO0FBQ0YsWUFBTSxTQUFTLE1BQU07QUFFckIsVUFBSSxPQUFPLFNBQVM7QUFDbEIsK0JBQXNCLG9CQUFvQixJQUFJLFNBQVMsSUFBSTtBQUFBLFVBQ3pEO0FBQUEsVUFDQSxXQUFXLEtBQUs7QUFBQTtBQUFBO0FBR3BCLGFBQU87QUFBQSxjQUNQO0FBQ0EsNkJBQXNCLHVCQUF1QixPQUFPLFNBQVM7QUFBQTtBQUFBO0FBQUEsUUFPbkQsc0JBQ1osVUFDK0I7QUFDL0IsUUFBSTtBQUNGLFlBQU0sU0FBUyxNQUFNLEtBQUssVUFBVTtBQUdwQyxVQUFJLFNBQVMsU0FBUyxTQUFTLGtCQUFrQjtBQUMvQyxjQUFNLEtBQUssc0JBQXNCLFVBQVU7QUFBQTtBQUc3QyxhQUFPO0FBQUEsUUFDTCxTQUFTO0FBQUEsUUFDVDtBQUFBLFFBQ0EsV0FBVyxLQUFLO0FBQUE7QUFBQSxhQUVYLE9BQVA7QUFDQSxXQUFLLE9BQU8sTUFBTSwyQkFBMkI7QUFFN0MsYUFBTztBQUFBLFFBQ0wsU0FBUztBQUFBLFFBQ1QsT0FBTyxLQUFLLGdCQUFnQjtBQUFBLFFBQzVCLFdBQVcsS0FBSztBQUFBO0FBQUE7QUFBQTtBQUFBLFFBUVIsc0JBQ1osVUFDQSxVQUNlO0FBbkhuQjtBQW9ISSxVQUFNLFVBQVU7QUFBQSxNQUNkLGdCQUFnQjtBQUFBLE1BQ2hCLGVBQWUsVUFBVSxTQUFTO0FBQUEsTUFDbEMsZ0JBQWdCO0FBQUEsTUFDaEIsV0FBVztBQUFBO0FBSWIsVUFBTSxxQkFBcUIsTUFBTSxNQUMvQixpREFDQTtBQUFBLE1BQ0UsUUFBUTtBQUFBLE1BQ1I7QUFBQSxNQUNBLE1BQU0sS0FBSyxVQUFVO0FBQUEsUUFDbkIsT0FBTztBQUFBLFFBQ1AsVUFBVSxDQUFDLEVBQUUsTUFBTSxRQUFRLFNBQVM7QUFBQSxRQUNwQyxZQUFZO0FBQUE7QUFBQSxNQUVkLFFBQVEsWUFBWSxRQUFRO0FBQUE7QUFJaEMsUUFBSSxDQUFDLG1CQUFtQixJQUFJO0FBQzFCLFlBQU0sWUFBWSxNQUFNLG1CQUFtQixPQUFPLE1BQU0sTUFBTztBQUMvRCxVQUFJLG1CQUFtQixXQUFXLEtBQUs7QUFDckMsY0FBTSxJQUFJLE1BQ1I7QUFBQSxpQkFFTyxtQkFBbUIsV0FBVyxLQUFLO0FBQzVDLGNBQU0sSUFBSSxNQUNSO0FBQUEsaUJBRU8sbUJBQW1CLFdBQVcsS0FBSztBQUM1QyxjQUFNLElBQUksTUFDUjtBQUFBO0FBR0osWUFBTSxJQUFJLE1BQ1IsOEJBQ0UsaUJBQVUsVUFBVixtQkFBaUIsWUFBVyxtQkFBbUI7QUFBQTtBQUFBO0FBQUEsUUFTekMsVUFBVSxVQUE2QztBQXBLdkU7QUFxS0ksVUFBTSxVQUFrQztBQUFBLE1BQ3RDLGdCQUFnQjtBQUFBO0FBSWxCLFFBQUksU0FBUyxRQUFRO0FBQ25CLFVBQUksU0FBUyxTQUFTLFNBQVMsa0JBQWtCO0FBQy9DLGdCQUFRLG1CQUFtQixVQUFVLFNBQVM7QUFDOUMsZ0JBQVEsa0JBQWtCO0FBQzFCLGdCQUFRLGFBQWE7QUFBQSxhQUNoQjtBQUNMLGdCQUFRLG1CQUFtQixVQUFVLFNBQVM7QUFBQTtBQUFBO0FBS2xELFFBQUk7QUFDSixRQUFJLFNBQVMsU0FBUyxTQUFTLGtCQUFrQjtBQUMvQyxpQkFBVztBQUFBLFdBQ047QUFFTCxZQUFNLFVBQVUsU0FBUyxTQUFTLFFBQVEsUUFBUTtBQUNsRCxpQkFBVyxRQUFRLFNBQVMsU0FDeEIsR0FBRyxtQkFDSCxRQUFRLFNBQVMsZ0JBQ2pCLFVBQ0EsR0FBRztBQUFBO0FBR1QsVUFBTSxXQUFXLE1BQU0sTUFBTSxVQUFVO0FBQUEsTUFDckMsUUFBUTtBQUFBLE1BQ1I7QUFBQSxNQUVBLFFBQVEsWUFBWSxRQUFRO0FBQUE7QUFHOUIsUUFBSSxDQUFDLFNBQVMsSUFBSTtBQUNoQixZQUFNLFlBQVksTUFBTSxTQUFTLE9BQU8sTUFBTSxNQUFPO0FBQ3JELFVBQUksU0FBUyxXQUFXLEtBQUs7QUFDM0IsY0FBTSxJQUFJLE1BQ1I7QUFBQSxpQkFFTyxTQUFTLFdBQVcsS0FBSztBQUNsQyxjQUFNLElBQUksTUFDUjtBQUFBLGlCQUVPLFNBQVMsV0FBVyxLQUFLO0FBQ2xDLGNBQU0sSUFBSSxNQUNSO0FBQUE7QUFHSixZQUFNLElBQUksTUFDUixlQUFlLGlCQUFVLFVBQVYsbUJBQWlCLFlBQVcsU0FBUztBQUFBO0FBSXhELFVBQU0sT0FBTyxNQUFNLFNBQVM7QUFHNUIsV0FBUSxhQUFLLFNBQUwsbUJBQVcsSUFBSSxDQUFDLFVBQWUsTUFBTSxRQUFPLElBQUksT0FDdEQsQ0FBQyxPQUFlLENBQUMsR0FBRyxjQUFjLFNBQVM7QUFBQTtBQUFBLEVBT3ZDLGdCQUFnQixPQUFvQjtBQUMxQyxRQUFJLGlCQUFpQixPQUFPO0FBQzFCLFVBQUksTUFBTSxTQUFTLGNBQWM7QUFDL0IsZUFBTztBQUFBO0FBS1QsYUFBTyxNQUFNO0FBQUE7QUFHZixXQUFPO0FBQUE7QUFBQTtBQWpPSjtBQUdVLEFBSFYsc0JBR1Usc0JBTVgsSUFBSTtBQUNPLEFBVlYsc0JBVVUseUJBR1gsSUFBSTs7O0FoQ2xCVjs7O0FpQ2JBLHdCQUEyQjtBQUlwQix5QkFBbUI7QUFBQSxFQU94QixZQUFtQixRQUE0QjtBQUE1QjtBQUVqQixTQUFLLE1BQU0sT0FBTztBQUNsQixTQUFLLFdBQVcsT0FBTztBQUd2QixTQUFLLHNCQUFzQjtBQUMzQixTQUFLLGtCQUFrQjtBQUd2QixTQUFLO0FBQUE7QUFBQSxRQUdELHdCQUF1QztBQUMzQyxVQUFNLFdBQVcsS0FBSyxTQUFTO0FBQy9CLFVBQU0sV0FBVyxHQUFHO0FBRXBCLFFBQUk7QUFFRixZQUFNLEtBQUssSUFBSSxNQUFNLFFBQVEsTUFBTTtBQUduQyxVQUFJLENBQUUsTUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLE9BQU8sV0FBWTtBQUNwRCxjQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sVUFBVTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSXhDLFlBQU0sT0FBTyxLQUFLLElBQUksTUFBTSxzQkFBc0I7QUFDbEQsVUFBSSxnQkFBZ0IseUJBQU87QUFFekIsY0FBTSxlQUFlLEtBQUssSUFBSSxVQUMzQixnQkFBZ0IsWUFDaEIsS0FBSyxDQUFDLFNBQVMsS0FBSyxLQUFLLFdBQVcsU0FBUyxLQUFLO0FBRXJELFlBQUksY0FBYztBQUVoQixlQUFLLElBQUksVUFBVSxjQUFjLGNBQWMsRUFBRSxPQUFPO0FBQUEsZUFDbkQ7QUFFTCxnQkFBTSxLQUFLLElBQUksVUFBVSxVQUFVLFNBQVM7QUFBQTtBQUFBO0FBQUEsYUFHekMsT0FBUDtBQUNBLGNBQVEsTUFBTSxnQ0FBZ0M7QUFDOUMsWUFBTTtBQUFBO0FBQUE7QUFBQSxFQUlGLDJCQUFpQztBQUN2QyxTQUFLLE9BQU8sY0FDVixLQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsT0FBTyxTQUFTO0FBQzFDLFlBQU0sV0FBVyxLQUFLLFNBQVM7QUFFL0IsVUFBSSxLQUFLLEtBQUssV0FBVyxhQUFhLEtBQUssS0FBSyxTQUFTLFFBQVE7QUFDL0QsY0FBTSxLQUFLLHNCQUFzQjtBQUFBO0FBQUE7QUFBQTtBQUFBLFFBTTNCLHNCQUFzQixNQUE0QjtBQUU5RCxRQUFJLENBQUMsS0FBSyxTQUFTLHdCQUF3QjtBQUN6QztBQUFBO0FBSUYsUUFBSSxDQUFDLEtBQUssS0FBSyxXQUFXLEtBQUssU0FBUyxpQkFBaUI7QUFDdkQ7QUFBQTtBQUlGLFFBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxRQUFRO0FBQzlCO0FBQUE7QUFHRixVQUFNLFdBQVcsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLO0FBQzNDLFVBQU0sWUFBWSxLQUFLLGVBQWU7QUFFdEMsUUFBSSxjQUFjLFVBQVU7QUFDMUIsWUFBTSxLQUFLLElBQUksTUFBTSxPQUFPLE1BQU07QUFBQTtBQUFBO0FBQUEsRUFJOUIsZUFBZSxTQUF5QjtBQUM5QyxVQUFNLFFBQVEsUUFBUSxNQUFNO0FBQzVCLFVBQU0sU0FBbUI7QUFDekIsUUFBSSxhQUF1QjtBQUUzQixVQUFNLGNBQWMsTUFBTTtBQUN4QixVQUFJLFdBQVcsU0FBUyxHQUFHO0FBQ3pCLGVBQU8sS0FBSyxHQUFHLEtBQUssaUJBQWlCO0FBQ3JDLHFCQUFhO0FBQUE7QUFBQTtBQUlqQixlQUFXLFFBQVEsT0FBTztBQUV4QixVQUFJLG9CQUFvQixLQUFLLE9BQU87QUFDbEMsbUJBQVcsS0FBSztBQUFBLGFBQ1g7QUFDTDtBQUNBLGVBQU8sS0FBSztBQUFBO0FBQUE7QUFHaEI7QUFDQSxXQUFPLE9BQU8sS0FBSztBQUFBO0FBQUEsRUFRYixpQkFBaUIsT0FBMkI7QUFRbEQsdUJBQW1CLE1BQXNCO0FBQ3ZDLFlBQU0sUUFBUSxLQUFLLE1BQU07QUFDekIsYUFBTyxRQUFRLE1BQU0sR0FBRyxTQUFTO0FBQUE7QUFJbkMsVUFBTSxRQUFvQjtBQUMxQixVQUFNLFFBQW9CO0FBRTFCLGVBQVcsUUFBUSxPQUFPO0FBQ3hCLFlBQU0sU0FBUyxVQUFVO0FBQ3pCLFlBQU0sT0FBaUIsRUFBRSxNQUFNLFVBQVUsSUFBSTtBQUU3QyxhQUFPLE1BQU0sU0FBUyxLQUFLLFVBQVUsTUFBTSxNQUFNLFNBQVMsR0FBRyxRQUFRO0FBQ25FLGNBQU07QUFBQTtBQUVSLFVBQUksTUFBTSxXQUFXLEdBQUc7QUFDdEIsY0FBTSxLQUFLO0FBQ1gsY0FBTSxLQUFLO0FBQUEsYUFDTjtBQUVMLGNBQU0sTUFBTSxTQUFTLEdBQUcsU0FBUyxLQUFLO0FBQ3RDLGNBQU0sS0FBSztBQUFBO0FBQUE7QUFLZiwwQkFBc0IsUUFBK0I7QUFFbkQsaUJBQVcsUUFBUSxRQUFPO0FBQ3hCLFlBQUksS0FBSyxTQUFTLFNBQVMsR0FBRztBQUM1QixlQUFLLFdBQVcsYUFBYSxLQUFLO0FBRWxDLGVBQUssU0FBUyxLQUFLLENBQUMsR0FBRyxNQUFNO0FBQzNCLGtCQUFNLFlBQVksaUJBQWlCLEtBQUssRUFBRSxRQUFRLElBQUk7QUFDdEQsa0JBQU0sWUFBWSxpQkFBaUIsS0FBSyxFQUFFLFFBQVEsSUFBSTtBQUN0RCxtQkFBTyxZQUFZO0FBQUE7QUFBQTtBQUFBO0FBS3pCLGFBQU0sS0FBSyxDQUFDLEdBQUcsTUFBTTtBQUNuQixjQUFNLFlBQVksaUJBQWlCLEtBQUssRUFBRSxRQUFRLElBQUk7QUFDdEQsY0FBTSxZQUFZLGlCQUFpQixLQUFLLEVBQUUsUUFBUSxJQUFJO0FBQ3RELGVBQU8sWUFBWTtBQUFBO0FBRXJCLGFBQU87QUFBQTtBQUdULFVBQU0saUJBQWlCLGFBQWE7QUFHcEMsVUFBTSxZQUFzQjtBQUM1QixxQkFBaUIsUUFBbUI7QUFDbEMsaUJBQVcsUUFBUSxRQUFPO0FBQ3hCLGtCQUFVLEtBQUssS0FBSztBQUNwQixZQUFJLEtBQUssU0FBUyxTQUFTLEdBQUc7QUFDNUIsa0JBQVEsS0FBSztBQUFBO0FBQUE7QUFBQTtBQUluQixZQUFRO0FBQ1IsV0FBTztBQUFBO0FBQUE7OztBQy9MSix5QkFBbUI7QUFBQSxFQVNoQixZQUNOLFFBQ0EsdUJBQ0E7QUFSTSxzQkFBeUM7QUFDekMseUJBQXdCO0FBQ2YsMEJBQWlCLEtBQUssS0FBSztBQUNwQywwQkFBc0Q7QUFNNUQsU0FBSyxTQUFTO0FBQ2QsU0FBSyx3QkFBd0I7QUFBQTtBQUFBLFNBR3hCLFlBQ0wsUUFDQSx1QkFDYztBQUNkLFFBQUksQ0FBQyxhQUFhLFVBQVU7QUFDMUIsbUJBQWEsV0FBVyxJQUFJLGFBQWEsUUFBUTtBQUFBO0FBRW5ELFdBQU8sYUFBYTtBQUFBO0FBQUEsUUFPVCxZQUEwQztBQUVyRCxRQUNFLEtBQUssY0FDTCxLQUFLLFFBQVEsS0FBSyxnQkFBZ0IsS0FBSyxnQkFDdkM7QUFDQSxhQUFPLEtBQUs7QUFBQTtBQUlkLFFBQUksS0FBSyxnQkFBZ0I7QUFDdkIsYUFBTyxLQUFLO0FBQUE7QUFJZCxTQUFLLGlCQUFpQixLQUFLO0FBQzNCLFFBQUk7QUFDRixZQUFNLFNBQVMsTUFBTSxLQUFLO0FBQzFCLGFBQU87QUFBQSxjQUNQO0FBQ0EsV0FBSyxpQkFBaUI7QUFBQTtBQUFBO0FBQUEsUUFPWixhQUEyQztBQUN2RCxRQUFJO0FBRUYsWUFBTSxlQUFlLE1BQU0sS0FBSyxPQUFPLFVBQVU7QUFHakQsWUFBTSxlQUFlLE1BQU0sS0FBSztBQUdoQyxZQUFNLFlBQVksQ0FBQyxHQUFHLGNBQWMsR0FBRztBQUd2QyxZQUFNLGlCQUFpQixLQUFLLE9BQU8sU0FBUyxrQkFBa0I7QUFDOUQsaUJBQVcsU0FBUyxXQUFXO0FBQzdCLGNBQU0sYUFBYSxlQUFlLEtBQ2hDLENBQUMsUUFBUSxJQUFJLFlBQVksTUFBTSxNQUFNLElBQUksYUFBYSxNQUFNO0FBQUE7QUFLaEUsV0FBSyxhQUFhO0FBQ2xCLFdBQUssZ0JBQWdCLEtBQUs7QUFFMUIsYUFBTztBQUFBLGFBQ0EsT0FBUDtBQUNBLGNBQVEsTUFBTSwwQkFBMEI7QUFFeEMsYUFBTyxLQUFLLGNBQWM7QUFBQTtBQUFBO0FBQUEsUUFPaEIsMkJBQXlEO0FBQ3JFLFVBQU0sRUFBRSxvQkFBb0IsS0FBSyxPQUFPO0FBRXhDLFVBQU0sVUFBVSxnQkFDYixPQUFPLENBQUMsTUFBTSxFQUFFLFdBQ2hCLElBQUksT0FBTyxNQUFNO0FBQ2hCLFVBQUk7QUFFRixjQUFNLFNBQVMsTUFBTSxLQUFLLHNCQUFzQixlQUFlO0FBQy9ELFlBQUksT0FBTyxXQUFXLE9BQU8sUUFBUTtBQUNuQyxpQkFBTyxLQUFLLG1CQUFtQixHQUFHLE9BQU87QUFBQTtBQUFBLGVBRXBDLE9BQVA7QUFDQSxnQkFBUSxNQUFNLDhCQUE4QixFQUFFLFNBQVM7QUFBQTtBQUV6RCxhQUFPO0FBQUE7QUFHWCxVQUFNLFVBQVUsTUFBTSxRQUFRLElBQUk7QUFDbEMsV0FBTyxRQUFRO0FBQUE7QUFBQSxFQU1ULG1CQUNOLFVBQ0EsVUFDcUI7QUFDckIsV0FBTyxTQUFTLElBQUksQ0FBQyxZQUFhO0FBQUEsTUFDaEMsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxTQUFTLEtBQUs7QUFBQSxNQUN4QixZQUFZO0FBQUEsTUFDWixnQkFBZ0I7QUFBQSxNQUNoQixjQUFjO0FBQUEsTUFDZCxTQUFTO0FBQUEsUUFDUCxRQUFRO0FBQUEsUUFDUixZQUFZO0FBQUEsUUFDWixPQUFPO0FBQUEsUUFDUCxTQUFTO0FBQUE7QUFBQSxNQUVYLGNBQWM7QUFBQSxRQUNaLFVBQVU7QUFBQSxRQUNWLFdBQVc7QUFBQSxRQUNYLGVBQWU7QUFBQTtBQUFBLE1BRWpCLGFBQWEsR0FBRyxTQUFTO0FBQUEsTUFDekIsWUFBWTtBQUFBLFFBQ1YsWUFBWSxTQUFTLEtBQUs7QUFBQSxRQUMxQjtBQUFBLFFBQ0EsYUFBYTtBQUFBO0FBQUE7QUFBQTtBQUFBLFFBUU4sZUFBZSxPQUF5QztBQUNuRSxVQUFNLGdCQUFnQixDQUFDLE1BQU07QUFDN0IsVUFBTSxhQUFhO0FBR25CLFFBQUksZUFBZTtBQUNqQixXQUFLLE9BQU8sU0FBUyxlQUFlLEtBQUs7QUFBQSxRQUN2QyxVQUFVLE1BQU07QUFBQSxRQUNoQixTQUFTLE1BQU07QUFBQTtBQUFBLFdBRVo7QUFDTCxXQUFLLE9BQU8sU0FBUyxpQkFDbkIsS0FBSyxPQUFPLFNBQVMsZUFBZSxPQUNsQyxDQUFDLFFBQ0MsQ0FBRSxLQUFJLFlBQVksTUFBTSxNQUFNLElBQUksYUFBYSxNQUFNO0FBQUE7QUFJN0QsVUFBTSxLQUFLLE9BQU87QUFBQTtBQUFBOzs7QWxDNUp0Qix1Q0FBZ0QseUJBQU87QUFBQSxFQUF2RCxjQWpCQTtBQWlCQTtBQUtVLGlDQUF3QjtBQUFBO0FBQUEsUUFZMUIsU0FBUztBQUViLFNBQUssa0JBQWtCLElBQUksZ0JBQWdCO0FBQzNDLFVBQU0sS0FBSyxnQkFBZ0I7QUFDM0IsU0FBSyxXQUFXLEtBQUssZ0JBQWdCO0FBR3JDLFNBQUssbUJBQW1CLENBQUMsUUFBUTtBQUdqQyxTQUFLLHdCQUF3QixJQUFJLHNCQUFzQjtBQUN2RCxTQUFLLGVBQWUsYUFBYSxZQUMvQixNQUNBLEtBQUs7QUFFUCxTQUFLLFlBQVksb0JBQW9CLFlBQVksS0FBSyxVQUFVLEtBQUs7QUFDckUsU0FBSyx1QkFBdUIscUJBQXFCLFlBQVk7QUFDN0QsU0FBSyxrQkFBa0IsZ0JBQWdCLFlBQVksS0FBSyxLQUFLO0FBQzdELFNBQUssY0FBYyxJQUFJLHdCQUNyQixLQUFLLEtBQ0wsS0FBSyxXQUNMO0FBSUYsd0JBQW9CLHVCQUF1QixLQUFLO0FBR2hELFNBQUssZ0JBQWdCLEtBQUssYUFBYTtBQUd2QyxTQUFLLGNBQWMsSUFBSSx1QkFBdUIsS0FBSyxLQUFLO0FBQ3hELFNBQUssY0FBYyxLQUFLO0FBR3hCLFNBQUssaUJBQWlCLElBQUksZUFBZSxNQUFNLEtBQUs7QUFDcEQsU0FBSyxlQUFlLElBQUksYUFBYTtBQUNyQyxTQUFLLGNBQWMsSUFBSSxZQUFZLE1BQU0sS0FBSztBQUM5QyxTQUFLLGlCQUFpQixJQUFJLGVBQWUsTUFBTSxLQUFLO0FBR3BELFNBQUssWUFBWTtBQUNqQixTQUFLLGVBQWU7QUFHcEIsd0JBQW9CLGtCQUFrQixNQUFNLENBQUMsVUFBVTtBQUNyRCxjQUFRLE1BQU0sOENBQThDO0FBQUE7QUFJOUQsUUFBSTtBQUNGLFlBQU0sS0FBSztBQUFBLGFBQ0osT0FBUDtBQUNBLGNBQVEsTUFBTSxrQ0FBa0M7QUFBQTtBQUFBO0FBQUEsUUFJOUMsV0FBVztBQUNmLFlBQVEsSUFBSTtBQUNaLFNBQUssZ0JBQWdCO0FBQ3JCLFNBQUsscUJBQXFCO0FBQzFCLFNBQUssWUFBWTtBQUFBO0FBQUEsUUFHYixXQUFXO0FBQ2YsV0FBTyxNQUFNO0FBQUE7QUFBQSxRQUdULFNBQVMsTUFBVztBQUN4QixXQUFPLE1BQU0sU0FBUztBQUFBO0FBQUEsUUFHbEIsZUFBZTtBQUNuQixVQUFNLEtBQUssZ0JBQWdCO0FBQUE7QUFBQSxFQUc3QixxQkFBc0M7QUFDcEMsV0FBTyxLQUFLO0FBQUE7QUFBQSxFQUdkLDBCQUFnRDtBQUM5QyxXQUFPLEtBQUs7QUFBQTtBQUFBLEVBR2Qsb0JBQW9DO0FBQ2xDLFdBQU8sS0FBSztBQUFBO0FBQUEsRUFHZCxxQkFBc0M7QUFDcEMsV0FBTyxLQUFLO0FBQUE7QUFBQSxFQU1QLG1CQUFpRDtBQUN0RCxXQUFPLEtBQUs7QUFBQTtBQUFBOyIsCiAgIm5hbWVzIjogW10KfQo=
