/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[Object.keys(fn)[0]])(fn = 0)), res;
};
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[Object.keys(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// src/services/SystemPromptService.ts
var _SystemPromptService, SystemPromptService;
var init_SystemPromptService = __esm({
  "src/services/SystemPromptService.ts"() {
    _SystemPromptService = class {
      constructor(app) {
        this.app = app;
        if (!_SystemPromptService.initPromise && !_SystemPromptService.isInitializing) {
          _SystemPromptService.initializeCache();
        }
      }
      static setSystemSculptService(service) {
        _SystemPromptService.systemSculptService = service;
      }
      static isCacheValid() {
        if (!_SystemPromptService.cache)
          return false;
        const now = Date.now();
        return now - _SystemPromptService.cache.timestamp < _SystemPromptService.CACHE_DURATION;
      }
      static updateCache(prompts) {
        const byId = {};
        prompts.forEach((prompt) => {
          byId[prompt.id] = prompt;
        });
        _SystemPromptService.cache = {
          prompts,
          timestamp: Date.now(),
          byId
        };
      }
      static initializeCache() {
        if (_SystemPromptService.initPromise) {
          return _SystemPromptService.initPromise;
        }
        if (!_SystemPromptService.systemSculptService) {
          return Promise.reject(new Error("SystemSculptService not initialized"));
        }
        _SystemPromptService.isInitializing = true;
        _SystemPromptService.initPromise = fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`).then(async (response) => {
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
        }).catch((error) => {
          console.error("Error initializing system prompts cache:", error);
          _SystemPromptService.initPromise = null;
        }).finally(() => {
          _SystemPromptService.isInitializing = false;
        });
        return _SystemPromptService.initPromise;
      }
      async ensureCacheInitialized() {
        if (_SystemPromptService.isCacheValid())
          return;
        if (_SystemPromptService.initPromise) {
          await _SystemPromptService.initPromise;
          return;
        }
        await _SystemPromptService.initializeCache();
      }
      async getSystemPrompts() {
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && _SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
          return data.prompts;
        } catch (error) {
          console.error("Error fetching system prompts:", error);
          if (_SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          throw error;
        }
      }
      async getSystemPromptById(id) {
        var _a, _b, _c;
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && ((_a = _SystemPromptService.cache) == null ? void 0 : _a.byId[id])) {
            return _SystemPromptService.cache.byId[id];
          }
          await this.getSystemPrompts();
          return ((_b = _SystemPromptService.cache) == null ? void 0 : _b.byId[id]) || null;
        } catch (error) {
          console.error(`Error fetching system prompt ${id}:`, error);
          if ((_c = _SystemPromptService.cache) == null ? void 0 : _c.byId[id]) {
            return _SystemPromptService.cache.byId[id];
          }
          throw error;
        }
      }
      async getSystemPromptTemplate() {
        try {
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts/template`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompt template: ${response.statusText}`);
          }
          const data = await response.json();
          return data.template;
        } catch (error) {
          console.error("Error fetching system prompt template:", error);
          throw error;
        }
      }
      async refreshCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
        await _SystemPromptService.initializeCache();
      }
      static clearCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
      }
    };
    SystemPromptService = _SystemPromptService;
    SystemPromptService.cache = null;
    SystemPromptService.CACHE_DURATION = 60 * 60 * 1e3;
    SystemPromptService.initPromise = null;
    SystemPromptService.isInitializing = false;
  }
});

// src/utils/errors.ts
function getErrorMessage(code, model) {
  const message = ERROR_MESSAGES[code];
  if (typeof message === "function") {
    return message(model);
  }
  return message;
}
var ERROR_CODES, ERROR_MESSAGES, SystemSculptError;
var init_errors = __esm({
  "src/utils/errors.ts"() {
    ERROR_CODES = {
      INVALID_LICENSE: "INVALID_LICENSE",
      LICENSE_EXPIRED: "LICENSE_EXPIRED",
      LICENSE_DISABLED: "LICENSE_DISABLED",
      PRO_REQUIRED: "PRO_REQUIRED",
      MODEL_UNAVAILABLE: "MODEL_UNAVAILABLE",
      MODEL_REQUEST_ERROR: "MODEL_REQUEST_ERROR",
      STREAM_ERROR: "STREAM_ERROR",
      INVALID_RESPONSE: "INVALID_RESPONSE",
      NO_IMAGE: "NO_IMAGE",
      FILE_NOT_FOUND: "FILE_NOT_FOUND",
      FILE_TOO_LARGE: "FILE_TOO_LARGE",
      UNSUPPORTED_FORMAT: "UNSUPPORTED_FORMAT",
      PROCESSING_ERROR: "PROCESSING_ERROR",
      UNKNOWN_ERROR: "UNKNOWN_ERROR",
      QUOTA_EXCEEDED: "QUOTA_EXCEEDED"
    };
    ERROR_MESSAGES = {
      [ERROR_CODES.INVALID_LICENSE]: "Invalid license key. Please check and try again.",
      [ERROR_CODES.LICENSE_EXPIRED]: "Your license has expired.",
      [ERROR_CODES.LICENSE_DISABLED]: "This license has been disabled.",
      [ERROR_CODES.PRO_REQUIRED]: "This feature requires a Pro subscription. Please upgrade.",
      [ERROR_CODES.MODEL_UNAVAILABLE]: (model) => `Model ${model || ""} is currently unavailable.`,
      [ERROR_CODES.MODEL_REQUEST_ERROR]: (model) => `Model ${model || ""} cannot process this request.`,
      [ERROR_CODES.STREAM_ERROR]: "Streaming failed. Please try again.",
      [ERROR_CODES.INVALID_RESPONSE]: "Invalid response received from server. Please try again.",
      [ERROR_CODES.UNKNOWN_ERROR]: "An unexpected error occurred. Please try again or contact support.",
      [ERROR_CODES.QUOTA_EXCEEDED]: "You have exceeded your quota. Please upgrade your plan.",
      [ERROR_CODES.NO_IMAGE]: "No image in clipboard",
      [ERROR_CODES.FILE_NOT_FOUND]: "File not found",
      [ERROR_CODES.FILE_TOO_LARGE]: "File too large (max 10MB)",
      [ERROR_CODES.UNSUPPORTED_FORMAT]: "Unsupported file format",
      [ERROR_CODES.PROCESSING_ERROR]: "Failed to process file"
    };
    SystemSculptError = class extends Error {
      constructor(message, code = ERROR_CODES.UNKNOWN_ERROR, statusCode = 500, metadata) {
        super(message);
        this.code = code;
        this.statusCode = statusCode;
        this.metadata = metadata;
        this.name = "SystemSculptError";
      }
    };
  }
});

// src/utils/ImageProcessor.ts
var _ImageProcessor, ImageProcessor;
var init_ImageProcessor = __esm({
  "src/utils/ImageProcessor.ts"() {
    init_errors();
    _ImageProcessor = class {
      static async processImage(file, app) {
        if (!file) {
          throw new SystemSculptError("File not found", "FILE_NOT_FOUND", 404);
        }
        if (file.stat.size > _ImageProcessor.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        const extension = file.extension.toLowerCase();
        if (!_ImageProcessor.SUPPORTED_FORMATS.has(extension)) {
          throw new SystemSculptError("Unsupported image format", "UNSUPPORTED_FORMAT", 415);
        }
        try {
          const arrayBuffer = await app.vault.readBinary(file);
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              const dataUrl = reader.result;
              resolve(dataUrl);
            };
            reader.onerror = () => reject(reader.error);
            const type = `image/${extension === "jpg" ? "jpeg" : extension}`;
            const blob = new Blob([arrayBuffer], { type });
            reader.readAsDataURL(blob);
          });
          return base64;
        } catch (error) {
          console.error("Image processing failed:", error);
          throw new SystemSculptError("Failed to process image", "PROCESSING_ERROR", 500);
        }
      }
      static async processClipboardImage(clipboardData) {
        const file = clipboardData.files[0];
        if (!file || !file.type.startsWith("image/")) {
          throw new SystemSculptError("No image in clipboard", "NO_IMAGE", 400);
        }
        if (file.size > this.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(reader.error);
          reader.readAsDataURL(file);
        });
      }
    };
    ImageProcessor = _ImageProcessor;
    ImageProcessor.MAX_FILE_SIZE = 10 * 1024 * 1024;
    ImageProcessor.SUPPORTED_FORMATS = new Set([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp"
    ]);
  }
});

// src/constants/api.ts
var API_BASE_URL, SYSTEMSCULPT_API_ENDPOINTS, SYSTEMSCULPT_API_HEADERS;
var init_api = __esm({
  "src/constants/api.ts"() {
    API_BASE_URL = window.location.hostname === "localhost" ? "http://localhost:3001/api/v1" : "https://api.systemsculpt.com/api/v1";
    SYSTEMSCULPT_API_ENDPOINTS = {
      LICENSE: {
        VALIDATE: (key) => `/api/v1/license/validate/${key}`
      },
      MODELS: {
        LIST: "/api/v1/models",
        GET: (modelId) => `/api/v1/models/${modelId}`
      },
      CHAT: {
        COMPLETIONS: "/api/v1/chat/completions"
      },
      SYSTEM_PROMPTS: {
        GET: (id) => `/api/v1/system-prompts/${id}`,
        LIST: "/api/v1/system-prompts"
      },
      DOCUMENTS: {
        PROCESS: "/api/v1/documents/process",
        GET: (id) => `/api/v1/documents/${id}`,
        DOWNLOAD: (id) => `/api/v1/documents/${id}/download`
      }
    };
    SYSTEMSCULPT_API_HEADERS = {
      DEFAULT: {
        "Content-Type": "application/json"
      },
      WITH_LICENSE: (licenseKey) => ({
        ...SYSTEMSCULPT_API_HEADERS.DEFAULT,
        Authorization: `Bearer ${licenseKey}`
      })
    };
  }
});

// src/services/SystemSculptService.ts
function generateUUID() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var import_obsidian, _SystemSculptService, SystemSculptService;
var init_SystemSculptService = __esm({
  "src/services/SystemSculptService.ts"() {
    import_obsidian = __toModule(require("obsidian"));
    init_SystemPromptService();
    init_errors();
    init_ImageProcessor();
    init_api();
    _SystemSculptService = class {
      constructor(settings, app) {
        this.isInsideThinkTags = false;
        this.hasLoggedDevMode = false;
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
        this.app = app;
      }
      get baseUrl() {
        if (!this.hasLoggedDevMode) {
          this.hasLoggedDevMode = true;
        }
        if (this.settings.developmentMode) {
          return this.settings.serverUrl;
        }
        return "https://api.systemsculpt.com";
      }
      get extractionsDirectory() {
        var _a;
        return (_a = this.settings.extractionsDirectory) != null ? _a : "";
      }
      static getInstance(settings, app) {
        if (!_SystemSculptService.instance) {
          _SystemSculptService.instance = new _SystemSculptService(settings, app);
        } else {
          _SystemSculptService.instance.settings = settings;
          _SystemSculptService.instance.licenseKey = settings.licenseKey;
        }
        return _SystemSculptService.instance;
      }
      updateSettings(settings) {
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
      }
      async makeRequest(endpoint, options = {}) {
        if (options.requiresPro && !endpoint.includes("/license/validate")) {
          const isValid = await this.validateLicense(true);
          if (!isValid) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.PRO_REQUIRED), ERROR_CODES.PRO_REQUIRED, 403);
          }
        }
        const headers = this.licenseKey ? SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey) : SYSTEMSCULPT_API_HEADERS.DEFAULT;
        const url = `${this.baseUrl}${endpoint}`;
        const response = await (0, import_obsidian.requestUrl)({
          url,
          method: options.method || "GET",
          headers: {
            ...headers,
            ...options.headers || {}
          },
          body: options.body,
          throw: false
        });
        let apiResponse;
        try {
          apiResponse = response.json;
        } catch (e) {
          throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, response.status);
        }
        if (response.status !== 200 || apiResponse.status === "error") {
          this.handleApiError(endpoint, response, apiResponse);
        }
        return apiResponse.data !== void 0 ? apiResponse.data : apiResponse;
      }
      handleApiError(endpoint, response, apiResponse) {
        if (apiResponse.error) {
          const errorCode = apiResponse.error.code || ERROR_CODES.UNKNOWN_ERROR;
          const statusCode = apiResponse.error.statusCode || response.status;
          const errorMessage = getErrorMessage(errorCode, apiResponse.error.model);
          const metadata = {};
          if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
            metadata.shouldResubmit = true;
            metadata.model = apiResponse.error.model;
          }
          throw new SystemSculptError(errorMessage, errorCode, statusCode, metadata);
        }
        throw new SystemSculptError(getErrorMessage(ERROR_CODES.UNKNOWN_ERROR), ERROR_CODES.UNKNOWN_ERROR, response.status);
      }
      async handleStreamError(response, isCustomProvider = false) {
        var _a, _b, _c, _d;
        console.error("Stream error response:", {
          status: response.status,
          statusText: response.statusText,
          contentType: response.headers.get("content-type"),
          isCustomProvider
        });
        let errorCode = ERROR_CODES.STREAM_ERROR;
        let metadata = {};
        try {
          const errorData = await response.json();
          console.error("Stream error data:", errorData);
          if (isCustomProvider) {
            metadata.rawError = errorData;
            metadata.provider = "custom";
            if (response.status === 401) {
              errorCode = ERROR_CODES.INVALID_LICENSE;
              throw new SystemSculptError(((_a = errorData.error) == null ? void 0 : _a.message) || "Invalid API key for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 429) {
              errorCode = ERROR_CODES.QUOTA_EXCEEDED;
              throw new SystemSculptError(((_b = errorData.error) == null ? void 0 : _b.message) || "Rate limit exceeded for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 404) {
              errorCode = ERROR_CODES.MODEL_UNAVAILABLE;
              throw new SystemSculptError(((_c = errorData.error) == null ? void 0 : _c.message) || "Model not found or endpoint incorrect", errorCode, response.status, metadata);
            }
            throw new SystemSculptError(((_d = errorData.error) == null ? void 0 : _d.message) || response.statusText, errorCode, response.status, metadata);
          }
          if (errorData.error) {
            errorCode = errorData.error.code || ERROR_CODES.STREAM_ERROR;
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata = {
                model: errorData.error.model,
                shouldResubmit: true,
                rawError: errorData
              };
            }
          }
        } catch (e) {
          console.error("Error parsing error response:", e);
          if (e instanceof SystemSculptError) {
            throw e;
          }
          errorCode = ERROR_CODES.STREAM_ERROR;
        }
        throw new SystemSculptError(getErrorMessage(errorCode, metadata.model), errorCode, response.status, metadata);
      }
      async validateLicense(forceCheck = false) {
        if (!this.licenseKey)
          return false;
        try {
          await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
            method: "GET",
            headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
          });
          return true;
        } catch (e) {
          return false;
        }
      }
      async getModels() {
        try {
          const response = await this.makeRequest("/api/v1/models", {
            method: "GET"
          });
          if (!response || !Array.isArray(response.models)) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, 500);
          }
          const systemsculptModels = response.models.map((model) => ({
            ...model,
            provider: "systemsculpt"
          }));
          return systemsculptModels;
        } catch (error) {
          throw error;
        }
      }
      async getTokenBalance() {
        const isValid = await this.validateLicense(true);
        if (!isValid)
          return 0;
        const licenseInfo = await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
          method: "GET",
          headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
        });
        return licenseInfo.credits_balance || 0;
      }
      async getContextFileContents(filePath) {
        try {
          const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
          const cleanPath = linkText.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            if (resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
              const base64 = await ImageProcessor.processImage(resolvedFile, this.app);
              return { type: "image", base64 };
            }
            const content = await this.app.vault.read(resolvedFile);
            return content;
          }
          const fileName = cleanPath.split("/").pop();
          if (fileName) {
            const allFiles = this.app.vault.getFiles();
            const matchingFile = allFiles.find((f) => f.name === fileName);
            if (matchingFile) {
              if (matchingFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
                const base64 = await ImageProcessor.processImage(matchingFile, this.app);
                return { type: "image", base64 };
              }
              const content = await this.app.vault.read(matchingFile);
              return content;
            }
          }
          return null;
        } catch (error) {
          return null;
        }
      }
      async buildContextMessageFromFile(filePath) {
        const content = await this.getContextFileContents(filePath);
        const displayName = filePath.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
        if (content) {
          if (typeof content === "string") {
            return {
              role: "user",
              content: `Context from ${displayName}:

${content}`,
              message_id: generateUUID()
            };
          } else if (content.type === "image") {
            return {
              role: "user",
              content: [
                {
                  type: "text",
                  text: `Context from ${displayName}:

`
                },
                {
                  type: "image_url",
                  image_url: {
                    url: `data:image/png;base64,${content.base64.replace(/^data:.*;base64,/, "")}`
                  }
                }
              ],
              message_id: generateUUID()
            };
          }
        }
        return null;
      }
      async prepareMessagesWithContext(messages, contextFiles, systemPromptType, systemPromptPath) {
        const preparedMessages = [];
        let systemPromptContent;
        if (systemPromptType === "custom" && systemPromptPath) {
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(systemPromptPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            systemPromptContent = await this.app.vault.read(resolvedFile);
          } else {
            const fileWithExt = this.app.vault.getAbstractFileByPath(`${systemPromptPath}.md`);
            if (fileWithExt instanceof import_obsidian.TFile) {
              systemPromptContent = await this.app.vault.read(fileWithExt);
            } else {
              const fileInSystemPromptsDir = this.app.vault.getAbstractFileByPath(`SystemSculpt/System Prompts/${systemPromptPath}.md`);
              if (fileInSystemPromptsDir instanceof import_obsidian.TFile) {
                systemPromptContent = await this.app.vault.read(fileInSystemPromptsDir);
              }
            }
          }
        } else if (systemPromptType) {
          try {
            const systemPromptService = new SystemPromptService(this.app);
            const preset = await systemPromptService.getSystemPromptById(systemPromptType);
            if (preset) {
              systemPromptContent = preset.systemPrompt;
            }
          } catch (error) {
          }
        }
        if (systemPromptContent) {
          preparedMessages.push({
            role: "system",
            content: systemPromptContent,
            message_id: crypto.randomUUID(),
            systemPromptType,
            systemPromptPath
          });
        }
        const documentIds = [];
        for (const filePath of contextFiles) {
          if (filePath.startsWith("doc:")) {
            const documentId = filePath.substring(4);
            documentIds.push(documentId);
          } else {
            const contextMessage = await this.buildContextMessageFromFile(filePath);
            if (contextMessage) {
              preparedMessages.push(contextMessage);
            }
          }
        }
        if (documentIds.length > 0) {
          const firstMessage = messages[0];
          if (firstMessage) {
            firstMessage.documentContext = { documentIds };
          }
        }
        for (const msg of messages) {
          preparedMessages.push({
            role: msg.role,
            content: msg.content,
            message_id: msg.message_id || generateUUID(),
            documentContext: msg.documentContext,
            systemPromptType: msg.systemPromptType,
            systemPromptPath: msg.systemPromptPath
          });
        }
        return preparedMessages;
      }
      normalizeDataPrefix(line) {
        if (!(line == null ? void 0 : line.trim()))
          return "";
        const trimmed = line.trim();
        if (trimmed === "data:" || trimmed === "data: " || trimmed === "[DONE]" || trimmed.startsWith(": OPENROUTER")) {
          return "";
        }
        return trimmed.replace(/^(?:data:\s*)+/, "");
      }
      isValidStreamEvent(data, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _i;
        if (!data)
          return false;
        try {
          const parsed = JSON.parse(data);
          return !!(parsed && (((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || ((_i = (_h = (_g = parsed.choices) == null ? void 0 : _g[0]) == null ? void 0 : _h.delta) == null ? void 0 : _i.function_call) || parsed.error));
        } catch (e) {
          return false;
        }
      }
      processStreamLine(line, isCustomProvider = false) {
        if (!line.trim().startsWith("data:")) {
          return null;
        }
        const normalized = this.normalizeDataPrefix(line);
        return this.isValidStreamEvent(normalized, isCustomProvider) ? normalized : null;
      }
      async handleStreamEvent(event, model, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f;
        if (!event)
          return null;
        try {
          let parsed;
          try {
            parsed = JSON.parse(event);
          } catch (parseError) {
            return null;
          }
          if (!parsed)
            return null;
          if (parsed.error) {
            const errorCode = parsed.error.code || ERROR_CODES.STREAM_ERROR;
            let errorMessage = parsed.error.message || getErrorMessage(errorCode, model);
            const metadata = {
              model,
              shouldResubmit: false,
              rawError: parsed.error,
              originalEvent: event
            };
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata.shouldResubmit = true;
            }
            throw new SystemSculptError(errorMessage, errorCode, parsed.error.statusCode || 500, metadata);
          }
          const content = ((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || null;
          const reasoning = ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || null;
          if (this.isInsideThinkTags) {
            let combinedText = "";
            if (reasoning)
              combinedText += reasoning;
            if (content)
              combinedText += content;
            const thinkEndMatch = combinedText.match(/(.*?)\s*<\/think>\s*(.*)/);
            if (thinkEndMatch) {
              this.isInsideThinkTags = false;
              return {
                reasoning: thinkEndMatch[1] || "",
                content: thinkEndMatch[2] || ""
              };
            }
            return {
              content: null,
              reasoning: combinedText || null
            };
          } else {
            if (content) {
              const thinkStartMatch = content.match(/<think>\s*(.*)/);
              if (thinkStartMatch) {
                this.isInsideThinkTags = true;
                return {
                  content: null,
                  reasoning: thinkStartMatch[1] || ""
                };
              }
            }
          }
          return { content, reasoning };
        } catch (e) {
          if (e instanceof SystemSculptError) {
            throw e;
          }
          return null;
        }
      }
      async processStreamChunk(chunk, buffer, model, isCustomProvider = false) {
        const decoded = _SystemSculptService.decoder.decode(chunk, { stream: true });
        const fullChunk = buffer + decoded;
        const lines = fullChunk.split("\n");
        const contents = [];
        const reasonings = [];
        for (let i = 0; i < lines.length - 1; i++) {
          const event = this.processStreamLine(lines[i], isCustomProvider);
          if (event) {
            const result = await this.handleStreamEvent(event, model, isCustomProvider);
            if (result) {
              if (result.content)
                contents.push(result.content);
              if (result.reasoning)
                reasonings.push(result.reasoning);
            }
          }
        }
        const newBuffer = lines[lines.length - 1].trim() ? lines[lines.length - 1] : "";
        return { newBuffer, contents, reasonings };
      }
      stripProviderPrefixes(modelId) {
        return modelId.replace(/^openrouter\//, "");
      }
      async getModelInfo(modelId) {
        if (this.settings.activeProvider.type === "custom") {
          const activeProvider = this.settings.customProviders.find((p) => p.id === this.settings.activeProvider.id && p.isEnabled);
          if (!activeProvider) {
            throw new SystemSculptError(`Provider ${this.settings.activeProvider.name} not found or disabled`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
          }
          return {
            isCustom: true,
            provider: activeProvider,
            actualModelId: modelId
          };
        }
        return {
          isCustom: false,
          actualModelId: this.stripProviderPrefixes(modelId)
        };
      }
      async handleCustomProviderCompletion(provider, messages, temperature, modelId, signal) {
        const endpoint = provider.endpoint.trim().replace(/\/$/, "");
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${provider.apiKey}`
        };
        if (endpoint.includes("openrouter.ai")) {
          headers["HTTP-Referer"] = "https://systemsculpt.com";
          headers["X-Title"] = "SystemSculpt AI";
        }
        const baseRequestBody = {
          model: modelId,
          messages: messages.map((msg) => ({
            role: msg.role,
            content: msg.content
          })),
          stream: true
        };
        const requestBody = {
          ...baseRequestBody,
          ...!endpoint.includes("api.openai.com") && { temperature },
          ...endpoint.includes("openrouter.ai") && {
            include_reasoning: true
          },
          ...endpoint.includes("api.openai.com") && modelId === "o3-mini" && {
            reasoning_effort: "high"
          }
        };
        if (endpoint.includes("api.openai.com") && modelId === "o3-mini") {
          console.log("Making OpenAI API call with o3-mini model:", {
            endpoint,
            modelId,
            requestBody
          });
        }
        const response = await fetch(`${endpoint}/chat/completions`, {
          method: "POST",
          headers,
          body: JSON.stringify(requestBody),
          signal
        });
        if (!response.ok) {
          await this.handleStreamError(response, true);
        }
        return response;
      }
      async *streamMessage({
        messages,
        model,
        temperature = 0.7,
        onError,
        contextFiles,
        systemPromptType,
        systemPromptPath,
        signal
      }) {
        try {
          this.isInsideThinkTags = false;
          const preparedMessages = await this.prepareMessagesWithContext(messages, contextFiles || new Set(), systemPromptType, systemPromptPath);
          const { isCustom, provider, actualModelId } = await this.getModelInfo(model);
          let response;
          if (isCustom && provider) {
            response = await this.handleCustomProviderCompletion(provider, preparedMessages, temperature, actualModelId, signal);
          } else {
            const requestBody = {
              model: actualModelId,
              messages: preparedMessages,
              temperature,
              stream: true,
              include_reasoning: true
            };
            response = await fetch(`${this.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.CHAT.COMPLETIONS}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "text/event-stream",
                "Cache-Control": "no-cache",
                "X-Request-ID": crypto.randomUUID(),
                "x-license-key": this.licenseKey
              },
              body: JSON.stringify(requestBody),
              signal
            });
          }
          if (!response.ok) {
            await this.handleStreamError(response, !!provider);
          }
          if (!response.body) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.STREAM_ERROR), ERROR_CODES.STREAM_ERROR, response.status);
          }
          const reader = response.body.getReader();
          let buffer = "";
          try {
            while (true) {
              const { done, value } = await reader.read();
              if (done) {
                const finalChunk = _SystemSculptService.decoder.decode();
                if (finalChunk) {
                  const event = this.processStreamLine(finalChunk);
                  if (event) {
                    const result = await this.handleStreamEvent(event, model, !!provider);
                    if (result) {
                      if (result.content || result.reasoning) {
                        yield {
                          content: result.content || void 0,
                          reasoning: result.reasoning || void 0
                        };
                      }
                    }
                  }
                }
                break;
              }
              const { newBuffer, contents, reasonings } = await this.processStreamChunk(value, buffer, model, !!provider);
              buffer = newBuffer;
              for (let i = 0; i < Math.max(contents.length, reasonings.length); i++) {
                yield {
                  content: contents[i],
                  reasoning: reasonings[i]
                };
              }
            }
          } finally {
            reader.releaseLock();
          }
        } catch (error) {
          if (error instanceof DOMException && error.name === "AbortError") {
            return;
          }
          if (onError) {
            let errorMessage = error instanceof Error ? error.message : getErrorMessage(ERROR_CODES.UNKNOWN_ERROR);
            if (error instanceof SystemSculptError && error.code === ERROR_CODES.STREAM_ERROR && error.statusCode === 400) {
              errorMessage += "\nPlease try again in a few moments. If the issue persists, try selecting a different model.";
            }
            onError(errorMessage);
          }
          throw error;
        }
      }
      async uploadDocument(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/documents/process`, {
            method: "POST",
            headers: {
              "x-license-key": this.licenseKey
            },
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          throw error;
        }
      }
      async uploadAudio(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/audio/transcriptions`, {
            method: "POST",
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Audio upload failed: ${response.status}`);
          }
          const result = await response.json();
          return result;
        } catch (error) {
          throw error;
        }
      }
      async preloadModels() {
        return Promise.resolve();
      }
    };
    SystemSculptService = _SystemSculptService;
    SystemSculptService.decoder = new TextDecoder();
  }
});

// src/core/ui/components/LoadingIndicator.ts
var init_LoadingIndicator = __esm({
  "src/core/ui/components/LoadingIndicator.ts"() {
  }
});

// src/core/ui/components/Button.ts
var init_Button = __esm({
  "src/core/ui/components/Button.ts"() {
  }
});

// src/core/ui/modals/TextAreaModal.ts
var import_obsidian2, TextAreaModal;
var init_TextAreaModal = __esm({
  "src/core/ui/modals/TextAreaModal.ts"() {
    import_obsidian2 = __toModule(require("obsidian"));
    TextAreaModal = class extends import_obsidian2.Modal {
      constructor(app, title, initialContent, options) {
        super(app);
        this.title = title;
        this.initialContent = initialContent;
        this.options = options;
        this.result = null;
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
      }
      onOpen() {
        var _a, _b, _c, _d, _e, _f;
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText(this.title);
        this.titleEl.addClass("systemsculpt-modal-title");
        const textAreaContainer = contentEl.createDiv("systemsculpt-textarea-container");
        if (((_a = this.options) == null ? void 0 : _a.presetButtons) && this.options.presetButtons.length > 0) {
          const presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
          this.options.presetButtons.forEach((preset) => {
            const button = presetButtonContainer.createEl("button", {
              text: preset.label,
              cls: "systemsculpt-preset-button"
            });
            button.onclick = () => {
              this.textArea.value = preset.value;
              const event = new Event("input", { bubbles: true });
              this.textArea.dispatchEvent(event);
            };
          });
        }
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            rows: ((_c = (_b = this.options) == null ? void 0 : _b.rows) == null ? void 0 : _c.toString()) || "10",
            placeholder: ((_d = this.options) == null ? void 0 : _d.placeholder) || ""
          }
        });
        this.textArea.value = this.initialContent;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = contentEl.createDiv("systemsculpt-button-container");
        if ((_e = this.options) == null ? void 0 : _e.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            text: this.options.secondaryButton,
            cls: "systemsculpt-button"
          });
          secondaryButton.onclick = () => {
            this.result = null;
            this.close();
          };
        }
        const primaryButton = buttonContainer.createEl("button", {
          text: ((_f = this.options) == null ? void 0 : _f.primaryButton) || "Save",
          cls: "systemsculpt-button mod-cta"
        });
        primaryButton.onclick = () => {
          this.result = this.textArea.value;
          this.close();
        };
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/core/ui/modals/PopupModal.ts
async function showPopup(app, message, options = {}) {
  const popup = new PopupComponent(app, message, options);
  return popup.open();
}
var import_obsidian3, PopupComponent;
var init_PopupModal = __esm({
  "src/core/ui/modals/PopupModal.ts"() {
    import_obsidian3 = __toModule(require("obsidian"));
    PopupComponent = class {
      constructor(app, message, options = {}) {
        this.result = null;
        this.app = app;
        this.message = message;
        this.options = options;
      }
      createPopup() {
        this.containerEl = document.createElement("div");
        this.containerEl.addClass("systemsculpt-popup-container");
        document.body.appendChild(this.containerEl);
        const popupEl = this.containerEl.createDiv({ cls: "systemsculpt-popup" });
        const content = popupEl.createDiv({ cls: "systemsculpt-popup-content" });
        if (this.options.title) {
          const titleEl = content.createDiv({ cls: "systemsculpt-popup-title" });
          if (this.options.icon) {
            const iconEl = titleEl.createSpan({ cls: "systemsculpt-popup-icon" });
            (0, import_obsidian3.setIcon)(iconEl, this.options.icon);
          }
          titleEl.createSpan({ text: this.options.title });
        }
        if (this.message) {
          content.createDiv({
            cls: "systemsculpt-popup-message",
            text: this.message
          });
        }
        if (this.options.description) {
          content.createDiv({
            cls: "systemsculpt-popup-description",
            text: this.options.description
          });
        }
        if (this.options.inputs) {
          const inputsContainer = content.createDiv({
            cls: "systemsculpt-popup-inputs"
          });
          this.options.inputs.forEach((input) => {
            if (input.type === "textarea") {
              inputsContainer.createEl("textarea", {
                cls: `systemsculpt-popup-textarea ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            } else {
              inputsContainer.createEl("input", {
                type: input.type,
                cls: `systemsculpt-popup-input ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            }
          });
        }
        const buttonContainer = popupEl.createDiv({
          cls: "systemsculpt-popup-buttons"
        });
        if (this.options.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            cls: "systemsculpt-popup-button systemsculpt-popup-button-secondary",
            text: this.options.secondaryButton
          });
          secondaryButton.addEventListener("click", () => {
            this.result = { confirmed: false };
            this.close();
          });
        }
        const primaryButton = buttonContainer.createEl("button", {
          cls: `systemsculpt-popup-button ${this.options.primaryButton === "Become A Patron" || this.options.primaryButton === "Become a Patron" ? "systemsculpt-popup-button-patron" : "systemsculpt-popup-button-primary"}`,
          text: this.options.primaryButton || "OK"
        });
        primaryButton.addEventListener("click", () => {
          if (this.options.inputs) {
            const inputs = Array.from(popupEl.querySelectorAll("input, textarea"));
            const hasEmptyRequired = inputs.some((input) => input.required && !input.value.trim());
            if (hasEmptyRequired) {
              return;
            }
            this.result = {
              confirmed: true,
              inputs: inputs.map((input) => input.value)
            };
          } else {
            this.result = { confirmed: true };
          }
          this.close();
        });
        this.containerEl.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            this.result = { confirmed: false };
            this.close();
          }
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey) {
            primaryButton.click();
          }
        });
        this.containerEl.addEventListener("mousedown", (e) => {
          if (e.target === this.containerEl) {
            this.result = { confirmed: false };
            this.close();
          }
        });
      }
      close() {
        this.containerEl.addClass("systemsculpt-popup-closing");
        setTimeout(() => {
          this.containerEl.remove();
          if (this.resolvePromise) {
            this.resolvePromise(this.result);
          }
        }, 200);
      }
      open() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.createPopup();
        });
      }
    };
  }
});

// src/core/ui/components/Notice.ts
function showEnhancedNotice(message, type, error) {
  if (error) {
    console.error("Notice error details:", {
      error,
      message: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
  }
  let duration;
  switch (type) {
    case "error":
      duration = 1e4;
      break;
    case "warning":
      duration = 5e3;
      break;
    default:
      duration = 3e3;
  }
  const notice = new import_obsidian4.Notice(message, duration);
  return notice;
}
var import_obsidian4;
var init_Notice = __esm({
  "src/core/ui/components/Notice.ts"() {
    import_obsidian4 = __toModule(require("obsidian"));
    init_errors();
  }
});

// src/core/ui/notifications.ts
function showNotice(message, options = {}) {
  const { type = "info", duration = 4e3 } = options;
  let prefix = "";
  switch (type) {
    case "success":
      prefix = "\u2728 ";
      break;
    case "error":
      prefix = "\u274C ";
      break;
    case "warning":
      prefix = "\u26A0\uFE0F ";
      break;
    case "info":
      prefix = "\u2139\uFE0F ";
      break;
  }
  new import_obsidian5.Notice(prefix + message, duration);
}
async function showAlert(app, message, options = {}) {
  const {
    title = options.type === "error" ? "Error" : options.type === "warning" ? "Warning" : "Alert",
    primaryButton = "OK",
    secondaryButton,
    icon = options.type === "error" ? "alert-circle" : options.type === "warning" ? "alert-triangle" : "info"
  } = options;
  const result = await showPopup(app, message, {
    title,
    primaryButton,
    secondaryButton,
    icon
  });
  return { confirmed: (result == null ? void 0 : result.confirmed) || false };
}
var import_obsidian5;
var init_notifications = __esm({
  "src/core/ui/notifications.ts"() {
    import_obsidian5 = __toModule(require("obsidian"));
    init_PopupModal();
  }
});

// src/core/ui/index.ts
var init_ui = __esm({
  "src/core/ui/index.ts"() {
    init_LoadingIndicator();
    init_Button();
    init_TextAreaModal();
    init_PopupModal();
    init_Notice();
    init_notifications();
  }
});

// src/components/FileSuggester.ts
function getFileSuggestions(app, directory) {
  const files = app.vault.getAllLoadedFiles().filter((file) => {
    var _a;
    if (!(file instanceof import_obsidian9.TFile))
      return false;
    const fileDir = (_a = file.parent) == null ? void 0 : _a.path;
    return fileDir === directory && file.extension === "md";
  });
  return new Set(files.map((file) => file.path));
}
function attachFileSuggester(inputEl, onSelect, app, directory) {
  return new FileSuggester(inputEl, onSelect, app, directory);
}
var import_obsidian9, FileSuggester;
var init_FileSuggester = __esm({
  "src/components/FileSuggester.ts"() {
    import_obsidian9 = __toModule(require("obsidian"));
    FileSuggester = class extends import_obsidian9.AbstractInputSuggest {
      constructor(inputEl, onSelectCb, app, directory) {
        super(app, inputEl);
        this.inputEl = inputEl;
        this.onSelectCb = onSelectCb;
        this.directory = directory;
        this.content = getFileSuggestions(app, directory);
      }
      getSuggestions(inputStr) {
        const lowerCaseInputStr = inputStr.toLowerCase();
        return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
      }
      renderSuggestion(content, el) {
        let display = content.replace(/\.md$/, "");
        el.setText(display);
      }
      selectSuggestion(content, evt) {
        this.onSelectCb(content);
        this.inputEl.value = content.replace(/\.md$/, "");
        this.inputEl.blur();
        this.close();
      }
    };
  }
});

// src/modals/PostProcessingPromptModal.ts
var PostProcessingPromptModal_exports = {};
__export(PostProcessingPromptModal_exports, {
  PostProcessingPromptModal: () => PostProcessingPromptModal,
  showPostProcessingPromptModal: () => showPostProcessingPromptModal
});
async function showPostProcessingPromptModal(app, plugin, currentPrompt, options) {
  const modal = new PostProcessingPromptModal(app, plugin, currentPrompt, options == null ? void 0 : options.systemPromptsDirectory, options == null ? void 0 : options.currentCustomPath);
  return await modal.openAndGetValue();
}
var import_obsidian11, PostProcessingPromptModal;
var init_PostProcessingPromptModal = __esm({
  "src/modals/PostProcessingPromptModal.ts"() {
    import_obsidian11 = __toModule(require("obsidian"));
    init_ui();
    init_FileSuggester();
    init_SystemSculptService();
    PostProcessingPromptModal = class extends import_obsidian11.Modal {
      constructor(app, plugin, currentPrompt, systemPromptsDirectory = "SystemSculpt/System Prompts", currentCustomPath) {
        super(app);
        this.plugin = plugin;
        this.currentPrompt = currentPrompt;
        this.systemPromptsDirectory = systemPromptsDirectory;
        this.currentCustomPath = currentCustomPath;
        this.result = null;
        this.activePreset = "general";
        this.prompts = [];
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        this.sculptService = SystemSculptService.getInstance(plugin.settings, app);
      }
      showLoading(show) {
        if (!this.loadingIndicator || !this.contentContainer)
          return;
        this.loadingIndicator.style.display = show ? "flex" : "none";
        this.contentContainer.style.display = show ? "none" : "block";
      }
      async loadPrompts() {
        try {
          this.showLoading(true);
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/post-transcription-prompts`);
          if (!response.ok) {
            throw new Error("Failed to load prompts");
          }
          const data = await response.json();
          this.prompts = data.data.prompts;
          this.createPresetButtons();
          this.showLoading(false);
        } catch (error) {
          console.error("Failed to load post-transcription prompts:", error);
          this.showLoading(false);
          await showPopup(this.app, "", {
            title: "Error",
            description: "Failed to load prompts. Please try again later.",
            primaryButton: "OK"
          });
        }
      }
      createPresetButtons() {
        if (!this.presetButtonContainer)
          return;
        this.presetButtonContainer.empty();
        if (this.currentCustomPath) {
          this.activePreset = "custom";
        } else {
          this.prompts.forEach((preset) => {
            if (preset.systemPrompt === this.currentPrompt) {
              this.activePreset = preset.id;
            }
          });
        }
        this.prompts.forEach((preset) => {
          const button = this.presetButtonContainer.createEl("button", {
            text: preset.label,
            cls: "systemsculpt-preset-button"
          });
          if (preset.description) {
            button.setAttribute("aria-label", preset.description);
            button.addClass("has-tooltip");
          }
          if (preset.id === this.activePreset) {
            button.addClass("active");
            if (this.textArea) {
              this.textArea.value = preset.systemPrompt;
              this.textArea.readOnly = !preset.isUserConfigurable;
            }
          }
          button.onclick = () => {
            this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
            button.addClass("active");
            this.activePreset = preset.id;
            if (preset.id === "custom") {
              this.customSection.style.display = "block";
              this.customInput.focus();
              if (this.textArea) {
                this.textArea.readOnly = false;
              }
            } else {
              this.customSection.style.display = "none";
              if (this.textArea) {
                this.textArea.value = preset.systemPrompt;
                this.textArea.readOnly = !preset.isUserConfigurable;
              }
            }
          };
        });
        if (this.activePreset === "custom") {
          this.customSection.style.display = "block";
          if (this.currentCustomPath) {
            this.customInput.value = this.currentCustomPath;
          }
        }
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Edit Post-Processing Prompt");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Configure how your transcriptions should be post-processed");
        descriptionEl.style.color = "var(--text-muted)";
        descriptionEl.style.fontSize = "0.9em";
        descriptionEl.style.marginTop = "0.2em";
        this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
        this.loadingIndicator.style.display = "none";
        this.loadingIndicator.style.justifyContent = "center";
        this.loadingIndicator.style.alignItems = "center";
        this.loadingIndicator.style.padding = "20px";
        const loadingText = this.loadingIndicator.createSpan();
        loadingText.setText("Loading prompts...");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
        this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
        this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
        this.customSection.style.display = "none";
        const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
        const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
        inputWrapper.style.display = "flex";
        inputWrapper.style.gap = "8px";
        inputWrapper.style.alignItems = "center";
        this.customInput = inputWrapper.createEl("input", {
          type: "text",
          placeholder: "Search for a system prompt file...",
          cls: "systemsculpt-custom-input"
        });
        const createButton2 = inputWrapper.createEl("button", {
          cls: "systemsculpt-create-button"
        });
        createButton2.style.padding = "4px 8px";
        createButton2.style.borderRadius = "4px";
        createButton2.style.cursor = "pointer";
        (0, import_obsidian11.setIcon)(createButton2, "plus");
        createButton2.addEventListener("click", async () => {
          var _a, _b;
          let templateContent = "";
          try {
            const response = await fetch(`${this.sculptService.baseUrl}/api/v1/system-prompts/template`);
            if (!response.ok) {
              throw new Error("Failed to fetch template");
            }
            const data = await response.json();
            templateContent = data.template;
          } catch (error) {
            console.error("Error fetching system prompt template:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: "Failed to fetch system prompt template. Please try again later.",
              primaryButton: "OK"
            });
            return;
          }
          const result = await showPopup(this.app, "", {
            title: "Create New System Prompt",
            description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
            primaryButton: "Create",
            secondaryButton: "Cancel",
            inputs: [
              {
                type: "text",
                placeholder: "My Custom Assistant",
                required: true,
                className: "systemsculpt-prompt-creation-title-input"
              },
              {
                type: "textarea",
                value: templateContent,
                required: true,
                className: "systemsculpt-prompt-creation-content"
              }
            ]
          });
          if (!(result == null ? void 0 : result.confirmed) || !((_a = result.inputs) == null ? void 0 : _a[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
            return;
          }
          const [title, content] = result.inputs;
          const fileName = title.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
          const filePath = `${this.systemPromptsDirectory}/${fileName}`;
          try {
            await this.app.vault.createFolder(this.systemPromptsDirectory).catch(() => {
            });
            const fileContent = `# ${title}

${content}`;
            const file = await this.app.vault.create(filePath + ".md", fileContent);
            if (!file) {
              throw new Error("Failed to create file");
            }
            if (this.textArea) {
              this.textArea.value = fileContent;
              this.textArea.readOnly = false;
            }
            this.customInput.value = filePath;
            await showPopup(this.app, "", {
              title: "Success",
              description: "System prompt file created successfully!",
              primaryButton: "OK"
            });
          } catch (error) {
            console.error("Error creating system prompt file:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: error instanceof Error ? error.message : "Failed to create system prompt file",
              primaryButton: "OK"
            });
          }
        });
        attachFileSuggester(this.customInput, async (selectedPath) => {
          try {
            const file = this.app.vault.getAbstractFileByPath(selectedPath);
            if (file instanceof import_obsidian11.TFile) {
              const content = await this.app.vault.read(file);
              this.textArea.value = content;
              this.textArea.readOnly = false;
              this.customInput.value = selectedPath.replace(/\.md$/, "");
            }
          } catch (error) {
            console.error("Error reading system prompt file:", error);
          }
        }, this.app, this.systemPromptsDirectory);
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            placeholder: "Enter post-processing prompt"
          }
        });
        this.textArea.value = this.currentPrompt;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        const primaryButton = buttonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          const activePreset = this.prompts.find((p) => p.id === this.activePreset);
          this.result = {
            content: this.textArea.value,
            type: (activePreset == null ? void 0 : activePreset.id) || "custom",
            path: this.activePreset === "custom" ? this.customInput.value : void 0
          };
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
        await this.loadPrompts();
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// ../node_modules/diff-match-patch/index.js
var require_diff_match_patch = __commonJS({
  "../node_modules/diff-match-patch/index.js"(exports, module2) {
    var diff_match_patch2 = function() {
      this.Diff_Timeout = 1;
      this.Diff_EditCost = 4;
      this.Match_Threshold = 0.5;
      this.Match_Distance = 1e3;
      this.Patch_DeleteThreshold = 0.5;
      this.Patch_Margin = 4;
      this.Match_MaxBits = 32;
    };
    var DIFF_DELETE2 = -1;
    var DIFF_INSERT2 = 1;
    var DIFF_EQUAL2 = 0;
    diff_match_patch2.Diff = function(op, text) {
      return [op, text];
    };
    diff_match_patch2.prototype.diff_main = function(text1, text2, opt_checklines, opt_deadline) {
      if (typeof opt_deadline == "undefined") {
        if (this.Diff_Timeout <= 0) {
          opt_deadline = Number.MAX_VALUE;
        } else {
          opt_deadline = new Date().getTime() + this.Diff_Timeout * 1e3;
        }
      }
      var deadline = opt_deadline;
      if (text1 == null || text2 == null) {
        throw new Error("Null input. (diff_main)");
      }
      if (text1 == text2) {
        if (text1) {
          return [new diff_match_patch2.Diff(DIFF_EQUAL2, text1)];
        }
        return [];
      }
      if (typeof opt_checklines == "undefined") {
        opt_checklines = true;
      }
      var checklines = opt_checklines;
      var commonlength = this.diff_commonPrefix(text1, text2);
      var commonprefix = text1.substring(0, commonlength);
      text1 = text1.substring(commonlength);
      text2 = text2.substring(commonlength);
      commonlength = this.diff_commonSuffix(text1, text2);
      var commonsuffix = text1.substring(text1.length - commonlength);
      text1 = text1.substring(0, text1.length - commonlength);
      text2 = text2.substring(0, text2.length - commonlength);
      var diffs = this.diff_compute_(text1, text2, checklines, deadline);
      if (commonprefix) {
        diffs.unshift(new diff_match_patch2.Diff(DIFF_EQUAL2, commonprefix));
      }
      if (commonsuffix) {
        diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, commonsuffix));
      }
      this.diff_cleanupMerge(diffs);
      return diffs;
    };
    diff_match_patch2.prototype.diff_compute_ = function(text1, text2, checklines, deadline) {
      var diffs;
      if (!text1) {
        return [new diff_match_patch2.Diff(DIFF_INSERT2, text2)];
      }
      if (!text2) {
        return [new diff_match_patch2.Diff(DIFF_DELETE2, text1)];
      }
      var longtext = text1.length > text2.length ? text1 : text2;
      var shorttext = text1.length > text2.length ? text2 : text1;
      var i = longtext.indexOf(shorttext);
      if (i != -1) {
        diffs = [
          new diff_match_patch2.Diff(DIFF_INSERT2, longtext.substring(0, i)),
          new diff_match_patch2.Diff(DIFF_EQUAL2, shorttext),
          new diff_match_patch2.Diff(DIFF_INSERT2, longtext.substring(i + shorttext.length))
        ];
        if (text1.length > text2.length) {
          diffs[0][0] = diffs[2][0] = DIFF_DELETE2;
        }
        return diffs;
      }
      if (shorttext.length == 1) {
        return [
          new diff_match_patch2.Diff(DIFF_DELETE2, text1),
          new diff_match_patch2.Diff(DIFF_INSERT2, text2)
        ];
      }
      var hm = this.diff_halfMatch_(text1, text2);
      if (hm) {
        var text1_a = hm[0];
        var text1_b = hm[1];
        var text2_a = hm[2];
        var text2_b = hm[3];
        var mid_common = hm[4];
        var diffs_a = this.diff_main(text1_a, text2_a, checklines, deadline);
        var diffs_b = this.diff_main(text1_b, text2_b, checklines, deadline);
        return diffs_a.concat([new diff_match_patch2.Diff(DIFF_EQUAL2, mid_common)], diffs_b);
      }
      if (checklines && text1.length > 100 && text2.length > 100) {
        return this.diff_lineMode_(text1, text2, deadline);
      }
      return this.diff_bisect_(text1, text2, deadline);
    };
    diff_match_patch2.prototype.diff_lineMode_ = function(text1, text2, deadline) {
      var a = this.diff_linesToChars_(text1, text2);
      text1 = a.chars1;
      text2 = a.chars2;
      var linearray = a.lineArray;
      var diffs = this.diff_main(text1, text2, false, deadline);
      this.diff_charsToLines_(diffs, linearray);
      this.diff_cleanupSemantic(diffs);
      diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, ""));
      var pointer = 0;
      var count_delete = 0;
      var count_insert = 0;
      var text_delete = "";
      var text_insert = "";
      while (pointer < diffs.length) {
        switch (diffs[pointer][0]) {
          case DIFF_INSERT2:
            count_insert++;
            text_insert += diffs[pointer][1];
            break;
          case DIFF_DELETE2:
            count_delete++;
            text_delete += diffs[pointer][1];
            break;
          case DIFF_EQUAL2:
            if (count_delete >= 1 && count_insert >= 1) {
              diffs.splice(pointer - count_delete - count_insert, count_delete + count_insert);
              pointer = pointer - count_delete - count_insert;
              var subDiff = this.diff_main(text_delete, text_insert, false, deadline);
              for (var j = subDiff.length - 1; j >= 0; j--) {
                diffs.splice(pointer, 0, subDiff[j]);
              }
              pointer = pointer + subDiff.length;
            }
            count_insert = 0;
            count_delete = 0;
            text_delete = "";
            text_insert = "";
            break;
        }
        pointer++;
      }
      diffs.pop();
      return diffs;
    };
    diff_match_patch2.prototype.diff_bisect_ = function(text1, text2, deadline) {
      var text1_length = text1.length;
      var text2_length = text2.length;
      var max_d = Math.ceil((text1_length + text2_length) / 2);
      var v_offset = max_d;
      var v_length = 2 * max_d;
      var v1 = new Array(v_length);
      var v2 = new Array(v_length);
      for (var x = 0; x < v_length; x++) {
        v1[x] = -1;
        v2[x] = -1;
      }
      v1[v_offset + 1] = 0;
      v2[v_offset + 1] = 0;
      var delta = text1_length - text2_length;
      var front = delta % 2 != 0;
      var k1start = 0;
      var k1end = 0;
      var k2start = 0;
      var k2end = 0;
      for (var d = 0; d < max_d; d++) {
        if (new Date().getTime() > deadline) {
          break;
        }
        for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {
          var k1_offset = v_offset + k1;
          var x1;
          if (k1 == -d || k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1]) {
            x1 = v1[k1_offset + 1];
          } else {
            x1 = v1[k1_offset - 1] + 1;
          }
          var y1 = x1 - k1;
          while (x1 < text1_length && y1 < text2_length && text1.charAt(x1) == text2.charAt(y1)) {
            x1++;
            y1++;
          }
          v1[k1_offset] = x1;
          if (x1 > text1_length) {
            k1end += 2;
          } else if (y1 > text2_length) {
            k1start += 2;
          } else if (front) {
            var k2_offset = v_offset + delta - k1;
            if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {
              var x2 = text1_length - v2[k2_offset];
              if (x1 >= x2) {
                return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);
              }
            }
          }
        }
        for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {
          var k2_offset = v_offset + k2;
          var x2;
          if (k2 == -d || k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1]) {
            x2 = v2[k2_offset + 1];
          } else {
            x2 = v2[k2_offset - 1] + 1;
          }
          var y2 = x2 - k2;
          while (x2 < text1_length && y2 < text2_length && text1.charAt(text1_length - x2 - 1) == text2.charAt(text2_length - y2 - 1)) {
            x2++;
            y2++;
          }
          v2[k2_offset] = x2;
          if (x2 > text1_length) {
            k2end += 2;
          } else if (y2 > text2_length) {
            k2start += 2;
          } else if (!front) {
            var k1_offset = v_offset + delta - k2;
            if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {
              var x1 = v1[k1_offset];
              var y1 = v_offset + x1 - k1_offset;
              x2 = text1_length - x2;
              if (x1 >= x2) {
                return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);
              }
            }
          }
        }
      }
      return [
        new diff_match_patch2.Diff(DIFF_DELETE2, text1),
        new diff_match_patch2.Diff(DIFF_INSERT2, text2)
      ];
    };
    diff_match_patch2.prototype.diff_bisectSplit_ = function(text1, text2, x, y, deadline) {
      var text1a = text1.substring(0, x);
      var text2a = text2.substring(0, y);
      var text1b = text1.substring(x);
      var text2b = text2.substring(y);
      var diffs = this.diff_main(text1a, text2a, false, deadline);
      var diffsb = this.diff_main(text1b, text2b, false, deadline);
      return diffs.concat(diffsb);
    };
    diff_match_patch2.prototype.diff_linesToChars_ = function(text1, text2) {
      var lineArray = [];
      var lineHash = {};
      lineArray[0] = "";
      function diff_linesToCharsMunge_(text) {
        var chars = "";
        var lineStart = 0;
        var lineEnd = -1;
        var lineArrayLength = lineArray.length;
        while (lineEnd < text.length - 1) {
          lineEnd = text.indexOf("\n", lineStart);
          if (lineEnd == -1) {
            lineEnd = text.length - 1;
          }
          var line = text.substring(lineStart, lineEnd + 1);
          if (lineHash.hasOwnProperty ? lineHash.hasOwnProperty(line) : lineHash[line] !== void 0) {
            chars += String.fromCharCode(lineHash[line]);
          } else {
            if (lineArrayLength == maxLines) {
              line = text.substring(lineStart);
              lineEnd = text.length;
            }
            chars += String.fromCharCode(lineArrayLength);
            lineHash[line] = lineArrayLength;
            lineArray[lineArrayLength++] = line;
          }
          lineStart = lineEnd + 1;
        }
        return chars;
      }
      var maxLines = 4e4;
      var chars1 = diff_linesToCharsMunge_(text1);
      maxLines = 65535;
      var chars2 = diff_linesToCharsMunge_(text2);
      return { chars1, chars2, lineArray };
    };
    diff_match_patch2.prototype.diff_charsToLines_ = function(diffs, lineArray) {
      for (var i = 0; i < diffs.length; i++) {
        var chars = diffs[i][1];
        var text = [];
        for (var j = 0; j < chars.length; j++) {
          text[j] = lineArray[chars.charCodeAt(j)];
        }
        diffs[i][1] = text.join("");
      }
    };
    diff_match_patch2.prototype.diff_commonPrefix = function(text1, text2) {
      if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {
        return 0;
      }
      var pointermin = 0;
      var pointermax = Math.min(text1.length, text2.length);
      var pointermid = pointermax;
      var pointerstart = 0;
      while (pointermin < pointermid) {
        if (text1.substring(pointerstart, pointermid) == text2.substring(pointerstart, pointermid)) {
          pointermin = pointermid;
          pointerstart = pointermin;
        } else {
          pointermax = pointermid;
        }
        pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);
      }
      return pointermid;
    };
    diff_match_patch2.prototype.diff_commonSuffix = function(text1, text2) {
      if (!text1 || !text2 || text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {
        return 0;
      }
      var pointermin = 0;
      var pointermax = Math.min(text1.length, text2.length);
      var pointermid = pointermax;
      var pointerend = 0;
      while (pointermin < pointermid) {
        if (text1.substring(text1.length - pointermid, text1.length - pointerend) == text2.substring(text2.length - pointermid, text2.length - pointerend)) {
          pointermin = pointermid;
          pointerend = pointermin;
        } else {
          pointermax = pointermid;
        }
        pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);
      }
      return pointermid;
    };
    diff_match_patch2.prototype.diff_commonOverlap_ = function(text1, text2) {
      var text1_length = text1.length;
      var text2_length = text2.length;
      if (text1_length == 0 || text2_length == 0) {
        return 0;
      }
      if (text1_length > text2_length) {
        text1 = text1.substring(text1_length - text2_length);
      } else if (text1_length < text2_length) {
        text2 = text2.substring(0, text1_length);
      }
      var text_length = Math.min(text1_length, text2_length);
      if (text1 == text2) {
        return text_length;
      }
      var best = 0;
      var length = 1;
      while (true) {
        var pattern = text1.substring(text_length - length);
        var found = text2.indexOf(pattern);
        if (found == -1) {
          return best;
        }
        length += found;
        if (found == 0 || text1.substring(text_length - length) == text2.substring(0, length)) {
          best = length;
          length++;
        }
      }
    };
    diff_match_patch2.prototype.diff_halfMatch_ = function(text1, text2) {
      if (this.Diff_Timeout <= 0) {
        return null;
      }
      var longtext = text1.length > text2.length ? text1 : text2;
      var shorttext = text1.length > text2.length ? text2 : text1;
      if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {
        return null;
      }
      var dmp = this;
      function diff_halfMatchI_(longtext2, shorttext2, i) {
        var seed = longtext2.substring(i, i + Math.floor(longtext2.length / 4));
        var j = -1;
        var best_common = "";
        var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;
        while ((j = shorttext2.indexOf(seed, j + 1)) != -1) {
          var prefixLength = dmp.diff_commonPrefix(longtext2.substring(i), shorttext2.substring(j));
          var suffixLength = dmp.diff_commonSuffix(longtext2.substring(0, i), shorttext2.substring(0, j));
          if (best_common.length < suffixLength + prefixLength) {
            best_common = shorttext2.substring(j - suffixLength, j) + shorttext2.substring(j, j + prefixLength);
            best_longtext_a = longtext2.substring(0, i - suffixLength);
            best_longtext_b = longtext2.substring(i + prefixLength);
            best_shorttext_a = shorttext2.substring(0, j - suffixLength);
            best_shorttext_b = shorttext2.substring(j + prefixLength);
          }
        }
        if (best_common.length * 2 >= longtext2.length) {
          return [
            best_longtext_a,
            best_longtext_b,
            best_shorttext_a,
            best_shorttext_b,
            best_common
          ];
        } else {
          return null;
        }
      }
      var hm1 = diff_halfMatchI_(longtext, shorttext, Math.ceil(longtext.length / 4));
      var hm2 = diff_halfMatchI_(longtext, shorttext, Math.ceil(longtext.length / 2));
      var hm;
      if (!hm1 && !hm2) {
        return null;
      } else if (!hm2) {
        hm = hm1;
      } else if (!hm1) {
        hm = hm2;
      } else {
        hm = hm1[4].length > hm2[4].length ? hm1 : hm2;
      }
      var text1_a, text1_b, text2_a, text2_b;
      if (text1.length > text2.length) {
        text1_a = hm[0];
        text1_b = hm[1];
        text2_a = hm[2];
        text2_b = hm[3];
      } else {
        text2_a = hm[0];
        text2_b = hm[1];
        text1_a = hm[2];
        text1_b = hm[3];
      }
      var mid_common = hm[4];
      return [text1_a, text1_b, text2_a, text2_b, mid_common];
    };
    diff_match_patch2.prototype.diff_cleanupSemantic = function(diffs) {
      var changes = false;
      var equalities = [];
      var equalitiesLength = 0;
      var lastEquality = null;
      var pointer = 0;
      var length_insertions1 = 0;
      var length_deletions1 = 0;
      var length_insertions2 = 0;
      var length_deletions2 = 0;
      while (pointer < diffs.length) {
        if (diffs[pointer][0] == DIFF_EQUAL2) {
          equalities[equalitiesLength++] = pointer;
          length_insertions1 = length_insertions2;
          length_deletions1 = length_deletions2;
          length_insertions2 = 0;
          length_deletions2 = 0;
          lastEquality = diffs[pointer][1];
        } else {
          if (diffs[pointer][0] == DIFF_INSERT2) {
            length_insertions2 += diffs[pointer][1].length;
          } else {
            length_deletions2 += diffs[pointer][1].length;
          }
          if (lastEquality && lastEquality.length <= Math.max(length_insertions1, length_deletions1) && lastEquality.length <= Math.max(length_insertions2, length_deletions2)) {
            diffs.splice(equalities[equalitiesLength - 1], 0, new diff_match_patch2.Diff(DIFF_DELETE2, lastEquality));
            diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT2;
            equalitiesLength--;
            equalitiesLength--;
            pointer = equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1;
            length_insertions1 = 0;
            length_deletions1 = 0;
            length_insertions2 = 0;
            length_deletions2 = 0;
            lastEquality = null;
            changes = true;
          }
        }
        pointer++;
      }
      if (changes) {
        this.diff_cleanupMerge(diffs);
      }
      this.diff_cleanupSemanticLossless(diffs);
      pointer = 1;
      while (pointer < diffs.length) {
        if (diffs[pointer - 1][0] == DIFF_DELETE2 && diffs[pointer][0] == DIFF_INSERT2) {
          var deletion = diffs[pointer - 1][1];
          var insertion = diffs[pointer][1];
          var overlap_length1 = this.diff_commonOverlap_(deletion, insertion);
          var overlap_length2 = this.diff_commonOverlap_(insertion, deletion);
          if (overlap_length1 >= overlap_length2) {
            if (overlap_length1 >= deletion.length / 2 || overlap_length1 >= insertion.length / 2) {
              diffs.splice(pointer, 0, new diff_match_patch2.Diff(DIFF_EQUAL2, insertion.substring(0, overlap_length1)));
              diffs[pointer - 1][1] = deletion.substring(0, deletion.length - overlap_length1);
              diffs[pointer + 1][1] = insertion.substring(overlap_length1);
              pointer++;
            }
          } else {
            if (overlap_length2 >= deletion.length / 2 || overlap_length2 >= insertion.length / 2) {
              diffs.splice(pointer, 0, new diff_match_patch2.Diff(DIFF_EQUAL2, deletion.substring(0, overlap_length2)));
              diffs[pointer - 1][0] = DIFF_INSERT2;
              diffs[pointer - 1][1] = insertion.substring(0, insertion.length - overlap_length2);
              diffs[pointer + 1][0] = DIFF_DELETE2;
              diffs[pointer + 1][1] = deletion.substring(overlap_length2);
              pointer++;
            }
          }
          pointer++;
        }
        pointer++;
      }
    };
    diff_match_patch2.prototype.diff_cleanupSemanticLossless = function(diffs) {
      function diff_cleanupSemanticScore_(one, two) {
        if (!one || !two) {
          return 6;
        }
        var char1 = one.charAt(one.length - 1);
        var char2 = two.charAt(0);
        var nonAlphaNumeric1 = char1.match(diff_match_patch2.nonAlphaNumericRegex_);
        var nonAlphaNumeric2 = char2.match(diff_match_patch2.nonAlphaNumericRegex_);
        var whitespace1 = nonAlphaNumeric1 && char1.match(diff_match_patch2.whitespaceRegex_);
        var whitespace2 = nonAlphaNumeric2 && char2.match(diff_match_patch2.whitespaceRegex_);
        var lineBreak1 = whitespace1 && char1.match(diff_match_patch2.linebreakRegex_);
        var lineBreak2 = whitespace2 && char2.match(diff_match_patch2.linebreakRegex_);
        var blankLine1 = lineBreak1 && one.match(diff_match_patch2.blanklineEndRegex_);
        var blankLine2 = lineBreak2 && two.match(diff_match_patch2.blanklineStartRegex_);
        if (blankLine1 || blankLine2) {
          return 5;
        } else if (lineBreak1 || lineBreak2) {
          return 4;
        } else if (nonAlphaNumeric1 && !whitespace1 && whitespace2) {
          return 3;
        } else if (whitespace1 || whitespace2) {
          return 2;
        } else if (nonAlphaNumeric1 || nonAlphaNumeric2) {
          return 1;
        }
        return 0;
      }
      var pointer = 1;
      while (pointer < diffs.length - 1) {
        if (diffs[pointer - 1][0] == DIFF_EQUAL2 && diffs[pointer + 1][0] == DIFF_EQUAL2) {
          var equality1 = diffs[pointer - 1][1];
          var edit = diffs[pointer][1];
          var equality2 = diffs[pointer + 1][1];
          var commonOffset = this.diff_commonSuffix(equality1, edit);
          if (commonOffset) {
            var commonString = edit.substring(edit.length - commonOffset);
            equality1 = equality1.substring(0, equality1.length - commonOffset);
            edit = commonString + edit.substring(0, edit.length - commonOffset);
            equality2 = commonString + equality2;
          }
          var bestEquality1 = equality1;
          var bestEdit = edit;
          var bestEquality2 = equality2;
          var bestScore = diff_cleanupSemanticScore_(equality1, edit) + diff_cleanupSemanticScore_(edit, equality2);
          while (edit.charAt(0) === equality2.charAt(0)) {
            equality1 += edit.charAt(0);
            edit = edit.substring(1) + equality2.charAt(0);
            equality2 = equality2.substring(1);
            var score = diff_cleanupSemanticScore_(equality1, edit) + diff_cleanupSemanticScore_(edit, equality2);
            if (score >= bestScore) {
              bestScore = score;
              bestEquality1 = equality1;
              bestEdit = edit;
              bestEquality2 = equality2;
            }
          }
          if (diffs[pointer - 1][1] != bestEquality1) {
            if (bestEquality1) {
              diffs[pointer - 1][1] = bestEquality1;
            } else {
              diffs.splice(pointer - 1, 1);
              pointer--;
            }
            diffs[pointer][1] = bestEdit;
            if (bestEquality2) {
              diffs[pointer + 1][1] = bestEquality2;
            } else {
              diffs.splice(pointer + 1, 1);
              pointer--;
            }
          }
        }
        pointer++;
      }
    };
    diff_match_patch2.nonAlphaNumericRegex_ = /[^a-zA-Z0-9]/;
    diff_match_patch2.whitespaceRegex_ = /\s/;
    diff_match_patch2.linebreakRegex_ = /[\r\n]/;
    diff_match_patch2.blanklineEndRegex_ = /\n\r?\n$/;
    diff_match_patch2.blanklineStartRegex_ = /^\r?\n\r?\n/;
    diff_match_patch2.prototype.diff_cleanupEfficiency = function(diffs) {
      var changes = false;
      var equalities = [];
      var equalitiesLength = 0;
      var lastEquality = null;
      var pointer = 0;
      var pre_ins = false;
      var pre_del = false;
      var post_ins = false;
      var post_del = false;
      while (pointer < diffs.length) {
        if (diffs[pointer][0] == DIFF_EQUAL2) {
          if (diffs[pointer][1].length < this.Diff_EditCost && (post_ins || post_del)) {
            equalities[equalitiesLength++] = pointer;
            pre_ins = post_ins;
            pre_del = post_del;
            lastEquality = diffs[pointer][1];
          } else {
            equalitiesLength = 0;
            lastEquality = null;
          }
          post_ins = post_del = false;
        } else {
          if (diffs[pointer][0] == DIFF_DELETE2) {
            post_del = true;
          } else {
            post_ins = true;
          }
          if (lastEquality && (pre_ins && pre_del && post_ins && post_del || lastEquality.length < this.Diff_EditCost / 2 && pre_ins + pre_del + post_ins + post_del == 3)) {
            diffs.splice(equalities[equalitiesLength - 1], 0, new diff_match_patch2.Diff(DIFF_DELETE2, lastEquality));
            diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT2;
            equalitiesLength--;
            lastEquality = null;
            if (pre_ins && pre_del) {
              post_ins = post_del = true;
              equalitiesLength = 0;
            } else {
              equalitiesLength--;
              pointer = equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1;
              post_ins = post_del = false;
            }
            changes = true;
          }
        }
        pointer++;
      }
      if (changes) {
        this.diff_cleanupMerge(diffs);
      }
    };
    diff_match_patch2.prototype.diff_cleanupMerge = function(diffs) {
      diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, ""));
      var pointer = 0;
      var count_delete = 0;
      var count_insert = 0;
      var text_delete = "";
      var text_insert = "";
      var commonlength;
      while (pointer < diffs.length) {
        switch (diffs[pointer][0]) {
          case DIFF_INSERT2:
            count_insert++;
            text_insert += diffs[pointer][1];
            pointer++;
            break;
          case DIFF_DELETE2:
            count_delete++;
            text_delete += diffs[pointer][1];
            pointer++;
            break;
          case DIFF_EQUAL2:
            if (count_delete + count_insert > 1) {
              if (count_delete !== 0 && count_insert !== 0) {
                commonlength = this.diff_commonPrefix(text_insert, text_delete);
                if (commonlength !== 0) {
                  if (pointer - count_delete - count_insert > 0 && diffs[pointer - count_delete - count_insert - 1][0] == DIFF_EQUAL2) {
                    diffs[pointer - count_delete - count_insert - 1][1] += text_insert.substring(0, commonlength);
                  } else {
                    diffs.splice(0, 0, new diff_match_patch2.Diff(DIFF_EQUAL2, text_insert.substring(0, commonlength)));
                    pointer++;
                  }
                  text_insert = text_insert.substring(commonlength);
                  text_delete = text_delete.substring(commonlength);
                }
                commonlength = this.diff_commonSuffix(text_insert, text_delete);
                if (commonlength !== 0) {
                  diffs[pointer][1] = text_insert.substring(text_insert.length - commonlength) + diffs[pointer][1];
                  text_insert = text_insert.substring(0, text_insert.length - commonlength);
                  text_delete = text_delete.substring(0, text_delete.length - commonlength);
                }
              }
              pointer -= count_delete + count_insert;
              diffs.splice(pointer, count_delete + count_insert);
              if (text_delete.length) {
                diffs.splice(pointer, 0, new diff_match_patch2.Diff(DIFF_DELETE2, text_delete));
                pointer++;
              }
              if (text_insert.length) {
                diffs.splice(pointer, 0, new diff_match_patch2.Diff(DIFF_INSERT2, text_insert));
                pointer++;
              }
              pointer++;
            } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL2) {
              diffs[pointer - 1][1] += diffs[pointer][1];
              diffs.splice(pointer, 1);
            } else {
              pointer++;
            }
            count_insert = 0;
            count_delete = 0;
            text_delete = "";
            text_insert = "";
            break;
        }
      }
      if (diffs[diffs.length - 1][1] === "") {
        diffs.pop();
      }
      var changes = false;
      pointer = 1;
      while (pointer < diffs.length - 1) {
        if (diffs[pointer - 1][0] == DIFF_EQUAL2 && diffs[pointer + 1][0] == DIFF_EQUAL2) {
          if (diffs[pointer][1].substring(diffs[pointer][1].length - diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {
            diffs[pointer][1] = diffs[pointer - 1][1] + diffs[pointer][1].substring(0, diffs[pointer][1].length - diffs[pointer - 1][1].length);
            diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];
            diffs.splice(pointer - 1, 1);
            changes = true;
          } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) == diffs[pointer + 1][1]) {
            diffs[pointer - 1][1] += diffs[pointer + 1][1];
            diffs[pointer][1] = diffs[pointer][1].substring(diffs[pointer + 1][1].length) + diffs[pointer + 1][1];
            diffs.splice(pointer + 1, 1);
            changes = true;
          }
        }
        pointer++;
      }
      if (changes) {
        this.diff_cleanupMerge(diffs);
      }
    };
    diff_match_patch2.prototype.diff_xIndex = function(diffs, loc) {
      var chars1 = 0;
      var chars2 = 0;
      var last_chars1 = 0;
      var last_chars2 = 0;
      var x;
      for (x = 0; x < diffs.length; x++) {
        if (diffs[x][0] !== DIFF_INSERT2) {
          chars1 += diffs[x][1].length;
        }
        if (diffs[x][0] !== DIFF_DELETE2) {
          chars2 += diffs[x][1].length;
        }
        if (chars1 > loc) {
          break;
        }
        last_chars1 = chars1;
        last_chars2 = chars2;
      }
      if (diffs.length != x && diffs[x][0] === DIFF_DELETE2) {
        return last_chars2;
      }
      return last_chars2 + (loc - last_chars1);
    };
    diff_match_patch2.prototype.diff_prettyHtml = function(diffs) {
      var html = [];
      var pattern_amp = /&/g;
      var pattern_lt = /</g;
      var pattern_gt = />/g;
      var pattern_para = /\n/g;
      for (var x = 0; x < diffs.length; x++) {
        var op = diffs[x][0];
        var data = diffs[x][1];
        var text = data.replace(pattern_amp, "&amp;").replace(pattern_lt, "&lt;").replace(pattern_gt, "&gt;").replace(pattern_para, "&para;<br>");
        switch (op) {
          case DIFF_INSERT2:
            html[x] = '<ins style="background:#e6ffe6;">' + text + "</ins>";
            break;
          case DIFF_DELETE2:
            html[x] = '<del style="background:#ffe6e6;">' + text + "</del>";
            break;
          case DIFF_EQUAL2:
            html[x] = "<span>" + text + "</span>";
            break;
        }
      }
      return html.join("");
    };
    diff_match_patch2.prototype.diff_text1 = function(diffs) {
      var text = [];
      for (var x = 0; x < diffs.length; x++) {
        if (diffs[x][0] !== DIFF_INSERT2) {
          text[x] = diffs[x][1];
        }
      }
      return text.join("");
    };
    diff_match_patch2.prototype.diff_text2 = function(diffs) {
      var text = [];
      for (var x = 0; x < diffs.length; x++) {
        if (diffs[x][0] !== DIFF_DELETE2) {
          text[x] = diffs[x][1];
        }
      }
      return text.join("");
    };
    diff_match_patch2.prototype.diff_levenshtein = function(diffs) {
      var levenshtein = 0;
      var insertions = 0;
      var deletions = 0;
      for (var x = 0; x < diffs.length; x++) {
        var op = diffs[x][0];
        var data = diffs[x][1];
        switch (op) {
          case DIFF_INSERT2:
            insertions += data.length;
            break;
          case DIFF_DELETE2:
            deletions += data.length;
            break;
          case DIFF_EQUAL2:
            levenshtein += Math.max(insertions, deletions);
            insertions = 0;
            deletions = 0;
            break;
        }
      }
      levenshtein += Math.max(insertions, deletions);
      return levenshtein;
    };
    diff_match_patch2.prototype.diff_toDelta = function(diffs) {
      var text = [];
      for (var x = 0; x < diffs.length; x++) {
        switch (diffs[x][0]) {
          case DIFF_INSERT2:
            text[x] = "+" + encodeURI(diffs[x][1]);
            break;
          case DIFF_DELETE2:
            text[x] = "-" + diffs[x][1].length;
            break;
          case DIFF_EQUAL2:
            text[x] = "=" + diffs[x][1].length;
            break;
        }
      }
      return text.join("	").replace(/%20/g, " ");
    };
    diff_match_patch2.prototype.diff_fromDelta = function(text1, delta) {
      var diffs = [];
      var diffsLength = 0;
      var pointer = 0;
      var tokens = delta.split(/\t/g);
      for (var x = 0; x < tokens.length; x++) {
        var param = tokens[x].substring(1);
        switch (tokens[x].charAt(0)) {
          case "+":
            try {
              diffs[diffsLength++] = new diff_match_patch2.Diff(DIFF_INSERT2, decodeURI(param));
            } catch (ex) {
              throw new Error("Illegal escape in diff_fromDelta: " + param);
            }
            break;
          case "-":
          case "=":
            var n = parseInt(param, 10);
            if (isNaN(n) || n < 0) {
              throw new Error("Invalid number in diff_fromDelta: " + param);
            }
            var text = text1.substring(pointer, pointer += n);
            if (tokens[x].charAt(0) == "=") {
              diffs[diffsLength++] = new diff_match_patch2.Diff(DIFF_EQUAL2, text);
            } else {
              diffs[diffsLength++] = new diff_match_patch2.Diff(DIFF_DELETE2, text);
            }
            break;
          default:
            if (tokens[x]) {
              throw new Error("Invalid diff operation in diff_fromDelta: " + tokens[x]);
            }
        }
      }
      if (pointer != text1.length) {
        throw new Error("Delta length (" + pointer + ") does not equal source text length (" + text1.length + ").");
      }
      return diffs;
    };
    diff_match_patch2.prototype.match_main = function(text, pattern, loc) {
      if (text == null || pattern == null || loc == null) {
        throw new Error("Null input. (match_main)");
      }
      loc = Math.max(0, Math.min(loc, text.length));
      if (text == pattern) {
        return 0;
      } else if (!text.length) {
        return -1;
      } else if (text.substring(loc, loc + pattern.length) == pattern) {
        return loc;
      } else {
        return this.match_bitap_(text, pattern, loc);
      }
    };
    diff_match_patch2.prototype.match_bitap_ = function(text, pattern, loc) {
      if (pattern.length > this.Match_MaxBits) {
        throw new Error("Pattern too long for this browser.");
      }
      var s = this.match_alphabet_(pattern);
      var dmp = this;
      function match_bitapScore_(e, x) {
        var accuracy = e / pattern.length;
        var proximity = Math.abs(loc - x);
        if (!dmp.Match_Distance) {
          return proximity ? 1 : accuracy;
        }
        return accuracy + proximity / dmp.Match_Distance;
      }
      var score_threshold = this.Match_Threshold;
      var best_loc = text.indexOf(pattern, loc);
      if (best_loc != -1) {
        score_threshold = Math.min(match_bitapScore_(0, best_loc), score_threshold);
        best_loc = text.lastIndexOf(pattern, loc + pattern.length);
        if (best_loc != -1) {
          score_threshold = Math.min(match_bitapScore_(0, best_loc), score_threshold);
        }
      }
      var matchmask = 1 << pattern.length - 1;
      best_loc = -1;
      var bin_min, bin_mid;
      var bin_max = pattern.length + text.length;
      var last_rd;
      for (var d = 0; d < pattern.length; d++) {
        bin_min = 0;
        bin_mid = bin_max;
        while (bin_min < bin_mid) {
          if (match_bitapScore_(d, loc + bin_mid) <= score_threshold) {
            bin_min = bin_mid;
          } else {
            bin_max = bin_mid;
          }
          bin_mid = Math.floor((bin_max - bin_min) / 2 + bin_min);
        }
        bin_max = bin_mid;
        var start = Math.max(1, loc - bin_mid + 1);
        var finish = Math.min(loc + bin_mid, text.length) + pattern.length;
        var rd = Array(finish + 2);
        rd[finish + 1] = (1 << d) - 1;
        for (var j = finish; j >= start; j--) {
          var charMatch = s[text.charAt(j - 1)];
          if (d === 0) {
            rd[j] = (rd[j + 1] << 1 | 1) & charMatch;
          } else {
            rd[j] = (rd[j + 1] << 1 | 1) & charMatch | ((last_rd[j + 1] | last_rd[j]) << 1 | 1) | last_rd[j + 1];
          }
          if (rd[j] & matchmask) {
            var score = match_bitapScore_(d, j - 1);
            if (score <= score_threshold) {
              score_threshold = score;
              best_loc = j - 1;
              if (best_loc > loc) {
                start = Math.max(1, 2 * loc - best_loc);
              } else {
                break;
              }
            }
          }
        }
        if (match_bitapScore_(d + 1, loc) > score_threshold) {
          break;
        }
        last_rd = rd;
      }
      return best_loc;
    };
    diff_match_patch2.prototype.match_alphabet_ = function(pattern) {
      var s = {};
      for (var i = 0; i < pattern.length; i++) {
        s[pattern.charAt(i)] = 0;
      }
      for (var i = 0; i < pattern.length; i++) {
        s[pattern.charAt(i)] |= 1 << pattern.length - i - 1;
      }
      return s;
    };
    diff_match_patch2.prototype.patch_addContext_ = function(patch, text) {
      if (text.length == 0) {
        return;
      }
      if (patch.start2 === null) {
        throw Error("patch not initialized");
      }
      var pattern = text.substring(patch.start2, patch.start2 + patch.length1);
      var padding = 0;
      while (text.indexOf(pattern) != text.lastIndexOf(pattern) && pattern.length < this.Match_MaxBits - this.Patch_Margin - this.Patch_Margin) {
        padding += this.Patch_Margin;
        pattern = text.substring(patch.start2 - padding, patch.start2 + patch.length1 + padding);
      }
      padding += this.Patch_Margin;
      var prefix = text.substring(patch.start2 - padding, patch.start2);
      if (prefix) {
        patch.diffs.unshift(new diff_match_patch2.Diff(DIFF_EQUAL2, prefix));
      }
      var suffix = text.substring(patch.start2 + patch.length1, patch.start2 + patch.length1 + padding);
      if (suffix) {
        patch.diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, suffix));
      }
      patch.start1 -= prefix.length;
      patch.start2 -= prefix.length;
      patch.length1 += prefix.length + suffix.length;
      patch.length2 += prefix.length + suffix.length;
    };
    diff_match_patch2.prototype.patch_make = function(a, opt_b, opt_c) {
      var text1, diffs;
      if (typeof a == "string" && typeof opt_b == "string" && typeof opt_c == "undefined") {
        text1 = a;
        diffs = this.diff_main(text1, opt_b, true);
        if (diffs.length > 2) {
          this.diff_cleanupSemantic(diffs);
          this.diff_cleanupEfficiency(diffs);
        }
      } else if (a && typeof a == "object" && typeof opt_b == "undefined" && typeof opt_c == "undefined") {
        diffs = a;
        text1 = this.diff_text1(diffs);
      } else if (typeof a == "string" && opt_b && typeof opt_b == "object" && typeof opt_c == "undefined") {
        text1 = a;
        diffs = opt_b;
      } else if (typeof a == "string" && typeof opt_b == "string" && opt_c && typeof opt_c == "object") {
        text1 = a;
        diffs = opt_c;
      } else {
        throw new Error("Unknown call format to patch_make.");
      }
      if (diffs.length === 0) {
        return [];
      }
      var patches = [];
      var patch = new diff_match_patch2.patch_obj();
      var patchDiffLength = 0;
      var char_count1 = 0;
      var char_count2 = 0;
      var prepatch_text = text1;
      var postpatch_text = text1;
      for (var x = 0; x < diffs.length; x++) {
        var diff_type = diffs[x][0];
        var diff_text = diffs[x][1];
        if (!patchDiffLength && diff_type !== DIFF_EQUAL2) {
          patch.start1 = char_count1;
          patch.start2 = char_count2;
        }
        switch (diff_type) {
          case DIFF_INSERT2:
            patch.diffs[patchDiffLength++] = diffs[x];
            patch.length2 += diff_text.length;
            postpatch_text = postpatch_text.substring(0, char_count2) + diff_text + postpatch_text.substring(char_count2);
            break;
          case DIFF_DELETE2:
            patch.length1 += diff_text.length;
            patch.diffs[patchDiffLength++] = diffs[x];
            postpatch_text = postpatch_text.substring(0, char_count2) + postpatch_text.substring(char_count2 + diff_text.length);
            break;
          case DIFF_EQUAL2:
            if (diff_text.length <= 2 * this.Patch_Margin && patchDiffLength && diffs.length != x + 1) {
              patch.diffs[patchDiffLength++] = diffs[x];
              patch.length1 += diff_text.length;
              patch.length2 += diff_text.length;
            } else if (diff_text.length >= 2 * this.Patch_Margin) {
              if (patchDiffLength) {
                this.patch_addContext_(patch, prepatch_text);
                patches.push(patch);
                patch = new diff_match_patch2.patch_obj();
                patchDiffLength = 0;
                prepatch_text = postpatch_text;
                char_count1 = char_count2;
              }
            }
            break;
        }
        if (diff_type !== DIFF_INSERT2) {
          char_count1 += diff_text.length;
        }
        if (diff_type !== DIFF_DELETE2) {
          char_count2 += diff_text.length;
        }
      }
      if (patchDiffLength) {
        this.patch_addContext_(patch, prepatch_text);
        patches.push(patch);
      }
      return patches;
    };
    diff_match_patch2.prototype.patch_deepCopy = function(patches) {
      var patchesCopy = [];
      for (var x = 0; x < patches.length; x++) {
        var patch = patches[x];
        var patchCopy = new diff_match_patch2.patch_obj();
        patchCopy.diffs = [];
        for (var y = 0; y < patch.diffs.length; y++) {
          patchCopy.diffs[y] = new diff_match_patch2.Diff(patch.diffs[y][0], patch.diffs[y][1]);
        }
        patchCopy.start1 = patch.start1;
        patchCopy.start2 = patch.start2;
        patchCopy.length1 = patch.length1;
        patchCopy.length2 = patch.length2;
        patchesCopy[x] = patchCopy;
      }
      return patchesCopy;
    };
    diff_match_patch2.prototype.patch_apply = function(patches, text) {
      if (patches.length == 0) {
        return [text, []];
      }
      patches = this.patch_deepCopy(patches);
      var nullPadding = this.patch_addPadding(patches);
      text = nullPadding + text + nullPadding;
      this.patch_splitMax(patches);
      var delta = 0;
      var results = [];
      for (var x = 0; x < patches.length; x++) {
        var expected_loc = patches[x].start2 + delta;
        var text1 = this.diff_text1(patches[x].diffs);
        var start_loc;
        var end_loc = -1;
        if (text1.length > this.Match_MaxBits) {
          start_loc = this.match_main(text, text1.substring(0, this.Match_MaxBits), expected_loc);
          if (start_loc != -1) {
            end_loc = this.match_main(text, text1.substring(text1.length - this.Match_MaxBits), expected_loc + text1.length - this.Match_MaxBits);
            if (end_loc == -1 || start_loc >= end_loc) {
              start_loc = -1;
            }
          }
        } else {
          start_loc = this.match_main(text, text1, expected_loc);
        }
        if (start_loc == -1) {
          results[x] = false;
          delta -= patches[x].length2 - patches[x].length1;
        } else {
          results[x] = true;
          delta = start_loc - expected_loc;
          var text2;
          if (end_loc == -1) {
            text2 = text.substring(start_loc, start_loc + text1.length);
          } else {
            text2 = text.substring(start_loc, end_loc + this.Match_MaxBits);
          }
          if (text1 == text2) {
            text = text.substring(0, start_loc) + this.diff_text2(patches[x].diffs) + text.substring(start_loc + text1.length);
          } else {
            var diffs = this.diff_main(text1, text2, false);
            if (text1.length > this.Match_MaxBits && this.diff_levenshtein(diffs) / text1.length > this.Patch_DeleteThreshold) {
              results[x] = false;
            } else {
              this.diff_cleanupSemanticLossless(diffs);
              var index1 = 0;
              var index2;
              for (var y = 0; y < patches[x].diffs.length; y++) {
                var mod = patches[x].diffs[y];
                if (mod[0] !== DIFF_EQUAL2) {
                  index2 = this.diff_xIndex(diffs, index1);
                }
                if (mod[0] === DIFF_INSERT2) {
                  text = text.substring(0, start_loc + index2) + mod[1] + text.substring(start_loc + index2);
                } else if (mod[0] === DIFF_DELETE2) {
                  text = text.substring(0, start_loc + index2) + text.substring(start_loc + this.diff_xIndex(diffs, index1 + mod[1].length));
                }
                if (mod[0] !== DIFF_DELETE2) {
                  index1 += mod[1].length;
                }
              }
            }
          }
        }
      }
      text = text.substring(nullPadding.length, text.length - nullPadding.length);
      return [text, results];
    };
    diff_match_patch2.prototype.patch_addPadding = function(patches) {
      var paddingLength = this.Patch_Margin;
      var nullPadding = "";
      for (var x = 1; x <= paddingLength; x++) {
        nullPadding += String.fromCharCode(x);
      }
      for (var x = 0; x < patches.length; x++) {
        patches[x].start1 += paddingLength;
        patches[x].start2 += paddingLength;
      }
      var patch = patches[0];
      var diffs = patch.diffs;
      if (diffs.length == 0 || diffs[0][0] != DIFF_EQUAL2) {
        diffs.unshift(new diff_match_patch2.Diff(DIFF_EQUAL2, nullPadding));
        patch.start1 -= paddingLength;
        patch.start2 -= paddingLength;
        patch.length1 += paddingLength;
        patch.length2 += paddingLength;
      } else if (paddingLength > diffs[0][1].length) {
        var extraLength = paddingLength - diffs[0][1].length;
        diffs[0][1] = nullPadding.substring(diffs[0][1].length) + diffs[0][1];
        patch.start1 -= extraLength;
        patch.start2 -= extraLength;
        patch.length1 += extraLength;
        patch.length2 += extraLength;
      }
      patch = patches[patches.length - 1];
      diffs = patch.diffs;
      if (diffs.length == 0 || diffs[diffs.length - 1][0] != DIFF_EQUAL2) {
        diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, nullPadding));
        patch.length1 += paddingLength;
        patch.length2 += paddingLength;
      } else if (paddingLength > diffs[diffs.length - 1][1].length) {
        var extraLength = paddingLength - diffs[diffs.length - 1][1].length;
        diffs[diffs.length - 1][1] += nullPadding.substring(0, extraLength);
        patch.length1 += extraLength;
        patch.length2 += extraLength;
      }
      return nullPadding;
    };
    diff_match_patch2.prototype.patch_splitMax = function(patches) {
      var patch_size = this.Match_MaxBits;
      for (var x = 0; x < patches.length; x++) {
        if (patches[x].length1 <= patch_size) {
          continue;
        }
        var bigpatch = patches[x];
        patches.splice(x--, 1);
        var start1 = bigpatch.start1;
        var start2 = bigpatch.start2;
        var precontext = "";
        while (bigpatch.diffs.length !== 0) {
          var patch = new diff_match_patch2.patch_obj();
          var empty = true;
          patch.start1 = start1 - precontext.length;
          patch.start2 = start2 - precontext.length;
          if (precontext !== "") {
            patch.length1 = patch.length2 = precontext.length;
            patch.diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, precontext));
          }
          while (bigpatch.diffs.length !== 0 && patch.length1 < patch_size - this.Patch_Margin) {
            var diff_type = bigpatch.diffs[0][0];
            var diff_text = bigpatch.diffs[0][1];
            if (diff_type === DIFF_INSERT2) {
              patch.length2 += diff_text.length;
              start2 += diff_text.length;
              patch.diffs.push(bigpatch.diffs.shift());
              empty = false;
            } else if (diff_type === DIFF_DELETE2 && patch.diffs.length == 1 && patch.diffs[0][0] == DIFF_EQUAL2 && diff_text.length > 2 * patch_size) {
              patch.length1 += diff_text.length;
              start1 += diff_text.length;
              empty = false;
              patch.diffs.push(new diff_match_patch2.Diff(diff_type, diff_text));
              bigpatch.diffs.shift();
            } else {
              diff_text = diff_text.substring(0, patch_size - patch.length1 - this.Patch_Margin);
              patch.length1 += diff_text.length;
              start1 += diff_text.length;
              if (diff_type === DIFF_EQUAL2) {
                patch.length2 += diff_text.length;
                start2 += diff_text.length;
              } else {
                empty = false;
              }
              patch.diffs.push(new diff_match_patch2.Diff(diff_type, diff_text));
              if (diff_text == bigpatch.diffs[0][1]) {
                bigpatch.diffs.shift();
              } else {
                bigpatch.diffs[0][1] = bigpatch.diffs[0][1].substring(diff_text.length);
              }
            }
          }
          precontext = this.diff_text2(patch.diffs);
          precontext = precontext.substring(precontext.length - this.Patch_Margin);
          var postcontext = this.diff_text1(bigpatch.diffs).substring(0, this.Patch_Margin);
          if (postcontext !== "") {
            patch.length1 += postcontext.length;
            patch.length2 += postcontext.length;
            if (patch.diffs.length !== 0 && patch.diffs[patch.diffs.length - 1][0] === DIFF_EQUAL2) {
              patch.diffs[patch.diffs.length - 1][1] += postcontext;
            } else {
              patch.diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, postcontext));
            }
          }
          if (!empty) {
            patches.splice(++x, 0, patch);
          }
        }
      }
    };
    diff_match_patch2.prototype.patch_toText = function(patches) {
      var text = [];
      for (var x = 0; x < patches.length; x++) {
        text[x] = patches[x];
      }
      return text.join("");
    };
    diff_match_patch2.prototype.patch_fromText = function(textline) {
      var patches = [];
      if (!textline) {
        return patches;
      }
      var text = textline.split("\n");
      var textPointer = 0;
      var patchHeader = /^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;
      while (textPointer < text.length) {
        var m = text[textPointer].match(patchHeader);
        if (!m) {
          throw new Error("Invalid patch string: " + text[textPointer]);
        }
        var patch = new diff_match_patch2.patch_obj();
        patches.push(patch);
        patch.start1 = parseInt(m[1], 10);
        if (m[2] === "") {
          patch.start1--;
          patch.length1 = 1;
        } else if (m[2] == "0") {
          patch.length1 = 0;
        } else {
          patch.start1--;
          patch.length1 = parseInt(m[2], 10);
        }
        patch.start2 = parseInt(m[3], 10);
        if (m[4] === "") {
          patch.start2--;
          patch.length2 = 1;
        } else if (m[4] == "0") {
          patch.length2 = 0;
        } else {
          patch.start2--;
          patch.length2 = parseInt(m[4], 10);
        }
        textPointer++;
        while (textPointer < text.length) {
          var sign = text[textPointer].charAt(0);
          try {
            var line = decodeURI(text[textPointer].substring(1));
          } catch (ex) {
            throw new Error("Illegal escape in patch_fromText: " + line);
          }
          if (sign == "-") {
            patch.diffs.push(new diff_match_patch2.Diff(DIFF_DELETE2, line));
          } else if (sign == "+") {
            patch.diffs.push(new diff_match_patch2.Diff(DIFF_INSERT2, line));
          } else if (sign == " ") {
            patch.diffs.push(new diff_match_patch2.Diff(DIFF_EQUAL2, line));
          } else if (sign == "@") {
            break;
          } else if (sign === "") {
          } else {
            throw new Error('Invalid patch mode "' + sign + '" in: ' + line);
          }
          textPointer++;
        }
      }
      return patches;
    };
    diff_match_patch2.patch_obj = function() {
      this.diffs = [];
      this.start1 = null;
      this.start2 = null;
      this.length1 = 0;
      this.length2 = 0;
    };
    diff_match_patch2.patch_obj.prototype.toString = function() {
      var coords1, coords2;
      if (this.length1 === 0) {
        coords1 = this.start1 + ",0";
      } else if (this.length1 == 1) {
        coords1 = this.start1 + 1;
      } else {
        coords1 = this.start1 + 1 + "," + this.length1;
      }
      if (this.length2 === 0) {
        coords2 = this.start2 + ",0";
      } else if (this.length2 == 1) {
        coords2 = this.start2 + 1;
      } else {
        coords2 = this.start2 + 1 + "," + this.length2;
      }
      var text = ["@@ -" + coords1 + " +" + coords2 + " @@\n"];
      var op;
      for (var x = 0; x < this.diffs.length; x++) {
        switch (this.diffs[x][0]) {
          case DIFF_INSERT2:
            op = "+";
            break;
          case DIFF_DELETE2:
            op = "-";
            break;
          case DIFF_EQUAL2:
            op = " ";
            break;
        }
        text[x + 1] = op + encodeURI(this.diffs[x][1]) + "\n";
      }
      return text.join("").replace(/%20/g, " ");
    };
    module2.exports = diff_match_patch2;
    module2.exports["diff_match_patch"] = diff_match_patch2;
    module2.exports["DIFF_DELETE"] = DIFF_DELETE2;
    module2.exports["DIFF_INSERT"] = DIFF_INSERT2;
    module2.exports["DIFF_EQUAL"] = DIFF_EQUAL2;
  }
});

// src/main.ts
__export(exports, {
  default: () => SystemSculptPlugin
});
var import_obsidian33 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/modals/SettingsTab.ts
var import_obsidian12 = __toModule(require("obsidian"));
init_ui();

// src/types/llm.ts
var DEFAULT_FILTER_SETTINGS = {
  showVisionModels: false,
  showReasoningModels: false,
  showCreativeModels: false
};

// src/types.ts
var PATREON_URL = "https://www.patreon.com/systemsculpt/membership";
var DEFAULT_SETTINGS = {
  licenseKey: "",
  licenseValid: false,
  selectedModelId: "",
  chatsDirectory: "SystemSculpt/Chats",
  lastValidated: 0,
  systemPrompt: "You are a helpful AI assistant. You help users with their questions and tasks in a clear and concise way.",
  recordingsDirectory: "SystemSculpt/Recordings",
  developmentMode: false,
  preferredMicrophoneId: "",
  autoTranscribeRecordings: true,
  autoPasteTranscription: true,
  postProcessingPrompt: "You are a transcription post-processor. Your task is to fix any transcription errors, correct grammar and punctuation, and ensure the text is properly formatted. Keep the original meaning intact while making the text more readable.",
  postProcessingEnabled: false,
  showModelTooltips: false,
  showVisionModelsOnly: false,
  showTopPicksOnly: false,
  selectedProvider: "all",
  serverUrl: "http://localhost:3001",
  attachmentsDirectory: "SystemSculpt/Attachments",
  extractionsDirectory: "SystemSculpt/Extractions",
  systemPromptsDirectory: "SystemSculpt/System Prompts",
  tasksDirectory: "SystemSculpt/Tasks",
  moveCompletedTasksDown: true,
  systemPromptType: "general-use",
  systemPromptPath: "",
  customProviders: [],
  modelFilterSettings: DEFAULT_FILTER_SETTINGS,
  favoriteModels: [],
  activeProvider: {
    id: "systemsculpt",
    name: "SystemSculpt",
    type: "native"
  }
};

// src/modals/SettingsTab.ts
init_SystemSculptService();

// src/modals/ModelSelectionModal.ts
var import_obsidian7 = __toModule(require("obsidian"));

// src/services/SearchService.ts
var SearchService = class {
  constructor() {
    this.DEFAULT_INITIAL_RESULTS_LIMIT = 25;
    this.DEFAULT_MAX_FILTERED_RESULTS = 50;
  }
  search(items, query, getSearchableFields, options) {
    var _a, _b;
    const initialLimit = (_a = options == null ? void 0 : options.initialResultsLimit) != null ? _a : this.DEFAULT_INITIAL_RESULTS_LIMIT;
    const maxFiltered = (_b = options == null ? void 0 : options.maxFilteredResults) != null ? _b : this.DEFAULT_MAX_FILTERED_RESULTS;
    if (!query.trim()) {
      return items.slice(0, initialLimit).map((item) => ({
        item,
        matches: [],
        score: 0
      }));
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
    const searchResults = items.map((item) => {
      const fields = getSearchableFields(item);
      const matches = [];
      let totalScore = 0;
      fields.forEach((field) => {
        if (!field.text)
          return;
        const fieldText = field.text;
        const fieldTextLower = fieldText.toLowerCase();
        const allTermsFound = searchTerms.every((term) => fieldTextLower.includes(term));
        if (allTermsFound) {
          searchTerms.forEach((term) => {
            const match = this.findMatches(fieldText, term);
            if (match.indices.length > 0) {
              matches.push({
                field: field.field,
                text: fieldText,
                indices: match.indices,
                matchQuality: match.quality
              });
              let score = field.weight * match.quality;
              if (searchTerms.length > 1) {
                const termPositions = searchTerms.map((t) => {
                  const idx = fieldTextLower.indexOf(t);
                  return idx >= 0 ? idx : Infinity;
                });
                const maxDistance = Math.max(...termPositions) - Math.min(...termPositions.filter((p) => p !== Infinity));
                if (maxDistance < 50) {
                  score *= 2;
                }
              }
              totalScore += score;
            }
          });
        }
      });
      return {
        item,
        matches,
        score: totalScore
      };
    });
    const validResults = searchResults.filter((result) => {
      if (result.matches.length === 0)
        return false;
      const foundTerms = new Set();
      result.matches.forEach((match) => {
        const text = match.text.toLowerCase();
        searchTerms.forEach((term) => {
          if (text.includes(term))
            foundTerms.add(term);
        });
      });
      return foundTerms.size === searchTerms.length;
    });
    return validResults.sort((a, b) => b.score - a.score).slice(0, maxFiltered);
  }
  findMatches(text, query) {
    const normalizedText = text.toLowerCase();
    const normalizedQuery = query.toLowerCase().trim();
    const indices = [];
    let quality = 0;
    if (normalizedQuery.length === 1) {
      const regex = new RegExp(`\\b${normalizedQuery}\\b`, "gi");
      let match;
      while ((match = regex.exec(text)) !== null) {
        indices.push(match.index);
        quality = 1;
      }
      return { indices, quality };
    }
    let pos = 0;
    while ((pos = normalizedText.indexOf(normalizedQuery, pos)) !== -1) {
      const beforeChar = pos > 0 ? normalizedText[pos - 1] : " ";
      const afterChar = pos + normalizedQuery.length < normalizedText.length ? normalizedText[pos + normalizedQuery.length] : " ";
      if ((/\s/.test(beforeChar) || /\W/.test(beforeChar) || pos === 0) && (/\s/.test(afterChar) || /\W/.test(afterChar) || pos + normalizedQuery.length === normalizedText.length)) {
        quality = 1;
      } else {
        quality = 0.8;
      }
      for (let i = 0; i < normalizedQuery.length; i++) {
        indices.push(pos + i);
      }
      pos += 1;
    }
    return { indices: [...new Set(indices)].sort((a, b) => a - b), quality };
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-search-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
    }
    return fragment;
  }
};

// src/modals/ModelSelectionHelper.ts
var ModelSelectionHelper = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.logger = console;
    this.filterSettings = { ...this.plugin.settings.modelFilterSettings };
  }
  getFilterSettings() {
    return this.filterSettings;
  }
  async setFilterSetting(key, value) {
    this.filterSettings[key] = value;
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  async resetFilterSettings() {
    this.filterSettings = { ...DEFAULT_FILTER_SETTINGS };
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  formatPrice(price) {
    try {
      if (price === null || price === void 0 || price === "0") {
        return "Free";
      }
      const numericPrice = typeof price === "string" ? parseFloat(price) : price;
      if (isNaN(numericPrice) || numericPrice === 0) {
        return "Free";
      }
      const pricePerMillion = numericPrice * 1e6;
      return `$${pricePerMillion.toFixed(2)}`;
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error formatting price", {
        price,
        error
      });
      return "Price error";
    }
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        const textNode = document.createTextNode(text.slice(lastIndex, match.index));
        fragment.appendChild(textNode);
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-model-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      const textNode = document.createTextNode(text.slice(lastIndex));
      fragment.appendChild(textNode);
    }
    return fragment;
  }
  sortModels(models) {
    const tiers = {
      favorites: [],
      essential: [],
      advanced: [],
      professional: [],
      custom: []
    };
    models.forEach((model) => {
      if (model.isFavorite) {
        tiers.favorites.push(model);
        return;
      }
      if (model.provider === "custom") {
        tiers.custom.push(model);
      } else {
      }
    });
    Object.values(tiers).forEach((tierModels) => {
      tierModels.sort((a, b) => a.name.localeCompare(b.name));
    });
    const sortedModels = [];
    if (tiers.favorites.length > 0) {
      sortedModels.push(...tiers.favorites);
    }
    sortedModels.push(...tiers.essential);
    sortedModels.push(...tiers.advanced);
    sortedModels.push(...tiers.professional);
    sortedModels.push(...tiers.custom);
    return sortedModels;
  }
  filterModels(models) {
    try {
      return models.filter((model) => {
        var _a, _b, _c;
        try {
          const hasVisionCapability = ((_a = model.capabilities) == null ? void 0 : _a.includes("vision")) || false;
          const hasReasoningCapability = ((_b = model.capabilities) == null ? void 0 : _b.includes("reasoning")) || false;
          const hasCreativeCapability = ((_c = model.capabilities) == null ? void 0 : _c.includes("creative")) || false;
          if (!Object.values(this.filterSettings).some((value) => value)) {
            return true;
          }
          return (!this.filterSettings.showVisionModels || hasVisionCapability) && (!this.filterSettings.showReasoningModels || hasReasoningCapability) && (!this.filterSettings.showCreativeModels || hasCreativeCapability);
        } catch (error) {
          this.logger.error("ModelSelectionHelper: Error filtering individual model", {
            model,
            error
          });
          return false;
        }
      });
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error in filterModels", error);
      return models;
    }
  }
};

// src/modals/CustomProviderModal.ts
var import_obsidian6 = __toModule(require("obsidian"));
var CustomProviderManagerModal = class extends import_obsidian6.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  renderProviderCard(provider, container) {
    const card = container.createDiv("systemsculpt-custom-provider-card");
    const header = card.createDiv("systemsculpt-custom-provider-card-header");
    header.createEl("h3", {
      text: provider.name,
      cls: "systemsculpt-custom-provider-card-name"
    });
    const actions = header.createDiv("systemsculpt-custom-provider-card-actions");
    const deleteBtn = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-card-action delete"
    });
    (0, import_obsidian6.setIcon)(deleteBtn, "trash-2");
    deleteBtn.addEventListener("click", async (e) => {
      e.stopPropagation();
      this.plugin.settings.customProviders = this.plugin.settings.customProviders.filter((p) => p.id !== provider.id);
      await this.plugin.saveSettings();
      await this.plugin.modelService.getModels();
      this.renderProviderList();
    });
    const details = card.createDiv("systemsculpt-custom-provider-card-details");
    const typeDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian6.setIcon)(typeDetail.createSpan(), "box");
    typeDetail.createSpan({
      text: "OpenAI Compatible"
    });
    const endpointDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian6.setIcon)(endpointDetail.createSpan(), "link");
    endpointDetail.createSpan({ text: provider.endpoint });
    const statusDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    const toggleContainer = statusDetail.createDiv({
      cls: "systemsculpt-custom-provider-toggle-container"
    });
    toggleContainer.createSpan({
      text: provider.isEnabled ? "Enabled" : "Disabled",
      cls: "systemsculpt-custom-provider-toggle-label"
    });
    const toggle = toggleContainer.createDiv({
      cls: `checkbox-container ${provider.isEnabled ? "is-enabled" : ""}`
    });
    toggle.createDiv({ cls: "checkbox-toggle" });
    toggle.addEventListener("click", async (e) => {
      e.stopPropagation();
      if (provider.isEnabled) {
        provider.isEnabled = false;
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.renderProviderList();
        return;
      }
      toggle.addClass("testing");
      const result = await this.plugin.customProviderService.testConnection(provider);
      toggle.removeClass("testing");
      if (result.success) {
        provider.isEnabled = true;
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.renderProviderList();
      } else {
        new import_obsidian6.Notice(`Failed to enable ${provider.name}: ${result.error || "Connection failed"}`, 5e3);
      }
    });
  }
  renderProviderList() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-manager-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-manager-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-back"
    });
    (0, import_obsidian6.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Models" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Custom Providers" });
    const content = contentEl.createDiv("systemsculpt-custom-provider-manager-content");
    const listContainer = content.createDiv("systemsculpt-custom-provider-manager-list");
    const providers = this.plugin.settings.customProviders;
    if (providers.length === 0) {
      const emptyState = listContainer.createDiv("systemsculpt-custom-provider-manager-empty");
      const emptyIcon = emptyState.createDiv("systemsculpt-custom-provider-manager-empty-icon");
      (0, import_obsidian6.setIcon)(emptyIcon, "server-off");
      emptyState.createDiv({
        cls: "systemsculpt-custom-provider-manager-empty-text",
        text: "No custom providers added yet"
      });
    } else {
      providers.forEach((provider) => {
        this.renderProviderCard(provider, listContainer);
      });
    }
    const actions = content.createDiv("systemsculpt-custom-provider-manager-actions");
    const addButton = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-button systemsculpt-custom-provider-manager-button-primary",
      text: "Add Provider"
    });
    (0, import_obsidian6.setIcon)(addButton.createSpan(), "plus");
    addButton.addEventListener("click", () => {
      this.close();
      const customProviderModal = new CustomProviderModal(this.app, this.plugin, () => {
        const managerModal = new CustomProviderManagerModal(this.app, this.plugin, this.onBack);
        managerModal.open();
      });
      customProviderModal.open();
    });
  }
  onOpen() {
    this.renderProviderList();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var CustomProviderModal = class extends import_obsidian6.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-back"
    });
    (0, import_obsidian6.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Providers" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Add Custom Provider" });
    const form = contentEl.createDiv("systemsculpt-custom-provider-form");
    const nameGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    nameGroup.createEl("label", { text: "Provider Name" });
    const nameInput = nameGroup.createEl("input", {
      type: "text",
      placeholder: "e.g., LM Studio, OpenAI",
      attr: {
        maxlength: "25"
      }
    });
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const urlGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    urlGroup.createEl("label", { text: "API Endpoint URL" });
    const presetContainer = urlGroup.createDiv("systemsculpt-custom-provider-presets");
    presetContainer.createEl("label", { text: "Quick Setup:" });
    const presetButtons = presetContainer.createDiv("systemsculpt-custom-provider-preset-buttons");
    const openAIButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenAI"
    });
    openAIButton.addEventListener("click", () => {
      nameInput.value = "OpenAI";
      urlInput.value = "https://api.openai.com/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const openRouterButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenRouter"
    });
    openRouterButton.addEventListener("click", () => {
      nameInput.value = "OpenRouter";
      urlInput.value = "https://openrouter.ai/api/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const groqButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Groq"
    });
    groqButton.addEventListener("click", () => {
      nameInput.value = "Groq";
      urlInput.value = "https://api.groq.com/openai/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const lmStudioButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "LM Studio"
    });
    lmStudioButton.addEventListener("click", () => {
      nameInput.value = "LM Studio";
      urlInput.value = "http://localhost:1234/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const ollamaButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Ollama"
    });
    ollamaButton.addEventListener("click", () => {
      nameInput.value = "Ollama";
      urlInput.value = "http://localhost:11434/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const urlInput = urlGroup.createEl("input", {
      type: "text",
      placeholder: "https://your-api-endpoint.com"
    });
    const urlError = urlGroup.createDiv({
      cls: "systemsculpt-custom-provider-error systemsculpt-custom-provider-error-hidden",
      text: " "
    });
    const validateEndpointUrl = (url) => {
      try {
        const parsedUrl = new URL(url);
        const isLocal = parsedUrl.hostname === "localhost" || parsedUrl.hostname === "127.0.0.1";
        if (isLocal && parsedUrl.protocol !== "http:") {
          return { isValid: false, error: "Local endpoints must use HTTP" };
        }
        if (!isLocal && parsedUrl.protocol !== "https:") {
          return { isValid: false, error: "Remote endpoints must use HTTPS" };
        }
        if (isLocal && !parsedUrl.port) {
          return {
            isValid: false,
            error: "Local endpoints require a port number"
          };
        }
        return { isValid: true };
      } catch (e) {
        return { isValid: false, error: "Invalid URL format" };
      }
    };
    const apiKeyGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    apiKeyGroup.createEl("label", { text: "API Key (Optional)" });
    const apiKeyInput = apiKeyGroup.createEl("input", {
      type: "password",
      placeholder: "Enter your API key"
    });
    const resetValidation = () => {
      isConnectionTested = false;
      testResult = null;
      updateButtonState("test");
      urlError.addClass("systemsculpt-custom-provider-error-hidden");
      urlError.removeClass("systemsculpt-custom-provider-success");
    };
    nameInput.addEventListener("input", resetValidation);
    urlInput.addEventListener("input", resetValidation);
    apiKeyInput.addEventListener("input", resetValidation);
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const formActions = form.createDiv("systemsculpt-custom-provider-form-actions");
    const cancelButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-secondary",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    const actionButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-primary",
      text: "Test Connection"
    });
    let isConnectionTested = false;
    let testResult = null;
    const createProviderFromForm = () => ({
      id: crypto.randomUUID(),
      name: nameInput.value.trim(),
      endpoint: urlInput.value.trim(),
      apiKey: apiKeyInput.value.trim(),
      isEnabled: true,
      lastTested: Date.now()
    });
    const updateButtonState = (state) => {
      switch (state) {
        case "test":
          actionButton.setText("Test Connection");
          actionButton.removeAttribute("disabled");
          break;
        case "testing":
          actionButton.setText("Testing...");
          actionButton.setAttribute("disabled", "true");
          break;
        case "retry":
          actionButton.setText("Try Again");
          actionButton.removeAttribute("disabled");
          break;
        case "save":
          actionButton.setText("Save Provider");
          actionButton.removeAttribute("disabled");
          break;
      }
    };
    const validateForm = () => {
      if (!nameInput.value.trim()) {
        return { isValid: false, error: "Provider name is required" };
      }
      const urlValidation = validateEndpointUrl(urlInput.value);
      if (!urlValidation.isValid) {
        return urlValidation;
      }
      const isLocal = urlInput.value.includes("localhost") || urlInput.value.includes("127.0.0.1");
      if (!isLocal && !apiKeyInput.value.trim()) {
        return {
          isValid: false,
          error: "API key is required for remote endpoints"
        };
      }
      return { isValid: true };
    };
    actionButton.addEventListener("click", async () => {
      var _a;
      const validation = validateForm();
      if (!validation.isValid) {
        urlError.textContent = validation.error || "Invalid form data";
        urlError.removeClass("systemsculpt-custom-provider-error-hidden");
        return;
      }
      if (!isConnectionTested) {
        updateButtonState("testing");
        const provider = createProviderFromForm();
        const result = await this.plugin.customProviderService.testConnection(provider);
        if (result.success) {
          isConnectionTested = true;
          updateButtonState("save");
          testResult = result;
          urlError.textContent = `Connection successful! Found ${((_a = result.models) == null ? void 0 : _a.length) || 0} models.`;
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.addClass("systemsculpt-custom-provider-success");
        } else {
          updateButtonState("retry");
          urlError.textContent = result.error || "Connection failed";
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.removeClass("systemsculpt-custom-provider-success");
        }
      } else {
        const provider = createProviderFromForm();
        this.plugin.settings.customProviders = [
          ...this.plugin.settings.customProviders,
          provider
        ];
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.close();
        this.onBack();
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/ModelSelectionModal.ts
var ModelSelectionModal = class extends import_obsidian7.Modal {
  constructor(app, currentModelId, onSelect, plugin) {
    super(app);
    this.allModels = [];
    this.selectedCardIndex = -1;
    this.modelCards = [];
    this.isClosing = false;
    this.getSearchableFields = (model) => {
      return [
        { field: "name", text: model.name, weight: 200 },
        ...model.name.split(/[\s\-:\.]+/).map((part) => ({
          field: "name",
          text: part,
          weight: 150
        })),
        ...model.provider === "custom" ? [{ field: "provider", text: model.id.split("-")[0], weight: 180 }] : [],
        { field: "description", text: model.description || "", weight: 50 }
      ];
    };
    this.selectedModelId = currentModelId;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.logger = console;
    this.helper = new ModelSelectionHelper(plugin);
    this.searchService = new SearchService();
  }
  async onOpen() {
    try {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.addClass("systemsculpt-model-selection-modal");
      this.createSearchUI();
      this.createModelGrid();
      this.setupSearch();
      const loadingContainer = this.modelGrid.createDiv({
        cls: "systemsculpt-loading-container"
      });
      const loadingSpinner = loadingContainer.createDiv({
        cls: "systemsculpt-loading-spinner"
      });
      (0, import_obsidian7.setIcon)(loadingSpinner, "loader-2");
      loadingContainer.createDiv({
        cls: "systemsculpt-loading-text",
        text: "Loading models..."
      });
      this.allModels = await this.plugin.getInitialModels();
      this.renderModels(this.getVisibleModels());
    } catch (error) {
      this.logger.error("ModelSelectionModal: Error in onOpen", error);
      this.contentEl.createDiv({
        cls: "systemsculpt-error-message",
        text: "Error loading model selection modal"
      });
    }
  }
  getVisibleModels() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.allModels.map((m) => ({ item: m, matches: [], score: 0 }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.allModels, query, (model) => this.getSearchableFields(model), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
  createSearchUI() {
    const searchContainer = this.contentEl.createDiv({
      cls: "systemsculpt-search-container"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search models...",
      cls: "systemsculpt-search-input"
    });
    const providersButton = searchContainer.createEl("button", {
      cls: "systemsculpt-providers-button"
    });
    (0, import_obsidian7.setIcon)(providersButton.createSpan(), "settings");
    providersButton.createSpan({ text: "Providers" });
    providersButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modelSelectionModal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modelSelectionModal.open();
      });
      managerModal.open();
    });
  }
  createModelGrid() {
    this.modelGrid = this.contentEl.createDiv({
      cls: "systemsculpt-model-grid"
    });
  }
  setupSearch() {
    var _a, _b, _c;
    this.searchInput.addEventListener("input", () => {
      const results = this.getVisibleModels();
      this.renderModels(results);
    });
    this.contentEl.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey) {
          this.selectedCardIndex = this.selectedCardIndex <= 0 ? this.modelCards.length - 1 : this.selectedCardIndex - 1;
        } else {
          this.selectedCardIndex = this.selectedCardIndex >= this.modelCards.length - 1 ? 0 : this.selectedCardIndex + 1;
        }
        this.modelCards.forEach((card, i) => {
          const isSelected = i === this.selectedCardIndex;
          card.classList.toggle("systemsculpt-keyboard-selected", isSelected);
          if (isSelected) {
            card.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }
        });
        this.searchInput.focus();
      } else if (e.key === "Enter") {
        const highlightedCard = this.modelCards[this.selectedCardIndex];
        if (highlightedCard) {
          e.preventDefault();
          const modelId = highlightedCard.dataset.modelId;
          if (modelId) {
            this.onSelect(modelId);
            this.close();
          }
        }
      }
    });
    (_a = this.modelGrid) == null ? void 0 : _a.addEventListener("wheel", () => {
    }, { passive: true });
    (_b = this.modelGrid) == null ? void 0 : _b.addEventListener("touchstart", () => {
    }, { passive: true });
    (_c = this.modelGrid) == null ? void 0 : _c.addEventListener("touchmove", () => {
    }, { passive: true });
  }
  renderModels(searchResults) {
    var _a, _b;
    if (!this.modelGrid)
      return;
    this.modelGrid.empty();
    this.modelCards = [];
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const hasValidLicense = (_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim();
    const favorites = [];
    const nonFavorites = [];
    const visibleModels = searchResults.map((sr) => sr.item);
    visibleModels.forEach((model) => {
      if (!hasValidLicense && model.provider === "systemsculpt") {
        return;
      }
      if (model.isFavorite) {
        favorites.push(model);
      } else {
        nonFavorites.push(model);
      }
    });
    if (favorites.length > 0) {
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => {
        if (a.provider === "systemsculpt" && b.provider !== "systemsculpt")
          return -1;
        if (a.provider !== "systemsculpt" && b.provider === "systemsculpt")
          return 1;
        if (a.provider !== b.provider) {
          return a.provider.localeCompare(b.provider);
        }
        return a.name.localeCompare(b.name);
      });
      favorites.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    const modelsByProvider = new Map();
    nonFavorites.forEach((model) => {
      var _a2;
      const provider = model.provider;
      if (!modelsByProvider.has(provider)) {
        modelsByProvider.set(provider, []);
      }
      (_a2 = modelsByProvider.get(provider)) == null ? void 0 : _a2.push(model);
    });
    const systemsculptHeader = this.modelGrid.createDiv({
      cls: "systemsculpt-provider-header"
    });
    systemsculptHeader.createSpan({ text: "SystemSculpt Models" });
    if (!hasValidLicense && searchResults.some((sr) => sr.item.provider === "systemsculpt")) {
      this.createProInfoMessage(this.modelGrid);
    }
    if (hasValidLicense && modelsByProvider.has("systemsculpt")) {
      const systemsculptModels = modelsByProvider.get("systemsculpt") || [];
      const sortedSystemsculptModels = systemsculptModels.sort((a, b) => a.name.localeCompare(b.name));
      sortedSystemsculptModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    modelsByProvider.delete("systemsculpt");
    const sortedProviders = Array.from(modelsByProvider.keys()).sort((a, b) => a.localeCompare(b));
    sortedProviders.forEach((provider) => {
      const models = modelsByProvider.get(provider) || [];
      if (models.length === 0)
        return;
      const sortedModels = models.sort((a, b) => a.name.localeCompare(b.name));
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      const providerName = `${provider.charAt(0).toUpperCase() + provider.slice(1)} Models`;
      header.createSpan({ text: providerName });
      sortedModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    });
    if (this.modelCards.length === 0) {
      if ((_b = this.searchInput) == null ? void 0 : _b.value) {
        const noResultsCard = this.renderNoResultsCard();
        this.modelGrid.appendChild(noResultsCard);
      } else {
        this.createCustomProviderInfoMessage(this.modelGrid);
      }
    }
  }
  renderNoResultsCard() {
    const card = createDiv({ cls: "systemsculpt-model-card" });
    const iconsContainer = card.createDiv({ cls: "systemsculpt-model-icons" });
    const searchIcon = iconsContainer.createDiv({
      cls: "systemsculpt-model-icon systemsculpt-pricing-low"
    });
    (0, import_obsidian7.setIcon)(searchIcon, "search");
    const nameContainer = card.createDiv({
      cls: "systemsculpt-model-name-container"
    });
    nameContainer.createDiv({
      cls: "systemsculpt-model-name",
      text: "No models found"
    });
    const description = card.createDiv({
      cls: "systemsculpt-model-description",
      text: "No models match your current search criteria. Click here to reset all filters."
    });
    card.createDiv({ cls: "systemsculpt-model-details" });
    card.addEventListener("click", () => {
      if (this.searchInput) {
        this.searchInput.value = "";
      }
      this.renderModels(this.allModels.map((m) => ({ item: m, matches: [], score: 0 })));
    });
    return card;
  }
  renderModelCard(model, matches = []) {
    var _a, _b, _c, _d, _e, _f, _g;
    const card = document.createElement("div");
    card.className = "systemsculpt-model-card";
    if (model.provider !== "systemsculpt") {
      card.classList.add("systemsculpt-custom-model-card");
    }
    card.setAttribute("tabindex", "0");
    card.dataset.modelId = model.id;
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${model.isFavorite ? "is-favorite" : ""}`,
      attr: {
        "aria-label": model.isFavorite ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian7.setIcon)(favoriteButton, "star");
    favoriteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isFavorite = !model.isFavorite;
      model.isFavorite = isFavorite;
      favoriteButton.classList.toggle("is-favorite", isFavorite);
      favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
      if (!Array.isArray(this.plugin.settings.favoriteModels)) {
        this.plugin.settings.favoriteModels = [];
      }
      if (isFavorite) {
        const newFav = { provider: model.provider, modelId: model.id };
        if (!this.plugin.settings.favoriteModels.some((f) => f.modelId === model.id && f.provider === model.provider)) {
          this.plugin.settings.favoriteModels.push(newFav);
        }
      } else {
        this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((f) => !(f.modelId === model.id && f.provider === model.provider));
      }
      await this.plugin.saveSettings();
      this.renderModels(this.getVisibleModels());
    });
    if (model.provider !== "systemsculpt") {
      const nameContainer = card.createDiv({
        cls: "systemsculpt-custom-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-custom-model-name"
      });
      const providerPrefix = `[${model.provider.toUpperCase()}] `;
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_a = this.searchInput) == null ? void 0 : _a.value));
    } else {
      const iconsContainer = card.createDiv({
        cls: "systemsculpt-model-icons"
      });
      const completionPrice = parseFloat(model.pricing.completion) * 1e6;
      const pricingIndicator = iconsContainer.createDiv({
        cls: "systemsculpt-model-icon",
        attr: {
          "aria-label": `Approx ~$${completionPrice.toFixed(2)} per million tokens`
        }
      });
      (0, import_obsidian7.setIcon)(pricingIndicator, "wallet");
      if ((_b = model.capabilities) == null ? void 0 : _b.includes("fast")) {
        const speedIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-speed-indicator",
          attr: { "aria-label": "Blazing fast responses" }
        });
        (0, import_obsidian7.setIcon)(speedIndicator, "zap");
      }
      if ((_c = model.capabilities) == null ? void 0 : _c.includes("reasoning")) {
        const reasonIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-reasoning-indicator",
          attr: { "aria-label": "Complex reasoning" }
        });
        (0, import_obsidian7.setIcon)(reasonIndicator, "brain");
      }
      if ((_d = model.capabilities) == null ? void 0 : _d.includes("creative")) {
        const creativeIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-creative-indicator",
          attr: { "aria-label": "Creative writing" }
        });
        (0, import_obsidian7.setIcon)(creativeIndicator, "brush");
      }
      if (((_e = model.architecture) == null ? void 0 : _e.modality) === "text+image->text") {
        const visionIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-vision-indicator",
          attr: { "aria-label": "Vision/image input" }
        });
        (0, import_obsidian7.setIcon)(visionIndicator, "eye");
      }
      const nameContainer = card.createDiv({
        cls: "systemsculpt-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-model-name"
      });
      const providerPrefix = "[SYSTEMSCULPT] ";
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_f = this.searchInput) == null ? void 0 : _f.value));
      const description = card.createDiv({
        cls: "systemsculpt-model-description"
      });
      description.append(this.helper.highlightText(model.description, matches, (_g = this.searchInput) == null ? void 0 : _g.value));
      description.setAttribute("aria-label", model.description);
      description.addClass("has-tooltip");
      const details = card.createDiv({ cls: "systemsculpt-model-details" });
      const contextLength = details.createDiv({
        cls: "systemsculpt-model-detail"
      });
      contextLength.createSpan({
        text: "Context: ",
        cls: "systemsculpt-detail-label"
      });
      contextLength.createSpan({
        text: `${model.context_length.toLocaleString()} tokens`,
        cls: "systemsculpt-detail-value"
      });
    }
    card.addEventListener("click", async () => {
      const customProvider = this.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === model.provider.toLowerCase());
      if (customProvider) {
        this.plugin.settings.activeProvider = {
          id: customProvider.id,
          name: customProvider.name,
          type: "custom"
        };
      } else {
        this.plugin.settings.activeProvider = {
          id: "systemsculpt",
          name: "SystemSculpt",
          type: "native"
        };
      }
      await this.plugin.saveSettings();
      this.onSelect(model.id);
      this.close();
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        this.onSelect(model.id);
        this.close();
      }
    });
    card.addEventListener("focus", () => {
      this.modelCards.forEach((c) => c.classList.remove("systemsculpt-keyboard-selected"));
      card.classList.add("systemsculpt-keyboard-selected");
      this.searchInput.focus();
    });
    return card;
  }
  onClose() {
    this.isClosing = true;
    this.contentEl.empty();
  }
  setModels(models) {
    if (!Array.isArray(models)) {
      this.logger.error("Invalid models data", { models });
      return;
    }
    this.allModels = models;
    if (this.modelGrid) {
      this.renderModels(this.getVisibleModels());
    }
  }
  createProInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian7.setIcon)(iconContainer, "sparkles");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Unlock Pro Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get instant access to o3 Mini, DeepSeek R1, and other state-of-the-art models. Always up to date so you don't have to guess which model to use."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian7.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    const patronBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const patronIcon = patronBtn.createSpan();
    (0, import_obsidian7.setIcon)(patronIcon, "heart");
    patronBtn.createSpan({ text: "Become A Patron" });
    patronBtn.addEventListener("click", () => {
      window.open(PATREON_URL, "_blank");
    });
    return infoEl;
  }
  createCustomProviderInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian7.setIcon)(iconContainer, "server");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Add Your Own Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get started by adding your own custom provider like Ollama, LM Studio, or OpenAI. You can use your own models or connect to other AI services."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian7.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    return infoEl;
  }
};

// src/components/FolderSuggester.ts
var import_obsidian8 = __toModule(require("obsidian"));
var FolderSuggester = class extends import_obsidian8.AbstractInputSuggest {
  constructor(inputEl, onSelectCb, app) {
    super(app, inputEl);
    this.inputEl = inputEl;
    this.onSelectCb = onSelectCb;
    this.content = getFolderSuggestions(app);
  }
  getSuggestions(inputStr) {
    const lowerCaseInputStr = inputStr.toLowerCase();
    return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
  }
  renderSuggestion(content, el) {
    el.setText(content);
  }
  selectSuggestion(content, evt) {
    this.onSelectCb(content);
    this.inputEl.value = content;
    this.inputEl.blur();
    this.close();
  }
};
function getFolderSuggestions(app) {
  const folders = app.vault.getAllLoadedFiles().filter((file) => file instanceof import_obsidian8.TFolder);
  return new Set(folders.map((folder) => folder.path));
}
function attachFolderSuggester(inputEl, onSelect, app) {
  return new FolderSuggester(inputEl, onSelect, app);
}

// src/modals/SystemPromptModal.ts
var import_obsidian10 = __toModule(require("obsidian"));
init_FileSuggester();
init_ui();
init_SystemPromptService();
function sanitizeFileName(name) {
  return name.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
}
function getSystemPromptPath(directory, fileName) {
  return `${directory}/${fileName}.md`;
}
var SystemPromptModal = class extends import_obsidian10.Modal {
  constructor(app, currentPrompt, options) {
    super(app);
    this.currentPrompt = currentPrompt;
    this.result = null;
    this.systemPrompts = [];
    this.activePreset = null;
    var _a;
    this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
    this.options = {
      ...options,
      systemPromptsDirectory: (_a = options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts"
    };
    this.systemPromptService = new SystemPromptService(app);
  }
  showLoading(show) {
    if (!this.loadingIndicator || !this.contentContainer)
      return;
    this.loadingIndicator.style.display = show ? "flex" : "none";
    this.contentContainer.style.display = show ? "none" : "block";
  }
  async loadSystemPrompts() {
    try {
      this.showLoading(true);
      this.systemPrompts = await this.systemPromptService.getSystemPrompts();
      this.createPresetButtons();
      this.showLoading(false);
    } catch (error) {
      console.error("Failed to load system prompts:", error);
      this.showLoading(false);
      await showPopup(this.app, "", {
        title: "Error",
        description: "Failed to load system prompts. Please try again later.",
        primaryButton: "OK"
      });
    }
  }
  createPresetButtons() {
    if (!this.presetButtonContainer)
      return;
    this.presetButtonContainer.empty();
    this.systemPrompts.forEach((preset) => {
      if (preset.systemPrompt === this.currentPrompt) {
        this.activePreset = preset.label;
      }
    });
    if (!this.activePreset && this.currentPrompt) {
      const generalUsePreset = this.systemPrompts.find((p) => p.id === "general-use");
      if (generalUsePreset && generalUsePreset.systemPrompt.trim() === this.currentPrompt.trim()) {
        this.activePreset = generalUsePreset.label;
      } else {
        this.activePreset = "General-use";
        if (this.textArea && generalUsePreset) {
          this.textArea.value = generalUsePreset.systemPrompt;
        }
      }
    }
    const presetButtons = [
      ...this.systemPrompts,
      ...!this.systemPrompts.some((p) => p.id === "custom") ? [
        {
          id: "custom",
          label: "Custom",
          isUserConfigurable: true,
          systemPrompt: ""
        }
      ] : []
    ].map((preset) => {
      const button = this.presetButtonContainer.createEl("button", {
        text: preset.label,
        cls: "systemsculpt-preset-button"
      });
      if (preset.label === this.activePreset) {
        button.addClass("active");
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
        }
      }
      button.onclick = () => {
        this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
        button.addClass("active");
        this.activePreset = preset.label;
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
          this.customInput.focus();
          if (this.textArea) {
            this.textArea.readOnly = false;
          }
        } else {
          this.customSection.style.display = "none";
          if (this.textArea) {
            this.textArea.value = preset.systemPrompt;
            this.textArea.readOnly = !preset.isUserConfigurable;
          }
        }
      };
      return button;
    });
  }
  async onOpen() {
    var _a, _b;
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal-content");
    this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
    this.loadingIndicator.style.display = "none";
    this.loadingIndicator.style.justifyContent = "center";
    this.loadingIndicator.style.alignItems = "center";
    this.loadingIndicator.style.padding = "20px";
    const loadingText = this.loadingIndicator.createSpan();
    loadingText.setText("Loading system prompts...");
    this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
    const title = this.options.mode === "default" ? "Edit Default System Prompt" : "Chat View Settings";
    const description = this.options.mode === "default" ? "Changes will apply as the default for all new chat views" : "Configure settings for this specific chat view";
    this.titleEl.setText(title);
    this.titleEl.addClass("systemsculpt-modal-title");
    const descriptionEl = this.titleEl.createDiv();
    descriptionEl.addClass("systemsculpt-modal-description");
    descriptionEl.setText(description);
    descriptionEl.style.color = "var(--text-muted)";
    descriptionEl.style.fontSize = "0.9em";
    descriptionEl.style.marginTop = "0.2em";
    const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
    this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
    this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
    this.customSection.style.display = "none";
    const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
    const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
    inputWrapper.style.display = "flex";
    inputWrapper.style.gap = "8px";
    inputWrapper.style.alignItems = "center";
    this.customInput = inputWrapper.createEl("input", {
      type: "text",
      placeholder: "Search for a system prompt file...",
      cls: "systemsculpt-custom-input"
    });
    const createButton2 = inputWrapper.createEl("button", {
      cls: "systemsculpt-create-button"
    });
    createButton2.style.padding = "4px 8px";
    createButton2.style.borderRadius = "4px";
    createButton2.style.cursor = "pointer";
    (0, import_obsidian10.setIcon)(createButton2, "plus");
    createButton2.addEventListener("click", async () => {
      var _a2, _b2, _c;
      let templateContent = "";
      try {
        templateContent = await this.systemPromptService.getSystemPromptTemplate();
      } catch (error) {
        console.error("Error fetching system prompt template:", error);
        await showPopup(this.app, "", {
          title: "Error",
          description: "Failed to fetch system prompt template. Please try again later.",
          primaryButton: "OK"
        });
        return;
      }
      const result = await showPopup(this.app, "", {
        title: "Create New System Prompt",
        description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
        primaryButton: "Create",
        secondaryButton: "Cancel",
        inputs: [
          {
            type: "text",
            placeholder: "My Custom Assistant",
            required: true,
            className: "systemsculpt-prompt-creation-title-input"
          },
          {
            type: "textarea",
            value: templateContent,
            required: true,
            className: "systemsculpt-prompt-creation-content"
          }
        ]
      });
      if (!(result == null ? void 0 : result.confirmed) || !((_a2 = result.inputs) == null ? void 0 : _a2[0]) || !((_b2 = result.inputs) == null ? void 0 : _b2[1])) {
        return;
      }
      const [title2, content] = result.inputs;
      const promptsDirectory = (_c = this.options.systemPromptsDirectory) != null ? _c : "SystemSculpt/System Prompts";
      const fileName = sanitizeFileName(title2);
      const filePath = getSystemPromptPath(promptsDirectory, fileName);
      try {
        await this.app.vault.createFolder(promptsDirectory).catch(() => {
        });
        const fileContent = `# ${title2}

${content}`;
        const file = await this.app.vault.create(filePath, fileContent);
        if (!file) {
          throw new Error("Failed to create file");
        }
        if (this.textArea) {
          this.textArea.value = fileContent;
          this.textArea.readOnly = false;
        }
        this.customInput.value = filePath;
        await showPopup(this.app, "", {
          title: "Success",
          description: "System prompt file created successfully!",
          primaryButton: "OK"
        });
      } catch (error) {
        console.error("Error creating system prompt file:", error);
        const errorMessage = error instanceof Error ? error.message : "Failed to create system prompt file. Please try again.";
        await showPopup(this.app, "", {
          title: "Error",
          description: errorMessage,
          primaryButton: "OK"
        });
      }
    });
    if (this.customInput) {
      attachFileSuggester(this.customInput, async (selectedPath) => {
        try {
          const file = this.app.vault.getAbstractFileByPath(selectedPath);
          if (file && file instanceof import_obsidian10.TFile) {
            const content = await this.app.vault.read(file);
            this.textArea.value = content;
            this.textArea.readOnly = false;
            this.customInput.value = selectedPath.replace(/\.md$/, "");
          }
        } catch (error) {
          console.error("Error reading system prompt file:", error);
        }
      }, this.app, (_a = this.options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts");
    }
    this.textArea = textAreaContainer.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter system prompt",
        readOnly: this.activePreset !== "Custom"
      }
    });
    this.textArea.value = this.currentPrompt;
    if (this.options.mode === "chat-specific") {
      const tokenLimitContainer = textAreaContainer.createDiv({
        cls: "systemsculpt-token-limit-container"
      });
      tokenLimitContainer.style.display = "flex";
      tokenLimitContainer.style.justifyContent = "flex-end";
      tokenLimitContainer.style.alignItems = "center";
      tokenLimitContainer.style.marginTop = "1rem";
      tokenLimitContainer.style.gap = "8px";
      const tokenLimitWrapper = tokenLimitContainer.createDiv({
        cls: "systemsculpt-token-limit-wrapper"
      });
      tokenLimitWrapper.style.display = "flex";
      tokenLimitWrapper.style.flexDirection = "column";
      tokenLimitWrapper.style.alignItems = "flex-end";
      tokenLimitWrapper.style.width = "50%";
      const tokenLimitLabel = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-label",
        text: "Context Token Limit"
      });
      tokenLimitLabel.style.fontWeight = "500";
      tokenLimitLabel.style.marginBottom = "4px";
      tokenLimitLabel.style.fontSize = "14px";
      const inputWrapper2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-input-wrapper"
      });
      inputWrapper2.style.display = "flex";
      inputWrapper2.style.alignItems = "center";
      inputWrapper2.style.gap = "4px";
      inputWrapper2.style.width = "100%";
      this.tokenLimitInput = inputWrapper2.createEl("input", {
        type: "range",
        cls: "systemsculpt-token-limit-input",
        attr: {
          min: "0",
          max: "100",
          step: "1",
          value: ((_b = this.options.tokenLimitPercentage) == null ? void 0 : _b.toString()) || "0"
        }
      });
      this.tokenLimitInput.style.width = "100%";
      const valueDisplay = inputWrapper2.createDiv({
        cls: "systemsculpt-token-limit-display",
        text: this.options.tokenLimitPercentage ? this.options.modelContextLength ? `${Math.floor(this.options.tokenLimitPercentage / 100 * this.options.modelContextLength / 1e3)}K` : `${this.options.tokenLimitPercentage}%` : "\u221E"
      });
      valueDisplay.style.minWidth = "45px";
      valueDisplay.style.textAlign = "right";
      valueDisplay.style.fontVariantNumeric = "tabular-nums";
      valueDisplay.style.fontSize = "14px";
      valueDisplay.style.fontWeight = "500";
      valueDisplay.style.color = "var(--text-accent)";
      const description2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-description",
        text: this.options.modelContextLength ? `Model max: ${Math.floor(this.options.modelContextLength / 1e3)}K tokens` : "Set to 0% for no limit"
      });
      description2.style.fontSize = "12px";
      description2.style.color = "var(--text-muted)";
      description2.style.marginTop = "4px";
      this.tokenLimitInput.addEventListener("input", (e) => {
        const percentage = parseInt(e.target.value, 10);
        if (percentage === 0) {
          valueDisplay.setText("\u221E");
        } else if (this.options.modelContextLength) {
          const tokens = Math.floor(percentage / 100 * this.options.modelContextLength / 1e3);
          valueDisplay.setText(`${tokens}K`);
        } else {
          valueDisplay.setText(`${percentage}%`);
        }
      });
    }
    if (this.activePreset === "Custom" && this.options.customPromptFilePath) {
      this.customInput.value = this.options.customPromptFilePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    }
    const resizeObserver = new ResizeObserver(() => {
      this.textArea.style.height = "auto";
      this.textArea.style.height = this.textArea.scrollHeight + "px";
    });
    resizeObserver.observe(this.textArea);
    const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
    const secondaryButton = buttonContainer.createEl("button", {
      text: "Cancel",
      cls: "systemsculpt-button"
    });
    const handleCancel = () => {
      this.result = null;
      this.close();
    };
    secondaryButton.onclick = handleCancel;
    const primaryButton = buttonContainer.createEl("button", {
      text: "Save",
      cls: "systemsculpt-button mod-cta"
    });
    const handleSave = () => {
      var _a2, _b2;
      const activeButton = this.modalEl.querySelector(".systemsculpt-preset-button.active");
      const activePresetLabel = (_a2 = activeButton == null ? void 0 : activeButton.textContent) != null ? _a2 : "";
      let result;
      if (activePresetLabel === "Custom" && this.customInput.value) {
        const path = this.customInput.value.replace(/\.md$/, "");
        result = {
          content: this.textArea.value,
          type: "custom",
          path
        };
      } else {
        const preset = this.systemPrompts.find((p) => p.label === activePresetLabel);
        if (preset) {
          result = {
            content: preset.systemPrompt,
            type: preset.id
          };
        } else {
          result = {
            content: this.textArea.value,
            type: "custom"
          };
        }
      }
      if (this.options.mode === "chat-specific" && ((_b2 = this.tokenLimitInput) == null ? void 0 : _b2.value)) {
        const percentage = parseInt(this.tokenLimitInput.value, 10);
        if (percentage > 0) {
          result.tokenLimitPercentage = percentage;
          if (this.options.modelContextLength) {
            result.tokenLimit = Math.floor(percentage / 100 * this.options.modelContextLength);
          }
        }
      }
      this.result = result;
      this.close();
    };
    primaryButton.onclick = handleSave;
    this.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
        e.preventDefault();
        handleSave();
      } else if (e.key === "Escape") {
        e.preventDefault();
        handleCancel();
      }
    });
    this.textArea.focus();
    this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
    await this.loadSystemPrompts();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
      this.resolvePromise(this.result);
    }
  }
  async openAndGetValue() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
};
async function showSystemPromptModal(app, currentPrompt, options) {
  const defaultOptions = {
    systemPromptsDirectory: "SystemSculpt/System Prompts",
    mode: "default",
    modelContextLength: void 0
  };
  const modal = new SystemPromptModal(app, currentPrompt, {
    ...defaultOptions,
    ...options
  });
  const result = await modal.openAndGetValue();
  if (result !== null && (options == null ? void 0 : options.onSave)) {
    await options.onSave(result.content);
  }
  return result;
}

// src/modals/SettingsTab.ts
var SystemSculptSettingTab = class extends import_obsidian12.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.debounceTimer = null;
    this.plugin = plugin;
    this.systemSculptService = SystemSculptService.getInstance(plugin.settings, this.app);
  }
  validateDirectory(path) {
    if (!path)
      return true;
    return !path.includes("..") && !path.startsWith("/") && !path.startsWith("\\");
  }
  async handleDirectoryChange(value, settingKey) {
    if (!this.validateDirectory(value)) {
      showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
      return;
    }
    if (this.debounceTimer)
      clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(async () => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    }, 500);
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    const mainContainer = containerEl.createDiv("systemsculpt-settings-container");
    mainContainer.createEl("h2", { text: "SystemSculpt AI Settings" });
    const tabContainer = mainContainer.createDiv("systemsculpt-settings-tabs");
    const contentContainer = mainContainer.createDiv("systemsculpt-settings-content");
    const tabs = [
      { id: "license", label: "License" },
      { id: "directories", label: "Directories" },
      { id: "recorder", label: "Recorder" },
      { id: "chat", label: "Chat" },
      { id: "tasks", label: "Tasks" },
      { id: "advanced", label: "Advanced" }
    ];
    tabs.forEach((tab) => {
      const tabButton = tabContainer.createEl("button", {
        cls: "systemsculpt-tab-button",
        text: tab.label
      });
      tabButton.dataset.tab = tab.id;
      if (tab.id === "license")
        tabButton.addClass("active");
    });
    const isProActive = this.plugin.settings.licenseValid === true;
    const licenseContent = contentContainer.createDiv("systemsculpt-tab-content active");
    const directoriesContent = contentContainer.createDiv("systemsculpt-tab-content");
    const recorderContent = contentContainer.createDiv("systemsculpt-tab-content");
    const chatContent = contentContainer.createDiv("systemsculpt-tab-content");
    const tasksContent = contentContainer.createDiv("systemsculpt-tab-content");
    const advancedContent = contentContainer.createDiv("systemsculpt-tab-content");
    this.displayLicenseTab(licenseContent, isProActive);
    this.displayDirectoriesTab(directoriesContent, isProActive);
    this.displayRecorderTab(recorderContent);
    this.displayChatTab(chatContent);
    this.displayTasksTab(tasksContent);
    this.displayAdvancedTab(advancedContent);
    tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((button) => {
      button.addEventListener("click", (e) => {
        var _a;
        const target = e.target;
        const tabId = target.dataset.tab;
        tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((b) => b.classList.remove("active"));
        contentContainer.querySelectorAll(".systemsculpt-tab-content").forEach((c) => c.classList.remove("active"));
        target.classList.add("active");
        (_a = contentContainer.querySelector(`[data-tab="${tabId}"]`)) == null ? void 0 : _a.classList.add("active");
      });
    });
    if (!document.getElementById("systemsculpt-settings-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-settings-styles";
      style.textContent = `
      .systemsculpt-settings-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 16px;
        border-bottom: 1px solid var(--background-modifier-border);
        padding-bottom: 8px;
        max-width: 100%;
      }
      
      .systemsculpt-tab-button {
        background: none;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: var(--text-normal);
        transition: all 0.2s ease;
        font-size: 0.9em;
        flex: 1 1 auto;
        min-width: 120px;
        text-align: center;
      }
      
      .systemsculpt-tab-button:hover {
        background-color: var(--background-modifier-hover);
      }
      
      .systemsculpt-tab-button.active {
        background-color: var(--interactive-accent);
        color: var(--text-on-accent);
      }
      
      .systemsculpt-tab-content {
        display: none;
        max-width: 100%;
        overflow-x: hidden;
      }
      
      .systemsculpt-tab-content.active {
        display: block;
        padding: 0 8px;
      }
      
      /* License Tab Styling */
      .systemsculpt-license-input {
        width: 100%;
        max-width: 400px;
      }
      
      .pro-badge {
        background: var(--interactive-accent);
        color: var(--text-on-accent);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: 600;
        margin-left: 8px;
        vertical-align: middle;
      }
      
      .token-balance-value {
        font-weight: 600;
        color: var(--text-accent);
        margin-left: 8px;
      }
      
      .pro-features-grid .setting-item {
        padding: 8px;
        border-radius: 4px;
        background: var(--background-secondary-alt);
        margin: 4px 0;
      }
      
      .pro-benefits-list {
        margin: 16px 0;
        padding-left: 20px;
        color: var(--text-muted);
      }
      
      .pro-benefits-list li {
        margin: 8px 0;
        list-style-type: '\u2192';
        padding-left: 20px;
        text-indent: -12px;
        word-break: break-word;
      }
    `;
      mainContainer.appendChild(style);
    }
  }
  displayLicenseTab(containerEl, isProActive) {
    containerEl.dataset.tab = "license";
    const licenseSettingContainer = containerEl.createDiv("systemsculpt-license-settings");
    licenseSettingContainer.createEl("h3", {
      text: "SystemSculpt License"
    });
    const licenseSetting = new import_obsidian12.Setting(licenseSettingContainer).setName("License Key").setDesc("Unlock Pro features with your license key").addText((text) => {
      text.setPlaceholder("Paste license key").setValue(this.plugin.settings.licenseKey).onChange(async (value) => {
        this.plugin.settings.licenseKey = value;
        await this.plugin.saveSettings();
      }).inputEl.addClass("systemsculpt-license-input");
      text.inputEl.type = "password";
      text.inputEl.style.fontFamily = "monospace";
      text.inputEl.addEventListener("focus", () => {
        text.inputEl.type = "text";
        text.inputEl.style.fontFamily = "inherit";
      });
      text.inputEl.addEventListener("blur", () => {
        text.inputEl.type = "password";
        text.inputEl.style.fontFamily = "monospace";
      });
      return text;
    }).addToggle((toggle) => {
      toggle.setValue(isProActive).setTooltip(isProActive ? "Disable Pro features" : "Enable Pro features").onChange(async (value) => {
        if (value) {
          const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true);
          if (!isValid) {
            toggle.setValue(false);
            showPopup(this.app, "Invalid license key - Pro features disabled");
          } else {
            const result = await showPopup(this.app, "Pro features have been successfully activated! To ensure all features work properly, Obsidian needs to be reloaded.", {
              title: "Reload to Complete Upgrade",
              description: "Click the button below to reload Obsidian and start using your Pro features.",
              primaryButton: "Reload & Upgrade",
              icon: "sparkles"
            });
            if (result == null ? void 0 : result.confirmed) {
              window.location.reload();
            }
          }
        } else {
          this.plugin.settings.licenseValid = false;
          await this.plugin.saveSettings();
        }
        this.display();
      });
      if (isProActive) {
        toggle.toggleEl.addClass("mod-cta");
      }
    });
    if (isProActive) {
      const statusSetting = new import_obsidian12.Setting(licenseSettingContainer).setName("Pro Status").setDesc("Active subscription \u2022 Premium features enabled");
      statusSetting.nameEl.createSpan({
        cls: "pro-badge",
        text: "ACTIVE"
      });
      const balanceEl = createSpan({
        cls: "token-balance-value",
        text: "Loading..."
      });
      statusSetting.addExtraButton((button) => {
        button.setIcon("sparkles").setTooltip("Available credits").setDisabled(true);
        statusSetting.controlEl.appendChild(balanceEl);
      });
      this.displayTokenBalance(balanceEl);
    }
    this.displayProPromotionSection(licenseSettingContainer, isProActive);
    const betaNoticeEl = licenseSettingContainer.createEl("div", {
      cls: "systemsculpt-beta-notice"
    });
    const headerContainer = betaNoticeEl.createEl("div", {
      cls: "beta-notice-header"
    });
    new import_obsidian12.Setting(headerContainer).setHeading().setName("Beta Testing Phase").addExtraButton((button) => {
      button.setIcon("rocket").setDisabled(true).extraSettingsEl.addClass("beta-header-icon");
    });
    betaNoticeEl.createEl("p", {
      text: "Thank you for trying out SystemSculpt! While some core features are available to everyone during this beta phase, certain advanced capabilities are currently limited to Patreon members to help manage the testing group size.",
      cls: "beta-notice-text"
    });
    betaNoticeEl.createEl("p", {
      text: "As a solo developer, your feedback is incredibly valuable in shaping SystemSculpt. Feel free to test the available features, and if you'd like access to the full beta experience, consider becoming a Patreon supporter!",
      cls: "beta-notice-text"
    });
    if (!document.getElementById("systemsculpt-beta-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-beta-styles";
      style.textContent = `
        .systemsculpt-beta-notice {
          margin-top: 32px;
          padding: 20px;
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .beta-notice-header {
          margin-bottom: 16px;
        }

        .beta-notice-header .setting-item {
          padding: 0;
          border: none;
        }

        .beta-notice-header .setting-item-name {
          font-size: 1.2em;
          font-weight: 600;
          color: var(--text-normal);
        }

        .beta-header-icon {
          color: var(--interactive-accent) !important;
          background: none !important;
          padding: 0 !important;
          margin-right: 8px !important;
        }

        .beta-notice-text {
          margin: 12px 0;
          color: var(--text-normal);
          line-height: 1.6;
          font-size: 0.95em;
        }

        .theme-dark .systemsculpt-beta-notice {
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
      `;
      containerEl.appendChild(style);
    }
  }
  async displayTokenBalance(containerEl) {
    try {
      const balance = await this.systemSculptService.getTokenBalance();
      containerEl.setText(`Available Credits: ${balance.toLocaleString()}`);
    } catch (error) {
      containerEl.setText("Unable to fetch credit balance");
      console.error("Failed to fetch token balance:", error);
    }
  }
  displayProPromotionSection(containerEl, isProActive) {
    if (!isProActive) {
      const proPromotionEl = containerEl.createEl("div", {
        cls: "systemsculpt-pro-promotion"
      });
      const headerContainer = proPromotionEl.createEl("div", {
        cls: "pro-promotion-header"
      });
      new import_obsidian12.Setting(headerContainer).setHeading().setName("Upgrade to Pro").addExtraButton((button) => {
        button.setIcon("sparkles").setDisabled(true).extraSettingsEl.addClass("pro-header-icon");
      });
      proPromotionEl.createEl("p", {
        text: "Transform your workflow with powerful AI features designed for serious productivity.",
        cls: "pro-promotion-text"
      });
      const benefitsList = proPromotionEl.createEl("ul", {
        cls: "pro-benefits-list"
      });
      [
        "Audio Recording & Instant Transcription",
        "Smart Document Processing",
        "Real-time Voice-to-Text in Notes & Chat",
        "Multi-format Support (PDF, Audio, Images)",
        "AI Templates & Custom Personalities",
        "Priority Access to New Features",
        "1-on-1 Support via Patreon DMs",
        "Support SystemSculpt's Development"
      ].forEach((benefit) => {
        benefitsList.createEl("li", { text: benefit });
      });
      new import_obsidian12.Setting(proPromotionEl).addButton((button) => button.setButtonText("Become a Patron").setCta().onClick(() => {
        window.open(PATREON_URL, "_blank");
      }));
    }
  }
  displayChatTab(containerEl) {
    containerEl.dataset.tab = "chat";
    containerEl.createEl("h3", { text: "Chat Settings" });
    const modelSetting = new import_obsidian12.Setting(containerEl).setName("AI Model").setDesc("Select which AI model to use for chat");
    modelSetting.addButton((button) => button.setButtonText("Select Model").onClick(async () => {
      button.setDisabled(true);
      try {
        const models = await this.systemSculptService.getModels();
        const modal = new ModelSelectionModal(this.app, this.plugin.settings.selectedModelId, async (modelId) => {
          this.plugin.settings.selectedModelId = modelId;
          await this.plugin.saveSettings();
          const modelDisplay = containerEl.querySelector(".systemsculpt-current-model");
          if (modelDisplay) {
            modelDisplay.setText(`Current model: ${modelId}`);
          }
        }, this.plugin);
        modal.open();
      } catch (error) {
        console.error("Error loading models:", error);
        showPopup(this.app, "Failed to load available models");
      } finally {
        button.setDisabled(false);
      }
    }));
    modelSetting.descEl.createEl("div", {
      text: `Current model: ${this.plugin.settings.selectedModelId}`,
      cls: "systemsculpt-current-model"
    });
    new import_obsidian12.Setting(containerEl).setName("Chat System Prompt").setDesc("Customize the system prompt used for all new chats").addButton((button) => {
      button.setButtonText("Edit Prompt").onClick(async () => {
        const result = await showSystemPromptModal(this.app, this.plugin.settings.systemPrompt, {
          onSave: async (newPrompt) => {
            this.plugin.settings.systemPrompt = newPrompt;
            await this.plugin.saveSettings();
          },
          systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
          mode: "default",
          customPromptFilePath: this.plugin.settings.systemPromptPath
        });
        if (result == null ? void 0 : result.content) {
          this.plugin.settings.systemPrompt = result.content;
          this.plugin.settings.systemPromptType = result.type;
          if ((result == null ? void 0 : result.type) === "custom" && (result == null ? void 0 : result.path)) {
            this.plugin.settings.systemPromptPath = result.path;
          } else {
            this.plugin.settings.systemPromptPath = "";
          }
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayAdvancedTab(containerEl) {
    containerEl.dataset.tab = "advanced";
    new import_obsidian12.Setting(containerEl).setName("Development Mode").setDesc("Toggle between development and production API endpoints").addToggle((toggle) => toggle.setValue(this.plugin.settings.developmentMode).onChange(async (value) => {
      this.plugin.settings.developmentMode = value;
      this.plugin.settings.serverUrl = value ? "http://localhost:3001" : "https://api.systemsculpt.com";
      await this.plugin.saveSettings();
      new import_obsidian12.Notice(`Switched to ${value ? "development" : "production"} mode (${this.systemSculptService.baseUrl})`);
    }));
    new import_obsidian12.Setting(containerEl).setName("Reset to Factory Settings").setDesc("Clear all custom settings and restore defaults for this plugin.").addButton((btn) => {
      btn.setButtonText("Reset\u2026").onClick(async () => {
        const confirm = await showPopup(this.app, "Reset to Factory Defaults", {
          description: "This will delete ALL saved settings and customizations for SystemSculpt, returning everything to default. Do you want to continue?",
          primaryButton: "Reset & Reload",
          secondaryButton: "Cancel"
        });
        if (!confirm || !confirm.confirmed) {
          return;
        }
        try {
          await this.plugin.saveData(null);
          await this.plugin.getSettingsManager().updateSettings(DEFAULT_SETTINGS);
          window.location.reload();
        } catch (error) {
          console.error("Error resetting to factory settings:", error);
          showPopup(this.app, "Failed to reset: " + String(error));
        }
      });
    });
  }
  async displayDirectoriesTab(containerEl, isProActive) {
    containerEl.dataset.tab = "directories";
    containerEl.createEl("h3", { text: "Directory Settings" });
    this.createDirectorySetting(containerEl, "Chats Directory", "Select the directory for your chat history", "chatsDirectory", "SystemSculpt/Chats");
    this.createDirectorySetting(containerEl, "Recordings Directory", "Select the directory for your recordings", "recordingsDirectory", "SystemSculpt/Recordings");
    this.createDirectorySetting(containerEl, "System Prompts Directory", "Select the directory for your custom system prompts", "systemPromptsDirectory", "SystemSculpt/System Prompts");
    this.createDirectorySetting(containerEl, "Attachments Directory", "Select the directory for saved images and attachments", "attachmentsDirectory", "SystemSculpt/Attachments");
    this.createDirectorySetting(containerEl, "Extractions Directory", "Select the directory where extracted PDFs/docs will be placed", "extractionsDirectory", "SystemSculpt/Extractions");
    this.createDirectorySetting(containerEl, "Tasks Directory", "Select the directory for your task lists", "tasksDirectory", "SystemSculpt/Tasks");
  }
  createDirectorySetting(containerEl, name, desc, settingKey, placeholder) {
    new import_obsidian12.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      text.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
        await this.handleDirectoryChange(value, settingKey);
      });
      attachFolderSuggester(text.inputEl, async (selectedPath) => {
        if (this.validateDirectory(selectedPath)) {
          this.plugin.settings[settingKey] = selectedPath;
          text.setValue(selectedPath);
          await this.plugin.saveSettings();
        } else {
          showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
        }
      }, this.app);
      return text;
    });
  }
  displayRecorderTab(containerEl) {
    containerEl.dataset.tab = "recorder";
    containerEl.createEl("h3", { text: "Recording Settings" });
    const microphoneSetting = new import_obsidian12.Setting(containerEl).setName("Preferred Microphone").setDesc("Select your preferred microphone for recordings");
    const micSelect = microphoneSetting.controlEl.createEl("select", {
      cls: "systemsculpt-microphone-select"
    });
    micSelect.createEl("option", {
      value: "",
      text: "Loading microphones..."
    }).setAttribute("disabled", "true");
    micSelect.disabled = true;
    try {
      navigator.mediaDevices.enumerateDevices().then((devices) => {
        var _a;
        const microphones = devices.filter((device) => device.kind === "audioinput");
        micSelect.disabled = false;
        (_a = micSelect.firstElementChild) == null ? void 0 : _a.remove();
        microphones.forEach((mic) => {
          const option = micSelect.createEl("option", {
            value: mic.deviceId,
            text: mic.label || `Microphone ${mic.deviceId.slice(0, 8)}...`
          });
          if (mic.deviceId === this.plugin.settings.preferredMicrophoneId) {
            option.selected = true;
          }
        });
      }).catch((error) => {
        console.error("Error enumerating audio devices:", error);
        micSelect.createEl("option", {
          value: "",
          text: "Unable to list microphones"
        });
      });
    } catch (error) {
      console.error("Microphone initialization failed:", error);
    }
    micSelect.addEventListener("change", async () => {
      this.plugin.settings.preferredMicrophoneId = micSelect.value;
      await this.plugin.saveSettings();
    });
    new import_obsidian12.Setting(containerEl).setName("Auto-Transcribe Recordings").setDesc("Automatically transcribe recordings when they are completed").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoTranscribeRecordings).onChange(async (value) => {
      this.plugin.settings.autoTranscribeRecordings = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian12.Setting(containerEl).setName("Auto-Paste Transcription").setDesc("Automatically paste transcriptions into the active document").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoPasteTranscription).onChange(async (value) => {
      this.plugin.settings.autoPasteTranscription = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian12.Setting(containerEl).setName("Post-Processing").setDesc("Configure how transcriptions should be post-processed").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.postProcessingEnabled).setTooltip("Enable/disable post-processing").onChange(async (value) => {
        this.plugin.settings.postProcessingEnabled = value;
        await this.plugin.saveSettings();
      });
      return toggle;
    }).addButton((button) => {
      button.setButtonText("Edit Prompt").setTooltip("Configure the post-processing prompt").onClick(async () => {
        const { showPostProcessingPromptModal: showPostProcessingPromptModal2 } = await Promise.resolve().then(() => (init_PostProcessingPromptModal(), PostProcessingPromptModal_exports));
        const result = await showPostProcessingPromptModal2(this.app, this.plugin, this.plugin.settings.postProcessingPrompt);
        if (result) {
          this.plugin.settings.postProcessingPrompt = result.content;
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayTasksTab(containerEl) {
    containerEl.dataset.tab = "tasks";
    containerEl.createEl("h3", { text: "Tasks Settings" });
    new import_obsidian12.Setting(containerEl).setName("Auto-Move Completed Tasks").setDesc("Automatically move completed tasks to the bottom of the list").addToggle((toggle) => toggle.setValue(this.plugin.settings.moveCompletedTasksDown).onChange(async (value) => {
      this.plugin.settings.moveCompletedTasksDown = value;
      await this.plugin.saveSettings();
    }));
  }
};

// src/services/RecorderService.ts
var import_obsidian26 = __toModule(require("obsidian"));

// src/modals/AudioTranscriptionModal.ts
var import_obsidian13 = __toModule(require("obsidian"));

// src/services/TranscriptionService.ts
init_SystemSculptService();
var SUPPORTED_AUDIO_EXTENSIONS = ["wav", "m4a", "webm", "ogg", "mp3"];
var MIME_TYPE_MAP = {
  wav: "audio/wav",
  m4a: "audio/mp4",
  webm: "audio/webm",
  ogg: "audio/ogg;codecs=opus",
  mp3: "audio/mpeg"
};
var TranscriptionService = class {
  constructor(plugin) {
    this.isTranscribing = false;
    this.plugin = plugin;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!TranscriptionService.instance) {
      TranscriptionService.instance = new TranscriptionService(plugin);
    }
    return TranscriptionService.instance;
  }
  async parseErrorResponse(response) {
    try {
      const data = await response.json();
      if (data.error) {
        if (typeof data.error === "string") {
          return { message: data.error, data };
        }
        if (data.error.message) {
          return { message: data.error.message, data };
        }
        return { message: JSON.stringify(data.error), data };
      }
      return { message: response.statusText, data };
    } catch (e) {
      return { message: response.statusText };
    }
  }
  async transcribeFile(file, context) {
    var _a, _b, _c, _d;
    console.log("TranscriptionService.transcribeFile called with:", {
      fileName: file.name,
      context
    });
    if (this.isTranscribing) {
      throw new Error("Already transcribing a file");
    }
    const extension = file.extension.toLowerCase();
    if (!SUPPORTED_AUDIO_EXTENSIONS.includes(extension)) {
      throw new Error(`Unsupported file type: ${extension}`);
    }
    this.isTranscribing = true;
    (_a = context == null ? void 0 : context.onProgress) == null ? void 0 : _a.call(context, 0, "Reading audio file...");
    const arrayBuffer = await this.plugin.app.vault.readBinary(file);
    const blob = new Blob([arrayBuffer], {
      type: MIME_TYPE_MAP[extension]
    });
    const formData = new FormData();
    formData.append("file", blob, file.name);
    if (context == null ? void 0 : context.timestamped) {
      formData.append("timestamped", "true");
    }
    try {
      (_b = context == null ? void 0 : context.onProgress) == null ? void 0 : _b.call(context, 20, "Uploading audio...");
      const response = await fetch(`${this.sculptService.baseUrl}/api/v1/audio/transcriptions`, {
        method: "POST",
        headers: {
          "x-license-key": this.plugin.settings.licenseKey
        },
        body: formData
      });
      console.log("Raw server response:", {
        status: response.status,
        ok: response.ok,
        contentType: response.headers.get("content-type")
      });
      let data;
      if (!response.ok) {
        const { message: errorMessage, data: parsedData } = await this.parseErrorResponse(response);
        console.log("Error response parsed:", { errorMessage, parsedData });
        if (response.status === 400 && errorMessage === "Credits charged successfully") {
          console.log("Credits charged successfully, continuing with transcription...");
          data = parsedData;
        } else {
          throw new Error(`Failed to transcribe file: ${response.status} - ${errorMessage}`);
        }
      } else {
        const responseText = await response.text();
        console.log("Raw response text:", responseText);
        try {
          data = JSON.parse(responseText);
          console.log("Parsed response data:", data);
        } catch (e) {
          console.error("Failed to parse response JSON:", e);
          throw new Error("Invalid JSON response from server");
        }
      }
      (_c = context == null ? void 0 : context.onProgress) == null ? void 0 : _c.call(context, 60, "Processing audio...");
      console.log("Final data object:", {
        hasData: !!data,
        dataType: typeof data,
        keys: data ? Object.keys(data) : null,
        textType: (data == null ? void 0 : data.text) ? typeof data.text : null,
        textLength: (data == null ? void 0 : data.text) ? data.text.length : null,
        textPreview: (data == null ? void 0 : data.text) ? data.text.substring(0, 100) + "..." : null
      });
      if (!data || typeof data.text !== "string") {
        console.error("Invalid response data:", data);
        throw new Error("No transcription text received from server");
      }
      const trimmedText = data.text.trim();
      console.log("Trimmed text:", {
        length: trimmedText.length,
        preview: trimmedText.substring(0, 100) + "..."
      });
      if (!trimmedText) {
        console.error("Empty transcription text after trimming:", data);
        throw new Error("Empty transcription text received from server");
      }
      if (data.cost_info) {
        console.log("Transcription cost details:", {
          duration: `${data.cost_info.audio_duration_seconds}s (${data.cost_info.audio_duration_hours}h)`,
          raw_cost: `$${data.cost_info.raw_cost_usd.toFixed(4)}`,
          markup_rate: `${(data.cost_info.markup_rate * 100).toFixed(1)}%`,
          final_cost: `${data.cost_info.final_cost_credits} credits`,
          file_size: `${(data.cost_info.file_size_bytes / 1024 / 1024).toFixed(2)}MB`
        });
      }
      (_d = context == null ? void 0 : context.onProgress) == null ? void 0 : _d.call(context, 100, "Transcription complete!");
      return trimmedText;
    } catch (error) {
      console.error("Transcription error:", error);
      throw error;
    } finally {
      this.isTranscribing = false;
    }
  }
  unload() {
  }
};

// src/services/PostProcessingService.ts
init_SystemSculptService();
var PostProcessingService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.defaultModelId = null;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!PostProcessingService.instance) {
      PostProcessingService.instance = new PostProcessingService(plugin);
    }
    return PostProcessingService.instance;
  }
  async findDefaultModel() {
    if (this.defaultModelId)
      return this.defaultModelId;
    try {
      const models = await this.sculptService.getModels();
      const defaultModel = models.find((model) => {
        var _a;
        return (_a = model.name) == null ? void 0 : _a.match(/\(Default\)/i);
      });
      if (!defaultModel) {
        throw new Error("Default model not found");
      }
      this.defaultModelId = defaultModel.id;
      return defaultModel.id;
    } catch (error) {
      console.error("Error finding default model:", error);
      throw error;
    }
  }
  async processTranscription(text) {
    if (!this.plugin.settings.postProcessingEnabled) {
      return text;
    }
    try {
      const modelId = await this.findDefaultModel();
      const messages = [
        {
          role: "system",
          content: this.plugin.settings.postProcessingPrompt,
          message_id: crypto.randomUUID()
        },
        {
          role: "user",
          content: text,
          message_id: crypto.randomUUID()
        }
      ];
      let processedText = "";
      for await (const chunk of this.sculptService.streamMessage({
        messages,
        model: modelId,
        temperature: 0.3
      })) {
        if (chunk.content) {
          processedText += chunk.content;
        }
      }
      return processedText.trim();
    } catch (error) {
      console.error("Error post-processing transcription:", error);
      return text;
    }
  }
};

// src/modals/AudioTranscriptionModal.ts
var PersistentTranscriptionNotice = class extends import_obsidian13.Notice {
  constructor() {
    super("", 0);
    this.noticeEl.addClass("systemsculpt-transcription-notice");
    const progressContainer = this.noticeEl.createDiv("transcription-progress");
    const statusContainer = progressContainer.createDiv("transcription-status");
    this.statusIcon = statusContainer.createDiv("transcription-status-icon");
    this.statusText = statusContainer.createDiv("transcription-status-text");
    const progressBarContainer = progressContainer.createDiv("transcription-progress-bar-container");
    this.progressBar = progressBarContainer.createDiv("transcription-progress-bar");
    if (!document.getElementById("systemsculpt-transcription-notice-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-transcription-notice-styles";
      style.textContent = `
        .systemsculpt-transcription-notice {
          padding: 8px 12px !important;
          min-width: 260px;
        }

        .transcription-progress {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .transcription-status {
          display: flex;
          align-items: center;
          gap: 8px;
          color: var(--text-normal);
        }

        .transcription-status-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--text-accent);
        }

        .transcription-status-text {
          flex: 1;
          font-size: 14px;
        }

        .transcription-progress-bar-container {
          width: 100%;
          height: 4px;
          background: var(--background-modifier-border);
          border-radius: 2px;
          overflow: hidden;
        }

        .transcription-progress-bar {
          height: 100%;
          background: var(--text-accent);
          border-radius: 2px;
          transition: width 0.3s ease;
          width: 0%;
        }

        .notice-success .transcription-progress-bar {
          background: var(--text-success) !important;
        }

        .notice-error .transcription-progress-bar {
          background: var(--text-error) !important;
        }
      `;
      document.head.appendChild(style);
    }
  }
  updateProgress({ progress, status, icon }) {
    this.progressBar.style.width = `${progress}%`;
    this.statusText.setText(status);
    this.statusIcon.empty();
    (0, import_obsidian13.setIcon)(this.statusIcon, icon);
    this.noticeEl.removeClass("notice-success", "notice-error");
    if (progress === 100) {
      this.noticeEl.addClass("notice-success");
    } else if (progress === 0 && icon === "x-circle") {
      this.noticeEl.addClass("notice-error");
    }
  }
};
var AudioTranscriptionModal = class {
  constructor(app, options) {
    this.options = options;
    this.transcriptionService = TranscriptionService.getInstance(options.plugin);
    this.postProcessingService = PostProcessingService.getInstance(options.plugin);
  }
  open() {
    this.notice = new PersistentTranscriptionNotice();
    this.startTranscription();
  }
  async startTranscription() {
    try {
      this.notice.updateProgress({
        progress: 0,
        status: "Starting transcription...",
        icon: "mic"
      });
      const text = await this.transcriptionService.transcribeFile(this.options.file, {
        type: this.options.isChat ? "chat" : "note",
        timestamped: this.options.timestamped,
        onProgress: (progress, status) => {
          this.notice.updateProgress({
            progress,
            status,
            icon: "audio-lines"
          });
        }
      });
      if (!text) {
        throw new Error("Failed to get transcription text");
      }
      let finalText = text;
      let processedText = "";
      if (this.options.plugin.settings.postProcessingEnabled) {
        this.notice.updateProgress({
          progress: 80,
          status: "Post-processing transcription...",
          icon: "wand"
        });
        processedText = await this.postProcessingService.processTranscription(text);
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}

## Processed Transcription
${processedText}`;
      } else {
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}`;
      }
      if (this.options.onTranscriptionComplete) {
        this.options.onTranscriptionComplete(finalText);
      }
      await navigator.clipboard.writeText(finalText);
      this.notice.updateProgress({
        progress: 100,
        status: "Transcription complete!",
        icon: "check-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 2e3);
    } catch (error) {
      console.error("Transcription error:", error);
      this.notice.updateProgress({
        progress: 0,
        status: `Error: ${error instanceof Error ? error.message : String(error)}`,
        icon: "x-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 4e3);
    }
  }
};
async function showAudioTranscriptionModal(app, options) {
  const modal = new AudioTranscriptionModal(app, options);
  modal.open();
}

// src/views/ChatView.ts
var import_obsidian25 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/services/ChatStorageService.ts
var import_obsidian14 = __toModule(require("obsidian"));
var ChatStorageService = class {
  constructor(app, chatDirectory) {
    this.app = app;
    this.chatDirectory = chatDirectory;
  }
  async saveChat(chatId, messages, selectedModelId, contextFiles, customPromptFilePath, systemPromptType, systemPromptPath, title, tokenLimit, tokenLimitPercentage) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const contextFileObjects = contextFiles ? Array.from(contextFiles).map((path) => {
        const isExtraction = path.includes("/Extractions/");
        return {
          path,
          type: isExtraction ? "extraction" : "source"
        };
      }) : [];
      const metadata = {
        id: chatId,
        model: selectedModelId,
        created: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        title: title || "Untitled Chat",
        context_files: contextFileObjects,
        systemMessage: systemPromptType ? {
          type: systemPromptType,
          path: systemPromptType === "custom" && systemPromptPath ? `[[${systemPromptPath}]]` : void 0,
          tokenLimit,
          tokenLimitPercentage
        } : void 0
      };
      const content = `---
${(0, import_obsidian14.stringifyYaml)(metadata)}---

${messages.map((msg) => {
        const messageStart = `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`;
        return `${messageStart}
${msg.content}
<!-- SYSTEMSCULPT-MESSAGE-END -->`;
      }).join("\n\n")}`;
      await this.app.vault.adapter.mkdir(this.chatDirectory);
      await this.app.vault.adapter.write(filePath, content);
    } catch (error) {
      console.error("Failed to save chat:", error);
      throw new Error("Failed to save chat");
    }
  }
  async loadChats() {
    try {
      const files = await this.app.vault.adapter.list(this.chatDirectory);
      const chatFiles = files.files.filter((f) => f.endsWith(".md"));
      const chats = await Promise.all(chatFiles.map(async (filePath) => {
        const content = await this.app.vault.adapter.read(filePath);
        return this.parseMarkdownContent(content);
      }));
      return chats.filter((chat) => chat !== null);
    } catch (error) {
      console.error("Failed to load chats:", error);
      return [];
    }
  }
  async loadChat(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian14.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMarkdownContent(content);
    } catch (error) {
      console.error("Failed to load chat:", error);
      return null;
    }
  }
  generateMarkdownContent(metadata, messages) {
    const yamlMetadata = {
      systemsculpt_chat: true,
      ...metadata
    };
    const metadataSection = [
      "---",
      (0, import_obsidian14.stringifyYaml)(yamlMetadata).trim(),
      "---",
      ""
    ].join("\n");
    const messagesSection = messages.map((msg) => [
      `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`,
      msg.content,
      "<!-- SYSTEMSCULPT-MESSAGE-END -->",
      ""
    ].join("\n")).join("\n");
    return metadataSection + messagesSection;
  }
  parseMetadata(content) {
    try {
      const metadataMatch = content.match(/---\n([\s\S]*?)\n---/);
      if (!metadataMatch)
        return null;
      const parsed = (0, import_obsidian14.parseYaml)(metadataMatch[1]);
      if (!parsed || typeof parsed !== "object")
        return null;
      const {
        id,
        model,
        created,
        lastModified,
        title,
        context_files,
        systemMessage
      } = parsed;
      if (!id || !model || !created || !lastModified)
        return null;
      const processedContextFiles = context_files == null ? void 0 : context_files.map((file) => {
        if (typeof file === "string") {
          const isExtraction = file.includes("/Extractions/");
          return {
            path: file,
            type: isExtraction ? "extraction" : "source"
          };
        }
        return {
          path: file.path,
          type: file.type
        };
      });
      if (systemMessage == null ? void 0 : systemMessage.path) {
        systemMessage.path = systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      return {
        id,
        model,
        created,
        lastModified,
        title: title || "Untitled Chat",
        context_files: processedContextFiles || [],
        systemMessage
      };
    } catch (error) {
      console.error("Failed to parse metadata:", error);
      return null;
    }
  }
  async parseMarkdownContent(content) {
    var _a, _b, _c;
    try {
      const metadata = this.parseMetadata(content);
      if (!metadata)
        return null;
      const messages = [];
      const messageRegex = /<!-- SYSTEMSCULPT-MESSAGE-START role="(user|assistant)" message-id="([^"]+)" -->\n([\s\S]*?)\n<!-- SYSTEMSCULPT-MESSAGE-END -->/g;
      let msgMatch;
      while ((msgMatch = messageRegex.exec(content)) !== null) {
        const [, role, messageId, messageContent] = msgMatch;
        messages.push({
          role,
          content: messageContent.trim(),
          message_id: messageId
        });
      }
      const contextFiles = (_a = metadata.context_files) == null ? void 0 : _a.map((file) => typeof file === "string" ? file : file.path);
      return {
        id: metadata.id,
        messages,
        selectedModelId: metadata.model,
        lastModified: new Date(metadata.lastModified).getTime(),
        title: metadata.title,
        context_files: contextFiles,
        customPromptFilePath: (_b = metadata.systemMessage) == null ? void 0 : _b.path,
        tokenLimit: (_c = metadata.systemMessage) == null ? void 0 : _c.tokenLimit
      };
    } catch (error) {
      console.error("Failed to parse markdown content:", error);
      return null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async getMetadata(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian14.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMetadata(content);
    } catch (error) {
      console.error("Failed to get metadata:", error);
      return null;
    }
  }
};

// src/services/ScrollManagerService.ts
var import_obsidian15 = __toModule(require("obsidian"));
var ScrollManagerService = class {
  constructor(config) {
    this.state = {
      isAutoScrollEnabled: true,
      isUserScrolling: false,
      lastContentHeight: 0
    };
    this.handleScroll = (0, import_obsidian15.debounce)(() => {
      const isAtBottom = this.isScrolledToBottom();
      if (isAtBottom && !this.state.isAutoScrollEnabled) {
        this.enableAutoScroll();
      } else if (!isAtBottom && this.state.isAutoScrollEnabled) {
        this.disableAutoScroll();
      }
    }, 150);
    this.handleWheel = (e) => {
      if (e.deltaY < 0) {
        this.disableAutoScroll();
      }
    };
    this.handleTouchStart = () => {
      this.state.isUserScrolling = true;
    };
    this.handleTouchEnd = () => {
      this.state.isUserScrolling = false;
      if (this.isScrolledToBottom()) {
        this.enableAutoScroll();
      }
    };
    this.container = config.container;
    this.onScrollStateChange = config.onScrollStateChange;
    this.attachEventListeners();
  }
  attachEventListeners() {
    this.container.addEventListener("scroll", this.handleScroll);
    this.container.addEventListener("wheel", this.handleWheel);
    this.container.addEventListener("touchstart", this.handleTouchStart);
    this.container.addEventListener("touchend", this.handleTouchEnd);
  }
  isScrolledToBottom() {
    const { scrollHeight, scrollTop, clientHeight } = this.container;
    return Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
  }
  scrollToBottom() {
    if (!this.state.isAutoScrollEnabled)
      return;
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      this.container.scrollTo({
        top: this.container.scrollHeight,
        behavior: this.state.isUserScrolling ? "smooth" : "auto"
      });
      this.state.lastContentHeight = this.container.scrollHeight;
    });
  }
  enableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = true;
    this.state.isUserScrolling = false;
    this.state.lastContentHeight = this.container.scrollHeight;
    this.scrollToBottom();
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, true);
  }
  disableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = false;
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, false);
  }
  updateContentHeight() {
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      const currentHeight = this.container.scrollHeight;
      if (currentHeight !== this.state.lastContentHeight) {
        this.state.lastContentHeight = currentHeight;
        if (!this.container.scrollTop || this.isScrolledToBottom()) {
          this.scrollToBottom();
        }
      }
    });
  }
  cleanup() {
    this.container.removeEventListener("scroll", this.handleScroll);
    this.container.removeEventListener("wheel", this.handleWheel);
    this.container.removeEventListener("touchstart", this.handleTouchStart);
    this.container.removeEventListener("touchend", this.handleTouchEnd);
  }
};

// src/views/ChatView.ts
init_ui();
init_errors();

// src/views/components/DrawerComponent.ts
var import_obsidian16 = __toModule(require("obsidian"));
var DrawerComponent = class extends import_obsidian16.Component {
  constructor(options) {
    super();
    this.isMouseInProximity = false;
    this.hideTimeout = null;
    this.options = options;
    this.initializeDrawer();
    this.setupEventListeners();
  }
  initializeDrawer() {
    this.drawer = this.options.container.createEl("div", {
      cls: `systemsculpt-drawer ${this.options.cls || ""}`
    });
    this.header = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-header"
    });
    const titleEl = this.header.createEl("div", {
      cls: "systemsculpt-drawer-title"
    });
    titleEl.createSpan({ text: this.options.title });
    this.toggle = this.header.createSpan({
      cls: "systemsculpt-drawer-toggle",
      text: "\u25BC"
    });
    this.content = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-content"
    });
    this.setVisibility(false);
  }
  setupEventListeners() {
    this.drawer.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true, true);
    });
    this.content.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true, true);
    });
    this.drawer.addEventListener("mouseleave", (e) => {
      const rect = this.drawer.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY >= rect.bottom && e.clientY <= rect.bottom + buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.content.addEventListener("mouseleave", (e) => {
      const rect = this.content.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY <= rect.top && e.clientY >= rect.top - buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
  }
  clearHideTimeout() {
    if (this.hideTimeout) {
      clearTimeout(this.hideTimeout);
      this.hideTimeout = null;
    }
  }
  scheduleHide() {
    this.clearHideTimeout();
    this.hideTimeout = setTimeout(() => {
      if (!this.isMouseInProximity) {
        this.setVisibility(false);
      }
    }, 100);
  }
  setVisibility(visible, expanded = false) {
    this.content.style.opacity = visible ? "1" : "0";
    this.content.style.pointerEvents = visible ? "all" : "none";
    this.content.style.transform = `translateY(${visible ? "0" : "-8px"})`;
    this.toggle.style.transform = visible ? "rotate(0)" : "rotate(-90deg)";
    if (this.options.onVisibilityChange) {
      this.options.onVisibilityChange(visible);
    }
  }
  getContent() {
    return this.content;
  }
  getDrawer() {
    return this.drawer;
  }
  getHeader() {
    return this.header;
  }
  onunload() {
    this.clearHideTimeout();
    super.onunload();
  }
};

// src/views/components/MessageRenderer.ts
var import_obsidian17 = __toModule(require("obsidian"));
init_ui();
var MessageRenderer = class extends import_obsidian17.Component {
  constructor(app) {
    super();
    this.app = app;
  }
  async renderMessage({
    app,
    messageId,
    role,
    content
  }) {
    const messageEl = document.createElement("div");
    messageEl.classList.add("systemsculpt-message");
    messageEl.classList.add(`systemsculpt-${role}-message`);
    messageEl.dataset.messageId = messageId;
    const contentEl = messageEl.createEl("div", {
      cls: "systemsculpt-message-content"
    });
    if (typeof content === "string") {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(content, contentEl, "", this);
    } else if (Array.isArray(content)) {
      const parts = content;
      for (const part of parts) {
        if (part.type === "text") {
          const p = contentEl.createEl("p");
          p.setText(part.text);
        } else if (part.type === "image_url") {
          const img = contentEl.createEl("img", {
            attr: { src: part.image_url.url }
          });
          img.classList.add("systemsculpt-message-image");
        }
      }
    } else {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(String(content), contentEl, "", this);
    }
    this.setupImageHandlers(contentEl);
    return { messageEl, contentEl };
  }
  async renderMarkdownContent(content, containerEl) {
    containerEl.empty();
    const markdownWrapper = containerEl.createEl("div", {
      cls: "systemsculpt-markdown-wrapper"
    });
    const normalizedContent = content.replace(/\n{3,}/g, "\n\n");
    await import_obsidian17.MarkdownRenderer.renderMarkdown(normalizedContent, markdownWrapper, "", this);
    markdownWrapper.querySelectorAll("pre").forEach((preEl) => {
      var _a;
      const codeBlockWrapper = createEl("div", {
        cls: "systemsculpt-code-block-wrapper"
      });
      (_a = preEl.parentNode) == null ? void 0 : _a.replaceChild(codeBlockWrapper, preEl);
      codeBlockWrapper.appendChild(preEl);
    });
  }
  setupImageHandlers(containerEl) {
    containerEl.querySelectorAll("img").forEach((img) => {
      img.style.cursor = "pointer";
      img.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();
        const src = img.getAttribute("src");
        if (!src)
          return;
        if (src.startsWith("app://")) {
          const path = src.replace("app://local/", "");
          this.app.workspace.openLinkText(path, "", true);
        }
      });
    });
  }
  setToolbarVisibility(toolbar, visible, expanded = false) {
    toolbar.style.opacity = visible ? "1" : "0";
    toolbar.style.pointerEvents = visible ? "all" : "none";
    toolbar.style.transform = `translateY(calc(100% + ${expanded ? "4" : "8"}px))`;
  }
  addMessageButtonToolbar(messageEl, content, role, messageId) {
    const buttonToolbar = messageEl.createEl("div", {
      cls: "systemsculpt-message-button-toolbar"
    });
    const copyButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    copyButton.setAttribute("title", "Copy message to clipboard");
    (0, import_obsidian17.setIcon)(copyButton, "copy");
    copyButton.addEventListener("click", () => {
      navigator.clipboard.writeText(content);
      (0, import_obsidian17.setIcon)(copyButton, "check");
      copyButton.classList.add("success");
      setTimeout(() => {
        (0, import_obsidian17.setIcon)(copyButton, "copy");
        copyButton.classList.remove("success");
        this.setToolbarVisibility(buttonToolbar, false);
      }, 2e3);
    });
    if (role === "user") {
      const resubmitButton = buttonToolbar.createEl("button", {
        cls: "systemsculpt-message-button"
      });
      resubmitButton.setAttribute("title", "Resubmit this message");
      (0, import_obsidian17.setIcon)(resubmitButton, "rotate-ccw");
      resubmitButton.dataset.originalIcon = "rotate-ccw";
      resubmitButton.addEventListener("click", async (e) => {
        e.stopPropagation();
        const isConfirming = resubmitButton.dataset.confirming === "true";
        if (!isConfirming) {
          resubmitButton.dataset.confirming = "true";
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmit?" });
          resubmitButton.classList.add("confirming", "success");
          const timeoutId = setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 3e3);
          resubmitButton.dataset.timeoutId = timeoutId.toString();
        } else {
          const timeoutId = resubmitButton.dataset.timeoutId;
          if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
          }
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmitting..." });
          messageEl.dispatchEvent(new CustomEvent("resubmit", {
            bubbles: true,
            detail: { messageId, content }
          }));
          setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 1e3);
        }
      });
    }
    const editButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    editButton.setAttribute("title", "Edit this message");
    (0, import_obsidian17.setIcon)(editButton, "pencil");
    editButton.dataset.originalIcon = "pencil";
    editButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const currentContent = messageEl.dataset.content || content;
      const modal = new TextAreaModal(this.app, "Edit Message", currentContent, {
        primaryButton: "Save",
        secondaryButton: "Cancel",
        rows: 10
      });
      const newText = await modal.openAndGetValue();
      if (newText !== null && newText !== currentContent) {
        messageEl.dispatchEvent(new CustomEvent("edit", {
          bubbles: true,
          detail: {
            messageId,
            oldContent: currentContent,
            newContent: newText
          }
        }));
      }
    });
    const deleteButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button danger"
    });
    deleteButton.setAttribute("title", "Delete this message");
    (0, import_obsidian17.setIcon)(deleteButton, "trash");
    deleteButton.dataset.originalIcon = "trash";
    deleteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isConfirming = deleteButton.dataset.confirming === "true";
      if (!isConfirming) {
        deleteButton.dataset.confirming = "true";
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Delete?" });
        deleteButton.classList.add("confirming");
        const timeoutId = setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 3e3);
        deleteButton.dataset.timeoutId = timeoutId.toString();
      } else {
        const timeoutId = deleteButton.dataset.timeoutId;
        if (timeoutId) {
          clearTimeout(parseInt(timeoutId));
        }
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Deleting..." });
        messageEl.dispatchEvent(new CustomEvent("delete", {
          bubbles: true,
          detail: { messageId }
        }));
        setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 1e3);
      }
    });
    messageEl.addEventListener("mouseenter", () => {
      this.setToolbarVisibility(buttonToolbar, true, true);
    });
    messageEl.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !buttonToolbar.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
    buttonToolbar.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !messageEl.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
  }
  createReasoningContainer(messageEl) {
    const container = messageEl.createEl("div", {
      cls: "systemsculpt-reasoning-container"
    });
    const header = container.createEl("div", {
      cls: "systemsculpt-reasoning-header"
    });
    (0, import_obsidian17.setIcon)(header, "brain");
    header.createSpan({ text: "Reasoning" });
    header.addEventListener("click", () => {
      container.classList.toggle("collapsed");
    });
    const content = container.createEl("div", {
      cls: "systemsculpt-reasoning-content"
    });
    return { container, content };
  }
  updateReasoningContent(messageEl, reasoning, isComplete = false) {
    let container = messageEl.querySelector(".systemsculpt-reasoning-container");
    let content = messageEl.querySelector(".systemsculpt-reasoning-content");
    if (!container || !content) {
      const elements = this.createReasoningContainer(messageEl);
      container = elements.container;
      content = elements.content;
      messageEl.prepend(container);
    }
    content.textContent = reasoning;
    container.classList.add("visible");
    if (isComplete) {
      container.classList.add("collapsed");
    }
  }
};

// src/views/components/InputHandler.ts
var import_obsidian19 = __toModule(require("obsidian"));
init_errors();
init_ui();
init_ImageProcessor();

// src/services/TokenCounterService.ts
var import_obsidian18 = __toModule(require("obsidian"));
var TokenCounterService = class {
  constructor() {
    this.cache = new Map();
    this.fileCache = new Map();
    this.cacheSize = 1e3;
    this.handleFileModify = this.handleFileModify.bind(this);
    this.handleFileDelete = this.handleFileDelete.bind(this);
    this.handleFileRename = this.handleFileRename.bind(this);
  }
  handleFileModify(file) {
    if (file instanceof import_obsidian18.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileDelete(file) {
    if (file instanceof import_obsidian18.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileRename(file, oldPath) {
    if (file instanceof import_obsidian18.TFile) {
      this.fileCache.delete(oldPath);
    }
  }
  static getInstance() {
    if (!TokenCounterService.instance) {
      TokenCounterService.instance = new TokenCounterService();
    }
    return TokenCounterService.instance;
  }
  setApp(app) {
    this.app = app;
    this.app.vault.on("modify", this.handleFileModify);
    this.app.vault.on("delete", this.handleFileDelete);
    this.app.vault.on("rename", this.handleFileRename);
  }
  async getFileTokenCount(file) {
    const cached = this.fileCache.get(file.path);
    if (cached && cached.mtime === file.stat.mtime) {
      return cached.tokens;
    }
    const content = await this.app.vault.read(file);
    const tokens = this.approximateTokenCount(content);
    this.fileCache.set(file.path, {
      tokens,
      mtime: file.stat.mtime
    });
    return tokens;
  }
  approximateTokenCount(text) {
    if (!text)
      return 0;
    const cacheKey = `${text.slice(0, 100)}_${text.length}`;
    const cached = this.cache.get(cacheKey);
    if (cached !== void 0)
      return cached;
    text = text.replace(/\s+/g, " ").trim();
    let tokenCount = 0;
    const commonPatterns = [
      /^https?:\/\/\S+/gm,
      /[@#]\w+/g,
      /:[a-z_]+:/g,
      /[A-Z]{2,}/g,
      /\d{1,16}/g,
      /[.,!?;:(){}\[\]"']/g
    ];
    for (const pattern of commonPatterns) {
      const matches = text.match(pattern);
      if (matches) {
        tokenCount += matches.reduce((sum, match) => {
          if (match.startsWith("http")) {
            return sum + Math.ceil(match.length / 4);
          } else if (match.length <= 4) {
            return sum + 1;
          } else {
            return sum + Math.ceil(match.length / 3);
          }
        }, 0);
        text = text.replace(pattern, " ");
      }
    }
    const words = text.split(/\s+/).filter((w) => w.length > 0);
    for (const word of words) {
      let wordTokens = 1;
      if (word.length > 4) {
        wordTokens += Math.floor((word.length - 4) / 3);
      }
      if (/[a-z][A-Z]/.test(word)) {
        wordTokens += (word.match(/[A-Z]/g) || []).length;
      }
      const nonAscii = (word.match(/[^\x00-\x7F]/g) || []).length;
      if (nonAscii > 0) {
        wordTokens += Math.ceil(nonAscii * 1.5);
      }
      tokenCount += wordTokens;
    }
    tokenCount = Math.ceil(tokenCount * 1.1);
    this.cacheResult(cacheKey, tokenCount);
    return tokenCount;
  }
  cacheResult(key, value) {
    if (this.cache.size >= this.cacheSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
  clearCache() {
    this.cache.clear();
    this.fileCache.clear();
  }
  unload() {
    if (this.app) {
      this.app.vault.off("modify", this.handleFileModify);
      this.app.vault.off("delete", this.handleFileDelete);
      this.app.vault.off("rename", this.handleFileRename);
    }
  }
  formatTokenCount(count) {
    if (count === 0)
      return "";
    if (count < 100)
      return "< 100 tokens";
    if (count >= 1e3) {
      const inK = Math.ceil(count / 1e3);
      return `~${inK}K tokens`;
    } else {
      const inHundreds = Math.ceil(count / 100) * 100;
      return `~${inHundreds} tokens`;
    }
  }
};

// src/views/components/InputHandler.ts
var InputHandler = class extends import_obsidian19.Component {
  constructor(options) {
    super();
    this.isGenerating = false;
    this.renderTimeout = null;
    this.recorderVisualizer = null;
    this.isRecording = false;
    this.abortController = null;
    this.stopButton = null;
    this.tokenCountTimeout = null;
    this.webSearchEnabled = false;
    this.app = options.app;
    this.container = options.container;
    this.aiService = options.aiService;
    this.getMessages = options.getMessages;
    this.getSelectedModelId = options.getSelectedModelId;
    this.getContextFiles = options.getContextFiles;
    this.getSystemPrompt = options.getSystemPrompt;
    this.chatContainer = options.chatContainer;
    this.scrollManager = options.scrollManager;
    this.messageRenderer = options.messageRenderer;
    this.onMessageSubmit = options.onMessageSubmit;
    this.onAssistantResponse = options.onAssistantResponse;
    this.onContextFileAdd = options.onContextFileAdd;
    this.onError = options.onError;
    this.onAddContextFile = options.onAddContextFile;
    this.onEditSystemPrompt = options.onEditSystemPrompt;
    this.plugin = options.plugin;
    this.chatView = options.chatView;
    console.log("Initializing InputHandler with RecorderService");
    this.recorderService = RecorderService.getInstance(this.app, this.plugin, {
      isInChat: true,
      onTranscriptionComplete: (text) => {
        console.log("Received transcription, inserting at cursor position");
        this.insertTextAtCursor(text);
      }
    });
    const originalMessageSubmit = options.onMessageSubmit;
    this.onMessageSubmit = async (message) => {
      await originalMessageSubmit(message);
      await this.updateTokenCount().catch(console.error);
    };
    const originalAssistantResponse = options.onAssistantResponse;
    this.onAssistantResponse = async (message) => {
      await originalAssistantResponse(message);
      await this.updateTokenCount().catch(console.error);
    };
    this.tokenCounterService = TokenCounterService.getInstance();
    this.tokenCounterService.setApp(this.app);
    this.setupInput();
    setTimeout(() => {
      console.log("Running initial token count");
      console.log("Current messages:", this.getMessages().length);
      this.updateTokenCount().catch(console.error);
    }, 100);
  }
  setupInput() {
    var _a;
    this.inputContainer = this.container.createEl("div", {
      cls: "systemsculpt-input-container"
    });
    this.buttonGrid = this.inputContainer.createEl("div", {
      cls: "systemsculpt-button-grid"
    });
    const attachButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Add attachment" }
    });
    (0, import_obsidian19.setIcon)(attachButton, "paperclip");
    attachButton.addEventListener("click", (e) => {
      if (e.shiftKey) {
        this.handleDocumentUpload();
      } else {
        this.onAddContextFile();
      }
    });
    const settingsButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "System prompt settings" }
    });
    (0, import_obsidian19.setIcon)(settingsButton, "settings");
    settingsButton.addEventListener("click", () => {
      this.onEditSystemPrompt();
    });
    const webSearchButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Toggle web search" }
    });
    this.webSearchButton = webSearchButton;
    (0, import_obsidian19.setIcon)(webSearchButton, "globe");
    webSearchButton.addEventListener("click", async () => {
      const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
      const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
      const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
      if (!isNativeProvider && !isOpenRouter) {
        const result = await showPopup(this.app, "Web search allows the AI to access real-time information from the internet to provide up-to-date answers.", {
          title: "Feature Restriction - Web Search",
          description: "Web search is only available for SystemSculpt and OpenRouter models. Please switch to a compatible model to use this feature.",
          primaryButton: "OK"
        });
        return;
      }
      this.webSearchEnabled = !this.webSearchEnabled;
      webSearchButton.classList.toggle("is-enabled", this.webSearchEnabled);
    });
    const hasProLicense = ((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && this.plugin.settings.licenseValid;
    const micButton = this.buttonGrid.createEl("button", {
      cls: `systemsculpt-input-action-button systemsculpt-mic-button${hasProLicense ? "" : " pro-feature"}`,
      attr: {
        "aria-label": hasProLicense ? "Record audio message" : "Record audio message (Pro feature)",
        "aria-disabled": (!hasProLicense).toString(),
        title: hasProLicense ? "Record audio message" : "Recording is a Pro feature. Click to learn more."
      }
    });
    (0, import_obsidian19.setIcon)(micButton, "mic");
    micButton.classList.toggle("disabled", !hasProLicense);
    micButton.addEventListener("click", async () => {
      if (!hasProLicense) {
        const result = await showPopup(this.app, "Voice recording allows you to quickly capture your thoughts by speaking instead of typing. This feature includes automatic transcription of your recordings to text.", {
          title: "Pro Feature - Voice Recording",
          description: "Support SystemSculpt's development and unlock voice recording, transcription, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        });
        if (result == null ? void 0 : result.confirmed) {
          window.open(PATREON_URL, "_blank");
        }
        return;
      }
      this.handleMicClick();
    });
    const sendButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-send-button",
      attr: { "aria-label": "Send message" }
    });
    (0, import_obsidian19.setIcon)(sendButton, "send");
    sendButton.addEventListener("click", this.handleSendMessage.bind(this));
    this.stopButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-stop-button",
      attr: { "aria-label": "Stop generation" }
    });
    (0, import_obsidian19.setIcon)(this.stopButton, "square");
    this.stopButton.style.display = "none";
    this.stopButton.addEventListener("click", this.handleStopGeneration.bind(this));
    this.input = this.inputContainer.createEl("textarea", {
      cls: "systemsculpt-input systemsculpt-chat-input",
      attr: {
        rows: "1",
        placeholder: "Type a message..."
      }
    });
    this.tokenCounter = this.inputContainer.createEl("div", {
      cls: "systemsculpt-token-counter",
      text: "0 tokens"
    });
    this.input.addEventListener("keydown", this.handleKeyDown.bind(this));
    this.input.addEventListener("input", this.adjustInputHeight.bind(this));
    this.input.addEventListener("paste", this.handlePaste.bind(this));
    this.recorderService.onToggle((isRecording) => {
      this.isRecording = isRecording;
      const micButton2 = this.buttonGrid.querySelector(".systemsculpt-mic-button");
      if (micButton2) {
        micButton2.classList.toggle("active", isRecording);
      }
    });
    this.updateGeneratingState = () => {
      this.input.disabled = this.isGenerating;
      sendButton.disabled = this.isGenerating;
      micButton.disabled = this.isGenerating;
      attachButton.disabled = this.isGenerating;
      settingsButton.disabled = this.isGenerating;
      webSearchButton.disabled = this.isGenerating;
      if (this.stopButton) {
        this.stopButton.style.display = this.isGenerating ? "flex" : "none";
        sendButton.style.display = this.isGenerating ? "none" : "flex";
      }
      this.input.placeholder = this.isGenerating ? "Waiting for response..." : "Type a message...";
      this.input.classList.toggle("disabled", this.isGenerating);
      sendButton.classList.toggle("disabled", this.isGenerating);
      micButton.classList.toggle("disabled", this.isGenerating);
      attachButton.classList.toggle("disabled", this.isGenerating);
      settingsButton.classList.toggle("disabled", this.isGenerating);
      webSearchButton.classList.toggle("disabled", this.isGenerating);
    };
    this.input.addEventListener("input", () => {
      this.adjustInputHeight();
      if (this.tokenCountTimeout) {
        clearTimeout(this.tokenCountTimeout);
      }
      this.tokenCountTimeout = setTimeout(() => {
        this.updateTokenCount().catch(console.error);
      }, 300);
    });
    this.updateTokenCount().catch(console.error);
  }
  handleStopGeneration() {
    if (this.abortController) {
      this.abortController.abort();
      this.abortController = null;
      this.isGenerating = false;
      this.updateGeneratingState();
    }
  }
  async handleSendMessage() {
    var _a, _b;
    const currentModelId = this.getSelectedModelId();
    if (!currentModelId || currentModelId.trim() === "") {
      const result = await showPopup(this.app, "No model selected", {
        description: "Please select an AI model before sending a message.",
        primaryButton: "Select Model",
        secondaryButton: "Cancel"
      });
      if (result == null ? void 0 : result.confirmed) {
        const modal = new ModelSelectionModal(this.app, "", async (modelId) => {
          await this.chatView.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected. Please re-send your message.", "info");
        }, this.plugin);
        modal.open();
      }
      return;
    }
    if (this.plugin.settings.activeProvider.type === "native" && (!this.plugin.settings.licenseKey || !this.plugin.settings.licenseKey.trim())) {
      showPopup(this.app, "You don't have a license key. Please add a valid license key in settings to use SystemSculpt AI specific models.", {
        description: "License Key Required",
        primaryButton: "OK"
      });
      return;
    }
    const content = this.input.value.trim();
    if (!content || this.isGenerating)
      return;
    const tokenLimit = (_b = (_a = this.chatView).getTokenLimit) == null ? void 0 : _b.call(_a);
    if (tokenLimit) {
      const text = this.input.value;
      const messages = this.getMessages();
      const inputTokens = this.tokenCounterService.approximateTokenCount(text);
      let historyTokens = 0;
      for (const message of messages) {
        const content2 = typeof message.content === "string" ? message.content : JSON.stringify(message.content);
        historyTokens += this.tokenCounterService.approximateTokenCount(content2);
        historyTokens += 4;
      }
      const totalTokens = inputTokens + historyTokens;
      if (totalTokens > tokenLimit) {
        showEnhancedNotice(`Cannot send message: Token limit of ${tokenLimit.toLocaleString()} exceeded`, "error");
        return;
      }
    }
    this.input.value = "";
    this.adjustInputHeight();
    try {
      const userMessageId = this.generateMessageId();
      const userMessage = {
        role: "user",
        content,
        message_id: userMessageId
      };
      const modelId = this.webSearchEnabled ? `${this.getSelectedModelId()}:online` : this.getSelectedModelId();
      await this.onMessageSubmit(userMessage);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      const { messageEl, contentEl } = this.createAssistantMessageContainer();
      messageEl.setAttribute("data-message-id", this.generateMessageId());
      messageEl.appendChild(contentEl);
      let fullResponse = "";
      let accumulatedReasoning = "";
      this.isGenerating = true;
      this.updateGeneratingState();
      const loadingEl = contentEl.createEl("span", {
        cls: "systemsculpt-loading",
        text: " \u25CF Thinking..."
      });
      this.chatContainer.appendChild(messageEl);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      this.abortController = new AbortController();
      const systemPrompt = this.getSystemPrompt();
      try {
        for await (const chunk of this.aiService.streamMessage({
          messages: this.getMessages(),
          model: modelId,
          contextFiles: this.getContextFiles(),
          systemPromptType: systemPrompt.type,
          systemPromptPath: systemPrompt.path,
          signal: this.abortController.signal
        })) {
          if (!fullResponse) {
            loadingEl.textContent = " \u25CF Generating...";
          }
          if (chunk.content) {
            fullResponse += chunk.content;
            await this.scheduleRender(fullResponse, contentEl);
            contentEl.appendChild(loadingEl);
          }
          if (chunk.reasoning) {
            accumulatedReasoning += chunk.reasoning;
            this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning);
          }
          this.scrollManager.updateContentHeight();
          this.scrollManager.scrollToBottom();
        }
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        if (accumulatedReasoning) {
          this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning, true);
        }
        const assistantMessage = {
          role: "assistant",
          content: fullResponse,
          message_id: messageEl.getAttribute("data-message-id") || this.generateMessageId()
        };
        await this.onAssistantResponse(assistantMessage);
        this.messageRenderer.addMessageButtonToolbar(messageEl, fullResponse, "assistant", assistantMessage.message_id);
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
        messageEl.addEventListener("delete", async (e) => {
          const { messageId } = e.detail;
          const messages = this.getMessages();
          const index = messages.findIndex((msg) => msg.message_id === messageId);
          if (index !== -1) {
            messageEl.remove();
            this.scrollManager.updateContentHeight();
          }
        });
      } catch (error) {
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        messageEl.remove();
        console.error("Chat message error:", {
          error,
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : void 0
        });
        this.onError(error);
      } finally {
        this.isGenerating = false;
        this.abortController = null;
        this.updateGeneratingState();
        this.focus();
      }
    } catch (error) {
      console.error("Outer message handling error:", {
        error,
        message: error instanceof Error ? error.message : String(error),
        stack: error instanceof Error ? error.stack : void 0
      });
      this.isGenerating = false;
      this.abortController = null;
      this.updateGeneratingState();
      this.focus();
      this.onError(error);
    }
  }
  handleMicClick() {
    if (this.isGenerating)
      return;
    this.toggleRecording();
  }
  async toggleRecording() {
    await this.recorderService.toggleRecording();
    this.input.focus();
  }
  async handlePaste(e) {
    var _a;
    const dt = e.clipboardData;
    if (!dt)
      return;
    const pastedText = (_a = dt.getData("text/plain")) != null ? _a : "";
    const allFiles = Array.from(dt.files);
    if (!allFiles.length && pastedText) {
      return;
    }
    e.preventDefault();
    if (!allFiles.length) {
      return;
    }
    for (const file of allFiles) {
      try {
        let extension = "bin";
        if (file.name && file.name.includes(".")) {
          const dotIdx = file.name.lastIndexOf(".");
          if (dotIdx >= 0) {
            extension = file.name.substring(dotIdx + 1).toLowerCase();
          }
        } else if (file.type) {
          const mimeParts = file.type.split("/");
          if (mimeParts.length === 2) {
            extension = mimeParts[1].toLowerCase().replace(/[^a-z0-9]/g, "");
          }
        }
        const now = new Date();
        const isoString = now.toISOString().replace(/[:.]/g, "-");
        const newFileName = `pasted-${isoString}.${extension}`;
        const arrayBuffer = await file.arrayBuffer();
        const attachmentsDir = this.plugin.settings.attachmentsDirectory || "Attachments";
        const finalPath = `${attachmentsDir}/${newFileName}`;
        await this.ensureDirectoryExists(attachmentsDir);
        await this.app.vault.createBinary(finalPath, arrayBuffer);
        const createdFile = this.app.vault.getAbstractFileByPath(finalPath);
        if (createdFile instanceof import_obsidian19.TFile) {
          await this.chatView.addFileToContext(createdFile);
          new import_obsidian19.Notice(`Pasted file saved & added to context: ${createdFile.name}`);
        } else {
          throw new Error("Failed to locate pasted file in vault.");
        }
      } catch (err) {
        console.error("Error handling pasted file:", err);
        new import_obsidian19.Notice(`Failed to handle pasted file: ${err}`);
      }
    }
    if (pastedText) {
      this.insertTextAtCursor(pastedText);
    }
  }
  async handleKeyDown(event) {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      await this.handleSendMessage();
    }
  }
  async handleImagePaste(clipboardData) {
    const file = clipboardData.files[0];
    if (!file || !file.type.startsWith("image/")) {
      throw new SystemSculptError("No image in clipboard", ERROR_CODES.NO_IMAGE, 400);
    }
    const base64 = await ImageProcessor.processClipboardImage(clipboardData);
    return base64;
  }
  adjustInputHeight() {
    if (!this.input)
      return;
    this.input.style.height = "auto";
    const newHeight = Math.min(Math.max(this.input.scrollHeight, 48), 200);
    this.input.style.height = newHeight + "px";
  }
  focus() {
    this.input.focus();
  }
  getValue() {
    return this.input.value;
  }
  setValue(value) {
    if (!this.input) {
      console.error("Input element not found in setValue");
      return;
    }
    try {
      this.input.value = value;
      const inputEvent = new Event("input", {
        bubbles: true,
        cancelable: true
      });
      this.input.dispatchEvent(inputEvent);
      this.adjustInputHeight();
      this.input.focus();
      this.input.setSelectionRange(value.length, value.length);
    } catch (error) {
      console.error("Error in setValue:", error);
      new import_obsidian19.Notice("\u274C Failed to set input value");
    }
  }
  unload() {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    this.recorderService.setVisualizerCanvas(null);
    if (this.recorderVisualizer) {
      this.recorderVisualizer.remove();
      this.recorderVisualizer = null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  createAssistantMessageContainer() {
    return {
      messageEl: createDiv({
        cls: "systemsculpt-message systemsculpt-assistant-message"
      }),
      contentEl: createDiv({ cls: "systemsculpt-message-content" })
    };
  }
  async scheduleRender(content, containerEl) {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    const currentHeight = containerEl.offsetHeight;
    const tempContainer = containerEl.querySelector(".temp-text") || containerEl.createEl("div", { cls: "temp-text" });
    tempContainer.style.visibility = "hidden";
    tempContainer.style.position = "absolute";
    tempContainer.style.width = containerEl.offsetWidth + "px";
    await this.messageRenderer.renderMarkdownContent(content, tempContainer);
    if (currentHeight !== tempContainer.offsetHeight) {
      await this.messageRenderer.renderMarkdownContent(content, containerEl);
    } else {
      const lastChild = containerEl.lastChild;
      if (lastChild && lastChild.nodeType === Node.TEXT_NODE) {
        lastChild.textContent = content;
      } else {
        containerEl.appendChild(document.createTextNode(content));
      }
    }
    tempContainer.remove();
    return Promise.resolve();
  }
  async handleDocumentUpload() {
    var _a;
    try {
      if (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !this.plugin.settings.licenseValid) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Support SystemSculpt's development and unlock document processing, analysis, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result2) => {
          if (result2 == null ? void 0 : result2.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true);
      if (!isValid) {
        this.plugin.settings.licenseValid = false;
        await this.plugin.saveSettings();
        await showPopup(this.app, "Your license appears to be invalid. Please check your license key in settings.", {
          title: "License Invalid",
          primaryButton: "OK"
        });
        return;
      }
      const files = this.app.vault.getFiles();
      if (!files.length) {
        new import_obsidian19.Notice("No files found to upload.");
        return;
      }
      const firstFile = files[0];
      const result = await this.aiService.uploadDocument(firstFile);
      new import_obsidian19.Notice(`Uploaded doc. ID: ${result.documentId}, status: ${result.status}`);
    } catch (error) {
      if ((error == null ? void 0 : error.statusCode) === 401 || (error == null ? void 0 : error.statusCode) === 403) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Document processing requires an active Pro subscription. Support SystemSculpt's development by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result) => {
          if (result == null ? void 0 : result.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      new import_obsidian19.Notice(`Error uploading doc: ${error}`);
    }
  }
  async updateTokenCount() {
    var _a, _b;
    const text = this.input.value;
    const messages = this.getMessages();
    const contextFiles = this.getContextFiles();
    const inputTokens = this.tokenCounterService.approximateTokenCount(text);
    let historyTokens = 0;
    for (const message of messages) {
      const content = typeof message.content === "string" ? message.content : JSON.stringify(message.content);
      const messageTokens = this.tokenCounterService.approximateTokenCount(content);
      historyTokens += messageTokens;
      historyTokens += 4;
    }
    let contextTokens = 0;
    for (const filePath of contextFiles) {
      if (filePath.startsWith("doc:"))
        continue;
      try {
        const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
        const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
        if (resolvedFile instanceof import_obsidian19.TFile) {
          if (!resolvedFile.extension.match(/^(md|txt|markdown)$/i)) {
            continue;
          }
          const fileTokens = await this.tokenCounterService.getFileTokenCount(resolvedFile);
          contextTokens += fileTokens;
          contextTokens += 4;
        }
      } catch (error) {
        console.warn("Failed to process context file for token count:", error);
      }
    }
    const totalTokens = inputTokens + historyTokens + contextTokens;
    const tokenLimit = (_b = (_a = this.chatView).getTokenLimit) == null ? void 0 : _b.call(_a);
    if (totalTokens === 0 && contextFiles.size === 0) {
      this.tokenCounter.textContent = "";
    } else {
      this.tokenCounter.textContent = this.tokenCounterService.formatTokenCount(totalTokens);
    }
    if (tokenLimit) {
      const warningThreshold = Math.floor(tokenLimit * 0.9);
      this.tokenCounter.classList.toggle("warning", totalTokens > warningThreshold);
      if (totalTokens > warningThreshold) {
        this.tokenCounter.textContent = `${totalTokens.toLocaleString()} / ${tokenLimit.toLocaleString()} tokens`;
      }
      const submitButton = this.container.querySelector(".systemsculpt-submit-button");
      if (submitButton) {
        const isOverLimit = totalTokens > tokenLimit;
        submitButton.disabled = isOverLimit;
        submitButton.title = isOverLimit ? `Exceeds token limit of ${tokenLimit.toLocaleString()}` : "";
      }
    } else {
      this.tokenCounter.classList.remove("warning");
    }
  }
  async ensureDirectoryExists(dirPath) {
    try {
      await this.app.vault.adapter.mkdir(dirPath);
    } catch (err) {
      if (!err.message.includes("already exists"))
        throw err;
    }
  }
  insertTextAtCursor(text) {
    const cursorPos = this.input.selectionStart;
    const currentValue = this.input.value;
    if (cursorPos !== null) {
      const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
      this.input.value = newValue;
      this.input.selectionStart = this.input.selectionEnd = cursorPos + text.length;
    } else {
      this.input.value = currentValue + text;
      this.input.selectionStart = this.input.selectionEnd = this.input.value.length;
    }
    this.input.dispatchEvent(new Event("input"));
    this.input.focus();
  }
  updateWebSearchButtonState() {
    if (!this.webSearchButton)
      return;
    const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
    const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
    const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
    const webSearchAllowed = isNativeProvider || isOpenRouter;
    if (!webSearchAllowed && this.webSearchEnabled) {
      this.webSearchEnabled = false;
      this.webSearchButton.classList.remove("is-enabled");
    }
    this.webSearchButton.classList.toggle("disabled", !webSearchAllowed);
    this.webSearchButton.setAttribute("aria-disabled", (!webSearchAllowed).toString());
  }
  onModelChange() {
    this.updateWebSearchButtonState();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian22 = __toModule(require("obsidian"));

// src/modals/ContextSelectionModal.ts
var import_obsidian20 = __toModule(require("obsidian"));
var import_obsidian21 = __toModule(require("obsidian"));

// src/core/license/LicenseChecker.ts
init_ui();
var LicenseChecker = class {
  static requiresProLicense(extension) {
    return this.PRO_EXTENSIONS.includes(extension.toLowerCase());
  }
  static hasValidLicense(plugin) {
    var _a;
    return ((_a = plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && plugin.settings.licenseValid;
  }
  static async showProFeaturePopup(app) {
    const result = await showPopup(app, "Support SystemSculpt's development and unlock powerful document processing features. Upgrade to Pro to process PDFs, Word documents, and audio files.", {
      title: "Pro Feature Required",
      primaryButton: "Become a Patron",
      secondaryButton: "Maybe Later",
      icon: "sparkles"
    });
    if (result == null ? void 0 : result.confirmed) {
      window.open(PATREON_URL, "_blank");
    }
    return (result == null ? void 0 : result.confirmed) || false;
  }
  static async checkLicenseForFile(file, app, plugin) {
    if (this.requiresProLicense(file.extension.toLowerCase())) {
      if (!this.hasValidLicense(plugin)) {
        await this.showProFeaturePopup(app);
        return false;
      }
    }
    return true;
  }
};
LicenseChecker.PRO_EXTENSIONS = [
  "pdf",
  "doc",
  "docx",
  "ppt",
  "pptx",
  "xls",
  "xlsx",
  "mp3",
  "wav",
  "m4a",
  "ogg",
  "webm"
];

// src/modals/ContextSelectionModal.ts
var SUPPORTED_EXTENSIONS = {
  documents: ["md", "txt"],
  proDocuments: ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"],
  images: ["png", "jpg", "jpeg", "gif", "svg", "webp"],
  audio: ["mp3", "wav", "m4a", "ogg", "webm"]
};
var ALL_SUPPORTED_EXTENSIONS = Object.values(SUPPORTED_EXTENSIONS).flat();
var ContextSelectionModal = class extends import_obsidian20.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.tokenCounts = new Map();
    this.currentSearchResults = [];
    this.searchTimeout = null;
    this.selectedExtensions = new Set();
    this.extensionButtons = new Map();
    this.selectedFiles = new Set();
    this.selectedIndex = 0;
    this.resultElements = [];
    this.onSelect = onSelect;
    this.searchService = new SearchService();
    this.tokenCounter = TokenCounterService.getInstance();
    this.plugin = plugin;
    this.files = this.getAvailableFiles();
    this.selectedExtensions.add("md");
  }
  getAvailableFiles() {
    return this.app.vault.getFiles().filter((file) => ALL_SUPPORTED_EXTENSIONS.includes(file.extension.toLowerCase()));
  }
  getSearchFields(file) {
    return [
      { field: "title", text: file.basename, weight: 100 },
      { field: "path", text: file.path, weight: 75 },
      { field: "extension", text: file.extension, weight: 50 }
    ];
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
  highlightText(text, matches = []) {
    var _a;
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendText(text.slice(lastIndex, match.index));
      }
      const span = fragment.createSpan({
        cls: "systemsculpt-highlight",
        text: match[0]
      });
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  createLoadingIndicator() {
    const container = createDiv({ cls: "systemsculpt-context-loading" });
    (0, import_obsidian21.setIcon)(container, "loader-2");
    container.appendChild(createSpan({ text: "Loading..." }));
    return container;
  }
  createEmptyState() {
    const container = createDiv({ cls: "systemsculpt-context-empty" });
    (0, import_obsidian21.setIcon)(container, "search");
    container.appendChild(createSpan({ text: "No matching files found" }));
    return container;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  createCard(file, result) {
    var _a;
    const card = createDiv({ cls: "systemsculpt-context-card" });
    card.setAttribute("tabindex", "0");
    const cardContent = card.createDiv({ cls: "systemsculpt-card-content" });
    if (file.extension.match(/png|jpe?g|gif|svg|webp/i)) {
      const thumbContainer = cardContent.createDiv({
        cls: "systemsculpt-context-thumbnail"
      });
      (async () => {
        try {
          const arrayBuffer = await this.app.vault.readBinary(file);
          const blob = new Blob([arrayBuffer]);
          const objectUrl = URL.createObjectURL(blob);
          const img = thumbContainer.createEl("img", {
            cls: "systemsculpt-context-thumb-img",
            attr: { src: objectUrl }
          });
        } catch (err) {
          console.error("Error loading thumbnail:", err);
        }
      })();
    }
    if (this.selectedFiles.has(file)) {
      card.addClass("is-added");
      const checkIcon = card.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    const textContainer = cardContent.createDiv({
      cls: "systemsculpt-card-text"
    });
    const title = textContainer.createDiv({
      cls: "systemsculpt-context-title"
    });
    title.appendChild(this.highlightText(file.basename, result.matches.filter((m) => m.field === "title")));
    const path = textContainer.createDiv({ cls: "systemsculpt-context-path" });
    path.appendChild(this.highlightText(file.path, result.matches.filter((m) => m.field === "path")));
    const meta = textContainer.createDiv({ cls: "systemsculpt-context-meta" });
    const typeGroup = meta.createDiv({
      cls: "systemsculpt-context-type-group"
    });
    const type = typeGroup.createDiv({ cls: "systemsculpt-context-type" });
    type.setText(file.extension.toUpperCase());
    if (LicenseChecker.requiresProLicense(file.extension)) {
      const proBadge = typeGroup.createDiv({
        cls: "systemsculpt-context-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge.createSpan(), "sparkles");
      proBadge.createSpan({ text: "Pro" });
    }
    const metaGroup = meta.createDiv({
      cls: "systemsculpt-context-meta-group"
    });
    const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
    size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
    if (file.extension === "md" || file.extension === "txt") {
      const tokenCount = metaGroup.createDiv({
        cls: "systemsculpt-context-token-count"
      });
      const count = this.tokenCounts.get(file.path) || 0;
      tokenCount.setText(this.tokenCounter.formatTokenCount(count));
      if (!this.tokenCounts.has(file.path)) {
        this.updateTokenCount(file).then(() => {
          tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
        });
      }
    }
    card.addEventListener("click", () => {
      this.toggleFileSelection(file, card);
    });
    card.addEventListener("mouseenter", () => {
      const index = this.resultElements.indexOf(card);
      if (index >= 0) {
        this.selectedIndex = index;
        this.updateSelectedResult();
      }
    });
    return card;
  }
  updateSelectedResult() {
    this.resultElements.forEach((el, index) => {
      el.toggleClass("is-selected", index === this.selectedIndex && this.selectedIndex >= 0);
    });
    if (this.selectedIndex >= 0 && this.selectedIndex < this.resultElements.length) {
      this.resultElements[this.selectedIndex].scrollIntoView({
        behavior: "smooth",
        block: "nearest"
      });
    }
  }
  async toggleFileSelection(file, cardEl) {
    var _a;
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (this.selectedFiles.has(file)) {
      this.selectedFiles.delete(file);
      cardEl.removeClass("is-added");
      (_a = cardEl.querySelector(".systemsculpt-context-check")) == null ? void 0 : _a.remove();
    } else {
      this.selectedFiles.add(file);
      cardEl.addClass("is-added");
      const checkIcon = cardEl.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    this.updateActionButton();
  }
  updateActionButton() {
    const actionButton = this.containerEl.querySelector(".systemsculpt-context-action-button");
    if (actionButton) {
      const count = this.selectedFiles.size;
      actionButton.setText(count > 0 ? `Add ${count} selected file${count === 1 ? "" : "s"}` : "Select files to add as context");
      actionButton.toggleClass("is-active", count > 0);
    }
  }
  renderResults(searchResults) {
    this.resultsContainer.empty();
    this.resultElements = [];
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      this.emptyState.style.display = "flex";
      return;
    }
    this.emptyState.style.display = "none";
    const grid = this.resultsContainer.createDiv({
      cls: "systemsculpt-context-grid"
    });
    searchResults.forEach((result, index) => {
      const card = this.createCard(result.item, result);
      grid.appendChild(card);
      this.resultElements.push(card);
    });
  }
  getUniqueExtensions() {
    const extensions = new Set();
    this.files.forEach((file) => {
      if (file.extension) {
        extensions.add(file.extension.toLowerCase());
      }
    });
    return Array.from(extensions).sort((a, b) => {
      if (a === "md")
        return -1;
      if (b === "md")
        return 1;
      const aIsPro = LicenseChecker.requiresProLicense(a);
      const bIsPro = LicenseChecker.requiresProLicense(b);
      if (aIsPro && !bIsPro)
        return 1;
      if (!aIsPro && bIsPro)
        return -1;
      return a.localeCompare(b);
    });
  }
  createExtensionButton(extension) {
    const button = createDiv({
      cls: "systemsculpt-extension-button"
    });
    const iconContainer = button.createSpan({
      cls: "systemsculpt-extension-icon"
    });
    if (SUPPORTED_EXTENSIONS.documents.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "file-text");
    } else if (SUPPORTED_EXTENSIONS.images.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "image");
    } else if (SUPPORTED_EXTENSIONS.audio.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "headphones");
    }
    button.createSpan({
      text: extension.toUpperCase(),
      cls: "systemsculpt-extension-text"
    });
    if (LicenseChecker.requiresProLicense(extension)) {
      const proBadge = button.createSpan({
        cls: "systemsculpt-extension-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge, "sparkles");
    }
    button.addEventListener("click", () => {
      if (this.selectedExtensions.has(extension)) {
        this.selectedExtensions.delete(extension);
        button.removeClass("is-selected");
      } else {
        this.selectedExtensions.add(extension);
        button.addClass("is-selected");
      }
      this.performSearch(this.searchInput.value);
    });
    return button;
  }
  performSearch(query) {
    let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
    results.sort((a, b) => {
      if (b.score !== a.score)
        return b.score - a.score;
      return a.item.basename.localeCompare(b.item.basename);
    });
    this.renderResults(results);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-context-modal");
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-context-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search files to add as context..."
    });
    const extensionContainer = contentEl.createDiv({
      cls: "systemsculpt-extension-container"
    });
    const extensions = this.getUniqueExtensions();
    extensions.forEach((ext) => {
      const button = this.createExtensionButton(ext);
      this.extensionButtons.set(ext, button);
      extensionContainer.appendChild(button);
    });
    const mdBtn = this.extensionButtons.get("md");
    if (mdBtn)
      mdBtn.addClass("is-selected");
    this.loadingIndicator = this.createLoadingIndicator();
    contentEl.appendChild(this.loadingIndicator);
    this.emptyState = this.createEmptyState();
    this.emptyState.style.display = "none";
    contentEl.appendChild(this.emptyState);
    const scrollContainer = contentEl.createDiv({
      cls: "systemsculpt-scroll-container"
    });
    this.resultsContainer = scrollContainer.createDiv();
    const actionContainer = contentEl.createDiv({
      cls: "systemsculpt-action-container"
    });
    const actionButton = actionContainer.createEl("button", {
      cls: "systemsculpt-context-action-button",
      text: "Select files to add as context"
    });
    actionButton.addEventListener("click", () => {
      if (this.selectedFiles.size > 0) {
        this.onSelect(Array.from(this.selectedFiles));
        this.close();
      }
    });
    this.updateActionButton();
    this.loadingIndicator.style.display = "flex";
    this.resultsContainer.empty();
    this.setupEventListeners();
    this.containerEl.addEventListener("keydown", (e) => {
      if (document.activeElement === this.searchInput)
        return;
      if (this.currentSearchResults.length === 0)
        return;
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey && this.selectedIndex === 0) {
          this.searchInput.focus();
          return;
        }
        if (e.shiftKey) {
          this.selectedIndex = (this.selectedIndex - 1 + this.resultElements.length) % this.resultElements.length;
        } else {
          this.selectedIndex = (this.selectedIndex + 1) % this.resultElements.length;
        }
        this.updateSelectedResult();
        return;
      }
      if (e.code === "Space") {
        e.preventDefault();
        const file = this.currentSearchResults[this.selectedIndex].item;
        const cardEl = this.resultElements[this.selectedIndex];
        this.toggleFileSelection(file, cardEl);
        return;
      }
      if (e.key === "Enter") {
        e.preventDefault();
        if (this.selectedFiles.size > 0) {
          this.onSelect(Array.from(this.selectedFiles));
          this.close();
        }
        return;
      }
    });
    this.searchInput.focus();
    this.performSearch("");
    this.loadingIndicator.style.display = "none";
  }
  setupEventListeners() {
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        e.stopPropagation();
        if (this.resultElements.length > 0) {
          if (e.shiftKey) {
            this.selectedIndex = this.resultElements.length - 1;
          } else {
            this.selectedIndex = 0;
          }
          this.updateSelectedResult();
          this.resultElements[this.selectedIndex].focus();
        }
      }
    });
    this.searchInput.addEventListener("focus", () => {
      this.selectedIndex = -1;
      this.updateSelectedResult();
    });
    this.searchInput.addEventListener("input", () => {
      if (this.searchTimeout) {
        window.clearTimeout(this.searchTimeout);
      }
      this.searchTimeout = window.setTimeout(() => {
        const query = this.searchInput.value;
        let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
        results.sort((a, b) => {
          if (b.score !== a.score)
            return b.score - a.score;
          return a.item.basename.localeCompare(b.item.basename);
        });
        this.renderResults(results);
      }, 150);
    });
  }
  onClose() {
    if (this.searchTimeout) {
      window.clearTimeout(this.searchTimeout);
    }
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian23 = __toModule(require("obsidian"));
var FileContextManager = class extends import_obsidian22.Component {
  constructor(options) {
    super();
    this.contextFiles = new Set();
    this.processingStatus = null;
    this.processingFiles = new Map();
    this.processingTimeouts = new Map();
    this.syncStatusEl = null;
    this.isSyncing = false;
    this.tokenCounts = new Map();
    this.app = options.app;
    this.onContextChange = options.onContextChange;
    this.sculptService = options.sculptService;
    this.plugin = options.plugin;
    this.tokenCounter = TokenCounterService.getInstance();
    this.drawer = new DrawerComponent({
      container: options.container,
      title: options.title || "Context Files"
    });
    this.contextPanel = this.drawer.getDrawer();
    this.setupContextPanel();
    this.initializeProcessingStatus();
  }
  initializeProcessingStatus() {
    this.processingStatus = this.contextPanel.createEl("div", {
      cls: "systemsculpt-processing-status"
    });
    this.processingStatus.style.display = "none";
  }
  updateProcessingStatus(file, status, icon, remove = false) {
    const fileId = file.path;
    let statusEl = this.processingFiles.get(fileId);
    const existingTimeout = this.processingTimeouts.get(fileId);
    if (existingTimeout) {
      clearTimeout(existingTimeout);
      this.processingTimeouts.delete(fileId);
    }
    if (!statusEl && !remove && this.processingStatus) {
      statusEl = this.processingStatus.createEl("div", {
        cls: "systemsculpt-file-status"
      });
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
      this.processingFiles.set(fileId, statusEl);
    } else if (statusEl && !remove) {
      statusEl.empty();
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
    } else if (statusEl && remove) {
      statusEl.remove();
      this.processingFiles.delete(fileId);
    }
    if (this.processingStatus) {
      this.processingStatus.style.display = this.processingFiles.size > 0 ? "block" : "none";
    }
    if (remove || status.includes("successfully") || status.includes("completed") || status.includes("Error:")) {
      const timeout = setTimeout(() => {
        this.updateProcessingStatus(file, "", "", true);
        this.processingTimeouts.delete(fileId);
      }, 3e3);
      this.processingTimeouts.set(fileId, timeout);
    }
  }
  setupContextPanel() {
    const titleEl = this.contextPanel.querySelector(".systemsculpt-drawer-title");
    if (!titleEl)
      return;
    const contextCount = titleEl.createSpan({
      cls: "systemsculpt-drawer-count",
      text: "0"
    });
    this.syncStatusEl = titleEl.createSpan({
      cls: "systemsculpt-sync-status synced"
    });
    (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    const contextButton = titleEl.createEl("button", {
      cls: "systemsculpt-context-add-button"
    });
    (0, import_obsidian22.setIcon)(contextButton, "plus");
    contextButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.addContextFile();
    });
    this.updateContextPanel();
  }
  updateSyncStatus(syncing = false) {
    if (!this.syncStatusEl)
      return;
    this.isSyncing = syncing;
    this.syncStatusEl.empty();
    if (syncing) {
      this.syncStatusEl.removeClass("synced");
      this.syncStatusEl.addClass("syncing");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "loader-2");
    } else {
      this.syncStatusEl.removeClass("syncing");
      this.syncStatusEl.addClass("synced");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    }
  }
  async checkSyncStatus() {
    if (this.contextFiles.size === 0) {
      this.updateSyncStatus(false);
      return;
    }
    this.updateSyncStatus(true);
    this.updateSyncStatus(false);
  }
  updateContextPanel() {
    var _a;
    if (!this.contextPanel)
      return;
    const header = this.contextPanel.querySelector(".systemsculpt-drawer-header");
    const content = this.contextPanel.querySelector(".systemsculpt-drawer-content");
    const count = this.contextPanel.querySelector(".systemsculpt-drawer-count");
    if (!header || !content || !count)
      return;
    count.textContent = this.contextFiles.size.toString();
    content.empty();
    if (this.contextFiles.size === 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-empty",
        text: "No context files added yet. Click the plus button to add files in your chat."
      });
      return;
    }
    const categories = {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
    const documentGroups = new Map();
    const nonExtractedFiles = new Set();
    for (const filePath of this.contextFiles) {
      const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      if (cleanPath.includes("/Extractions/")) {
        const parts = cleanPath.split("/");
        const extractionDirIndex = parts.indexOf("Extractions");
        if (extractionDirIndex >= 0 && extractionDirIndex + 1 < parts.length) {
          const sourceDoc = parts[extractionDirIndex + 1];
          if (!documentGroups.has(sourceDoc)) {
            documentGroups.set(sourceDoc, new Set());
          }
          (_a = documentGroups.get(sourceDoc)) == null ? void 0 : _a.add(filePath);
        } else {
          nonExtractedFiles.add(filePath);
        }
      } else {
        nonExtractedFiles.add(filePath);
      }
    }
    this.categorizeFiles(Array.from(nonExtractedFiles), categories);
    for (const categoryKey of ["text", "images", "audio"]) {
      const category = categories[categoryKey];
      if (category.files.length > 0) {
        this.renderCategory(content, category);
      }
    }
    if (categories.documents.files.length > 0 || documentGroups.size > 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-category",
        text: "Documents"
      });
      this.renderFiles(content, categories.documents.files);
      for (const [sourceDoc, extractedFiles] of documentGroups) {
        content.createEl("div", {
          cls: "systemsculpt-drawer-category",
          text: `\u{1F4C4} ${sourceDoc} Extractions`
        });
        const extractedCategories = this.createCategories();
        this.categorizeFiles(Array.from(extractedFiles), extractedCategories);
        const textFiles = extractedCategories.text.files;
        if (textFiles.length > 0) {
          this.renderFiles(content, textFiles);
        }
        const imageFiles = extractedCategories.images.files;
        if (imageFiles.length > 0) {
          this.renderFiles(content, imageFiles);
        }
        const otherFiles = [
          ...extractedCategories.audio.files,
          ...extractedCategories.documents.files
        ];
        if (otherFiles.length > 0) {
          this.renderFiles(content, otherFiles);
        }
      }
    }
  }
  createCategories() {
    return {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
  }
  categorizeFiles(files, categories) {
    for (const filePath of files) {
      const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
      if (resolvedFile instanceof import_obsidian22.TFile) {
        const extension = resolvedFile.extension.toLowerCase();
        let categoryFound = false;
        for (const [category, info] of Object.entries(categories)) {
          if (info.extensions.includes(extension)) {
            info.files.push({ file: resolvedFile, path: filePath, linkText });
            categoryFound = true;
            break;
          }
        }
        if (!categoryFound) {
          categories.documents.files.push({
            file: resolvedFile,
            path: filePath,
            linkText
          });
        }
      }
    }
  }
  renderCategory(container, category) {
    if (category.files.length === 0)
      return;
    container.createEl("div", {
      cls: "systemsculpt-drawer-category",
      text: category.label
    });
    this.renderFiles(container, category.files);
  }
  renderFiles(container, files) {
    var _a;
    files.sort((a, b) => a.file.basename.localeCompare(b.file.basename));
    const imagePreview = document.body.createEl("img", {
      cls: "systemsculpt-preview systemsculpt-image-preview"
    });
    const markdownPreview = document.body.createDiv({
      cls: "systemsculpt-preview systemsculpt-markdown-preview"
    });
    let isMarkdownPreviewVisible = false;
    const handleWheel = (e) => {
      if (!isMarkdownPreviewVisible)
        return;
      e.preventDefault();
      const scrollAmount = e.deltaY;
      markdownPreview.scrollTop += scrollAmount;
    };
    document.addEventListener("wheel", handleWheel, { passive: false });
    this.register(() => {
      document.removeEventListener("wheel", handleWheel);
    });
    const calculatePreviewDimensions = (naturalWidth, naturalHeight, viewportWidth, viewportHeight) => {
      const maxWidth = Math.min(viewportWidth * 0.4, naturalWidth);
      const maxHeight = Math.min(viewportHeight * 0.6, naturalHeight);
      let width = naturalWidth;
      let height = naturalHeight;
      if (width > maxWidth) {
        width = maxWidth;
        height = naturalHeight * maxWidth / naturalWidth;
      }
      if (height > maxHeight) {
        height = maxHeight;
        width = naturalWidth * maxHeight / naturalHeight;
      }
      return { width, height };
    };
    const updatePreviewPosition = (e, previewEl) => {
      if (!previewEl)
        return;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const rect = previewEl.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      let x = e.clientX + 16;
      let y = e.clientY + 16;
      if (x + width > viewportWidth) {
        x = e.clientX - width - 16;
      }
      if (y + height > viewportHeight) {
        y = e.clientY - height - 16;
      }
      previewEl.style.left = `${x}px`;
      previewEl.style.top = `${y}px`;
    };
    this.register(() => {
      imagePreview.remove();
      markdownPreview.remove();
    });
    for (const { file, path, linkText } of files) {
      const item = container.createEl("div", {
        cls: "systemsculpt-drawer-item"
      });
      const pathEl = item.createEl("div", {
        cls: "systemsculpt-drawer-item-path"
      });
      const iconContainer = pathEl.createSpan({
        cls: "systemsculpt-file-icon"
      });
      const extension = file.extension.toLowerCase();
      let iconName = "file";
      const link = pathEl.createEl("a", {
        cls: "internal-link",
        text: file.basename,
        attr: {
          href: path,
          "data-href": path
        }
      });
      if (["md", "txt", "markdown"].includes(extension)) {
        iconName = "file-text";
        const showMarkdownPreview = async (e) => {
          try {
            const mdFile = this.app.vault.getAbstractFileByPath(file.path);
            if (mdFile instanceof import_obsidian22.TFile) {
              const content = await this.app.vault.read(mdFile);
              markdownPreview.empty();
              markdownPreview.createDiv({
                cls: "systemsculpt-preview-header",
                text: file.basename
              });
              const contentEl = markdownPreview.createDiv();
              await import_obsidian23.MarkdownRenderer.renderMarkdown(content.length > 4e3 ? content.slice(0, 4e3) + "\n\n---\n\n**Click to view full document** (showing first 4000 of " + content.length + " characters)" : content, contentEl, file.path, this);
              markdownPreview.classList.add("visible");
              isMarkdownPreviewVisible = true;
              updatePreviewPosition(e, markdownPreview);
            }
          } catch (error) {
            console.error("Failed to load markdown preview:", error);
          }
        };
        const hideMarkdownPreview = () => {
          markdownPreview.classList.remove("visible");
          markdownPreview.empty();
          isMarkdownPreviewVisible = false;
          markdownPreview.scrollTop = 0;
        };
        item.addEventListener("mouseenter", showMarkdownPreview);
        item.addEventListener("mouseleave", hideMarkdownPreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, markdownPreview));
        markdownPreview.addEventListener("mouseleave", hideMarkdownPreview);
        this.register(() => {
          markdownPreview.removeEventListener("mouseleave", hideMarkdownPreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideMarkdownPreview);
      } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        iconName = "image";
        const showImagePreview = async (e) => {
          try {
            const imageFile = this.app.vault.getAbstractFileByPath(file.path);
            if (imageFile instanceof import_obsidian22.TFile) {
              const arrayBuffer = await this.app.vault.readBinary(imageFile);
              const blob = new Blob([arrayBuffer]);
              const url = URL.createObjectURL(blob);
              imagePreview.src = url;
              imagePreview.onload = () => {
                URL.revokeObjectURL(url);
                imagePreview.classList.add("visible");
                const { width, height } = calculatePreviewDimensions(imagePreview.naturalWidth, imagePreview.naturalHeight, window.innerWidth, window.innerHeight);
                imagePreview.style.width = `${width}px`;
                imagePreview.style.height = `${height}px`;
                updatePreviewPosition(e, imagePreview);
              };
            }
          } catch (error) {
            console.error("Failed to load image preview:", error);
          }
        };
        const hideImagePreview = () => {
          imagePreview.classList.remove("visible");
          imagePreview.src = "";
          imagePreview.style.width = "";
          imagePreview.style.height = "";
        };
        item.addEventListener("mouseenter", showImagePreview);
        item.addEventListener("mouseleave", hideImagePreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, imagePreview));
        imagePreview.addEventListener("mouseleave", hideImagePreview);
        this.register(() => {
          imagePreview.removeEventListener("mouseleave", hideImagePreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideImagePreview);
      } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
        iconName = "audio-lines";
      } else if (["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"].includes(extension)) {
        iconName = "file";
      }
      (0, import_obsidian22.setIcon)(iconContainer, iconName);
      link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        this.app.workspace.openLinkText(linkText, "", true);
      });
      const meta = item.createDiv({ cls: "systemsculpt-context-meta" });
      const type = meta.createDiv({ cls: "systemsculpt-context-type" });
      type.setText(file.extension.toUpperCase());
      const metaGroup = meta.createDiv({
        cls: "systemsculpt-context-meta-group"
      });
      const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
      size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
      if (file.extension === "md" || file.extension === "txt") {
        const tokenCount = metaGroup.createDiv({
          cls: "systemsculpt-context-token-count"
        });
        const count = this.tokenCounts.get(file.path) || 0;
        tokenCount.setText(this.tokenCounter.formatTokenCount(count));
        if (!this.tokenCounts.has(file.path)) {
          this.updateTokenCount(file).then(() => {
            tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
          });
        }
      }
      const removeBtn = item.createEl("button", {
        cls: "systemsculpt-drawer-item-remove",
        text: "\xD7"
      });
      removeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        this.removeContextFile(path);
      });
    }
  }
  async addContextFile() {
    const modal = new ContextSelectionModal(this.app, async (files) => {
      for (const file of files) {
        try {
          await this.addFileToContext(file);
        } catch (error) {
          this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
          setTimeout(() => {
            this.updateProcessingStatus(file, "", "", true);
          }, 3e3);
        }
      }
    }, this.plugin);
    modal.open();
  }
  async removeContextFile(filePath) {
    const normalizedPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    this.contextFiles.delete(filePath);
    this.contextFiles.delete(`[[${normalizedPath}]]`);
    this.updateContextPanel();
    await this.onContextChange();
  }
  async addFileToContext(file) {
    const extension = file.extension.toLowerCase();
    const datalabDocExtensions = [
      "pdf",
      "doc",
      "docx",
      "xls",
      "xlsx",
      "ppt",
      "pptx"
    ];
    const audioExtensions = ["wav", "m4a", "webm", "ogg", "mp3"];
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (datalabDocExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processDocumentFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else if (audioExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processAudioFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else {
      const wikiLink = `[[${file.path}]]`;
      this.contextFiles.add(wikiLink);
    }
    this.updateContextPanel();
    await this.onContextChange();
  }
  async processDocumentFile(file) {
    var _a, _b;
    this.updateProcessingStatus(file, "Uploading...", "upload");
    const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
    if (!cached) {
      this.updateProcessingStatus(file, "Processing...", "loader-2");
      const success = await this.pollUntilComplete(documentId);
      if (!success) {
        throw new Error("Document processing not completed in time.");
      }
    }
    this.updateProcessingStatus(file, "Downloading results...", "download");
    const extractionData = await this.downloadExtraction(documentId);
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
    await this.app.vault.createFolder(parentPath).catch(() => {
    });
    const extractedText = this.getExtractionMarkdown(extractionData);
    const newMdPath = `${parentPath}/${baseName}.md`;
    try {
      await this.app.vault.create(newMdPath, extractedText);
    } catch (error) {
      if (!(error instanceof Error) || !error.message.includes("already exists")) {
        throw error;
      }
    }
    const mdWikiLink = `[[${newMdPath}]]`;
    this.contextFiles.add(mdWikiLink);
    if (extractionData.images && typeof extractionData.images === "object") {
      for (const [filename, base64Data] of Object.entries(extractionData.images)) {
        const imagePath = `${parentPath}/${filename.replace(/[\\/:*?"<>|]/g, "-").trim()}`;
        try {
          await this.app.vault.createBinary(imagePath, this.decodeBase64(base64Data));
        } catch (error) {
          if (!(error instanceof Error) || !error.message.includes("already exists")) {
            throw error;
          }
        }
        const imageWikiLink = `[[${imagePath}]]`;
        this.contextFiles.add(imageWikiLink);
      }
    }
    return newMdPath;
  }
  getExtractionMarkdown(extractionData) {
    var _a, _b, _c;
    const text = (_a = extractionData == null ? void 0 : extractionData.text) != null ? _a : "";
    const metadata = (_b = extractionData == null ? void 0 : extractionData.metadata) != null ? _b : {};
    const pageCount = (_c = extractionData == null ? void 0 : extractionData.pageCount) != null ? _c : 0;
    return `# Document Extraction
Page Count: ${pageCount}

${text}

${metadata ? `
# Metadata
${JSON.stringify(metadata, null, 2)}` : ""}
`;
  }
  decodeBase64(base64String) {
    const binaryStr = window.atob(base64String);
    const len = binaryStr.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryStr.charCodeAt(i);
    }
    return bytes.buffer;
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  getContextFiles() {
    return this.contextFiles;
  }
  async setContextFiles(files) {
    this.contextFiles = new Set(files);
    this.updateContextPanel();
    await this.checkSyncStatus();
  }
  getContainer() {
    return this.contextPanel;
  }
  unload() {
    this.processingTimeouts.forEach((timeout) => {
      clearTimeout(timeout);
    });
    this.processingTimeouts.clear();
    this.processingFiles.forEach((statusEl) => {
      statusEl.remove();
    });
    this.processingFiles.clear();
    if (this.processingStatus) {
      this.processingStatus.style.display = "none";
    }
    this.drawer.unload();
  }
  async processAudioFile(file, timestamped = false) {
    var _a, _b;
    this.updateProcessingStatus(file, "Transcribing audio...", "loader-2");
    try {
      const transcriptionService = TranscriptionService.getInstance(this.plugin);
      const text = await transcriptionService.transcribeFile(file, {
        type: "note",
        timestamped,
        onProgress: (progress, status) => {
          this.updateProcessingStatus(file, status, "loader-2");
        }
      });
      const extractionFolder = this.sculptService.extractionsDirectory;
      const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
      const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
      await this.app.vault.createFolder(parentPath).catch(() => {
      });
      const outputPath = `${parentPath}/${baseName}.md`;
      const finalContent = `# Audio Transcription
Source: ${file.basename}
Transcribed: ${new Date().toISOString()}

${text}`;
      try {
        const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
        if (existingFile instanceof import_obsidian22.TFile) {
          await this.app.vault.modify(existingFile, finalContent);
        } else {
          await this.app.vault.create(outputPath, finalContent);
        }
      } catch (error) {
        console.error("File operation failed:", error);
        throw error;
      }
      this.updateProcessingStatus(file, "Added successfully!", "check-circle");
      return outputPath;
    } catch (error) {
      console.error("Audio transcription error:", error);
      this.updateProcessingStatus(file, `Error: ${error instanceof Error ? error.message : String(error)}`, "x-circle");
      throw error;
    }
  }
  async pollUntilComplete(documentId) {
    var _a, _b, _c;
    const maxTries = 50;
    for (let i = 0; i < maxTries; i++) {
      await this.sleep(3e3);
      const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}`;
      const resp = await fetch(url);
      if (!resp.ok)
        continue;
      const data = await resp.json();
      if (((_a = data == null ? void 0 : data.data) == null ? void 0 : _a.status) === "completed")
        return true;
      if (((_b = data == null ? void 0 : data.data) == null ? void 0 : _b.status) === "error") {
        throw new Error(((_c = data == null ? void 0 : data.data) == null ? void 0 : _c.error) || "Processing failed");
      }
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}/download`;
    const resp = await fetch(url);
    if (!resp.ok) {
      throw new Error(`Download extraction failed: ${resp.status}`);
    }
    const data = await resp.json();
    if (!data.success) {
      throw new Error(data.error || "Failed to download extraction");
    }
    return data.data.extractionResult;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
};

// src/views/ChatView.ts
init_SystemPromptService();

// src/modals/LoadChatModal.ts
var import_obsidian24 = __toModule(require("obsidian"));
init_SystemPromptService();
var LoadChatModal = class extends import_obsidian24.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.chatItems = [];
    this.selectedChatId = null;
    this.selectedCardIndex = 0;
    this.chatCards = [];
    this.currentSearchResults = [];
    this.isKeyboardNavActive = false;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.searchService = new SearchService();
    this.chatStorage = new ChatStorageService(app, plugin.settings.chatsDirectory);
  }
  async getSearchFields(item) {
    var _a, _b;
    const allContent = item.messages.map((msg) => this.getMessageContent(msg)).join("\n");
    const promptLabel = await this.getPromptLabel(item);
    const searchTerms = ((_b = (_a = this.searchInput) == null ? void 0 : _a.value) == null ? void 0 : _b.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const searchFields = [
      {
        field: "content",
        text: allContent,
        weight: 200
      },
      ...allContent.split(/[\s\-:\.]+/).map((part) => ({
        field: "content",
        text: part,
        weight: 100
      })),
      {
        field: "model",
        text: await this.getModelName(item.selectedModelId),
        weight: 180
      },
      {
        field: "prompt",
        text: promptLabel,
        weight: 180
      },
      ...promptLabel.split(/[\s\-_]+/).map((part) => ({
        field: "prompt",
        text: part,
        weight: 150
      }))
    ];
    if (searchTerms.length > 1) {
      const allContentLower = allContent.toLowerCase();
      for (let i = 0; i < searchTerms.length - 1; i++) {
        const term1 = searchTerms[i];
        const term2 = searchTerms[i + 1];
        let pos = 0;
        while ((pos = allContentLower.indexOf(term1, pos)) !== -1) {
          const nextPos = allContentLower.indexOf(term2, pos);
          if (nextPos !== -1 && nextPos - (pos + term1.length) < 30) {
            searchFields.push({
              field: "content",
              text: allContent.slice(pos, nextPos + term2.length),
              weight: 300
            });
          }
          pos++;
        }
      }
    }
    return searchFields;
  }
  getMessageContent(message) {
    if (typeof message.content === "string") {
      return message.content;
    }
    return "Image message";
  }
  findAllIndices(text, searchTerm) {
    const indices = [];
    let currentIndex = 0;
    text = text.toLowerCase();
    searchTerm = searchTerm.toLowerCase();
    while (currentIndex < text.length) {
      const index = text.indexOf(searchTerm, currentIndex);
      if (index === -1)
        break;
      indices.push(index);
      currentIndex = index + 1;
    }
    return indices;
  }
  getMessagePreview(messages, matches = []) {
    var _a, _b;
    if (!matches || matches.length === 0) {
      const lastMessage = messages[messages.length - 1];
      if (!lastMessage)
        return { text: "", previewStart: 0 };
      return { text: this.getMessageContent(lastMessage), previewStart: 0 };
    }
    const contentMatches = matches.filter((m) => m.field === "content");
    if (contentMatches.length === 0) {
      const lastMessage = messages[messages.length - 1];
      if (!lastMessage)
        return { text: "", previewStart: 0 };
      return { text: this.getMessageContent(lastMessage), previewStart: 0 };
    }
    const allContent = messages.map((msg) => this.getMessageContent(msg)).join("\n");
    const searchTerms = ((_b = (_a = this.searchInput) == null ? void 0 : _a.value) == null ? void 0 : _b.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const termIndices = [];
    const allContentLower = allContent.toLowerCase();
    searchTerms.forEach((term) => {
      const indices = this.findAllIndices(allContentLower, term);
      termIndices.push(...indices);
    });
    if (termIndices.length === 0) {
      const firstMatch = contentMatches[0];
      termIndices.push(firstMatch.indices[0]);
    }
    termIndices.sort((a, b) => a - b);
    const CONTEXT_SIZE = 75;
    let bestStart = termIndices[0];
    let bestEnd = termIndices[0];
    let bestSpan = Infinity;
    for (let i = 0; i < termIndices.length; i++) {
      const start = termIndices[i];
      const searchWindow = new Set();
      for (let j = i; j < termIndices.length; j++) {
        const end = termIndices[j];
        const span = end - start;
        const termAtPosition = searchTerms.find((term) => allContentLower.slice(termIndices[j]).startsWith(term));
        if (termAtPosition) {
          searchWindow.add(termAtPosition);
        }
        if (searchWindow.size === searchTerms.length && span < bestSpan) {
          bestStart = start;
          bestEnd = end;
          bestSpan = span;
        }
      }
    }
    const contextStart = Math.max(0, bestStart - CONTEXT_SIZE);
    const contextEnd = Math.min(allContent.length, bestEnd + CONTEXT_SIZE);
    let previewStart = contextStart;
    while (previewStart > 0 && !/[\s.!?\n]/.test(allContent[previewStart - 1])) {
      previewStart--;
    }
    let previewEnd = contextEnd;
    while (previewEnd < allContent.length && !/[\s.!?\n]/.test(allContent[previewEnd])) {
      previewEnd++;
    }
    let preview = allContent.slice(previewStart, previewEnd).trim();
    if (previewStart > 0)
      preview = "..." + preview;
    if (previewEnd < allContent.length)
      preview = preview + "...";
    return { text: preview, previewStart };
  }
  formatDate(timestamp) {
    return new Date(timestamp).toLocaleString();
  }
  openNewChat() {
    this.close();
    const leaf = this.app.workspace.getLeaf(true);
    leaf.setViewState({
      type: CHAT_VIEW_TYPE,
      state: {}
    });
    this.app.workspace.setActiveLeaf(leaf);
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-chat-modal");
    const loadingContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-loading"
    });
    loadingContainer.createSpan({ text: "Loading chats..." });
    try {
      const chats = await this.chatStorage.loadChats();
      this.chatItems = chats.sort((a, b) => b.lastModified - a.lastModified);
    } catch (error) {
      console.error("Failed to load chats:", error);
      this.chatItems = [];
    }
    contentEl.empty();
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search chats..."
    });
    this.searchInput.focus();
    this.chatGrid = contentEl.createDiv({ cls: "systemsculpt-chat-grid" });
    const initialResults = await Promise.all(this.chatItems.map(async (item) => ({
      item,
      matches: [],
      score: 0
    })));
    await this.renderChats(initialResults);
    this.searchInput.addEventListener("input", async () => {
      const query = this.searchInput.value;
      const results = await Promise.all(this.chatItems.map(async (item) => {
        const searchFields = await this.getSearchFields(item);
        const searchResult = this.searchService.search([item], query, () => searchFields)[0];
        return {
          item,
          matches: (searchResult == null ? void 0 : searchResult.matches) || [],
          score: (searchResult == null ? void 0 : searchResult.score) || 0
        };
      }));
      if (!query) {
        this.currentSearchResults = results.sort((a, b) => b.item.lastModified - a.item.lastModified);
        this.selectedCardIndex = 0;
        await this.renderChats(this.currentSearchResults);
        return;
      }
      const processedResults = results.filter((result) => result.matches.length > 0 && result.score > 0).map((result) => {
        let finalScore = result.score;
        const content = result.item.messages.map((msg) => this.getMessageContent(msg)).join("\n").toLowerCase();
        if (content.includes(query.toLowerCase())) {
          finalScore *= 2;
        }
        const wordBoundaryMatch = new RegExp(`\\b${query}`, "i").test(content);
        if (wordBoundaryMatch) {
          finalScore *= 1.5;
        }
        return {
          ...result,
          score: finalScore
        };
      });
      processedResults.sort((a, b) => {
        if (b.score !== a.score) {
          return b.score - a.score;
        }
        return b.item.lastModified - a.item.lastModified;
      });
      this.currentSearchResults = processedResults;
      this.selectedCardIndex = 0;
      await this.renderChats(processedResults);
    });
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (!this.isKeyboardNavActive) {
          this.isKeyboardNavActive = true;
          this.selectedCardIndex = 0;
          this.updateSelectedCard();
        } else {
          if (e.shiftKey) {
            this.selectedCardIndex = Math.max(0, this.selectedCardIndex - 1);
          } else {
            this.selectedCardIndex = Math.min(this.chatCards.length - 1, this.selectedCardIndex + 1);
          }
          this.updateSelectedCard();
        }
      } else if (e.key === "Enter" && this.chatCards.length > 0 && this.isKeyboardNavActive) {
        e.preventDefault();
        const selectedCard = this.chatCards[this.selectedCardIndex];
        if (selectedCard == null ? void 0 : selectedCard.dataset.chatId) {
          this.onSelect(selectedCard.dataset.chatId);
          this.close();
        }
      }
    });
    contentEl.addEventListener("click", () => {
      if (this.isKeyboardNavActive) {
        this.isKeyboardNavActive = false;
        this.updateSelectedCard();
      }
    });
    const buttonContainer = contentEl.createDiv({
      cls: "systemsculpt-button-container"
    });
    const newChatButton = buttonContainer.createEl("button", {
      cls: "systemsculpt-button",
      text: "Open New Chat Instead"
    });
    newChatButton.addEventListener("click", () => this.openNewChat());
  }
  async renderChats(searchResults) {
    this.chatGrid.empty();
    this.chatCards = [];
    this.selectedCardIndex = 0;
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      const emptyState = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-empty"
      });
      emptyState.setText(this.chatItems.length === 0 ? "No chat history found." : "No chats found matching your search.");
      return;
    }
    const sectionsContainer = this.chatGrid.createDiv({
      cls: "systemsculpt-chat-sections-container"
    });
    for (const result of searchResults) {
      await this.renderChatCard(result, sectionsContainer);
    }
  }
  async getModelName(modelId) {
    try {
      const models = await this.plugin.modelService.getModels();
      if (!models)
        return modelId;
      const model = models.find((m) => m.id === modelId || m.identifier && `${m.identifier.providerId}/${m.identifier.modelId}` === modelId);
      if (model == null ? void 0 : model.identifier) {
        return model.identifier.displayName || model.identifier.modelId;
      }
      return (model == null ? void 0 : model.name) || modelId;
    } catch (error) {
      console.error("Failed to get model name:", error);
      return modelId;
    }
  }
  async getPromptLabel(item) {
    var _a;
    if (item.customPromptFilePath) {
      return ((_a = item.customPromptFilePath.split("/").pop()) == null ? void 0 : _a.replace(/\.md$/, "")) || "Custom Prompt";
    }
    if (item.systemPromptType) {
      try {
        const systemPromptService = new SystemPromptService(this.app);
        const preset = await systemPromptService.getSystemPromptById(item.systemPromptType);
        if (preset) {
          return preset.label;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
      }
    }
    return "Default";
  }
  renderPreview(preview, item, matches = []) {
    var _a;
    const { text, previewStart } = this.getMessagePreview(item.messages, matches);
    const contentMatches = matches.filter((m) => m.field === "content");
    if (contentMatches.length > 0) {
      const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
      preview.appendChild(this.searchService.highlightText(text, contentMatches, searchQuery));
    } else {
      preview.createSpan({ text });
    }
  }
  async renderChatCard({ item, matches = [] }, container) {
    var _a;
    const isSelected = this.isKeyboardNavActive && this.chatCards.length === this.selectedCardIndex;
    const card = container.createDiv({
      cls: `systemsculpt-chat-card ${item.id === this.selectedChatId ? "selected" : ""} ${isSelected ? "systemsculpt-keyboard-selected" : ""}`
    });
    card.dataset.chatId = item.id;
    this.chatCards.push(card);
    const header = card.createDiv({ cls: "systemsculpt-chat-card-header" });
    const leftContainer = header.createDiv({
      cls: "systemsculpt-chat-header-left"
    });
    const modelBadge = leftContainer.createDiv({
      cls: "systemsculpt-chat-badge"
    });
    (0, import_obsidian24.setIcon)(modelBadge, "bot");
    const modelName = await this.getModelName(item.selectedModelId);
    const modelMatches = matches.filter((m) => m.field === "model");
    if (modelMatches.length > 0) {
      modelBadge.appendChild(this.highlightText(modelName, modelMatches));
    } else {
      modelBadge.appendText(modelName);
    }
    const promptBadge = leftContainer.createDiv({
      cls: "systemsculpt-chat-badge"
    });
    (0, import_obsidian24.setIcon)(promptBadge, "command");
    const promptLabel = await this.getPromptLabel(item);
    const promptMatches = matches.filter((m) => m.field === "prompt");
    if (promptMatches.length > 0) {
      promptBadge.appendChild(this.highlightText(promptLabel, promptMatches));
    } else {
      promptBadge.appendText(promptLabel);
    }
    if (item.context_files && item.context_files.length > 0) {
      const docBadge = leftContainer.createDiv({
        cls: "systemsculpt-chat-badge"
      });
      (0, import_obsidian24.setIcon)(docBadge, "file-text");
      docBadge.appendText(`${item.context_files.length} Document${item.context_files.length > 1 ? "s" : ""}`);
    }
    const preview = card.createDiv({
      cls: "systemsculpt-chat-preview"
    });
    if (((_a = this.searchInput) == null ? void 0 : _a.value) && matches.length > 0) {
      const { text } = this.getMessagePreview(item.messages, matches);
      const searchTerms = this.searchInput.value.toLowerCase().split(/\s+/);
      const textLower = text.toLowerCase();
      const termPositions = [];
      searchTerms.forEach((term) => {
        let index = textLower.indexOf(term);
        if (index >= 0) {
          termPositions.push({ term, index });
        }
      });
      termPositions.sort((a, b) => a.index - b.index);
      if (termPositions.length > 0) {
        const fragment = document.createDocumentFragment();
        let lastIndex = 0;
        termPositions.forEach(({ term, index }) => {
          if (index > lastIndex) {
            fragment.appendChild(document.createTextNode(text.slice(lastIndex, index)));
          }
          const highlight = document.createElement("span");
          highlight.className = "systemsculpt-search-highlight";
          highlight.textContent = text.slice(index, index + term.length);
          fragment.appendChild(highlight);
          lastIndex = index + term.length;
        });
        if (lastIndex < text.length) {
          fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
        }
        preview.appendChild(fragment);
      } else {
        preview.appendText(text);
      }
    } else {
      const lastMessage = item.messages[item.messages.length - 1];
      if (lastMessage) {
        preview.appendText(this.getMessageContent(lastMessage));
      }
    }
    const meta = card.createDiv({ cls: "systemsculpt-chat-meta" });
    const dateEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian24.setIcon)(dateEl, "calendar");
    dateEl.createSpan({
      text: this.formatDate(item.lastModified)
    });
    const messagesEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian24.setIcon)(messagesEl, "message-square");
    messagesEl.createSpan({
      text: `${item.messages.length} message${item.messages.length !== 1 ? "s" : ""}`
    });
    const titleEl = meta.createDiv({
      cls: "systemsculpt-chat-info"
    });
    (0, import_obsidian24.setIcon)(titleEl, "file");
    titleEl.createSpan({
      text: item.title
    });
    card.addEventListener("click", () => {
      this.onSelect(item.id);
      this.close();
    });
  }
  highlightText(text, matches = []) {
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const allIndices = new Set();
    matches.forEach((match) => {
      match.indices.forEach((idx) => allIndices.add(idx));
    });
    const sortedIndices = Array.from(allIndices).sort((a, b) => a - b);
    const ranges = [];
    let rangeStart = sortedIndices[0];
    let prev = sortedIndices[0];
    for (let i = 1; i <= sortedIndices.length; i++) {
      const curr = sortedIndices[i];
      if (curr !== prev + 1) {
        ranges.push([rangeStart, prev + 1]);
        rangeStart = curr;
      }
      prev = curr;
    }
    let lastIndex = 0;
    ranges.forEach(([start, end]) => {
      if (start > lastIndex) {
        fragment.appendText(text.slice(lastIndex, start));
      }
      const highlightedText = text.slice(start, end);
      const span = fragment.createSpan({
        cls: "systemsculpt-chat-highlight",
        text: highlightedText
      });
      lastIndex = end;
    });
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  updateSelectedCard() {
    this.chatCards.forEach((card, index) => {
      if (index === this.selectedCardIndex && this.isKeyboardNavActive) {
        card.classList.add("systemsculpt-keyboard-selected");
        card.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        card.classList.remove("systemsculpt-keyboard-selected");
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/ChatView.ts
var CHAT_VIEW_TYPE = "systemsculpt-chat-view";
var ChatView = class extends import_obsidian25.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.messages = [];
    this.currentModelName = "";
    this.isGenerating = false;
    this.refreshInterval = null;
    this.lastRefreshTime = 0;
    this.awaitingStateRestore = false;
    this.chatTitle = "Untitled Chat";
    this.plugin = plugin;
    this.aiService = SystemSculptService.getInstance(plugin.settings, this.app);
    this.chatStorage = new ChatStorageService(this.app, plugin.settings.chatsDirectory);
    this.selectedModelId = plugin.settings.selectedModelId;
    this.messages = [];
    this.lastRefreshTime = 0;
    this.isGenerating = false;
    this.awaitingStateRestore = true;
    this.messageRenderer = new MessageRenderer(this.app);
    this.systemPromptType = this.plugin.settings.systemPromptType || "general-use";
    if (this.systemPromptType === "custom" && this.plugin.settings.systemPromptPath) {
      this.systemPromptPath = this.plugin.settings.systemPromptPath;
    } else {
      this.systemPromptPath = void 0;
    }
    this.layoutChangeHandler = this.onLayoutChange.bind(this);
  }
  getViewType() {
    return CHAT_VIEW_TYPE;
  }
  getDisplayText() {
    const allChats = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (allChats.length <= 1) {
      return this.chatTitle;
    }
    const chatNumber = allChats.indexOf(this.leaf) + 1;
    return `${this.chatTitle} ${chatNumber}`;
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    container.addClass("systemsculpt-chat-container");
    this.setupDragAndDrop(container);
    const headerContainer = container.createEl("div", {
      cls: "systemsculpt-chat-header"
    });
    const topRow = headerContainer.createEl("div", {
      cls: "systemsculpt-chat-header-top"
    });
    this.modelIndicator = topRow.createEl("button", {
      cls: "systemsculpt-model-indicator",
      text: `Current Model: ${this.selectedModelId}`
    });
    this.updateModelIndicator();
    this.actionsDrawer = new DrawerComponent({
      container: topRow,
      title: "Actions"
    });
    const actionsContent = this.actionsDrawer.getContent();
    const openHistoryAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Open Chat History File"
    });
    openHistoryAction.addEventListener("click", () => {
      const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian25.TFile) {
        this.app.workspace.getLeaf().openFile(file);
      }
    });
    const loadDifferentChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Load A Different Chat"
    });
    loadDifferentChatAction.addEventListener("click", () => {
      const leaf = this.app.workspace.getLeaf(true);
      new LoadChatModal(this.app, async (chatId) => {
        const view = await leaf.setViewState({
          type: CHAT_VIEW_TYPE,
          state: { chatId }
        });
        this.app.workspace.setActiveLeaf(leaf);
      }, this.plugin).open();
    });
    const copyChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Copy Chat to Clipboard"
    });
    copyChatAction.addEventListener("click", async () => {
      await this.copyToClipboard();
    });
    const deleteChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item systemsculpt-drawer-item-danger",
      text: "Delete This Chat"
    });
    deleteChatAction.addEventListener("click", async () => {
      const deleteConfirmed = await showPopup(this.app, "Are you sure you want to delete this chat?", {
        primaryButton: "Delete",
        secondaryButton: "Cancel"
      });
      if (deleteConfirmed == null ? void 0 : deleteConfirmed.confirmed) {
        const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
        const file = this.app.vault.getAbstractFileByPath(filePath);
        if (file instanceof import_obsidian25.TFile) {
          await this.app.vault.delete(file);
        }
        this.leaf.detach();
      }
    });
    const bottomRow = headerContainer.createEl("div", {
      cls: "systemsculpt-chat-header-bottom"
    });
    this.contextManager = new FileContextManager({
      app: this.app,
      container: bottomRow,
      onContextChange: async () => {
        await this.saveChat();
        await this.contextManager.checkSyncStatus();
      },
      sculptService: this.aiService,
      plugin: this.plugin
    });
    this.chatContainer = container.createEl("div", {
      cls: "systemsculpt-messages-container"
    });
    this.scrollManager = new ScrollManagerService({
      container: this.chatContainer
    });
    this.inputHandler = new InputHandler({
      app: this.app,
      container,
      aiService: this.aiService,
      getMessages: () => [...this.messages],
      getSelectedModelId: () => this.selectedModelId,
      getContextFiles: () => this.contextManager.getContextFiles(),
      getSystemPrompt: () => ({
        type: this.systemPromptType,
        path: this.systemPromptPath
      }),
      chatContainer: this.chatContainer,
      scrollManager: this.scrollManager,
      messageRenderer: this.messageRenderer,
      onMessageSubmit: async (message) => {
        this.messages.push(message);
        await this.saveChat();
        await this.addMessage(message.role, message.content, message.message_id);
      },
      onAssistantResponse: async (message) => {
        this.messages.push(message);
        await this.saveChat();
      },
      onContextFileAdd: async (wikilink) => {
        const files = this.contextManager.getContextFiles();
        files.add(wikilink);
        this.contextManager.setContextFiles(Array.from(files));
        await this.saveChat();
      },
      onError: (error) => this.handleError(error),
      onAddContextFile: () => {
        const contextButton = this.contextManager.getContainer().querySelector(".systemsculpt-context-add-button");
        if (contextButton instanceof HTMLElement) {
          contextButton.click();
        }
      },
      onEditSystemPrompt: () => {
        this.handleSystemPromptEdit();
      },
      plugin: this.plugin,
      chatView: this
    });
    this.inputHandler.onModelChange();
    this.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf === this.leaf) {
        this.checkForUpdates();
        this.inputHandler.focus();
      }
    });
    this.inputHandler.focus();
    await this.checkForUpdates();
    if (!this.awaitingStateRestore && this.messages.length === 0) {
      if (!this.chatId) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const hour = String(now.getHours()).padStart(2, "0");
        const minute = String(now.getMinutes()).padStart(2, "0");
        const second = String(now.getSeconds()).padStart(2, "0");
        this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
        this.chatTitle = `Chat ${now.toLocaleString()}`;
        await this.saveChat();
      }
    }
    setTimeout(async () => {
      if (!this.plugin.settings.selectedModelId) {
        const result = await showPopup(this.app, "You don't have a default model selected yet. Would you like to choose one now? This will be used as the default for all new chats.", {
          title: "Select Default Model",
          icon: "bot",
          primaryButton: "Choose Model",
          secondaryButton: "Maybe Later"
        });
        if (result == null ? void 0 : result.confirmed) {
          try {
            const models = await this.plugin.modelService.getModels();
            const modal = new ModelSelectionModal(this.app, "", async (modelId) => {
              this.plugin.settings.selectedModelId = modelId;
              await this.plugin.saveSettings();
              this.selectedModelId = modelId;
              await this.updateModelIndicator();
            }, this.plugin);
            modal.open();
          } catch (error) {
            console.error("Error loading models:", error);
            showPopup(this.app, "Failed to load available models");
          }
        }
      }
    }, 100);
  }
  async loadMessages() {
    if (!this.chatContainer)
      return;
    const scrollTop = this.chatContainer.scrollTop;
    const scrollHeight = this.chatContainer.scrollHeight;
    const clientHeight = this.chatContainer.clientHeight;
    const wasAtBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
    this.chatContainer.empty();
    for (const message of this.messages) {
      await this.addMessage(message.role, message.content, message.message_id);
    }
    if (wasAtBottom) {
      this.scrollManager.scrollToBottom();
    } else {
      this.chatContainer.scrollTop = scrollTop;
    }
    if (this.inputHandler) {
      await this.inputHandler.updateTokenCount();
    }
  }
  async updateModelIndicator() {
    if (this.modelIndicator) {
      const newModelIndicator = this.modelIndicator.cloneNode(true);
      this.modelIndicator.replaceWith(newModelIndicator);
      this.modelIndicator = newModelIndicator;
      this.modelIndicator.addEventListener("click", async () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId || "", async (modelId) => {
          await this.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected successfully", "info");
        }, this.plugin);
        modal.open();
      });
      if (!this.selectedModelId || this.selectedModelId.trim() === "") {
        this.modelIndicator.empty();
        this.modelIndicator.createSpan({ text: "No model selected" });
        this.modelIndicator.addClass("systemsculpt-no-model");
      } else {
        try {
          const models = await this.plugin.modelService.getModels();
          const currentModel = models.find((model) => model.id === this.selectedModelId);
          let providerPrefix = "";
          if (currentModel) {
            if (currentModel.provider === "systemsculpt") {
              providerPrefix = "[SYSTEMSCULPT] ";
            } else {
              providerPrefix = `[${currentModel.provider.toUpperCase()}] `;
            }
          }
          this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
          this.modelIndicator.empty();
          this.modelIndicator.removeClass("systemsculpt-no-model");
          this.modelIndicator.createSpan({ text: "Current Model: " });
          this.modelIndicator.createSpan({
            text: providerPrefix + this.currentModelName
          });
        } catch (error) {
          this.currentModelName = this.selectedModelId;
          this.modelIndicator.empty();
          this.modelIndicator.removeClass("systemsculpt-no-model");
          this.modelIndicator.createSpan({ text: "Current Model: " });
          this.modelIndicator.createSpan({ text: this.currentModelName });
        }
      }
    }
  }
  async checkForUpdates() {
    if (this.isGenerating)
      return;
    try {
      const savedChats = await this.chatStorage.loadChats();
      const currentChat = savedChats.find((c) => c.id === this.chatId);
      if (!currentChat)
        return;
      const hasChanges = currentChat.messages.length !== this.messages.length || currentChat.selectedModelId !== this.selectedModelId || JSON.stringify(Array.from(this.contextManager.getContextFiles())) !== JSON.stringify(currentChat.context_files) || JSON.stringify(currentChat.messages) !== JSON.stringify(this.messages);
      if (hasChanges) {
        this.messages = currentChat.messages;
        this.selectedModelId = currentChat.selectedModelId;
        if (currentChat.context_files) {
          await this.contextManager.setContextFiles(currentChat.context_files);
        }
        await this.loadMessages();
        this.updateModelIndicator();
      } else {
        await this.contextManager.checkSyncStatus();
      }
    } catch (error) {
      console.error("Failed to check for updates:", error);
    }
  }
  async saveChat() {
    if (!this.chatId) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      const hour = String(now.getHours()).padStart(2, "0");
      const minute = String(now.getMinutes()).padStart(2, "0");
      const second = String(now.getSeconds()).padStart(2, "0");
      this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
      this.chatTitle = this.chatTitle || this.chatId;
    }
    try {
      await this.chatStorage.saveChat(this.chatId, this.messages, this.selectedModelId, this.contextManager.getContextFiles(), void 0, this.systemPromptType, this.systemPromptPath, this.chatTitle, this.tokenLimit, this.tokenLimitPercentage);
    } catch (error) {
      this.handleError("Failed to save chat");
    }
  }
  async handleError(error) {
    console.error("Chat error:", {
      error,
      message: typeof error === "string" ? error : error.message,
      code: error instanceof SystemSculptError ? error.code : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
    let errorMessage = typeof error === "string" ? error : error.message;
    if (error instanceof SystemSculptError && (error.code === "MODEL_UNAVAILABLE" || error.code === "MODEL_REQUEST_ERROR" || error.code === "QUOTA_EXCEEDED")) {
      showEnhancedNotice(errorMessage, "error", error);
      const modal = new ModelSelectionModal(this.app, this.selectedModelId, async (modelId) => {
        this.selectedModelId = modelId;
        this.updateModelIndicator();
        showEnhancedNotice("Model changed. You can now retry your message.", "info");
        this.focusInput();
      }, this.plugin);
      modal.open();
      try {
        const models = await this.plugin.modelService.getModels();
        modal.setModels(models);
      } catch (err) {
        console.error("Failed to fetch models:", err);
        showEnhancedNotice("Failed to fetch available models", "error", err);
      }
      const lastMessage = this.chatContainer.querySelector(".systemsculpt-message:last-child");
      if (lastMessage) {
        lastMessage.remove();
      }
      const lastUserMessage = [...this.messages].reverse().find((msg) => msg.role === "user");
      if (lastUserMessage) {
        const index = this.messages.findIndex((msg) => msg.message_id === lastUserMessage.message_id);
        if (index !== -1) {
          this.messages.splice(index);
          const allMessages = this.chatContainer.querySelectorAll(".systemsculpt-message");
          for (let i = index; i < allMessages.length; i++) {
            allMessages[i].remove();
          }
          this.inputHandler.setValue(typeof lastUserMessage.content === "string" ? lastUserMessage.content : JSON.stringify(lastUserMessage.content));
          this.inputHandler.focus();
        }
      }
    } else {
      showEnhancedNotice(errorMessage, "error", error);
    }
  }
  async onLayoutChange() {
    var _a;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian25.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.lastRefreshTime = 0;
      await this.checkForUpdates();
      this.inputHandler.focus();
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async handleSystemPromptEdit() {
    let currentContent = "";
    if (this.systemPromptType === "custom") {
      const file = this.app.vault.getAbstractFileByPath((this.systemPromptPath || "") + ".md");
      if (file instanceof import_obsidian25.TFile) {
        currentContent = await this.app.vault.read(file);
      } else {
        currentContent = this.plugin.settings.systemPrompt;
      }
    } else {
      const systemPromptService = new SystemPromptService(this.app);
      try {
        const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
        if (preset) {
          currentContent = preset.systemPrompt;
        } else {
          currentContent = this.plugin.settings.systemPrompt;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
        currentContent = this.plugin.settings.systemPrompt;
      }
    }
    let modelContextLength;
    try {
      const models = await this.plugin.modelService.getModels();
      const currentModel = models.find((model) => model.id === this.selectedModelId);
      if (currentModel) {
        modelContextLength = currentModel.context_length;
      }
    } catch (error) {
      console.error("Failed to get model context length:", error);
    }
    const result = await showSystemPromptModal(this.app, currentContent, {
      mode: "chat-specific",
      customPromptFilePath: this.systemPromptPath || this.plugin.settings.systemPromptPath,
      systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
      modelContextLength,
      tokenLimitPercentage: this.tokenLimitPercentage
    });
    if (result) {
      this.systemPromptType = result.type;
      if (result.type === "custom" && result.path) {
        this.systemPromptPath = result.path;
      } else {
        this.systemPromptPath = void 0;
      }
      this.tokenLimitPercentage = result.tokenLimitPercentage;
      this.tokenLimit = result.tokenLimit;
      await this.inputHandler.updateTokenCount();
      await this.saveChat();
    }
  }
  async addMessage(role, content, existingMessageId) {
    const messageId = existingMessageId || this.generateMessageId();
    const { messageEl, contentEl } = await this.messageRenderer.renderMessage({
      app: this.app,
      messageId,
      role,
      content
    });
    const contentStr = typeof content === "string" ? content : JSON.stringify(content);
    messageEl.dataset.content = contentStr;
    this.messageRenderer.addMessageButtonToolbar(messageEl, typeof content === "string" ? content : JSON.stringify(content), role, messageId);
    messageEl.addEventListener("resubmit", async (e) => {
      const { messageId: messageId2, content: content2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index);
        await this.saveChat();
        this.chatContainer.empty();
        for (const msg of this.messages) {
          await this.addMessage(msg.role, msg.content, msg.message_id);
        }
        this.inputHandler.setValue(content2);
        this.inputHandler.focus();
      }
    });
    messageEl.addEventListener("edit", async (e) => {
      const { messageId: messageId2, oldContent, newContent } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages[index].content = newContent;
        await this.saveChat();
        const { contentEl: newContentEl } = await this.messageRenderer.renderMessage({
          app: this.app,
          messageId: messageId2,
          role: this.messages[index].role,
          content: this.messages[index].content
        });
        const oldContentEl = messageEl.querySelector(".systemsculpt-message-content");
        if (oldContentEl && newContentEl) {
          oldContentEl.replaceWith(newContentEl);
          this.messageRenderer.setupImageHandlers(newContentEl);
        }
        const updatedStr = typeof this.messages[index].content === "string" ? this.messages[index].content : JSON.stringify(this.messages[index].content);
        messageEl.dataset.content = updatedStr;
      }
    });
    messageEl.addEventListener("delete", async (e) => {
      const { messageId: messageId2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index, 1);
        await this.saveChat();
        messageEl.remove();
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
      }
    });
    this.chatContainer.appendChild(messageEl);
    this.scrollManager.updateContentHeight();
    this.scrollManager.scrollToBottom();
  }
  getInputValue() {
    return this.inputHandler.getValue();
  }
  onunload() {
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
      this.refreshInterval = null;
    }
    this.scrollManager.cleanup();
    this.app.workspace.off("active-leaf-change", this.checkForUpdates.bind(this));
    this.actionsDrawer.unload();
    this.contextManager.unload();
    this.inputHandler.unload();
  }
  getState() {
    return {
      chatId: this.chatId,
      selectedModelId: this.selectedModelId
    };
  }
  async setState(state) {
    var _a;
    if (state.chatId) {
      await this.loadChatById(state.chatId);
    }
    this.awaitingStateRestore = false;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian25.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.inputHandler.focus();
    }
  }
  async loadChatById(chatId) {
    try {
      const chatData = await this.chatStorage.loadChat(chatId);
      if (!chatData) {
        this.handleError("Failed to load chat");
        return;
      }
      this.chatContainer.empty();
      this.messages = chatData.messages;
      this.chatId = chatData.id;
      this.selectedModelId = chatData.selectedModelId;
      this.chatTitle = chatData.title || "Untitled Chat";
      const metadata = await this.chatStorage.getMetadata(chatId);
      if (metadata == null ? void 0 : metadata.systemMessage) {
        this.systemPromptType = metadata.systemMessage.type;
        this.tokenLimit = metadata.systemMessage.tokenLimit;
        this.tokenLimitPercentage = metadata.systemMessage.tokenLimitPercentage;
        if (metadata.systemMessage.path) {
          this.systemPromptPath = metadata.systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
        }
      }
      try {
        const models = await this.plugin.modelService.getModels();
        const currentModel = models.find((model) => model.id === this.selectedModelId);
        this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
      } catch (error) {
        this.currentModelName = this.selectedModelId;
      }
      if (chatData.context_files) {
        await this.contextManager.setContextFiles(chatData.context_files);
      }
      for (const message of this.messages) {
        await this.addMessage(message.role, message.content, message.message_id);
      }
      this.updateModelIndicator();
      this.inputHandler.onModelChange();
      if (this.inputHandler) {
        await this.inputHandler.updateTokenCount();
      }
    } catch (error) {
      console.error("[SystemSculpt] Error in loadChatById:", error);
      this.handleError("Failed to load chat");
    }
  }
  async addFileToContext(file) {
    await this.contextManager.addFileToContext(file);
  }
  async copyToClipboard() {
    try {
      const content = await this.getMarkdown();
      await navigator.clipboard.writeText(content);
      showNotice("Chat copied to clipboard", { type: "success" });
    } catch (error) {
      showNotice("Failed to copy chat to clipboard", { type: "error" });
    }
  }
  getTokenLimit() {
    return this.tokenLimit;
  }
  focusInput() {
    this.inputHandler.focus();
  }
  setupDragAndDrop(container) {
    const overlay = container.createEl("div", {
      cls: "systemsculpt-drag-overlay"
    });
    const message = overlay.createEl("div", {
      cls: "systemsculpt-drag-message",
      text: "Drop files to add to context"
    });
    const MAX_FILES = 100;
    const parseObsidianUri = (uri) => {
      try {
        if (!uri.startsWith("obsidian://open"))
          return null;
        const url = new URL(uri);
        return decodeURIComponent(url.searchParams.get("file") || "");
      } catch (e) {
        console.error("[DragDrop] Error parsing URI:", uri, e);
        return null;
      }
    };
    const getFilesFromFolder = (folder) => {
      const files = [];
      const processFolder = (currentFolder) => {
        for (const child of currentFolder.children) {
          if (child instanceof import_obsidian25.TFile) {
            files.push(child);
          } else if (child instanceof import_obsidian25.TFolder) {
            processFolder(child);
          }
        }
      };
      processFolder(folder);
      const result = files.slice(0, MAX_FILES);
      return result;
    };
    const getFileCount = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        return 0;
      }
      const remainingSlots = MAX_FILES - currentContextSize;
      let newFileCount = 0;
      let filesToProcess = [];
      if (dt.items && dt.items.length > 0) {
        for (const item of Array.from(dt.items)) {
          if (item.type === "text/plain") {
            const text = await new Promise((resolve) => {
              item.getAsString(resolve);
            });
            const lines = text.split("\n").filter((line) => line.trim());
            for (const line of lines) {
              let filePath = line;
              let abstractFile = null;
              if (line.startsWith("obsidian://")) {
                filePath = parseObsidianUri(line) || line;
              }
              abstractFile = this.app.vault.getAbstractFileByPath(filePath);
              if (abstractFile instanceof import_obsidian25.TFolder) {
                filesToProcess.push(abstractFile);
              } else if (abstractFile instanceof import_obsidian25.TFile) {
                filesToProcess.push(abstractFile);
              } else if (!filePath.includes(".")) {
                const mdPath = `${filePath}.md`;
                const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                if (mdFile instanceof import_obsidian25.TFile) {
                  filesToProcess.push(mdFile);
                }
              }
            }
          }
        }
      }
      for (const item of filesToProcess) {
        if (item instanceof import_obsidian25.TFolder) {
          const folderFiles = getFilesFromFolder(item).length;
          newFileCount += folderFiles;
        } else if (item instanceof import_obsidian25.TFile) {
          newFileCount++;
        }
      }
      if (newFileCount === 0 && dt.types.includes("text/uri-list")) {
        const uriData = await new Promise((resolve) => {
          dt.items[1].getAsString(resolve);
        });
        const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
        for (const uri of uris) {
          const filePath = parseObsidianUri(uri);
          if (!filePath)
            continue;
          const abstractFile = this.app.vault.getAbstractFileByPath(filePath);
          if (abstractFile instanceof import_obsidian25.TFolder) {
            const folderFiles = getFilesFromFolder(abstractFile).length;
            newFileCount += folderFiles;
          } else if (abstractFile instanceof import_obsidian25.TFile) {
            newFileCount++;
          }
        }
      }
      const finalCount = Math.min(newFileCount, remainingSlots);
      return finalCount;
    };
    const updateMessage = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        message.textContent = `Cannot add more files (max ${MAX_FILES} reached)`;
        return;
      }
      const fileCount = await getFileCount(dt);
      if (fileCount > 0) {
        message.textContent = `Add ${fileCount} file${fileCount > 1 ? "s" : ""} to context (${currentContextSize + fileCount}/${MAX_FILES} total)`;
      } else {
        message.textContent = `Drop files to add to context (${currentContextSize}/${MAX_FILES})`;
      }
    };
    let dragCounter = 0;
    container.addEventListener("dragenter", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter++;
      if (dragCounter === 1) {
        container.addClass("systemsculpt-drag-active");
        if (e.dataTransfer) {
          updateMessage(e.dataTransfer);
        }
      }
    });
    container.addEventListener("dragleave", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter--;
      if (dragCounter === 0) {
        container.removeClass("systemsculpt-drag-active");
      }
    });
    container.addEventListener("dragover", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (e.dataTransfer) {
        await updateMessage(e.dataTransfer);
      }
    });
    container.addEventListener("drop", async (e) => {
      var _a, _b, _c;
      e.preventDefault();
      e.stopPropagation();
      dragCounter = 0;
      container.removeClass("systemsculpt-drag-active");
      const dt = e.dataTransfer;
      if (!dt) {
        return;
      }
      const startingContextSize = this.contextManager.getContextFiles().size;
      if (startingContextSize >= MAX_FILES) {
        const { confirmed } = await showAlert(this.app, `Cannot add more files (max ${MAX_FILES} reached)`, {
          type: "info",
          icon: "alert-triangle"
        });
        return;
      }
      try {
        let filesToProcess = [];
        if (dt.items && dt.items.length > 0) {
          for (const item of Array.from(dt.items)) {
            if (item.type === "text/plain") {
              const text = await new Promise((resolve) => {
                item.getAsString(resolve);
              });
              const lines = text.split("\n").filter((line) => line.trim());
              for (const line of lines) {
                let filePath = line;
                let abstractFile = null;
                if (line.startsWith("obsidian://")) {
                  filePath = parseObsidianUri(line) || line;
                }
                abstractFile = this.app.vault.getAbstractFileByPath(filePath);
                if (abstractFile instanceof import_obsidian25.TFolder) {
                  filesToProcess.push(abstractFile);
                } else if (abstractFile instanceof import_obsidian25.TFile) {
                  const extension = abstractFile.extension.toLowerCase();
                  const requiresPro = [
                    "pdf",
                    "doc",
                    "docx",
                    "mp3",
                    "wav",
                    "m4a",
                    "ogg",
                    "webm"
                  ].includes(extension);
                  if (requiresPro && (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !this.plugin.settings.licenseValid)) {
                    await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                      title: "Pro Feature",
                      primaryButton: "Become a Patron",
                      secondaryButton: "Maybe Later"
                    }).then((result) => {
                      if (result == null ? void 0 : result.confirmed) {
                        window.open(PATREON_URL, "_blank");
                      }
                    });
                    return;
                  }
                  filesToProcess.push(abstractFile);
                } else if (!filePath.includes(".")) {
                  const mdPath = `${filePath}.md`;
                  const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                  if (mdFile instanceof import_obsidian25.TFile) {
                    filesToProcess.push(mdFile);
                  }
                }
              }
            }
          }
        }
        if (filesToProcess.length === 0 && dt.types.includes("text/uri-list")) {
          const uriData = await new Promise((resolve) => {
            dt.items[1].getAsString(resolve);
          });
          const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
          for (const uri of uris) {
            const filePath = parseObsidianUri(uri);
            if (!filePath)
              continue;
            let abstractFile = this.app.vault.getAbstractFileByPath(filePath);
            if (abstractFile instanceof import_obsidian25.TFile) {
              const extension = abstractFile.extension.toLowerCase();
              const requiresPro = [
                "pdf",
                "doc",
                "docx",
                "mp3",
                "wav",
                "m4a",
                "ogg",
                "webm"
              ].includes(extension);
              if (requiresPro && (!((_b = this.plugin.settings.licenseKey) == null ? void 0 : _b.trim()) || !this.plugin.settings.licenseValid)) {
                await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                  title: "Pro Feature",
                  primaryButton: "Become a Patron",
                  secondaryButton: "Maybe Later"
                }).then((result) => {
                  if (result == null ? void 0 : result.confirmed) {
                    window.open(PATREON_URL, "_blank");
                  }
                });
                return;
              }
            }
            if (abstractFile instanceof import_obsidian25.TFile || abstractFile instanceof import_obsidian25.TFolder) {
              filesToProcess.push(abstractFile);
            }
          }
        }
        let totalFilesAdded = 0;
        const remainingSlots = MAX_FILES - startingContextSize;
        for (const item of filesToProcess) {
          if (item instanceof import_obsidian25.TFolder) {
            const files = getFilesFromFolder(item);
            for (const file of files) {
              const currentContextSize = this.contextManager.getContextFiles().size;
              if (currentContextSize >= MAX_FILES) {
                const { confirmed } = await showAlert(this.app, `File limit reached (${MAX_FILES} total)`, {
                  type: "info",
                  icon: "alert-triangle"
                });
                return;
              }
              const extension = file.extension.toLowerCase();
              const requiresPro = [
                "pdf",
                "doc",
                "docx",
                "mp3",
                "wav",
                "m4a",
                "ogg",
                "webm"
              ].includes(extension);
              if (requiresPro && (!((_c = this.plugin.settings.licenseKey) == null ? void 0 : _c.trim()) || !this.plugin.settings.licenseValid)) {
                await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                  title: "Pro Feature",
                  primaryButton: "Become a Patron",
                  secondaryButton: "Maybe Later"
                }).then((result) => {
                  if (result == null ? void 0 : result.confirmed) {
                    window.open(PATREON_URL, "_blank");
                  }
                });
                return;
              }
              try {
                await this.contextManager.addFileToContext(file);
                totalFilesAdded++;
                const updatedContextSize = this.contextManager.getContextFiles().size;
                showNotice(`Added ${file.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
              } catch (error) {
                console.error("[DragDrop] Error adding file from folder:", {
                  file: file.path,
                  error
                });
              }
            }
          } else if (item instanceof import_obsidian25.TFile) {
            const currentContextSize = this.contextManager.getContextFiles().size;
            if (currentContextSize >= MAX_FILES) {
              const { confirmed } = await showAlert(this.app, `File limit reached (${MAX_FILES} total)`, {
                type: "info",
                icon: "alert-triangle"
              });
              return;
            }
            await this.contextManager.addFileToContext(item);
            totalFilesAdded++;
            const updatedContextSize = this.contextManager.getContextFiles().size;
            showNotice(`Added ${item.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
          }
        }
      } catch (error) {
        console.error("[DragDrop] Error processing drop:", error);
        await showAlert(this.app, "Failed to process dropped files", {
          type: "error"
        });
      }
    });
  }
  getSelectedModelId() {
    return this.selectedModelId;
  }
  async setSelectedModelId(modelId) {
    this.selectedModelId = modelId;
    await this.updateModelIndicator();
    await this.saveChat();
    const models = await this.plugin.modelService.getModels();
    const selectedModel = models.find((model) => model.id === modelId);
    if (this.tokenLimitPercentage && (selectedModel == null ? void 0 : selectedModel.context_length)) {
      this.tokenLimit = Math.floor(this.tokenLimitPercentage / 100 * selectedModel.context_length);
      await this.saveChat();
    }
    this.inputHandler.onModelChange();
    this.focusInput();
  }
  async getMarkdown() {
    let chatContent = "";
    if (this.systemPromptType) {
      let systemPromptContent = "";
      if (this.systemPromptType === "custom" && this.systemPromptPath) {
        const file = this.app.vault.getAbstractFileByPath(this.systemPromptPath + ".md");
        if (file instanceof import_obsidian25.TFile) {
          systemPromptContent = await this.app.vault.read(file);
        }
      } else {
        const systemPromptService = new SystemPromptService(this.app);
        try {
          const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
          if (preset) {
            systemPromptContent = preset.systemPrompt;
          }
        } catch (error) {
          console.error("Failed to fetch system prompt:", error);
        }
      }
      if (systemPromptContent) {
        chatContent += `System Prompt:
"""""
${systemPromptContent}
"""""

`;
      }
    }
    const contextFiles = this.contextManager.getContextFiles();
    if (contextFiles.size > 0) {
      chatContent += "Context Files:\n\n";
      for (const filePath of contextFiles) {
        if (!filePath.startsWith("doc:")) {
          const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1").replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian25.TFile && !resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
            const content = await this.app.vault.read(resolvedFile);
            chatContent += `[${cleanPath}]
"""""
${content}
"""""

`;
          }
        }
      }
    }
    chatContent += "Chat History Thus Far:\n\n";
    for (const message of this.messages) {
      const role = message.role === "assistant" ? "A" : "User";
      if (typeof message.content === "string") {
        chatContent += `${role}:
"""""
${message.content}
"""""

`;
      }
    }
    return chatContent;
  }
};

// src/services/RecorderService.ts
var RECORDING_FORMATS = [
  { mimeType: "audio/webm;codecs=opus", extension: "webm", sampleRate: 16e3 },
  { mimeType: "audio/webm", extension: "webm", sampleRate: 48e3 },
  { mimeType: "audio/ogg;codecs=opus", extension: "ogg", sampleRate: 48e3 },
  { mimeType: "audio/wav", extension: "wav", sampleRate: 48e3 }
];
var RecorderService = class {
  constructor(app, plugin, options = {}) {
    this.isRecording = false;
    this.onToggleCallbacks = new Set();
    this.mediaStream = null;
    this.mediaRecorder = null;
    this.chunks = [];
    this.selectedFormat = null;
    this.lastRecordedFilePath = null;
    this.audioContext = null;
    this.analyser = null;
    this.animationFrame = null;
    this.smoothingFactor = 0.4;
    this.visualizerCanvas = null;
    this.currentContext = null;
    this.recordingModal = null;
    this.dragCleanup = null;
    this.editorHandler = null;
    this.draw = () => {
      if (!this.isRecording || !this.analyser || !this.visualizerCanvas) {
        if (this.animationFrame) {
          cancelAnimationFrame(this.animationFrame);
          this.animationFrame = null;
        }
        return;
      }
      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
        this.animationFrame = null;
      }
      const bufferLength = this.analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      this.analyser.getByteFrequencyData(dataArray);
      const ctx = this.visualizerCanvas.getContext("2d");
      if (!ctx)
        return;
      ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      const rect = this.visualizerCanvas.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      const centerY = height / 2;
      const centerX = width / 2;
      const isMobile = width <= 400;
      const overlap = isMobile ? 3 : 5;
      const centerOverlapScale = isMobile ? 4 : 8;
      const amplitudeScale = isMobile ? 0.8 : 0.95;
      const edgeZoneScale = isMobile ? 0.15 : 0.2;
      const computedStyle = getComputedStyle(document.documentElement);
      let accentColor = computedStyle.getPropertyValue("--text-accent").trim();
      if (!accentColor) {
        accentColor = "#5871ef";
      }
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, accentColor);
      gradient.addColorStop(0.5, accentColor);
      gradient.addColorStop(1, accentColor);
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      const halfBufferLength = Math.floor(bufferLength / 2);
      const sliceWidth = width / 2 / halfBufferLength;
      const centerOverlap = sliceWidth * centerOverlapScale;
      const getEdgeTaper = (i, total) => {
        const edgeZone = total * edgeZoneScale;
        if (i < edgeZone) {
          return 0.3 + 0.7 * (i / edgeZone);
        } else if (i > total - edgeZone) {
          return 0.3 + 0.7 * ((total - i) / edgeZone);
        }
        return 1;
      };
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const value = dataArray[Math.abs(i)] / 255;
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        this.smoothedValues[index] = this.smoothedValues[index] * this.smoothingFactor + value * (1 - this.smoothingFactor);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      if (this.isRecording) {
        this.animationFrame = requestAnimationFrame(this.draw);
      }
    };
    this.app = app;
    this.plugin = plugin;
    this.smoothedValues = new Float32Array(128);
    this.updateContext(options);
    console.log("RecorderService initialized");
  }
  static getInstance(app, plugin, options = {}) {
    if (!RecorderService.instance) {
      console.log("Creating new RecorderService instance");
      RecorderService.instance = new RecorderService(app, plugin);
    }
    RecorderService.instance.updateContext(options);
    return RecorderService.instance;
  }
  getActiveViewInfo() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      return { isChat: false, viewIdentifier: "unknown" };
    }
    const viewState = activeLeaf.getViewState();
    const viewType = viewState.type;
    if (viewType === CHAT_VIEW_TYPE) {
      return { isChat: true, viewIdentifier: "chat" };
    }
    const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian26.MarkdownView);
    if (markdownView == null ? void 0 : markdownView.file) {
      return {
        isChat: false,
        viewIdentifier: `note-${markdownView.file.path}`
      };
    }
    return { isChat: false, viewIdentifier: "unknown" };
  }
  updateContext(options) {
    const { isChat } = this.getActiveViewInfo();
    this.currentContext = {
      isInChat: isChat,
      onTranscriptionComplete: options.onTranscriptionComplete
    };
  }
  insertTextIntoActiveView(text) {
    const { isChat } = this.getActiveViewInfo();
    if (isChat) {
      const chatView = this.app.workspace.getActiveViewOfType(ChatView);
      if (chatView) {
        const input = chatView.containerEl.querySelector(".systemsculpt-chat-input");
        if (input) {
          const cursorPos = input.selectionStart;
          const currentValue = input.value;
          if (cursorPos !== null) {
            const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
            input.value = newValue;
            input.selectionStart = input.selectionEnd = cursorPos + text.length;
          } else {
            input.value = currentValue + text;
            input.selectionStart = input.selectionEnd = input.value.length;
          }
          input.dispatchEvent(new Event("input"));
          input.focus();
          new import_obsidian26.Notice("\u2728 Transcription pasted into chat");
        } else {
          console.warn("Chat input element not found");
          new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no chat input)");
        }
      } else {
        console.warn("No active chat view found");
        new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no active chat)");
      }
    } else {
      const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian26.MarkdownView);
      if (!(markdownView == null ? void 0 : markdownView.editor)) {
        console.warn("No active markdown editor found");
        new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no active note)");
        return;
      }
      const editor = markdownView.editor;
      const cursor = editor.getCursor();
      const lineContent = editor.getLine(cursor.line);
      const textToInsert = text ? cursor.ch > 0 && lineContent.length > 0 ? "\n" + text : text : "";
      if (!textToInsert) {
        console.warn("No text to insert");
        return;
      }
      editor.replaceRange(textToInsert, cursor);
      const lines = textToInsert.split("\n");
      const lastLine = lines[lines.length - 1] || "";
      editor.setCursor({
        line: cursor.line + lines.length - 1,
        ch: lastLine.length
      });
      new import_obsidian26.Notice("\u2728 Transcription pasted into note");
    }
  }
  async transcribeLastRecording() {
    var _a, _b;
    if (!this.lastRecordedFilePath)
      return;
    try {
      const file = this.plugin.app.vault.getAbstractFileByPath(this.lastRecordedFilePath);
      if (!file || !(file instanceof import_obsidian26.TFile))
        return;
      const modal = new AudioTranscriptionModal(this.app, {
        file,
        isChat: (_b = (_a = this.currentContext) == null ? void 0 : _a.isInChat) != null ? _b : false,
        onTranscriptionComplete: (text) => {
          var _a2;
          if ((_a2 = this.currentContext) == null ? void 0 : _a2.onTranscriptionComplete) {
            this.currentContext.onTranscriptionComplete(text);
          } else {
            this.insertTextIntoActiveView(text);
          }
        },
        plugin: this.plugin
      });
      modal.open();
      try {
        await this.plugin.app.vault.delete(file);
      } catch (error) {
        console.warn("Failed to clean up recording file:", error);
      }
    } catch (error) {
      console.error("Auto-transcription failed:", error);
      new import_obsidian26.Notice("\u274C Failed to transcribe audio");
      throw error;
    }
  }
  createRecordingModal() {
    if (this.recordingModal) {
      if (this.dragCleanup) {
        this.dragCleanup();
        this.dragCleanup = null;
      }
      this.recordingModal.remove();
      this.recordingModal = null;
    }
    this.recordingModal = document.createElement("div");
    this.recordingModal.className = "systemsculpt-recorder-modal";
    const content = document.createElement("div");
    content.className = "systemsculpt-recorder-content";
    const liveIndicator = document.createElement("div");
    liveIndicator.className = "systemsculpt-recorder-live";
    liveIndicator.textContent = "\u25CF Live";
    content.appendChild(liveIndicator);
    const canvas = document.createElement("canvas");
    canvas.className = "systemsculpt-recorder-canvas";
    content.appendChild(canvas);
    this.recordingModal.appendChild(content);
    document.body.appendChild(this.recordingModal);
    this.dragCleanup = this.setupDraggable(this.recordingModal);
    this.setVisualizerCanvas(canvas);
  }
  setupDraggable(element) {
    let pos = { x: 0, y: 0 };
    const cleanup = () => {
      element.classList.remove("dragging");
    };
    const onMove = (clientX, clientY) => {
      const rect = element.getBoundingClientRect();
      pos.x = Math.min(Math.max(0, clientX - rect.width / 2), window.innerWidth - rect.width);
      pos.y = Math.min(Math.max(0, clientY - rect.height / 2), window.innerHeight - rect.height);
      element.style.bottom = "";
      element.style.right = "";
      element.style.left = `${pos.x}px`;
      element.style.top = `${pos.y}px`;
    };
    const onPointerDown = (e) => {
      if (e.button !== 0 && e.button !== -1)
        return;
      element.classList.add("dragging");
      element.setPointerCapture(e.pointerId);
      const rect = element.getBoundingClientRect();
      pos.x = rect.left;
      pos.y = rect.top;
      onMove(e.clientX, e.clientY);
    };
    const onPointerMove = (e) => {
      if (element.hasPointerCapture(e.pointerId)) {
        onMove(e.clientX, e.clientY);
      }
    };
    const onPointerUp = (e) => {
      cleanup();
      element.releasePointerCapture(e.pointerId);
    };
    element.addEventListener("pointerdown", onPointerDown);
    element.addEventListener("pointermove", onPointerMove);
    element.addEventListener("pointerup", onPointerUp);
    element.addEventListener("pointercancel", cleanup);
    return () => {
      element.removeEventListener("pointerdown", onPointerDown);
      element.removeEventListener("pointermove", onPointerMove);
      element.removeEventListener("pointerup", onPointerUp);
      element.removeEventListener("pointercancel", cleanup);
    };
  }
  async toggleRecording() {
    try {
      if (!this.isRecording) {
        const { isChat, viewIdentifier } = this.getActiveViewInfo();
        if (viewIdentifier === "unknown") {
          new import_obsidian26.Notice("\u26A0\uFE0F Please open a note or chat before recording");
          return;
        }
        console.log("Starting recording in view:", {
          isChat,
          viewIdentifier
        });
        this.updateContext({
          isInChat: isChat
        });
        this.createRecordingModal();
      }
      if (this.isRecording) {
        await this.stopRecording();
        if (this.recordingModal) {
          if (this.dragCleanup) {
            this.dragCleanup();
            this.dragCleanup = null;
          }
          this.recordingModal.remove();
          this.recordingModal = null;
        }
      } else {
        await this.startRecording();
        if (this.recordingModal) {
          this.recordingModal.classList.add("recording");
        }
      }
    } catch (error) {
      console.error("Error toggling recording:", error);
      new import_obsidian26.Notice("\u274C Failed to toggle recording");
    }
  }
  async ensureRecordingDirectory() {
    const dir = this.plugin.settings.recordingsDirectory;
    try {
      await this.plugin.app.vault.adapter.mkdir(dir);
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : "Unknown error";
      console.error("Failed to create recordings directory:", errorMessage);
      throw new Error(`Failed to create recordings directory: ${errorMessage}`);
    }
  }
  async detectSupportedFormat() {
    for (const format of RECORDING_FORMATS) {
      try {
        if (MediaRecorder.isTypeSupported(format.mimeType)) {
          console.log(`Selected recording format: ${format.mimeType}`);
          return format;
        }
      } catch (error) {
        console.warn(`Format ${format.mimeType} check failed:`, error);
      }
    }
    throw new Error("No supported audio recording format found");
  }
  generateFileName() {
    var _a;
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-").replace("T", "_").split(".")[0];
    return `${timestamp}.${((_a = this.selectedFormat) == null ? void 0 : _a.extension) || "audio"}`;
  }
  resetVisualizationState() {
    this.smoothedValues = new Float32Array(128);
    if (this.animationFrame) {
      cancelAnimationFrame(this.animationFrame);
      this.animationFrame = null;
    }
    if (this.analyser) {
      this.analyser.disconnect();
      this.analyser = null;
    }
    if (this.audioContext) {
      this.audioContext.close();
      this.audioContext = null;
    }
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
  }
  setupVisualization() {
    if (!this.mediaStream)
      return;
    this.audioContext = new AudioContext({
      sampleRate: 16e3,
      latencyHint: "interactive"
    });
    const source = this.audioContext.createMediaStreamSource(this.mediaStream);
    this.analyser = this.audioContext.createAnalyser();
    this.analyser.fftSize = 256;
    this.analyser.smoothingTimeConstant = 0.7;
    source.connect(this.analyser);
    if (this.visualizerCanvas) {
      this.updateCanvasSize();
      this.draw();
    }
  }
  setVisualizerCanvas(canvas) {
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
    if (!canvas) {
      this.resetVisualizationState();
    }
    this.visualizerCanvas = canvas;
    if (canvas && this.isRecording) {
      this.updateCanvasSize();
      if (!this.audioContext || !this.analyser) {
        this.setupVisualization();
      } else {
        this.draw();
      }
    }
  }
  updateCanvasSize() {
    if (!this.visualizerCanvas)
      return;
    const rect = this.visualizerCanvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    this.visualizerCanvas.width = rect.width * dpr;
    this.visualizerCanvas.height = rect.height * dpr;
    const ctx = this.visualizerCanvas.getContext("2d");
    if (ctx) {
      ctx.scale(dpr, dpr);
    }
  }
  async startRecording() {
    if (this.isRecording)
      return;
    this.resetVisualizationState();
    try {
      await this.ensureRecordingDirectory();
      const permissionResult = await navigator.permissions.query({
        name: "microphone"
      });
      if (permissionResult.state === "denied") {
        throw new Error("Microphone permission denied");
      }
      this.selectedFormat = await this.detectSupportedFormat();
      const audioConstraints = {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 16e3,
        channelCount: 1
      };
      if (this.plugin.settings.preferredMicrophoneId) {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const preferredDevice = devices.find((device) => device.kind === "audioinput" && device.deviceId === this.plugin.settings.preferredMicrophoneId);
          if (preferredDevice) {
            audioConstraints.deviceId = {
              exact: this.plugin.settings.preferredMicrophoneId
            };
          } else {
            this.plugin.settings.preferredMicrophoneId = "";
            await this.plugin.saveSettings();
            console.log("Preferred microphone not found, falling back to default");
          }
        } catch (error) {
          console.error("Error checking microphone devices:", error);
        }
      }
      this.mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: audioConstraints
      });
      this.mediaRecorder = new MediaRecorder(this.mediaStream, {
        mimeType: this.selectedFormat.mimeType
      });
      this.chunks = [];
      this.mediaRecorder.ondataavailable = async (e) => {
        var _a, _b;
        if (e.data.size > 0) {
          this.chunks.push({
            blob: e.data,
            sampleRate: (_b = (_a = this.selectedFormat) == null ? void 0 : _a.sampleRate) != null ? _b : 48e3
          });
        }
      };
      this.mediaRecorder.onstop = async () => {
        var _a;
        try {
          const fileName = this.generateFileName();
          const filePath = `${this.plugin.settings.recordingsDirectory}/${fileName}`;
          const blob = new Blob(this.chunks.map((chunk) => chunk.blob), { type: (_a = this.selectedFormat) == null ? void 0 : _a.mimeType });
          const arrayBuffer = await blob.arrayBuffer();
          await this.plugin.app.vault.adapter.writeBinary(filePath, arrayBuffer);
          this.lastRecordedFilePath = filePath;
          await this.transcribeLastRecording();
        } catch (error) {
          console.error("Failed to save recording:", error);
          new import_obsidian26.Notice("\u274C Failed to save recording");
        }
      };
      this.mediaRecorder.start(1e3);
      this.setupVisualization();
      this.isRecording = true;
      this.notifyListeners();
      if (this.visualizerCanvas) {
        this.draw();
      }
    } catch (error) {
      console.error("Recording error:", error);
      const errorMessage = error instanceof Error ? error.message : "Recording failed";
      throw error;
    }
  }
  async stopRecording() {
    if (!this.isRecording)
      return;
    if (this.mediaRecorder && this.mediaRecorder.state !== "inactive") {
      this.mediaRecorder.stop();
    }
    if (this.mediaStream) {
      this.mediaStream.getTracks().forEach((track) => track.stop());
      this.mediaStream = null;
    }
    this.resetVisualizationState();
    if (this.recordingModal) {
      this.recordingModal.classList.remove("recording");
    }
    this.mediaRecorder = null;
    this.isRecording = false;
    this.notifyListeners();
  }
  onToggle(callback) {
    this.onToggleCallbacks.add(callback);
  }
  notifyListeners() {
    this.onToggleCallbacks.forEach((cb) => cb(this.isRecording));
  }
  unload() {
    this.stopRecording();
    this.onToggleCallbacks.clear();
  }
};

// src/components/SystemSculptContextMenu.ts
var import_obsidian28 = __toModule(require("obsidian"));
init_api();

// src/modals/TextModificationModal.ts
var import_obsidian27 = __toModule(require("obsidian"));
init_SystemSculptService();
init_ui();
function generateUUID2() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var TextModificationModal = class extends import_obsidian27.Modal {
  constructor(app, options) {
    super(app);
    this.isGenerating = false;
    this.options = options;
    this.aiService = SystemSculptService.getInstance(DEFAULT_SETTINGS, app);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal");
    contentEl.addClass("systemsculpt-text-modification-modal");
    const headerEl = contentEl.createDiv("systemsculpt-modal-header");
    headerEl.createEl("h2", { text: "Modify Text" });
    const mainContent = contentEl.createDiv("systemsculpt-modal-content");
    const inputSection = mainContent.createDiv("systemsculpt-input-section");
    const inputLabel = inputSection.createEl("label", {
      text: "Modification Instructions"
    });
    this.inputArea = inputSection.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter instructions for how to modify the text..."
      }
    });
    const previewSection = mainContent.createDiv("systemsculpt-preview-section");
    const previewLabel = previewSection.createEl("label", { text: "Preview" });
    this.previewArea = previewSection.createDiv("systemsculpt-preview-content");
    this.previewArea.setText(this.options.initialText);
    const footerEl = contentEl.createDiv("systemsculpt-modal-footer");
    const cancelButton = footerEl.createEl("button", {
      cls: "systemsculpt-button",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => this.close());
    this.modifyButton = footerEl.createEl("button", {
      cls: "systemsculpt-button mod-cta",
      text: "Modify"
    });
    this.modifyButton.addEventListener("click", () => this.handleModify());
    this.inputArea.focus();
  }
  async handleModify() {
    if (this.isGenerating || !this.inputArea.value.trim())
      return;
    try {
      this.isGenerating = true;
      this.modifyButton.disabled = true;
      (0, import_obsidian27.setIcon)(this.modifyButton, "loader-2");
      this.modifyButton.addClass("loading");
      const instructions = this.inputArea.value.trim();
      const textToModify = this.options.initialText;
      let modifiedText = "";
      for await (const chunk of this.aiService.streamMessage({
        messages: [
          { role: "user", content: textToModify, message_id: generateUUID2() },
          { role: "user", content: instructions, message_id: generateUUID2() }
        ],
        model: "llama-3.3-70b-versatile",
        systemPromptType: "text_modification",
        onError: (error) => {
          showEnhancedNotice(`Failed to modify text: ${error}`, "error");
        }
      })) {
        modifiedText += chunk;
        this.previewArea.setText(modifiedText);
      }
      this.options.onModify(modifiedText);
      this.close();
    } catch (error) {
      console.error("Text modification failed:", error);
      showEnhancedNotice("Failed to modify text. Please try again.", "error");
    } finally {
      this.isGenerating = false;
      this.modifyButton.disabled = false;
      this.modifyButton.empty();
      this.modifyButton.setText("Modify");
      this.modifyButton.removeClass("loading");
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/components/SystemSculptContextMenu.ts
var SystemSculptContextMenu = class {
  constructor(app, sculptService, plugin) {
    this.statusBarItem = null;
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
    this.app = app;
    this.sculptService = sculptService;
    this.plugin = plugin;
    this.transcriptionService = TranscriptionService.getInstance(plugin);
    this.registerContextMenu();
    this.initializeStatusBar();
  }
  initializeStatusBar() {
    this.statusBarItem = this.app.workspace.containerEl.createDiv({
      cls: "systemsculpt-status-bar"
    });
    this.statusBarItem.style.display = "none";
  }
  registerContextMenu() {
    this.app.workspace.on("editor-menu", (menu, editor, view) => {
      if (!(view instanceof import_obsidian28.MarkdownView))
        return;
      const selection = editor.getSelection();
      if (!selection)
        return;
      menu.addItem((item) => {
        item.setTitle("SystemSculpt - Modify Text").setIcon("wand").onClick(async () => {
          const modal = new TextModificationModal(this.app, {
            initialText: selection,
            onModify: (modifiedText) => {
              editor.replaceSelection(modifiedText);
            }
          });
          modal.open();
        });
      });
    });
    this.app.workspace.on("file-menu", (menu, file) => {
      if (!(file instanceof import_obsidian28.TFile))
        return;
      const extension = file.extension.toLowerCase();
      if (["md", "txt", "markdown"].includes(extension) || ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"].includes(extension) || ["mp3", "wav", "m4a", "ogg", "webm"].includes(extension) || ["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Chat with File").setIcon("message-square").onClick(async () => {
            try {
              const leaf = this.app.workspace.getLeaf("tab");
              const view = new ChatView(leaf, this.plugin);
              await leaf.open(view);
              await new Promise((resolve) => setTimeout(resolve, 50));
              this.app.workspace.setActiveLeaf(leaf, { focus: true });
              await view.addFileToContext(file);
            } catch (error) {
              new import_obsidian28.Notice("Failed to open chat with file");
              console.error("Chat open error:", error);
            }
          });
        });
      }
      if (file.extension === "mp3" || file.extension === "wav" || file.extension === "webm") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio").setIcon("microphone").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, false);
            } catch (error) {
              new import_obsidian28.Notice("Failed to transcribe audio file");
              console.error("Transcription error:", error);
            }
          });
        });
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio (Timestamped)").setIcon("clock").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, true);
            } catch (error) {
              new import_obsidian28.Notice("Failed to transcribe audio file with timestamps");
              console.error("Timestamped transcription error:", error);
            }
          });
        });
      }
      if (file.extension === "pdf" || file.extension === "docx" || file.extension === "doc") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Convert to Markdown").setIcon("file-text").onClick(async () => {
            try {
              await this.handleDocumentConversion(file);
            } catch (error) {
              new import_obsidian28.Notice("Failed to convert document");
              console.error("Document conversion error:", error);
            }
          });
        });
      }
    });
  }
  async handleDocumentConversion(file) {
    this.createProgressModal();
    this.updateProgressModal(0, "Processing your document...", "loader-2");
    try {
      await this.sleep(1e3);
      this.updateProgressModal(10, "Uploading document...", "upload");
      const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
      if (cached) {
        this.updateProgressModal(50, "Found cached version", "check");
        const extractionData2 = await this.downloadExtraction(documentId);
        const extractionPath2 = await this.saveExtractionResults(file, extractionData2);
        this.updateProgressModal(100, "Processing complete!", "check-circle");
        this.showCompletionButtons(extractionPath2);
        return;
      }
      this.updateProgressModal(30, "Processing document...", "loader-2");
      const pollResult = await this.pollUntilComplete(documentId);
      if (!pollResult) {
        this.updateProgressModal(0, "Processing incomplete", "alert-circle");
        await this.sleep(3e3);
        this.closeProgressModal();
        return;
      }
      this.updateProgressModal(80, "Downloading results...", "download");
      const extractionData = await this.downloadExtraction(documentId);
      const extractionPath = await this.saveExtractionResults(file, extractionData);
      this.updateProgressModal(100, "Processing complete!", "check-circle");
      this.showCompletionButtons(extractionPath);
    } catch (e) {
      console.error("SystemSculpt error", e);
      this.updateProgressModal(0, `Error: ${e instanceof Error ? e.message : String(e)}`, "x-circle");
      await this.sleep(5e3);
      this.closeProgressModal();
    }
  }
  async handleAudioTranscription(file, timestamped) {
    try {
      await showAudioTranscriptionModal(this.app, {
        file,
        timestamped,
        plugin: this.plugin,
        onTranscriptionComplete: async (text) => {
          var _a;
          const baseName = file.basename;
          const fileExtension = timestamped ? "srt" : "md";
          const outputPath = `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}.${fileExtension}`;
          const content = timestamped ? text : text;
          let transcriptionFile;
          const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
          if (existingFile instanceof import_obsidian28.TFile) {
            await this.app.vault.modify(existingFile, content);
            transcriptionFile = existingFile;
          } else {
            transcriptionFile = await this.app.vault.create(outputPath, content);
          }
          const leaf = this.app.workspace.getLeaf("tab");
          await leaf.openFile(transcriptionFile);
          this.app.workspace.setActiveLeaf(leaf, { focus: true });
        }
      });
    } catch (error) {
      console.error("Audio transcription error:", error);
      throw error;
    }
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  createProgressModal() {
    if (this.progressModal)
      return;
    this.progressModal = document.createElement("div");
    this.progressModal.className = "systemsculpt-progress-modal";
    this.progressBar = this.progressModal.createDiv("systemsculpt-progress-bar");
    this.progressStatus = this.progressModal.createDiv("systemsculpt-progress-status");
    this.progressButtons = this.progressModal.createDiv("systemsculpt-progress-buttons");
    document.body.appendChild(this.progressModal);
  }
  updateProgressModal(progress, status, icon) {
    if (!this.progressModal || !this.progressBar || !this.progressStatus)
      return;
    this.progressBar.style.width = `${progress}%`;
    this.progressStatus.empty();
    (0, import_obsidian28.setIcon)(this.progressStatus, icon);
    this.progressStatus.createSpan({ text: status });
  }
  showCompletionButtons(extractionPath) {
    if (!this.progressButtons)
      return;
    this.progressButtons.empty();
    const viewButton = this.progressButtons.createEl("button", {
      text: "View Result",
      cls: "mod-cta"
    });
    viewButton.addEventListener("click", async () => {
      const file = this.app.vault.getAbstractFileByPath(extractionPath);
      if (file instanceof import_obsidian28.TFile) {
        await this.app.workspace.getLeaf().openFile(file);
      }
      this.closeProgressModal();
    });
    const closeButton = this.progressButtons.createEl("button", {
      text: "Close"
    });
    closeButton.addEventListener("click", () => {
      this.closeProgressModal();
    });
  }
  closeProgressModal() {
    if (this.progressModal && this.progressModal.parentNode) {
      this.progressModal.parentNode.removeChild(this.progressModal);
    }
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
  }
  async pollUntilComplete(documentId, maxAttempts = 30) {
    for (let i = 0; i < maxAttempts; i++) {
      const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.GET(documentId)}`, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      if (!response.ok) {
        throw new Error(`Failed to check status: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === "completed") {
        return true;
      } else if (data.status === "failed") {
        throw new Error(data.error || "Processing failed");
      }
      const progress = Math.min(30 + i / maxAttempts * 50, 80);
      this.updateProgressModal(progress, "Processing document...", "loader-2");
      await this.sleep(2e3);
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.DOWNLOAD(documentId)}`, {
      headers: {
        "Content-Type": "application/json"
      }
    });
    if (!response.ok) {
      throw new Error(`Failed to download extraction: ${response.statusText}`);
    }
    return response.json();
  }
  async saveExtractionResults(file, data) {
    var _a;
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = this.sanitizeFilename(file.basename);
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}`;
    await this.createFolder(parentPath);
    const extractionPath = this.normalizePath(`${parentPath}/${baseName}-extraction.md`);
    const content = this.formatExtractionContent(data);
    const existingFile = this.app.vault.getAbstractFileByPath(extractionPath);
    if (existingFile instanceof import_obsidian28.TFile) {
      await this.app.vault.modify(existingFile, content);
    } else {
      await this.app.vault.create(extractionPath, content);
    }
    return extractionPath;
  }
  sanitizeFilename(filename) {
    return filename.replace(/[^a-zA-Z0-9-_ ]/g, "");
  }
  normalizePath(path) {
    return path.replace(/\\/g, "/").replace(/\/+/g, "/");
  }
  async createFolder(path) {
    const normalizedPath = this.normalizePath(path);
    if (!(this.app.vault.getAbstractFileByPath(normalizedPath) instanceof import_obsidian28.TFolder)) {
      await this.app.vault.createFolder(normalizedPath);
    }
  }
  formatExtractionContent(data) {
    return `# ${data.title || "Document Extraction"}

${data.content || ""}

---
Extracted with SystemSculpt
`;
  }
};

// src/core/settings/SettingsManager.ts
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.settings = DEFAULT_SETTINGS;
  }
  async loadSettings() {
    const loadedData = await this.plugin.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
    if (this.settings.developmentMode) {
      this.settings.serverUrl = "http://localhost:3001";
    } else {
      this.settings.serverUrl = "https://api.systemsculpt.com";
    }
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
    this.plugin.aiService.updateSettings(this.settings);
  }
  getSettings() {
    return this.settings;
  }
  async updateSettings(newSettings) {
    if (newSettings === DEFAULT_SETTINGS) {
      this.settings = { ...DEFAULT_SETTINGS };
      await this.saveSettings();
      return;
    }
    if (newSettings.developmentMode !== void 0) {
      newSettings.serverUrl = newSettings.developmentMode ? "http://localhost:3001" : "https://api.systemsculpt.com";
    }
    this.settings = { ...this.settings, ...newSettings };
    await this.saveSettings();
  }
};

// src/core/license/LicenseManager.ts
var LicenseManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  async validateLicenseKey(force = false) {
    if (!this.plugin.settings.licenseKey) {
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
    try {
      const isValid = await this.plugin.aiService.validateLicense(force);
      this.plugin.settings.licenseValid = isValid;
      await this.plugin.saveSettings();
      return isValid;
    } catch (error) {
      console.error("License validation error:", error);
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
  }
};

// src/modals/JanitorModal.ts
var import_obsidian29 = __toModule(require("obsidian"));
init_ui();
var JanitorModal = class extends import_obsidian29.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  calculateSize(files) {
    const totalBytes = files.reduce((acc, file) => acc + file.stat.size, 0);
    if (totalBytes === 0) {
      return "empty";
    } else if (totalBytes < 1024) {
      return `${totalBytes} bytes`;
    } else if (totalBytes < 1024 * 1024) {
      return `${(totalBytes / 1024).toFixed(1)} KB`;
    } else if (totalBytes < 1024 * 1024 * 1024) {
      return `${(totalBytes / (1024 * 1024)).toFixed(1)} MB`;
    } else {
      return `${(totalBytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;
    }
  }
  getFilesInDirectory(directory) {
    return this.app.vault.getFiles().filter((file) => file.path.startsWith(directory));
  }
  disableButton(button) {
    button.disabled = true;
    button.addClass("mod-disabled");
    button.removeClass("mod-warning");
  }
  updateButtonState(button, files, type) {
    const size = this.calculateSize(files);
    const hasFiles = files.length > 0;
    if (hasFiles) {
      button.disabled = false;
      button.removeClass("mod-disabled");
      button.addClass("mod-warning");
      button.setText(`Clear All ${type} (${size})`);
    } else {
      button.disabled = true;
      button.addClass("mod-disabled");
      button.removeClass("mod-warning");
      button.setText(`No ${type}`);
    }
  }
  async cleanDirectory(directory) {
    if (!directory || directory === "/" || directory === "." || directory === "..") {
      throw new Error("Cannot delete root or system directories");
    }
    const files = this.getFilesInDirectory(directory);
    for (const file of files) {
      await this.app.vault.trash(file, true);
    }
    const folder = this.app.vault.getAbstractFileByPath(directory);
    if (folder instanceof import_obsidian29.TFolder) {
      const subdirs = folder.children.filter((child) => child instanceof import_obsidian29.TFolder).sort((a, b) => b.path.length - a.path.length);
      for (const subdir of subdirs) {
        if (subdir.children.length === 0) {
          await this.app.vault.trash(subdir, true);
        }
      }
      if (folder.children.length === 0) {
        await this.app.vault.trash(folder, true);
      }
    }
  }
  showFilePreview(files, type) {
    var _a, _b;
    const container = document.createElement("div");
    container.className = "systemsculpt-file-tree nav-folder";
    const summary = document.createElement("div");
    summary.className = "nav-folder-title";
    summary.textContent = `${files.length} ${type} (${this.calculateSize(files)})`;
    container.appendChild(summary);
    const sortedFiles = files.sort((a, b) => a.path.localeCompare(b.path));
    const filesByDir = new Map();
    for (const file of sortedFiles) {
      const dir = ((_a = file.parent) == null ? void 0 : _a.path) || "";
      if (!filesByDir.has(dir)) {
        filesByDir.set(dir, []);
      }
      (_b = filesByDir.get(dir)) == null ? void 0 : _b.push(file);
    }
    for (const [dir, dirFiles] of filesByDir) {
      if (dir) {
        const folderDiv = document.createElement("div");
        folderDiv.className = "nav-folder";
        const folderTitle = document.createElement("div");
        folderTitle.className = "nav-folder-title";
        (0, import_obsidian29.setIcon)(folderTitle, "folder");
        folderTitle.createSpan({ text: dir });
        folderDiv.appendChild(folderTitle);
        const folderContent = document.createElement("div");
        folderContent.className = "nav-folder-children";
        folderDiv.appendChild(folderContent);
        for (const file of dirFiles) {
          folderContent.appendChild(this.createFileItem(file));
        }
        container.appendChild(folderDiv);
      } else {
        for (const file of dirFiles) {
          container.appendChild(this.createFileItem(file));
        }
      }
    }
    return container;
  }
  createFileItem(file) {
    const fileDiv = document.createElement("div");
    fileDiv.className = "nav-file";
    const fileTitle = document.createElement("div");
    fileTitle.className = "nav-file-title";
    const extension = file.extension.toLowerCase();
    let iconName = "file";
    if (["md", "txt", "markdown"].includes(extension)) {
      iconName = "file-text";
    } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
      iconName = "image";
    } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
      iconName = "audio-lines";
    } else if (["pdf"].includes(extension)) {
      iconName = "file-text";
    }
    (0, import_obsidian29.setIcon)(fileTitle, iconName);
    fileTitle.createSpan({ text: file.name });
    const sizeSpan = document.createElement("span");
    sizeSpan.className = "nav-file-size";
    sizeSpan.textContent = this.calculateSize([file]);
    fileTitle.appendChild(sizeSpan);
    fileDiv.appendChild(fileTitle);
    return fileDiv;
  }
  async showConfirmationDialog(files, type, directory, button) {
    const confirmModal = new import_obsidian29.Modal(this.app);
    confirmModal.titleEl.setText(`Clear ${type}`);
    const content = confirmModal.contentEl;
    content.createDiv({
      cls: "systemsculpt-modal-description",
      text: `\u26A0\uFE0F WARNING: The following files will be moved to the Obsidian trash. You can restore them from the trash if needed.`
    });
    content.appendChild(this.showFilePreview(files, type));
    const buttonContainer = content.createDiv({
      cls: "systemsculpt-modal-buttons"
    });
    const cancelButton = buttonContainer.createEl("button", { text: "Cancel" });
    cancelButton.addEventListener("click", () => confirmModal.close());
    const confirmButton = buttonContainer.createEl("button", {
      cls: "mod-warning",
      text: "Move to Trash"
    });
    confirmButton.addEventListener("click", async () => {
      try {
        await this.cleanDirectory(directory);
        this.disableButton(button);
        button.setText(`No ${type}`);
        showPopup(this.app, `Successfully moved ${files.length} ${type.toLowerCase()} files (${this.calculateSize(files)}) to trash`, { title: "Success" });
      } catch (error) {
        console.error(`Error clearing ${type.toLowerCase()}:`, error);
        showPopup(this.app, `Failed to clear ${type.toLowerCase()}`, {
          title: "Error"
        });
      }
      confirmModal.close();
    });
    confirmModal.open();
  }
  async isEmptyFile(file) {
    if (file.stat.size === 0)
      return true;
    const extension = file.extension.toLowerCase();
    if (["md", "txt", "markdown"].includes(extension)) {
      const content = await this.app.vault.read(file);
      const contentWithoutFrontmatter = content.replace(/^---[\s\S]*?---/, "").trim();
      return !contentWithoutFrontmatter;
    }
    if ([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp",
      "svg",
      "mp3",
      "wav",
      "ogg",
      "m4a"
    ].includes(extension)) {
      return file.stat.size === 0;
    }
    if (file.path.includes("/Extractions/")) {
      const content = await this.app.vault.read(file);
      const hasOnlyHeaders = !content.replace(/^#.*$/gm, "").trim();
      const hasErrorMessage = content.includes("Error extracting") || content.includes("Processing failed");
      return hasOnlyHeaders || hasErrorMessage;
    }
    return false;
  }
  async getEmptyFiles() {
    const allFiles = this.app.vault.getFiles();
    const emptyFiles = [];
    for (const file of allFiles) {
      if (await this.isEmptyFile(file)) {
        emptyFiles.push(file);
      }
    }
    return emptyFiles;
  }
  async getEmptyFolders() {
    const emptyFolders = [];
    const checkFolder = (folder) => {
      const hasNonEmptyChildren = folder.children.some((child) => {
        if (child instanceof import_obsidian29.TFile) {
          return child.stat.size > 0;
        }
        if (child instanceof import_obsidian29.TFolder) {
          return !checkFolder(child);
        }
        return false;
      });
      if (!hasNonEmptyChildren) {
        emptyFolders.push(folder);
        return true;
      }
      return false;
    };
    const rootFolder = this.app.vault.getRoot();
    for (const child of rootFolder.children) {
      if (child instanceof import_obsidian29.TFolder) {
        checkFolder(child);
      }
    }
    return emptyFolders;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-janitor-modal");
    const titleEl = contentEl.createDiv({ cls: "systemsculpt-modal-title" });
    titleEl.setText("SystemSculpt Janitor");
    const descriptionEl = titleEl.createDiv({
      cls: "systemsculpt-modal-description"
    });
    descriptionEl.setText("Clean up and optimize your SystemSculpt workspace");
    const mainContent = contentEl.createDiv({
      cls: "systemsculpt-janitor-content"
    });
    const sectionsContainer = mainContent.createDiv({
      cls: "systemsculpt-sections-container"
    });
    this.createEmptyContentSection(sectionsContainer);
    this.createChatHistorySection(sectionsContainer);
    this.createExtractionsSection(sectionsContainer);
    this.createRecordingsSection(sectionsContainer);
  }
  async createEmptyContentSection(container) {
    const emptySection = this.createSection(container, "Empty Content", "Clean up empty files and folders");
    const emptyFiles = await this.getEmptyFiles();
    const emptyFolders = await this.getEmptyFolders();
    const totalEmpty = emptyFiles.length + emptyFolders.length;
    const clearEmptyButton = emptySection.createEl("button", {
      cls: "systemsculpt-button",
      text: totalEmpty > 0 ? `Clear Empty Content (${totalEmpty} items)` : "No Empty Content"
    });
    this.updateButtonState(clearEmptyButton, emptyFiles, "Empty Content");
    if (totalEmpty > 0) {
      clearEmptyButton.addEventListener("click", async () => {
        if (clearEmptyButton.disabled)
          return;
        const confirmModal = new import_obsidian29.Modal(this.app);
        confirmModal.titleEl.setText("Clear Empty Content");
        const content = confirmModal.contentEl;
        content.createDiv({
          cls: "systemsculpt-modal-description",
          text: `\u26A0\uFE0F WARNING: The following empty items will be moved to the Obsidian trash. You can restore them from the trash if needed.`
        });
        if (emptyFiles.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Files"
          });
          content.appendChild(this.showFilePreview(emptyFiles, "Empty Files"));
        }
        if (emptyFolders.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Folders"
          });
          const folderList = content.createDiv({
            cls: "systemsculpt-file-tree nav-folder"
          });
          for (const folder of emptyFolders) {
            const folderItem = folderList.createDiv({
              cls: "nav-folder-title"
            });
            (0, import_obsidian29.setIcon)(folderItem, "folder");
            folderItem.createSpan({ text: folder.path });
          }
        }
        const buttonContainer = content.createDiv({
          cls: "systemsculpt-modal-buttons"
        });
        const cancelButton = buttonContainer.createEl("button", {
          text: "Cancel"
        });
        cancelButton.addEventListener("click", () => confirmModal.close());
        const confirmButton = buttonContainer.createEl("button", {
          cls: "mod-warning",
          text: "Move to Trash"
        });
        confirmButton.addEventListener("click", async () => {
          try {
            for (const file of emptyFiles) {
              await this.app.vault.trash(file, true);
            }
            const sortedFolders = emptyFolders.sort((a, b) => b.path.length - a.path.length);
            for (const folder of sortedFolders) {
              await this.app.vault.trash(folder, true);
            }
            this.disableButton(clearEmptyButton);
            clearEmptyButton.setText("No Empty Content");
            showPopup(this.app, `Successfully moved ${totalEmpty} empty items to trash`, { title: "Success" });
          } catch (error) {
            console.error("Error clearing empty content:", error);
            showPopup(this.app, "Failed to clear empty content", {
              title: "Error"
            });
          }
          confirmModal.close();
        });
        confirmModal.open();
      });
    }
  }
  createChatHistorySection(container) {
    const historySection = this.createSection(container, "Chat History", "Delete all chat history and conversations permanently");
    const chatFiles = this.getFilesInDirectory(this.plugin.settings.chatsDirectory);
    const chatSize = this.calculateSize(chatFiles);
    const hasChatFiles = chatFiles.length > 0;
    const clearHistoryButton = historySection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasChatFiles ? `Clear All Chat History (${chatSize})` : "No Chat History"
    });
    this.updateButtonState(clearHistoryButton, chatFiles, "Chat History");
    if (hasChatFiles) {
      clearHistoryButton.addEventListener("click", async () => {
        if (clearHistoryButton.disabled)
          return;
        await this.showConfirmationDialog(chatFiles, "Chat History", this.plugin.settings.chatsDirectory, clearHistoryButton);
      });
    }
  }
  createExtractionsSection(container) {
    const extractionsSection = this.createSection(container, "Document Extractions", "Delete all extracted document content (PDFs, documents, etc.)");
    const extractionFiles = this.getFilesInDirectory(this.plugin.settings.extractionsDirectory);
    const extractionsSize = this.calculateSize(extractionFiles);
    const hasExtractionFiles = extractionFiles.length > 0;
    const clearExtractionsButton = extractionsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasExtractionFiles ? `Clear All Extractions (${extractionsSize})` : "No Extractions"
    });
    this.updateButtonState(clearExtractionsButton, extractionFiles, "Extractions");
    if (hasExtractionFiles) {
      clearExtractionsButton.addEventListener("click", async () => {
        if (clearExtractionsButton.disabled)
          return;
        await this.showConfirmationDialog(extractionFiles, "Extractions", this.plugin.settings.extractionsDirectory, clearExtractionsButton);
      });
    }
  }
  createRecordingsSection(container) {
    const recordingsSection = this.createSection(container, "Audio Recordings", "Delete all audio recordings (this won't affect transcriptions)");
    const recordingFiles = this.getFilesInDirectory(this.plugin.settings.recordingsDirectory);
    const recordingsSize = this.calculateSize(recordingFiles);
    const hasRecordingFiles = recordingFiles.length > 0;
    const clearRecordingsButton = recordingsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasRecordingFiles ? `Clear All Recordings (${recordingsSize})` : "No Recordings"
    });
    this.updateButtonState(clearRecordingsButton, recordingFiles, "Recordings");
    if (hasRecordingFiles) {
      clearRecordingsButton.addEventListener("click", async () => {
        if (clearRecordingsButton.disabled)
          return;
        await this.showConfirmationDialog(recordingFiles, "Recordings", this.plugin.settings.recordingsDirectory, clearRecordingsButton);
      });
    }
  }
  createSection(container, title, description) {
    const section = container.createDiv({
      cls: "systemsculpt-janitor-section"
    });
    const header = section.createDiv({ cls: "systemsculpt-section-header" });
    header.setText(title);
    const desc = section.createDiv({ cls: "systemsculpt-section-description" });
    desc.setText(description);
    return section;
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/core/plugin/ribbons.ts
var RibbonManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  initialize() {
    this.registerRibbonIcons();
  }
  registerRibbonIcons() {
    this.plugin.addRibbonIcon("message-square", "Open SystemSculpt Chat", async () => {
      await this.openChatView();
    });
    this.plugin.addRibbonIcon("history", "Open SystemSculpt Chat History", () => {
      this.openChatHistoryModal();
    });
    this.plugin.addRibbonIcon("trash", "Open SystemSculpt Janitor", () => {
      this.openJanitorModal();
    });
  }
  async openChatView() {
    const { workspace } = this.app;
    const leaf = workspace.getLeaf("tab");
    const view = new ChatView(leaf, this.plugin);
    await leaf.open(view);
    workspace.setActiveLeaf(leaf, { focus: true });
  }
  openChatHistoryModal() {
    const modal = new LoadChatModal(this.app, async (chatId) => {
      const leaf = this.app.workspace.getLeaf("tab");
      const view = new ChatView(leaf, this.plugin);
      await leaf.open(view);
      await view.loadChatById(chatId);
      this.app.workspace.setActiveLeaf(leaf, { focus: true });
    }, this.plugin);
    modal.open();
  }
  openJanitorModal() {
    new JanitorModal(this.app, this.plugin).open();
  }
};

// src/core/plugin/views.ts
var ViewManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  initialize() {
    this.registerView();
    this.ribbonManager.initialize();
    this.app.workspace.onLayoutReady(() => {
      this.restoreChatViews();
    });
  }
  async restoreChatViews() {
    const leaves = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (leaves.length === 0)
      return;
    for (const leaf of leaves) {
      const view = leaf.view;
      const state = leaf.getViewState();
      if (state && state.state && state.state.chatId) {
        await view.setState(state.state);
      }
    }
  }
  registerView() {
    this.plugin.registerView(CHAT_VIEW_TYPE, (leaf) => new ChatView(leaf, this.plugin));
  }
  unloadViews() {
    this.app.workspace.detachLeavesOfType(CHAT_VIEW_TYPE);
  }
};

// src/core/plugin/commands.ts
var import_obsidian31 = __toModule(require("obsidian"));
init_ui();

// src/editors/InlineDiffEditor.ts
var import_view = __toModule(require("@codemirror/view"));
var import_state = __toModule(require("@codemirror/state"));
var import_obsidian30 = __toModule(require("obsidian"));
init_SystemSculptService();
init_ui();
var import_diff_match_patch = __toModule(require_diff_match_patch());
var setDiffEffect = import_state.StateEffect.define();
var diffField = import_state.StateField.define({
  create() {
    return import_view.Decoration.none;
  },
  update(deco, tr) {
    for (const effect of tr.effects) {
      if (effect.is(setDiffEffect)) {
        return effect.value;
      }
    }
    return tr.docChanged ? import_view.Decoration.none : deco.map(tr.changes);
  },
  provide: (field) => import_view.EditorView.decorations.from(field)
});
var ProcessingWidget = class extends import_view.WidgetType {
  toDOM() {
    const container = document.createElement("div");
    container.className = "diff-processing";
    const spinner = document.createElement("div");
    spinner.className = "spinner";
    container.appendChild(spinner);
    const text = document.createElement("span");
    text.textContent = "Processing edits\u2026";
    container.appendChild(text);
    return container;
  }
};
var UnifiedDiffWidget = class extends import_view.WidgetType {
  constructor(chunk, editor) {
    super();
    this.chunk = chunk;
    this.editor = editor;
  }
  formatText(text) {
    return text.split("\n").map((line) => line.trimEnd()).join("\n");
  }
  toDOM() {
    const container = document.createElement("div");
    container.className = "unified-diff-chunk";
    const diffLines = document.createElement("div");
    diffLines.className = "diff-lines";
    if (this.chunk.type === "delete" && this.chunk.originalText) {
      const lineEl = document.createElement("div");
      lineEl.className = "diff-line diff-old";
      lineEl.textContent = `- ${this.formatText(this.chunk.originalText)}`;
      diffLines.appendChild(lineEl);
    } else if (this.chunk.type === "insert" && this.chunk.newText) {
      const lineEl = document.createElement("div");
      lineEl.className = "diff-line diff-new";
      lineEl.textContent = `+ ${this.formatText(this.chunk.newText)}`;
      diffLines.appendChild(lineEl);
    } else if (this.chunk.type === "replace") {
      const oldText = this.chunk.originalText && this.formatText(this.chunk.originalText);
      const newText = this.chunk.newText && this.formatText(this.chunk.newText);
      if (oldText) {
        const oldLine = document.createElement("div");
        oldLine.className = "diff-line diff-old";
        oldLine.textContent = `- ${oldText}`;
        diffLines.appendChild(oldLine);
      }
      if (newText) {
        const newLine = document.createElement("div");
        newLine.className = "diff-line diff-new";
        newLine.textContent = `+ ${newText}`;
        diffLines.appendChild(newLine);
      }
    }
    container.appendChild(diffLines);
    const actionsEl = document.createElement("div");
    actionsEl.className = "diff-actions";
    const acceptBtn = document.createElement("button");
    acceptBtn.className = "diff-btn diff-accept";
    (0, import_obsidian30.setIcon)(acceptBtn, "check");
    acceptBtn.title = "Accept Change";
    acceptBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      this.editor.applyChunkChange(this.chunk.id, true);
    });
    actionsEl.appendChild(acceptBtn);
    const rejectBtn = document.createElement("button");
    rejectBtn.className = "diff-btn diff-reject";
    (0, import_obsidian30.setIcon)(rejectBtn, "x");
    rejectBtn.title = "Reject Change";
    rejectBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      this.editor.applyChunkChange(this.chunk.id, false);
    });
    actionsEl.appendChild(rejectBtn);
    container.appendChild(actionsEl);
    return container;
  }
};
var InlineDiffEditor = class {
  constructor(app, editor, plugin) {
    this.app = app;
    this.editor = editor;
    this.plugin = plugin;
    this.diffChunks = [];
    this.processing = false;
    this.bottomToolbar = null;
    this.selectionRange = null;
    this.aiService = SystemSculptService.getInstance(this.plugin.settings, this.app);
    this.editorView = this.editor.cm;
    this.dmp = new import_diff_match_patch.diff_match_patch();
    this.initializeEditor();
    this.initializeKeyboardShortcuts();
    this.initializeBottomToolbar();
  }
  initializeEditor() {
    if (!this.editorView.state.field(diffField, false)) {
      this.editorView.dispatch({
        effects: import_state.StateEffect.appendConfig.of([diffField])
      });
    }
  }
  initializeKeyboardShortcuts() {
    this.editorView.dom.addEventListener("keydown", (e) => {
      if (e.metaKey && e.key === "Enter") {
        e.preventDefault();
        this.triggerSuggestion();
      }
    });
  }
  triggerSuggestion() {
  }
  normalizeText(text) {
    let normalized = text.replace(/\r\n?/g, "\n");
    const hadTrailingNewline = /(\r\n|\n)$/.test(text);
    const hasTrailingNewline = normalized.endsWith("\n");
    if (hadTrailingNewline && !hasTrailingNewline) {
      normalized += "\n";
    } else if (!hadTrailingNewline && hasTrailingNewline) {
      normalized = normalized.slice(0, -1);
    }
    return normalized;
  }
  getExactPosition(text, offset) {
    const normalized = this.normalizeText(text.slice(0, offset));
    const lines = normalized.split("\n");
    const line = lines.length - 1;
    let ch = 0;
    const tabSize = this.editorView.state.tabSize || 4;
    for (const char of lines[line]) {
      if (char === "	") {
        ch = Math.floor((ch + tabSize) / tabSize) * tabSize;
      } else {
        ch++;
      }
    }
    return { line, ch };
  }
  adjustPosition(pos) {
    if (!this.selectionRange)
      return pos;
    const basePos = this.selectionRange.from;
    return pos.line === 0 ? { line: basePos.line, ch: basePos.ch + pos.ch } : { line: basePos.line + pos.line, ch: pos.ch };
  }
  resolvePosition(view, pos) {
    const line = view.state.doc.line(pos.line + 1);
    return line.from + pos.ch;
  }
  computeDiffChunks(original, modified) {
    var _a, _b;
    const normOrig = this.normalizeText(original);
    const normMod = this.normalizeText(modified);
    const origLines = normOrig.split("\n");
    const modLines = normMod.split("\n");
    const chunks = [];
    let id = 0;
    const maxLines = Math.max(origLines.length, modLines.length);
    for (let i = 0; i < maxLines; i++) {
      const origLine = (_a = origLines[i]) != null ? _a : "";
      const modLine = (_b = modLines[i]) != null ? _b : "";
      if (origLine === modLine)
        continue;
      if (!origLine && modLine) {
        chunks.push({
          id: id++,
          type: "insert",
          from: { line: i, ch: 0 },
          to: { line: i, ch: 0 },
          newText: modLine,
          applied: false,
          lineNumber: i
        });
      } else if (origLine && !modLine) {
        chunks.push({
          id: id++,
          type: "delete",
          from: { line: i, ch: 0 },
          to: { line: i, ch: origLine.length },
          originalText: origLine,
          applied: false,
          lineNumber: i
        });
      } else {
        chunks.push({
          id: id++,
          type: "replace",
          from: { line: i, ch: 0 },
          to: { line: i, ch: origLine.length },
          originalText: origLine,
          newText: modLine,
          applied: false,
          lineNumber: i
        });
      }
    }
    return chunks;
  }
  buildDiffDecorations(view, chunks) {
    const decorations = [];
    if (this.processing) {
      decorations.push(import_view.Decoration.widget({
        widget: new ProcessingWidget(),
        side: -1
      }).range(0));
    }
    const chunksByLine = new Map();
    for (const chunk of chunks) {
      if (!chunk.applied) {
        chunksByLine.set(chunk.lineNumber, chunk);
      }
    }
    for (const chunk of chunksByLine.values()) {
      try {
        const adjustedFrom = this.resolvePosition(view, this.adjustPosition(chunk.from));
        const adjustedTo = this.resolvePosition(view, this.adjustPosition(chunk.to));
        if (adjustedFrom === adjustedTo)
          continue;
        decorations.push(import_view.Decoration.replace({
          widget: new UnifiedDiffWidget(chunk, this),
          block: false
        }).range(adjustedFrom, adjustedTo));
      } catch (error) {
        console.error("Error building diff decoration:", error);
      }
    }
    return import_view.Decoration.set(decorations, true);
  }
  showDiff(chunks) {
    const decoSet = this.buildDiffDecorations(this.editorView, chunks);
    this.editorView.dispatch({ effects: setDiffEffect.of(decoSet) });
    this.updateBottomToolbarVisibility();
  }
  getEditableContent() {
    this.selectionRange = this.getCurrentSelectionRange();
    if (this.selectionRange) {
      return {
        content: this.editor.getRange(this.selectionRange.from, this.selectionRange.to),
        isSelection: true
      };
    }
    return { content: this.editor.getValue(), isSelection: false };
  }
  getCurrentSelectionRange() {
    const selection = this.editor.getSelection();
    if (!selection || selection.trim() === "")
      return null;
    return {
      from: this.editor.getCursor("from"),
      to: this.editor.getCursor("to")
    };
  }
  applyChunkToEditor(chunk) {
    var _a, _b;
    const from = this.adjustPosition(chunk.from);
    const to = this.adjustPosition(chunk.to);
    console.log("Applying chunk:", "ID:", chunk.id, "Type:", chunk.type, "From:", from, "To:", to, "Original:", chunk.originalText, "New:", chunk.newText);
    if (chunk.type === "delete") {
      if (from.line === to.line) {
        const lineText = (_a = this.editor.getLine(from.line)) != null ? _a : "";
        const fullLine = from.ch === 0 && to.ch >= lineText.length;
        if (fullLine) {
          this.editor.replaceRange("", { line: from.line, ch: 0 }, { line: from.line, ch: lineText.length });
        } else {
          this.editor.replaceRange("", from, to);
        }
      } else {
        for (let line = from.line; line <= to.line; line++) {
          const lineText = (_b = this.editor.getLine(line)) != null ? _b : "";
          if (line === from.line) {
            this.editor.replaceRange("", { line, ch: from.ch }, { line, ch: lineText.length });
          } else if (line === to.line) {
            this.editor.replaceRange("", { line, ch: 0 }, { line, ch: Math.min(to.ch, lineText.length) });
          } else {
            this.editor.replaceRange("", { line, ch: 0 }, { line, ch: lineText.length });
          }
        }
      }
      return;
    }
    if (chunk.type === "insert" && chunk.newText) {
      this.editor.replaceRange(this.normalizeText(chunk.newText), from, from);
    } else if (chunk.type === "replace" && chunk.newText) {
      this.editor.replaceRange(this.normalizeText(chunk.newText), from, to);
    }
  }
  applyChunkChange(chunkId, accept) {
    const chunk = this.diffChunks.find((c) => c.id === chunkId);
    if (!chunk)
      return;
    if (accept) {
      this.applyChunkToEditor(chunk);
    }
    chunk.applied = true;
    this.showDiff(this.diffChunks);
  }
  applyAllChanges(accept) {
    this.diffChunks.filter((chunk) => !chunk.applied).forEach((chunk) => this.applyChunkChange(chunk.id, accept));
    this.updateBottomToolbarVisibility();
  }
  initializeBottomToolbar() {
    var _a;
    (_a = this.bottomToolbar) == null ? void 0 : _a.remove();
    this.bottomToolbar = document.createElement("div");
    this.bottomToolbar.className = "diff-bottom-toolbar";
    this.editorView.dom.appendChild(this.bottomToolbar);
    const acceptAllBtn = document.createElement("button");
    acceptAllBtn.className = "diff-btn diff-accept";
    (0, import_obsidian30.setIcon)(acceptAllBtn, "check");
    const acceptText = document.createElement("span");
    acceptText.textContent = "Accept All";
    acceptAllBtn.appendChild(acceptText);
    acceptAllBtn.title = "Accept all changes";
    acceptAllBtn.addEventListener("click", () => this.applyAllChanges(true));
    this.bottomToolbar.appendChild(acceptAllBtn);
    const rejectAllBtn = document.createElement("button");
    rejectAllBtn.className = "diff-btn diff-reject";
    (0, import_obsidian30.setIcon)(rejectAllBtn, "x");
    const rejectText = document.createElement("span");
    rejectText.textContent = "Reject All";
    rejectAllBtn.appendChild(rejectText);
    rejectAllBtn.title = "Reject all changes";
    rejectAllBtn.addEventListener("click", () => this.applyAllChanges(false));
    this.bottomToolbar.appendChild(rejectAllBtn);
    this.updateBottomToolbarVisibility();
  }
  updateBottomToolbarVisibility() {
    if (!this.bottomToolbar)
      return;
    const hasPending = this.diffChunks.some((chunk) => !chunk.applied);
    this.bottomToolbar.classList.toggle("visible", hasPending);
  }
  async suggestEdits(instructions) {
    try {
      const { content: originalContent, isSelection } = this.getEditableContent();
      this.processing = true;
      this.diffChunks = [];
      this.showDiff([]);
      let accumulatedContent = "";
      let updateTimeout = null;
      let lastProcessedLength = 0;
      for await (const chunk of this.aiService.streamMessage({
        messages: [
          {
            role: "user",
            content: originalContent,
            message_id: crypto.randomUUID()
          },
          {
            role: "user",
            content: `${isSelection ? "Please only modify the selected text. " : ""}${instructions}`,
            message_id: crypto.randomUUID()
          }
        ],
        model: this.plugin.settings.selectedModelId,
        systemPromptType: "text_modification",
        onError: (error) => {
          console.error("AI service error:", error);
          showEnhancedNotice(`Failed to modify text: ${error}`, "error");
        }
      })) {
        if (chunk.content) {
          accumulatedContent += chunk.content;
          if (accumulatedContent.length > lastProcessedLength) {
            if (updateTimeout)
              clearTimeout(updateTimeout);
            updateTimeout = setTimeout(() => {
              const currentChunks = this.computeDiffChunks(originalContent, this.normalizeText(accumulatedContent));
              if (currentChunks.length > 0) {
                this.diffChunks = currentChunks;
                this.showDiff(currentChunks);
                lastProcessedLength = accumulatedContent.length;
              }
            }, 50);
          }
        }
      }
      if (updateTimeout)
        clearTimeout(updateTimeout);
      const normalizedContent = this.normalizeText(accumulatedContent);
      const finalChunks = this.computeDiffChunks(originalContent, normalizedContent);
      if (finalChunks.length > 0) {
        this.diffChunks = finalChunks;
        this.showDiff(finalChunks);
      }
      this.processing = false;
    } catch (error) {
      console.error("Error during suggestEdits:", error);
      new import_obsidian30.Notice("Failed to suggest edits. Please try again.");
      this.processing = false;
      this.diffChunks = [];
      this.showDiff([]);
    }
  }
  onunload() {
    var _a;
    (_a = this.bottomToolbar) == null ? void 0 : _a.remove();
  }
};

// src/core/plugin/commands.ts
var CommandManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  registerCommands() {
    this.registerOpenTasksFile();
    this.registerToggleAudioRecorder();
    this.registerOpenChat();
    this.registerOpenChatHistory();
    this.registerOpenJanitor();
    this.registerReloadObsidian();
    this.registerOpenSettings();
    this.registerChangeChatModel();
    this.registerChatWithFile();
    this.registerSuggestEdits();
    this.registerClearSuggestedEdits();
  }
  registerOpenTasksFile() {
    this.plugin.addCommand({
      id: "open-tasks-file",
      name: "Open Tasks File",
      callback: async () => {
        await this.plugin.tasksService.openOrCreateTasksFile();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "t" }]
    });
  }
  registerToggleAudioRecorder() {
    this.plugin.addCommand({
      id: "toggle-audio-recorder",
      name: "Toggle Audio Recorder",
      callback: () => {
        this.plugin.getRecorderService().toggleRecording();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "r" }]
    });
  }
  registerOpenChat() {
    this.plugin.addCommand({
      id: "open-systemsculpt-chat",
      name: "Open SystemSculpt Chat",
      callback: async () => {
        await this.ribbonManager.openChatView();
      }
    });
  }
  registerOpenChatHistory() {
    this.plugin.addCommand({
      id: "open-chat-history",
      name: "Open SystemSculpt Chat History",
      callback: () => {
        this.ribbonManager.openChatHistoryModal();
      }
    });
  }
  registerOpenJanitor() {
    this.plugin.addCommand({
      id: "open-systemsculpt-janitor",
      name: "Open SystemSculpt Janitor",
      callback: () => {
        this.ribbonManager.openJanitorModal();
      }
    });
  }
  registerReloadObsidian() {
    this.plugin.addCommand({
      id: "reload-obsidian",
      name: "Reload Obsidian",
      callback: () => {
        window.location.reload();
      }
    });
  }
  registerOpenSettings() {
    this.plugin.addCommand({
      id: "open-systemsculpt-settings",
      name: "Open SystemSculpt AI Settings",
      callback: () => {
        this.app.setting.open();
        this.app.setting.openTabById(this.plugin.manifest.id);
      }
    });
  }
  registerChangeChatModel() {
    this.plugin.addCommand({
      id: "change-chat-model",
      name: "Change Chat Model",
      checkCallback: (checking) => {
        const chatView = this.app.workspace.getActiveViewOfType(ChatView);
        if (!chatView) {
          if (!checking) {
            showEnhancedNotice("You need to be within a SystemSculpt chatview to change the model.", "warning");
          }
          return false;
        }
        if (!checking) {
          (async () => {
            try {
              await this.plugin.modelService.getModels();
              const modal = new ModelSelectionModal(this.app, chatView.getSelectedModelId(), async (modelId) => {
                await chatView.setSelectedModelId(modelId);
                showEnhancedNotice("Model changed successfully", "info");
              }, this.plugin);
              modal.open();
            } catch (err) {
              console.error("Failed to open model selection:", err);
              showEnhancedNotice("Failed to fetch available models", "error");
            }
          })();
        }
        return true;
      }
    });
  }
  registerChatWithFile() {
    this.plugin.addCommand({
      id: "chat-with-file",
      name: "Chat with File",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (!activeFile)
          return false;
        const extension = activeFile.extension.toLowerCase();
        const supportedExtensions = [
          "md",
          "txt",
          "markdown",
          "pdf",
          "doc",
          "docx",
          "ppt",
          "pptx",
          "xls",
          "xlsx",
          "mp3",
          "wav",
          "m4a",
          "ogg",
          "webm",
          "jpg",
          "jpeg",
          "png",
          "gif",
          "webp",
          "svg"
        ];
        if (!supportedExtensions.includes(extension))
          return false;
        if (!checking) {
          const leaf = this.app.workspace.getLeaf("tab");
          const view = new ChatView(leaf, this.plugin);
          leaf.open(view).then(async () => {
            await new Promise((resolve) => setTimeout(resolve, 50));
            this.app.workspace.setActiveLeaf(leaf, { focus: true });
            await view.addFileToContext(activeFile);
            view.focusInput();
          });
        }
        return true;
      }
    });
  }
  registerSuggestEdits() {
    this.plugin.addCommand({
      id: "suggest-edits",
      name: "Suggest AI Edits (Inline Diff)",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian31.MarkdownView);
        if (!activeView)
          return false;
        if (!checking) {
          const modal = new EditInstructionsModal(this.app, async (instructions) => {
            const editor = new InlineDiffEditor(this.app, activeView.editor, this.plugin);
            await editor.suggestEdits(instructions);
          });
          modal.open();
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "e" }]
    });
  }
  registerClearSuggestedEdits() {
    this.plugin.addCommand({
      id: "clear-suggested-edits",
      name: "Clear All Suggested Edits",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian31.MarkdownView);
        if (!activeView)
          return false;
        if (!checking) {
          const editor = new InlineDiffEditor(this.app, activeView.editor, this.plugin);
          editor.clearDiffs();
          showEnhancedNotice("Cleared all suggested edits", "info");
        }
        return true;
      }
    });
  }
};
var EditInstructionsModal = class extends import_obsidian31.Modal {
  constructor(app, onSubmit) {
    super(app);
    this.instruction = "";
    this.onSubmit = onSubmit;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-edit-instructions-modal");
    const titleEl = contentEl.createDiv({ cls: "modal-title" });
    const iconEl = titleEl.createSpan({ cls: "modal-icon" });
    (0, import_obsidian31.setIcon)(iconEl, "wand");
    titleEl.createSpan({ text: "AI Edit Instructions" });
    contentEl.createDiv({
      cls: "modal-description",
      text: "Describe how you'd like the AI to modify this text. Be specific for better results."
    });
    const textArea = contentEl.createEl("textarea", {
      placeholder: "Examples:\n\u2022 Fix grammar and improve clarity\n\u2022 Make the tone more professional\n\u2022 Convert text to bullet points\n\u2022 Rewrite as a poem\n\u2022 Simplify complex sentences"
    });
    setTimeout(() => textArea.focus(), 10);
    textArea.addEventListener("input", (e) => {
      this.instruction = e.target.value;
    });
    const buttonContainer = contentEl.createDiv({
      cls: "modal-button-container"
    });
    const cancelButton = buttonContainer.createEl("button", {
      cls: "modal-button modal-button-secondary",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => this.close());
    const submitButton = buttonContainer.createEl("button", {
      cls: "modal-button modal-button-primary",
      text: "Suggest Edits"
    });
    submitButton.addEventListener("click", () => {
      if (!this.instruction.trim()) {
        showEnhancedNotice("Please provide instructions for the edit", "warning");
        return;
      }
      this.close();
      this.onSubmit(this.instruction);
    });
    this.scope.register([], "Enter", (evt) => {
      if (evt.shiftKey) {
        evt.preventDefault();
        if (this.instruction.trim()) {
          this.close();
          this.onSubmit(this.instruction);
        }
      }
    });
    this.scope.register([], "Escape", () => this.close());
  }
  onClose() {
    this.contentEl.empty();
  }
};

// src/services/CustomProviderService.ts
var _CustomProviderService = class {
  constructor(plugin) {
    this.CACHE_DURATION = 30 * 60 * 1e3;
    this.plugin = plugin;
    this.logger = console;
  }
  async testConnection(provider) {
    const cached = _CustomProviderService.connectionTestCache.get(provider.id);
    if (cached && Date.now() - cached.result.timestamp < this.CACHE_DURATION) {
      return cached.result;
    }
    const existingPromise = _CustomProviderService.connectionTestPromises.get(provider.id);
    if (existingPromise) {
      return existingPromise;
    }
    const testPromise = this.performConnectionTest(provider);
    _CustomProviderService.connectionTestPromises.set(provider.id, testPromise);
    try {
      const result = await testPromise;
      if (result.success) {
        _CustomProviderService.connectionTestCache.set(provider.id, {
          result,
          timestamp: Date.now()
        });
      }
      return result;
    } finally {
      _CustomProviderService.connectionTestPromises.delete(provider.id);
    }
  }
  async performConnectionTest(provider) {
    try {
      const models = await this.getModels(provider);
      if (provider.endpoint.includes("openrouter.ai")) {
        await this.validateOpenRouterKey(provider, models);
      }
      return {
        success: true,
        models,
        timestamp: Date.now()
      };
    } catch (error) {
      this.logger.error("Connection test failed:", error);
      return {
        success: false,
        error: this.getErrorMessage(error),
        timestamp: Date.now()
      };
    }
  }
  async validateOpenRouterKey(provider, modelIds) {
    var _a;
    const headers = {
      "Content-Type": "application/json",
      Authorization: `Bearer ${provider.apiKey}`,
      "HTTP-Referer": "https://systemsculpt.com",
      "X-Title": "SystemSculpt AI"
    };
    const completionResponse = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers,
      body: JSON.stringify({
        model: "meta-llama/llama-3-8b-instruct:free",
        messages: [{ role: "user", content: "Hi" }],
        max_tokens: 1
      }),
      signal: AbortSignal.timeout(1e4)
    });
    if (!completionResponse.ok) {
      const errorData = await completionResponse.json().catch(() => ({}));
      if (completionResponse.status === 401) {
        throw new Error("Invalid API key. Please check your OpenRouter API key and try again.");
      } else if (completionResponse.status === 402) {
        throw new Error("Insufficient credits. Please add credits to your OpenRouter account.");
      } else if (completionResponse.status === 429) {
        throw new Error("Rate limit exceeded. Please try again in a few minutes.");
      }
      throw new Error(`API key validation failed: ${((_a = errorData.error) == null ? void 0 : _a.message) || completionResponse.statusText}`);
    }
  }
  async getModels(provider) {
    var _a, _b;
    const headers = {
      "Content-Type": "application/json"
    };
    if (provider.apiKey) {
      if (provider.endpoint.includes("openrouter.ai")) {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
        headers["HTTP-Referer"] = "https://systemsculpt.com";
        headers["X-Title"] = "SystemSculpt AI";
      } else {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
      }
    }
    let endpoint;
    if (provider.endpoint.includes("openrouter.ai")) {
      endpoint = "https://openrouter.ai/api/v1/models";
    } else {
      const baseUrl = provider.endpoint.replace(/\/+$/, "");
      endpoint = baseUrl.endsWith("/v1") ? `${baseUrl}/models` : baseUrl.endsWith("/v1/models") ? baseUrl : `${baseUrl}/v1/models`;
    }
    const response = await fetch(endpoint, {
      method: "GET",
      headers,
      signal: AbortSignal.timeout(1e4)
    });
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      if (response.status === 401) {
        throw new Error("Invalid API key. Please check your API key and try again.");
      } else if (response.status === 403) {
        throw new Error("Access denied. Please verify your API key has the correct permissions.");
      } else if (response.status === 404) {
        throw new Error("API endpoint not found. Please check the URL and try again.");
      }
      throw new Error(`HTTP error: ${((_a = errorData.error) == null ? void 0 : _a.message) || response.statusText}`);
    }
    const data = await response.json();
    return (((_b = data.data) == null ? void 0 : _b.map((model) => model.id)) || []).filter((id) => !id.toLowerCase().includes("whisper"));
  }
  getErrorMessage(error) {
    if (error instanceof Error) {
      if (error.name === "AbortError") {
        return "Connection timed out. Please check your internet connection and try again.";
      }
      return error.message;
    }
    return "An unexpected error occurred. Please try again or contact support if the issue persists.";
  }
};
var CustomProviderService = _CustomProviderService;
CustomProviderService.connectionTestCache = new Map();
CustomProviderService.connectionTestPromises = new Map();

// src/main.ts
init_SystemPromptService();

// src/services/TasksService.ts
var import_obsidian32 = __toModule(require("obsidian"));
var TasksService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.app = plugin.app;
    this.settings = plugin.settings;
    this.lastTaskFileReorder = 0;
    this.reorderDebounce = 0;
    this.registerTasksFileWatcher();
  }
  async openOrCreateTasksFile() {
    const tasksDir = this.settings.tasksDirectory;
    const fileName = `${tasksDir}/Tasks.md`;
    try {
      await this.app.vault.adapter.mkdir(tasksDir);
      if (!await this.app.vault.adapter.exists(fileName)) {
        await this.app.vault.create(fileName, `# Tasks

- [ ] Sample task
`);
      }
      const file = this.app.vault.getAbstractFileByPath(fileName);
      if (file instanceof import_obsidian32.TFile) {
        const existingLeaf = this.app.workspace.getLeavesOfType("markdown").find((leaf) => leaf.view.getState().file === file.path);
        if (existingLeaf) {
          this.app.workspace.setActiveLeaf(existingLeaf, { focus: true });
        } else {
          await this.app.workspace.getLeaf().openFile(file);
        }
      }
    } catch (error) {
      console.error("Failed to handle tasks file:", error);
      throw error;
    }
  }
  registerTasksFileWatcher() {
    this.plugin.registerEvent(this.app.vault.on("modify", async (file) => {
      const tasksDir = this.settings.tasksDirectory;
      if (file.path.startsWith(tasksDir) && file.path.endsWith(".md")) {
        await this.reorderCompletedTasks(file);
      }
    }));
  }
  async reorderCompletedTasks(file) {
    if (!this.settings.moveCompletedTasksDown) {
      return;
    }
    if (!file.path.startsWith(this.settings.tasksDirectory)) {
      return;
    }
    if (!file.path.endsWith(".md")) {
      return;
    }
    const original = await this.app.vault.read(file);
    const reordered = this.reorderContent(original);
    if (reordered !== original) {
      await this.app.vault.modify(file, reordered);
    }
  }
  reorderContent(content) {
    const lines = content.split("\n");
    const output = [];
    let listBuffer = [];
    const flushBuffer = () => {
      if (listBuffer.length > 0) {
        output.push(...this.reorderListBlock(listBuffer));
        listBuffer = [];
      }
    };
    for (const line of lines) {
      if (/^\s*-\s*\[[x\s]\]/.test(line)) {
        listBuffer.push(line);
      } else {
        flushBuffer();
        output.push(line);
      }
    }
    flushBuffer();
    return output.join("\n");
  }
  reorderListBlock(lines) {
    function getIndent(line) {
      const match = line.match(/^(\s*)/);
      return match ? match[1].length : 0;
    }
    const nodes = [];
    const stack = [];
    for (const line of lines) {
      const indent = getIndent(line);
      const node = { line, children: [], indent };
      while (stack.length > 0 && indent <= stack[stack.length - 1].indent) {
        stack.pop();
      }
      if (stack.length === 0) {
        nodes.push(node);
        stack.push(node);
      } else {
        stack[stack.length - 1].children.push(node);
        stack.push(node);
      }
    }
    function reorderNodes(nodes2) {
      for (const node of nodes2) {
        if (node.children.length > 0) {
          node.children = reorderNodes(node.children);
          node.children.sort((a, b) => {
            const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
            const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
            return aComplete - bComplete;
          });
        }
      }
      nodes2.sort((a, b) => {
        const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
        const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
        return aComplete - bComplete;
      });
      return nodes2;
    }
    const reorderedNodes = reorderNodes(nodes);
    const flattened = [];
    function flatten(nodes2) {
      for (const node of nodes2) {
        flattened.push(node.line);
        if (node.children.length > 0) {
          flatten(node.children);
        }
      }
    }
    flatten(reorderedNodes);
    return flattened;
  }
};

// src/services/ModelService.ts
var ModelService = class {
  constructor(plugin, customProviderService) {
    this.loadingPromise = null;
    this.plugin = plugin;
    this.customProviderService = customProviderService;
  }
  static getInstance(plugin, customProviderService) {
    if (!ModelService.instance) {
      ModelService.instance = new ModelService(plugin, customProviderService);
    }
    return ModelService.instance;
  }
  async getModels() {
    if (this.loadingPromise) {
      return this.loadingPromise;
    }
    this.loadingPromise = this.loadModels();
    try {
      const models = await this.loadingPromise;
      return models;
    } finally {
      this.loadingPromise = null;
    }
  }
  async loadModels() {
    try {
      const systemModels = await this.plugin.aiService.getModels();
      const customModels = await this.loadCustomProviderModels();
      const allModels = [...systemModels, ...customModels];
      const favoriteModels = this.plugin.settings.favoriteModels || [];
      for (const model of allModels) {
        model.isFavorite = favoriteModels.some((fav) => fav.modelId === model.id && fav.provider === model.provider);
      }
      return allModels;
    } catch (error) {
      console.error("Failed to load models:", error);
      return [];
    }
  }
  async loadCustomProviderModels() {
    const { customProviders } = this.plugin.settings;
    const fetches = customProviders.filter((p) => p.isEnabled).map(async (p) => {
      try {
        const result = await this.customProviderService.testConnection(p);
        if (result.success && result.models) {
          return this.createCustomModels(p, result.models);
        }
      } catch (error) {
        console.error(`Failed to load models from ${p.name}:`, error);
      }
      return [];
    });
    const results = await Promise.all(fetches);
    return results.flat();
  }
  createCustomModels(provider, modelIds) {
    return modelIds.map((modelId) => ({
      id: modelId,
      name: modelId,
      provider: provider.name.toLowerCase(),
      isFavorite: false,
      context_length: 0,
      capabilities: [],
      pricing: {
        prompt: "0",
        completion: "0",
        image: "0",
        request: "0"
      },
      architecture: {
        modality: "text->text",
        tokenizer: "",
        instruct_type: null
      },
      description: `${provider.name} model`,
      identifier: {
        providerId: provider.name.toLowerCase(),
        modelId,
        displayName: modelId
      }
    }));
  }
  async toggleFavorite(model) {
    const isNowFavorite = !model.isFavorite;
    model.isFavorite = isNowFavorite;
    if (isNowFavorite) {
      this.plugin.settings.favoriteModels.push({
        provider: model.provider,
        modelId: model.id
      });
    } else {
      this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((fav) => !(fav.modelId === model.id && fav.provider === model.provider));
    }
    await this.plugin.saveSettings();
  }
};

// src/main.ts
var SystemSculptPlugin = class extends import_obsidian33.Plugin {
  async onload() {
    try {
      this.settingsManager = new SettingsManager(this);
      await this.settingsManager.loadSettings();
      this.settings = this.settingsManager.getSettings();
      try {
        const registeredExtensions = this.app.viewRegistry.typeByExtension;
        if (!(registeredExtensions == null ? void 0 : registeredExtensions.srt)) {
          this.registerExtensions(["srt"], "markdown");
        }
      } catch (error) {
        console.error("Failed to register .srt extension:", error);
      }
      try {
        this.customProviderService = new CustomProviderService(this);
        this.modelService = ModelService.getInstance(this, this.customProviderService);
        this.aiService = SystemSculptService.getInstance(this.settings, this.app);
        this.transcriptionService = TranscriptionService.getInstance(this);
        this.recorderService = RecorderService.getInstance(this.app, this);
        this.contextMenu = new SystemSculptContextMenu(this.app, this.aiService, this);
        SystemPromptService.setSystemSculptService(this.aiService);
      } catch (error) {
        console.error("Failed to initialize core services:", error);
        throw error;
      }
      this.settingsTab = new SystemSculptSettingTab(this.app, this);
      this.addSettingTab(this.settingsTab);
      try {
        this.licenseManager = new LicenseManager(this, this.app);
        this.tasksService = new TasksService(this);
        this.viewManager = new ViewManager(this, this.app);
        this.commandManager = new CommandManager(this, this.app);
        this.viewManager.initialize();
        this.commandManager.registerCommands();
      } catch (error) {
        console.error("Failed to initialize managers:", error);
        throw error;
      }
      SystemPromptService.initializeCache().catch((error) => {
        console.error("Failed to initialize system prompts cache:", error);
      });
    } catch (error) {
      console.error("Failed to load SystemSculpt plugin:", error);
      throw error;
    }
  }
  async onunload() {
    console.log("SystemSculpt AI plugin unloading...");
    try {
      if (this.settingsTab) {
      }
      if (this.commandManager) {
        const commands = [
          "open-tasks-file",
          "toggle-audio-recorder",
          "open-systemsculpt-chat",
          "open-chat-history",
          "open-systemsculpt-janitor",
          "reload-obsidian",
          "open-systemsculpt-settings",
          "change-chat-model",
          "chat-with-file",
          "suggest-edits",
          "clear-suggested-edits"
        ];
        commands.forEach((id) => {
          this.app.commands.removeCommand(`${this.manifest.id}:${id}`);
        });
      }
      if (this.viewManager) {
        this.viewManager.unloadViews();
      }
      if (this.contextMenu) {
      }
      if (this.recorderService) {
        this.recorderService.unload();
      }
      if (this.transcriptionService) {
        this.transcriptionService.unload();
        TranscriptionService.instance = null;
      }
      if (this.aiService) {
        SystemSculptService.instance = null;
      }
      if (this.modelService) {
        ModelService.instance = null;
      }
      if (this.customProviderService) {
      }
      SystemPromptService.clearCache();
      try {
        const registeredExtensions = this.app.viewRegistry.typeByExtension;
        if (registeredExtensions == null ? void 0 : registeredExtensions.srt) {
          delete registeredExtensions.srt;
        }
      } catch (error) {
        console.error("Failed to unregister .srt extension:", error);
      }
      console.log("SystemSculpt AI plugin unloaded successfully");
    } catch (error) {
      console.error("Error during plugin cleanup:", error);
      throw error;
    }
  }
  async loadData() {
    return super.loadData();
  }
  async saveData(data) {
    return super.saveData(data);
  }
  async saveSettings() {
    await this.settingsManager.saveSettings();
  }
  getRecorderService() {
    return this.recorderService;
  }
  getTranscriptionService() {
    return this.transcriptionService;
  }
  getLicenseManager() {
    return this.licenseManager;
  }
  getSettingsManager() {
    return this.settingsManager;
  }
  getInitialModels() {
    return this.modelService.getModels();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2UudHMiLCAic3JjL3V0aWxzL2Vycm9ycy50cyIsICJzcmMvdXRpbHMvSW1hZ2VQcm9jZXNzb3IudHMiLCAic3JjL2NvbnN0YW50cy9hcGkudHMiLCAic3JjL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2UudHMiLCAic3JjL2NvcmUvdWkvY29tcG9uZW50cy9Mb2FkaW5nSW5kaWNhdG9yLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvQnV0dG9uLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9UZXh0QXJlYU1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9Qb3B1cE1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvTm90aWNlLnRzIiwgInNyYy9jb3JlL3VpL25vdGlmaWNhdGlvbnMudHMiLCAic3JjL2NvcmUvdWkvaW5kZXgudHMiLCAic3JjL2NvbXBvbmVudHMvRmlsZVN1Z2dlc3Rlci50cyIsICJzcmMvbW9kYWxzL1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwudHMiLCAiLi4vbm9kZV9tb2R1bGVzL2RpZmYtbWF0Y2gtcGF0Y2gvaW5kZXguanMiLCAic3JjL21haW4udHMiLCAic3JjL21vZGFscy9TZXR0aW5nc1RhYi50cyIsICJzcmMvdHlwZXMvbGxtLnRzIiwgInNyYy90eXBlcy50cyIsICJzcmMvbW9kYWxzL01vZGVsU2VsZWN0aW9uTW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2UudHMiLCAic3JjL21vZGFscy9Nb2RlbFNlbGVjdGlvbkhlbHBlci50cyIsICJzcmMvbW9kYWxzL0N1c3RvbVByb3ZpZGVyTW9kYWwudHMiLCAic3JjL2NvbXBvbmVudHMvRm9sZGVyU3VnZ2VzdGVyLnRzIiwgInNyYy9tb2RhbHMvU3lzdGVtUHJvbXB0TW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL1JlY29yZGVyU2VydmljZS50cyIsICJzcmMvbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLnRzIiwgInNyYy92aWV3cy9DaGF0Vmlldy50cyIsICJzcmMvc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZS50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9EcmF3ZXJDb21wb25lbnQudHMiLCAic3JjL3ZpZXdzL2NvbXBvbmVudHMvTWVzc2FnZVJlbmRlcmVyLnRzIiwgInNyYy92aWV3cy9jb21wb25lbnRzL0lucHV0SGFuZGxlci50cyIsICJzcmMvc2VydmljZXMvVG9rZW5Db3VudGVyU2VydmljZS50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9GaWxlQ29udGV4dE1hbmFnZXIudHMiLCAic3JjL21vZGFscy9Db250ZXh0U2VsZWN0aW9uTW9kYWwudHMiLCAic3JjL2NvcmUvbGljZW5zZS9MaWNlbnNlQ2hlY2tlci50cyIsICJzcmMvbW9kYWxzL0xvYWRDaGF0TW9kYWwudHMiLCAic3JjL2NvbXBvbmVudHMvU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUudHMiLCAic3JjL21vZGFscy9UZXh0TW9kaWZpY2F0aW9uTW9kYWwudHMiLCAic3JjL2NvcmUvc2V0dGluZ3MvU2V0dGluZ3NNYW5hZ2VyLnRzIiwgInNyYy9jb3JlL2xpY2Vuc2UvTGljZW5zZU1hbmFnZXIudHMiLCAic3JjL21vZGFscy9KYW5pdG9yTW9kYWwudHMiLCAic3JjL2NvcmUvcGx1Z2luL3JpYmJvbnMudHMiLCAic3JjL2NvcmUvcGx1Z2luL3ZpZXdzLnRzIiwgInNyYy9jb3JlL3BsdWdpbi9jb21tYW5kcy50cyIsICJzcmMvZWRpdG9ycy9JbmxpbmVEaWZmRWRpdG9yLnRzIiwgInNyYy9zZXJ2aWNlcy9DdXN0b21Qcm92aWRlclNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1Rhc2tzU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvTW9kZWxTZXJ2aWNlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFByZXNldCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcblxuaW50ZXJmYWNlIFN5c3RlbVByb21wdENhY2hlIHtcbiAgcHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBieUlkOiB7IFtrZXk6IHN0cmluZ106IFN5c3RlbVByb21wdFByZXNldCB9O1xufVxuXG5leHBvcnQgY2xhc3MgU3lzdGVtUHJvbXB0U2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGNhY2hlOiBTeXN0ZW1Qcm9tcHRDYWNoZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDQUNIRV9EVVJBVElPTiA9IDYwICogNjAgKiAxMDAwOyAvLyAxIGhvdXIgaW4gbWlsbGlzZWNvbmRzXG4gIHByaXZhdGUgc3RhdGljIGluaXRQcm9taXNlOiBQcm9taXNlPHZvaWQ+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc3RhdGljIGlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc3RhdGljIHN5c3RlbVNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCkge1xuICAgIC8vIFN0YXJ0IGNhY2hlIGluaXRpYWxpemF0aW9uIGlmIG5vdCBhbHJlYWR5IHN0YXJ0ZWRcbiAgICBpZiAoXG4gICAgICAhU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSAmJlxuICAgICAgIVN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsaXppbmdcbiAgICApIHtcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBzZXRTeXN0ZW1TY3VscHRTZXJ2aWNlKHNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UpIHtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UgPSBzZXJ2aWNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgaXNDYWNoZVZhbGlkKCk6IGJvb2xlYW4ge1xuICAgIGlmICghU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgcmV0dXJuIChcbiAgICAgIG5vdyAtIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUudGltZXN0YW1wIDxcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuQ0FDSEVfRFVSQVRJT05cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlQ2FjaGUocHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10pOiB2b2lkIHtcbiAgICBjb25zdCBieUlkOiB7IFtrZXk6IHN0cmluZ106IFN5c3RlbVByb21wdFByZXNldCB9ID0ge307XG4gICAgcHJvbXB0cy5mb3JFYWNoKChwcm9tcHQpID0+IHtcbiAgICAgIGJ5SWRbcHJvbXB0LmlkXSA9IHByb21wdDtcbiAgICB9KTtcblxuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSB7XG4gICAgICBwcm9tcHRzLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgYnlJZCxcbiAgICB9O1xuICB9XG5cbiAgLy8gSW5pdGlhbGl6ZSBjYWNoZSB3aXRob3V0IGJsb2NraW5nXG4gIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZUNhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlKSB7XG4gICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgICB9XG5cbiAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlN5c3RlbVNjdWxwdFNlcnZpY2Ugbm90IGluaXRpYWxpemVkXCIpKTtcbiAgICB9XG5cbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzSW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gZmV0Y2goXG4gICAgICBgJHtTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzYFxuICAgIClcbiAgICAgIC50aGVuKGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UudXBkYXRlQ2FjaGUoZGF0YS5wcm9tcHRzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbml0aWFsaXppbmcgc3lzdGVtIHByb21wdHMgY2FjaGU6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gQ2xlYXIgdGhlIHByb21pc2Ugc28gd2UgY2FuIHJldHJ5IGxhdGVyXG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgPSBudWxsO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0luaXRpYWxpemluZyA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgfVxuXG4gIC8vIEVuc3VyZSBjYWNoZSBpcyBpbml0aWFsaXplZCBiZWZvcmUgcHJvY2VlZGluZ1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZUNhY2hlSW5pdGlhbGl6ZWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkpIHJldHVybjtcblxuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlKSB7XG4gICAgICBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gIH1cblxuICBhc3luYyBnZXRTeXN0ZW1Qcm9tcHRzKCk6IFByb21pc2U8U3lzdGVtUHJvbXB0UHJlc2V0W10+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVDYWNoZUluaXRpYWxpemVkKCk7XG5cbiAgICAgIC8vIFJldHVybiBjYWNoZWQgZGF0YSBpZiB2YWxpZFxuICAgICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkgJiYgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5wcm9tcHRzO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBjYWNoZSBpcyBpbnZhbGlkIG9yIG1pc3NpbmcsIGZldGNoIGZyZXNoIGRhdGFcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke1N5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHNgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UudXBkYXRlQ2FjaGUoZGF0YS5wcm9tcHRzKTtcbiAgICAgIHJldHVybiBkYXRhLnByb21wdHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgLy8gSWYgY2FjaGUgZXhpc3RzIGJ1dCBleHBpcmVkLCByZXR1cm4gaXQgYXMgZmFsbGJhY2tcbiAgICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlKSB7XG4gICAgICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLnByb21wdHM7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTeXN0ZW1Qcm9tcHRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN5c3RlbVByb21wdFByZXNldCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVDYWNoZUluaXRpYWxpemVkKCk7XG5cbiAgICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgICBpZiAoXG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkgJiZcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8uYnlJZFtpZF1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5ieUlkW2lkXTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgY2FjaGUgaXMgbWlzc2luZyBvciBpbnZhbGlkLCBmZXRjaCBhbGwgcHJvbXB0cyB0byByZWZyZXNoIGNhY2hlXG4gICAgICBhd2FpdCB0aGlzLmdldFN5c3RlbVByb21wdHMoKTtcblxuICAgICAgLy8gUmV0dXJuIGZyb20gcmVmcmVzaGVkIGNhY2hlXG4gICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8uYnlJZFtpZF0gfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCAke2lkfTpgLCBlcnJvcik7XG4gICAgICAvLyBGYWxsYmFjayB0byBjYWNoZSBldmVuIGlmIGV4cGlyZWRcbiAgICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlPy5ieUlkW2lkXSkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5ieUlkW2lkXTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFN5c3RlbVByb21wdFRlbXBsYXRlKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke1N5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHMvdGVtcGxhdGVgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBkYXRhLnRlbXBsYXRlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gRm9yY2UgcmVmcmVzaCB0aGUgY2FjaGVcbiAgYXN5bmMgcmVmcmVzaENhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSBudWxsO1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgPSBudWxsO1xuICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gIH1cblxuICAvLyBDbGVhciB0aGUgY2FjaGVcbiAgc3RhdGljIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSA9IG51bGw7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSA9IG51bGw7XG4gIH1cbn1cbiIsICJleHBvcnQgY29uc3QgRVJST1JfQ09ERVMgPSB7XG4gIC8vIEF1dGhlbnRpY2F0aW9uIEVycm9yc1xuICBJTlZBTElEX0xJQ0VOU0U6IFwiSU5WQUxJRF9MSUNFTlNFXCIsXG4gIExJQ0VOU0VfRVhQSVJFRDogXCJMSUNFTlNFX0VYUElSRURcIixcbiAgTElDRU5TRV9ESVNBQkxFRDogXCJMSUNFTlNFX0RJU0FCTEVEXCIsXG4gIFBST19SRVFVSVJFRDogXCJQUk9fUkVRVUlSRURcIixcblxuICAvLyBNb2RlbCBFcnJvcnNcbiAgTU9ERUxfVU5BVkFJTEFCTEU6IFwiTU9ERUxfVU5BVkFJTEFCTEVcIixcbiAgTU9ERUxfUkVRVUVTVF9FUlJPUjogXCJNT0RFTF9SRVFVRVNUX0VSUk9SXCIsXG5cbiAgLy8gU3RyZWFtIEVycm9yc1xuICBTVFJFQU1fRVJST1I6IFwiU1RSRUFNX0VSUk9SXCIsXG4gIElOVkFMSURfUkVTUE9OU0U6IFwiSU5WQUxJRF9SRVNQT05TRVwiLFxuICBOT19JTUFHRTogXCJOT19JTUFHRVwiLFxuXG4gIC8vIEZpbGUgUHJvY2Vzc2luZyBFcnJvcnNcbiAgRklMRV9OT1RfRk9VTkQ6IFwiRklMRV9OT1RfRk9VTkRcIixcbiAgRklMRV9UT09fTEFSR0U6IFwiRklMRV9UT09fTEFSR0VcIixcbiAgVU5TVVBQT1JURURfRk9STUFUOiBcIlVOU1VQUE9SVEVEX0ZPUk1BVFwiLFxuICBQUk9DRVNTSU5HX0VSUk9SOiBcIlBST0NFU1NJTkdfRVJST1JcIixcblxuICAvLyBHZW5lcmljIEVycm9yc1xuICBVTktOT1dOX0VSUk9SOiBcIlVOS05PV05fRVJST1JcIixcbiAgUVVPVEFfRVhDRUVERUQ6IFwiUVVPVEFfRVhDRUVERURcIixcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIEVycm9yQ29kZSA9ICh0eXBlb2YgRVJST1JfQ09ERVMpW2tleW9mIHR5cGVvZiBFUlJPUl9DT0RFU107XG5cbnR5cGUgRXJyb3JNZXNzYWdlRnVuY3Rpb24gPSAobW9kZWw/OiBzdHJpbmcpID0+IHN0cmluZztcbnR5cGUgRXJyb3JNZXNzYWdlVmFsdWUgPSBzdHJpbmcgfCBFcnJvck1lc3NhZ2VGdW5jdGlvbjtcblxuZXhwb3J0IGNvbnN0IEVSUk9SX01FU1NBR0VTOiBSZWNvcmQ8RXJyb3JDb2RlLCBFcnJvck1lc3NhZ2VWYWx1ZT4gPSB7XG4gIFtFUlJPUl9DT0RFUy5JTlZBTElEX0xJQ0VOU0VdOlxuICAgIFwiSW52YWxpZCBsaWNlbnNlIGtleS4gUGxlYXNlIGNoZWNrIGFuZCB0cnkgYWdhaW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5MSUNFTlNFX0VYUElSRURdOiBcIllvdXIgbGljZW5zZSBoYXMgZXhwaXJlZC5cIixcbiAgW0VSUk9SX0NPREVTLkxJQ0VOU0VfRElTQUJMRURdOiBcIlRoaXMgbGljZW5zZSBoYXMgYmVlbiBkaXNhYmxlZC5cIixcbiAgW0VSUk9SX0NPREVTLlBST19SRVFVSVJFRF06XG4gICAgXCJUaGlzIGZlYXR1cmUgcmVxdWlyZXMgYSBQcm8gc3Vic2NyaXB0aW9uLiBQbGVhc2UgdXBncmFkZS5cIixcbiAgW0VSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFXTogKG1vZGVsPzogc3RyaW5nKSA9PlxuICAgIGBNb2RlbCAke21vZGVsIHx8IFwiXCJ9IGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZS5gLFxuICBbRVJST1JfQ09ERVMuTU9ERUxfUkVRVUVTVF9FUlJPUl06IChtb2RlbD86IHN0cmluZykgPT5cbiAgICBgTW9kZWwgJHttb2RlbCB8fCBcIlwifSBjYW5ub3QgcHJvY2VzcyB0aGlzIHJlcXVlc3QuYCxcbiAgW0VSUk9SX0NPREVTLlNUUkVBTV9FUlJPUl06IFwiU3RyZWFtaW5nIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIixcbiAgW0VSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0VdOlxuICAgIFwiSW52YWxpZCByZXNwb25zZSByZWNlaXZlZCBmcm9tIHNlcnZlci4gUGxlYXNlIHRyeSBhZ2Fpbi5cIixcbiAgW0VSUk9SX0NPREVTLlVOS05PV05fRVJST1JdOlxuICAgIFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQuXCIsXG4gIFtFUlJPUl9DT0RFUy5RVU9UQV9FWENFRURFRF06XG4gICAgXCJZb3UgaGF2ZSBleGNlZWRlZCB5b3VyIHF1b3RhLiBQbGVhc2UgdXBncmFkZSB5b3VyIHBsYW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5OT19JTUFHRV06IFwiTm8gaW1hZ2UgaW4gY2xpcGJvYXJkXCIsXG4gIFtFUlJPUl9DT0RFUy5GSUxFX05PVF9GT1VORF06IFwiRmlsZSBub3QgZm91bmRcIixcbiAgW0VSUk9SX0NPREVTLkZJTEVfVE9PX0xBUkdFXTogXCJGaWxlIHRvbyBsYXJnZSAobWF4IDEwTUIpXCIsXG4gIFtFUlJPUl9DT0RFUy5VTlNVUFBPUlRFRF9GT1JNQVRdOiBcIlVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0XCIsXG4gIFtFUlJPUl9DT0RFUy5QUk9DRVNTSU5HX0VSUk9SXTogXCJGYWlsZWQgdG8gcHJvY2VzcyBmaWxlXCIsXG59O1xuXG5leHBvcnQgY2xhc3MgU3lzdGVtU2N1bHB0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgY29kZTogRXJyb3JDb2RlID0gRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUixcbiAgICBwdWJsaWMgc3RhdHVzQ29kZTogbnVtYmVyID0gNTAwLFxuICAgIHB1YmxpYyBtZXRhZGF0YT86IHtcbiAgICAgIHByb3ZpZGVyPzogc3RyaW5nO1xuICAgICAgbW9kZWw/OiBzdHJpbmc7XG4gICAgICBzaG91bGRSZXN1Ym1pdD86IGJvb2xlYW47XG4gICAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgfVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIlN5c3RlbVNjdWxwdEVycm9yXCI7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShjb2RlOiBFcnJvckNvZGUsIG1vZGVsPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbWVzc2FnZSA9IEVSUk9SX01FU1NBR0VTW2NvZGVdO1xuICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiBtZXNzYWdlKG1vZGVsKTtcbiAgfVxuICByZXR1cm4gbWVzc2FnZTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuL2Vycm9yc1wiO1xuXG5leHBvcnQgY2xhc3MgSW1hZ2VQcm9jZXNzb3Ige1xuICBwcml2YXRlIHN0YXRpYyBNQVhfRklMRV9TSVpFID0gMTAgKiAxMDI0ICogMTAyNDsgXG4gIHByaXZhdGUgc3RhdGljIFNVUFBPUlRFRF9GT1JNQVRTID0gbmV3IFNldChbXG4gICAgXCJqcGdcIixcbiAgICBcImpwZWdcIixcbiAgICBcInBuZ1wiLFxuICAgIFwiZ2lmXCIsXG4gICAgXCJ3ZWJwXCIsXG4gIF0pO1xuXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzSW1hZ2UoZmlsZTogVEZpbGUsIGFwcDogQXBwKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcIkZpbGUgbm90IGZvdW5kXCIsIFwiRklMRV9OT1RfRk9VTkRcIiwgNDA0KTtcbiAgICB9XG5cbiAgICBcbiAgICBpZiAoZmlsZS5zdGF0LnNpemUgPiBJbWFnZVByb2Nlc3Nvci5NQVhfRklMRV9TSVpFKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiSW1hZ2UgdG9vIGxhcmdlIChtYXggMTBNQilcIixcbiAgICAgICAgXCJGSUxFX1RPT19MQVJHRVwiLFxuICAgICAgICA0MTNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgXG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoIUltYWdlUHJvY2Vzc29yLlNVUFBPUlRFRF9GT1JNQVRTLmhhcyhleHRlbnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiVW5zdXBwb3J0ZWQgaW1hZ2UgZm9ybWF0XCIsXG4gICAgICAgIFwiVU5TVVBQT1JURURfRk9STUFUXCIsXG4gICAgICAgIDQxNVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgXG4gICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuXG4gICAgICBcbiAgICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGRhdGFVcmwgPSByZWFkZXIucmVzdWx0IGFzIHN0cmluZztcbiAgICAgICAgICByZXNvbHZlKGRhdGFVcmwpO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChyZWFkZXIuZXJyb3IpO1xuXG4gICAgICAgIFxuICAgICAgICBjb25zdCB0eXBlID0gYGltYWdlLyR7ZXh0ZW5zaW9uID09PSBcImpwZ1wiID8gXCJqcGVnXCIgOiBleHRlbnNpb259YDtcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHsgdHlwZSB9KTtcblxuICAgICAgICBcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGJhc2U2NDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkltYWdlIHByb2Nlc3NpbmcgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiRmFpbGVkIHRvIHByb2Nlc3MgaW1hZ2VcIixcbiAgICAgICAgXCJQUk9DRVNTSU5HX0VSUk9SXCIsXG4gICAgICAgIDUwMFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgcHJvY2Vzc0NsaXBib2FyZEltYWdlKFxuICAgIGNsaXBib2FyZERhdGE6IERhdGFUcmFuc2ZlclxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZpbGUgPSBjbGlwYm9hcmREYXRhLmZpbGVzWzBdO1xuICAgIGlmICghZmlsZSB8fCAhZmlsZS50eXBlLnN0YXJ0c1dpdGgoXCJpbWFnZS9cIikpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcIk5vIGltYWdlIGluIGNsaXBib2FyZFwiLCBcIk5PX0lNQUdFXCIsIDQwMCk7XG4gICAgfVxuXG4gICAgaWYgKGZpbGUuc2l6ZSA+IHRoaXMuTUFYX0ZJTEVfU0laRSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIkltYWdlIHRvbyBsYXJnZSAobWF4IDEwTUIpXCIsXG4gICAgICAgIFwiRklMRV9UT09fTEFSR0VcIixcbiAgICAgICAgNDEzXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCBhcyBzdHJpbmcpO1xuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiByZWplY3QocmVhZGVyLmVycm9yKTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgIH0pO1xuICB9XG59XG4iLCAiLy8gQmFzZSBVUkwgZm9yIEFQSSByZXF1ZXN0c1xuZXhwb3J0IGNvbnN0IEFQSV9CQVNFX1VSTCA9XG4gIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIlxuICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjMwMDEvYXBpL3YxXCJcbiAgICA6IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbS9hcGkvdjFcIjtcblxuZXhwb3J0IGNvbnN0IFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTID0ge1xuICBMSUNFTlNFOiB7XG4gICAgVkFMSURBVEU6IChrZXk6IHN0cmluZykgPT4gYC9hcGkvdjEvbGljZW5zZS92YWxpZGF0ZS8ke2tleX1gLFxuICB9LFxuICBNT0RFTFM6IHtcbiAgICBMSVNUOiBcIi9hcGkvdjEvbW9kZWxzXCIsXG4gICAgR0VUOiAobW9kZWxJZDogc3RyaW5nKSA9PiBgL2FwaS92MS9tb2RlbHMvJHttb2RlbElkfWAsXG4gIH0sXG4gIENIQVQ6IHtcbiAgICBDT01QTEVUSU9OUzogXCIvYXBpL3YxL2NoYXQvY29tcGxldGlvbnNcIixcbiAgfSxcbiAgU1lTVEVNX1BST01QVFM6IHtcbiAgICBHRVQ6IChpZDogc3RyaW5nKSA9PiBgL2FwaS92MS9zeXN0ZW0tcHJvbXB0cy8ke2lkfWAsXG4gICAgTElTVDogXCIvYXBpL3YxL3N5c3RlbS1wcm9tcHRzXCIsXG4gIH0sXG4gIERPQ1VNRU5UUzoge1xuICAgIFBST0NFU1M6IFwiL2FwaS92MS9kb2N1bWVudHMvcHJvY2Vzc1wiLFxuICAgIEdFVDogKGlkOiBzdHJpbmcpID0+IGAvYXBpL3YxL2RvY3VtZW50cy8ke2lkfWAsXG4gICAgRE9XTkxPQUQ6IChpZDogc3RyaW5nKSA9PiBgL2FwaS92MS9kb2N1bWVudHMvJHtpZH0vZG93bmxvYWRgLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IE9QRU5ST1VURVJfQVBJX0VORFBPSU5UUyA9IHtcbiAgQ0hBVDoge1xuICAgIENPTVBMRVRJT046IFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gICAgTU9ERUxTOiBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvbW9kZWxzXCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQVBJX0VORFBPSU5UUyA9IHtcbiAgQ0hBVDoge1xuICAgIENPTVBMRVRJT046IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3YxL2NoYXQvY29tcGxldGlvbnNcIixcbiAgICBNT0RFTFM6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3YxL21vZGVsc1wiLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGludGVyZmFjZSBBcGlFcnJvckRldGFpbHMge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNvZGU6IHN0cmluZztcbiAgc3RhdHVzQ29kZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaVJlc3BvbnNlPFQ+IHtcbiAgc3RhdHVzOiBcInN1Y2Nlc3NcIiB8IFwiZXJyb3JcIjtcbiAgZGF0YTogVCB8IG51bGw7XG4gIGVycm9yPzogQXBpRXJyb3JEZXRhaWxzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExpY2Vuc2VWYWxpZGF0aW9uUmVzcG9uc2Uge1xuICBlbWFpbDogc3RyaW5nO1xuICBjcmVkaXRzX2JhbGFuY2U6IG51bWJlcjtcbiAgc3Vic2NyaXB0aW9uX3N0YXR1czogc3RyaW5nO1xuICBsaWNlbnNlX2tleTogc3RyaW5nO1xuICBpc19wcm86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9rZW5CYWxhbmNlUmVzcG9uc2Uge1xuICBiYWxhbmNlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tvdXRSZXNwb25zZSB7XG4gIGNoZWNrb3V0VXJsOiBzdHJpbmc7XG4gIHNlc3Npb25JZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9wZW5Sb3V0ZXJDb21wbGV0aW9uUmVzcG9uc2Uge1xuICBpZDogc3RyaW5nO1xuICBjaG9pY2VzOiBBcnJheTx7XG4gICAgbWVzc2FnZToge1xuICAgICAgcm9sZTogc3RyaW5nO1xuICAgICAgY29udGVudDogc3RyaW5nO1xuICAgIH07XG4gICAgZmluaXNoX3JlYXNvbjogc3RyaW5nO1xuICB9Pjtcbn1cblxuZXhwb3J0IGNvbnN0IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyA9IHtcbiAgREVGQVVMVDoge1xuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxuICBXSVRIX0xJQ0VOU0U6IChsaWNlbnNlS2V5OiBzdHJpbmcpID0+ICh7XG4gICAgLi4uU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLkRFRkFVTFQsXG4gICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2xpY2Vuc2VLZXl9YCxcbiAgfSksXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgT1BFTlJPVVRFUl9BUElfSEVBREVSUyA9IHtcbiAgREVGQVVMVDogKGFwaUtleTogc3RyaW5nKSA9PiAoe1xuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthcGlLZXl9YCxcbiAgICBcIkhUVFAtUmVmZXJlclwiOiBcImh0dHBzOi8vc3lzdGVtc2N1bHB0LmNvbVwiLFxuICAgIFwiWC1UaXRsZVwiOiBcIlN5c3RlbVNjdWxwdCBBUElcIixcbiAgfSksXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQVBJX0hFQURFUlMgPSB7XG4gIERFRkFVTFQ6IHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0gYXMgY29uc3Q7XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgcmVxdWVzdFVybCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIENoYXRNZXNzYWdlLFxuICBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bmssXG4gIFN5c3RlbVNjdWxwdFNldHRpbmdzLFxuICBDdXN0b21Qcm92aWRlcixcbn0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQge1xuICBTeXN0ZW1TY3VscHRFcnJvcixcbiAgRVJST1JfQ09ERVMsXG4gIEVycm9yQ29kZSxcbiAgZ2V0RXJyb3JNZXNzYWdlLFxufSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBJbWFnZVByb2Nlc3NvciB9IGZyb20gXCIuLi91dGlscy9JbWFnZVByb2Nlc3NvclwiO1xuaW1wb3J0IHtcbiAgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMsXG4gIFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyxcbiAgTGljZW5zZVZhbGlkYXRpb25SZXNwb25zZSxcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcblxuZnVuY3Rpb24gZ2VuZXJhdGVVVUlEKCk6IHN0cmluZyB7XG4gIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcbiAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwO1xuICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICB9KTtcbn1cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdFNlcnZpY2Uge1xuICBwcml2YXRlIGxpY2Vuc2VLZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHN0YXRpYyBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gIHByaXZhdGUgaXNJbnNpZGVUaGlua1RhZ3MgPSBmYWxzZTtcbiAgcHJpdmF0ZSBoYXNMb2dnZWREZXZNb2RlID0gZmFsc2U7IC8vIFRyYWNrIGlmIHdlJ3ZlIGxvZ2dlZCBkZXYgbW9kZSBzdGF0dXNcblxuICBwdWJsaWMgZ2V0IGJhc2VVcmwoKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IGxvZyBkZXYgbW9kZSBzdGF0dXMgb25jZVxuICAgIGlmICghdGhpcy5oYXNMb2dnZWREZXZNb2RlKSB7XG4gICAgICB0aGlzLmhhc0xvZ2dlZERldk1vZGUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIElmIGluIGRldmVsb3BtZW50IG1vZGUsIHVzZSBzZXJ2ZXJVcmwgKHdoaWNoIGRlZmF1bHRzIHRvIGxvY2FsaG9zdDozMDAxKVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Muc2VydmVyVXJsO1xuICAgIH1cblxuICAgIC8vIEluIHByb2R1Y3Rpb24sIHVzZSB0aGUgcHJvZHVjdGlvbiBVUkxcbiAgICByZXR1cm4gXCJodHRwczovL2FwaS5zeXN0ZW1zY3VscHQuY29tXCI7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGV4dHJhY3Rpb25zRGlyZWN0b3J5KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3MuZXh0cmFjdGlvbnNEaXJlY3RvcnkgPz8gXCJcIjtcbiAgfVxuXG4gIHByaXZhdGUgY29uc3RydWN0b3Ioc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzLCBhcHA6IEFwcCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLmxpY2Vuc2VLZXkgPSBzZXR0aW5ncy5saWNlbnNlS2V5O1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyxcbiAgICBhcHA6IEFwcFxuICApOiBTeXN0ZW1TY3VscHRTZXJ2aWNlIHtcbiAgICBpZiAoIVN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgU3lzdGVtU2N1bHB0U2VydmljZShzZXR0aW5ncywgYXBwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZS5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZS5saWNlbnNlS2V5ID0gc2V0dGluZ3MubGljZW5zZUtleTtcbiAgICB9XG4gICAgcmV0dXJuIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlU2V0dGluZ3Moc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzKTogdm9pZCB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMubGljZW5zZUtleSA9IHNldHRpbmdzLmxpY2Vuc2VLZXk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG1ha2VSZXF1ZXN0PFQ+KFxuICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgbWV0aG9kPzogc3RyaW5nO1xuICAgICAgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gICAgICBib2R5Pzogc3RyaW5nO1xuICAgICAgc2hvd05vdGljZXM/OiBib29sZWFuO1xuICAgICAgcmVxdWlyZXNQcm8/OiBib29sZWFuO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBpZiAob3B0aW9ucy5yZXF1aXJlc1BybyAmJiAhZW5kcG9pbnQuaW5jbHVkZXMoXCIvbGljZW5zZS92YWxpZGF0ZVwiKSkge1xuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaWNlbnNlKHRydWUpO1xuICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuUFJPX1JFUVVJUkVEKSxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5QUk9fUkVRVUlSRUQsXG4gICAgICAgICAgNDAzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaGVhZGVycyA9IHRoaXMubGljZW5zZUtleVxuICAgICAgPyBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSlcbiAgICAgIDogU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLkRFRkFVTFQ7XG5cbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9JHtlbmRwb2ludH1gO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7XG4gICAgICB1cmwsXG4gICAgICBtZXRob2Q6IG9wdGlvbnMubWV0aG9kIHx8IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLmhlYWRlcnMsXG4gICAgICAgIC4uLihvcHRpb25zLmhlYWRlcnMgfHwge30pLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IG9wdGlvbnMuYm9keSxcbiAgICAgIHRocm93OiBmYWxzZSxcbiAgICB9KTtcblxuICAgIGxldCBhcGlSZXNwb25zZTogYW55O1xuICAgIHRyeSB7XG4gICAgICBhcGlSZXNwb25zZSA9IHJlc3BvbnNlLmpzb247XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRSksXG4gICAgICAgIEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UsXG4gICAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgfHwgYXBpUmVzcG9uc2Uuc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgIHRoaXMuaGFuZGxlQXBpRXJyb3IoZW5kcG9pbnQsIHJlc3BvbnNlLCBhcGlSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIHJlc3BvbnNlIGlzIHdyYXBwZWQgaW4gYSBkYXRhIGZpZWxkLCByZXR1cm4gdGhhdCwgb3RoZXJ3aXNlIHJldHVybiB0aGUgd2hvbGUgcmVzcG9uc2VcbiAgICByZXR1cm4gKFxuICAgICAgYXBpUmVzcG9uc2UuZGF0YSAhPT0gdW5kZWZpbmVkID8gYXBpUmVzcG9uc2UuZGF0YSA6IGFwaVJlc3BvbnNlXG4gICAgKSBhcyBUO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVBcGlFcnJvcihcbiAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgIHJlc3BvbnNlOiB7IHN0YXR1czogbnVtYmVyIH0sXG4gICAgYXBpUmVzcG9uc2U6IGFueVxuICApOiBuZXZlciB7XG4gICAgaWYgKGFwaVJlc3BvbnNlLmVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvckNvZGUgPSAoYXBpUmVzcG9uc2UuZXJyb3IuY29kZSB8fFxuICAgICAgICBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SKSBhcyBFcnJvckNvZGU7XG4gICAgICBjb25zdCBzdGF0dXNDb2RlID0gYXBpUmVzcG9uc2UuZXJyb3Iuc3RhdHVzQ29kZSB8fCByZXNwb25zZS5zdGF0dXM7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBhcGlSZXNwb25zZS5lcnJvci5tb2RlbCk7XG5cbiAgICAgIGNvbnN0IG1ldGFkYXRhOiBTeXN0ZW1TY3VscHRFcnJvcltcIm1ldGFkYXRhXCJdID0ge307XG5cbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRSB8fFxuICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICkge1xuICAgICAgICBtZXRhZGF0YS5zaG91bGRSZXN1Ym1pdCA9IHRydWU7XG4gICAgICAgIG1ldGFkYXRhLm1vZGVsID0gYXBpUmVzcG9uc2UuZXJyb3IubW9kZWw7XG4gICAgICB9XG5cbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgIHN0YXR1c0NvZGUsXG4gICAgICAgIG1ldGFkYXRhXG4gICAgICApO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SKSxcbiAgICAgIEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IsXG4gICAgICByZXNwb25zZS5zdGF0dXNcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1FcnJvcihcbiAgICByZXNwb25zZTogUmVzcG9uc2UsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8bmV2ZXI+IHtcbiAgICAvLyBMb2cgcmF3IHJlc3BvbnNlIGZpcnN0XG4gICAgY29uc29sZS5lcnJvcihcIlN0cmVhbSBlcnJvciByZXNwb25zZTpcIiwge1xuICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgY29udGVudFR5cGU6IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpLFxuICAgICAgaXNDdXN0b21Qcm92aWRlcixcbiAgICB9KTtcblxuICAgIGxldCBlcnJvckNvZGU6IEVycm9yQ29kZSA9IEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUjtcbiAgICBsZXQgbWV0YWRhdGE6IFN5c3RlbVNjdWxwdEVycm9yW1wibWV0YWRhdGFcIl0gPSB7fTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU3RyZWFtIGVycm9yIGRhdGE6XCIsIGVycm9yRGF0YSk7XG5cbiAgICAgIC8vIEhhbmRsZSBjdXN0b20gcHJvdmlkZXIgZXJyb3JzXG4gICAgICBpZiAoaXNDdXN0b21Qcm92aWRlcikge1xuICAgICAgICAvLyBQcmVzZXJ2ZSByYXcgZXJyb3IgZGF0YVxuICAgICAgICBtZXRhZGF0YS5yYXdFcnJvciA9IGVycm9yRGF0YTtcbiAgICAgICAgbWV0YWRhdGEucHJvdmlkZXIgPSBcImN1c3RvbVwiO1xuXG4gICAgICAgIC8vIENvbW1vbiBlcnJvciBzdGF0dXMgY29kZXMgZm9yIE9wZW5BSS1jb21wYXRpYmxlIEFQSXNcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuSU5WQUxJRF9MSUNFTlNFO1xuICAgICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBcIkludmFsaWQgQVBJIGtleSBmb3IgY3VzdG9tIHByb3ZpZGVyXCIsXG4gICAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MjkpIHtcbiAgICAgICAgICBlcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5RVU9UQV9FWENFRURFRDtcbiAgICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHxcbiAgICAgICAgICAgICAgXCJSYXRlIGxpbWl0IGV4Y2VlZGVkIGZvciBjdXN0b20gcHJvdmlkZXJcIixcbiAgICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgIGVycm9yQ29kZSA9IEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFO1xuICAgICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBcIk1vZGVsIG5vdCBmb3VuZCBvciBlbmRwb2ludCBpbmNvcnJlY3RcIixcbiAgICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZvciBvdGhlciBlcnJvcnMsIHBhc3MgdGhyb3VnaCB0aGUgcHJvdmlkZXIncyBlcnJvciBtZXNzYWdlXG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvckRhdGEuZXJyb3IpIHtcbiAgICAgICAgZXJyb3JDb2RlID0gKGVycm9yRGF0YS5lcnJvci5jb2RlIHx8XG4gICAgICAgICAgRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SKSBhcyBFcnJvckNvZGU7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICAgKSB7XG4gICAgICAgICAgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgICBtb2RlbDogZXJyb3JEYXRhLmVycm9yLm1vZGVsLFxuICAgICAgICAgICAgc2hvdWxkUmVzdWJtaXQ6IHRydWUsXG4gICAgICAgICAgICByYXdFcnJvcjogZXJyb3JEYXRhLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBMb2cgcGFyc2UgZXJyb3JcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwYXJzaW5nIGVycm9yIHJlc3BvbnNlOlwiLCBlKTtcblxuICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIGVycm9yIHJlc3BvbnNlIG9yIGl0J3MgYWxyZWFkeSBhIFN5c3RlbVNjdWxwdEVycm9yLCB0aHJvdyBpdFxuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvcikge1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlIHVzZSBkZWZhdWx0IHN0cmVhbSBlcnJvclxuICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgIGdldEVycm9yTWVzc2FnZShlcnJvckNvZGUsIG1ldGFkYXRhLm1vZGVsKSxcbiAgICAgIGVycm9yQ29kZSxcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIG1ldGFkYXRhXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlTGljZW5zZShmb3JjZUNoZWNrID0gZmFsc2UpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMubGljZW5zZUtleSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8TGljZW5zZVZhbGlkYXRpb25SZXNwb25zZT4oXG4gICAgICAgIFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkxJQ0VOU0UuVkFMSURBVEUodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSksXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCByZWd1bGFyIG1vZGVsc1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PHsgbW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdIH0+KFxuICAgICAgICBcIi9hcGkvdjEvbW9kZWxzXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmICghcmVzcG9uc2UgfHwgIUFycmF5LmlzQXJyYXkocmVzcG9uc2UubW9kZWxzKSkge1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UpLFxuICAgICAgICAgIEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UsXG4gICAgICAgICAgNTAwXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBwcm92aWRlciB0byBzeXN0ZW1zY3VscHQgZm9yIG91ciBtb2RlbHNcbiAgICAgIGNvbnN0IHN5c3RlbXNjdWxwdE1vZGVscyA9IHJlc3BvbnNlLm1vZGVscy5tYXAoKG1vZGVsKSA9PiAoe1xuICAgICAgICAuLi5tb2RlbCxcbiAgICAgICAgcHJvdmlkZXI6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFJldHVybiBvbmx5IHN5c3RlbSBtb2RlbHNcbiAgICAgIHJldHVybiBzeXN0ZW1zY3VscHRNb2RlbHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFRva2VuQmFsYW5jZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGljZW5zZSh0cnVlKTtcbiAgICBpZiAoIWlzVmFsaWQpIHJldHVybiAwO1xuXG4gICAgLy8gcmUtdmFsaWRhdGUgdG8gZ2V0IGZyZXNoIGxpY2Vuc2UgZGF0YVxuICAgIGNvbnN0IGxpY2Vuc2VJbmZvID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDxMaWNlbnNlVmFsaWRhdGlvblJlc3BvbnNlPihcbiAgICAgIFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkxJQ0VOU0UuVkFMSURBVEUodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICBoZWFkZXJzOiBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuV0lUSF9MSUNFTlNFKHRoaXMubGljZW5zZUtleSksXG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gbGljZW5zZUluZm8uY3JlZGl0c19iYWxhbmNlIHx8IDA7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldENvbnRleHRGaWxlQ29udGVudHMoXG4gICAgZmlsZVBhdGg6IHN0cmluZ1xuICApOiBQcm9taXNlPHN0cmluZyB8IG51bGwgfCB7IHR5cGU6IFwiaW1hZ2VcIjsgYmFzZTY0OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhbiB0aGUgd2lraS1saW5rIGZvcm1hdDogW1twYXRoXV0gLT4gcGF0aFxuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcblxuICAgICAgLy8gUmVtb3ZlIGFueSBtYXRoIGRpc3BsYXkgbWFya2VycyBpZiBwcmVzZW50XG4gICAgICBjb25zdCBjbGVhblBhdGggPSBsaW5rVGV4dC5yZXBsYWNlKFxuICAgICAgICAvXFwkYmVnaW46bWF0aDpkaXNwbGF5XFwkXFxbKC4qPylcXCRlbmQ6bWF0aDpkaXNwbGF5XFwkXS9nLFxuICAgICAgICBcIiQxXCJcbiAgICAgICk7XG5cbiAgICAgIC8vIFRyeSB0byByZXNvbHZlIHRoZSBmaWxlIHVzaW5nIHRoZSBjbGVhbmVkIHBhdGhcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIGNsZWFuUGF0aCxcbiAgICAgICAgXCJcIlxuICAgICAgKTtcblxuICAgICAgaWYgKHJlc29sdmVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGlmIChyZXNvbHZlZEZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9eKGpwZ3xqcGVnfHBuZ3xnaWZ8d2VicCkkL2kpKSB7XG4gICAgICAgICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgSW1hZ2VQcm9jZXNzb3IucHJvY2Vzc0ltYWdlKFxuICAgICAgICAgICAgcmVzb2x2ZWRGaWxlLFxuICAgICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB7IHR5cGU6IFwiaW1hZ2VcIiwgYmFzZTY0IH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQocmVzb2x2ZWRGaWxlKTtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGZpbGUgbm90IGZvdW5kLCB0cnkgcmVzb2x2aW5nIHdpdGhvdXQgdGhlIGZvbGRlciBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gY2xlYW5QYXRoLnNwbGl0KFwiL1wiKS5wb3AoKTtcbiAgICAgIGlmIChmaWxlTmFtZSkge1xuICAgICAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgICAgIGNvbnN0IG1hdGNoaW5nRmlsZSA9IGFsbEZpbGVzLmZpbmQoKGYpID0+IGYubmFtZSA9PT0gZmlsZU5hbWUpO1xuICAgICAgICBpZiAobWF0Y2hpbmdGaWxlKSB7XG4gICAgICAgICAgaWYgKG1hdGNoaW5nRmlsZS5leHRlbnNpb24ubWF0Y2goL14oanBnfGpwZWd8cG5nfGdpZnx3ZWJwKSQvaSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IEltYWdlUHJvY2Vzc29yLnByb2Nlc3NJbWFnZShcbiAgICAgICAgICAgICAgbWF0Y2hpbmdGaWxlLFxuICAgICAgICAgICAgICB0aGlzLmFwcFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6IFwiaW1hZ2VcIiwgYmFzZTY0IH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKG1hdGNoaW5nRmlsZSk7XG4gICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYnVpbGRDb250ZXh0TWVzc2FnZUZyb21GaWxlKFxuICAgIGZpbGVQYXRoOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxDaGF0TWVzc2FnZSB8IG51bGw+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0RmlsZUNvbnRlbnRzKGZpbGVQYXRoKTtcbiAgICBjb25zdCBkaXNwbGF5TmFtZSA9IGZpbGVQYXRoLnJlcGxhY2UoXG4gICAgICAvXFwkYmVnaW46bWF0aDpkaXNwbGF5XFwkXFxbKC4qPylcXCRlbmQ6bWF0aDpkaXNwbGF5XFwkXS9nLFxuICAgICAgXCIkMVwiXG4gICAgKTtcblxuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBgQ29udGV4dCBmcm9tICR7ZGlzcGxheU5hbWV9OlxcblxcbiR7Y29udGVudH1gLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmIChjb250ZW50LnR5cGUgPT09IFwiaW1hZ2VcIikge1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYSBcInR5cGU6aW1hZ2VfdXJsXCIgYXJyYXkgZW50cnk6XG4gICAgICAgIC8vIE9wdGlvbmFsbHkgcHJlZml4IHdpdGggYSBcInR5cGU6dGV4dFwiIGVudHJ5IGZvciBhbnkgbGFiZWwgb3IgbWVudGlvbiBvZiB0aGUgZmlsZVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgIHRleHQ6IGBDb250ZXh0IGZyb20gJHtkaXNwbGF5TmFtZX06XFxuXFxuYCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwiaW1hZ2VfdXJsXCIsXG4gICAgICAgICAgICAgIGltYWdlX3VybDoge1xuICAgICAgICAgICAgICAgIC8vIElmIHBvc3NpYmxlLCBwcmVmaXggd2l0aCBkYXRhOmltYWdlLzxleHQ+XG4gICAgICAgICAgICAgICAgdXJsOiBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7Y29udGVudC5iYXNlNjQucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgIC9eZGF0YTouKjtiYXNlNjQsLyxcbiAgICAgICAgICAgICAgICAgIFwiXCJcbiAgICAgICAgICAgICAgICApfWAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWVzc2FnZV9pZDogZ2VuZXJhdGVVVUlEKCksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcmVwYXJlTWVzc2FnZXNXaXRoQ29udGV4dChcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICBjb250ZXh0RmlsZXM6IFNldDxzdHJpbmc+LFxuICAgIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmcsXG4gICAgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZ1xuICApOiBQcm9taXNlPENoYXRNZXNzYWdlW10+IHtcbiAgICBjb25zdCBwcmVwYXJlZE1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW107XG5cbiAgICAvLyBBZGQgc3lzdGVtIG1lc3NhZ2UgZmlyc3RcbiAgICBsZXQgc3lzdGVtUHJvbXB0Q29udGVudDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGlmIChzeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHN5c3RlbVByb21wdFBhdGgpIHtcbiAgICAgIC8vIEZvciBjdXN0b20gcHJvbXB0cywgcmVhZCBmcm9tIHRoZSBmaWxlXG4gICAgICAvLyBUcnkgdG8gcmVzb2x2ZSB0aGUgZmlsZSB1c2luZyB0aGUgY2xlYW5lZCBwYXRoXG4gICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQocmVzb2x2ZWRGaWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIG5vdCBmb3VuZCwgdHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICBjb25zdCBmaWxlV2l0aEV4dCA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgICBgJHtzeXN0ZW1Qcm9tcHRQYXRofS5tZGBcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGZpbGVXaXRoRXh0IGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlV2l0aEV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVHJ5IGluIHRoZSBzeXN0ZW0gcHJvbXB0cyBkaXJlY3RvcnlcbiAgICAgICAgICBjb25zdCBmaWxlSW5TeXN0ZW1Qcm9tcHRzRGlyID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAgICAgYFN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0cy8ke3N5c3RlbVByb21wdFBhdGh9Lm1kYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGZpbGVJblN5c3RlbVByb21wdHNEaXIgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoXG4gICAgICAgICAgICAgIGZpbGVJblN5c3RlbVByb21wdHNEaXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzeXN0ZW1Qcm9tcHRUeXBlKSB7XG4gICAgICAvLyBGb3Igbm9uLWN1c3RvbSBwcm9tcHRzLCBmZXRjaCBmcm9tIHNlcnZlclxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0U2VydmljZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKHRoaXMuYXBwKTtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gYXdhaXQgc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKFxuICAgICAgICAgIHN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgZXJyb3IgYW5kIGNvbnRpbnVlIHdpdGhvdXQgc3lzdGVtIHByb21wdFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCBzeXN0ZW0gbWVzc2FnZSBpZiB3ZSBoYXZlIGNvbnRlbnRcbiAgICBpZiAoc3lzdGVtUHJvbXB0Q29udGVudCkge1xuICAgICAgcHJlcGFyZWRNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgY29udGVudDogc3lzdGVtUHJvbXB0Q29udGVudCxcbiAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgY29udGV4dCBmaWxlcyBhbmQgY29sbGVjdCBkb2N1bWVudCBJRHMgZm9yIHRoZSBzZXJ2ZXJcbiAgICBjb25zdCBkb2N1bWVudElkczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIGRvY3VtZW50IHJlZmVyZW5jZSAoc3RhcnRzIHdpdGggXCJkb2M6XCIpXG4gICAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIHtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IGZpbGVQYXRoLnN1YnN0cmluZyg0KTtcbiAgICAgICAgZG9jdW1lbnRJZHMucHVzaChkb2N1bWVudElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSByZWd1bGFyIGZpbGUgY29udGV4dHMgYXMgYmVmb3JlXG4gICAgICAgIGNvbnN0IGNvbnRleHRNZXNzYWdlID0gYXdhaXQgdGhpcy5idWlsZENvbnRleHRNZXNzYWdlRnJvbUZpbGUoZmlsZVBhdGgpO1xuICAgICAgICBpZiAoY29udGV4dE1lc3NhZ2UpIHtcbiAgICAgICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goY29udGV4dE1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGRvY3VtZW50IGNvbnRleHQgdG8gdGhlIGZpcnN0IG1lc3NhZ2UgaWYgd2UgaGF2ZSBkb2N1bWVudCBJRHNcbiAgICBpZiAoZG9jdW1lbnRJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmlyc3RNZXNzYWdlID0gbWVzc2FnZXNbMF07XG4gICAgICBpZiAoZmlyc3RNZXNzYWdlKSB7XG4gICAgICAgIGZpcnN0TWVzc2FnZS5kb2N1bWVudENvbnRleHQgPSB7IGRvY3VtZW50SWRzIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBhY3R1YWwgY2hhdCBtZXNzYWdlc1xuICAgIGZvciAoY29uc3QgbXNnIG9mIG1lc3NhZ2VzKSB7XG4gICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goe1xuICAgICAgICByb2xlOiBtc2cucm9sZSxcbiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IG1zZy5tZXNzYWdlX2lkIHx8IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICBkb2N1bWVudENvbnRleHQ6IG1zZy5kb2N1bWVudENvbnRleHQsXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGU6IG1zZy5zeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoOiBtc2cuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBwcmVwYXJlZE1lc3NhZ2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVEYXRhUHJlZml4KGxpbmU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFsaW5lPy50cmltKCkpIHJldHVybiBcIlwiO1xuICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgIC8vIFNraXAgc3BlY2lhbCBtZXNzYWdlc1xuICAgIGlmIChcbiAgICAgIHRyaW1tZWQgPT09IFwiZGF0YTpcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJkYXRhOiBcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJbRE9ORV1cIiB8fFxuICAgICAgdHJpbW1lZC5zdGFydHNXaXRoKFwiOiBPUEVOUk9VVEVSXCIpXG4gICAgKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJpbW1lZC5yZXBsYWNlKC9eKD86ZGF0YTpcXHMqKSsvLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNWYWxpZFN0cmVhbUV2ZW50KGRhdGE6IHN0cmluZywgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlKTogYm9vbGVhbiB7XG4gICAgaWYgKCFkYXRhKSByZXR1cm4gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIHJldHVybiAhIShcbiAgICAgICAgcGFyc2VkICYmXG4gICAgICAgIChwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fFxuICAgICAgICAgIHBhcnNlZC5jaG9pY2VzPy5bMF0/LmRlbHRhPy5yZWFzb25pbmcgfHxcbiAgICAgICAgICBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uZnVuY3Rpb25fY2FsbCB8fFxuICAgICAgICAgIHBhcnNlZC5lcnJvcilcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc1N0cmVhbUxpbmUoXG4gICAgbGluZTogc3RyaW5nLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoIWxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IHRoaXMubm9ybWFsaXplRGF0YVByZWZpeChsaW5lKTtcbiAgICByZXR1cm4gdGhpcy5pc1ZhbGlkU3RyZWFtRXZlbnQobm9ybWFsaXplZCwgaXNDdXN0b21Qcm92aWRlcilcbiAgICAgID8gbm9ybWFsaXplZFxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1FdmVudChcbiAgICBldmVudDogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8eyBjb250ZW50OiBzdHJpbmcgfCBudWxsOyByZWFzb25pbmc6IHN0cmluZyB8IG51bGwgfSB8IG51bGw+IHtcbiAgICBpZiAoIWV2ZW50KSByZXR1cm4gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFyc2VkOiBTeXN0ZW1TY3VscHRTdHJlYW1DaHVuaztcbiAgICAgIHRyeSB7XG4gICAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoZXZlbnQpO1xuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwYXJzZWQpIHJldHVybiBudWxsO1xuXG4gICAgICAvLyBIYW5kbGUgZXJyb3JzXG4gICAgICBpZiAocGFyc2VkLmVycm9yKSB7XG4gICAgICAgIGNvbnN0IGVycm9yQ29kZSA9IChwYXJzZWQuZXJyb3IuY29kZSB8fFxuICAgICAgICAgIEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUikgYXMgRXJyb3JDb2RlO1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBwYXJzZWQuZXJyb3IubWVzc2FnZSB8fCBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBtb2RlbCk7XG5cbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgc2hvdWxkUmVzdWJtaXQ6IGZhbHNlLFxuICAgICAgICAgIHJhd0Vycm9yOiBwYXJzZWQuZXJyb3IsXG4gICAgICAgICAgb3JpZ2luYWxFdmVudDogZXZlbnQsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICAgKSB7XG4gICAgICAgICAgbWV0YWRhdGEuc2hvdWxkUmVzdWJtaXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgcGFyc2VkLmVycm9yLnN0YXR1c0NvZGUgfHwgNTAwLFxuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fCBudWxsO1xuICAgICAgY29uc3QgcmVhc29uaW5nID0gcGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LnJlYXNvbmluZyB8fCBudWxsO1xuXG4gICAgICAvLyBJZiB3ZSdyZSBpbiB0aGluayBtb2RlLCBhbGwgY29udGVudCBzaG91bGQgYmUgdHJlYXRlZCBhcyByZWFzb25pbmcgdW50aWwgd2Ugc2VlIDwvdGhpbms+XG4gICAgICBpZiAodGhpcy5pc0luc2lkZVRoaW5rVGFncykge1xuICAgICAgICAvLyBDaGVjayBib3RoIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBmb3IgPC90aGluaz5cbiAgICAgICAgbGV0IGNvbWJpbmVkVGV4dCA9IFwiXCI7XG4gICAgICAgIGlmIChyZWFzb25pbmcpIGNvbWJpbmVkVGV4dCArPSByZWFzb25pbmc7XG4gICAgICAgIGlmIChjb250ZW50KSBjb21iaW5lZFRleHQgKz0gY29udGVudDtcblxuICAgICAgICBjb25zdCB0aGlua0VuZE1hdGNoID0gY29tYmluZWRUZXh0Lm1hdGNoKC8oLio/KVxccyo8XFwvdGhpbms+XFxzKiguKikvKTtcbiAgICAgICAgaWYgKHRoaW5rRW5kTWF0Y2gpIHtcbiAgICAgICAgICB0aGlzLmlzSW5zaWRlVGhpbmtUYWdzID0gZmFsc2U7XG4gICAgICAgICAgLy8gRXZlcnl0aGluZyBiZWZvcmUgPC90aGluaz4gaXMgcmVhc29uaW5nLCBldmVyeXRoaW5nIGFmdGVyIGlzIGNvbnRlbnRcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua0VuZE1hdGNoWzFdIHx8IFwiXCIsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlua0VuZE1hdGNoWzJdIHx8IFwiXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIG5vIDwvdGhpbms+IGZvdW5kLCBldmVyeXRoaW5nIGlzIHN0aWxsIHJlYXNvbmluZ1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgcmVhc29uaW5nOiBjb21iaW5lZFRleHQgfHwgbnVsbCxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGNvbnRlbnQgY29udGFpbnMgPHRoaW5rPlxuICAgICAgICBpZiAoY29udGVudCkge1xuICAgICAgICAgIGNvbnN0IHRoaW5rU3RhcnRNYXRjaCA9IGNvbnRlbnQubWF0Y2goLzx0aGluaz5cXHMqKC4qKS8pO1xuICAgICAgICAgIGlmICh0aGlua1N0YXJ0TWF0Y2gpIHtcbiAgICAgICAgICAgIHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY29udGVudDogbnVsbCxcbiAgICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua1N0YXJ0TWF0Y2hbMV0gfHwgXCJcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGNvbnRlbnQsIHJlYXNvbmluZyB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1N0cmVhbUNodW5rKFxuICAgIGNodW5rOiBVaW50OEFycmF5LFxuICAgIGJ1ZmZlcjogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8e1xuICAgIG5ld0J1ZmZlcjogc3RyaW5nO1xuICAgIGNvbnRlbnRzOiBzdHJpbmdbXTtcbiAgICByZWFzb25pbmdzOiBzdHJpbmdbXTtcbiAgfT4ge1xuICAgIGNvbnN0IGRlY29kZWQgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmRlY29kZXIuZGVjb2RlKGNodW5rLCB7IHN0cmVhbTogdHJ1ZSB9KTtcbiAgICBjb25zdCBmdWxsQ2h1bmsgPSBidWZmZXIgKyBkZWNvZGVkO1xuXG4gICAgY29uc3QgbGluZXMgPSBmdWxsQ2h1bmsuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3QgY29udGVudHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgcmVhc29uaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFByb2Nlc3MgYWxsIGxpbmVzIGV4Y2VwdCBwb3RlbnRpYWxseSBpbmNvbXBsZXRlIGxhc3QgbGluZVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICBjb25zdCBldmVudCA9IHRoaXMucHJvY2Vzc1N0cmVhbUxpbmUobGluZXNbaV0sIGlzQ3VzdG9tUHJvdmlkZXIpO1xuICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXZlbnQoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgaXNDdXN0b21Qcm92aWRlclxuICAgICAgICApO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5jb250ZW50KSBjb250ZW50cy5wdXNoKHJlc3VsdC5jb250ZW50KTtcbiAgICAgICAgICBpZiAocmVzdWx0LnJlYXNvbmluZykgcmVhc29uaW5ncy5wdXNoKHJlc3VsdC5yZWFzb25pbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gS2VlcCBsYXN0IGxpbmUgYXMgYnVmZmVyIGlmIG5vbi1lbXB0eVxuICAgIGNvbnN0IG5ld0J1ZmZlciA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLnRyaW0oKVxuICAgICAgPyBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXVxuICAgICAgOiBcIlwiO1xuXG4gICAgcmV0dXJuIHsgbmV3QnVmZmVyLCBjb250ZW50cywgcmVhc29uaW5ncyB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzdHJpcFByb3ZpZGVyUHJlZml4ZXMobW9kZWxJZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IHJlbW92ZSB0aGUgb3BlbnJvdXRlci8gcHJlZml4LCBrZWVwIHRoZSBwcm92aWRlciBpZGVudGlmaWVyXG4gICAgcmV0dXJuIG1vZGVsSWQucmVwbGFjZSgvXm9wZW5yb3V0ZXJcXC8vLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TW9kZWxJbmZvKG1vZGVsSWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlzQ3VzdG9tOiBib29sZWFuO1xuICAgIHByb3ZpZGVyPzogQ3VzdG9tUHJvdmlkZXI7XG4gICAgYWN0dWFsTW9kZWxJZDogc3RyaW5nO1xuICB9PiB7XG4gICAgLy8gRm9yIGN1c3RvbSBwcm92aWRlcnMsIGZpbmQgdGhlIGFjdGl2ZSBvbmVcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci50eXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICBjb25zdCBhY3RpdmVQcm92aWRlciA9IHRoaXMuc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgIChwKSA9PiBwLmlkID09PSB0aGlzLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLmlkICYmIHAuaXNFbmFibGVkXG4gICAgICApO1xuXG4gICAgICBpZiAoIWFjdGl2ZVByb3ZpZGVyKSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBgUHJvdmlkZXIgJHt0aGlzLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLm5hbWV9IG5vdCBmb3VuZCBvciBkaXNhYmxlZGAsXG4gICAgICAgICAgRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUsXG4gICAgICAgICAgNDA0XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQ3VzdG9tOiB0cnVlLFxuICAgICAgICBwcm92aWRlcjogYWN0aXZlUHJvdmlkZXIsXG4gICAgICAgIGFjdHVhbE1vZGVsSWQ6IG1vZGVsSWQsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIE5hdGl2ZSBTeXN0ZW1TY3VscHQgcHJvdmlkZXJcbiAgICByZXR1cm4ge1xuICAgICAgaXNDdXN0b206IGZhbHNlLFxuICAgICAgYWN0dWFsTW9kZWxJZDogdGhpcy5zdHJpcFByb3ZpZGVyUHJlZml4ZXMobW9kZWxJZCksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlQ3VzdG9tUHJvdmlkZXJDb21wbGV0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlcixcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICB0ZW1wZXJhdHVyZTogbnVtYmVyLFxuICAgIG1vZGVsSWQ6IHN0cmluZyxcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbFxuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgY29uc3QgZW5kcG9pbnQgPSBwcm92aWRlci5lbmRwb2ludC50cmltKCkucmVwbGFjZSgvXFwvJC8sIFwiXCIpO1xuICAgIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YCxcbiAgICB9O1xuXG4gICAgLy8gQWRkIE9wZW5Sb3V0ZXIgc3BlY2lmaWMgaGVhZGVycyBpZiBpdCdzIGFuIE9wZW5Sb3V0ZXIgZW5kcG9pbnRcbiAgICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpKSB7XG4gICAgICBoZWFkZXJzW1wiSFRUUC1SZWZlcmVyXCJdID0gXCJodHRwczovL3N5c3RlbXNjdWxwdC5jb21cIjtcbiAgICAgIGhlYWRlcnNbXCJYLVRpdGxlXCJdID0gXCJTeXN0ZW1TY3VscHQgQUlcIjtcbiAgICB9XG5cbiAgICAvLyBCYXNlIHJlcXVlc3QgYm9keVxuICAgIGNvbnN0IGJhc2VSZXF1ZXN0Qm9keSA9IHtcbiAgICAgIG1vZGVsOiBtb2RlbElkLFxuICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzLm1hcCgobXNnKSA9PiAoe1xuICAgICAgICByb2xlOiBtc2cucm9sZSxcbiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsXG4gICAgICB9KSksXG4gICAgICBzdHJlYW06IHRydWUsXG4gICAgfTtcblxuICAgIC8vIEFkZCBwcm92aWRlci1zcGVjaWZpYyBwYXJhbWV0ZXJzXG4gICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XG4gICAgICAuLi5iYXNlUmVxdWVzdEJvZHksXG4gICAgICAvLyBBZGQgdGVtcGVyYXR1cmUgb25seSBmb3Igbm9uLU9wZW5BSSBlbmRwb2ludHNcbiAgICAgIC4uLighZW5kcG9pbnQuaW5jbHVkZXMoXCJhcGkub3BlbmFpLmNvbVwiKSAmJiB7IHRlbXBlcmF0dXJlIH0pLFxuICAgICAgLy8gQWRkIGluY2x1ZGVfcmVhc29uaW5nIGZvciBPcGVuUm91dGVyIGVuZHBvaW50c1xuICAgICAgLi4uKGVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSAmJiB7XG4gICAgICAgIGluY2x1ZGVfcmVhc29uaW5nOiB0cnVlLFxuICAgICAgfSksXG4gICAgICAvLyBBZGQgcmVhc29uaW5nX2VmZm9ydCBmb3IgT3BlbkFJJ3MgbzMtbWluaSBtb2RlbFxuICAgICAgLi4uKGVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIikgJiZcbiAgICAgICAgbW9kZWxJZCA9PT0gXCJvMy1taW5pXCIgJiYge1xuICAgICAgICAgIHJlYXNvbmluZ19lZmZvcnQ6IFwiaGlnaFwiLFxuICAgICAgICB9KSxcbiAgICB9O1xuXG4gICAgLy8gTG9nIHRoZSByZXF1ZXN0IGJvZHkgaWYgaXQncyBPcGVuQUkgYW5kIG8zLW1pbmlcbiAgICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoXCJhcGkub3BlbmFpLmNvbVwiKSAmJiBtb2RlbElkID09PSBcIm8zLW1pbmlcIikge1xuICAgICAgY29uc29sZS5sb2coXCJNYWtpbmcgT3BlbkFJIEFQSSBjYWxsIHdpdGggbzMtbWluaSBtb2RlbDpcIiwge1xuICAgICAgICBlbmRwb2ludCxcbiAgICAgICAgbW9kZWxJZCxcbiAgICAgICAgcmVxdWVzdEJvZHksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2VuZHBvaW50fS9jaGF0L2NvbXBsZXRpb25zYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksXG4gICAgICBzaWduYWwsXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVN0cmVhbUVycm9yKHJlc3BvbnNlLCB0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICBhc3luYyAqc3RyZWFtTWVzc2FnZSh7XG4gICAgbWVzc2FnZXMsXG4gICAgbW9kZWwsXG4gICAgdGVtcGVyYXR1cmUgPSAwLjcsXG4gICAgb25FcnJvcixcbiAgICBjb250ZXh0RmlsZXMsXG4gICAgc3lzdGVtUHJvbXB0VHlwZSxcbiAgICBzeXN0ZW1Qcm9tcHRQYXRoLFxuICAgIHNpZ25hbCxcbiAgfToge1xuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgIG1vZGVsOiBzdHJpbmc7XG4gICAgdGVtcGVyYXR1cmU/OiBudW1iZXI7XG4gICAgb25FcnJvcj86IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkO1xuICAgIGNvbnRleHRGaWxlcz86IFNldDxzdHJpbmc+O1xuICAgIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmc7XG4gICAgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZztcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbDtcbiAgfSk6IEFzeW5jR2VuZXJhdG9yPHsgY29udGVudD86IHN0cmluZzsgcmVhc29uaW5nPzogc3RyaW5nIH0sIHZvaWQsIHVua25vd24+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVzZXQgdGhpbmsgdGFnIHN0YXRlIGF0IHN0YXJ0IG9mIHN0cmVhbVxuICAgICAgdGhpcy5pc0luc2lkZVRoaW5rVGFncyA9IGZhbHNlO1xuXG4gICAgICBjb25zdCBwcmVwYXJlZE1lc3NhZ2VzID0gYXdhaXQgdGhpcy5wcmVwYXJlTWVzc2FnZXNXaXRoQ29udGV4dChcbiAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgIGNvbnRleHRGaWxlcyB8fCBuZXcgU2V0KCksXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGUsXG4gICAgICAgIHN5c3RlbVByb21wdFBhdGhcbiAgICAgICk7XG5cbiAgICAgIC8vIEdldCBtb2RlbCBpbmZvXG4gICAgICBjb25zdCB7IGlzQ3VzdG9tLCBwcm92aWRlciwgYWN0dWFsTW9kZWxJZCB9ID0gYXdhaXQgdGhpcy5nZXRNb2RlbEluZm8oXG4gICAgICAgIG1vZGVsXG4gICAgICApO1xuXG4gICAgICBsZXQgcmVzcG9uc2U6IFJlc3BvbnNlO1xuXG4gICAgICBpZiAoaXNDdXN0b20gJiYgcHJvdmlkZXIpIHtcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmhhbmRsZUN1c3RvbVByb3ZpZGVyQ29tcGxldGlvbihcbiAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgICBwcmVwYXJlZE1lc3NhZ2VzLFxuICAgICAgICAgIHRlbXBlcmF0dXJlLFxuICAgICAgICAgIGFjdHVhbE1vZGVsSWQsXG4gICAgICAgICAgc2lnbmFsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZWd1bGFyIFN5c3RlbVNjdWxwdCBBUEkgcmVxdWVzdFxuICAgICAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgICAgICBtb2RlbDogYWN0dWFsTW9kZWxJZCxcbiAgICAgICAgICBtZXNzYWdlczogcHJlcGFyZWRNZXNzYWdlcyxcbiAgICAgICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgICAgICBzdHJlYW06IHRydWUsXG4gICAgICAgICAgaW5jbHVkZV9yZWFzb25pbmc6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICBgJHt0aGlzLmJhc2VVcmx9JHtTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5DSEFULkNPTVBMRVRJT05TfWAsXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgIEFjY2VwdDogXCJ0ZXh0L2V2ZW50LXN0cmVhbVwiLFxuICAgICAgICAgICAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJuby1jYWNoZVwiLFxuICAgICAgICAgICAgICBcIlgtUmVxdWVzdC1JRFwiOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICAgICAgICBcIngtbGljZW5zZS1rZXlcIjogdGhpcy5saWNlbnNlS2V5LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICAgICAgICAgIHNpZ25hbCxcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTdHJlYW1FcnJvcihyZXNwb25zZSwgISFwcm92aWRlcik7XG4gICAgICB9XG4gICAgICBpZiAoIXJlc3BvbnNlLmJvZHkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IpLFxuICAgICAgICAgIEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUixcbiAgICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTtcbiAgICAgIGxldCBidWZmZXIgPSBcIlwiO1xuXG4gICAgICB0cnkge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7XG5cbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgLy8gUHJvY2VzcyBmaW5hbCBjaHVuayBpZiBhbnlcbiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2h1bmsgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmRlY29kZXIuZGVjb2RlKCk7XG4gICAgICAgICAgICBpZiAoZmluYWxDaHVuaykge1xuICAgICAgICAgICAgICBjb25zdCBldmVudCA9IHRoaXMucHJvY2Vzc1N0cmVhbUxpbmUoZmluYWxDaHVuayk7XG4gICAgICAgICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXZlbnQoXG4gICAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgICAgICAgISFwcm92aWRlclxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb250ZW50IHx8IHJlc3VsdC5yZWFzb25pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdC5jb250ZW50IHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICByZWFzb25pbmc6IHJlc3VsdC5yZWFzb25pbmcgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gUHJvY2VzcyBjaHVuayBhbmQgeWllbGQgY29udGVudHNcbiAgICAgICAgICBjb25zdCB7IG5ld0J1ZmZlciwgY29udGVudHMsIHJlYXNvbmluZ3MgfSA9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NTdHJlYW1DaHVuayh2YWx1ZSwgYnVmZmVyLCBtb2RlbCwgISFwcm92aWRlcik7XG4gICAgICAgICAgYnVmZmVyID0gbmV3QnVmZmVyO1xuXG4gICAgICAgICAgLy8gWWllbGQgYm90aCBjb250ZW50IGFuZCByZWFzb25pbmcgY2h1bmtzXG4gICAgICAgICAgZm9yIChcbiAgICAgICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgICAgIGkgPCBNYXRoLm1heChjb250ZW50cy5sZW5ndGgsIHJlYXNvbmluZ3MubGVuZ3RoKTtcbiAgICAgICAgICAgIGkrK1xuICAgICAgICAgICkge1xuICAgICAgICAgICAgeWllbGQge1xuICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50c1tpXSxcbiAgICAgICAgICAgICAgcmVhc29uaW5nOiByZWFzb25pbmdzW2ldLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJlYWRlci5yZWxlYXNlTG9jaygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBET01FeGNlcHRpb24gJiYgZXJyb3IubmFtZSA9PT0gXCJBYm9ydEVycm9yXCIpIHtcbiAgICAgICAgLy8gSGFuZGxlIGFib3J0IGdyYWNlZnVsbHlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICA6IGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvciAmJlxuICAgICAgICAgIGVycm9yLmNvZGUgPT09IEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUiAmJlxuICAgICAgICAgIGVycm9yLnN0YXR1c0NvZGUgPT09IDQwMFxuICAgICAgICApIHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgKz1cbiAgICAgICAgICAgIFwiXFxuUGxlYXNlIHRyeSBhZ2FpbiBpbiBhIGZldyBtb21lbnRzLiBJZiB0aGUgaXNzdWUgcGVyc2lzdHMsIHRyeSBzZWxlY3RpbmcgYSBkaWZmZXJlbnQgbW9kZWwuXCI7XG4gICAgICAgIH1cbiAgICAgICAgb25FcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwbG9hZHMgYSBmaWxlIHRvIHRoZSBzZXJ2ZXIgZm9yIGRvY3VtZW50IHByb2Nlc3NpbmcuXG4gICAqIFJldHVybnMge2RvY3VtZW50SWQsIHN0YXR1czogXCJxdWV1ZWRcIiB8IFwicHJvY2Vzc2luZ1wiIHwgXCJjb21wbGV0ZWRcIiwgY2FjaGVkPzogYm9vbGVhbn0gaWYgc3VjY2Vzc2Z1bC5cbiAgICovXG4gIHB1YmxpYyBhc3luYyB1cGxvYWREb2N1bWVudChcbiAgICBmaWxlOiBURmlsZVxuICApOiBQcm9taXNlPHsgZG9jdW1lbnRJZDogc3RyaW5nOyBzdGF0dXM6IHN0cmluZzsgY2FjaGVkPzogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlYWQgZmlsZSBmcm9tIHZhdWx0XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZEJpbmFyeShmaWxlKTtcblxuICAgICAgLy8gUHJlcGFyZSBtdWx0aXBhcnQgZm9ybSBkYXRhXG4gICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwgeyB0eXBlOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiIH0pO1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBibG9iLCBmaWxlLm5hbWUpO1xuXG4gICAgICAvLyBNYWtlIHJlcXVlc3QgdG8gL2FwaS92MS9kb2N1bWVudHMvcHJvY2Vzc1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2FwaS92MS9kb2N1bWVudHMvcHJvY2Vzc2AsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwieC1saWNlbnNlLWtleVwiOiB0aGlzLmxpY2Vuc2VLZXksXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVcGxvYWQgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGxvYWRzIGFuIGF1ZGlvIGZpbGUgdG8gdGhlIHNlcnZlciBmb3Igc3BlZWNoLXRvLXRleHQgZXh0cmFjdGlvbi5cbiAgICogUmV0dXJucyB7ZG9jdW1lbnRJZCwgc3RhdHVzOiBcInF1ZXVlZFwifFwicHJvY2Vzc2luZ1wifFwiY29tcGxldGVkXCIsIGNhY2hlZD86IGJvb2xlYW59IGlmIHN1Y2Nlc3NmdWwuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdXBsb2FkQXVkaW8oXG4gICAgZmlsZTogVEZpbGVcbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50SWQ6IHN0cmluZzsgc3RhdHVzOiBzdHJpbmc7IGNhY2hlZD86IGJvb2xlYW4gfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZWFkIGZpbGUgZnJvbSB2YXVsdFxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG5cbiAgICAgIC8vIFByZXBhcmUgbXVsdGlwYXJ0IGZvcm0gZGF0YVxuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZGF0YV0sIHsgdHlwZTogXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIiB9KTtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgYmxvYiwgZmlsZS5uYW1lKTtcblxuICAgICAgLy8gTWFrZSByZXF1ZXN0IHRvIC9hcGkvdjEvYXVkaW8vdHJhbnNjcmlwdGlvbnMgZW5kcG9pbnRcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke3RoaXMuYmFzZVVybH0vYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zYCxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQXVkaW8gdXBsb2FkIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcHJlbG9hZE1vZGVscygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBSZW1vdmUgcHJlbG9hZGluZyBzaW5jZSB3ZSdyZSBub3QgY2FjaGluZ1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxufVxuIiwgImV4cG9ydCBjb25zdCBjcmVhdGVMb2FkaW5nSW5kaWNhdG9yID0gKCkgPT4ge1xuICBjb25zdCBpbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBpbmRpY2F0b3IuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtbG9hZGluZ1wiO1xuICBpbmRpY2F0b3IudGV4dENvbnRlbnQgPSBcIlx1MjVDRlwiO1xuICByZXR1cm4gaW5kaWNhdG9yO1xufTtcbiIsICJleHBvcnQgY29uc3QgY3JlYXRlQnV0dG9uID0gKFxuICB0ZXh0OiBzdHJpbmcsXG4gIG9uQ2xpY2s6ICgpID0+IHZvaWQsXG4gIGNsYXNzTmFtZSA9IFwiXCJcbikgPT4ge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBidXR0b24uY2xhc3NOYW1lID0gYHN5c3RlbXNjdWxwdC1idXR0b24gJHtjbGFzc05hbWV9YDtcbiAgYnV0dG9uLnRleHRDb250ZW50ID0gdGV4dDtcbiAgYnV0dG9uLm9uY2xpY2sgPSBvbkNsaWNrO1xuICByZXR1cm4gYnV0dG9uO1xufTtcbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dEFyZWFNb2RhbE9wdGlvbnMge1xuICBwcmltYXJ5QnV0dG9uPzogc3RyaW5nO1xuICBzZWNvbmRhcnlCdXR0b24/OiBzdHJpbmc7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICByb3dzPzogbnVtYmVyO1xuICBwcmVzZXRCdXR0b25zPzoge1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgdmFsdWU6IHN0cmluZztcbiAgfVtdO1xufVxuXG5leHBvcnQgY2xhc3MgVGV4dEFyZWFNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSByZXN1bHQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IHN0cmluZyB8IG51bGwpID0+IHZvaWQ7XG4gIHByaXZhdGUgdGV4dEFyZWE6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSB0aXRsZTogc3RyaW5nLFxuICAgIHByaXZhdGUgaW5pdGlhbENvbnRlbnQ6IHN0cmluZyxcbiAgICBwcml2YXRlIG9wdGlvbnM/OiBUZXh0QXJlYU1vZGFsT3B0aW9uc1xuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiLCBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1tb2RhbFwiKTtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtY29udGVudFwiKTtcblxuICAgIHRoaXMudGl0bGVFbC5zZXRUZXh0KHRoaXMudGl0bGUpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBwcmVzZXQgYnV0dG9ucyBpZiB0aGV5IGV4aXN0XG4gICAgaWYgKHRoaXMub3B0aW9ucz8ucHJlc2V0QnV0dG9ucyAmJiB0aGlzLm9wdGlvbnMucHJlc2V0QnV0dG9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBwcmVzZXRCdXR0b25Db250YWluZXIgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICAgIFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24tY29udGFpbmVyXCJcbiAgICAgICk7XG5cbiAgICAgIHRoaXMub3B0aW9ucy5wcmVzZXRCdXR0b25zLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICBjb25zdCBidXR0b24gPSBwcmVzZXRCdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICAgIHRleHQ6IHByZXNldC5sYWJlbCxcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIixcbiAgICAgICAgfSk7XG4gICAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQudmFsdWU7XG4gICAgICAgICAgLy8gVHJpZ2dlciByZXNpemUgb2JzZXJ2ZXJcbiAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KTtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy50ZXh0QXJlYSA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZUVsKFwidGV4dGFyZWFcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYVwiLFxuICAgICAgYXR0cjoge1xuICAgICAgICByb3dzOiB0aGlzLm9wdGlvbnM/LnJvd3M/LnRvU3RyaW5nKCkgfHwgXCIxMFwiLFxuICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5vcHRpb25zPy5wbGFjZWhvbGRlciB8fCBcIlwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gdGhpcy5pbml0aWFsQ29udGVudDtcblxuICAgIC8vIEFkZCByZXNpemUgb2JzZXJ2ZXIgdG8gaGFuZGxlIGR5bmFtaWMgY29udGVudFxuICAgIGNvbnN0IHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMudGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgIH0pO1xuICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy50ZXh0QXJlYSk7XG5cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnM/LnNlY29uZGFyeUJ1dHRvbikge1xuICAgICAgY29uc3Qgc2Vjb25kYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnNlY29uZGFyeUJ1dHRvbixcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIH0pO1xuICAgICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IHRoaXMub3B0aW9ucz8ucHJpbWFyeUJ1dHRvbiB8fCBcIlNhdmVcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBwcmltYXJ5QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdCA9IHRoaXMudGV4dEFyZWEudmFsdWU7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcblxuICAgIC8vIEZvY3VzIHRoZSB0ZXh0YXJlYSBhbmQgcGxhY2UgY3Vyc29yIGF0IHRoZSBlbmRcbiAgICB0aGlzLnRleHRBcmVhLmZvY3VzKCk7XG4gICAgdGhpcy50ZXh0QXJlYS5zZXRTZWxlY3Rpb25SYW5nZShcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoLFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGhcbiAgICApO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSkge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd1RleHRhcmVhUG9wdXAoXG4gIGFwcDogQXBwLFxuICB0aXRsZTogc3RyaW5nLFxuICBpbml0aWFsQ29udGVudDogc3RyaW5nLFxuICBvcHRpb25zPzogVGV4dEFyZWFNb2RhbE9wdGlvbnNcbik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICBjb25zdCBtb2RhbCA9IG5ldyBUZXh0QXJlYU1vZGFsKGFwcCwgdGl0bGUsIGluaXRpYWxDb250ZW50LCBvcHRpb25zKTtcbiAgcmV0dXJuIG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xufVxuIiwgImltcG9ydCB7IEFwcCwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgUG9wdXBPcHRpb25zIHtcbiAgcHJpbWFyeUJ1dHRvbj86IHN0cmluZztcbiAgc2Vjb25kYXJ5QnV0dG9uPzogc3RyaW5nO1xuICB0aXRsZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGljb24/OiBzdHJpbmc7XG4gIGlucHV0cz86IHtcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gICAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICAgIGNsYXNzTmFtZT86IHN0cmluZztcbiAgICB2YWx1ZT86IHN0cmluZztcbiAgfVtdO1xufVxuXG5leHBvcnQgY2xhc3MgUG9wdXBDb21wb25lbnQge1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIG1lc3NhZ2U6IHN0cmluZztcbiAgcHJpdmF0ZSBvcHRpb25zOiBQb3B1cE9wdGlvbnM7XG4gIHByaXZhdGUgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAoXG4gICAgdmFsdWU6IHsgY29uZmlybWVkOiBib29sZWFuOyBpbnB1dHM/OiBzdHJpbmdbXSB9IHwgbnVsbFxuICApID0+IHZvaWQ7XG4gIHByaXZhdGUgcmVzdWx0OiB7IGNvbmZpcm1lZDogYm9vbGVhbjsgaW5wdXRzPzogc3RyaW5nW10gfSB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBtZXNzYWdlOiBzdHJpbmcsIG9wdGlvbnM6IFBvcHVwT3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQb3B1cCgpIHtcbiAgICAvLyBDcmVhdGUgY29udGFpbmVyXG4gICAgdGhpcy5jb250YWluZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1wb3B1cC1jb250YWluZXJcIik7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lckVsKTtcblxuICAgIC8vIENyZWF0ZSBwb3B1cFxuICAgIGNvbnN0IHBvcHVwRWwgPSB0aGlzLmNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtcG9wdXBcIiB9KTtcbiAgICBjb25zdCBjb250ZW50ID0gcG9wdXBFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWNvbnRlbnRcIiB9KTtcblxuICAgIC8vIEFkZCB0aXRsZSBpZiBwcm92aWRlZFxuICAgIGlmICh0aGlzLm9wdGlvbnMudGl0bGUpIHtcbiAgICAgIGNvbnN0IHRpdGxlRWwgPSBjb250ZW50LmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtcG9wdXAtdGl0bGVcIiB9KTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWNvbikge1xuICAgICAgICBjb25zdCBpY29uRWwgPSB0aXRsZUVsLmNyZWF0ZVNwYW4oeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWljb25cIiB9KTtcbiAgICAgICAgc2V0SWNvbihpY29uRWwsIHRoaXMub3B0aW9ucy5pY29uKTtcbiAgICAgIH1cbiAgICAgIHRpdGxlRWwuY3JlYXRlU3Bhbih7IHRleHQ6IHRoaXMub3B0aW9ucy50aXRsZSB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgbWFpbiBtZXNzYWdlXG4gICAgaWYgKHRoaXMubWVzc2FnZSkge1xuICAgICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLW1lc3NhZ2VcIixcbiAgICAgICAgdGV4dDogdGhpcy5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGRlc2NyaXB0aW9uIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRoaXMub3B0aW9ucy5kZXNjcmlwdGlvbikge1xuICAgICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWRlc2NyaXB0aW9uXCIsXG4gICAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5kZXNjcmlwdGlvbixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBpbnB1dHMgaWYgcHJvdmlkZWRcbiAgICBpZiAodGhpcy5vcHRpb25zLmlucHV0cykge1xuICAgICAgY29uc3QgaW5wdXRzQ29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWlucHV0c1wiLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMub3B0aW9ucy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgaWYgKGlucHV0LnR5cGUgPT09IFwidGV4dGFyZWFcIikge1xuICAgICAgICAgIGlucHV0c0NvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgICAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1wb3B1cC10ZXh0YXJlYSAke2lucHV0LmNsYXNzTmFtZSB8fCBcIlwifWAsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogaW5wdXQucGxhY2Vob2xkZXIsXG4gICAgICAgICAgICB2YWx1ZTogaW5wdXQudmFsdWUgfHwgXCJcIixcbiAgICAgICAgICAgIGF0dHI6IHtcbiAgICAgICAgICAgICAgcmVxdWlyZWQ6IGlucHV0LnJlcXVpcmVkID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlucHV0c0NvbnRhaW5lci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtcG9wdXAtaW5wdXQgJHtpbnB1dC5jbGFzc05hbWUgfHwgXCJcIn1gLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGlucHV0LnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgdmFsdWU6IGlucHV0LnZhbHVlIHx8IFwiXCIsXG4gICAgICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBpbnB1dC5yZXF1aXJlZCA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGJ1dHRvbnNcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBwb3B1cEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbnNcIixcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5QnV0dG9uKSB7XG4gICAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbiBzeXN0ZW1zY3VscHQtcG9wdXAtYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5QnV0dG9uLFxuICAgICAgfSk7XG4gICAgICBzZWNvbmRhcnlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7IGNvbmZpcm1lZDogZmFsc2UgfTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtcG9wdXAtYnV0dG9uICR7XG4gICAgICAgIHRoaXMub3B0aW9ucy5wcmltYXJ5QnV0dG9uID09PSBcIkJlY29tZSBBIFBhdHJvblwiIHx8XG4gICAgICAgIHRoaXMub3B0aW9ucy5wcmltYXJ5QnV0dG9uID09PSBcIkJlY29tZSBhIFBhdHJvblwiXG4gICAgICAgICAgPyBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b24tcGF0cm9uXCJcbiAgICAgICAgICA6IFwic3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbi1wcmltYXJ5XCJcbiAgICAgIH1gLFxuICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnByaW1hcnlCdXR0b24gfHwgXCJPS1wiLFxuICAgIH0pO1xuXG4gICAgcHJpbWFyeUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbnB1dHMpIHtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gQXJyYXkuZnJvbShcbiAgICAgICAgICBwb3B1cEVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dCwgdGV4dGFyZWFcIikgYXMgTm9kZUxpc3RPZjxcbiAgICAgICAgICAgIEhUTUxJbnB1dEVsZW1lbnQgfCBIVE1MVGV4dEFyZWFFbGVtZW50XG4gICAgICAgICAgPlxuICAgICAgICApO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIGFueSByZXF1aXJlZCBpbnB1dHMgYXJlIGVtcHR5XG4gICAgICAgIGNvbnN0IGhhc0VtcHR5UmVxdWlyZWQgPSBpbnB1dHMuc29tZShcbiAgICAgICAgICAoaW5wdXQpID0+IGlucHV0LnJlcXVpcmVkICYmICFpbnB1dC52YWx1ZS50cmltKClcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGhhc0VtcHR5UmVxdWlyZWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlc3VsdCA9IHtcbiAgICAgICAgICBjb25maXJtZWQ6IHRydWUsXG4gICAgICAgICAgaW5wdXRzOiBpbnB1dHMubWFwKChpbnB1dCkgPT4gaW5wdXQudmFsdWUpLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7IGNvbmZpcm1lZDogdHJ1ZSB9O1xuICAgICAgfVxuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGtleWJvYXJkIGhhbmRsZXJzXG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0geyBjb25maXJtZWQ6IGZhbHNlIH07XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiICYmICFlLmlzQ29tcG9zaW5nICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgIHByaW1hcnlCdXR0b24uY2xpY2soKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENsb3NlIG9uIGJhY2tncm91bmQgY2xpY2tcbiAgICB0aGlzLmNvbnRhaW5lckVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5jb250YWluZXJFbCkge1xuICAgICAgICB0aGlzLnJlc3VsdCA9IHsgY29uZmlybWVkOiBmYWxzZSB9O1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlKCkge1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtcG9wdXAtY2xvc2luZ1wiKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuY29udGFpbmVyRWwucmVtb3ZlKCk7XG4gICAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSkge1xuICAgICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcbiAgICAgIH1cbiAgICB9LCAyMDApOyAvLyBNYXRjaCB0aGUgYW5pbWF0aW9uIGR1cmF0aW9uXG4gIH1cblxuICBwdWJsaWMgb3BlbigpOiBQcm9taXNlPHsgY29uZmlybWVkOiBib29sZWFuOyBpbnB1dHM/OiBzdHJpbmdbXSB9IHwgbnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB0aGlzLmNyZWF0ZVBvcHVwKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dQb3B1cChcbiAgYXBwOiBBcHAsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgb3B0aW9uczogUG9wdXBPcHRpb25zID0ge31cbik6IFByb21pc2U8eyBjb25maXJtZWQ6IGJvb2xlYW47IGlucHV0cz86IHN0cmluZ1tdIH0gfCBudWxsPiB7XG4gIGNvbnN0IHBvcHVwID0gbmV3IFBvcHVwQ29tcG9uZW50KGFwcCwgbWVzc2FnZSwgb3B0aW9ucyk7XG4gIHJldHVybiBwb3B1cC5vcGVuKCk7XG59XG4iLCAiaW1wb3J0IHsgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9lcnJvcnNcIjtcblxudHlwZSBOb3RpY2VUeXBlID0gXCJpbmZvXCIgfCBcImVycm9yXCIgfCBcIndhcm5pbmdcIiB8IFwic3VjY2Vzc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gc2hvd0VuaGFuY2VkTm90aWNlKFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIHR5cGU/OiBOb3RpY2VUeXBlLFxuICBlcnJvcj86IEVycm9yIHwgU3lzdGVtU2N1bHB0RXJyb3IgfCB1bmtub3duXG4pIHtcbiAgLy8gQWx3YXlzIGxvZyBlcnJvcnMgdG8gY29uc29sZSBpZiBwcmVzZW50XG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJOb3RpY2UgZXJyb3IgZGV0YWlsczpcIiwge1xuICAgICAgZXJyb3IsXG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgbWV0YWRhdGE6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5tZXRhZGF0YSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcbiAgfVxuXG4gIGxldCBkdXJhdGlvbjogbnVtYmVyO1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgIGR1cmF0aW9uID0gMTAwMDA7IC8vIDEwIHNlY29uZHMgZm9yIGVycm9yc1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIndhcm5pbmdcIjpcbiAgICAgIGR1cmF0aW9uID0gNTAwMDsgLy8gNSBzZWNvbmRzIGZvciB3YXJuaW5nc1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGR1cmF0aW9uID0gMzAwMDsgLy8gMyBzZWNvbmRzIGZvciBpbmZvIGFuZCBzdWNjZXNzXG4gIH1cblxuICBjb25zdCBub3RpY2UgPSBuZXcgTm90aWNlKG1lc3NhZ2UsIGR1cmF0aW9uKTtcbiAgcmV0dXJuIG5vdGljZTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4vbW9kYWxzL1BvcHVwTW9kYWxcIjtcblxuaW50ZXJmYWNlIE5vdGlmaWNhdGlvbk9wdGlvbnMge1xuICB0eXBlPzogXCJzdWNjZXNzXCIgfCBcImVycm9yXCIgfCBcIndhcm5pbmdcIiB8IFwiaW5mb1wiO1xuICBkdXJhdGlvbj86IG51bWJlcjtcbiAgaWNvbj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEFsZXJ0T3B0aW9ucyB7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBwcmltYXJ5QnV0dG9uPzogc3RyaW5nO1xuICBzZWNvbmRhcnlCdXR0b24/OiBzdHJpbmc7XG4gIGljb24/OiBzdHJpbmc7XG4gIHR5cGU/OiBcImVycm9yXCIgfCBcIndhcm5pbmdcIiB8IFwiaW5mb1wiO1xufVxuXG4vKipcbiAqIFNob3cgYSBxdWljayBub3RpZmljYXRpb24gZm9yIG5vbi1jcml0aWNhbCBpbmZvcm1hdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd05vdGljZShtZXNzYWdlOiBzdHJpbmcsIG9wdGlvbnM6IE5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7fSkge1xuICBjb25zdCB7IHR5cGUgPSBcImluZm9cIiwgZHVyYXRpb24gPSA0MDAwIH0gPSBvcHRpb25zO1xuICBsZXQgcHJlZml4ID0gXCJcIjtcblxuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIFwic3VjY2Vzc1wiOlxuICAgICAgcHJlZml4ID0gXCJcdTI3MjggXCI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgIHByZWZpeCA9IFwiXHUyNzRDIFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIndhcm5pbmdcIjpcbiAgICAgIHByZWZpeCA9IFwiXHUyNkEwXHVGRTBGIFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcImluZm9cIjpcbiAgICAgIHByZWZpeCA9IFwiXHUyMTM5XHVGRTBGIFwiO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICBuZXcgTm90aWNlKHByZWZpeCArIG1lc3NhZ2UsIGR1cmF0aW9uKTtcbn1cblxuLyoqXG4gKiBTaG93IGFuIGFsZXJ0IHBvcHVwIGZvciBpbXBvcnRhbnQgbWVzc2FnZXMgdGhhdCBuZWVkIHVzZXIgYXR0ZW50aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93QWxlcnQoXG4gIGFwcDogQXBwLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIG9wdGlvbnM6IEFsZXJ0T3B0aW9ucyA9IHt9XG4pOiBQcm9taXNlPHsgY29uZmlybWVkOiBib29sZWFuIH0+IHtcbiAgY29uc3Qge1xuICAgIHRpdGxlID0gb3B0aW9ucy50eXBlID09PSBcImVycm9yXCJcbiAgICAgID8gXCJFcnJvclwiXG4gICAgICA6IG9wdGlvbnMudHlwZSA9PT0gXCJ3YXJuaW5nXCJcbiAgICAgID8gXCJXYXJuaW5nXCJcbiAgICAgIDogXCJBbGVydFwiLFxuICAgIHByaW1hcnlCdXR0b24gPSBcIk9LXCIsXG4gICAgc2Vjb25kYXJ5QnV0dG9uLFxuICAgIGljb24gPSBvcHRpb25zLnR5cGUgPT09IFwiZXJyb3JcIlxuICAgICAgPyBcImFsZXJ0LWNpcmNsZVwiXG4gICAgICA6IG9wdGlvbnMudHlwZSA9PT0gXCJ3YXJuaW5nXCJcbiAgICAgID8gXCJhbGVydC10cmlhbmdsZVwiXG4gICAgICA6IFwiaW5mb1wiLFxuICB9ID0gb3B0aW9ucztcblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoYXBwLCBtZXNzYWdlLCB7XG4gICAgdGl0bGUsXG4gICAgcHJpbWFyeUJ1dHRvbixcbiAgICBzZWNvbmRhcnlCdXR0b24sXG4gICAgaWNvbixcbiAgfSk7XG5cbiAgcmV0dXJuIHsgY29uZmlybWVkOiByZXN1bHQ/LmNvbmZpcm1lZCB8fCBmYWxzZSB9O1xufVxuXG4vKipcbiAqIFNob3cgYSBjb25maXJtYXRpb24gcG9wdXAgZm9yIGFjdGlvbnMgdGhhdCBuZWVkIHVzZXIgYXBwcm92YWxcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dDb25maXJtKFxuICBhcHA6IEFwcCxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBvcHRpb25zOiBBbGVydE9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTx7IGNvbmZpcm1lZDogYm9vbGVhbiB9PiB7XG4gIGNvbnN0IHtcbiAgICB0aXRsZSA9IFwiQ29uZmlybSBBY3Rpb25cIixcbiAgICBwcmltYXJ5QnV0dG9uID0gXCJDb25maXJtXCIsXG4gICAgc2Vjb25kYXJ5QnV0dG9uID0gXCJDYW5jZWxcIixcbiAgICBpY29uID0gXCJoZWxwLWNpcmNsZVwiLFxuICB9ID0gb3B0aW9ucztcblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoYXBwLCBtZXNzYWdlLCB7XG4gICAgdGl0bGUsXG4gICAgcHJpbWFyeUJ1dHRvbixcbiAgICBzZWNvbmRhcnlCdXR0b24sXG4gICAgaWNvbixcbiAgfSk7XG5cbiAgcmV0dXJuIHsgY29uZmlybWVkOiByZXN1bHQ/LmNvbmZpcm1lZCB8fCBmYWxzZSB9O1xufVxuIiwgImV4cG9ydCB7IGNyZWF0ZUxvYWRpbmdJbmRpY2F0b3IgfSBmcm9tIFwiLi9jb21wb25lbnRzL0xvYWRpbmdJbmRpY2F0b3JcIjtcbmV4cG9ydCB7IGNyZWF0ZUJ1dHRvbiB9IGZyb20gXCIuL2NvbXBvbmVudHMvQnV0dG9uXCI7XG5leHBvcnQge1xuICBUZXh0QXJlYU1vZGFsLFxuICB0eXBlIFRleHRBcmVhTW9kYWxPcHRpb25zLFxuICBzaG93VGV4dGFyZWFQb3B1cCxcbn0gZnJvbSBcIi4vbW9kYWxzL1RleHRBcmVhTW9kYWxcIjtcbmV4cG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuL21vZGFscy9Qb3B1cE1vZGFsXCI7XG5leHBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UgfSBmcm9tIFwiLi9jb21wb25lbnRzL05vdGljZVwiO1xuZXhwb3J0IHsgc2hvd05vdGljZSwgc2hvd0FsZXJ0LCBzaG93Q29uZmlybSB9IGZyb20gXCIuL25vdGlmaWNhdGlvbnNcIjtcbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBBYnN0cmFjdElucHV0U3VnZ2VzdCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgRmlsZVN1Z2dlc3RlciBleHRlbmRzIEFic3RyYWN0SW5wdXRTdWdnZXN0PHN0cmluZz4ge1xuICBwcml2YXRlIGNvbnRlbnQ6IFNldDxzdHJpbmc+O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudCxcbiAgICBwcml2YXRlIG9uU2VsZWN0Q2I6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkLFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgZGlyZWN0b3J5OiBzdHJpbmdcbiAgKSB7XG4gICAgc3VwZXIoYXBwLCBpbnB1dEVsKTtcbiAgICB0aGlzLmNvbnRlbnQgPSBnZXRGaWxlU3VnZ2VzdGlvbnMoYXBwLCBkaXJlY3RvcnkpO1xuICB9XG5cbiAgZ2V0U3VnZ2VzdGlvbnMoaW5wdXRTdHI6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBsb3dlckNhc2VJbnB1dFN0ciA9IGlucHV0U3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIFsuLi50aGlzLmNvbnRlbnRdLmZpbHRlcigoY29udGVudCkgPT5cbiAgICAgIGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlckNhc2VJbnB1dFN0cilcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyU3VnZ2VzdGlvbihjb250ZW50OiBzdHJpbmcsIGVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIC8vIFJlbW92ZSBhbnkgdHJhaWxpbmcgXCIubWRcIiBleHRlbnNpb24gdG8gYXZvaWQgY2x1dHRlclxuICAgIGxldCBkaXNwbGF5ID0gY29udGVudC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICBlbC5zZXRUZXh0KGRpc3BsYXkpO1xuICB9XG5cbiAgc2VsZWN0U3VnZ2VzdGlvbihjb250ZW50OiBzdHJpbmcsIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLm9uU2VsZWN0Q2IoY29udGVudCk7XG4gICAgdGhpcy5pbnB1dEVsLnZhbHVlID0gY29udGVudC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICB0aGlzLmlucHV0RWwuYmx1cigpO1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsZVN1Z2dlc3Rpb25zKGFwcDogQXBwLCBkaXJlY3Rvcnk6IHN0cmluZyk6IFNldDxzdHJpbmc+IHtcbiAgY29uc3QgZmlsZXMgPSBhcHAudmF1bHQuZ2V0QWxsTG9hZGVkRmlsZXMoKS5maWx0ZXIoKGZpbGUpOiBmaWxlIGlzIFRGaWxlID0+IHtcbiAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm4gZmFsc2U7XG4gICAgLy8gT25seSBpbmNsdWRlIC5tZCBmaWxlcyBkaXJlY3RseSBpbiB0aGUgc3BlY2lmaWVkIGRpcmVjdG9yeSAobm90IGluIHN1YmRpcmVjdG9yaWVzKVxuICAgIGNvbnN0IGZpbGVEaXIgPSBmaWxlLnBhcmVudD8ucGF0aDtcbiAgICByZXR1cm4gZmlsZURpciA9PT0gZGlyZWN0b3J5ICYmIGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCI7XG4gIH0pO1xuICByZXR1cm4gbmV3IFNldChmaWxlcy5tYXAoKGZpbGUpID0+IGZpbGUucGF0aCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXR0YWNoRmlsZVN1Z2dlc3RlcihcbiAgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudCxcbiAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4gdm9pZCxcbiAgYXBwOiBBcHAsXG4gIGRpcmVjdG9yeTogc3RyaW5nXG4pOiBGaWxlU3VnZ2VzdGVyIHtcbiAgcmV0dXJuIG5ldyBGaWxlU3VnZ2VzdGVyKGlucHV0RWwsIG9uU2VsZWN0LCBhcHAsIGRpcmVjdG9yeSk7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgc2V0SWNvbiwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBhdHRhY2hGaWxlU3VnZ2VzdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRmlsZVN1Z2dlc3RlclwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBQb3N0VHJhbnNjcmlwdGlvblByb21wdFR5cGUge1xuICBpZDogc3RyaW5nO1xuICBsYWJlbDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgaXNVc2VyQ29uZmlndXJhYmxlOiBib29sZWFuO1xuICBzeXN0ZW1Qcm9tcHQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdHlwZTogXCJnZW5lcmFsXCIgfCBcInJoeW1lXCIgfCBcImN1c3RvbVwiO1xuICBwYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgUG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSByZXN1bHQ6IFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogUG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQgfCBudWxsKSA9PiB2b2lkO1xuICBwcml2YXRlIHRleHRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIGxvYWRpbmdJbmRpY2F0b3I6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGNvbnRlbnRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHByZXNldEJ1dHRvbkNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tU2VjdGlvbjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgYWN0aXZlUHJlc2V0OiBzdHJpbmcgfCBudWxsID0gXCJnZW5lcmFsXCI7IC8vIERlZmF1bHQgdG8gZ2VuZXJhbFxuICBwcml2YXRlIHByb21wdHM6IFBvc3RUcmFuc2NyaXB0aW9uUHJvbXB0VHlwZVtdID0gW107XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICAgIHByaXZhdGUgY3VycmVudFByb21wdDogc3RyaW5nLFxuICAgIHByaXZhdGUgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTogc3RyaW5nID0gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIixcbiAgICBwcml2YXRlIGN1cnJlbnRDdXN0b21QYXRoPzogc3RyaW5nXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb2RhbEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsXCIsIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLW1vZGFsXCIpO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luLnNldHRpbmdzLCBhcHApO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93TG9hZGluZyhzaG93OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLmxvYWRpbmdJbmRpY2F0b3IgfHwgIXRoaXMuY29udGVudENvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcbiAgICB0aGlzLmNvbnRlbnRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcIm5vbmVcIiA6IFwiYmxvY2tcIjtcbiAgfVxuXG4gIGFzeW5jIGxvYWRQcm9tcHRzKCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKHRydWUpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9wb3N0LXRyYW5zY3JpcHRpb24tcHJvbXB0c2BcbiAgICAgICk7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2FkIHByb21wdHNcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgdGhpcy5wcm9tcHRzID0gZGF0YS5kYXRhLnByb21wdHM7XG5cbiAgICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9ucyBhZnRlciBsb2FkaW5nIGRhdGFcbiAgICAgIHRoaXMuY3JlYXRlUHJlc2V0QnV0dG9ucygpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBwb3N0LXRyYW5zY3JpcHRpb24gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRmFpbGVkIHRvIGxvYWQgcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcmVzZXRCdXR0b25zKCkge1xuICAgIGlmICghdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIpIHJldHVybjtcblxuICAgIC8vIENsZWFyIGV4aXN0aW5nIGJ1dHRvbnNcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBhY3RpdmUgcHJlc2V0IGJhc2VkIG9uIGN1cnJlbnQgcHJvbXB0IGFuZCBwYXRoXG4gICAgaWYgKHRoaXMuY3VycmVudEN1c3RvbVBhdGgpIHtcbiAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gXCJjdXN0b21cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcm9tcHRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICBpZiAocHJlc2V0LnN5c3RlbVByb21wdCA9PT0gdGhpcy5jdXJyZW50UHJvbXB0KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQuaWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9ucyBmb3IgZWFjaCBwcm9tcHRcbiAgICB0aGlzLnByb21wdHMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIHRleHQ6IHByZXNldC5sYWJlbCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHRvb2x0aXAgd2l0aCBkZXNjcmlwdGlvbiBpZiBhdmFpbGFibGVcbiAgICAgIGlmIChwcmVzZXQuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcHJlc2V0LmRlc2NyaXB0aW9uKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiaGFzLXRvb2x0aXBcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBpbml0aWFsIGFjdGl2ZSBzdGF0ZVxuICAgICAgaWYgKHByZXNldC5pZCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpIHtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2ZSBjbGFzcyBmcm9tIGFsbCBidXR0b25zXG4gICAgICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyXG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIilcbiAgICAgICAgICAuZm9yRWFjaCgoYnRuKSA9PiBidG4ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmlkO1xuXG4gICAgICAgIC8vIFNob3cvaGlkZSBjdXN0b20gc2VjdGlvblxuICAgICAgICBpZiAocHJlc2V0LmlkID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC5mb2N1cygpO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9ICFwcmVzZXQuaXNVc2VyQ29uZmlndXJhYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIFNob3cgY3VzdG9tIHNlY3Rpb24gaWYgaXQncyBhY3RpdmVcbiAgICBpZiAodGhpcy5hY3RpdmVQcmVzZXQgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgaWYgKHRoaXMuY3VycmVudEN1c3RvbVBhdGgpIHtcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHRoaXMuY3VycmVudEN1c3RvbVBhdGg7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgLy8gQWRkIHRpdGxlXG4gICAgdGhpcy50aXRsZUVsLnNldFRleHQoXCJFZGl0IFBvc3QtUHJvY2Vzc2luZyBQcm9tcHRcIik7XG4gICAgdGhpcy50aXRsZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIpO1xuXG4gICAgLy8gQWRkIGRlc2NyaXB0aW9uXG4gICAgY29uc3QgZGVzY3JpcHRpb25FbCA9IHRoaXMudGl0bGVFbC5jcmVhdGVEaXYoKTtcbiAgICBkZXNjcmlwdGlvbkVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIpO1xuICAgIGRlc2NyaXB0aW9uRWwuc2V0VGV4dChcbiAgICAgIFwiQ29uZmlndXJlIGhvdyB5b3VyIHRyYW5zY3JpcHRpb25zIHNob3VsZCBiZSBwb3N0LXByb2Nlc3NlZFwiXG4gICAgKTtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW11dGVkKVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUuZm9udFNpemUgPSBcIjAuOWVtXCI7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5tYXJnaW5Ub3AgPSBcIjAuMmVtXCI7XG5cbiAgICAvLyBDcmVhdGUgbG9hZGluZyBpbmRpY2F0b3JcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3IgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWxvYWRpbmdcIik7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUucGFkZGluZyA9IFwiMjBweFwiO1xuICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gdGhpcy5sb2FkaW5nSW5kaWNhdG9yLmNyZWF0ZVNwYW4oKTtcbiAgICBsb2FkaW5nVGV4dC5zZXRUZXh0KFwiTG9hZGluZyBwcm9tcHRzLi4uXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGNvbnRlbnQgY29udGFpbmVyXG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWNvbnRlbnQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgY29uc3QgdGV4dEFyZWFDb250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b24gY29udGFpbmVyXG4gICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBjdXN0b20gc2VjdGlvbiAoaGlkZGVuIGJ5IGRlZmF1bHQpXG4gICAgdGhpcy5jdXN0b21TZWN0aW9uID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXNlY3Rpb25cIlxuICAgICk7XG4gICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGNvbnN0IGN1c3RvbUlucHV0Q29udGFpbmVyID0gdGhpcy5jdXN0b21TZWN0aW9uLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1pbnB1dC1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgYSBjb250YWluZXIgZm9yIHRoZSBpbnB1dCBhbmQgYnV0dG9uXG4gICAgY29uc3QgaW5wdXRXcmFwcGVyID0gY3VzdG9tSW5wdXRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtaW5wdXQtd3JhcHBlclwiXG4gICAgKTtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5nYXAgPSBcIjhweFwiO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcblxuICAgIC8vIEFkZCB0aGUgc2VhcmNoIGlucHV0XG4gICAgdGhpcy5jdXN0b21JbnB1dCA9IGlucHV0V3JhcHBlci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoIGZvciBhIHN5c3RlbSBwcm9tcHQgZmlsZS4uLlwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aGUgY3JlYXRlIG5ldyBidXR0b25cbiAgICBjb25zdCBjcmVhdGVCdXR0b24gPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jcmVhdGUtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLnBhZGRpbmcgPSBcIjRweCA4cHhcIjtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI0cHhcIjtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XG4gICAgc2V0SWNvbihjcmVhdGVCdXR0b24sIFwicGx1c1wiKTtcblxuICAgIGNyZWF0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHRlbXBsYXRlQ29udGVudCA9IFwiXCI7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgIGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHMvdGVtcGxhdGVgXG4gICAgICAgICk7XG4gICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggdGVtcGxhdGVcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgdGVtcGxhdGVDb250ZW50ID0gZGF0YS50ZW1wbGF0ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICBcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkNyZWF0ZSBOZXcgU3lzdGVtIFByb21wdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkVudGVyIGEgdGl0bGUgYW5kIGNvbnRlbnQgZm9yIHlvdXIgbmV3IHN5c3RlbSBwcm9tcHQuIFRoZSB0aXRsZSB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGEgbWFya2Rvd24gZmlsZSB0aGF0IHlvdSBjYW4gY3VzdG9taXplIGxhdGVyLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkNyZWF0ZVwiLFxuICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgIGlucHV0czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiTXkgQ3VzdG9tIEFzc2lzdGFudFwiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3lzdGVtc2N1bHB0LXByb21wdC1jcmVhdGlvbi10aXRsZS1pbnB1dFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJ0ZXh0YXJlYVwiLFxuICAgICAgICAgICAgdmFsdWU6IHRlbXBsYXRlQ29udGVudCxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tY29udGVudFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXN1bHQ/LmNvbmZpcm1lZCB8fCAhcmVzdWx0LmlucHV0cz8uWzBdIHx8ICFyZXN1bHQuaW5wdXRzPy5bMV0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbdGl0bGUsIGNvbnRlbnRdID0gcmVzdWx0LmlucHV0cztcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gdGl0bGUucmVwbGFjZSgvW15hLXpBLVowLTktXyBdL2csIFwiXCIpLnJlcGxhY2UoLyAvZywgXCItXCIpO1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLnN5c3RlbVByb21wdHNEaXJlY3Rvcnl9LyR7ZmlsZU5hbWV9YDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdFxuICAgICAgICAgIC5jcmVhdGVGb2xkZXIodGhpcy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5KVxuICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAvKiBEaXJlY3RvcnkgbWlnaHQgYWxyZWFkeSBleGlzdCAqL1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGZpbGVDb250ZW50ID0gYCMgJHt0aXRsZX1cXG5cXG4ke2NvbnRlbnR9YDtcbiAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShmaWxlUGF0aCArIFwiLm1kXCIsIGZpbGVDb250ZW50KTtcblxuICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGZpbGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIHRleHRhcmVhIHdpdGggdGhlIGNvbnRlbnRcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gZmlsZUNvbnRlbnQ7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnB1dCB0byBzaG93IHRoZSBzZWxlY3RlZCBmaWxlXG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSBmaWxlUGF0aDtcblxuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiU3lzdGVtIHByb21wdCBmaWxlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICA6IFwiRmFpbGVkIHRvIGNyZWF0ZSBzeXN0ZW0gcHJvbXB0IGZpbGVcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQXR0YWNoIGZpbGUgc3VnZ2VzdGVyIGZvciBjdXN0b20gcHJvbXB0c1xuICAgIGF0dGFjaEZpbGVTdWdnZXN0ZXIoXG4gICAgICB0aGlzLmN1c3RvbUlucHV0LFxuICAgICAgYXN5bmMgKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChzZWxlY3RlZFBhdGgpO1xuICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWUgd2l0aG91dCAubWQgZXh0ZW5zaW9uXG4gICAgICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gc2VsZWN0ZWRQYXRoLnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVhZGluZyBzeXN0ZW0gcHJvbXB0IGZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XG4gICAgKTtcblxuICAgIHRoaXMudGV4dEFyZWEgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWFcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiRW50ZXIgcG9zdC1wcm9jZXNzaW5nIHByb21wdFwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gdGhpcy5jdXJyZW50UHJvbXB0O1xuXG4gICAgLy8gQWRkIHJlc2l6ZSBvYnNlcnZlciB0byBoYW5kbGUgZHluYW1pYyBjb250ZW50XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGhpcy50ZXh0QXJlYS5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfSk7XG4gICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRleHRBcmVhKTtcblxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IHRoaXMuY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgY29uc3Qgc2Vjb25kYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHNlY29uZGFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlQ2FuY2VsO1xuXG4gICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIlNhdmVcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVTYXZlID0gKCkgPT4ge1xuICAgICAgY29uc3QgYWN0aXZlUHJlc2V0ID0gdGhpcy5wcm9tcHRzLmZpbmQoKHApID0+IHAuaWQgPT09IHRoaXMuYWN0aXZlUHJlc2V0KTtcbiAgICAgIHRoaXMucmVzdWx0ID0ge1xuICAgICAgICBjb250ZW50OiB0aGlzLnRleHRBcmVhLnZhbHVlLFxuICAgICAgICB0eXBlOiAoYWN0aXZlUHJlc2V0Py5pZCB8fCBcImN1c3RvbVwiKSBhcyBcImdlbmVyYWxcIiB8IFwicmh5bWVcIiB8IFwiY3VzdG9tXCIsXG4gICAgICAgIHBhdGg6XG4gICAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPT09IFwiY3VzdG9tXCIgPyB0aGlzLmN1c3RvbUlucHV0LnZhbHVlIDogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHByaW1hcnlCdXR0b24ub25jbGljayA9IGhhbmRsZVNhdmU7XG5cbiAgICAvLyBIYW5kbGUga2V5Ym9hcmQgZXZlbnRzXG4gICAgdGhpcy5tb2RhbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgIWUuaXNDb21wb3NpbmcgJiZcbiAgICAgICAgIWUuc2hpZnRLZXkgJiZcbiAgICAgICAgZS50YXJnZXQgIT09IHRoaXMudGV4dEFyZWFcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVNhdmUoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVDYW5jZWwoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZvY3VzIHRoZSB0ZXh0YXJlYSBhbmQgcGxhY2UgY3Vyc29yIGF0IHRoZSBlbmRcbiAgICB0aGlzLnRleHRBcmVhLmZvY3VzKCk7XG4gICAgdGhpcy50ZXh0QXJlYS5zZXRTZWxlY3Rpb25SYW5nZShcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoLFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGhcbiAgICApO1xuXG4gICAgLy8gU3RhcnQgbG9hZGluZyBwcm9tcHRzIGFmdGVyIFVJIGlzIHNldCB1cFxuICAgIGF3YWl0IHRoaXMubG9hZFByb21wdHMoKTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgaWYgKHRoaXMucmVzb2x2ZVByb21pc2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc29sdmVQcm9taXNlICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuQW5kR2V0VmFsdWUoKTogUHJvbWlzZTxQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsKFxuICBhcHA6IEFwcCxcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IHtcbiAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5Pzogc3RyaW5nO1xuICAgIGN1cnJlbnRDdXN0b21QYXRoPzogc3RyaW5nO1xuICB9XG4pOiBQcm9taXNlPFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHwgbnVsbD4ge1xuICBjb25zdCBtb2RhbCA9IG5ldyBQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsKFxuICAgIGFwcCxcbiAgICBwbHVnaW4sXG4gICAgY3VycmVudFByb21wdCxcbiAgICBvcHRpb25zPy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgIG9wdGlvbnM/LmN1cnJlbnRDdXN0b21QYXRoXG4gICk7XG4gIHJldHVybiBhd2FpdCBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcbn1cbiIsICIvKipcbiAqIERpZmYgTWF0Y2ggYW5kIFBhdGNoXG4gKiBDb3B5cmlnaHQgMjAxOCBUaGUgZGlmZi1tYXRjaC1wYXRjaCBBdXRob3JzLlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9kaWZmLW1hdGNoLXBhdGNoXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ29tcHV0ZXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0d28gdGV4dHMgdG8gY3JlYXRlIGEgcGF0Y2guXG4gKiBBcHBsaWVzIHRoZSBwYXRjaCBvbnRvIGFub3RoZXIgdGV4dCwgYWxsb3dpbmcgZm9yIGVycm9ycy5cbiAqIEBhdXRob3IgZnJhc2VyQGdvb2dsZS5jb20gKE5laWwgRnJhc2VyKVxuICovXG5cbi8qKlxuICogQ2xhc3MgY29udGFpbmluZyB0aGUgZGlmZiwgbWF0Y2ggYW5kIHBhdGNoIG1ldGhvZHMuXG4gKiBAY29uc3RydWN0b3JcbiAqL1xudmFyIGRpZmZfbWF0Y2hfcGF0Y2ggPSBmdW5jdGlvbigpIHtcblxuICAvLyBEZWZhdWx0cy5cbiAgLy8gUmVkZWZpbmUgdGhlc2UgaW4geW91ciBwcm9ncmFtIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0cy5cblxuICAvLyBOdW1iZXIgb2Ygc2Vjb25kcyB0byBtYXAgYSBkaWZmIGJlZm9yZSBnaXZpbmcgdXAgKDAgZm9yIGluZmluaXR5KS5cbiAgdGhpcy5EaWZmX1RpbWVvdXQgPSAxLjA7XG4gIC8vIENvc3Qgb2YgYW4gZW1wdHkgZWRpdCBvcGVyYXRpb24gaW4gdGVybXMgb2YgZWRpdCBjaGFyYWN0ZXJzLlxuICB0aGlzLkRpZmZfRWRpdENvc3QgPSA0O1xuICAvLyBBdCB3aGF0IHBvaW50IGlzIG5vIG1hdGNoIGRlY2xhcmVkICgwLjAgPSBwZXJmZWN0aW9uLCAxLjAgPSB2ZXJ5IGxvb3NlKS5cbiAgdGhpcy5NYXRjaF9UaHJlc2hvbGQgPSAwLjU7XG4gIC8vIEhvdyBmYXIgdG8gc2VhcmNoIGZvciBhIG1hdGNoICgwID0gZXhhY3QgbG9jYXRpb24sIDEwMDArID0gYnJvYWQgbWF0Y2gpLlxuICAvLyBBIG1hdGNoIHRoaXMgbWFueSBjaGFyYWN0ZXJzIGF3YXkgZnJvbSB0aGUgZXhwZWN0ZWQgbG9jYXRpb24gd2lsbCBhZGRcbiAgLy8gMS4wIHRvIHRoZSBzY29yZSAoMC4wIGlzIGEgcGVyZmVjdCBtYXRjaCkuXG4gIHRoaXMuTWF0Y2hfRGlzdGFuY2UgPSAxMDAwO1xuICAvLyBXaGVuIGRlbGV0aW5nIGEgbGFyZ2UgYmxvY2sgb2YgdGV4dCAob3ZlciB+NjQgY2hhcmFjdGVycyksIGhvdyBjbG9zZSBkb1xuICAvLyB0aGUgY29udGVudHMgaGF2ZSB0byBiZSB0byBtYXRjaCB0aGUgZXhwZWN0ZWQgY29udGVudHMuICgwLjAgPSBwZXJmZWN0aW9uLFxuICAvLyAxLjAgPSB2ZXJ5IGxvb3NlKS4gIE5vdGUgdGhhdCBNYXRjaF9UaHJlc2hvbGQgY29udHJvbHMgaG93IGNsb3NlbHkgdGhlXG4gIC8vIGVuZCBwb2ludHMgb2YgYSBkZWxldGUgbmVlZCB0byBtYXRjaC5cbiAgdGhpcy5QYXRjaF9EZWxldGVUaHJlc2hvbGQgPSAwLjU7XG4gIC8vIENodW5rIHNpemUgZm9yIGNvbnRleHQgbGVuZ3RoLlxuICB0aGlzLlBhdGNoX01hcmdpbiA9IDQ7XG5cbiAgLy8gVGhlIG51bWJlciBvZiBiaXRzIGluIGFuIGludC5cbiAgdGhpcy5NYXRjaF9NYXhCaXRzID0gMzI7XG59O1xuXG5cbi8vICBESUZGIEZVTkNUSU9OU1xuXG5cbi8qKlxuICogVGhlIGRhdGEgc3RydWN0dXJlIHJlcHJlc2VudGluZyBhIGRpZmYgaXMgYW4gYXJyYXkgb2YgdHVwbGVzOlxuICogW1tESUZGX0RFTEVURSwgJ0hlbGxvJ10sIFtESUZGX0lOU0VSVCwgJ0dvb2RieWUnXSwgW0RJRkZfRVFVQUwsICcgd29ybGQuJ11dXG4gKiB3aGljaCBtZWFuczogZGVsZXRlICdIZWxsbycsIGFkZCAnR29vZGJ5ZScgYW5kIGtlZXAgJyB3b3JsZC4nXG4gKi9cbnZhciBESUZGX0RFTEVURSA9IC0xO1xudmFyIERJRkZfSU5TRVJUID0gMTtcbnZhciBESUZGX0VRVUFMID0gMDtcblxuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgb25lIGRpZmYgdHVwbGUuXG4gKiB+QXR0ZW1wdHMgdG8gbG9vayBsaWtlIGEgdHdvLWVsZW1lbnQgYXJyYXkgKHdoaWNoIGlzIHdoYXQgdGhpcyB1c2VkIHRvIGJlKS5+XG4gKiBDb25zdHJ1Y3RvciByZXR1cm5zIGFuIGFjdHVhbCB0d28tZWxlbWVudCBhcnJheSwgdG8gYWxsb3cgZGVzdHJ1Y3RpbmcgQEphY2t1QlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9KYWNrdUIvZGlmZi1tYXRjaC1wYXRjaC9pc3N1ZXMvMTQgZm9yIGRldGFpbHNcbiAqIEBwYXJhbSB7bnVtYmVyfSBvcCBPcGVyYXRpb24sIG9uZSBvZjogRElGRl9ERUxFVEUsIERJRkZfSU5TRVJULCBESUZGX0VRVUFMLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGV4dCB0byBiZSBkZWxldGVkLCBpbnNlcnRlZCwgb3IgcmV0YWluZWQuXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5EaWZmID0gZnVuY3Rpb24ob3AsIHRleHQpIHtcbiAgcmV0dXJuIFtvcCwgdGV4dF07XG59O1xuXG4vKipcbiAqIEZpbmQgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gdHdvIHRleHRzLiAgU2ltcGxpZmllcyB0aGUgcHJvYmxlbSBieSBzdHJpcHBpbmdcbiAqIGFueSBjb21tb24gcHJlZml4IG9yIHN1ZmZpeCBvZmYgdGhlIHRleHRzIGJlZm9yZSBkaWZmaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIE9sZCBzdHJpbmcgdG8gYmUgZGlmZmVkLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQyIE5ldyBzdHJpbmcgdG8gYmUgZGlmZmVkLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2NoZWNrbGluZXMgT3B0aW9uYWwgc3BlZWR1cCBmbGFnLiBJZiBwcmVzZW50IGFuZCBmYWxzZSxcbiAqICAgICB0aGVuIGRvbid0IHJ1biBhIGxpbmUtbGV2ZWwgZGlmZiBmaXJzdCB0byBpZGVudGlmeSB0aGUgY2hhbmdlZCBhcmVhcy5cbiAqICAgICBEZWZhdWx0cyB0byB0cnVlLCB3aGljaCBkb2VzIGEgZmFzdGVyLCBzbGlnaHRseSBsZXNzIG9wdGltYWwgZGlmZi5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2RlYWRsaW5lIE9wdGlvbmFsIHRpbWUgd2hlbiB0aGUgZGlmZiBzaG91bGQgYmUgY29tcGxldGVcbiAqICAgICBieS4gIFVzZWQgaW50ZXJuYWxseSBmb3IgcmVjdXJzaXZlIGNhbGxzLiAgVXNlcnMgc2hvdWxkIHNldCBEaWZmVGltZW91dFxuICogICAgIGluc3RlYWQuXG4gKiBAcmV0dXJuIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9tYWluID0gZnVuY3Rpb24odGV4dDEsIHRleHQyLCBvcHRfY2hlY2tsaW5lcyxcbiAgICBvcHRfZGVhZGxpbmUpIHtcbiAgLy8gU2V0IGEgZGVhZGxpbmUgYnkgd2hpY2ggdGltZSB0aGUgZGlmZiBtdXN0IGJlIGNvbXBsZXRlLlxuICBpZiAodHlwZW9mIG9wdF9kZWFkbGluZSA9PSAndW5kZWZpbmVkJykge1xuICAgIGlmICh0aGlzLkRpZmZfVGltZW91dCA8PSAwKSB7XG4gICAgICBvcHRfZGVhZGxpbmUgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcHRfZGVhZGxpbmUgPSAobmV3IERhdGUpLmdldFRpbWUoKSArIHRoaXMuRGlmZl9UaW1lb3V0ICogMTAwMDtcbiAgICB9XG4gIH1cbiAgdmFyIGRlYWRsaW5lID0gb3B0X2RlYWRsaW5lO1xuXG4gIC8vIENoZWNrIGZvciBudWxsIGlucHV0cy5cbiAgaWYgKHRleHQxID09IG51bGwgfHwgdGV4dDIgPT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTnVsbCBpbnB1dC4gKGRpZmZfbWFpbiknKTtcbiAgfVxuXG4gIC8vIENoZWNrIGZvciBlcXVhbGl0eSAoc3BlZWR1cCkuXG4gIGlmICh0ZXh0MSA9PSB0ZXh0Mikge1xuICAgIGlmICh0ZXh0MSkge1xuICAgICAgcmV0dXJuIFtuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIHRleHQxKV07XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygb3B0X2NoZWNrbGluZXMgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBvcHRfY2hlY2tsaW5lcyA9IHRydWU7XG4gIH1cbiAgdmFyIGNoZWNrbGluZXMgPSBvcHRfY2hlY2tsaW5lcztcblxuICAvLyBUcmltIG9mZiBjb21tb24gcHJlZml4IChzcGVlZHVwKS5cbiAgdmFyIGNvbW1vbmxlbmd0aCA9IHRoaXMuZGlmZl9jb21tb25QcmVmaXgodGV4dDEsIHRleHQyKTtcbiAgdmFyIGNvbW1vbnByZWZpeCA9IHRleHQxLnN1YnN0cmluZygwLCBjb21tb25sZW5ndGgpO1xuICB0ZXh0MSA9IHRleHQxLnN1YnN0cmluZyhjb21tb25sZW5ndGgpO1xuICB0ZXh0MiA9IHRleHQyLnN1YnN0cmluZyhjb21tb25sZW5ndGgpO1xuXG4gIC8vIFRyaW0gb2ZmIGNvbW1vbiBzdWZmaXggKHNwZWVkdXApLlxuICBjb21tb25sZW5ndGggPSB0aGlzLmRpZmZfY29tbW9uU3VmZml4KHRleHQxLCB0ZXh0Mik7XG4gIHZhciBjb21tb25zdWZmaXggPSB0ZXh0MS5zdWJzdHJpbmcodGV4dDEubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKTtcbiAgdGV4dDEgPSB0ZXh0MS5zdWJzdHJpbmcoMCwgdGV4dDEubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKTtcbiAgdGV4dDIgPSB0ZXh0Mi5zdWJzdHJpbmcoMCwgdGV4dDIubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKTtcblxuICAvLyBDb21wdXRlIHRoZSBkaWZmIG9uIHRoZSBtaWRkbGUgYmxvY2suXG4gIHZhciBkaWZmcyA9IHRoaXMuZGlmZl9jb21wdXRlXyh0ZXh0MSwgdGV4dDIsIGNoZWNrbGluZXMsIGRlYWRsaW5lKTtcblxuICAvLyBSZXN0b3JlIHRoZSBwcmVmaXggYW5kIHN1ZmZpeC5cbiAgaWYgKGNvbW1vbnByZWZpeCkge1xuICAgIGRpZmZzLnVuc2hpZnQobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBjb21tb25wcmVmaXgpKTtcbiAgfVxuICBpZiAoY29tbW9uc3VmZml4KSB7XG4gICAgZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGNvbW1vbnN1ZmZpeCkpO1xuICB9XG4gIHRoaXMuZGlmZl9jbGVhbnVwTWVyZ2UoZGlmZnMpO1xuICByZXR1cm4gZGlmZnM7XG59O1xuXG5cbi8qKlxuICogRmluZCB0aGUgZGlmZmVyZW5jZXMgYmV0d2VlbiB0d28gdGV4dHMuICBBc3N1bWVzIHRoYXQgdGhlIHRleHRzIGRvIG5vdFxuICogaGF2ZSBhbnkgY29tbW9uIHByZWZpeCBvciBzdWZmaXguXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDEgT2xkIHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDIgTmV3IHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNoZWNrbGluZXMgU3BlZWR1cCBmbGFnLiAgSWYgZmFsc2UsIHRoZW4gZG9uJ3QgcnVuIGFcbiAqICAgICBsaW5lLWxldmVsIGRpZmYgZmlyc3QgdG8gaWRlbnRpZnkgdGhlIGNoYW5nZWQgYXJlYXMuXG4gKiAgICAgSWYgdHJ1ZSwgdGhlbiBydW4gYSBmYXN0ZXIsIHNsaWdodGx5IGxlc3Mgb3B0aW1hbCBkaWZmLlxuICogQHBhcmFtIHtudW1iZXJ9IGRlYWRsaW5lIFRpbWUgd2hlbiB0aGUgZGlmZiBzaG91bGQgYmUgY29tcGxldGUgYnkuXG4gKiBAcmV0dXJuIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqIEBwcml2YXRlXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY29tcHV0ZV8gPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIsIGNoZWNrbGluZXMsXG4gICAgZGVhZGxpbmUpIHtcbiAgdmFyIGRpZmZzO1xuXG4gIGlmICghdGV4dDEpIHtcbiAgICAvLyBKdXN0IGFkZCBzb21lIHRleHQgKHNwZWVkdXApLlxuICAgIHJldHVybiBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0lOU0VSVCwgdGV4dDIpXTtcbiAgfVxuXG4gIGlmICghdGV4dDIpIHtcbiAgICAvLyBKdXN0IGRlbGV0ZSBzb21lIHRleHQgKHNwZWVkdXApLlxuICAgIHJldHVybiBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0RFTEVURSwgdGV4dDEpXTtcbiAgfVxuXG4gIHZhciBsb25ndGV4dCA9IHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCA/IHRleHQxIDogdGV4dDI7XG4gIHZhciBzaG9ydHRleHQgPSB0ZXh0MS5sZW5ndGggPiB0ZXh0Mi5sZW5ndGggPyB0ZXh0MiA6IHRleHQxO1xuICB2YXIgaSA9IGxvbmd0ZXh0LmluZGV4T2Yoc2hvcnR0ZXh0KTtcbiAgaWYgKGkgIT0gLTEpIHtcbiAgICAvLyBTaG9ydGVyIHRleHQgaXMgaW5zaWRlIHRoZSBsb25nZXIgdGV4dCAoc3BlZWR1cCkuXG4gICAgZGlmZnMgPSBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0lOU0VSVCwgbG9uZ3RleHQuc3Vic3RyaW5nKDAsIGkpKSxcbiAgICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIHNob3J0dGV4dCksXG4gICAgICAgICAgICAgbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0lOU0VSVCxcbiAgICAgICAgICAgICAgICAgbG9uZ3RleHQuc3Vic3RyaW5nKGkgKyBzaG9ydHRleHQubGVuZ3RoKSldO1xuICAgIC8vIFN3YXAgaW5zZXJ0aW9ucyBmb3IgZGVsZXRpb25zIGlmIGRpZmYgaXMgcmV2ZXJzZWQuXG4gICAgaWYgKHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCkge1xuICAgICAgZGlmZnNbMF1bMF0gPSBkaWZmc1syXVswXSA9IERJRkZfREVMRVRFO1xuICAgIH1cbiAgICByZXR1cm4gZGlmZnM7XG4gIH1cblxuICBpZiAoc2hvcnR0ZXh0Lmxlbmd0aCA9PSAxKSB7XG4gICAgLy8gU2luZ2xlIGNoYXJhY3RlciBzdHJpbmcuXG4gICAgLy8gQWZ0ZXIgdGhlIHByZXZpb3VzIHNwZWVkdXAsIHRoZSBjaGFyYWN0ZXIgY2FuJ3QgYmUgYW4gZXF1YWxpdHkuXG4gICAgcmV0dXJuIFtuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfREVMRVRFLCB0ZXh0MSksXG4gICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCB0ZXh0MildO1xuICB9XG5cbiAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBwcm9ibGVtIGNhbiBiZSBzcGxpdCBpbiB0d28uXG4gIHZhciBobSA9IHRoaXMuZGlmZl9oYWxmTWF0Y2hfKHRleHQxLCB0ZXh0Mik7XG4gIGlmIChobSkge1xuICAgIC8vIEEgaGFsZi1tYXRjaCB3YXMgZm91bmQsIHNvcnQgb3V0IHRoZSByZXR1cm4gZGF0YS5cbiAgICB2YXIgdGV4dDFfYSA9IGhtWzBdO1xuICAgIHZhciB0ZXh0MV9iID0gaG1bMV07XG4gICAgdmFyIHRleHQyX2EgPSBobVsyXTtcbiAgICB2YXIgdGV4dDJfYiA9IGhtWzNdO1xuICAgIHZhciBtaWRfY29tbW9uID0gaG1bNF07XG4gICAgLy8gU2VuZCBib3RoIHBhaXJzIG9mZiBmb3Igc2VwYXJhdGUgcHJvY2Vzc2luZy5cbiAgICB2YXIgZGlmZnNfYSA9IHRoaXMuZGlmZl9tYWluKHRleHQxX2EsIHRleHQyX2EsIGNoZWNrbGluZXMsIGRlYWRsaW5lKTtcbiAgICB2YXIgZGlmZnNfYiA9IHRoaXMuZGlmZl9tYWluKHRleHQxX2IsIHRleHQyX2IsIGNoZWNrbGluZXMsIGRlYWRsaW5lKTtcbiAgICAvLyBNZXJnZSB0aGUgcmVzdWx0cy5cbiAgICByZXR1cm4gZGlmZnNfYS5jb25jYXQoW25ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgbWlkX2NvbW1vbildLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmc19iKTtcbiAgfVxuXG4gIGlmIChjaGVja2xpbmVzICYmIHRleHQxLmxlbmd0aCA+IDEwMCAmJiB0ZXh0Mi5sZW5ndGggPiAxMDApIHtcbiAgICByZXR1cm4gdGhpcy5kaWZmX2xpbmVNb2RlXyh0ZXh0MSwgdGV4dDIsIGRlYWRsaW5lKTtcbiAgfVxuXG4gIHJldHVybiB0aGlzLmRpZmZfYmlzZWN0Xyh0ZXh0MSwgdGV4dDIsIGRlYWRsaW5lKTtcbn07XG5cblxuLyoqXG4gKiBEbyBhIHF1aWNrIGxpbmUtbGV2ZWwgZGlmZiBvbiBib3RoIHN0cmluZ3MsIHRoZW4gcmVkaWZmIHRoZSBwYXJ0cyBmb3JcbiAqIGdyZWF0ZXIgYWNjdXJhY3kuXG4gKiBUaGlzIHNwZWVkdXAgY2FuIHByb2R1Y2Ugbm9uLW1pbmltYWwgZGlmZnMuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDEgT2xkIHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDIgTmV3IHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gZGVhZGxpbmUgVGltZSB3aGVuIHRoZSBkaWZmIHNob3VsZCBiZSBjb21wbGV0ZSBieS5cbiAqIEByZXR1cm4geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59IEFycmF5IG9mIGRpZmYgdHVwbGVzLlxuICogQHByaXZhdGVcbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9saW5lTW9kZV8gPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIsIGRlYWRsaW5lKSB7XG4gIC8vIFNjYW4gdGhlIHRleHQgb24gYSBsaW5lLWJ5LWxpbmUgYmFzaXMgZmlyc3QuXG4gIHZhciBhID0gdGhpcy5kaWZmX2xpbmVzVG9DaGFyc18odGV4dDEsIHRleHQyKTtcbiAgdGV4dDEgPSBhLmNoYXJzMTtcbiAgdGV4dDIgPSBhLmNoYXJzMjtcbiAgdmFyIGxpbmVhcnJheSA9IGEubGluZUFycmF5O1xuXG4gIHZhciBkaWZmcyA9IHRoaXMuZGlmZl9tYWluKHRleHQxLCB0ZXh0MiwgZmFsc2UsIGRlYWRsaW5lKTtcblxuICAvLyBDb252ZXJ0IHRoZSBkaWZmIGJhY2sgdG8gb3JpZ2luYWwgdGV4dC5cbiAgdGhpcy5kaWZmX2NoYXJzVG9MaW5lc18oZGlmZnMsIGxpbmVhcnJheSk7XG4gIC8vIEVsaW1pbmF0ZSBmcmVhayBtYXRjaGVzIChlLmcuIGJsYW5rIGxpbmVzKVxuICB0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljKGRpZmZzKTtcblxuICAvLyBSZWRpZmYgYW55IHJlcGxhY2VtZW50IGJsb2NrcywgdGhpcyB0aW1lIGNoYXJhY3Rlci1ieS1jaGFyYWN0ZXIuXG4gIC8vIEFkZCBhIGR1bW15IGVudHJ5IGF0IHRoZSBlbmQuXG4gIGRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCAnJykpO1xuICB2YXIgcG9pbnRlciA9IDA7XG4gIHZhciBjb3VudF9kZWxldGUgPSAwO1xuICB2YXIgY291bnRfaW5zZXJ0ID0gMDtcbiAgdmFyIHRleHRfZGVsZXRlID0gJyc7XG4gIHZhciB0ZXh0X2luc2VydCA9ICcnO1xuICB3aGlsZSAocG9pbnRlciA8IGRpZmZzLmxlbmd0aCkge1xuICAgIHN3aXRjaCAoZGlmZnNbcG9pbnRlcl1bMF0pIHtcbiAgICAgIGNhc2UgRElGRl9JTlNFUlQ6XG4gICAgICAgIGNvdW50X2luc2VydCsrO1xuICAgICAgICB0ZXh0X2luc2VydCArPSBkaWZmc1twb2ludGVyXVsxXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfREVMRVRFOlxuICAgICAgICBjb3VudF9kZWxldGUrKztcbiAgICAgICAgdGV4dF9kZWxldGUgKz0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAvLyBVcG9uIHJlYWNoaW5nIGFuIGVxdWFsaXR5LCBjaGVjayBmb3IgcHJpb3IgcmVkdW5kYW5jaWVzLlxuICAgICAgICBpZiAoY291bnRfZGVsZXRlID49IDEgJiYgY291bnRfaW5zZXJ0ID49IDEpIHtcbiAgICAgICAgICAvLyBEZWxldGUgdGhlIG9mZmVuZGluZyByZWNvcmRzIGFuZCBhZGQgdGhlIG1lcmdlZCBvbmVzLlxuICAgICAgICAgIGRpZmZzLnNwbGljZShwb2ludGVyIC0gY291bnRfZGVsZXRlIC0gY291bnRfaW5zZXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICBjb3VudF9kZWxldGUgKyBjb3VudF9pbnNlcnQpO1xuICAgICAgICAgIHBvaW50ZXIgPSBwb2ludGVyIC0gY291bnRfZGVsZXRlIC0gY291bnRfaW5zZXJ0O1xuICAgICAgICAgIHZhciBzdWJEaWZmID1cbiAgICAgICAgICAgICAgdGhpcy5kaWZmX21haW4odGV4dF9kZWxldGUsIHRleHRfaW5zZXJ0LCBmYWxzZSwgZGVhZGxpbmUpO1xuICAgICAgICAgIGZvciAodmFyIGogPSBzdWJEaWZmLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XG4gICAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciwgMCwgc3ViRGlmZltqXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBvaW50ZXIgPSBwb2ludGVyICsgc3ViRGlmZi5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgY291bnRfaW5zZXJ0ID0gMDtcbiAgICAgICAgY291bnRfZGVsZXRlID0gMDtcbiAgICAgICAgdGV4dF9kZWxldGUgPSAnJztcbiAgICAgICAgdGV4dF9pbnNlcnQgPSAnJztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHBvaW50ZXIrKztcbiAgfVxuICBkaWZmcy5wb3AoKTsgIC8vIFJlbW92ZSB0aGUgZHVtbXkgZW50cnkgYXQgdGhlIGVuZC5cblxuICByZXR1cm4gZGlmZnM7XG59O1xuXG5cbi8qKlxuICogRmluZCB0aGUgJ21pZGRsZSBzbmFrZScgb2YgYSBkaWZmLCBzcGxpdCB0aGUgcHJvYmxlbSBpbiB0d29cbiAqIGFuZCByZXR1cm4gdGhlIHJlY3Vyc2l2ZWx5IGNvbnN0cnVjdGVkIGRpZmYuXG4gKiBTZWUgTXllcnMgMTk4NiBwYXBlcjogQW4gTyhORCkgRGlmZmVyZW5jZSBBbGdvcml0aG0gYW5kIEl0cyBWYXJpYXRpb25zLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIE9sZCBzdHJpbmcgdG8gYmUgZGlmZmVkLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQyIE5ldyBzdHJpbmcgdG8gYmUgZGlmZmVkLlxuICogQHBhcmFtIHtudW1iZXJ9IGRlYWRsaW5lIFRpbWUgYXQgd2hpY2ggdG8gYmFpbCBpZiBub3QgeWV0IGNvbXBsZXRlLlxuICogQHJldHVybiB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gQXJyYXkgb2YgZGlmZiB0dXBsZXMuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2Jpc2VjdF8gPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIsIGRlYWRsaW5lKSB7XG4gIC8vIENhY2hlIHRoZSB0ZXh0IGxlbmd0aHMgdG8gcHJldmVudCBtdWx0aXBsZSBjYWxscy5cbiAgdmFyIHRleHQxX2xlbmd0aCA9IHRleHQxLmxlbmd0aDtcbiAgdmFyIHRleHQyX2xlbmd0aCA9IHRleHQyLmxlbmd0aDtcbiAgdmFyIG1heF9kID0gTWF0aC5jZWlsKCh0ZXh0MV9sZW5ndGggKyB0ZXh0Ml9sZW5ndGgpIC8gMik7XG4gIHZhciB2X29mZnNldCA9IG1heF9kO1xuICB2YXIgdl9sZW5ndGggPSAyICogbWF4X2Q7XG4gIHZhciB2MSA9IG5ldyBBcnJheSh2X2xlbmd0aCk7XG4gIHZhciB2MiA9IG5ldyBBcnJheSh2X2xlbmd0aCk7XG4gIC8vIFNldHRpbmcgYWxsIGVsZW1lbnRzIHRvIC0xIGlzIGZhc3RlciBpbiBDaHJvbWUgJiBGaXJlZm94IHRoYW4gbWl4aW5nXG4gIC8vIGludGVnZXJzIGFuZCB1bmRlZmluZWQuXG4gIGZvciAodmFyIHggPSAwOyB4IDwgdl9sZW5ndGg7IHgrKykge1xuICAgIHYxW3hdID0gLTE7XG4gICAgdjJbeF0gPSAtMTtcbiAgfVxuICB2MVt2X29mZnNldCArIDFdID0gMDtcbiAgdjJbdl9vZmZzZXQgKyAxXSA9IDA7XG4gIHZhciBkZWx0YSA9IHRleHQxX2xlbmd0aCAtIHRleHQyX2xlbmd0aDtcbiAgLy8gSWYgdGhlIHRvdGFsIG51bWJlciBvZiBjaGFyYWN0ZXJzIGlzIG9kZCwgdGhlbiB0aGUgZnJvbnQgcGF0aCB3aWxsIGNvbGxpZGVcbiAgLy8gd2l0aCB0aGUgcmV2ZXJzZSBwYXRoLlxuICB2YXIgZnJvbnQgPSAoZGVsdGEgJSAyICE9IDApO1xuICAvLyBPZmZzZXRzIGZvciBzdGFydCBhbmQgZW5kIG9mIGsgbG9vcC5cbiAgLy8gUHJldmVudHMgbWFwcGluZyBvZiBzcGFjZSBiZXlvbmQgdGhlIGdyaWQuXG4gIHZhciBrMXN0YXJ0ID0gMDtcbiAgdmFyIGsxZW5kID0gMDtcbiAgdmFyIGsyc3RhcnQgPSAwO1xuICB2YXIgazJlbmQgPSAwO1xuICBmb3IgKHZhciBkID0gMDsgZCA8IG1heF9kOyBkKyspIHtcbiAgICAvLyBCYWlsIG91dCBpZiBkZWFkbGluZSBpcyByZWFjaGVkLlxuICAgIGlmICgobmV3IERhdGUoKSkuZ2V0VGltZSgpID4gZGVhZGxpbmUpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIFdhbGsgdGhlIGZyb250IHBhdGggb25lIHN0ZXAuXG4gICAgZm9yICh2YXIgazEgPSAtZCArIGsxc3RhcnQ7IGsxIDw9IGQgLSBrMWVuZDsgazEgKz0gMikge1xuICAgICAgdmFyIGsxX29mZnNldCA9IHZfb2Zmc2V0ICsgazE7XG4gICAgICB2YXIgeDE7XG4gICAgICBpZiAoazEgPT0gLWQgfHwgKGsxICE9IGQgJiYgdjFbazFfb2Zmc2V0IC0gMV0gPCB2MVtrMV9vZmZzZXQgKyAxXSkpIHtcbiAgICAgICAgeDEgPSB2MVtrMV9vZmZzZXQgKyAxXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHgxID0gdjFbazFfb2Zmc2V0IC0gMV0gKyAxO1xuICAgICAgfVxuICAgICAgdmFyIHkxID0geDEgLSBrMTtcbiAgICAgIHdoaWxlICh4MSA8IHRleHQxX2xlbmd0aCAmJiB5MSA8IHRleHQyX2xlbmd0aCAmJlxuICAgICAgICAgICAgIHRleHQxLmNoYXJBdCh4MSkgPT0gdGV4dDIuY2hhckF0KHkxKSkge1xuICAgICAgICB4MSsrO1xuICAgICAgICB5MSsrO1xuICAgICAgfVxuICAgICAgdjFbazFfb2Zmc2V0XSA9IHgxO1xuICAgICAgaWYgKHgxID4gdGV4dDFfbGVuZ3RoKSB7XG4gICAgICAgIC8vIFJhbiBvZmYgdGhlIHJpZ2h0IG9mIHRoZSBncmFwaC5cbiAgICAgICAgazFlbmQgKz0gMjtcbiAgICAgIH0gZWxzZSBpZiAoeTEgPiB0ZXh0Ml9sZW5ndGgpIHtcbiAgICAgICAgLy8gUmFuIG9mZiB0aGUgYm90dG9tIG9mIHRoZSBncmFwaC5cbiAgICAgICAgazFzdGFydCArPSAyO1xuICAgICAgfSBlbHNlIGlmIChmcm9udCkge1xuICAgICAgICB2YXIgazJfb2Zmc2V0ID0gdl9vZmZzZXQgKyBkZWx0YSAtIGsxO1xuICAgICAgICBpZiAoazJfb2Zmc2V0ID49IDAgJiYgazJfb2Zmc2V0IDwgdl9sZW5ndGggJiYgdjJbazJfb2Zmc2V0XSAhPSAtMSkge1xuICAgICAgICAgIC8vIE1pcnJvciB4MiBvbnRvIHRvcC1sZWZ0IGNvb3JkaW5hdGUgc3lzdGVtLlxuICAgICAgICAgIHZhciB4MiA9IHRleHQxX2xlbmd0aCAtIHYyW2syX29mZnNldF07XG4gICAgICAgICAgaWYgKHgxID49IHgyKSB7XG4gICAgICAgICAgICAvLyBPdmVybGFwIGRldGVjdGVkLlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlmZl9iaXNlY3RTcGxpdF8odGV4dDEsIHRleHQyLCB4MSwgeTEsIGRlYWRsaW5lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBXYWxrIHRoZSByZXZlcnNlIHBhdGggb25lIHN0ZXAuXG4gICAgZm9yICh2YXIgazIgPSAtZCArIGsyc3RhcnQ7IGsyIDw9IGQgLSBrMmVuZDsgazIgKz0gMikge1xuICAgICAgdmFyIGsyX29mZnNldCA9IHZfb2Zmc2V0ICsgazI7XG4gICAgICB2YXIgeDI7XG4gICAgICBpZiAoazIgPT0gLWQgfHwgKGsyICE9IGQgJiYgdjJbazJfb2Zmc2V0IC0gMV0gPCB2MltrMl9vZmZzZXQgKyAxXSkpIHtcbiAgICAgICAgeDIgPSB2MltrMl9vZmZzZXQgKyAxXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHgyID0gdjJbazJfb2Zmc2V0IC0gMV0gKyAxO1xuICAgICAgfVxuICAgICAgdmFyIHkyID0geDIgLSBrMjtcbiAgICAgIHdoaWxlICh4MiA8IHRleHQxX2xlbmd0aCAmJiB5MiA8IHRleHQyX2xlbmd0aCAmJlxuICAgICAgICAgICAgIHRleHQxLmNoYXJBdCh0ZXh0MV9sZW5ndGggLSB4MiAtIDEpID09XG4gICAgICAgICAgICAgdGV4dDIuY2hhckF0KHRleHQyX2xlbmd0aCAtIHkyIC0gMSkpIHtcbiAgICAgICAgeDIrKztcbiAgICAgICAgeTIrKztcbiAgICAgIH1cbiAgICAgIHYyW2syX29mZnNldF0gPSB4MjtcbiAgICAgIGlmICh4MiA+IHRleHQxX2xlbmd0aCkge1xuICAgICAgICAvLyBSYW4gb2ZmIHRoZSBsZWZ0IG9mIHRoZSBncmFwaC5cbiAgICAgICAgazJlbmQgKz0gMjtcbiAgICAgIH0gZWxzZSBpZiAoeTIgPiB0ZXh0Ml9sZW5ndGgpIHtcbiAgICAgICAgLy8gUmFuIG9mZiB0aGUgdG9wIG9mIHRoZSBncmFwaC5cbiAgICAgICAgazJzdGFydCArPSAyO1xuICAgICAgfSBlbHNlIGlmICghZnJvbnQpIHtcbiAgICAgICAgdmFyIGsxX29mZnNldCA9IHZfb2Zmc2V0ICsgZGVsdGEgLSBrMjtcbiAgICAgICAgaWYgKGsxX29mZnNldCA+PSAwICYmIGsxX29mZnNldCA8IHZfbGVuZ3RoICYmIHYxW2sxX29mZnNldF0gIT0gLTEpIHtcbiAgICAgICAgICB2YXIgeDEgPSB2MVtrMV9vZmZzZXRdO1xuICAgICAgICAgIHZhciB5MSA9IHZfb2Zmc2V0ICsgeDEgLSBrMV9vZmZzZXQ7XG4gICAgICAgICAgLy8gTWlycm9yIHgyIG9udG8gdG9wLWxlZnQgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gICAgICAgICAgeDIgPSB0ZXh0MV9sZW5ndGggLSB4MjtcbiAgICAgICAgICBpZiAoeDEgPj0geDIpIHtcbiAgICAgICAgICAgIC8vIE92ZXJsYXAgZGV0ZWN0ZWQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaWZmX2Jpc2VjdFNwbGl0Xyh0ZXh0MSwgdGV4dDIsIHgxLCB5MSwgZGVhZGxpbmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBEaWZmIHRvb2sgdG9vIGxvbmcgYW5kIGhpdCB0aGUgZGVhZGxpbmUgb3JcbiAgLy8gbnVtYmVyIG9mIGRpZmZzIGVxdWFscyBudW1iZXIgb2YgY2hhcmFjdGVycywgbm8gY29tbW9uYWxpdHkgYXQgYWxsLlxuICByZXR1cm4gW25ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIHRleHQxKSxcbiAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCB0ZXh0MildO1xufTtcblxuXG4vKipcbiAqIEdpdmVuIHRoZSBsb2NhdGlvbiBvZiB0aGUgJ21pZGRsZSBzbmFrZScsIHNwbGl0IHRoZSBkaWZmIGluIHR3byBwYXJ0c1xuICogYW5kIHJlY3Vyc2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDEgT2xkIHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDIgTmV3IHN0cmluZyB0byBiZSBkaWZmZWQuXG4gKiBAcGFyYW0ge251bWJlcn0geCBJbmRleCBvZiBzcGxpdCBwb2ludCBpbiB0ZXh0MS5cbiAqIEBwYXJhbSB7bnVtYmVyfSB5IEluZGV4IG9mIHNwbGl0IHBvaW50IGluIHRleHQyLlxuICogQHBhcmFtIHtudW1iZXJ9IGRlYWRsaW5lIFRpbWUgYXQgd2hpY2ggdG8gYmFpbCBpZiBub3QgeWV0IGNvbXBsZXRlLlxuICogQHJldHVybiB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gQXJyYXkgb2YgZGlmZiB0dXBsZXMuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2Jpc2VjdFNwbGl0XyA9IGZ1bmN0aW9uKHRleHQxLCB0ZXh0MiwgeCwgeSxcbiAgICBkZWFkbGluZSkge1xuICB2YXIgdGV4dDFhID0gdGV4dDEuc3Vic3RyaW5nKDAsIHgpO1xuICB2YXIgdGV4dDJhID0gdGV4dDIuc3Vic3RyaW5nKDAsIHkpO1xuICB2YXIgdGV4dDFiID0gdGV4dDEuc3Vic3RyaW5nKHgpO1xuICB2YXIgdGV4dDJiID0gdGV4dDIuc3Vic3RyaW5nKHkpO1xuXG4gIC8vIENvbXB1dGUgYm90aCBkaWZmcyBzZXJpYWxseS5cbiAgdmFyIGRpZmZzID0gdGhpcy5kaWZmX21haW4odGV4dDFhLCB0ZXh0MmEsIGZhbHNlLCBkZWFkbGluZSk7XG4gIHZhciBkaWZmc2IgPSB0aGlzLmRpZmZfbWFpbih0ZXh0MWIsIHRleHQyYiwgZmFsc2UsIGRlYWRsaW5lKTtcblxuICByZXR1cm4gZGlmZnMuY29uY2F0KGRpZmZzYik7XG59O1xuXG5cbi8qKlxuICogU3BsaXQgdHdvIHRleHRzIGludG8gYW4gYXJyYXkgb2Ygc3RyaW5ncy4gIFJlZHVjZSB0aGUgdGV4dHMgdG8gYSBzdHJpbmcgb2ZcbiAqIGhhc2hlcyB3aGVyZSBlYWNoIFVuaWNvZGUgY2hhcmFjdGVyIHJlcHJlc2VudHMgb25lIGxpbmUuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDEgRmlyc3Qgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQyIFNlY29uZCBzdHJpbmcuXG4gKiBAcmV0dXJuIHt7Y2hhcnMxOiBzdHJpbmcsIGNoYXJzMjogc3RyaW5nLCBsaW5lQXJyYXk6ICFBcnJheS48c3RyaW5nPn19XG4gKiAgICAgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGVuY29kZWQgdGV4dDEsIHRoZSBlbmNvZGVkIHRleHQyIGFuZFxuICogICAgIHRoZSBhcnJheSBvZiB1bmlxdWUgc3RyaW5ncy5cbiAqICAgICBUaGUgemVyb3RoIGVsZW1lbnQgb2YgdGhlIGFycmF5IG9mIHVuaXF1ZSBzdHJpbmdzIGlzIGludGVudGlvbmFsbHkgYmxhbmsuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2xpbmVzVG9DaGFyc18gPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIpIHtcbiAgdmFyIGxpbmVBcnJheSA9IFtdOyAgLy8gZS5nLiBsaW5lQXJyYXlbNF0gPT0gJ0hlbGxvXFxuJ1xuICB2YXIgbGluZUhhc2ggPSB7fTsgICAvLyBlLmcuIGxpbmVIYXNoWydIZWxsb1xcbiddID09IDRcblxuICAvLyAnXFx4MDAnIGlzIGEgdmFsaWQgY2hhcmFjdGVyLCBidXQgdmFyaW91cyBkZWJ1Z2dlcnMgZG9uJ3QgbGlrZSBpdC5cbiAgLy8gU28gd2UnbGwgaW5zZXJ0IGEganVuayBlbnRyeSB0byBhdm9pZCBnZW5lcmF0aW5nIGEgbnVsbCBjaGFyYWN0ZXIuXG4gIGxpbmVBcnJheVswXSA9ICcnO1xuXG4gIC8qKlxuICAgKiBTcGxpdCBhIHRleHQgaW50byBhbiBhcnJheSBvZiBzdHJpbmdzLiAgUmVkdWNlIHRoZSB0ZXh0cyB0byBhIHN0cmluZyBvZlxuICAgKiBoYXNoZXMgd2hlcmUgZWFjaCBVbmljb2RlIGNoYXJhY3RlciByZXByZXNlbnRzIG9uZSBsaW5lLlxuICAgKiBNb2RpZmllcyBsaW5lYXJyYXkgYW5kIGxpbmVoYXNoIHRocm91Z2ggYmVpbmcgYSBjbG9zdXJlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBTdHJpbmcgdG8gZW5jb2RlLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IEVuY29kZWQgc3RyaW5nLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gZGlmZl9saW5lc1RvQ2hhcnNNdW5nZV8odGV4dCkge1xuICAgIHZhciBjaGFycyA9ICcnO1xuICAgIC8vIFdhbGsgdGhlIHRleHQsIHB1bGxpbmcgb3V0IGEgc3Vic3RyaW5nIGZvciBlYWNoIGxpbmUuXG4gICAgLy8gdGV4dC5zcGxpdCgnXFxuJykgd291bGQgd291bGQgdGVtcG9yYXJpbHkgZG91YmxlIG91ciBtZW1vcnkgZm9vdHByaW50LlxuICAgIC8vIE1vZGlmeWluZyB0ZXh0IHdvdWxkIGNyZWF0ZSBtYW55IGxhcmdlIHN0cmluZ3MgdG8gZ2FyYmFnZSBjb2xsZWN0LlxuICAgIHZhciBsaW5lU3RhcnQgPSAwO1xuICAgIHZhciBsaW5lRW5kID0gLTE7XG4gICAgLy8gS2VlcGluZyBvdXIgb3duIGxlbmd0aCB2YXJpYWJsZSBpcyBmYXN0ZXIgdGhhbiBsb29raW5nIGl0IHVwLlxuICAgIHZhciBsaW5lQXJyYXlMZW5ndGggPSBsaW5lQXJyYXkubGVuZ3RoO1xuICAgIHdoaWxlIChsaW5lRW5kIDwgdGV4dC5sZW5ndGggLSAxKSB7XG4gICAgICBsaW5lRW5kID0gdGV4dC5pbmRleE9mKCdcXG4nLCBsaW5lU3RhcnQpO1xuICAgICAgaWYgKGxpbmVFbmQgPT0gLTEpIHtcbiAgICAgICAgbGluZUVuZCA9IHRleHQubGVuZ3RoIC0gMTtcbiAgICAgIH1cbiAgICAgIHZhciBsaW5lID0gdGV4dC5zdWJzdHJpbmcobGluZVN0YXJ0LCBsaW5lRW5kICsgMSk7XG5cbiAgICAgIGlmIChsaW5lSGFzaC5oYXNPd25Qcm9wZXJ0eSA/IGxpbmVIYXNoLmhhc093blByb3BlcnR5KGxpbmUpIDpcbiAgICAgICAgICAobGluZUhhc2hbbGluZV0gIT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgY2hhcnMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShsaW5lSGFzaFtsaW5lXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAobGluZUFycmF5TGVuZ3RoID09IG1heExpbmVzKSB7XG4gICAgICAgICAgLy8gQmFpbCBvdXQgYXQgNjU1MzUgYmVjYXVzZVxuICAgICAgICAgIC8vIFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzYpID09IFN0cmluZy5mcm9tQ2hhckNvZGUoMClcbiAgICAgICAgICBsaW5lID0gdGV4dC5zdWJzdHJpbmcobGluZVN0YXJ0KTtcbiAgICAgICAgICBsaW5lRW5kID0gdGV4dC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgY2hhcnMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShsaW5lQXJyYXlMZW5ndGgpO1xuICAgICAgICBsaW5lSGFzaFtsaW5lXSA9IGxpbmVBcnJheUxlbmd0aDtcbiAgICAgICAgbGluZUFycmF5W2xpbmVBcnJheUxlbmd0aCsrXSA9IGxpbmU7XG4gICAgICB9XG4gICAgICBsaW5lU3RhcnQgPSBsaW5lRW5kICsgMTtcbiAgICB9XG4gICAgcmV0dXJuIGNoYXJzO1xuICB9XG4gIC8vIEFsbG9jYXRlIDIvM3JkcyBvZiB0aGUgc3BhY2UgZm9yIHRleHQxLCB0aGUgcmVzdCBmb3IgdGV4dDIuXG4gIHZhciBtYXhMaW5lcyA9IDQwMDAwO1xuICB2YXIgY2hhcnMxID0gZGlmZl9saW5lc1RvQ2hhcnNNdW5nZV8odGV4dDEpO1xuICBtYXhMaW5lcyA9IDY1NTM1O1xuICB2YXIgY2hhcnMyID0gZGlmZl9saW5lc1RvQ2hhcnNNdW5nZV8odGV4dDIpO1xuICByZXR1cm4ge2NoYXJzMTogY2hhcnMxLCBjaGFyczI6IGNoYXJzMiwgbGluZUFycmF5OiBsaW5lQXJyYXl9O1xufTtcblxuXG4vKipcbiAqIFJlaHlkcmF0ZSB0aGUgdGV4dCBpbiBhIGRpZmYgZnJvbSBhIHN0cmluZyBvZiBsaW5lIGhhc2hlcyB0byByZWFsIGxpbmVzIG9mXG4gKiB0ZXh0LlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqIEBwYXJhbSB7IUFycmF5LjxzdHJpbmc+fSBsaW5lQXJyYXkgQXJyYXkgb2YgdW5pcXVlIHN0cmluZ3MuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NoYXJzVG9MaW5lc18gPSBmdW5jdGlvbihkaWZmcywgbGluZUFycmF5KSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGlmZnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY2hhcnMgPSBkaWZmc1tpXVsxXTtcbiAgICB2YXIgdGV4dCA9IFtdO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2hhcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgIHRleHRbal0gPSBsaW5lQXJyYXlbY2hhcnMuY2hhckNvZGVBdChqKV07XG4gICAgfVxuICAgIGRpZmZzW2ldWzFdID0gdGV4dC5qb2luKCcnKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIERldGVybWluZSB0aGUgY29tbW9uIHByZWZpeCBvZiB0d28gc3RyaW5ncy5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0MSBGaXJzdCBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDIgU2Vjb25kIHN0cmluZy5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIGNvbW1vbiB0byB0aGUgc3RhcnQgb2YgZWFjaFxuICogICAgIHN0cmluZy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jb21tb25QcmVmaXggPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIpIHtcbiAgLy8gUXVpY2sgY2hlY2sgZm9yIGNvbW1vbiBudWxsIGNhc2VzLlxuICBpZiAoIXRleHQxIHx8ICF0ZXh0MiB8fCB0ZXh0MS5jaGFyQXQoMCkgIT0gdGV4dDIuY2hhckF0KDApKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgLy8gQmluYXJ5IHNlYXJjaC5cbiAgLy8gUGVyZm9ybWFuY2UgYW5hbHlzaXM6IGh0dHBzOi8vbmVpbC5mcmFzZXIubmFtZS9uZXdzLzIwMDcvMTAvMDkvXG4gIHZhciBwb2ludGVybWluID0gMDtcbiAgdmFyIHBvaW50ZXJtYXggPSBNYXRoLm1pbih0ZXh0MS5sZW5ndGgsIHRleHQyLmxlbmd0aCk7XG4gIHZhciBwb2ludGVybWlkID0gcG9pbnRlcm1heDtcbiAgdmFyIHBvaW50ZXJzdGFydCA9IDA7XG4gIHdoaWxlIChwb2ludGVybWluIDwgcG9pbnRlcm1pZCkge1xuICAgIGlmICh0ZXh0MS5zdWJzdHJpbmcocG9pbnRlcnN0YXJ0LCBwb2ludGVybWlkKSA9PVxuICAgICAgICB0ZXh0Mi5zdWJzdHJpbmcocG9pbnRlcnN0YXJ0LCBwb2ludGVybWlkKSkge1xuICAgICAgcG9pbnRlcm1pbiA9IHBvaW50ZXJtaWQ7XG4gICAgICBwb2ludGVyc3RhcnQgPSBwb2ludGVybWluO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2ludGVybWF4ID0gcG9pbnRlcm1pZDtcbiAgICB9XG4gICAgcG9pbnRlcm1pZCA9IE1hdGguZmxvb3IoKHBvaW50ZXJtYXggLSBwb2ludGVybWluKSAvIDIgKyBwb2ludGVybWluKTtcbiAgfVxuICByZXR1cm4gcG9pbnRlcm1pZDtcbn07XG5cblxuLyoqXG4gKiBEZXRlcm1pbmUgdGhlIGNvbW1vbiBzdWZmaXggb2YgdHdvIHN0cmluZ3MuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDEgRmlyc3Qgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQyIFNlY29uZCBzdHJpbmcuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyBjb21tb24gdG8gdGhlIGVuZCBvZiBlYWNoIHN0cmluZy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jb21tb25TdWZmaXggPSBmdW5jdGlvbih0ZXh0MSwgdGV4dDIpIHtcbiAgLy8gUXVpY2sgY2hlY2sgZm9yIGNvbW1vbiBudWxsIGNhc2VzLlxuICBpZiAoIXRleHQxIHx8ICF0ZXh0MiB8fFxuICAgICAgdGV4dDEuY2hhckF0KHRleHQxLmxlbmd0aCAtIDEpICE9IHRleHQyLmNoYXJBdCh0ZXh0Mi5sZW5ndGggLSAxKSkge1xuICAgIHJldHVybiAwO1xuICB9XG4gIC8vIEJpbmFyeSBzZWFyY2guXG4gIC8vIFBlcmZvcm1hbmNlIGFuYWx5c2lzOiBodHRwczovL25laWwuZnJhc2VyLm5hbWUvbmV3cy8yMDA3LzEwLzA5L1xuICB2YXIgcG9pbnRlcm1pbiA9IDA7XG4gIHZhciBwb2ludGVybWF4ID0gTWF0aC5taW4odGV4dDEubGVuZ3RoLCB0ZXh0Mi5sZW5ndGgpO1xuICB2YXIgcG9pbnRlcm1pZCA9IHBvaW50ZXJtYXg7XG4gIHZhciBwb2ludGVyZW5kID0gMDtcbiAgd2hpbGUgKHBvaW50ZXJtaW4gPCBwb2ludGVybWlkKSB7XG4gICAgaWYgKHRleHQxLnN1YnN0cmluZyh0ZXh0MS5sZW5ndGggLSBwb2ludGVybWlkLCB0ZXh0MS5sZW5ndGggLSBwb2ludGVyZW5kKSA9PVxuICAgICAgICB0ZXh0Mi5zdWJzdHJpbmcodGV4dDIubGVuZ3RoIC0gcG9pbnRlcm1pZCwgdGV4dDIubGVuZ3RoIC0gcG9pbnRlcmVuZCkpIHtcbiAgICAgIHBvaW50ZXJtaW4gPSBwb2ludGVybWlkO1xuICAgICAgcG9pbnRlcmVuZCA9IHBvaW50ZXJtaW47XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvaW50ZXJtYXggPSBwb2ludGVybWlkO1xuICAgIH1cbiAgICBwb2ludGVybWlkID0gTWF0aC5mbG9vcigocG9pbnRlcm1heCAtIHBvaW50ZXJtaW4pIC8gMiArIHBvaW50ZXJtaW4pO1xuICB9XG4gIHJldHVybiBwb2ludGVybWlkO1xufTtcblxuXG4vKipcbiAqIERldGVybWluZSBpZiB0aGUgc3VmZml4IG9mIG9uZSBzdHJpbmcgaXMgdGhlIHByZWZpeCBvZiBhbm90aGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIEZpcnN0IHN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0MiBTZWNvbmQgc3RyaW5nLlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgY29tbW9uIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0XG4gKiAgICAgc3RyaW5nIGFuZCB0aGUgc3RhcnQgb2YgdGhlIHNlY29uZCBzdHJpbmcuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NvbW1vbk92ZXJsYXBfID0gZnVuY3Rpb24odGV4dDEsIHRleHQyKSB7XG4gIC8vIENhY2hlIHRoZSB0ZXh0IGxlbmd0aHMgdG8gcHJldmVudCBtdWx0aXBsZSBjYWxscy5cbiAgdmFyIHRleHQxX2xlbmd0aCA9IHRleHQxLmxlbmd0aDtcbiAgdmFyIHRleHQyX2xlbmd0aCA9IHRleHQyLmxlbmd0aDtcbiAgLy8gRWxpbWluYXRlIHRoZSBudWxsIGNhc2UuXG4gIGlmICh0ZXh0MV9sZW5ndGggPT0gMCB8fCB0ZXh0Ml9sZW5ndGggPT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9XG4gIC8vIFRydW5jYXRlIHRoZSBsb25nZXIgc3RyaW5nLlxuICBpZiAodGV4dDFfbGVuZ3RoID4gdGV4dDJfbGVuZ3RoKSB7XG4gICAgdGV4dDEgPSB0ZXh0MS5zdWJzdHJpbmcodGV4dDFfbGVuZ3RoIC0gdGV4dDJfbGVuZ3RoKTtcbiAgfSBlbHNlIGlmICh0ZXh0MV9sZW5ndGggPCB0ZXh0Ml9sZW5ndGgpIHtcbiAgICB0ZXh0MiA9IHRleHQyLnN1YnN0cmluZygwLCB0ZXh0MV9sZW5ndGgpO1xuICB9XG4gIHZhciB0ZXh0X2xlbmd0aCA9IE1hdGgubWluKHRleHQxX2xlbmd0aCwgdGV4dDJfbGVuZ3RoKTtcbiAgLy8gUXVpY2sgY2hlY2sgZm9yIHRoZSB3b3JzdCBjYXNlLlxuICBpZiAodGV4dDEgPT0gdGV4dDIpIHtcbiAgICByZXR1cm4gdGV4dF9sZW5ndGg7XG4gIH1cblxuICAvLyBTdGFydCBieSBsb29raW5nIGZvciBhIHNpbmdsZSBjaGFyYWN0ZXIgbWF0Y2hcbiAgLy8gYW5kIGluY3JlYXNlIGxlbmd0aCB1bnRpbCBubyBtYXRjaCBpcyBmb3VuZC5cbiAgLy8gUGVyZm9ybWFuY2UgYW5hbHlzaXM6IGh0dHBzOi8vbmVpbC5mcmFzZXIubmFtZS9uZXdzLzIwMTAvMTEvMDQvXG4gIHZhciBiZXN0ID0gMDtcbiAgdmFyIGxlbmd0aCA9IDE7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgdmFyIHBhdHRlcm4gPSB0ZXh0MS5zdWJzdHJpbmcodGV4dF9sZW5ndGggLSBsZW5ndGgpO1xuICAgIHZhciBmb3VuZCA9IHRleHQyLmluZGV4T2YocGF0dGVybik7XG4gICAgaWYgKGZvdW5kID09IC0xKSB7XG4gICAgICByZXR1cm4gYmVzdDtcbiAgICB9XG4gICAgbGVuZ3RoICs9IGZvdW5kO1xuICAgIGlmIChmb3VuZCA9PSAwIHx8IHRleHQxLnN1YnN0cmluZyh0ZXh0X2xlbmd0aCAtIGxlbmd0aCkgPT1cbiAgICAgICAgdGV4dDIuc3Vic3RyaW5nKDAsIGxlbmd0aCkpIHtcbiAgICAgIGJlc3QgPSBsZW5ndGg7XG4gICAgICBsZW5ndGgrKztcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBEbyB0aGUgdHdvIHRleHRzIHNoYXJlIGEgc3Vic3RyaW5nIHdoaWNoIGlzIGF0IGxlYXN0IGhhbGYgdGhlIGxlbmd0aCBvZiB0aGVcbiAqIGxvbmdlciB0ZXh0P1xuICogVGhpcyBzcGVlZHVwIGNhbiBwcm9kdWNlIG5vbi1taW5pbWFsIGRpZmZzLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIEZpcnN0IHN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0MiBTZWNvbmQgc3RyaW5nLlxuICogQHJldHVybiB7QXJyYXkuPHN0cmluZz59IEZpdmUgZWxlbWVudCBBcnJheSwgY29udGFpbmluZyB0aGUgcHJlZml4IG9mXG4gKiAgICAgdGV4dDEsIHRoZSBzdWZmaXggb2YgdGV4dDEsIHRoZSBwcmVmaXggb2YgdGV4dDIsIHRoZSBzdWZmaXggb2ZcbiAqICAgICB0ZXh0MiBhbmQgdGhlIGNvbW1vbiBtaWRkbGUuICBPciBudWxsIGlmIHRoZXJlIHdhcyBubyBtYXRjaC5cbiAqIEBwcml2YXRlXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfaGFsZk1hdGNoXyA9IGZ1bmN0aW9uKHRleHQxLCB0ZXh0Mikge1xuICBpZiAodGhpcy5EaWZmX1RpbWVvdXQgPD0gMCkge1xuICAgIC8vIERvbid0IHJpc2sgcmV0dXJuaW5nIGEgbm9uLW9wdGltYWwgZGlmZiBpZiB3ZSBoYXZlIHVubGltaXRlZCB0aW1lLlxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHZhciBsb25ndGV4dCA9IHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCA/IHRleHQxIDogdGV4dDI7XG4gIHZhciBzaG9ydHRleHQgPSB0ZXh0MS5sZW5ndGggPiB0ZXh0Mi5sZW5ndGggPyB0ZXh0MiA6IHRleHQxO1xuICBpZiAobG9uZ3RleHQubGVuZ3RoIDwgNCB8fCBzaG9ydHRleHQubGVuZ3RoICogMiA8IGxvbmd0ZXh0Lmxlbmd0aCkge1xuICAgIHJldHVybiBudWxsOyAgLy8gUG9pbnRsZXNzLlxuICB9XG4gIHZhciBkbXAgPSB0aGlzOyAgLy8gJ3RoaXMnIGJlY29tZXMgJ3dpbmRvdycgaW4gYSBjbG9zdXJlLlxuXG4gIC8qKlxuICAgKiBEb2VzIGEgc3Vic3RyaW5nIG9mIHNob3J0dGV4dCBleGlzdCB3aXRoaW4gbG9uZ3RleHQgc3VjaCB0aGF0IHRoZSBzdWJzdHJpbmdcbiAgICogaXMgYXQgbGVhc3QgaGFsZiB0aGUgbGVuZ3RoIG9mIGxvbmd0ZXh0P1xuICAgKiBDbG9zdXJlLCBidXQgZG9lcyBub3QgcmVmZXJlbmNlIGFueSBleHRlcm5hbCB2YXJpYWJsZXMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsb25ndGV4dCBMb25nZXIgc3RyaW5nLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2hvcnR0ZXh0IFNob3J0ZXIgc3RyaW5nLlxuICAgKiBAcGFyYW0ge251bWJlcn0gaSBTdGFydCBpbmRleCBvZiBxdWFydGVyIGxlbmd0aCBzdWJzdHJpbmcgd2l0aGluIGxvbmd0ZXh0LlxuICAgKiBAcmV0dXJuIHtBcnJheS48c3RyaW5nPn0gRml2ZSBlbGVtZW50IEFycmF5LCBjb250YWluaW5nIHRoZSBwcmVmaXggb2ZcbiAgICogICAgIGxvbmd0ZXh0LCB0aGUgc3VmZml4IG9mIGxvbmd0ZXh0LCB0aGUgcHJlZml4IG9mIHNob3J0dGV4dCwgdGhlIHN1ZmZpeFxuICAgKiAgICAgb2Ygc2hvcnR0ZXh0IGFuZCB0aGUgY29tbW9uIG1pZGRsZS4gIE9yIG51bGwgaWYgdGhlcmUgd2FzIG5vIG1hdGNoLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gZGlmZl9oYWxmTWF0Y2hJXyhsb25ndGV4dCwgc2hvcnR0ZXh0LCBpKSB7XG4gICAgLy8gU3RhcnQgd2l0aCBhIDEvNCBsZW5ndGggc3Vic3RyaW5nIGF0IHBvc2l0aW9uIGkgYXMgYSBzZWVkLlxuICAgIHZhciBzZWVkID0gbG9uZ3RleHQuc3Vic3RyaW5nKGksIGkgKyBNYXRoLmZsb29yKGxvbmd0ZXh0Lmxlbmd0aCAvIDQpKTtcbiAgICB2YXIgaiA9IC0xO1xuICAgIHZhciBiZXN0X2NvbW1vbiA9ICcnO1xuICAgIHZhciBiZXN0X2xvbmd0ZXh0X2EsIGJlc3RfbG9uZ3RleHRfYiwgYmVzdF9zaG9ydHRleHRfYSwgYmVzdF9zaG9ydHRleHRfYjtcbiAgICB3aGlsZSAoKGogPSBzaG9ydHRleHQuaW5kZXhPZihzZWVkLCBqICsgMSkpICE9IC0xKSB7XG4gICAgICB2YXIgcHJlZml4TGVuZ3RoID0gZG1wLmRpZmZfY29tbW9uUHJlZml4KGxvbmd0ZXh0LnN1YnN0cmluZyhpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnR0ZXh0LnN1YnN0cmluZyhqKSk7XG4gICAgICB2YXIgc3VmZml4TGVuZ3RoID0gZG1wLmRpZmZfY29tbW9uU3VmZml4KGxvbmd0ZXh0LnN1YnN0cmluZygwLCBpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnR0ZXh0LnN1YnN0cmluZygwLCBqKSk7XG4gICAgICBpZiAoYmVzdF9jb21tb24ubGVuZ3RoIDwgc3VmZml4TGVuZ3RoICsgcHJlZml4TGVuZ3RoKSB7XG4gICAgICAgIGJlc3RfY29tbW9uID0gc2hvcnR0ZXh0LnN1YnN0cmluZyhqIC0gc3VmZml4TGVuZ3RoLCBqKSArXG4gICAgICAgICAgICBzaG9ydHRleHQuc3Vic3RyaW5nKGosIGogKyBwcmVmaXhMZW5ndGgpO1xuICAgICAgICBiZXN0X2xvbmd0ZXh0X2EgPSBsb25ndGV4dC5zdWJzdHJpbmcoMCwgaSAtIHN1ZmZpeExlbmd0aCk7XG4gICAgICAgIGJlc3RfbG9uZ3RleHRfYiA9IGxvbmd0ZXh0LnN1YnN0cmluZyhpICsgcHJlZml4TGVuZ3RoKTtcbiAgICAgICAgYmVzdF9zaG9ydHRleHRfYSA9IHNob3J0dGV4dC5zdWJzdHJpbmcoMCwgaiAtIHN1ZmZpeExlbmd0aCk7XG4gICAgICAgIGJlc3Rfc2hvcnR0ZXh0X2IgPSBzaG9ydHRleHQuc3Vic3RyaW5nKGogKyBwcmVmaXhMZW5ndGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYmVzdF9jb21tb24ubGVuZ3RoICogMiA+PSBsb25ndGV4dC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBbYmVzdF9sb25ndGV4dF9hLCBiZXN0X2xvbmd0ZXh0X2IsXG4gICAgICAgICAgICAgIGJlc3Rfc2hvcnR0ZXh0X2EsIGJlc3Rfc2hvcnR0ZXh0X2IsIGJlc3RfY29tbW9uXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIHNlY29uZCBxdWFydGVyIGlzIHRoZSBzZWVkIGZvciBhIGhhbGYtbWF0Y2guXG4gIHZhciBobTEgPSBkaWZmX2hhbGZNYXRjaElfKGxvbmd0ZXh0LCBzaG9ydHRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguY2VpbChsb25ndGV4dC5sZW5ndGggLyA0KSk7XG4gIC8vIENoZWNrIGFnYWluIGJhc2VkIG9uIHRoZSB0aGlyZCBxdWFydGVyLlxuICB2YXIgaG0yID0gZGlmZl9oYWxmTWF0Y2hJXyhsb25ndGV4dCwgc2hvcnR0ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNlaWwobG9uZ3RleHQubGVuZ3RoIC8gMikpO1xuICB2YXIgaG07XG4gIGlmICghaG0xICYmICFobTIpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBlbHNlIGlmICghaG0yKSB7XG4gICAgaG0gPSBobTE7XG4gIH0gZWxzZSBpZiAoIWhtMSkge1xuICAgIGhtID0gaG0yO1xuICB9IGVsc2Uge1xuICAgIC8vIEJvdGggbWF0Y2hlZC4gIFNlbGVjdCB0aGUgbG9uZ2VzdC5cbiAgICBobSA9IGhtMVs0XS5sZW5ndGggPiBobTJbNF0ubGVuZ3RoID8gaG0xIDogaG0yO1xuICB9XG5cbiAgLy8gQSBoYWxmLW1hdGNoIHdhcyBmb3VuZCwgc29ydCBvdXQgdGhlIHJldHVybiBkYXRhLlxuICB2YXIgdGV4dDFfYSwgdGV4dDFfYiwgdGV4dDJfYSwgdGV4dDJfYjtcbiAgaWYgKHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCkge1xuICAgIHRleHQxX2EgPSBobVswXTtcbiAgICB0ZXh0MV9iID0gaG1bMV07XG4gICAgdGV4dDJfYSA9IGhtWzJdO1xuICAgIHRleHQyX2IgPSBobVszXTtcbiAgfSBlbHNlIHtcbiAgICB0ZXh0Ml9hID0gaG1bMF07XG4gICAgdGV4dDJfYiA9IGhtWzFdO1xuICAgIHRleHQxX2EgPSBobVsyXTtcbiAgICB0ZXh0MV9iID0gaG1bM107XG4gIH1cbiAgdmFyIG1pZF9jb21tb24gPSBobVs0XTtcbiAgcmV0dXJuIFt0ZXh0MV9hLCB0ZXh0MV9iLCB0ZXh0Ml9hLCB0ZXh0Ml9iLCBtaWRfY29tbW9uXTtcbn07XG5cblxuLyoqXG4gKiBSZWR1Y2UgdGhlIG51bWJlciBvZiBlZGl0cyBieSBlbGltaW5hdGluZyBzZW1hbnRpY2FsbHkgdHJpdmlhbCBlcXVhbGl0aWVzLlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jbGVhbnVwU2VtYW50aWMgPSBmdW5jdGlvbihkaWZmcykge1xuICB2YXIgY2hhbmdlcyA9IGZhbHNlO1xuICB2YXIgZXF1YWxpdGllcyA9IFtdOyAgLy8gU3RhY2sgb2YgaW5kaWNlcyB3aGVyZSBlcXVhbGl0aWVzIGFyZSBmb3VuZC5cbiAgdmFyIGVxdWFsaXRpZXNMZW5ndGggPSAwOyAgLy8gS2VlcGluZyBvdXIgb3duIGxlbmd0aCB2YXIgaXMgZmFzdGVyIGluIEpTLlxuICAvKiogQHR5cGUgez9zdHJpbmd9ICovXG4gIHZhciBsYXN0RXF1YWxpdHkgPSBudWxsO1xuICAvLyBBbHdheXMgZXF1YWwgdG8gZGlmZnNbZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV1dWzFdXG4gIHZhciBwb2ludGVyID0gMDsgIC8vIEluZGV4IG9mIGN1cnJlbnQgcG9zaXRpb24uXG4gIC8vIE51bWJlciBvZiBjaGFyYWN0ZXJzIHRoYXQgY2hhbmdlZCBwcmlvciB0byB0aGUgZXF1YWxpdHkuXG4gIHZhciBsZW5ndGhfaW5zZXJ0aW9uczEgPSAwO1xuICB2YXIgbGVuZ3RoX2RlbGV0aW9uczEgPSAwO1xuICAvLyBOdW1iZXIgb2YgY2hhcmFjdGVycyB0aGF0IGNoYW5nZWQgYWZ0ZXIgdGhlIGVxdWFsaXR5LlxuICB2YXIgbGVuZ3RoX2luc2VydGlvbnMyID0gMDtcbiAgdmFyIGxlbmd0aF9kZWxldGlvbnMyID0gMDtcbiAgd2hpbGUgKHBvaW50ZXIgPCBkaWZmcy5sZW5ndGgpIHtcbiAgICBpZiAoZGlmZnNbcG9pbnRlcl1bMF0gPT0gRElGRl9FUVVBTCkgeyAgLy8gRXF1YWxpdHkgZm91bmQuXG4gICAgICBlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGgrK10gPSBwb2ludGVyO1xuICAgICAgbGVuZ3RoX2luc2VydGlvbnMxID0gbGVuZ3RoX2luc2VydGlvbnMyO1xuICAgICAgbGVuZ3RoX2RlbGV0aW9uczEgPSBsZW5ndGhfZGVsZXRpb25zMjtcbiAgICAgIGxlbmd0aF9pbnNlcnRpb25zMiA9IDA7XG4gICAgICBsZW5ndGhfZGVsZXRpb25zMiA9IDA7XG4gICAgICBsYXN0RXF1YWxpdHkgPSBkaWZmc1twb2ludGVyXVsxXTtcbiAgICB9IGVsc2UgeyAgLy8gQW4gaW5zZXJ0aW9uIG9yIGRlbGV0aW9uLlxuICAgICAgaWYgKGRpZmZzW3BvaW50ZXJdWzBdID09IERJRkZfSU5TRVJUKSB7XG4gICAgICAgIGxlbmd0aF9pbnNlcnRpb25zMiArPSBkaWZmc1twb2ludGVyXVsxXS5sZW5ndGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZW5ndGhfZGVsZXRpb25zMiArPSBkaWZmc1twb2ludGVyXVsxXS5sZW5ndGg7XG4gICAgICB9XG4gICAgICAvLyBFbGltaW5hdGUgYW4gZXF1YWxpdHkgdGhhdCBpcyBzbWFsbGVyIG9yIGVxdWFsIHRvIHRoZSBlZGl0cyBvbiBib3RoXG4gICAgICAvLyBzaWRlcyBvZiBpdC5cbiAgICAgIGlmIChsYXN0RXF1YWxpdHkgJiYgKGxhc3RFcXVhbGl0eS5sZW5ndGggPD1cbiAgICAgICAgICBNYXRoLm1heChsZW5ndGhfaW5zZXJ0aW9uczEsIGxlbmd0aF9kZWxldGlvbnMxKSkgJiZcbiAgICAgICAgICAobGFzdEVxdWFsaXR5Lmxlbmd0aCA8PSBNYXRoLm1heChsZW5ndGhfaW5zZXJ0aW9uczIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoX2RlbGV0aW9uczIpKSkge1xuICAgICAgICAvLyBEdXBsaWNhdGUgcmVjb3JkLlxuICAgICAgICBkaWZmcy5zcGxpY2UoZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0sIDAsXG4gICAgICAgICAgICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfREVMRVRFLCBsYXN0RXF1YWxpdHkpKTtcbiAgICAgICAgLy8gQ2hhbmdlIHNlY29uZCBjb3B5IHRvIGluc2VydC5cbiAgICAgICAgZGlmZnNbZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0gKyAxXVswXSA9IERJRkZfSU5TRVJUO1xuICAgICAgICAvLyBUaHJvdyBhd2F5IHRoZSBlcXVhbGl0eSB3ZSBqdXN0IGRlbGV0ZWQuXG4gICAgICAgIGVxdWFsaXRpZXNMZW5ndGgtLTtcbiAgICAgICAgLy8gVGhyb3cgYXdheSB0aGUgcHJldmlvdXMgZXF1YWxpdHkgKGl0IG5lZWRzIHRvIGJlIHJlZXZhbHVhdGVkKS5cbiAgICAgICAgZXF1YWxpdGllc0xlbmd0aC0tO1xuICAgICAgICBwb2ludGVyID0gZXF1YWxpdGllc0xlbmd0aCA+IDAgPyBlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGggLSAxXSA6IC0xO1xuICAgICAgICBsZW5ndGhfaW5zZXJ0aW9uczEgPSAwOyAgLy8gUmVzZXQgdGhlIGNvdW50ZXJzLlxuICAgICAgICBsZW5ndGhfZGVsZXRpb25zMSA9IDA7XG4gICAgICAgIGxlbmd0aF9pbnNlcnRpb25zMiA9IDA7XG4gICAgICAgIGxlbmd0aF9kZWxldGlvbnMyID0gMDtcbiAgICAgICAgbGFzdEVxdWFsaXR5ID0gbnVsbDtcbiAgICAgICAgY2hhbmdlcyA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHBvaW50ZXIrKztcbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSB0aGUgZGlmZi5cbiAgaWYgKGNoYW5nZXMpIHtcbiAgICB0aGlzLmRpZmZfY2xlYW51cE1lcmdlKGRpZmZzKTtcbiAgfVxuICB0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3MoZGlmZnMpO1xuXG4gIC8vIEZpbmQgYW55IG92ZXJsYXBzIGJldHdlZW4gZGVsZXRpb25zIGFuZCBpbnNlcnRpb25zLlxuICAvLyBlLmc6IDxkZWw+YWJjeHh4PC9kZWw+PGlucz54eHhkZWY8L2lucz5cbiAgLy8gICAtPiA8ZGVsPmFiYzwvZGVsPnh4eDxpbnM+ZGVmPC9pbnM+XG4gIC8vIGUuZzogPGRlbD54eHhhYmM8L2RlbD48aW5zPmRlZnh4eDwvaW5zPlxuICAvLyAgIC0+IDxpbnM+ZGVmPC9pbnM+eHh4PGRlbD5hYmM8L2RlbD5cbiAgLy8gT25seSBleHRyYWN0IGFuIG92ZXJsYXAgaWYgaXQgaXMgYXMgYmlnIGFzIHRoZSBlZGl0IGFoZWFkIG9yIGJlaGluZCBpdC5cbiAgcG9pbnRlciA9IDE7XG4gIHdoaWxlIChwb2ludGVyIDwgZGlmZnMubGVuZ3RoKSB7XG4gICAgaWYgKGRpZmZzW3BvaW50ZXIgLSAxXVswXSA9PSBESUZGX0RFTEVURSAmJlxuICAgICAgICBkaWZmc1twb2ludGVyXVswXSA9PSBESUZGX0lOU0VSVCkge1xuICAgICAgdmFyIGRlbGV0aW9uID0gZGlmZnNbcG9pbnRlciAtIDFdWzFdO1xuICAgICAgdmFyIGluc2VydGlvbiA9IGRpZmZzW3BvaW50ZXJdWzFdO1xuICAgICAgdmFyIG92ZXJsYXBfbGVuZ3RoMSA9IHRoaXMuZGlmZl9jb21tb25PdmVybGFwXyhkZWxldGlvbiwgaW5zZXJ0aW9uKTtcbiAgICAgIHZhciBvdmVybGFwX2xlbmd0aDIgPSB0aGlzLmRpZmZfY29tbW9uT3ZlcmxhcF8oaW5zZXJ0aW9uLCBkZWxldGlvbik7XG4gICAgICBpZiAob3ZlcmxhcF9sZW5ndGgxID49IG92ZXJsYXBfbGVuZ3RoMikge1xuICAgICAgICBpZiAob3ZlcmxhcF9sZW5ndGgxID49IGRlbGV0aW9uLmxlbmd0aCAvIDIgfHxcbiAgICAgICAgICAgIG92ZXJsYXBfbGVuZ3RoMSA+PSBpbnNlcnRpb24ubGVuZ3RoIC8gMikge1xuICAgICAgICAgIC8vIE92ZXJsYXAgZm91bmQuICBJbnNlcnQgYW4gZXF1YWxpdHkgYW5kIHRyaW0gdGhlIHN1cnJvdW5kaW5nIGVkaXRzLlxuICAgICAgICAgIGRpZmZzLnNwbGljZShwb2ludGVyLCAwLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsXG4gICAgICAgICAgICAgIGluc2VydGlvbi5zdWJzdHJpbmcoMCwgb3ZlcmxhcF9sZW5ndGgxKSkpO1xuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgLSAxXVsxXSA9XG4gICAgICAgICAgICAgIGRlbGV0aW9uLnN1YnN0cmluZygwLCBkZWxldGlvbi5sZW5ndGggLSBvdmVybGFwX2xlbmd0aDEpO1xuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9IGluc2VydGlvbi5zdWJzdHJpbmcob3ZlcmxhcF9sZW5ndGgxKTtcbiAgICAgICAgICBwb2ludGVyKys7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvdmVybGFwX2xlbmd0aDIgPj0gZGVsZXRpb24ubGVuZ3RoIC8gMiB8fFxuICAgICAgICAgICAgb3ZlcmxhcF9sZW5ndGgyID49IGluc2VydGlvbi5sZW5ndGggLyAyKSB7XG4gICAgICAgICAgLy8gUmV2ZXJzZSBvdmVybGFwIGZvdW5kLlxuICAgICAgICAgIC8vIEluc2VydCBhbiBlcXVhbGl0eSBhbmQgc3dhcCBhbmQgdHJpbSB0aGUgc3Vycm91bmRpbmcgZWRpdHMuXG4gICAgICAgICAgZGlmZnMuc3BsaWNlKHBvaW50ZXIsIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCxcbiAgICAgICAgICAgICAgZGVsZXRpb24uc3Vic3RyaW5nKDAsIG92ZXJsYXBfbGVuZ3RoMikpKTtcbiAgICAgICAgICBkaWZmc1twb2ludGVyIC0gMV1bMF0gPSBESUZGX0lOU0VSVDtcbiAgICAgICAgICBkaWZmc1twb2ludGVyIC0gMV1bMV0gPVxuICAgICAgICAgICAgICBpbnNlcnRpb24uc3Vic3RyaW5nKDAsIGluc2VydGlvbi5sZW5ndGggLSBvdmVybGFwX2xlbmd0aDIpO1xuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVswXSA9IERJRkZfREVMRVRFO1xuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9XG4gICAgICAgICAgICAgIGRlbGV0aW9uLnN1YnN0cmluZyhvdmVybGFwX2xlbmd0aDIpO1xuICAgICAgICAgIHBvaW50ZXIrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcG9pbnRlcisrO1xuICAgIH1cbiAgICBwb2ludGVyKys7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBMb29rIGZvciBzaW5nbGUgZWRpdHMgc3Vycm91bmRlZCBvbiBib3RoIHNpZGVzIGJ5IGVxdWFsaXRpZXNcbiAqIHdoaWNoIGNhbiBiZSBzaGlmdGVkIHNpZGV3YXlzIHRvIGFsaWduIHRoZSBlZGl0IHRvIGEgd29yZCBib3VuZGFyeS5cbiAqIGUuZzogVGhlIGM8aW5zPmF0IGM8L2lucz5hbWUuIC0+IFRoZSA8aW5zPmNhdCA8L2lucz5jYW1lLlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jbGVhbnVwU2VtYW50aWNMb3NzbGVzcyA9IGZ1bmN0aW9uKGRpZmZzKSB7XG4gIC8qKlxuICAgKiBHaXZlbiB0d28gc3RyaW5ncywgY29tcHV0ZSBhIHNjb3JlIHJlcHJlc2VudGluZyB3aGV0aGVyIHRoZSBpbnRlcm5hbFxuICAgKiBib3VuZGFyeSBmYWxscyBvbiBsb2dpY2FsIGJvdW5kYXJpZXMuXG4gICAqIFNjb3JlcyByYW5nZSBmcm9tIDYgKGJlc3QpIHRvIDAgKHdvcnN0KS5cbiAgICogQ2xvc3VyZSwgYnV0IGRvZXMgbm90IHJlZmVyZW5jZSBhbnkgZXh0ZXJuYWwgdmFyaWFibGVzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gb25lIEZpcnN0IHN0cmluZy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHR3byBTZWNvbmQgc3RyaW5nLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzY29yZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIGRpZmZfY2xlYW51cFNlbWFudGljU2NvcmVfKG9uZSwgdHdvKSB7XG4gICAgaWYgKCFvbmUgfHwgIXR3bykge1xuICAgICAgLy8gRWRnZXMgYXJlIHRoZSBiZXN0LlxuICAgICAgcmV0dXJuIDY7XG4gICAgfVxuXG4gICAgLy8gRWFjaCBwb3J0IG9mIHRoaXMgZnVuY3Rpb24gYmVoYXZlcyBzbGlnaHRseSBkaWZmZXJlbnRseSBkdWUgdG9cbiAgICAvLyBzdWJ0bGUgZGlmZmVyZW5jZXMgaW4gZWFjaCBsYW5ndWFnZSdzIGRlZmluaXRpb24gb2YgdGhpbmdzIGxpa2VcbiAgICAvLyAnd2hpdGVzcGFjZScuICBTaW5jZSB0aGlzIGZ1bmN0aW9uJ3MgcHVycG9zZSBpcyBsYXJnZWx5IGNvc21ldGljLFxuICAgIC8vIHRoZSBjaG9pY2UgaGFzIGJlZW4gbWFkZSB0byB1c2UgZWFjaCBsYW5ndWFnZSdzIG5hdGl2ZSBmZWF0dXJlc1xuICAgIC8vIHJhdGhlciB0aGFuIGZvcmNlIHRvdGFsIGNvbmZvcm1pdHkuXG4gICAgdmFyIGNoYXIxID0gb25lLmNoYXJBdChvbmUubGVuZ3RoIC0gMSk7XG4gICAgdmFyIGNoYXIyID0gdHdvLmNoYXJBdCgwKTtcbiAgICB2YXIgbm9uQWxwaGFOdW1lcmljMSA9IGNoYXIxLm1hdGNoKGRpZmZfbWF0Y2hfcGF0Y2gubm9uQWxwaGFOdW1lcmljUmVnZXhfKTtcbiAgICB2YXIgbm9uQWxwaGFOdW1lcmljMiA9IGNoYXIyLm1hdGNoKGRpZmZfbWF0Y2hfcGF0Y2gubm9uQWxwaGFOdW1lcmljUmVnZXhfKTtcbiAgICB2YXIgd2hpdGVzcGFjZTEgPSBub25BbHBoYU51bWVyaWMxICYmXG4gICAgICAgIGNoYXIxLm1hdGNoKGRpZmZfbWF0Y2hfcGF0Y2gud2hpdGVzcGFjZVJlZ2V4Xyk7XG4gICAgdmFyIHdoaXRlc3BhY2UyID0gbm9uQWxwaGFOdW1lcmljMiAmJlxuICAgICAgICBjaGFyMi5tYXRjaChkaWZmX21hdGNoX3BhdGNoLndoaXRlc3BhY2VSZWdleF8pO1xuICAgIHZhciBsaW5lQnJlYWsxID0gd2hpdGVzcGFjZTEgJiZcbiAgICAgICAgY2hhcjEubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC5saW5lYnJlYWtSZWdleF8pO1xuICAgIHZhciBsaW5lQnJlYWsyID0gd2hpdGVzcGFjZTIgJiZcbiAgICAgICAgY2hhcjIubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC5saW5lYnJlYWtSZWdleF8pO1xuICAgIHZhciBibGFua0xpbmUxID0gbGluZUJyZWFrMSAmJlxuICAgICAgICBvbmUubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC5ibGFua2xpbmVFbmRSZWdleF8pO1xuICAgIHZhciBibGFua0xpbmUyID0gbGluZUJyZWFrMiAmJlxuICAgICAgICB0d28ubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC5ibGFua2xpbmVTdGFydFJlZ2V4Xyk7XG5cbiAgICBpZiAoYmxhbmtMaW5lMSB8fCBibGFua0xpbmUyKSB7XG4gICAgICAvLyBGaXZlIHBvaW50cyBmb3IgYmxhbmsgbGluZXMuXG4gICAgICByZXR1cm4gNTtcbiAgICB9IGVsc2UgaWYgKGxpbmVCcmVhazEgfHwgbGluZUJyZWFrMikge1xuICAgICAgLy8gRm91ciBwb2ludHMgZm9yIGxpbmUgYnJlYWtzLlxuICAgICAgcmV0dXJuIDQ7XG4gICAgfSBlbHNlIGlmIChub25BbHBoYU51bWVyaWMxICYmICF3aGl0ZXNwYWNlMSAmJiB3aGl0ZXNwYWNlMikge1xuICAgICAgLy8gVGhyZWUgcG9pbnRzIGZvciBlbmQgb2Ygc2VudGVuY2VzLlxuICAgICAgcmV0dXJuIDM7XG4gICAgfSBlbHNlIGlmICh3aGl0ZXNwYWNlMSB8fCB3aGl0ZXNwYWNlMikge1xuICAgICAgLy8gVHdvIHBvaW50cyBmb3Igd2hpdGVzcGFjZS5cbiAgICAgIHJldHVybiAyO1xuICAgIH0gZWxzZSBpZiAobm9uQWxwaGFOdW1lcmljMSB8fCBub25BbHBoYU51bWVyaWMyKSB7XG4gICAgICAvLyBPbmUgcG9pbnQgZm9yIG5vbi1hbHBoYW51bWVyaWMuXG4gICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICB2YXIgcG9pbnRlciA9IDE7XG4gIC8vIEludGVudGlvbmFsbHkgaWdub3JlIHRoZSBmaXJzdCBhbmQgbGFzdCBlbGVtZW50IChkb24ndCBuZWVkIGNoZWNraW5nKS5cbiAgd2hpbGUgKHBvaW50ZXIgPCBkaWZmcy5sZW5ndGggLSAxKSB7XG4gICAgaWYgKGRpZmZzW3BvaW50ZXIgLSAxXVswXSA9PSBESUZGX0VRVUFMICYmXG4gICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVswXSA9PSBESUZGX0VRVUFMKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgc2luZ2xlIGVkaXQgc3Vycm91bmRlZCBieSBlcXVhbGl0aWVzLlxuICAgICAgdmFyIGVxdWFsaXR5MSA9IGRpZmZzW3BvaW50ZXIgLSAxXVsxXTtcbiAgICAgIHZhciBlZGl0ID0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICB2YXIgZXF1YWxpdHkyID0gZGlmZnNbcG9pbnRlciArIDFdWzFdO1xuXG4gICAgICAvLyBGaXJzdCwgc2hpZnQgdGhlIGVkaXQgYXMgZmFyIGxlZnQgYXMgcG9zc2libGUuXG4gICAgICB2YXIgY29tbW9uT2Zmc2V0ID0gdGhpcy5kaWZmX2NvbW1vblN1ZmZpeChlcXVhbGl0eTEsIGVkaXQpO1xuICAgICAgaWYgKGNvbW1vbk9mZnNldCkge1xuICAgICAgICB2YXIgY29tbW9uU3RyaW5nID0gZWRpdC5zdWJzdHJpbmcoZWRpdC5sZW5ndGggLSBjb21tb25PZmZzZXQpO1xuICAgICAgICBlcXVhbGl0eTEgPSBlcXVhbGl0eTEuc3Vic3RyaW5nKDAsIGVxdWFsaXR5MS5sZW5ndGggLSBjb21tb25PZmZzZXQpO1xuICAgICAgICBlZGl0ID0gY29tbW9uU3RyaW5nICsgZWRpdC5zdWJzdHJpbmcoMCwgZWRpdC5sZW5ndGggLSBjb21tb25PZmZzZXQpO1xuICAgICAgICBlcXVhbGl0eTIgPSBjb21tb25TdHJpbmcgKyBlcXVhbGl0eTI7XG4gICAgICB9XG5cbiAgICAgIC8vIFNlY29uZCwgc3RlcCBjaGFyYWN0ZXIgYnkgY2hhcmFjdGVyIHJpZ2h0LCBsb29raW5nIGZvciB0aGUgYmVzdCBmaXQuXG4gICAgICB2YXIgYmVzdEVxdWFsaXR5MSA9IGVxdWFsaXR5MTtcbiAgICAgIHZhciBiZXN0RWRpdCA9IGVkaXQ7XG4gICAgICB2YXIgYmVzdEVxdWFsaXR5MiA9IGVxdWFsaXR5MjtcbiAgICAgIHZhciBiZXN0U2NvcmUgPSBkaWZmX2NsZWFudXBTZW1hbnRpY1Njb3JlXyhlcXVhbGl0eTEsIGVkaXQpICtcbiAgICAgICAgICBkaWZmX2NsZWFudXBTZW1hbnRpY1Njb3JlXyhlZGl0LCBlcXVhbGl0eTIpO1xuICAgICAgd2hpbGUgKGVkaXQuY2hhckF0KDApID09PSBlcXVhbGl0eTIuY2hhckF0KDApKSB7XG4gICAgICAgIGVxdWFsaXR5MSArPSBlZGl0LmNoYXJBdCgwKTtcbiAgICAgICAgZWRpdCA9IGVkaXQuc3Vic3RyaW5nKDEpICsgZXF1YWxpdHkyLmNoYXJBdCgwKTtcbiAgICAgICAgZXF1YWxpdHkyID0gZXF1YWxpdHkyLnN1YnN0cmluZygxKTtcbiAgICAgICAgdmFyIHNjb3JlID0gZGlmZl9jbGVhbnVwU2VtYW50aWNTY29yZV8oZXF1YWxpdHkxLCBlZGl0KSArXG4gICAgICAgICAgICBkaWZmX2NsZWFudXBTZW1hbnRpY1Njb3JlXyhlZGl0LCBlcXVhbGl0eTIpO1xuICAgICAgICAvLyBUaGUgPj0gZW5jb3VyYWdlcyB0cmFpbGluZyByYXRoZXIgdGhhbiBsZWFkaW5nIHdoaXRlc3BhY2Ugb24gZWRpdHMuXG4gICAgICAgIGlmIChzY29yZSA+PSBiZXN0U2NvcmUpIHtcbiAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTtcbiAgICAgICAgICBiZXN0RXF1YWxpdHkxID0gZXF1YWxpdHkxO1xuICAgICAgICAgIGJlc3RFZGl0ID0gZWRpdDtcbiAgICAgICAgICBiZXN0RXF1YWxpdHkyID0gZXF1YWxpdHkyO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChkaWZmc1twb2ludGVyIC0gMV1bMV0gIT0gYmVzdEVxdWFsaXR5MSkge1xuICAgICAgICAvLyBXZSBoYXZlIGFuIGltcHJvdmVtZW50LCBzYXZlIGl0IGJhY2sgdG8gdGhlIGRpZmYuXG4gICAgICAgIGlmIChiZXN0RXF1YWxpdHkxKSB7XG4gICAgICAgICAgZGlmZnNbcG9pbnRlciAtIDFdWzFdID0gYmVzdEVxdWFsaXR5MTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciAtIDEsIDEpO1xuICAgICAgICAgIHBvaW50ZXItLTtcbiAgICAgICAgfVxuICAgICAgICBkaWZmc1twb2ludGVyXVsxXSA9IGJlc3RFZGl0O1xuICAgICAgICBpZiAoYmVzdEVxdWFsaXR5Mikge1xuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9IGJlc3RFcXVhbGl0eTI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlmZnMuc3BsaWNlKHBvaW50ZXIgKyAxLCAxKTtcbiAgICAgICAgICBwb2ludGVyLS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcG9pbnRlcisrO1xuICB9XG59O1xuXG4vLyBEZWZpbmUgc29tZSByZWdleCBwYXR0ZXJucyBmb3IgbWF0Y2hpbmcgYm91bmRhcmllcy5cbmRpZmZfbWF0Y2hfcGF0Y2gubm9uQWxwaGFOdW1lcmljUmVnZXhfID0gL1teYS16QS1aMC05XS87XG5kaWZmX21hdGNoX3BhdGNoLndoaXRlc3BhY2VSZWdleF8gPSAvXFxzLztcbmRpZmZfbWF0Y2hfcGF0Y2gubGluZWJyZWFrUmVnZXhfID0gL1tcXHJcXG5dLztcbmRpZmZfbWF0Y2hfcGF0Y2guYmxhbmtsaW5lRW5kUmVnZXhfID0gL1xcblxccj9cXG4kLztcbmRpZmZfbWF0Y2hfcGF0Y2guYmxhbmtsaW5lU3RhcnRSZWdleF8gPSAvXlxccj9cXG5cXHI/XFxuLztcblxuLyoqXG4gKiBSZWR1Y2UgdGhlIG51bWJlciBvZiBlZGl0cyBieSBlbGltaW5hdGluZyBvcGVyYXRpb25hbGx5IHRyaXZpYWwgZXF1YWxpdGllcy5cbiAqIEBwYXJhbSB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gZGlmZnMgQXJyYXkgb2YgZGlmZiB0dXBsZXMuXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY2xlYW51cEVmZmljaWVuY3kgPSBmdW5jdGlvbihkaWZmcykge1xuICB2YXIgY2hhbmdlcyA9IGZhbHNlO1xuICB2YXIgZXF1YWxpdGllcyA9IFtdOyAgLy8gU3RhY2sgb2YgaW5kaWNlcyB3aGVyZSBlcXVhbGl0aWVzIGFyZSBmb3VuZC5cbiAgdmFyIGVxdWFsaXRpZXNMZW5ndGggPSAwOyAgLy8gS2VlcGluZyBvdXIgb3duIGxlbmd0aCB2YXIgaXMgZmFzdGVyIGluIEpTLlxuICAvKiogQHR5cGUgez9zdHJpbmd9ICovXG4gIHZhciBsYXN0RXF1YWxpdHkgPSBudWxsO1xuICAvLyBBbHdheXMgZXF1YWwgdG8gZGlmZnNbZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV1dWzFdXG4gIHZhciBwb2ludGVyID0gMDsgIC8vIEluZGV4IG9mIGN1cnJlbnQgcG9zaXRpb24uXG4gIC8vIElzIHRoZXJlIGFuIGluc2VydGlvbiBvcGVyYXRpb24gYmVmb3JlIHRoZSBsYXN0IGVxdWFsaXR5LlxuICB2YXIgcHJlX2lucyA9IGZhbHNlO1xuICAvLyBJcyB0aGVyZSBhIGRlbGV0aW9uIG9wZXJhdGlvbiBiZWZvcmUgdGhlIGxhc3QgZXF1YWxpdHkuXG4gIHZhciBwcmVfZGVsID0gZmFsc2U7XG4gIC8vIElzIHRoZXJlIGFuIGluc2VydGlvbiBvcGVyYXRpb24gYWZ0ZXIgdGhlIGxhc3QgZXF1YWxpdHkuXG4gIHZhciBwb3N0X2lucyA9IGZhbHNlO1xuICAvLyBJcyB0aGVyZSBhIGRlbGV0aW9uIG9wZXJhdGlvbiBhZnRlciB0aGUgbGFzdCBlcXVhbGl0eS5cbiAgdmFyIHBvc3RfZGVsID0gZmFsc2U7XG4gIHdoaWxlIChwb2ludGVyIDwgZGlmZnMubGVuZ3RoKSB7XG4gICAgaWYgKGRpZmZzW3BvaW50ZXJdWzBdID09IERJRkZfRVFVQUwpIHsgIC8vIEVxdWFsaXR5IGZvdW5kLlxuICAgICAgaWYgKGRpZmZzW3BvaW50ZXJdWzFdLmxlbmd0aCA8IHRoaXMuRGlmZl9FZGl0Q29zdCAmJlxuICAgICAgICAgIChwb3N0X2lucyB8fCBwb3N0X2RlbCkpIHtcbiAgICAgICAgLy8gQ2FuZGlkYXRlIGZvdW5kLlxuICAgICAgICBlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGgrK10gPSBwb2ludGVyO1xuICAgICAgICBwcmVfaW5zID0gcG9zdF9pbnM7XG4gICAgICAgIHByZV9kZWwgPSBwb3N0X2RlbDtcbiAgICAgICAgbGFzdEVxdWFsaXR5ID0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb3QgYSBjYW5kaWRhdGUsIGFuZCBjYW4gbmV2ZXIgYmVjb21lIG9uZS5cbiAgICAgICAgZXF1YWxpdGllc0xlbmd0aCA9IDA7XG4gICAgICAgIGxhc3RFcXVhbGl0eSA9IG51bGw7XG4gICAgICB9XG4gICAgICBwb3N0X2lucyA9IHBvc3RfZGVsID0gZmFsc2U7XG4gICAgfSBlbHNlIHsgIC8vIEFuIGluc2VydGlvbiBvciBkZWxldGlvbi5cbiAgICAgIGlmIChkaWZmc1twb2ludGVyXVswXSA9PSBESUZGX0RFTEVURSkge1xuICAgICAgICBwb3N0X2RlbCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwb3N0X2lucyA9IHRydWU7XG4gICAgICB9XG4gICAgICAvKlxuICAgICAgICogRml2ZSB0eXBlcyB0byBiZSBzcGxpdDpcbiAgICAgICAqIDxpbnM+QTwvaW5zPjxkZWw+QjwvZGVsPlhZPGlucz5DPC9pbnM+PGRlbD5EPC9kZWw+XG4gICAgICAgKiA8aW5zPkE8L2lucz5YPGlucz5DPC9pbnM+PGRlbD5EPC9kZWw+XG4gICAgICAgKiA8aW5zPkE8L2lucz48ZGVsPkI8L2RlbD5YPGlucz5DPC9pbnM+XG4gICAgICAgKiA8aW5zPkE8L2RlbD5YPGlucz5DPC9pbnM+PGRlbD5EPC9kZWw+XG4gICAgICAgKiA8aW5zPkE8L2lucz48ZGVsPkI8L2RlbD5YPGRlbD5DPC9kZWw+XG4gICAgICAgKi9cbiAgICAgIGlmIChsYXN0RXF1YWxpdHkgJiYgKChwcmVfaW5zICYmIHByZV9kZWwgJiYgcG9zdF9pbnMgJiYgcG9zdF9kZWwpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAoKGxhc3RFcXVhbGl0eS5sZW5ndGggPCB0aGlzLkRpZmZfRWRpdENvc3QgLyAyKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwcmVfaW5zICsgcHJlX2RlbCArIHBvc3RfaW5zICsgcG9zdF9kZWwpID09IDMpKSkge1xuICAgICAgICAvLyBEdXBsaWNhdGUgcmVjb3JkLlxuICAgICAgICBkaWZmcy5zcGxpY2UoZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0sIDAsXG4gICAgICAgICAgICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfREVMRVRFLCBsYXN0RXF1YWxpdHkpKTtcbiAgICAgICAgLy8gQ2hhbmdlIHNlY29uZCBjb3B5IHRvIGluc2VydC5cbiAgICAgICAgZGlmZnNbZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0gKyAxXVswXSA9IERJRkZfSU5TRVJUO1xuICAgICAgICBlcXVhbGl0aWVzTGVuZ3RoLS07ICAvLyBUaHJvdyBhd2F5IHRoZSBlcXVhbGl0eSB3ZSBqdXN0IGRlbGV0ZWQ7XG4gICAgICAgIGxhc3RFcXVhbGl0eSA9IG51bGw7XG4gICAgICAgIGlmIChwcmVfaW5zICYmIHByZV9kZWwpIHtcbiAgICAgICAgICAvLyBObyBjaGFuZ2VzIG1hZGUgd2hpY2ggY291bGQgYWZmZWN0IHByZXZpb3VzIGVudHJ5LCBrZWVwIGdvaW5nLlxuICAgICAgICAgIHBvc3RfaW5zID0gcG9zdF9kZWwgPSB0cnVlO1xuICAgICAgICAgIGVxdWFsaXRpZXNMZW5ndGggPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVxdWFsaXRpZXNMZW5ndGgtLTsgIC8vIFRocm93IGF3YXkgdGhlIHByZXZpb3VzIGVxdWFsaXR5LlxuICAgICAgICAgIHBvaW50ZXIgPSBlcXVhbGl0aWVzTGVuZ3RoID4gMCA/XG4gICAgICAgICAgICAgIGVxdWFsaXRpZXNbZXF1YWxpdGllc0xlbmd0aCAtIDFdIDogLTE7XG4gICAgICAgICAgcG9zdF9pbnMgPSBwb3N0X2RlbCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNoYW5nZXMgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBwb2ludGVyKys7XG4gIH1cblxuICBpZiAoY2hhbmdlcykge1xuICAgIHRoaXMuZGlmZl9jbGVhbnVwTWVyZ2UoZGlmZnMpO1xuICB9XG59O1xuXG5cbi8qKlxuICogUmVvcmRlciBhbmQgbWVyZ2UgbGlrZSBlZGl0IHNlY3Rpb25zLiAgTWVyZ2UgZXF1YWxpdGllcy5cbiAqIEFueSBlZGl0IHNlY3Rpb24gY2FuIG1vdmUgYXMgbG9uZyBhcyBpdCBkb2Vzbid0IGNyb3NzIGFuIGVxdWFsaXR5LlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jbGVhbnVwTWVyZ2UgPSBmdW5jdGlvbihkaWZmcykge1xuICAvLyBBZGQgYSBkdW1teSBlbnRyeSBhdCB0aGUgZW5kLlxuICBkaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgJycpKTtcbiAgdmFyIHBvaW50ZXIgPSAwO1xuICB2YXIgY291bnRfZGVsZXRlID0gMDtcbiAgdmFyIGNvdW50X2luc2VydCA9IDA7XG4gIHZhciB0ZXh0X2RlbGV0ZSA9ICcnO1xuICB2YXIgdGV4dF9pbnNlcnQgPSAnJztcbiAgdmFyIGNvbW1vbmxlbmd0aDtcbiAgd2hpbGUgKHBvaW50ZXIgPCBkaWZmcy5sZW5ndGgpIHtcbiAgICBzd2l0Y2ggKGRpZmZzW3BvaW50ZXJdWzBdKSB7XG4gICAgICBjYXNlIERJRkZfSU5TRVJUOlxuICAgICAgICBjb3VudF9pbnNlcnQrKztcbiAgICAgICAgdGV4dF9pbnNlcnQgKz0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICAgIHBvaW50ZXIrKztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfREVMRVRFOlxuICAgICAgICBjb3VudF9kZWxldGUrKztcbiAgICAgICAgdGV4dF9kZWxldGUgKz0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICAgIHBvaW50ZXIrKztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfRVFVQUw6XG4gICAgICAgIC8vIFVwb24gcmVhY2hpbmcgYW4gZXF1YWxpdHksIGNoZWNrIGZvciBwcmlvciByZWR1bmRhbmNpZXMuXG4gICAgICAgIGlmIChjb3VudF9kZWxldGUgKyBjb3VudF9pbnNlcnQgPiAxKSB7XG4gICAgICAgICAgaWYgKGNvdW50X2RlbGV0ZSAhPT0gMCAmJiBjb3VudF9pbnNlcnQgIT09IDApIHtcbiAgICAgICAgICAgIC8vIEZhY3RvciBvdXQgYW55IGNvbW1vbiBwcmVmaXhpZXMuXG4gICAgICAgICAgICBjb21tb25sZW5ndGggPSB0aGlzLmRpZmZfY29tbW9uUHJlZml4KHRleHRfaW5zZXJ0LCB0ZXh0X2RlbGV0ZSk7XG4gICAgICAgICAgICBpZiAoY29tbW9ubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgIGlmICgocG9pbnRlciAtIGNvdW50X2RlbGV0ZSAtIGNvdW50X2luc2VydCkgPiAwICYmXG4gICAgICAgICAgICAgICAgICBkaWZmc1twb2ludGVyIC0gY291bnRfZGVsZXRlIC0gY291bnRfaW5zZXJ0IC0gMV1bMF0gPT1cbiAgICAgICAgICAgICAgICAgIERJRkZfRVFVQUwpIHtcbiAgICAgICAgICAgICAgICBkaWZmc1twb2ludGVyIC0gY291bnRfZGVsZXRlIC0gY291bnRfaW5zZXJ0IC0gMV1bMV0gKz1cbiAgICAgICAgICAgICAgICAgICAgdGV4dF9pbnNlcnQuc3Vic3RyaW5nKDAsIGNvbW1vbmxlbmd0aCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlmZnMuc3BsaWNlKDAsIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCxcbiAgICAgICAgICAgICAgICAgICAgdGV4dF9pbnNlcnQuc3Vic3RyaW5nKDAsIGNvbW1vbmxlbmd0aCkpKTtcbiAgICAgICAgICAgICAgICBwb2ludGVyKys7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGV4dF9pbnNlcnQgPSB0ZXh0X2luc2VydC5zdWJzdHJpbmcoY29tbW9ubGVuZ3RoKTtcbiAgICAgICAgICAgICAgdGV4dF9kZWxldGUgPSB0ZXh0X2RlbGV0ZS5zdWJzdHJpbmcoY29tbW9ubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZhY3RvciBvdXQgYW55IGNvbW1vbiBzdWZmaXhpZXMuXG4gICAgICAgICAgICBjb21tb25sZW5ndGggPSB0aGlzLmRpZmZfY29tbW9uU3VmZml4KHRleHRfaW5zZXJ0LCB0ZXh0X2RlbGV0ZSk7XG4gICAgICAgICAgICBpZiAoY29tbW9ubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgIGRpZmZzW3BvaW50ZXJdWzFdID0gdGV4dF9pbnNlcnQuc3Vic3RyaW5nKHRleHRfaW5zZXJ0Lmxlbmd0aCAtXG4gICAgICAgICAgICAgICAgICBjb21tb25sZW5ndGgpICsgZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICAgICAgICAgIHRleHRfaW5zZXJ0ID0gdGV4dF9pbnNlcnQuc3Vic3RyaW5nKDAsIHRleHRfaW5zZXJ0Lmxlbmd0aCAtXG4gICAgICAgICAgICAgICAgICBjb21tb25sZW5ndGgpO1xuICAgICAgICAgICAgICB0ZXh0X2RlbGV0ZSA9IHRleHRfZGVsZXRlLnN1YnN0cmluZygwLCB0ZXh0X2RlbGV0ZS5sZW5ndGggLVxuICAgICAgICAgICAgICAgICAgY29tbW9ubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gRGVsZXRlIHRoZSBvZmZlbmRpbmcgcmVjb3JkcyBhbmQgYWRkIHRoZSBtZXJnZWQgb25lcy5cbiAgICAgICAgICBwb2ludGVyIC09IGNvdW50X2RlbGV0ZSArIGNvdW50X2luc2VydDtcbiAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciwgY291bnRfZGVsZXRlICsgY291bnRfaW5zZXJ0KTtcbiAgICAgICAgICBpZiAodGV4dF9kZWxldGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciwgMCxcbiAgICAgICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfREVMRVRFLCB0ZXh0X2RlbGV0ZSkpO1xuICAgICAgICAgICAgcG9pbnRlcisrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGV4dF9pbnNlcnQubGVuZ3RoKSB7XG4gICAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciwgMCxcbiAgICAgICAgICAgICAgICBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCB0ZXh0X2luc2VydCkpO1xuICAgICAgICAgICAgcG9pbnRlcisrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb2ludGVyKys7XG4gICAgICAgIH0gZWxzZSBpZiAocG9pbnRlciAhPT0gMCAmJiBkaWZmc1twb2ludGVyIC0gMV1bMF0gPT0gRElGRl9FUVVBTCkge1xuICAgICAgICAgIC8vIE1lcmdlIHRoaXMgZXF1YWxpdHkgd2l0aCB0aGUgcHJldmlvdXMgb25lLlxuICAgICAgICAgIGRpZmZzW3BvaW50ZXIgLSAxXVsxXSArPSBkaWZmc1twb2ludGVyXVsxXTtcbiAgICAgICAgICBkaWZmcy5zcGxpY2UocG9pbnRlciwgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcG9pbnRlcisrO1xuICAgICAgICB9XG4gICAgICAgIGNvdW50X2luc2VydCA9IDA7XG4gICAgICAgIGNvdW50X2RlbGV0ZSA9IDA7XG4gICAgICAgIHRleHRfZGVsZXRlID0gJyc7XG4gICAgICAgIHRleHRfaW5zZXJ0ID0gJyc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBpZiAoZGlmZnNbZGlmZnMubGVuZ3RoIC0gMV1bMV0gPT09ICcnKSB7XG4gICAgZGlmZnMucG9wKCk7ICAvLyBSZW1vdmUgdGhlIGR1bW15IGVudHJ5IGF0IHRoZSBlbmQuXG4gIH1cblxuICAvLyBTZWNvbmQgcGFzczogbG9vayBmb3Igc2luZ2xlIGVkaXRzIHN1cnJvdW5kZWQgb24gYm90aCBzaWRlcyBieSBlcXVhbGl0aWVzXG4gIC8vIHdoaWNoIGNhbiBiZSBzaGlmdGVkIHNpZGV3YXlzIHRvIGVsaW1pbmF0ZSBhbiBlcXVhbGl0eS5cbiAgLy8gZS5nOiBBPGlucz5CQTwvaW5zPkMgLT4gPGlucz5BQjwvaW5zPkFDXG4gIHZhciBjaGFuZ2VzID0gZmFsc2U7XG4gIHBvaW50ZXIgPSAxO1xuICAvLyBJbnRlbnRpb25hbGx5IGlnbm9yZSB0aGUgZmlyc3QgYW5kIGxhc3QgZWxlbWVudCAoZG9uJ3QgbmVlZCBjaGVja2luZykuXG4gIHdoaWxlIChwb2ludGVyIDwgZGlmZnMubGVuZ3RoIC0gMSkge1xuICAgIGlmIChkaWZmc1twb2ludGVyIC0gMV1bMF0gPT0gRElGRl9FUVVBTCAmJlxuICAgICAgICBkaWZmc1twb2ludGVyICsgMV1bMF0gPT0gRElGRl9FUVVBTCkge1xuICAgICAgLy8gVGhpcyBpcyBhIHNpbmdsZSBlZGl0IHN1cnJvdW5kZWQgYnkgZXF1YWxpdGllcy5cbiAgICAgIGlmIChkaWZmc1twb2ludGVyXVsxXS5zdWJzdHJpbmcoZGlmZnNbcG9pbnRlcl1bMV0ubGVuZ3RoIC1cbiAgICAgICAgICBkaWZmc1twb2ludGVyIC0gMV1bMV0ubGVuZ3RoKSA9PSBkaWZmc1twb2ludGVyIC0gMV1bMV0pIHtcbiAgICAgICAgLy8gU2hpZnQgdGhlIGVkaXQgb3ZlciB0aGUgcHJldmlvdXMgZXF1YWxpdHkuXG4gICAgICAgIGRpZmZzW3BvaW50ZXJdWzFdID0gZGlmZnNbcG9pbnRlciAtIDFdWzFdICtcbiAgICAgICAgICAgIGRpZmZzW3BvaW50ZXJdWzFdLnN1YnN0cmluZygwLCBkaWZmc1twb2ludGVyXVsxXS5sZW5ndGggLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZzW3BvaW50ZXIgLSAxXVsxXS5sZW5ndGgpO1xuICAgICAgICBkaWZmc1twb2ludGVyICsgMV1bMV0gPSBkaWZmc1twb2ludGVyIC0gMV1bMV0gKyBkaWZmc1twb2ludGVyICsgMV1bMV07XG4gICAgICAgIGRpZmZzLnNwbGljZShwb2ludGVyIC0gMSwgMSk7XG4gICAgICAgIGNoYW5nZXMgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkaWZmc1twb2ludGVyXVsxXS5zdWJzdHJpbmcoMCwgZGlmZnNbcG9pbnRlciArIDFdWzFdLmxlbmd0aCkgPT1cbiAgICAgICAgICBkaWZmc1twb2ludGVyICsgMV1bMV0pIHtcbiAgICAgICAgLy8gU2hpZnQgdGhlIGVkaXQgb3ZlciB0aGUgbmV4dCBlcXVhbGl0eS5cbiAgICAgICAgZGlmZnNbcG9pbnRlciAtIDFdWzFdICs9IGRpZmZzW3BvaW50ZXIgKyAxXVsxXTtcbiAgICAgICAgZGlmZnNbcG9pbnRlcl1bMV0gPVxuICAgICAgICAgICAgZGlmZnNbcG9pbnRlcl1bMV0uc3Vic3RyaW5nKGRpZmZzW3BvaW50ZXIgKyAxXVsxXS5sZW5ndGgpICtcbiAgICAgICAgICAgIGRpZmZzW3BvaW50ZXIgKyAxXVsxXTtcbiAgICAgICAgZGlmZnMuc3BsaWNlKHBvaW50ZXIgKyAxLCAxKTtcbiAgICAgICAgY2hhbmdlcyA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHBvaW50ZXIrKztcbiAgfVxuICAvLyBJZiBzaGlmdHMgd2VyZSBtYWRlLCB0aGUgZGlmZiBuZWVkcyByZW9yZGVyaW5nIGFuZCBhbm90aGVyIHNoaWZ0IHN3ZWVwLlxuICBpZiAoY2hhbmdlcykge1xuICAgIHRoaXMuZGlmZl9jbGVhbnVwTWVyZ2UoZGlmZnMpO1xuICB9XG59O1xuXG5cbi8qKlxuICogbG9jIGlzIGEgbG9jYXRpb24gaW4gdGV4dDEsIGNvbXB1dGUgYW5kIHJldHVybiB0aGUgZXF1aXZhbGVudCBsb2NhdGlvbiBpblxuICogdGV4dDIuXG4gKiBlLmcuICdUaGUgY2F0JyB2cyAnVGhlIGJpZyBjYXQnLCAxLT4xLCA1LT44XG4gKiBAcGFyYW0geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59IGRpZmZzIEFycmF5IG9mIGRpZmYgdHVwbGVzLlxuICogQHBhcmFtIHtudW1iZXJ9IGxvYyBMb2NhdGlvbiB3aXRoaW4gdGV4dDEuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IExvY2F0aW9uIHdpdGhpbiB0ZXh0Mi5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl94SW5kZXggPSBmdW5jdGlvbihkaWZmcywgbG9jKSB7XG4gIHZhciBjaGFyczEgPSAwO1xuICB2YXIgY2hhcnMyID0gMDtcbiAgdmFyIGxhc3RfY2hhcnMxID0gMDtcbiAgdmFyIGxhc3RfY2hhcnMyID0gMDtcbiAgdmFyIHg7XG4gIGZvciAoeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykge1xuICAgIGlmIChkaWZmc1t4XVswXSAhPT0gRElGRl9JTlNFUlQpIHsgIC8vIEVxdWFsaXR5IG9yIGRlbGV0aW9uLlxuICAgICAgY2hhcnMxICs9IGRpZmZzW3hdWzFdLmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKGRpZmZzW3hdWzBdICE9PSBESUZGX0RFTEVURSkgeyAgLy8gRXF1YWxpdHkgb3IgaW5zZXJ0aW9uLlxuICAgICAgY2hhcnMyICs9IGRpZmZzW3hdWzFdLmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKGNoYXJzMSA+IGxvYykgeyAgLy8gT3ZlcnNob3QgdGhlIGxvY2F0aW9uLlxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGxhc3RfY2hhcnMxID0gY2hhcnMxO1xuICAgIGxhc3RfY2hhcnMyID0gY2hhcnMyO1xuICB9XG4gIC8vIFdhcyB0aGUgbG9jYXRpb24gd2FzIGRlbGV0ZWQ/XG4gIGlmIChkaWZmcy5sZW5ndGggIT0geCAmJiBkaWZmc1t4XVswXSA9PT0gRElGRl9ERUxFVEUpIHtcbiAgICByZXR1cm4gbGFzdF9jaGFyczI7XG4gIH1cbiAgLy8gQWRkIHRoZSByZW1haW5pbmcgY2hhcmFjdGVyIGxlbmd0aC5cbiAgcmV0dXJuIGxhc3RfY2hhcnMyICsgKGxvYyAtIGxhc3RfY2hhcnMxKTtcbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0IGEgZGlmZiBhcnJheSBpbnRvIGEgcHJldHR5IEhUTUwgcmVwb3J0LlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqIEByZXR1cm4ge3N0cmluZ30gSFRNTCByZXByZXNlbnRhdGlvbi5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9wcmV0dHlIdG1sID0gZnVuY3Rpb24oZGlmZnMpIHtcbiAgdmFyIGh0bWwgPSBbXTtcbiAgdmFyIHBhdHRlcm5fYW1wID0gLyYvZztcbiAgdmFyIHBhdHRlcm5fbHQgPSAvPC9nO1xuICB2YXIgcGF0dGVybl9ndCA9IC8+L2c7XG4gIHZhciBwYXR0ZXJuX3BhcmEgPSAvXFxuL2c7XG4gIGZvciAodmFyIHggPSAwOyB4IDwgZGlmZnMubGVuZ3RoOyB4KyspIHtcbiAgICB2YXIgb3AgPSBkaWZmc1t4XVswXTsgICAgLy8gT3BlcmF0aW9uIChpbnNlcnQsIGRlbGV0ZSwgZXF1YWwpXG4gICAgdmFyIGRhdGEgPSBkaWZmc1t4XVsxXTsgIC8vIFRleHQgb2YgY2hhbmdlLlxuICAgIHZhciB0ZXh0ID0gZGF0YS5yZXBsYWNlKHBhdHRlcm5fYW1wLCAnJmFtcDsnKS5yZXBsYWNlKHBhdHRlcm5fbHQsICcmbHQ7JylcbiAgICAgICAgLnJlcGxhY2UocGF0dGVybl9ndCwgJyZndDsnKS5yZXBsYWNlKHBhdHRlcm5fcGFyYSwgJyZwYXJhOzxicj4nKTtcbiAgICBzd2l0Y2ggKG9wKSB7XG4gICAgICBjYXNlIERJRkZfSU5TRVJUOlxuICAgICAgICBodG1sW3hdID0gJzxpbnMgc3R5bGU9XCJiYWNrZ3JvdW5kOiNlNmZmZTY7XCI+JyArIHRleHQgKyAnPC9pbnM+JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfREVMRVRFOlxuICAgICAgICBodG1sW3hdID0gJzxkZWwgc3R5bGU9XCJiYWNrZ3JvdW5kOiNmZmU2ZTY7XCI+JyArIHRleHQgKyAnPC9kZWw+JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfRVFVQUw6XG4gICAgICAgIGh0bWxbeF0gPSAnPHNwYW4+JyArIHRleHQgKyAnPC9zcGFuPic7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaHRtbC5qb2luKCcnKTtcbn07XG5cblxuLyoqXG4gKiBDb21wdXRlIGFuZCByZXR1cm4gdGhlIHNvdXJjZSB0ZXh0IChhbGwgZXF1YWxpdGllcyBhbmQgZGVsZXRpb25zKS5cbiAqIEBwYXJhbSB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gZGlmZnMgQXJyYXkgb2YgZGlmZiB0dXBsZXMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFNvdXJjZSB0ZXh0LlxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX3RleHQxID0gZnVuY3Rpb24oZGlmZnMpIHtcbiAgdmFyIHRleHQgPSBbXTtcbiAgZm9yICh2YXIgeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykge1xuICAgIGlmIChkaWZmc1t4XVswXSAhPT0gRElGRl9JTlNFUlQpIHtcbiAgICAgIHRleHRbeF0gPSBkaWZmc1t4XVsxXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRleHQuam9pbignJyk7XG59O1xuXG5cbi8qKlxuICogQ29tcHV0ZSBhbmQgcmV0dXJuIHRoZSBkZXN0aW5hdGlvbiB0ZXh0IChhbGwgZXF1YWxpdGllcyBhbmQgaW5zZXJ0aW9ucykuXG4gKiBAcGFyYW0geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59IGRpZmZzIEFycmF5IG9mIGRpZmYgdHVwbGVzLlxuICogQHJldHVybiB7c3RyaW5nfSBEZXN0aW5hdGlvbiB0ZXh0LlxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX3RleHQyID0gZnVuY3Rpb24oZGlmZnMpIHtcbiAgdmFyIHRleHQgPSBbXTtcbiAgZm9yICh2YXIgeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykge1xuICAgIGlmIChkaWZmc1t4XVswXSAhPT0gRElGRl9ERUxFVEUpIHtcbiAgICAgIHRleHRbeF0gPSBkaWZmc1t4XVsxXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRleHQuam9pbignJyk7XG59O1xuXG5cbi8qKlxuICogQ29tcHV0ZSB0aGUgTGV2ZW5zaHRlaW4gZGlzdGFuY2U7IHRoZSBudW1iZXIgb2YgaW5zZXJ0ZWQsIGRlbGV0ZWQgb3JcbiAqIHN1YnN0aXR1dGVkIGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59IGRpZmZzIEFycmF5IG9mIGRpZmYgdHVwbGVzLlxuICogQHJldHVybiB7bnVtYmVyfSBOdW1iZXIgb2YgY2hhbmdlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9sZXZlbnNodGVpbiA9IGZ1bmN0aW9uKGRpZmZzKSB7XG4gIHZhciBsZXZlbnNodGVpbiA9IDA7XG4gIHZhciBpbnNlcnRpb25zID0gMDtcbiAgdmFyIGRlbGV0aW9ucyA9IDA7XG4gIGZvciAodmFyIHggPSAwOyB4IDwgZGlmZnMubGVuZ3RoOyB4KyspIHtcbiAgICB2YXIgb3AgPSBkaWZmc1t4XVswXTtcbiAgICB2YXIgZGF0YSA9IGRpZmZzW3hdWzFdO1xuICAgIHN3aXRjaCAob3ApIHtcbiAgICAgIGNhc2UgRElGRl9JTlNFUlQ6XG4gICAgICAgIGluc2VydGlvbnMgKz0gZGF0YS5sZW5ndGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0RFTEVURTpcbiAgICAgICAgZGVsZXRpb25zICs9IGRhdGEubGVuZ3RoO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRElGRl9FUVVBTDpcbiAgICAgICAgLy8gQSBkZWxldGlvbiBhbmQgYW4gaW5zZXJ0aW9uIGlzIG9uZSBzdWJzdGl0dXRpb24uXG4gICAgICAgIGxldmVuc2h0ZWluICs9IE1hdGgubWF4KGluc2VydGlvbnMsIGRlbGV0aW9ucyk7XG4gICAgICAgIGluc2VydGlvbnMgPSAwO1xuICAgICAgICBkZWxldGlvbnMgPSAwO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgbGV2ZW5zaHRlaW4gKz0gTWF0aC5tYXgoaW5zZXJ0aW9ucywgZGVsZXRpb25zKTtcbiAgcmV0dXJuIGxldmVuc2h0ZWluO1xufTtcblxuXG4vKipcbiAqIENydXNoIHRoZSBkaWZmIGludG8gYW4gZW5jb2RlZCBzdHJpbmcgd2hpY2ggZGVzY3JpYmVzIHRoZSBvcGVyYXRpb25zXG4gKiByZXF1aXJlZCB0byB0cmFuc2Zvcm0gdGV4dDEgaW50byB0ZXh0Mi5cbiAqIEUuZy4gPTNcXHQtMlxcdCtpbmcgIC0+IEtlZXAgMyBjaGFycywgZGVsZXRlIDIgY2hhcnMsIGluc2VydCAnaW5nJy5cbiAqIE9wZXJhdGlvbnMgYXJlIHRhYi1zZXBhcmF0ZWQuICBJbnNlcnRlZCB0ZXh0IGlzIGVzY2FwZWQgdXNpbmcgJXh4IG5vdGF0aW9uLlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBkaWZmcyBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqIEByZXR1cm4ge3N0cmluZ30gRGVsdGEgdGV4dC5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl90b0RlbHRhID0gZnVuY3Rpb24oZGlmZnMpIHtcbiAgdmFyIHRleHQgPSBbXTtcbiAgZm9yICh2YXIgeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykge1xuICAgIHN3aXRjaCAoZGlmZnNbeF1bMF0pIHtcbiAgICAgIGNhc2UgRElGRl9JTlNFUlQ6XG4gICAgICAgIHRleHRbeF0gPSAnKycgKyBlbmNvZGVVUkkoZGlmZnNbeF1bMV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRElGRl9ERUxFVEU6XG4gICAgICAgIHRleHRbeF0gPSAnLScgKyBkaWZmc1t4XVsxXS5sZW5ndGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICB0ZXh0W3hdID0gJz0nICsgZGlmZnNbeF1bMV0ubGVuZ3RoO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRleHQuam9pbignXFx0JykucmVwbGFjZSgvJTIwL2csICcgJyk7XG59O1xuXG5cbi8qKlxuICogR2l2ZW4gdGhlIG9yaWdpbmFsIHRleHQxLCBhbmQgYW4gZW5jb2RlZCBzdHJpbmcgd2hpY2ggZGVzY3JpYmVzIHRoZVxuICogb3BlcmF0aW9ucyByZXF1aXJlZCB0byB0cmFuc2Zvcm0gdGV4dDEgaW50byB0ZXh0MiwgY29tcHV0ZSB0aGUgZnVsbCBkaWZmLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIFNvdXJjZSBzdHJpbmcgZm9yIHRoZSBkaWZmLlxuICogQHBhcmFtIHtzdHJpbmd9IGRlbHRhIERlbHRhIHRleHQuXG4gKiBAcmV0dXJuIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLkRpZmY+fSBBcnJheSBvZiBkaWZmIHR1cGxlcy5cbiAqIEB0aHJvd3MgeyFFcnJvcn0gSWYgaW52YWxpZCBpbnB1dC5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9mcm9tRGVsdGEgPSBmdW5jdGlvbih0ZXh0MSwgZGVsdGEpIHtcbiAgdmFyIGRpZmZzID0gW107XG4gIHZhciBkaWZmc0xlbmd0aCA9IDA7ICAvLyBLZWVwaW5nIG91ciBvd24gbGVuZ3RoIHZhciBpcyBmYXN0ZXIgaW4gSlMuXG4gIHZhciBwb2ludGVyID0gMDsgIC8vIEN1cnNvciBpbiB0ZXh0MVxuICB2YXIgdG9rZW5zID0gZGVsdGEuc3BsaXQoL1xcdC9nKTtcbiAgZm9yICh2YXIgeCA9IDA7IHggPCB0b2tlbnMubGVuZ3RoOyB4KyspIHtcbiAgICAvLyBFYWNoIHRva2VuIGJlZ2lucyB3aXRoIGEgb25lIGNoYXJhY3RlciBwYXJhbWV0ZXIgd2hpY2ggc3BlY2lmaWVzIHRoZVxuICAgIC8vIG9wZXJhdGlvbiBvZiB0aGlzIHRva2VuIChkZWxldGUsIGluc2VydCwgZXF1YWxpdHkpLlxuICAgIHZhciBwYXJhbSA9IHRva2Vuc1t4XS5zdWJzdHJpbmcoMSk7XG4gICAgc3dpdGNoICh0b2tlbnNbeF0uY2hhckF0KDApKSB7XG4gICAgICBjYXNlICcrJzpcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkaWZmc1tkaWZmc0xlbmd0aCsrXSA9XG4gICAgICAgICAgICAgIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGRlY29kZVVSSShwYXJhbSkpO1xuICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgIC8vIE1hbGZvcm1lZCBVUkkgc2VxdWVuY2UuXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbGxlZ2FsIGVzY2FwZSBpbiBkaWZmX2Zyb21EZWx0YTogJyArIHBhcmFtKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJy0nOlxuICAgICAgICAvLyBGYWxsIHRocm91Z2guXG4gICAgICBjYXNlICc9JzpcbiAgICAgICAgdmFyIG4gPSBwYXJzZUludChwYXJhbSwgMTApO1xuICAgICAgICBpZiAoaXNOYU4obikgfHwgbiA8IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbnVtYmVyIGluIGRpZmZfZnJvbURlbHRhOiAnICsgcGFyYW0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0ZXh0ID0gdGV4dDEuc3Vic3RyaW5nKHBvaW50ZXIsIHBvaW50ZXIgKz0gbik7XG4gICAgICAgIGlmICh0b2tlbnNbeF0uY2hhckF0KDApID09ICc9Jykge1xuICAgICAgICAgIGRpZmZzW2RpZmZzTGVuZ3RoKytdID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCB0ZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWZmc1tkaWZmc0xlbmd0aCsrXSA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gQmxhbmsgdG9rZW5zIGFyZSBvayAoZnJvbSBhIHRyYWlsaW5nIFxcdCkuXG4gICAgICAgIC8vIEFueXRoaW5nIGVsc2UgaXMgYW4gZXJyb3IuXG4gICAgICAgIGlmICh0b2tlbnNbeF0pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZGlmZiBvcGVyYXRpb24gaW4gZGlmZl9mcm9tRGVsdGE6ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnNbeF0pO1xuICAgICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChwb2ludGVyICE9IHRleHQxLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcignRGVsdGEgbGVuZ3RoICgnICsgcG9pbnRlciArXG4gICAgICAgICcpIGRvZXMgbm90IGVxdWFsIHNvdXJjZSB0ZXh0IGxlbmd0aCAoJyArIHRleHQxLmxlbmd0aCArICcpLicpO1xuICB9XG4gIHJldHVybiBkaWZmcztcbn07XG5cblxuLy8gIE1BVENIIEZVTkNUSU9OU1xuXG5cbi8qKlxuICogTG9jYXRlIHRoZSBiZXN0IGluc3RhbmNlIG9mICdwYXR0ZXJuJyBpbiAndGV4dCcgbmVhciAnbG9jJy5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIHNlYXJjaC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXR0ZXJuIFRoZSBwYXR0ZXJuIHRvIHNlYXJjaCBmb3IuXG4gKiBAcGFyYW0ge251bWJlcn0gbG9jIFRoZSBsb2NhdGlvbiB0byBzZWFyY2ggYXJvdW5kLlxuICogQHJldHVybiB7bnVtYmVyfSBCZXN0IG1hdGNoIGluZGV4IG9yIC0xLlxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5tYXRjaF9tYWluID0gZnVuY3Rpb24odGV4dCwgcGF0dGVybiwgbG9jKSB7XG4gIC8vIENoZWNrIGZvciBudWxsIGlucHV0cy5cbiAgaWYgKHRleHQgPT0gbnVsbCB8fCBwYXR0ZXJuID09IG51bGwgfHwgbG9jID09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ051bGwgaW5wdXQuIChtYXRjaF9tYWluKScpO1xuICB9XG5cbiAgbG9jID0gTWF0aC5tYXgoMCwgTWF0aC5taW4obG9jLCB0ZXh0Lmxlbmd0aCkpO1xuICBpZiAodGV4dCA9PSBwYXR0ZXJuKSB7XG4gICAgLy8gU2hvcnRjdXQgKHBvdGVudGlhbGx5IG5vdCBndWFyYW50ZWVkIGJ5IHRoZSBhbGdvcml0aG0pXG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSBpZiAoIXRleHQubGVuZ3RoKSB7XG4gICAgLy8gTm90aGluZyB0byBtYXRjaC5cbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSBpZiAodGV4dC5zdWJzdHJpbmcobG9jLCBsb2MgKyBwYXR0ZXJuLmxlbmd0aCkgPT0gcGF0dGVybikge1xuICAgIC8vIFBlcmZlY3QgbWF0Y2ggYXQgdGhlIHBlcmZlY3Qgc3BvdCEgIChJbmNsdWRlcyBjYXNlIG9mIG51bGwgcGF0dGVybilcbiAgICByZXR1cm4gbG9jO1xuICB9IGVsc2Uge1xuICAgIC8vIERvIGEgZnV6enkgY29tcGFyZS5cbiAgICByZXR1cm4gdGhpcy5tYXRjaF9iaXRhcF8odGV4dCwgcGF0dGVybiwgbG9jKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIExvY2F0ZSB0aGUgYmVzdCBpbnN0YW5jZSBvZiAncGF0dGVybicgaW4gJ3RleHQnIG5lYXIgJ2xvYycgdXNpbmcgdGhlXG4gKiBCaXRhcCBhbGdvcml0aG0uXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byBzZWFyY2guXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVybiBUaGUgcGF0dGVybiB0byBzZWFyY2ggZm9yLlxuICogQHBhcmFtIHtudW1iZXJ9IGxvYyBUaGUgbG9jYXRpb24gdG8gc2VhcmNoIGFyb3VuZC5cbiAqIEByZXR1cm4ge251bWJlcn0gQmVzdCBtYXRjaCBpbmRleCBvciAtMS5cbiAqIEBwcml2YXRlXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLm1hdGNoX2JpdGFwXyA9IGZ1bmN0aW9uKHRleHQsIHBhdHRlcm4sIGxvYykge1xuICBpZiAocGF0dGVybi5sZW5ndGggPiB0aGlzLk1hdGNoX01heEJpdHMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhdHRlcm4gdG9vIGxvbmcgZm9yIHRoaXMgYnJvd3Nlci4nKTtcbiAgfVxuXG4gIC8vIEluaXRpYWxpc2UgdGhlIGFscGhhYmV0LlxuICB2YXIgcyA9IHRoaXMubWF0Y2hfYWxwaGFiZXRfKHBhdHRlcm4pO1xuXG4gIHZhciBkbXAgPSB0aGlzOyAgLy8gJ3RoaXMnIGJlY29tZXMgJ3dpbmRvdycgaW4gYSBjbG9zdXJlLlxuXG4gIC8qKlxuICAgKiBDb21wdXRlIGFuZCByZXR1cm4gdGhlIHNjb3JlIGZvciBhIG1hdGNoIHdpdGggZSBlcnJvcnMgYW5kIHggbG9jYXRpb24uXG4gICAqIEFjY2Vzc2VzIGxvYyBhbmQgcGF0dGVybiB0aHJvdWdoIGJlaW5nIGEgY2xvc3VyZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGUgTnVtYmVyIG9mIGVycm9ycyBpbiBtYXRjaC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHggTG9jYXRpb24gb2YgbWF0Y2guXG4gICAqIEByZXR1cm4ge251bWJlcn0gT3ZlcmFsbCBzY29yZSBmb3IgbWF0Y2ggKDAuMCA9IGdvb2QsIDEuMCA9IGJhZCkuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBtYXRjaF9iaXRhcFNjb3JlXyhlLCB4KSB7XG4gICAgdmFyIGFjY3VyYWN5ID0gZSAvIHBhdHRlcm4ubGVuZ3RoO1xuICAgIHZhciBwcm94aW1pdHkgPSBNYXRoLmFicyhsb2MgLSB4KTtcbiAgICBpZiAoIWRtcC5NYXRjaF9EaXN0YW5jZSkge1xuICAgICAgLy8gRG9kZ2UgZGl2aWRlIGJ5IHplcm8gZXJyb3IuXG4gICAgICByZXR1cm4gcHJveGltaXR5ID8gMS4wIDogYWNjdXJhY3k7XG4gICAgfVxuICAgIHJldHVybiBhY2N1cmFjeSArIChwcm94aW1pdHkgLyBkbXAuTWF0Y2hfRGlzdGFuY2UpO1xuICB9XG5cbiAgLy8gSGlnaGVzdCBzY29yZSBiZXlvbmQgd2hpY2ggd2UgZ2l2ZSB1cC5cbiAgdmFyIHNjb3JlX3RocmVzaG9sZCA9IHRoaXMuTWF0Y2hfVGhyZXNob2xkO1xuICAvLyBJcyB0aGVyZSBhIG5lYXJieSBleGFjdCBtYXRjaD8gKHNwZWVkdXApXG4gIHZhciBiZXN0X2xvYyA9IHRleHQuaW5kZXhPZihwYXR0ZXJuLCBsb2MpO1xuICBpZiAoYmVzdF9sb2MgIT0gLTEpIHtcbiAgICBzY29yZV90aHJlc2hvbGQgPSBNYXRoLm1pbihtYXRjaF9iaXRhcFNjb3JlXygwLCBiZXN0X2xvYyksIHNjb3JlX3RocmVzaG9sZCk7XG4gICAgLy8gV2hhdCBhYm91dCBpbiB0aGUgb3RoZXIgZGlyZWN0aW9uPyAoc3BlZWR1cClcbiAgICBiZXN0X2xvYyA9IHRleHQubGFzdEluZGV4T2YocGF0dGVybiwgbG9jICsgcGF0dGVybi5sZW5ndGgpO1xuICAgIGlmIChiZXN0X2xvYyAhPSAtMSkge1xuICAgICAgc2NvcmVfdGhyZXNob2xkID1cbiAgICAgICAgICBNYXRoLm1pbihtYXRjaF9iaXRhcFNjb3JlXygwLCBiZXN0X2xvYyksIHNjb3JlX3RocmVzaG9sZCk7XG4gICAgfVxuICB9XG5cbiAgLy8gSW5pdGlhbGlzZSB0aGUgYml0IGFycmF5cy5cbiAgdmFyIG1hdGNobWFzayA9IDEgPDwgKHBhdHRlcm4ubGVuZ3RoIC0gMSk7XG4gIGJlc3RfbG9jID0gLTE7XG5cbiAgdmFyIGJpbl9taW4sIGJpbl9taWQ7XG4gIHZhciBiaW5fbWF4ID0gcGF0dGVybi5sZW5ndGggKyB0ZXh0Lmxlbmd0aDtcbiAgdmFyIGxhc3RfcmQ7XG4gIGZvciAodmFyIGQgPSAwOyBkIDwgcGF0dGVybi5sZW5ndGg7IGQrKykge1xuICAgIC8vIFNjYW4gZm9yIHRoZSBiZXN0IG1hdGNoOyBlYWNoIGl0ZXJhdGlvbiBhbGxvd3MgZm9yIG9uZSBtb3JlIGVycm9yLlxuICAgIC8vIFJ1biBhIGJpbmFyeSBzZWFyY2ggdG8gZGV0ZXJtaW5lIGhvdyBmYXIgZnJvbSAnbG9jJyB3ZSBjYW4gc3RyYXkgYXQgdGhpc1xuICAgIC8vIGVycm9yIGxldmVsLlxuICAgIGJpbl9taW4gPSAwO1xuICAgIGJpbl9taWQgPSBiaW5fbWF4O1xuICAgIHdoaWxlIChiaW5fbWluIDwgYmluX21pZCkge1xuICAgICAgaWYgKG1hdGNoX2JpdGFwU2NvcmVfKGQsIGxvYyArIGJpbl9taWQpIDw9IHNjb3JlX3RocmVzaG9sZCkge1xuICAgICAgICBiaW5fbWluID0gYmluX21pZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJpbl9tYXggPSBiaW5fbWlkO1xuICAgICAgfVxuICAgICAgYmluX21pZCA9IE1hdGguZmxvb3IoKGJpbl9tYXggLSBiaW5fbWluKSAvIDIgKyBiaW5fbWluKTtcbiAgICB9XG4gICAgLy8gVXNlIHRoZSByZXN1bHQgZnJvbSB0aGlzIGl0ZXJhdGlvbiBhcyB0aGUgbWF4aW11bSBmb3IgdGhlIG5leHQuXG4gICAgYmluX21heCA9IGJpbl9taWQ7XG4gICAgdmFyIHN0YXJ0ID0gTWF0aC5tYXgoMSwgbG9jIC0gYmluX21pZCArIDEpO1xuICAgIHZhciBmaW5pc2ggPSBNYXRoLm1pbihsb2MgKyBiaW5fbWlkLCB0ZXh0Lmxlbmd0aCkgKyBwYXR0ZXJuLmxlbmd0aDtcblxuICAgIHZhciByZCA9IEFycmF5KGZpbmlzaCArIDIpO1xuICAgIHJkW2ZpbmlzaCArIDFdID0gKDEgPDwgZCkgLSAxO1xuICAgIGZvciAodmFyIGogPSBmaW5pc2g7IGogPj0gc3RhcnQ7IGotLSkge1xuICAgICAgLy8gVGhlIGFscGhhYmV0IChzKSBpcyBhIHNwYXJzZSBoYXNoLCBzbyB0aGUgZm9sbG93aW5nIGxpbmUgZ2VuZXJhdGVzXG4gICAgICAvLyB3YXJuaW5ncy5cbiAgICAgIHZhciBjaGFyTWF0Y2ggPSBzW3RleHQuY2hhckF0KGogLSAxKV07XG4gICAgICBpZiAoZCA9PT0gMCkgeyAgLy8gRmlyc3QgcGFzczogZXhhY3QgbWF0Y2guXG4gICAgICAgIHJkW2pdID0gKChyZFtqICsgMV0gPDwgMSkgfCAxKSAmIGNoYXJNYXRjaDtcbiAgICAgIH0gZWxzZSB7ICAvLyBTdWJzZXF1ZW50IHBhc3NlczogZnV6enkgbWF0Y2guXG4gICAgICAgIHJkW2pdID0gKCgocmRbaiArIDFdIDw8IDEpIHwgMSkgJiBjaGFyTWF0Y2gpIHxcbiAgICAgICAgICAgICAgICAoKChsYXN0X3JkW2ogKyAxXSB8IGxhc3RfcmRbal0pIDw8IDEpIHwgMSkgfFxuICAgICAgICAgICAgICAgIGxhc3RfcmRbaiArIDFdO1xuICAgICAgfVxuICAgICAgaWYgKHJkW2pdICYgbWF0Y2htYXNrKSB7XG4gICAgICAgIHZhciBzY29yZSA9IG1hdGNoX2JpdGFwU2NvcmVfKGQsIGogLSAxKTtcbiAgICAgICAgLy8gVGhpcyBtYXRjaCB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgYmUgYmV0dGVyIHRoYW4gYW55IGV4aXN0aW5nIG1hdGNoLlxuICAgICAgICAvLyBCdXQgY2hlY2sgYW55d2F5LlxuICAgICAgICBpZiAoc2NvcmUgPD0gc2NvcmVfdGhyZXNob2xkKSB7XG4gICAgICAgICAgLy8gVG9sZCB5b3Ugc28uXG4gICAgICAgICAgc2NvcmVfdGhyZXNob2xkID0gc2NvcmU7XG4gICAgICAgICAgYmVzdF9sb2MgPSBqIC0gMTtcbiAgICAgICAgICBpZiAoYmVzdF9sb2MgPiBsb2MpIHtcbiAgICAgICAgICAgIC8vIFdoZW4gcGFzc2luZyBsb2MsIGRvbid0IGV4Y2VlZCBvdXIgY3VycmVudCBkaXN0YW5jZSBmcm9tIGxvYy5cbiAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoMSwgMiAqIGxvYyAtIGJlc3RfbG9jKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQWxyZWFkeSBwYXNzZWQgbG9jLCBkb3duaGlsbCBmcm9tIGhlcmUgb24gaW4uXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLy8gTm8gaG9wZSBmb3IgYSAoYmV0dGVyKSBtYXRjaCBhdCBncmVhdGVyIGVycm9yIGxldmVscy5cbiAgICBpZiAobWF0Y2hfYml0YXBTY29yZV8oZCArIDEsIGxvYykgPiBzY29yZV90aHJlc2hvbGQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXN0X3JkID0gcmQ7XG4gIH1cbiAgcmV0dXJuIGJlc3RfbG9jO1xufTtcblxuXG4vKipcbiAqIEluaXRpYWxpc2UgdGhlIGFscGhhYmV0IGZvciB0aGUgQml0YXAgYWxnb3JpdGhtLlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdHRlcm4gVGhlIHRleHQgdG8gZW5jb2RlLlxuICogQHJldHVybiB7IU9iamVjdH0gSGFzaCBvZiBjaGFyYWN0ZXIgbG9jYXRpb25zLlxuICogQHByaXZhdGVcbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUubWF0Y2hfYWxwaGFiZXRfID0gZnVuY3Rpb24ocGF0dGVybikge1xuICB2YXIgcyA9IHt9O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm4ubGVuZ3RoOyBpKyspIHtcbiAgICBzW3BhdHRlcm4uY2hhckF0KGkpXSA9IDA7XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXR0ZXJuLmxlbmd0aDsgaSsrKSB7XG4gICAgc1twYXR0ZXJuLmNoYXJBdChpKV0gfD0gMSA8PCAocGF0dGVybi5sZW5ndGggLSBpIC0gMSk7XG4gIH1cbiAgcmV0dXJuIHM7XG59O1xuXG5cbi8vICBQQVRDSCBGVU5DVElPTlNcblxuXG4vKipcbiAqIEluY3JlYXNlIHRoZSBjb250ZXh0IHVudGlsIGl0IGlzIHVuaXF1ZSxcbiAqIGJ1dCBkb24ndCBsZXQgdGhlIHBhdHRlcm4gZXhwYW5kIGJleW9uZCBNYXRjaF9NYXhCaXRzLlxuICogQHBhcmFtIHshZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmp9IHBhdGNoIFRoZSBwYXRjaCB0byBncm93LlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQgU291cmNlIHRleHQuXG4gKiBAcHJpdmF0ZVxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9hZGRDb250ZXh0XyA9IGZ1bmN0aW9uKHBhdGNoLCB0ZXh0KSB7XG4gIGlmICh0ZXh0Lmxlbmd0aCA9PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChwYXRjaC5zdGFydDIgPT09IG51bGwpIHtcbiAgICB0aHJvdyBFcnJvcigncGF0Y2ggbm90IGluaXRpYWxpemVkJyk7XG4gIH1cbiAgdmFyIHBhdHRlcm4gPSB0ZXh0LnN1YnN0cmluZyhwYXRjaC5zdGFydDIsIHBhdGNoLnN0YXJ0MiArIHBhdGNoLmxlbmd0aDEpO1xuICB2YXIgcGFkZGluZyA9IDA7XG5cbiAgLy8gTG9vayBmb3IgdGhlIGZpcnN0IGFuZCBsYXN0IG1hdGNoZXMgb2YgcGF0dGVybiBpbiB0ZXh0LiAgSWYgdHdvIGRpZmZlcmVudFxuICAvLyBtYXRjaGVzIGFyZSBmb3VuZCwgaW5jcmVhc2UgdGhlIHBhdHRlcm4gbGVuZ3RoLlxuICB3aGlsZSAodGV4dC5pbmRleE9mKHBhdHRlcm4pICE9IHRleHQubGFzdEluZGV4T2YocGF0dGVybikgJiZcbiAgICAgICAgIHBhdHRlcm4ubGVuZ3RoIDwgdGhpcy5NYXRjaF9NYXhCaXRzIC0gdGhpcy5QYXRjaF9NYXJnaW4gLVxuICAgICAgICAgdGhpcy5QYXRjaF9NYXJnaW4pIHtcbiAgICBwYWRkaW5nICs9IHRoaXMuUGF0Y2hfTWFyZ2luO1xuICAgIHBhdHRlcm4gPSB0ZXh0LnN1YnN0cmluZyhwYXRjaC5zdGFydDIgLSBwYWRkaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaC5zdGFydDIgKyBwYXRjaC5sZW5ndGgxICsgcGFkZGluZyk7XG4gIH1cbiAgLy8gQWRkIG9uZSBjaHVuayBmb3IgZ29vZCBsdWNrLlxuICBwYWRkaW5nICs9IHRoaXMuUGF0Y2hfTWFyZ2luO1xuXG4gIC8vIEFkZCB0aGUgcHJlZml4LlxuICB2YXIgcHJlZml4ID0gdGV4dC5zdWJzdHJpbmcocGF0Y2guc3RhcnQyIC0gcGFkZGluZywgcGF0Y2guc3RhcnQyKTtcbiAgaWYgKHByZWZpeCkge1xuICAgIHBhdGNoLmRpZmZzLnVuc2hpZnQobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBwcmVmaXgpKTtcbiAgfVxuICAvLyBBZGQgdGhlIHN1ZmZpeC5cbiAgdmFyIHN1ZmZpeCA9IHRleHQuc3Vic3RyaW5nKHBhdGNoLnN0YXJ0MiArIHBhdGNoLmxlbmd0aDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaC5zdGFydDIgKyBwYXRjaC5sZW5ndGgxICsgcGFkZGluZyk7XG4gIGlmIChzdWZmaXgpIHtcbiAgICBwYXRjaC5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgc3VmZml4KSk7XG4gIH1cblxuICAvLyBSb2xsIGJhY2sgdGhlIHN0YXJ0IHBvaW50cy5cbiAgcGF0Y2guc3RhcnQxIC09IHByZWZpeC5sZW5ndGg7XG4gIHBhdGNoLnN0YXJ0MiAtPSBwcmVmaXgubGVuZ3RoO1xuICAvLyBFeHRlbmQgdGhlIGxlbmd0aHMuXG4gIHBhdGNoLmxlbmd0aDEgKz0gcHJlZml4Lmxlbmd0aCArIHN1ZmZpeC5sZW5ndGg7XG4gIHBhdGNoLmxlbmd0aDIgKz0gcHJlZml4Lmxlbmd0aCArIHN1ZmZpeC5sZW5ndGg7XG59O1xuXG5cbi8qKlxuICogQ29tcHV0ZSBhIGxpc3Qgb2YgcGF0Y2hlcyB0byB0dXJuIHRleHQxIGludG8gdGV4dDIuXG4gKiBVc2UgZGlmZnMgaWYgcHJvdmlkZWQsIG90aGVyd2lzZSBjb21wdXRlIGl0IG91cnNlbHZlcy5cbiAqIFRoZXJlIGFyZSBmb3VyIHdheXMgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uLCBkZXBlbmRpbmcgb24gd2hhdCBkYXRhIGlzXG4gKiBhdmFpbGFibGUgdG8gdGhlIGNhbGxlcjpcbiAqIE1ldGhvZCAxOlxuICogYSA9IHRleHQxLCBiID0gdGV4dDJcbiAqIE1ldGhvZCAyOlxuICogYSA9IGRpZmZzXG4gKiBNZXRob2QgMyAob3B0aW1hbCk6XG4gKiBhID0gdGV4dDEsIGIgPSBkaWZmc1xuICogTWV0aG9kIDQgKGRlcHJlY2F0ZWQsIHVzZSBtZXRob2QgMyk6XG4gKiBhID0gdGV4dDEsIGIgPSB0ZXh0MiwgYyA9IGRpZmZzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gYSB0ZXh0MSAobWV0aG9kcyAxLDMsNCkgb3JcbiAqIEFycmF5IG9mIGRpZmYgdHVwbGVzIGZvciB0ZXh0MSB0byB0ZXh0MiAobWV0aG9kIDIpLlxuICogQHBhcmFtIHtzdHJpbmd8IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPj19IG9wdF9iIHRleHQyIChtZXRob2RzIDEsNCkgb3JcbiAqIEFycmF5IG9mIGRpZmYgdHVwbGVzIGZvciB0ZXh0MSB0byB0ZXh0MiAobWV0aG9kIDMpIG9yIHVuZGVmaW5lZCAobWV0aG9kIDIpLlxuICogQHBhcmFtIHtzdHJpbmd8IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPj19IG9wdF9jIEFycmF5IG9mIGRpZmYgdHVwbGVzXG4gKiBmb3IgdGV4dDEgdG8gdGV4dDIgKG1ldGhvZCA0KSBvciB1bmRlZmluZWQgKG1ldGhvZHMgMSwyLDMpLlxuICogQHJldHVybiB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmo+fSBBcnJheSBvZiBQYXRjaCBvYmplY3RzLlxuICovXG5kaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9tYWtlID0gZnVuY3Rpb24oYSwgb3B0X2IsIG9wdF9jKSB7XG4gIHZhciB0ZXh0MSwgZGlmZnM7XG4gIGlmICh0eXBlb2YgYSA9PSAnc3RyaW5nJyAmJiB0eXBlb2Ygb3B0X2IgPT0gJ3N0cmluZycgJiZcbiAgICAgIHR5cGVvZiBvcHRfYyA9PSAndW5kZWZpbmVkJykge1xuICAgIC8vIE1ldGhvZCAxOiB0ZXh0MSwgdGV4dDJcbiAgICAvLyBDb21wdXRlIGRpZmZzIGZyb20gdGV4dDEgYW5kIHRleHQyLlxuICAgIHRleHQxID0gLyoqIEB0eXBlIHtzdHJpbmd9ICovKGEpO1xuICAgIGRpZmZzID0gdGhpcy5kaWZmX21haW4odGV4dDEsIC8qKiBAdHlwZSB7c3RyaW5nfSAqLyhvcHRfYiksIHRydWUpO1xuICAgIGlmIChkaWZmcy5sZW5ndGggPiAyKSB7XG4gICAgICB0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljKGRpZmZzKTtcbiAgICAgIHRoaXMuZGlmZl9jbGVhbnVwRWZmaWNpZW5jeShkaWZmcyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGEgJiYgdHlwZW9mIGEgPT0gJ29iamVjdCcgJiYgdHlwZW9mIG9wdF9iID09ICd1bmRlZmluZWQnICYmXG4gICAgICB0eXBlb2Ygb3B0X2MgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBNZXRob2QgMjogZGlmZnNcbiAgICAvLyBDb21wdXRlIHRleHQxIGZyb20gZGlmZnMuXG4gICAgZGlmZnMgPSAvKiogQHR5cGUgeyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59ICovKGEpO1xuICAgIHRleHQxID0gdGhpcy5kaWZmX3RleHQxKGRpZmZzKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PSAnc3RyaW5nJyAmJiBvcHRfYiAmJiB0eXBlb2Ygb3B0X2IgPT0gJ29iamVjdCcgJiZcbiAgICAgIHR5cGVvZiBvcHRfYyA9PSAndW5kZWZpbmVkJykge1xuICAgIC8vIE1ldGhvZCAzOiB0ZXh0MSwgZGlmZnNcbiAgICB0ZXh0MSA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyhhKTtcbiAgICBkaWZmcyA9IC8qKiBAdHlwZSB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gKi8ob3B0X2IpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBhID09ICdzdHJpbmcnICYmIHR5cGVvZiBvcHRfYiA9PSAnc3RyaW5nJyAmJlxuICAgICAgb3B0X2MgJiYgdHlwZW9mIG9wdF9jID09ICdvYmplY3QnKSB7XG4gICAgLy8gTWV0aG9kIDQ6IHRleHQxLCB0ZXh0MiwgZGlmZnNcbiAgICAvLyB0ZXh0MiBpcyBub3QgdXNlZC5cbiAgICB0ZXh0MSA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyhhKTtcbiAgICBkaWZmcyA9IC8qKiBAdHlwZSB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5EaWZmPn0gKi8ob3B0X2MpO1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBjYWxsIGZvcm1hdCB0byBwYXRjaF9tYWtlLicpO1xuICB9XG5cbiAgaWYgKGRpZmZzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBbXTsgIC8vIEdldCByaWQgb2YgdGhlIG51bGwgY2FzZS5cbiAgfVxuICB2YXIgcGF0Y2hlcyA9IFtdO1xuICB2YXIgcGF0Y2ggPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmooKTtcbiAgdmFyIHBhdGNoRGlmZkxlbmd0aCA9IDA7ICAvLyBLZWVwaW5nIG91ciBvd24gbGVuZ3RoIHZhciBpcyBmYXN0ZXIgaW4gSlMuXG4gIHZhciBjaGFyX2NvdW50MSA9IDA7ICAvLyBOdW1iZXIgb2YgY2hhcmFjdGVycyBpbnRvIHRoZSB0ZXh0MSBzdHJpbmcuXG4gIHZhciBjaGFyX2NvdW50MiA9IDA7ICAvLyBOdW1iZXIgb2YgY2hhcmFjdGVycyBpbnRvIHRoZSB0ZXh0MiBzdHJpbmcuXG4gIC8vIFN0YXJ0IHdpdGggdGV4dDEgKHByZXBhdGNoX3RleHQpIGFuZCBhcHBseSB0aGUgZGlmZnMgdW50aWwgd2UgYXJyaXZlIGF0XG4gIC8vIHRleHQyIChwb3N0cGF0Y2hfdGV4dCkuICBXZSByZWNyZWF0ZSB0aGUgcGF0Y2hlcyBvbmUgYnkgb25lIHRvIGRldGVybWluZVxuICAvLyBjb250ZXh0IGluZm8uXG4gIHZhciBwcmVwYXRjaF90ZXh0ID0gdGV4dDE7XG4gIHZhciBwb3N0cGF0Y2hfdGV4dCA9IHRleHQxO1xuICBmb3IgKHZhciB4ID0gMDsgeCA8IGRpZmZzLmxlbmd0aDsgeCsrKSB7XG4gICAgdmFyIGRpZmZfdHlwZSA9IGRpZmZzW3hdWzBdO1xuICAgIHZhciBkaWZmX3RleHQgPSBkaWZmc1t4XVsxXTtcblxuICAgIGlmICghcGF0Y2hEaWZmTGVuZ3RoICYmIGRpZmZfdHlwZSAhPT0gRElGRl9FUVVBTCkge1xuICAgICAgLy8gQSBuZXcgcGF0Y2ggc3RhcnRzIGhlcmUuXG4gICAgICBwYXRjaC5zdGFydDEgPSBjaGFyX2NvdW50MTtcbiAgICAgIHBhdGNoLnN0YXJ0MiA9IGNoYXJfY291bnQyO1xuICAgIH1cblxuICAgIHN3aXRjaCAoZGlmZl90eXBlKSB7XG4gICAgICBjYXNlIERJRkZfSU5TRVJUOlxuICAgICAgICBwYXRjaC5kaWZmc1twYXRjaERpZmZMZW5ndGgrK10gPSBkaWZmc1t4XTtcbiAgICAgICAgcGF0Y2gubGVuZ3RoMiArPSBkaWZmX3RleHQubGVuZ3RoO1xuICAgICAgICBwb3N0cGF0Y2hfdGV4dCA9IHBvc3RwYXRjaF90ZXh0LnN1YnN0cmluZygwLCBjaGFyX2NvdW50MikgKyBkaWZmX3RleHQgK1xuICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RwYXRjaF90ZXh0LnN1YnN0cmluZyhjaGFyX2NvdW50Mik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0RFTEVURTpcbiAgICAgICAgcGF0Y2gubGVuZ3RoMSArPSBkaWZmX3RleHQubGVuZ3RoO1xuICAgICAgICBwYXRjaC5kaWZmc1twYXRjaERpZmZMZW5ndGgrK10gPSBkaWZmc1t4XTtcbiAgICAgICAgcG9zdHBhdGNoX3RleHQgPSBwb3N0cGF0Y2hfdGV4dC5zdWJzdHJpbmcoMCwgY2hhcl9jb3VudDIpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0cGF0Y2hfdGV4dC5zdWJzdHJpbmcoY2hhcl9jb3VudDIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmX3RleHQubGVuZ3RoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfRVFVQUw6XG4gICAgICAgIGlmIChkaWZmX3RleHQubGVuZ3RoIDw9IDIgKiB0aGlzLlBhdGNoX01hcmdpbiAmJlxuICAgICAgICAgICAgcGF0Y2hEaWZmTGVuZ3RoICYmIGRpZmZzLmxlbmd0aCAhPSB4ICsgMSkge1xuICAgICAgICAgIC8vIFNtYWxsIGVxdWFsaXR5IGluc2lkZSBhIHBhdGNoLlxuICAgICAgICAgIHBhdGNoLmRpZmZzW3BhdGNoRGlmZkxlbmd0aCsrXSA9IGRpZmZzW3hdO1xuICAgICAgICAgIHBhdGNoLmxlbmd0aDEgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBwYXRjaC5sZW5ndGgyICs9IGRpZmZfdGV4dC5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlmZl90ZXh0Lmxlbmd0aCA+PSAyICogdGhpcy5QYXRjaF9NYXJnaW4pIHtcbiAgICAgICAgICAvLyBUaW1lIGZvciBhIG5ldyBwYXRjaC5cbiAgICAgICAgICBpZiAocGF0Y2hEaWZmTGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnBhdGNoX2FkZENvbnRleHRfKHBhdGNoLCBwcmVwYXRjaF90ZXh0KTtcbiAgICAgICAgICAgIHBhdGNoZXMucHVzaChwYXRjaCk7XG4gICAgICAgICAgICBwYXRjaCA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpO1xuICAgICAgICAgICAgcGF0Y2hEaWZmTGVuZ3RoID0gMDtcbiAgICAgICAgICAgIC8vIFVubGlrZSBVbmlkaWZmLCBvdXIgcGF0Y2ggbGlzdHMgaGF2ZSBhIHJvbGxpbmcgY29udGV4dC5cbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvZGlmZi1tYXRjaC1wYXRjaC93aWtpL1VuaWRpZmZcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBwcmVwYXRjaCB0ZXh0ICYgcG9zIHRvIHJlZmxlY3QgdGhlIGFwcGxpY2F0aW9uIG9mIHRoZVxuICAgICAgICAgICAgLy8ganVzdCBjb21wbGV0ZWQgcGF0Y2guXG4gICAgICAgICAgICBwcmVwYXRjaF90ZXh0ID0gcG9zdHBhdGNoX3RleHQ7XG4gICAgICAgICAgICBjaGFyX2NvdW50MSA9IGNoYXJfY291bnQyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIGN1cnJlbnQgY2hhcmFjdGVyIGNvdW50LlxuICAgIGlmIChkaWZmX3R5cGUgIT09IERJRkZfSU5TRVJUKSB7XG4gICAgICBjaGFyX2NvdW50MSArPSBkaWZmX3RleHQubGVuZ3RoO1xuICAgIH1cbiAgICBpZiAoZGlmZl90eXBlICE9PSBESUZGX0RFTEVURSkge1xuICAgICAgY2hhcl9jb3VudDIgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICB9XG4gIH1cbiAgLy8gUGljayB1cCB0aGUgbGVmdG92ZXIgcGF0Y2ggaWYgbm90IGVtcHR5LlxuICBpZiAocGF0Y2hEaWZmTGVuZ3RoKSB7XG4gICAgdGhpcy5wYXRjaF9hZGRDb250ZXh0XyhwYXRjaCwgcHJlcGF0Y2hfdGV4dCk7XG4gICAgcGF0Y2hlcy5wdXNoKHBhdGNoKTtcbiAgfVxuXG4gIHJldHVybiBwYXRjaGVzO1xufTtcblxuXG4vKipcbiAqIEdpdmVuIGFuIGFycmF5IG9mIHBhdGNoZXMsIHJldHVybiBhbm90aGVyIGFycmF5IHRoYXQgaXMgaWRlbnRpY2FsLlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj59IHBhdGNoZXMgQXJyYXkgb2YgUGF0Y2ggb2JqZWN0cy5cbiAqIEByZXR1cm4geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqPn0gQXJyYXkgb2YgUGF0Y2ggb2JqZWN0cy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfZGVlcENvcHkgPSBmdW5jdGlvbihwYXRjaGVzKSB7XG4gIC8vIE1ha2luZyBkZWVwIGNvcGllcyBpcyBoYXJkIGluIEphdmFTY3JpcHQuXG4gIHZhciBwYXRjaGVzQ29weSA9IFtdO1xuICBmb3IgKHZhciB4ID0gMDsgeCA8IHBhdGNoZXMubGVuZ3RoOyB4KyspIHtcbiAgICB2YXIgcGF0Y2ggPSBwYXRjaGVzW3hdO1xuICAgIHZhciBwYXRjaENvcHkgPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmooKTtcbiAgICBwYXRjaENvcHkuZGlmZnMgPSBbXTtcbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHBhdGNoLmRpZmZzLmxlbmd0aDsgeSsrKSB7XG4gICAgICBwYXRjaENvcHkuZGlmZnNbeV0gPVxuICAgICAgICAgIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYocGF0Y2guZGlmZnNbeV1bMF0sIHBhdGNoLmRpZmZzW3ldWzFdKTtcbiAgICB9XG4gICAgcGF0Y2hDb3B5LnN0YXJ0MSA9IHBhdGNoLnN0YXJ0MTtcbiAgICBwYXRjaENvcHkuc3RhcnQyID0gcGF0Y2guc3RhcnQyO1xuICAgIHBhdGNoQ29weS5sZW5ndGgxID0gcGF0Y2gubGVuZ3RoMTtcbiAgICBwYXRjaENvcHkubGVuZ3RoMiA9IHBhdGNoLmxlbmd0aDI7XG4gICAgcGF0Y2hlc0NvcHlbeF0gPSBwYXRjaENvcHk7XG4gIH1cbiAgcmV0dXJuIHBhdGNoZXNDb3B5O1xufTtcblxuXG4vKipcbiAqIE1lcmdlIGEgc2V0IG9mIHBhdGNoZXMgb250byB0aGUgdGV4dC4gIFJldHVybiBhIHBhdGNoZWQgdGV4dCwgYXMgd2VsbFxuICogYXMgYSBsaXN0IG9mIHRydWUvZmFsc2UgdmFsdWVzIGluZGljYXRpbmcgd2hpY2ggcGF0Y2hlcyB3ZXJlIGFwcGxpZWQuXG4gKiBAcGFyYW0geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqPn0gcGF0Y2hlcyBBcnJheSBvZiBQYXRjaCBvYmplY3RzLlxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQgT2xkIHRleHQuXG4gKiBAcmV0dXJuIHshQXJyYXkuPHN0cmluZ3whQXJyYXkuPGJvb2xlYW4+Pn0gVHdvIGVsZW1lbnQgQXJyYXksIGNvbnRhaW5pbmcgdGhlXG4gKiAgICAgIG5ldyB0ZXh0IGFuZCBhbiBhcnJheSBvZiBib29sZWFuIHZhbHVlcy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfYXBwbHkgPSBmdW5jdGlvbihwYXRjaGVzLCB0ZXh0KSB7XG4gIGlmIChwYXRjaGVzLmxlbmd0aCA9PSAwKSB7XG4gICAgcmV0dXJuIFt0ZXh0LCBbXV07XG4gIH1cblxuICAvLyBEZWVwIGNvcHkgdGhlIHBhdGNoZXMgc28gdGhhdCBubyBjaGFuZ2VzIGFyZSBtYWRlIHRvIG9yaWdpbmFscy5cbiAgcGF0Y2hlcyA9IHRoaXMucGF0Y2hfZGVlcENvcHkocGF0Y2hlcyk7XG5cbiAgdmFyIG51bGxQYWRkaW5nID0gdGhpcy5wYXRjaF9hZGRQYWRkaW5nKHBhdGNoZXMpO1xuICB0ZXh0ID0gbnVsbFBhZGRpbmcgKyB0ZXh0ICsgbnVsbFBhZGRpbmc7XG5cbiAgdGhpcy5wYXRjaF9zcGxpdE1heChwYXRjaGVzKTtcbiAgLy8gZGVsdGEga2VlcHMgdHJhY2sgb2YgdGhlIG9mZnNldCBiZXR3ZWVuIHRoZSBleHBlY3RlZCBhbmQgYWN0dWFsIGxvY2F0aW9uXG4gIC8vIG9mIHRoZSBwcmV2aW91cyBwYXRjaC4gIElmIHRoZXJlIGFyZSBwYXRjaGVzIGV4cGVjdGVkIGF0IHBvc2l0aW9ucyAxMCBhbmRcbiAgLy8gMjAsIGJ1dCB0aGUgZmlyc3QgcGF0Y2ggd2FzIGZvdW5kIGF0IDEyLCBkZWx0YSBpcyAyIGFuZCB0aGUgc2Vjb25kIHBhdGNoXG4gIC8vIGhhcyBhbiBlZmZlY3RpdmUgZXhwZWN0ZWQgcG9zaXRpb24gb2YgMjIuXG4gIHZhciBkZWx0YSA9IDA7XG4gIHZhciByZXN1bHRzID0gW107XG4gIGZvciAodmFyIHggPSAwOyB4IDwgcGF0Y2hlcy5sZW5ndGg7IHgrKykge1xuICAgIHZhciBleHBlY3RlZF9sb2MgPSBwYXRjaGVzW3hdLnN0YXJ0MiArIGRlbHRhO1xuICAgIHZhciB0ZXh0MSA9IHRoaXMuZGlmZl90ZXh0MShwYXRjaGVzW3hdLmRpZmZzKTtcbiAgICB2YXIgc3RhcnRfbG9jO1xuICAgIHZhciBlbmRfbG9jID0gLTE7XG4gICAgaWYgKHRleHQxLmxlbmd0aCA+IHRoaXMuTWF0Y2hfTWF4Qml0cykge1xuICAgICAgLy8gcGF0Y2hfc3BsaXRNYXggd2lsbCBvbmx5IHByb3ZpZGUgYW4gb3ZlcnNpemVkIHBhdHRlcm4gaW4gdGhlIGNhc2Ugb2ZcbiAgICAgIC8vIGEgbW9uc3RlciBkZWxldGUuXG4gICAgICBzdGFydF9sb2MgPSB0aGlzLm1hdGNoX21haW4odGV4dCwgdGV4dDEuc3Vic3RyaW5nKDAsIHRoaXMuTWF0Y2hfTWF4Qml0cyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRfbG9jKTtcbiAgICAgIGlmIChzdGFydF9sb2MgIT0gLTEpIHtcbiAgICAgICAgZW5kX2xvYyA9IHRoaXMubWF0Y2hfbWFpbih0ZXh0LFxuICAgICAgICAgICAgdGV4dDEuc3Vic3RyaW5nKHRleHQxLmxlbmd0aCAtIHRoaXMuTWF0Y2hfTWF4Qml0cyksXG4gICAgICAgICAgICBleHBlY3RlZF9sb2MgKyB0ZXh0MS5sZW5ndGggLSB0aGlzLk1hdGNoX01heEJpdHMpO1xuICAgICAgICBpZiAoZW5kX2xvYyA9PSAtMSB8fCBzdGFydF9sb2MgPj0gZW5kX2xvYykge1xuICAgICAgICAgIC8vIENhbid0IGZpbmQgdmFsaWQgdHJhaWxpbmcgY29udGV4dC4gIERyb3AgdGhpcyBwYXRjaC5cbiAgICAgICAgICBzdGFydF9sb2MgPSAtMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzdGFydF9sb2MgPSB0aGlzLm1hdGNoX21haW4odGV4dCwgdGV4dDEsIGV4cGVjdGVkX2xvYyk7XG4gICAgfVxuICAgIGlmIChzdGFydF9sb2MgPT0gLTEpIHtcbiAgICAgIC8vIE5vIG1hdGNoIGZvdW5kLiAgOihcbiAgICAgIHJlc3VsdHNbeF0gPSBmYWxzZTtcbiAgICAgIC8vIFN1YnRyYWN0IHRoZSBkZWx0YSBmb3IgdGhpcyBmYWlsZWQgcGF0Y2ggZnJvbSBzdWJzZXF1ZW50IHBhdGNoZXMuXG4gICAgICBkZWx0YSAtPSBwYXRjaGVzW3hdLmxlbmd0aDIgLSBwYXRjaGVzW3hdLmxlbmd0aDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvdW5kIGEgbWF0Y2guICA6KVxuICAgICAgcmVzdWx0c1t4XSA9IHRydWU7XG4gICAgICBkZWx0YSA9IHN0YXJ0X2xvYyAtIGV4cGVjdGVkX2xvYztcbiAgICAgIHZhciB0ZXh0MjtcbiAgICAgIGlmIChlbmRfbG9jID09IC0xKSB7XG4gICAgICAgIHRleHQyID0gdGV4dC5zdWJzdHJpbmcoc3RhcnRfbG9jLCBzdGFydF9sb2MgKyB0ZXh0MS5sZW5ndGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGV4dDIgPSB0ZXh0LnN1YnN0cmluZyhzdGFydF9sb2MsIGVuZF9sb2MgKyB0aGlzLk1hdGNoX01heEJpdHMpO1xuICAgICAgfVxuICAgICAgaWYgKHRleHQxID09IHRleHQyKSB7XG4gICAgICAgIC8vIFBlcmZlY3QgbWF0Y2gsIGp1c3Qgc2hvdmUgdGhlIHJlcGxhY2VtZW50IHRleHQgaW4uXG4gICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBzdGFydF9sb2MpICtcbiAgICAgICAgICAgICAgIHRoaXMuZGlmZl90ZXh0MihwYXRjaGVzW3hdLmRpZmZzKSArXG4gICAgICAgICAgICAgICB0ZXh0LnN1YnN0cmluZyhzdGFydF9sb2MgKyB0ZXh0MS5sZW5ndGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSW1wZXJmZWN0IG1hdGNoLiAgUnVuIGEgZGlmZiB0byBnZXQgYSBmcmFtZXdvcmsgb2YgZXF1aXZhbGVudFxuICAgICAgICAvLyBpbmRpY2VzLlxuICAgICAgICB2YXIgZGlmZnMgPSB0aGlzLmRpZmZfbWFpbih0ZXh0MSwgdGV4dDIsIGZhbHNlKTtcbiAgICAgICAgaWYgKHRleHQxLmxlbmd0aCA+IHRoaXMuTWF0Y2hfTWF4Qml0cyAmJlxuICAgICAgICAgICAgdGhpcy5kaWZmX2xldmVuc2h0ZWluKGRpZmZzKSAvIHRleHQxLmxlbmd0aCA+XG4gICAgICAgICAgICB0aGlzLlBhdGNoX0RlbGV0ZVRocmVzaG9sZCkge1xuICAgICAgICAgIC8vIFRoZSBlbmQgcG9pbnRzIG1hdGNoLCBidXQgdGhlIGNvbnRlbnQgaXMgdW5hY2NlcHRhYmx5IGJhZC5cbiAgICAgICAgICByZXN1bHRzW3hdID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kaWZmX2NsZWFudXBTZW1hbnRpY0xvc3NsZXNzKGRpZmZzKTtcbiAgICAgICAgICB2YXIgaW5kZXgxID0gMDtcbiAgICAgICAgICB2YXIgaW5kZXgyO1xuICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgcGF0Y2hlc1t4XS5kaWZmcy5sZW5ndGg7IHkrKykge1xuICAgICAgICAgICAgdmFyIG1vZCA9IHBhdGNoZXNbeF0uZGlmZnNbeV07XG4gICAgICAgICAgICBpZiAobW9kWzBdICE9PSBESUZGX0VRVUFMKSB7XG4gICAgICAgICAgICAgIGluZGV4MiA9IHRoaXMuZGlmZl94SW5kZXgoZGlmZnMsIGluZGV4MSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kWzBdID09PSBESUZGX0lOU0VSVCkgeyAgLy8gSW5zZXJ0aW9uXG4gICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBzdGFydF9sb2MgKyBpbmRleDIpICsgbW9kWzFdICtcbiAgICAgICAgICAgICAgICAgICAgIHRleHQuc3Vic3RyaW5nKHN0YXJ0X2xvYyArIGluZGV4Mik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1vZFswXSA9PT0gRElGRl9ERUxFVEUpIHsgIC8vIERlbGV0aW9uXG4gICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBzdGFydF9sb2MgKyBpbmRleDIpICtcbiAgICAgICAgICAgICAgICAgICAgIHRleHQuc3Vic3RyaW5nKHN0YXJ0X2xvYyArIHRoaXMuZGlmZl94SW5kZXgoZGlmZnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgxICsgbW9kWzFdLmxlbmd0aCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vZFswXSAhPT0gRElGRl9ERUxFVEUpIHtcbiAgICAgICAgICAgICAgaW5kZXgxICs9IG1vZFsxXS5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIFN0cmlwIHRoZSBwYWRkaW5nIG9mZi5cbiAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKG51bGxQYWRkaW5nLmxlbmd0aCwgdGV4dC5sZW5ndGggLSBudWxsUGFkZGluZy5sZW5ndGgpO1xuICByZXR1cm4gW3RleHQsIHJlc3VsdHNdO1xufTtcblxuXG4vKipcbiAqIEFkZCBzb21lIHBhZGRpbmcgb24gdGV4dCBzdGFydCBhbmQgZW5kIHNvIHRoYXQgZWRnZXMgY2FuIG1hdGNoIHNvbWV0aGluZy5cbiAqIEludGVuZGVkIHRvIGJlIGNhbGxlZCBvbmx5IGZyb20gd2l0aGluIHBhdGNoX2FwcGx5LlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj59IHBhdGNoZXMgQXJyYXkgb2YgUGF0Y2ggb2JqZWN0cy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhZGRpbmcgc3RyaW5nIGFkZGVkIHRvIGVhY2ggc2lkZS5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfYWRkUGFkZGluZyA9IGZ1bmN0aW9uKHBhdGNoZXMpIHtcbiAgdmFyIHBhZGRpbmdMZW5ndGggPSB0aGlzLlBhdGNoX01hcmdpbjtcbiAgdmFyIG51bGxQYWRkaW5nID0gJyc7XG4gIGZvciAodmFyIHggPSAxOyB4IDw9IHBhZGRpbmdMZW5ndGg7IHgrKykge1xuICAgIG51bGxQYWRkaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoeCk7XG4gIH1cblxuICAvLyBCdW1wIGFsbCB0aGUgcGF0Y2hlcyBmb3J3YXJkLlxuICBmb3IgKHZhciB4ID0gMDsgeCA8IHBhdGNoZXMubGVuZ3RoOyB4KyspIHtcbiAgICBwYXRjaGVzW3hdLnN0YXJ0MSArPSBwYWRkaW5nTGVuZ3RoO1xuICAgIHBhdGNoZXNbeF0uc3RhcnQyICs9IHBhZGRpbmdMZW5ndGg7XG4gIH1cblxuICAvLyBBZGQgc29tZSBwYWRkaW5nIG9uIHN0YXJ0IG9mIGZpcnN0IGRpZmYuXG4gIHZhciBwYXRjaCA9IHBhdGNoZXNbMF07XG4gIHZhciBkaWZmcyA9IHBhdGNoLmRpZmZzO1xuICBpZiAoZGlmZnMubGVuZ3RoID09IDAgfHwgZGlmZnNbMF1bMF0gIT0gRElGRl9FUVVBTCkge1xuICAgIC8vIEFkZCBudWxsUGFkZGluZyBlcXVhbGl0eS5cbiAgICBkaWZmcy51bnNoaWZ0KG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgbnVsbFBhZGRpbmcpKTtcbiAgICBwYXRjaC5zdGFydDEgLT0gcGFkZGluZ0xlbmd0aDsgIC8vIFNob3VsZCBiZSAwLlxuICAgIHBhdGNoLnN0YXJ0MiAtPSBwYWRkaW5nTGVuZ3RoOyAgLy8gU2hvdWxkIGJlIDAuXG4gICAgcGF0Y2gubGVuZ3RoMSArPSBwYWRkaW5nTGVuZ3RoO1xuICAgIHBhdGNoLmxlbmd0aDIgKz0gcGFkZGluZ0xlbmd0aDtcbiAgfSBlbHNlIGlmIChwYWRkaW5nTGVuZ3RoID4gZGlmZnNbMF1bMV0ubGVuZ3RoKSB7XG4gICAgLy8gR3JvdyBmaXJzdCBlcXVhbGl0eS5cbiAgICB2YXIgZXh0cmFMZW5ndGggPSBwYWRkaW5nTGVuZ3RoIC0gZGlmZnNbMF1bMV0ubGVuZ3RoO1xuICAgIGRpZmZzWzBdWzFdID0gbnVsbFBhZGRpbmcuc3Vic3RyaW5nKGRpZmZzWzBdWzFdLmxlbmd0aCkgKyBkaWZmc1swXVsxXTtcbiAgICBwYXRjaC5zdGFydDEgLT0gZXh0cmFMZW5ndGg7XG4gICAgcGF0Y2guc3RhcnQyIC09IGV4dHJhTGVuZ3RoO1xuICAgIHBhdGNoLmxlbmd0aDEgKz0gZXh0cmFMZW5ndGg7XG4gICAgcGF0Y2gubGVuZ3RoMiArPSBleHRyYUxlbmd0aDtcbiAgfVxuXG4gIC8vIEFkZCBzb21lIHBhZGRpbmcgb24gZW5kIG9mIGxhc3QgZGlmZi5cbiAgcGF0Y2ggPSBwYXRjaGVzW3BhdGNoZXMubGVuZ3RoIC0gMV07XG4gIGRpZmZzID0gcGF0Y2guZGlmZnM7XG4gIGlmIChkaWZmcy5sZW5ndGggPT0gMCB8fCBkaWZmc1tkaWZmcy5sZW5ndGggLSAxXVswXSAhPSBESUZGX0VRVUFMKSB7XG4gICAgLy8gQWRkIG51bGxQYWRkaW5nIGVxdWFsaXR5LlxuICAgIGRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBudWxsUGFkZGluZykpO1xuICAgIHBhdGNoLmxlbmd0aDEgKz0gcGFkZGluZ0xlbmd0aDtcbiAgICBwYXRjaC5sZW5ndGgyICs9IHBhZGRpbmdMZW5ndGg7XG4gIH0gZWxzZSBpZiAocGFkZGluZ0xlbmd0aCA+IGRpZmZzW2RpZmZzLmxlbmd0aCAtIDFdWzFdLmxlbmd0aCkge1xuICAgIC8vIEdyb3cgbGFzdCBlcXVhbGl0eS5cbiAgICB2YXIgZXh0cmFMZW5ndGggPSBwYWRkaW5nTGVuZ3RoIC0gZGlmZnNbZGlmZnMubGVuZ3RoIC0gMV1bMV0ubGVuZ3RoO1xuICAgIGRpZmZzW2RpZmZzLmxlbmd0aCAtIDFdWzFdICs9IG51bGxQYWRkaW5nLnN1YnN0cmluZygwLCBleHRyYUxlbmd0aCk7XG4gICAgcGF0Y2gubGVuZ3RoMSArPSBleHRyYUxlbmd0aDtcbiAgICBwYXRjaC5sZW5ndGgyICs9IGV4dHJhTGVuZ3RoO1xuICB9XG5cbiAgcmV0dXJuIG51bGxQYWRkaW5nO1xufTtcblxuXG4vKipcbiAqIExvb2sgdGhyb3VnaCB0aGUgcGF0Y2hlcyBhbmQgYnJlYWsgdXAgYW55IHdoaWNoIGFyZSBsb25nZXIgdGhhbiB0aGUgbWF4aW11bVxuICogbGltaXQgb2YgdGhlIG1hdGNoIGFsZ29yaXRobS5cbiAqIEludGVuZGVkIHRvIGJlIGNhbGxlZCBvbmx5IGZyb20gd2l0aGluIHBhdGNoX2FwcGx5LlxuICogQHBhcmFtIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj59IHBhdGNoZXMgQXJyYXkgb2YgUGF0Y2ggb2JqZWN0cy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfc3BsaXRNYXggPSBmdW5jdGlvbihwYXRjaGVzKSB7XG4gIHZhciBwYXRjaF9zaXplID0gdGhpcy5NYXRjaF9NYXhCaXRzO1xuICBmb3IgKHZhciB4ID0gMDsgeCA8IHBhdGNoZXMubGVuZ3RoOyB4KyspIHtcbiAgICBpZiAocGF0Y2hlc1t4XS5sZW5ndGgxIDw9IHBhdGNoX3NpemUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB2YXIgYmlncGF0Y2ggPSBwYXRjaGVzW3hdO1xuICAgIC8vIFJlbW92ZSB0aGUgYmlnIG9sZCBwYXRjaC5cbiAgICBwYXRjaGVzLnNwbGljZSh4LS0sIDEpO1xuICAgIHZhciBzdGFydDEgPSBiaWdwYXRjaC5zdGFydDE7XG4gICAgdmFyIHN0YXJ0MiA9IGJpZ3BhdGNoLnN0YXJ0MjtcbiAgICB2YXIgcHJlY29udGV4dCA9ICcnO1xuICAgIHdoaWxlIChiaWdwYXRjaC5kaWZmcy5sZW5ndGggIT09IDApIHtcbiAgICAgIC8vIENyZWF0ZSBvbmUgb2Ygc2V2ZXJhbCBzbWFsbGVyIHBhdGNoZXMuXG4gICAgICB2YXIgcGF0Y2ggPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmooKTtcbiAgICAgIHZhciBlbXB0eSA9IHRydWU7XG4gICAgICBwYXRjaC5zdGFydDEgPSBzdGFydDEgLSBwcmVjb250ZXh0Lmxlbmd0aDtcbiAgICAgIHBhdGNoLnN0YXJ0MiA9IHN0YXJ0MiAtIHByZWNvbnRleHQubGVuZ3RoO1xuICAgICAgaWYgKHByZWNvbnRleHQgIT09ICcnKSB7XG4gICAgICAgIHBhdGNoLmxlbmd0aDEgPSBwYXRjaC5sZW5ndGgyID0gcHJlY29udGV4dC5sZW5ndGg7XG4gICAgICAgIHBhdGNoLmRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBwcmVjb250ZXh0KSk7XG4gICAgICB9XG4gICAgICB3aGlsZSAoYmlncGF0Y2guZGlmZnMubGVuZ3RoICE9PSAwICYmXG4gICAgICAgICAgICAgcGF0Y2gubGVuZ3RoMSA8IHBhdGNoX3NpemUgLSB0aGlzLlBhdGNoX01hcmdpbikge1xuICAgICAgICB2YXIgZGlmZl90eXBlID0gYmlncGF0Y2guZGlmZnNbMF1bMF07XG4gICAgICAgIHZhciBkaWZmX3RleHQgPSBiaWdwYXRjaC5kaWZmc1swXVsxXTtcbiAgICAgICAgaWYgKGRpZmZfdHlwZSA9PT0gRElGRl9JTlNFUlQpIHtcbiAgICAgICAgICAvLyBJbnNlcnRpb25zIGFyZSBoYXJtbGVzcy5cbiAgICAgICAgICBwYXRjaC5sZW5ndGgyICs9IGRpZmZfdGV4dC5sZW5ndGg7XG4gICAgICAgICAgc3RhcnQyICs9IGRpZmZfdGV4dC5sZW5ndGg7XG4gICAgICAgICAgcGF0Y2guZGlmZnMucHVzaChiaWdwYXRjaC5kaWZmcy5zaGlmdCgpKTtcbiAgICAgICAgICBlbXB0eSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGRpZmZfdHlwZSA9PT0gRElGRl9ERUxFVEUgJiYgcGF0Y2guZGlmZnMubGVuZ3RoID09IDEgJiZcbiAgICAgICAgICAgICAgICAgICBwYXRjaC5kaWZmc1swXVswXSA9PSBESUZGX0VRVUFMICYmXG4gICAgICAgICAgICAgICAgICAgZGlmZl90ZXh0Lmxlbmd0aCA+IDIgKiBwYXRjaF9zaXplKSB7XG4gICAgICAgICAgLy8gVGhpcyBpcyBhIGxhcmdlIGRlbGV0aW9uLiAgTGV0IGl0IHBhc3MgaW4gb25lIGNodW5rLlxuICAgICAgICAgIHBhdGNoLmxlbmd0aDEgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBzdGFydDEgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBlbXB0eSA9IGZhbHNlO1xuICAgICAgICAgIHBhdGNoLmRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihkaWZmX3R5cGUsIGRpZmZfdGV4dCkpO1xuICAgICAgICAgIGJpZ3BhdGNoLmRpZmZzLnNoaWZ0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRGVsZXRpb24gb3IgZXF1YWxpdHkuICBPbmx5IHRha2UgYXMgbXVjaCBhcyB3ZSBjYW4gc3RvbWFjaC5cbiAgICAgICAgICBkaWZmX3RleHQgPSBkaWZmX3RleHQuc3Vic3RyaW5nKDAsXG4gICAgICAgICAgICAgIHBhdGNoX3NpemUgLSBwYXRjaC5sZW5ndGgxIC0gdGhpcy5QYXRjaF9NYXJnaW4pO1xuICAgICAgICAgIHBhdGNoLmxlbmd0aDEgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBzdGFydDEgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBpZiAoZGlmZl90eXBlID09PSBESUZGX0VRVUFMKSB7XG4gICAgICAgICAgICBwYXRjaC5sZW5ndGgyICs9IGRpZmZfdGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBzdGFydDIgKz0gZGlmZl90ZXh0Lmxlbmd0aDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW1wdHkgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGF0Y2guZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKGRpZmZfdHlwZSwgZGlmZl90ZXh0KSk7XG4gICAgICAgICAgaWYgKGRpZmZfdGV4dCA9PSBiaWdwYXRjaC5kaWZmc1swXVsxXSkge1xuICAgICAgICAgICAgYmlncGF0Y2guZGlmZnMuc2hpZnQoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmlncGF0Y2guZGlmZnNbMF1bMV0gPVxuICAgICAgICAgICAgICAgIGJpZ3BhdGNoLmRpZmZzWzBdWzFdLnN1YnN0cmluZyhkaWZmX3RleHQubGVuZ3RoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIENvbXB1dGUgdGhlIGhlYWQgY29udGV4dCBmb3IgdGhlIG5leHQgcGF0Y2guXG4gICAgICBwcmVjb250ZXh0ID0gdGhpcy5kaWZmX3RleHQyKHBhdGNoLmRpZmZzKTtcbiAgICAgIHByZWNvbnRleHQgPVxuICAgICAgICAgIHByZWNvbnRleHQuc3Vic3RyaW5nKHByZWNvbnRleHQubGVuZ3RoIC0gdGhpcy5QYXRjaF9NYXJnaW4pO1xuICAgICAgLy8gQXBwZW5kIHRoZSBlbmQgY29udGV4dCBmb3IgdGhpcyBwYXRjaC5cbiAgICAgIHZhciBwb3N0Y29udGV4dCA9IHRoaXMuZGlmZl90ZXh0MShiaWdwYXRjaC5kaWZmcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDAsIHRoaXMuUGF0Y2hfTWFyZ2luKTtcbiAgICAgIGlmIChwb3N0Y29udGV4dCAhPT0gJycpIHtcbiAgICAgICAgcGF0Y2gubGVuZ3RoMSArPSBwb3N0Y29udGV4dC5sZW5ndGg7XG4gICAgICAgIHBhdGNoLmxlbmd0aDIgKz0gcG9zdGNvbnRleHQubGVuZ3RoO1xuICAgICAgICBpZiAocGF0Y2guZGlmZnMubGVuZ3RoICE9PSAwICYmXG4gICAgICAgICAgICBwYXRjaC5kaWZmc1twYXRjaC5kaWZmcy5sZW5ndGggLSAxXVswXSA9PT0gRElGRl9FUVVBTCkge1xuICAgICAgICAgIHBhdGNoLmRpZmZzW3BhdGNoLmRpZmZzLmxlbmd0aCAtIDFdWzFdICs9IHBvc3Rjb250ZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhdGNoLmRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBwb3N0Y29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWVtcHR5KSB7XG4gICAgICAgIHBhdGNoZXMuc3BsaWNlKCsreCwgMCwgcGF0Y2gpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIFRha2UgYSBsaXN0IG9mIHBhdGNoZXMgYW5kIHJldHVybiBhIHRleHR1YWwgcmVwcmVzZW50YXRpb24uXG4gKiBAcGFyYW0geyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqPn0gcGF0Y2hlcyBBcnJheSBvZiBQYXRjaCBvYmplY3RzLlxuICogQHJldHVybiB7c3RyaW5nfSBUZXh0IHJlcHJlc2VudGF0aW9uIG9mIHBhdGNoZXMuXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX3RvVGV4dCA9IGZ1bmN0aW9uKHBhdGNoZXMpIHtcbiAgdmFyIHRleHQgPSBbXTtcbiAgZm9yICh2YXIgeCA9IDA7IHggPCBwYXRjaGVzLmxlbmd0aDsgeCsrKSB7XG4gICAgdGV4dFt4XSA9IHBhdGNoZXNbeF07XG4gIH1cbiAgcmV0dXJuIHRleHQuam9pbignJyk7XG59O1xuXG5cbi8qKlxuICogUGFyc2UgYSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIHBhdGNoZXMgYW5kIHJldHVybiBhIGxpc3Qgb2YgUGF0Y2ggb2JqZWN0cy5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0bGluZSBUZXh0IHJlcHJlc2VudGF0aW9uIG9mIHBhdGNoZXMuXG4gKiBAcmV0dXJuIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj59IEFycmF5IG9mIFBhdGNoIG9iamVjdHMuXG4gKiBAdGhyb3dzIHshRXJyb3J9IElmIGludmFsaWQgaW5wdXQuXG4gKi9cbmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX2Zyb21UZXh0ID0gZnVuY3Rpb24odGV4dGxpbmUpIHtcbiAgdmFyIHBhdGNoZXMgPSBbXTtcbiAgaWYgKCF0ZXh0bGluZSkge1xuICAgIHJldHVybiBwYXRjaGVzO1xuICB9XG4gIHZhciB0ZXh0ID0gdGV4dGxpbmUuc3BsaXQoJ1xcbicpO1xuICB2YXIgdGV4dFBvaW50ZXIgPSAwO1xuICB2YXIgcGF0Y2hIZWFkZXIgPSAvXkBAIC0oXFxkKyksPyhcXGQqKSBcXCsoXFxkKyksPyhcXGQqKSBAQCQvO1xuICB3aGlsZSAodGV4dFBvaW50ZXIgPCB0ZXh0Lmxlbmd0aCkge1xuICAgIHZhciBtID0gdGV4dFt0ZXh0UG9pbnRlcl0ubWF0Y2gocGF0Y2hIZWFkZXIpO1xuICAgIGlmICghbSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhdGNoIHN0cmluZzogJyArIHRleHRbdGV4dFBvaW50ZXJdKTtcbiAgICB9XG4gICAgdmFyIHBhdGNoID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqKCk7XG4gICAgcGF0Y2hlcy5wdXNoKHBhdGNoKTtcbiAgICBwYXRjaC5zdGFydDEgPSBwYXJzZUludChtWzFdLCAxMCk7XG4gICAgaWYgKG1bMl0gPT09ICcnKSB7XG4gICAgICBwYXRjaC5zdGFydDEtLTtcbiAgICAgIHBhdGNoLmxlbmd0aDEgPSAxO1xuICAgIH0gZWxzZSBpZiAobVsyXSA9PSAnMCcpIHtcbiAgICAgIHBhdGNoLmxlbmd0aDEgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXRjaC5zdGFydDEtLTtcbiAgICAgIHBhdGNoLmxlbmd0aDEgPSBwYXJzZUludChtWzJdLCAxMCk7XG4gICAgfVxuXG4gICAgcGF0Y2guc3RhcnQyID0gcGFyc2VJbnQobVszXSwgMTApO1xuICAgIGlmIChtWzRdID09PSAnJykge1xuICAgICAgcGF0Y2guc3RhcnQyLS07XG4gICAgICBwYXRjaC5sZW5ndGgyID0gMTtcbiAgICB9IGVsc2UgaWYgKG1bNF0gPT0gJzAnKSB7XG4gICAgICBwYXRjaC5sZW5ndGgyID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcGF0Y2guc3RhcnQyLS07XG4gICAgICBwYXRjaC5sZW5ndGgyID0gcGFyc2VJbnQobVs0XSwgMTApO1xuICAgIH1cbiAgICB0ZXh0UG9pbnRlcisrO1xuXG4gICAgd2hpbGUgKHRleHRQb2ludGVyIDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIHZhciBzaWduID0gdGV4dFt0ZXh0UG9pbnRlcl0uY2hhckF0KDApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGxpbmUgPSBkZWNvZGVVUkkodGV4dFt0ZXh0UG9pbnRlcl0uc3Vic3RyaW5nKDEpKTtcbiAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIC8vIE1hbGZvcm1lZCBVUkkgc2VxdWVuY2UuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSWxsZWdhbCBlc2NhcGUgaW4gcGF0Y2hfZnJvbVRleHQ6ICcgKyBsaW5lKTtcbiAgICAgIH1cbiAgICAgIGlmIChzaWduID09ICctJykge1xuICAgICAgICAvLyBEZWxldGlvbi5cbiAgICAgICAgcGF0Y2guZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfREVMRVRFLCBsaW5lKSk7XG4gICAgICB9IGVsc2UgaWYgKHNpZ24gPT0gJysnKSB7XG4gICAgICAgIC8vIEluc2VydGlvbi5cbiAgICAgICAgcGF0Y2guZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCBsaW5lKSk7XG4gICAgICB9IGVsc2UgaWYgKHNpZ24gPT0gJyAnKSB7XG4gICAgICAgIC8vIE1pbm9yIGVxdWFsaXR5LlxuICAgICAgICBwYXRjaC5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgbGluZSkpO1xuICAgICAgfSBlbHNlIGlmIChzaWduID09ICdAJykge1xuICAgICAgICAvLyBTdGFydCBvZiBuZXh0IHBhdGNoLlxuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSBpZiAoc2lnbiA9PT0gJycpIHtcbiAgICAgICAgLy8gQmxhbmsgbGluZT8gIFdoYXRldmVyLlxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gV1RGP1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGF0Y2ggbW9kZSBcIicgKyBzaWduICsgJ1wiIGluOiAnICsgbGluZSk7XG4gICAgICB9XG4gICAgICB0ZXh0UG9pbnRlcisrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGF0Y2hlcztcbn07XG5cblxuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgb25lIHBhdGNoIG9wZXJhdGlvbi5cbiAqIEBjb25zdHJ1Y3RvclxuICovXG5kaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaiA9IGZ1bmN0aW9uKCkge1xuICAvKiogQHR5cGUgeyFBcnJheS48IWRpZmZfbWF0Y2hfcGF0Y2guRGlmZj59ICovXG4gIHRoaXMuZGlmZnMgPSBbXTtcbiAgLyoqIEB0eXBlIHs/bnVtYmVyfSAqL1xuICB0aGlzLnN0YXJ0MSA9IG51bGw7XG4gIC8qKiBAdHlwZSB7P251bWJlcn0gKi9cbiAgdGhpcy5zdGFydDIgPSBudWxsO1xuICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgdGhpcy5sZW5ndGgxID0gMDtcbiAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4gIHRoaXMubGVuZ3RoMiA9IDA7XG59O1xuXG5cbi8qKlxuICogRW11bGF0ZSBHTlUgZGlmZidzIGZvcm1hdC5cbiAqIEhlYWRlcjogQEAgLTM4Miw4ICs0ODEsOSBAQFxuICogSW5kaWNlcyBhcmUgcHJpbnRlZCBhcyAxLWJhc2VkLCBub3QgMC1iYXNlZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEdOVSBkaWZmIHN0cmluZy5cbiAqL1xuZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmoucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gIHZhciBjb29yZHMxLCBjb29yZHMyO1xuICBpZiAodGhpcy5sZW5ndGgxID09PSAwKSB7XG4gICAgY29vcmRzMSA9IHRoaXMuc3RhcnQxICsgJywwJztcbiAgfSBlbHNlIGlmICh0aGlzLmxlbmd0aDEgPT0gMSkge1xuICAgIGNvb3JkczEgPSB0aGlzLnN0YXJ0MSArIDE7XG4gIH0gZWxzZSB7XG4gICAgY29vcmRzMSA9ICh0aGlzLnN0YXJ0MSArIDEpICsgJywnICsgdGhpcy5sZW5ndGgxO1xuICB9XG4gIGlmICh0aGlzLmxlbmd0aDIgPT09IDApIHtcbiAgICBjb29yZHMyID0gdGhpcy5zdGFydDIgKyAnLDAnO1xuICB9IGVsc2UgaWYgKHRoaXMubGVuZ3RoMiA9PSAxKSB7XG4gICAgY29vcmRzMiA9IHRoaXMuc3RhcnQyICsgMTtcbiAgfSBlbHNlIHtcbiAgICBjb29yZHMyID0gKHRoaXMuc3RhcnQyICsgMSkgKyAnLCcgKyB0aGlzLmxlbmd0aDI7XG4gIH1cbiAgdmFyIHRleHQgPSBbJ0BAIC0nICsgY29vcmRzMSArICcgKycgKyBjb29yZHMyICsgJyBAQFxcbiddO1xuICB2YXIgb3A7XG4gIC8vIEVzY2FwZSB0aGUgYm9keSBvZiB0aGUgcGF0Y2ggd2l0aCAleHggbm90YXRpb24uXG4gIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5kaWZmcy5sZW5ndGg7IHgrKykge1xuICAgIHN3aXRjaCAodGhpcy5kaWZmc1t4XVswXSkge1xuICAgICAgY2FzZSBESUZGX0lOU0VSVDpcbiAgICAgICAgb3AgPSAnKyc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0RFTEVURTpcbiAgICAgICAgb3AgPSAnLSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICBvcCA9ICcgJztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHRleHRbeCArIDFdID0gb3AgKyBlbmNvZGVVUkkodGhpcy5kaWZmc1t4XVsxXSkgKyAnXFxuJztcbiAgfVxuICByZXR1cm4gdGV4dC5qb2luKCcnKS5yZXBsYWNlKC8lMjAvZywgJyAnKTtcbn07XG5cblxuLy8gVGhlIGZvbGxvd2luZyBleHBvcnQgY29kZSB3YXMgYWRkZWQgYnkgQEZvcmJlc0xpbmRlc2F5XG5tb2R1bGUuZXhwb3J0cyA9IGRpZmZfbWF0Y2hfcGF0Y2g7XG5tb2R1bGUuZXhwb3J0c1snZGlmZl9tYXRjaF9wYXRjaCddID0gZGlmZl9tYXRjaF9wYXRjaDtcbm1vZHVsZS5leHBvcnRzWydESUZGX0RFTEVURSddID0gRElGRl9ERUxFVEU7XG5tb2R1bGUuZXhwb3J0c1snRElGRl9JTlNFUlQnXSA9IERJRkZfSU5TRVJUO1xubW9kdWxlLmV4cG9ydHNbJ0RJRkZfRVFVQUwnXSA9IERJRkZfRVFVQUw7IiwgImltcG9ydCB7IFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwgfSBmcm9tIFwiLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiIH0gZnJvbSBcIi4vbW9kYWxzL1NldHRpbmdzVGFiXCI7XG5pbXBvcnQgeyBSZWNvcmRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdENvbnRleHRNZW51IH0gZnJvbSBcIi4vY29tcG9uZW50cy9TeXN0ZW1TY3VscHRDb250ZXh0TWVudVwiO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9zZXR0aW5ncy9TZXR0aW5nc01hbmFnZXJcIjtcbmltcG9ydCB7IExpY2Vuc2VNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9saWNlbnNlL0xpY2Vuc2VNYW5hZ2VyXCI7XG5pbXBvcnQgeyBWaWV3TWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL3ZpZXdzXCI7XG5pbXBvcnQgeyBDb21tYW5kTWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL2NvbW1hbmRzXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9DdXN0b21Qcm92aWRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBUYXNrc1NlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9UYXNrc1NlcnZpY2VcIjtcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL01vZGVsU2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTeXN0ZW1TY3VscHRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgc2V0dGluZ3NUYWI6IFN5c3RlbVNjdWxwdFNldHRpbmdUYWI7XG4gIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHJlY29yZGVyU2VydmljZTogUmVjb3JkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlcjtcbiAgcHJpdmF0ZSBsaWNlbnNlTWFuYWdlcjogTGljZW5zZU1hbmFnZXI7XG4gIHB1YmxpYyB0YXNrc1NlcnZpY2U6IFRhc2tzU2VydmljZTtcbiAgcHJpdmF0ZSB2aWV3TWFuYWdlcjogVmlld01hbmFnZXI7XG4gIHByaXZhdGUgY29tbWFuZE1hbmFnZXI6IENvbW1hbmRNYW5hZ2VyO1xuICBwcml2YXRlIGNvbnRleHRNZW51OiBTeXN0ZW1TY3VscHRDb250ZXh0TWVudTtcbiAgcHVibGljIG1vZGVsU2VydmljZTogTW9kZWxTZXJ2aWNlO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICB0cnkge1xuICAgICAgLy8gSW5pdGlhbGl6ZSBzZXR0aW5ncyBmaXJzdCBhcyBvdGhlciBzZXJ2aWNlcyBkZXBlbmQgb24gaXRcbiAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyID0gbmV3IFNldHRpbmdzTWFuYWdlcih0aGlzKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmxvYWRTZXR0aW5ncygpO1xuICAgICAgdGhpcy5zZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmdzKCk7XG5cbiAgICAgIC8vIE9ubHkgcmVnaXN0ZXIgLnNydCBleHRlbnNpb24gaWYgbm90IGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJlZEV4dGVuc2lvbnMgPSAodGhpcy5hcHAgYXMgYW55KS52aWV3UmVnaXN0cnlcbiAgICAgICAgICAudHlwZUJ5RXh0ZW5zaW9uO1xuICAgICAgICBpZiAoIXJlZ2lzdGVyZWRFeHRlbnNpb25zPy5zcnQpIHtcbiAgICAgICAgICB0aGlzLnJlZ2lzdGVyRXh0ZW5zaW9ucyhbXCJzcnRcIl0sIFwibWFya2Rvd25cIik7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcmVnaXN0ZXIgLnNydCBleHRlbnNpb246XCIsIGVycm9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGl6ZSBjb3JlIHNlcnZpY2VzIGluIHRoZSBjb3JyZWN0IG9yZGVyXG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSA9IG5ldyBDdXN0b21Qcm92aWRlclNlcnZpY2UodGhpcyk7XG4gICAgICAgIHRoaXMubW9kZWxTZXJ2aWNlID0gTW9kZWxTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2VcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5haVNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZSA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMpO1xuICAgICAgICB0aGlzLnJlY29yZGVyU2VydmljZSA9IFJlY29yZGVyU2VydmljZS5nZXRJbnN0YW5jZSh0aGlzLmFwcCwgdGhpcyk7XG4gICAgICAgIHRoaXMuY29udGV4dE1lbnUgPSBuZXcgU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgdGhpcy5haVNlcnZpY2UsXG4gICAgICAgICAgdGhpc1xuICAgICAgICApO1xuXG4gICAgICAgIC8vIFNldCBTeXN0ZW1TY3VscHRTZXJ2aWNlIGluIFN5c3RlbVByb21wdFNlcnZpY2VcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5zZXRTeXN0ZW1TY3VscHRTZXJ2aWNlKHRoaXMuYWlTZXJ2aWNlKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBjb3JlIHNlcnZpY2VzOlwiLCBlcnJvcik7XG4gICAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyB0byBwcmV2ZW50IHBhcnRpYWwgaW5pdGlhbGl6YXRpb25cbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGl6ZSBVSSBjb21wb25lbnRzXG4gICAgICB0aGlzLnNldHRpbmdzVGFiID0gbmV3IFN5c3RlbVNjdWxwdFNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpO1xuICAgICAgdGhpcy5hZGRTZXR0aW5nVGFiKHRoaXMuc2V0dGluZ3NUYWIpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIG1hbmFnZXJzXG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmxpY2Vuc2VNYW5hZ2VyID0gbmV3IExpY2Vuc2VNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcbiAgICAgICAgdGhpcy50YXNrc1NlcnZpY2UgPSBuZXcgVGFza3NTZXJ2aWNlKHRoaXMpO1xuICAgICAgICB0aGlzLnZpZXdNYW5hZ2VyID0gbmV3IFZpZXdNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcbiAgICAgICAgdGhpcy5jb21tYW5kTWFuYWdlciA9IG5ldyBDb21tYW5kTWFuYWdlcih0aGlzLCB0aGlzLmFwcCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB2aWV3cyBhbmQgY29tbWFuZHNcbiAgICAgICAgdGhpcy52aWV3TWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICAgIHRoaXMuY29tbWFuZE1hbmFnZXIucmVnaXN0ZXJDb21tYW5kcygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIG1hbmFnZXJzOlwiLCBlcnJvcik7XG4gICAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyB0byBwcmV2ZW50IHBhcnRpYWwgaW5pdGlhbGl6YXRpb25cbiAgICAgIH1cblxuICAgICAgLy8gU3RhcnQgbG9hZGluZyBzeXN0ZW0gcHJvbXB0cyBjYWNoZSBpbiB0aGUgYmFja2dyb3VuZFxuICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIHN5c3RlbSBwcm9tcHRzIGNhY2hlOlwiLCBlcnJvcik7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIFN5c3RlbVNjdWxwdCBwbHVnaW46XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyB0byBlbnN1cmUgT2JzaWRpYW4ga25vd3MgaW5pdGlhbGl6YXRpb24gZmFpbGVkXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb251bmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coXCJTeXN0ZW1TY3VscHQgQUkgcGx1Z2luIHVubG9hZGluZy4uLlwiKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhbnVwIFVJIGNvbXBvbmVudHMgZmlyc3RcbiAgICAgIGlmICh0aGlzLnNldHRpbmdzVGFiKSB7XG4gICAgICAgIC8vIFNldHRpbmdzIHRhYiBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYnkgT2JzaWRpYW5cbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYW51cCBtYW5hZ2VycyBhbmQgdmlld3NcbiAgICAgIGlmICh0aGlzLmNvbW1hbmRNYW5hZ2VyKSB7XG4gICAgICAgIC8vIFVucmVnaXN0ZXIgYWxsIGNvbW1hbmRzIGJ5IHRoZWlyIElEc1xuICAgICAgICBjb25zdCBjb21tYW5kcyA9IFtcbiAgICAgICAgICBcIm9wZW4tdGFza3MtZmlsZVwiLFxuICAgICAgICAgIFwidG9nZ2xlLWF1ZGlvLXJlY29yZGVyXCIsXG4gICAgICAgICAgXCJvcGVuLXN5c3RlbXNjdWxwdC1jaGF0XCIsXG4gICAgICAgICAgXCJvcGVuLWNoYXQtaGlzdG9yeVwiLFxuICAgICAgICAgIFwib3Blbi1zeXN0ZW1zY3VscHQtamFuaXRvclwiLFxuICAgICAgICAgIFwicmVsb2FkLW9ic2lkaWFuXCIsXG4gICAgICAgICAgXCJvcGVuLXN5c3RlbXNjdWxwdC1zZXR0aW5nc1wiLFxuICAgICAgICAgIFwiY2hhbmdlLWNoYXQtbW9kZWxcIixcbiAgICAgICAgICBcImNoYXQtd2l0aC1maWxlXCIsXG4gICAgICAgICAgXCJzdWdnZXN0LWVkaXRzXCIsXG4gICAgICAgICAgXCJjbGVhci1zdWdnZXN0ZWQtZWRpdHNcIixcbiAgICAgICAgXTtcbiAgICAgICAgY29tbWFuZHMuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgICAgICAvLyBAdHMtaWdub3JlIC0gcmVtb3ZlQ29tbWFuZCBleGlzdHMgYnV0IGlzbid0IGluIHRoZSB0eXBlc1xuICAgICAgICAgIHRoaXMuYXBwLmNvbW1hbmRzLnJlbW92ZUNvbW1hbmQoYCR7dGhpcy5tYW5pZmVzdC5pZH06JHtpZH1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFudXAgdmlld3NcbiAgICAgIGlmICh0aGlzLnZpZXdNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMudmlld01hbmFnZXIudW5sb2FkVmlld3MoKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYW51cCBzZXJ2aWNlcyBpbiByZXZlcnNlIG9yZGVyIG9mIGluaXRpYWxpemF0aW9uXG4gICAgICBpZiAodGhpcy5jb250ZXh0TWVudSkge1xuICAgICAgICAvLyBDb250ZXh0IG1lbnUgaXMgY2xlYW5lZCB1cCBhdXRvbWF0aWNhbGx5XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5yZWNvcmRlclNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5yZWNvcmRlclNlcnZpY2UudW5sb2FkKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy50cmFuc2NyaXB0aW9uU2VydmljZSkge1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnVubG9hZCgpO1xuICAgICAgICAvLyBAdHMtaWdub3JlIC0gYWNjZXNzaW5nIHByaXZhdGUgc3RhdGljIGluc3RhbmNlXG4gICAgICAgIFRyYW5zY3JpcHRpb25TZXJ2aWNlLmluc3RhbmNlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmFpU2VydmljZSkge1xuICAgICAgICAvLyBSZXNldCBTeXN0ZW1TY3VscHRTZXJ2aWNlIHNpbmdsZXRvblxuICAgICAgICAvLyBAdHMtaWdub3JlIC0gYWNjZXNzaW5nIHByaXZhdGUgc3RhdGljIGluc3RhbmNlXG4gICAgICAgIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubW9kZWxTZXJ2aWNlKSB7XG4gICAgICAgIC8vIFJlc2V0IE1vZGVsU2VydmljZSBzaW5nbGV0b25cbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIGFjY2Vzc2luZyBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZVxuICAgICAgICBNb2RlbFNlcnZpY2UuaW5zdGFuY2UgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY3VzdG9tUHJvdmlkZXJTZXJ2aWNlKSB7XG4gICAgICAgIC8vIEN1c3RvbSBwcm92aWRlciBjbGVhbnVwIGlmIG5lZWRlZFxuICAgICAgfVxuICAgICAgLy8gVGFza3NTZXJ2aWNlIGNsZWFudXAgaXMgaGFuZGxlZCBhdXRvbWF0aWNhbGx5IGJ5IE9ic2lkaWFuJ3MgZXZlbnQgc3lzdGVtXG4gICAgICAvLyB3aGVuIHRoZSBwbHVnaW4gaXMgdW5sb2FkZWRcblxuICAgICAgLy8gUmVzZXQgc3lzdGVtIHByb21wdCBzZXJ2aWNlIHN0YXRlXG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNsZWFyQ2FjaGUoKTtcblxuICAgICAgLy8gQ2xlYXIgYW55IHJlZ2lzdGVyZWQgZXh0ZW5zaW9uc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJlZEV4dGVuc2lvbnMgPSAodGhpcy5hcHAgYXMgYW55KS52aWV3UmVnaXN0cnlcbiAgICAgICAgICAudHlwZUJ5RXh0ZW5zaW9uO1xuICAgICAgICBpZiAocmVnaXN0ZXJlZEV4dGVuc2lvbnM/LnNydCkge1xuICAgICAgICAgIGRlbGV0ZSByZWdpc3RlcmVkRXh0ZW5zaW9ucy5zcnQ7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5yZWdpc3RlciAuc3J0IGV4dGVuc2lvbjpcIiwgZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhcIlN5c3RlbVNjdWxwdCBBSSBwbHVnaW4gdW5sb2FkZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIHBsdWdpbiBjbGVhbnVwOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gZW5zdXJlIE9ic2lkaWFuIGtub3dzIGFib3V0IHRoZSBjbGVhbnVwIGZhaWx1cmVcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkRGF0YSgpIHtcbiAgICByZXR1cm4gc3VwZXIubG9hZERhdGEoKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVEYXRhKGRhdGE6IGFueSkge1xuICAgIHJldHVybiBzdXBlci5zYXZlRGF0YShkYXRhKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcbiAgfVxuXG4gIGdldFJlY29yZGVyU2VydmljZSgpOiBSZWNvcmRlclNlcnZpY2Uge1xuICAgIHJldHVybiB0aGlzLnJlY29yZGVyU2VydmljZTtcbiAgfVxuXG4gIGdldFRyYW5zY3JpcHRpb25TZXJ2aWNlKCk6IFRyYW5zY3JpcHRpb25TZXJ2aWNlIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZTtcbiAgfVxuXG4gIGdldExpY2Vuc2VNYW5hZ2VyKCk6IExpY2Vuc2VNYW5hZ2VyIHtcbiAgICByZXR1cm4gdGhpcy5saWNlbnNlTWFuYWdlcjtcbiAgfVxuXG4gIGdldFNldHRpbmdzTWFuYWdlcigpOiBTZXR0aW5nc01hbmFnZXIge1xuICAgIHJldHVybiB0aGlzLnNldHRpbmdzTWFuYWdlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZnJlc2ggbW9kZWxzIGZyb20gdGhlIG1vZGVsIHNlcnZpY2VcbiAgICovXG4gIHB1YmxpYyBnZXRJbml0aWFsTW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIHJldHVybiB0aGlzLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgREVGQVVMVF9TRVRUSU5HUywgUEFUUkVPTl9VUkwgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuL01vZGVsU2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IGF0dGFjaEZvbGRlclN1Z2dlc3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZvbGRlclN1Z2dlc3RlclwiO1xuaW1wb3J0IHsgcmVxdWVzdFVybCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2hvd1N5c3RlbVByb21wdE1vZGFsIH0gZnJvbSBcIi4vU3lzdGVtUHJvbXB0TW9kYWxcIjtcblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgc3lzdGVtU2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBkZWJvdW5jZVRpbWVyOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnN5c3RlbVNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgcGx1Z2luLnNldHRpbmdzLFxuICAgICAgdGhpcy5hcHBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZURpcmVjdG9yeShwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAoIXBhdGgpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiAoXG4gICAgICAhcGF0aC5pbmNsdWRlcyhcIi4uXCIpICYmICFwYXRoLnN0YXJ0c1dpdGgoXCIvXCIpICYmICFwYXRoLnN0YXJ0c1dpdGgoXCJcXFxcXCIpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRGlyZWN0b3J5Q2hhbmdlKFxuICAgIHZhbHVlOiBzdHJpbmcsXG4gICAgc2V0dGluZ0tleTpcbiAgICAgIHwgXCJhdHRhY2htZW50c0RpcmVjdG9yeVwiXG4gICAgICB8IFwicmVjb3JkaW5nc0RpcmVjdG9yeVwiXG4gICAgICB8IFwiY2hhdHNEaXJlY3RvcnlcIlxuICAgICAgfCBcImV4dHJhY3Rpb25zRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJ0YXNrc0RpcmVjdG9yeVwiXG4gICkge1xuICAgIGlmICghdGhpcy52YWxpZGF0ZURpcmVjdG9yeSh2YWx1ZSkpIHtcbiAgICAgIHNob3dQb3B1cChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIFwiSW52YWxpZCBkaXJlY3RvcnkgcGF0aC4gUGxlYXNlIHVzZSByZWxhdGl2ZSBwYXRocyB3aXRob3V0ICcuLicgb3IgbGVhZGluZyBzbGFzaGVzLlwiXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRlYm91bmNlVGltZXIpIGNsZWFyVGltZW91dCh0aGlzLmRlYm91bmNlVGltZXIpO1xuXG4gICAgdGhpcy5kZWJvdW5jZVRpbWVyID0gc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSA9IHZhbHVlO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgfSwgNTAwKTtcbiAgfVxuXG4gIGFzeW5jIGRpc3BsYXkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgLy8gTWFpbiBjb250YWluZXIgd2l0aCB0YWJzXG4gICAgY29uc3QgbWFpbkNvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXNldHRpbmdzLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICBtYWluQ29udGFpbmVyLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIlN5c3RlbVNjdWxwdCBBSSBTZXR0aW5nc1wiIH0pO1xuXG4gICAgLy8gVGFiIG5hdmlnYXRpb25cbiAgICBjb25zdCB0YWJDb250YWluZXIgPSBtYWluQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy10YWJzXCIpO1xuICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBtYWluQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXNldHRpbmdzLWNvbnRlbnRcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgdGFic1xuICAgIGNvbnN0IHRhYnMgPSBbXG4gICAgICB7IGlkOiBcImxpY2Vuc2VcIiwgbGFiZWw6IFwiTGljZW5zZVwiIH0sXG4gICAgICB7IGlkOiBcImRpcmVjdG9yaWVzXCIsIGxhYmVsOiBcIkRpcmVjdG9yaWVzXCIgfSxcbiAgICAgIHsgaWQ6IFwicmVjb3JkZXJcIiwgbGFiZWw6IFwiUmVjb3JkZXJcIiB9LFxuICAgICAgeyBpZDogXCJjaGF0XCIsIGxhYmVsOiBcIkNoYXRcIiB9LFxuICAgICAgeyBpZDogXCJ0YXNrc1wiLCBsYWJlbDogXCJUYXNrc1wiIH0sXG4gICAgICB7IGlkOiBcImFkdmFuY2VkXCIsIGxhYmVsOiBcIkFkdmFuY2VkXCIgfSxcbiAgICBdO1xuXG4gICAgLy8gQWRkIHRhYiBidXR0b25zXG4gICAgdGFicy5mb3JFYWNoKCh0YWIpID0+IHtcbiAgICAgIGNvbnN0IHRhYkJ1dHRvbiA9IHRhYkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGFiLWJ1dHRvblwiLFxuICAgICAgICB0ZXh0OiB0YWIubGFiZWwsXG4gICAgICB9KTtcbiAgICAgIHRhYkJ1dHRvbi5kYXRhc2V0LnRhYiA9IHRhYi5pZDtcbiAgICAgIGlmICh0YWIuaWQgPT09IFwibGljZW5zZVwiKSB0YWJCdXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgdGFiIGNvbnRlbnQgc2VjdGlvbnNcbiAgICBjb25zdCBpc1Byb0FjdGl2ZSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9PT0gdHJ1ZTtcbiAgICBjb25zdCBsaWNlbnNlQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnQgYWN0aXZlXCJcbiAgICApO1xuICAgIGNvbnN0IGRpcmVjdG9yaWVzQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgcmVjb3JkZXJDb250ZW50ID0gY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiXG4gICAgKTtcbiAgICBjb25zdCBjaGF0Q29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCIpO1xuICAgIGNvbnN0IHRhc2tzQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCIpO1xuICAgIGNvbnN0IGFkdmFuY2VkQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgY29udGVudCB0byBlYWNoIHRhYlxuICAgIHRoaXMuZGlzcGxheUxpY2Vuc2VUYWIobGljZW5zZUNvbnRlbnQsIGlzUHJvQWN0aXZlKTtcbiAgICB0aGlzLmRpc3BsYXlEaXJlY3Rvcmllc1RhYihkaXJlY3Rvcmllc0NvbnRlbnQsIGlzUHJvQWN0aXZlKTtcbiAgICB0aGlzLmRpc3BsYXlSZWNvcmRlclRhYihyZWNvcmRlckNvbnRlbnQpO1xuICAgIHRoaXMuZGlzcGxheUNoYXRUYWIoY2hhdENvbnRlbnQpO1xuICAgIHRoaXMuZGlzcGxheVRhc2tzVGFiKHRhc2tzQ29udGVudCk7XG4gICAgdGhpcy5kaXNwbGF5QWR2YW5jZWRUYWIoYWR2YW5jZWRDb250ZW50KTtcblxuICAgIC8vIEFkZCB0YWIgY2xpY2sgaGFuZGxlcnNcbiAgICB0YWJDb250YWluZXJcbiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uXCIpXG4gICAgICAuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgICBjb25zdCB0YWJJZCA9IHRhcmdldC5kYXRhc2V0LnRhYjtcblxuICAgICAgICAgIC8vIFJlbW92ZSBhY3RpdmUgY2xhc3Nlc1xuICAgICAgICAgIHRhYkNvbnRhaW5lclxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXRhYi1idXR0b25cIilcbiAgICAgICAgICAgIC5mb3JFYWNoKChiKSA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xuICAgICAgICAgIGNvbnRlbnRDb250YWluZXJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC10YWItY29udGVudFwiKVxuICAgICAgICAgICAgLmZvckVhY2goKGMpID0+IGMuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKSk7XG5cbiAgICAgICAgICAvLyBBZGQgYWN0aXZlIGNsYXNzZXMgdG8gc2VsZWN0ZWQgdGFiXG4gICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgY29udGVudENvbnRhaW5lclxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYj1cIiR7dGFiSWR9XCJdYClcbiAgICAgICAgICAgID8uY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LXNldHRpbmdzLXN0eWxlc1wiKSkge1xuICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICBzdHlsZS5pZCA9IFwic3lzdGVtc2N1bHB0LXNldHRpbmdzLXN0eWxlc1wiO1xuICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgICAuc3lzdGVtc2N1bHB0LXNldHRpbmdzLXRhYnMge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBmbGV4LXdyYXA6IHdyYXA7XG4gICAgICAgIGdhcDogNHB4O1xuICAgICAgICBtYXJnaW4tYm90dG9tOiAxNnB4O1xuICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICBwYWRkaW5nLWJvdHRvbTogOHB4O1xuICAgICAgICBtYXgtd2lkdGg6IDEwMCU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvbiB7XG4gICAgICAgIGJhY2tncm91bmQ6IG5vbmU7XG4gICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgcGFkZGluZzogNnB4IDEycHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuICAgICAgICBmb250LXNpemU6IDAuOWVtO1xuICAgICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgICAgbWluLXdpZHRoOiAxMjBweDtcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1idXR0b246aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWhvdmVyKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uLmFjdGl2ZSB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnQge1xuICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICBtYXgtd2lkdGg6IDEwMCU7XG4gICAgICAgIG92ZXJmbG93LXg6IGhpZGRlbjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItY29udGVudC5hY3RpdmUge1xuICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgcGFkZGluZzogMCA4cHg7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8qIExpY2Vuc2UgVGFiIFN0eWxpbmcgKi9cbiAgICAgIC5zeXN0ZW1zY3VscHQtbGljZW5zZS1pbnB1dCB7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBtYXgtd2lkdGg6IDQwMHB4O1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWJhZGdlIHtcbiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtb24tYWNjZW50KTtcbiAgICAgICAgcGFkZGluZzogMnB4IDhweDtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBmb250LXNpemU6IDAuOGVtO1xuICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICBtYXJnaW4tbGVmdDogOHB4O1xuICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAudG9rZW4tYmFsYW5jZS12YWx1ZSB7XG4gICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWFjY2VudCk7XG4gICAgICAgIG1hcmdpbi1sZWZ0OiA4cHg7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5wcm8tZmVhdHVyZXMtZ3JpZCAuc2V0dGluZy1pdGVtIHtcbiAgICAgICAgcGFkZGluZzogOHB4O1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5LWFsdCk7XG4gICAgICAgIG1hcmdpbjogNHB4IDA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5wcm8tYmVuZWZpdHMtbGlzdCB7XG4gICAgICAgIG1hcmdpbjogMTZweCAwO1xuICAgICAgICBwYWRkaW5nLWxlZnQ6IDIwcHg7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnByby1iZW5lZml0cy1saXN0IGxpIHtcbiAgICAgICAgbWFyZ2luOiA4cHggMDtcbiAgICAgICAgbGlzdC1zdHlsZS10eXBlOiAnXHUyMTkyJztcbiAgICAgICAgcGFkZGluZy1sZWZ0OiAyMHB4O1xuICAgICAgICB0ZXh0LWluZGVudDogLTEycHg7XG4gICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7XG4gICAgICB9XG4gICAgYDtcbiAgICAgIG1haW5Db250YWluZXIuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheUxpY2Vuc2VUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBpc1Byb0FjdGl2ZTogYm9vbGVhbikge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJsaWNlbnNlXCI7XG4gICAgY29uc3QgbGljZW5zZVNldHRpbmdDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1saWNlbnNlLXNldHRpbmdzXCJcbiAgICApO1xuXG4gICAgbGljZW5zZVNldHRpbmdDb250YWluZXIuY3JlYXRlRWwoXCJoM1wiLCB7XG4gICAgICB0ZXh0OiBcIlN5c3RlbVNjdWxwdCBMaWNlbnNlXCIsXG4gICAgfSk7XG5cbiAgICAvLyBMaWNlbnNlIEtleSBTZWN0aW9uXG4gICAgY29uc3QgbGljZW5zZVNldHRpbmcgPSBuZXcgU2V0dGluZyhsaWNlbnNlU2V0dGluZ0NvbnRhaW5lcilcbiAgICAgIC5zZXROYW1lKFwiTGljZW5zZSBLZXlcIilcbiAgICAgIC5zZXREZXNjKFwiVW5sb2NrIFBybyBmZWF0dXJlcyB3aXRoIHlvdXIgbGljZW5zZSBrZXlcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJQYXN0ZSBsaWNlbnNlIGtleVwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5KVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXkgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmlucHV0RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbGljZW5zZS1pbnB1dFwiKTtcbiAgICAgICAgdGV4dC5pbnB1dEVsLnR5cGUgPSBcInBhc3N3b3JkXCI7XG4gICAgICAgIHRleHQuaW5wdXRFbC5zdHlsZS5mb250RmFtaWx5ID0gXCJtb25vc3BhY2VcIjtcbiAgICAgICAgdGV4dC5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnR5cGUgPSBcInRleHRcIjtcbiAgICAgICAgICB0ZXh0LmlucHV0RWwuc3R5bGUuZm9udEZhbWlseSA9IFwiaW5oZXJpdFwiO1xuICAgICAgICB9KTtcbiAgICAgICAgdGV4dC5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsICgpID0+IHtcbiAgICAgICAgICB0ZXh0LmlucHV0RWwudHlwZSA9IFwicGFzc3dvcmRcIjtcbiAgICAgICAgICB0ZXh0LmlucHV0RWwuc3R5bGUuZm9udEZhbWlseSA9IFwibW9ub3NwYWNlXCI7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICAgIH0pXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKGlzUHJvQWN0aXZlKVxuICAgICAgICAgIC5zZXRUb29sdGlwKFxuICAgICAgICAgICAgaXNQcm9BY3RpdmUgPyBcIkRpc2FibGUgUHJvIGZlYXR1cmVzXCIgOiBcIkVuYWJsZSBQcm8gZmVhdHVyZXNcIlxuICAgICAgICAgIClcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgLy8gT25seSB2YWxpZGF0ZSB3aGVuIHRvZ2dsaW5nIE9OXG4gICAgICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICAgIC5nZXRMaWNlbnNlTWFuYWdlcigpXG4gICAgICAgICAgICAgICAgLnZhbGlkYXRlTGljZW5zZUtleSh0cnVlKTtcbiAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgIFwiSW52YWxpZCBsaWNlbnNlIGtleSAtIFBybyBmZWF0dXJlcyBkaXNhYmxlZFwiXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBTaG93IHJlbG9hZCBwb3B1cCBvbiBzdWNjZXNzZnVsIGFjdGl2YXRpb25cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgIFwiUHJvIGZlYXR1cmVzIGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgYWN0aXZhdGVkISBUbyBlbnN1cmUgYWxsIGZlYXR1cmVzIHdvcmsgcHJvcGVybHksIE9ic2lkaWFuIG5lZWRzIHRvIGJlIHJlbG9hZGVkLlwiLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJSZWxvYWQgdG8gQ29tcGxldGUgVXBncmFkZVwiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgICAgICAgICBcIkNsaWNrIHRoZSBidXR0b24gYmVsb3cgdG8gcmVsb2FkIE9ic2lkaWFuIGFuZCBzdGFydCB1c2luZyB5b3VyIFBybyBmZWF0dXJlcy5cIixcbiAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJSZWxvYWQgJiBVcGdyYWRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGljb246IFwic3BhcmtsZXNcIixcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGlzUHJvQWN0aXZlKSB7XG4gICAgICAgICAgdG9nZ2xlLnRvZ2dsZUVsLmFkZENsYXNzKFwibW9kLWN0YVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICBpZiAoaXNQcm9BY3RpdmUpIHtcbiAgICAgIGNvbnN0IHN0YXR1c1NldHRpbmcgPSBuZXcgU2V0dGluZyhsaWNlbnNlU2V0dGluZ0NvbnRhaW5lcilcbiAgICAgICAgLnNldE5hbWUoXCJQcm8gU3RhdHVzXCIpXG4gICAgICAgIC5zZXREZXNjKFwiQWN0aXZlIHN1YnNjcmlwdGlvbiBcdTIwMjIgUHJlbWl1bSBmZWF0dXJlcyBlbmFibGVkXCIpO1xuXG4gICAgICBzdGF0dXNTZXR0aW5nLm5hbWVFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInByby1iYWRnZVwiLFxuICAgICAgICB0ZXh0OiBcIkFDVElWRVwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJhbGFuY2VFbCA9IGNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwidG9rZW4tYmFsYW5jZS12YWx1ZVwiLFxuICAgICAgICB0ZXh0OiBcIkxvYWRpbmcuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICBzdGF0dXNTZXR0aW5nLmFkZEV4dHJhQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uXG4gICAgICAgICAgLnNldEljb24oXCJzcGFya2xlc1wiKVxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiQXZhaWxhYmxlIGNyZWRpdHNcIilcbiAgICAgICAgICAuc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIHN0YXR1c1NldHRpbmcuY29udHJvbEVsLmFwcGVuZENoaWxkKGJhbGFuY2VFbCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZGlzcGxheVRva2VuQmFsYW5jZShiYWxhbmNlRWwpO1xuICAgIH1cblxuICAgIC8vIEFkZCBQcm8gcHJvbW90aW9uIHNlY3Rpb24gaWYgbm90IGFjdGl2ZVxuICAgIHRoaXMuZGlzcGxheVByb1Byb21vdGlvblNlY3Rpb24obGljZW5zZVNldHRpbmdDb250YWluZXIsIGlzUHJvQWN0aXZlKTtcblxuICAgIC8vIEFkZCBiZXRhIG5vdGljZSBzZWN0aW9uXG4gICAgY29uc3QgYmV0YU5vdGljZUVsID0gbGljZW5zZVNldHRpbmdDb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1iZXRhLW5vdGljZVwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgaGVhZGVyQ29udGFpbmVyID0gYmV0YU5vdGljZUVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJiZXRhLW5vdGljZS1oZWFkZXJcIixcbiAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGhlYWRlckNvbnRhaW5lcilcbiAgICAgIC5zZXRIZWFkaW5nKClcbiAgICAgIC5zZXROYW1lKFwiQmV0YSBUZXN0aW5nIFBoYXNlXCIpXG4gICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0SWNvbihcInJvY2tldFwiKVxuICAgICAgICAgIC5zZXREaXNhYmxlZCh0cnVlKVxuICAgICAgICAgIC5leHRyYVNldHRpbmdzRWwuYWRkQ2xhc3MoXCJiZXRhLWhlYWRlci1pY29uXCIpO1xuICAgICAgfSk7XG5cbiAgICBiZXRhTm90aWNlRWwuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgIHRleHQ6IFwiVGhhbmsgeW91IGZvciB0cnlpbmcgb3V0IFN5c3RlbVNjdWxwdCEgV2hpbGUgc29tZSBjb3JlIGZlYXR1cmVzIGFyZSBhdmFpbGFibGUgdG8gZXZlcnlvbmUgZHVyaW5nIHRoaXMgYmV0YSBwaGFzZSwgY2VydGFpbiBhZHZhbmNlZCBjYXBhYmlsaXRpZXMgYXJlIGN1cnJlbnRseSBsaW1pdGVkIHRvIFBhdHJlb24gbWVtYmVycyB0byBoZWxwIG1hbmFnZSB0aGUgdGVzdGluZyBncm91cCBzaXplLlwiLFxuICAgICAgY2xzOiBcImJldGEtbm90aWNlLXRleHRcIixcbiAgICB9KTtcblxuICAgIGJldGFOb3RpY2VFbC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgdGV4dDogXCJBcyBhIHNvbG8gZGV2ZWxvcGVyLCB5b3VyIGZlZWRiYWNrIGlzIGluY3JlZGlibHkgdmFsdWFibGUgaW4gc2hhcGluZyBTeXN0ZW1TY3VscHQuIEZlZWwgZnJlZSB0byB0ZXN0IHRoZSBhdmFpbGFibGUgZmVhdHVyZXMsIGFuZCBpZiB5b3UnZCBsaWtlIGFjY2VzcyB0byB0aGUgZnVsbCBiZXRhIGV4cGVyaWVuY2UsIGNvbnNpZGVyIGJlY29taW5nIGEgUGF0cmVvbiBzdXBwb3J0ZXIhXCIsXG4gICAgICBjbHM6IFwiYmV0YS1ub3RpY2UtdGV4dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHN0eWxlcyBpZiBub3QgYWxyZWFkeSBhZGRlZFxuICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzeXN0ZW1zY3VscHQtYmV0YS1zdHlsZXNcIikpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgICAgc3R5bGUuaWQgPSBcInN5c3RlbXNjdWxwdC1iZXRhLXN0eWxlc1wiO1xuICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgICAgIC5zeXN0ZW1zY3VscHQtYmV0YS1ub3RpY2Uge1xuICAgICAgICAgIG1hcmdpbi10b3A6IDMycHg7XG4gICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7XG4gICAgICAgICAgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsIDAsIDAsIDAuMSk7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtaGVhZGVyIHtcbiAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNnB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtbm90aWNlLWhlYWRlciAuc2V0dGluZy1pdGVtIHtcbiAgICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLW5vdGljZS1oZWFkZXIgLnNldHRpbmctaXRlbS1uYW1lIHtcbiAgICAgICAgICBmb250LXNpemU6IDEuMmVtO1xuICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLWhlYWRlci1pY29uIHtcbiAgICAgICAgICBjb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KSAhaW1wb3J0YW50O1xuICAgICAgICAgIGJhY2tncm91bmQ6IG5vbmUgIWltcG9ydGFudDtcbiAgICAgICAgICBwYWRkaW5nOiAwICFpbXBvcnRhbnQ7XG4gICAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHggIWltcG9ydGFudDtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLW5vdGljZS10ZXh0IHtcbiAgICAgICAgICBtYXJnaW46IDEycHggMDtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjY7XG4gICAgICAgICAgZm9udC1zaXplOiAwLjk1ZW07XG4gICAgICAgIH1cblxuICAgICAgICAudGhlbWUtZGFyayAuc3lzdGVtc2N1bHB0LWJldGEtbm90aWNlIHtcbiAgICAgICAgICBib3gtc2hhZG93OiAwIDFweCAzcHggcmdiYSgwLCAwLCAwLCAwLjIpO1xuICAgICAgICB9XG4gICAgICBgO1xuICAgICAgY29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZGlzcGxheVRva2VuQmFsYW5jZShjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IHRoaXMuc3lzdGVtU2N1bHB0U2VydmljZS5nZXRUb2tlbkJhbGFuY2UoKTtcbiAgICAgIGNvbnRhaW5lckVsLnNldFRleHQoYEF2YWlsYWJsZSBDcmVkaXRzOiAke2JhbGFuY2UudG9Mb2NhbGVTdHJpbmcoKX1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29udGFpbmVyRWwuc2V0VGV4dChcIlVuYWJsZSB0byBmZXRjaCBjcmVkaXQgYmFsYW5jZVwiKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggdG9rZW4gYmFsYW5jZTpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheVByb1Byb21vdGlvblNlY3Rpb24oXG4gICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxuICAgIGlzUHJvQWN0aXZlOiBib29sZWFuXG4gICkge1xuICAgIGlmICghaXNQcm9BY3RpdmUpIHtcbiAgICAgIGNvbnN0IHByb1Byb21vdGlvbkVsID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByby1wcm9tb3Rpb25cIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBoZWFkZXJDb250YWluZXIgPSBwcm9Qcm9tb3Rpb25FbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJwcm8tcHJvbW90aW9uLWhlYWRlclwiLFxuICAgICAgfSk7XG5cbiAgICAgIG5ldyBTZXR0aW5nKGhlYWRlckNvbnRhaW5lcilcbiAgICAgICAgLnNldEhlYWRpbmcoKVxuICAgICAgICAuc2V0TmFtZShcIlVwZ3JhZGUgdG8gUHJvXCIpXG4gICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgICAgYnV0dG9uXG4gICAgICAgICAgICAuc2V0SWNvbihcInNwYXJrbGVzXCIpXG4gICAgICAgICAgICAuc2V0RGlzYWJsZWQodHJ1ZSlcbiAgICAgICAgICAgIC5leHRyYVNldHRpbmdzRWwuYWRkQ2xhc3MoXCJwcm8taGVhZGVyLWljb25cIik7XG4gICAgICAgIH0pO1xuXG4gICAgICBwcm9Qcm9tb3Rpb25FbC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgICB0ZXh0OiBcIlRyYW5zZm9ybSB5b3VyIHdvcmtmbG93IHdpdGggcG93ZXJmdWwgQUkgZmVhdHVyZXMgZGVzaWduZWQgZm9yIHNlcmlvdXMgcHJvZHVjdGl2aXR5LlwiLFxuICAgICAgICBjbHM6IFwicHJvLXByb21vdGlvbi10ZXh0XCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYmVuZWZpdHNMaXN0ID0gcHJvUHJvbW90aW9uRWwuY3JlYXRlRWwoXCJ1bFwiLCB7XG4gICAgICAgIGNsczogXCJwcm8tYmVuZWZpdHMtbGlzdFwiLFxuICAgICAgfSk7XG5cbiAgICAgIFtcbiAgICAgICAgXCJBdWRpbyBSZWNvcmRpbmcgJiBJbnN0YW50IFRyYW5zY3JpcHRpb25cIixcbiAgICAgICAgXCJTbWFydCBEb2N1bWVudCBQcm9jZXNzaW5nXCIsXG4gICAgICAgIFwiUmVhbC10aW1lIFZvaWNlLXRvLVRleHQgaW4gTm90ZXMgJiBDaGF0XCIsXG4gICAgICAgIFwiTXVsdGktZm9ybWF0IFN1cHBvcnQgKFBERiwgQXVkaW8sIEltYWdlcylcIixcbiAgICAgICAgXCJBSSBUZW1wbGF0ZXMgJiBDdXN0b20gUGVyc29uYWxpdGllc1wiLFxuICAgICAgICBcIlByaW9yaXR5IEFjY2VzcyB0byBOZXcgRmVhdHVyZXNcIixcbiAgICAgICAgXCIxLW9uLTEgU3VwcG9ydCB2aWEgUGF0cmVvbiBETXNcIixcbiAgICAgICAgXCJTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIERldmVsb3BtZW50XCIsXG4gICAgICBdLmZvckVhY2goKGJlbmVmaXQpID0+IHtcbiAgICAgICAgYmVuZWZpdHNMaXN0LmNyZWF0ZUVsKFwibGlcIiwgeyB0ZXh0OiBiZW5lZml0IH0pO1xuICAgICAgfSk7XG5cbiAgICAgIG5ldyBTZXR0aW5nKHByb1Byb21vdGlvbkVsKS5hZGRCdXR0b24oKGJ1dHRvbikgPT5cbiAgICAgICAgYnV0dG9uXG4gICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJCZWNvbWUgYSBQYXRyb25cIilcbiAgICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5Q2hhdFRhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwiY2hhdFwiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIkNoYXQgU2V0dGluZ3NcIiB9KTtcblxuICAgIC8vIEFJIE1vZGVsIFNldHRpbmdcbiAgICBjb25zdCBtb2RlbFNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQUkgTW9kZWxcIilcbiAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHdoaWNoIEFJIG1vZGVsIHRvIHVzZSBmb3IgY2hhdFwiKTtcblxuICAgIG1vZGVsU2V0dGluZy5hZGRCdXR0b24oKGJ1dHRvbikgPT5cbiAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KFwiU2VsZWN0IE1vZGVsXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICBidXR0b24uc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgICAgICAgICAgY29uc3QgbW9kZWxEaXNwbGF5ID0gY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBcIi5zeXN0ZW1zY3VscHQtY3VycmVudC1tb2RlbFwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGlmIChtb2RlbERpc3BsYXkpIHtcbiAgICAgICAgICAgICAgICBtb2RlbERpc3BsYXkuc2V0VGV4dChgQ3VycmVudCBtb2RlbDogJHttb2RlbElkfWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gbG9hZCBhdmFpbGFibGUgbW9kZWxzXCIpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGJ1dHRvbi5zZXREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIG1vZGVsU2V0dGluZy5kZXNjRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgdGV4dDogYEN1cnJlbnQgbW9kZWw6ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkfWAsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1cnJlbnQtbW9kZWxcIixcbiAgICB9KTtcblxuICAgIC8vIFN5c3RlbSBQcm9tcHQgU2V0dGluZ1xuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJDaGF0IFN5c3RlbSBQcm9tcHRcIilcbiAgICAgIC5zZXREZXNjKFwiQ3VzdG9taXplIHRoZSBzeXN0ZW0gcHJvbXB0IHVzZWQgZm9yIGFsbCBuZXcgY2hhdHNcIilcbiAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dChcIkVkaXQgUHJvbXB0XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dTeXN0ZW1Qcm9tcHRNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBvblNhdmU6IGFzeW5jIChuZXdQcm9tcHQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQgPSBuZXdQcm9tcHQ7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgbW9kZTogXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICAgIGN1c3RvbVByb21wdEZpbGVQYXRoOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAocmVzdWx0Py5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQgPSByZXN1bHQuY29udGVudDtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFR5cGUgPSByZXN1bHQudHlwZTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQ/LnR5cGUgPT09IFwiY3VzdG9tXCIgJiYgcmVzdWx0Py5wYXRoKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGggPSByZXN1bHQucGF0aDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGggPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5QWR2YW5jZWRUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImFkdmFuY2VkXCI7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGV2ZWxvcG1lbnQgTW9kZVwiKVxuICAgICAgLnNldERlc2MoXCJUb2dnbGUgYmV0d2VlbiBkZXZlbG9wbWVudCBhbmQgcHJvZHVjdGlvbiBBUEkgZW5kcG9pbnRzXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXJ2ZXJVcmwgPSB2YWx1ZVxuICAgICAgICAgICAgICA/IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCJcbiAgICAgICAgICAgICAgOiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb21cIjtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgbmV3IE5vdGljZShcbiAgICAgICAgICAgICAgYFN3aXRjaGVkIHRvICR7dmFsdWUgPyBcImRldmVsb3BtZW50XCIgOiBcInByb2R1Y3Rpb25cIn0gbW9kZSAoJHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgICAgICAgICB9KWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAvLyBSZXNldCB0byBGYWN0b3J5IFNldHRpbmdzIGJ1dHRvblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJSZXNldCB0byBGYWN0b3J5IFNldHRpbmdzXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJDbGVhciBhbGwgY3VzdG9tIHNldHRpbmdzIGFuZCByZXN0b3JlIGRlZmF1bHRzIGZvciB0aGlzIHBsdWdpbi5cIlxuICAgICAgKVxuICAgICAgLmFkZEJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KFwiUmVzZXRcdTIwMjZcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29uZmlybSA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgXCJSZXNldCB0byBGYWN0b3J5IERlZmF1bHRzXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICAgIFwiVGhpcyB3aWxsIGRlbGV0ZSBBTEwgc2F2ZWQgc2V0dGluZ3MgYW5kIGN1c3RvbWl6YXRpb25zIGZvciBTeXN0ZW1TY3VscHQsIHJldHVybmluZyBldmVyeXRoaW5nIHRvIGRlZmF1bHQuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlP1wiLFxuICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlJlc2V0ICYgUmVsb2FkXCIsXG4gICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghY29uZmlybSB8fCAhY29uZmlybS5jb25maXJtZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEobnVsbCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICAuZ2V0U2V0dGluZ3NNYW5hZ2VyKClcbiAgICAgICAgICAgICAgLnVwZGF0ZVNldHRpbmdzKERFRkFVTFRfU0VUVElOR1MpO1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVzZXR0aW5nIHRvIGZhY3Rvcnkgc2V0dGluZ3M6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gcmVzZXQ6IFwiICsgU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkaXNwbGF5RGlyZWN0b3JpZXNUYWIoXG4gICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxuICAgIGlzUHJvQWN0aXZlOiBib29sZWFuXG4gICkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJkaXJlY3Rvcmllc1wiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIkRpcmVjdG9yeSBTZXR0aW5nc1wiIH0pO1xuXG4gICAgLy8gQ29yZSBkaXJlY3RvcmllcyAoYWx3YXlzIGF2YWlsYWJsZSlcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiQ2hhdHMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIGNoYXQgaGlzdG9yeVwiLFxuICAgICAgXCJjaGF0c0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvQ2hhdHNcIlxuICAgICk7XG5cbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiUmVjb3JkaW5ncyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgcmVjb3JkaW5nc1wiLFxuICAgICAgXCJyZWNvcmRpbmdzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9SZWNvcmRpbmdzXCJcbiAgICApO1xuXG4gICAgLy8gQ2hhbmdlZCB0byBcIlN5c3RlbSBQcm9tcHRzXCJcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiU3lzdGVtIFByb21wdHMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIGN1c3RvbSBzeXN0ZW0gcHJvbXB0c1wiLFxuICAgICAgXCJzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiXG4gICAgKTtcblxuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJBdHRhY2htZW50cyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHNhdmVkIGltYWdlcyBhbmQgYXR0YWNobWVudHNcIixcbiAgICAgIFwiYXR0YWNobWVudHNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L0F0dGFjaG1lbnRzXCJcbiAgICApO1xuXG4gICAgLy8gQWx3YXlzIGRpc3BsYXkgdGhlc2UgZGlyZWN0b3JpZXNcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiRXh0cmFjdGlvbnMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IHdoZXJlIGV4dHJhY3RlZCBQREZzL2RvY3Mgd2lsbCBiZSBwbGFjZWRcIixcbiAgICAgIFwiZXh0cmFjdGlvbnNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L0V4dHJhY3Rpb25zXCJcbiAgICApO1xuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJUYXNrcyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgdGFzayBsaXN0c1wiLFxuICAgICAgXCJ0YXNrc0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvVGFza3NcIlxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBkZXNjOiBzdHJpbmcsXG4gICAgc2V0dGluZ0tleTpcbiAgICAgIHwgXCJhdHRhY2htZW50c0RpcmVjdG9yeVwiXG4gICAgICB8IFwicmVjb3JkaW5nc0RpcmVjdG9yeVwiXG4gICAgICB8IFwiY2hhdHNEaXJlY3RvcnlcIlxuICAgICAgfCBcImV4dHJhY3Rpb25zRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJ0YXNrc0RpcmVjdG9yeVwiLFxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmdcbiAgKSB7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShuYW1lKVxuICAgICAgLnNldERlc2MoZGVzYylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIocGxhY2Vob2xkZXIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlRGlyZWN0b3J5Q2hhbmdlKHZhbHVlLCBzZXR0aW5nS2V5KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhdHRhY2hGb2xkZXJTdWdnZXN0ZXIoXG4gICAgICAgICAgdGV4dC5pbnB1dEVsLFxuICAgICAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsaWRhdGVEaXJlY3Rvcnkoc2VsZWN0ZWRQYXRoKSkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSA9IHNlbGVjdGVkUGF0aDtcbiAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShzZWxlY3RlZFBhdGgpO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNob3dQb3B1cChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICBcIkludmFsaWQgZGlyZWN0b3J5IHBhdGguIFBsZWFzZSB1c2UgcmVsYXRpdmUgcGF0aHMgd2l0aG91dCAnLi4nIG9yIGxlYWRpbmcgc2xhc2hlcy5cIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheVJlY29yZGVyVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJyZWNvcmRlclwiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIlJlY29yZGluZyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgY29uc3QgbWljcm9waG9uZVNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUHJlZmVycmVkIE1pY3JvcGhvbmVcIilcbiAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHlvdXIgcHJlZmVycmVkIG1pY3JvcGhvbmUgZm9yIHJlY29yZGluZ3NcIik7XG5cbiAgICBjb25zdCBtaWNTZWxlY3QgPSBtaWNyb3Bob25lU2V0dGluZy5jb250cm9sRWwuY3JlYXRlRWwoXCJzZWxlY3RcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1taWNyb3Bob25lLXNlbGVjdFwiLFxuICAgIH0pO1xuXG4gICAgbWljU2VsZWN0XG4gICAgICAuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICB2YWx1ZTogXCJcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nIG1pY3JvcGhvbmVzLi4uXCIsXG4gICAgICB9KVxuICAgICAgLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcblxuICAgIG1pY1NlbGVjdC5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlc1xuICAgICAgICAuZW51bWVyYXRlRGV2aWNlcygpXG4gICAgICAgIC50aGVuKChkZXZpY2VzKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWljcm9waG9uZXMgPSBkZXZpY2VzLmZpbHRlcihcbiAgICAgICAgICAgIChkZXZpY2UpID0+IGRldmljZS5raW5kID09PSBcImF1ZGlvaW5wdXRcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgbWljU2VsZWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgbWljU2VsZWN0LmZpcnN0RWxlbWVudENoaWxkPy5yZW1vdmUoKTsgLy8gUmVtb3ZlIGxvYWRpbmcgbWVzc2FnZVxuICAgICAgICAgIG1pY3JvcGhvbmVzLmZvckVhY2goKG1pYykgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gbWljU2VsZWN0LmNyZWF0ZUVsKFwib3B0aW9uXCIsIHtcbiAgICAgICAgICAgICAgdmFsdWU6IG1pYy5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgdGV4dDogbWljLmxhYmVsIHx8IGBNaWNyb3Bob25lICR7bWljLmRldmljZUlkLnNsaWNlKDAsIDgpfS4uLmAsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChtaWMuZGV2aWNlSWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCkge1xuICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVudW1lcmF0aW5nIGF1ZGlvIGRldmljZXM6XCIsIGVycm9yKTtcbiAgICAgICAgICBtaWNTZWxlY3QuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIlVuYWJsZSB0byBsaXN0IG1pY3JvcGhvbmVzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTWljcm9waG9uZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICBtaWNTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQgPSBtaWNTZWxlY3QudmFsdWU7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBdXRvLVRyYW5zY3JpYmUgUmVjb3JkaW5nc1wiKVxuICAgICAgLnNldERlc2MoXCJBdXRvbWF0aWNhbGx5IHRyYW5zY3JpYmUgcmVjb3JkaW5ncyB3aGVuIHRoZXkgYXJlIGNvbXBsZXRlZFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9UcmFuc2NyaWJlUmVjb3JkaW5ncyA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQXV0by1QYXN0ZSBUcmFuc2NyaXB0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgcGFzdGUgdHJhbnNjcmlwdGlvbnMgaW50byB0aGUgYWN0aXZlIGRvY3VtZW50XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvUGFzdGVUcmFuc2NyaXB0aW9uKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9QYXN0ZVRyYW5zY3JpcHRpb24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgLy8gQWRkIG5ldyBwb3N0LXByb2Nlc3NpbmcgcHJvbXB0IHNldHRpbmdcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUG9zdC1Qcm9jZXNzaW5nXCIpXG4gICAgICAuc2V0RGVzYyhcIkNvbmZpZ3VyZSBob3cgdHJhbnNjcmlwdGlvbnMgc2hvdWxkIGJlIHBvc3QtcHJvY2Vzc2VkXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZClcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkVuYWJsZS9kaXNhYmxlIHBvc3QtcHJvY2Vzc2luZ1wiKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0b2dnbGU7XG4gICAgICB9KVxuICAgICAgLmFkZEJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiRWRpdCBQcm9tcHRcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkNvbmZpZ3VyZSB0aGUgcG9zdC1wcm9jZXNzaW5nIHByb21wdFwiKVxuICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2hvd1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwgfSA9IGF3YWl0IGltcG9ydChcbiAgICAgICAgICAgICAgXCIuL1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWxcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0ID0gcmVzdWx0LmNvbnRlbnQ7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlUYXNrc1RhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwidGFza3NcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJUYXNrcyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkF1dG8tTW92ZSBDb21wbGV0ZWQgVGFza3NcIilcbiAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSBtb3ZlIGNvbXBsZXRlZCB0YXNrcyB0byB0aGUgYm90dG9tIG9mIHRoZSBsaXN0XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb3ZlQ29tcGxldGVkVGFza3NEb3duKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vdmVDb21wbGV0ZWRUYXNrc0Rvd24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG59XG4iLCAiZXhwb3J0IGludGVyZmFjZSBNb2RlbEFyY2hpdGVjdHVyZSB7XG4gIG1vZGFsaXR5OiBzdHJpbmc7XG4gIHRva2VuaXplcjogc3RyaW5nO1xuICBpbnN0cnVjdF90eXBlOiBzdHJpbmcgfCBudWxsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVsUHJpY2luZyB7XG4gIHByb21wdDogc3RyaW5nO1xuICBjb21wbGV0aW9uOiBzdHJpbmc7XG4gIGltYWdlOiBzdHJpbmc7XG4gIHJlcXVlc3Q6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb3BQcm92aWRlciB7XG4gIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gIG1heF9jb21wbGV0aW9uX3Rva2VuczogbnVtYmVyIHwgbnVsbDtcbiAgaXNfbW9kZXJhdGVkOiBib29sZWFuO1xufVxuXG4vLyBOZXcgaW50ZXJmYWNlIGZvciBzdG9yaW5nIGZhdm9yaXRlIG1vZGVsc1xuZXhwb3J0IGludGVyZmFjZSBGYXZvcml0ZU1vZGVsIHtcbiAgcHJvdmlkZXI6IHN0cmluZztcbiAgbW9kZWxJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVsSWRlbnRpZmllciB7XG4gIHByb3ZpZGVySWQ6IHN0cmluZzsgLy8gZS5nLiBcIm9wZW5yb3V0ZXJcIiwgXCJzeXN0ZW1zY3VscHRcIlxuICBtb2RlbElkOiBzdHJpbmc7IC8vIGUuZy4gXCJncHQtNFwiLCBcIm1pc3RyYWwtN2JcIlxuICBkaXNwbGF5TmFtZT86IHN0cmluZzsgLy8gT3B0aW9uYWwgZGlzcGxheSBuYW1lIG92ZXJyaWRlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0TW9kZWwge1xuICBpZGVudGlmaWVyOiBNb2RlbElkZW50aWZpZXI7IC8vIE5ldyBzdHJ1Y3R1cmVkIGlkZW50aWZpZXJcbiAgaWQ6IHN0cmluZzsgLy8gS2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICBuYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gIGNhcGFiaWxpdGllczogc3RyaW5nW107XG4gIGFyY2hpdGVjdHVyZToge1xuICAgIG1vZGFsaXR5OiBzdHJpbmc7XG4gICAgdG9rZW5pemVyPzogc3RyaW5nO1xuICAgIGluc3RydWN0X3R5cGU/OiBzdHJpbmcgfCBudWxsO1xuICB9O1xuICBwcmljaW5nOiB7XG4gICAgcHJvbXB0OiBzdHJpbmc7XG4gICAgY29tcGxldGlvbjogc3RyaW5nO1xuICAgIGltYWdlOiBzdHJpbmc7XG4gICAgcmVxdWVzdDogc3RyaW5nO1xuICB9O1xuICBwcm92aWRlcjogc3RyaW5nO1xuICB0b3BfcHJvdmlkZXI/OiB7XG4gICAgY29udGV4dF9sZW5ndGg6IG51bWJlcjtcbiAgICBtYXhfY29tcGxldGlvbl90b2tlbnM6IG51bWJlciB8IG51bGw7XG4gICAgaXNfbW9kZXJhdGVkOiBib29sZWFuO1xuICB9O1xuICBpc0Zhdm9yaXRlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDdXN0b21Qcm92aWRlciB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZW5kcG9pbnQ6IHN0cmluZztcbiAgYXBpS2V5OiBzdHJpbmc7XG4gIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgbGFzdFRlc3RlZD86IG51bWJlcjsgLy8gVGltZXN0YW1wIG9mIGxhc3QgY29ubmVjdGlvbiB0ZXN0XG4gIGNhY2hlZE1vZGVscz86IHN0cmluZ1tdOyAvLyBDYWNoZWQgbGlzdCBvZiBtb2RlbCBJRHNcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3RpdmVQcm92aWRlciB7XG4gIGlkOiBzdHJpbmc7IC8vIFVuaXF1ZSBJRCBvZiB0aGUgcHJvdmlkZXJcbiAgbmFtZTogc3RyaW5nOyAvLyBEaXNwbGF5IG5hbWUgKGUuZy4sIFwiU3lzdGVtU2N1bHB0XCIsIFwiT2xsYW1hXCIsIGV0Yy4pXG4gIHR5cGU6IFwibmF0aXZlXCIgfCBcImN1c3RvbVwiOyAvLyBXaGV0aGVyIGl0J3MgdGhlIG5hdGl2ZSBTeXN0ZW1TY3VscHQgb3IgYSBjdXN0b20gcHJvdmlkZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbEZpbHRlclNldHRpbmdzIHtcbiAgc2hvd1Zpc2lvbk1vZGVsczogYm9vbGVhbjtcbiAgc2hvd1JlYXNvbmluZ01vZGVsczogYm9vbGVhbjtcbiAgc2hvd0NyZWF0aXZlTW9kZWxzOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9GSUxURVJfU0VUVElOR1M6IE1vZGVsRmlsdGVyU2V0dGluZ3MgPSB7XG4gIHNob3dWaXNpb25Nb2RlbHM6IGZhbHNlLFxuICBzaG93UmVhc29uaW5nTW9kZWxzOiBmYWxzZSxcbiAgc2hvd0NyZWF0aXZlTW9kZWxzOiBmYWxzZSxcbn07XG4iLCAiaW1wb3J0IHsgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZVwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vdmlld3MvY29tcG9uZW50cy9NZXNzYWdlUmVuZGVyZXJcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHR5cGUge1xuICBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgQ3VzdG9tUHJvdmlkZXIsXG4gIE1vZGVsRmlsdGVyU2V0dGluZ3MsXG4gIEFjdGl2ZVByb3ZpZGVyLFxuICBGYXZvcml0ZU1vZGVsLFxufSBmcm9tIFwiLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTIH0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5cbi8vIFJlLWV4cG9ydCBmb3IgY29udmVuaWVuY2VcbmV4cG9ydCB0eXBlIHtcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG4gIEN1c3RvbVByb3ZpZGVyLFxuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBBY3RpdmVQcm92aWRlcixcbiAgRmF2b3JpdGVNb2RlbCxcbn0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5cbmV4cG9ydCBjb25zdCBQQVRSRU9OX1VSTCA9IFwiaHR0cHM6Ly93d3cucGF0cmVvbi5jb20vc3lzdGVtc2N1bHB0L21lbWJlcnNoaXBcIjtcblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1TY3VscHRTZXR0aW5ncyB7XG4gIGxpY2Vuc2VLZXk6IHN0cmluZztcbiAgbGljZW5zZVZhbGlkOiBib29sZWFuO1xuICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgY2hhdHNEaXJlY3Rvcnk6IHN0cmluZztcbiAgbGFzdFZhbGlkYXRlZDogbnVtYmVyO1xuICAvKipcbiAgICogRm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHdlJ2xsIGtlZXAgc3lzdGVtUHJvbXB0IGFzIHRoZSBsYXN0LXNhdmVkXG4gICAqIHVzZXItY2hvc2VuIHRleHQuIFRoaXMgaXMgb25seSB1c2VkIGZvciBkaXJlY3Qgc3RvcmFnZSBpZiB0aGUgdXNlclxuICAgKiBwaWNrcyBhIHByZXNldCBvciB0eXBlZCBjb250ZW50LiBCdXQgaWYgc3lzdGVtUHJvbXB0VHlwZSBpcyBcImN1c3RvbVwiLFxuICAgKiB3ZSdsbCByZWFkIGZyb20gc3lzdGVtUHJvbXB0UGF0aC5cbiAgICovXG4gIHN5c3RlbVByb21wdDogc3RyaW5nO1xuICByZWNvcmRpbmdzRGlyZWN0b3J5OiBzdHJpbmc7XG4gIGRldmVsb3BtZW50TW9kZTogYm9vbGVhbjtcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBzdHJpbmc7XG4gIGF1dG9UcmFuc2NyaWJlUmVjb3JkaW5nczogYm9vbGVhbjtcbiAgYXV0b1Bhc3RlVHJhbnNjcmlwdGlvbjogYm9vbGVhbjtcbiAgcG9zdFByb2Nlc3NpbmdQcm9tcHQ6IHN0cmluZztcbiAgcG9zdFByb2Nlc3NpbmdFbmFibGVkOiBib29sZWFuO1xuICBzaG93TW9kZWxUb29sdGlwczogYm9vbGVhbjtcbiAgc2hvd1Zpc2lvbk1vZGVsc09ubHk6IGJvb2xlYW47XG4gIHNob3dUb3BQaWNrc09ubHk6IGJvb2xlYW47XG4gIHNlbGVjdGVkUHJvdmlkZXI6IHN0cmluZztcbiAgc2VydmVyVXJsOiBzdHJpbmc7XG4gIGF0dGFjaG1lbnRzRGlyZWN0b3J5OiBzdHJpbmc7XG4gIGV4dHJhY3Rpb25zRGlyZWN0b3J5OiBzdHJpbmc7XG4gIC8vIENoYW5nZWQgYmVsb3cgdG8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIiB3aXRoIGEgc3BhY2VcbiAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTogc3RyaW5nO1xuICB0YXNrc0RpcmVjdG9yeTogc3RyaW5nO1xuICBtb3ZlQ29tcGxldGVkVGFza3NEb3duOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBORVcgRklFTERTOlxuICAgKiBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCJcbiAgICogc3lzdGVtUHJvbXB0UGF0aDogcGF0aCB0byB0aGUgZmlsZSB0aGF0IGhvbGRzIHRoZSBjdXN0b20gc3lzdGVtIHByb21wdCAoaWYgYW55KS5cbiAgICovXG4gIHN5c3RlbVByb21wdFR5cGU6IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIjtcbiAgc3lzdGVtUHJvbXB0UGF0aDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDdXN0b20gcHJvdmlkZXIgc2V0dGluZ3NcbiAgICovXG4gIGN1c3RvbVByb3ZpZGVyczogQ3VzdG9tUHJvdmlkZXJbXTtcblxuICBtb2RlbEZpbHRlclNldHRpbmdzOiBNb2RlbEZpbHRlclNldHRpbmdzO1xuXG4gIGZhdm9yaXRlTW9kZWxzOiBGYXZvcml0ZU1vZGVsW107XG5cbiAgYWN0aXZlUHJvdmlkZXI6IEFjdGl2ZVByb3ZpZGVyO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU3lzdGVtU2N1bHB0U2V0dGluZ3MgPSB7XG4gIGxpY2Vuc2VLZXk6IFwiXCIsXG4gIGxpY2Vuc2VWYWxpZDogZmFsc2UsXG4gIHNlbGVjdGVkTW9kZWxJZDogXCJcIixcbiAgY2hhdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0NoYXRzXCIsXG4gIGxhc3RWYWxpZGF0ZWQ6IDAsXG4gIC8vIFRoaXMgaXMgdGhlIGZhbGxiYWNrIHN5c3RlbSBwcm9tcHQgaWYgdGhlIHVzZXIgaGFzbid0IGNob3NlbiBhIGN1c3RvbSBvciBwcmVzZXRcbiAgc3lzdGVtUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50LiBZb3UgaGVscCB1c2VycyB3aXRoIHRoZWlyIHF1ZXN0aW9ucyBhbmQgdGFza3MgaW4gYSBjbGVhciBhbmQgY29uY2lzZSB3YXkuXCIsXG4gIHJlY29yZGluZ3NEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1JlY29yZGluZ3NcIixcbiAgZGV2ZWxvcG1lbnRNb2RlOiBmYWxzZSxcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBcIlwiLFxuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IHRydWUsXG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IHRydWUsXG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIHRyYW5zY3JpcHRpb24gcG9zdC1wcm9jZXNzb3IuIFlvdXIgdGFzayBpcyB0byBmaXggYW55IHRyYW5zY3JpcHRpb24gZXJyb3JzLCBjb3JyZWN0IGdyYW1tYXIgYW5kIHB1bmN0dWF0aW9uLCBhbmQgZW5zdXJlIHRoZSB0ZXh0IGlzIHByb3Blcmx5IGZvcm1hdHRlZC4gS2VlcCB0aGUgb3JpZ2luYWwgbWVhbmluZyBpbnRhY3Qgd2hpbGUgbWFraW5nIHRoZSB0ZXh0IG1vcmUgcmVhZGFibGUuXCIsXG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogZmFsc2UsXG4gIHNob3dNb2RlbFRvb2x0aXBzOiBmYWxzZSxcbiAgc2hvd1Zpc2lvbk1vZGVsc09ubHk6IGZhbHNlLFxuICBzaG93VG9wUGlja3NPbmx5OiBmYWxzZSxcbiAgc2VsZWN0ZWRQcm92aWRlcjogXCJhbGxcIixcbiAgc2VydmVyVXJsOiBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiLFxuICBhdHRhY2htZW50c0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvQXR0YWNobWVudHNcIixcbiAgZXh0cmFjdGlvbnNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0V4dHJhY3Rpb25zXCIsXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gIHRhc2tzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9UYXNrc1wiLFxuICBtb3ZlQ29tcGxldGVkVGFza3NEb3duOiB0cnVlLFxuXG4gIC8qKlxuICAgKiBORVcgRklFTERTIERFRkFVTFRTOlxuICAgKi9cbiAgc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiLFxuICBzeXN0ZW1Qcm9tcHRQYXRoOiBcIlwiLFxuXG4gIC8qKlxuICAgKiBDdXN0b20gcHJvdmlkZXIgZGVmYXVsdHNcbiAgICovXG4gIGN1c3RvbVByb3ZpZGVyczogW10sXG5cbiAgbW9kZWxGaWx0ZXJTZXR0aW5nczogREVGQVVMVF9GSUxURVJfU0VUVElOR1MsXG5cbiAgZmF2b3JpdGVNb2RlbHM6IFtdLFxuXG4gIGFjdGl2ZVByb3ZpZGVyOiB7XG4gICAgaWQ6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgbmFtZTogXCJTeXN0ZW1TY3VscHRcIixcbiAgICB0eXBlOiBcIm5hdGl2ZVwiLFxuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IFNFTlNJVElWRV9TRVRUSU5HUzogUGFydGlhbDxcbiAgUmVjb3JkPGtleW9mIFN5c3RlbVNjdWxwdFNldHRpbmdzLCBcIm5vbmVcIiB8IFwiYm90aFwiIHwgXCJ2YWx1ZVwiPlxuPiA9IHtcbiAgbGljZW5zZUtleTogXCJib3RoXCIsXG4gIHNlbGVjdGVkTW9kZWxJZDogXCJub25lXCIsXG4gIGNoYXRzRGlyZWN0b3J5OiBcIm5vbmVcIixcbiAgbGFzdFZhbGlkYXRlZDogXCJub25lXCIsXG4gIHN5c3RlbVByb21wdDogXCJub25lXCIsXG4gIHJlY29yZGluZ3NEaXJlY3Rvcnk6IFwibm9uZVwiLFxuICBkZXZlbG9wbWVudE1vZGU6IFwibm9uZVwiLFxuICBwcmVmZXJyZWRNaWNyb3Bob25lSWQ6IFwibm9uZVwiLFxuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IFwibm9uZVwiLFxuICBhdXRvUGFzdGVUcmFuc2NyaXB0aW9uOiBcIm5vbmVcIixcbiAgdGFza3NEaXJlY3Rvcnk6IFwibm9uZVwiLFxufTtcblxuZXhwb3J0IHR5cGUgQ2hhdFJvbGUgPSBcInVzZXJcIiB8IFwiYXNzaXN0YW50XCIgfCBcInN5c3RlbVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlQ29udGVudCB7XG4gIHR5cGU6IFwiaW1hZ2VfdXJsXCI7XG4gIGltYWdlX3VybDoge1xuICAgIHVybDogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRDb250ZW50IHtcbiAgdHlwZTogXCJ0ZXh0XCI7XG4gIHRleHQ6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgTXVsdGlQYXJ0Q29udGVudCA9IFRleHRDb250ZW50IHwgSW1hZ2VDb250ZW50O1xuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdEluZm8ge1xuICB0eXBlOiBzdHJpbmc7XG4gIHBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5wdXRIYW5kbGVyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIGdldE1lc3NhZ2VzOiAoKSA9PiBDaGF0TWVzc2FnZVtdO1xuICBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHN0cmluZztcbiAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiBTeXN0ZW1Qcm9tcHRJbmZvO1xuICBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIG1lc3NhZ2VSZW5kZXJlcjogTWVzc2FnZVJlbmRlcmVyO1xuICBvbk1lc3NhZ2VTdWJtaXQ6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkNvbnRleHRGaWxlQWRkOiAod2lraWxpbms6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25FcnJvcjogKGVycm9yOiBzdHJpbmcpID0+IHZvaWQ7XG4gIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHZvaWQ7XG4gIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4gdm9pZDtcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdE1lc3NhZ2Uge1xuICByb2xlOiBDaGF0Um9sZTtcbiAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xuICBtZXNzYWdlX2lkOiBzdHJpbmc7XG4gIGRvY3VtZW50Q29udGV4dD86IHtcbiAgICBkb2N1bWVudElkczogc3RyaW5nW107XG4gIH07XG4gIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmc7XG4gIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0UmVzcG9uc2Uge1xuICBpZDogc3RyaW5nO1xuICBjaG9pY2VzOiB7XG4gICAgbWVzc2FnZTogQ2hhdE1lc3NhZ2U7XG4gIH1bXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1TY3VscHRTdHJlYW1DaHVuayB7XG4gIGlkPzogc3RyaW5nO1xuICBjaG9pY2VzPzogQXJyYXk8e1xuICAgIGRlbHRhPzoge1xuICAgICAgY29udGVudD86IHN0cmluZztcbiAgICAgIHRleHQ/OiBzdHJpbmc7XG4gICAgICByZWFzb25pbmc/OiBzdHJpbmc7XG4gICAgfTtcbiAgfT47XG4gIGNvbXBsZXRpb24/OiBzdHJpbmc7XG4gIGRlbHRhPzoge1xuICAgIHRleHQ/OiBzdHJpbmc7XG4gICAgcmVhc29uaW5nPzogc3RyaW5nO1xuICB9O1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHN0YXR1c0NvZGU/OiBudW1iZXI7XG4gICAgbW9kZWw/OiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0UHJlc2V0IHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjtcbiAgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0VHlwZSB7XG4gIGlkOiBzdHJpbmc7IC8vIGUuZy4sIFwidGV4dF9tb2RpZmljYXRpb25cIlxuICBsYWJlbDogc3RyaW5nOyAvLyBlLmcuLCBcIlRleHQgTW9kaWZpY2F0aW9uXCJcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7IC8vIE9wdGlvbmFsIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGhpcyBwcm9tcHQgdHlwZSBkb2VzXG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjsgLy8gV2hldGhlciB1c2VyIGNhbiBjdXN0b21pemUgdGhlIHByb21wdFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRNb2RpZmljYXRpb25TdGF0ZSB7XG4gIG9yaWdpbmFsVGV4dDogc3RyaW5nO1xuICBtb2RpZmllZFRleHQ6IHN0cmluZztcbiAgaXNTdHJlYW1pbmc6IGJvb2xlYW47XG4gIHN0cmVhbUNvbXBsZXRlOiBib29sZWFuO1xuICBlcnJvcj86IHN0cmluZztcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCB9IGZyb20gXCIuLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7XG4gIFNlYXJjaFNlcnZpY2UsXG4gIFNlYXJjaE1hdGNoLFxuICBTZWFyY2hSZXN1bHQsXG4gIFNlYXJjaGFibGVGaWVsZCxcbn0gZnJvbSBcIi4uL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2VcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uSGVscGVyIH0gZnJvbSBcIi4vTW9kZWxTZWxlY3Rpb25IZWxwZXJcIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsIH0gZnJvbSBcIi4vQ3VzdG9tUHJvdmlkZXJNb2RhbFwiO1xuaW1wb3J0IHsgUEFUUkVPTl9VUkwgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIE1vZGVsU2VsZWN0aW9uTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgYWxsTW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdID0gW107XG4gIHByaXZhdGUgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChtb2RlbElkOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHByaXZhdGUgc2VhcmNoSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgbW9kZWxHcmlkOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlO1xuICBwcml2YXRlIHNlbGVjdGVkQ2FyZEluZGV4OiBudW1iZXIgPSAtMTtcbiAgcHJpdmF0ZSBtb2RlbENhcmRzOiBIVE1MRWxlbWVudFtdID0gW107XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgbG9nZ2VyOiBDb25zb2xlO1xuICBwcml2YXRlIGlzQ2xvc2luZzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGhlbHBlcjogTW9kZWxTZWxlY3Rpb25IZWxwZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgY3VycmVudE1vZGVsSWQ6IHN0cmluZyxcbiAgICBvblNlbGVjdDogKG1vZGVsSWQ6IHN0cmluZykgPT4gdm9pZCxcbiAgICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpblxuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gY3VycmVudE1vZGVsSWQ7XG4gICAgdGhpcy5vblNlbGVjdCA9IG9uU2VsZWN0O1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLmhlbHBlciA9IG5ldyBNb2RlbFNlbGVjdGlvbkhlbHBlcihwbHVnaW4pO1xuICAgIHRoaXMuc2VhcmNoU2VydmljZSA9IG5ldyBTZWFyY2hTZXJ2aWNlKCk7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kZWwtc2VsZWN0aW9uLW1vZGFsXCIpO1xuXG4gICAgICAvLyBDcmVhdGUgVUkgZWxlbWVudHNcbiAgICAgIHRoaXMuY3JlYXRlU2VhcmNoVUkoKTtcbiAgICAgIHRoaXMuY3JlYXRlTW9kZWxHcmlkKCk7XG4gICAgICB0aGlzLnNldHVwU2VhcmNoKCk7XG5cbiAgICAgIC8vIFNob3cgbG9hZGluZyBzdGF0ZVxuICAgICAgY29uc3QgbG9hZGluZ0NvbnRhaW5lciA9IHRoaXMubW9kZWxHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbG9hZGluZy1jb250YWluZXJcIixcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbG9hZGluZ1NwaW5uZXIgPSBsb2FkaW5nQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbG9hZGluZy1zcGlubmVyXCIsXG4gICAgICB9KTtcbiAgICAgIHNldEljb24obG9hZGluZ1NwaW5uZXIsIFwibG9hZGVyLTJcIik7XG4gICAgICBsb2FkaW5nQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbG9hZGluZy10ZXh0XCIsXG4gICAgICAgIHRleHQ6IFwiTG9hZGluZyBtb2RlbHMuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBVc2UgdGhlIHBsdWdpbidzIGluaXRpYWwgbW9kZWxzIHByb21pc2VcbiAgICAgIHRoaXMuYWxsTW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4uZ2V0SW5pdGlhbE1vZGVscygpO1xuXG4gICAgICAvLyBJbml0aWFsIHJlbmRlclxuICAgICAgdGhpcy5yZW5kZXJNb2RlbHModGhpcy5nZXRWaXNpYmxlTW9kZWxzKCkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIk1vZGVsU2VsZWN0aW9uTW9kYWw6IEVycm9yIGluIG9uT3BlblwiLCBlcnJvcik7XG4gICAgICB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWVycm9yLW1lc3NhZ2VcIixcbiAgICAgICAgdGV4dDogXCJFcnJvciBsb2FkaW5nIG1vZGVsIHNlbGVjdGlvbiBtb2RhbFwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRWaXNpYmxlTW9kZWxzKCk6IFNlYXJjaFJlc3VsdDxTeXN0ZW1TY3VscHRNb2RlbD5bXSB7XG4gICAgLy8gSWYgdGhlcmUncyBubyBzZWFyY2ggcXVlcnksIGp1c3QgcmV0dXJuIHRoZW0gYWxsIHNvcnRlZCBieSBwcm92aWRlclxuICAgIGlmICghdGhpcy5zZWFyY2hJbnB1dCB8fCAhdGhpcy5zZWFyY2hJbnB1dC52YWx1ZS50cmltKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmFsbE1vZGVscy5tYXAoKG0pID0+ICh7IGl0ZW06IG0sIG1hdGNoZXM6IFtdLCBzY29yZTogMCB9KSk7XG4gICAgfVxuXG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlLnRyaW0oKTtcblxuICAgIC8vIEFwcGx5IHNlYXJjaCBhbmQgZmlsdGVyXG4gICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICB0aGlzLmFsbE1vZGVscyxcbiAgICAgIHF1ZXJ5LFxuICAgICAgKG1vZGVsKSA9PiB0aGlzLmdldFNlYXJjaGFibGVGaWVsZHMobW9kZWwpLFxuICAgICAge1xuICAgICAgICBpbml0aWFsUmVzdWx0c0xpbWl0OiAyNSxcbiAgICAgICAgbWF4RmlsdGVyZWRSZXN1bHRzOiA1MCxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gRmlsdGVyIG91dCByZXN1bHRzIHdpdGggbm8gbWF0Y2hlcyBvciBsb3cgc2NvcmVzXG4gICAgY29uc3QgZmlsdGVyZWRSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoXG4gICAgICAocmVzdWx0KSA9PiByZXN1bHQubWF0Y2hlcy5sZW5ndGggPiAwICYmIHJlc3VsdC5zY29yZSA+IDBcbiAgICApO1xuXG4gICAgLy8gU29ydCByZXN1bHRzIGJ5IHNjb3JlXG4gICAgcmV0dXJuIGZpbHRlcmVkUmVzdWx0cy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlYXJjaGFibGVGaWVsZHMgPSAoXG4gICAgbW9kZWw6IFN5c3RlbVNjdWxwdE1vZGVsXG4gICk6IFNlYXJjaGFibGVGaWVsZFtdID0+IHtcbiAgICByZXR1cm4gW1xuICAgICAgeyBmaWVsZDogXCJuYW1lXCIsIHRleHQ6IG1vZGVsLm5hbWUsIHdlaWdodDogMjAwIH0sXG4gICAgICAuLi5tb2RlbC5uYW1lLnNwbGl0KC9bXFxzXFwtOlxcLl0rLykubWFwKChwYXJ0KSA9PiAoe1xuICAgICAgICBmaWVsZDogXCJuYW1lXCIsXG4gICAgICAgIHRleHQ6IHBhcnQsXG4gICAgICAgIHdlaWdodDogMTUwLFxuICAgICAgfSkpLFxuICAgICAgLi4uKG1vZGVsLnByb3ZpZGVyID09PSBcImN1c3RvbVwiXG4gICAgICAgID8gW3sgZmllbGQ6IFwicHJvdmlkZXJcIiwgdGV4dDogbW9kZWwuaWQuc3BsaXQoXCItXCIpWzBdLCB3ZWlnaHQ6IDE4MCB9XVxuICAgICAgICA6IFtdKSxcbiAgICAgIHsgZmllbGQ6IFwiZGVzY3JpcHRpb25cIiwgdGV4dDogbW9kZWwuZGVzY3JpcHRpb24gfHwgXCJcIiwgd2VpZ2h0OiA1MCB9LFxuICAgIF07XG4gIH07XG5cbiAgcHJpdmF0ZSBjcmVhdGVTZWFyY2hVSSgpIHtcbiAgICBjb25zdCBzZWFyY2hDb250YWluZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWFyY2gtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgc2VhcmNoIGlucHV0XG4gICAgdGhpcy5zZWFyY2hJbnB1dCA9IHNlYXJjaENvbnRhaW5lci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoIG1vZGVscy4uLlwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWFyY2gtaW5wdXRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBwcm92aWRlcnMgYnV0dG9uXG4gICAgY29uc3QgcHJvdmlkZXJzQnV0dG9uID0gc2VhcmNoQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXJzLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIHNldEljb24ocHJvdmlkZXJzQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJzZXR0aW5nc1wiKTtcbiAgICBwcm92aWRlcnNCdXR0b24uY3JlYXRlU3Bhbih7IHRleHQ6IFwiUHJvdmlkZXJzXCIgfSk7XG5cbiAgICBwcm92aWRlcnNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuXG4gICAgICAvLyBPcGVuIGN1c3RvbSBwcm92aWRlciBtYW5hZ2VyIG1vZGFsXG4gICAgICBjb25zdCBtYW5hZ2VyTW9kYWwgPSBuZXcgQ3VzdG9tUHJvdmlkZXJNYW5hZ2VyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIC8vIE9uIGJhY2tcbiAgICAgICAgICBjb25zdCBtb2RlbFNlbGVjdGlvbk1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICAgICAgdGhpcy5vblNlbGVjdCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgKTtcbiAgICAgICAgICBtb2RlbFNlbGVjdGlvbk1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIG1hbmFnZXJNb2RhbC5vcGVuKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU1vZGVsR3JpZCgpIHtcbiAgICB0aGlzLm1vZGVsR3JpZCA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWdyaWRcIixcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBTZWFyY2goKSB7XG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpO1xuICAgICAgdGhpcy5yZW5kZXJNb2RlbHMocmVzdWx0cyk7XG4gICAgfSk7XG5cbiAgICAvLyBLZXlib2FyZCBuYXZcbiAgICB0aGlzLmNvbnRlbnRFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPD0gMFxuICAgICAgICAgICAgICA/IHRoaXMubW9kZWxDYXJkcy5sZW5ndGggLSAxXG4gICAgICAgICAgICAgIDogdGhpcy5zZWxlY3RlZENhcmRJbmRleCAtIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID49IHRoaXMubW9kZWxDYXJkcy5sZW5ndGggLSAxXG4gICAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggKyAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kZWxDYXJkcy5mb3JFYWNoKChjYXJkLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IGkgPT09IHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXg7XG4gICAgICAgICAgY2FyZC5jbGFzc0xpc3QudG9nZ2xlKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIsIGlzU2VsZWN0ZWQpO1xuICAgICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBjYXJkLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcIm5lYXJlc3RcIiB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgY29uc3QgaGlnaGxpZ2h0ZWRDYXJkID0gdGhpcy5tb2RlbENhcmRzW3RoaXMuc2VsZWN0ZWRDYXJkSW5kZXhdO1xuICAgICAgICBpZiAoaGlnaGxpZ2h0ZWRDYXJkKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnN0IG1vZGVsSWQgPSBoaWdobGlnaHRlZENhcmQuZGF0YXNldC5tb2RlbElkO1xuICAgICAgICAgIGlmIChtb2RlbElkKSB7XG4gICAgICAgICAgICB0aGlzLm9uU2VsZWN0KG1vZGVsSWQpO1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUGFzc2l2ZSBzY3JvbGwvdG91Y2hcbiAgICB0aGlzLm1vZGVsR3JpZD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgIFwid2hlZWxcIixcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8ganVzdCBhIG5vLW9wXG4gICAgICB9LFxuICAgICAgeyBwYXNzaXZlOiB0cnVlIH1cbiAgICApO1xuICAgIHRoaXMubW9kZWxHcmlkPy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoKSA9PiB7fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICAgIHRoaXMubW9kZWxHcmlkPy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsICgpID0+IHt9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyBhbGwgY3VycmVudGx5IHZpc2libGUgbW9kZWxzIGJ1dCBpbiAyIHNpbXBsZSBzZWN0aW9uczpcbiAgICogLSBTeXN0ZW1TY3VscHQgbW9kZWxzXG4gICAqIC0gQ3VzdG9tIHByb3ZpZGVyIG1vZGVsc1xuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJNb2RlbHMoc2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PFN5c3RlbVNjdWxwdE1vZGVsPltdKSB7XG4gICAgaWYgKCF0aGlzLm1vZGVsR3JpZCkgcmV0dXJuO1xuXG4gICAgdGhpcy5tb2RlbEdyaWQuZW1wdHkoKTtcbiAgICB0aGlzLm1vZGVsQ2FyZHMgPSBbXTtcblxuICAgIC8vIENyZWF0ZSBhIGxvb2t1cCBmb3Igc2VhcmNoTWF0Y2hlc1xuICAgIGNvbnN0IHNyTWFwID0gbmV3IE1hcChcbiAgICAgIHNlYXJjaFJlc3VsdHMubWFwKChzcikgPT4gW3NyLml0ZW0uaWQsIHNyLm1hdGNoZXMgfHwgW11dKVxuICAgICk7XG5cbiAgICAvLyBDaGVjayBsaWNlbnNlIHN0YXR1cyBvbmNlXG4gICAgY29uc3QgaGFzVmFsaWRMaWNlbnNlID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpO1xuXG4gICAgLy8gRmlyc3QsIHNlcGFyYXRlIGZhdm9yaXRlcyBmcm9tIG90aGVyIG1vZGVsc1xuICAgIGNvbnN0IGZhdm9yaXRlczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuICAgIGNvbnN0IG5vbkZhdm9yaXRlczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuXG4gICAgLy8gT25seSBwcm9jZXNzIG1vZGVscyB0aGF0IGFyZSBpbiBvdXIgc2VhcmNoIHJlc3VsdHNcbiAgICBjb25zdCB2aXNpYmxlTW9kZWxzID0gc2VhcmNoUmVzdWx0cy5tYXAoKHNyKSA9PiBzci5pdGVtKTtcbiAgICB2aXNpYmxlTW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAvLyBTa2lwIFN5c3RlbVNjdWxwdCBtb2RlbHMgaWYgbm8gdmFsaWQgbGljZW5zZVxuICAgICAgaWYgKCFoYXNWYWxpZExpY2Vuc2UgJiYgbW9kZWwucHJvdmlkZXIgPT09IFwic3lzdGVtc2N1bHB0XCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kZWwuaXNGYXZvcml0ZSkge1xuICAgICAgICBmYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub25GYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgZmF2b3JpdGVzIHNlY3Rpb24gaWYgdGhlcmUgYXJlIGFueSBmYXZvcml0ZXNcbiAgICBpZiAoZmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEFkZCBmYXZvcml0ZXMgaGVhZGVyXG4gICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLm1vZGVsR3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiLFxuICAgICAgfSk7XG4gICAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiRmF2b3JpdGVzXCIgfSk7XG5cbiAgICAgIC8vIFNvcnQgZmF2b3JpdGVzOiBTeXN0ZW1TY3VscHQgZmlyc3QsIHRoZW4gYnkgcHJvdmlkZXIgYW5kIG5hbWVcbiAgICAgIGZhdm9yaXRlcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIC8vIFN5c3RlbVNjdWxwdCBtb2RlbHMgY29tZSBmaXJzdFxuICAgICAgICBpZiAoYS5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIiAmJiBiLnByb3ZpZGVyICE9PSBcInN5c3RlbXNjdWxwdFwiKVxuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgaWYgKGEucHJvdmlkZXIgIT09IFwic3lzdGVtc2N1bHB0XCIgJiYgYi5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIilcbiAgICAgICAgICByZXR1cm4gMTtcblxuICAgICAgICAvLyBUaGVuIHNvcnQgYnkgcHJvdmlkZXJcbiAgICAgICAgaWYgKGEucHJvdmlkZXIgIT09IGIucHJvdmlkZXIpIHtcbiAgICAgICAgICByZXR1cm4gYS5wcm92aWRlci5sb2NhbGVDb21wYXJlKGIucHJvdmlkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluYWxseSBzb3J0IGJ5IG5hbWVcbiAgICAgICAgcmV0dXJuIGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gUmVuZGVyIGZhdm9yaXRlIG1vZGVsc1xuICAgICAgZmF2b3JpdGVzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBzck1hcC5nZXQobW9kZWwuaWQpIHx8IFtdO1xuICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5yZW5kZXJNb2RlbENhcmQobW9kZWwsIG1hdGNoZXMpO1xuICAgICAgICBpZiAoY2FyZCkge1xuICAgICAgICAgIHRoaXMubW9kZWxHcmlkLmFwcGVuZENoaWxkKGNhcmQpO1xuICAgICAgICAgIHRoaXMubW9kZWxDYXJkcy5wdXNoKGNhcmQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHcm91cCByZW1haW5pbmcgbW9kZWxzIGJ5IHByb3ZpZGVyXG4gICAgY29uc3QgbW9kZWxzQnlQcm92aWRlciA9IG5ldyBNYXA8c3RyaW5nLCBTeXN0ZW1TY3VscHRNb2RlbFtdPigpO1xuICAgIG5vbkZhdm9yaXRlcy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgY29uc3QgcHJvdmlkZXIgPSBtb2RlbC5wcm92aWRlcjtcbiAgICAgIGlmICghbW9kZWxzQnlQcm92aWRlci5oYXMocHJvdmlkZXIpKSB7XG4gICAgICAgIG1vZGVsc0J5UHJvdmlkZXIuc2V0KHByb3ZpZGVyLCBbXSk7XG4gICAgICB9XG4gICAgICBtb2RlbHNCeVByb3ZpZGVyLmdldChwcm92aWRlcik/LnB1c2gobW9kZWwpO1xuICAgIH0pO1xuXG4gICAgLy8gQWx3YXlzIHNob3cgU3lzdGVtU2N1bHB0IHNlY3Rpb24gZmlyc3RcbiAgICBjb25zdCBzeXN0ZW1zY3VscHRIZWFkZXIgPSB0aGlzLm1vZGVsR3JpZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIixcbiAgICB9KTtcbiAgICBzeXN0ZW1zY3VscHRIZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiU3lzdGVtU2N1bHB0IE1vZGVsc1wiIH0pO1xuXG4gICAgLy8gU2hvdyBwcm8gaW5mbyBtZXNzYWdlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgdmFsaWQgbGljZW5zZSBhbmQgdGhlcmUgYXJlIFN5c3RlbVNjdWxwdCBtb2RlbHNcbiAgICBpZiAoXG4gICAgICAhaGFzVmFsaWRMaWNlbnNlICYmXG4gICAgICBzZWFyY2hSZXN1bHRzLnNvbWUoKHNyKSA9PiBzci5pdGVtLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiKVxuICAgICkge1xuICAgICAgdGhpcy5jcmVhdGVQcm9JbmZvTWVzc2FnZSh0aGlzLm1vZGVsR3JpZCk7XG4gICAgfVxuXG4gICAgLy8gSWYgd2UgaGF2ZSBTeXN0ZW1TY3VscHQgbW9kZWxzIGFuZCBhIHZhbGlkIGxpY2Vuc2UsIHNob3cgdGhlbVxuICAgIGlmIChoYXNWYWxpZExpY2Vuc2UgJiYgbW9kZWxzQnlQcm92aWRlci5oYXMoXCJzeXN0ZW1zY3VscHRcIikpIHtcbiAgICAgIGNvbnN0IHN5c3RlbXNjdWxwdE1vZGVscyA9IG1vZGVsc0J5UHJvdmlkZXIuZ2V0KFwic3lzdGVtc2N1bHB0XCIpIHx8IFtdO1xuICAgICAgY29uc3Qgc29ydGVkU3lzdGVtc2N1bHB0TW9kZWxzID0gc3lzdGVtc2N1bHB0TW9kZWxzLnNvcnQoKGEsIGIpID0+XG4gICAgICAgIGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSlcbiAgICAgICk7XG5cbiAgICAgIHNvcnRlZFN5c3RlbXNjdWxwdE1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gc3JNYXAuZ2V0KG1vZGVsLmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyTW9kZWxDYXJkKG1vZGVsLCBtYXRjaGVzKTtcbiAgICAgICAgaWYgKGNhcmQpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsR3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgICB0aGlzLm1vZGVsQ2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIFN5c3RlbVNjdWxwdCBmcm9tIHRoZSBtYXAgc2luY2Ugd2UndmUgaGFuZGxlZCBpdFxuICAgIG1vZGVsc0J5UHJvdmlkZXIuZGVsZXRlKFwic3lzdGVtc2N1bHB0XCIpO1xuXG4gICAgLy8gUmVuZGVyIHJlbWFpbmluZyBwcm92aWRlcnNcbiAgICBjb25zdCBzb3J0ZWRQcm92aWRlcnMgPSBBcnJheS5mcm9tKG1vZGVsc0J5UHJvdmlkZXIua2V5cygpKS5zb3J0KChhLCBiKSA9PlxuICAgICAgYS5sb2NhbGVDb21wYXJlKGIpXG4gICAgKTtcblxuICAgIC8vIFJlbmRlciBlYWNoIHJlbWFpbmluZyBwcm92aWRlciBzZWN0aW9uXG4gICAgc29ydGVkUHJvdmlkZXJzLmZvckVhY2goKHByb3ZpZGVyKSA9PiB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBtb2RlbHNCeVByb3ZpZGVyLmdldChwcm92aWRlcikgfHwgW107XG5cbiAgICAgIC8vIFNraXAgZW1wdHkgcHJvdmlkZXJzXG4gICAgICBpZiAobW9kZWxzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAvLyBTb3J0IG1vZGVscyBhbHBoYWJldGljYWxseVxuICAgICAgY29uc3Qgc29ydGVkTW9kZWxzID0gbW9kZWxzLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xuXG4gICAgICAvLyBBZGQgcHJvdmlkZXIgaGVhZGVyXG4gICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLm1vZGVsR3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBwcm92aWRlck5hbWUgPSBgJHtcbiAgICAgICAgcHJvdmlkZXIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm92aWRlci5zbGljZSgxKVxuICAgICAgfSBNb2RlbHNgO1xuICAgICAgaGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBwcm92aWRlck5hbWUgfSk7XG5cbiAgICAgIC8vIFJlbmRlciBtb2RlbHMgZm9yIHRoaXMgcHJvdmlkZXJcbiAgICAgIHNvcnRlZE1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gc3JNYXAuZ2V0KG1vZGVsLmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyTW9kZWxDYXJkKG1vZGVsLCBtYXRjaGVzKTtcbiAgICAgICAgaWYgKGNhcmQpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsR3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgICB0aGlzLm1vZGVsQ2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBJZiBubyBjYXJkcyBhdCBhbGwsIHNob3cgYXBwcm9wcmlhdGUgbWVzc2FnZSBiYXNlZCBvbiBjb250ZXh0XG4gICAgaWYgKHRoaXMubW9kZWxDYXJkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICh0aGlzLnNlYXJjaElucHV0Py52YWx1ZSkge1xuICAgICAgICAvLyBJZiB0aGVyZSdzIGEgc2VhcmNoIHF1ZXJ5LCBzaG93IHRoZSBubyByZXN1bHRzIGNhcmRcbiAgICAgICAgY29uc3Qgbm9SZXN1bHRzQ2FyZCA9IHRoaXMucmVuZGVyTm9SZXN1bHRzQ2FyZCgpO1xuICAgICAgICB0aGlzLm1vZGVsR3JpZC5hcHBlbmRDaGlsZChub1Jlc3VsdHNDYXJkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIHRoZXJlJ3Mgbm8gc2VhcmNoIHF1ZXJ5IGFuZCBubyBtb2RlbHMsIHNob3cgdGhlIGN1c3RvbSBwcm92aWRlciBpbmZvXG4gICAgICAgIHRoaXMuY3JlYXRlQ3VzdG9tUHJvdmlkZXJJbmZvTWVzc2FnZSh0aGlzLm1vZGVsR3JpZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJOb1Jlc3VsdHNDYXJkKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1jYXJkXCIgfSk7XG5cbiAgICBjb25zdCBpY29uc0NvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uc1wiIH0pO1xuICAgIGNvbnN0IHNlYXJjaEljb24gPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1wcmljaW5nLWxvd1wiLFxuICAgIH0pO1xuICAgIHNldEljb24oc2VhcmNoSWNvbiwgXCJzZWFyY2hcIik7XG5cbiAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbmFtZVwiLFxuICAgICAgdGV4dDogXCJObyBtb2RlbHMgZm91bmRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogXCJObyBtb2RlbHMgbWF0Y2ggeW91ciBjdXJyZW50IHNlYXJjaCBjcml0ZXJpYS4gQ2xpY2sgaGVyZSB0byByZXNldCBhbGwgZmlsdGVycy5cIixcbiAgICB9KTtcblxuICAgIGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXRhaWxzXCIgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgICB0aGlzLnNlYXJjaElucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKFxuICAgICAgICB0aGlzLmFsbE1vZGVscy5tYXAoKG0pID0+ICh7IGl0ZW06IG0sIG1hdGNoZXM6IFtdLCBzY29yZTogMCB9KSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW9kZWxDYXJkKFxuICAgIG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNhcmQuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtbW9kZWwtY2FyZFwiO1xuICAgIGlmIChtb2RlbC5wcm92aWRlciAhPT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1tb2RlbC1jYXJkXCIpO1xuICAgIH1cbiAgICBjYXJkLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMFwiKTtcbiAgICBjYXJkLmRhdGFzZXQubW9kZWxJZCA9IG1vZGVsLmlkO1xuXG4gICAgLy8gRmF2b3JpdGUgc3RhclxuICAgIGNvbnN0IGZhdm9yaXRlQnV0dG9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LWZhdm9yaXRlLWJ1dHRvbiAke1xuICAgICAgICBtb2RlbC5pc0Zhdm9yaXRlID8gXCJpcy1mYXZvcml0ZVwiIDogXCJcIlxuICAgICAgfWAsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIFwiYXJpYS1sYWJlbFwiOiBtb2RlbC5pc0Zhdm9yaXRlXG4gICAgICAgICAgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiXG4gICAgICAgICAgOiBcIkFkZCB0byBmYXZvcml0ZXNcIixcbiAgICAgICAgcm9sZTogXCJidXR0b25cIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihmYXZvcml0ZUJ1dHRvbiwgXCJzdGFyXCIpO1xuXG4gICAgLy8gRmF2b3JpdGUgdG9nZ2xlXG4gICAgZmF2b3JpdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgaXNGYXZvcml0ZSA9ICFtb2RlbC5pc0Zhdm9yaXRlO1xuICAgICAgbW9kZWwuaXNGYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG5cbiAgICAgIGZhdm9yaXRlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpcy1mYXZvcml0ZVwiLCBpc0Zhdm9yaXRlKTtcbiAgICAgIGZhdm9yaXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcbiAgICAgICAgXCJhcmlhLWxhYmVsXCIsXG4gICAgICAgIGlzRmF2b3JpdGUgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiIDogXCJBZGQgdG8gZmF2b3JpdGVzXCJcbiAgICAgICk7XG5cbiAgICAgIC8vIEVuc3VyZSBhcnJheVxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzKSkge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9IFtdO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgb3IgcmVtb3ZlIGZyb20gc2V0dGluZ3NcbiAgICAgIGlmIChpc0Zhdm9yaXRlKSB7XG4gICAgICAgIGNvbnN0IG5ld0ZhdiA9IHsgcHJvdmlkZXI6IG1vZGVsLnByb3ZpZGVyLCBtb2RlbElkOiBtb2RlbC5pZCB9O1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLnNvbWUoXG4gICAgICAgICAgICAoZikgPT4gZi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmLnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlclxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMucHVzaChuZXdGYXYpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMuZmlsdGVyKFxuICAgICAgICAgICAgKGYpID0+ICEoZi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmLnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlcilcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgIC8vIFJlLXJlbmRlciB0byBtb3ZlIHRoZSBtb2RlbCB0byBpdHMgbmV3IHNlY3Rpb25cbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpKTtcbiAgICB9KTtcblxuICAgIC8vIFJlbmRlciBtYWluIGNvbnRlbnRcbiAgICBpZiAobW9kZWwucHJvdmlkZXIgIT09IFwic3lzdGVtc2N1bHB0XCIpIHtcbiAgICAgIC8vIEp1c3Qgc2hvdyBtb2RlbCBuYW1lIGZvciBjdXN0b20gcHJvdmlkZXJzXG4gICAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1tb2RlbC1uYW1lLWNvbnRhaW5lclwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG1vZGVsTmFtZSA9IG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tbW9kZWwtbmFtZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBwcm92aWRlciBwcmVmaXggaW4gYnJhY2tldHNcbiAgICAgIGNvbnN0IHByb3ZpZGVyUHJlZml4ID0gYFske21vZGVsLnByb3ZpZGVyLnRvVXBwZXJDYXNlKCl9XSBgO1xuICAgICAgY29uc3QgbmFtZVRleHQgPSBwcm92aWRlclByZWZpeCArIG1vZGVsLm5hbWU7XG5cbiAgICAgIG1vZGVsTmFtZS5hcHBlbmQoXG4gICAgICAgIHRoaXMuaGVscGVyLmhpZ2hsaWdodFRleHQobmFtZVRleHQsIG1hdGNoZXMsIHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTm9ybWFsIHN5c3RlbSBtb2RlbCBjYXJkXG4gICAgICBjb25zdCBpY29uc0NvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uc1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNpbXBsZSBjb3N0IGluZGljYXRvclxuICAgICAgY29uc3QgY29tcGxldGlvblByaWNlID0gcGFyc2VGbG9hdChtb2RlbC5wcmljaW5nLmNvbXBsZXRpb24pICogMV8wMDBfMDAwO1xuICAgICAgY29uc3QgcHJpY2luZ0luZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvblwiLFxuICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgXCJhcmlhLWxhYmVsXCI6IGBBcHByb3ggfiQke2NvbXBsZXRpb25QcmljZS50b0ZpeGVkKFxuICAgICAgICAgICAgMlxuICAgICAgICAgICl9IHBlciBtaWxsaW9uIHRva2Vuc2AsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHNldEljb24ocHJpY2luZ0luZGljYXRvciwgXCJ3YWxsZXRcIik7XG5cbiAgICAgIC8vIGNhcGFiaWxpdHkgaWNvbnNcbiAgICAgIGlmIChtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwiZmFzdFwiKSkge1xuICAgICAgICBjb25zdCBzcGVlZEluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1zcGVlZC1pbmRpY2F0b3JcIixcbiAgICAgICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkJsYXppbmcgZmFzdCByZXNwb25zZXNcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbihzcGVlZEluZGljYXRvciwgXCJ6YXBcIik7XG4gICAgICB9XG4gICAgICBpZiAobW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInJlYXNvbmluZ1wiKSkge1xuICAgICAgICBjb25zdCByZWFzb25JbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtcmVhc29uaW5nLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQ29tcGxleCByZWFzb25pbmdcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbihyZWFzb25JbmRpY2F0b3IsIFwiYnJhaW5cIik7XG4gICAgICB9XG4gICAgICBpZiAobW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcImNyZWF0aXZlXCIpKSB7XG4gICAgICAgIGNvbnN0IGNyZWF0aXZlSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LWNyZWF0aXZlLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQ3JlYXRpdmUgd3JpdGluZ1wiIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJY29uKGNyZWF0aXZlSW5kaWNhdG9yLCBcImJydXNoXCIpO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGVsLmFyY2hpdGVjdHVyZT8ubW9kYWxpdHkgPT09IFwidGV4dCtpbWFnZS0+dGV4dFwiKSB7XG4gICAgICAgIGNvbnN0IHZpc2lvbkluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC12aXNpb24taW5kaWNhdG9yXCIsXG4gICAgICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJWaXNpb24vaW1hZ2UgaW5wdXRcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbih2aXNpb25JbmRpY2F0b3IsIFwiZXllXCIpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW5hbWUtY29udGFpbmVyXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG1vZGVsTmFtZSA9IG5hbWVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHByb3ZpZGVyIHByZWZpeCBpbiBicmFja2V0cyBmb3IgU3lzdGVtU2N1bHB0IG1vZGVsc1xuICAgICAgY29uc3QgcHJvdmlkZXJQcmVmaXggPSBcIltTWVNURU1TQ1VMUFRdIFwiO1xuICAgICAgY29uc3QgbmFtZVRleHQgPSBwcm92aWRlclByZWZpeCArIG1vZGVsLm5hbWU7XG5cbiAgICAgIG1vZGVsTmFtZS5hcHBlbmQoXG4gICAgICAgIHRoaXMuaGVscGVyLmhpZ2hsaWdodFRleHQobmFtZVRleHQsIG1hdGNoZXMsIHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlKVxuICAgICAgKTtcblxuICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGVzY3JpcHRpb25cIixcbiAgICAgIH0pO1xuICAgICAgZGVzY3JpcHRpb24uYXBwZW5kKFxuICAgICAgICB0aGlzLmhlbHBlci5oaWdobGlnaHRUZXh0KFxuICAgICAgICAgIG1vZGVsLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIG1hdGNoZXMsXG4gICAgICAgICAgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWVcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgbW9kZWwuZGVzY3JpcHRpb24pO1xuICAgICAgZGVzY3JpcHRpb24uYWRkQ2xhc3MoXCJoYXMtdG9vbHRpcFwiKTtcblxuICAgICAgY29uc3QgZGV0YWlscyA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXRhaWxzXCIgfSk7XG4gICAgICBjb25zdCBjb250ZXh0TGVuZ3RoID0gZGV0YWlscy5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRldGFpbFwiLFxuICAgICAgfSk7XG4gICAgICBjb250ZXh0TGVuZ3RoLmNyZWF0ZVNwYW4oe1xuICAgICAgICB0ZXh0OiBcIkNvbnRleHQ6IFwiLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRldGFpbC1sYWJlbFwiLFxuICAgICAgfSk7XG4gICAgICBjb250ZXh0TGVuZ3RoLmNyZWF0ZVNwYW4oe1xuICAgICAgICB0ZXh0OiBgJHttb2RlbC5jb250ZXh0X2xlbmd0aC50b0xvY2FsZVN0cmluZygpfSB0b2tlbnNgLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRldGFpbC12YWx1ZVwiLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGNsaWNrIGhhbmRsZXJcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBJZiBjdXN0b20sIHBpY2sgdGhhdCBhcyBwcm92aWRlclxuICAgICAgY29uc3QgY3VzdG9tUHJvdmlkZXIgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMuZmluZChcbiAgICAgICAgKHApID0+IHAubmFtZS50b0xvd2VyQ2FzZSgpID09PSBtb2RlbC5wcm92aWRlci50b0xvd2VyQ2FzZSgpXG4gICAgICApO1xuICAgICAgaWYgKGN1c3RvbVByb3ZpZGVyKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyID0ge1xuICAgICAgICAgIGlkOiBjdXN0b21Qcm92aWRlci5pZCxcbiAgICAgICAgICBuYW1lOiBjdXN0b21Qcm92aWRlci5uYW1lLFxuICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlciA9IHtcbiAgICAgICAgICBpZDogXCJzeXN0ZW1zY3VscHRcIixcbiAgICAgICAgICBuYW1lOiBcIlN5c3RlbVNjdWxwdFwiLFxuICAgICAgICAgIHR5cGU6IFwibmF0aXZlXCIsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIHRoaXMub25TZWxlY3QobW9kZWwuaWQpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gS2V5Ym9hcmQgbmF2XG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLm9uU2VsZWN0KG1vZGVsLmlkKTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5tb2RlbENhcmRzLmZvckVhY2goKGMpID0+XG4gICAgICAgIGMuY2xhc3NMaXN0LnJlbW92ZShcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiKVxuICAgICAgKTtcbiAgICAgIGNhcmQuY2xhc3NMaXN0LmFkZChcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiKTtcbiAgICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBjYXJkO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICB0aGlzLmlzQ2xvc2luZyA9IHRydWU7XG4gICAgdGhpcy5jb250ZW50RWwuZW1wdHkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbGxvd3MgeW91IHRvIHByb2dyYW1tYXRpY2FsbHkgc2V0IG1vZGVscyBpZiBuZWVkZWQgKG9sZCB1c2FnZSkuXG4gICAqL1xuICBwdWJsaWMgc2V0TW9kZWxzKG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSk6IHZvaWQge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShtb2RlbHMpKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIkludmFsaWQgbW9kZWxzIGRhdGFcIiwgeyBtb2RlbHMgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuYWxsTW9kZWxzID0gbW9kZWxzO1xuICAgIGlmICh0aGlzLm1vZGVsR3JpZCkge1xuICAgICAgdGhpcy5yZW5kZXJNb2RlbHModGhpcy5nZXRWaXNpYmxlTW9kZWxzKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgdGhlIHByby1pbmZvIG1lc3NhZ2VcbiAgcHJpdmF0ZSBjcmVhdGVQcm9JbmZvTWVzc2FnZShjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgaW5mb0VsID0gY29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm9cIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBpY29uIGNvbnRhaW5lclxuICAgIGNvbnN0IGljb25Db250YWluZXIgPSBpbmZvRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbi1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGljb25Db250YWluZXIsIFwic3BhcmtsZXNcIik7XG5cbiAgICAvLyBDcmVhdGUgbWFpbiBtZXNzYWdlXG4gICAgY29uc3QgbWVzc2FnZUNvbnRhaW5lciA9IGluZm9FbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1tZXNzYWdlLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLXRpdGxlXCIsXG4gICAgICB0ZXh0OiBcIlVubG9jayBQcm8gTW9kZWxzXCIsXG4gICAgfSk7XG5cbiAgICBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tZGVzY3JpcHRpb25cIixcbiAgICAgIHRleHQ6IFwiR2V0IGluc3RhbnQgYWNjZXNzIHRvIG8zIE1pbmksIERlZXBTZWVrIFIxLCBhbmQgb3RoZXIgc3RhdGUtb2YtdGhlLWFydCBtb2RlbHMuIEFsd2F5cyB1cCB0byBkYXRlIHNvIHlvdSBkb24ndCBoYXZlIHRvIGd1ZXNzIHdoaWNoIG1vZGVsIHRvIHVzZS5cIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBidXR0b24gY29udGFpbmVyXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLWJ1dHRvbnNcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBwcm92aWRlciBidXR0b25cbiAgICBjb25zdCBhZGRQcm92aWRlckJ0biA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWluZm8tYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgYWRkUHJvdmlkZXJJY29uID0gYWRkUHJvdmlkZXJCdG4uY3JlYXRlU3BhbigpO1xuICAgIHNldEljb24oYWRkUHJvdmlkZXJJY29uLCBcInBsdXNcIik7XG4gICAgYWRkUHJvdmlkZXJCdG4uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQWRkIEEgUHJvdmlkZXJcIiB9KTtcbiAgICBhZGRQcm92aWRlckJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICB0aGlzLm9uU2VsZWN0LFxuICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICApO1xuICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIG1hbmFnZXJNb2RhbC5vcGVuKCk7XG4gICAgfSk7XG5cbiAgICAvLyBCZWNvbWUgcGF0cm9uIGJ1dHRvblxuICAgIGNvbnN0IHBhdHJvbkJ0biA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWluZm8tYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBjb25zdCBwYXRyb25JY29uID0gcGF0cm9uQnRuLmNyZWF0ZVNwYW4oKTtcbiAgICBzZXRJY29uKHBhdHJvbkljb24sIFwiaGVhcnRcIik7XG4gICAgcGF0cm9uQnRuLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkJlY29tZSBBIFBhdHJvblwiIH0pO1xuICAgIHBhdHJvbkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGluZm9FbDtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ3VzdG9tUHJvdmlkZXJJbmZvTWVzc2FnZShjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgaW5mb0VsID0gY29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm9cIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBpY29uIGNvbnRhaW5lclxuICAgIGNvbnN0IGljb25Db250YWluZXIgPSBpbmZvRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbi1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGljb25Db250YWluZXIsIFwic2VydmVyXCIpO1xuXG4gICAgLy8gQ3JlYXRlIG1haW4gbWVzc2FnZVxuICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSBpbmZvRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbWVzc2FnZS1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby10aXRsZVwiLFxuICAgICAgdGV4dDogXCJBZGQgWW91ciBPd24gTW9kZWxzXCIsXG4gICAgfSk7XG5cbiAgICBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tZGVzY3JpcHRpb25cIixcbiAgICAgIHRleHQ6IFwiR2V0IHN0YXJ0ZWQgYnkgYWRkaW5nIHlvdXIgb3duIGN1c3RvbSBwcm92aWRlciBsaWtlIE9sbGFtYSwgTE0gU3R1ZGlvLCBvciBPcGVuQUkuIFlvdSBjYW4gdXNlIHlvdXIgb3duIG1vZGVscyBvciBjb25uZWN0IHRvIG90aGVyIEFJIHNlcnZpY2VzLlwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGJ1dHRvbiBjb250YWluZXJcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tYnV0dG9uc1wiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGJ1dHRvblxuICAgIGNvbnN0IGFkZFByb3ZpZGVyQnRuID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5mby1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGFkZFByb3ZpZGVySWNvbiA9IGFkZFByb3ZpZGVyQnRuLmNyZWF0ZVNwYW4oKTtcbiAgICBzZXRJY29uKGFkZFByb3ZpZGVySWNvbiwgXCJwbHVzXCIpO1xuICAgIGFkZFByb3ZpZGVyQnRuLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkFkZCBBIFByb3ZpZGVyXCIgfSk7XG4gICAgYWRkUHJvdmlkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICBjb25zdCBtYW5hZ2VyTW9kYWwgPSBuZXcgQ3VzdG9tUHJvdmlkZXJNYW5hZ2VyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICAgICAgdGhpcy5vblNlbGVjdCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgKTtcbiAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBtYW5hZ2VyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGluZm9FbDtcbiAgfVxufVxuIiwgImV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoYWJsZUZpZWxkIHtcbiAgZmllbGQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgd2VpZ2h0OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoTWF0Y2gge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIGluZGljZXM6IG51bWJlcltdO1xuICBtYXRjaFF1YWxpdHk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hSZXN1bHQ8VD4ge1xuICBpdGVtOiBUO1xuICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdO1xuICBzY29yZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFVJT3B0aW9uczxUPiB7XG4gIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudDtcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIGdldEl0ZW1UaXRsZTogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgZ2V0SXRlbURlc2NyaXB0aW9uPzogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgZ2V0SXRlbUJhZGdlPzogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgZ2V0SXRlbUNvbnRleHQ/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtTWV0YT86IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIG9uU2VsZWN0OiAoaXRlbTogVCkgPT4gdm9pZDtcbiAgaW5pdGlhbFF1ZXJ5Pzogc3RyaW5nO1xuICBpbml0aWFsUmVzdWx0c0xpbWl0PzogbnVtYmVyO1xuICBtYXhGaWx0ZXJlZFJlc3VsdHM/OiBudW1iZXI7XG4gIGVtcHR5U3RhdGVUZXh0Pzogc3RyaW5nO1xuICBpc0xvYWRpbmc/OiBib29sZWFuO1xuICBsb2FkaW5nU3RhdGVUZXh0Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgU2VhcmNoU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9JTklUSUFMX1JFU1VMVFNfTElNSVQgPSAyNTtcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX01BWF9GSUxURVJFRF9SRVNVTFRTID0gNTA7XG5cbiAgcHVibGljIHNlYXJjaDxUPihcbiAgICBpdGVtczogVFtdLFxuICAgIHF1ZXJ5OiBzdHJpbmcsXG4gICAgZ2V0U2VhcmNoYWJsZUZpZWxkczogKGl0ZW06IFQpID0+IFNlYXJjaGFibGVGaWVsZFtdLFxuICAgIG9wdGlvbnM/OiB7IGluaXRpYWxSZXN1bHRzTGltaXQ/OiBudW1iZXI7IG1heEZpbHRlcmVkUmVzdWx0cz86IG51bWJlciB9XG4gICk6IFNlYXJjaFJlc3VsdDxUPltdIHtcbiAgICBjb25zdCBpbml0aWFsTGltaXQgPVxuICAgICAgb3B0aW9ucz8uaW5pdGlhbFJlc3VsdHNMaW1pdCA/PyB0aGlzLkRFRkFVTFRfSU5JVElBTF9SRVNVTFRTX0xJTUlUO1xuICAgIGNvbnN0IG1heEZpbHRlcmVkID1cbiAgICAgIG9wdGlvbnM/Lm1heEZpbHRlcmVkUmVzdWx0cyA/PyB0aGlzLkRFRkFVTFRfTUFYX0ZJTFRFUkVEX1JFU1VMVFM7XG5cbiAgICAvLyBJZiBubyBxdWVyeSwgcmV0dXJuIGluaXRpYWwgaXRlbXMgd2l0aCBubyBtYXRjaGVzXG4gICAgaWYgKCFxdWVyeS50cmltKCkpIHtcbiAgICAgIHJldHVybiBpdGVtcy5zbGljZSgwLCBpbml0aWFsTGltaXQpLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAgICAgaXRlbSxcbiAgICAgICAgbWF0Y2hlczogW10sXG4gICAgICAgIHNjb3JlOiAwLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8vIFNwbGl0IHF1ZXJ5IGludG8gdGVybXNcbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICBjb25zdCBzZWFyY2hSZXN1bHRzID0gaXRlbXMubWFwKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBnZXRTZWFyY2hhYmxlRmllbGRzKGl0ZW0pO1xuICAgICAgY29uc3QgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdO1xuICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuXG4gICAgICBmaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgaWYgKCFmaWVsZC50ZXh0KSByZXR1cm47XG4gICAgICAgIGNvbnN0IGZpZWxkVGV4dCA9IGZpZWxkLnRleHQ7XG4gICAgICAgIGNvbnN0IGZpZWxkVGV4dExvd2VyID0gZmllbGRUZXh0LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYWxsIHRlcm1zIGV4aXN0IGluIHRoaXMgZmllbGQgZmlyc3RcbiAgICAgICAgY29uc3QgYWxsVGVybXNGb3VuZCA9IHNlYXJjaFRlcm1zLmV2ZXJ5KCh0ZXJtKSA9PlxuICAgICAgICAgIGZpZWxkVGV4dExvd2VyLmluY2x1ZGVzKHRlcm0pXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGFsbFRlcm1zRm91bmQpIHtcbiAgICAgICAgICAvLyBGaW5kIG1hdGNoZXMgZm9yIGVhY2ggdGVybVxuICAgICAgICAgIHNlYXJjaFRlcm1zLmZvckVhY2goKHRlcm0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGhpcy5maW5kTWF0Y2hlcyhmaWVsZFRleHQsIHRlcm0pO1xuICAgICAgICAgICAgaWYgKG1hdGNoLmluZGljZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZC5maWVsZCxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmaWVsZFRleHQsXG4gICAgICAgICAgICAgICAgaW5kaWNlczogbWF0Y2guaW5kaWNlcyxcbiAgICAgICAgICAgICAgICBtYXRjaFF1YWxpdHk6IG1hdGNoLnF1YWxpdHksXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGxldCBzY29yZSA9IGZpZWxkLndlaWdodCAqIG1hdGNoLnF1YWxpdHk7XG5cbiAgICAgICAgICAgICAgLy8gQWRkIHByb3hpbWl0eSBib251cyBpZiB3ZSBoYXZlIG11bHRpcGxlIHRlcm1zXG4gICAgICAgICAgICAgIGlmIChzZWFyY2hUZXJtcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVybVBvc2l0aW9ucyA9IHNlYXJjaFRlcm1zLm1hcCgodCkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gZmllbGRUZXh0TG93ZXIuaW5kZXhPZih0KTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBpZHggPj0gMCA/IGlkeCA6IEluZmluaXR5O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgbWF4RGlzdGFuY2UgPVxuICAgICAgICAgICAgICAgICAgTWF0aC5tYXgoLi4udGVybVBvc2l0aW9ucykgLVxuICAgICAgICAgICAgICAgICAgTWF0aC5taW4oLi4udGVybVBvc2l0aW9ucy5maWx0ZXIoKHApID0+IHAgIT09IEluZmluaXR5KSk7XG4gICAgICAgICAgICAgICAgaWYgKG1heERpc3RhbmNlIDwgNTApIHtcbiAgICAgICAgICAgICAgICAgIHNjb3JlICo9IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIG1hdGNoZXMsXG4gICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIEZpbHRlciBvdXQgaXRlbXMgd2l0aCBubyBtYXRjaGVzXG4gICAgY29uc3QgdmFsaWRSZXN1bHRzID0gc2VhcmNoUmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5tYXRjaGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAvLyBFbnN1cmUgd2UgaGF2ZSBtYXRjaGVzIGZvciBhbGwgdGVybXNcbiAgICAgIGNvbnN0IGZvdW5kVGVybXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgIHJlc3VsdC5tYXRjaGVzLmZvckVhY2goKG1hdGNoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBtYXRjaC50ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHNlYXJjaFRlcm1zLmZvckVhY2goKHRlcm0pID0+IHtcbiAgICAgICAgICBpZiAodGV4dC5pbmNsdWRlcyh0ZXJtKSkgZm91bmRUZXJtcy5hZGQodGVybSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBmb3VuZFRlcm1zLnNpemUgPT09IHNlYXJjaFRlcm1zLmxlbmd0aDtcbiAgICB9KTtcblxuICAgIHJldHVybiB2YWxpZFJlc3VsdHMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpLnNsaWNlKDAsIG1heEZpbHRlcmVkKTtcbiAgfVxuXG4gIHByaXZhdGUgZmluZE1hdGNoZXMoXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHF1ZXJ5OiBzdHJpbmdcbiAgKTogeyBpbmRpY2VzOiBudW1iZXJbXTsgcXVhbGl0eTogbnVtYmVyIH0ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRUZXh0ID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIGNvbnN0IGluZGljZXM6IG51bWJlcltdID0gW107XG4gICAgbGV0IHF1YWxpdHkgPSAwO1xuXG4gICAgLy8gRm9yIHNpbmdsZSBjaGFyYWN0ZXIgcXVlcmllcywgb25seSBtYXRjaCB3b3JkIGJvdW5kYXJpZXNcbiAgICBpZiAobm9ybWFsaXplZFF1ZXJ5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBcXFxcYiR7bm9ybWFsaXplZFF1ZXJ5fVxcXFxiYCwgXCJnaVwiKTtcbiAgICAgIGxldCBtYXRjaDtcbiAgICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgICBpbmRpY2VzLnB1c2gobWF0Y2guaW5kZXgpO1xuICAgICAgICBxdWFsaXR5ID0gMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IGluZGljZXMsIHF1YWxpdHkgfTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIGFsbCBvY2N1cnJlbmNlcyBvZiB0aGUgcXVlcnkgaW4gdGhlIHRleHRcbiAgICBsZXQgcG9zID0gMDtcbiAgICB3aGlsZSAoKHBvcyA9IG5vcm1hbGl6ZWRUZXh0LmluZGV4T2Yobm9ybWFsaXplZFF1ZXJ5LCBwb3MpKSAhPT0gLTEpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSB3b3JkIGJvdW5kYXJ5IG1hdGNoXG4gICAgICBjb25zdCBiZWZvcmVDaGFyID0gcG9zID4gMCA/IG5vcm1hbGl6ZWRUZXh0W3BvcyAtIDFdIDogXCIgXCI7XG4gICAgICBjb25zdCBhZnRlckNoYXIgPVxuICAgICAgICBwb3MgKyBub3JtYWxpemVkUXVlcnkubGVuZ3RoIDwgbm9ybWFsaXplZFRleHQubGVuZ3RoXG4gICAgICAgICAgPyBub3JtYWxpemVkVGV4dFtwb3MgKyBub3JtYWxpemVkUXVlcnkubGVuZ3RoXVxuICAgICAgICAgIDogXCIgXCI7XG5cbiAgICAgIGlmIChcbiAgICAgICAgKC9cXHMvLnRlc3QoYmVmb3JlQ2hhcikgfHwgL1xcVy8udGVzdChiZWZvcmVDaGFyKSB8fCBwb3MgPT09IDApICYmXG4gICAgICAgICgvXFxzLy50ZXN0KGFmdGVyQ2hhcikgfHxcbiAgICAgICAgICAvXFxXLy50ZXN0KGFmdGVyQ2hhcikgfHxcbiAgICAgICAgICBwb3MgKyBub3JtYWxpemVkUXVlcnkubGVuZ3RoID09PSBub3JtYWxpemVkVGV4dC5sZW5ndGgpXG4gICAgICApIHtcbiAgICAgICAgLy8gUGVyZmVjdCB3b3JkIGJvdW5kYXJ5IG1hdGNoXG4gICAgICAgIHF1YWxpdHkgPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUGFydGlhbCBtYXRjaFxuICAgICAgICBxdWFsaXR5ID0gMC44O1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgYWxsIGluZGljZXMgZm9yIHRoaXMgbWF0Y2hcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9ybWFsaXplZFF1ZXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGluZGljZXMucHVzaChwb3MgKyBpKTtcbiAgICAgIH1cblxuICAgICAgcG9zICs9IDE7IC8vIE1vdmUgcGFzdCBjdXJyZW50IG1hdGNoIHRvIGZpbmQgbmV4dFxuICAgIH1cblxuICAgIHJldHVybiB7IGluZGljZXM6IFsuLi5uZXcgU2V0KGluZGljZXMpXS5zb3J0KChhLCBiKSA9PiBhIC0gYiksIHF1YWxpdHkgfTtcbiAgfVxuXG4gIHB1YmxpYyBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW10sXG4gICAgc2VhcmNoUXVlcnk/OiBzdHJpbmdcbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwIHx8ICFzZWFyY2hRdWVyeSkge1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICAvLyBVc2UgdGhlIGFjdHVhbCBzZWFyY2ggcXVlcnkgZm9yIGhpZ2hsaWdodGluZ1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHNlYXJjaFF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gICAgLy8gVXNlIHJlZ2V4IHRvIGZpbmQgd2hvbGUgd29yZCBvciBwaHJhc2UgbWF0Y2hlc1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7bm9ybWFsaXplZFF1ZXJ5fSlgLCBcImdpXCIpO1xuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaDtcblxuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgLy8gQWRkIG5vbi1oaWdobGlnaHRlZCB0ZXh0IGJlZm9yZSBtYXRjaFxuICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKFxuICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc2xpY2UobGFzdEluZGV4LCBtYXRjaC5pbmRleCkpXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCBtYXRjaFxuICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgc3Bhbi5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1zZWFyY2gtaGlnaGxpZ2h0XCI7XG4gICAgICBzcGFuLnRleHRDb250ZW50ID0gbWF0Y2hbMF07XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzcGFuKTtcblxuICAgICAgbGFzdEluZGV4ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlbWFpbmluZyB0ZXh0XG4gICAgaWYgKGxhc3RJbmRleCA8IHRleHQubGVuZ3RoKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cbn1cbiIsICJpbXBvcnQge1xuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyxcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG59IGZyb20gXCIuLi90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IFNlYXJjaE1hdGNoIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBUaWVySW5mbyB7XG4gIG5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjb25zdCBUSUVSX0lORk86IHsgW2tleTogc3RyaW5nXTogVGllckluZm8gfSA9IHtcbiAgZmF2b3JpdGVzOiB7XG4gICAgbmFtZTogXCJGYXZvcml0ZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJZb3VyIGZhdm9yaXRlIG1vZGVscyBmb3IgcXVpY2sgYWNjZXNzXCIsXG4gICAgY2xhc3NOYW1lOiBcImZhdm9yaXRlXCIsXG4gIH0sXG4gIGVzc2VudGlhbDoge1xuICAgIG5hbWU6IFwiRXNzZW50aWFsXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIkJ1ZGdldC1mcmllbmRseSwgZ3JlYXQgZm9yIGRhaWx5IHRhc2tzLCBpbmNsdWRlcyB2aXNpb24gYW5kIHJlYXNvbmluZyBjYXBhYmlsaXRpZXMsIGV4Y2VsbGVudCB2YWx1ZVwiLFxuICAgIGNsYXNzTmFtZTogXCJlc3NlbnRpYWxcIixcbiAgfSxcbiAgYWR2YW5jZWQ6IHtcbiAgICBuYW1lOiBcIkFkdmFuY2VkXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIkJhbGFuY2VkIHBlcmZvcm1hbmNlLCBlbmhhbmNlZCBjYXBhYmlsaXRpZXMsIGlkZWFsIGZvciBjb21wbGV4IHRhc2tzLCBlZmZpY2llbnQgcmVzb3VyY2UgdXNhZ2VcIixcbiAgICBjbGFzc05hbWU6IFwiYWR2YW5jZWRcIixcbiAgfSxcbiAgcHJvZmVzc2lvbmFsOiB7XG4gICAgbmFtZTogXCJQcm9mZXNzaW9uYWxcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiTWF4aW11bSBwZXJmb3JtYW5jZSwgYWR2YW5jZWQgZmVhdHVyZXMsIHNwZWNpYWxpemVkIHdvcmtmbG93cywgZW50ZXJwcmlzZS1ncmFkZSBjYXBhYmlsaXRpZXNcIixcbiAgICBjbGFzc05hbWU6IFwicHJvZmVzc2lvbmFsXCIsXG4gIH0sXG4gIGN1c3RvbToge1xuICAgIG5hbWU6IFwiQ3VzdG9tIE1vZGVsc1wiLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgXCJZb3VyIHBlcnNvbmFsbHkgY29uZmlndXJlZCBtb2RlbHMgZnJvbSBjdXN0b20gcHJvdmlkZXJzLCBhbGxvd2luZyBmdWxsIGNvbnRyb2wgb3ZlciBtb2RlbCBzZWxlY3Rpb25cIixcbiAgICBjbGFzc05hbWU6IFwiY3VzdG9tXCIsXG4gIH0sXG4gIC8vIEZhbGxiYWNrIGZvciBhbnkgdW5rbm93biB0aWVyXG4gIGRlZmF1bHQ6IHtcbiAgICBuYW1lOiBcIk1vZGVsc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkF2YWlsYWJsZSBtb2RlbHNcIixcbiAgICBjbGFzc05hbWU6IFwiZGVmYXVsdFwiLFxuICB9LFxufTtcblxuZXhwb3J0IGNsYXNzIE1vZGVsU2VsZWN0aW9uSGVscGVyIHtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgZmlsdGVyU2V0dGluZ3M6IE1vZGVsRmlsdGVyU2V0dGluZ3M7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmxvZ2dlciA9IGNvbnNvbGU7XG4gICAgLy8gSW5pdGlhbGl6ZSB3aXRoIHNhdmVkIHNldHRpbmdzIG9yIGRlZmF1bHRzXG4gICAgdGhpcy5maWx0ZXJTZXR0aW5ncyA9IHsgLi4udGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxGaWx0ZXJTZXR0aW5ncyB9O1xuICB9XG5cbiAgZ2V0RmlsdGVyU2V0dGluZ3MoKTogTW9kZWxGaWx0ZXJTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyU2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyBzZXRGaWx0ZXJTZXR0aW5nKGtleToga2V5b2YgTW9kZWxGaWx0ZXJTZXR0aW5ncywgdmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzW2tleV0gPSB2YWx1ZTtcbiAgICAvLyBVcGRhdGUgcGx1Z2luIHNldHRpbmdzIGFuZCBzYXZlXG4gICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxGaWx0ZXJTZXR0aW5ncyA9IHsgLi4udGhpcy5maWx0ZXJTZXR0aW5ncyB9O1xuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICB9XG5cbiAgYXN5bmMgcmVzZXRGaWx0ZXJTZXR0aW5ncygpIHtcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzID0geyAuLi5ERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyB9O1xuICAgIC8vIFVwZGF0ZSBwbHVnaW4gc2V0dGluZ3MgYW5kIHNhdmVcbiAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLmZpbHRlclNldHRpbmdzIH07XG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBmb3JtYXRQcmljZShwcmljZTogbnVtYmVyIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICB0cnkge1xuICAgICAgaWYgKHByaWNlID09PSBudWxsIHx8IHByaWNlID09PSB1bmRlZmluZWQgfHwgcHJpY2UgPT09IFwiMFwiKSB7XG4gICAgICAgIHJldHVybiBcIkZyZWVcIjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbnVtZXJpY1ByaWNlID1cbiAgICAgICAgdHlwZW9mIHByaWNlID09PSBcInN0cmluZ1wiID8gcGFyc2VGbG9hdChwcmljZSkgOiBwcmljZTtcblxuICAgICAgaWYgKGlzTmFOKG51bWVyaWNQcmljZSkgfHwgbnVtZXJpY1ByaWNlID09PSAwKSB7XG4gICAgICAgIHJldHVybiBcIkZyZWVcIjtcbiAgICAgIH1cblxuICAgICAgLy8gTXVsdGlwbHkgYnkgMSwwMDAsMDAwIHRvIGNvbnZlcnQgZnJvbSBwZXIgdG9rZW4gdG8gcGVyIDFNIHRva2Vuc1xuICAgICAgY29uc3QgcHJpY2VQZXJNaWxsaW9uID0gbnVtZXJpY1ByaWNlICogMTAwMDAwMDtcblxuICAgICAgLy8gQWx3YXlzIHNob3cgZXhhY3RseSAyIGRlY2ltYWwgcGxhY2VzXG4gICAgICByZXR1cm4gYCQke3ByaWNlUGVyTWlsbGlvbi50b0ZpeGVkKDIpfWA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGZvcm1hdHRpbmcgcHJpY2VcIiwge1xuICAgICAgICBwcmljZSxcbiAgICAgICAgZXJyb3IsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBcIlByaWNlIGVycm9yXCI7XG4gICAgfVxuICB9XG5cbiAgaGlnaGxpZ2h0VGV4dChcbiAgICB0ZXh0OiBzdHJpbmcsXG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdLFxuICAgIHNlYXJjaFF1ZXJ5Pzogc3RyaW5nXG4gICk6IERvY3VtZW50RnJhZ21lbnQge1xuICAgIGlmICghbWF0Y2hlcyB8fCBtYXRjaGVzLmxlbmd0aCA9PT0gMCB8fCAhc2VhcmNoUXVlcnkpIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgZnJhZ21lbnQudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHNlYXJjaFF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gICAgLy8gVXNlIHJlZ2V4IHRvIGZpbmQgd2hvbGUgd29yZCBvciBwaHJhc2UgbWF0Y2hlc1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7bm9ybWFsaXplZFF1ZXJ5fSlgLCBcImdpXCIpO1xuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaDtcblxuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgLy8gQWRkIG5vbi1oaWdobGlnaHRlZCB0ZXh0IGJlZm9yZSBtYXRjaFxuICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgIGNvbnN0IHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXG4gICAgICAgICAgdGV4dC5zbGljZShsYXN0SW5kZXgsIG1hdGNoLmluZGV4KVxuICAgICAgICApO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCBtYXRjaFxuICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgc3Bhbi5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1tb2RlbC1oaWdobGlnaHRcIjtcbiAgICAgIHNwYW4udGV4dENvbnRlbnQgPSBtYXRjaFswXTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNwYW4pO1xuXG4gICAgICBsYXN0SW5kZXggPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zbGljZShsYXN0SW5kZXgpKTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBzb3J0TW9kZWxzKG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSk6IFN5c3RlbVNjdWxwdE1vZGVsW10ge1xuICAgIC8vIENyZWF0ZSB0aWVyIGdyb3VwcyBpbmNsdWRpbmcgZmF2b3JpdGVzXG4gICAgY29uc3QgdGllcnMgPSB7XG4gICAgICBmYXZvcml0ZXM6IFtdIGFzIFN5c3RlbVNjdWxwdE1vZGVsW10sXG4gICAgICBlc3NlbnRpYWw6IFtdIGFzIFN5c3RlbVNjdWxwdE1vZGVsW10sXG4gICAgICBhZHZhbmNlZDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIHByb2Zlc3Npb25hbDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGN1c3RvbTogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICB9O1xuXG4gICAgLy8gRmlyc3QgcGFzczogZGlzdHJpYnV0ZSBtb2RlbHMgdG8gdGhlaXIgcmVzcGVjdGl2ZSB0aWVyc1xuICAgIG1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgLy8gRmF2b3JpdGVkIG1vZGVscyBPTkxZIGdvIHRvIGZhdm9yaXRlcyB0aWVyXG4gICAgICBpZiAobW9kZWwuaXNGYXZvcml0ZSkge1xuICAgICAgICB0aWVycy5mYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICAgIHJldHVybjsgLy8gU2tpcCBhZGRpbmcgdG8gb3RoZXIgdGllcnNcbiAgICAgIH1cblxuICAgICAgLy8gTm9uLWZhdm9yaXRlcyBnbyB0byB0aGVpciByZXNwZWN0aXZlIHRpZXJzXG4gICAgICBpZiAobW9kZWwucHJvdmlkZXIgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgdGllcnMuY3VzdG9tLnB1c2gobW9kZWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNvcnQgbW9kZWxzIHdpdGhpbiBlYWNoIHRpZXIgYnkgbmFtZVxuICAgIE9iamVjdC52YWx1ZXModGllcnMpLmZvckVhY2goKHRpZXJNb2RlbHMpID0+IHtcbiAgICAgIHRpZXJNb2RlbHMuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG4gICAgfSk7XG5cbiAgICAvLyBDb21iaW5lIHRpZXJzIGluIHRoZSBjb3JyZWN0IG9yZGVyLCBvbmx5IGluY2x1ZGluZyBub24tZW1wdHkgdGllcnNcbiAgICBjb25zdCBzb3J0ZWRNb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcblxuICAgIC8vIEZhdm9yaXRlcyBhbHdheXMgZmlyc3QgKGlmIGFueSBleGlzdClcbiAgICBpZiAodGllcnMuZmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmZhdm9yaXRlcyk7XG4gICAgfVxuXG4gICAgLy8gVGhlbiB0aGUgc3RhbmRhcmQgdGllcnMgaW4gb3JkZXJcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5lc3NlbnRpYWwpO1xuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmFkdmFuY2VkKTtcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5wcm9mZXNzaW9uYWwpO1xuXG4gICAgLy8gQ3VzdG9tIG1vZGVscyBsYXN0XG4gICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuY3VzdG9tKTtcblxuICAgIHJldHVybiBzb3J0ZWRNb2RlbHM7XG4gIH1cblxuICBmaWx0ZXJNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogU3lzdGVtU2N1bHB0TW9kZWxbXSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBtb2RlbHMuZmlsdGVyKChtb2RlbCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGhhc1Zpc2lvbkNhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInZpc2lvblwiKSB8fCBmYWxzZTtcbiAgICAgICAgICBjb25zdCBoYXNSZWFzb25pbmdDYXBhYmlsaXR5ID1cbiAgICAgICAgICAgIG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJyZWFzb25pbmdcIikgfHwgZmFsc2U7XG4gICAgICAgICAgY29uc3QgaGFzQ3JlYXRpdmVDYXBhYmlsaXR5ID1cbiAgICAgICAgICAgIG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJjcmVhdGl2ZVwiKSB8fCBmYWxzZTtcblxuICAgICAgICAgIC8vIElmIG5vIGZpbHRlcnMgYXJlIGFjdGl2ZSwgc2hvdyBhbGwgbW9kZWxzXG4gICAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKHRoaXMuZmlsdGVyU2V0dGluZ3MpLnNvbWUoKHZhbHVlKSA9PiB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENoZWNrIGVhY2ggYWN0aXZlIGZpbHRlclxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAoIXRoaXMuZmlsdGVyU2V0dGluZ3Muc2hvd1Zpc2lvbk1vZGVscyB8fCBoYXNWaXNpb25DYXBhYmlsaXR5KSAmJlxuICAgICAgICAgICAgKCF0aGlzLmZpbHRlclNldHRpbmdzLnNob3dSZWFzb25pbmdNb2RlbHMgfHxcbiAgICAgICAgICAgICAgaGFzUmVhc29uaW5nQ2FwYWJpbGl0eSkgJiZcbiAgICAgICAgICAgICghdGhpcy5maWx0ZXJTZXR0aW5ncy5zaG93Q3JlYXRpdmVNb2RlbHMgfHwgaGFzQ3JlYXRpdmVDYXBhYmlsaXR5KVxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICBcIk1vZGVsU2VsZWN0aW9uSGVscGVyOiBFcnJvciBmaWx0ZXJpbmcgaW5kaXZpZHVhbCBtb2RlbFwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIk1vZGVsU2VsZWN0aW9uSGVscGVyOiBFcnJvciBpbiBmaWx0ZXJNb2RlbHNcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG1vZGVscztcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBOb3RpY2UsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcInNyYy9tYWluXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlciB9IGZyb20gXCJzcmMvdHlwZXMvbGxtXCI7XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgb25CYWNrOiAoKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgb25CYWNrOiAoKSA9PiB2b2lkKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmxvZ2dlciA9IGNvbnNvbGU7XG4gICAgdGhpcy5vbkJhY2sgPSBvbkJhY2s7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByb3ZpZGVyQ2FyZChwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIsIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBjYXJkID0gY29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZFwiKTtcblxuICAgIC8vIEhlYWRlciB3aXRoIG5hbWUgYW5kIGFjdGlvbnNcbiAgICBjb25zdCBoZWFkZXIgPSBjYXJkLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1oZWFkZXJcIik7XG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwiaDNcIiwge1xuICAgICAgdGV4dDogcHJvdmlkZXIubmFtZSxcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtbmFtZVwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWN0aW9ucyA9IGhlYWRlci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gRGVsZXRlIGJ1dHRvblxuICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1hY3Rpb24gZGVsZXRlXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihkZWxldGVCdG4sIFwidHJhc2gtMlwiKTtcbiAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAvLyBSZW1vdmUgcHJvdmlkZXJcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycyA9XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maWx0ZXIoXG4gICAgICAgICAgKHApID0+IHAuaWQgIT09IHByb3ZpZGVyLmlkXG4gICAgICAgICk7XG5cbiAgICAgIC8vIFNhdmUgc2V0dGluZ3NcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAvLyBHZXQgZnJlc2ggbW9kZWxzIGFuZCB1cGRhdGUgVUlcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcblxuICAgICAgLy8gUmUtcmVuZGVyIGxpc3RcbiAgICAgIHRoaXMucmVuZGVyUHJvdmlkZXJMaXN0KCk7XG4gICAgfSk7XG5cbiAgICAvLyBEZXRhaWxzIHNlY3Rpb25cbiAgICBjb25zdCBkZXRhaWxzID0gY2FyZC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtZGV0YWlsc1wiKTtcblxuICAgIC8vIFR5cGVcbiAgICBjb25zdCB0eXBlRGV0YWlsID0gZGV0YWlscy5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1kZXRhaWxcIlxuICAgICk7XG4gICAgc2V0SWNvbih0eXBlRGV0YWlsLmNyZWF0ZVNwYW4oKSwgXCJib3hcIik7XG4gICAgdHlwZURldGFpbC5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IFwiT3BlbkFJIENvbXBhdGlibGVcIixcbiAgICB9KTtcblxuICAgIC8vIEVuZHBvaW50XG4gICAgY29uc3QgZW5kcG9pbnREZXRhaWwgPSBkZXRhaWxzLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbFwiXG4gICAgKTtcbiAgICBzZXRJY29uKGVuZHBvaW50RGV0YWlsLmNyZWF0ZVNwYW4oKSwgXCJsaW5rXCIpO1xuICAgIGVuZHBvaW50RGV0YWlsLmNyZWF0ZVNwYW4oeyB0ZXh0OiBwcm92aWRlci5lbmRwb2ludCB9KTtcblxuICAgIC8vIFN0YXR1c1xuICAgIGNvbnN0IHN0YXR1c0RldGFpbCA9IGRldGFpbHMuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtZGV0YWlsXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHRvZ2dsZSBjb250YWluZXJcbiAgICBjb25zdCB0b2dnbGVDb250YWluZXIgPSBzdGF0dXNEZXRhaWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXRvZ2dsZS1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBsYWJlbFxuICAgIHRvZ2dsZUNvbnRhaW5lci5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IHByb3ZpZGVyLmlzRW5hYmxlZCA/IFwiRW5hYmxlZFwiIDogXCJEaXNhYmxlZFwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItdG9nZ2xlLWxhYmVsXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgdG9nZ2xlIHN3aXRjaFxuICAgIGNvbnN0IHRvZ2dsZSA9IHRvZ2dsZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBgY2hlY2tib3gtY29udGFpbmVyICR7cHJvdmlkZXIuaXNFbmFibGVkID8gXCJpcy1lbmFibGVkXCIgOiBcIlwifWAsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgdGhlIHRvZ2dsZSB0cmFjayBhbmQgdGh1bWJcbiAgICB0b2dnbGUuY3JlYXRlRGl2KHsgY2xzOiBcImNoZWNrYm94LXRvZ2dsZVwiIH0pO1xuXG4gICAgLy8gQWRkIGNsaWNrIGhhbmRsZXIgZm9yIHN0YXR1cyB0b2dnbGVcbiAgICB0b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAvLyBJZiBhbHJlYWR5IGVuYWJsZWQsIGp1c3QgZGlzYWJsZVxuICAgICAgaWYgKHByb3ZpZGVyLmlzRW5hYmxlZCkge1xuICAgICAgICBwcm92aWRlci5pc0VuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgdGhpcy5yZW5kZXJQcm92aWRlckxpc3QoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBlbmFibGluZywgdGVzdCBjb25uZWN0aW9uIGZpcnN0XG4gICAgICB0b2dnbGUuYWRkQ2xhc3MoXCJ0ZXN0aW5nXCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wbHVnaW4uY3VzdG9tUHJvdmlkZXJTZXJ2aWNlLnRlc3RDb25uZWN0aW9uKFxuICAgICAgICBwcm92aWRlclxuICAgICAgKTtcbiAgICAgIHRvZ2dsZS5yZW1vdmVDbGFzcyhcInRlc3RpbmdcIik7XG5cbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBwcm92aWRlci5pc0VuYWJsZWQgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvciBub3RpY2VcbiAgICAgICAgbmV3IE5vdGljZShcbiAgICAgICAgICBgRmFpbGVkIHRvIGVuYWJsZSAke3Byb3ZpZGVyLm5hbWV9OiAke1xuICAgICAgICAgICAgcmVzdWx0LmVycm9yIHx8IFwiQ29ubmVjdGlvbiBmYWlsZWRcIlxuICAgICAgICAgIH1gLFxuICAgICAgICAgIDUwMDBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvdmlkZXJMaXN0KCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgLy8gQ2xlYXIgZXhpc3RpbmcgY29udGVudFxuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1tb2RhbFwiKTtcblxuICAgIC8vIENyZWF0ZSBoZWFkZXIgd2l0aCBiYWNrIGJ1dHRvblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1oZWFkZXJcIlxuICAgICk7XG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJhY2tcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGJhY2tCdXR0b24uY3JlYXRlU3BhbigpLCBcImFycm93LWxlZnRcIik7XG4gICAgYmFja0J1dHRvbi5jcmVhdGVTcGFuKHsgdGV4dDogXCJCYWNrIHRvIE1vZGVsc1wiIH0pO1xuXG4gICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIGhlYWRlci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDdXN0b20gUHJvdmlkZXJzXCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXJcbiAgICBjb25zdCBjb250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGNvbnRlbnQuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItbGlzdFwiXG4gICAgKTtcblxuICAgIC8vIEdldCBwcm92aWRlcnMgZnJvbSBzZXR0aW5nc1xuICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycztcblxuICAgIGlmIChwcm92aWRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBTaG93IGVtcHR5IHN0YXRlXG4gICAgICBjb25zdCBlbXB0eVN0YXRlID0gbGlzdENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWVtcHR5XCJcbiAgICAgICk7XG4gICAgICBjb25zdCBlbXB0eUljb24gPSBlbXB0eVN0YXRlLmNyZWF0ZURpdihcbiAgICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItZW1wdHktaWNvblwiXG4gICAgICApO1xuICAgICAgc2V0SWNvbihlbXB0eUljb24sIFwic2VydmVyLW9mZlwiKTtcbiAgICAgIGVtcHR5U3RhdGUuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1lbXB0eS10ZXh0XCIsXG4gICAgICAgIHRleHQ6IFwiTm8gY3VzdG9tIHByb3ZpZGVycyBhZGRlZCB5ZXRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZW5kZXIgcHJvdmlkZXIgY2FyZHNcbiAgICAgIHByb3ZpZGVycy5mb3JFYWNoKChwcm92aWRlcikgPT4ge1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyQ2FyZChwcm92aWRlciwgbGlzdENvbnRhaW5lcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYWN0aW9ucyBjb250YWluZXJcbiAgICBjb25zdCBhY3Rpb25zID0gY29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGJ1dHRvblxuICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1idXR0b24gc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJ1dHRvbi1wcmltYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkFkZCBQcm92aWRlclwiLFxuICAgIH0pO1xuICAgIHNldEljb24oYWRkQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJwbHVzXCIpO1xuXG4gICAgYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICBjb25zdCBjdXN0b21Qcm92aWRlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICB0aGlzLm9uQmFja1xuICAgICAgICAgICk7XG4gICAgICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGN1c3RvbVByb3ZpZGVyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIHRoaXMucmVuZGVyUHJvdmlkZXJMaXN0KCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBvbkJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBvbkJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLm9uQmFjayA9IG9uQmFjaztcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1vZGFsXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGhlYWRlciB3aXRoIGJhY2sgYnV0dG9uXG4gICAgY29uc3QgaGVhZGVyID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItaGVhZGVyXCIpO1xuXG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1iYWNrXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihiYWNrQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJhcnJvdy1sZWZ0XCIpO1xuICAgIGJhY2tCdXR0b24uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQmFjayB0byBQcm92aWRlcnNcIiB9KTtcblxuICAgIGJhY2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIHRoaXMub25CYWNrKCk7XG4gICAgfSk7XG5cbiAgICBoZWFkZXIuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQWRkIEN1c3RvbSBQcm92aWRlclwiIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGZvcm0gY29udGFpbmVyXG4gICAgY29uc3QgZm9ybSA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm1cIik7XG5cbiAgICAvLyBQcm92aWRlciBOYW1lXG4gICAgY29uc3QgbmFtZUdyb3VwID0gZm9ybS5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tZ3JvdXBcIik7XG4gICAgbmFtZUdyb3VwLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIlByb3ZpZGVyIE5hbWVcIiB9KTtcbiAgICBjb25zdCBuYW1lSW5wdXQgPSBuYW1lR3JvdXAuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcImUuZy4sIExNIFN0dWRpbywgT3BlbkFJXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIG1heGxlbmd0aDogXCIyNVwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEFkZCBpbnB1dCBydWxlcyBmb3IgcHJvdmlkZXIgbmFtZVxuICAgIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBuYW1lSW5wdXQudmFsdWU7XG5cbiAgICAgIC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyIG9mIGVhY2ggd29yZFxuICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgIC5tYXAoKHdvcmQpID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKVxuICAgICAgICAuam9pbihcIiBcIik7XG5cbiAgICAgIC8vIE9ubHkgdXBkYXRlIGlmIHRoZSB2YWx1ZSBoYXMgY2hhbmdlZCB0byBwcmV2ZW50IGN1cnNvciBqdW1waW5nXG4gICAgICBpZiAoZm9ybWF0dGVkVmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IGZvcm1hdHRlZFZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRW5kcG9pbnQgVVJMXG4gICAgY29uc3QgdXJsR3JvdXAgPSBmb3JtLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1ncm91cFwiKTtcbiAgICB1cmxHcm91cC5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogXCJBUEkgRW5kcG9pbnQgVVJMXCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnNcbiAgICBjb25zdCBwcmVzZXRDb250YWluZXIgPSB1cmxHcm91cC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0c1wiXG4gICAgKTtcbiAgICBwcmVzZXRDb250YWluZXIuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUXVpY2sgU2V0dXA6XCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnMgY29udGFpbmVyXG4gICAgY29uc3QgcHJlc2V0QnV0dG9ucyA9IHByZXNldENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0LWJ1dHRvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgT3BlbkFJIHByZXNldFxuICAgIGNvbnN0IG9wZW5BSUJ1dHRvbiA9IHByZXNldEJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJPcGVuQUlcIixcbiAgICB9KTtcblxuICAgIG9wZW5BSUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJPcGVuQUlcIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBPcGVuUm91dGVyIHByZXNldFxuICAgIGNvbnN0IG9wZW5Sb3V0ZXJCdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiT3BlblJvdXRlclwiLFxuICAgIH0pO1xuXG4gICAgb3BlblJvdXRlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJPcGVuUm91dGVyXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MVwiO1xuICAgICAgYXBpS2V5SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgR3JvcSBwcmVzZXRcbiAgICBjb25zdCBncm9xQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkdyb3FcIixcbiAgICB9KTtcblxuICAgIGdyb3FCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IFwiR3JvcVwiO1xuICAgICAgdXJsSW5wdXQudmFsdWUgPSBcImh0dHBzOi8vYXBpLmdyb3EuY29tL29wZW5haS92MVwiO1xuICAgICAgYXBpS2V5SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgTE0gU3R1ZGlvIHByZXNldFxuICAgIGNvbnN0IGxtU3R1ZGlvQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkxNIFN0dWRpb1wiLFxuICAgIH0pO1xuXG4gICAgbG1TdHVkaW9CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IFwiTE0gU3R1ZGlvXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cDovL2xvY2FsaG9zdDoxMjM0L3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBPbGxhbWEgcHJlc2V0XG4gICAgY29uc3Qgb2xsYW1hQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIk9sbGFtYVwiLFxuICAgIH0pO1xuXG4gICAgb2xsYW1hQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSBcIk9sbGFtYVwiO1xuICAgICAgdXJsSW5wdXQudmFsdWUgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQvdjFcIjtcbiAgICAgIGFwaUtleUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdXJsSW5wdXQgPSB1cmxHcm91cC5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiaHR0cHM6Ly95b3VyLWFwaS1lbmRwb2ludC5jb21cIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBlcnJvciBtZXNzYWdlIGNvbnRhaW5lclxuICAgIGNvbnN0IHVybEVycm9yID0gdXJsR3JvdXAuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIsXG4gICAgICB0ZXh0OiBcIiBcIiwgLy8gU3BhY2UgdG8gbWFpbnRhaW4gaGVpZ2h0XG4gICAgfSk7XG5cbiAgICAvLyBVUkwgdmFsaWRhdGlvbiBmdW5jdGlvblxuICAgIGNvbnN0IHZhbGlkYXRlRW5kcG9pbnRVcmwgPSAoXG4gICAgICB1cmw6IHN0cmluZ1xuICAgICk6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHVybCk7XG4gICAgICAgIGNvbnN0IGlzTG9jYWwgPVxuICAgICAgICAgIHBhcnNlZFVybC5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiB8fFxuICAgICAgICAgIHBhcnNlZFVybC5ob3N0bmFtZSA9PT0gXCIxMjcuMC4wLjFcIjtcblxuICAgICAgICBpZiAoaXNMb2NhbCAmJiBwYXJzZWRVcmwucHJvdG9jb2wgIT09IFwiaHR0cDpcIikge1xuICAgICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJMb2NhbCBlbmRwb2ludHMgbXVzdCB1c2UgSFRUUFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzTG9jYWwgJiYgcGFyc2VkVXJsLnByb3RvY29sICE9PSBcImh0dHBzOlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIlJlbW90ZSBlbmRwb2ludHMgbXVzdCB1c2UgSFRUUFNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzTG9jYWwgJiYgIXBhcnNlZFVybC5wb3J0KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IFwiTG9jYWwgZW5kcG9pbnRzIHJlcXVpcmUgYSBwb3J0IG51bWJlclwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlIH07XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkludmFsaWQgVVJMIGZvcm1hdFwiIH07XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEFQSSBLZXlcbiAgICBjb25zdCBhcGlLZXlHcm91cCA9IGZvcm0uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tZ3JvdXBcIlxuICAgICk7XG4gICAgYXBpS2V5R3JvdXAuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiQVBJIEtleSAoT3B0aW9uYWwpXCIgfSk7XG4gICAgY29uc3QgYXBpS2V5SW5wdXQgPSBhcGlLZXlHcm91cC5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHlvdXIgQVBJIGtleVwiLFxuICAgIH0pO1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gcmVzZXQgdmFsaWRhdGlvbiBzdGF0ZVxuICAgIGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9ICgpID0+IHtcbiAgICAgIGlzQ29ubmVjdGlvblRlc3RlZCA9IGZhbHNlO1xuICAgICAgdGVzdFJlc3VsdCA9IG51bGw7XG4gICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInRlc3RcIik7XG4gICAgICB1cmxFcnJvci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXN1Y2Nlc3NcIik7XG4gICAgfTtcblxuICAgIC8vIEFkZCBjaGFuZ2UgbGlzdGVuZXJzIHRvIGFsbCBpbnB1dHNcbiAgICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG4gICAgdXJsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG4gICAgYXBpS2V5SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG5cbiAgICAvLyBBZGQgaW5wdXQgcnVsZXMgZm9yIHByb3ZpZGVyIG5hbWVcbiAgICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbmFtZUlucHV0LnZhbHVlO1xuXG4gICAgICAvLyBDYXBpdGFsaXplIGZpcnN0IGxldHRlciBvZiBlYWNoIHdvcmRcbiAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gdmFsdWVcbiAgICAgICAgLnNwbGl0KFwiIFwiKVxuICAgICAgICAubWFwKCh3b3JkKSA9PiB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xuXG4gICAgICAvLyBPbmx5IHVwZGF0ZSBpZiB0aGUgdmFsdWUgaGFzIGNoYW5nZWQgdG8gcHJldmVudCBjdXJzb3IganVtcGluZ1xuICAgICAgaWYgKGZvcm1hdHRlZFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICBuYW1lSW5wdXQudmFsdWUgPSBmb3JtYXR0ZWRWYWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBmb3JtIGFjdGlvbnMgY29udGFpbmVyXG4gICAgY29uc3QgZm9ybUFjdGlvbnMgPSBmb3JtLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1mb3JtLWFjdGlvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgY2FuY2VsIGJ1dHRvbiBmaXJzdCAob24gdGhlIGxlZnQpXG4gICAgY29uc3QgY2FuY2VsQnV0dG9uID0gZm9ybUFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICB9KTtcblxuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0ZXN0L3NhdmUgYnV0dG9uIChvbiB0aGUgcmlnaHQpXG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gZm9ybUFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXByaW1hcnlcIixcbiAgICAgIHRleHQ6IFwiVGVzdCBDb25uZWN0aW9uXCIsXG4gICAgfSk7XG5cbiAgICBsZXQgaXNDb25uZWN0aW9uVGVzdGVkID0gZmFsc2U7XG4gICAgbGV0IHRlc3RSZXN1bHQ6IHsgc3VjY2VzczogYm9vbGVhbjsgbW9kZWxzPzogc3RyaW5nW10gfSB8IG51bGwgPSBudWxsO1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gY3JlYXRlIGEgcHJvdmlkZXIgb2JqZWN0IGZyb20gZm9ybSBkYXRhXG4gICAgY29uc3QgY3JlYXRlUHJvdmlkZXJGcm9tRm9ybSA9ICgpOiBDdXN0b21Qcm92aWRlciA9PiAoe1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBuYW1lOiBuYW1lSW5wdXQudmFsdWUudHJpbSgpLFxuICAgICAgZW5kcG9pbnQ6IHVybElucHV0LnZhbHVlLnRyaW0oKSxcbiAgICAgIGFwaUtleTogYXBpS2V5SW5wdXQudmFsdWUudHJpbSgpLFxuICAgICAgaXNFbmFibGVkOiB0cnVlLFxuICAgICAgbGFzdFRlc3RlZDogRGF0ZS5ub3coKSxcbiAgICB9KTtcblxuICAgIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBidXR0b24gc3RhdGVcbiAgICBjb25zdCB1cGRhdGVCdXR0b25TdGF0ZSA9IChcbiAgICAgIHN0YXRlOiBcInRlc3RcIiB8IFwidGVzdGluZ1wiIHwgXCJyZXRyeVwiIHwgXCJzYXZlXCJcbiAgICApID0+IHtcbiAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgY2FzZSBcInRlc3RcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlRlc3QgQ29ubmVjdGlvblwiKTtcbiAgICAgICAgICBhY3Rpb25CdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0ZXN0aW5nXCI6XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXCJUZXN0aW5nLi4uXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZXRyeVwiOlxuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFwiVHJ5IEFnYWluXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNhdmVcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlNhdmUgUHJvdmlkZXJcIik7XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBGdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgaW5wdXRzXG4gICAgY29uc3QgdmFsaWRhdGVGb3JtID0gKCk6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSA9PiB7XG4gICAgICAvLyBDaGVjayBuYW1lXG4gICAgICBpZiAoIW5hbWVJbnB1dC52YWx1ZS50cmltKCkpIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIlByb3ZpZGVyIG5hbWUgaXMgcmVxdWlyZWRcIiB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBVUkxcbiAgICAgIGNvbnN0IHVybFZhbGlkYXRpb24gPSB2YWxpZGF0ZUVuZHBvaW50VXJsKHVybElucHV0LnZhbHVlKTtcbiAgICAgIGlmICghdXJsVmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgIHJldHVybiB1cmxWYWxpZGF0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBBUEkga2V5IChyZXF1aXJlZCBmb3Igbm9uLWxvY2FsIGVuZHBvaW50cylcbiAgICAgIGNvbnN0IGlzTG9jYWwgPVxuICAgICAgICB1cmxJbnB1dC52YWx1ZS5pbmNsdWRlcyhcImxvY2FsaG9zdFwiKSB8fFxuICAgICAgICB1cmxJbnB1dC52YWx1ZS5pbmNsdWRlcyhcIjEyNy4wLjAuMVwiKTtcbiAgICAgIGlmICghaXNMb2NhbCAmJiAhYXBpS2V5SW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IFwiQVBJIGtleSBpcyByZXF1aXJlZCBmb3IgcmVtb3RlIGVuZHBvaW50c1wiLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlIH07XG4gICAgfTtcblxuICAgIC8vIEhhbmRsZSBidXR0b24gY2xpY2tcbiAgICBhY3Rpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUZvcm0oKTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvclxuICAgICAgICB1cmxFcnJvci50ZXh0Q29udGVudCA9IHZhbGlkYXRpb24uZXJyb3IgfHwgXCJJbnZhbGlkIGZvcm0gZGF0YVwiO1xuICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNDb25uZWN0aW9uVGVzdGVkKSB7XG4gICAgICAgIC8vIFRlc3QgY29ubmVjdGlvblxuICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInRlc3RpbmdcIik7XG5cbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBjcmVhdGVQcm92aWRlckZyb21Gb3JtKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGx1Z2luLmN1c3RvbVByb3ZpZGVyU2VydmljZS50ZXN0Q29ubmVjdGlvbihcbiAgICAgICAgICBwcm92aWRlclxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGlzQ29ubmVjdGlvblRlc3RlZCA9IHRydWU7XG4gICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoXCJzYXZlXCIpO1xuICAgICAgICAgIHRlc3RSZXN1bHQgPSByZXN1bHQ7XG5cbiAgICAgICAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZVxuICAgICAgICAgIHVybEVycm9yLnRleHRDb250ZW50ID0gYENvbm5lY3Rpb24gc3VjY2Vzc2Z1bCEgRm91bmQgJHtcbiAgICAgICAgICAgIHJlc3VsdC5tb2RlbHM/Lmxlbmd0aCB8fCAwXG4gICAgICAgICAgfSBtb2RlbHMuYDtcbiAgICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgICAgIHVybEVycm9yLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1zdWNjZXNzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKFwicmV0cnlcIik7XG5cbiAgICAgICAgICAvLyBTaG93IGVycm9yIG1lc3NhZ2VcbiAgICAgICAgICB1cmxFcnJvci50ZXh0Q29udGVudCA9IHJlc3VsdC5lcnJvciB8fCBcIkNvbm5lY3Rpb24gZmFpbGVkXCI7XG4gICAgICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiKTtcbiAgICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItc3VjY2Vzc1wiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2F2ZSBwcm92aWRlclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IGNyZWF0ZVByb3ZpZGVyRnJvbUZvcm0oKTtcblxuICAgICAgICAvLyBBZGQgdG8gc2V0dGluZ3NcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzID0gW1xuICAgICAgICAgIC4uLnRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycyxcbiAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBTYXZlIHNldHRpbmdzXG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAgIC8vIEdldCBmcmVzaCBtb2RlbHNcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuXG4gICAgICAgIC8vIENsb3NlIGFuZCBnbyBiYWNrXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGb2xkZXIsIEFic3RyYWN0SW5wdXRTdWdnZXN0IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBGb2xkZXJTdWdnZXN0ZXIgZXh0ZW5kcyBBYnN0cmFjdElucHV0U3VnZ2VzdDxzdHJpbmc+IHtcbiAgcHJpdmF0ZSBjb250ZW50OiBTZXQ8c3RyaW5nPjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gICAgcHJpdmF0ZSBvblNlbGVjdENiOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZCxcbiAgICBhcHA6IEFwcFxuICApIHtcbiAgICBzdXBlcihhcHAsIGlucHV0RWwpO1xuICAgIHRoaXMuY29udGVudCA9IGdldEZvbGRlclN1Z2dlc3Rpb25zKGFwcCk7XG4gIH1cblxuICBnZXRTdWdnZXN0aW9ucyhpbnB1dFN0cjogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGxvd2VyQ2FzZUlucHV0U3RyID0gaW5wdXRTdHIudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gWy4uLnRoaXMuY29udGVudF0uZmlsdGVyKChjb250ZW50KSA9PlxuICAgICAgY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyQ2FzZUlucHV0U3RyKVxuICAgICk7XG4gIH1cblxuICByZW5kZXJTdWdnZXN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgZWwuc2V0VGV4dChjb250ZW50KTtcbiAgfVxuXG4gIHNlbGVjdFN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5vblNlbGVjdENiKGNvbnRlbnQpO1xuICAgIHRoaXMuaW5wdXRFbC52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgdGhpcy5pbnB1dEVsLmJsdXIoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZvbGRlclN1Z2dlc3Rpb25zKGFwcDogQXBwKTogU2V0PHN0cmluZz4ge1xuICBjb25zdCBmb2xkZXJzID0gYXBwLnZhdWx0XG4gICAgLmdldEFsbExvYWRlZEZpbGVzKClcbiAgICAuZmlsdGVyKChmaWxlKSA9PiBmaWxlIGluc3RhbmNlb2YgVEZvbGRlcikgYXMgVEZvbGRlcltdO1xuICByZXR1cm4gbmV3IFNldChmb2xkZXJzLm1hcCgoZm9sZGVyKSA9PiBmb2xkZXIucGF0aCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXR0YWNoRm9sZGVyU3VnZ2VzdGVyKFxuICBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICBvblNlbGVjdDogKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB2b2lkLFxuICBhcHA6IEFwcFxuKTogRm9sZGVyU3VnZ2VzdGVyIHtcbiAgcmV0dXJuIG5ldyBGb2xkZXJTdWdnZXN0ZXIoaW5wdXRFbCwgb25TZWxlY3QsIGFwcCk7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVEZpbGUsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IGF0dGFjaEZpbGVTdWdnZXN0ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9GaWxlU3VnZ2VzdGVyXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlTmFtZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gbmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOS1fIF0vZywgXCJcIikucmVwbGFjZSgvIC9nLCBcIi1cIik7XG59XG5cbmZ1bmN0aW9uIGdldFN5c3RlbVByb21wdFBhdGgoZGlyZWN0b3J5OiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7ZGlyZWN0b3J5fS8ke2ZpbGVOYW1lfS5tZGA7XG59XG5cbmV4cG9ydCB0eXBlIFN5c3RlbVByb21wdE1vZGUgPSBcImRlZmF1bHRcIiB8IFwiY2hhdC1zcGVjaWZpY1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucyB7XG4gIG9uU2F2ZT86IChuZXdQcm9tcHQ6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeT86IHN0cmluZztcbiAgbW9kZTogU3lzdGVtUHJvbXB0TW9kZTtcbiAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gIG1vZGVsQ29udGV4dExlbmd0aD86IG51bWJlcjtcbiAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0UmVzdWx0IHtcbiAgY29udGVudDogc3RyaW5nO1xuICB0eXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHBhdGg/OiBzdHJpbmc7XG4gIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gIHRva2VuTGltaXRQZXJjZW50YWdlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU3lzdGVtUHJvbXB0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcmVzdWx0OiBTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsKSA9PiB2b2lkO1xuICBwcml2YXRlIHRleHRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbUlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbVNlY3Rpb246IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG9wdGlvbnM6IFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucztcbiAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRTZXJ2aWNlOiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlO1xuICBwcml2YXRlIHN5c3RlbVByb21wdHM6IFN5c3RlbVByb21wdFByZXNldFtdID0gW107XG4gIHByaXZhdGUgdG9rZW5MaW1pdElucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIGxvYWRpbmdJbmRpY2F0b3I6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGNvbnRlbnRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHByZXNldEJ1dHRvbkNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgYWN0aXZlUHJlc2V0OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBwcml2YXRlIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiBTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnNcbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm1vZGFsRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWxcIiwgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtbW9kYWxcIik7XG4gICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6XG4gICAgICAgIG9wdGlvbnMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSA/PyBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiLFxuICAgIH07XG4gICAgdGhpcy5zeXN0ZW1Qcm9tcHRTZXJ2aWNlID0gbmV3IFN5c3RlbVByb21wdFNlcnZpY2UoYXBwKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd0xvYWRpbmcoc2hvdzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5sb2FkaW5nSW5kaWNhdG9yIHx8ICF0aGlzLmNvbnRlbnRDb250YWluZXIpIHJldHVybjtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG4gIH1cblxuICBhc3luYyBsb2FkU3lzdGVtUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyh0cnVlKTtcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0cyA9IGF3YWl0IHRoaXMuc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRzKCk7XG5cbiAgICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9ucyBhZnRlciBsb2FkaW5nIGRhdGFcbiAgICAgIHRoaXMuY3JlYXRlUHJlc2V0QnV0dG9ucygpO1xuXG4gICAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIHN5c3RlbSBwcm9tcHRzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcmVzZXRCdXR0b25zKCkge1xuICAgIGlmICghdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIpIHJldHVybjtcblxuICAgIC8vIENsZWFyIGV4aXN0aW5nIGJ1dHRvbnNcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBhY3RpdmUgcHJlc2V0IGJhc2VkIG9uIGN1cnJlbnQgcHJvbXB0XG4gICAgdGhpcy5zeXN0ZW1Qcm9tcHRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgaWYgKHByZXNldC5zeXN0ZW1Qcm9tcHQgPT09IHRoaXMuY3VycmVudFByb21wdCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IHByZXNldC5sYWJlbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIElmIG5vIHByZXNldCBtYXRjaGVzLCBjaGVjayBmb3IgZ2VuZXJhbC11c2UgbWF0Y2hcbiAgICBpZiAoIXRoaXMuYWN0aXZlUHJlc2V0ICYmIHRoaXMuY3VycmVudFByb21wdCkge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhlIFwiZ2VuZXJhbC11c2VcIiBwcm9tcHQgdGV4dCBleGFjdGx5IG1hdGNoZXMgdGhlIHVzZXIncyBjdXJyZW50IHByb21wdFxuICAgICAgY29uc3QgZ2VuZXJhbFVzZVByZXNldCA9IHRoaXMuc3lzdGVtUHJvbXB0cy5maW5kKFxuICAgICAgICAocCkgPT4gcC5pZCA9PT0gXCJnZW5lcmFsLXVzZVwiXG4gICAgICApO1xuICAgICAgaWYgKFxuICAgICAgICBnZW5lcmFsVXNlUHJlc2V0ICYmXG4gICAgICAgIGdlbmVyYWxVc2VQcmVzZXQuc3lzdGVtUHJvbXB0LnRyaW0oKSA9PT0gdGhpcy5jdXJyZW50UHJvbXB0LnRyaW0oKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gZ2VuZXJhbFVzZVByZXNldC5sYWJlbDsgLy8gZS5nLiBcIkdlbmVyYWwtdXNlXCJcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZhbGwgYmFjayB0byBnZW5lcmFsLXVzZSBhbmQgdXNlIGl0cyBzeXN0ZW0gcHJvbXB0XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gXCJHZW5lcmFsLXVzZVwiO1xuICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSAmJiBnZW5lcmFsVXNlUHJlc2V0KSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGdlbmVyYWxVc2VQcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b25zIGZvciBlYWNoIHN5c3RlbSBwcm9tcHRcbiAgICBjb25zdCBwcmVzZXRCdXR0b25zID0gW1xuICAgICAgLi4udGhpcy5zeXN0ZW1Qcm9tcHRzLFxuICAgICAgLy8gT25seSBhZGQgY3VzdG9tIGlmIGl0J3Mgbm90IGFscmVhZHkgaW4gc3lzdGVtUHJvbXB0c1xuICAgICAgLi4uKCF0aGlzLnN5c3RlbVByb21wdHMuc29tZSgocCkgPT4gcC5pZCA9PT0gXCJjdXN0b21cIilcbiAgICAgICAgPyBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgICBsYWJlbDogXCJDdXN0b21cIixcbiAgICAgICAgICAgICAgaXNVc2VyQ29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICBzeXN0ZW1Qcm9tcHQ6IFwiXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF1cbiAgICAgICAgOiBbXSksXG4gICAgXS5tYXAoKHByZXNldCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBwcmVzZXQubGFiZWwsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCBpbml0aWFsIGFjdGl2ZSBzdGF0ZVxuICAgICAgaWYgKHByZXNldC5sYWJlbCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpIHtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAocHJlc2V0LmxhYmVsID09PSBcIkN1c3RvbVwiKSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3RpdmUgY2xhc3MgZnJvbSBhbGwgYnV0dG9uc1xuICAgICAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lclxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIpXG4gICAgICAgICAgLmZvckVhY2goKGJ0bikgPT4gYnRuLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IHByZXNldC5sYWJlbDtcblxuICAgICAgICAvLyBVcGRhdGUgdGV4dCBhcmVhIGFuZCBjdXN0b20gc2VjdGlvbiBiYXNlZCBvbiBwcmVzZXRcbiAgICAgICAgaWYgKHByZXNldC5sYWJlbCA9PT0gXCJDdXN0b21cIikge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgIHRoaXMuY3VzdG9tSW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gYnV0dG9uO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgLy8gQ3JlYXRlIGxvYWRpbmcgaW5kaWNhdG9yXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IHRoaXMubG9hZGluZ0luZGljYXRvci5jcmVhdGVTcGFuKCk7XG4gICAgbG9hZGluZ1RleHQuc2V0VGV4dChcIkxvYWRpbmcgc3lzdGVtIHByb21wdHMuLi5cIik7XG5cbiAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXJcbiAgICB0aGlzLmNvbnRlbnRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY29udGVudC1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBTZXQgdGl0bGUgYW5kIGRlc2NyaXB0aW9uIGJhc2VkIG9uIG1vZGVcbiAgICBjb25zdCB0aXRsZSA9XG4gICAgICB0aGlzLm9wdGlvbnMubW9kZSA9PT0gXCJkZWZhdWx0XCJcbiAgICAgICAgPyBcIkVkaXQgRGVmYXVsdCBTeXN0ZW0gUHJvbXB0XCJcbiAgICAgICAgOiBcIkNoYXQgVmlldyBTZXR0aW5nc1wiO1xuXG4gICAgY29uc3QgZGVzY3JpcHRpb24gPVxuICAgICAgdGhpcy5vcHRpb25zLm1vZGUgPT09IFwiZGVmYXVsdFwiXG4gICAgICAgID8gXCJDaGFuZ2VzIHdpbGwgYXBwbHkgYXMgdGhlIGRlZmF1bHQgZm9yIGFsbCBuZXcgY2hhdCB2aWV3c1wiXG4gICAgICAgIDogXCJDb25maWd1cmUgc2V0dGluZ3MgZm9yIHRoaXMgc3BlY2lmaWMgY2hhdCB2aWV3XCI7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dCh0aXRsZSk7XG4gICAgdGhpcy50aXRsZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIpO1xuXG4gICAgLy8gQWRkIGRlc2NyaXB0aW9uIHRleHQgZGlyZWN0bHkgYWZ0ZXIgdGl0bGVcbiAgICBjb25zdCBkZXNjcmlwdGlvbkVsID0gdGhpcy50aXRsZUVsLmNyZWF0ZURpdigpO1xuICAgIGRlc2NyaXB0aW9uRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtZGVzY3JpcHRpb25cIik7XG4gICAgZGVzY3JpcHRpb25FbC5zZXRUZXh0KGRlc2NyaXB0aW9uKTtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW11dGVkKVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUuZm9udFNpemUgPSBcIjAuOWVtXCI7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5tYXJnaW5Ub3AgPSBcIjAuMmVtXCI7XG5cbiAgICBjb25zdCB0ZXh0QXJlYUNvbnRhaW5lciA9IHRoaXMuY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbiBjb250YWluZXIgYnV0IGRvbid0IHBvcHVsYXRlIHlldFxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHNlY3Rpb24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuY3VzdG9tU2VjdGlvbiA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1zZWN0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBjdXN0b21JbnB1dENvbnRhaW5lciA9IHRoaXMuY3VzdG9tU2VjdGlvbi5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgYW5kIGJ1dHRvblxuICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGN1c3RvbUlucHV0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LXdyYXBwZXJcIlxuICAgICk7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdGhlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuY3VzdG9tSW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmb3IgYSBzeXN0ZW0gcHJvbXB0IGZpbGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNyZWF0ZSBuZXcgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnV0dG9uID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3JlYXRlLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gXCI0cHggOHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHNldEljb24oY3JlYXRlQnV0dG9uLCBcInBsdXNcIik7XG5cbiAgICBjcmVhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnQgPSBcIlwiO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGVtcGxhdGVDb250ZW50ID1cbiAgICAgICAgICBhd2FpdCB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0VGVtcGxhdGUoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICBcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkNyZWF0ZSBOZXcgU3lzdGVtIFByb21wdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkVudGVyIGEgdGl0bGUgYW5kIGNvbnRlbnQgZm9yIHlvdXIgbmV3IHN5c3RlbSBwcm9tcHQuIFRoZSB0aXRsZSB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGEgbWFya2Rvd24gZmlsZSB0aGF0IHlvdSBjYW4gY3VzdG9taXplIGxhdGVyLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkNyZWF0ZVwiLFxuICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgIGlucHV0czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiTXkgQ3VzdG9tIEFzc2lzdGFudFwiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3lzdGVtc2N1bHB0LXByb21wdC1jcmVhdGlvbi10aXRsZS1pbnB1dFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJ0ZXh0YXJlYVwiLFxuICAgICAgICAgICAgdmFsdWU6IHRlbXBsYXRlQ29udGVudCxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tY29udGVudFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXN1bHQ/LmNvbmZpcm1lZCB8fCAhcmVzdWx0LmlucHV0cz8uWzBdIHx8ICFyZXN1bHQuaW5wdXRzPy5bMV0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbdGl0bGUsIGNvbnRlbnRdID0gcmVzdWx0LmlucHV0cztcbiAgICAgIGNvbnN0IHByb21wdHNEaXJlY3RvcnkgPVxuICAgICAgICB0aGlzLm9wdGlvbnMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSA/PyBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiO1xuICAgICAgY29uc3QgZmlsZU5hbWUgPSBzYW5pdGl6ZUZpbGVOYW1lKHRpdGxlKTtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gZ2V0U3lzdGVtUHJvbXB0UGF0aChwcm9tcHRzRGlyZWN0b3J5LCBmaWxlTmFtZSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKHByb21wdHNEaXJlY3RvcnkpLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAvKiBEaXJlY3RvcnkgbWlnaHQgYWxyZWFkeSBleGlzdCAqL1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGAjICR7dGl0bGV9XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIGZpbGVDb250ZW50KTtcblxuICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGZpbGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIHRleHRhcmVhIHdpdGggdGhlIGNvbnRlbnRcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gZmlsZUNvbnRlbnQ7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnB1dCB0byBzaG93IHRoZSBzZWxlY3RlZCBmaWxlXG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSBmaWxlUGF0aDtcblxuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiU3lzdGVtIHByb21wdCBmaWxlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG5cbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIDogXCJGYWlsZWQgdG8gY3JlYXRlIHN5c3RlbSBwcm9tcHQgZmlsZS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIjtcblxuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE9ubHkgYXR0YWNoIGZpbGUgc3VnZ2VzdGVyIGFmdGVyIGlucHV0IGlzIGNyZWF0ZWRcbiAgICBpZiAodGhpcy5jdXN0b21JbnB1dCkge1xuICAgICAgYXR0YWNoRmlsZVN1Z2dlc3RlcihcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dCxcbiAgICAgICAgYXN5bmMgKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICAgIGlmIChmaWxlICYmIGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlIHdpdGhvdXQgLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gc2VsZWN0ZWRQYXRoLnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVhZGluZyBzeXN0ZW0gcHJvbXB0IGZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSA/PyBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMudGV4dEFyZWEgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWFcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiRW50ZXIgc3lzdGVtIHByb21wdFwiLFxuICAgICAgICByZWFkT25seTogdGhpcy5hY3RpdmVQcmVzZXQgIT09IFwiQ3VzdG9tXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQ7XG5cbiAgICAvLyBBZGQgdG9rZW4gbGltaXQgc2VjdGlvbiBvbmx5IGZvciBjaGF0LXNwZWNpZmljIG1vZGUsIGFmdGVyIHRoZSB0ZXh0YXJlYVxuICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gXCJjaGF0LXNwZWNpZmljXCIpIHtcbiAgICAgIGNvbnN0IHRva2VuTGltaXRDb250YWluZXIgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWNvbnRhaW5lclwiLFxuICAgICAgfSk7XG4gICAgICB0b2tlbkxpbWl0Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIHRva2VuTGltaXRDb250YWluZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtZW5kXCI7XG4gICAgICB0b2tlbkxpbWl0Q29udGFpbmVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuICAgICAgdG9rZW5MaW1pdENvbnRhaW5lci5zdHlsZS5tYXJnaW5Ub3AgPSBcIjFyZW1cIjtcbiAgICAgIHRva2VuTGltaXRDb250YWluZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcblxuICAgICAgY29uc3QgdG9rZW5MaW1pdFdyYXBwZXIgPSB0b2tlbkxpbWl0Q29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtd3JhcHBlclwiLFxuICAgICAgfSk7XG4gICAgICB0b2tlbkxpbWl0V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgICB0b2tlbkxpbWl0V3JhcHBlci5zdHlsZS5mbGV4RGlyZWN0aW9uID0gXCJjb2x1bW5cIjtcbiAgICAgIHRva2VuTGltaXRXcmFwcGVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImZsZXgtZW5kXCI7XG4gICAgICB0b2tlbkxpbWl0V3JhcHBlci5zdHlsZS53aWR0aCA9IFwiNTAlXCI7XG5cbiAgICAgIGNvbnN0IHRva2VuTGltaXRMYWJlbCA9IHRva2VuTGltaXRXcmFwcGVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtbGFiZWxcIixcbiAgICAgICAgdGV4dDogXCJDb250ZXh0IFRva2VuIExpbWl0XCIsXG4gICAgICB9KTtcbiAgICAgIHRva2VuTGltaXRMYWJlbC5zdHlsZS5mb250V2VpZ2h0ID0gXCI1MDBcIjtcbiAgICAgIHRva2VuTGltaXRMYWJlbC5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjRweFwiO1xuICAgICAgdG9rZW5MaW1pdExhYmVsLnN0eWxlLmZvbnRTaXplID0gXCIxNHB4XCI7XG5cbiAgICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IHRva2VuTGltaXRXcmFwcGVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtaW5wdXQtd3JhcHBlclwiLFxuICAgICAgfSk7XG4gICAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgaW5wdXRXcmFwcGVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuICAgICAgaW5wdXRXcmFwcGVyLnN0eWxlLmdhcCA9IFwiNHB4XCI7XG4gICAgICBpbnB1dFdyYXBwZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblxuICAgICAgdGhpcy50b2tlbkxpbWl0SW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICAgIHR5cGU6IFwicmFuZ2VcIixcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1pbnB1dFwiLFxuICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgbWluOiBcIjBcIixcbiAgICAgICAgICBtYXg6IFwiMTAwXCIsXG4gICAgICAgICAgc3RlcDogXCIxXCIsXG4gICAgICAgICAgdmFsdWU6IHRoaXMub3B0aW9ucy50b2tlbkxpbWl0UGVyY2VudGFnZT8udG9TdHJpbmcoKSB8fCBcIjBcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy50b2tlbkxpbWl0SW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblxuICAgICAgY29uc3QgdmFsdWVEaXNwbGF5ID0gaW5wdXRXcmFwcGVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtZGlzcGxheVwiLFxuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMudG9rZW5MaW1pdFBlcmNlbnRhZ2VcbiAgICAgICAgICA/IHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGhcbiAgICAgICAgICAgID8gYCR7TWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgICAoKHRoaXMub3B0aW9ucy50b2tlbkxpbWl0UGVyY2VudGFnZSAvIDEwMCkgKlxuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aCkgL1xuICAgICAgICAgICAgICAgICAgMTAwMFxuICAgICAgICAgICAgICApfUtgXG4gICAgICAgICAgICA6IGAke3RoaXMub3B0aW9ucy50b2tlbkxpbWl0UGVyY2VudGFnZX0lYFxuICAgICAgICAgIDogXCJcdTIyMUVcIixcbiAgICAgIH0pO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLm1pbldpZHRoID0gXCI0NXB4XCI7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUudGV4dEFsaWduID0gXCJyaWdodFwiO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLmZvbnRWYXJpYW50TnVtZXJpYyA9IFwidGFidWxhci1udW1zXCI7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUuZm9udFNpemUgPSBcIjE0cHhcIjtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS5mb250V2VpZ2h0ID0gXCI1MDBcIjtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1hY2NlbnQpXCI7XG5cbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdG9rZW5MaW1pdFdyYXBwZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1kZXNjcmlwdGlvblwiLFxuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoXG4gICAgICAgICAgPyBgTW9kZWwgbWF4OiAke01hdGguZmxvb3IoXG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGggLyAxMDAwXG4gICAgICAgICAgICApfUsgdG9rZW5zYFxuICAgICAgICAgIDogXCJTZXQgdG8gMCUgZm9yIG5vIGxpbWl0XCIsXG4gICAgICB9KTtcbiAgICAgIGRlc2NyaXB0aW9uLnN0eWxlLmZvbnRTaXplID0gXCIxMnB4XCI7XG4gICAgICBkZXNjcmlwdGlvbi5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICAgIGRlc2NyaXB0aW9uLnN0eWxlLm1hcmdpblRvcCA9IFwiNHB4XCI7XG5cbiAgICAgIC8vIFVwZGF0ZSBkaXNwbGF5IHdoZW4gc2xpZGVyIGNoYW5nZXNcbiAgICAgIHRoaXMudG9rZW5MaW1pdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gcGFyc2VJbnQoKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlLCAxMCk7XG4gICAgICAgIGlmIChwZXJjZW50YWdlID09PSAwKSB7XG4gICAgICAgICAgdmFsdWVEaXNwbGF5LnNldFRleHQoXCJcdTIyMUVcIik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IHRva2VucyA9IE1hdGguZmxvb3IoXG4gICAgICAgICAgICAoKHBlcmNlbnRhZ2UgLyAxMDApICogdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aCkgLyAxMDAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2YWx1ZURpc3BsYXkuc2V0VGV4dChgJHt0b2tlbnN9S2ApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbHVlRGlzcGxheS5zZXRUZXh0KGAke3BlcmNlbnRhZ2V9JWApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBJZiBcIkN1c3RvbVwiIGlzIGFjdGl2ZSwgZmlsbCB0aGUgY3VzdG9tSW5wdXQgd2l0aCB0aGUgdXNlci1wcm92aWRlZCBwYXRoXG4gICAgaWYgKHRoaXMuYWN0aXZlUHJlc2V0ID09PSBcIkN1c3RvbVwiICYmIHRoaXMub3B0aW9ucy5jdXN0b21Qcm9tcHRGaWxlUGF0aCkge1xuICAgICAgLy8gUmVtb3ZlIGFueSBleGlzdGluZyByZWxhdGl2ZSBsaW5rIG1hcmtlcnNcbiAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSB0aGlzLm9wdGlvbnMuY3VzdG9tUHJvbXB0RmlsZVBhdGgucmVwbGFjZShcbiAgICAgICAgL15cXFtcXFsoLio/KVxcXVxcXSQvLFxuICAgICAgICBcIiQxXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlc2l6ZSBvYnNlcnZlciB0byBoYW5kbGUgZHluYW1pYyBjb250ZW50XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGhpcy50ZXh0QXJlYS5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfSk7XG4gICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRleHRBcmVhKTtcblxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IHRoaXMuY29udGVudENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgY29uc3Qgc2Vjb25kYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHNlY29uZGFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlQ2FuY2VsO1xuXG4gICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIlNhdmVcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVTYXZlID0gKCkgPT4ge1xuICAgICAgLy8gRmluZCB3aGljaCBwcmVzZXQgaXMgYWN0aXZlXG4gICAgICBjb25zdCBhY3RpdmVCdXR0b24gPSB0aGlzLm1vZGFsRWwucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuc3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24uYWN0aXZlXCJcbiAgICAgICk7XG4gICAgICBjb25zdCBhY3RpdmVQcmVzZXRMYWJlbCA9IGFjdGl2ZUJ1dHRvbj8udGV4dENvbnRlbnQgPz8gXCJcIjtcblxuICAgICAgbGV0IHJlc3VsdDogU3lzdGVtUHJvbXB0UmVzdWx0O1xuXG4gICAgICBpZiAoYWN0aXZlUHJlc2V0TGFiZWwgPT09IFwiQ3VzdG9tXCIgJiYgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSkge1xuICAgICAgICAvLyBSZW1vdmUgLm1kIGV4dGVuc2lvbiBhbmQgY29udmVydCB0byByZWxhdGl2ZSBsaW5rIGZvcm1hdFxuICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5jdXN0b21JbnB1dC52YWx1ZS5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMudGV4dEFyZWEudmFsdWUsXG4gICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQoXG4gICAgICAgICAgKHApID0+IHAubGFiZWwgPT09IGFjdGl2ZVByZXNldExhYmVsXG4gICAgICAgICk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICBjb250ZW50OiBwcmVzZXQuc3lzdGVtUHJvbXB0LFxuICAgICAgICAgICAgdHlwZTogcHJlc2V0LmlkIGFzIFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGN1cnJlbnQgY29udGVudCBpZiBubyBwcmVzZXQgZm91bmRcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLnRleHRBcmVhLnZhbHVlLFxuICAgICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB0b2tlbiBsaW1pdCBpZiBpbiBjaGF0LXNwZWNpZmljIG1vZGUgYW5kIGEgdmFsdWUgaXMgc2V0XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5tb2RlID09PSBcImNoYXQtc3BlY2lmaWNcIiAmJlxuICAgICAgICB0aGlzLnRva2VuTGltaXRJbnB1dD8udmFsdWVcbiAgICAgICkge1xuICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gcGFyc2VJbnQodGhpcy50b2tlbkxpbWl0SW5wdXQudmFsdWUsIDEwKTtcbiAgICAgICAgaWYgKHBlcmNlbnRhZ2UgPiAwKSB7XG4gICAgICAgICAgLy8gU3RvcmUgdGhlIHBlcmNlbnRhZ2UgdmFsdWUgZGlyZWN0bHlcbiAgICAgICAgICByZXN1bHQudG9rZW5MaW1pdFBlcmNlbnRhZ2UgPSBwZXJjZW50YWdlO1xuICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBtb2RlbCBjb250ZXh0IGxlbmd0aCwgYWxzbyBjYWxjdWxhdGUgYW5kIHN0b3JlIHRoZSBhY3R1YWwgdG9rZW4gbGltaXRcbiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0LnRva2VuTGltaXQgPSBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAocGVyY2VudGFnZSAvIDEwMCkgKiB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHByaW1hcnlCdXR0b24ub25jbGljayA9IGhhbmRsZVNhdmU7XG5cbiAgICAvLyBIYW5kbGUga2V5Ym9hcmQgZXZlbnRzXG4gICAgdGhpcy5tb2RhbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAvLyBPbmx5IGhhbmRsZSBFbnRlciBpZiBub3QgaW4gdGV4dGFyZWEgKHdoZXJlIHdlIHdhbnQgdG8gYWxsb3cgbmV3bGluZXMpXG4gICAgICBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgIWUuaXNDb21wb3NpbmcgJiZcbiAgICAgICAgIWUuc2hpZnRLZXkgJiZcbiAgICAgICAgZS50YXJnZXQgIT09IHRoaXMudGV4dEFyZWFcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVNhdmUoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVDYW5jZWwoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZvY3VzIHRoZSB0ZXh0YXJlYSBhbmQgcGxhY2UgY3Vyc29yIGF0IHRoZSBlbmRcbiAgICB0aGlzLnRleHRBcmVhLmZvY3VzKCk7XG4gICAgdGhpcy50ZXh0QXJlYS5zZXRTZWxlY3Rpb25SYW5nZShcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoLFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGhcbiAgICApO1xuXG4gICAgLy8gU3RhcnQgbG9hZGluZyBwcm9tcHRzIGFmdGVyIFVJIGlzIHNldCB1cFxuICAgIGF3YWl0IHRoaXMubG9hZFN5c3RlbVByb21wdHMoKTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgaWYgKHRoaXMucmVzb2x2ZVByb21pc2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc29sdmVQcm9taXNlICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuQW5kR2V0VmFsdWUoKTogUHJvbWlzZTxTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93U3lzdGVtUHJvbXB0TW9kYWwoXG4gIGFwcDogQXBwLFxuICBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiBQYXJ0aWFsPFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucz5cbik6IFByb21pc2U8U3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbD4ge1xuICBjb25zdCBkZWZhdWx0T3B0aW9uczogU3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zID0ge1xuICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gICAgbW9kZTogXCJkZWZhdWx0XCIsXG4gICAgbW9kZWxDb250ZXh0TGVuZ3RoOiB1bmRlZmluZWQsXG4gIH07XG5cbiAgY29uc3QgbW9kYWwgPSBuZXcgU3lzdGVtUHJvbXB0TW9kYWwoYXBwLCBjdXJyZW50UHJvbXB0LCB7XG4gICAgLi4uZGVmYXVsdE9wdGlvbnMsXG4gICAgLi4ub3B0aW9ucyxcbiAgfSk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xuXG4gIGlmIChyZXN1bHQgIT09IG51bGwgJiYgb3B0aW9ucz8ub25TYXZlKSB7XG4gICAgYXdhaXQgb3B0aW9ucy5vblNhdmUocmVzdWx0LmNvbnRlbnQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldywgTm90aWNlLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQge1xuICBUcmFuc2NyaXB0aW9uU2VydmljZSxcbiAgdHlwZSBUcmFuc2NyaXB0aW9uQ29udGV4dCxcbn0gZnJvbSBcIi4vVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgQ0hBVF9WSUVXX1RZUEUsIENoYXRWaWV3IH0gZnJvbSBcIi4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5cbi8vIEVkaXRvckhhbmRsZXIgaW50ZXJmYWNlIGFuZCBpbXBsZW1lbnRhdGlvbnNcbmludGVyZmFjZSBFZGl0b3JIYW5kbGVyIHtcbiAgaW5zZXJ0VGV4dCh0ZXh0OiBzdHJpbmcpOiB2b2lkO1xufVxuXG5jbGFzcyBNYXJrZG93bkVkaXRvckhhbmRsZXIgaW1wbGVtZW50cyBFZGl0b3JIYW5kbGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCkge31cblxuICBpbnNlcnRUZXh0KHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgIGlmICghYWN0aXZlVmlldz8uZWRpdG9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyBhY3RpdmUgbWFya2Rvd24gZWRpdG9yIGZvdW5kIGZvciBwYXN0aW5nXCIpO1xuICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKG5vIGFjdGl2ZSBub3RlKVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBlZGl0b3IgPSBhY3RpdmVWaWV3LmVkaXRvcjtcbiAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgY29uc3QgbGluZUNvbnRlbnQgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSk7XG5cbiAgICBjb25zdCB0ZXh0VG9JbnNlcnQgPSB0ZXh0XG4gICAgICA/IGN1cnNvci5jaCA+IDAgJiYgbGluZUNvbnRlbnQubGVuZ3RoID4gMFxuICAgICAgICA/IFwiXFxuXCIgKyB0ZXh0XG4gICAgICAgIDogdGV4dFxuICAgICAgOiBcIlwiO1xuXG4gICAgaWYgKCF0ZXh0VG9JbnNlcnQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIHRleHQgdG8gaW5zZXJ0XCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UodGV4dFRvSW5zZXJ0LCBjdXJzb3IpO1xuICAgIGNvbnN0IGxpbmVzID0gdGV4dFRvSW5zZXJ0LnNwbGl0KFwiXFxuXCIpO1xuICAgIGNvbnN0IGxhc3RMaW5lID0gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0gfHwgXCJcIjtcblxuICAgIGVkaXRvci5zZXRDdXJzb3Ioe1xuICAgICAgbGluZTogY3Vyc29yLmxpbmUgKyBsaW5lcy5sZW5ndGggLSAxLFxuICAgICAgY2g6IGxhc3RMaW5lLmxlbmd0aCxcbiAgICB9KTtcblxuICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBwYXN0ZWQgaW50byBub3RlXCIpO1xuICB9XG59XG5cbmNsYXNzIENoYXRFZGl0b3JIYW5kbGVyIGltcGxlbWVudHMgRWRpdG9ySGFuZGxlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6ICgodGV4dDogc3RyaW5nKSA9PiB2b2lkKSB8IHVuZGVmaW5lZFxuICApIHt9XG5cbiAgaW5zZXJ0VGV4dCh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSkge1xuICAgICAgdGhpcy5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSh0ZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFwiTm8gY2hhdCBoYW5kbGVyIGZvdW5kIGZvciB0cmFuc2NyaXB0aW9uXCIpO1xuICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKGNoYXQgaGFuZGxlciBtaXNzaW5nKVwiKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gUHJpb3JpdGl6ZWQgTUlNRSB0eXBlcyBmb3IgcmVjb3JkaW5nXG5jb25zdCBSRUNPUkRJTkdfRk9STUFUUyA9IFtcbiAgeyBtaW1lVHlwZTogXCJhdWRpby93ZWJtO2NvZGVjcz1vcHVzXCIsIGV4dGVuc2lvbjogXCJ3ZWJtXCIsIHNhbXBsZVJhdGU6IDE2MDAwIH0sIC8vIE9wdGltYWwgZm9yIHNwZWVjaCwgc21hbGwgc2l6ZVxuICB7IG1pbWVUeXBlOiBcImF1ZGlvL3dlYm1cIiwgZXh0ZW5zaW9uOiBcIndlYm1cIiwgc2FtcGxlUmF0ZTogNDgwMDAgfSwgLy8gRmFsbGJhY2sgd2l0aCBkZWZhdWx0IGNvZGVjXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vb2dnO2NvZGVjcz1vcHVzXCIsIGV4dGVuc2lvbjogXCJvZ2dcIiwgc2FtcGxlUmF0ZTogNDgwMDAgfSwgLy8gQWx0ZXJuYXRpdmUgT3B1cyBjb250YWluZXJcbiAgeyBtaW1lVHlwZTogXCJhdWRpby93YXZcIiwgZXh0ZW5zaW9uOiBcIndhdlwiLCBzYW1wbGVSYXRlOiA0ODAwMCB9LCAvLyBMYXN0IHJlc29ydCBmYWxsYmFja1xuXSBhcyBjb25zdDtcblxuaW50ZXJmYWNlIEF1ZGlvQ2h1bmsge1xuICBibG9iOiBCbG9iO1xuICBzYW1wbGVSYXRlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBSZWNvcmRlck9wdGlvbnMge1xuICBpc0luQ2hhdD86IGJvb2xlYW47XG4gIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlPzogKHRleHQ6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIFJlY29yZGluZ0NvbnRleHQge1xuICBpc0luQ2hhdDogYm9vbGVhbjtcbiAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU/OiAodGV4dDogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgUmVjb3JkZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFJlY29yZGVyU2VydmljZTtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBpc1JlY29yZGluZyA9IGZhbHNlO1xuICBwcml2YXRlIG9uVG9nZ2xlQ2FsbGJhY2tzOiBTZXQ8KGlzUmVjb3JkaW5nOiBib29sZWFuKSA9PiB2b2lkPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBtZWRpYVN0cmVhbTogTWVkaWFTdHJlYW0gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBtZWRpYVJlY29yZGVyOiBNZWRpYVJlY29yZGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY2h1bmtzOiBBdWRpb0NodW5rW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZEZvcm1hdDogKHR5cGVvZiBSRUNPUkRJTkdfRk9STUFUUylbbnVtYmVyXSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGxhc3RSZWNvcmRlZEZpbGVQYXRoOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhdWRpb0NvbnRleHQ6IEF1ZGlvQ29udGV4dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGFuYWx5c2VyOiBBbmFseXNlck5vZGUgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhbmltYXRpb25GcmFtZTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc21vb3RoZWRWYWx1ZXM6IEZsb2F0MzJBcnJheTtcbiAgcHJpdmF0ZSByZWFkb25seSBzbW9vdGhpbmdGYWN0b3IgPSAwLjQ7XG4gIHByaXZhdGUgdmlzdWFsaXplckNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBjdXJyZW50Q29udGV4dDogUmVjb3JkaW5nQ29udGV4dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlY29yZGluZ01vZGFsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRyYWdDbGVhbnVwOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBlZGl0b3JIYW5kbGVyOiBFZGl0b3JIYW5kbGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBvcHRpb25zOiBSZWNvcmRlck9wdGlvbnMgPSB7fVxuICApIHtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnNtb290aGVkVmFsdWVzID0gbmV3IEZsb2F0MzJBcnJheSgxMjgpO1xuICAgIHRoaXMudXBkYXRlQ29udGV4dChvcHRpb25zKTtcbiAgICBjb25zb2xlLmxvZyhcIlJlY29yZGVyU2VydmljZSBpbml0aWFsaXplZFwiKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShcbiAgICBhcHA6IEFwcCxcbiAgICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBvcHRpb25zOiBSZWNvcmRlck9wdGlvbnMgPSB7fVxuICApOiBSZWNvcmRlclNlcnZpY2Uge1xuICAgIGlmICghUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkNyZWF0aW5nIG5ldyBSZWNvcmRlclNlcnZpY2UgaW5zdGFuY2VcIik7XG4gICAgICBSZWNvcmRlclNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgUmVjb3JkZXJTZXJ2aWNlKGFwcCwgcGx1Z2luKTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgdXBkYXRlIGNvbnRleHQgd2hlbiBnZXRJbnN0YW5jZSBpcyBjYWxsZWRcbiAgICBSZWNvcmRlclNlcnZpY2UuaW5zdGFuY2UudXBkYXRlQ29udGV4dChvcHRpb25zKTtcbiAgICByZXR1cm4gUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBY3RpdmVWaWV3SW5mbygpOiB7IGlzQ2hhdDogYm9vbGVhbjsgdmlld0lkZW50aWZpZXI6IHN0cmluZyB9IHtcbiAgICBjb25zdCBhY3RpdmVMZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmFjdGl2ZUxlYWY7XG4gICAgaWYgKCFhY3RpdmVMZWFmKSB7XG4gICAgICByZXR1cm4geyBpc0NoYXQ6IGZhbHNlLCB2aWV3SWRlbnRpZmllcjogXCJ1bmtub3duXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCB2aWV3U3RhdGUgPSBhY3RpdmVMZWFmLmdldFZpZXdTdGF0ZSgpO1xuICAgIGNvbnN0IHZpZXdUeXBlID0gdmlld1N0YXRlLnR5cGU7XG5cbiAgICAvLyBDaGVjayBpZiBpdCdzIGEgY2hhdCB2aWV3XG4gICAgaWYgKHZpZXdUeXBlID09PSBDSEFUX1ZJRVdfVFlQRSkge1xuICAgICAgcmV0dXJuIHsgaXNDaGF0OiB0cnVlLCB2aWV3SWRlbnRpZmllcjogXCJjaGF0XCIgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBpdCdzIGEgbWFya2Rvd24gdmlld1xuICAgIGNvbnN0IG1hcmtkb3duVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgaWYgKG1hcmtkb3duVmlldz8uZmlsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNDaGF0OiBmYWxzZSxcbiAgICAgICAgdmlld0lkZW50aWZpZXI6IGBub3RlLSR7bWFya2Rvd25WaWV3LmZpbGUucGF0aH1gLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBpc0NoYXQ6IGZhbHNlLCB2aWV3SWRlbnRpZmllcjogXCJ1bmtub3duXCIgfTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ29udGV4dChvcHRpb25zOiBSZWNvcmRlck9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGlzQ2hhdCB9ID0gdGhpcy5nZXRBY3RpdmVWaWV3SW5mbygpO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQgPSB7XG4gICAgICBpc0luQ2hhdDogaXNDaGF0LFxuICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6IG9wdGlvbnMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0VGV4dEludG9BY3RpdmVWaWV3KHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHsgaXNDaGF0IH0gPSB0aGlzLmdldEFjdGl2ZVZpZXdJbmZvKCk7XG5cbiAgICBpZiAoaXNDaGF0KSB7XG4gICAgICBjb25zdCBjaGF0VmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKENoYXRWaWV3KTtcbiAgICAgIGlmIChjaGF0Vmlldykge1xuICAgICAgICBjb25zdCBpbnB1dCA9IGNoYXRWaWV3LmNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgXCIuc3lzdGVtc2N1bHB0LWNoYXQtaW5wdXRcIlxuICAgICAgICApIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgIGNvbnN0IGN1cnNvclBvcyA9IGlucHV0LnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGlucHV0LnZhbHVlO1xuXG4gICAgICAgICAgaWYgKGN1cnNvclBvcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gSW5zZXJ0IGF0IGN1cnNvciBwb3NpdGlvblxuICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPVxuICAgICAgICAgICAgICBjdXJyZW50VmFsdWUuc2xpY2UoMCwgY3Vyc29yUG9zKSArXG4gICAgICAgICAgICAgIHRleHQgK1xuICAgICAgICAgICAgICBjdXJyZW50VmFsdWUuc2xpY2UoY3Vyc29yUG9zKTtcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAvLyBNb3ZlIGN1cnNvciB0byBlbmQgb2YgaW5zZXJ0ZWQgdGV4dFxuICAgICAgICAgICAgaW5wdXQuc2VsZWN0aW9uU3RhcnQgPSBpbnB1dC5zZWxlY3Rpb25FbmQgPSBjdXJzb3JQb3MgKyB0ZXh0Lmxlbmd0aDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQXBwZW5kIHRvIGVuZCBpZiBubyBjdXJzb3IgcG9zaXRpb25cbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gY3VycmVudFZhbHVlICsgdGV4dDtcbiAgICAgICAgICAgIGlucHV0LnNlbGVjdGlvblN0YXJ0ID0gaW5wdXQuc2VsZWN0aW9uRW5kID0gaW5wdXQudmFsdWUubGVuZ3RoO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRyaWdnZXIgaW5wdXQgZXZlbnQgZm9yIGhlaWdodCBhZGp1c3RtZW50IGFuZCB0b2tlbiBjb3VudGluZ1xuICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIikpO1xuICAgICAgICAgIC8vIEZvY3VzIHRoZSBpbnB1dCBhZnRlciBpbnNlcnRpb25cbiAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuXG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIHBhc3RlZCBpbnRvIGNoYXRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFwiQ2hhdCBpbnB1dCBlbGVtZW50IG5vdCBmb3VuZFwiKTtcbiAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gY2hhdCBpbnB1dClcIik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIk5vIGFjdGl2ZSBjaGF0IHZpZXcgZm91bmRcIik7XG4gICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChubyBhY3RpdmUgY2hhdClcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1hcmtkb3duVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICBpZiAoIW1hcmtkb3duVmlldz8uZWRpdG9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIk5vIGFjdGl2ZSBtYXJrZG93biBlZGl0b3IgZm91bmRcIik7XG4gICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChubyBhY3RpdmUgbm90ZSlcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZWRpdG9yID0gbWFya2Rvd25WaWV3LmVkaXRvcjtcbiAgICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcbiAgICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3Vyc29yLmxpbmUpO1xuICAgICAgY29uc3QgdGV4dFRvSW5zZXJ0ID0gdGV4dFxuICAgICAgICA/IGN1cnNvci5jaCA+IDAgJiYgbGluZUNvbnRlbnQubGVuZ3RoID4gMFxuICAgICAgICAgID8gXCJcXG5cIiArIHRleHRcbiAgICAgICAgICA6IHRleHRcbiAgICAgICAgOiBcIlwiO1xuXG4gICAgICBpZiAoIXRleHRUb0luc2VydCkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJObyB0ZXh0IHRvIGluc2VydFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKHRleHRUb0luc2VydCwgY3Vyc29yKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGV4dFRvSW5zZXJ0LnNwbGl0KFwiXFxuXCIpO1xuICAgICAgY29uc3QgbGFzdExpbmUgPSBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXSB8fCBcIlwiO1xuICAgICAgZWRpdG9yLnNldEN1cnNvcih7XG4gICAgICAgIGxpbmU6IGN1cnNvci5saW5lICsgbGluZXMubGVuZ3RoIC0gMSxcbiAgICAgICAgY2g6IGxhc3RMaW5lLmxlbmd0aCxcbiAgICAgIH0pO1xuXG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gcGFzdGVkIGludG8gbm90ZVwiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHRyYW5zY3JpYmVMYXN0UmVjb3JkaW5nKCkge1xuICAgIGlmICghdGhpcy5sYXN0UmVjb3JkZWRGaWxlUGF0aCkgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICB0aGlzLmxhc3RSZWNvcmRlZEZpbGVQYXRoXG4gICAgICApO1xuICAgICAgaWYgKCFmaWxlIHx8ICEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBtb2RhbCA9IG5ldyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCh0aGlzLmFwcCwge1xuICAgICAgICBmaWxlLFxuICAgICAgICBpc0NoYXQ6IHRoaXMuY3VycmVudENvbnRleHQ/LmlzSW5DaGF0ID8/IGZhbHNlLFxuICAgICAgICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb250ZXh0Py5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGV4dC5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSh0ZXh0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRUZXh0SW50b0FjdGl2ZVZpZXcodGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW46IHRoaXMucGx1Z2luLFxuICAgICAgfSk7XG4gICAgICBtb2RhbC5vcGVuKCk7XG5cbiAgICAgIC8vIENsZWFuIHVwIHRoZSByZWNvcmRpbmcgZmlsZVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmRlbGV0ZShmaWxlKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBjbGVhbiB1cCByZWNvcmRpbmcgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQXV0by10cmFuc2NyaXB0aW9uIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gdHJhbnNjcmliZSBhdWRpb1wiKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUmVjb3JkaW5nTW9kYWwoKTogdm9pZCB7XG4gICAgLy8gQ2xlYW51cCBhbnkgb2xkIGluc3RhbmNlXG4gICAgaWYgKHRoaXMucmVjb3JkaW5nTW9kYWwpIHtcbiAgICAgIGlmICh0aGlzLmRyYWdDbGVhbnVwKSB7XG4gICAgICAgIHRoaXMuZHJhZ0NsZWFudXAoKTtcbiAgICAgICAgdGhpcy5kcmFnQ2xlYW51cCA9IG51bGw7XG4gICAgICB9XG4gICAgICB0aGlzLnJlY29yZGluZ01vZGFsLnJlbW92ZSgpO1xuICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbCA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHRoZSBuZXcgZmxvYXRpbmcgbW9kYWxcbiAgICB0aGlzLnJlY29yZGluZ01vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnJlY29yZGluZ01vZGFsLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXJlY29yZGVyLW1vZGFsXCI7XG5cbiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250ZW50LmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXJlY29yZGVyLWNvbnRlbnRcIjtcblxuICAgIGNvbnN0IGxpdmVJbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGxpdmVJbmRpY2F0b3IuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtcmVjb3JkZXItbGl2ZVwiO1xuICAgIGxpdmVJbmRpY2F0b3IudGV4dENvbnRlbnQgPSBcIlx1MjVDRiBMaXZlXCI7XG4gICAgY29udGVudC5hcHBlbmRDaGlsZChsaXZlSW5kaWNhdG9yKTtcblxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXJlY29yZGVyLWNhbnZhc1wiO1xuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoY2FudmFzKTtcblxuICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuYXBwZW5kQ2hpbGQoY29udGVudCk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnJlY29yZGluZ01vZGFsKTtcblxuICAgIHRoaXMuZHJhZ0NsZWFudXAgPSB0aGlzLnNldHVwRHJhZ2dhYmxlKHRoaXMucmVjb3JkaW5nTW9kYWwpO1xuICAgIHRoaXMuc2V0VmlzdWFsaXplckNhbnZhcyhjYW52YXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cERyYWdnYWJsZShlbGVtZW50OiBIVE1MRWxlbWVudCk6ICgpID0+IHZvaWQge1xuICAgIC8vIFRyYWNrIHBvc2l0aW9uIHN0YXRlXG4gICAgbGV0IHBvcyA9IHsgeDogMCwgeTogMCB9O1xuXG4gICAgLy8gQ2xlYW4gZXZlbnQgaGFuZGxpbmdcbiAgICBjb25zdCBjbGVhbnVwID0gKCkgPT4ge1xuICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJhZ2dpbmdcIik7XG4gICAgfTtcblxuICAgIC8vIFNpbXBsZSBtb3ZlIGhhbmRsZXIgd2l0aCBib3VuZHMgY2hlY2tpbmdcbiAgICBjb25zdCBvbk1vdmUgPSAoY2xpZW50WDogbnVtYmVyLCBjbGllbnRZOiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcG9zLnggPSBNYXRoLm1pbihcbiAgICAgICAgTWF0aC5tYXgoMCwgY2xpZW50WCAtIHJlY3Qud2lkdGggLyAyKSxcbiAgICAgICAgd2luZG93LmlubmVyV2lkdGggLSByZWN0LndpZHRoXG4gICAgICApO1xuICAgICAgcG9zLnkgPSBNYXRoLm1pbihcbiAgICAgICAgTWF0aC5tYXgoMCwgY2xpZW50WSAtIHJlY3QuaGVpZ2h0IC8gMiksXG4gICAgICAgIHdpbmRvdy5pbm5lckhlaWdodCAtIHJlY3QuaGVpZ2h0XG4gICAgICApO1xuXG4gICAgICAvLyBSZW1vdmUgYm90dG9tL3JpZ2h0IHBvc2l0aW9uaW5nIHdoZW4gZHJhZ2dpbmcgc3RhcnRzXG4gICAgICBlbGVtZW50LnN0eWxlLmJvdHRvbSA9IFwiXCI7XG4gICAgICBlbGVtZW50LnN0eWxlLnJpZ2h0ID0gXCJcIjtcblxuICAgICAgLy8gQXBwbHkgbmV3IHBvc2l0aW9uXG4gICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSBgJHtwb3MueH1weGA7XG4gICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IGAke3Bvcy55fXB4YDtcbiAgICB9O1xuXG4gICAgLy8gUG9pbnRlciBldmVudCBoYW5kbGVyc1xuICAgIGNvbnN0IG9uUG9pbnRlckRvd24gPSAoZTogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICAvLyBPbmx5IGhhbmRsZSBsZWZ0IGNsaWNrIG9yIHRvdWNoXG4gICAgICBpZiAoZS5idXR0b24gIT09IDAgJiYgZS5idXR0b24gIT09IC0xKSByZXR1cm47XG5cbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImRyYWdnaW5nXCIpO1xuICAgICAgZWxlbWVudC5zZXRQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7XG5cbiAgICAgIC8vIFNldCBpbml0aWFsIHBvc2l0aW9uIGJhc2VkIG9uIGN1cnJlbnQgbG9jYXRpb25cbiAgICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcG9zLnggPSByZWN0LmxlZnQ7XG4gICAgICBwb3MueSA9IHJlY3QudG9wO1xuXG4gICAgICAvLyBJbml0aWFsIG1vdmUgdG8gcHJldmVudCBqdW1wc1xuICAgICAgb25Nb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25Qb2ludGVyTW92ZSA9IChlOiBQb2ludGVyRXZlbnQpID0+IHtcbiAgICAgIGlmIChlbGVtZW50Lmhhc1BvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKSkge1xuICAgICAgICBvbk1vdmUoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBvblBvaW50ZXJVcCA9IChlOiBQb2ludGVyRXZlbnQpID0+IHtcbiAgICAgIGNsZWFudXAoKTtcbiAgICAgIGVsZW1lbnQucmVsZWFzZVBvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKTtcbiAgICB9O1xuXG4gICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIG9uUG9pbnRlckRvd24pO1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsIG9uUG9pbnRlck1vdmUpO1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBvblBvaW50ZXJVcCk7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmNhbmNlbFwiLCBjbGVhbnVwKTtcblxuICAgIC8vIENsZWFudXAgZnVuY3Rpb24gZm9yIHJlbW92aW5nIGxpc3RlbmVyc1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBvblBvaW50ZXJEb3duKTtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsIG9uUG9pbnRlck1vdmUpO1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIG9uUG9pbnRlclVwKTtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIiwgY2xlYW51cCk7XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIHRvZ2dsZVJlY29yZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKCF0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICAgIGNvbnN0IHsgaXNDaGF0LCB2aWV3SWRlbnRpZmllciB9ID0gdGhpcy5nZXRBY3RpdmVWaWV3SW5mbygpO1xuXG4gICAgICAgIGlmICh2aWV3SWRlbnRpZmllciA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNkEwXHVGRTBGIFBsZWFzZSBvcGVuIGEgbm90ZSBvciBjaGF0IGJlZm9yZSByZWNvcmRpbmdcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyByZWNvcmRpbmcgaW4gdmlldzpcIiwge1xuICAgICAgICAgIGlzQ2hhdCxcbiAgICAgICAgICB2aWV3SWRlbnRpZmllcixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGNvbnRleHQgd2l0aCBjdXJyZW50IHZpZXcgaW5mb1xuICAgICAgICB0aGlzLnVwZGF0ZUNvbnRleHQoe1xuICAgICAgICAgIGlzSW5DaGF0OiBpc0NoYXQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFsd2F5cyBjcmVhdGUgdGhlIGRyYWdnYWJsZSBtb2RhbFxuICAgICAgICB0aGlzLmNyZWF0ZVJlY29yZGluZ01vZGFsKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc3RvcFJlY29yZGluZygpO1xuXG4gICAgICAgIGlmICh0aGlzLnJlY29yZGluZ01vZGFsKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZHJhZ0NsZWFudXApIHtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0NsZWFudXAoKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0NsZWFudXAgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnJlY29yZGluZ01vZGFsLnJlbW92ZSgpO1xuICAgICAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0UmVjb3JkaW5nKCk7XG4gICAgICAgIGlmICh0aGlzLnJlY29yZGluZ01vZGFsKSB7XG4gICAgICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5jbGFzc0xpc3QuYWRkKFwicmVjb3JkaW5nXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB0b2dnbGluZyByZWNvcmRpbmc6XCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3NEMgRmFpbGVkIHRvIHRvZ2dsZSByZWNvcmRpbmdcIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlbnN1cmVSZWNvcmRpbmdEaXJlY3RvcnkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGlyID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmFkYXB0ZXIubWtkaXIoZGlyKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlVua25vd24gZXJyb3JcIjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIHJlY29yZGluZ3MgZGlyZWN0b3J5OlwiLCBlcnJvck1lc3NhZ2UpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIHJlY29yZGluZ3MgZGlyZWN0b3J5OiAke2Vycm9yTWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRldGVjdFN1cHBvcnRlZEZvcm1hdCgpOiBQcm9taXNlPFxuICAgICh0eXBlb2YgUkVDT1JESU5HX0ZPUk1BVFMpW251bWJlcl1cbiAgPiB7XG4gICAgZm9yIChjb25zdCBmb3JtYXQgb2YgUkVDT1JESU5HX0ZPUk1BVFMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChNZWRpYVJlY29yZGVyLmlzVHlwZVN1cHBvcnRlZChmb3JtYXQubWltZVR5cGUpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFNlbGVjdGVkIHJlY29yZGluZyBmb3JtYXQ6ICR7Zm9ybWF0Lm1pbWVUeXBlfWApO1xuICAgICAgICAgIHJldHVybiBmb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgRm9ybWF0ICR7Zm9ybWF0Lm1pbWVUeXBlfSBjaGVjayBmYWlsZWQ6YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdXBwb3J0ZWQgYXVkaW8gcmVjb3JkaW5nIGZvcm1hdCBmb3VuZFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVGaWxlTmFtZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbm93XG4gICAgICAudG9JU09TdHJpbmcoKVxuICAgICAgLnJlcGxhY2UoL1s6Ll0vZywgXCItXCIpXG4gICAgICAucmVwbGFjZShcIlRcIiwgXCJfXCIpXG4gICAgICAuc3BsaXQoXCIuXCIpWzBdO1xuICAgIHJldHVybiBgJHt0aW1lc3RhbXB9LiR7dGhpcy5zZWxlY3RlZEZvcm1hdD8uZXh0ZW5zaW9uIHx8IFwiYXVkaW9cIn1gO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpOiB2b2lkIHtcbiAgICAvLyBSZXNldCBzbW9vdGhlZCB2YWx1ZXNcbiAgICB0aGlzLnNtb290aGVkVmFsdWVzID0gbmV3IEZsb2F0MzJBcnJheSgxMjgpO1xuXG4gICAgLy8gQ2FuY2VsIGFueSBvbmdvaW5nIGFuaW1hdGlvblxuICAgIGlmICh0aGlzLmFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcbiAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIFByb3Blcmx5IGRpc2Nvbm5lY3QgYW5kIG51bGwgb3V0IGFuYWx5emVyXG4gICAgaWYgKHRoaXMuYW5hbHlzZXIpIHtcbiAgICAgIHRoaXMuYW5hbHlzZXIuZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy5hbmFseXNlciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gQ2xvc2UgYW5kIG51bGwgb3V0IGF1ZGlvIGNvbnRleHRcbiAgICBpZiAodGhpcy5hdWRpb0NvbnRleHQpIHtcbiAgICAgIHRoaXMuYXVkaW9Db250ZXh0LmNsb3NlKCk7XG4gICAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgY2FudmFzIGlmIGl0IGV4aXN0c1xuICAgIGlmICh0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgIGNvbnN0IGN0eCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBpZiAoY3R4KSB7XG4gICAgICAgIGN0eC5jbGVhclJlY3QoXG4gICAgICAgICAgMCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy53aWR0aCxcbiAgICAgICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuaGVpZ2h0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cFZpc3VhbGl6YXRpb24oKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm1lZGlhU3RyZWFtKSByZXR1cm47XG5cbiAgICAvLyBDcmVhdGUgbmV3IGF1ZGlvIGNvbnRleHRcbiAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoe1xuICAgICAgc2FtcGxlUmF0ZTogMTYwMDAsXG4gICAgICBsYXRlbmN5SGludDogXCJpbnRlcmFjdGl2ZVwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGFuZCBjb25uZWN0IG1lZGlhIHN0cmVhbSBzb3VyY2VcbiAgICBjb25zdCBzb3VyY2UgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZSh0aGlzLm1lZGlhU3RyZWFtKTtcblxuICAgIC8vIENyZWF0ZSBhbmQgY29uZmlndXJlIGFuYWx5emVyXG4gICAgdGhpcy5hbmFseXNlciA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG4gICAgdGhpcy5hbmFseXNlci5mZnRTaXplID0gMjU2O1xuICAgIHRoaXMuYW5hbHlzZXIuc21vb3RoaW5nVGltZUNvbnN0YW50ID0gMC43O1xuXG4gICAgLy8gQ29ubmVjdCBzb3VyY2UgdG8gYW5hbHl6ZXJcbiAgICBzb3VyY2UuY29ubmVjdCh0aGlzLmFuYWx5c2VyKTtcblxuICAgIC8vIFN0YXJ0IHZpc3VhbGl6YXRpb24gaWYgY2FudmFzIGV4aXN0c1xuICAgIGlmICh0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgIHRoaXMudXBkYXRlQ2FudmFzU2l6ZSgpO1xuICAgICAgdGhpcy5kcmF3KCk7XG4gICAgfVxuICB9XG5cbiAgc2V0VmlzdWFsaXplckNhbnZhcyhjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbCk6IHZvaWQge1xuICAgIC8vIENsZWFuIHVwIG9sZCBjYW52YXNcbiAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgaWYgKGN0eCkge1xuICAgICAgICBjdHguY2xlYXJSZWN0KFxuICAgICAgICAgIDAsXG4gICAgICAgICAgMCxcbiAgICAgICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMud2lkdGgsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlc2V0IHN0YXRlIGlmIHJlbW92aW5nIGNhbnZhc1xuICAgIGlmICghY2FudmFzKSB7XG4gICAgICB0aGlzLnJlc2V0VmlzdWFsaXphdGlvblN0YXRlKCk7XG4gICAgfVxuXG4gICAgdGhpcy52aXN1YWxpemVyQ2FudmFzID0gY2FudmFzO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBuZXcgY2FudmFzIGlmIHJlY29yZGluZ1xuICAgIGlmIChjYW52YXMgJiYgdGhpcy5pc1JlY29yZGluZykge1xuICAgICAgdGhpcy51cGRhdGVDYW52YXNTaXplKCk7XG4gICAgICAvLyBSZWluaXRpYWxpemUgdmlzdWFsaXphdGlvbiBpZiBuZWVkZWRcbiAgICAgIGlmICghdGhpcy5hdWRpb0NvbnRleHQgfHwgIXRoaXMuYW5hbHlzZXIpIHtcbiAgICAgICAgdGhpcy5zZXR1cFZpc3VhbGl6YXRpb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ2FudmFzU2l6ZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudmlzdWFsaXplckNhbnZhcykgcmV0dXJuO1xuXG4gICAgY29uc3QgcmVjdCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBkcHIgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxO1xuXG4gICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoID0gcmVjdC53aWR0aCAqIGRwcjtcbiAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuaGVpZ2h0ID0gcmVjdC5oZWlnaHQgKiBkcHI7XG5cbiAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmIChjdHgpIHtcbiAgICAgIGN0eC5zY2FsZShkcHIsIGRwcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdGFydFJlY29yZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pc1JlY29yZGluZykgcmV0dXJuO1xuXG4gICAgLy8gUmVzZXQgYWxsIHZpc3VhbGl6YXRpb24gc3RhdGUgYmVmb3JlIHN0YXJ0aW5nXG4gICAgdGhpcy5yZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZW5zdXJlUmVjb3JkaW5nRGlyZWN0b3J5KCk7XG5cbiAgICAgIC8vIEZpcnN0IGNoZWNrIGlmIHdlIGhhdmUgcGVybWlzc2lvblxuICAgICAgY29uc3QgcGVybWlzc2lvblJlc3VsdCA9IGF3YWl0IG5hdmlnYXRvci5wZXJtaXNzaW9ucy5xdWVyeSh7XG4gICAgICAgIG5hbWU6IFwibWljcm9waG9uZVwiIGFzIFBlcm1pc3Npb25OYW1lLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChwZXJtaXNzaW9uUmVzdWx0LnN0YXRlID09PSBcImRlbmllZFwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pY3JvcGhvbmUgcGVybWlzc2lvbiBkZW5pZWRcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIERldGVjdCBzdXBwb3J0ZWQgZm9ybWF0IGJlZm9yZSBzdGFydGluZ1xuICAgICAgdGhpcy5zZWxlY3RlZEZvcm1hdCA9IGF3YWl0IHRoaXMuZGV0ZWN0U3VwcG9ydGVkRm9ybWF0KCk7XG5cbiAgICAgIGNvbnN0IGF1ZGlvQ29uc3RyYWludHM6IE1lZGlhVHJhY2tDb25zdHJhaW50cyA9IHtcbiAgICAgICAgZWNob0NhbmNlbGxhdGlvbjogdHJ1ZSxcbiAgICAgICAgbm9pc2VTdXBwcmVzc2lvbjogdHJ1ZSxcbiAgICAgICAgc2FtcGxlUmF0ZTogMTYwMDAsXG4gICAgICAgIGNoYW5uZWxDb3VudDogMSwgLy8gTW9ubyBmb3Igc3BlZWNoXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlZmVycmVkTWljcm9waG9uZUlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpO1xuICAgICAgICAgIGNvbnN0IHByZWZlcnJlZERldmljZSA9IGRldmljZXMuZmluZChcbiAgICAgICAgICAgIChkZXZpY2UpID0+XG4gICAgICAgICAgICAgIGRldmljZS5raW5kID09PSBcImF1ZGlvaW5wdXRcIiAmJlxuICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlSWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAocHJlZmVycmVkRGV2aWNlKSB7XG4gICAgICAgICAgICBhdWRpb0NvbnN0cmFpbnRzLmRldmljZUlkID0ge1xuICAgICAgICAgICAgICBleGFjdDogdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlZmVycmVkTWljcm9waG9uZUlkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlZmVycmVkTWljcm9waG9uZUlkID0gXCJcIjtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgIFwiUHJlZmVycmVkIG1pY3JvcGhvbmUgbm90IGZvdW5kLCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdFwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2hlY2tpbmcgbWljcm9waG9uZSBkZXZpY2VzOlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVxdWVzdCBtZWRpYSBzdHJlYW1cbiAgICAgIHRoaXMubWVkaWFTdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4gICAgICAgIGF1ZGlvOiBhdWRpb0NvbnN0cmFpbnRzLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBtZWRpYSByZWNvcmRlclxuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhUmVjb3JkZXIodGhpcy5tZWRpYVN0cmVhbSwge1xuICAgICAgICBtaW1lVHlwZTogdGhpcy5zZWxlY3RlZEZvcm1hdC5taW1lVHlwZSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTZXQgdXAgZGF0YSBoYW5kbGluZ1xuICAgICAgdGhpcy5jaHVua3MgPSBbXTtcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5vbmRhdGFhdmFpbGFibGUgPSBhc3luYyAoZTogQmxvYkV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChlLmRhdGEuc2l6ZSA+IDApIHtcbiAgICAgICAgICB0aGlzLmNodW5rcy5wdXNoKHtcbiAgICAgICAgICAgIGJsb2I6IGUuZGF0YSxcbiAgICAgICAgICAgIHNhbXBsZVJhdGU6IHRoaXMuc2VsZWN0ZWRGb3JtYXQ/LnNhbXBsZVJhdGUgPz8gNDgwMDAsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEhhbmRsZSByZWNvcmRpbmcgc3RvcFxuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLm9uc3RvcCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBTYXZlIHRoZSByZWNvcmRpbmdcbiAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHRoaXMuZ2VuZXJhdGVGaWxlTmFtZSgpO1xuICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeX0vJHtmaWxlTmFtZX1gO1xuXG4gICAgICAgICAgLy8gQ29tYmluZSBhbGwgY2h1bmtzIGludG8gYSBzaW5nbGUgYmxvYlxuICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihcbiAgICAgICAgICAgIHRoaXMuY2h1bmtzLm1hcCgoY2h1bmspID0+IGNodW5rLmJsb2IpLFxuICAgICAgICAgICAgeyB0eXBlOiB0aGlzLnNlbGVjdGVkRm9ybWF0Py5taW1lVHlwZSB9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIENvbnZlcnQgYmxvYiB0byBhcnJheSBidWZmZXJcbiAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgICAgIC8vIFNhdmUgdG8gZmlsZVxuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5hZGFwdGVyLndyaXRlQmluYXJ5KFxuICAgICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgICBhcnJheUJ1ZmZlclxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBTdG9yZSB0aGUgcGF0aCBmb3IgdHJhbnNjcmlwdGlvblxuICAgICAgICAgIHRoaXMubGFzdFJlY29yZGVkRmlsZVBhdGggPSBmaWxlUGF0aDtcblxuICAgICAgICAgIC8vIFN0YXJ0IHRyYW5zY3JpcHRpb25cbiAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zY3JpYmVMYXN0UmVjb3JkaW5nKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIHJlY29yZGluZzpcIiwgZXJyb3IpO1xuICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3NEMgRmFpbGVkIHRvIHNhdmUgcmVjb3JkaW5nXCIpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBTdGFydCByZWNvcmRpbmcgd2l0aCBhIHNtYWxsZXIgdGltZXNsaWNlIGZvciBtb3JlIGZyZXF1ZW50IG9uZGF0YWF2YWlsYWJsZSBldmVudHNcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5zdGFydCgxMDAwKTtcblxuICAgICAgLy8gU2V0IHVwIHZpc3VhbGl6YXRpb24gY2hhaW5cbiAgICAgIHRoaXMuc2V0dXBWaXN1YWxpemF0aW9uKCk7XG5cbiAgICAgIHRoaXMuaXNSZWNvcmRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoKTtcblxuICAgICAgLy8gU3RhcnQgdmlzdWFsaXphdGlvbiBpbW1lZGlhdGVseVxuICAgICAgaWYgKHRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlJlY29yZGluZyBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlJlY29yZGluZyBmYWlsZWRcIjtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc3RvcFJlY29yZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNSZWNvcmRpbmcpIHJldHVybjtcblxuICAgIC8vIFN0b3AgbWVkaWEgcmVjb3JkZXIgZmlyc3RcbiAgICBpZiAodGhpcy5tZWRpYVJlY29yZGVyICYmIHRoaXMubWVkaWFSZWNvcmRlci5zdGF0ZSAhPT0gXCJpbmFjdGl2ZVwiKSB7XG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIuc3RvcCgpO1xuICAgIH1cblxuICAgIC8vIFN0b3AgYWxsIG1lZGlhIHRyYWNrc1xuICAgIGlmICh0aGlzLm1lZGlhU3RyZWFtKSB7XG4gICAgICB0aGlzLm1lZGlhU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goKHRyYWNrKSA9PiB0cmFjay5zdG9wKCkpO1xuICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgYWxsIHZpc3VhbGl6YXRpb24gc3RhdGVcbiAgICB0aGlzLnJlc2V0VmlzdWFsaXphdGlvblN0YXRlKCk7XG5cbiAgICAvLyBSZW1vdmUgcmVjb3JkaW5nIGNsYXNzIGZyb20gbW9kYWxcbiAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwicmVjb3JkaW5nXCIpO1xuICAgIH1cblxuICAgIHRoaXMubWVkaWFSZWNvcmRlciA9IG51bGw7XG4gICAgdGhpcy5pc1JlY29yZGluZyA9IGZhbHNlO1xuICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKCk7XG4gIH1cblxuICBwcml2YXRlIGRyYXcgPSAoKSA9PiB7XG4gICAgaWYgKCF0aGlzLmlzUmVjb3JkaW5nIHx8ICF0aGlzLmFuYWx5c2VyIHx8ICF0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgIGlmICh0aGlzLmFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0aW9uRnJhbWUpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgYW5pbWF0aW9uIGZyYW1lIGJlZm9yZSBzdGFydGluZyBuZXcgb25lXG4gICAgaWYgKHRoaXMuYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0aW9uRnJhbWUpO1xuICAgICAgdGhpcy5hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5hbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudDtcbiAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShidWZmZXJMZW5ndGgpO1xuICAgIHRoaXMuYW5hbHlzZXIuZ2V0Qnl0ZUZyZXF1ZW5jeURhdGEoZGF0YUFycmF5KTtcblxuICAgIGNvbnN0IGN0eCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgaWYgKCFjdHgpIHJldHVybjtcblxuICAgIC8vIENsZWFyIHRoZSBjYW52YXMgYmVmb3JlIGRyYXdpbmdcbiAgICBjdHguY2xlYXJSZWN0KFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMud2lkdGgsXG4gICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuaGVpZ2h0XG4gICAgKTtcblxuICAgIGNvbnN0IHJlY3QgPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3Qgd2lkdGggPSByZWN0LndpZHRoO1xuICAgIGNvbnN0IGhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuICAgIGNvbnN0IGNlbnRlclkgPSBoZWlnaHQgLyAyO1xuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XG5cbiAgICAvLyBDYWxjdWxhdGUgcmVzcG9uc2l2ZSB2YWx1ZXMgYmFzZWQgb24gc2NyZWVuIHdpZHRoXG4gICAgY29uc3QgaXNNb2JpbGUgPSB3aWR0aCA8PSA0MDA7XG4gICAgY29uc3Qgb3ZlcmxhcCA9IGlzTW9iaWxlID8gMyA6IDU7IC8vIFJlZHVjZWQgb3ZlcmxhcCBwb2ludHMgZm9yIG1vYmlsZVxuICAgIGNvbnN0IGNlbnRlck92ZXJsYXBTY2FsZSA9IGlzTW9iaWxlID8gNCA6IDg7IC8vIFJlZHVjZWQgY2VudGVyIG92ZXJsYXAgZm9yIG1vYmlsZVxuICAgIGNvbnN0IGFtcGxpdHVkZVNjYWxlID0gaXNNb2JpbGUgPyAwLjggOiAwLjk1OyAvLyBTbGlnaHRseSByZWR1Y2VkIGFtcGxpdHVkZSBmb3IgbW9iaWxlXG4gICAgY29uc3QgZWRnZVpvbmVTY2FsZSA9IGlzTW9iaWxlID8gMC4xNSA6IDAuMjsgLy8gQWRqdXN0ZWQgZWRnZSB0YXBlciB6b25lIGZvciBtb2JpbGVcblxuICAgIC8vIEdldCB0aGUgY29tcHV0ZWQgYWNjZW50IGNvbG9yIHdpdGggZmFsbGJhY2tcbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO1xuICAgIGxldCBhY2NlbnRDb2xvciA9IGNvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcIi0tdGV4dC1hY2NlbnRcIikudHJpbSgpO1xuICAgIGlmICghYWNjZW50Q29sb3IpIHtcbiAgICAgIGFjY2VudENvbG9yID0gXCIjNTg3MWVmXCI7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGdyYWRpZW50XG4gICAgY29uc3QgZ3JhZGllbnQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgaGVpZ2h0KTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCwgYWNjZW50Q29sb3IpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjUsIGFjY2VudENvbG9yKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgYWNjZW50Q29sb3IpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDtcblxuICAgIC8vIERyYXcgdGhlIHdhdmVmb3JtXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8oY2VudGVyWCwgY2VudGVyWSk7XG5cbiAgICBjb25zdCBoYWxmQnVmZmVyTGVuZ3RoID0gTWF0aC5mbG9vcihidWZmZXJMZW5ndGggLyAyKTtcbiAgICBjb25zdCBzbGljZVdpZHRoID0gd2lkdGggLyAyIC8gaGFsZkJ1ZmZlckxlbmd0aDtcbiAgICBjb25zdCBjZW50ZXJPdmVybGFwID0gc2xpY2VXaWR0aCAqIGNlbnRlck92ZXJsYXBTY2FsZTtcblxuICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjYWxjdWxhdGUgZWRnZSB0YXBlclxuICAgIGNvbnN0IGdldEVkZ2VUYXBlciA9IChpOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGVkZ2Vab25lID0gdG90YWwgKiBlZGdlWm9uZVNjYWxlO1xuICAgICAgaWYgKGkgPCBlZGdlWm9uZSkge1xuICAgICAgICByZXR1cm4gMC4zICsgMC43ICogKGkgLyBlZGdlWm9uZSk7XG4gICAgICB9IGVsc2UgaWYgKGkgPiB0b3RhbCAtIGVkZ2Vab25lKSB7XG4gICAgICAgIHJldHVybiAwLjMgKyAwLjcgKiAoKHRvdGFsIC0gaSkgLyBlZGdlWm9uZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gMTtcbiAgICB9O1xuXG4gICAgLy8gRHJhdyByaWdodCBzaWRlICh0b3AgaGFsZilcbiAgICBmb3IgKGxldCBpID0gLW92ZXJsYXA7IGkgPCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcDsgaSsrKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGRhdGFBcnJheVtNYXRoLmFicyhpKV0gLyAyNTUuMDtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdID1cbiAgICAgICAgdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiB0aGlzLnNtb290aGluZ0ZhY3RvciArXG4gICAgICAgIHZhbHVlICogKDEgLSB0aGlzLnNtb290aGluZ0ZhY3Rvcik7XG5cbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYICsgaSAqIHNsaWNlV2lkdGggLSBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSAtIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIC8vIERyYXcgcmlnaHQgc2lkZSAoYm90dG9tIGhhbGYpXG4gICAgZm9yIChsZXQgaSA9IGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwIC0gMTsgaSA+PSAtb3ZlcmxhcDsgaS0tKSB7XG4gICAgICBjb25zdCBpbmRleCA9IE1hdGgubWluKE1hdGguYWJzKGkpLCBoYWxmQnVmZmVyTGVuZ3RoIC0gMSk7XG4gICAgICBjb25zdCB4ID0gY2VudGVyWCArIGkgKiBzbGljZVdpZHRoIC0gY2VudGVyT3ZlcmxhcDtcbiAgICAgIGNvbnN0IHRhcGVyID0gZ2V0RWRnZVRhcGVyKGkgKyBvdmVybGFwLCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAqIDIpO1xuICAgICAgY29uc3QgeSA9XG4gICAgICAgIGNlbnRlclkgKyB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIGNlbnRlclkgKiBhbXBsaXR1ZGVTY2FsZSAqIHRhcGVyO1xuICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICB9XG5cbiAgICAvLyBEcmF3IGxlZnQgc2lkZSAoYm90dG9tIGhhbGYpXG4gICAgZm9yIChsZXQgaSA9IC1vdmVybGFwOyBpIDwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXA7IGkrKykge1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihNYXRoLmFicyhpKSwgaGFsZkJ1ZmZlckxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgeCA9IGNlbnRlclggLSBpICogc2xpY2VXaWR0aCArIGNlbnRlck92ZXJsYXA7XG4gICAgICBjb25zdCB0YXBlciA9IGdldEVkZ2VUYXBlcihpICsgb3ZlcmxhcCwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgKiAyKTtcbiAgICAgIGNvbnN0IHkgPVxuICAgICAgICBjZW50ZXJZICsgdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiBjZW50ZXJZICogYW1wbGl0dWRlU2NhbGUgKiB0YXBlcjtcbiAgICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBsZWZ0IHNpZGUgKHRvcCBoYWxmKVxuICAgIGZvciAobGV0IGkgPSBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAtIDE7IGkgPj0gLW92ZXJsYXA7IGktLSkge1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihNYXRoLmFicyhpKSwgaGFsZkJ1ZmZlckxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgeCA9IGNlbnRlclggLSBpICogc2xpY2VXaWR0aCArIGNlbnRlck92ZXJsYXA7XG4gICAgICBjb25zdCB0YXBlciA9IGdldEVkZ2VUYXBlcihpICsgb3ZlcmxhcCwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgKiAyKTtcbiAgICAgIGNvbnN0IHkgPVxuICAgICAgICBjZW50ZXJZIC0gdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiBjZW50ZXJZICogYW1wbGl0dWRlU2NhbGUgKiB0YXBlcjtcbiAgICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5maWxsKCk7XG5cbiAgICAvLyBTY2hlZHVsZSBuZXh0IGZyYW1lIG9ubHkgaWYgc3RpbGwgcmVjb3JkaW5nXG4gICAgaWYgKHRoaXMuaXNSZWNvcmRpbmcpIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5kcmF3KTtcbiAgICB9XG4gIH07XG5cbiAgb25Ub2dnbGUoY2FsbGJhY2s6IChpc1JlY29yZGluZzogYm9vbGVhbikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub25Ub2dnbGVDYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcbiAgfVxuXG4gIHByaXZhdGUgbm90aWZ5TGlzdGVuZXJzKCk6IHZvaWQge1xuICAgIHRoaXMub25Ub2dnbGVDYWxsYmFja3MuZm9yRWFjaCgoY2IpID0+IGNiKHRoaXMuaXNSZWNvcmRpbmcpKTtcbiAgfVxuXG4gIHVubG9hZCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3BSZWNvcmRpbmcoKTtcbiAgICB0aGlzLm9uVG9nZ2xlQ2FsbGJhY2tzLmNsZWFyKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE5vdGljZSwgc2V0SWNvbiwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1RyYW5zY3JpcHRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IFBvc3RQcm9jZXNzaW5nU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9Qb3N0UHJvY2Vzc2luZ1NlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBBdWRpb1RyYW5zY3JpcHRpb25Qcm9ncmVzcyB7XG4gIHByb2dyZXNzOiBudW1iZXI7XG4gIHN0YXR1czogc3RyaW5nO1xuICBpY29uOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXVkaW9UcmFuc2NyaXB0aW9uT3B0aW9ucyB7XG4gIGZpbGU6IFRGaWxlO1xuICB0aW1lc3RhbXBlZD86IGJvb2xlYW47XG4gIGlzQ2hhdD86IGJvb2xlYW47XG4gIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlPzogKHRleHQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG59XG5cbmNsYXNzIFBlcnNpc3RlbnRUcmFuc2NyaXB0aW9uTm90aWNlIGV4dGVuZHMgTm90aWNlIHtcbiAgcHJpdmF0ZSBwcm9ncmVzc0JhcjogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgc3RhdHVzVGV4dDogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgc3RhdHVzSWNvbjogSFRNTERpdkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoXCJcIiwgMCk7IC8vIE5ldmVyIGF1dG8taGlkZVxuICAgIHRoaXMubm90aWNlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtdHJhbnNjcmlwdGlvbi1ub3RpY2VcIik7XG5cbiAgICAvLyBDcmVhdGUgcHJvZ3Jlc3MgY29udGFpbmVyXG4gICAgY29uc3QgcHJvZ3Jlc3NDb250YWluZXIgPSB0aGlzLm5vdGljZUVsLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tcHJvZ3Jlc3NcIik7XG5cbiAgICAvLyBBZGQgc3RhdHVzIGNvbnRhaW5lciB3aXRoIGljb24gYW5kIHRleHRcbiAgICBjb25zdCBzdGF0dXNDb250YWluZXIgPSBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoXCJ0cmFuc2NyaXB0aW9uLXN0YXR1c1wiKTtcbiAgICB0aGlzLnN0YXR1c0ljb24gPSBzdGF0dXNDb250YWluZXIuY3JlYXRlRGl2KFwidHJhbnNjcmlwdGlvbi1zdGF0dXMtaWNvblwiKTtcbiAgICB0aGlzLnN0YXR1c1RleHQgPSBzdGF0dXNDb250YWluZXIuY3JlYXRlRGl2KFwidHJhbnNjcmlwdGlvbi1zdGF0dXMtdGV4dFwiKTtcblxuICAgIC8vIEFkZCBwcm9ncmVzcyBiYXJcbiAgICBjb25zdCBwcm9ncmVzc0JhckNvbnRhaW5lciA9IHByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwidHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXItY29udGFpbmVyXCJcbiAgICApO1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBwcm9ncmVzc0JhckNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIHN0eWxlcyBpZiBub3QgYWxyZWFkeSBhZGRlZFxuICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzeXN0ZW1zY3VscHQtdHJhbnNjcmlwdGlvbi1ub3RpY2Utc3R5bGVzXCIpKSB7XG4gICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgICAgIHN0eWxlLmlkID0gXCJzeXN0ZW1zY3VscHQtdHJhbnNjcmlwdGlvbi1ub3RpY2Utc3R5bGVzXCI7XG4gICAgICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAgICAgLnN5c3RlbXNjdWxwdC10cmFuc2NyaXB0aW9uLW5vdGljZSB7XG4gICAgICAgICAgcGFkZGluZzogOHB4IDEycHggIWltcG9ydGFudDtcbiAgICAgICAgICBtaW4td2lkdGg6IDI2MHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3Mge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICAgICAgICBnYXA6IDhweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXN0YXR1cyB7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgIGdhcDogOHB4O1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1zdGF0dXMtaWNvbiB7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWFjY2VudCk7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1zdGF0dXMtdGV4dCB7XG4gICAgICAgICAgZmxleDogMTtcbiAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXItY29udGFpbmVyIHtcbiAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICBoZWlnaHQ6IDRweDtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogMnB4O1xuICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXIge1xuICAgICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS10ZXh0LWFjY2VudCk7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogMnB4O1xuICAgICAgICAgIHRyYW5zaXRpb246IHdpZHRoIDAuM3MgZWFzZTtcbiAgICAgICAgICB3aWR0aDogMCU7XG4gICAgICAgIH1cblxuICAgICAgICAubm90aWNlLXN1Y2Nlc3MgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS10ZXh0LXN1Y2Nlc3MpICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cblxuICAgICAgICAubm90aWNlLWVycm9yIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1lcnJvcikgIWltcG9ydGFudDtcbiAgICAgICAgfVxuICAgICAgYDtcbiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVByb2dyZXNzKHsgcHJvZ3Jlc3MsIHN0YXR1cywgaWNvbiB9OiBBdWRpb1RyYW5zY3JpcHRpb25Qcm9ncmVzcykge1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBgJHtwcm9ncmVzc30lYDtcbiAgICB0aGlzLnN0YXR1c1RleHQuc2V0VGV4dChzdGF0dXMpO1xuICAgIHRoaXMuc3RhdHVzSWNvbi5lbXB0eSgpO1xuICAgIHNldEljb24odGhpcy5zdGF0dXNJY29uLCBpY29uKTtcblxuICAgIC8vIFVwZGF0ZSBub3RpY2UgY2xhc3MgYmFzZWQgb24gc3RhdHVzXG4gICAgdGhpcy5ub3RpY2VFbC5yZW1vdmVDbGFzcyhcIm5vdGljZS1zdWNjZXNzXCIsIFwibm90aWNlLWVycm9yXCIpO1xuICAgIGlmIChwcm9ncmVzcyA9PT0gMTAwKSB7XG4gICAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwibm90aWNlLXN1Y2Nlc3NcIik7XG4gICAgfSBlbHNlIGlmIChwcm9ncmVzcyA9PT0gMCAmJiBpY29uID09PSBcIngtY2lyY2xlXCIpIHtcbiAgICAgIHRoaXMubm90aWNlRWwuYWRkQ2xhc3MoXCJub3RpY2UtZXJyb3JcIik7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCB7XG4gIHByaXZhdGUgdHJhbnNjcmlwdGlvblNlcnZpY2U6IFRyYW5zY3JpcHRpb25TZXJ2aWNlO1xuICBwcml2YXRlIHBvc3RQcm9jZXNzaW5nU2VydmljZTogUG9zdFByb2Nlc3NpbmdTZXJ2aWNlO1xuICBwcml2YXRlIG9wdGlvbnM6IEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnM7XG4gIHByaXZhdGUgbm90aWNlOiBQZXJzaXN0ZW50VHJhbnNjcmlwdGlvbk5vdGljZTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgb3B0aW9uczogQXVkaW9UcmFuc2NyaXB0aW9uT3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZSA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgb3B0aW9ucy5wbHVnaW5cbiAgICApO1xuICAgIHRoaXMucG9zdFByb2Nlc3NpbmdTZXJ2aWNlID0gUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgb3B0aW9ucy5wbHVnaW5cbiAgICApO1xuICB9XG5cbiAgb3BlbigpIHtcbiAgICB0aGlzLm5vdGljZSA9IG5ldyBQZXJzaXN0ZW50VHJhbnNjcmlwdGlvbk5vdGljZSgpO1xuICAgIHRoaXMuc3RhcnRUcmFuc2NyaXB0aW9uKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHN0YXJ0VHJhbnNjcmlwdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgLy8gU2hvdyBpbml0aWFsIHN0YXR1c1xuICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgc3RhdHVzOiBcIlN0YXJ0aW5nIHRyYW5zY3JpcHRpb24uLi5cIixcbiAgICAgICAgaWNvbjogXCJtaWNcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlRmlsZShcbiAgICAgICAgdGhpcy5vcHRpb25zLmZpbGUsXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiB0aGlzLm9wdGlvbnMuaXNDaGF0ID8gXCJjaGF0XCIgOiBcIm5vdGVcIixcbiAgICAgICAgICB0aW1lc3RhbXBlZDogdGhpcy5vcHRpb25zLnRpbWVzdGFtcGVkLFxuICAgICAgICAgIG9uUHJvZ3Jlc3M6IChwcm9ncmVzcywgc3RhdHVzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgICAgICAgIHByb2dyZXNzLFxuICAgICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICAgIGljb246IFwiYXVkaW8tbGluZXNcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmICghdGV4dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHRyYW5zY3JpcHRpb24gdGV4dFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgcG9zdC1wcm9jZXNzaW5nIGlzIGVuYWJsZWQsIHByb2Nlc3MgdGhlIHRleHRcbiAgICAgIGxldCBmaW5hbFRleHQgPSB0ZXh0O1xuICAgICAgbGV0IHByb2Nlc3NlZFRleHQgPSBcIlwiO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wbHVnaW4uc2V0dGluZ3MucG9zdFByb2Nlc3NpbmdFbmFibGVkKSB7XG4gICAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgICBwcm9ncmVzczogODAsXG4gICAgICAgICAgc3RhdHVzOiBcIlBvc3QtcHJvY2Vzc2luZyB0cmFuc2NyaXB0aW9uLi4uXCIsXG4gICAgICAgICAgaWNvbjogXCJ3YW5kXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBwcm9jZXNzZWRUZXh0ID0gYXdhaXQgdGhpcy5wb3N0UHJvY2Vzc2luZ1NlcnZpY2UucHJvY2Vzc1RyYW5zY3JpcHRpb24oXG4gICAgICAgICAgdGV4dFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEZvcm1hdCB0aGUgZmluYWwgdGV4dCB3aXRoIGJvdGggdmVyc2lvbnNcbiAgICAgICAgZmluYWxUZXh0ID0gYCMgQXVkaW8gVHJhbnNjcmlwdGlvblxuU291cmNlOiAke3RoaXMub3B0aW9ucy5maWxlLmJhc2VuYW1lfVxuVHJhbnNjcmliZWQ6ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4jIyBSYXcgVHJhbnNjcmlwdGlvblxuJHt0ZXh0fVxuXG4jIyBQcm9jZXNzZWQgVHJhbnNjcmlwdGlvblxuJHtwcm9jZXNzZWRUZXh0fWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBwb3N0LXByb2Nlc3NpbmcgaXMgZGlzYWJsZWQsIGp1c3Qgc2hvdyB0aGUgcmF3IHRyYW5zY3JpcHRpb25cbiAgICAgICAgZmluYWxUZXh0ID0gYCMgQXVkaW8gVHJhbnNjcmlwdGlvblxuU291cmNlOiAke3RoaXMub3B0aW9ucy5maWxlLmJhc2VuYW1lfVxuVHJhbnNjcmliZWQ6ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4jIyBSYXcgVHJhbnNjcmlwdGlvblxuJHt0ZXh0fWA7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgdGhlIGNvbXBsZXRpb24gY2FsbGJhY2sgaWYgcHJvdmlkZWRcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKGZpbmFsVGV4dCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvcHkgdGV4dCB0byBjbGlwYm9hcmRcbiAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGZpbmFsVGV4dCk7XG5cbiAgICAgIC8vIFNob3cgc3VjY2VzcyBtZXNzYWdlXG4gICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgIHByb2dyZXNzOiAxMDAsXG4gICAgICAgIHN0YXR1czogXCJUcmFuc2NyaXB0aW9uIGNvbXBsZXRlIVwiLFxuICAgICAgICBpY29uOiBcImNoZWNrLWNpcmNsZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEhpZGUgbm90aWNlIGFmdGVyIHN1Y2Nlc3NcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLm5vdGljZS5oaWRlKCk7XG4gICAgICB9LCAyMDAwKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgIHN0YXR1czogYEVycm9yOiAke1xuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgICAgICB9YCxcbiAgICAgICAgaWNvbjogXCJ4LWNpcmNsZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEhpZGUgbm90aWNlIGFmdGVyIGVycm9yXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5ub3RpY2UuaGlkZSgpO1xuICAgICAgfSwgNDAwMCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwoXG4gIGFwcDogQXBwLFxuICBvcHRpb25zOiBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwoYXBwLCBvcHRpb25zKTtcbiAgbW9kYWwub3BlbigpO1xufVxuIiwgImltcG9ydCB7IFBsdWdpbiwgTm90aWNlLCBNZW51LCBURmlsZSwgTWFya2Rvd25WaWV3IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4vU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcblxuLy8gTWF0Y2ggc2VydmVyLXNpZGUgY29uZmlndXJhdGlvblxuY29uc3QgU1VQUE9SVEVEX0FVRElPX0VYVEVOU0lPTlMgPSBbXCJ3YXZcIiwgXCJtNGFcIiwgXCJ3ZWJtXCIsIFwib2dnXCIsIFwibXAzXCJdO1xuY29uc3QgTUlNRV9UWVBFX01BUCA9IHtcbiAgd2F2OiBcImF1ZGlvL3dhdlwiLFxuICBtNGE6IFwiYXVkaW8vbXA0XCIsXG4gIHdlYm06IFwiYXVkaW8vd2VibVwiLFxuICBvZ2c6IFwiYXVkaW8vb2dnO2NvZGVjcz1vcHVzXCIsXG4gIG1wMzogXCJhdWRpby9tcGVnXCIsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zY3JpcHRpb25Db250ZXh0IHtcbiAgdHlwZTogXCJub3RlXCIgfCBcImNoYXRcIjtcbiAgdGltZXN0YW1wZWQ/OiBib29sZWFuO1xuICBvblByb2dyZXNzPzogKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgVHJhbnNjcmlwdGlvblNlcnZpY2Uge1xuICBwcml2YXRlIHBsdWdpbjogUGx1Z2luICYgeyBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MgfTtcbiAgcHJpdmF0ZSBpc1RyYW5zY3JpYmluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogVHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHBsdWdpbjogUGx1Z2luICYgeyBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBwbHVnaW4uc2V0dGluZ3MsXG4gICAgICBwbHVnaW4uYXBwXG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShcbiAgICBwbHVnaW46IFBsdWdpbiAmIHsgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzIH1cbiAgKTogVHJhbnNjcmlwdGlvblNlcnZpY2Uge1xuICAgIGlmICghVHJhbnNjcmlwdGlvblNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFRyYW5zY3JpcHRpb25TZXJ2aWNlLmluc3RhbmNlID0gbmV3IFRyYW5zY3JpcHRpb25TZXJ2aWNlKHBsdWdpbik7XG4gICAgfVxuICAgIHJldHVybiBUcmFuc2NyaXB0aW9uU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcGFyc2VFcnJvclJlc3BvbnNlKFxuICAgIHJlc3BvbnNlOiBSZXNwb25zZVxuICApOiBQcm9taXNlPHsgbWVzc2FnZTogc3RyaW5nOyBkYXRhPzogYW55IH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YS5lcnJvciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIHJldHVybiB7IG1lc3NhZ2U6IGRhdGEuZXJyb3IsIGRhdGEgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS5lcnJvci5tZXNzYWdlKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogZGF0YS5lcnJvci5tZXNzYWdlLCBkYXRhIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZGF0YS5lcnJvciksIGRhdGEgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IG1lc3NhZ2U6IHJlc3BvbnNlLnN0YXR1c1RleHQsIGRhdGEgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4geyBtZXNzYWdlOiByZXNwb25zZS5zdGF0dXNUZXh0IH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdHJhbnNjcmliZUZpbGUoXG4gICAgZmlsZTogVEZpbGUsXG4gICAgY29udGV4dD86IFRyYW5zY3JpcHRpb25Db250ZXh0XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc29sZS5sb2coXCJUcmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlRmlsZSBjYWxsZWQgd2l0aDpcIiwge1xuICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSxcbiAgICAgIGNvbnRleHQsXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5pc1RyYW5zY3JpYmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSB0cmFuc2NyaWJpbmcgYSBmaWxlXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCFTVVBQT1JURURfQVVESU9fRVhURU5TSU9OUy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGZpbGUgdHlwZTogJHtleHRlbnNpb259YCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc1RyYW5zY3JpYmluZyA9IHRydWU7XG5cbiAgICAvLyBSZXBvcnQgaW5pdGlhbCBwcm9ncmVzc1xuICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/LigwLCBcIlJlYWRpbmcgYXVkaW8gZmlsZS4uLlwiKTtcblxuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHtcbiAgICAgIHR5cGU6IE1JTUVfVFlQRV9NQVBbZXh0ZW5zaW9uIGFzIGtleW9mIHR5cGVvZiBNSU1FX1RZUEVfTUFQXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBibG9iLCBmaWxlLm5hbWUpO1xuICAgIGlmIChjb250ZXh0Py50aW1lc3RhbXBlZCkge1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwidGltZXN0YW1wZWRcIiwgXCJ0cnVlXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBSZXBvcnQgdXBsb2FkIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMjAsIFwiVXBsb2FkaW5nIGF1ZGlvLi4uXCIpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zYCxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc29sZS5sb2coXCJSYXcgc2VydmVyIHJlc3BvbnNlOlwiLCB7XG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICBvazogcmVzcG9uc2Uub2ssXG4gICAgICAgIGNvbnRlbnRUeXBlOiByZXNwb25zZS5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSxcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgZGF0YTogYW55O1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgZGF0YTogcGFyc2VkRGF0YSB9ID1cbiAgICAgICAgICBhd2FpdCB0aGlzLnBhcnNlRXJyb3JSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgcmVzcG9uc2UgcGFyc2VkOlwiLCB7IGVycm9yTWVzc2FnZSwgcGFyc2VkRGF0YSB9KTtcbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlOiBDUkVESVRfVVBEQVRFIGlzIGFjdHVhbGx5IGEgc3VjY2Vzc1xuICAgICAgICBpZiAoXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDAgJiZcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPT09IFwiQ3JlZGl0cyBjaGFyZ2VkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIENvbnRpbnVlIHByb2Nlc3NpbmcgLSB0aGlzIGlzIG5vdCBhY3R1YWxseSBhbiBlcnJvclxuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJDcmVkaXRzIGNoYXJnZWQgc3VjY2Vzc2Z1bGx5LCBjb250aW51aW5nIHdpdGggdHJhbnNjcmlwdGlvbi4uLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBkYXRhID0gcGFyc2VkRGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgRmFpbGVkIHRvIHRyYW5zY3JpYmUgZmlsZTogJHtyZXNwb25zZS5zdGF0dXN9IC0gJHtlcnJvck1lc3NhZ2V9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJSYXcgcmVzcG9uc2UgdGV4dDpcIiwgcmVzcG9uc2VUZXh0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGFyc2VkIHJlc3BvbnNlIGRhdGE6XCIsIGRhdGEpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSByZXNwb25zZSBKU09OOlwiLCBlKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIEpTT04gcmVzcG9uc2UgZnJvbSBzZXJ2ZXJcIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVwb3J0IHByb2Nlc3NpbmcgcHJvZ3Jlc3NcbiAgICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/Lig2MCwgXCJQcm9jZXNzaW5nIGF1ZGlvLi4uXCIpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIkZpbmFsIGRhdGEgb2JqZWN0OlwiLCB7XG4gICAgICAgIGhhc0RhdGE6ICEhZGF0YSxcbiAgICAgICAgZGF0YVR5cGU6IHR5cGVvZiBkYXRhLFxuICAgICAgICBrZXlzOiBkYXRhID8gT2JqZWN0LmtleXMoZGF0YSkgOiBudWxsLFxuICAgICAgICB0ZXh0VHlwZTogZGF0YT8udGV4dCA/IHR5cGVvZiBkYXRhLnRleHQgOiBudWxsLFxuICAgICAgICB0ZXh0TGVuZ3RoOiBkYXRhPy50ZXh0ID8gZGF0YS50ZXh0Lmxlbmd0aCA6IG51bGwsXG4gICAgICAgIHRleHRQcmV2aWV3OiBkYXRhPy50ZXh0ID8gZGF0YS50ZXh0LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIiA6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgdmFsaWQgdHJhbnNjcmlwdGlvbiB0ZXh0XG4gICAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEudGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCByZXNwb25zZSBkYXRhOlwiLCBkYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdHJhbnNjcmlwdGlvbiB0ZXh0IHJlY2VpdmVkIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSB0ZXh0IGlzIG5vdCBlbXB0eSBhZnRlciB0cmltbWluZ1xuICAgICAgY29uc3QgdHJpbW1lZFRleHQgPSBkYXRhLnRleHQudHJpbSgpO1xuICAgICAgY29uc29sZS5sb2coXCJUcmltbWVkIHRleHQ6XCIsIHtcbiAgICAgICAgbGVuZ3RoOiB0cmltbWVkVGV4dC5sZW5ndGgsXG4gICAgICAgIHByZXZpZXc6IHRyaW1tZWRUZXh0LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRyaW1tZWRUZXh0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFbXB0eSB0cmFuc2NyaXB0aW9uIHRleHQgYWZ0ZXIgdHJpbW1pbmc6XCIsIGRhdGEpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbXB0eSB0cmFuc2NyaXB0aW9uIHRleHQgcmVjZWl2ZWQgZnJvbSBzZXJ2ZXJcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIExvZyBjb3N0IGluZm9ybWF0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgaWYgKGRhdGEuY29zdF9pbmZvKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVHJhbnNjcmlwdGlvbiBjb3N0IGRldGFpbHM6XCIsIHtcbiAgICAgICAgICBkdXJhdGlvbjogYCR7ZGF0YS5jb3N0X2luZm8uYXVkaW9fZHVyYXRpb25fc2Vjb25kc31zICgke2RhdGEuY29zdF9pbmZvLmF1ZGlvX2R1cmF0aW9uX2hvdXJzfWgpYCxcbiAgICAgICAgICByYXdfY29zdDogYCQke2RhdGEuY29zdF9pbmZvLnJhd19jb3N0X3VzZC50b0ZpeGVkKDQpfWAsXG4gICAgICAgICAgbWFya3VwX3JhdGU6IGAkeyhkYXRhLmNvc3RfaW5mby5tYXJrdXBfcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYCxcbiAgICAgICAgICBmaW5hbF9jb3N0OiBgJHtkYXRhLmNvc3RfaW5mby5maW5hbF9jb3N0X2NyZWRpdHN9IGNyZWRpdHNgLFxuICAgICAgICAgIGZpbGVfc2l6ZTogYCR7KGRhdGEuY29zdF9pbmZvLmZpbGVfc2l6ZV9ieXRlcyAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKFxuICAgICAgICAgICAgMlxuICAgICAgICAgICl9TUJgLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwb3J0IGNvbXBsZXRpb24gcHJvZ3Jlc3NcbiAgICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/LigxMDAsIFwiVHJhbnNjcmlwdGlvbiBjb21wbGV0ZSFcIik7XG5cbiAgICAgIHJldHVybiB0cmltbWVkVGV4dDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzVHJhbnNjcmliaW5nID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgdW5sb2FkKCkge1xuICAgIC8vIE5vdGhpbmcgdG8gdW5sb2FkIGN1cnJlbnRseVxuICB9XG59XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIFBvc3RQcm9jZXNzaW5nU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQb3N0UHJvY2Vzc2luZ1NlcnZpY2U7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBkZWZhdWx0TW9kZWxJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHBsdWdpbi5hcHBcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKTogUG9zdFByb2Nlc3NpbmdTZXJ2aWNlIHtcbiAgICBpZiAoIVBvc3RQcm9jZXNzaW5nU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFBvc3RQcm9jZXNzaW5nU2VydmljZShwbHVnaW4pO1xuICAgIH1cbiAgICByZXR1cm4gUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmaW5kRGVmYXVsdE1vZGVsKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKHRoaXMuZGVmYXVsdE1vZGVsSWQpIHJldHVybiB0aGlzLmRlZmF1bHRNb2RlbElkO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMuc2N1bHB0U2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgIGNvbnN0IGRlZmF1bHRNb2RlbCA9IG1vZGVscy5maW5kKChtb2RlbCkgPT5cbiAgICAgICAgbW9kZWwubmFtZT8ubWF0Y2goL1xcKERlZmF1bHRcXCkvaSlcbiAgICAgICk7XG4gICAgICBpZiAoIWRlZmF1bHRNb2RlbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEZWZhdWx0IG1vZGVsIG5vdCBmb3VuZFwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGVmYXVsdE1vZGVsSWQgPSBkZWZhdWx0TW9kZWwuaWQ7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsLmlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmluZGluZyBkZWZhdWx0IG1vZGVsOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBwcm9jZXNzVHJhbnNjcmlwdGlvbih0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MucG9zdFByb2Nlc3NpbmdFbmFibGVkKSB7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxJZCA9IGF3YWl0IHRoaXMuZmluZERlZmF1bHRNb2RlbCgpO1xuICAgICAgY29uc3QgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0LFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiB0ZXh0LFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBsZXQgcHJvY2Vzc2VkVGV4dCA9IFwiXCI7XG4gICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHRoaXMuc2N1bHB0U2VydmljZS5zdHJlYW1NZXNzYWdlKHtcbiAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgIG1vZGVsOiBtb2RlbElkLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4zLCAvLyBMb3dlciB0ZW1wZXJhdHVyZSBmb3IgbW9yZSBjb25zaXN0ZW50IG91dHB1dFxuICAgICAgfSkpIHtcbiAgICAgICAgaWYgKGNodW5rLmNvbnRlbnQpIHtcbiAgICAgICAgICBwcm9jZXNzZWRUZXh0ICs9IGNodW5rLmNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByb2Nlc3NlZFRleHQudHJpbSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcG9zdC1wcm9jZXNzaW5nIHRyYW5zY3JpcHRpb246XCIsIGVycm9yKTtcbiAgICAgIC8vIE9uIGVycm9yLCByZXR1cm4gb3JpZ2luYWwgdGV4dFxuICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgSXRlbVZpZXcsIFdvcmtzcGFjZUxlYWYsIFRGaWxlLCBURm9sZGVyLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UsIENoYXRSb2xlLCBNdWx0aVBhcnRDb250ZW50LCBQQVRSRU9OX1VSTCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgQ2hhdFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL0NoYXRTdG9yYWdlU2VydmljZVwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuLi9tb2RhbHMvTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHtcbiAgc2hvd0VuaGFuY2VkTm90aWNlLFxuICBzaG93UG9wdXAsXG4gIHNob3dOb3RpY2UsXG4gIHNob3dBbGVydCxcbn0gZnJvbSBcIi4uL2NvcmUvdWkvXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuLi91dGlscy9lcnJvcnNcIjtcbmltcG9ydCB7IERyYXdlckNvbXBvbmVudCB9IGZyb20gXCIuL2NvbXBvbmVudHMvRHJhd2VyQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBNZXNzYWdlUmVuZGVyZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL01lc3NhZ2VSZW5kZXJlclwiO1xuaW1wb3J0IHsgSW5wdXRIYW5kbGVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9JbnB1dEhhbmRsZXJcIjtcbmltcG9ydCB7IEZpbGVDb250ZXh0TWFuYWdlciB9IGZyb20gXCIuL2NvbXBvbmVudHMvRmlsZUNvbnRleHRNYW5hZ2VyXCI7XG5pbXBvcnQgeyBzaG93U3lzdGVtUHJvbXB0TW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL1N5c3RlbVByb21wdE1vZGFsXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7IExvYWRDaGF0TW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0xvYWRDaGF0TW9kYWxcIjtcbmltcG9ydCB7IFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGNvbnN0IENIQVRfVklFV19UWVBFID0gXCJzeXN0ZW1zY3VscHQtY2hhdC12aWV3XCI7XG5cbmV4cG9ydCBjbGFzcyBDaGF0VmlldyBleHRlbmRzIEl0ZW1WaWV3IHtcbiAgcHJpdmF0ZSBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtdO1xuICBwcml2YXRlIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBjaGF0U3RvcmFnZTogQ2hhdFN0b3JhZ2VTZXJ2aWNlO1xuICBwcml2YXRlIGNoYXRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGlucHV0SGFuZGxlcjogSW5wdXRIYW5kbGVyO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGNoYXRJZDogc3RyaW5nO1xuICBwcml2YXRlIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICBwcml2YXRlIG1vZGVsSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXJyZW50TW9kZWxOYW1lOiBzdHJpbmcgPSBcIlwiO1xuICBwcml2YXRlIGlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICBwcml2YXRlIGNvbnRleHRNYW5hZ2VyOiBGaWxlQ29udGV4dE1hbmFnZXI7XG4gIHByaXZhdGUgcmVmcmVzaEludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGxhc3RSZWZyZXNoVGltZSA9IDA7XG4gIHByaXZhdGUgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIHByaXZhdGUgbGF5b3V0Q2hhbmdlSGFuZGxlcjogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBhd2FpdGluZ1N0YXRlUmVzdG9yZSA9IGZhbHNlO1xuICBwcml2YXRlIGFjdGlvbnNEcmF3ZXI6IERyYXdlckNvbXBvbmVudDtcbiAgcHJpdmF0ZSBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgLyoqXG4gICAqIHN5c3RlbVByb21wdFR5cGUgYW5kIHN5c3RlbVByb21wdFBhdGggYXJlIHRoZSBkZWZhdWx0IHN5c3RlbSBwcm9tcHQgZm9yIHRoaXMgY2hhdFxuICAgKiBpZiB0aGUgdXNlciBoYXMgbm90IG92ZXJyaWRkZW4gdGhlbSB5ZXQuXG4gICAqL1xuICBwcml2YXRlIHN5c3RlbVByb21wdFR5cGU6IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIjtcbiAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nO1xuICBwcml2YXRlIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gIHByaXZhdGUgY2hhdFRpdGxlOiBzdHJpbmcgPSBcIlVudGl0bGVkIENoYXRcIjtcbiAgcHJpdmF0ZSB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihsZWFmOiBXb3Jrc3BhY2VMZWFmLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHN1cGVyKGxlYWYpO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuYWlTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShwbHVnaW4uc2V0dGluZ3MsIHRoaXMuYXBwKTtcbiAgICB0aGlzLmNoYXRTdG9yYWdlID0gbmV3IENoYXRTdG9yYWdlU2VydmljZShcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgcGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5XG4gICAgKTtcbiAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IHBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQ7XG4gICAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuICAgIHRoaXMubGFzdFJlZnJlc2hUaW1lID0gMDtcbiAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgIHRoaXMuYXdhaXRpbmdTdGF0ZVJlc3RvcmUgPSB0cnVlO1xuICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyID0gbmV3IE1lc3NhZ2VSZW5kZXJlcih0aGlzLmFwcCk7XG5cbiAgICAvLyBJbnN0ZWFkIG9mIG1hdGNoaW5nIHByZXNldHMsIHJlYWQgZnJvbSBwbHVnaW4gc2V0dGluZ3M6XG4gICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID1cbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFR5cGUgfHwgXCJnZW5lcmFsLXVzZVwiO1xuICAgIGlmIChcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aFxuICAgICkge1xuICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoID0gdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHRoaXMubGF5b3V0Q2hhbmdlSGFuZGxlciA9IHRoaXMub25MYXlvdXRDaGFuZ2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGdldFZpZXdUeXBlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIENIQVRfVklFV19UWVBFO1xuICB9XG5cbiAgZ2V0RGlzcGxheVRleHQoKTogc3RyaW5nIHtcbiAgICBjb25zdCBhbGxDaGF0cyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoQ0hBVF9WSUVXX1RZUEUpO1xuXG4gICAgLy8gSWYgdGhlcmUncyBvbmx5IG9uZSBjaGF0LCBqdXN0IHNob3cgdGhlIHRpdGxlXG4gICAgaWYgKGFsbENoYXRzLmxlbmd0aCA8PSAxKSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGF0VGl0bGU7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGNoYXRzLCBhcHBlbmQgYSBudW1iZXJcbiAgICBjb25zdCBjaGF0TnVtYmVyID0gYWxsQ2hhdHMuaW5kZXhPZih0aGlzLmxlYWYpICsgMTtcbiAgICByZXR1cm4gYCR7dGhpcy5jaGF0VGl0bGV9ICR7Y2hhdE51bWJlcn1gO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyRWwuY2hpbGRyZW5bMV0gYXMgSFRNTEVsZW1lbnQ7XG4gICAgY29udGFpbmVyLmVtcHR5KCk7XG4gICAgY29udGFpbmVyLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWNoYXQtY29udGFpbmVyXCIpO1xuXG4gICAgLy8gQWRkIGRyYWcgYW5kIGRyb3AgZXZlbnQgaGFuZGxlcnNcbiAgICB0aGlzLnNldHVwRHJhZ0FuZERyb3AoY29udGFpbmVyKTtcblxuICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGVhZGVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCB0b3BSb3cgPSBoZWFkZXJDb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlci10b3BcIixcbiAgICB9KTtcblxuICAgIHRoaXMubW9kZWxJbmRpY2F0b3IgPSB0b3BSb3cuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmRpY2F0b3JcIixcbiAgICAgIHRleHQ6IGBDdXJyZW50IE1vZGVsOiAke3RoaXMuc2VsZWN0ZWRNb2RlbElkfWAsXG4gICAgfSk7XG5cbiAgICB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG5cbiAgICB0aGlzLmFjdGlvbnNEcmF3ZXIgPSBuZXcgRHJhd2VyQ29tcG9uZW50KHtcbiAgICAgIGNvbnRhaW5lcjogdG9wUm93LFxuICAgICAgdGl0bGU6IFwiQWN0aW9uc1wiLFxuICAgIH0pO1xuICAgIGNvbnN0IGFjdGlvbnNDb250ZW50ID0gdGhpcy5hY3Rpb25zRHJhd2VyLmdldENvbnRlbnQoKTtcblxuICAgIGNvbnN0IG9wZW5IaXN0b3J5QWN0aW9uID0gYWN0aW9uc0NvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgdGV4dDogXCJPcGVuIENoYXQgSGlzdG9yeSBGaWxlXCIsXG4gICAgfSk7XG4gICAgb3Blbkhpc3RvcnlBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdHNEaXJlY3Rvcnl9LyR7dGhpcy5jaGF0SWR9Lm1kYDtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKGZpbGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgbG9hZERpZmZlcmVudENoYXRBY3Rpb24gPSBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtXCIsXG4gICAgICB0ZXh0OiBcIkxvYWQgQSBEaWZmZXJlbnQgQ2hhdFwiLFxuICAgIH0pO1xuICAgIGxvYWREaWZmZXJlbnRDaGF0QWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgbmV3IGxlYWYvdGFiXG4gICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYodHJ1ZSk7XG4gICAgICAvLyBPcGVuIExvYWRDaGF0TW9kYWwgd2l0aCBjYWxsYmFjayB0byBsb2FkIHNlbGVjdGVkIGNoYXQgaW4gbmV3IGxlYWZcbiAgICAgIG5ldyBMb2FkQ2hhdE1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgYXN5bmMgKGNoYXRJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgY29uc3QgdmlldyA9IGF3YWl0IGxlYWYuc2V0Vmlld1N0YXRlKHtcbiAgICAgICAgICAgIHR5cGU6IENIQVRfVklFV19UWVBFLFxuICAgICAgICAgICAgc3RhdGU6IHsgY2hhdElkIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8gQWN0aXZhdGUgdGhlIG5ldyBsZWFmXG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZik7XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucGx1Z2luXG4gICAgICApLm9wZW4oKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvcHlDaGF0QWN0aW9uID0gYWN0aW9uc0NvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgdGV4dDogXCJDb3B5IENoYXQgdG8gQ2xpcGJvYXJkXCIsXG4gICAgfSk7XG4gICAgY29weUNoYXRBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMuY29weVRvQ2xpcGJvYXJkKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZWxldGVDaGF0QWN0aW9uID0gYWN0aW9uc0NvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbSBzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW0tZGFuZ2VyXCIsXG4gICAgICB0ZXh0OiBcIkRlbGV0ZSBUaGlzIENoYXRcIixcbiAgICB9KTtcbiAgICBkZWxldGVDaGF0QWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxldGVDb25maXJtZWQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBjaGF0P1wiLFxuICAgICAgICB7XG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJEZWxldGVcIixcbiAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmIChkZWxldGVDb25maXJtZWQ/LmNvbmZpcm1lZCkge1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5fS8ke3RoaXMuY2hhdElkfS5tZGA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuZGVsZXRlKGZpbGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGVhZi5kZXRhY2goKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGJvdHRvbVJvdyA9IGhlYWRlckNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGVhZGVyLWJvdHRvbVwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5jb250ZXh0TWFuYWdlciA9IG5ldyBGaWxlQ29udGV4dE1hbmFnZXIoe1xuICAgICAgYXBwOiB0aGlzLmFwcCxcbiAgICAgIGNvbnRhaW5lcjogYm90dG9tUm93LFxuICAgICAgb25Db250ZXh0Q2hhbmdlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5jaGVja1N5bmNTdGF0dXMoKTtcbiAgICAgIH0sXG4gICAgICBzY3VscHRTZXJ2aWNlOiB0aGlzLmFpU2VydmljZSxcbiAgICAgIHBsdWdpbjogdGhpcy5wbHVnaW4sXG4gICAgfSk7XG5cbiAgICB0aGlzLmNoYXRDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlcy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIHRoaXMuc2Nyb2xsTWFuYWdlciA9IG5ldyBTY3JvbGxNYW5hZ2VyU2VydmljZSh7XG4gICAgICBjb250YWluZXI6IHRoaXMuY2hhdENvbnRhaW5lcixcbiAgICB9KTtcblxuICAgIHRoaXMuaW5wdXRIYW5kbGVyID0gbmV3IElucHV0SGFuZGxlcih7XG4gICAgICBhcHA6IHRoaXMuYXBwLFxuICAgICAgY29udGFpbmVyLFxuICAgICAgYWlTZXJ2aWNlOiB0aGlzLmFpU2VydmljZSxcbiAgICAgIGdldE1lc3NhZ2VzOiAoKSA9PiBbLi4udGhpcy5tZXNzYWdlc10sXG4gICAgICBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLFxuICAgICAgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiAoe1xuICAgICAgICB0eXBlOiB0aGlzLnN5c3RlbVByb21wdFR5cGUsXG4gICAgICAgIHBhdGg6IHRoaXMuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pLFxuICAgICAgY2hhdENvbnRhaW5lcjogdGhpcy5jaGF0Q29udGFpbmVyLFxuICAgICAgc2Nyb2xsTWFuYWdlcjogdGhpcy5zY3JvbGxNYW5hZ2VyLFxuICAgICAgbWVzc2FnZVJlbmRlcmVyOiB0aGlzLm1lc3NhZ2VSZW5kZXJlcixcbiAgICAgIG9uTWVzc2FnZVN1Ym1pdDogYXN5bmMgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRkTWVzc2FnZShcbiAgICAgICAgICBtZXNzYWdlLnJvbGUsXG4gICAgICAgICAgbWVzc2FnZS5jb250ZW50LFxuICAgICAgICAgIG1lc3NhZ2UubWVzc2FnZV9pZFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIG9uQXNzaXN0YW50UmVzcG9uc2U6IGFzeW5jIChtZXNzYWdlKSA9PiB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuICAgICAgfSxcbiAgICAgIG9uQ29udGV4dEZpbGVBZGQ6IGFzeW5jICh3aWtpbGluaykgPT4ge1xuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCk7XG4gICAgICAgIGZpbGVzLmFkZCh3aWtpbGluayk7XG4gICAgICAgIHRoaXMuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKEFycmF5LmZyb20oZmlsZXMpKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuICAgICAgfSxcbiAgICAgIG9uRXJyb3I6IChlcnJvcikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciksXG4gICAgICBvbkFkZENvbnRleHRGaWxlOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnRleHRCdXR0b24gPSB0aGlzLmNvbnRleHRNYW5hZ2VyXG4gICAgICAgICAgLmdldENvbnRhaW5lcigpXG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LWNvbnRleHQtYWRkLWJ1dHRvblwiKTtcbiAgICAgICAgaWYgKGNvbnRleHRCdXR0b24gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgIGNvbnRleHRCdXR0b24uY2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZVN5c3RlbVByb21wdEVkaXQoKTtcbiAgICAgIH0sXG4gICAgICBwbHVnaW46IHRoaXMucGx1Z2luLFxuICAgICAgY2hhdFZpZXc6IHRoaXMsXG4gICAgfSk7XG5cbiAgICAvLyBJbml0aWFsaXplIHdlYiBzZWFyY2ggYnV0dG9uIHN0YXRlXG4gICAgdGhpcy5pbnB1dEhhbmRsZXIub25Nb2RlbENoYW5nZSgpO1xuXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiYWN0aXZlLWxlYWYtY2hhbmdlXCIsIChsZWFmKSA9PiB7XG4gICAgICBpZiAobGVhZiA9PT0gdGhpcy5sZWFmKSB7XG4gICAgICAgIHRoaXMuY2hlY2tGb3JVcGRhdGVzKCk7XG4gICAgICAgIC8vIEZvY3VzIGlucHV0IHdoZW4gdGhpcyB2aWV3IGJlY29tZXMgYWN0aXZlXG4gICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBzZXR1cFxuICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG5cbiAgICBhd2FpdCB0aGlzLmNoZWNrRm9yVXBkYXRlcygpO1xuXG4gICAgaWYgKCF0aGlzLmF3YWl0aW5nU3RhdGVSZXN0b3JlICYmIHRoaXMubWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAoIXRoaXMuY2hhdElkKSB7XG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IHllYXIgPSBub3cuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IGRheSA9IFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IGhvdXIgPSBTdHJpbmcobm93LmdldEhvdXJzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgY29uc3QgbWludXRlID0gU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgY29uc3Qgc2Vjb25kID0gU3RyaW5nKG5vdy5nZXRTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgdGhpcy5jaGF0SWQgPSBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX0gJHtob3VyfS0ke21pbnV0ZX0tJHtzZWNvbmR9YDtcbiAgICAgICAgdGhpcy5jaGF0VGl0bGUgPSBgQ2hhdCAke25vdy50b0xvY2FsZVN0cmluZygpfWA7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZnRlciBldmVyeXRoaW5nIGlzIGluaXRpYWxpemVkLCBjaGVjayBmb3IgbW9kZWwgc2VsZWN0aW9uXG4gICAgLy8gVXNlIHNldFRpbWVvdXQgdG8gZW5zdXJlIHRoaXMgcnVucyBhZnRlciB0aGUgdmlldyBpcyBmdWxseSBsb2FkZWRcbiAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIllvdSBkb24ndCBoYXZlIGEgZGVmYXVsdCBtb2RlbCBzZWxlY3RlZCB5ZXQuIFdvdWxkIHlvdSBsaWtlIHRvIGNob29zZSBvbmUgbm93PyBUaGlzIHdpbGwgYmUgdXNlZCBhcyB0aGUgZGVmYXVsdCBmb3IgYWxsIG5ldyBjaGF0cy5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJTZWxlY3QgRGVmYXVsdCBNb2RlbFwiLFxuICAgICAgICAgICAgaWNvbjogXCJib3RcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQ2hvb3NlIE1vZGVsXCIsXG4gICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICBcIlwiLFxuICAgICAgICAgICAgICBhc3luYyAobW9kZWxJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gU2V0IGFzIGRlZmF1bHQgbW9kZWwgaW4gc2V0dGluZ3NcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQgPSBtb2RlbElkO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAgICAgICAgICAgLy8gQWxzbyBzZXQgZm9yIHRoaXMgY2hhdCB2aWV3XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBtb2RlbElkO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIkZhaWxlZCB0byBsb2FkIGF2YWlsYWJsZSBtb2RlbHNcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZE1lc3NhZ2VzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5jaGF0Q29udGFpbmVyKSByZXR1cm47XG5cbiAgICBjb25zdCBzY3JvbGxUb3AgPSB0aGlzLmNoYXRDb250YWluZXIuc2Nyb2xsVG9wO1xuICAgIGNvbnN0IHNjcm9sbEhlaWdodCA9IHRoaXMuY2hhdENvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgY29uc3QgY2xpZW50SGVpZ2h0ID0gdGhpcy5jaGF0Q29udGFpbmVyLmNsaWVudEhlaWdodDtcbiAgICBjb25zdCB3YXNBdEJvdHRvbSA9IE1hdGguYWJzKHNjcm9sbEhlaWdodCAtIHNjcm9sbFRvcCAtIGNsaWVudEhlaWdodCkgPCAxMDtcblxuICAgIHRoaXMuY2hhdENvbnRhaW5lci5lbXB0eSgpO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiB0aGlzLm1lc3NhZ2VzKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkZE1lc3NhZ2UobWVzc2FnZS5yb2xlLCBtZXNzYWdlLmNvbnRlbnQsIG1lc3NhZ2UubWVzc2FnZV9pZCk7XG4gICAgfVxuXG4gICAgaWYgKHdhc0F0Qm90dG9tKSB7XG4gICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGF0Q29udGFpbmVyLnNjcm9sbFRvcCA9IHNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICAvLyBUcmlnZ2VyIHRva2VuIGNvdW50IHVwZGF0ZSBhZnRlciBtZXNzYWdlcyBhcmUgbG9hZGVkXG4gICAgaWYgKHRoaXMuaW5wdXRIYW5kbGVyKSB7XG4gICAgICBhd2FpdCB0aGlzLmlucHV0SGFuZGxlci51cGRhdGVUb2tlbkNvdW50KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVNb2RlbEluZGljYXRvcigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5tb2RlbEluZGljYXRvcikge1xuICAgICAgLy8gUmVtb3ZlIGFueSBleGlzdGluZyBjbGljayBsaXN0ZW5lcnMgdG8gcHJldmVudCBkdXBsaWNhdGVzXG4gICAgICBjb25zdCBuZXdNb2RlbEluZGljYXRvciA9IHRoaXMubW9kZWxJbmRpY2F0b3IuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5yZXBsYWNlV2l0aChuZXdNb2RlbEluZGljYXRvcik7XG4gICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yID0gbmV3TW9kZWxJbmRpY2F0b3IgYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIHRoYXQgd2lsbCBiZSB1c2VkIGluIGJvdGggY2FzZXNcbiAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCB8fCBcIlwiLCAvLyBQYXNzIGN1cnJlbnQgbW9kZWwgSUQgb3IgZW1wdHkgc3RyaW5nXG4gICAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRTZWxlY3RlZE1vZGVsSWQobW9kZWxJZCk7XG4gICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJNb2RlbCBzZWxlY3RlZCBzdWNjZXNzZnVsbHlcIiwgXCJpbmZvXCIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIElmIG5vIG1vZGVsIGlzIHNlbGVjdGVkLCBzaG93IGEgcHJvbXB0IHRleHQgaW5zdGVhZFxuICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkTW9kZWxJZCB8fCB0aGlzLnNlbGVjdGVkTW9kZWxJZC50cmltKCkgPT09IFwiXCIpIHtcbiAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5lbXB0eSgpO1xuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIk5vIG1vZGVsIHNlbGVjdGVkXCIgfSk7XG4gICAgICAgIC8vIEFkZCBjbGlja2FibGUgZWxlbWVudCB0byBpbmRpY2F0ZSB0aGUgbmVlZCB0byBjaG9vc2UgYSBtb2RlbFxuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXhpc3RpbmcgYmVoYXZpb3I6IGZldGNoIHRoZSBtb2RlbCBkZXRhaWxzIGFuZCBkaXNwbGF5IHRoZSBjdXJyZW50IG1vZGVsIG5hbWVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgICAgICAobW9kZWwpID0+IG1vZGVsLmlkID09PSB0aGlzLnNlbGVjdGVkTW9kZWxJZFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBHZXQgdGhlIHByb3ZpZGVyIHByZWZpeFxuICAgICAgICAgIGxldCBwcm92aWRlclByZWZpeCA9IFwiXCI7XG4gICAgICAgICAgaWYgKGN1cnJlbnRNb2RlbCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRNb2RlbC5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgICAgICAgICBwcm92aWRlclByZWZpeCA9IFwiW1NZU1RFTVNDVUxQVF0gXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwcm92aWRlclByZWZpeCA9IGBbJHtjdXJyZW50TW9kZWwucHJvdmlkZXIudG9VcHBlckNhc2UoKX1dIGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5jdXJyZW50TW9kZWxOYW1lID0gY3VycmVudE1vZGVsPy5uYW1lIHx8IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuZW1wdHkoKTtcbiAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHtcbiAgICAgICAgICAgIHRleHQ6IHByb3ZpZGVyUHJlZml4ICsgdGhpcy5jdXJyZW50TW9kZWxOYW1lLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuZW1wdHkoKTtcbiAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHsgdGV4dDogdGhpcy5jdXJyZW50TW9kZWxOYW1lIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjaGVja0ZvclVwZGF0ZXMoKSB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2F2ZWRDaGF0cyA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXRzKCk7XG4gICAgICBjb25zdCBjdXJyZW50Q2hhdCA9IHNhdmVkQ2hhdHMuZmluZCgoYykgPT4gYy5pZCA9PT0gdGhpcy5jaGF0SWQpO1xuXG4gICAgICBpZiAoIWN1cnJlbnRDaGF0KSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGhhc0NoYW5nZXMgPVxuICAgICAgICBjdXJyZW50Q2hhdC5tZXNzYWdlcy5sZW5ndGggIT09IHRoaXMubWVzc2FnZXMubGVuZ3RoIHx8XG4gICAgICAgIGN1cnJlbnRDaGF0LnNlbGVjdGVkTW9kZWxJZCAhPT0gdGhpcy5zZWxlY3RlZE1vZGVsSWQgfHxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoQXJyYXkuZnJvbSh0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpKSkgIT09XG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoY3VycmVudENoYXQuY29udGV4dF9maWxlcykgfHxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY3VycmVudENoYXQubWVzc2FnZXMpICE9PSBKU09OLnN0cmluZ2lmeSh0aGlzLm1lc3NhZ2VzKTtcblxuICAgICAgaWYgKGhhc0NoYW5nZXMpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IGN1cnJlbnRDaGF0Lm1lc3NhZ2VzO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IGN1cnJlbnRDaGF0LnNlbGVjdGVkTW9kZWxJZDtcblxuICAgICAgICBpZiAoY3VycmVudENoYXQuY29udGV4dF9maWxlcykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKGN1cnJlbnRDaGF0LmNvbnRleHRfZmlsZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkTWVzc2FnZXMoKTtcbiAgICAgICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXZlbiBpZiB0aGVyZSBhcmUgbm8gY2hhbmdlcywgY2hlY2sgc3luYyBzdGF0dXMgb2YgY29udGV4dCBmaWxlc1xuICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmNoZWNrU3luY1N0YXR1cygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGZvciB1cGRhdGVzOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzYXZlQ2hhdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY2hhdElkKSB7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICBjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3QgaG91ciA9IFN0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3QgbWludXRlID0gU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIGNvbnN0IHNlY29uZCA9IFN0cmluZyhub3cuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICB0aGlzLmNoYXRJZCA9IGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fSAke2hvdXJ9LSR7bWludXRlfS0ke3NlY29uZH1gO1xuICAgICAgdGhpcy5jaGF0VGl0bGUgPSB0aGlzLmNoYXRUaXRsZSB8fCB0aGlzLmNoYXRJZDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5zYXZlQ2hhdChcbiAgICAgICAgdGhpcy5jaGF0SWQsXG4gICAgICAgIHRoaXMubWVzc2FnZXMsXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICB0aGlzLmNoYXRUaXRsZSxcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0LFxuICAgICAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKFwiRmFpbGVkIHRvIHNhdmUgY2hhdFwiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUVycm9yKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcik6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIExvZyBlcnJvciBmaXJzdFxuICAgIGNvbnNvbGUuZXJyb3IoXCJDaGF0IGVycm9yOlwiLCB7XG4gICAgICBlcnJvcixcbiAgICAgIG1lc3NhZ2U6IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3IubWVzc2FnZSxcbiAgICAgIGNvZGU6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5jb2RlIDogdW5kZWZpbmVkLFxuICAgICAgbWV0YWRhdGE6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5tZXRhZGF0YSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcblxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yLm1lc3NhZ2U7XG5cbiAgICBpZiAoXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yICYmXG4gICAgICAoZXJyb3IuY29kZSA9PT0gXCJNT0RFTF9VTkFWQUlMQUJMRVwiIHx8XG4gICAgICAgIGVycm9yLmNvZGUgPT09IFwiTU9ERUxfUkVRVUVTVF9FUlJPUlwiIHx8XG4gICAgICAgIGVycm9yLmNvZGUgPT09IFwiUVVPVEFfRVhDRUVERURcIilcbiAgICApIHtcbiAgICAgIHNob3dFbmhhbmNlZE5vdGljZShlcnJvck1lc3NhZ2UsIFwiZXJyb3JcIiwgZXJyb3IpO1xuXG4gICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgICAgICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICAgIFwiTW9kZWwgY2hhbmdlZC4gWW91IGNhbiBub3cgcmV0cnkgeW91ciBtZXNzYWdlLlwiLFxuICAgICAgICAgICAgXCJpbmZvXCJcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgbW9kZWwgc2VsZWN0aW9uXG4gICAgICAgICAgdGhpcy5mb2N1c0lucHV0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucGx1Z2luXG4gICAgICApO1xuXG4gICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgIG1vZGFsLnNldE1vZGVscyhtb2RlbHMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggbW9kZWxzOlwiLCBlcnIpO1xuICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggYXZhaWxhYmxlIG1vZGVsc1wiLCBcImVycm9yXCIsIGVycik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gdGhpcy5jaGF0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiLnN5c3RlbXNjdWxwdC1tZXNzYWdlOmxhc3QtY2hpbGRcIlxuICAgICAgKTtcbiAgICAgIGlmIChsYXN0TWVzc2FnZSkge1xuICAgICAgICBsYXN0TWVzc2FnZS5yZW1vdmUoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGFzdFVzZXJNZXNzYWdlID0gWy4uLnRoaXMubWVzc2FnZXNdXG4gICAgICAgIC5yZXZlcnNlKClcbiAgICAgICAgLmZpbmQoKG1zZykgPT4gbXNnLnJvbGUgPT09IFwidXNlclwiKTtcbiAgICAgIGlmIChsYXN0VXNlck1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbGFzdFVzZXJNZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIHRoaXMubWVzc2FnZXMuc3BsaWNlKGluZGV4KTtcblxuICAgICAgICAgIGNvbnN0IGFsbE1lc3NhZ2VzID0gdGhpcy5jaGF0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICBcIi5zeXN0ZW1zY3VscHQtbWVzc2FnZVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCBhbGxNZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYWxsTWVzc2FnZXNbaV0ucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuc2V0VmFsdWUoXG4gICAgICAgICAgICB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgPyBsYXN0VXNlck1lc3NhZ2UuY29udGVudFxuICAgICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzaG93RW5oYW5jZWROb3RpY2UoZXJyb3JNZXNzYWdlLCBcImVycm9yXCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9uTGF5b3V0Q2hhbmdlKCkge1xuICAgIGlmICh0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShJdGVtVmlldyk/LmxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgdGhpcy5sYXN0UmVmcmVzaFRpbWUgPSAwO1xuICAgICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcbiAgICAgIC8vIEZvY3VzIGlucHV0IHdoZW4gdGhpcyB2aWV3IGlzIGFjdGl2ZSBhZnRlciBsYXlvdXQgY2hhbmdlXG4gICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVNZXNzYWdlSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIChjKSA9PiB7XG4gICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwO1xuICAgICAgY29uc3QgdiA9IGMgPT09IFwieFwiID8gciA6IChyICYgMHgzKSB8IDB4ODtcbiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU3lzdGVtUHJvbXB0RWRpdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBSZXRyaWV2ZSB0aGUgY3VycmVudCBwcm9tcHQgZnJvbSBwbHVnaW4gc2V0dGluZ3MgaWYgc3lzdGVtUHJvbXB0VHlwZSBpcyBcImN1c3RvbVwiXG4gICAgLy8gZWxzZSBmYWxsYmFjayB0byB0aGUgY29udGVudCBmcm9tIHRoZSBzdG9yZWQgdGV4dCBvciBwcmVzZXQuXG4gICAgbGV0IGN1cnJlbnRDb250ZW50ID0gXCJcIjtcbiAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAvLyBBdHRlbXB0IHRvIHJlYWQgZnJvbSBmaWxlIHVzaW5nIGNoYXQncyBzeXN0ZW1Qcm9tcHRQYXRoOlxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgKHRoaXMuc3lzdGVtUHJvbXB0UGF0aCB8fCBcIlwiKSArIFwiLm1kXCJcbiAgICAgICk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGN1cnJlbnRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZhbGxiYWNrIHRvIHBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRcbiAgICAgICAgY3VycmVudENvbnRlbnQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIHdlIGhhdmUgYSBrbm93biBwcmVzZXQsIHdlIGxvYWQgdGhhdCB2YWx1ZSBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcmVzZXQgPSBhd2FpdCBzeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdEJ5SWQoXG4gICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICBjdXJyZW50Q29udGVudCA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudENvbnRlbnQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgICBjdXJyZW50Q29udGVudCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbW9kZWwncyBjb250ZXh0IGxlbmd0aFxuICAgIGxldCBtb2RlbENvbnRleHRMZW5ndGg6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgY29uc3QgY3VycmVudE1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgIChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMuc2VsZWN0ZWRNb2RlbElkXG4gICAgICApO1xuICAgICAgaWYgKGN1cnJlbnRNb2RlbCkge1xuICAgICAgICBtb2RlbENvbnRleHRMZW5ndGggPSBjdXJyZW50TW9kZWwuY29udGV4dF9sZW5ndGg7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IG1vZGVsIGNvbnRleHQgbGVuZ3RoOlwiLCBlcnJvcik7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1N5c3RlbVByb21wdE1vZGFsKHRoaXMuYXBwLCBjdXJyZW50Q29udGVudCwge1xuICAgICAgbW9kZTogXCJjaGF0LXNwZWNpZmljXCIsXG4gICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDpcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoIHx8IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGgsXG4gICAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgICAgbW9kZWxDb250ZXh0TGVuZ3RoLFxuICAgICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U6IHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UsXG4gICAgfSk7XG5cbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICAvLyBVcGRhdGUgbG9jYWwgc3RhdGVzXG4gICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGUgPSByZXN1bHQudHlwZTtcbiAgICAgIGlmIChyZXN1bHQudHlwZSA9PT0gXCJjdXN0b21cIiAmJiByZXN1bHQucGF0aCkge1xuICAgICAgICB0aGlzLnN5c3RlbVByb21wdFBhdGggPSByZXN1bHQucGF0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcmUgYm90aCB0aGUgcGVyY2VudGFnZSBhbmQgY2FsY3VsYXRlZCB0b2tlbiBsaW1pdFxuICAgICAgdGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSA9IHJlc3VsdC50b2tlbkxpbWl0UGVyY2VudGFnZTtcbiAgICAgIHRoaXMudG9rZW5MaW1pdCA9IHJlc3VsdC50b2tlbkxpbWl0O1xuXG4gICAgICAvLyBVcGRhdGUgdG9rZW4gY291bnQgZGlzcGxheSBpbW1lZGlhdGVseVxuICAgICAgYXdhaXQgdGhpcy5pbnB1dEhhbmRsZXIudXBkYXRlVG9rZW5Db3VudCgpO1xuXG4gICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhZGRNZXNzYWdlKFxuICAgIHJvbGU6IENoYXRSb2xlLFxuICAgIGNvbnRlbnQ6IHN0cmluZyB8IE11bHRpUGFydENvbnRlbnRbXSxcbiAgICBleGlzdGluZ01lc3NhZ2VJZD86IHN0cmluZ1xuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBtZXNzYWdlSWQgPSBleGlzdGluZ01lc3NhZ2VJZCB8fCB0aGlzLmdlbmVyYXRlTWVzc2FnZUlkKCk7XG5cbiAgICBjb25zdCB7IG1lc3NhZ2VFbCwgY29udGVudEVsIH0gPSBhd2FpdCB0aGlzLm1lc3NhZ2VSZW5kZXJlci5yZW5kZXJNZXNzYWdlKHtcbiAgICAgIGFwcDogdGhpcy5hcHAsXG4gICAgICBtZXNzYWdlSWQsXG4gICAgICByb2xlLFxuICAgICAgY29udGVudCxcbiAgICB9KTtcblxuICAgIC8vIFN0b3JlIGN1cnJlbnQgY29udGVudCBpbiBkYXRhc2V0IGZvciBlYXN5IHJldHJpZXZhbFxuICAgIGNvbnN0IGNvbnRlbnRTdHIgPVxuICAgICAgdHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIgPyBjb250ZW50IDogSlNPTi5zdHJpbmdpZnkoY29udGVudCk7XG4gICAgbWVzc2FnZUVsLmRhdGFzZXQuY29udGVudCA9IGNvbnRlbnRTdHI7XG5cbiAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlci5hZGRNZXNzYWdlQnV0dG9uVG9vbGJhcihcbiAgICAgIG1lc3NhZ2VFbCxcbiAgICAgIHR5cGVvZiBjb250ZW50ID09PSBcInN0cmluZ1wiID8gY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQpLFxuICAgICAgcm9sZSxcbiAgICAgIG1lc3NhZ2VJZFxuICAgICk7XG5cbiAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcInJlc3VibWl0XCIsIGFzeW5jIChlOiBDdXN0b21FdmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBtZXNzYWdlSWQsIGNvbnRlbnQgfSA9IGUuZGV0YWlsO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaW5kZXgpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAgICAgdGhpcy5jaGF0Q29udGFpbmVyLmVtcHR5KCk7XG4gICAgICAgIGZvciAoY29uc3QgbXNnIG9mIHRoaXMubWVzc2FnZXMpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFkZE1lc3NhZ2UobXNnLnJvbGUsIG1zZy5jb250ZW50LCBtc2cubWVzc2FnZV9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5zZXRWYWx1ZShjb250ZW50KTtcbiAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiZWRpdFwiLCBhc3luYyAoZTogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHsgbWVzc2FnZUlkLCBvbGRDb250ZW50LCBuZXdDb250ZW50IH0gPSBlLmRldGFpbDtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5tZXNzYWdlcy5maW5kSW5kZXgoXG4gICAgICAgIChtc2cpID0+IG1zZy5tZXNzYWdlX2lkID09PSBtZXNzYWdlSWRcbiAgICAgICk7XG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgbWVzc2FnZSBjb250ZW50XG4gICAgICAgIHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQgPSBuZXdDb250ZW50O1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAgICAgLy8gUmUtcmVuZGVyIElOIFBMQUNFIGJ5IHVwZGF0aW5nIGV4aXN0aW5nIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbDogbmV3Q29udGVudEVsIH0gPVxuICAgICAgICAgIGF3YWl0IHRoaXMubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1lc3NhZ2Uoe1xuICAgICAgICAgICAgYXBwOiB0aGlzLmFwcCxcbiAgICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICAgIHJvbGU6IHRoaXMubWVzc2FnZXNbaW5kZXhdLnJvbGUsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLm1lc3NhZ2VzW2luZGV4XS5jb250ZW50LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlcGxhY2UganVzdCB0aGUgY29udGVudCBwb3J0aW9uIHRvIG1haW50YWluIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IG9sZENvbnRlbnRFbCA9IG1lc3NhZ2VFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLnN5c3RlbXNjdWxwdC1tZXNzYWdlLWNvbnRlbnRcIlxuICAgICAgICApO1xuICAgICAgICBpZiAob2xkQ29udGVudEVsICYmIG5ld0NvbnRlbnRFbCkge1xuICAgICAgICAgIG9sZENvbnRlbnRFbC5yZXBsYWNlV2l0aChuZXdDb250ZW50RWwpO1xuICAgICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLnNldHVwSW1hZ2VIYW5kbGVycyhuZXdDb250ZW50RWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGRhdGFzZXQgd2l0aCBuZXcgY29udGVudFxuICAgICAgICBjb25zdCB1cGRhdGVkU3RyID1cbiAgICAgICAgICB0eXBlb2YgdGhpcy5tZXNzYWdlc1tpbmRleF0uY29udGVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgPyB0aGlzLm1lc3NhZ2VzW2luZGV4XS5jb250ZW50XG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQpO1xuICAgICAgICBtZXNzYWdlRWwuZGF0YXNldC5jb250ZW50ID0gdXBkYXRlZFN0cjtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiZGVsZXRlXCIsIGFzeW5jIChlOiBDdXN0b21FdmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBtZXNzYWdlSWQgfSA9IGUuZGV0YWlsO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICAgIG1lc3NhZ2VFbC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQobWVzc2FnZUVsKTtcbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRJbnB1dFZhbHVlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRIYW5kbGVyLmdldFZhbHVlKCk7XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICBpZiAodGhpcy5yZWZyZXNoSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5yZWZyZXNoSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5yZWZyZXNoSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIuY2xlYW51cCgpO1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vZmYoXG4gICAgICBcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLFxuICAgICAgdGhpcy5jaGVja0ZvclVwZGF0ZXMuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5hY3Rpb25zRHJhd2VyLnVubG9hZCgpO1xuICAgIHRoaXMuY29udGV4dE1hbmFnZXIudW5sb2FkKCk7XG4gICAgdGhpcy5pbnB1dEhhbmRsZXIudW5sb2FkKCk7XG4gIH1cblxuICBnZXRTdGF0ZSgpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICBjaGF0SWQ6IHRoaXMuY2hhdElkLFxuICAgICAgc2VsZWN0ZWRNb2RlbElkOiB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgc2V0U3RhdGUoc3RhdGU6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChzdGF0ZS5jaGF0SWQpIHtcbiAgICAgIGF3YWl0IHRoaXMubG9hZENoYXRCeUlkKHN0YXRlLmNoYXRJZCk7XG4gICAgfVxuICAgIHRoaXMuYXdhaXRpbmdTdGF0ZVJlc3RvcmUgPSBmYWxzZTtcbiAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBzdGF0ZSByZXN0b3JlIGlmIHRoaXMgdmlldyBpcyBhY3RpdmVcbiAgICBpZiAodGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoSXRlbVZpZXcpPy5sZWFmID09PSB0aGlzLmxlYWYpIHtcbiAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENoYXRCeUlkKGNoYXRJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoYXREYXRhID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5sb2FkQ2hhdChjaGF0SWQpO1xuICAgICAgaWYgKCFjaGF0RGF0YSkge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNoYXRDb250YWluZXIuZW1wdHkoKTtcbiAgICAgIHRoaXMubWVzc2FnZXMgPSBjaGF0RGF0YS5tZXNzYWdlcztcbiAgICAgIHRoaXMuY2hhdElkID0gY2hhdERhdGEuaWQ7XG4gICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IGNoYXREYXRhLnNlbGVjdGVkTW9kZWxJZDtcbiAgICAgIHRoaXMuY2hhdFRpdGxlID0gY2hhdERhdGEudGl0bGUgfHwgXCJVbnRpdGxlZCBDaGF0XCI7XG5cbiAgICAgIC8vIFVwZGF0ZSBzeXN0ZW0gcHJvbXB0IHNldHRpbmdzIGZyb20gbWV0YWRhdGFcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5nZXRNZXRhZGF0YShjaGF0SWQpO1xuICAgICAgaWYgKG1ldGFkYXRhPy5zeXN0ZW1NZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UudHlwZTtcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0ID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS50b2tlbkxpbWl0O1xuICAgICAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS50b2tlbkxpbWl0UGVyY2VudGFnZTtcbiAgICAgICAgaWYgKG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UucGF0aCkge1xuICAgICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UucGF0aC5yZXBsYWNlKFxuICAgICAgICAgICAgL15cXFtcXFsoLio/KVxcXVxcXSQvLFxuICAgICAgICAgICAgXCIkMVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbCA9IG1vZGVscy5maW5kKFxuICAgICAgICAgIChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMuc2VsZWN0ZWRNb2RlbElkXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IGN1cnJlbnRNb2RlbD8ubmFtZSB8fCB0aGlzLnNlbGVjdGVkTW9kZWxJZDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2hhdERhdGEuY29udGV4dF9maWxlcykge1xuICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLnNldENvbnRleHRGaWxlcyhjaGF0RGF0YS5jb250ZXh0X2ZpbGVzKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIHRoaXMubWVzc2FnZXMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGRNZXNzYWdlKFxuICAgICAgICAgIG1lc3NhZ2Uucm9sZSxcbiAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQsXG4gICAgICAgICAgbWVzc2FnZS5tZXNzYWdlX2lkXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcblxuICAgICAgLy8gVXBkYXRlIHdlYiBzZWFyY2ggYnV0dG9uIHN0YXRlXG4gICAgICB0aGlzLmlucHV0SGFuZGxlci5vbk1vZGVsQ2hhbmdlKCk7XG5cbiAgICAgIC8vIFRyaWdnZXIgdG9rZW4gY291bnQgdXBkYXRlIGFmdGVyIGNoYXQgaXMgZnVsbHkgbG9hZGVkXG4gICAgICBpZiAodGhpcy5pbnB1dEhhbmRsZXIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbnB1dEhhbmRsZXIudXBkYXRlVG9rZW5Db3VudCgpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRXJyb3IgaW4gbG9hZENoYXRCeUlkOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdFwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBhZGRGaWxlVG9Db250ZXh0KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5hZGRGaWxlVG9Db250ZXh0KGZpbGUpO1xuICB9XG5cbiAgYXN5bmMgY29weVRvQ2xpcGJvYXJkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRNYXJrZG93bigpO1xuICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29udGVudCk7XG4gICAgICBzaG93Tm90aWNlKFwiQ2hhdCBjb3BpZWQgdG8gY2xpcGJvYXJkXCIsIHsgdHlwZTogXCJzdWNjZXNzXCIgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNob3dOb3RpY2UoXCJGYWlsZWQgdG8gY29weSBjaGF0IHRvIGNsaXBib2FyZFwiLCB7IHR5cGU6IFwiZXJyb3JcIiB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0VG9rZW5MaW1pdCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnRva2VuTGltaXQ7XG4gIH1cblxuICBwdWJsaWMgZm9jdXNJbnB1dCgpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cERyYWdBbmREcm9wKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAvLyBDcmVhdGUgb3ZlcmxheSBlbGVtZW50c1xuICAgIGNvbnN0IG92ZXJsYXkgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmFnLW92ZXJsYXlcIixcbiAgICB9KTtcbiAgICBjb25zdCBtZXNzYWdlID0gb3ZlcmxheS5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYWctbWVzc2FnZVwiLFxuICAgICAgdGV4dDogXCJEcm9wIGZpbGVzIHRvIGFkZCB0byBjb250ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBNQVhfRklMRVMgPSAxMDA7XG5cbiAgICAvLyBQYXJzZSBPYnNpZGlhbiBVUkkgdG8gZ2V0IGZpbGUgcGF0aFxuICAgIGNvbnN0IHBhcnNlT2JzaWRpYW5VcmkgPSAodXJpOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghdXJpLnN0YXJ0c1dpdGgoXCJvYnNpZGlhbjovL29wZW5cIikpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHVyaSk7XG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJmaWxlXCIpIHx8IFwiXCIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW0RyYWdEcm9wXSBFcnJvciBwYXJzaW5nIFVSSTpcIiwgdXJpLCBlKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEdldCBmaWxlcyBmcm9tIGZvbGRlciByZWN1cnNpdmVseVxuICAgIGNvbnN0IGdldEZpbGVzRnJvbUZvbGRlciA9IChmb2xkZXI6IFRGb2xkZXIpOiBURmlsZVtdID0+IHtcbiAgICAgIGNvbnN0IGZpbGVzOiBURmlsZVtdID0gW107XG4gICAgICBjb25zdCBwcm9jZXNzRm9sZGVyID0gKGN1cnJlbnRGb2xkZXI6IFRGb2xkZXIpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjdXJyZW50Rm9sZGVyLmNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGZpbGVzLnB1c2goY2hpbGQpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICBwcm9jZXNzRm9sZGVyKGNoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBwcm9jZXNzRm9sZGVyKGZvbGRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbGVzLnNsaWNlKDAsIE1BWF9GSUxFUyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICAvLyBHZXQgZmlsZSBjb3VudCBmcm9tIGRhdGEgdHJhbnNmZXJcbiAgICBjb25zdCBnZXRGaWxlQ291bnQgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2Zlcik6IFByb21pc2U8bnVtYmVyPiA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50Q29udGV4dFNpemUgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG5cbiAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZW1haW5pbmdTbG90cyA9IE1BWF9GSUxFUyAtIGN1cnJlbnRDb250ZXh0U2l6ZTtcblxuICAgICAgbGV0IG5ld0ZpbGVDb3VudCA9IDA7XG4gICAgICBsZXQgZmlsZXNUb1Byb2Nlc3M6IChURmlsZSB8IFRGb2xkZXIpW10gPSBbXTtcblxuICAgICAgLy8gVHJ5IHRvIGdldCBmaWxlcyBmcm9tIHRleHQvcGxhaW4gKGZvbGRlciBkcm9wcylcbiAgICAgIGlmIChkdC5pdGVtcyAmJiBkdC5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICBpdGVtLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFNwbGl0IGJ5IG5ld2xpbmVzIGluIGNhc2Ugb2YgbXVsdGlwbGUgVVJJc1xuICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgICAgbGV0IGZpbGVQYXRoID0gbGluZTtcbiAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIE9ic2lkaWFuIFVSSSBmaXJzdFxuICAgICAgICAgICAgICBpZiAobGluZS5zdGFydHNXaXRoKFwib2JzaWRpYW46Ly9cIikpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkobGluZSkgfHwgbGluZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFRyeSB0byBnZXQgdGhlIGZpbGVcbiAgICAgICAgICAgICAgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICghZmlsZVBhdGguaW5jbHVkZXMoXCIuXCIpKSB7XG4gICAgICAgICAgICAgICAgLy8gVHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgIGNvbnN0IG1kUGF0aCA9IGAke2ZpbGVQYXRofS5tZGA7XG4gICAgICAgICAgICAgICAgY29uc3QgbWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG1kUGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKG1kRmlsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENvdW50IGZpbGVzIGZyb20gdGhlIHByb2Nlc3NlZCBpdGVtc1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGZpbGVzVG9Qcm9jZXNzKSB7XG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgIGNvbnN0IGZvbGRlckZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGl0ZW0pLmxlbmd0aDtcbiAgICAgICAgICBuZXdGaWxlQ291bnQgKz0gZm9sZGVyRmlsZXM7XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgbmV3RmlsZUNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gSWYgbm8gZmlsZXMgZm91bmQgeWV0LCB0cnkgVVJJIGxpc3RcbiAgICAgIGlmIChuZXdGaWxlQ291bnQgPT09IDAgJiYgZHQudHlwZXMuaW5jbHVkZXMoXCJ0ZXh0L3VyaS1saXN0XCIpKSB7XG4gICAgICAgIGNvbnN0IHVyaURhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgZHQuaXRlbXNbMV0uZ2V0QXNTdHJpbmcocmVzb2x2ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHVyaXMgPSB1cmlEYXRhXG4gICAgICAgICAgLnNwbGl0KFwib2JzaWRpYW46Ly9vcGVuXCIpXG4gICAgICAgICAgLmZpbHRlcigodXJpKSA9PiB1cmkudHJpbSgpKVxuICAgICAgICAgIC5tYXAoKHVyaSkgPT4gXCJvYnNpZGlhbjovL29wZW5cIiArIHVyaS50cmltKCkpO1xuXG4gICAgICAgIGZvciAoY29uc3QgdXJpIG9mIHVyaXMpIHtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkodXJpKTtcbiAgICAgICAgICBpZiAoIWZpbGVQYXRoKSBjb250aW51ZTtcblxuICAgICAgICAgIGNvbnN0IGFic3RyYWN0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlckZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGFic3RyYWN0RmlsZSkubGVuZ3RoO1xuICAgICAgICAgICAgbmV3RmlsZUNvdW50ICs9IGZvbGRlckZpbGVzO1xuICAgICAgICAgIH0gZWxzZSBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIG5ld0ZpbGVDb3VudCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBmaW5hbENvdW50ID0gTWF0aC5taW4obmV3RmlsZUNvdW50LCByZW1haW5pbmdTbG90cyk7XG4gICAgICByZXR1cm4gZmluYWxDb3VudDtcbiAgICB9O1xuXG4gICAgLy8gVXBkYXRlIG1lc3NhZ2UgY29udGVudFxuICAgIGNvbnN0IHVwZGF0ZU1lc3NhZ2UgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2ZlcikgPT4ge1xuICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgaWYgKGN1cnJlbnRDb250ZXh0U2l6ZSA+PSBNQVhfRklMRVMpIHtcbiAgICAgICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGBDYW5ub3QgYWRkIG1vcmUgZmlsZXMgKG1heCAke01BWF9GSUxFU30gcmVhY2hlZClgO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpbGVDb3VudCA9IGF3YWl0IGdldEZpbGVDb3VudChkdCk7XG4gICAgICBpZiAoZmlsZUNvdW50ID4gMCkge1xuICAgICAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gYEFkZCAke2ZpbGVDb3VudH0gZmlsZSR7XG4gICAgICAgICAgZmlsZUNvdW50ID4gMSA/IFwic1wiIDogXCJcIlxuICAgICAgICB9IHRvIGNvbnRleHQgKCR7Y3VycmVudENvbnRleHRTaXplICsgZmlsZUNvdW50fS8ke01BWF9GSUxFU30gdG90YWwpYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBgRHJvcCBmaWxlcyB0byBhZGQgdG8gY29udGV4dCAoJHtjdXJyZW50Q29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBUcmFjayBkcmFnIHN0YXRlXG4gICAgbGV0IGRyYWdDb3VudGVyID0gMDtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VudGVyXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZHJhZ0NvdW50ZXIrKztcbiAgICAgIGlmIChkcmFnQ291bnRlciA9PT0gMSkge1xuICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtZHJhZy1hY3RpdmVcIik7XG4gICAgICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICAgIHVwZGF0ZU1lc3NhZ2UoZS5kYXRhVHJhbnNmZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyLS07XG4gICAgICBpZiAoZHJhZ0NvdW50ZXIgPT09IDApIHtcbiAgICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWRyYWctYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICBhd2FpdCB1cGRhdGVNZXNzYWdlKGUuZGF0YVRyYW5zZmVyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyID0gMDtcbiAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1kcmFnLWFjdGl2ZVwiKTtcblxuICAgICAgY29uc3QgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIGlmICghZHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdGFydGluZ0NvbnRleHRTaXplID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgaWYgKHN0YXJ0aW5nQ29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIGNvbnN0IHsgY29uZmlybWVkIH0gPSBhd2FpdCBzaG93QWxlcnQoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgYENhbm5vdCBhZGQgbW9yZSBmaWxlcyAobWF4ICR7TUFYX0ZJTEVTfSByZWFjaGVkKWAsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJpbmZvXCIsXG4gICAgICAgICAgICBpY29uOiBcImFsZXJ0LXRyaWFuZ2xlXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBmaWxlc1RvUHJvY2VzczogKFRGaWxlIHwgVEZvbGRlcilbXSA9IFtdO1xuXG4gICAgICAgIC8vIEZpcnN0IHRyeSB0byBoYW5kbGUgaXQgYXMgYSBmb2xkZXIgZHJvcFxuICAgICAgICBpZiAoZHQuaXRlbXMgJiYgZHQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICBpdGVtLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvLyBTcGxpdCBieSBuZXdsaW5lcyBpbiBjYXNlIG9mIG11bHRpcGxlIFVSSXNcbiAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpO1xuXG4gICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgICAgIGxldCBmaWxlUGF0aCA9IGxpbmU7XG4gICAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgT2JzaWRpYW4gVVJJIGZpcnN0XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcIm9ic2lkaWFuOi8vXCIpKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkobGluZSkgfHwgbGluZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZ2V0IHRoZSBmaWxlXG4gICAgICAgICAgICAgICAgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgICAgICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSByZXF1aXJlcyBwcm8gZmVhdHVyZXNcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGFic3RyYWN0RmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVpcmVzUHJvID0gW1xuICAgICAgICAgICAgICAgICAgICBcInBkZlwiLFxuICAgICAgICAgICAgICAgICAgICBcImRvY1wiLFxuICAgICAgICAgICAgICAgICAgICBcImRvY3hcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtcDNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtNGFcIixcbiAgICAgICAgICAgICAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ3ZWJtXCIsXG4gICAgICAgICAgICAgICAgICBdLmluY2x1ZGVzKGV4dGVuc2lvbik7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZXNQcm8gJiZcbiAgICAgICAgICAgICAgICAgICAgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5Py50cmltKCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkKVxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgICBcIkRvY3VtZW50IHByb2Nlc3NpbmcgaXMgYSBQcm8gZmVhdHVyZS4gU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBkZXZlbG9wbWVudCBhbmQgdW5sb2NrIHRoaXMgZmVhdHVyZSBieSBiZWNvbWluZyBhIFBhdHJlb24gbWVtYmVyIVwiLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZpbGVQYXRoLmluY2x1ZGVzKFwiLlwiKSkge1xuICAgICAgICAgICAgICAgICAgLy8gVHJ5IHdpdGggLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgICAgY29uc3QgbWRQYXRoID0gYCR7ZmlsZVBhdGh9Lm1kYDtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1kRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChtZFBhdGgpO1xuICAgICAgICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2gobWRGaWxlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBubyBmb2xkZXJzIGZvdW5kLCB0cnkgaGFuZGxpbmcgYXMgVVJJIGxpc3RcbiAgICAgICAgaWYgKGZpbGVzVG9Qcm9jZXNzLmxlbmd0aCA9PT0gMCAmJiBkdC50eXBlcy5pbmNsdWRlcyhcInRleHQvdXJpLWxpc3RcIikpIHtcbiAgICAgICAgICBjb25zdCB1cmlEYXRhID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgZHQuaXRlbXNbMV0uZ2V0QXNTdHJpbmcocmVzb2x2ZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCB1cmlzID0gdXJpRGF0YVxuICAgICAgICAgICAgLnNwbGl0KFwib2JzaWRpYW46Ly9vcGVuXCIpXG4gICAgICAgICAgICAuZmlsdGVyKCh1cmkpID0+IHVyaS50cmltKCkpXG4gICAgICAgICAgICAubWFwKCh1cmkpID0+IFwib2JzaWRpYW46Ly9vcGVuXCIgKyB1cmkudHJpbSgpKTtcblxuICAgICAgICAgIGZvciAoY29uc3QgdXJpIG9mIHVyaXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGFyc2VPYnNpZGlhblVyaSh1cmkpO1xuICAgICAgICAgICAgaWYgKCFmaWxlUGF0aCkgY29udGludWU7XG5cbiAgICAgICAgICAgIGxldCBhYnN0cmFjdEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSByZXF1aXJlcyBwcm8gZmVhdHVyZXNcbiAgICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gYWJzdHJhY3RGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICBjb25zdCByZXF1aXJlc1BybyA9IFtcbiAgICAgICAgICAgICAgICBcInBkZlwiLFxuICAgICAgICAgICAgICAgIFwiZG9jXCIsXG4gICAgICAgICAgICAgICAgXCJkb2N4XCIsXG4gICAgICAgICAgICAgICAgXCJtcDNcIixcbiAgICAgICAgICAgICAgICBcIndhdlwiLFxuICAgICAgICAgICAgICAgIFwibTRhXCIsXG4gICAgICAgICAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgICAgICAgICBcIndlYm1cIixcbiAgICAgICAgICAgICAgXS5pbmNsdWRlcyhleHRlbnNpb24pO1xuXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICByZXF1aXJlc1BybyAmJlxuICAgICAgICAgICAgICAgICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8XG4gICAgICAgICAgICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgIFwiRG9jdW1lbnQgcHJvY2Vzc2luZyBpcyBhIFBybyBmZWF0dXJlLiBTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgdGhpcyBmZWF0dXJlIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlXCIsXG4gICAgICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlIHx8XG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXJcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdGFsRmlsZXNBZGRlZCA9IDA7XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1Nsb3RzID0gTUFYX0ZJTEVTIC0gc3RhcnRpbmdDb250ZXh0U2l6ZTtcblxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZmlsZXNUb1Byb2Nlc3MpIHtcbiAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGl0ZW0pO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID1cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBjb25maXJtZWQgfSA9IGF3YWl0IHNob3dBbGVydChcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgYEZpbGUgbGltaXQgcmVhY2hlZCAoJHtNQVhfRklMRVN9IHRvdGFsKWAsXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5mb1wiLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBcImFsZXJ0LXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBDaGVjayBpZiBmaWxlIHJlcXVpcmVzIHBybyBmZWF0dXJlc1xuICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICBjb25zdCByZXF1aXJlc1BybyA9IFtcbiAgICAgICAgICAgICAgICBcInBkZlwiLFxuICAgICAgICAgICAgICAgIFwiZG9jXCIsXG4gICAgICAgICAgICAgICAgXCJkb2N4XCIsXG4gICAgICAgICAgICAgICAgXCJtcDNcIixcbiAgICAgICAgICAgICAgICBcIndhdlwiLFxuICAgICAgICAgICAgICAgIFwibTRhXCIsXG4gICAgICAgICAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgICAgICAgICBcIndlYm1cIixcbiAgICAgICAgICAgICAgXS5pbmNsdWRlcyhleHRlbnNpb24pO1xuXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICByZXF1aXJlc1BybyAmJlxuICAgICAgICAgICAgICAgICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8XG4gICAgICAgICAgICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgIFwiRG9jdW1lbnQgcHJvY2Vzc2luZyBpcyBhIFBybyBmZWF0dXJlLiBTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgdGhpcyBmZWF0dXJlIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlXCIsXG4gICAgICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5hZGRGaWxlVG9Db250ZXh0KGZpbGUpO1xuICAgICAgICAgICAgICAgIHRvdGFsRmlsZXNBZGRlZCsrO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRDb250ZXh0U2l6ZSA9XG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICAgICAgc2hvd05vdGljZShcbiAgICAgICAgICAgICAgICAgIGBBZGRlZCAke2ZpbGUubmFtZX0gdG8gY29udGV4dCAoJHt1cGRhdGVkQ29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgLFxuICAgICAgICAgICAgICAgICAgeyB0eXBlOiBcInN1Y2Nlc3NcIiB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiW0RyYWdEcm9wXSBFcnJvciBhZGRpbmcgZmlsZSBmcm9tIGZvbGRlcjpcIiwge1xuICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZS5wYXRoLFxuICAgICAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID1cbiAgICAgICAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRDb250ZXh0U2l6ZSA+PSBNQVhfRklMRVMpIHtcbiAgICAgICAgICAgICAgY29uc3QgeyBjb25maXJtZWQgfSA9IGF3YWl0IHNob3dBbGVydChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICBgRmlsZSBsaW1pdCByZWFjaGVkICgke01BWF9GSUxFU30gdG90YWwpYCxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcImluZm9cIixcbiAgICAgICAgICAgICAgICAgIGljb246IFwiYWxlcnQtdHJpYW5nbGVcIixcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5hZGRGaWxlVG9Db250ZXh0KGl0ZW0pO1xuICAgICAgICAgICAgdG90YWxGaWxlc0FkZGVkKys7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkQ29udGV4dFNpemUgPVxuICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICBzaG93Tm90aWNlKFxuICAgICAgICAgICAgICBgQWRkZWQgJHtpdGVtLm5hbWV9IHRvIGNvbnRleHQgKCR7dXBkYXRlZENvbnRleHRTaXplfS8ke01BWF9GSUxFU30pYCxcbiAgICAgICAgICAgICAgeyB0eXBlOiBcInN1Y2Nlc3NcIiB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltEcmFnRHJvcF0gRXJyb3IgcHJvY2Vzc2luZyBkcm9wOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dBbGVydCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gcHJvY2VzcyBkcm9wcGVkIGZpbGVzXCIsIHtcbiAgICAgICAgICB0eXBlOiBcImVycm9yXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudGx5IHNlbGVjdGVkIG1vZGVsIElEIGZvciB0aGlzIGNoYXQgdmlld1xuICAgKi9cbiAgcHVibGljIGdldFNlbGVjdGVkTW9kZWxJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkTW9kZWxJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIG1vZGVsIElEIGZvciB0aGlzIGNoYXQgdmlldyBhbmQgdXBkYXRlIHRoZSBVSVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHNldFNlbGVjdGVkTW9kZWxJZChtb2RlbElkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgYXdhaXQgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcblxuICAgIC8vIFJlY2FsY3VsYXRlIHRva2VuIGxpbWl0IGlmIG5lZWRlZFxuICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICBjb25zdCBzZWxlY3RlZE1vZGVsID0gbW9kZWxzLmZpbmQoKG1vZGVsKSA9PiBtb2RlbC5pZCA9PT0gbW9kZWxJZCk7XG4gICAgaWYgKHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgJiYgc2VsZWN0ZWRNb2RlbD8uY29udGV4dF9sZW5ndGgpIHtcbiAgICAgIHRoaXMudG9rZW5MaW1pdCA9IE1hdGguZmxvb3IoXG4gICAgICAgICh0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlIC8gMTAwKSAqIHNlbGVjdGVkTW9kZWwuY29udGV4dF9sZW5ndGhcbiAgICAgICk7XG4gICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHdlYiBzZWFyY2ggYnV0dG9uIHN0YXRlXG4gICAgdGhpcy5pbnB1dEhhbmRsZXIub25Nb2RlbENoYW5nZSgpO1xuXG4gICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgbW9kZWwgc2VsZWN0aW9uXG4gICAgdGhpcy5mb2N1c0lucHV0KCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldE1hcmtkb3duKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgbGV0IGNoYXRDb250ZW50ID0gXCJcIjtcblxuICAgIC8vIEFkZCBzeXN0ZW0gcHJvbXB0IGlmIGV4aXN0c1xuICAgIGlmICh0aGlzLnN5c3RlbVByb21wdFR5cGUpIHtcbiAgICAgIGxldCBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gXCJcIjtcbiAgICAgIGlmICh0aGlzLnN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiYgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoKSB7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoXG4gICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoICsgXCIubWRcIlxuICAgICAgICApO1xuICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcHJlc2V0ID0gYXdhaXQgc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKFxuICAgICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocHJlc2V0KSB7XG4gICAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0OlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzeXN0ZW1Qcm9tcHRDb250ZW50KSB7XG4gICAgICAgIGNoYXRDb250ZW50ICs9IGBTeXN0ZW0gUHJvbXB0OlxcblwiXCJcIlwiXCJcXG4ke3N5c3RlbVByb21wdENvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGNvbnRleHQgZmlsZXNcbiAgICBjb25zdCBjb250ZXh0RmlsZXMgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpO1xuICAgIGlmIChjb250ZXh0RmlsZXMuc2l6ZSA+IDApIHtcbiAgICAgIGNoYXRDb250ZW50ICs9IFwiQ29udGV4dCBGaWxlczpcXG5cXG5cIjtcbiAgICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgY29udGV4dEZpbGVzKSB7XG4gICAgICAgIGlmICghZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIHtcbiAgICAgICAgICAvLyBTa2lwIGRvY3VtZW50IHJlZmVyZW5jZXNcbiAgICAgICAgICAvLyBDbGVhbiB0aGUgd2lraS1saW5rIGZvcm1hdCBhbmQgbWF0aCBkaXNwbGF5IG1hcmtlcnNcbiAgICAgICAgICBjb25zdCBjbGVhblBhdGggPSBmaWxlUGF0aFxuICAgICAgICAgICAgLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpXG4gICAgICAgICAgICAucmVwbGFjZShcbiAgICAgICAgICAgICAgL1xcJGJlZ2luOm1hdGg6ZGlzcGxheVxcJFxcWyguKj8pXFwkZW5kOm1hdGg6ZGlzcGxheVxcJF0vZyxcbiAgICAgICAgICAgICAgXCIkMVwiXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgYW5kIHJlYWQgdGhlIGZpbGVcbiAgICAgICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICAgICAgY2xlYW5QYXRoLFxuICAgICAgICAgICAgXCJcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgcmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUgJiZcbiAgICAgICAgICAgICFyZXNvbHZlZEZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9eKGpwZ3xqcGVnfHBuZ3xnaWZ8d2VicCkkL2kpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChyZXNvbHZlZEZpbGUpO1xuICAgICAgICAgICAgY2hhdENvbnRlbnQgKz0gYFske2NsZWFuUGF0aH1dXFxuXCJcIlwiXCJcIlxcbiR7Y29udGVudH1cXG5cIlwiXCJcIlwiXFxuXFxuYDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgY2hhdCBtZXNzYWdlc1xuICAgIGNoYXRDb250ZW50ICs9IFwiQ2hhdCBIaXN0b3J5IFRodXMgRmFyOlxcblxcblwiO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiB0aGlzLm1lc3NhZ2VzKSB7XG4gICAgICBjb25zdCByb2xlID0gbWVzc2FnZS5yb2xlID09PSBcImFzc2lzdGFudFwiID8gXCJBXCIgOiBcIlVzZXJcIjtcbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5jb250ZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNoYXRDb250ZW50ICs9IGAke3JvbGV9OlxcblwiXCJcIlwiXCJcXG4ke21lc3NhZ2UuY29udGVudH1cXG5cIlwiXCJcIlwiXFxuXFxuYDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2hhdENvbnRlbnQ7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBwYXJzZVlhbWwsIHN0cmluZ2lmeVlhbWwgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBDaGF0Um9sZSwgU3lzdGVtUHJvbXB0UHJlc2V0IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmludGVyZmFjZSBDb250ZXh0RmlsZSB7XG4gIHBhdGg6IHN0cmluZztcbiAgdHlwZTogXCJzb3VyY2VcIiB8IFwiZXh0cmFjdGlvblwiO1xufVxuXG5pbnRlcmZhY2UgQ2hhdE1ldGFkYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgbW9kZWw6IHN0cmluZztcbiAgY3JlYXRlZDogc3RyaW5nO1xuICBsYXN0TW9kaWZpZWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGV4dF9maWxlcz86IENvbnRleHRGaWxlW107XG4gIHN5c3RlbU1lc3NhZ2U/OiB7XG4gICAgdHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgICB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIENoYXRTdG9yYWdlU2VydmljZSB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY2hhdERpcmVjdG9yeTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBjaGF0RGlyZWN0b3J5OiBzdHJpbmcpIHtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLmNoYXREaXJlY3RvcnkgPSBjaGF0RGlyZWN0b3J5O1xuICB9XG5cbiAgYXN5bmMgc2F2ZUNoYXQoXG4gICAgY2hhdElkOiBzdHJpbmcsXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10sXG4gICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmcsXG4gICAgY29udGV4dEZpbGVzPzogU2V0PHN0cmluZz4sXG4gICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmcsXG4gICAgc3lzdGVtUHJvbXB0VHlwZT86IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIixcbiAgICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nLFxuICAgIHRpdGxlPzogc3RyaW5nLFxuICAgIHRva2VuTGltaXQ/OiBudW1iZXIsXG4gICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5jaGF0RGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuXG4gICAgICAvLyBDb252ZXJ0IFNldDxzdHJpbmc+IHRvIENvbnRleHRGaWxlW11cbiAgICAgIGNvbnN0IGNvbnRleHRGaWxlT2JqZWN0cyA9IGNvbnRleHRGaWxlc1xuICAgICAgICA/IEFycmF5LmZyb20oY29udGV4dEZpbGVzKS5tYXAoKHBhdGgpID0+IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYW4gZXh0cmFjdGlvbiBieSBsb29raW5nIGF0IHRoZSBwYXRoXG4gICAgICAgICAgICBjb25zdCBpc0V4dHJhY3Rpb24gPSBwYXRoLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICAgIHR5cGU6IGlzRXh0cmFjdGlvblxuICAgICAgICAgICAgICAgID8gKFwiZXh0cmFjdGlvblwiIGFzIGNvbnN0KVxuICAgICAgICAgICAgICAgIDogKFwic291cmNlXCIgYXMgY29uc3QpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICA6IFtdO1xuXG4gICAgICBjb25zdCBtZXRhZGF0YTogQ2hhdE1ldGFkYXRhID0ge1xuICAgICAgICBpZDogY2hhdElkLFxuICAgICAgICBtb2RlbDogc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB0aXRsZTogdGl0bGUgfHwgXCJVbnRpdGxlZCBDaGF0XCIsXG4gICAgICAgIGNvbnRleHRfZmlsZXM6IGNvbnRleHRGaWxlT2JqZWN0cyxcbiAgICAgICAgc3lzdGVtTWVzc2FnZTogc3lzdGVtUHJvbXB0VHlwZVxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICB0eXBlOiBzeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICAgICAgICBwYXRoOlxuICAgICAgICAgICAgICAgIHN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiYgc3lzdGVtUHJvbXB0UGF0aFxuICAgICAgICAgICAgICAgICAgPyBgW1ske3N5c3RlbVByb21wdFBhdGh9XV1gXG4gICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgdG9rZW5MaW1pdCxcbiAgICAgICAgICAgICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2UsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZW50ID0gYC0tLVxcbiR7c3RyaW5naWZ5WWFtbChtZXRhZGF0YSl9LS0tXFxuXFxuJHttZXNzYWdlc1xuICAgICAgICAubWFwKChtc2cpID0+IHtcbiAgICAgICAgICBjb25zdCBtZXNzYWdlU3RhcnQgPSBgPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1TVEFSVCByb2xlPVwiJHttc2cucm9sZX1cIiBtZXNzYWdlLWlkPVwiJHttc2cubWVzc2FnZV9pZH1cIiAtLT5gO1xuICAgICAgICAgIHJldHVybiBgJHttZXNzYWdlU3RhcnR9XFxuJHttc2cuY29udGVudH1cXG48IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLUVORCAtLT5gO1xuICAgICAgICB9KVxuICAgICAgICAuam9pbihcIlxcblxcblwiKX1gO1xuXG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKHRoaXMuY2hhdERpcmVjdG9yeSk7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLndyaXRlKGZpbGVQYXRoLCBjb250ZW50KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIGNoYXQ6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBzYXZlIGNoYXRcIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENoYXRzKCk6IFByb21pc2U8XG4gICAge1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gICAgICBsYXN0TW9kaWZpZWQ6IG51bWJlcjtcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZztcbiAgICB9W11cbiAgPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5saXN0KHRoaXMuY2hhdERpcmVjdG9yeSk7XG4gICAgICBjb25zdCBjaGF0RmlsZXMgPSBmaWxlcy5maWxlcy5maWx0ZXIoKGYpID0+IGYuZW5kc1dpdGgoXCIubWRcIikpO1xuXG4gICAgICBjb25zdCBjaGF0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBjaGF0RmlsZXMubWFwKGFzeW5jIChmaWxlUGF0aCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLnJlYWQoZmlsZVBhdGgpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlTWFya2Rvd25Db250ZW50KGNvbnRlbnQpO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGNoYXRzLmZpbHRlcihcbiAgICAgICAgKGNoYXQpOiBjaGF0IGlzIE5vbk51bGxhYmxlPHR5cGVvZiBjaGF0PiA9PiBjaGF0ICE9PSBudWxsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdHM6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gICAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gICAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgfSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLmNoYXREaXJlY3Rvcnl9LyR7Y2hhdElkfS5tZGA7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZU1hcmtkb3duQ29udGVudChjb250ZW50KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXQ6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVNYXJrZG93bkNvbnRlbnQoXG4gICAgbWV0YWRhdGE6IENoYXRNZXRhZGF0YSxcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHlhbWxNZXRhZGF0YSA9IHtcbiAgICAgIHN5c3RlbXNjdWxwdF9jaGF0OiB0cnVlLFxuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgfTtcblxuICAgIGNvbnN0IG1ldGFkYXRhU2VjdGlvbiA9IFtcbiAgICAgIFwiLS0tXCIsXG4gICAgICBzdHJpbmdpZnlZYW1sKHlhbWxNZXRhZGF0YSkudHJpbSgpLFxuICAgICAgXCItLS1cIixcbiAgICAgIFwiXCIsXG4gICAgXS5qb2luKFwiXFxuXCIpO1xuXG4gICAgY29uc3QgbWVzc2FnZXNTZWN0aW9uID0gbWVzc2FnZXNcbiAgICAgIC5tYXAoKG1zZykgPT5cbiAgICAgICAgW1xuICAgICAgICAgIGA8IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLVNUQVJUIHJvbGU9XCIke21zZy5yb2xlfVwiIG1lc3NhZ2UtaWQ9XCIke21zZy5tZXNzYWdlX2lkfVwiIC0tPmAsXG4gICAgICAgICAgbXNnLmNvbnRlbnQsXG4gICAgICAgICAgXCI8IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLUVORCAtLT5cIixcbiAgICAgICAgICBcIlwiLFxuICAgICAgICBdLmpvaW4oXCJcXG5cIilcbiAgICAgIClcbiAgICAgIC5qb2luKFwiXFxuXCIpO1xuXG4gICAgcmV0dXJuIG1ldGFkYXRhU2VjdGlvbiArIG1lc3NhZ2VzU2VjdGlvbjtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VNZXRhZGF0YShjb250ZW50OiBzdHJpbmcpOiBDaGF0TWV0YWRhdGEgfCBudWxsIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWV0YWRhdGFNYXRjaCA9IGNvbnRlbnQubWF0Y2goLy0tLVxcbihbXFxzXFxTXSo/KVxcbi0tLS8pO1xuICAgICAgaWYgKCFtZXRhZGF0YU1hdGNoKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VZYW1sKG1ldGFkYXRhTWF0Y2hbMV0pO1xuICAgICAgaWYgKCFwYXJzZWQgfHwgdHlwZW9mIHBhcnNlZCAhPT0gXCJvYmplY3RcIikgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IHtcbiAgICAgICAgaWQsXG4gICAgICAgIG1vZGVsLFxuICAgICAgICBjcmVhdGVkLFxuICAgICAgICBsYXN0TW9kaWZpZWQsXG4gICAgICAgIHRpdGxlLFxuICAgICAgICBjb250ZXh0X2ZpbGVzLFxuICAgICAgICBzeXN0ZW1NZXNzYWdlLFxuICAgICAgfSA9IHBhcnNlZDtcbiAgICAgIGlmICghaWQgfHwgIW1vZGVsIHx8ICFjcmVhdGVkIHx8ICFsYXN0TW9kaWZpZWQpIHJldHVybiBudWxsO1xuXG4gICAgICAvLyBDb252ZXJ0IG9sZCBmb3JtYXQgKHN0cmluZ1tdKSB0byBuZXcgZm9ybWF0IChDb250ZXh0RmlsZVtdKVxuICAgICAgY29uc3QgcHJvY2Vzc2VkQ29udGV4dEZpbGVzID0gY29udGV4dF9maWxlcz8ubWFwKFxuICAgICAgICAoZmlsZTogc3RyaW5nIHwgQ29udGV4dEZpbGUpID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mIGZpbGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIC8vIExlZ2FjeSBmb3JtYXQgLSBjb252ZXJ0IHRvIG5ldyBmb3JtYXRcbiAgICAgICAgICAgIGNvbnN0IGlzRXh0cmFjdGlvbiA9IGZpbGUuaW5jbHVkZXMoXCIvRXh0cmFjdGlvbnMvXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgcGF0aDogZmlsZSxcbiAgICAgICAgICAgICAgdHlwZTogaXNFeHRyYWN0aW9uXG4gICAgICAgICAgICAgICAgPyAoXCJleHRyYWN0aW9uXCIgYXMgY29uc3QpXG4gICAgICAgICAgICAgICAgOiAoXCJzb3VyY2VcIiBhcyBjb25zdCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogZmlsZS5wYXRoLFxuICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIENsZWFuIHVwIHN5c3RlbSBtZXNzYWdlIHBhdGggaWYgaXQgZXhpc3RzXG4gICAgICBpZiAoc3lzdGVtTWVzc2FnZT8ucGF0aCkge1xuICAgICAgICBzeXN0ZW1NZXNzYWdlLnBhdGggPSBzeXN0ZW1NZXNzYWdlLnBhdGgucmVwbGFjZShcbiAgICAgICAgICAvXlxcW1xcWyguKj8pXFxdXFxdJC8sXG4gICAgICAgICAgXCIkMVwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICBtb2RlbCxcbiAgICAgICAgY3JlYXRlZCxcbiAgICAgICAgbGFzdE1vZGlmaWVkLFxuICAgICAgICB0aXRsZTogdGl0bGUgfHwgXCJVbnRpdGxlZCBDaGF0XCIsXG4gICAgICAgIGNvbnRleHRfZmlsZXM6IHByb2Nlc3NlZENvbnRleHRGaWxlcyB8fCBbXSxcbiAgICAgICAgc3lzdGVtTWVzc2FnZSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgbWV0YWRhdGE6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcGFyc2VNYXJrZG93bkNvbnRlbnQoY29udGVudDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgaWQ6IHN0cmluZztcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgICBsYXN0TW9kaWZpZWQ6IG51bWJlcjtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRleHRfZmlsZXM/OiBzdHJpbmdbXTtcbiAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZztcbiAgICB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICB9IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMucGFyc2VNZXRhZGF0YShjb250ZW50KTtcbiAgICAgIGlmICghbWV0YWRhdGEpIHJldHVybiBudWxsO1xuXG4gICAgICBjb25zdCBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtdO1xuXG4gICAgICAvLyBQYXJzZSB1c2VyIGFuZCBhc3Npc3RhbnQgbWVzc2FnZXNcbiAgICAgIGNvbnN0IG1lc3NhZ2VSZWdleCA9XG4gICAgICAgIC88IS0tIFNZU1RFTVNDVUxQVC1NRVNTQUdFLVNUQVJUIHJvbGU9XCIodXNlcnxhc3Npc3RhbnQpXCIgbWVzc2FnZS1pZD1cIihbXlwiXSspXCIgLS0+XFxuKFtcXHNcXFNdKj8pXFxuPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+L2c7XG5cbiAgICAgIGxldCBtc2dNYXRjaDtcbiAgICAgIHdoaWxlICgobXNnTWF0Y2ggPSBtZXNzYWdlUmVnZXguZXhlYyhjb250ZW50KSkgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgWywgcm9sZSwgbWVzc2FnZUlkLCBtZXNzYWdlQ29udGVudF0gPSBtc2dNYXRjaDtcbiAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogcm9sZSBhcyBDaGF0Um9sZSxcbiAgICAgICAgICBjb250ZW50OiBtZXNzYWdlQ29udGVudC50cmltKCksXG4gICAgICAgICAgbWVzc2FnZV9pZDogbWVzc2FnZUlkLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29udmVydCBDb250ZXh0RmlsZVtdIHRvIHN0cmluZ1tdIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgICBjb25zdCBjb250ZXh0RmlsZXMgPSBtZXRhZGF0YS5jb250ZXh0X2ZpbGVzPy5tYXAoKGZpbGUpID0+XG4gICAgICAgIHR5cGVvZiBmaWxlID09PSBcInN0cmluZ1wiID8gZmlsZSA6IGZpbGUucGF0aFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IG1ldGFkYXRhLmlkLFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgc2VsZWN0ZWRNb2RlbElkOiBtZXRhZGF0YS5tb2RlbCxcbiAgICAgICAgbGFzdE1vZGlmaWVkOiBuZXcgRGF0ZShtZXRhZGF0YS5sYXN0TW9kaWZpZWQpLmdldFRpbWUoKSxcbiAgICAgICAgdGl0bGU6IG1ldGFkYXRhLnRpdGxlLFxuICAgICAgICBjb250ZXh0X2ZpbGVzOiBjb250ZXh0RmlsZXMsXG4gICAgICAgIGN1c3RvbVByb21wdEZpbGVQYXRoOiBtZXRhZGF0YS5zeXN0ZW1NZXNzYWdlPy5wYXRoLFxuICAgICAgICB0b2tlbkxpbWl0OiBtZXRhZGF0YS5zeXN0ZW1NZXNzYWdlPy50b2tlbkxpbWl0LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSBtYXJrZG93biBjb250ZW50OlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWVzc2FnZUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCAoYykgPT4ge1xuICAgICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRNZXRhZGF0YShjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdE1ldGFkYXRhIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuY2hhdERpcmVjdG9yeX0vJHtjaGF0SWR9Lm1kYDtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlTWV0YWRhdGEoY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IG1ldGFkYXRhOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgU2Nyb2xsU3RhdGUge1xuICBpc0F1dG9TY3JvbGxFbmFibGVkOiBib29sZWFuO1xuICBpc1VzZXJTY3JvbGxpbmc6IGJvb2xlYW47XG4gIGxhc3RDb250ZW50SGVpZ2h0OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBTY3JvbGxDb25maWcge1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBvblNjcm9sbFN0YXRlQ2hhbmdlPzogKGlzQXV0b1Njcm9sbEVuYWJsZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBTY3JvbGxNYW5hZ2VyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGU6IFNjcm9sbFN0YXRlID0ge1xuICAgIGlzQXV0b1Njcm9sbEVuYWJsZWQ6IHRydWUsXG4gICAgaXNVc2VyU2Nyb2xsaW5nOiBmYWxzZSxcbiAgICBsYXN0Q29udGVudEhlaWdodDogMCxcbiAgfTtcbiAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG9uU2Nyb2xsU3RhdGVDaGFuZ2U/OiAoaXNBdXRvU2Nyb2xsRW5hYmxlZDogYm9vbGVhbikgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFNjcm9sbENvbmZpZykge1xuICAgIHRoaXMuY29udGFpbmVyID0gY29uZmlnLmNvbnRhaW5lcjtcbiAgICB0aGlzLm9uU2Nyb2xsU3RhdGVDaGFuZ2UgPSBjb25maWcub25TY3JvbGxTdGF0ZUNoYW5nZTtcbiAgICB0aGlzLmF0dGFjaEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaEV2ZW50TGlzdGVuZXJzKCk6IHZvaWQge1xuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5oYW5kbGVTY3JvbGwpO1xuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCB0aGlzLmhhbmRsZVdoZWVsKTtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCB0aGlzLmhhbmRsZVRvdWNoU3RhcnQpO1xuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLmhhbmRsZVRvdWNoRW5kKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU2Nyb2xsID0gZGVib3VuY2UoKCkgPT4ge1xuICAgIGNvbnN0IGlzQXRCb3R0b20gPSB0aGlzLmlzU2Nyb2xsZWRUb0JvdHRvbSgpO1xuICAgIGlmIChpc0F0Qm90dG9tICYmICF0aGlzLnN0YXRlLmlzQXV0b1Njcm9sbEVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZW5hYmxlQXV0b1Njcm9sbCgpO1xuICAgIH0gZWxzZSBpZiAoIWlzQXRCb3R0b20gJiYgdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkKSB7XG4gICAgICB0aGlzLmRpc2FibGVBdXRvU2Nyb2xsKCk7XG4gICAgfVxuICB9LCAxNTApO1xuXG4gIHByaXZhdGUgaGFuZGxlV2hlZWwgPSAoZTogV2hlZWxFdmVudCkgPT4ge1xuICAgIGlmIChlLmRlbHRhWSA8IDApIHtcbiAgICAgIHRoaXMuZGlzYWJsZUF1dG9TY3JvbGwoKTtcbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSBoYW5kbGVUb3VjaFN0YXJ0ID0gKCkgPT4ge1xuICAgIHRoaXMuc3RhdGUuaXNVc2VyU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgfTtcblxuICBwcml2YXRlIGhhbmRsZVRvdWNoRW5kID0gKCkgPT4ge1xuICAgIHRoaXMuc3RhdGUuaXNVc2VyU2Nyb2xsaW5nID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuaXNTY3JvbGxlZFRvQm90dG9tKCkpIHtcbiAgICAgIHRoaXMuZW5hYmxlQXV0b1Njcm9sbCgpO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIGlzU2Nyb2xsZWRUb0JvdHRvbSgpOiBib29sZWFuIHtcbiAgICBjb25zdCB7IHNjcm9sbEhlaWdodCwgc2Nyb2xsVG9wLCBjbGllbnRIZWlnaHQgfSA9IHRoaXMuY29udGFpbmVyO1xuICAgIHJldHVybiBNYXRoLmFicyhzY3JvbGxIZWlnaHQgLSBzY3JvbGxUb3AgLSBjbGllbnRIZWlnaHQpIDwgMTA7XG4gIH1cblxuICBwdWJsaWMgc2Nyb2xsVG9Cb3R0b20oKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmlzQXV0b1Njcm9sbEVuYWJsZWQpIHJldHVybjtcblxuICAgIC8vIEZvcmNlIGxheW91dCByZWNhbGN1bGF0aW9uIHRvIGVuc3VyZSBwcm9wZXIgc2Nyb2xsaW5nXG4gICAgLy8gVGhpcyBpcyBuZWVkZWQgZXNwZWNpYWxseSBmb3IgdGhlIGZpcnN0IG1lc3NhZ2Ugd2hlbiB0aGVyZSdzIG5vIHNjcm9sbGJhciB5ZXRcbiAgICB2b2lkIHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodDtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxUbyh7XG4gICAgICAgIHRvcDogdGhpcy5jb250YWluZXIuc2Nyb2xsSGVpZ2h0LFxuICAgICAgICBiZWhhdmlvcjogdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPyBcInNtb290aFwiIDogXCJhdXRvXCIsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3RhdGUubGFzdENvbnRlbnRIZWlnaHQgPSB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGVuYWJsZUF1dG9TY3JvbGwoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkID0gdHJ1ZTtcbiAgICB0aGlzLnN0YXRlLmlzVXNlclNjcm9sbGluZyA9IGZhbHNlO1xuICAgIHRoaXMuc3RhdGUubGFzdENvbnRlbnRIZWlnaHQgPSB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgIHRoaXMub25TY3JvbGxTdGF0ZUNoYW5nZT8uKHRydWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNhYmxlQXV0b1Njcm9sbCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlLmlzQXV0b1Njcm9sbEVuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLm9uU2Nyb2xsU3RhdGVDaGFuZ2U/LihmYWxzZSk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlQ29udGVudEhlaWdodCgpOiB2b2lkIHtcbiAgICAvLyBGb3JjZSBsYXlvdXQgcmVjYWxjdWxhdGlvblxuICAgIHZvaWQgdGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0O1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRIZWlnaHQgPSB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgICBpZiAoY3VycmVudEhlaWdodCAhPT0gdGhpcy5zdGF0ZS5sYXN0Q29udGVudEhlaWdodCkge1xuICAgICAgICB0aGlzLnN0YXRlLmxhc3RDb250ZW50SGVpZ2h0ID0gY3VycmVudEhlaWdodDtcbiAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgZmlyc3QgY29udGVudCAobm8gc2Nyb2xsIHlldCkgb3Igd2UncmUgYWxyZWFkeSBhdCBib3R0b21cbiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AgfHwgdGhpcy5pc1Njcm9sbGVkVG9Cb3R0b20oKSkge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNsZWFudXAoKTogdm9pZCB7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIndoZWVsXCIsIHRoaXMuaGFuZGxlV2hlZWwpO1xuICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHRoaXMuaGFuZGxlVG91Y2hTdGFydCk7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIHRoaXMuaGFuZGxlVG91Y2hFbmQpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJhd2VyT3B0aW9ucyB7XG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNscz86IHN0cmluZztcbiAgb25WaXNpYmlsaXR5Q2hhbmdlPzogKHZpc2libGU6IGJvb2xlYW4pID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBEcmF3ZXJDb21wb25lbnQgZXh0ZW5kcyBDb21wb25lbnQge1xuICBwcml2YXRlIGRyYXdlcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgaGVhZGVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSB0b2dnbGU6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGlzTW91c2VJblByb3hpbWl0eSA9IGZhbHNlO1xuICBwcml2YXRlIGhpZGVUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIG9wdGlvbnM6IERyYXdlck9wdGlvbnM7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogRHJhd2VyT3B0aW9ucykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLmluaXRpYWxpemVEcmF3ZXIoKTtcbiAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZURyYXdlcigpOiB2b2lkIHtcbiAgICB0aGlzLmRyYXdlciA9IHRoaXMub3B0aW9ucy5jb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LWRyYXdlciAke3RoaXMub3B0aW9ucy5jbHMgfHwgXCJcIn1gLFxuICAgIH0pO1xuXG4gICAgdGhpcy5oZWFkZXIgPSB0aGlzLmRyYXdlci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1oZWFkZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IHRpdGxlRWwgPSB0aGlzLmhlYWRlci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci10aXRsZVwiLFxuICAgIH0pO1xuICAgIHRpdGxlRWwuY3JlYXRlU3Bhbih7IHRleHQ6IHRoaXMub3B0aW9ucy50aXRsZSB9KTtcblxuICAgIHRoaXMudG9nZ2xlID0gdGhpcy5oZWFkZXIuY3JlYXRlU3Bhbih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci10b2dnbGVcIixcbiAgICAgIHRleHQ6IFwiXHUyNUJDXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmRyYXdlci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLnNldFZpc2liaWxpdHkoZmFsc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cEV2ZW50TGlzdGVuZXJzKCk6IHZvaWQge1xuICAgIHRoaXMuZHJhd2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KHRydWUsIHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jb250ZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KHRydWUsIHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5kcmF3ZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmRyYXdlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IDI1O1xuXG4gICAgICBpZiAoXG4gICAgICAgIGUuY2xpZW50WSA+PSByZWN0LmJvdHRvbSAmJlxuICAgICAgICBlLmNsaWVudFkgPD0gcmVjdC5ib3R0b20gKyBidWZmZXIgJiZcbiAgICAgICAgZS5jbGllbnRYID49IHJlY3QubGVmdCAmJlxuICAgICAgICBlLmNsaWVudFggPD0gcmVjdC5yaWdodFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NoZWR1bGVIaWRlKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNvbnRlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCBidWZmZXIgPSAyNTtcblxuICAgICAgaWYgKFxuICAgICAgICBlLmNsaWVudFkgPD0gcmVjdC50b3AgJiZcbiAgICAgICAgZS5jbGllbnRZID49IHJlY3QudG9wIC0gYnVmZmVyICYmXG4gICAgICAgIGUuY2xpZW50WCA+PSByZWN0LmxlZnQgJiZcbiAgICAgICAgZS5jbGllbnRYIDw9IHJlY3QucmlnaHRcbiAgICAgICkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gZmFsc2U7XG4gICAgICB0aGlzLnNjaGVkdWxlSGlkZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhckhpZGVUaW1lb3V0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhpZGVUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5oaWRlVGltZW91dCk7XG4gICAgICB0aGlzLmhpZGVUaW1lb3V0ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNjaGVkdWxlSGlkZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFySGlkZVRpbWVvdXQoKTtcbiAgICB0aGlzLmhpZGVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNNb3VzZUluUHJveGltaXR5KSB7XG4gICAgICAgIHRoaXMuc2V0VmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICB9XG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRWaXNpYmlsaXR5KHZpc2libGU6IGJvb2xlYW4sIGV4cGFuZGVkOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRlbnQuc3R5bGUub3BhY2l0eSA9IHZpc2libGUgPyBcIjFcIiA6IFwiMFwiO1xuICAgIHRoaXMuY29udGVudC5zdHlsZS5wb2ludGVyRXZlbnRzID0gdmlzaWJsZSA/IFwiYWxsXCIgOiBcIm5vbmVcIjtcbiAgICB0aGlzLmNvbnRlbnQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoJHt2aXNpYmxlID8gXCIwXCIgOiBcIi04cHhcIn0pYDtcbiAgICB0aGlzLnRvZ2dsZS5zdHlsZS50cmFuc2Zvcm0gPSB2aXNpYmxlID8gXCJyb3RhdGUoMClcIiA6IFwicm90YXRlKC05MGRlZylcIjtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMub25WaXNpYmlsaXR5Q2hhbmdlKSB7XG4gICAgICB0aGlzLm9wdGlvbnMub25WaXNpYmlsaXR5Q2hhbmdlKHZpc2libGUpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRDb250ZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50O1xuICB9XG5cbiAgcHVibGljIGdldERyYXdlcigpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd2VyO1xuICB9XG5cbiAgcHVibGljIGdldEhlYWRlcigpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuaGVhZGVyO1xuICB9XG5cbiAgb251bmxvYWQoKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgc3VwZXIub251bmxvYWQoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IE1hcmtkb3duUmVuZGVyZXIsIFRGaWxlLCBBcHAsIENvbXBvbmVudCwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgQ2hhdFJvbGUsIEltYWdlQ29udGVudCwgTXVsdGlQYXJ0Q29udGVudCB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgc2hvd1BvcHVwLCBUZXh0QXJlYU1vZGFsIH0gZnJvbSBcIi4uLy4uL2NvcmUvdWlcIjtcblxuZXhwb3J0IGludGVyZmFjZSBNZXNzYWdlUmVuZGVyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgcm9sZTogQ2hhdFJvbGU7XG4gIGNvbnRlbnQ6IHN0cmluZyB8IE11bHRpUGFydENvbnRlbnRbXTtcbn1cblxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VSZW5kZXJlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHJlbmRlck1lc3NhZ2Uoe1xuICAgIGFwcCxcbiAgICBtZXNzYWdlSWQsXG4gICAgcm9sZSxcbiAgICBjb250ZW50LFxuICB9OiB7XG4gICAgYXBwOiBBcHA7XG4gICAgbWVzc2FnZUlkOiBzdHJpbmc7XG4gICAgcm9sZTogQ2hhdFJvbGU7XG4gICAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xuICB9KTogUHJvbWlzZTx7IG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQ7IGNvbnRlbnRFbDogSFRNTEVsZW1lbnQgfT4ge1xuICAgIGNvbnN0IG1lc3NhZ2VFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbWVzc2FnZUVsLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQtbWVzc2FnZVwiKTtcbiAgICBtZXNzYWdlRWwuY2xhc3NMaXN0LmFkZChgc3lzdGVtc2N1bHB0LSR7cm9sZX0tbWVzc2FnZWApO1xuICAgIG1lc3NhZ2VFbC5kYXRhc2V0Lm1lc3NhZ2VJZCA9IG1lc3NhZ2VJZDtcblxuICAgIGNvbnN0IGNvbnRlbnRFbCA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtY29udGVudFwiLFxuICAgIH0pO1xuXG4gICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAvLyBFeGlzdGluZyBwYXRoOiB0cmVhdCBpdCBhcyBtYXJrZG93biB0ZXh0XG4gICAgICBhd2FpdCBNYXJrZG93blJlbmRlcmVyLnJlbmRlck1hcmtkb3duKGNvbnRlbnQsIGNvbnRlbnRFbCwgXCJcIiwgdGhpcyk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7XG4gICAgICBjb25zdCBwYXJ0cyA9IGNvbnRlbnQgYXMgTXVsdGlQYXJ0Q29udGVudFtdO1xuICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIHBhcnRzKSB7XG4gICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgLy8gU2ltcGxlIHRleHQgc25pcHBldFxuICAgICAgICAgIGNvbnN0IHAgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJwXCIpO1xuICAgICAgICAgIHAuc2V0VGV4dChwYXJ0LnRleHQpO1xuICAgICAgICB9IGVsc2UgaWYgKHBhcnQudHlwZSA9PT0gXCJpbWFnZV91cmxcIikge1xuICAgICAgICAgIC8vIEluc2VydCB0aGUgPGltZz5cbiAgICAgICAgICBjb25zdCBpbWcgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJpbWdcIiwge1xuICAgICAgICAgICAgYXR0cjogeyBzcmM6IHBhcnQuaW1hZ2VfdXJsLnVybCB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGltZy5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtaW1hZ2VcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRmFsbGJhY2sgaWYgbmVlZGVkXG4gICAgICBhd2FpdCBNYXJrZG93blJlbmRlcmVyLnJlbmRlck1hcmtkb3duKFxuICAgICAgICBTdHJpbmcoY29udGVudCksXG4gICAgICAgIGNvbnRlbnRFbCxcbiAgICAgICAgXCJcIixcbiAgICAgICAgdGhpc1xuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5zZXR1cEltYWdlSGFuZGxlcnMoY29udGVudEVsKTtcblxuICAgIHJldHVybiB7IG1lc3NhZ2VFbCwgY29udGVudEVsIH07XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVuZGVyTWFya2Rvd25Db250ZW50KFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnRcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IG1hcmtkb3duV3JhcHBlciA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWFya2Rvd24td3JhcHBlclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgbm9ybWFsaXplZENvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoL1xcbnszLH0vZywgXCJcXG5cXG5cIik7XG5cbiAgICBhd2FpdCBNYXJrZG93blJlbmRlcmVyLnJlbmRlck1hcmtkb3duKFxuICAgICAgbm9ybWFsaXplZENvbnRlbnQsXG4gICAgICBtYXJrZG93bldyYXBwZXIsXG4gICAgICBcIlwiLFxuICAgICAgdGhpc1xuICAgICk7XG5cbiAgICBtYXJrZG93bldyYXBwZXIucXVlcnlTZWxlY3RvckFsbChcInByZVwiKS5mb3JFYWNoKChwcmVFbCkgPT4ge1xuICAgICAgY29uc3QgY29kZUJsb2NrV3JhcHBlciA9IGNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb2RlLWJsb2NrLXdyYXBwZXJcIixcbiAgICAgIH0pO1xuXG4gICAgICBwcmVFbC5wYXJlbnROb2RlPy5yZXBsYWNlQ2hpbGQoY29kZUJsb2NrV3JhcHBlciwgcHJlRWwpO1xuICAgICAgY29kZUJsb2NrV3JhcHBlci5hcHBlbmRDaGlsZChwcmVFbCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc2V0dXBJbWFnZUhhbmRsZXJzKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbWdcIikuZm9yRWFjaCgoaW1nKSA9PiB7XG4gICAgICBpbWcuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XG4gICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBjb25zdCBzcmMgPSBpbWcuZ2V0QXR0cmlidXRlKFwic3JjXCIpO1xuICAgICAgICBpZiAoIXNyYykgcmV0dXJuO1xuXG4gICAgICAgIGlmIChzcmMuc3RhcnRzV2l0aChcImFwcDovL1wiKSkge1xuICAgICAgICAgIGNvbnN0IHBhdGggPSBzcmMucmVwbGFjZShcImFwcDovL2xvY2FsL1wiLCBcIlwiKTtcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub3BlbkxpbmtUZXh0KHBhdGgsIFwiXCIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9vbGJhclZpc2liaWxpdHkoXG4gICAgdG9vbGJhcjogSFRNTEVsZW1lbnQsXG4gICAgdmlzaWJsZTogYm9vbGVhbixcbiAgICBleHBhbmRlZDogYm9vbGVhbiA9IGZhbHNlXG4gICk6IHZvaWQge1xuICAgIHRvb2xiYXIuc3R5bGUub3BhY2l0eSA9IHZpc2libGUgPyBcIjFcIiA6IFwiMFwiO1xuICAgIHRvb2xiYXIuc3R5bGUucG9pbnRlckV2ZW50cyA9IHZpc2libGUgPyBcImFsbFwiIDogXCJub25lXCI7XG4gICAgdG9vbGJhci5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWShjYWxjKDEwMCUgKyAke1xuICAgICAgZXhwYW5kZWQgPyBcIjRcIiA6IFwiOFwiXG4gICAgfXB4KSlgO1xuICB9XG5cbiAgcHVibGljIGFkZE1lc3NhZ2VCdXR0b25Ub29sYmFyKFxuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQsXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIHJvbGU6IENoYXRSb2xlLFxuICAgIG1lc3NhZ2VJZDogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGJ1dHRvblRvb2xiYXIgPSBtZXNzYWdlRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlLWJ1dHRvbi10b29sYmFyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjb3B5QnV0dG9uID0gYnV0dG9uVG9vbGJhci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29weUJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIkNvcHkgbWVzc2FnZSB0byBjbGlwYm9hcmRcIik7XG4gICAgc2V0SWNvbihjb3B5QnV0dG9uLCBcImNvcHlcIik7XG4gICAgY29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29udGVudCk7XG4gICAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY2hlY2tcIik7XG4gICAgICBjb3B5QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJzdWNjZXNzXCIpO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc2V0SWNvbihjb3B5QnV0dG9uLCBcImNvcHlcIik7XG4gICAgICAgIGNvcHlCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcInN1Y2Nlc3NcIik7XG4gICAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgZmFsc2UpO1xuICAgICAgfSwgMjAwMCk7XG4gICAgfSk7XG5cbiAgICBpZiAocm9sZSA9PT0gXCJ1c2VyXCIpIHtcbiAgICAgIGNvbnN0IHJlc3VibWl0QnV0dG9uID0gYnV0dG9uVG9vbGJhci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICAgIH0pO1xuICAgICAgcmVzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgXCJSZXN1Ym1pdCB0aGlzIG1lc3NhZ2VcIik7XG4gICAgICBzZXRJY29uKHJlc3VibWl0QnV0dG9uLCBcInJvdGF0ZS1jY3dcIik7XG4gICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiA9IFwicm90YXRlLWNjd1wiO1xuXG4gICAgICByZXN1Ym1pdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgaXNDb25maXJtaW5nID0gcmVzdWJtaXRCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID09PSBcInRydWVcIjtcblxuICAgICAgICBpZiAoIWlzQ29uZmlybWluZykge1xuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwidHJ1ZVwiO1xuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmVtcHR5KCk7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uY3JlYXRlRWwoXCJzcGFuXCIsIHsgdGV4dDogXCJSZXN1Ym1pdD9cIiB9KTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY29uZmlybWluZ1wiLCBcInN1Y2Nlc3NcIik7XG5cbiAgICAgICAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmVtcHR5KCk7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbEljb24gPVxuICAgICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInJvdGF0ZS1jY3dcIjtcbiAgICAgICAgICAgIHNldEljb24ocmVzdWJtaXRCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY29uZmlybWluZ1wiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZGF0YXNldC50aW1lb3V0SWQgPSB0aW1lb3V0SWQudG9TdHJpbmcoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB0aW1lb3V0SWQgPSByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZDtcbiAgICAgICAgICBpZiAodGltZW91dElkKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQocGFyc2VJbnQodGltZW91dElkKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmVtcHR5KCk7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uY3JlYXRlRWwoXCJzcGFuXCIsIHsgdGV4dDogXCJSZXN1Ym1pdHRpbmcuLi5cIiB9KTtcblxuICAgICAgICAgIG1lc3NhZ2VFbC5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KFwicmVzdWJtaXRcIiwge1xuICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgICBkZXRhaWw6IHsgbWVzc2FnZUlkLCBjb250ZW50IH0sXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmVtcHR5KCk7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbEljb24gPVxuICAgICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInJvdGF0ZS1jY3dcIjtcbiAgICAgICAgICAgIHNldEljb24ocmVzdWJtaXRCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY29uZmlybWluZ1wiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhbiBcIkVkaXRcIiBidXR0b25cbiAgICBjb25zdCBlZGl0QnV0dG9uID0gYnV0dG9uVG9vbGJhci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgZWRpdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIkVkaXQgdGhpcyBtZXNzYWdlXCIpO1xuICAgIHNldEljb24oZWRpdEJ1dHRvbiwgXCJwZW5jaWxcIik7XG4gICAgZWRpdEJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiA9IFwicGVuY2lsXCI7XG5cbiAgICAvLyBIYW5kbGUgY2xpY2sgXHUyMTkyIG9wZW4gYW4gZWRpdGluZyBtb2RhbFxuICAgIGVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAvLyBVc2UgZXhpc3RpbmcgdGV4dC1hcmVhIG1vZGFsIGZvciBlZGl0aW5nXG4gICAgICAvLyBHZXQgY3VycmVudCBjb250ZW50IGZyb20gZGF0YXNldCB3aGljaCBpcyBhbHdheXMgdXAtdG8tZGF0ZVxuICAgICAgY29uc3QgY3VycmVudENvbnRlbnQgPSBtZXNzYWdlRWwuZGF0YXNldC5jb250ZW50IHx8IGNvbnRlbnQ7XG4gICAgICBjb25zdCBtb2RhbCA9IG5ldyBUZXh0QXJlYU1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgXCJFZGl0IE1lc3NhZ2VcIixcbiAgICAgICAgY3VycmVudENvbnRlbnQsXG4gICAgICAgIHtcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlNhdmVcIixcbiAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgcm93czogMTAsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IG5ld1RleHQgPSBhd2FpdCBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcbiAgICAgIGlmIChuZXdUZXh0ICE9PSBudWxsICYmIG5ld1RleHQgIT09IGN1cnJlbnRDb250ZW50KSB7XG4gICAgICAgIC8vIERpc3BhdGNoIGVkaXQgZXZlbnQgd2l0aCBvbGQgYW5kIG5ldyBjb250ZW50XG4gICAgICAgIG1lc3NhZ2VFbC5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgIG5ldyBDdXN0b21FdmVudChcImVkaXRcIiwge1xuICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgIGRldGFpbDoge1xuICAgICAgICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgICAgICAgIG9sZENvbnRlbnQ6IGN1cnJlbnRDb250ZW50LFxuICAgICAgICAgICAgICBuZXdDb250ZW50OiBuZXdUZXh0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgZGVsZXRlQnV0dG9uID0gYnV0dG9uVG9vbGJhci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uIGRhbmdlclwiLFxuICAgIH0pO1xuICAgIGRlbGV0ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIkRlbGV0ZSB0aGlzIG1lc3NhZ2VcIik7XG4gICAgc2V0SWNvbihkZWxldGVCdXR0b24sIFwidHJhc2hcIik7XG4gICAgZGVsZXRlQnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJ0cmFzaFwiO1xuXG4gICAgZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IGlzQ29uZmlybWluZyA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPT09IFwidHJ1ZVwiO1xuXG4gICAgICBpZiAoIWlzQ29uZmlybWluZykge1xuICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJ0cnVlXCI7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICBkZWxldGVCdXR0b24uY3JlYXRlRWwoXCJzcGFuXCIsIHsgdGV4dDogXCJEZWxldGU/XCIgfSk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY29uZmlybWluZ1wiKTtcblxuICAgICAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBkZWxldGVCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbEljb24gPSBkZWxldGVCdXR0b24uZGF0YXNldC5vcmlnaW5hbEljb24gfHwgXCJ0cmFzaFwiO1xuICAgICAgICAgIHNldEljb24oZGVsZXRlQnV0dG9uLCBvcmlnaW5hbEljb24pO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY29uZmlybWluZ1wiKTtcbiAgICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJmYWxzZVwiO1xuICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmRhdGFzZXQudGltZW91dElkID0gdGltZW91dElkLnRvU3RyaW5nKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB0aW1lb3V0SWQgPSBkZWxldGVCdXR0b24uZGF0YXNldC50aW1lb3V0SWQ7XG4gICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQocGFyc2VJbnQodGltZW91dElkKSk7XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlQnV0dG9uLmVtcHR5KCk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIkRlbGV0aW5nLi4uXCIgfSk7XG5cbiAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KFwiZGVsZXRlXCIsIHtcbiAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICBkZXRhaWw6IHsgbWVzc2FnZUlkIH0sXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBkZWxldGVCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbEljb24gPSBkZWxldGVCdXR0b24uZGF0YXNldC5vcmlnaW5hbEljb24gfHwgXCJ0cmFzaFwiO1xuICAgICAgICAgIHNldEljb24oZGVsZXRlQnV0dG9uLCBvcmlnaW5hbEljb24pO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY29uZmlybWluZ1wiKTtcbiAgICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJmYWxzZVwiO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICB0aGlzLnNldFRvb2xiYXJWaXNpYmlsaXR5KGJ1dHRvblRvb2xiYXIsIHRydWUsIHRydWUpO1xuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgICFlLnJlbGF0ZWRUYXJnZXQgfHxcbiAgICAgICAgIWJ1dHRvblRvb2xiYXIuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0IGFzIE5vZGUpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5zZXRUb29sYmFyVmlzaWJpbGl0eShidXR0b25Ub29sYmFyLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBidXR0b25Ub29sYmFyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICBpZiAoIWUucmVsYXRlZFRhcmdldCB8fCAhbWVzc2FnZUVsLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCBhcyBOb2RlKSkge1xuICAgICAgICB0aGlzLnNldFRvb2xiYXJWaXNpYmlsaXR5KGJ1dHRvblRvb2xiYXIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVSZWFzb25pbmdDb250YWluZXIobWVzc2FnZUVsOiBIVE1MRWxlbWVudCk6IHtcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIGNvbnRlbnQ6IEhUTUxFbGVtZW50O1xuICB9IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBtZXNzYWdlRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBoZWFkZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1yZWFzb25pbmctaGVhZGVyXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihoZWFkZXIsIFwiYnJhaW5cIik7XG4gICAgaGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlJlYXNvbmluZ1wiIH0pO1xuXG4gICAgLy8gQWRkIGNsaWNrIGhhbmRsZXIgdG8gdG9nZ2xlIGNvbGxhcHNlXG4gICAgaGVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShcImNvbGxhcHNlZFwiKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGVudFwiLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgY29udGFpbmVyLCBjb250ZW50IH07XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlUmVhc29uaW5nQ29udGVudChcbiAgICBtZXNzYWdlRWw6IEhUTUxFbGVtZW50LFxuICAgIHJlYXNvbmluZzogc3RyaW5nLFxuICAgIGlzQ29tcGxldGU6IGJvb2xlYW4gPSBmYWxzZVxuICApOiB2b2lkIHtcbiAgICBsZXQgY29udGFpbmVyID0gbWVzc2FnZUVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5zeXN0ZW1zY3VscHQtcmVhc29uaW5nLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICBsZXQgY29udGVudCA9IG1lc3NhZ2VFbC5xdWVyeVNlbGVjdG9yKFwiLnN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGVudFwiKTtcblxuICAgIGlmICghY29udGFpbmVyIHx8ICFjb250ZW50KSB7XG4gICAgICBjb25zdCBlbGVtZW50cyA9IHRoaXMuY3JlYXRlUmVhc29uaW5nQ29udGFpbmVyKG1lc3NhZ2VFbCk7XG4gICAgICBjb250YWluZXIgPSBlbGVtZW50cy5jb250YWluZXI7XG4gICAgICBjb250ZW50ID0gZWxlbWVudHMuY29udGVudDtcbiAgICAgIG1lc3NhZ2VFbC5wcmVwZW5kKGNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgY29udGVudC50ZXh0Q29udGVudCA9IHJlYXNvbmluZztcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XG5cbiAgICAvLyBBdXRvLWNvbGxhcHNlIHdoZW4gc3RyZWFtaW5nIGlzIGNvbXBsZXRlXG4gICAgaWYgKGlzQ29tcGxldGUpIHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiY29sbGFwc2VkXCIpO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIHNldEljb24sIENvbXBvbmVudCwgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQge1xuICBDaGF0TWVzc2FnZSxcbiAgU3lzdGVtUHJvbXB0SW5mbyxcbiAgQ2hhdFJvbGUsXG4gIE11bHRpUGFydENvbnRlbnQsXG4gIFBBVFJFT05fVVJMLFxufSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgRVJST1JfQ09ERVMsIFN5c3RlbVNjdWxwdEVycm9yIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2Vycm9yc1wiO1xuaW1wb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlLCBzaG93UG9wdXAgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgSW1hZ2VQcm9jZXNzb3IgfSBmcm9tIFwiLi4vLi4vdXRpbHMvSW1hZ2VQcm9jZXNzb3JcIjtcbmltcG9ydCB7IFNjcm9sbE1hbmFnZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1Njcm9sbE1hbmFnZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNZXNzYWdlUmVuZGVyZXIgfSBmcm9tIFwiLi9NZXNzYWdlUmVuZGVyZXJcIjtcbmltcG9ydCB7IFJlY29yZGVyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgVG9rZW5Db3VudGVyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9Ub2tlbkNvdW50ZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5wdXRIYW5kbGVyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIGdldE1lc3NhZ2VzOiAoKSA9PiBDaGF0TWVzc2FnZVtdO1xuICBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHN0cmluZztcbiAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiBTeXN0ZW1Qcm9tcHRJbmZvO1xuICBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIG1lc3NhZ2VSZW5kZXJlcjogTWVzc2FnZVJlbmRlcmVyO1xuICBvbk1lc3NhZ2VTdWJtaXQ6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkNvbnRleHRGaWxlQWRkOiAod2lraWxpbms6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25FcnJvcjogKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcikgPT4gdm9pZDtcbiAgb25BZGRDb250ZXh0RmlsZTogKCkgPT4gdm9pZDtcbiAgb25FZGl0U3lzdGVtUHJvbXB0OiAoKSA9PiB2b2lkO1xuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgY2hhdFZpZXc6IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIElucHV0SGFuZGxlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZ2V0TWVzc2FnZXM6ICgpID0+IENoYXRNZXNzYWdlW107XG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiBzdHJpbmc7XG4gIHByaXZhdGUgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgcHJpdmF0ZSBnZXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IFN5c3RlbVByb21wdEluZm87XG4gIHByaXZhdGUgY2hhdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIHByaXZhdGUgbWVzc2FnZVJlbmRlcmVyOiBNZXNzYWdlUmVuZGVyZXI7XG4gIHByaXZhdGUgb25NZXNzYWdlU3VibWl0OiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIG9uQ29udGV4dEZpbGVBZGQ6ICh3aWtpbGluazogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIG9uRXJyb3I6IChlcnJvcjogc3RyaW5nIHwgU3lzdGVtU2N1bHB0RXJyb3IpID0+IHZvaWQ7XG4gIHByaXZhdGUgb25BZGRDb250ZXh0RmlsZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgaW5wdXQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHByaXZhdGUgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gIHByaXZhdGUgcmVuZGVyVGltZW91dDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWNvcmRlclNlcnZpY2U6IFJlY29yZGVyU2VydmljZTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBpbnB1dENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgYnV0dG9uR3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcmVjb3JkZXJWaXN1YWxpemVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzUmVjb3JkaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgdXBkYXRlR2VuZXJhdGluZ1N0YXRlOiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIGFib3J0Q29udHJvbGxlcjogQWJvcnRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc3RvcEJ1dHRvbjogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50ZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHRva2VuQ291bnRlclNlcnZpY2U6IFRva2VuQ291bnRlclNlcnZpY2U7XG4gIHByaXZhdGUgdG9rZW5Db3VudFRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY2hhdFZpZXc6IGFueTtcbiAgcHJpdmF0ZSB3ZWJTZWFyY2hFbmFibGVkID0gZmFsc2U7XG4gIHByaXZhdGUgd2ViU2VhcmNoQnV0dG9uOiBIVE1MRWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBJbnB1dEhhbmRsZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmFwcCA9IG9wdGlvbnMuYXBwO1xuICAgIHRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XG4gICAgdGhpcy5haVNlcnZpY2UgPSBvcHRpb25zLmFpU2VydmljZTtcbiAgICB0aGlzLmdldE1lc3NhZ2VzID0gb3B0aW9ucy5nZXRNZXNzYWdlcztcbiAgICB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCA9IG9wdGlvbnMuZ2V0U2VsZWN0ZWRNb2RlbElkO1xuICAgIHRoaXMuZ2V0Q29udGV4dEZpbGVzID0gb3B0aW9ucy5nZXRDb250ZXh0RmlsZXM7XG4gICAgdGhpcy5nZXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLmdldFN5c3RlbVByb21wdDtcbiAgICB0aGlzLmNoYXRDb250YWluZXIgPSBvcHRpb25zLmNoYXRDb250YWluZXI7XG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyID0gb3B0aW9ucy5zY3JvbGxNYW5hZ2VyO1xuICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyID0gb3B0aW9ucy5tZXNzYWdlUmVuZGVyZXI7XG4gICAgdGhpcy5vbk1lc3NhZ2VTdWJtaXQgPSBvcHRpb25zLm9uTWVzc2FnZVN1Ym1pdDtcbiAgICB0aGlzLm9uQXNzaXN0YW50UmVzcG9uc2UgPSBvcHRpb25zLm9uQXNzaXN0YW50UmVzcG9uc2U7XG4gICAgdGhpcy5vbkNvbnRleHRGaWxlQWRkID0gb3B0aW9ucy5vbkNvbnRleHRGaWxlQWRkO1xuICAgIHRoaXMub25FcnJvciA9IG9wdGlvbnMub25FcnJvcjtcbiAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUgPSBvcHRpb25zLm9uQWRkQ29udGV4dEZpbGU7XG4gICAgdGhpcy5vbkVkaXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLm9uRWRpdFN5c3RlbVByb21wdDtcbiAgICB0aGlzLnBsdWdpbiA9IG9wdGlvbnMucGx1Z2luO1xuICAgIHRoaXMuY2hhdFZpZXcgPSBvcHRpb25zLmNoYXRWaWV3O1xuXG4gICAgY29uc29sZS5sb2coXCJJbml0aWFsaXppbmcgSW5wdXRIYW5kbGVyIHdpdGggUmVjb3JkZXJTZXJ2aWNlXCIpO1xuICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlID0gUmVjb3JkZXJTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwge1xuICAgICAgaXNJbkNoYXQ6IHRydWUsXG4gICAgICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlY2VpdmVkIHRyYW5zY3JpcHRpb24sIGluc2VydGluZyBhdCBjdXJzb3IgcG9zaXRpb25cIik7XG4gICAgICAgIHRoaXMuaW5zZXJ0VGV4dEF0Q3Vyc29yKHRleHQpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdyYXAgdGhlIG1lc3NhZ2UgaGFuZGxlcnMgdG8gaW5jbHVkZSB0b2tlbiBjb3VudGluZ1xuICAgIGNvbnN0IG9yaWdpbmFsTWVzc2FnZVN1Ym1pdCA9IG9wdGlvbnMub25NZXNzYWdlU3VibWl0O1xuICAgIHRoaXMub25NZXNzYWdlU3VibWl0ID0gYXN5bmMgKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiB7XG4gICAgICBhd2FpdCBvcmlnaW5hbE1lc3NhZ2VTdWJtaXQobWVzc2FnZSk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb3JpZ2luYWxBc3Npc3RhbnRSZXNwb25zZSA9IG9wdGlvbnMub25Bc3Npc3RhbnRSZXNwb25zZTtcbiAgICB0aGlzLm9uQXNzaXN0YW50UmVzcG9uc2UgPSBhc3luYyAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IHtcbiAgICAgIGF3YWl0IG9yaWdpbmFsQXNzaXN0YW50UmVzcG9uc2UobWVzc2FnZSk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9O1xuXG4gICAgdGhpcy50b2tlbkNvdW50ZXJTZXJ2aWNlID0gVG9rZW5Db3VudGVyU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIHRoaXMudG9rZW5Db3VudGVyU2VydmljZS5zZXRBcHAodGhpcy5hcHApO1xuXG4gICAgdGhpcy5zZXR1cElucHV0KCk7XG5cbiAgICAvLyBJbml0aWFsIHRva2VuIGNvdW50IGFmdGVyIHNldHVwXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIlJ1bm5pbmcgaW5pdGlhbCB0b2tlbiBjb3VudFwiKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ3VycmVudCBtZXNzYWdlczpcIiwgdGhpcy5nZXRNZXNzYWdlcygpLmxlbmd0aCk7XG4gICAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9LCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cElucHV0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5idXR0b25HcmlkID0gdGhpcy5pbnB1dENvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1ncmlkXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdHRhY2hCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkFkZCBhdHRhY2htZW50XCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKGF0dGFjaEJ1dHRvbiwgXCJwYXBlcmNsaXBcIik7XG4gICAgYXR0YWNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgLy8gU0hJRlQtY2xpY2sgPT4gZGlyZWN0IHVwbG9hZCB0byBzZXJ2ZXJcbiAgICAgICAgdGhpcy5oYW5kbGVEb2N1bWVudFVwbG9hZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciBjbGljayA9PiBhZGQgY29udGV4dCBmaWxlIGFzIGJlZm9yZVxuICAgICAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHNldHRpbmdzQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJTeXN0ZW0gcHJvbXB0IHNldHRpbmdzXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKHNldHRpbmdzQnV0dG9uLCBcInNldHRpbmdzXCIpO1xuICAgIHNldHRpbmdzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uRWRpdFN5c3RlbVByb21wdCgpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgd2ViU2VhcmNoQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJUb2dnbGUgd2ViIHNlYXJjaFwiIH0sXG4gICAgfSk7XG4gICAgdGhpcy53ZWJTZWFyY2hCdXR0b24gPSB3ZWJTZWFyY2hCdXR0b247XG4gICAgc2V0SWNvbih3ZWJTZWFyY2hCdXR0b24sIFwiZ2xvYmVcIik7XG4gICAgd2ViU2VhcmNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHZXQgY3VycmVudCBwcm92aWRlciBpbmZvXG4gICAgICBjb25zdCBpc05hdGl2ZVByb3ZpZGVyID1cbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIudHlwZSA9PT0gXCJuYXRpdmVcIjtcbiAgICAgIGNvbnN0IGN1cnJlbnRQcm92aWRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maW5kKFxuICAgICAgICAocCkgPT4gcC5pZCA9PT0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIuaWRcbiAgICAgICk7XG4gICAgICBjb25zdCBpc09wZW5Sb3V0ZXIgPSBjdXJyZW50UHJvdmlkZXI/LmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKTtcblxuICAgICAgLy8gT25seSBhbGxvdyB3ZWIgc2VhcmNoIGZvciBuYXRpdmUgbW9kZWxzIG9yIE9wZW5Sb3V0ZXJcbiAgICAgIGlmICghaXNOYXRpdmVQcm92aWRlciAmJiAhaXNPcGVuUm91dGVyKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIldlYiBzZWFyY2ggYWxsb3dzIHRoZSBBSSB0byBhY2Nlc3MgcmVhbC10aW1lIGluZm9ybWF0aW9uIGZyb20gdGhlIGludGVybmV0IHRvIHByb3ZpZGUgdXAtdG8tZGF0ZSBhbnN3ZXJzLlwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkZlYXR1cmUgUmVzdHJpY3Rpb24gLSBXZWIgU2VhcmNoXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgXCJXZWIgc2VhcmNoIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBTeXN0ZW1TY3VscHQgYW5kIE9wZW5Sb3V0ZXIgbW9kZWxzLiBQbGVhc2Ugc3dpdGNoIHRvIGEgY29tcGF0aWJsZSBtb2RlbCB0byB1c2UgdGhpcyBmZWF0dXJlLlwiLFxuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndlYlNlYXJjaEVuYWJsZWQgPSAhdGhpcy53ZWJTZWFyY2hFbmFibGVkO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpcy1lbmFibGVkXCIsIHRoaXMud2ViU2VhcmNoRW5hYmxlZCk7XG4gICAgfSk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBwcm8gbGljZW5zZVxuICAgIGNvbnN0IGhhc1Byb0xpY2Vuc2UgPVxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpICYmXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQ7XG5cbiAgICAvLyBDcmVhdGUgbWljIGJ1dHRvbiB3aXRoIHByby1vbmx5IGhhbmRsaW5nXG4gICAgY29uc3QgbWljQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1taWMtYnV0dG9uJHtcbiAgICAgICAgaGFzUHJvTGljZW5zZSA/IFwiXCIgOiBcIiBwcm8tZmVhdHVyZVwiXG4gICAgICB9YCxcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgXCJhcmlhLWxhYmVsXCI6IGhhc1Byb0xpY2Vuc2VcbiAgICAgICAgICA/IFwiUmVjb3JkIGF1ZGlvIG1lc3NhZ2VcIlxuICAgICAgICAgIDogXCJSZWNvcmQgYXVkaW8gbWVzc2FnZSAoUHJvIGZlYXR1cmUpXCIsXG4gICAgICAgIFwiYXJpYS1kaXNhYmxlZFwiOiAoIWhhc1Byb0xpY2Vuc2UpLnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiBoYXNQcm9MaWNlbnNlXG4gICAgICAgICAgPyBcIlJlY29yZCBhdWRpbyBtZXNzYWdlXCJcbiAgICAgICAgICA6IFwiUmVjb3JkaW5nIGlzIGEgUHJvIGZlYXR1cmUuIENsaWNrIHRvIGxlYXJuIG1vcmUuXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHNldEljb24obWljQnV0dG9uLCBcIm1pY1wiKTtcblxuICAgIC8vIEFkZC9yZW1vdmUgZGlzYWJsZWQgY2xhc3MgYmFzZWQgb24gbGljZW5zZSBzdGF0dXNcbiAgICBtaWNCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsICFoYXNQcm9MaWNlbnNlKTtcblxuICAgIG1pY0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFoYXNQcm9MaWNlbnNlKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlZvaWNlIHJlY29yZGluZyBhbGxvd3MgeW91IHRvIHF1aWNrbHkgY2FwdHVyZSB5b3VyIHRob3VnaHRzIGJ5IHNwZWFraW5nIGluc3RlYWQgb2YgdHlwaW5nLiBUaGlzIGZlYXR1cmUgaW5jbHVkZXMgYXV0b21hdGljIHRyYW5zY3JpcHRpb24gb2YgeW91ciByZWNvcmRpbmdzIHRvIHRleHQuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvIEZlYXR1cmUgLSBWb2ljZSBSZWNvcmRpbmdcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIlN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYW5kIHVubG9jayB2b2ljZSByZWNvcmRpbmcsIHRyYW5zY3JpcHRpb24sIGFuZCBvdGhlciBwcmVtaXVtIGZlYXR1cmVzIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaGFuZGxlTWljQ2xpY2soKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlbmRCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1zZW5kLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJTZW5kIG1lc3NhZ2VcIiB9LFxuICAgIH0pO1xuICAgIHNldEljb24oc2VuZEJ1dHRvbiwgXCJzZW5kXCIpO1xuICAgIHNlbmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGFuZGxlU2VuZE1lc3NhZ2UuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBDcmVhdGUgc3RvcCBidXR0b24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuc3RvcEJ1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b24gc3lzdGVtc2N1bHB0LXN0b3AtYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIlN0b3AgZ2VuZXJhdGlvblwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbih0aGlzLnN0b3BCdXR0b24sIFwic3F1YXJlXCIpO1xuICAgIHRoaXMuc3RvcEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5zdG9wQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcImNsaWNrXCIsXG4gICAgICB0aGlzLmhhbmRsZVN0b3BHZW5lcmF0aW9uLmJpbmQodGhpcylcbiAgICApO1xuXG4gICAgdGhpcy5pbnB1dCA9IHRoaXMuaW5wdXRDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0IHN5c3RlbXNjdWxwdC1jaGF0LWlucHV0XCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHJvd3M6IFwiMVwiLFxuICAgICAgICBwbGFjZWhvbGRlcjogXCJUeXBlIGEgbWVzc2FnZS4uLlwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0b2tlbiBjb3VudGVyIGVsZW1lbnRcbiAgICB0aGlzLnRva2VuQ291bnRlciA9IHRoaXMuaW5wdXRDb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1jb3VudGVyXCIsXG4gICAgICB0ZXh0OiBcIjAgdG9rZW5zXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCB0aGlzLmFkanVzdElucHV0SGVpZ2h0LmJpbmQodGhpcykpO1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcInBhc3RlXCIsIHRoaXMuaGFuZGxlUGFzdGUuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBTaW1wbGlmaWVkIHJlY29yZGVyIGhhbmRsaW5nXG4gICAgdGhpcy5yZWNvcmRlclNlcnZpY2Uub25Ub2dnbGUoKGlzUmVjb3JkaW5nKSA9PiB7XG4gICAgICB0aGlzLmlzUmVjb3JkaW5nID0gaXNSZWNvcmRpbmc7XG4gICAgICBjb25zdCBtaWNCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuc3lzdGVtc2N1bHB0LW1pYy1idXR0b25cIlxuICAgICAgKTtcbiAgICAgIGlmIChtaWNCdXR0b24pIHtcbiAgICAgICAgbWljQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmVcIiwgaXNSZWNvcmRpbmcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIFVJIHdoZW4gZ2VuZXJhdGluZyBzdGF0ZSBjaGFuZ2VzXG4gICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUgPSAoKSA9PiB7XG4gICAgICB0aGlzLmlucHV0LmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBzZW5kQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBtaWNCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIGF0dGFjaEJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgc2V0dGluZ3NCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIHdlYlNlYXJjaEJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuXG4gICAgICBpZiAodGhpcy5zdG9wQnV0dG9uKSB7XG4gICAgICAgIHRoaXMuc3RvcEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5pc0dlbmVyYXRpbmcgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgICAgICBzZW5kQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmlzR2VuZXJhdGluZyA/IFwibm9uZVwiIDogXCJmbGV4XCI7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLmlzR2VuZXJhdGluZ1xuICAgICAgICA/IFwiV2FpdGluZyBmb3IgcmVzcG9uc2UuLi5cIlxuICAgICAgICA6IFwiVHlwZSBhIG1lc3NhZ2UuLi5cIjtcblxuICAgICAgLy8gVG9nZ2xlIGRpc2FibGVkIGNsYXNzZXNcbiAgICAgIHRoaXMuaW5wdXQuY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIHNlbmRCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIG1pY0J1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgYXR0YWNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICBzZXR0aW5nc0J1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgfTtcblxuICAgIC8vIEFkZCBpbnB1dCBldmVudCBsaXN0ZW5lciBmb3IgdG9rZW4gY291bnRpbmdcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmFkanVzdElucHV0SGVpZ2h0KCk7XG4gICAgICAvLyBEZWJvdW5jZSB0b2tlbiBjb3VudGluZyB0byBhdm9pZCBleGNlc3NpdmUgZmlsZSByZWFkc1xuICAgICAgaWYgKHRoaXMudG9rZW5Db3VudFRpbWVvdXQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudG9rZW5Db3VudFRpbWVvdXQpO1xuICAgICAgfVxuICAgICAgdGhpcy50b2tlbkNvdW50VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgIH0sIDMwMCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbml0aWFsIHRva2VuIGNvdW50XG4gICAgdGhpcy51cGRhdGVUb2tlbkNvdW50KCkuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVN0b3BHZW5lcmF0aW9uKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmFib3J0Q29udHJvbGxlcikge1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyID0gbnVsbDtcbiAgICAgIHRoaXMuaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU2VuZE1lc3NhZ2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gRmlyc3QsIGNoZWNrIGlmIGEgbW9kZWwgaXMgc2VsZWN0ZWRcbiAgICBjb25zdCBjdXJyZW50TW9kZWxJZCA9IHRoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkKCk7XG4gICAgaWYgKCFjdXJyZW50TW9kZWxJZCB8fCBjdXJyZW50TW9kZWxJZC50cmltKCkgPT09IFwiXCIpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJObyBtb2RlbCBzZWxlY3RlZFwiLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlBsZWFzZSBzZWxlY3QgYW4gQUkgbW9kZWwgYmVmb3JlIHNlbmRpbmcgYSBtZXNzYWdlLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlNlbGVjdCBNb2RlbFwiLFxuICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICB9KTtcbiAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAvLyBPcGVuIHRoZSBtb2RlbCBzZWxlY3Rpb24gbW9kYWxcbiAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlwiLCAvLyBubyBtb2RlbCBpcyBzZWxlY3RlZCBjdXJyZW50bHlcbiAgICAgICAgICBhc3luYyAobW9kZWxJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGNoYXQgdmlldyB3aXRoIHRoZSBjaG9zZW4gbW9kZWxcbiAgICAgICAgICAgIGF3YWl0ICh0aGlzLmNoYXRWaWV3IGFzIGFueSkuc2V0U2VsZWN0ZWRNb2RlbElkKG1vZGVsSWQpO1xuICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFxuICAgICAgICAgICAgICBcIk1vZGVsIHNlbGVjdGVkLiBQbGVhc2UgcmUtc2VuZCB5b3VyIG1lc3NhZ2UuXCIsXG4gICAgICAgICAgICAgIFwiaW5mb1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuOyAvLyBEbyBub3QgcHJvY2VlZCB3aXRoIHNlbmRpbmcgdGhlIG1lc3NhZ2VcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbGljZW5zZSBrZXkgb25seSB3aGVuIHVzaW5nIG5hdGl2ZSBTeXN0ZW1TY3VscHQgbW9kZWxzXG4gICAgaWYgKFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIudHlwZSA9PT0gXCJuYXRpdmVcIiAmJlxuICAgICAgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5IHx8XG4gICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5LnRyaW0oKSlcbiAgICApIHtcbiAgICAgIHNob3dQb3B1cChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIFwiWW91IGRvbid0IGhhdmUgYSBsaWNlbnNlIGtleS4gUGxlYXNlIGFkZCBhIHZhbGlkIGxpY2Vuc2Uga2V5IGluIHNldHRpbmdzIHRvIHVzZSBTeXN0ZW1TY3VscHQgQUkgc3BlY2lmaWMgbW9kZWxzLlwiLFxuICAgICAgICB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiTGljZW5zZSBLZXkgUmVxdWlyZWRcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY29udGVudCA9IHRoaXMuaW5wdXQudmFsdWUudHJpbSgpO1xuICAgIGlmICghY29udGVudCB8fCB0aGlzLmlzR2VuZXJhdGluZykgcmV0dXJuO1xuXG4gICAgLy8gQ2hlY2sgdG9rZW4gbGltaXQgYmVmb3JlIHByb2NlZWRpbmdcbiAgICBjb25zdCB0b2tlbkxpbWl0ID0gdGhpcy5jaGF0Vmlldy5nZXRUb2tlbkxpbWl0Py4oKTtcbiAgICBpZiAodG9rZW5MaW1pdCkge1xuICAgICAgY29uc3QgdGV4dCA9IHRoaXMuaW5wdXQudmFsdWU7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IHRoaXMuZ2V0TWVzc2FnZXMoKTtcbiAgICAgIGNvbnN0IGlucHV0VG9rZW5zID0gdGhpcy50b2tlbkNvdW50ZXJTZXJ2aWNlLmFwcHJveGltYXRlVG9rZW5Db3VudCh0ZXh0KTtcbiAgICAgIGxldCBoaXN0b3J5VG9rZW5zID0gMDtcblxuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPVxuICAgICAgICAgIHR5cGVvZiBtZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICAgID8gbWVzc2FnZS5jb250ZW50XG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UuY29udGVudCk7XG4gICAgICAgIGhpc3RvcnlUb2tlbnMgKz1cbiAgICAgICAgICB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgICBoaXN0b3J5VG9rZW5zICs9IDQ7IC8vIG92ZXJoZWFkXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRvdGFsVG9rZW5zID0gaW5wdXRUb2tlbnMgKyBoaXN0b3J5VG9rZW5zO1xuICAgICAgaWYgKHRvdGFsVG9rZW5zID4gdG9rZW5MaW1pdCkge1xuICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXG4gICAgICAgICAgYENhbm5vdCBzZW5kIG1lc3NhZ2U6IFRva2VuIGxpbWl0IG9mICR7dG9rZW5MaW1pdC50b0xvY2FsZVN0cmluZygpfSBleGNlZWRlZGAsXG4gICAgICAgICAgXCJlcnJvclwiXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmlucHV0LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLmFkanVzdElucHV0SGVpZ2h0KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIHVzZXIgbWVzc2FnZVxuICAgICAgY29uc3QgdXNlck1lc3NhZ2VJZCA9IHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKTtcbiAgICAgIGNvbnN0IHVzZXJNZXNzYWdlOiBDaGF0TWVzc2FnZSA9IHtcbiAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgIGNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IHVzZXJNZXNzYWdlSWQsXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2RpZnkgdGhlIG1vZGVsIElEIGlmIHdlYiBzZWFyY2ggaXMgZW5hYmxlZFxuICAgICAgY29uc3QgbW9kZWxJZCA9IHRoaXMud2ViU2VhcmNoRW5hYmxlZFxuICAgICAgICA/IGAke3RoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkKCl9Om9ubGluZWBcbiAgICAgICAgOiB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCgpO1xuXG4gICAgICAvLyBTZW5kIHRoZSBtZXNzYWdlIGFuZCBwcmVwYXJlIGZvciBhc3Npc3RhbnQgcmVzcG9uc2VcbiAgICAgIGF3YWl0IHRoaXMub25NZXNzYWdlU3VibWl0KHVzZXJNZXNzYWdlKTtcblxuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuXG4gICAgICAvLyBQcmVwYXJlIGFzc2lzdGFudCBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgY29uc3QgeyBtZXNzYWdlRWwsIGNvbnRlbnRFbCB9ID0gdGhpcy5jcmVhdGVBc3Npc3RhbnRNZXNzYWdlQ29udGFpbmVyKCk7XG4gICAgICBtZXNzYWdlRWwuc2V0QXR0cmlidXRlKFwiZGF0YS1tZXNzYWdlLWlkXCIsIHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKSk7XG4gICAgICBtZXNzYWdlRWwuYXBwZW5kQ2hpbGQoY29udGVudEVsKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSByZXNwb25zZSBoYW5kbGluZ1xuICAgICAgbGV0IGZ1bGxSZXNwb25zZSA9IFwiXCI7XG4gICAgICBsZXQgYWNjdW11bGF0ZWRSZWFzb25pbmcgPSBcIlwiO1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUoKTtcblxuICAgICAgY29uc3QgbG9hZGluZ0VsID0gY29udGVudEVsLmNyZWF0ZUVsKFwic3BhblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbG9hZGluZ1wiLFxuICAgICAgICB0ZXh0OiBcIiBcdTI1Q0YgVGhpbmtpbmcuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgdG8gRE9NIGFuZCBzY3JvbGxcbiAgICAgIHRoaXMuY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWwpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuXG4gICAgICAvLyBDcmVhdGUgbmV3IGFib3J0IGNvbnRyb2xsZXIgZm9yIHRoaXMgcmVxdWVzdFxuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG5cbiAgICAgIC8vIEdldCBzeXN0ZW0gcHJvbXB0IGluZm9cbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IHRoaXMuZ2V0U3lzdGVtUHJvbXB0KCk7XG5cbiAgICAgIC8vIFN0cmVhbSB0aGUgcmVzcG9uc2VcbiAgICAgIHRyeSB7XG4gICAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgdGhpcy5haVNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgICAgbWVzc2FnZXM6IHRoaXMuZ2V0TWVzc2FnZXMoKSxcbiAgICAgICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgICAgICBjb250ZXh0RmlsZXM6IHRoaXMuZ2V0Q29udGV4dEZpbGVzKCksXG4gICAgICAgICAgc3lzdGVtUHJvbXB0VHlwZTogc3lzdGVtUHJvbXB0LnR5cGUsXG4gICAgICAgICAgc3lzdGVtUHJvbXB0UGF0aDogc3lzdGVtUHJvbXB0LnBhdGgsXG4gICAgICAgICAgc2lnbmFsOiB0aGlzLmFib3J0Q29udHJvbGxlci5zaWduYWwsXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgaWYgKCFmdWxsUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGxvYWRpbmdFbC50ZXh0Q29udGVudCA9IFwiIFx1MjVDRiBHZW5lcmF0aW5nLi4uXCI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSGFuZGxlIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBjaHVua3NcbiAgICAgICAgICBpZiAoY2h1bmsuY29udGVudCkge1xuICAgICAgICAgICAgZnVsbFJlc3BvbnNlICs9IGNodW5rLmNvbnRlbnQ7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjaGVkdWxlUmVuZGVyKGZ1bGxSZXNwb25zZSwgY29udGVudEVsKTtcbiAgICAgICAgICAgIGNvbnRlbnRFbC5hcHBlbmRDaGlsZChsb2FkaW5nRWwpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChjaHVuay5yZWFzb25pbmcpIHtcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkUmVhc29uaW5nICs9IGNodW5rLnJlYXNvbmluZztcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLnVwZGF0ZVJlYXNvbmluZ0NvbnRlbnQoXG4gICAgICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRW5zdXJlIHByb3BlciBzY3JvbGwgYWZ0ZXIgZWFjaCBjaHVua1xuICAgICAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci51cGRhdGVDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5hbGl6ZSBhc3Npc3RhbnQgcmVzcG9uc2VcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICBsb2FkaW5nRWwucmVtb3ZlKCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHJlYXNvbmluZyBvbmUgZmluYWwgdGltZSB3aXRoIGlzQ29tcGxldGU9dHJ1ZSB0byB0cmlnZ2VyIGF1dG8tY29sbGFwc2VcbiAgICAgICAgaWYgKGFjY3VtdWxhdGVkUmVhc29uaW5nKSB7XG4gICAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIudXBkYXRlUmVhc29uaW5nQ29udGVudChcbiAgICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkUmVhc29uaW5nLFxuICAgICAgICAgICAgdHJ1ZSAvLyBNYXJrIGFzIGNvbXBsZXRlIHRvIHRyaWdnZXIgYXV0by1jb2xsYXBzZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhc3Npc3RhbnRNZXNzYWdlOiBDaGF0TWVzc2FnZSA9IHtcbiAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGZ1bGxSZXNwb25zZSxcbiAgICAgICAgICBtZXNzYWdlX2lkOlxuICAgICAgICAgICAgbWVzc2FnZUVsLmdldEF0dHJpYnV0ZShcImRhdGEtbWVzc2FnZS1pZFwiKSB8fFxuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGF3YWl0IHRoaXMub25Bc3Npc3RhbnRSZXNwb25zZShhc3Npc3RhbnRNZXNzYWdlKTtcblxuICAgICAgICAvLyBBZGQgbWVzc2FnZSB0b29sYmFyIGFmdGVyIHJlc3BvbnNlIGlzIGNvbXBsZXRlXG4gICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLmFkZE1lc3NhZ2VCdXR0b25Ub29sYmFyKFxuICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICBmdWxsUmVzcG9uc2UsXG4gICAgICAgICAgXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICBhc3Npc3RhbnRNZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBGaW5hbCBzY3JvbGwgdG8gYm90dG9tIGFmdGVyIHRvb2xiYXIgaXMgYWRkZWRcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgICAgLy8gSGFuZGxlIG1lc3NhZ2UgdG9vbGJhciBldmVudHNcbiAgICAgICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJkZWxldGVcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBtZXNzYWdlSWQgfSA9IGUuZGV0YWlsO1xuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gdGhpcy5nZXRNZXNzYWdlcygpO1xuICAgICAgICAgIGNvbnN0IGluZGV4ID0gbWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICBsb2FkaW5nRWwucmVtb3ZlKCk7XG4gICAgICAgIG1lc3NhZ2VFbC5yZW1vdmUoKTtcblxuICAgICAgICAvLyBMb2cgYWxsIGVycm9ycyB0byBjb25zb2xlIGZpcnN0XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDaGF0IG1lc3NhZ2UgZXJyb3I6XCIsIHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGVycm9yIGZpbHRlcmluZyAtIGFsd2F5cyBzaG93IGVycm9yc1xuICAgICAgICB0aGlzLm9uRXJyb3IoZXJyb3IpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuICAgICAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBpdCdzIHJlLWVuYWJsZWRcbiAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBMb2cgb3V0ZXIgZXJyb3IgYXMgd2VsbFxuICAgICAgY29uc29sZS5lcnJvcihcIk91dGVyIG1lc3NhZ2UgaGFuZGxpbmcgZXJyb3I6XCIsIHtcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUoKTtcbiAgICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIGl0J3MgcmUtZW5hYmxlZFxuICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgdGhpcy5vbkVycm9yKGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZU1pY0NsaWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzR2VuZXJhdGluZykgcmV0dXJuO1xuICAgIHRoaXMudG9nZ2xlUmVjb3JkaW5nKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHRvZ2dsZVJlY29yZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnJlY29yZGVyU2VydmljZS50b2dnbGVSZWNvcmRpbmcoKTtcbiAgICAvLyBLZWVwIGZvY3VzL2N1cnNvciBpbiBjaGF0XG4gICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVQYXN0ZShlOiBDbGlwYm9hcmRFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGR0ID0gZS5jbGlwYm9hcmREYXRhO1xuICAgIGlmICghZHQpIHJldHVybjtcblxuICAgIC8vIFJldHJpZXZlIGFueSBwbGFpbiB0ZXh0XG4gICAgY29uc3QgcGFzdGVkVGV4dCA9IGR0LmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpID8/IFwiXCI7XG5cbiAgICAvLyBSZXRyaWV2ZSBmaWxlc1xuICAgIGNvbnN0IGFsbEZpbGVzID0gQXJyYXkuZnJvbShkdC5maWxlcyk7XG5cbiAgICAvLyBJZiB3ZSBoYXZlIG5vIGZpbGVzIGJ1dCBkbyBoYXZlIHRleHQsIGxldCB0aGUgbm9ybWFsIHBhc3RlIGhhcHBlblxuICAgIGlmICghYWxsRmlsZXMubGVuZ3RoICYmIHBhc3RlZFRleHQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIGZpbGVzIChhbmQgcG9zc2libHkgYWxzbyB0ZXh0KSwgcHJldmVudCBkZWZhdWx0IHNvIHdlIGNhbiBoYW5kbGUgdGhlbVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICghYWxsRmlsZXMubGVuZ3RoKSB7XG4gICAgICAvLyBJZiBubyBmaWxlcyBhdCBhbGwsIGJ1dCBjb2RlIGhhcyBub3QgcmV0dXJuZWQgeWV0LCBpdCBtZWFucyB0aGVyZSdzIG5vIHRleHQgZWl0aGVyXG4gICAgICAvLyBKdXN0IHJldHVybiBzbyB3ZSBkb24ndCBicmVhayBkZWZhdWx0IGJlaGF2aW9yIGluIGEgY29ybmVyIGNhc2VcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIGFsbCBmaWxlcyBpbiB0aGUgY2xpcGJvYXJkXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBEZXJpdmUgZXh0ZW5zaW9uIGZyb20gZmlsZW5hbWUgb3IgTUlNRSB0eXBlXG4gICAgICAgIGxldCBleHRlbnNpb24gPSBcImJpblwiO1xuICAgICAgICBpZiAoZmlsZS5uYW1lICYmIGZpbGUubmFtZS5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgICAgICBjb25zdCBkb3RJZHggPSBmaWxlLm5hbWUubGFzdEluZGV4T2YoXCIuXCIpO1xuICAgICAgICAgIGlmIChkb3RJZHggPj0gMCkge1xuICAgICAgICAgICAgZXh0ZW5zaW9uID0gZmlsZS5uYW1lLnN1YnN0cmluZyhkb3RJZHggKyAxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChmaWxlLnR5cGUpIHtcbiAgICAgICAgICBjb25zdCBtaW1lUGFydHMgPSBmaWxlLnR5cGUuc3BsaXQoXCIvXCIpO1xuICAgICAgICAgIGlmIChtaW1lUGFydHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICBleHRlbnNpb24gPSBtaW1lUGFydHNbMV0udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0vZywgXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQnVpbGQgYSB0aW1lc3RhbXAtYmFzZWQgZmlsZSBuYW1lXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGlzb1N0cmluZyA9IG5vdy50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgXCItXCIpO1xuICAgICAgICBjb25zdCBuZXdGaWxlTmFtZSA9IGBwYXN0ZWQtJHtpc29TdHJpbmd9LiR7ZXh0ZW5zaW9ufWA7XG5cbiAgICAgICAgLy8gUmVhZCB0aGUgY2xpcGJvYXJkIGZpbGUgYXMgYmluYXJ5XG4gICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpO1xuXG4gICAgICAgIC8vIERldGVybWluZSBhdHRhY2htZW50cyBwYXRoIGZyb20gcGx1Z2luIHNldHRpbmdzXG4gICAgICAgIGNvbnN0IGF0dGFjaG1lbnRzRGlyID1cbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdHRhY2htZW50c0RpcmVjdG9yeSB8fCBcIkF0dGFjaG1lbnRzXCI7XG4gICAgICAgIGNvbnN0IGZpbmFsUGF0aCA9IGAke2F0dGFjaG1lbnRzRGlyfS8ke25ld0ZpbGVOYW1lfWA7XG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRGlyZWN0b3J5RXhpc3RzKGF0dGFjaG1lbnRzRGlyKTtcblxuICAgICAgICAvLyBDcmVhdGUgdGhlIGZpbGUgaW4gdGhlIHZhdWx0XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUJpbmFyeShmaW5hbFBhdGgsIGFycmF5QnVmZmVyKTtcblxuICAgICAgICAvLyBBdHRlbXB0IHRvIGxvYWQgdGhlIG5ld2x5IGNyZWF0ZWQgZmlsZVxuICAgICAgICBjb25zdCBjcmVhdGVkRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaW5hbFBhdGgpO1xuICAgICAgICBpZiAoY3JlYXRlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIC8vIEFkZCB0byB0aGlzIGNoYXQncyBjb250ZXh0XG4gICAgICAgICAgYXdhaXQgdGhpcy5jaGF0Vmlldy5hZGRGaWxlVG9Db250ZXh0KGNyZWF0ZWRGaWxlKTtcbiAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgYFBhc3RlZCBmaWxlIHNhdmVkICYgYWRkZWQgdG8gY29udGV4dDogJHtjcmVhdGVkRmlsZS5uYW1lfWBcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2NhdGUgcGFzdGVkIGZpbGUgaW4gdmF1bHQuXCIpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGhhbmRsaW5nIHBhc3RlZCBmaWxlOlwiLCBlcnIpO1xuICAgICAgICBuZXcgTm90aWNlKGBGYWlsZWQgdG8gaGFuZGxlIHBhc3RlZCBmaWxlOiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5hbGx5LCBpZiB0aGVyZSdzIGFsc28gdGV4dCBpbiB0aGUgc2FtZSBwYXN0ZSBldmVudCwgaW5zZXJ0IHRoYXQgYWZ0ZXIgZmlsZSBoYW5kbGluZ1xuICAgIGlmIChwYXN0ZWRUZXh0KSB7XG4gICAgICB0aGlzLmluc2VydFRleHRBdEN1cnNvcihwYXN0ZWRUZXh0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUtleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTZW5kTWVzc2FnZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlSW1hZ2VQYXN0ZShjbGlwYm9hcmREYXRhOiBEYXRhVHJhbnNmZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZpbGUgPSBjbGlwYm9hcmREYXRhLmZpbGVzWzBdO1xuICAgIGlmICghZmlsZSB8fCAhZmlsZS50eXBlLnN0YXJ0c1dpdGgoXCJpbWFnZS9cIikpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJObyBpbWFnZSBpbiBjbGlwYm9hcmRcIixcbiAgICAgICAgRVJST1JfQ09ERVMuTk9fSU1BR0UsXG4gICAgICAgIDQwMFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCBJbWFnZVByb2Nlc3Nvci5wcm9jZXNzQ2xpcGJvYXJkSW1hZ2UoY2xpcGJvYXJkRGF0YSk7XG4gICAgcmV0dXJuIGJhc2U2NDtcbiAgfVxuXG4gIHByaXZhdGUgYWRqdXN0SW5wdXRIZWlnaHQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlucHV0KSByZXR1cm47XG5cbiAgICB0aGlzLmlucHV0LnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgIGNvbnN0IG5ld0hlaWdodCA9IE1hdGgubWluKE1hdGgubWF4KHRoaXMuaW5wdXQuc2Nyb2xsSGVpZ2h0LCA0OCksIDIwMCk7IC8vIE1pbiA0OHB4LCBtYXggMjAwcHhcbiAgICB0aGlzLmlucHV0LnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodCArIFwicHhcIjtcbiAgfVxuXG4gIHB1YmxpYyBmb2N1cygpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0VmFsdWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dC52YWx1ZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRWYWx1ZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlucHV0KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiSW5wdXQgZWxlbWVudCBub3QgZm91bmQgaW4gc2V0VmFsdWVcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNldCB0aGUgdmFsdWUgZGlyZWN0bHlcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSB2YWx1ZTtcblxuICAgICAgLy8gVHJpZ2dlciBpbnB1dCBldmVudCBmb3IgYW55IGxpc3RlbmVyc1xuICAgICAgY29uc3QgaW5wdXRFdmVudCA9IG5ldyBFdmVudChcImlucHV0XCIsIHtcbiAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KGlucHV0RXZlbnQpO1xuXG4gICAgICAvLyBBZGp1c3QgaGVpZ2h0IGFmdGVyIHZhbHVlIGlzIHNldFxuICAgICAgdGhpcy5hZGp1c3RJbnB1dEhlaWdodCgpO1xuXG4gICAgICAvLyBGb2N1cyB0aGUgaW5wdXQgYW5kIG1vdmUgY3Vyc29yIHRvIGVuZFxuICAgICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICAgICAgdGhpcy5pbnB1dC5zZXRTZWxlY3Rpb25SYW5nZSh2YWx1ZS5sZW5ndGgsIHZhbHVlLmxlbmd0aCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBzZXRWYWx1ZTpcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gc2V0IGlucHV0IHZhbHVlXCIpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1bmxvYWQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucmVuZGVyVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVuZGVyVGltZW91dCk7XG4gICAgfVxuICAgIC8vIEVuc3VyZSByZWNvcmRlciBzZXJ2aWNlIGNsZWFudXBcbiAgICB0aGlzLnJlY29yZGVyU2VydmljZS5zZXRWaXN1YWxpemVyQ2FudmFzKG51bGwpO1xuICAgIGlmICh0aGlzLnJlY29yZGVyVmlzdWFsaXplcikge1xuICAgICAgdGhpcy5yZWNvcmRlclZpc3VhbGl6ZXIucmVtb3ZlKCk7XG4gICAgICB0aGlzLnJlY29yZGVyVmlzdWFsaXplciA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lc3NhZ2VJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBc3Npc3RhbnRNZXNzYWdlQ29udGFpbmVyKCk6IHtcbiAgICBtZXNzYWdlRWw6IEhUTUxFbGVtZW50O1xuICAgIGNvbnRlbnRFbDogSFRNTEVsZW1lbnQ7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBtZXNzYWdlRWw6IGNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZSBzeXN0ZW1zY3VscHQtYXNzaXN0YW50LW1lc3NhZ2VcIixcbiAgICAgIH0pLFxuICAgICAgY29udGVudEVsOiBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtY29udGVudFwiIH0pLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNjaGVkdWxlUmVuZGVyKFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnRcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMucmVuZGVyVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVuZGVyVGltZW91dCk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGN1cnJlbnQgaGVpZ2h0XG4gICAgY29uc3QgY3VycmVudEhlaWdodCA9IGNvbnRhaW5lckVsLm9mZnNldEhlaWdodDtcblxuICAgIC8vIFVwZGF0ZSB0ZXh0IGluIGEgdGVtcG9yYXJ5IGNvbnRhaW5lciB0byBjaGVjayBoZWlnaHRcbiAgICBjb25zdCB0ZW1wQ29udGFpbmVyID1cbiAgICAgIChjb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFwiLnRlbXAtdGV4dFwiKSBhcyBIVE1MRWxlbWVudCkgfHxcbiAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcInRlbXAtdGV4dFwiIH0pO1xuICAgIHRlbXBDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgdGVtcENvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB0ZW1wQ29udGFpbmVyLnN0eWxlLndpZHRoID0gY29udGFpbmVyRWwub2Zmc2V0V2lkdGggKyBcInB4XCI7XG4gICAgYXdhaXQgdGhpcy5tZXNzYWdlUmVuZGVyZXIucmVuZGVyTWFya2Rvd25Db250ZW50KGNvbnRlbnQsIHRlbXBDb250YWluZXIpO1xuXG4gICAgLy8gSWYgaGVpZ2h0IGNoYW5nZWQsIGRvIGEgZnVsbCByZW5kZXJcbiAgICBpZiAoY3VycmVudEhlaWdodCAhPT0gdGVtcENvbnRhaW5lci5vZmZzZXRIZWlnaHQpIHtcbiAgICAgIGF3YWl0IHRoaXMubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1hcmtkb3duQ29udGVudChjb250ZW50LCBjb250YWluZXJFbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSBqdXN0IHVwZGF0ZSB0aGUgdmlzaWJsZSB0ZXh0XG4gICAgICBjb25zdCBsYXN0Q2hpbGQgPSBjb250YWluZXJFbC5sYXN0Q2hpbGQ7XG4gICAgICBpZiAobGFzdENoaWxkICYmIGxhc3RDaGlsZC5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgICAgbGFzdENoaWxkLnRleHRDb250ZW50ID0gY29udGVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhbiB1cFxuICAgIHRlbXBDb250YWluZXIucmVtb3ZlKCk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVEb2N1bWVudFVwbG9hZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdXNlciBoYXMgYSB2YWxpZCBsaWNlbnNlIGtleVxuICAgICAgaWYgKFxuICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8XG4gICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWRcbiAgICAgICkge1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJVcGxvYWQgYW5kIHByb2Nlc3MgZG9jdW1lbnRzIGRpcmVjdGx5IGluIHlvdXIgY2hhdCBjb252ZXJzYXRpb25zLiBTeXN0ZW1TY3VscHQgd2lsbCBhdXRvbWF0aWNhbGx5IGV4dHJhY3QgYW5kIGFuYWx5emUgdGhlIGNvbnRlbnQuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvIEZlYXR1cmUgLSBEb2N1bWVudCBQcm9jZXNzaW5nXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgXCJTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgZG9jdW1lbnQgcHJvY2Vzc2luZywgYW5hbHlzaXMsIGFuZCBvdGhlciBwcmVtaXVtIGZlYXR1cmVzIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgfVxuICAgICAgICApLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRG91YmxlIGNoZWNrIGxpY2Vuc2UgaXMgc3RpbGwgdmFsaWQgd2l0aCBzZXJ2ZXJcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnBsdWdpblxuICAgICAgICAuZ2V0TGljZW5zZU1hbmFnZXIoKVxuICAgICAgICAudmFsaWRhdGVMaWNlbnNlS2V5KHRydWUpO1xuICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIFwiWW91ciBsaWNlbnNlIGFwcGVhcnMgdG8gYmUgaW52YWxpZC4gUGxlYXNlIGNoZWNrIHlvdXIgbGljZW5zZSBrZXkgaW4gc2V0dGluZ3MuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiTGljZW5zZSBJbnZhbGlkXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE5vdyBwcm9jZWVkIHdpdGggZG9jdW1lbnQgdXBsb2FkXG4gICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgICBpZiAoIWZpbGVzLmxlbmd0aCkge1xuICAgICAgICBuZXcgTm90aWNlKFwiTm8gZmlsZXMgZm91bmQgdG8gdXBsb2FkLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaXJzdEZpbGUgPSBmaWxlc1swXTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWlTZXJ2aWNlLnVwbG9hZERvY3VtZW50KGZpcnN0RmlsZSk7XG4gICAgICBuZXcgTm90aWNlKFxuICAgICAgICBgVXBsb2FkZWQgZG9jLiBJRDogJHtyZXN1bHQuZG9jdW1lbnRJZH0sIHN0YXR1czogJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBzcGVjaWZpYyA0MDEvNDAzIGVycm9ycyBncmFjZWZ1bGx5XG4gICAgICBpZiAoZXJyb3I/LnN0YXR1c0NvZGUgPT09IDQwMSB8fCBlcnJvcj8uc3RhdHVzQ29kZSA9PT0gNDAzKSB7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlVwbG9hZCBhbmQgcHJvY2VzcyBkb2N1bWVudHMgZGlyZWN0bHkgaW4geW91ciBjaGF0IGNvbnZlcnNhdGlvbnMuIFN5c3RlbVNjdWxwdCB3aWxsIGF1dG9tYXRpY2FsbHkgZXh0cmFjdCBhbmQgYW5hbHl6ZSB0aGUgY29udGVudC5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZSAtIERvY3VtZW50IFByb2Nlc3NpbmdcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIkRvY3VtZW50IHByb2Nlc3NpbmcgcmVxdWlyZXMgYW4gYWN0aXZlIFBybyBzdWJzY3JpcHRpb24uIFN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYnkgYmVjb21pbmcgYSBQYXRyZW9uIG1lbWJlciFcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICB9XG4gICAgICAgICkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgb3RoZXIgZXJyb3JzXG4gICAgICBuZXcgTm90aWNlKGBFcnJvciB1cGxvYWRpbmcgZG9jOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyB1cGRhdGVUb2tlbkNvdW50KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHRleHQgPSB0aGlzLmlucHV0LnZhbHVlO1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gdGhpcy5nZXRNZXNzYWdlcygpO1xuICAgIGNvbnN0IGNvbnRleHRGaWxlcyA9IHRoaXMuZ2V0Q29udGV4dEZpbGVzKCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdG9rZW5zIGZvciBjdXJyZW50IGlucHV0XG4gICAgY29uc3QgaW5wdXRUb2tlbnMgPSB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuYXBwcm94aW1hdGVUb2tlbkNvdW50KHRleHQpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHRva2VucyBmb3IgbWVzc2FnZSBoaXN0b3J5XG4gICAgbGV0IGhpc3RvcnlUb2tlbnMgPSAwO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xuICAgICAgY29uc3QgY29udGVudCA9XG4gICAgICAgIHR5cGVvZiBtZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICA/IG1lc3NhZ2UuY29udGVudFxuICAgICAgICAgIDogSlNPTi5zdHJpbmdpZnkobWVzc2FnZS5jb250ZW50KTtcbiAgICAgIGNvbnN0IG1lc3NhZ2VUb2tlbnMgPVxuICAgICAgICB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgaGlzdG9yeVRva2VucyArPSBtZXNzYWdlVG9rZW5zO1xuICAgICAgLy8gQWRkIG92ZXJoZWFkIGZvciBtZXNzYWdlIG1ldGFkYXRhIChyb2xlLCBldGMpXG4gICAgICBoaXN0b3J5VG9rZW5zICs9IDQ7XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHRva2VucyBmb3IgY29udGV4dCBmaWxlc1xuICAgIGxldCBjb250ZXh0VG9rZW5zID0gMDtcblxuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgY29udGV4dEZpbGVzKSB7XG4gICAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIGNvbnRpbnVlO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBsaW5rVGV4dCA9IGZpbGVQYXRoLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpO1xuICAgICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICAgIGxpbmtUZXh0LFxuICAgICAgICAgIFwiXCJcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAvLyBPbmx5IGNvdW50IHRva2VucyBmb3IgdGV4dCBhbmQgbWFya2Rvd24gZmlsZXNcbiAgICAgICAgICBpZiAoIXJlc29sdmVkRmlsZS5leHRlbnNpb24ubWF0Y2goL14obWR8dHh0fG1hcmtkb3duKSQvaSkpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGZpbGUgdG9rZW4gY291bnRpbmdcbiAgICAgICAgICBjb25zdCBmaWxlVG9rZW5zID0gYXdhaXQgdGhpcy50b2tlbkNvdW50ZXJTZXJ2aWNlLmdldEZpbGVUb2tlbkNvdW50KFxuICAgICAgICAgICAgcmVzb2x2ZWRGaWxlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb250ZXh0VG9rZW5zICs9IGZpbGVUb2tlbnM7XG4gICAgICAgICAgY29udGV4dFRva2VucyArPSA0OyAvLyBvdmVyaGVhZFxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gcHJvY2VzcyBjb250ZXh0IGZpbGUgZm9yIHRva2VuIGNvdW50OlwiLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHRva2Vuc1xuICAgIGNvbnN0IHRvdGFsVG9rZW5zID0gaW5wdXRUb2tlbnMgKyBoaXN0b3J5VG9rZW5zICsgY29udGV4dFRva2VucztcblxuICAgIC8vIEdldCB0b2tlbiBsaW1pdCBmcm9tIENoYXRWaWV3XG4gICAgY29uc3QgdG9rZW5MaW1pdCA9ICh0aGlzLmNoYXRWaWV3IGFzIGFueSkuZ2V0VG9rZW5MaW1pdD8uKCk7XG5cbiAgICAvLyBVcGRhdGUgZGlzcGxheSB3aXRoIGFwcHJveGltYXRlIGNvdW50IGFuZCB3YXJuaW5nIHN0YXRlXG4gICAgLy8gT25seSBoaWRlIHRoZSBjb3VudGVyIGlmIHRoZXJlIGFyZSBubyB0b2tlbnMgQU5EIG5vIGNvbnRleHQgZmlsZXNcbiAgICBpZiAodG90YWxUb2tlbnMgPT09IDAgJiYgY29udGV4dEZpbGVzLnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMudG9rZW5Db3VudGVyLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50b2tlbkNvdW50ZXIudGV4dENvbnRlbnQgPVxuICAgICAgICB0aGlzLnRva2VuQ291bnRlclNlcnZpY2UuZm9ybWF0VG9rZW5Db3VudCh0b3RhbFRva2Vucyk7XG4gICAgfVxuXG4gICAgLy8gU2hvdyB3YXJuaW5nIGlmIG92ZXIgdG9rZW4gbGltaXQgb3IgYXBwcm9hY2hpbmcgaXQgKDkwJSlcbiAgICBpZiAodG9rZW5MaW1pdCkge1xuICAgICAgY29uc3Qgd2FybmluZ1RocmVzaG9sZCA9IE1hdGguZmxvb3IodG9rZW5MaW1pdCAqIDAuOSk7XG4gICAgICB0aGlzLnRva2VuQ291bnRlci5jbGFzc0xpc3QudG9nZ2xlKFxuICAgICAgICBcIndhcm5pbmdcIixcbiAgICAgICAgdG90YWxUb2tlbnMgPiB3YXJuaW5nVGhyZXNob2xkXG4gICAgICApO1xuXG4gICAgICAvLyBBZGQgZXhhY3QgY291bnQgYW5kIGxpbWl0IHdoZW4gYXBwcm9hY2hpbmcvZXhjZWVkaW5nIGxpbWl0XG4gICAgICBpZiAodG90YWxUb2tlbnMgPiB3YXJuaW5nVGhyZXNob2xkKSB7XG4gICAgICAgIHRoaXMudG9rZW5Db3VudGVyLnRleHRDb250ZW50ID0gYCR7dG90YWxUb2tlbnMudG9Mb2NhbGVTdHJpbmcoKX0gLyAke3Rva2VuTGltaXQudG9Mb2NhbGVTdHJpbmcoKX0gdG9rZW5zYDtcbiAgICAgIH1cblxuICAgICAgLy8gRGlzYWJsZSBpbnB1dCBpZiBvdmVyIGxpbWl0XG4gICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIi5zeXN0ZW1zY3VscHQtc3VibWl0LWJ1dHRvblwiXG4gICAgICApIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgaWYgKHN1Ym1pdEJ1dHRvbikge1xuICAgICAgICBjb25zdCBpc092ZXJMaW1pdCA9IHRvdGFsVG9rZW5zID4gdG9rZW5MaW1pdDtcbiAgICAgICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gaXNPdmVyTGltaXQ7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi50aXRsZSA9IGlzT3ZlckxpbWl0XG4gICAgICAgICAgPyBgRXhjZWVkcyB0b2tlbiBsaW1pdCBvZiAke3Rva2VuTGltaXQudG9Mb2NhbGVTdHJpbmcoKX1gXG4gICAgICAgICAgOiBcIlwiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBObyBsaW1pdCBzZXQgLSBkb24ndCBzaG93IHdhcm5pbmcgc2luY2Ugd2UgaGF2ZSBpbmZpbml0ZSBjb250ZXh0XG4gICAgICB0aGlzLnRva2VuQ291bnRlci5jbGFzc0xpc3QucmVtb3ZlKFwid2FybmluZ1wiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuc3VyZURpcmVjdG9yeUV4aXN0cyhkaXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2RpcihkaXJQYXRoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoXCJhbHJlYWR5IGV4aXN0c1wiKSkgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0VGV4dEF0Q3Vyc29yKHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnNvclBvcyA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTtcblxuICAgIGlmIChjdXJzb3JQb3MgIT09IG51bGwpIHtcbiAgICAgIC8vIEluc2VydCBhdCBjdXJzb3IgcG9zaXRpb25cbiAgICAgIGNvbnN0IG5ld1ZhbHVlID1cbiAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKDAsIGN1cnNvclBvcykgKyB0ZXh0ICsgY3VycmVudFZhbHVlLnNsaWNlKGN1cnNvclBvcyk7XG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAvLyBNb3ZlIGN1cnNvciB0byBlbmQgb2YgaW5zZXJ0ZWQgdGV4dFxuICAgICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uRW5kID1cbiAgICAgICAgY3Vyc29yUG9zICsgdGV4dC5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFwcGVuZCB0byBlbmQgaWYgbm8gY3Vyc29yIHBvc2l0aW9uXG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gY3VycmVudFZhbHVlICsgdGV4dDtcbiAgICAgIHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmlucHV0LnNlbGVjdGlvbkVuZCA9XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIFRyaWdnZXIgaW5wdXQgZXZlbnQgZm9yIGhlaWdodCBhZGp1c3RtZW50IGFuZCB0b2tlbiBjb3VudGluZ1xuICAgIHRoaXMuaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiKSk7XG5cbiAgICAvLyBGb2N1cyB0aGUgaW5wdXQgYWZ0ZXIgaW5zZXJ0aW9uXG4gICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVXZWJTZWFyY2hCdXR0b25TdGF0ZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMud2ViU2VhcmNoQnV0dG9uKSByZXR1cm47XG5cbiAgICBjb25zdCBpc05hdGl2ZVByb3ZpZGVyID1cbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLnR5cGUgPT09IFwibmF0aXZlXCI7XG4gICAgY29uc3QgY3VycmVudFByb3ZpZGVyID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAocCkgPT4gcC5pZCA9PT0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIuaWRcbiAgICApO1xuICAgIGNvbnN0IGlzT3BlblJvdXRlciA9IGN1cnJlbnRQcm92aWRlcj8uZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpO1xuXG4gICAgY29uc3Qgd2ViU2VhcmNoQWxsb3dlZCA9IGlzTmF0aXZlUHJvdmlkZXIgfHwgaXNPcGVuUm91dGVyO1xuXG4gICAgLy8gUmVzZXQgd2ViIHNlYXJjaCBzdGF0ZSBpZiBpdCB3YXMgZW5hYmxlZCBidXQgaXMgbm8gbG9uZ2VyIGFsbG93ZWRcbiAgICBpZiAoIXdlYlNlYXJjaEFsbG93ZWQgJiYgdGhpcy53ZWJTZWFyY2hFbmFibGVkKSB7XG4gICAgICB0aGlzLndlYlNlYXJjaEVuYWJsZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMud2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJpcy1lbmFibGVkXCIpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBidXR0b24gc3RhdGVcbiAgICB0aGlzLndlYlNlYXJjaEJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgIXdlYlNlYXJjaEFsbG93ZWQpO1xuICAgIHRoaXMud2ViU2VhcmNoQnV0dG9uLnNldEF0dHJpYnV0ZShcbiAgICAgIFwiYXJpYS1kaXNhYmxlZFwiLFxuICAgICAgKCF3ZWJTZWFyY2hBbGxvd2VkKS50b1N0cmluZygpXG4gICAgKTtcbiAgfVxuXG4gIC8vIENhbGwgdGhpcyB3aGVuIG1vZGVsIGNoYW5nZXNcbiAgcHVibGljIG9uTW9kZWxDaGFuZ2UoKTogdm9pZCB7XG4gICAgdGhpcy51cGRhdGVXZWJTZWFyY2hCdXR0b25TdGF0ZSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgRXZlbnRzIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmludGVyZmFjZSBGaWxlVG9rZW5DYWNoZSB7XG4gIHRva2VuczogbnVtYmVyO1xuICBtdGltZTogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgVG9rZW5Db3VudGVyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBUb2tlbkNvdW50ZXJTZXJ2aWNlO1xuICBwcml2YXRlIGNhY2hlOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGZpbGVDYWNoZTogTWFwPHN0cmluZywgRmlsZVRva2VuQ2FjaGU+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGNhY2hlU2l6ZSA9IDEwMDA7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBCaW5kIHRoZSBldmVudCBoYW5kbGVyc1xuICAgIHRoaXMuaGFuZGxlRmlsZU1vZGlmeSA9IHRoaXMuaGFuZGxlRmlsZU1vZGlmeS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRmlsZURlbGV0ZSA9IHRoaXMuaGFuZGxlRmlsZURlbGV0ZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRmlsZVJlbmFtZSA9IHRoaXMuaGFuZGxlRmlsZVJlbmFtZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVGaWxlTW9kaWZ5KGZpbGU6IFRGaWxlKTogdm9pZCB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgdGhpcy5maWxlQ2FjaGUuZGVsZXRlKGZpbGUucGF0aCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVGaWxlRGVsZXRlKGZpbGU6IFRGaWxlKTogdm9pZCB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgdGhpcy5maWxlQ2FjaGUuZGVsZXRlKGZpbGUucGF0aCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVGaWxlUmVuYW1lKGZpbGU6IFRGaWxlLCBvbGRQYXRoOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICB0aGlzLmZpbGVDYWNoZS5kZWxldGUob2xkUGF0aCk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFRva2VuQ291bnRlclNlcnZpY2Uge1xuICAgIGlmICghVG9rZW5Db3VudGVyU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgVG9rZW5Db3VudGVyU2VydmljZS5pbnN0YW5jZSA9IG5ldyBUb2tlbkNvdW50ZXJTZXJ2aWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBUb2tlbkNvdW50ZXJTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgc2V0QXBwKGFwcDogQXBwKTogdm9pZCB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG5cbiAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgdGhpcy5hcHAudmF1bHQub24oXCJtb2RpZnlcIiwgdGhpcy5oYW5kbGVGaWxlTW9kaWZ5KTtcbiAgICB0aGlzLmFwcC52YXVsdC5vbihcImRlbGV0ZVwiLCB0aGlzLmhhbmRsZUZpbGVEZWxldGUpO1xuICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwicmVuYW1lXCIsIHRoaXMuaGFuZGxlRmlsZVJlbmFtZSk7XG4gIH1cblxuICBhc3luYyBnZXRGaWxlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBhIHZhbGlkIGNhY2hlZCBjb3VudFxuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuZmlsZUNhY2hlLmdldChmaWxlLnBhdGgpO1xuICAgIGlmIChjYWNoZWQgJiYgY2FjaGVkLm10aW1lID09PSBmaWxlLnN0YXQubXRpbWUpIHtcbiAgICAgIHJldHVybiBjYWNoZWQudG9rZW5zO1xuICAgIH1cblxuICAgIC8vIFJlYWQgYW5kIGNvdW50IHRva2Vuc1xuICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgIGNvbnN0IHRva2VucyA9IHRoaXMuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuXG4gICAgLy8gQ2FjaGUgdGhlIHJlc3VsdCB3aXRoIHRoZSBjdXJyZW50IG10aW1lXG4gICAgdGhpcy5maWxlQ2FjaGUuc2V0KGZpbGUucGF0aCwge1xuICAgICAgdG9rZW5zLFxuICAgICAgbXRpbWU6IGZpbGUuc3RhdC5tdGltZSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0b2tlbnM7XG4gIH1cblxuICBhcHByb3hpbWF0ZVRva2VuQ291bnQodGV4dDogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBpZiAoIXRleHQpIHJldHVybiAwO1xuXG4gICAgLy8gQ2FjaGUgY2hlY2tcbiAgICBjb25zdCBjYWNoZUtleSA9IGAke3RleHQuc2xpY2UoMCwgMTAwKX1fJHt0ZXh0Lmxlbmd0aH1gO1xuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuY2FjaGUuZ2V0KGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkICE9PSB1bmRlZmluZWQpIHJldHVybiBjYWNoZWQ7XG5cbiAgICAvLyBQcmUtcHJvY2VzcyB0ZXh0IGZvciBtb3JlIGFjY3VyYXRlIGNvdW50aW5nXG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpO1xuXG4gICAgbGV0IHRva2VuQ291bnQgPSAwO1xuXG4gICAgLy8gQ291bnQgc3BlY2lhbCBwYXR0ZXJucyB0aGF0IGNvbW1vbmx5IG1hcCB0byBzaW5nbGUgdG9rZW5zXG4gICAgY29uc3QgY29tbW9uUGF0dGVybnMgPSBbXG4gICAgICAvXmh0dHBzPzpcXC9cXC9cXFMrL2dtLCAvLyBVUkxzXG4gICAgICAvW0AjXVxcdysvZywgLy8gTWVudGlvbnMgYW5kIGhhc2h0YWdzXG4gICAgICAvOlthLXpfXSs6L2csIC8vIEVtb2ppIGNvZGVzXG4gICAgICAvW0EtWl17Mix9L2csIC8vIEFjcm9ueW1zXG4gICAgICAvXFxkezEsMTZ9L2csIC8vIE51bWJlcnNcbiAgICAgIC9bLiwhPzs6KCl7fVxcW1xcXVwiJ10vZywgLy8gQ29tbW9uIHB1bmN0dWF0aW9uXG4gICAgXTtcblxuICAgIC8vIFJlbW92ZSBhbmQgY291bnQgc3BlY2lhbCBwYXR0ZXJucyBmaXJzdFxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBjb21tb25QYXR0ZXJucykge1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IHRleHQubWF0Y2gocGF0dGVybik7XG4gICAgICBpZiAobWF0Y2hlcykge1xuICAgICAgICB0b2tlbkNvdW50ICs9IG1hdGNoZXMucmVkdWNlKChzdW0sIG1hdGNoKSA9PiB7XG4gICAgICAgICAgLy8gQWRqdXN0IHRva2VuIGNvdW50IGJhc2VkIG9uIHBhdHRlcm4gdHlwZSBhbmQgbGVuZ3RoXG4gICAgICAgICAgaWYgKG1hdGNoLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VtICsgTWF0aC5jZWlsKG1hdGNoLmxlbmd0aCAvIDQpO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoIDw9IDQpIHtcbiAgICAgICAgICAgIHJldHVybiBzdW0gKyAxO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3VtICsgTWF0aC5jZWlsKG1hdGNoLmxlbmd0aCAvIDMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UocGF0dGVybiwgXCIgXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNwbGl0IHJlbWFpbmluZyB0ZXh0IGFuZCBjb3VudFxuICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXFxzKy8pLmZpbHRlcigodykgPT4gdy5sZW5ndGggPiAwKTtcbiAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygd29yZHMpIHtcbiAgICAgIC8vIEJhc2UgdG9rZW4gY291bnRcbiAgICAgIGxldCB3b3JkVG9rZW5zID0gMTtcblxuICAgICAgLy8gQWRqdXN0IGZvciB3b3JkIGxlbmd0aCAobW9zdCBtb2RlbHMgc3BsaXQgbG9uZyB3b3JkcylcbiAgICAgIGlmICh3b3JkLmxlbmd0aCA+IDQpIHtcbiAgICAgICAgd29yZFRva2VucyArPSBNYXRoLmZsb29yKCh3b3JkLmxlbmd0aCAtIDQpIC8gMyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkanVzdCBmb3IgbWl4ZWQgY2FzZSAocG90ZW50aWFsIHN1YndvcmQgdG9rZW5zKVxuICAgICAgaWYgKC9bYS16XVtBLVpdLy50ZXN0KHdvcmQpKSB7XG4gICAgICAgIHdvcmRUb2tlbnMgKz0gKHdvcmQubWF0Y2goL1tBLVpdL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkanVzdCBmb3Igbm9uLUFTQ0lJIGNoYXJhY3RlcnNcbiAgICAgIGNvbnN0IG5vbkFzY2lpID0gKHdvcmQubWF0Y2goL1teXFx4MDAtXFx4N0ZdL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICBpZiAobm9uQXNjaWkgPiAwKSB7XG4gICAgICAgIHdvcmRUb2tlbnMgKz0gTWF0aC5jZWlsKG5vbkFzY2lpICogMS41KTtcbiAgICAgIH1cblxuICAgICAgdG9rZW5Db3VudCArPSB3b3JkVG9rZW5zO1xuICAgIH1cblxuICAgIC8vIEFkZCAxMCUgc2FmZXR5IG1hcmdpbiBmb3Igb3ZlcmVzdGltYXRpb25cbiAgICB0b2tlbkNvdW50ID0gTWF0aC5jZWlsKHRva2VuQ291bnQgKiAxLjEpO1xuXG4gICAgLy8gQ2FjaGUgdGhlIHJlc3VsdFxuICAgIHRoaXMuY2FjaGVSZXN1bHQoY2FjaGVLZXksIHRva2VuQ291bnQpO1xuXG4gICAgcmV0dXJuIHRva2VuQ291bnQ7XG4gIH1cblxuICBwcml2YXRlIGNhY2hlUmVzdWx0KGtleTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2FjaGUuc2l6ZSA+PSB0aGlzLmNhY2hlU2l6ZSkge1xuICAgICAgY29uc3QgZmlyc3RLZXkgPSB0aGlzLmNhY2hlLmtleXMoKS5uZXh0KCkudmFsdWU7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShmaXJzdEtleSk7XG4gICAgfVxuICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgdmFsdWUpO1xuICB9XG5cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gICAgdGhpcy5maWxlQ2FjaGUuY2xlYXIoKTtcbiAgfVxuXG4gIHVubG9hZCgpOiB2b2lkIHtcbiAgICAvLyBDbGVhbiB1cCBldmVudCBsaXN0ZW5lcnMgd2hlbiBwbHVnaW4gaXMgZGlzYWJsZWRcbiAgICBpZiAodGhpcy5hcHApIHtcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9mZihcIm1vZGlmeVwiLCB0aGlzLmhhbmRsZUZpbGVNb2RpZnkpO1xuICAgICAgdGhpcy5hcHAudmF1bHQub2ZmKFwiZGVsZXRlXCIsIHRoaXMuaGFuZGxlRmlsZURlbGV0ZSk7XG4gICAgICB0aGlzLmFwcC52YXVsdC5vZmYoXCJyZW5hbWVcIiwgdGhpcy5oYW5kbGVGaWxlUmVuYW1lKTtcbiAgICB9XG4gIH1cblxuICBmb3JtYXRUb2tlbkNvdW50KGNvdW50OiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChjb3VudCA9PT0gMCkgcmV0dXJuIFwiXCI7XG4gICAgaWYgKGNvdW50IDwgMTAwKSByZXR1cm4gXCI8IDEwMCB0b2tlbnNcIjtcbiAgICBpZiAoY291bnQgPj0gMTAwMCkge1xuICAgICAgLy8gUm91bmQgdXAgdG8gbmVhcmVzdCB0aG91c2FuZFxuICAgICAgY29uc3QgaW5LID0gTWF0aC5jZWlsKGNvdW50IC8gMTAwMCk7XG4gICAgICByZXR1cm4gYH4ke2luS31LIHRva2Vuc2A7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJvdW5kIHVwIHRvIG5lYXJlc3QgaHVuZHJlZFxuICAgICAgY29uc3QgaW5IdW5kcmVkcyA9IE1hdGguY2VpbChjb3VudCAvIDEwMCkgKiAxMDA7XG4gICAgICByZXR1cm4gYH4ke2luSHVuZHJlZHN9IHRva2Vuc2A7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgc2V0SWNvbiwgQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBEcmF3ZXJDb21wb25lbnQgfSBmcm9tIFwiLi9EcmF3ZXJDb21wb25lbnRcIjtcbmltcG9ydCB7IENvbnRleHRTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvQ29udGV4dFNlbGVjdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1RyYW5zY3JpcHRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBUb2tlbkNvdW50ZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1Rva2VuQ291bnRlclNlcnZpY2VcIjtcbmltcG9ydCB7IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uLy4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IExpY2Vuc2VDaGVja2VyIH0gZnJvbSBcIi4uLy4uL2NvcmUvbGljZW5zZS9MaWNlbnNlQ2hlY2tlclwiO1xuXG5pbnRlcmZhY2UgQ29udGV4dEZpbGUge1xuICBwYXRoOiBzdHJpbmc7XG4gIHR5cGU6IFwic291cmNlXCIgfCBcImV4dHJhY3Rpb25cIjtcbn1cblxuaW50ZXJmYWNlIENhdGVnb3J5RmlsZSB7XG4gIGZpbGU6IFRGaWxlO1xuICBwYXRoOiBzdHJpbmc7XG4gIGxpbmtUZXh0OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBDYXRlZ29yeSB7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGZpbGVzOiBDYXRlZ29yeUZpbGVbXTtcbiAgZXh0ZW5zaW9uczogc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBGaWxlQ29udGV4dE1hbmFnZXJPcHRpb25zIHtcbiAgYXBwOiBBcHA7XG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBvbkNvbnRleHRDaGFuZ2U6ICgpID0+IFByb21pc2U8dm9pZD47XG4gIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHBsdWdpbjogYW55O1xufVxuXG5leHBvcnQgY2xhc3MgRmlsZUNvbnRleHRNYW5hZ2VyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBjb250ZXh0RmlsZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgcHJpdmF0ZSBkcmF3ZXI6IERyYXdlckNvbXBvbmVudDtcbiAgcHJpdmF0ZSBjb250ZXh0UGFuZWw6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG9uQ29udGV4dENoYW5nZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nU3RhdHVzOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2Nlc3NpbmdGaWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBIVE1MRWxlbWVudD4oKTtcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nVGltZW91dHMgPSBuZXcgTWFwPHN0cmluZywgTm9kZUpTLlRpbWVvdXQ+KCk7XG4gIHByaXZhdGUgc3luY1N0YXR1c0VsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzU3luY2luZyA9IGZhbHNlO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgcGx1Z2luOiBhbnk7XG4gIHByaXZhdGUgdG9rZW5Db3VudGVyOiBUb2tlbkNvdW50ZXJTZXJ2aWNlO1xuICBwcml2YXRlIHRva2VuQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBGaWxlQ29udGV4dE1hbmFnZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmFwcCA9IG9wdGlvbnMuYXBwO1xuICAgIHRoaXMub25Db250ZXh0Q2hhbmdlID0gb3B0aW9ucy5vbkNvbnRleHRDaGFuZ2U7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gb3B0aW9ucy5zY3VscHRTZXJ2aWNlO1xuICAgIHRoaXMucGx1Z2luID0gb3B0aW9ucy5wbHVnaW47XG4gICAgdGhpcy50b2tlbkNvdW50ZXIgPSBUb2tlbkNvdW50ZXJTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG5cbiAgICB0aGlzLmRyYXdlciA9IG5ldyBEcmF3ZXJDb21wb25lbnQoe1xuICAgICAgY29udGFpbmVyOiBvcHRpb25zLmNvbnRhaW5lcixcbiAgICAgIHRpdGxlOiBvcHRpb25zLnRpdGxlIHx8IFwiQ29udGV4dCBGaWxlc1wiLFxuICAgIH0pO1xuICAgIHRoaXMuY29udGV4dFBhbmVsID0gdGhpcy5kcmF3ZXIuZ2V0RHJhd2VyKCk7XG5cbiAgICB0aGlzLnNldHVwQ29udGV4dFBhbmVsKCk7XG4gICAgdGhpcy5pbml0aWFsaXplUHJvY2Vzc2luZ1N0YXR1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUHJvY2Vzc2luZ1N0YXR1cygpIHtcbiAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMgPSB0aGlzLmNvbnRleHRQYW5lbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb2Nlc3Npbmctc3RhdHVzXCIsXG4gICAgfSk7XG4gICAgdGhpcy5wcm9jZXNzaW5nU3RhdHVzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICBmaWxlOiBURmlsZSxcbiAgICBzdGF0dXM6IHN0cmluZyxcbiAgICBpY29uOiBzdHJpbmcsXG4gICAgcmVtb3ZlOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3QgZmlsZUlkID0gZmlsZS5wYXRoO1xuICAgIGxldCBzdGF0dXNFbCA9IHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmdldChmaWxlSWQpO1xuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIHRpbWVvdXQgZm9yIHRoaXMgZmlsZVxuICAgIGNvbnN0IGV4aXN0aW5nVGltZW91dCA9IHRoaXMucHJvY2Vzc2luZ1RpbWVvdXRzLmdldChmaWxlSWQpO1xuICAgIGlmIChleGlzdGluZ1RpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dChleGlzdGluZ1RpbWVvdXQpO1xuICAgICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZGVsZXRlKGZpbGVJZCk7XG4gICAgfVxuXG4gICAgaWYgKCFzdGF0dXNFbCAmJiAhcmVtb3ZlICYmIHRoaXMucHJvY2Vzc2luZ1N0YXR1cykge1xuICAgICAgc3RhdHVzRWwgPSB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtc3RhdHVzXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaWNvbkVsID0gc3RhdHVzRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLWljb25cIixcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihpY29uRWwsIGljb24pO1xuXG4gICAgICBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogYCR7ZmlsZS5iYXNlbmFtZX06ICR7c3RhdHVzfWAsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLXRleHRcIixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5zZXQoZmlsZUlkLCBzdGF0dXNFbCk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXNFbCAmJiAhcmVtb3ZlKSB7XG4gICAgICBzdGF0dXNFbC5lbXB0eSgpO1xuICAgICAgY29uc3QgaWNvbkVsID0gc3RhdHVzRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLWljb25cIixcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihpY29uRWwsIGljb24pO1xuICAgICAgc3RhdHVzRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgIHRleHQ6IGAke2ZpbGUuYmFzZW5hbWV9OiAke3N0YXR1c31gLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXN0YXR1cy10ZXh0XCIsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1c0VsICYmIHJlbW92ZSkge1xuICAgICAgc3RhdHVzRWwucmVtb3ZlKCk7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5kZWxldGUoZmlsZUlkKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nU3RhdHVzKSB7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuc3R5bGUuZGlzcGxheSA9XG4gICAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLnNpemUgPiAwID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhpcyBpcyBhIHN1Y2Nlc3Mgb3IgZXJyb3IgbWVzc2FnZSwgb3IgZXhwbGljaXQgcmVtb3ZhbCByZXF1ZXN0ZWQsIHNldCBhIHRpbWVvdXQgdG8gcmVtb3ZlIGl0XG4gICAgaWYgKFxuICAgICAgcmVtb3ZlIHx8XG4gICAgICBzdGF0dXMuaW5jbHVkZXMoXCJzdWNjZXNzZnVsbHlcIikgfHxcbiAgICAgIHN0YXR1cy5pbmNsdWRlcyhcImNvbXBsZXRlZFwiKSB8fFxuICAgICAgc3RhdHVzLmluY2x1ZGVzKFwiRXJyb3I6XCIpXG4gICAgKSB7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlwiLCBcIlwiLCB0cnVlKTtcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZGVsZXRlKGZpbGVJZCk7XG4gICAgICB9LCAzMDAwKTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ1RpbWVvdXRzLnNldChmaWxlSWQsIHRpbWVvdXQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBDb250ZXh0UGFuZWwoKTogdm9pZCB7XG4gICAgY29uc3QgdGl0bGVFbCA9IHRoaXMuY29udGV4dFBhbmVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5zeXN0ZW1zY3VscHQtZHJhd2VyLXRpdGxlXCJcbiAgICApO1xuICAgIGlmICghdGl0bGVFbCkgcmV0dXJuO1xuXG4gICAgY29uc3QgY29udGV4dENvdW50ID0gdGl0bGVFbC5jcmVhdGVTcGFuKHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNvdW50XCIsXG4gICAgICB0ZXh0OiBcIjBcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBzeW5jIHN0YXR1cyBlbGVtZW50XG4gICAgdGhpcy5zeW5jU3RhdHVzRWwgPSB0aXRsZUVsLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zeW5jLXN0YXR1cyBzeW5jZWRcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHRoaXMuc3luY1N0YXR1c0VsLCBcImNoZWNrXCIpO1xuXG4gICAgY29uc3QgY29udGV4dEJ1dHRvbiA9IHRpdGxlRWwuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWFkZC1idXR0b25cIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGNvbnRleHRCdXR0b24sIFwicGx1c1wiKTtcbiAgICBjb250ZXh0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuYWRkQ29udGV4dEZpbGUoKTtcbiAgICB9KTtcblxuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVN5bmNTdGF0dXMoc3luY2luZzogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgaWYgKCF0aGlzLnN5bmNTdGF0dXNFbCkgcmV0dXJuO1xuXG4gICAgdGhpcy5pc1N5bmNpbmcgPSBzeW5jaW5nO1xuICAgIHRoaXMuc3luY1N0YXR1c0VsLmVtcHR5KCk7XG5cbiAgICBpZiAoc3luY2luZykge1xuICAgICAgdGhpcy5zeW5jU3RhdHVzRWwucmVtb3ZlQ2xhc3MoXCJzeW5jZWRcIik7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5hZGRDbGFzcyhcInN5bmNpbmdcIik7XG4gICAgICBzZXRJY29uKHRoaXMuc3luY1N0YXR1c0VsLCBcImxvYWRlci0yXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5yZW1vdmVDbGFzcyhcInN5bmNpbmdcIik7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5hZGRDbGFzcyhcInN5bmNlZFwiKTtcbiAgICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwiY2hlY2tcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGNoZWNrU3luY1N0YXR1cygpIHtcbiAgICBpZiAodGhpcy5jb250ZXh0RmlsZXMuc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy51cGRhdGVTeW5jU3RhdHVzKGZhbHNlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXModHJ1ZSk7XG4gICAgLy8gTm8gbmVlZCB0byBzaW11bGF0ZSwganVzdCB1cGRhdGUgc3RhdHVzXG4gICAgdGhpcy51cGRhdGVTeW5jU3RhdHVzKGZhbHNlKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ29udGV4dFBhbmVsKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb250ZXh0UGFuZWwpIHJldHVybjtcblxuICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuY29udGV4dFBhbmVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5zeXN0ZW1zY3VscHQtZHJhd2VyLWhlYWRlclwiXG4gICAgKTtcbiAgICBjb25zdCBjb250ZW50ID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItY29udGVudFwiXG4gICAgKSBhcyBIVE1MRWxlbWVudDtcbiAgICBjb25zdCBjb3VudCA9IHRoaXMuY29udGV4dFBhbmVsLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LWRyYXdlci1jb3VudFwiKTtcblxuICAgIGlmICghaGVhZGVyIHx8ICFjb250ZW50IHx8ICFjb3VudCkgcmV0dXJuO1xuXG4gICAgY291bnQudGV4dENvbnRlbnQgPSB0aGlzLmNvbnRleHRGaWxlcy5zaXplLnRvU3RyaW5nKCk7XG5cbiAgICBjb250ZW50LmVtcHR5KCk7XG5cbiAgICBpZiAodGhpcy5jb250ZXh0RmlsZXMuc2l6ZSA9PT0gMCkge1xuICAgICAgY29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWVtcHR5XCIsXG4gICAgICAgIHRleHQ6IFwiTm8gY29udGV4dCBmaWxlcyBhZGRlZCB5ZXQuIENsaWNrIHRoZSBwbHVzIGJ1dHRvbiB0byBhZGQgZmlsZXMgaW4geW91ciBjaGF0LlwiLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY2F0ZWdvcmllczogUmVjb3JkPHN0cmluZywgQ2F0ZWdvcnk+ID0ge1xuICAgICAgdGV4dDoge1xuICAgICAgICBsYWJlbDogXCJUZXh0IEZpbGVzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXSxcbiAgICAgIH0sXG4gICAgICBpbWFnZXM6IHtcbiAgICAgICAgbGFiZWw6IFwiSW1hZ2VzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0sXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgbGFiZWw6IFwiQXVkaW8gRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJvZ2dcIiwgXCJtNGFcIl0sXG4gICAgICB9LFxuICAgICAgZG9jdW1lbnRzOiB7XG4gICAgICAgIGxhYmVsOiBcIkRvY3VtZW50c1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcInBkZlwiXSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIEdyb3VwIGV4dHJhY3RlZCBmaWxlcyBieSB0aGVpciBzb3VyY2UgZG9jdW1lbnRcbiAgICBjb25zdCBkb2N1bWVudEdyb3VwcyA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4oKTtcbiAgICBjb25zdCBub25FeHRyYWN0ZWRGaWxlcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiB0aGlzLmNvbnRleHRGaWxlcykge1xuICAgICAgY29uc3QgY2xlYW5QYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG5cbiAgICAgIGlmIChjbGVhblBhdGguaW5jbHVkZXMoXCIvRXh0cmFjdGlvbnMvXCIpKSB7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gY2xlYW5QYXRoLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgY29uc3QgZXh0cmFjdGlvbkRpckluZGV4ID0gcGFydHMuaW5kZXhPZihcIkV4dHJhY3Rpb25zXCIpO1xuICAgICAgICBpZiAoZXh0cmFjdGlvbkRpckluZGV4ID49IDAgJiYgZXh0cmFjdGlvbkRpckluZGV4ICsgMSA8IHBhcnRzLmxlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IHNvdXJjZURvYyA9IHBhcnRzW2V4dHJhY3Rpb25EaXJJbmRleCArIDFdO1xuICAgICAgICAgIGlmICghZG9jdW1lbnRHcm91cHMuaGFzKHNvdXJjZURvYykpIHtcbiAgICAgICAgICAgIGRvY3VtZW50R3JvdXBzLnNldChzb3VyY2VEb2MsIG5ldyBTZXQoKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRvY3VtZW50R3JvdXBzLmdldChzb3VyY2VEb2MpPy5hZGQoZmlsZVBhdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5vbkV4dHJhY3RlZEZpbGVzLmFkZChmaWxlUGF0aCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vbkV4dHJhY3RlZEZpbGVzLmFkZChmaWxlUGF0aCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmlyc3QsIGNhdGVnb3JpemUgbm9uLWV4dHJhY3RlZCBmaWxlc1xuICAgIHRoaXMuY2F0ZWdvcml6ZUZpbGVzKEFycmF5LmZyb20obm9uRXh0cmFjdGVkRmlsZXMpLCBjYXRlZ29yaWVzKTtcblxuICAgIC8vIFJlbmRlciByZWd1bGFyIGNhdGVnb3JpZXMgZmlyc3RcbiAgICBmb3IgKGNvbnN0IGNhdGVnb3J5S2V5IG9mIFtcInRleHRcIiwgXCJpbWFnZXNcIiwgXCJhdWRpb1wiXSkge1xuICAgICAgY29uc3QgY2F0ZWdvcnkgPSBjYXRlZ29yaWVzW2NhdGVnb3J5S2V5XTtcbiAgICAgIGlmIChjYXRlZ29yeS5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMucmVuZGVyQ2F0ZWdvcnkoY29udGVudCwgY2F0ZWdvcnkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIGRvY3VtZW50cyBjYXRlZ29yeVxuICAgIGlmIChjYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcy5sZW5ndGggPiAwIHx8IGRvY3VtZW50R3JvdXBzLnNpemUgPiAwKSB7XG4gICAgICAvLyBNYWluIFwiRG9jdW1lbnRzXCIgY2F0ZWdvcnkgaGVhZGVyXG4gICAgICBjb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY2F0ZWdvcnlcIixcbiAgICAgICAgdGV4dDogXCJEb2N1bWVudHNcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGaXJzdCByZW5kZXIgc3RhbmRhbG9uZSBkb2N1bWVudHNcbiAgICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGVudCwgY2F0ZWdvcmllcy5kb2N1bWVudHMuZmlsZXMpO1xuXG4gICAgICAvLyBUaGVuIHJlbmRlciBlYWNoIGRvY3VtZW50IGdyb3VwIGFzIGEgc3ViY2F0ZWdvcnlcbiAgICAgIGZvciAoY29uc3QgW3NvdXJjZURvYywgZXh0cmFjdGVkRmlsZXNdIG9mIGRvY3VtZW50R3JvdXBzKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIHN1YmNhdGVnb3J5IGZvciB0aGlzIGRvY3VtZW50XG4gICAgICAgIGNvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNhdGVnb3J5XCIsXG4gICAgICAgICAgdGV4dDogYFx1RDgzRFx1RENDNCAke3NvdXJjZURvY30gRXh0cmFjdGlvbnNgLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDYXRlZ29yaXplIGV4dHJhY3RlZCBmaWxlc1xuICAgICAgICBjb25zdCBleHRyYWN0ZWRDYXRlZ29yaWVzID0gdGhpcy5jcmVhdGVDYXRlZ29yaWVzKCk7XG4gICAgICAgIHRoaXMuY2F0ZWdvcml6ZUZpbGVzKEFycmF5LmZyb20oZXh0cmFjdGVkRmlsZXMpLCBleHRyYWN0ZWRDYXRlZ29yaWVzKTtcblxuICAgICAgICAvLyBGaXJzdCByZW5kZXIgdGV4dCBmaWxlcyAobWQsIHR4dCwgbWFya2Rvd24pXG4gICAgICAgIGNvbnN0IHRleHRGaWxlcyA9IGV4dHJhY3RlZENhdGVnb3JpZXMudGV4dC5maWxlcztcbiAgICAgICAgaWYgKHRleHRGaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCB0ZXh0RmlsZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlbiByZW5kZXIgaW1hZ2VzXG4gICAgICAgIGNvbnN0IGltYWdlRmlsZXMgPSBleHRyYWN0ZWRDYXRlZ29yaWVzLmltYWdlcy5maWxlcztcbiAgICAgICAgaWYgKGltYWdlRmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGVudCwgaW1hZ2VGaWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5hbGx5IHJlbmRlciBhbnkgb3RoZXIgdHlwZXMgaWYgdGhleSBleGlzdFxuICAgICAgICBjb25zdCBvdGhlckZpbGVzID0gW1xuICAgICAgICAgIC4uLmV4dHJhY3RlZENhdGVnb3JpZXMuYXVkaW8uZmlsZXMsXG4gICAgICAgICAgLi4uZXh0cmFjdGVkQ2F0ZWdvcmllcy5kb2N1bWVudHMuZmlsZXMsXG4gICAgICAgIF07XG4gICAgICAgIGlmIChvdGhlckZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZpbGVzKGNvbnRlbnQsIG90aGVyRmlsZXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDYXRlZ29yaWVzKCk6IFJlY29yZDxzdHJpbmcsIENhdGVnb3J5PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRleHQ6IHtcbiAgICAgICAgbGFiZWw6IFwiVGV4dCBGaWxlc1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0sXG4gICAgICB9LFxuICAgICAgaW1hZ2VzOiB7XG4gICAgICAgIGxhYmVsOiBcIkltYWdlc1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcImpwZ1wiLCBcImpwZWdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJ3ZWJwXCIsIFwic3ZnXCJdLFxuICAgICAgfSxcbiAgICAgIGF1ZGlvOiB7XG4gICAgICAgIGxhYmVsOiBcIkF1ZGlvIEZpbGVzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLFxuICAgICAgfSxcbiAgICAgIGRvY3VtZW50czoge1xuICAgICAgICBsYWJlbDogXCJEb2N1bWVudHNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJwZGZcIl0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNhdGVnb3JpemVGaWxlcyhcbiAgICBmaWxlczogc3RyaW5nW10sXG4gICAgY2F0ZWdvcmllczogUmVjb3JkPHN0cmluZywgQ2F0ZWdvcnk+XG4gICk6IHZvaWQge1xuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgZmlsZXMpIHtcbiAgICAgIGNvbnN0IGxpbmtUZXh0ID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG4gICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICBsaW5rVGV4dCxcbiAgICAgICAgXCJcIlxuICAgICAgKTtcblxuICAgICAgaWYgKHJlc29sdmVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IHJlc29sdmVkRmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbGV0IGNhdGVnb3J5Rm91bmQgPSBmYWxzZTtcblxuICAgICAgICBmb3IgKGNvbnN0IFtjYXRlZ29yeSwgaW5mb10gb2YgT2JqZWN0LmVudHJpZXMoY2F0ZWdvcmllcykpIHtcbiAgICAgICAgICBpZiAoaW5mby5leHRlbnNpb25zLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgIGluZm8uZmlsZXMucHVzaCh7IGZpbGU6IHJlc29sdmVkRmlsZSwgcGF0aDogZmlsZVBhdGgsIGxpbmtUZXh0IH0pO1xuICAgICAgICAgICAgY2F0ZWdvcnlGb3VuZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNhdGVnb3J5Rm91bmQpIHtcbiAgICAgICAgICBjYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcy5wdXNoKHtcbiAgICAgICAgICAgIGZpbGU6IHJlc29sdmVkRmlsZSxcbiAgICAgICAgICAgIHBhdGg6IGZpbGVQYXRoLFxuICAgICAgICAgICAgbGlua1RleHQsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckNhdGVnb3J5KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGNhdGVnb3J5OiBDYXRlZ29yeSk6IHZvaWQge1xuICAgIGlmIChjYXRlZ29yeS5maWxlcy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgIGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1jYXRlZ29yeVwiLFxuICAgICAgdGV4dDogY2F0ZWdvcnkubGFiZWwsXG4gICAgfSk7XG5cbiAgICB0aGlzLnJlbmRlckZpbGVzKGNvbnRhaW5lciwgY2F0ZWdvcnkuZmlsZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJGaWxlcyhjb250YWluZXI6IEhUTUxFbGVtZW50LCBmaWxlczogQ2F0ZWdvcnlGaWxlW10pOiB2b2lkIHtcbiAgICBmaWxlcy5zb3J0KChhLCBiKSA9PiBhLmZpbGUuYmFzZW5hbWUubG9jYWxlQ29tcGFyZShiLmZpbGUuYmFzZW5hbWUpKTtcblxuICAgIC8vIENyZWF0ZSBwcmV2aWV3IGVsZW1lbnRzIG9uY2UgYW5kIHJldXNlXG4gICAgY29uc3QgaW1hZ2VQcmV2aWV3ID0gZG9jdW1lbnQuYm9keS5jcmVhdGVFbChcImltZ1wiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXZpZXcgc3lzdGVtc2N1bHB0LWltYWdlLXByZXZpZXdcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IG1hcmtkb3duUHJldmlldyA9IGRvY3VtZW50LmJvZHkuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldyBzeXN0ZW1zY3VscHQtbWFya2Rvd24tcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgLy8gVHJhY2sgaWYgbWFya2Rvd24gcHJldmlldyBpcyB2aXNpYmxlXG4gICAgbGV0IGlzTWFya2Rvd25QcmV2aWV3VmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgLy8gSGFuZGxlIHdoZWVsIGV2ZW50cyBmb3IgbWFya2Rvd24gcHJldmlldyBzY3JvbGxpbmdcbiAgICBjb25zdCBoYW5kbGVXaGVlbCA9IChlOiBXaGVlbEV2ZW50KSA9PiB7XG4gICAgICBpZiAoIWlzTWFya2Rvd25QcmV2aWV3VmlzaWJsZSkgcmV0dXJuO1xuXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBzY3JvbGxBbW91bnQgPSBlLmRlbHRhWTtcbiAgICAgIG1hcmtkb3duUHJldmlldy5zY3JvbGxUb3AgKz0gc2Nyb2xsQW1vdW50O1xuICAgIH07XG5cbiAgICAvLyBBZGQgd2hlZWwgZXZlbnQgbGlzdGVuZXIgdG8gZG9jdW1lbnRcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgaGFuZGxlV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7XG5cbiAgICAvLyBDbGVhbiB1cCB3aGVlbCBldmVudCBsaXN0ZW5lciB3aGVuIGNvbXBvbmVudCB1bmxvYWRzXG4gICAgdGhpcy5yZWdpc3RlcigoKSA9PiB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgaGFuZGxlV2hlZWwpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY2FsY3VsYXRlUHJldmlld0RpbWVuc2lvbnMgPSAoXG4gICAgICBuYXR1cmFsV2lkdGg6IG51bWJlcixcbiAgICAgIG5hdHVyYWxIZWlnaHQ6IG51bWJlcixcbiAgICAgIHZpZXdwb3J0V2lkdGg6IG51bWJlcixcbiAgICAgIHZpZXdwb3J0SGVpZ2h0OiBudW1iZXJcbiAgICApID0+IHtcbiAgICAgIC8vIE1heGltdW0gc2l6ZSBzaG91bGQgYmUgYSBwZXJjZW50YWdlIG9mIHZpZXdwb3J0XG4gICAgICBjb25zdCBtYXhXaWR0aCA9IE1hdGgubWluKHZpZXdwb3J0V2lkdGggKiAwLjQsIG5hdHVyYWxXaWR0aCk7IC8vIDQwJSBvZiB2aWV3cG9ydCB3aWR0aFxuICAgICAgY29uc3QgbWF4SGVpZ2h0ID0gTWF0aC5taW4odmlld3BvcnRIZWlnaHQgKiAwLjYsIG5hdHVyYWxIZWlnaHQpOyAvLyA2MCUgb2Ygdmlld3BvcnQgaGVpZ2h0XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBkaW1lbnNpb25zIG1haW50YWluaW5nIGFzcGVjdCByYXRpb1xuICAgICAgbGV0IHdpZHRoID0gbmF0dXJhbFdpZHRoO1xuICAgICAgbGV0IGhlaWdodCA9IG5hdHVyYWxIZWlnaHQ7XG5cbiAgICAgIGlmICh3aWR0aCA+IG1heFdpZHRoKSB7XG4gICAgICAgIHdpZHRoID0gbWF4V2lkdGg7XG4gICAgICAgIGhlaWdodCA9IChuYXR1cmFsSGVpZ2h0ICogbWF4V2lkdGgpIC8gbmF0dXJhbFdpZHRoO1xuICAgICAgfVxuXG4gICAgICBpZiAoaGVpZ2h0ID4gbWF4SGVpZ2h0KSB7XG4gICAgICAgIGhlaWdodCA9IG1heEhlaWdodDtcbiAgICAgICAgd2lkdGggPSAobmF0dXJhbFdpZHRoICogbWF4SGVpZ2h0KSAvIG5hdHVyYWxIZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHdpZHRoLCBoZWlnaHQgfTtcbiAgICB9O1xuXG4gICAgY29uc3QgdXBkYXRlUHJldmlld1Bvc2l0aW9uID0gKGU6IE1vdXNlRXZlbnQsIHByZXZpZXdFbDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgIGlmICghcHJldmlld0VsKSByZXR1cm47XG5cbiAgICAgIC8vIEdldCB2aWV3cG9ydCBkaW1lbnNpb25zXG4gICAgICBjb25zdCB2aWV3cG9ydFdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICBjb25zdCB2aWV3cG9ydEhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgLy8gR2V0IHByZXZpZXcgZGltZW5zaW9uc1xuICAgICAgY29uc3QgcmVjdCA9IHByZXZpZXdFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IHdpZHRoID0gcmVjdC53aWR0aDtcbiAgICAgIGNvbnN0IGhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb25cbiAgICAgIGxldCB4ID0gZS5jbGllbnRYICsgMTY7IC8vIERlZmF1bHQgb2Zmc2V0IGZyb20gY3Vyc29yXG4gICAgICBsZXQgeSA9IGUuY2xpZW50WSArIDE2O1xuXG4gICAgICAvLyBDaGVjayBpZiBwcmV2aWV3IHdvdWxkIGdvIG9mZiBzY3JlZW5cbiAgICAgIGlmICh4ICsgd2lkdGggPiB2aWV3cG9ydFdpZHRoKSB7XG4gICAgICAgIHggPSBlLmNsaWVudFggLSB3aWR0aCAtIDE2OyAvLyBTaG93IG9uIGxlZnQgc2lkZSBvZiBjdXJzb3JcbiAgICAgIH1cbiAgICAgIGlmICh5ICsgaGVpZ2h0ID4gdmlld3BvcnRIZWlnaHQpIHtcbiAgICAgICAgeSA9IGUuY2xpZW50WSAtIGhlaWdodCAtIDE2OyAvLyBTaG93IGFib3ZlIGN1cnNvclxuICAgICAgfVxuXG4gICAgICBwcmV2aWV3RWwuc3R5bGUubGVmdCA9IGAke3h9cHhgO1xuICAgICAgcHJldmlld0VsLnN0eWxlLnRvcCA9IGAke3l9cHhgO1xuICAgIH07XG5cbiAgICAvLyBDbGVhbiB1cCBwcmV2aWV3cyB3aGVuIGNvbXBvbmVudCB1bmxvYWRzXG4gICAgdGhpcy5yZWdpc3RlcigoKSA9PiB7XG4gICAgICBpbWFnZVByZXZpZXcucmVtb3ZlKCk7XG4gICAgICBtYXJrZG93blByZXZpZXcucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgICBmb3IgKGNvbnN0IHsgZmlsZSwgcGF0aCwgbGlua1RleHQgfSBvZiBmaWxlcykge1xuICAgICAgY29uc3QgaXRlbSA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW1cIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBwYXRoRWwgPSBpdGVtLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbS1wYXRoXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHBhdGhFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1maWxlLWljb25cIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgbGV0IGljb25OYW1lID0gXCJmaWxlXCI7XG5cbiAgICAgIC8vIENyZWF0ZSBsaW5rIGZpcnN0IHNvIHdlIGNhbiByZWZlcmVuY2UgaXQgZm9yIGhvdmVyIGV2ZW50c1xuICAgICAgY29uc3QgbGluayA9IHBhdGhFbC5jcmVhdGVFbChcImFcIiwge1xuICAgICAgICBjbHM6IFwiaW50ZXJuYWwtbGlua1wiLFxuICAgICAgICB0ZXh0OiBmaWxlLmJhc2VuYW1lLFxuICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgaHJlZjogcGF0aCxcbiAgICAgICAgICBcImRhdGEtaHJlZlwiOiBwYXRoLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChbXCJtZFwiLCBcInR4dFwiLCBcIm1hcmtkb3duXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgaWNvbk5hbWUgPSBcImZpbGUtdGV4dFwiO1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBoYW5kbGVycyBmb3IgbWFya2Rvd24gZmlsZXNcbiAgICAgICAgY29uc3Qgc2hvd01hcmtkb3duUHJldmlldyA9IGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG1kRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlLnBhdGgpO1xuICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKG1kRmlsZSk7XG5cbiAgICAgICAgICAgICAgLy8gQ3JlYXRlIGhlYWRlciB3aXRoIGZpbGVuYW1lXG4gICAgICAgICAgICAgIG1hcmtkb3duUHJldmlldy5lbXB0eSgpO1xuICAgICAgICAgICAgICBtYXJrZG93blByZXZpZXcuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXZpZXctaGVhZGVyXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgLy8gQ3JlYXRlIGNvbnRlbnQgY29udGFpbmVyIGFuZCByZW5kZXIgbWFya2Rvd25cbiAgICAgICAgICAgICAgY29uc3QgY29udGVudEVsID0gbWFya2Rvd25QcmV2aWV3LmNyZWF0ZURpdigpO1xuICAgICAgICAgICAgICBhd2FpdCBNYXJrZG93blJlbmRlcmVyLnJlbmRlck1hcmtkb3duKFxuICAgICAgICAgICAgICAgIC8vIFNob3cgZmlyc3QgNDAwMCBjaGFyYWN0ZXJzIHdpdGggbWVzc2FnZSBpZiBsb25nZXJcbiAgICAgICAgICAgICAgICBjb250ZW50Lmxlbmd0aCA+IDQwMDBcbiAgICAgICAgICAgICAgICAgID8gY29udGVudC5zbGljZSgwLCA0MDAwKSArXG4gICAgICAgICAgICAgICAgICAgICAgXCJcXG5cXG4tLS1cXG5cXG4qKkNsaWNrIHRvIHZpZXcgZnVsbCBkb2N1bWVudCoqIChzaG93aW5nIGZpcnN0IDQwMDAgb2YgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQubGVuZ3RoICtcbiAgICAgICAgICAgICAgICAgICAgICBcIiBjaGFyYWN0ZXJzKVwiXG4gICAgICAgICAgICAgICAgICA6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgY29udGVudEVsLFxuICAgICAgICAgICAgICAgIGZpbGUucGF0aCxcbiAgICAgICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgbWFya2Rvd25QcmV2aWV3LmNsYXNzTGlzdC5hZGQoXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICBpc01hcmtkb3duUHJldmlld1Zpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3UG9zaXRpb24oZSwgbWFya2Rvd25QcmV2aWV3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIG1hcmtkb3duIHByZXZpZXc6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaGlkZU1hcmtkb3duUHJldmlldyA9ICgpID0+IHtcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XG4gICAgICAgICAgbWFya2Rvd25QcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgaXNNYXJrZG93blByZXZpZXdWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgLy8gUmVzZXQgc2Nyb2xsIHBvc2l0aW9uIHdoZW4gaGlkaW5nXG4gICAgICAgICAgbWFya2Rvd25QcmV2aWV3LnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIHRvIHRoZSBlbnRpcmUgaXRlbSBjb250YWluZXJcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBzaG93TWFya2Rvd25QcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlTWFya2Rvd25QcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIChlKSA9PlxuICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBtYXJrZG93blByZXZpZXcpXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQWRkIG1vdXNlbGVhdmUgaGFuZGxlciB0byB0aGUgcHJldmlldyBpdHNlbGZcbiAgICAgICAgbWFya2Rvd25QcmV2aWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSBwcmV2aWV3J3MgbW91c2VsZWF2ZSBoYW5kbGVyIG9uIHVubG9hZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgIFwibW91c2VsZWF2ZVwiLFxuICAgICAgICAgICAgaGlkZU1hcmtkb3duUHJldmlld1xuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvcmNlIHRoZSBwcmV2aWV3IHRvIGhpZGUgd2hlbmV2ZXIgdGhlIHBvaW50ZXIgbGVhdmVzIHRoZSB3aG9sZSBwYW5lbFxuICAgICAgICB0aGlzLmNvbnRleHRQYW5lbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlTWFya2Rvd25QcmV2aWV3KTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIFtcImpwZ1wiLCBcImpwZWdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJ3ZWJwXCIsIFwic3ZnXCJdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICAgICkge1xuICAgICAgICBpY29uTmFtZSA9IFwiaW1hZ2VcIjtcblxuICAgICAgICAvLyBBZGQgaG92ZXIgaGFuZGxlcnMgZm9yIGltYWdlc1xuICAgICAgICBjb25zdCBzaG93SW1hZ2VQcmV2aWV3ID0gYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaW1hZ2VGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGUucGF0aCk7XG4gICAgICAgICAgICBpZiAoaW1hZ2VGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGltYWdlRmlsZSk7XG4gICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdKTtcbiAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcblxuICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuc3JjID0gdXJsO1xuICAgICAgICAgICAgICBpbWFnZVByZXZpZXcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcbiAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBvc2l0aW9uIGFuZCBzaXplIGltbWVkaWF0ZWx5IGFmdGVyIGltYWdlIGxvYWRzXG4gICAgICAgICAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYWxjdWxhdGVQcmV2aWV3RGltZW5zaW9ucyhcbiAgICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5uYXR1cmFsV2lkdGgsXG4gICAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcubmF0dXJhbEhlaWdodCxcbiAgICAgICAgICAgICAgICAgIHdpbmRvdy5pbm5lcldpZHRoLFxuICAgICAgICAgICAgICAgICAgd2luZG93LmlubmVySGVpZ2h0XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gICAgICAgICAgICAgICAgaW1hZ2VQcmV2aWV3LnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gICAgICAgICAgICAgICAgdXBkYXRlUHJldmlld1Bvc2l0aW9uKGUsIGltYWdlUHJldmlldyk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBpbWFnZSBwcmV2aWV3OlwiLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGhpZGVJbWFnZVByZXZpZXcgPSAoKSA9PiB7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LmNsYXNzTGlzdC5yZW1vdmUoXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgIGltYWdlUHJldmlldy5zcmMgPSBcIlwiO1xuICAgICAgICAgIC8vIFJlc2V0IGRpbWVuc2lvbnNcbiAgICAgICAgICBpbWFnZVByZXZpZXcuc3R5bGUud2lkdGggPSBcIlwiO1xuICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBoYW5kbGVycyB0byB0aGUgZW50aXJlIGl0ZW0gY29udGFpbmVyXG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgc2hvd0ltYWdlUHJldmlldyk7XG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZUltYWdlUHJldmlldyk7XG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCAoZSkgPT5cbiAgICAgICAgICB1cGRhdGVQcmV2aWV3UG9zaXRpb24oZSwgaW1hZ2VQcmV2aWV3KVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEFkZCBtb3VzZWxlYXZlIGhhbmRsZXIgdG8gdGhlIHByZXZpZXcgaXRzZWxmXG4gICAgICAgIGltYWdlUHJldmlldy5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcblxuICAgICAgICAvLyBDbGVhbiB1cCB0aGUgcHJldmlldydzIG1vdXNlbGVhdmUgaGFuZGxlciBvbiB1bmxvYWRcbiAgICAgICAgdGhpcy5yZWdpc3RlcigoKSA9PiB7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVJbWFnZVByZXZpZXcpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBGb3JjZSB0aGUgcHJldmlldyB0byBoaWRlIHdoZW5ldmVyIHRoZSBwb2ludGVyIGxlYXZlcyB0aGUgd2hvbGUgcGFuZWxcbiAgICAgICAgdGhpcy5jb250ZXh0UGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZUltYWdlUHJldmlldyk7XG4gICAgICB9IGVsc2UgaWYgKFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJhdWRpby1saW5lc1wiO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgW1wiZG9jXCIsIFwiZG9jeFwiLCBcInBwdFwiLCBcInBwdHhcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwicGRmXCJdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICAgICkge1xuICAgICAgICBpY29uTmFtZSA9IFwiZmlsZVwiO1xuICAgICAgfVxuXG4gICAgICBzZXRJY29uKGljb25Db250YWluZXIsIGljb25OYW1lKTtcblxuICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub3BlbkxpbmtUZXh0KGxpbmtUZXh0LCBcIlwiLCB0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtZXRhID0gaXRlbS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbWV0YVwiIH0pO1xuXG4gICAgICBjb25zdCB0eXBlID0gbWV0YS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdHlwZVwiIH0pO1xuICAgICAgdHlwZS5zZXRUZXh0KGZpbGUuZXh0ZW5zaW9uLnRvVXBwZXJDYXNlKCkpO1xuXG4gICAgICBjb25zdCBtZXRhR3JvdXAgPSBtZXRhLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tZXRhLWdyb3VwXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2l6ZSA9IG1ldGFHcm91cC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZVwiIH0pO1xuICAgICAgc2l6ZS5zZXRUZXh0KHRoaXMuZm9ybWF0RmlsZVNpemUoZmlsZS5zdGF0Py5zaXplIHx8IDApKTtcblxuICAgICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpIHtcbiAgICAgICAgY29uc3QgdG9rZW5Db3VudCA9IG1ldGFHcm91cC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10b2tlbi1jb3VudFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDA7XG4gICAgICAgIHRva2VuQ291bnQuc2V0VGV4dCh0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KGNvdW50KSk7XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRva2VuIGNvdW50IGlmIG5vdCBhbHJlYWR5IGRvbmVcbiAgICAgICAgaWYgKCF0aGlzLnRva2VuQ291bnRzLmhhcyhmaWxlLnBhdGgpKSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVUb2tlbkNvdW50KGZpbGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdG9rZW5Db3VudC5zZXRUZXh0KFxuICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KFxuICAgICAgICAgICAgICAgIHRoaXMudG9rZW5Db3VudHMuZ2V0KGZpbGUucGF0aCkgfHwgMFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgcmVtb3ZlIGJ1dHRvbiB0byB0aGUgZW5kXG4gICAgICBjb25zdCByZW1vdmVCdG4gPSBpdGVtLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbS1yZW1vdmVcIixcbiAgICAgICAgdGV4dDogXCJcdTAwRDdcIixcbiAgICAgIH0pO1xuXG4gICAgICByZW1vdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQ29udGV4dEZpbGUocGF0aCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGFkZENvbnRleHRGaWxlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1vZGFsID0gbmV3IENvbnRleHRTZWxlY3Rpb25Nb2RhbChcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgYXN5bmMgKGZpbGVzOiBURmlsZVtdKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFkZEZpbGVUb0NvbnRleHQoZmlsZSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICAgICAgICAgICAgZmlsZSxcbiAgICAgICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlwiLCBcIlwiLCB0cnVlKTtcbiAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRoaXMucGx1Z2luXG4gICAgKTtcbiAgICBtb2RhbC5vcGVuKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbW92ZUNvbnRleHRGaWxlKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IGZpbGVQYXRoLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpO1xuICAgIHRoaXMuY29udGV4dEZpbGVzLmRlbGV0ZShmaWxlUGF0aCk7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMuZGVsZXRlKGBbWyR7bm9ybWFsaXplZFBhdGh9XV1gKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHRQYW5lbCgpO1xuICAgIGF3YWl0IHRoaXMub25Db250ZXh0Q2hhbmdlKCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgYWRkRmlsZVRvQ29udGV4dChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZGF0YWxhYkRvY0V4dGVuc2lvbnMgPSBbXG4gICAgICBcInBkZlwiLFxuICAgICAgXCJkb2NcIixcbiAgICAgIFwiZG9jeFwiLFxuICAgICAgXCJ4bHNcIixcbiAgICAgIFwieGxzeFwiLFxuICAgICAgXCJwcHRcIixcbiAgICAgIFwicHB0eFwiLFxuICAgIF07XG4gICAgY29uc3QgYXVkaW9FeHRlbnNpb25zID0gW1wid2F2XCIsIFwibTRhXCIsIFwid2VibVwiLCBcIm9nZ1wiLCBcIm1wM1wiXTtcblxuICAgIC8vIENoZWNrIGxpY2Vuc2UgYmVmb3JlIHByb2Nlc3NpbmdcbiAgICBpZiAoXG4gICAgICAhKGF3YWl0IExpY2Vuc2VDaGVja2VyLmNoZWNrTGljZW5zZUZvckZpbGUoZmlsZSwgdGhpcy5hcHAsIHRoaXMucGx1Z2luKSlcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiBmaWxlIGlzIGEgZG9jdW1lbnQgdGhhdCBuZWVkcyBEYXRhbGFiIHByb2Nlc3NpbmdcbiAgICBpZiAoZGF0YWxhYkRvY0V4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmV3TWRQYXRoID0gYXdhaXQgdGhpcy5wcm9jZXNzRG9jdW1lbnRGaWxlKGZpbGUpO1xuICAgICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7bmV3TWRQYXRofV1dYDtcbiAgICAgICAgdGhpcy5jb250ZXh0RmlsZXMuYWRkKHdpa2lMaW5rKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICAgICAgICBmaWxlLFxuICAgICAgICAgIGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhdWRpb0V4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmV3TWRQYXRoID0gYXdhaXQgdGhpcy5wcm9jZXNzQXVkaW9GaWxlKGZpbGUpO1xuICAgICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7bmV3TWRQYXRofV1dYDtcbiAgICAgICAgdGhpcy5jb250ZXh0RmlsZXMuYWRkKHdpa2lMaW5rKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICAgICAgICBmaWxlLFxuICAgICAgICAgIGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE9yaWdpbmFsIGxvZ2ljIGZvciBub3JtYWwgZmlsZVxuICAgICAgY29uc3Qgd2lraUxpbmsgPSBgW1ske2ZpbGUucGF0aH1dXWA7XG4gICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gICAgYXdhaXQgdGhpcy5vbkNvbnRleHRDaGFuZ2UoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0RvY3VtZW50RmlsZShmaWxlOiBURmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gSW5kaWNhdGUgd2UncmUgdXBsb2FkaW5nXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiVXBsb2FkaW5nLi4uXCIsIFwidXBsb2FkXCIpO1xuICAgIGNvbnN0IHsgZG9jdW1lbnRJZCwgc3RhdHVzLCBjYWNoZWQgfSA9XG4gICAgICBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UudXBsb2FkRG9jdW1lbnQoZmlsZSk7XG5cbiAgICAvLyBJZiBkb2N1bWVudCBpcyBjYWNoZWQsIHNraXAgcG9sbFxuICAgIGlmICghY2FjaGVkKSB7XG4gICAgICAvLyBJbmRpY2F0ZSB3ZSdyZSBwcm9jZXNzaW5nXG4gICAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJQcm9jZXNzaW5nLi4uXCIsIFwibG9hZGVyLTJcIik7XG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5wb2xsVW50aWxDb21wbGV0ZShkb2N1bWVudElkKTtcbiAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb2N1bWVudCBwcm9jZXNzaW5nIG5vdCBjb21wbGV0ZWQgaW4gdGltZS5cIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW5kaWNhdGUgd2UncmUgZG93bmxvYWRpbmcgcmVzdWx0c1xuICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIkRvd25sb2FkaW5nIHJlc3VsdHMuLi5cIiwgXCJkb3dubG9hZFwiKTtcbiAgICBjb25zdCBleHRyYWN0aW9uRGF0YSA9IGF3YWl0IHRoaXMuZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQpO1xuXG4gICAgLy8gQ3JlYXRlIHN1YmZvbGRlciBhbmQgLm1kIHdpdGggZXh0cmFjdGVkIHRleHRcbiAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgIGNvbnN0IGJhc2VOYW1lID0gZmlsZS5iYXNlbmFtZS5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgXCItXCIpLnRyaW0oKTtcbiAgICBjb25zdCBwYXJlbnRQYXRoID0gZXh0cmFjdGlvbkZvbGRlclxuICAgICAgPyBgJHtleHRyYWN0aW9uRm9sZGVyfS8ke2Jhc2VOYW1lfWBcbiAgICAgIDogYCR7ZmlsZS5wYXJlbnQ/LnBhdGggPz8gXCJcIn0vJHtiYXNlTmFtZX1gO1xuXG4gICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKHBhcmVudFBhdGgpLmNhdGNoKCgpID0+IHtcbiAgICAgIC8qIGZvbGRlciBtYXkgZXhpc3QgKi9cbiAgICB9KTtcblxuICAgIGNvbnN0IGV4dHJhY3RlZFRleHQgPSB0aGlzLmdldEV4dHJhY3Rpb25NYXJrZG93bihleHRyYWN0aW9uRGF0YSk7XG4gICAgY29uc3QgbmV3TWRQYXRoID0gYCR7cGFyZW50UGF0aH0vJHtiYXNlTmFtZX0ubWRgO1xuXG4gICAgLy8gVHJ5IHRvIGNyZWF0ZSB0aGUgbWFya2Rvd24gZmlsZSwgaWYgaXQgZXhpc3RzLCB3ZSdsbCB1c2UgdGhlIGV4aXN0aW5nIG9uZVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUobmV3TWRQYXRoLCBleHRyYWN0ZWRUZXh0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRmlsZSBleGlzdHMsIHRoYXQncyBva2F5IC0gd2UnbGwgdXNlIGl0XG4gICAgICBpZiAoXG4gICAgICAgICEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikgfHxcbiAgICAgICAgIWVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJhbHJlYWR5IGV4aXN0c1wiKVxuICAgICAgKSB7XG4gICAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyBpZiBpdCdzIG5vdCBhIFwiZmlsZSBleGlzdHNcIiBlcnJvclxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgbWFya2Rvd24gZmlsZSB0byBjb250ZXh0XG4gICAgY29uc3QgbWRXaWtpTGluayA9IGBbWyR7bmV3TWRQYXRofV1dYDtcbiAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQobWRXaWtpTGluayk7XG5cbiAgICAvLyBIYW5kbGUgaW1hZ2VzIGFuZCBhZGQgdGhlbSB0byBjb250ZXh0XG4gICAgaWYgKGV4dHJhY3Rpb25EYXRhLmltYWdlcyAmJiB0eXBlb2YgZXh0cmFjdGlvbkRhdGEuaW1hZ2VzID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBmb3IgKGNvbnN0IFtmaWxlbmFtZSwgYmFzZTY0RGF0YV0gb2YgT2JqZWN0LmVudHJpZXMoXG4gICAgICAgIGV4dHJhY3Rpb25EYXRhLmltYWdlc1xuICAgICAgKSkge1xuICAgICAgICBjb25zdCBpbWFnZVBhdGggPSBgJHtwYXJlbnRQYXRofS8ke2ZpbGVuYW1lXG4gICAgICAgICAgLnJlcGxhY2UoL1tcXFxcLzoqP1wiPD58XS9nLCBcIi1cIilcbiAgICAgICAgICAudHJpbSgpfWA7XG5cbiAgICAgICAgLy8gVHJ5IHRvIGNyZWF0ZSB0aGUgaW1hZ2UgZmlsZSwgaWYgaXQgZXhpc3RzLCB3ZSdsbCB1c2UgdGhlIGV4aXN0aW5nIG9uZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUJpbmFyeShcbiAgICAgICAgICAgIGltYWdlUGF0aCxcbiAgICAgICAgICAgIHRoaXMuZGVjb2RlQmFzZTY0KGJhc2U2NERhdGEgYXMgc3RyaW5nKVxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgLy8gRmlsZSBleGlzdHMsIHRoYXQncyBva2F5IC0gd2UnbGwgdXNlIGl0XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgIShlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB8fFxuICAgICAgICAgICAgIWVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJhbHJlYWR5IGV4aXN0c1wiKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IGlmIGl0J3Mgbm90IGEgXCJmaWxlIGV4aXN0c1wiIGVycm9yXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGVhY2ggaW1hZ2UgdG8gY29udGV4dFxuICAgICAgICBjb25zdCBpbWFnZVdpa2lMaW5rID0gYFtbJHtpbWFnZVBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQoaW1hZ2VXaWtpTGluayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ld01kUGF0aDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RXh0cmFjdGlvbk1hcmtkb3duKGV4dHJhY3Rpb25EYXRhOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRleHQgPSBleHRyYWN0aW9uRGF0YT8udGV4dCA/PyBcIlwiO1xuICAgIGNvbnN0IG1ldGFkYXRhID0gZXh0cmFjdGlvbkRhdGE/Lm1ldGFkYXRhID8/IHt9O1xuICAgIGNvbnN0IHBhZ2VDb3VudCA9IGV4dHJhY3Rpb25EYXRhPy5wYWdlQ291bnQgPz8gMDtcbiAgICByZXR1cm4gYCMgRG9jdW1lbnQgRXh0cmFjdGlvblxuUGFnZSBDb3VudDogJHtwYWdlQ291bnR9XG5cbiR7dGV4dH1cblxuJHttZXRhZGF0YSA/IGBcXG4jIE1ldGFkYXRhXFxuJHtKU09OLnN0cmluZ2lmeShtZXRhZGF0YSwgbnVsbCwgMil9YCA6IFwiXCJ9XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBkZWNvZGVCYXNlNjQoYmFzZTY0U3RyaW5nOiBzdHJpbmcpOiBBcnJheUJ1ZmZlciB7XG4gICAgY29uc3QgYmluYXJ5U3RyID0gd2luZG93LmF0b2IoYmFzZTY0U3RyaW5nKTtcbiAgICBjb25zdCBsZW4gPSBiaW5hcnlTdHIubGVuZ3RoO1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBieXRlc1tpXSA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXMuYnVmZmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG4gIH1cblxuICBnZXRDb250ZXh0RmlsZXMoKTogU2V0PHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHRGaWxlcztcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZXRDb250ZXh0RmlsZXMoZmlsZXM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMgPSBuZXcgU2V0KGZpbGVzKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHRQYW5lbCgpO1xuICAgIGF3YWl0IHRoaXMuY2hlY2tTeW5jU3RhdHVzKCk7XG4gIH1cblxuICBnZXRDb250YWluZXIoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHRQYW5lbDtcbiAgfVxuXG4gIHVubG9hZCgpOiB2b2lkIHtcbiAgICAvLyBDbGVhciBhbGwgcHJvY2Vzc2luZyB0aW1lb3V0c1xuICAgIHRoaXMucHJvY2Vzc2luZ1RpbWVvdXRzLmZvckVhY2goKHRpbWVvdXQpID0+IHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5jbGVhcigpO1xuXG4gICAgLy8gQ2xlYXIgYWxsIHByb2Nlc3Npbmcgc3RhdHVzZXNcbiAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5mb3JFYWNoKChzdGF0dXNFbCkgPT4ge1xuICAgICAgc3RhdHVzRWwucmVtb3ZlKCk7XG4gICAgfSk7XG4gICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuY2xlYXIoKTtcblxuICAgIGlmICh0aGlzLnByb2Nlc3NpbmdTdGF0dXMpIHtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuXG4gICAgdGhpcy5kcmF3ZXIudW5sb2FkKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NBdWRpb0ZpbGUoXG4gICAgZmlsZTogVEZpbGUsXG4gICAgdGltZXN0YW1wZWQ6IGJvb2xlYW4gPSBmYWxzZVxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIEluZGljYXRlIHdlJ3JlIHRyYW5zY3JpYmluZ1xuICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlRyYW5zY3JpYmluZyBhdWRpby4uLlwiLCBcImxvYWRlci0yXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBUcmFuc2NyaXB0aW9uU2VydmljZSBkaXJlY3RseVxuICAgICAgY29uc3QgdHJhbnNjcmlwdGlvblNlcnZpY2UgPSBUcmFuc2NyaXB0aW9uU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICk7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgdHJhbnNjcmlwdGlvblNlcnZpY2UudHJhbnNjcmliZUZpbGUoZmlsZSwge1xuICAgICAgICB0eXBlOiBcIm5vdGVcIixcbiAgICAgICAgdGltZXN0YW1wZWQsXG4gICAgICAgIG9uUHJvZ3Jlc3M6IChwcm9ncmVzcywgc3RhdHVzKSA9PiB7XG4gICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIHN0YXR1cywgXCJsb2FkZXItMlwiKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgc3ViZm9sZGVyICsgLm1kIHdpdGggdHJhbnNjcmliZWQgdGV4dFxuICAgICAgY29uc3QgZXh0cmFjdGlvbkZvbGRlciA9IHRoaXMuc2N1bHB0U2VydmljZS5leHRyYWN0aW9uc0RpcmVjdG9yeTtcbiAgICAgIGNvbnN0IGJhc2VOYW1lID0gZmlsZS5iYXNlbmFtZS5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgXCItXCIpLnRyaW0oKTtcbiAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICAgID8gYCR7ZXh0cmFjdGlvbkZvbGRlcn0vJHtiYXNlTmFtZX1gXG4gICAgICAgIDogYCR7ZmlsZS5wYXJlbnQ/LnBhdGggPz8gXCJcIn0vJHtiYXNlTmFtZX1gO1xuXG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIocGFyZW50UGF0aCkuY2F0Y2goKCkgPT4ge30pO1xuXG4gICAgICBjb25zdCBvdXRwdXRQYXRoID0gYCR7cGFyZW50UGF0aH0vJHtiYXNlTmFtZX0ubWRgO1xuICAgICAgY29uc3QgZmluYWxDb250ZW50ID0gYCMgQXVkaW8gVHJhbnNjcmlwdGlvblxuU291cmNlOiAke2ZpbGUuYmFzZW5hbWV9XG5UcmFuc2NyaWJlZDogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9XG5cbiR7dGV4dH1gO1xuXG4gICAgICAvLyBUcnkgY3JlYXRpbmcgdGhlIC5tZFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG91dHB1dFBhdGgpO1xuICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZXhpc3RpbmdGaWxlLCBmaW5hbENvbnRlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShvdXRwdXRQYXRoLCBmaW5hbENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmlsZSBvcGVyYXRpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJBZGRlZCBzdWNjZXNzZnVsbHkhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgcmV0dXJuIG91dHB1dFBhdGg7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdWRpbyB0cmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoXG4gICAgICAgIGZpbGUsXG4gICAgICAgIGBFcnJvcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCxcbiAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwb2xsVW50aWxDb21wbGV0ZShkb2N1bWVudElkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBtYXhUcmllcyA9IDUwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4VHJpZXM7IGkrKykge1xuICAgICAgYXdhaXQgdGhpcy5zbGVlcCgzMDAwKTtcbiAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvZG9jdW1lbnRzLyR7ZG9jdW1lbnRJZH1gO1xuICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICBpZiAoIXJlc3Aub2spIGNvbnRpbnVlO1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgaWYgKGRhdGE/LmRhdGE/LnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIikgcmV0dXJuIHRydWU7XG4gICAgICBpZiAoZGF0YT8uZGF0YT8uc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGE/LmRhdGE/LmVycm9yIHx8IFwiUHJvY2Vzc2luZyBmYWlsZWRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvZG9jdW1lbnRzLyR7ZG9jdW1lbnRJZH0vZG93bmxvYWRgO1xuICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgIGlmICghcmVzcC5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBEb3dubG9hZCBleHRyYWN0aW9uIGZhaWxlZDogJHtyZXNwLnN0YXR1c31gKTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvciB8fCBcIkZhaWxlZCB0byBkb3dubG9hZCBleHRyYWN0aW9uXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YS5kYXRhLmV4dHJhY3Rpb25SZXN1bHQ7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZTogVEZpbGUpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoZmlsZS5leHRlbnNpb24gPT09IFwibWRcIiB8fCBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ0eHRcIikge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5Db3VudGVyLmFwcHJveGltYXRlVG9rZW5Db3VudChjb250ZW50KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2FsY3VsYXRpbmcgdG9rZW5zIGZvciBmaWxlOlwiLCBmaWxlLnBhdGgsIGVycm9yKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVUb2tlbkNvdW50KGZpbGUpO1xuICAgIHRoaXMudG9rZW5Db3VudHMuc2V0KGZpbGUucGF0aCwgY291bnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRGaWxlU2l6ZShieXRlczogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoYnl0ZXMgPCAxMDI0KSByZXR1cm4gYnl0ZXMgKyBcIiBCXCI7XG4gICAgY29uc3Qga2IgPSBieXRlcyAvIDEwMjQ7XG4gICAgaWYgKGtiIDwgMTAyNCkgcmV0dXJuIGtiLnRvRml4ZWQoMSkgKyBcIiBLQlwiO1xuICAgIGNvbnN0IG1iID0ga2IgLyAxMDI0O1xuICAgIHJldHVybiBtYi50b0ZpeGVkKDEpICsgXCIgTUJcIjtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTZWFyY2hTZXJ2aWNlIH0gZnJvbSBcInNyYy9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlXCI7XG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUb2tlbkNvdW50ZXJTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1Rva2VuQ291bnRlclNlcnZpY2VcIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBMaWNlbnNlQ2hlY2tlciB9IGZyb20gXCIuLi9jb3JlL2xpY2Vuc2UvTGljZW5zZUNoZWNrZXJcIjtcblxuLy8gRGVmaW5lIHN1cHBvcnRlZCBmaWxlIHR5cGVzXG5jb25zdCBTVVBQT1JURURfRVhURU5TSU9OUyA9IHtcbiAgZG9jdW1lbnRzOiBbXCJtZFwiLCBcInR4dFwiXSxcbiAgcHJvRG9jdW1lbnRzOiBbXCJwZGZcIiwgXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIl0sXG4gIGltYWdlczogW1wicG5nXCIsIFwianBnXCIsIFwianBlZ1wiLCBcImdpZlwiLCBcInN2Z1wiLCBcIndlYnBcIl0sXG4gIGF1ZGlvOiBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJtNGFcIiwgXCJvZ2dcIiwgXCJ3ZWJtXCJdLFxufTtcblxuLy8gRmxhdHRlbiBhbGwgc3VwcG9ydGVkIGV4dGVuc2lvbnMgaW50byBhIHNpbmdsZSBhcnJheVxuY29uc3QgQUxMX1NVUFBPUlRFRF9FWFRFTlNJT05TID0gT2JqZWN0LnZhbHVlcyhTVVBQT1JURURfRVhURU5TSU9OUykuZmxhdCgpO1xuXG5pbnRlcmZhY2UgU2VhcmNoTWF0Y2gge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIGluZGljZXM6IG51bWJlcltdO1xuICBtYXRjaFF1YWxpdHk6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFNlYXJjaFJlc3VsdDxUPiB7XG4gIGl0ZW06IFQ7XG4gIG1hdGNoZXM6IFNlYXJjaE1hdGNoW107XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBDb250ZXh0Q2FyZCB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHBhdGg6IHN0cmluZztcbiAgc2l6ZTogc3RyaW5nO1xuICB0eXBlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBDb250ZXh0U2VsZWN0aW9uTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50ZXI6IFRva2VuQ291bnRlclNlcnZpY2U7XG4gIHByaXZhdGUgdG9rZW5Db3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBwcml2YXRlIG9uU2VsZWN0OiAoZmlsZXM6IFRGaWxlW10pID0+IHZvaWQ7XG4gIHByaXZhdGUgZmlsZXM6IFRGaWxlW107XG4gIHByaXZhdGUgc2VhcmNoSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgcmVzdWx0c0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VycmVudFNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxURmlsZT5bXSA9IFtdO1xuICBwcml2YXRlIGxvYWRpbmdJbmRpY2F0b3I6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGVtcHR5U3RhdGU6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHNlYXJjaFRpbWVvdXQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNlbGVjdGVkRXh0ZW5zaW9uczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgZXh0ZW5zaW9uQnV0dG9uczogTWFwPHN0cmluZywgSFRNTEVsZW1lbnQ+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHNlbGVjdGVkRmlsZXM6IFNldDxURmlsZT4gPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgc2VsZWN0ZWRJbmRleCA9IDA7XG4gIHByaXZhdGUgcmVzdWx0RWxlbWVudHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBwbHVnaW46IGFueTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgb25TZWxlY3Q6IChmaWxlczogVEZpbGVbXSkgPT4gdm9pZCwgcGx1Z2luOiBhbnkpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMub25TZWxlY3QgPSBvblNlbGVjdDtcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2UgPSBuZXcgU2VhcmNoU2VydmljZSgpO1xuICAgIHRoaXMudG9rZW5Db3VudGVyID0gVG9rZW5Db3VudGVyU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuZmlsZXMgPSB0aGlzLmdldEF2YWlsYWJsZUZpbGVzKCk7XG4gICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuYWRkKFwibWRcIik7IC8vIERlZmF1bHQgdG8gTWFya2Rvd24gZmlsdGVyXG4gIH1cblxuICBwcml2YXRlIGdldEF2YWlsYWJsZUZpbGVzKCk6IFRGaWxlW10ge1xuICAgIC8vIFNob3cgb25seSBzdXBwb3J0ZWQgZmlsZXNcbiAgICByZXR1cm4gdGhpcy5hcHAudmF1bHRcbiAgICAgIC5nZXRGaWxlcygpXG4gICAgICAuZmlsdGVyKChmaWxlKSA9PlxuICAgICAgICBBTExfU1VQUE9SVEVEX0VYVEVOU0lPTlMuaW5jbHVkZXMoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSlcbiAgICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlYXJjaEZpZWxkcyhmaWxlOiBURmlsZSkge1xuICAgIHJldHVybiBbXG4gICAgICB7IGZpZWxkOiBcInRpdGxlXCIsIHRleHQ6IGZpbGUuYmFzZW5hbWUsIHdlaWdodDogMTAwIH0sXG4gICAgICB7IGZpZWxkOiBcInBhdGhcIiwgdGV4dDogZmlsZS5wYXRoLCB3ZWlnaHQ6IDc1IH0sXG4gICAgICB7IGZpZWxkOiBcImV4dGVuc2lvblwiLCB0ZXh0OiBmaWxlLmV4dGVuc2lvbiwgd2VpZ2h0OiA1MCB9LFxuICAgIF07XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChieXRlcyA8IDEwMjQpIHJldHVybiBieXRlcyArIFwiIEJcIjtcbiAgICBjb25zdCBrYiA9IGJ5dGVzIC8gMTAyNDtcbiAgICBpZiAoa2IgPCAxMDI0KSByZXR1cm4ga2IudG9GaXhlZCgxKSArIFwiIEtCXCI7XG4gICAgY29uc3QgbWIgPSBrYiAvIDEwMjQ7XG4gICAgcmV0dXJuIG1iLnRvRml4ZWQoMSkgKyBcIiBNQlwiO1xuICB9XG5cbiAgcHJpdmF0ZSBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGNyZWF0ZUZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQpO1xuICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoKTtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlIHx8IFwiXCI7XG5cbiAgICAvLyBVc2UgcmVnZXggdG8gZmluZCB3aG9sZSB3b3JkIG9yIHBocmFzZSBtYXRjaGVzXG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoJHtub3JtYWxpemVkUXVlcnl9KWAsIFwiZ2lcIik7XG4gICAgbGV0IGxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoO1xuXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyBBZGQgbm9uLWhpZ2hsaWdodGVkIHRleHQgYmVmb3JlIG1hdGNoXG4gICAgICBpZiAobWF0Y2guaW5kZXggPiBsYXN0SW5kZXgpIHtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kVGV4dCh0ZXh0LnNsaWNlKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGhpZ2hsaWdodGVkIG1hdGNoXG4gICAgICBjb25zdCBzcGFuID0gZnJhZ21lbnQuY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaGlnaGxpZ2h0XCIsXG4gICAgICAgIHRleHQ6IG1hdGNoWzBdLFxuICAgICAgfSk7XG5cbiAgICAgIGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgZnJhZ21lbnQuYXBwZW5kVGV4dCh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpO1xuICAgIH1cblxuICAgIHJldHVybiBmcmFnbWVudDtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTG9hZGluZ0luZGljYXRvcigpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWxvYWRpbmdcIiB9KTtcbiAgICBzZXRJY29uKGNvbnRhaW5lciwgXCJsb2FkZXItMlwiKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlU3Bhbih7IHRleHQ6IFwiTG9hZGluZy4uLlwiIH0pKTtcbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFbXB0eVN0YXRlKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtZW1wdHlcIiB9KTtcbiAgICBzZXRJY29uKGNvbnRhaW5lciwgXCJzZWFyY2hcIik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZVNwYW4oeyB0ZXh0OiBcIk5vIG1hdGNoaW5nIGZpbGVzIGZvdW5kXCIgfSkpO1xuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZTogVEZpbGUpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoZmlsZS5leHRlbnNpb24gPT09IFwibWRcIiB8fCBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ0eHRcIikge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5Db3VudGVyLmFwcHJveGltYXRlVG9rZW5Db3VudChjb250ZW50KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2FsY3VsYXRpbmcgdG9rZW5zIGZvciBmaWxlOlwiLCBmaWxlLnBhdGgsIGVycm9yKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVUb2tlbkNvdW50KGZpbGUpO1xuICAgIHRoaXMudG9rZW5Db3VudHMuc2V0KGZpbGUucGF0aCwgY291bnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDYXJkKGZpbGU6IFRGaWxlLCByZXN1bHQ6IFNlYXJjaFJlc3VsdDxURmlsZT4pOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY2FyZCA9IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1jYXJkXCIgfSk7XG4gICAgY2FyZC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCBcIjBcIik7XG4gICAgY29uc3QgY2FyZENvbnRlbnQgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2FyZC1jb250ZW50XCIgfSk7XG5cbiAgICAvLyBBZGQgdGh1bWJuYWlsIGZvciBpbWFnZSBmaWxlc1xuICAgIGlmIChmaWxlLmV4dGVuc2lvbi5tYXRjaCgvcG5nfGpwZT9nfGdpZnxzdmd8d2VicC9pKSkge1xuICAgICAgY29uc3QgdGh1bWJDb250YWluZXIgPSBjYXJkQ29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdGh1bWJuYWlsXCIsXG4gICAgICB9KTtcblxuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG4gICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0pO1xuICAgICAgICAgIGNvbnN0IG9iamVjdFVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG5cbiAgICAgICAgICBjb25zdCBpbWcgPSB0aHVtYkNvbnRhaW5lci5jcmVhdGVFbChcImltZ1wiLCB7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdGh1bWItaW1nXCIsXG4gICAgICAgICAgICBhdHRyOiB7IHNyYzogb2JqZWN0VXJsIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIHRodW1ibmFpbDpcIiwgZXJyKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLmhhcyhmaWxlKSkge1xuICAgICAgY2FyZC5hZGRDbGFzcyhcImlzLWFkZGVkXCIpO1xuICAgICAgY29uc3QgY2hlY2tJY29uID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtY2hlY2tcIiB9KTtcbiAgICAgIHNldEljb24oY2hlY2tJY29uLCBcImNoZWNrXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHRleHRDb250YWluZXIgPSBjYXJkQ29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jYXJkLXRleHRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IHRpdGxlID0gdGV4dENvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXRpdGxlXCIsXG4gICAgfSk7XG4gICAgdGl0bGUuYXBwZW5kQ2hpbGQoXG4gICAgICB0aGlzLmhpZ2hsaWdodFRleHQoXG4gICAgICAgIGZpbGUuYmFzZW5hbWUsXG4gICAgICAgIHJlc3VsdC5tYXRjaGVzLmZpbHRlcigobSkgPT4gbS5maWVsZCA9PT0gXCJ0aXRsZVwiKVxuICAgICAgKVxuICAgICk7XG5cbiAgICBjb25zdCBwYXRoID0gdGV4dENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtcGF0aFwiIH0pO1xuICAgIHBhdGguYXBwZW5kQ2hpbGQoXG4gICAgICB0aGlzLmhpZ2hsaWdodFRleHQoXG4gICAgICAgIGZpbGUucGF0aCxcbiAgICAgICAgcmVzdWx0Lm1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcInBhdGhcIilcbiAgICAgIClcbiAgICApO1xuXG4gICAgY29uc3QgbWV0YSA9IHRleHRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1ldGFcIiB9KTtcblxuICAgIGNvbnN0IHR5cGVHcm91cCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10eXBlLWdyb3VwXCIsXG4gICAgfSk7XG4gICAgY29uc3QgdHlwZSA9IHR5cGVHcm91cC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdHlwZVwiIH0pO1xuICAgIHR5cGUuc2V0VGV4dChmaWxlLmV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpKTtcblxuICAgIC8vIEFkZCBwcm8gYmFkZ2UgbmV4dCB0byBmaWxlIGV4dGVuc2lvbiBpZiByZXF1aXJlZFxuICAgIGlmIChMaWNlbnNlQ2hlY2tlci5yZXF1aXJlc1Byb0xpY2Vuc2UoZmlsZS5leHRlbnNpb24pKSB7XG4gICAgICBjb25zdCBwcm9CYWRnZSA9IHR5cGVHcm91cC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtYmFkZ2UgcHJvLWJhZGdlXCIsXG4gICAgICB9KTtcbiAgICAgIHNldEljb24ocHJvQmFkZ2UuY3JlYXRlU3BhbigpLCBcInNwYXJrbGVzXCIpO1xuICAgICAgcHJvQmFkZ2UuY3JlYXRlU3Bhbih7IHRleHQ6IFwiUHJvXCIgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgbWV0YUdyb3VwID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1ldGEtZ3JvdXBcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IHNpemUgPSBtZXRhR3JvdXAuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXNpemVcIiB9KTtcbiAgICBzaXplLnNldFRleHQodGhpcy5mb3JtYXRGaWxlU2l6ZShmaWxlLnN0YXQ/LnNpemUgfHwgMCkpO1xuXG4gICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpIHtcbiAgICAgIGNvbnN0IHRva2VuQ291bnQgPSBtZXRhR3JvdXAuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXRva2VuLWNvdW50XCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy50b2tlbkNvdW50cy5nZXQoZmlsZS5wYXRoKSB8fCAwO1xuICAgICAgdG9rZW5Db3VudC5zZXRUZXh0KHRoaXMudG9rZW5Db3VudGVyLmZvcm1hdFRva2VuQ291bnQoY291bnQpKTtcblxuICAgICAgaWYgKCF0aGlzLnRva2VuQ291bnRzLmhhcyhmaWxlLnBhdGgpKSB7XG4gICAgICAgIHRoaXMudXBkYXRlVG9rZW5Db3VudChmaWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQoXG4gICAgICAgICAgICB0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KFxuICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDBcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLnRvZ2dsZUZpbGVTZWxlY3Rpb24oZmlsZSwgY2FyZCk7XG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZXN1bHRFbGVtZW50cy5pbmRleE9mKGNhcmQpO1xuICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBjYXJkO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFJlc3VsdCgpIHtcbiAgICB0aGlzLnJlc3VsdEVsZW1lbnRzLmZvckVhY2goKGVsLCBpbmRleCkgPT4ge1xuICAgICAgZWwudG9nZ2xlQ2xhc3MoXG4gICAgICAgIFwiaXMtc2VsZWN0ZWRcIixcbiAgICAgICAgaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRJbmRleCAmJiB0aGlzLnNlbGVjdGVkSW5kZXggPj0gMFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA+PSAwICYmXG4gICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPCB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aFxuICAgICkge1xuICAgICAgdGhpcy5yZXN1bHRFbGVtZW50c1t0aGlzLnNlbGVjdGVkSW5kZXhdLnNjcm9sbEludG9WaWV3KHtcbiAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgIGJsb2NrOiBcIm5lYXJlc3RcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdG9nZ2xlRmlsZVNlbGVjdGlvbihmaWxlOiBURmlsZSwgY2FyZEVsOiBIVE1MRWxlbWVudCkge1xuICAgIC8vIENoZWNrIGxpY2Vuc2UgYmVmb3JlIGFsbG93aW5nIHNlbGVjdGlvblxuICAgIGlmIChcbiAgICAgICEoYXdhaXQgTGljZW5zZUNoZWNrZXIuY2hlY2tMaWNlbnNlRm9yRmlsZShmaWxlLCB0aGlzLmFwcCwgdGhpcy5wbHVnaW4pKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuaGFzKGZpbGUpKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRmlsZXMuZGVsZXRlKGZpbGUpO1xuICAgICAgY2FyZEVsLnJlbW92ZUNsYXNzKFwiaXMtYWRkZWRcIik7XG4gICAgICBjYXJkRWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtY29udGV4dC1jaGVja1wiKT8ucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcy5hZGQoZmlsZSk7XG4gICAgICBjYXJkRWwuYWRkQ2xhc3MoXCJpcy1hZGRlZFwiKTtcbiAgICAgIGNvbnN0IGNoZWNrSWNvbiA9IGNhcmRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtY2hlY2tcIiB9KTtcbiAgICAgIHNldEljb24oY2hlY2tJY29uLCBcImNoZWNrXCIpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUFjdGlvbkJ1dHRvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVBY3Rpb25CdXR0b24oKSB7XG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gdGhpcy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuc3lzdGVtc2N1bHB0LWNvbnRleHQtYWN0aW9uLWJ1dHRvblwiXG4gICAgKTtcbiAgICBpZiAoYWN0aW9uQnV0dG9uKSB7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXMuc2VsZWN0ZWRGaWxlcy5zaXplO1xuICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXG4gICAgICAgIGNvdW50ID4gMFxuICAgICAgICAgID8gYEFkZCAke2NvdW50fSBzZWxlY3RlZCBmaWxlJHtjb3VudCA9PT0gMSA/IFwiXCIgOiBcInNcIn1gXG4gICAgICAgICAgOiBcIlNlbGVjdCBmaWxlcyB0byBhZGQgYXMgY29udGV4dFwiXG4gICAgICApO1xuICAgICAgYWN0aW9uQnV0dG9uLnRvZ2dsZUNsYXNzKFwiaXMtYWN0aXZlXCIsIGNvdW50ID4gMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJSZXN1bHRzKHNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxURmlsZT5bXSkge1xuICAgIHRoaXMucmVzdWx0c0NvbnRhaW5lci5lbXB0eSgpO1xuICAgIHRoaXMucmVzdWx0RWxlbWVudHMgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzID0gc2VhcmNoUmVzdWx0cztcblxuICAgIGlmIChzZWFyY2hSZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5lbXB0eVN0YXRlLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgZ3JpZCA9IHRoaXMucmVzdWx0c0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWdyaWRcIixcbiAgICB9KTtcblxuICAgIHNlYXJjaFJlc3VsdHMuZm9yRWFjaCgocmVzdWx0LCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IHRoaXMuY3JlYXRlQ2FyZChyZXN1bHQuaXRlbSwgcmVzdWx0KTtcbiAgICAgIGdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICB0aGlzLnJlc3VsdEVsZW1lbnRzLnB1c2goY2FyZCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFVuaXF1ZUV4dGVuc2lvbnMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGV4dGVuc2lvbnMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICB0aGlzLmZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbikge1xuICAgICAgICBleHRlbnNpb25zLmFkZChmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEN1c3RvbSBzb3J0aW5nOiBNRCBmaXJzdCwgdGhlbiBub24tcHJvLCB0aGVuIHByb1xuICAgIHJldHVybiBBcnJheS5mcm9tKGV4dGVuc2lvbnMpLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIC8vIE1EIGZpbGVzIGFsd2F5cyBjb21lIGZpcnN0XG4gICAgICBpZiAoYSA9PT0gXCJtZFwiKSByZXR1cm4gLTE7XG4gICAgICBpZiAoYiA9PT0gXCJtZFwiKSByZXR1cm4gMTtcblxuICAgICAgY29uc3QgYUlzUHJvID0gTGljZW5zZUNoZWNrZXIucmVxdWlyZXNQcm9MaWNlbnNlKGEpO1xuICAgICAgY29uc3QgYklzUHJvID0gTGljZW5zZUNoZWNrZXIucmVxdWlyZXNQcm9MaWNlbnNlKGIpO1xuXG4gICAgICAvLyBUaGVuIHNvcnQgYnkgcHJvL25vbi1wcm9cbiAgICAgIGlmIChhSXNQcm8gJiYgIWJJc1BybykgcmV0dXJuIDE7XG4gICAgICBpZiAoIWFJc1BybyAmJiBiSXNQcm8pIHJldHVybiAtMTtcblxuICAgICAgLy8gRmluYWxseSBzb3J0IGFscGhhYmV0aWNhbGx5IHdpdGhpbiB0aGVpciBncm91cHNcbiAgICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUV4dGVuc2lvbkJ1dHRvbihleHRlbnNpb246IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBidXR0b24gPSBjcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24tYnV0dG9uXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgaWNvbiBiYXNlZCBvbiBmaWxlIHR5cGVcbiAgICBjb25zdCBpY29uQ29udGFpbmVyID0gYnV0dG9uLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24taWNvblwiLFxuICAgIH0pO1xuXG4gICAgaWYgKFNVUFBPUlRFRF9FWFRFTlNJT05TLmRvY3VtZW50cy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBzZXRJY29uKGljb25Db250YWluZXIsIFwiZmlsZS10ZXh0XCIpO1xuICAgIH0gZWxzZSBpZiAoU1VQUE9SVEVEX0VYVEVOU0lPTlMuaW1hZ2VzLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgXCJpbWFnZVwiKTtcbiAgICB9IGVsc2UgaWYgKFNVUFBPUlRFRF9FWFRFTlNJT05TLmF1ZGlvLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgXCJoZWFkcGhvbmVzXCIpOyAvLyBDaGFuZ2VkIGZyb20gJ2F1ZGlvJyB0byAnaGVhZHBob25lcydcbiAgICB9XG5cbiAgICBidXR0b24uY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBleHRlbnNpb24udG9VcHBlckNhc2UoKSxcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXh0ZW5zaW9uLXRleHRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBwcm8gYmFkZ2UgaWYgbmVlZGVkXG4gICAgaWYgKExpY2Vuc2VDaGVja2VyLnJlcXVpcmVzUHJvTGljZW5zZShleHRlbnNpb24pKSB7XG4gICAgICBjb25zdCBwcm9CYWRnZSA9IGJ1dHRvbi5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24tYmFkZ2UgcHJvLWJhZGdlXCIsXG4gICAgICB9KTtcbiAgICAgIHNldEljb24ocHJvQmFkZ2UsIFwic3BhcmtsZXNcIik7XG4gICAgfVxuXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuaGFzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuZGVsZXRlKGV4dGVuc2lvbik7XG4gICAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcyhcImlzLXNlbGVjdGVkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuYWRkKGV4dGVuc2lvbik7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImlzLXNlbGVjdGVkXCIpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnBlcmZvcm1TZWFyY2godGhpcy5zZWFyY2hJbnB1dC52YWx1ZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9XG5cbiAgcHJpdmF0ZSBwZXJmb3JtU2VhcmNoKHF1ZXJ5OiBzdHJpbmcpIHtcbiAgICBsZXQgcmVzdWx0cyA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICB0aGlzLmZpbGVzLmZpbHRlcihcbiAgICAgICAgKGZpbGUpID0+XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuc2l6ZSA9PT0gMCB8fFxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmhhcyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKVxuICAgICAgKSxcbiAgICAgIHF1ZXJ5LFxuICAgICAgKGZpbGUpID0+IHRoaXMuZ2V0U2VhcmNoRmllbGRzKGZpbGUpXG4gICAgKTtcblxuICAgIHJlc3VsdHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgICAgIHJldHVybiBhLml0ZW0uYmFzZW5hbWUubG9jYWxlQ29tcGFyZShiLml0ZW0uYmFzZW5hbWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yZW5kZXJSZXN1bHRzKHJlc3VsdHMpO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1vZGFsXCIpO1xuXG4gICAgY29uc3Qgc2VhcmNoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2VhcmNoXCIsXG4gICAgfSk7XG4gICAgdGhpcy5zZWFyY2hJbnB1dCA9IHNlYXJjaENvbnRhaW5lci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoIGZpbGVzIHRvIGFkZCBhcyBjb250ZXh0Li4uXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBleHRlbnNpb25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXh0ZW5zaW9uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZXh0ZW5zaW9ucyA9IHRoaXMuZ2V0VW5pcXVlRXh0ZW5zaW9ucygpO1xuICAgIGV4dGVuc2lvbnMuZm9yRWFjaCgoZXh0KSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSB0aGlzLmNyZWF0ZUV4dGVuc2lvbkJ1dHRvbihleHQpO1xuICAgICAgdGhpcy5leHRlbnNpb25CdXR0b25zLnNldChleHQsIGJ1dHRvbik7XG4gICAgICBleHRlbnNpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcbiAgICB9KTtcblxuICAgIC8vIE1hcmsgTUQgYnV0dG9uIGFzIHNlbGVjdGVkIGJ5IGRlZmF1bHRcbiAgICBjb25zdCBtZEJ0biA9IHRoaXMuZXh0ZW5zaW9uQnV0dG9ucy5nZXQoXCJtZFwiKTtcbiAgICBpZiAobWRCdG4pIG1kQnRuLmFkZENsYXNzKFwiaXMtc2VsZWN0ZWRcIik7XG5cbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3IgPSB0aGlzLmNyZWF0ZUxvYWRpbmdJbmRpY2F0b3IoKTtcbiAgICBjb250ZW50RWwuYXBwZW5kQ2hpbGQodGhpcy5sb2FkaW5nSW5kaWNhdG9yKTtcblxuICAgIHRoaXMuZW1wdHlTdGF0ZSA9IHRoaXMuY3JlYXRlRW1wdHlTdGF0ZSgpO1xuICAgIHRoaXMuZW1wdHlTdGF0ZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgY29udGVudEVsLmFwcGVuZENoaWxkKHRoaXMuZW1wdHlTdGF0ZSk7XG5cbiAgICBjb25zdCBzY3JvbGxDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2Nyb2xsLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIHRoaXMucmVzdWx0c0NvbnRhaW5lciA9IHNjcm9sbENvbnRhaW5lci5jcmVhdGVEaXYoKTtcblxuICAgIGNvbnN0IGFjdGlvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1hY3Rpb24tY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhY3Rpb25CdXR0b24gPSBhY3Rpb25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIHRleHQ6IFwiU2VsZWN0IGZpbGVzIHRvIGFkZCBhcyBjb250ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBhY3Rpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgdGhpcy5vblNlbGVjdChBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRGaWxlcykpO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnVwZGF0ZUFjdGlvbkJ1dHRvbigpO1xuXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICB0aGlzLnJlc3VsdHNDb250YWluZXIuZW1wdHkoKTtcblxuICAgIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpO1xuXG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMuc2VhcmNoSW5wdXQpIHJldHVybjtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICBpZiAoZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChlLnNoaWZ0S2V5ICYmIHRoaXMuc2VsZWN0ZWRJbmRleCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9XG4gICAgICAgICAgICAodGhpcy5zZWxlY3RlZEluZGV4IC0gMSArIHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoKSAlXG4gICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPVxuICAgICAgICAgICAgKHRoaXMuc2VsZWN0ZWRJbmRleCArIDEpICUgdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJlc3VsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChlLmNvZGUgPT09IFwiU3BhY2VcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzW3RoaXMuc2VsZWN0ZWRJbmRleF0uaXRlbTtcbiAgICAgICAgY29uc3QgY2FyZEVsID0gdGhpcy5yZXN1bHRFbGVtZW50c1t0aGlzLnNlbGVjdGVkSW5kZXhdO1xuICAgICAgICB0aGlzLnRvZ2dsZUZpbGVTZWxlY3Rpb24oZmlsZSwgY2FyZEVsKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgICB0aGlzLm9uU2VsZWN0KEFycmF5LmZyb20odGhpcy5zZWxlY3RlZEZpbGVzKSk7XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcblxuICAgIHRoaXMucGVyZm9ybVNlYXJjaChcIlwiKTtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAvLyBTSElGVCtUYWIgPT4gZm9jdXMgbGFzdCByZXN1bHRcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gbm9ybWFsIFRhYiA9PiBmb2N1cyBmaXJzdCByZXN1bHRcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnRzW3RoaXMuc2VsZWN0ZWRJbmRleF0uZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUmVzdWx0KCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWFyY2hUaW1lb3V0KSB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5zZWFyY2hUaW1lb3V0KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZWFyY2hUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQudmFsdWU7XG5cbiAgICAgICAgbGV0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgICAgIHRoaXMuZmlsZXMuZmlsdGVyKFxuICAgICAgICAgICAgKGZpbGUpID0+XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLnNpemUgPT09IDAgfHxcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuaGFzKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgKSxcbiAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAoZmlsZSkgPT4gdGhpcy5nZXRTZWFyY2hGaWVsZHMoZmlsZSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgIHJldHVybiBhLml0ZW0uYmFzZW5hbWUubG9jYWxlQ29tcGFyZShiLml0ZW0uYmFzZW5hbWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlbmRlclJlc3VsdHMocmVzdWx0cyk7XG4gICAgICB9LCAxNTApO1xuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBpZiAodGhpcy5zZWFyY2hUaW1lb3V0KSB7XG4gICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoVGltZW91dCk7XG4gICAgfVxuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL3VpXCI7XG5pbXBvcnQgeyBQQVRSRU9OX1VSTCB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgTGljZW5zZUNoZWNrZXIge1xuICBwcml2YXRlIHN0YXRpYyBQUk9fRVhURU5TSU9OUyA9IFtcbiAgICBcInBkZlwiLFxuICAgIFwiZG9jXCIsXG4gICAgXCJkb2N4XCIsXG4gICAgXCJwcHRcIixcbiAgICBcInBwdHhcIixcbiAgICBcInhsc1wiLFxuICAgIFwieGxzeFwiLFxuICAgIFwibXAzXCIsXG4gICAgXCJ3YXZcIixcbiAgICBcIm00YVwiLFxuICAgIFwib2dnXCIsXG4gICAgXCJ3ZWJtXCIsXG4gIF07XG5cbiAgcHVibGljIHN0YXRpYyByZXF1aXJlc1Byb0xpY2Vuc2UoZXh0ZW5zaW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5QUk9fRVhURU5TSU9OUy5pbmNsdWRlcyhleHRlbnNpb24udG9Mb3dlckNhc2UoKSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGhhc1ZhbGlkTGljZW5zZShwbHVnaW46IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBwbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpICYmIHBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQ7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIHNob3dQcm9GZWF0dXJlUG9wdXAoYXBwOiBBcHApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICBhcHAsXG4gICAgICBcIlN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYW5kIHVubG9jayBwb3dlcmZ1bCBkb2N1bWVudCBwcm9jZXNzaW5nIGZlYXR1cmVzLiBVcGdyYWRlIHRvIFBybyB0byBwcm9jZXNzIFBERnMsIFdvcmQgZG9jdW1lbnRzLCBhbmQgYXVkaW8gZmlsZXMuXCIsXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlIFJlcXVpcmVkXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICBpY29uOiBcInNwYXJrbGVzXCIsXG4gICAgICB9XG4gICAgKTtcblxuICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ/LmNvbmZpcm1lZCB8fCBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgY2hlY2tMaWNlbnNlRm9yRmlsZShcbiAgICBmaWxlOiBURmlsZSxcbiAgICBhcHA6IEFwcCxcbiAgICBwbHVnaW46IGFueVxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAodGhpcy5yZXF1aXJlc1Byb0xpY2Vuc2UoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgIGlmICghdGhpcy5oYXNWYWxpZExpY2Vuc2UocGx1Z2luKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnNob3dQcm9GZWF0dXJlUG9wdXAoYXBwKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDaGF0U3RvcmFnZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7IENIQVRfVklFV19UWVBFIH0gZnJvbSBcIi4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5cbmludGVyZmFjZSBDaGF0SGlzdG9yeUl0ZW0ge1xuICBpZDogc3RyaW5nO1xuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICB0aXRsZTogc3RyaW5nO1xuICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU2VhcmNoTWF0Y2gge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIGluZGljZXM6IG51bWJlcltdO1xuICBtYXRjaFF1YWxpdHk6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFNlYXJjaFJlc3VsdDxUPiB7XG4gIGl0ZW06IFQ7XG4gIG1hdGNoZXM6IFNlYXJjaE1hdGNoW107XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBMb2FkQ2hhdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIGNoYXRJdGVtczogQ2hhdEhpc3RvcnlJdGVtW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENoYXRJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChjaGF0SWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjaGF0R3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENhcmRJbmRleDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBjaGF0Q2FyZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBjdXJyZW50U2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PENoYXRIaXN0b3J5SXRlbT5bXSA9IFtdO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGlzS2V5Ym9hcmROYXZBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBjaGF0U3RvcmFnZTogQ2hhdFN0b3JhZ2VTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIG9uU2VsZWN0OiAoY2hhdElkOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgICB0aGlzLmNoYXRTdG9yYWdlID0gbmV3IENoYXRTdG9yYWdlU2VydmljZShcbiAgICAgIGFwcCxcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFNlYXJjaEZpZWxkcyhpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pIHtcbiAgICBjb25zdCBhbGxDb250ZW50ID0gaXRlbS5tZXNzYWdlc1xuICAgICAgLm1hcCgobXNnKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIGNvbnN0IHByb21wdExhYmVsID0gYXdhaXQgdGhpcy5nZXRQcm9tcHRMYWJlbChpdGVtKTtcblxuICAgIC8vIEdldCBhbGwgc2VhcmNoIHRlcm1zIGlmIHRoZXJlJ3MgYSBzZWFyY2hcbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9XG4gICAgICB0aGlzLnNlYXJjaElucHV0Py52YWx1ZT8udG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKSB8fCBbXTtcblxuICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IFtcbiAgICAgIC8vIE1haW4gY29udGVudCBmaWVsZCB3aXRoIGhpZ2hlc3Qgd2VpZ2h0XG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcImNvbnRlbnRcIixcbiAgICAgICAgdGV4dDogYWxsQ29udGVudCxcbiAgICAgICAgd2VpZ2h0OiAyMDAsXG4gICAgICB9LFxuXG4gICAgICAvLyBJbmRpdmlkdWFsIG1lc3NhZ2UgcGFydHMgZm9yIHBhcnRpYWwgbWF0Y2hlc1xuICAgICAgLi4uYWxsQ29udGVudC5zcGxpdCgvW1xcc1xcLTpcXC5dKy8pLm1hcCgocGFydCkgPT4gKHtcbiAgICAgICAgZmllbGQ6IFwiY29udGVudFwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDEwMCxcbiAgICAgIH0pKSxcblxuICAgICAgLy8gTW9kZWwgbmFtZSBhcyBzZWFyY2hhYmxlIGZpZWxkXG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcIm1vZGVsXCIsXG4gICAgICAgIHRleHQ6IGF3YWl0IHRoaXMuZ2V0TW9kZWxOYW1lKGl0ZW0uc2VsZWN0ZWRNb2RlbElkKSxcbiAgICAgICAgd2VpZ2h0OiAxODAsXG4gICAgICB9LFxuXG4gICAgICAvLyBQcm9tcHQgbmFtZSBhcyBzZWFyY2hhYmxlIGZpZWxkXG4gICAgICB7XG4gICAgICAgIGZpZWxkOiBcInByb21wdFwiLFxuICAgICAgICB0ZXh0OiBwcm9tcHRMYWJlbCxcbiAgICAgICAgd2VpZ2h0OiAxODAsXG4gICAgICB9LFxuXG4gICAgICAvLyBJbmRpdmlkdWFsIHByb21wdCBwYXJ0c1xuICAgICAgLi4ucHJvbXB0TGFiZWwuc3BsaXQoL1tcXHNcXC1fXSsvKS5tYXAoKHBhcnQpID0+ICh7XG4gICAgICAgIGZpZWxkOiBcInByb21wdFwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDE1MCxcbiAgICAgIH0pKSxcbiAgICBdO1xuXG4gICAgLy8gSWYgd2UgaGF2ZSBtdWx0aXBsZSBzZWFyY2ggdGVybXMsIGFkZCBhZGRpdGlvbmFsIGZpZWxkcyBmb3IgbXVsdGktdGVybSBtYXRjaGVzXG4gICAgaWYgKHNlYXJjaFRlcm1zLmxlbmd0aCA+IDEpIHtcbiAgICAgIC8vIExvb2sgZm9yIGNvbnNlY3V0aXZlIHRlcm1zXG4gICAgICBjb25zdCBhbGxDb250ZW50TG93ZXIgPSBhbGxDb250ZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlYXJjaFRlcm1zLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICBjb25zdCB0ZXJtMSA9IHNlYXJjaFRlcm1zW2ldO1xuICAgICAgICBjb25zdCB0ZXJtMiA9IHNlYXJjaFRlcm1zW2kgKyAxXTtcblxuICAgICAgICAvLyBGaW5kIGFsbCBvY2N1cnJlbmNlcyBvZiBmaXJzdCB0ZXJtXG4gICAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgICB3aGlsZSAoKHBvcyA9IGFsbENvbnRlbnRMb3dlci5pbmRleE9mKHRlcm0xLCBwb3MpKSAhPT0gLTEpIHtcbiAgICAgICAgICAvLyBMb29rIGZvciBzZWNvbmQgdGVybSB3aXRoaW4gcmVhc29uYWJsZSBkaXN0YW5jZVxuICAgICAgICAgIGNvbnN0IG5leHRQb3MgPSBhbGxDb250ZW50TG93ZXIuaW5kZXhPZih0ZXJtMiwgcG9zKTtcbiAgICAgICAgICBpZiAobmV4dFBvcyAhPT0gLTEgJiYgbmV4dFBvcyAtIChwb3MgKyB0ZXJtMS5sZW5ndGgpIDwgMzApIHtcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgcGhyYXNlIGFzIGEgaGlnaC13ZWlnaHQgZmllbGRcbiAgICAgICAgICAgIHNlYXJjaEZpZWxkcy5wdXNoKHtcbiAgICAgICAgICAgICAgZmllbGQ6IFwiY29udGVudFwiLFxuICAgICAgICAgICAgICB0ZXh0OiBhbGxDb250ZW50LnNsaWNlKHBvcywgbmV4dFBvcyArIHRlcm0yLmxlbmd0aCksXG4gICAgICAgICAgICAgIHdlaWdodDogMzAwLCAvLyBIaWdoZXIgd2VpZ2h0IGZvciBuZWFyYnkgdGVybXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb3MrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzZWFyY2hGaWVsZHM7XG4gIH1cblxuICBwcml2YXRlIGdldE1lc3NhZ2VDb250ZW50KG1lc3NhZ2U6IENoYXRNZXNzYWdlKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG1lc3NhZ2UuY29udGVudDtcbiAgICB9XG4gICAgLy8gRm9yIGltYWdlIGNvbnRlbnQsIHdlJ2xsIHJldHVybiBhIHBsYWNlaG9sZGVyXG4gICAgcmV0dXJuIFwiSW1hZ2UgbWVzc2FnZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSBmaW5kQWxsSW5kaWNlcyh0ZXh0OiBzdHJpbmcsIHNlYXJjaFRlcm06IHN0cmluZyk6IG51bWJlcltdIHtcbiAgICBjb25zdCBpbmRpY2VzOiBudW1iZXJbXSA9IFtdO1xuICAgIGxldCBjdXJyZW50SW5kZXggPSAwO1xuICAgIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKTtcblxuICAgIHdoaWxlIChjdXJyZW50SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgY29uc3QgaW5kZXggPSB0ZXh0LmluZGV4T2Yoc2VhcmNoVGVybSwgY3VycmVudEluZGV4KTtcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIGJyZWFrO1xuICAgICAgaW5kaWNlcy5wdXNoKGluZGV4KTtcbiAgICAgIGN1cnJlbnRJbmRleCA9IGluZGV4ICsgMTsgLy8gTW92ZSBwYXN0IGN1cnJlbnQgbWF0Y2ggdG8gZmluZCBuZXh0XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNZXNzYWdlUHJldmlldyhcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogeyB0ZXh0OiBzdHJpbmc7IHByZXZpZXdTdGFydDogbnVtYmVyIH0ge1xuICAgIC8vIElmIG5vIG1hdGNoZXMsIHNob3cgdGhlIGxhc3QgbWVzc2FnZSBhcyBkZWZhdWx0IHByZXZpZXdcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gbWVzc2FnZXNbbWVzc2FnZXMubGVuZ3RoIC0gMV07XG4gICAgICBpZiAoIWxhc3RNZXNzYWdlKSByZXR1cm4geyB0ZXh0OiBcIlwiLCBwcmV2aWV3U3RhcnQ6IDAgfTtcbiAgICAgIHJldHVybiB7IHRleHQ6IHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobGFzdE1lc3NhZ2UpLCBwcmV2aWV3U3RhcnQ6IDAgfTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIGNvbnRlbnQgbWF0Y2hlc1xuICAgIGNvbnN0IGNvbnRlbnRNYXRjaGVzID0gbWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwiY29udGVudFwiKTtcbiAgICBpZiAoY29udGVudE1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IG1lc3NhZ2VzW21lc3NhZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKCFsYXN0TWVzc2FnZSkgcmV0dXJuIHsgdGV4dDogXCJcIiwgcHJldmlld1N0YXJ0OiAwIH07XG4gICAgICByZXR1cm4geyB0ZXh0OiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KGxhc3RNZXNzYWdlKSwgcHJldmlld1N0YXJ0OiAwIH07XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBtZXNzYWdlIGNvbnRlbnQgd2hlcmUgdGhlIG1hdGNoIG9jY3Vyc1xuICAgIGNvbnN0IGFsbENvbnRlbnQgPSBtZXNzYWdlc1xuICAgICAgLm1hcCgobXNnKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIC8vIEdldCBhbGwgc2VhcmNoIHRlcm1zXG4gICAgY29uc3Qgc2VhcmNoVGVybXMgPVxuICAgICAgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWU/LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbikgfHwgW107XG5cbiAgICAvLyBGaW5kIGFsbCBpbmRpY2VzIGZvciBlYWNoIHNlYXJjaCB0ZXJtXG4gICAgY29uc3QgdGVybUluZGljZXM6IG51bWJlcltdID0gW107XG4gICAgY29uc3QgYWxsQ29udGVudExvd2VyID0gYWxsQ29udGVudC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgc2VhcmNoVGVybXMuZm9yRWFjaCgodGVybSkgPT4ge1xuICAgICAgY29uc3QgaW5kaWNlcyA9IHRoaXMuZmluZEFsbEluZGljZXMoYWxsQ29udGVudExvd2VyLCB0ZXJtKTtcbiAgICAgIHRlcm1JbmRpY2VzLnB1c2goLi4uaW5kaWNlcyk7XG4gICAgfSk7XG5cbiAgICBpZiAodGVybUluZGljZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBGYWxsYmFjayB0byBmaXJzdCBtYXRjaCBpZiBubyB0ZXJtcyBmb3VuZCBkaXJlY3RseVxuICAgICAgY29uc3QgZmlyc3RNYXRjaCA9IGNvbnRlbnRNYXRjaGVzWzBdO1xuICAgICAgdGVybUluZGljZXMucHVzaChmaXJzdE1hdGNoLmluZGljZXNbMF0pO1xuICAgIH1cblxuICAgIC8vIFNvcnQgaW5kaWNlcyB0byBmaW5kIHRoZSBjbG9zZXN0IGNsdXN0ZXIgb2YgbWF0Y2hlc1xuICAgIHRlcm1JbmRpY2VzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcblxuICAgIC8vIEZpbmQgdGhlIGJlc3QgY2x1c3RlciBvZiBtYXRjaGVzIHRoYXQgY29udGFpbnMgYWxsIHNlYXJjaCB0ZXJtc1xuICAgIGNvbnN0IENPTlRFWFRfU0laRSA9IDc1O1xuICAgIGxldCBiZXN0U3RhcnQgPSB0ZXJtSW5kaWNlc1swXTtcbiAgICBsZXQgYmVzdEVuZCA9IHRlcm1JbmRpY2VzWzBdO1xuICAgIGxldCBiZXN0U3BhbiA9IEluZmluaXR5O1xuXG4gICAgLy8gRm9yIGVhY2ggc3RhcnRpbmcgcG9zaXRpb24sIHRyeSB0byBmaW5kIHRoZSBzbWFsbGVzdCB3aW5kb3cgdGhhdCBjb250YWlucyBhbGwgdGVybXNcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRlcm1JbmRpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdGFydCA9IHRlcm1JbmRpY2VzW2ldO1xuICAgICAgY29uc3Qgc2VhcmNoV2luZG93ID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICAgIC8vIExvb2sgYWhlYWQgdG8gZmluZCBhIHdpbmRvdyBjb250YWluaW5nIGFsbCBzZWFyY2ggdGVybXNcbiAgICAgIGZvciAobGV0IGogPSBpOyBqIDwgdGVybUluZGljZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgZW5kID0gdGVybUluZGljZXNbal07XG4gICAgICAgIGNvbnN0IHNwYW4gPSBlbmQgLSBzdGFydDtcblxuICAgICAgICAvLyBBZGQgdGhlIHRlcm0gYXQgdGhpcyBwb3NpdGlvbiB0byBvdXIgd2luZG93XG4gICAgICAgIGNvbnN0IHRlcm1BdFBvc2l0aW9uID0gc2VhcmNoVGVybXMuZmluZCgodGVybSkgPT5cbiAgICAgICAgICBhbGxDb250ZW50TG93ZXIuc2xpY2UodGVybUluZGljZXNbal0pLnN0YXJ0c1dpdGgodGVybSlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRlcm1BdFBvc2l0aW9uKSB7XG4gICAgICAgICAgc2VhcmNoV2luZG93LmFkZCh0ZXJtQXRQb3NpdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGFsbCB0ZXJtcyBhbmQgdGhpcyBzcGFuIGlzIGJldHRlciB0aGFuIG91ciBiZXN0IHNvIGZhclxuICAgICAgICBpZiAoc2VhcmNoV2luZG93LnNpemUgPT09IHNlYXJjaFRlcm1zLmxlbmd0aCAmJiBzcGFuIDwgYmVzdFNwYW4pIHtcbiAgICAgICAgICBiZXN0U3RhcnQgPSBzdGFydDtcbiAgICAgICAgICBiZXN0RW5kID0gZW5kO1xuICAgICAgICAgIGJlc3RTcGFuID0gc3BhbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgcHJldmlldyB3aW5kb3cgYXJvdW5kIHRoZSBiZXN0IGNsdXN0ZXJcbiAgICBjb25zdCBjb250ZXh0U3RhcnQgPSBNYXRoLm1heCgwLCBiZXN0U3RhcnQgLSBDT05URVhUX1NJWkUpO1xuICAgIGNvbnN0IGNvbnRleHRFbmQgPSBNYXRoLm1pbihhbGxDb250ZW50Lmxlbmd0aCwgYmVzdEVuZCArIENPTlRFWFRfU0laRSk7XG5cbiAgICAvLyBGaW5kIGNsZWFuIHdvcmQgYm91bmRhcmllc1xuICAgIGxldCBwcmV2aWV3U3RhcnQgPSBjb250ZXh0U3RhcnQ7XG4gICAgd2hpbGUgKFxuICAgICAgcHJldmlld1N0YXJ0ID4gMCAmJlxuICAgICAgIS9bXFxzLiE/XFxuXS8udGVzdChhbGxDb250ZW50W3ByZXZpZXdTdGFydCAtIDFdKVxuICAgICkge1xuICAgICAgcHJldmlld1N0YXJ0LS07XG4gICAgfVxuXG4gICAgbGV0IHByZXZpZXdFbmQgPSBjb250ZXh0RW5kO1xuICAgIHdoaWxlIChcbiAgICAgIHByZXZpZXdFbmQgPCBhbGxDb250ZW50Lmxlbmd0aCAmJlxuICAgICAgIS9bXFxzLiE/XFxuXS8udGVzdChhbGxDb250ZW50W3ByZXZpZXdFbmRdKVxuICAgICkge1xuICAgICAgcHJldmlld0VuZCsrO1xuICAgIH1cblxuICAgIGxldCBwcmV2aWV3ID0gYWxsQ29udGVudC5zbGljZShwcmV2aWV3U3RhcnQsIHByZXZpZXdFbmQpLnRyaW0oKTtcblxuICAgIC8vIEFkZCBlbGxpcHNpcyBpZiB3ZSdyZSBub3QgYXQgdGhlIHN0YXJ0L2VuZFxuICAgIGlmIChwcmV2aWV3U3RhcnQgPiAwKSBwcmV2aWV3ID0gXCIuLi5cIiArIHByZXZpZXc7XG4gICAgaWYgKHByZXZpZXdFbmQgPCBhbGxDb250ZW50Lmxlbmd0aCkgcHJldmlldyA9IHByZXZpZXcgKyBcIi4uLlwiO1xuXG4gICAgcmV0dXJuIHsgdGV4dDogcHJldmlldywgcHJldmlld1N0YXJ0OiBwcmV2aWV3U3RhcnQgfTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RGF0ZSh0aW1lc3RhbXA6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHRpbWVzdGFtcCkudG9Mb2NhbGVTdHJpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbk5ld0NoYXQoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICAgIC8vIENyZWF0ZSBuZXcgbGVhZiBhbmQgc2V0IGl0IHRvIGNoYXQgdmlld1xuICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKTtcbiAgICBsZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIHN0YXRlOiB7fSxcbiAgICB9KTtcbiAgICAvLyBBY3RpdmF0ZSB0aGUgbmV3IGxlYWZcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGFzeW5jIG9uT3BlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY2hhdC1tb2RhbFwiKTtcblxuICAgIC8vIEFkZCBsb2FkaW5nIHN0YXRlXG4gICAgY29uc3QgbG9hZGluZ0NvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWxvYWRpbmdcIixcbiAgICB9KTtcbiAgICBsb2FkaW5nQ29udGFpbmVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkxvYWRpbmcgY2hhdHMuLi5cIiB9KTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjaGF0cyA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXRzKCk7XG4gICAgICAvLyBTb3J0IGNoYXRzIGJ5IGxhc3QgbW9kaWZpZWQgZGF0ZSAobmV3ZXN0IGZpcnN0KVxuICAgICAgdGhpcy5jaGF0SXRlbXMgPSBjaGF0cy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmNoYXRJdGVtcyA9IFtdO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGxvYWRpbmcgc3RhdGVcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlYXJjaFwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBjaGF0cy4uLlwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcblxuICAgIHRoaXMuY2hhdEdyaWQgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWdyaWRcIiB9KTtcblxuICAgIC8vIEluaXRpYWwgcmVuZGVyIHdpdGggYXN5bmMgc2VhcmNoIGZpZWxkc1xuICAgIGNvbnN0IGluaXRpYWxSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB0aGlzLmNoYXRJdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+ICh7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIG1hdGNoZXM6IFtdLFxuICAgICAgICBzY29yZTogMCxcbiAgICAgIH0pKVxuICAgICk7XG4gICAgYXdhaXQgdGhpcy5yZW5kZXJDaGF0cyhpbml0aWFsUmVzdWx0cyk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQudmFsdWU7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIHRoaXMuY2hhdEl0ZW1zLm1hcChhc3luYyAoaXRlbSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IGF3YWl0IHRoaXMuZ2V0U2VhcmNoRmllbGRzKGl0ZW0pO1xuICAgICAgICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICAgICAgICBbaXRlbV0sXG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgICgpID0+IHNlYXJjaEZpZWxkc1xuICAgICAgICAgIClbMF07XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICBtYXRjaGVzOiBzZWFyY2hSZXN1bHQ/Lm1hdGNoZXMgfHwgW10sXG4gICAgICAgICAgICBzY29yZTogc2VhcmNoUmVzdWx0Py5zY29yZSB8fCAwLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBpZiAoIXF1ZXJ5KSB7XG4gICAgICAgIC8vIFdoZW4gbm8gc2VhcmNoIHF1ZXJ5LCBtYWludGFpbiB0aGUgZGF0ZSBzb3J0IG9yZGVyXG4gICAgICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSByZXN1bHRzLnNvcnQoXG4gICAgICAgICAgKGEsIGIpID0+IGIuaXRlbS5sYXN0TW9kaWZpZWQgLSBhLml0ZW0ubGFzdE1vZGlmaWVkXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRzKHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbHRlciBvdXQgcmVzdWx0cyB3aXRoIG5vIG1hdGNoZXMgb3IgdmVyeSBsb3cgc2NvcmVzXG4gICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcmVzdWx0c1xuICAgICAgICAuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5tYXRjaGVzLmxlbmd0aCA+IDAgJiYgcmVzdWx0LnNjb3JlID4gMClcbiAgICAgICAgLm1hcCgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgbGV0IGZpbmFsU2NvcmUgPSByZXN1bHQuc2NvcmU7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IHJlc3VsdC5pdGVtLm1lc3NhZ2VzXG4gICAgICAgICAgICAubWFwKChtc2c6IENoYXRNZXNzYWdlKSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpXG4gICAgICAgICAgICAuam9pbihcIlxcblwiKVxuICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICBpZiAoY29udGVudC5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgZmluYWxTY29yZSAqPSAyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHdvcmRCb3VuZGFyeU1hdGNoID0gbmV3IFJlZ0V4cChgXFxcXGIke3F1ZXJ5fWAsIFwiaVwiKS50ZXN0KFxuICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdvcmRCb3VuZGFyeU1hdGNoKSB7XG4gICAgICAgICAgICBmaW5hbFNjb3JlICo9IDEuNTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgc2NvcmU6IGZpbmFsU2NvcmUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIFNvcnQgYnkgc2NvcmUgZmlyc3QsIHRoZW4gYnkgZGF0ZSBmb3IgZXF1YWwgc2NvcmVzXG4gICAgICBwcm9jZXNzZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHtcbiAgICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGIuaXRlbS5sYXN0TW9kaWZpZWQgLSBhLml0ZW0ubGFzdE1vZGlmaWVkO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSBwcm9jZXNzZWRSZXN1bHRzO1xuICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRzKHByb2Nlc3NlZFJlc3VsdHMpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwO1xuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSBNYXRoLm1heCgwLCB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IC0gMSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSBNYXRoLm1pbihcbiAgICAgICAgICAgICAgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCArIDFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoID4gMCAmJlxuICAgICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmVcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkQ2FyZCA9IHRoaXMuY2hhdENhcmRzW3RoaXMuc2VsZWN0ZWRDYXJkSW5kZXhdO1xuICAgICAgICBpZiAoc2VsZWN0ZWRDYXJkPy5kYXRhc2V0LmNoYXRJZCkge1xuICAgICAgICAgIHRoaXMub25TZWxlY3Qoc2VsZWN0ZWRDYXJkLmRhdGFzZXQuY2hhdElkKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIHRvIGRpc2FibGUga2V5Ym9hcmQgbmF2aWdhdGlvbiB3aGVuIG1vdXNlIGlzIHVzZWRcbiAgICBjb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIG5ldyBjaGF0IGJ1dHRvbiBjb250YWluZXIgYXQgdGhlIGJvdHRvbVxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgY29uc3QgbmV3Q2hhdEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJPcGVuIE5ldyBDaGF0IEluc3RlYWRcIixcbiAgICB9KTtcbiAgICBuZXdDaGF0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLm9wZW5OZXdDaGF0KCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJDaGF0cyhzZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8Q2hhdEhpc3RvcnlJdGVtPltdKSB7XG4gICAgdGhpcy5jaGF0R3JpZC5lbXB0eSgpO1xuICAgIHRoaXMuY2hhdENhcmRzID0gW107XG4gICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyA9IHNlYXJjaFJlc3VsdHM7XG5cbiAgICBpZiAoc2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1lbXB0eVwiLFxuICAgICAgfSk7XG4gICAgICBlbXB0eVN0YXRlLnNldFRleHQoXG4gICAgICAgIHRoaXMuY2hhdEl0ZW1zLmxlbmd0aCA9PT0gMFxuICAgICAgICAgID8gXCJObyBjaGF0IGhpc3RvcnkgZm91bmQuXCJcbiAgICAgICAgICA6IFwiTm8gY2hhdHMgZm91bmQgbWF0Y2hpbmcgeW91ciBzZWFyY2guXCJcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGNvbnRhaW5lciBmb3IgYWxsIGNoYXRzXG4gICAgY29uc3Qgc2VjdGlvbnNDb250YWluZXIgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtc2VjdGlvbnMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgY2hhdCBjYXJkc1xuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHNlYXJjaFJlc3VsdHMpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVuZGVyQ2hhdENhcmQocmVzdWx0LCBzZWN0aW9uc0NvbnRhaW5lcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRNb2RlbE5hbWUobW9kZWxJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgaWYgKCFtb2RlbHMpIHJldHVybiBtb2RlbElkO1xuXG4gICAgICBjb25zdCBtb2RlbCA9IG1vZGVscy5maW5kKFxuICAgICAgICAobToge1xuICAgICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgICAgaWRlbnRpZmllcj86IHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHN0cmluZztcbiAgICAgICAgICAgIG1vZGVsSWQ6IHN0cmluZztcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lPzogc3RyaW5nO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pID0+XG4gICAgICAgICAgbS5pZCA9PT0gbW9kZWxJZCB8fFxuICAgICAgICAgIChtLmlkZW50aWZpZXIgJiZcbiAgICAgICAgICAgIGAke20uaWRlbnRpZmllci5wcm92aWRlcklkfS8ke20uaWRlbnRpZmllci5tb2RlbElkfWAgPT09IG1vZGVsSWQpXG4gICAgICApO1xuXG4gICAgICBpZiAobW9kZWw/LmlkZW50aWZpZXIpIHtcbiAgICAgICAgcmV0dXJuIG1vZGVsLmlkZW50aWZpZXIuZGlzcGxheU5hbWUgfHwgbW9kZWwuaWRlbnRpZmllci5tb2RlbElkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbW9kZWw/Lm5hbWUgfHwgbW9kZWxJZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgbW9kZWwgbmFtZTpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG1vZGVsSWQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRQcm9tcHRMYWJlbChpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmIChpdGVtLmN1c3RvbVByb21wdEZpbGVQYXRoKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBpdGVtLmN1c3RvbVByb21wdEZpbGVQYXRoLnNwbGl0KFwiL1wiKS5wb3AoKT8ucmVwbGFjZSgvXFwubWQkLywgXCJcIikgfHxcbiAgICAgICAgXCJDdXN0b20gUHJvbXB0XCJcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChpdGVtLnN5c3RlbVByb21wdFR5cGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICBpdGVtLnN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHJldHVybiBwcmVzZXQubGFiZWw7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJEZWZhdWx0XCI7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByZXZpZXcoXG4gICAgcHJldmlldzogSFRNTEVsZW1lbnQsXG4gICAgaXRlbTogQ2hhdEhpc3RvcnlJdGVtLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXVxuICApIHtcbiAgICBjb25zdCB7IHRleHQsIHByZXZpZXdTdGFydCB9ID0gdGhpcy5nZXRNZXNzYWdlUHJldmlldyhcbiAgICAgIGl0ZW0ubWVzc2FnZXMsXG4gICAgICBtYXRjaGVzXG4gICAgKTtcblxuICAgIC8vIEdldCBhbGwgY29udGVudCBtYXRjaGVzIGZvciBoaWdobGlnaHRpbmdcbiAgICBjb25zdCBjb250ZW50TWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcImNvbnRlbnRcIik7XG5cbiAgICBpZiAoY29udGVudE1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gR2V0IHRoZSBhY3R1YWwgc2VhcmNoIHF1ZXJ5IGZyb20gdGhlIHNlYXJjaCBpbnB1dFxuICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB0aGlzLnNlYXJjaElucHV0Py52YWx1ZSB8fCBcIlwiO1xuICAgICAgcHJldmlldy5hcHBlbmRDaGlsZChcbiAgICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLmhpZ2hsaWdodFRleHQodGV4dCwgY29udGVudE1hdGNoZXMsIHNlYXJjaFF1ZXJ5KVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldmlldy5jcmVhdGVTcGFuKHsgdGV4dCB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlckNoYXRDYXJkKFxuICAgIHsgaXRlbSwgbWF0Y2hlcyA9IFtdIH06IFNlYXJjaFJlc3VsdDxDaGF0SGlzdG9yeUl0ZW0+LFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnRcbiAgKSB7XG4gICAgY29uc3QgaXNTZWxlY3RlZCA9XG4gICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgJiZcbiAgICAgIHRoaXMuY2hhdENhcmRzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleDtcblxuICAgIGNvbnN0IGNhcmQgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1jaGF0LWNhcmQgJHtcbiAgICAgICAgaXRlbS5pZCA9PT0gdGhpcy5zZWxlY3RlZENoYXRJZCA/IFwic2VsZWN0ZWRcIiA6IFwiXCJcbiAgICAgIH0gJHtpc1NlbGVjdGVkID8gXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIiA6IFwiXCJ9YCxcbiAgICB9KTtcblxuICAgIGNhcmQuZGF0YXNldC5jaGF0SWQgPSBpdGVtLmlkO1xuICAgIHRoaXMuY2hhdENhcmRzLnB1c2goY2FyZCk7XG5cbiAgICBjb25zdCBoZWFkZXIgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1jYXJkLWhlYWRlclwiIH0pO1xuXG4gICAgY29uc3QgbGVmdENvbnRhaW5lciA9IGhlYWRlci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlci1sZWZ0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgbW9kZWwgYmFkZ2Ugd2l0aCBuYW1lIGluc3RlYWQgb2YgSURcbiAgICBjb25zdCBtb2RlbEJhZGdlID0gbGVmdENvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihtb2RlbEJhZGdlLCBcImJvdFwiKTtcbiAgICBjb25zdCBtb2RlbE5hbWUgPSBhd2FpdCB0aGlzLmdldE1vZGVsTmFtZShpdGVtLnNlbGVjdGVkTW9kZWxJZCk7XG4gICAgY29uc3QgbW9kZWxNYXRjaGVzID0gbWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwibW9kZWxcIik7XG4gICAgaWYgKG1vZGVsTWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICBtb2RlbEJhZGdlLmFwcGVuZENoaWxkKHRoaXMuaGlnaGxpZ2h0VGV4dChtb2RlbE5hbWUsIG1vZGVsTWF0Y2hlcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtb2RlbEJhZGdlLmFwcGVuZFRleHQobW9kZWxOYW1lKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcHJvbXB0IGJhZGdlXG4gICAgY29uc3QgcHJvbXB0QmFkZ2UgPSBsZWZ0Q29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtYmFkZ2VcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHByb21wdEJhZGdlLCBcImNvbW1hbmRcIik7XG4gICAgY29uc3QgcHJvbXB0TGFiZWwgPSBhd2FpdCB0aGlzLmdldFByb21wdExhYmVsKGl0ZW0pO1xuICAgIGNvbnN0IHByb21wdE1hdGNoZXMgPSBtYXRjaGVzLmZpbHRlcigobSkgPT4gbS5maWVsZCA9PT0gXCJwcm9tcHRcIik7XG4gICAgaWYgKHByb21wdE1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgcHJvbXB0QmFkZ2UuYXBwZW5kQ2hpbGQodGhpcy5oaWdobGlnaHRUZXh0KHByb21wdExhYmVsLCBwcm9tcHRNYXRjaGVzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb21wdEJhZGdlLmFwcGVuZFRleHQocHJvbXB0TGFiZWwpO1xuICAgIH1cblxuICAgIC8vIEFkZCBkb2N1bWVudCBjb250ZXh0IGJhZGdlIGlmIHByZXNlbnRcbiAgICBpZiAoaXRlbS5jb250ZXh0X2ZpbGVzICYmIGl0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBkb2NCYWRnZSA9IGxlZnRDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIsXG4gICAgICB9KTtcbiAgICAgIHNldEljb24oZG9jQmFkZ2UsIFwiZmlsZS10ZXh0XCIpO1xuICAgICAgZG9jQmFkZ2UuYXBwZW5kVGV4dChcbiAgICAgICAgYCR7aXRlbS5jb250ZXh0X2ZpbGVzLmxlbmd0aH0gRG9jdW1lbnQke1xuICAgICAgICAgIGl0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwiXG4gICAgICAgIH1gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZpZXcgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlICYmIG1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyB0ZXh0IH0gPSB0aGlzLmdldE1lc3NhZ2VQcmV2aWV3KGl0ZW0ubWVzc2FnZXMsIG1hdGNoZXMpO1xuXG4gICAgICAvLyBHZXQgYWxsIHNlYXJjaCB0ZXJtc1xuICAgICAgY29uc3Qgc2VhcmNoVGVybXMgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKTtcbiAgICAgIGNvbnN0IHRleHRMb3dlciA9IHRleHQudG9Mb3dlckNhc2UoKTtcblxuICAgICAgLy8gRmluZCBhbGwgdGVybSBwb3NpdGlvbnMgaW4gdGhlIHByZXZpZXcgdGV4dFxuICAgICAgY29uc3QgdGVybVBvc2l0aW9uczogQXJyYXk8eyB0ZXJtOiBzdHJpbmc7IGluZGV4OiBudW1iZXIgfT4gPSBbXTtcbiAgICAgIHNlYXJjaFRlcm1zLmZvckVhY2goKHRlcm0pID0+IHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGV4dExvd2VyLmluZGV4T2YodGVybSk7XG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgdGVybVBvc2l0aW9ucy5wdXNoKHsgdGVybSwgaW5kZXggfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBTb3J0IHBvc2l0aW9ucyBieSBpbmRleFxuICAgICAgdGVybVBvc2l0aW9ucy5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7XG5cbiAgICAgIGlmICh0ZXJtUG9zaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGxldCBsYXN0SW5kZXggPSAwO1xuXG4gICAgICAgIC8vIFByb2Nlc3MgZWFjaCB0ZXJtIGluIG9yZGVyXG4gICAgICAgIHRlcm1Qb3NpdGlvbnMuZm9yRWFjaCgoeyB0ZXJtLCBpbmRleCB9KSA9PiB7XG4gICAgICAgICAgLy8gQWRkIHRleHQgYmVmb3JlIHRoaXMgdGVybVxuICAgICAgICAgIGlmIChpbmRleCA+IGxhc3RJbmRleCkge1xuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc2xpY2UobGFzdEluZGV4LCBpbmRleCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCB0ZXJtXG4gICAgICAgICAgY29uc3QgaGlnaGxpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgICAgaGlnaGxpZ2h0LmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXNlYXJjaC1oaWdobGlnaHRcIjtcbiAgICAgICAgICBoaWdobGlnaHQudGV4dENvbnRlbnQgPSB0ZXh0LnNsaWNlKGluZGV4LCBpbmRleCArIHRlcm0ubGVuZ3RoKTtcbiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChoaWdobGlnaHQpO1xuXG4gICAgICAgICAgbGFzdEluZGV4ID0gaW5kZXggKyB0ZXJtLmxlbmd0aDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIGFueSByZW1haW5pbmcgdGV4dFxuICAgICAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByZXZpZXcuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJldmlldy5hcHBlbmRUZXh0KHRleHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBObyBzZWFyY2ggLSBzaG93IGxhc3QgbWVzc2FnZVxuICAgICAgY29uc3QgbGFzdE1lc3NhZ2UgPSBpdGVtLm1lc3NhZ2VzW2l0ZW0ubWVzc2FnZXMubGVuZ3RoIC0gMV07XG4gICAgICBpZiAobGFzdE1lc3NhZ2UpIHtcbiAgICAgICAgcHJldmlldy5hcHBlbmRUZXh0KHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobGFzdE1lc3NhZ2UpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBtZXRhID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtbWV0YVwiIH0pO1xuXG4gICAgY29uc3QgZGF0ZUVsID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWluZm9cIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGRhdGVFbCwgXCJjYWxlbmRhclwiKTtcbiAgICBkYXRlRWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiB0aGlzLmZvcm1hdERhdGUoaXRlbS5sYXN0TW9kaWZpZWQpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWVzc2FnZXNFbCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihtZXNzYWdlc0VsLCBcIm1lc3NhZ2Utc3F1YXJlXCIpO1xuICAgIG1lc3NhZ2VzRWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBgJHtpdGVtLm1lc3NhZ2VzLmxlbmd0aH0gbWVzc2FnZSR7XG4gICAgICAgIGl0ZW0ubWVzc2FnZXMubGVuZ3RoICE9PSAxID8gXCJzXCIgOiBcIlwiXG4gICAgICB9YCxcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aXRsZSBpbmZvXG4gICAgY29uc3QgdGl0bGVFbCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbih0aXRsZUVsLCBcImZpbGVcIik7XG4gICAgdGl0bGVFbC5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IGl0ZW0udGl0bGUsXG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uU2VsZWN0KGl0ZW0uaWQpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW11cbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGNyZWF0ZUZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQpO1xuICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoKTtcblxuICAgIGNvbnN0IGFsbEluZGljZXMgPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICBtYXRjaGVzLmZvckVhY2goKG1hdGNoKSA9PiB7XG4gICAgICBtYXRjaC5pbmRpY2VzLmZvckVhY2goKGlkeCkgPT4gYWxsSW5kaWNlcy5hZGQoaWR4KSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzb3J0ZWRJbmRpY2VzID0gQXJyYXkuZnJvbShhbGxJbmRpY2VzKS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG5cbiAgICBjb25zdCByYW5nZXM6IEFycmF5PFtudW1iZXIsIG51bWJlcl0+ID0gW107XG4gICAgbGV0IHJhbmdlU3RhcnQgPSBzb3J0ZWRJbmRpY2VzWzBdO1xuICAgIGxldCBwcmV2ID0gc29ydGVkSW5kaWNlc1swXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNvcnRlZEluZGljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGN1cnIgPSBzb3J0ZWRJbmRpY2VzW2ldO1xuICAgICAgaWYgKGN1cnIgIT09IHByZXYgKyAxKSB7XG4gICAgICAgIHJhbmdlcy5wdXNoKFtyYW5nZVN0YXJ0LCBwcmV2ICsgMV0pO1xuICAgICAgICByYW5nZVN0YXJ0ID0gY3VycjtcbiAgICAgIH1cbiAgICAgIHByZXYgPSBjdXJyO1xuICAgIH1cblxuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIHJhbmdlcy5mb3JFYWNoKChbc3RhcnQsIGVuZF0pID0+IHtcbiAgICAgIGlmIChzdGFydCA+IGxhc3RJbmRleCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4LCBzdGFydCkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBoaWdobGlnaHRlZFRleHQgPSB0ZXh0LnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgY29uc3Qgc3BhbiA9IGZyYWdtZW50LmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGlnaGxpZ2h0XCIsXG4gICAgICAgIHRleHQ6IGhpZ2hsaWdodGVkVGV4dCxcbiAgICAgIH0pO1xuXG4gICAgICBsYXN0SW5kZXggPSBlbmQ7XG4gICAgfSk7XG5cbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dC5zbGljZShsYXN0SW5kZXgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkQ2FyZCgpIHtcbiAgICB0aGlzLmNoYXRDYXJkcy5mb3JFYWNoKChjYXJkLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ICYmIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSkge1xuICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIik7XG4gICAgICAgIGNhcmQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogXCJzbW9vdGhcIiwgYmxvY2s6IFwibmVhcmVzdFwiIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7XG4gIEFwcCxcbiAgTWVudSxcbiAgTm90aWNlLFxuICBURmlsZSxcbiAgVEZvbGRlcixcbiAgVmF1bHQsXG4gIHNldEljb24sXG4gIE1hcmtkb3duVmlldyxcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1RyYW5zY3JpcHRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL1RleHRNb2RpZmljYXRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5cbi8vIEZvciBhIHR5cGljYWwgT2JzaWRpYW4gcGx1Z2luLCB5b3UnZCBpbml0aWFsaXplIHRoaXMgaW4geW91ciBtYWluIHBsdWdpbiBjbGFzcy5cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdENvbnRleHRNZW51IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzdGF0dXNCYXJJdGVtOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzTW9kYWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NTdGF0dXM6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCdXR0b25zOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gc2N1bHB0U2VydmljZTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dE1lbnUoKTtcbiAgICB0aGlzLmluaXRpYWxpemVTdGF0dXNCYXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVN0YXR1c0JhcigpIHtcbiAgICB0aGlzLnN0YXR1c0Jhckl0ZW0gPSB0aGlzLmFwcC53b3Jrc3BhY2UuY29udGFpbmVyRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLWJhclwiLFxuICAgIH0pO1xuICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ29udGV4dE1lbnUoKSB7XG4gICAgLy8gUmVnaXN0ZXIgdGhlIGVkaXRvciBtZW51IGV2ZW50IGZvciB0ZXh0IG1vZGlmaWNhdGlvblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImVkaXRvci1tZW51XCIsIChtZW51LCBlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgIGlmICghKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIGlmICghc2VsZWN0aW9uKSByZXR1cm47XG5cbiAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtXG4gICAgICAgICAgLnNldFRpdGxlKFwiU3lzdGVtU2N1bHB0IC0gTW9kaWZ5IFRleHRcIilcbiAgICAgICAgICAuc2V0SWNvbihcIndhbmRcIilcbiAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwodGhpcy5hcHAsIHtcbiAgICAgICAgICAgICAgaW5pdGlhbFRleHQ6IHNlbGVjdGlvbixcbiAgICAgICAgICAgICAgb25Nb2RpZnk6IChtb2RpZmllZFRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihtb2RpZmllZFRleHQpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIHRoZSBmaWxlIG1lbnUgZXZlbnQgZm9yIGF1ZGlvIGZpbGVzXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiZmlsZS1tZW51XCIsIChtZW51LCBmaWxlKSA9PiB7XG4gICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIC8vIEFkZCBcIkNoYXQgd2l0aCBGaWxlXCIgZm9yIGFsbCBzdXBwb3J0ZWQgZmlsZSB0eXBlc1xuICAgICAgaWYgKFxuICAgICAgICAvLyBUZXh0IGZpbGVzXG4gICAgICAgIFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSB8fFxuICAgICAgICAvLyBEb2N1bWVudHMgKHdpbGwgYmUgYXV0by1leHRyYWN0ZWQpXG4gICAgICAgIFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiXS5pbmNsdWRlcyhcbiAgICAgICAgICBleHRlbnNpb25cbiAgICAgICAgKSB8fFxuICAgICAgICAvLyBBdWRpbyBmaWxlcyAod2lsbCBiZSBhdXRvLXRyYW5zY3JpYmVkKVxuICAgICAgICBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJtNGFcIiwgXCJvZ2dcIiwgXCJ3ZWJtXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikgfHxcbiAgICAgICAgLy8gSW1hZ2VzIChmb3IgdmlzaW9uIG1vZGVscylcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENoYXQgd2l0aCBGaWxlXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcIm1lc3NhZ2Utc3F1YXJlXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdmlldy5hZGRGaWxlVG9Db250ZXh0KGZpbGUpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gb3BlbiBjaGF0IHdpdGggZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2hhdCBvcGVuIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGF1ZGlvIGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIm1wM1wiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndhdlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndlYm1cIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIFRyYW5zY3JpYmUgQXVkaW9cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwibWljcm9waG9uZVwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQXVkaW9UcmFuc2NyaXB0aW9uKGZpbGUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIHRyYW5zY3JpYmUgYXVkaW8gZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5ldyBtZW51IGl0ZW0gZm9yIHRpbWVzdGFtcGVkIHRyYW5zY3JpcHRpb25cbiAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XG4gICAgICAgICAgaXRlbVxuICAgICAgICAgICAgLnNldFRpdGxlKFwiU3lzdGVtU2N1bHB0IC0gVHJhbnNjcmliZSBBdWRpbyAoVGltZXN0YW1wZWQpXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcImNsb2NrXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oZmlsZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byB0cmFuc2NyaWJlIGF1ZGlvIGZpbGUgd2l0aCB0aW1lc3RhbXBzXCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaW1lc3RhbXBlZCB0cmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGRvY3VtZW50IGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcInBkZlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcImRvY3hcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJkb2NcIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENvbnZlcnQgdG8gTWFya2Rvd25cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwiZmlsZS10ZXh0XCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVEb2N1bWVudENvbnZlcnNpb24oZmlsZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byBjb252ZXJ0IGRvY3VtZW50XCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEb2N1bWVudCBjb252ZXJzaW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRG9jdW1lbnRDb252ZXJzaW9uKGZpbGU6IFRGaWxlKSB7XG4gICAgdGhpcy5jcmVhdGVQcm9ncmVzc01vZGFsKCk7XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDAsIFwiUHJvY2Vzc2luZyB5b3VyIGRvY3VtZW50Li4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gU21hbGwgZGVsYXkgdG8gZW5zdXJlIHVzZXJzIHNlZSB0aGUgaW5pdGlhbCBwcm9jZXNzaW5nIG1lc3NhZ2VcbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwMCk7XG5cbiAgICAgIC8vIFNob3cgdXBsb2FkIHN0YXR1c1xuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDEwLCBcIlVwbG9hZGluZyBkb2N1bWVudC4uLlwiLCBcInVwbG9hZFwiKTtcblxuICAgICAgLy8gVXBsb2FkIHRoZSBmaWxlXG4gICAgICBjb25zdCB7IGRvY3VtZW50SWQsIHN0YXR1cywgY2FjaGVkIH0gPVxuICAgICAgICBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UudXBsb2FkRG9jdW1lbnQoZmlsZSk7XG5cbiAgICAgIGlmIChjYWNoZWQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDUwLCBcIkZvdW5kIGNhY2hlZCB2ZXJzaW9uXCIsIFwiY2hlY2tcIik7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgICAgZmlsZSxcbiAgICAgICAgICBleHRyYWN0aW9uRGF0YVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgICB0aGlzLnNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDMwLCBcIlByb2Nlc3NpbmcgZG9jdW1lbnQuLi5cIiwgXCJsb2FkZXItMlwiKTtcblxuICAgICAgLy8gUG9sbCBmb3Igc3RhdHVzIHVudGlsIGNvbXBsZXRlZFxuICAgICAgY29uc3QgcG9sbFJlc3VsdCA9IGF3YWl0IHRoaXMucG9sbFVudGlsQ29tcGxldGUoZG9jdW1lbnRJZCk7XG5cbiAgICAgIGlmICghcG9sbFJlc3VsdCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMCwgXCJQcm9jZXNzaW5nIGluY29tcGxldGVcIiwgXCJhbGVydC1jaXJjbGVcIik7XG4gICAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMzAwMCk7XG4gICAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDgwLCBcIkRvd25sb2FkaW5nIHJlc3VsdHMuLi5cIiwgXCJkb3dubG9hZFwiKTtcblxuICAgICAgLy8gRG93bmxvYWQgZXh0cmFjdGlvblxuICAgICAgY29uc3QgZXh0cmFjdGlvbkRhdGEgPSBhd2FpdCB0aGlzLmRvd25sb2FkRXh0cmFjdGlvbihkb2N1bWVudElkKTtcbiAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgIGZpbGUsXG4gICAgICAgIGV4dHJhY3Rpb25EYXRhXG4gICAgICApO1xuXG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgdGhpcy5zaG93Q29tcGxldGlvbkJ1dHRvbnMoZXh0cmFjdGlvblBhdGgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTeXN0ZW1TY3VscHQgZXJyb3JcIiwgZSk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoXG4gICAgICAgIDAsXG4gICAgICAgIGBFcnJvcjogJHtlIGluc3RhbmNlb2YgRXJyb3IgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSl9YCxcbiAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy5zbGVlcCg1MDAwKTtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oXG4gICAgZmlsZTogVEZpbGUsXG4gICAgdGltZXN0YW1wZWQ6IGJvb2xlYW5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNob3dBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCh0aGlzLmFwcCwge1xuICAgICAgICBmaWxlLFxuICAgICAgICB0aW1lc3RhbXBlZCxcbiAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6IGFzeW5jICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAvLyBDcmVhdGUgdGhlIG91dHB1dCBmaWxlXG4gICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lO1xuICAgICAgICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSB0aW1lc3RhbXBlZCA/IFwic3J0XCIgOiBcIm1kXCI7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0UGF0aCA9IGAke1xuICAgICAgICAgICAgZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIlxuICAgICAgICAgIH0vJHtiYXNlTmFtZX0uJHtmaWxlRXh0ZW5zaW9ufWA7XG5cbiAgICAgICAgICAvLyBGb3IgU1JUIGZpbGVzLCB1c2UgcmF3IHRleHQuIEZvciBNRCBmaWxlcywgdGhlIHRleHQgaXMgYWxyZWFkeSBmb3JtYXR0ZWRcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGltZXN0YW1wZWQgPyB0ZXh0IDogdGV4dDtcblxuICAgICAgICAgIC8vIENyZWF0ZSBvciB1cGRhdGUgdGhlIGZpbGVcbiAgICAgICAgICBsZXQgdHJhbnNjcmlwdGlvbkZpbGU6IFRGaWxlO1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChvdXRwdXRQYXRoKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgdHJhbnNjcmlwdGlvbkZpbGUgPSBleGlzdGluZ0ZpbGU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyYW5zY3JpcHRpb25GaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKFxuICAgICAgICAgICAgICBvdXRwdXRQYXRoLFxuICAgICAgICAgICAgICBjb250ZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIE9wZW4gdGhlIHRyYW5zY3JpcHRpb24gZmlsZSBpbiBhIG5ldyBsZWFmXG4gICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUodHJhbnNjcmlwdGlvbkZpbGUpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1ZGlvIHRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcm9ncmVzc01vZGFsKCkge1xuICAgIGlmICh0aGlzLnByb2dyZXNzTW9kYWwpIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NNb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5wcm9ncmVzc01vZGFsLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLW1vZGFsXCI7XG5cbiAgICB0aGlzLnByb2dyZXNzQmFyID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLWJhclwiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLXN0YXR1c1wiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzQnV0dG9ucyA9IHRoaXMucHJvZ3Jlc3NNb2RhbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1idXR0b25zXCJcbiAgICApO1xuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9ncmVzc01vZGFsKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nLCBpY29uOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMucHJvZ3Jlc3NNb2RhbCB8fCAhdGhpcy5wcm9ncmVzc0JhciB8fCAhdGhpcy5wcm9ncmVzc1N0YXR1cylcbiAgICAgIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBgJHtwcm9ncmVzc30lYDtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmVtcHR5KCk7XG4gICAgc2V0SWNvbih0aGlzLnByb2dyZXNzU3RhdHVzLCBpY29uKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmNyZWF0ZVNwYW4oeyB0ZXh0OiBzdGF0dXMgfSk7XG4gIH1cblxuICBwcml2YXRlIHNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnByb2dyZXNzQnV0dG9ucykgcmV0dXJuO1xuXG4gICAgdGhpcy5wcm9ncmVzc0J1dHRvbnMuZW1wdHkoKTtcblxuICAgIC8vIFZpZXcgYnV0dG9uXG4gICAgY29uc3Qgdmlld0J1dHRvbiA9IHRoaXMucHJvZ3Jlc3NCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiVmlldyBSZXN1bHRcIixcbiAgICAgIGNsczogXCJtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgdmlld0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChleHRyYWN0aW9uUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xvc2UgYnV0dG9uXG4gICAgY29uc3QgY2xvc2VCdXR0b24gPSB0aGlzLnByb2dyZXNzQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNsb3NlXCIsXG4gICAgfSk7XG4gICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlUHJvZ3Jlc3NNb2RhbCgpIHtcbiAgICBpZiAodGhpcy5wcm9ncmVzc01vZGFsICYmIHRoaXMucHJvZ3Jlc3NNb2RhbC5wYXJlbnROb2RlKSB7XG4gICAgICB0aGlzLnByb2dyZXNzTW9kYWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICAgIH1cbiAgICB0aGlzLnByb2dyZXNzTW9kYWwgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NTdGF0dXMgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCdXR0b25zID0gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcG9sbFVudGlsQ29tcGxldGUoXG4gICAgZG9jdW1lbnRJZDogc3RyaW5nLFxuICAgIG1heEF0dGVtcHRzID0gMzBcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhBdHRlbXB0czsgaSsrKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtcbiAgICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgICB9JHtTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5ET0NVTUVOVFMuR0VUKGRvY3VtZW50SWQpfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNoZWNrIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvciB8fCBcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYmFzZWQgb24gYXR0ZW1wdCBudW1iZXJcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oMzAgKyAoaSAvIG1heEF0dGVtcHRzKSAqIDUwLCA4MCk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwocHJvZ3Jlc3MsIFwiUHJvY2Vzc2luZyBkb2N1bWVudC4uLlwiLCBcImxvYWRlci0yXCIpO1xuXG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDIwMDApO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGAke1xuICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuRE9DVU1FTlRTLkRPV05MT0FEKGRvY3VtZW50SWQpfWAsXG4gICAgICB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZG93bmxvYWQgZXh0cmFjdGlvbjogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVFeHRyYWN0aW9uUmVzdWx0cyhmaWxlOiBURmlsZSwgZGF0YTogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgIGNvbnN0IGJhc2VOYW1lID0gdGhpcy5zYW5pdGl6ZUZpbGVuYW1lKGZpbGUuYmFzZW5hbWUpO1xuICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCB8fCBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICAvLyBDcmVhdGUgdGhlIHRhcmdldCBmb2xkZXJcbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKTtcblxuICAgIC8vIENyZWF0ZSBleHRyYWN0aW9uIGZpbGUgcGF0aFxuICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKFxuICAgICAgYCR7cGFyZW50UGF0aH0vJHtiYXNlTmFtZX0tZXh0cmFjdGlvbi5tZGBcbiAgICApO1xuXG4gICAgLy8gU2F2ZSB0aGUgZXh0cmFjdGlvbiBjb250ZW50XG4gICAgY29uc3QgY29udGVudCA9IHRoaXMuZm9ybWF0RXh0cmFjdGlvbkNvbnRlbnQoZGF0YSk7XG4gICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGV4dHJhY3Rpb25QYXRoKTtcbiAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZXh0cmFjdGlvblBhdGgsIGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBleHRyYWN0aW9uUGF0aDtcbiAgfVxuXG4gIHByaXZhdGUgc2FuaXRpemVGaWxlbmFtZShmaWxlbmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZmlsZW5hbWUucmVwbGFjZSgvW15hLXpBLVowLTktXyBdL2csIFwiXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVQYXRoKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFxcXC9nLCBcIi9cIikucmVwbGFjZSgvXFwvKy9nLCBcIi9cIik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUZvbGRlcihwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICBpZiAoXG4gICAgICAhKHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChub3JtYWxpemVkUGF0aCkgaW5zdGFuY2VvZiBURm9sZGVyKVxuICAgICkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKG5vcm1hbGl6ZWRQYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEV4dHJhY3Rpb25Db250ZW50KGRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAjICR7ZGF0YS50aXRsZSB8fCBcIkRvY3VtZW50IEV4dHJhY3Rpb25cIn1cblxuJHtkYXRhLmNvbnRlbnQgfHwgXCJcIn1cblxuLS0tXG5FeHRyYWN0ZWQgd2l0aCBTeXN0ZW1TY3VscHRcbmA7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpOiBzdHJpbmcge1xuICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dE1vZGlmaWNhdGlvbk1vZGFsT3B0aW9ucyB7XG4gIGluaXRpYWxUZXh0OiBzdHJpbmc7XG4gIG9uTW9kaWZ5OiAobW9kaWZpZWRUZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBUZXh0TW9kaWZpY2F0aW9uTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgaW5wdXRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIHByZXZpZXdBcmVhOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBtb2RpZnlCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICBwcml2YXRlIG9wdGlvbnM6IFRleHRNb2RpZmljYXRpb25Nb2RhbE9wdGlvbnM7XG4gIHByaXZhdGUgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIGlzR2VuZXJhdGluZyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvcHRpb25zOiBUZXh0TW9kaWZpY2F0aW9uTW9kYWxPcHRpb25zKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuYWlTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShERUZBVUxUX1NFVFRJTkdTLCBhcHApO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtdGV4dC1tb2RpZmljYXRpb24tbW9kYWxcIik7XG5cbiAgICAvLyBDcmVhdGUgaGVhZGVyXG4gICAgY29uc3QgaGVhZGVyRWwgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LW1vZGFsLWhlYWRlclwiKTtcbiAgICBoZWFkZXJFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJNb2RpZnkgVGV4dFwiIH0pO1xuXG4gICAgLy8gQ3JlYXRlIG1haW4gY29udGVudCBhcmVhIHdpdGggc3BsaXQgdmlld1xuICAgIGNvbnN0IG1haW5Db250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgLy8gTGVmdCBzaWRlIC0gSW5wdXRcbiAgICBjb25zdCBpbnB1dFNlY3Rpb24gPSBtYWluQ29udGVudC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtaW5wdXQtc2VjdGlvblwiKTtcbiAgICBjb25zdCBpbnB1dExhYmVsID0gaW5wdXRTZWN0aW9uLmNyZWF0ZUVsKFwibGFiZWxcIiwge1xuICAgICAgdGV4dDogXCJNb2RpZmljYXRpb24gSW5zdHJ1Y3Rpb25zXCIsXG4gICAgfSk7XG4gICAgdGhpcy5pbnB1dEFyZWEgPSBpbnB1dFNlY3Rpb24uY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIGluc3RydWN0aW9ucyBmb3IgaG93IHRvIG1vZGlmeSB0aGUgdGV4dC4uLlwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFJpZ2h0IHNpZGUgLSBQcmV2aWV3XG4gICAgY29uc3QgcHJldmlld1NlY3Rpb24gPSBtYWluQ29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcmV2aWV3LXNlY3Rpb25cIlxuICAgICk7XG4gICAgY29uc3QgcHJldmlld0xhYmVsID0gcHJldmlld1NlY3Rpb24uY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUHJldmlld1wiIH0pO1xuICAgIHRoaXMucHJldmlld0FyZWEgPSBwcmV2aWV3U2VjdGlvbi5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtcHJldmlldy1jb250ZW50XCIpO1xuICAgIHRoaXMucHJldmlld0FyZWEuc2V0VGV4dCh0aGlzLm9wdGlvbnMuaW5pdGlhbFRleHQpO1xuXG4gICAgLy8gRm9vdGVyIHdpdGggYnV0dG9uc1xuICAgIGNvbnN0IGZvb3RlckVsID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1tb2RhbC1mb290ZXJcIik7XG5cbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBmb290ZXJFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICB9KTtcbiAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG5cbiAgICB0aGlzLm1vZGlmeUJ1dHRvbiA9IGZvb3RlckVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICAgIHRleHQ6IFwiTW9kaWZ5XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgdGhpcy5tb2RpZnlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuaGFuZGxlTW9kaWZ5KCkpO1xuXG4gICAgLy8gRm9jdXMgaW5wdXRcbiAgICB0aGlzLmlucHV0QXJlYS5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVNb2RpZnkoKSB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nIHx8ICF0aGlzLmlucHV0QXJlYS52YWx1ZS50cmltKCkpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLm1vZGlmeUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBzZXRJY29uKHRoaXMubW9kaWZ5QnV0dG9uLCBcImxvYWRlci0yXCIpO1xuICAgICAgdGhpcy5tb2RpZnlCdXR0b24uYWRkQ2xhc3MoXCJsb2FkaW5nXCIpO1xuXG4gICAgICAvLyBHZXQgdGhlIG1vZGlmaWNhdGlvbiBpbnN0cnVjdGlvbnMgYW5kIHRleHRcbiAgICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IHRoaXMuaW5wdXRBcmVhLnZhbHVlLnRyaW0oKTtcbiAgICAgIGNvbnN0IHRleHRUb01vZGlmeSA9IHRoaXMub3B0aW9ucy5pbml0aWFsVGV4dDtcblxuICAgICAgLy8gQ3JlYXRlIGEgdmFyaWFibGUgdG8gc3RvcmUgdGhlIG1vZGlmaWVkIHRleHRcbiAgICAgIGxldCBtb2RpZmllZFRleHQgPSBcIlwiO1xuXG4gICAgICAvLyBTdHJlYW0gdGhlIHJlc3BvbnNlIGZyb20gdGhlIEFJIHNlcnZpY2VcbiAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgdGhpcy5haVNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogdGV4dFRvTW9kaWZ5LCBtZXNzYWdlX2lkOiBnZW5lcmF0ZVVVSUQoKSB9LFxuICAgICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IGluc3RydWN0aW9ucywgbWVzc2FnZV9pZDogZ2VuZXJhdGVVVUlEKCkgfSxcbiAgICAgICAgXSxcbiAgICAgICAgbW9kZWw6IFwibGxhbWEtMy4zLTcwYi12ZXJzYXRpbGVcIixcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZTogXCJ0ZXh0X21vZGlmaWNhdGlvblwiLFxuICAgICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoYEZhaWxlZCB0byBtb2RpZnkgdGV4dDogJHtlcnJvcn1gLCBcImVycm9yXCIpO1xuICAgICAgICB9LFxuICAgICAgfSkpIHtcbiAgICAgICAgbW9kaWZpZWRUZXh0ICs9IGNodW5rO1xuICAgICAgICB0aGlzLnByZXZpZXdBcmVhLnNldFRleHQobW9kaWZpZWRUZXh0KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsbCB0aGUgY2FsbGJhY2sgd2l0aCB0aGUgbW9kaWZpZWQgdGV4dFxuICAgICAgdGhpcy5vcHRpb25zLm9uTW9kaWZ5KG1vZGlmaWVkVGV4dCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUZXh0IG1vZGlmaWNhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byBtb2RpZnkgdGV4dC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIiwgXCJlcnJvclwiKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMubW9kaWZ5QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm1vZGlmeUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgdGhpcy5tb2RpZnlCdXR0b24uc2V0VGV4dChcIk1vZGlmeVwiKTtcbiAgICAgIHRoaXMubW9kaWZ5QnV0dG9uLnJlbW92ZUNsYXNzKFwibG9hZGluZ1wiKTtcbiAgICB9XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIFNldHRpbmdzTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBERUZBVUxUX1NFVFRJTkdTO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSBhd2FpdCB0aGlzLnBsdWdpbi5sb2FkRGF0YSgpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBsb2FkZWREYXRhKTtcblxuICAgIC8vIEVuc3VyZSBzZXJ2ZXIgVVJMIG1hdGNoZXMgZGV2ZWxvcG1lbnQgbW9kZVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy5zZXJ2ZXJVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldHRpbmdzLnNlcnZlclVybCA9IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB0aGlzLnBsdWdpbi5haVNlcnZpY2UudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBnZXRTZXR0aW5ncygpOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTZXR0aW5ncyhuZXdTZXR0aW5nczogUGFydGlhbDxTeXN0ZW1TY3VscHRTZXR0aW5ncz4pIHtcbiAgICAvLyBGb3IgYSBjb21wbGV0ZSByZXNldCB0byBkZWZhdWx0cywgcmVwbGFjZSBlbnRpcmUgc2V0dGluZ3Mgb2JqZWN0XG4gICAgaWYgKG5ld1NldHRpbmdzID09PSBERUZBVUxUX1NFVFRJTkdTKSB7XG4gICAgICB0aGlzLnNldHRpbmdzID0geyAuLi5ERUZBVUxUX1NFVFRJTkdTIH07XG4gICAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEZvciBwYXJ0aWFsIHVwZGF0ZXMsIG1lcmdlIHdpdGggZXhpc3Rpbmcgc2V0dGluZ3NcbiAgICBpZiAobmV3U2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG5ld1NldHRpbmdzLnNlcnZlclVybCA9IG5ld1NldHRpbmdzLmRldmVsb3BtZW50TW9kZVxuICAgICAgICA/IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCJcbiAgICAgICAgOiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb21cIjtcbiAgICB9XG4gICAgdGhpcy5zZXR0aW5ncyA9IHsgLi4udGhpcy5zZXR0aW5ncywgLi4ubmV3U2V0dGluZ3MgfTtcbiAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi91aVwiO1xuXG5leHBvcnQgY2xhc3MgTGljZW5zZU1hbmFnZXIge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGFwcDogQXBwO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBhcHA6IEFwcCkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGVMaWNlbnNlS2V5KGZvcmNlID0gZmFsc2UpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXkpIHtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnBsdWdpbi5haVNlcnZpY2UudmFsaWRhdGVMaWNlbnNlKGZvcmNlKTtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGlzVmFsaWQ7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTGljZW5zZSB2YWxpZGF0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPSBmYWxzZTtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFRGaWxlLCBURm9sZGVyLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuXG5leHBvcnQgY2xhc3MgSmFuaXRvck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVNpemUoZmlsZXM6IFRGaWxlW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IHRvdGFsQnl0ZXMgPSBmaWxlcy5yZWR1Y2UoKGFjYywgZmlsZSkgPT4gYWNjICsgZmlsZS5zdGF0LnNpemUsIDApO1xuICAgIGlmICh0b3RhbEJ5dGVzID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJlbXB0eVwiO1xuICAgIH0gZWxzZSBpZiAodG90YWxCeXRlcyA8IDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHt0b3RhbEJ5dGVzfSBieXRlc2A7XG4gICAgfSBlbHNlIGlmICh0b3RhbEJ5dGVzIDwgMTAyNCAqIDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHsodG90YWxCeXRlcyAvIDEwMjQpLnRvRml4ZWQoMSl9IEtCYDtcbiAgICB9IGVsc2UgaWYgKHRvdGFsQnl0ZXMgPCAxMDI0ICogMTAyNCAqIDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHsodG90YWxCeXRlcyAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSl9IE1CYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gKDEwMjQgKiAxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSl9IEdCYDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEZpbGVzSW5EaXJlY3RvcnkoZGlyZWN0b3J5OiBzdHJpbmcpOiBURmlsZVtdIHtcbiAgICByZXR1cm4gdGhpcy5hcHAudmF1bHRcbiAgICAgIC5nZXRGaWxlcygpXG4gICAgICAuZmlsdGVyKChmaWxlKSA9PiBmaWxlLnBhdGguc3RhcnRzV2l0aChkaXJlY3RvcnkpKTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzYWJsZUJ1dHRvbihidXR0b246IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBidXR0b24uYWRkQ2xhc3MoXCJtb2QtZGlzYWJsZWRcIik7XG4gICAgYnV0dG9uLnJlbW92ZUNsYXNzKFwibW9kLXdhcm5pbmdcIik7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUJ1dHRvblN0YXRlKFxuICAgIGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQsXG4gICAgZmlsZXM6IFRGaWxlW10sXG4gICAgdHlwZTogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IHNpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoZmlsZXMpO1xuICAgIGNvbnN0IGhhc0ZpbGVzID0gZmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGlmIChoYXNGaWxlcykge1xuICAgICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJtb2QtZGlzYWJsZWRcIik7XG4gICAgICBidXR0b24uYWRkQ2xhc3MoXCJtb2Qtd2FybmluZ1wiKTtcbiAgICAgIGJ1dHRvbi5zZXRUZXh0KGBDbGVhciBBbGwgJHt0eXBlfSAoJHtzaXplfSlgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcyhcIm1vZC13YXJuaW5nXCIpO1xuICAgICAgYnV0dG9uLnNldFRleHQoYE5vICR7dHlwZX1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNsZWFuRGlyZWN0b3J5KGRpcmVjdG9yeTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRlbGV0aW9uIG9mIHJvb3Qgb3Igc3lzdGVtIGRpcmVjdG9yaWVzXG4gICAgaWYgKFxuICAgICAgIWRpcmVjdG9yeSB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi9cIiB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi5cIiB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi4uXCJcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBkZWxldGUgcm9vdCBvciBzeXN0ZW0gZGlyZWN0b3JpZXNcIik7XG4gICAgfVxuXG4gICAgLy8gR2V0IGFsbCBmaWxlcyBpbiB0aGUgZGlyZWN0b3J5XG4gICAgY29uc3QgZmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoZGlyZWN0b3J5KTtcblxuICAgIC8vIE1vdmUgZmlsZXMgdG8gdHJhc2hcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZpbGUsIHRydWUpO1xuICAgIH1cblxuICAgIC8vIEFmdGVyIGZpbGVzIGFyZSBtb3ZlZCB0byB0cmFzaCwgY2xlYW4gdXAgZW1wdHkgZGlyZWN0b3JpZXNcbiAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZGlyZWN0b3J5KTtcbiAgICBpZiAoZm9sZGVyIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgLy8gR2V0IGFsbCBzdWJkaXJlY3Rvcmllc1xuICAgICAgY29uc3Qgc3ViZGlycyA9IGZvbGRlci5jaGlsZHJlblxuICAgICAgICAuZmlsdGVyKChjaGlsZCk6IGNoaWxkIGlzIFRGb2xkZXIgPT4gY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5wYXRoLmxlbmd0aCAtIGEucGF0aC5sZW5ndGgpOyAvLyBTb3J0IGJ5IHBhdGggbGVuZ3RoIGRlc2NlbmRpbmcgdG8gZGVsZXRlIGRlZXBlc3QgZmlyc3RcblxuICAgICAgLy8gRGVsZXRlIHN1YmRpcmVjdG9yaWVzIGlmIHRoZXkncmUgZW1wdHlcbiAgICAgIGZvciAoY29uc3Qgc3ViZGlyIG9mIHN1YmRpcnMpIHtcbiAgICAgICAgaWYgKHN1YmRpci5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC50cmFzaChzdWJkaXIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSB0aGUgbWFpbiBkaXJlY3RvcnkgaWYgaXQncyBlbXB0eVxuICAgICAgaWYgKGZvbGRlci5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZm9sZGVyLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3dGaWxlUHJldmlldyhmaWxlczogVEZpbGVbXSwgdHlwZTogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LWZpbGUtdHJlZSBuYXYtZm9sZGVyXCI7XG5cbiAgICAvLyBBZGQgc3VtbWFyeSB0ZXh0XG4gICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3VtbWFyeS5jbGFzc05hbWUgPSBcIm5hdi1mb2xkZXItdGl0bGVcIjtcbiAgICBzdW1tYXJ5LnRleHRDb250ZW50ID0gYCR7ZmlsZXMubGVuZ3RofSAke3R5cGV9ICgke3RoaXMuY2FsY3VsYXRlU2l6ZShcbiAgICAgIGZpbGVzXG4gICAgKX0pYDtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3VtbWFyeSk7XG5cbiAgICAvLyBTb3J0IGZpbGVzIGJ5IHBhdGggZm9yIGJldHRlciBvcmdhbml6YXRpb25cbiAgICBjb25zdCBzb3J0ZWRGaWxlcyA9IGZpbGVzLnNvcnQoKGEsIGIpID0+IGEucGF0aC5sb2NhbGVDb21wYXJlKGIucGF0aCkpO1xuXG4gICAgLy8gR3JvdXAgZmlsZXMgYnkgZGlyZWN0b3J5XG4gICAgY29uc3QgZmlsZXNCeURpciA9IG5ldyBNYXA8c3RyaW5nLCBURmlsZVtdPigpO1xuICAgIGZvciAoY29uc3QgZmlsZSBvZiBzb3J0ZWRGaWxlcykge1xuICAgICAgY29uc3QgZGlyID0gZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIjtcbiAgICAgIGlmICghZmlsZXNCeURpci5oYXMoZGlyKSkge1xuICAgICAgICBmaWxlc0J5RGlyLnNldChkaXIsIFtdKTtcbiAgICAgIH1cbiAgICAgIGZpbGVzQnlEaXIuZ2V0KGRpcik/LnB1c2goZmlsZSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGZpbGUgdHJlZVxuICAgIGZvciAoY29uc3QgW2RpciwgZGlyRmlsZXNdIG9mIGZpbGVzQnlEaXIpIHtcbiAgICAgIGlmIChkaXIpIHtcbiAgICAgICAgY29uc3QgZm9sZGVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZm9sZGVyRGl2LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlclwiO1xuXG4gICAgICAgIGNvbnN0IGZvbGRlclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZm9sZGVyVGl0bGUuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyLXRpdGxlXCI7XG4gICAgICAgIHNldEljb24oZm9sZGVyVGl0bGUsIFwiZm9sZGVyXCIpO1xuICAgICAgICBmb2xkZXJUaXRsZS5jcmVhdGVTcGFuKHsgdGV4dDogZGlyIH0pO1xuICAgICAgICBmb2xkZXJEaXYuYXBwZW5kQ2hpbGQoZm9sZGVyVGl0bGUpO1xuXG4gICAgICAgIGNvbnN0IGZvbGRlckNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJDb250ZW50LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlci1jaGlsZHJlblwiO1xuICAgICAgICBmb2xkZXJEaXYuYXBwZW5kQ2hpbGQoZm9sZGVyQ29udGVudCk7XG5cbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGRpckZpbGVzKSB7XG4gICAgICAgICAgZm9sZGVyQ29udGVudC5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUZpbGVJdGVtKGZpbGUpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmb2xkZXJEaXYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmlsZXMgaW4gcm9vdFxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZGlyRmlsZXMpIHtcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVGaWxlSXRlbShmaWxlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVGaWxlSXRlbShmaWxlOiBURmlsZSk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBmaWxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBmaWxlRGl2LmNsYXNzTmFtZSA9IFwibmF2LWZpbGVcIjtcblxuICAgIGNvbnN0IGZpbGVUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZmlsZVRpdGxlLmNsYXNzTmFtZSA9IFwibmF2LWZpbGUtdGl0bGVcIjtcblxuICAgIC8vIFNldCBhcHByb3ByaWF0ZSBpY29uIGJhc2VkIG9uIGZpbGUgdHlwZVxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IGljb25OYW1lID0gXCJmaWxlXCI7XG4gICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgaWNvbk5hbWUgPSBcImZpbGUtdGV4dFwiO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBbXCJqcGdcIiwgXCJqcGVnXCIsIFwicG5nXCIsIFwiZ2lmXCIsIFwid2VicFwiLCBcInN2Z1wiXS5pbmNsdWRlcyhleHRlbnNpb24pXG4gICAgKSB7XG4gICAgICBpY29uTmFtZSA9IFwiaW1hZ2VcIjtcbiAgICB9IGVsc2UgaWYgKFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiYXVkaW8tbGluZXNcIjtcbiAgICB9IGVsc2UgaWYgKFtcInBkZlwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG4gICAgfVxuICAgIHNldEljb24oZmlsZVRpdGxlLCBpY29uTmFtZSk7XG5cbiAgICAvLyBGaWxlIG5hbWVcbiAgICBmaWxlVGl0bGUuY3JlYXRlU3Bhbih7IHRleHQ6IGZpbGUubmFtZSB9KTtcblxuICAgIC8vIEZpbGUgc2l6ZVxuICAgIGNvbnN0IHNpemVTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgc2l6ZVNwYW4uY2xhc3NOYW1lID0gXCJuYXYtZmlsZS1zaXplXCI7XG4gICAgc2l6ZVNwYW4udGV4dENvbnRlbnQgPSB0aGlzLmNhbGN1bGF0ZVNpemUoW2ZpbGVdKTtcbiAgICBmaWxlVGl0bGUuYXBwZW5kQ2hpbGQoc2l6ZVNwYW4pO1xuXG4gICAgZmlsZURpdi5hcHBlbmRDaGlsZChmaWxlVGl0bGUpO1xuICAgIHJldHVybiBmaWxlRGl2O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgIGZpbGVzOiBURmlsZVtdLFxuICAgIHR5cGU6IHN0cmluZyxcbiAgICBkaXJlY3Rvcnk6IHN0cmluZyxcbiAgICBidXR0b246IEhUTUxCdXR0b25FbGVtZW50XG4gICkge1xuICAgIGNvbnN0IGNvbmZpcm1Nb2RhbCA9IG5ldyBNb2RhbCh0aGlzLmFwcCk7XG4gICAgY29uZmlybU1vZGFsLnRpdGxlRWwuc2V0VGV4dChgQ2xlYXIgJHt0eXBlfWApO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbmZpcm1Nb2RhbC5jb250ZW50RWw7XG4gICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogYFx1MjZBMFx1RkUwRiBXQVJOSU5HOiBUaGUgZm9sbG93aW5nIGZpbGVzIHdpbGwgYmUgbW92ZWQgdG8gdGhlIE9ic2lkaWFuIHRyYXNoLiBZb3UgY2FuIHJlc3RvcmUgdGhlbSBmcm9tIHRoZSB0cmFzaCBpZiBuZWVkZWQuYCxcbiAgICB9KTtcblxuICAgIC8vIEFkZCBmaWxlIHByZXZpZXcgbGlzdFxuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGhpcy5zaG93RmlsZVByZXZpZXcoZmlsZXMsIHR5cGUpKTtcblxuICAgIC8vIEFkZCBidXR0b25zXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIkNhbmNlbFwiIH0pO1xuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY29uZmlybU1vZGFsLmNsb3NlKCkpO1xuXG4gICAgY29uc3QgY29uZmlybUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwibW9kLXdhcm5pbmdcIixcbiAgICAgIHRleHQ6IFwiTW92ZSB0byBUcmFzaFwiLFxuICAgIH0pO1xuICAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xlYW5EaXJlY3RvcnkoZGlyZWN0b3J5KTtcbiAgICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKGJ1dHRvbik7XG4gICAgICAgIGJ1dHRvbi5zZXRUZXh0KGBObyAke3R5cGV9YCk7XG5cbiAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIGBTdWNjZXNzZnVsbHkgbW92ZWQgJHtcbiAgICAgICAgICAgIGZpbGVzLmxlbmd0aFxuICAgICAgICAgIH0gJHt0eXBlLnRvTG93ZXJDYXNlKCl9IGZpbGVzICgke3RoaXMuY2FsY3VsYXRlU2l6ZShcbiAgICAgICAgICAgIGZpbGVzXG4gICAgICAgICAgKX0pIHRvIHRyYXNoYCxcbiAgICAgICAgICB7IHRpdGxlOiBcIlN1Y2Nlc3NcIiB9XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjbGVhcmluZyAke3R5cGUudG9Mb3dlckNhc2UoKX06YCwgZXJyb3IpO1xuICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIGBGYWlsZWQgdG8gY2xlYXIgJHt0eXBlLnRvTG93ZXJDYXNlKCl9YCwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uZmlybU1vZGFsLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICBjb25maXJtTW9kYWwub3BlbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpc0VtcHR5RmlsZShmaWxlOiBURmlsZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIENoZWNrIGZpbGUgc2l6ZSBmaXJzdFxuICAgIGlmIChmaWxlLnN0YXQuc2l6ZSA9PT0gMCkgcmV0dXJuIHRydWU7XG5cbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuXG4gICAgLy8gRm9yIG1hcmtkb3duIGZpbGVzLCBjaGVjayBjb250ZW50XG4gICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAvLyBSZW1vdmUgZnJvbnRtYXR0ZXIgYW5kIGNoZWNrIGlmIHJlbWFpbmluZyBjb250ZW50IGlzIGVtcHR5XG4gICAgICBjb25zdCBjb250ZW50V2l0aG91dEZyb250bWF0dGVyID0gY29udGVudFxuICAgICAgICAucmVwbGFjZSgvXi0tLVtcXHNcXFNdKj8tLS0vLCBcIlwiKVxuICAgICAgICAudHJpbSgpO1xuICAgICAgcmV0dXJuICFjb250ZW50V2l0aG91dEZyb250bWF0dGVyO1xuICAgIH1cblxuICAgIC8vIEZvciBpbWFnZXMgYW5kIGJpbmFyeSBmaWxlcywganVzdCBjaGVjayBzaXplXG4gICAgaWYgKFxuICAgICAgW1xuICAgICAgICBcImpwZ1wiLFxuICAgICAgICBcImpwZWdcIixcbiAgICAgICAgXCJwbmdcIixcbiAgICAgICAgXCJnaWZcIixcbiAgICAgICAgXCJ3ZWJwXCIsXG4gICAgICAgIFwic3ZnXCIsXG4gICAgICAgIFwibXAzXCIsXG4gICAgICAgIFwid2F2XCIsXG4gICAgICAgIFwib2dnXCIsXG4gICAgICAgIFwibTRhXCIsXG4gICAgICBdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICApIHtcbiAgICAgIHJldHVybiBmaWxlLnN0YXQuc2l6ZSA9PT0gMDtcbiAgICB9XG5cbiAgICAvLyBGb3IgZXh0cmFjdGlvbnMsIGNoZWNrIGlmIGl0J3MganVzdCBoZWFkZXJzIG9yIGVycm9yIG1lc3NhZ2VzXG4gICAgaWYgKGZpbGUucGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIikpIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgY29uc3QgaGFzT25seUhlYWRlcnMgPSAhY29udGVudC5yZXBsYWNlKC9eIy4qJC9nbSwgXCJcIikudHJpbSgpO1xuICAgICAgY29uc3QgaGFzRXJyb3JNZXNzYWdlID1cbiAgICAgICAgY29udGVudC5pbmNsdWRlcyhcIkVycm9yIGV4dHJhY3RpbmdcIikgfHxcbiAgICAgICAgY29udGVudC5pbmNsdWRlcyhcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgcmV0dXJuIGhhc09ubHlIZWFkZXJzIHx8IGhhc0Vycm9yTWVzc2FnZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEVtcHR5RmlsZXMoKTogUHJvbWlzZTxURmlsZVtdPiB7XG4gICAgY29uc3QgYWxsRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpO1xuICAgIGNvbnN0IGVtcHR5RmlsZXM6IFRGaWxlW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xuICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFbXB0eUZpbGUoZmlsZSkpIHtcbiAgICAgICAgZW1wdHlGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbXB0eUZpbGVzO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRFbXB0eUZvbGRlcnMoKTogUHJvbWlzZTxURm9sZGVyW10+IHtcbiAgICBjb25zdCBlbXB0eUZvbGRlcnM6IFRGb2xkZXJbXSA9IFtdO1xuICAgIGNvbnN0IGNoZWNrRm9sZGVyID0gKGZvbGRlcjogVEZvbGRlcik6IGJvb2xlYW4gPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgZm9sZGVyIGhhcyBhbnkgbm9uLWVtcHR5IGNoaWxkcmVuXG4gICAgICBjb25zdCBoYXNOb25FbXB0eUNoaWxkcmVuID0gZm9sZGVyLmNoaWxkcmVuLnNvbWUoKGNoaWxkKSA9PiB7XG4gICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkLnN0YXQuc2l6ZSA+IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgIHJldHVybiAhY2hlY2tGb2xkZXIoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWhhc05vbkVtcHR5Q2hpbGRyZW4pIHtcbiAgICAgICAgZW1wdHlGb2xkZXJzLnB1c2goZm9sZGVyKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIGNvbnN0IHJvb3RGb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRSb290KCk7XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiByb290Rm9sZGVyLmNoaWxkcmVuKSB7XG4gICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgIGNoZWNrRm9sZGVyKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZW1wdHlGb2xkZXJzO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1qYW5pdG9yLW1vZGFsXCIpO1xuXG4gICAgLy8gQWRkIHRpdGxlXG4gICAgY29uc3QgdGl0bGVFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIgfSk7XG4gICAgdGl0bGVFbC5zZXRUZXh0KFwiU3lzdGVtU2N1bHB0IEphbml0b3JcIik7XG5cbiAgICAvLyBBZGQgZGVzY3JpcHRpb25cbiAgICBjb25zdCBkZXNjcmlwdGlvbkVsID0gdGl0bGVFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgIH0pO1xuICAgIGRlc2NyaXB0aW9uRWwuc2V0VGV4dChcIkNsZWFuIHVwIGFuZCBvcHRpbWl6ZSB5b3VyIFN5c3RlbVNjdWxwdCB3b3Jrc3BhY2VcIik7XG5cbiAgICAvLyBDcmVhdGUgbWFpbiBjb250ZW50IGNvbnRhaW5lclxuICAgIGNvbnN0IG1haW5Db250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWphbml0b3ItY29udGVudFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHNlY3Rpb25zIGNvbnRhaW5lclxuICAgIGNvbnN0IHNlY3Rpb25zQ29udGFpbmVyID0gbWFpbkNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbnMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgRW1wdHkgQ29udGVudCBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVFbXB0eUNvbnRlbnRTZWN0aW9uKHNlY3Rpb25zQ29udGFpbmVyKTtcblxuICAgIC8vIEFkZCBDaGF0IEhpc3RvcnkgU2VjdGlvblxuICAgIHRoaXMuY3JlYXRlQ2hhdEhpc3RvcnlTZWN0aW9uKHNlY3Rpb25zQ29udGFpbmVyKTtcblxuICAgIC8vIEFkZCBFeHRyYWN0aW9ucyBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVFeHRyYWN0aW9uc1NlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIFJlY29yZGluZ3MgU2VjdGlvblxuICAgIHRoaXMuY3JlYXRlUmVjb3JkaW5nc1NlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVFbXB0eUNvbnRlbnRTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBlbXB0eVNlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkVtcHR5IENvbnRlbnRcIixcbiAgICAgIFwiQ2xlYW4gdXAgZW1wdHkgZmlsZXMgYW5kIGZvbGRlcnNcIlxuICAgICk7XG5cbiAgICBjb25zdCBlbXB0eUZpbGVzID0gYXdhaXQgdGhpcy5nZXRFbXB0eUZpbGVzKCk7XG4gICAgY29uc3QgZW1wdHlGb2xkZXJzID0gYXdhaXQgdGhpcy5nZXRFbXB0eUZvbGRlcnMoKTtcbiAgICBjb25zdCB0b3RhbEVtcHR5ID0gZW1wdHlGaWxlcy5sZW5ndGggKyBlbXB0eUZvbGRlcnMubGVuZ3RoO1xuXG4gICAgY29uc3QgY2xlYXJFbXB0eUJ1dHRvbiA9IGVtcHR5U2VjdGlvbi5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDpcbiAgICAgICAgdG90YWxFbXB0eSA+IDBcbiAgICAgICAgICA/IGBDbGVhciBFbXB0eSBDb250ZW50ICgke3RvdGFsRW1wdHl9IGl0ZW1zKWBcbiAgICAgICAgICA6IFwiTm8gRW1wdHkgQ29udGVudFwiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShjbGVhckVtcHR5QnV0dG9uLCBlbXB0eUZpbGVzLCBcIkVtcHR5IENvbnRlbnRcIik7XG5cbiAgICBpZiAodG90YWxFbXB0eSA+IDApIHtcbiAgICAgIGNsZWFyRW1wdHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyRW1wdHlCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcblxuICAgICAgICAvLyBDcmVhdGUgYSBwcmV2aWV3IHRoYXQgaW5jbHVkZXMgYm90aCBmaWxlcyBhbmQgZm9sZGVyc1xuICAgICAgICBjb25zdCBjb25maXJtTW9kYWwgPSBuZXcgTW9kYWwodGhpcy5hcHApO1xuICAgICAgICBjb25maXJtTW9kYWwudGl0bGVFbC5zZXRUZXh0KFwiQ2xlYXIgRW1wdHkgQ29udGVudFwiKTtcblxuICAgICAgICBjb25zdCBjb250ZW50ID0gY29uZmlybU1vZGFsLmNvbnRlbnRFbDtcbiAgICAgICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtZGVzY3JpcHRpb25cIixcbiAgICAgICAgICB0ZXh0OiBgXHUyNkEwXHVGRTBGIFdBUk5JTkc6IFRoZSBmb2xsb3dpbmcgZW1wdHkgaXRlbXMgd2lsbCBiZSBtb3ZlZCB0byB0aGUgT2JzaWRpYW4gdHJhc2guIFlvdSBjYW4gcmVzdG9yZSB0aGVtIGZyb20gdGhlIHRyYXNoIGlmIG5lZWRlZC5gLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTaG93IGVtcHR5IGZpbGVzXG4gICAgICAgIGlmIChlbXB0eUZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIkVtcHR5IEZpbGVzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLnNob3dGaWxlUHJldmlldyhlbXB0eUZpbGVzLCBcIkVtcHR5IEZpbGVzXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNob3cgZW1wdHkgZm9sZGVyc1xuICAgICAgICBpZiAoZW1wdHlGb2xkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIkVtcHR5IEZvbGRlcnNcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBmb2xkZXJMaXN0ID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1maWxlLXRyZWUgbmF2LWZvbGRlclwiLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZm9yIChjb25zdCBmb2xkZXIgb2YgZW1wdHlGb2xkZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBmb2xkZXJJdGVtID0gZm9sZGVyTGlzdC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICBjbHM6IFwibmF2LWZvbGRlci10aXRsZVwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZXRJY29uKGZvbGRlckl0ZW0sIFwiZm9sZGVyXCIpO1xuICAgICAgICAgICAgZm9sZGVySXRlbS5jcmVhdGVTcGFuKHsgdGV4dDogZm9sZGVyLnBhdGggfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGJ1dHRvbnNcbiAgICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtYnV0dG9uc1wiLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNvbmZpcm1Nb2RhbC5jbG9zZSgpKTtcblxuICAgICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgICBjbHM6IFwibW9kLXdhcm5pbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIk1vdmUgdG8gVHJhc2hcIixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBEZWxldGUgZW1wdHkgZmlsZXMgZmlyc3RcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBlbXB0eUZpbGVzKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZpbGUsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGVuIGRlbGV0ZSBlbXB0eSBmb2xkZXJzIChkZWVwZXN0IGZpcnN0KVxuICAgICAgICAgICAgY29uc3Qgc29ydGVkRm9sZGVycyA9IGVtcHR5Rm9sZGVycy5zb3J0KFxuICAgICAgICAgICAgICAoYSwgYikgPT4gYi5wYXRoLmxlbmd0aCAtIGEucGF0aC5sZW5ndGhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBzb3J0ZWRGb2xkZXJzKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZvbGRlciwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbihjbGVhckVtcHR5QnV0dG9uKTtcbiAgICAgICAgICAgIGNsZWFyRW1wdHlCdXR0b24uc2V0VGV4dChcIk5vIEVtcHR5IENvbnRlbnRcIik7XG5cbiAgICAgICAgICAgIHNob3dQb3B1cChcbiAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgIGBTdWNjZXNzZnVsbHkgbW92ZWQgJHt0b3RhbEVtcHR5fSBlbXB0eSBpdGVtcyB0byB0cmFzaGAsXG4gICAgICAgICAgICAgIHsgdGl0bGU6IFwiU3VjY2Vzc1wiIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjbGVhcmluZyBlbXB0eSBjb250ZW50OlwiLCBlcnJvcik7XG4gICAgICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiRmFpbGVkIHRvIGNsZWFyIGVtcHR5IGNvbnRlbnRcIiwge1xuICAgICAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbmZpcm1Nb2RhbC5jbG9zZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25maXJtTW9kYWwub3BlbigpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDaGF0SGlzdG9yeVNlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGhpc3RvcnlTZWN0aW9uID0gdGhpcy5jcmVhdGVTZWN0aW9uKFxuICAgICAgY29udGFpbmVyLFxuICAgICAgXCJDaGF0IEhpc3RvcnlcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBjaGF0IGhpc3RvcnkgYW5kIGNvbnZlcnNhdGlvbnMgcGVybWFuZW50bHlcIlxuICAgICk7XG5cbiAgICBjb25zdCBjaGF0RmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgY2hhdFNpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoY2hhdEZpbGVzKTtcbiAgICBjb25zdCBoYXNDaGF0RmlsZXMgPSBjaGF0RmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFySGlzdG9yeUJ1dHRvbiA9IGhpc3RvcnlTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNDaGF0RmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIENoYXQgSGlzdG9yeSAoJHtjaGF0U2l6ZX0pYFxuICAgICAgICA6IFwiTm8gQ2hhdCBIaXN0b3J5XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG5cbiAgICB0aGlzLnVwZGF0ZUJ1dHRvblN0YXRlKGNsZWFySGlzdG9yeUJ1dHRvbiwgY2hhdEZpbGVzLCBcIkNoYXQgSGlzdG9yeVwiKTtcblxuICAgIGlmIChoYXNDaGF0RmlsZXMpIHtcbiAgICAgIGNsZWFySGlzdG9yeUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJIaXN0b3J5QnV0dG9uLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIGF3YWl0IHRoaXMuc2hvd0NvbmZpcm1hdGlvbkRpYWxvZyhcbiAgICAgICAgICBjaGF0RmlsZXMsXG4gICAgICAgICAgXCJDaGF0IEhpc3RvcnlcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhckhpc3RvcnlCdXR0b25cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXh0cmFjdGlvbnNTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBleHRyYWN0aW9uc1NlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkRvY3VtZW50IEV4dHJhY3Rpb25zXCIsXG4gICAgICBcIkRlbGV0ZSBhbGwgZXh0cmFjdGVkIGRvY3VtZW50IGNvbnRlbnQgKFBERnMsIGRvY3VtZW50cywgZXRjLilcIlxuICAgICk7XG5cbiAgICBjb25zdCBleHRyYWN0aW9uRmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHRyYWN0aW9uc0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgZXh0cmFjdGlvbnNTaXplID0gdGhpcy5jYWxjdWxhdGVTaXplKGV4dHJhY3Rpb25GaWxlcyk7XG4gICAgY29uc3QgaGFzRXh0cmFjdGlvbkZpbGVzID0gZXh0cmFjdGlvbkZpbGVzLmxlbmd0aCA+IDA7XG5cbiAgICBjb25zdCBjbGVhckV4dHJhY3Rpb25zQnV0dG9uID0gZXh0cmFjdGlvbnNTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNFeHRyYWN0aW9uRmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIEV4dHJhY3Rpb25zICgke2V4dHJhY3Rpb25zU2l6ZX0pYFxuICAgICAgICA6IFwiTm8gRXh0cmFjdGlvbnNcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoXG4gICAgICBjbGVhckV4dHJhY3Rpb25zQnV0dG9uLFxuICAgICAgZXh0cmFjdGlvbkZpbGVzLFxuICAgICAgXCJFeHRyYWN0aW9uc1wiXG4gICAgKTtcblxuICAgIGlmIChoYXNFeHRyYWN0aW9uRmlsZXMpIHtcbiAgICAgIGNsZWFyRXh0cmFjdGlvbnNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyRXh0cmFjdGlvbnNCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgYXdhaXQgdGhpcy5zaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgICAgICAgIGV4dHJhY3Rpb25GaWxlcyxcbiAgICAgICAgICBcIkV4dHJhY3Rpb25zXCIsXG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXh0cmFjdGlvbnNEaXJlY3RvcnksXG4gICAgICAgICAgY2xlYXJFeHRyYWN0aW9uc0J1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZWNvcmRpbmdzU2VjdGlvbihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgcmVjb3JkaW5nc1NlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkF1ZGlvIFJlY29yZGluZ3NcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBhdWRpbyByZWNvcmRpbmdzICh0aGlzIHdvbid0IGFmZmVjdCB0cmFuc2NyaXB0aW9ucylcIlxuICAgICk7XG5cbiAgICBjb25zdCByZWNvcmRpbmdGaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3RvcnlcbiAgICApO1xuICAgIGNvbnN0IHJlY29yZGluZ3NTaXplID0gdGhpcy5jYWxjdWxhdGVTaXplKHJlY29yZGluZ0ZpbGVzKTtcbiAgICBjb25zdCBoYXNSZWNvcmRpbmdGaWxlcyA9IHJlY29yZGluZ0ZpbGVzLmxlbmd0aCA+IDA7XG5cbiAgICBjb25zdCBjbGVhclJlY29yZGluZ3NCdXR0b24gPSByZWNvcmRpbmdzU2VjdGlvbi5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogaGFzUmVjb3JkaW5nRmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIFJlY29yZGluZ3MgKCR7cmVjb3JkaW5nc1NpemV9KWBcbiAgICAgICAgOiBcIk5vIFJlY29yZGluZ3NcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoY2xlYXJSZWNvcmRpbmdzQnV0dG9uLCByZWNvcmRpbmdGaWxlcywgXCJSZWNvcmRpbmdzXCIpO1xuXG4gICAgaWYgKGhhc1JlY29yZGluZ0ZpbGVzKSB7XG4gICAgICBjbGVhclJlY29yZGluZ3NCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyUmVjb3JkaW5nc0J1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuICAgICAgICBhd2FpdCB0aGlzLnNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgICAgICAgcmVjb3JkaW5nRmlsZXMsXG4gICAgICAgICAgXCJSZWNvcmRpbmdzXCIsXG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhclJlY29yZGluZ3NCdXR0b25cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2VjdGlvbihcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgZGVzY3JpcHRpb246IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1qYW5pdG9yLXNlY3Rpb25cIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlciA9IHNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWhlYWRlclwiIH0pO1xuICAgIGhlYWRlci5zZXRUZXh0KHRpdGxlKTtcblxuICAgIGNvbnN0IGRlc2MgPSBzZWN0aW9uLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1kZXNjcmlwdGlvblwiIH0pO1xuICAgIGRlc2Muc2V0VGV4dChkZXNjcmlwdGlvbik7XG5cbiAgICByZXR1cm4gc2VjdGlvbjtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IENoYXRWaWV3IH0gZnJvbSBcIi4uLy4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5pbXBvcnQgeyBKYW5pdG9yTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0phbml0b3JNb2RhbFwiO1xuaW1wb3J0IHsgTG9hZENoYXRNb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvTG9hZENoYXRNb2RhbFwiO1xuXG5leHBvcnQgY2xhc3MgUmliYm9uTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgcmliYm9uIG1hbmFnZXIgYW5kIHJlZ2lzdGVyIGFsbCByaWJib24gaWNvbnNcbiAgICovXG4gIGluaXRpYWxpemUoKSB7XG4gICAgdGhpcy5yZWdpc3RlclJpYmJvbkljb25zKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYWxsIHJpYmJvbiBpY29ucyBpbiB0aGUgY29ycmVjdCBvcmRlcjpcbiAgICogMS4gU3lzdGVtU2N1bHB0IENoYXRcbiAgICogMi4gU3lzdGVtU2N1bHB0IENoYXQgSGlzdG9yeVxuICAgKiAzLiBTeXN0ZW1TY3VscHQgSmFuaXRvclxuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RlclJpYmJvbkljb25zKCkge1xuICAgIC8vIDEuIFN5c3RlbVNjdWxwdCBDaGF0XG4gICAgdGhpcy5wbHVnaW4uYWRkUmliYm9uSWNvbihcbiAgICAgIFwibWVzc2FnZS1zcXVhcmVcIixcbiAgICAgIFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdFwiLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLm9wZW5DaGF0VmlldygpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyAyLiBDaGF0IEhpc3RvcnlcbiAgICB0aGlzLnBsdWdpbi5hZGRSaWJib25JY29uKFxuICAgICAgXCJoaXN0b3J5XCIsXG4gICAgICBcIk9wZW4gU3lzdGVtU2N1bHB0IENoYXQgSGlzdG9yeVwiLFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLm9wZW5DaGF0SGlzdG9yeU1vZGFsKCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIDMuIEphbml0b3JcbiAgICB0aGlzLnBsdWdpbi5hZGRSaWJib25JY29uKFwidHJhc2hcIiwgXCJPcGVuIFN5c3RlbVNjdWxwdCBKYW5pdG9yXCIsICgpID0+IHtcbiAgICAgIHRoaXMub3Blbkphbml0b3JNb2RhbCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gYSBuZXcgU3lzdGVtU2N1bHB0IENoYXQgdmlldyBpbiBhIG5ldyB0YWJcbiAgICovXG4gIHB1YmxpYyBhc3luYyBvcGVuQ2hhdFZpZXcoKSB7XG4gICAgY29uc3QgeyB3b3Jrc3BhY2UgfSA9IHRoaXMuYXBwO1xuICAgIGNvbnN0IGxlYWYgPSB3b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICBjb25zdCB2aWV3ID0gbmV3IENoYXRWaWV3KGxlYWYsIHRoaXMucGx1Z2luKTtcbiAgICBhd2FpdCBsZWFmLm9wZW4odmlldyk7XG4gICAgd29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5IG1vZGFsXG4gICAqL1xuICBwdWJsaWMgb3BlbkNoYXRIaXN0b3J5TW9kYWwoKSB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgTG9hZENoYXRNb2RhbChcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgYXN5bmMgKGNoYXRJZCkgPT4ge1xuICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoXCJ0YWJcIik7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgICAgICBhd2FpdCBsZWFmLm9wZW4odmlldyk7XG4gICAgICAgIGF3YWl0IHZpZXcubG9hZENoYXRCeUlkKGNoYXRJZCk7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICB9LFxuICAgICAgdGhpcy5wbHVnaW5cbiAgICApO1xuICAgIG1vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBTeXN0ZW1TY3VscHQgSmFuaXRvciBtb2RhbFxuICAgKi9cbiAgcHVibGljIG9wZW5KYW5pdG9yTW9kYWwoKSB7XG4gICAgbmV3IEphbml0b3JNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4pLm9wZW4oKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgV29ya3NwYWNlTGVhZiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcsIENIQVRfVklFV19UWVBFIH0gZnJvbSBcIi4uLy4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5pbXBvcnQgeyBSaWJib25NYW5hZ2VyIH0gZnJvbSBcIi4vcmliYm9uc1wiO1xuXG5leHBvcnQgY2xhc3MgVmlld01hbmFnZXIge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIHJpYmJvbk1hbmFnZXI6IFJpYmJvbk1hbmFnZXI7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5yaWJib25NYW5hZ2VyID0gbmV3IFJpYmJvbk1hbmFnZXIocGx1Z2luLCBhcHApO1xuICB9XG5cbiAgaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyVmlldygpO1xuICAgIHRoaXMucmliYm9uTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uTGF5b3V0UmVhZHkoKCkgPT4ge1xuICAgICAgdGhpcy5yZXN0b3JlQ2hhdFZpZXdzKCk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyByZXN0b3JlQ2hhdFZpZXdzKCkge1xuICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoQ0hBVF9WSUVXX1RZUEUpO1xuXG4gICAgaWYgKGxlYXZlcy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgIGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcbiAgICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXcgYXMgQ2hhdFZpZXc7XG4gICAgICBjb25zdCBzdGF0ZSA9IGxlYWYuZ2V0Vmlld1N0YXRlKCk7XG4gICAgICBpZiAoc3RhdGUgJiYgc3RhdGUuc3RhdGUgJiYgc3RhdGUuc3RhdGUuY2hhdElkKSB7XG4gICAgICAgIGF3YWl0IHZpZXcuc2V0U3RhdGUoc3RhdGUuc3RhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyVmlldygpIHtcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlclZpZXcoXG4gICAgICBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pXG4gICAgKTtcbiAgfVxuXG4gIHVubG9hZFZpZXdzKCkge1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5kZXRhY2hMZWF2ZXNPZlR5cGUoQ0hBVF9WSUVXX1RZUEUpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgTWFya2Rvd25WaWV3LCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBSaWJib25NYW5hZ2VyIH0gZnJvbSBcIi4vcmliYm9uc1wiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL01vZGVsU2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSB9IGZyb20gXCIuLi8uLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBJbmxpbmVEaWZmRWRpdG9yIH0gZnJvbSBcIi4uLy4uL2VkaXRvcnMvSW5saW5lRGlmZkVkaXRvclwiO1xuaW1wb3J0IHsgRWRpdG9yVmlldyB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5cbmV4cG9ydCBjbGFzcyBDb21tYW5kTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgcmliYm9uTWFuYWdlcjogUmliYm9uTWFuYWdlcjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgYXBwOiBBcHApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLnJpYmJvbk1hbmFnZXIgPSBuZXcgUmliYm9uTWFuYWdlcihwbHVnaW4sIGFwcCk7XG4gIH1cblxuICByZWdpc3RlckNvbW1hbmRzKCkge1xuICAgIHRoaXMucmVnaXN0ZXJPcGVuVGFza3NGaWxlKCk7XG4gICAgdGhpcy5yZWdpc3RlclRvZ2dsZUF1ZGlvUmVjb3JkZXIoKTtcbiAgICB0aGlzLnJlZ2lzdGVyT3BlbkNoYXQoKTtcbiAgICB0aGlzLnJlZ2lzdGVyT3BlbkNoYXRIaXN0b3J5KCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5KYW5pdG9yKCk7XG4gICAgdGhpcy5yZWdpc3RlclJlbG9hZE9ic2lkaWFuKCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5TZXR0aW5ncygpO1xuICAgIHRoaXMucmVnaXN0ZXJDaGFuZ2VDaGF0TW9kZWwoKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ2hhdFdpdGhGaWxlKCk7XG4gICAgdGhpcy5yZWdpc3RlclN1Z2dlc3RFZGl0cygpO1xuICAgIHRoaXMucmVnaXN0ZXJDbGVhclN1Z2dlc3RlZEVkaXRzKCk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyT3BlblRhc2tzRmlsZSgpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tdGFza3MtZmlsZVwiLFxuICAgICAgbmFtZTogXCJPcGVuIFRhc2tzIEZpbGVcIixcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5vcGVuT3JDcmVhdGVUYXNrc0ZpbGUoKTtcbiAgICAgIH0sXG4gICAgICBob3RrZXlzOiBbeyBtb2RpZmllcnM6IFtcIk1vZFwiXSwga2V5OiBcInRcIiB9XSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJUb2dnbGVBdWRpb1JlY29yZGVyKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwidG9nZ2xlLWF1ZGlvLXJlY29yZGVyXCIsXG4gICAgICBuYW1lOiBcIlRvZ2dsZSBBdWRpbyBSZWNvcmRlclwiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5wbHVnaW4uZ2V0UmVjb3JkZXJTZXJ2aWNlKCkudG9nZ2xlUmVjb3JkaW5nKCk7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIl0sIGtleTogXCJyXCIgfV0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyT3BlbkNoYXQoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1jaGF0XCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IENoYXRcIixcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMucmliYm9uTWFuYWdlci5vcGVuQ2hhdFZpZXcoKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyT3BlbkNoYXRIaXN0b3J5KCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwib3Blbi1jaGF0LWhpc3RvcnlcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICB0aGlzLnJpYmJvbk1hbmFnZXIub3BlbkNoYXRIaXN0b3J5TW9kYWwoKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyT3Blbkphbml0b3IoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1qYW5pdG9yXCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IEphbml0b3JcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucmliYm9uTWFuYWdlci5vcGVuSmFuaXRvck1vZGFsKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlclJlbG9hZE9ic2lkaWFuKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwicmVsb2FkLW9ic2lkaWFuXCIsXG4gICAgICBuYW1lOiBcIlJlbG9hZCBPYnNpZGlhblwiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPcGVuU2V0dGluZ3MoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXN5c3RlbXNjdWxwdC1zZXR0aW5nc1wiLFxuICAgICAgbmFtZTogXCJPcGVuIFN5c3RlbVNjdWxwdCBBSSBTZXR0aW5nc1wiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSBcdTIwMTMgdGhpcyBpcyBhIGtub3duIE9ic2lkaWFuIEFQSSBidWdcbiAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5vcGVuKCk7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5vcGVuVGFiQnlJZCh0aGlzLnBsdWdpbi5tYW5pZmVzdC5pZCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlckNoYW5nZUNoYXRNb2RlbCgpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNoYW5nZS1jaGF0LW1vZGVsXCIsXG4gICAgICBuYW1lOiBcIkNoYW5nZSBDaGF0IE1vZGVsXCIsXG4gICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgY29uc3QgY2hhdFZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShDaGF0Vmlldyk7XG4gICAgICAgIGlmICghY2hhdFZpZXcpIHtcbiAgICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXG4gICAgICAgICAgICAgIFwiWW91IG5lZWQgdG8gYmUgd2l0aGluIGEgU3lzdGVtU2N1bHB0IGNoYXR2aWV3IHRvIGNoYW5nZSB0aGUgbW9kZWwuXCIsXG4gICAgICAgICAgICAgIFwid2FybmluZ1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgY2hhdFZpZXcuZ2V0U2VsZWN0ZWRNb2RlbElkKCksXG4gICAgICAgICAgICAgICAgYXN5bmMgKG1vZGVsSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LnNldFNlbGVjdGVkTW9kZWxJZChtb2RlbElkKTtcbiAgICAgICAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIk1vZGVsIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5XCIsIFwiaW5mb1wiKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIG9wZW4gbW9kZWwgc2VsZWN0aW9uOlwiLCBlcnIpO1xuICAgICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggYXZhaWxhYmxlIG1vZGVsc1wiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlckNoYXRXaXRoRmlsZSgpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNoYXQtd2l0aC1maWxlXCIsXG4gICAgICBuYW1lOiBcIkNoYXQgd2l0aCBGaWxlXCIsXG4gICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgY29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgIGlmICghYWN0aXZlRmlsZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhY3RpdmVGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBzdXBwb3J0ZWRFeHRlbnNpb25zID0gW1xuICAgICAgICAgIFwibWRcIixcbiAgICAgICAgICBcInR4dFwiLFxuICAgICAgICAgIFwibWFya2Rvd25cIixcbiAgICAgICAgICBcInBkZlwiLFxuICAgICAgICAgIFwiZG9jXCIsXG4gICAgICAgICAgXCJkb2N4XCIsXG4gICAgICAgICAgXCJwcHRcIixcbiAgICAgICAgICBcInBwdHhcIixcbiAgICAgICAgICBcInhsc1wiLFxuICAgICAgICAgIFwieGxzeFwiLFxuICAgICAgICAgIFwibXAzXCIsXG4gICAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgICBcIm00YVwiLFxuICAgICAgICAgIFwib2dnXCIsXG4gICAgICAgICAgXCJ3ZWJtXCIsXG4gICAgICAgICAgXCJqcGdcIixcbiAgICAgICAgICBcImpwZWdcIixcbiAgICAgICAgICBcInBuZ1wiLFxuICAgICAgICAgIFwiZ2lmXCIsXG4gICAgICAgICAgXCJ3ZWJwXCIsXG4gICAgICAgICAgXCJzdmdcIixcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKCFzdXBwb3J0ZWRFeHRlbnNpb25zLmluY2x1ZGVzKGV4dGVuc2lvbikpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3IENoYXRWaWV3KGxlYWYsIHRoaXMucGx1Z2luKTtcbiAgICAgICAgICBsZWFmLm9wZW4odmlldykudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGF3YWl0IHZpZXcuYWRkRmlsZVRvQ29udGV4dChhY3RpdmVGaWxlKTtcbiAgICAgICAgICAgIHZpZXcuZm9jdXNJbnB1dCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJTdWdnZXN0RWRpdHMoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJzdWdnZXN0LWVkaXRzXCIsXG4gICAgICBuYW1lOiBcIlN1Z2dlc3QgQUkgRWRpdHMgKElubGluZSBEaWZmKVwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEVkaXRJbnN0cnVjdGlvbnNNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgYXN5bmMgKGluc3RydWN0aW9ucykgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBlZGl0b3IgPSBuZXcgSW5saW5lRGlmZkVkaXRvcihcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICBhY3RpdmVWaWV3LmVkaXRvcixcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBhd2FpdCBlZGl0b3Iuc3VnZ2VzdEVkaXRzKGluc3RydWN0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIiwgXCJTaGlmdFwiXSwga2V5OiBcImVcIiB9XSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDbGVhclN1Z2dlc3RlZEVkaXRzKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2xlYXItc3VnZ2VzdGVkLWVkaXRzXCIsXG4gICAgICBuYW1lOiBcIkNsZWFyIEFsbCBTdWdnZXN0ZWQgRWRpdHNcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICBjb25zdCBlZGl0b3IgPSBuZXcgSW5saW5lRGlmZkVkaXRvcihcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgYWN0aXZlVmlldy5lZGl0b3IsXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgZWRpdG9yLmNsZWFyRGlmZnMoKTtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJDbGVhcmVkIGFsbCBzdWdnZXN0ZWQgZWRpdHNcIiwgXCJpbmZvXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufVxuXG4vLyBNb2RhbCBmb3IgY2FwdHVyaW5nIGVkaXQgaW5zdHJ1Y3Rpb25zIGZyb20gdGhlIHVzZXJcbmNsYXNzIEVkaXRJbnN0cnVjdGlvbnNNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBpbnN0cnVjdGlvbiA9IFwiXCI7XG4gIHByaXZhdGUgb25TdWJtaXQ6IChpbnN0cnVjdGlvbjogc3RyaW5nKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblN1Ym1pdDogKGluc3RydWN0aW9uOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMub25TdWJtaXQgPSBvblN1Ym1pdDtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtZWRpdC1pbnN0cnVjdGlvbnMtbW9kYWxcIik7XG5cbiAgICAvLyBUaXRsZSB3aXRoIGFuIGljb25cbiAgICBjb25zdCB0aXRsZUVsID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJtb2RhbC10aXRsZVwiIH0pO1xuICAgIGNvbnN0IGljb25FbCA9IHRpdGxlRWwuY3JlYXRlU3Bhbih7IGNsczogXCJtb2RhbC1pY29uXCIgfSk7XG4gICAgc2V0SWNvbihpY29uRWwsIFwid2FuZFwiKTtcbiAgICB0aXRsZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkFJIEVkaXQgSW5zdHJ1Y3Rpb25zXCIgfSk7XG5cbiAgICAvLyBEZXNjcmlwdGlvblxuICAgIGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcIm1vZGFsLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBcIkRlc2NyaWJlIGhvdyB5b3UnZCBsaWtlIHRoZSBBSSB0byBtb2RpZnkgdGhpcyB0ZXh0LiBCZSBzcGVjaWZpYyBmb3IgYmV0dGVyIHJlc3VsdHMuXCIsXG4gICAgfSk7XG5cbiAgICAvLyBUZXh0YXJlYSBmb3IgaW5zdHJ1Y3Rpb25zXG4gICAgY29uc3QgdGV4dEFyZWEgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBwbGFjZWhvbGRlcjpcbiAgICAgICAgXCJFeGFtcGxlczpcXG5cdTIwMjIgRml4IGdyYW1tYXIgYW5kIGltcHJvdmUgY2xhcml0eVxcblx1MjAyMiBNYWtlIHRoZSB0b25lIG1vcmUgcHJvZmVzc2lvbmFsXFxuXHUyMDIyIENvbnZlcnQgdGV4dCB0byBidWxsZXQgcG9pbnRzXFxuXHUyMDIyIFJld3JpdGUgYXMgYSBwb2VtXFxuXHUyMDIyIFNpbXBsaWZ5IGNvbXBsZXggc2VudGVuY2VzXCIsXG4gICAgfSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0ZXh0QXJlYS5mb2N1cygpLCAxMCk7XG4gICAgdGV4dEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChlKSA9PiB7XG4gICAgICB0aGlzLmluc3RydWN0aW9uID0gKGUudGFyZ2V0IGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQpLnZhbHVlO1xuICAgIH0pO1xuXG4gICAgLy8gQnV0dG9uc1xuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcIm1vZGFsLWJ1dHRvbi1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcIm1vZGFsLWJ1dHRvbiBtb2RhbC1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgIH0pO1xuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcIm1vZGFsLWJ1dHRvbiBtb2RhbC1idXR0b24tcHJpbWFyeVwiLFxuICAgICAgdGV4dDogXCJTdWdnZXN0IEVkaXRzXCIsXG4gICAgfSk7XG4gICAgc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaW5zdHJ1Y3Rpb24udHJpbSgpKSB7XG4gICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICBcIlBsZWFzZSBwcm92aWRlIGluc3RydWN0aW9ucyBmb3IgdGhlIGVkaXRcIixcbiAgICAgICAgICBcIndhcm5pbmdcIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB0aGlzLm9uU3VibWl0KHRoaXMuaW5zdHJ1Y3Rpb24pO1xuICAgIH0pO1xuXG4gICAgLy8gS2V5Ym9hcmQgc2hvcnRjdXRzXG4gICAgdGhpcy5zY29wZS5yZWdpc3RlcihbXSwgXCJFbnRlclwiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnNoaWZ0S2V5KSB7XG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5pbnN0cnVjdGlvbi50cmltKCkpIHtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgdGhpcy5vblN1Ym1pdCh0aGlzLmluc3RydWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuc2NvcGUucmVnaXN0ZXIoW10sIFwiRXNjYXBlXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIHRoaXMuY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQge1xuICBFZGl0b3JWaWV3LFxuICBEZWNvcmF0aW9uLFxuICBEZWNvcmF0aW9uU2V0LFxuICBXaWRnZXRUeXBlLFxufSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xuaW1wb3J0IHR5cGUgeyBSYW5nZSB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHsgU3RhdGVGaWVsZCwgU3RhdGVFZmZlY3QgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcbmltcG9ydCB7IEFwcCwgRWRpdG9yLCBFZGl0b3JQb3NpdGlvbiwgTm90aWNlLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5cbi8vIEltcG9ydCBkaWZmLW1hdGNoLXBhdGNoIHR5cGVzIChhZGp1c3QgaWYgbmVlZGVkIGZvciBUUylcbmltcG9ydCB7XG4gIGRpZmZfbWF0Y2hfcGF0Y2gsXG4gIERJRkZfREVMRVRFLFxuICBESUZGX0lOU0VSVCxcbiAgRElGRl9FUVVBTCxcbn0gZnJvbSBcImRpZmYtbWF0Y2gtcGF0Y2hcIjtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgVFlQRVMgJiBTVEFURVxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiogUmVwcmVzZW50cyBhIGRpZmYgY2h1bmsgKGEgY29udGlndW91cyBjaGFuZ2UpIGJldHdlZW4gb3JpZ2luYWwgYW5kIG1vZGlmaWVkIHRleHQuICovXG5pbnRlcmZhY2UgRGlmZkNodW5rIHtcbiAgaWQ6IG51bWJlcjtcbiAgdHlwZTogXCJyZXBsYWNlXCIgfCBcImluc2VydFwiIHwgXCJkZWxldGVcIjtcbiAgZnJvbTogRWRpdG9yUG9zaXRpb247XG4gIHRvOiBFZGl0b3JQb3NpdGlvbjtcbiAgbmV3VGV4dD86IHN0cmluZztcbiAgb3JpZ2luYWxUZXh0Pzogc3RyaW5nO1xuICBhcHBsaWVkOiBib29sZWFuO1xuICBsaW5lTnVtYmVyOiBudW1iZXI7XG59XG5cbi8qKiBTdGF0ZSBlZmZlY3QgZm9yIHVwZGF0aW5nIGRpZmYgZGVjb3JhdGlvbnMuICovXG5jb25zdCBzZXREaWZmRWZmZWN0ID0gU3RhdGVFZmZlY3QuZGVmaW5lPERlY29yYXRpb25TZXQ+KCk7XG5cbi8qKlxuICogQSBTdGF0ZUZpZWxkIHRoYXQgaG9sZHMgYW5kIHVwZGF0ZXMgZGlmZiBkZWNvcmF0aW9ucyBpbiB0aGUgZWRpdG9yLlxuICogV2hlbiB0aGUgZG9jdW1lbnQgY2hhbmdlcyAob3IgbmV3IGRpZmYgZGVjb3JhdGlvbnMgYXJlIGRpc3BhdGNoZWQpLFxuICogdGhpcyBmaWVsZCBpcyB1cGRhdGVkIGFjY29yZGluZ2x5LlxuICovXG5leHBvcnQgY29uc3QgZGlmZkZpZWxkID0gU3RhdGVGaWVsZC5kZWZpbmU8RGVjb3JhdGlvblNldD4oe1xuICBjcmVhdGUoKSB7XG4gICAgcmV0dXJuIERlY29yYXRpb24ubm9uZTtcbiAgfSxcbiAgdXBkYXRlKGRlY28sIHRyKSB7XG4gICAgZm9yIChjb25zdCBlZmZlY3Qgb2YgdHIuZWZmZWN0cykge1xuICAgICAgaWYgKGVmZmVjdC5pcyhzZXREaWZmRWZmZWN0KSkge1xuICAgICAgICByZXR1cm4gZWZmZWN0LnZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBVcGRhdGUgZGVjb3JhdGlvbiBwb3NpdGlvbnMgd2hlbiB0aGUgZG9jdW1lbnQgY2hhbmdlcy5cbiAgICByZXR1cm4gdHIuZG9jQ2hhbmdlZCA/IERlY29yYXRpb24ubm9uZSA6IGRlY28ubWFwKHRyLmNoYW5nZXMpO1xuICB9LFxuICBwcm92aWRlOiAoZmllbGQpID0+IEVkaXRvclZpZXcuZGVjb3JhdGlvbnMuZnJvbShmaWVsZCksXG59KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgV0lER0VUU1xuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKipcbiAqIEEgd2lkZ2V0IHNob3duIHdoaWxlIEFJIGVkaXRzIGFyZSBwcm9jZXNzaW5nLlxuICovXG5jbGFzcyBQcm9jZXNzaW5nV2lkZ2V0IGV4dGVuZHMgV2lkZ2V0VHlwZSB7XG4gIHRvRE9NKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcImRpZmYtcHJvY2Vzc2luZ1wiO1xuXG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXJcIjtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG5cbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgdGV4dC50ZXh0Q29udGVudCA9IFwiUHJvY2Vzc2luZyBlZGl0c1x1MjAyNlwiO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0KTtcblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cbn1cblxuLyoqXG4gKiBVbmlmaWVkRGlmZldpZGdldCBcdTIwMTMgcmVuZGVycyBhIGRpZmYgY2h1bmsgaW4gYSB1bmlmaWVkIGRpZmYgc3R5bGUuXG4gKi9cbmNsYXNzIFVuaWZpZWREaWZmV2lkZ2V0IGV4dGVuZHMgV2lkZ2V0VHlwZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2h1bms6IERpZmZDaHVuaywgcHJpdmF0ZSBlZGl0b3I6IElubGluZURpZmZFZGl0b3IpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRUZXh0KHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gT25seSB0cmltIHRyYWlsaW5nIHNwYWNlcyBidXQgcHJlc2VydmUgYWxsIGxpbmVzIGluY2x1ZGluZyBlbXB0eSBvbmVzXG4gICAgcmV0dXJuIHRleHRcbiAgICAgIC5zcGxpdChcIlxcblwiKVxuICAgICAgLm1hcCgobGluZSkgPT4gbGluZS50cmltRW5kKCkpXG4gICAgICAuam9pbihcIlxcblwiKTtcbiAgfVxuXG4gIHRvRE9NKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInVuaWZpZWQtZGlmZi1jaHVua1wiO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgZGlmZiBsaW5lc1xuICAgIGNvbnN0IGRpZmZMaW5lcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZGlmZkxpbmVzLmNsYXNzTmFtZSA9IFwiZGlmZi1saW5lc1wiO1xuXG4gICAgLy8gRm9yIGEgZGVsZXRpb24sIGRpc3BsYXkgdGhlIG9yaWdpbmFsIHRleHQgd2l0aCBhIFwiXHUyMDEzXCIgcHJlZml4XG4gICAgaWYgKHRoaXMuY2h1bmsudHlwZSA9PT0gXCJkZWxldGVcIiAmJiB0aGlzLmNodW5rLm9yaWdpbmFsVGV4dCkge1xuICAgICAgY29uc3QgbGluZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGxpbmVFbC5jbGFzc05hbWUgPSBcImRpZmYtbGluZSBkaWZmLW9sZFwiO1xuICAgICAgbGluZUVsLnRleHRDb250ZW50ID0gYC0gJHt0aGlzLmZvcm1hdFRleHQodGhpcy5jaHVuay5vcmlnaW5hbFRleHQpfWA7XG4gICAgICBkaWZmTGluZXMuYXBwZW5kQ2hpbGQobGluZUVsKTtcbiAgICB9XG4gICAgLy8gRm9yIGFuIGluc2VydGlvbiwgZGlzcGxheSB0aGUgbmV3IHRleHQgd2l0aCBhIFwiK1wiIHByZWZpeFxuICAgIGVsc2UgaWYgKHRoaXMuY2h1bmsudHlwZSA9PT0gXCJpbnNlcnRcIiAmJiB0aGlzLmNodW5rLm5ld1RleHQpIHtcbiAgICAgIGNvbnN0IGxpbmVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBsaW5lRWwuY2xhc3NOYW1lID0gXCJkaWZmLWxpbmUgZGlmZi1uZXdcIjtcbiAgICAgIGxpbmVFbC50ZXh0Q29udGVudCA9IGArICR7dGhpcy5mb3JtYXRUZXh0KHRoaXMuY2h1bmsubmV3VGV4dCl9YDtcbiAgICAgIGRpZmZMaW5lcy5hcHBlbmRDaGlsZChsaW5lRWwpO1xuICAgIH1cbiAgICAvLyBGb3IgYSByZXBsYWNlbWVudCwgc2hvdyBib3RoIG9sZCBhbmQgbmV3XG4gICAgZWxzZSBpZiAodGhpcy5jaHVuay50eXBlID09PSBcInJlcGxhY2VcIikge1xuICAgICAgY29uc3Qgb2xkVGV4dCA9XG4gICAgICAgIHRoaXMuY2h1bmsub3JpZ2luYWxUZXh0ICYmIHRoaXMuZm9ybWF0VGV4dCh0aGlzLmNodW5rLm9yaWdpbmFsVGV4dCk7XG4gICAgICBjb25zdCBuZXdUZXh0ID0gdGhpcy5jaHVuay5uZXdUZXh0ICYmIHRoaXMuZm9ybWF0VGV4dCh0aGlzLmNodW5rLm5ld1RleHQpO1xuXG4gICAgICBpZiAob2xkVGV4dCkge1xuICAgICAgICBjb25zdCBvbGRMaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgb2xkTGluZS5jbGFzc05hbWUgPSBcImRpZmYtbGluZSBkaWZmLW9sZFwiO1xuICAgICAgICBvbGRMaW5lLnRleHRDb250ZW50ID0gYC0gJHtvbGRUZXh0fWA7XG4gICAgICAgIGRpZmZMaW5lcy5hcHBlbmRDaGlsZChvbGRMaW5lKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld1RleHQpIHtcbiAgICAgICAgY29uc3QgbmV3TGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIG5ld0xpbmUuY2xhc3NOYW1lID0gXCJkaWZmLWxpbmUgZGlmZi1uZXdcIjtcbiAgICAgICAgbmV3TGluZS50ZXh0Q29udGVudCA9IGArICR7bmV3VGV4dH1gO1xuICAgICAgICBkaWZmTGluZXMuYXBwZW5kQ2hpbGQobmV3TGluZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpZmZMaW5lcyk7XG5cbiAgICAvLyBDcmVhdGUgYW4gYWN0aW9ucyBjb250YWluZXIgZm9yIEFjY2VwdC9SZWplY3QgYnV0dG9uc1xuICAgIGNvbnN0IGFjdGlvbnNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgYWN0aW9uc0VsLmNsYXNzTmFtZSA9IFwiZGlmZi1hY3Rpb25zXCI7XG5cbiAgICAvLyBBY2NlcHQgQnV0dG9uXG4gICAgY29uc3QgYWNjZXB0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBhY2NlcHRCdG4uY2xhc3NOYW1lID0gXCJkaWZmLWJ0biBkaWZmLWFjY2VwdFwiO1xuICAgIHNldEljb24oYWNjZXB0QnRuLCBcImNoZWNrXCIpO1xuICAgIGFjY2VwdEJ0bi50aXRsZSA9IFwiQWNjZXB0IENoYW5nZVwiO1xuICAgIGFjY2VwdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmVkaXRvci5hcHBseUNodW5rQ2hhbmdlKHRoaXMuY2h1bmsuaWQsIHRydWUpO1xuICAgIH0pO1xuICAgIGFjdGlvbnNFbC5hcHBlbmRDaGlsZChhY2NlcHRCdG4pO1xuXG4gICAgLy8gUmVqZWN0IEJ1dHRvblxuICAgIGNvbnN0IHJlamVjdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgcmVqZWN0QnRuLmNsYXNzTmFtZSA9IFwiZGlmZi1idG4gZGlmZi1yZWplY3RcIjtcbiAgICBzZXRJY29uKHJlamVjdEJ0biwgXCJ4XCIpO1xuICAgIHJlamVjdEJ0bi50aXRsZSA9IFwiUmVqZWN0IENoYW5nZVwiO1xuICAgIHJlamVjdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmVkaXRvci5hcHBseUNodW5rQ2hhbmdlKHRoaXMuY2h1bmsuaWQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBhY3Rpb25zRWwuYXBwZW5kQ2hpbGQocmVqZWN0QnRuKTtcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChhY3Rpb25zRWwpO1xuXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxufVxuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICBJTkxJTkUgRElGRiBFRElUT1IgQ0xBU1Ncbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyoqXG4gKiBJbmxpbmVEaWZmRWRpdG9yIG1hbmFnZXMgZGlmZiBjYWxjdWxhdGlvbiwgZGVjb3JhdGlvbiByZW5kZXJpbmcsXG4gKiBBSSBlZGl0IHN0cmVhbWluZywgYW5kIHVzZXIgYWN0aW9ucyAoYWNjZXB0L3JlamVjdCkgb24gZWFjaCBkaWZmIGNodW5rLlxuICovXG5leHBvcnQgY2xhc3MgSW5saW5lRGlmZkVkaXRvciB7XG4gIC8vIEN1cnJlbnQgZGlmZiBjaHVua3MgY29tcHV0ZWQgZnJvbSBjb21wYXJpbmcgb3JpZ2luYWwgYW5kIEFJLW1vZGlmaWVkIHRleHQuXG4gIHByaXZhdGUgZGlmZkNodW5rczogRGlmZkNodW5rW10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgZWRpdG9yVmlldzogRWRpdG9yVmlldztcbiAgLy8gSW5zdGFuY2Ugb2YgZGlmZi1tYXRjaC1wYXRjaC5cbiAgcHJpdmF0ZSByZWFkb25seSBkbXA6IEluc3RhbmNlVHlwZTx0eXBlb2YgZGlmZl9tYXRjaF9wYXRjaD47XG4gIHByaXZhdGUgcHJvY2Vzc2luZyA9IGZhbHNlO1xuICBwcml2YXRlIGJvdHRvbVRvb2xiYXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2VsZWN0aW9uUmFuZ2U6IHsgZnJvbTogRWRpdG9yUG9zaXRpb247IHRvOiBFZGl0b3JQb3NpdGlvbiB9IHwgbnVsbCA9XG4gICAgbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFwcDogQXBwLFxuICAgIHByaXZhdGUgZWRpdG9yOiBFZGl0b3IsXG4gICAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpblxuICApIHtcbiAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHRoaXMuYXBwXG4gICAgKTtcbiAgICAvLyBAdHMtaWdub3JlIFx1MjAxMyBPYnNpZGlhbidzIEVkaXRvciBleHBvc2VzIHRoZSBDb2RlTWlycm9yIGluc3RhbmNlIGFzIFwiY21cIlxuICAgIHRoaXMuZWRpdG9yVmlldyA9IHRoaXMuZWRpdG9yLmNtO1xuICAgIHRoaXMuZG1wID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2goKTtcbiAgICB0aGlzLmluaXRpYWxpemVFZGl0b3IoKTtcbiAgICB0aGlzLmluaXRpYWxpemVLZXlib2FyZFNob3J0Y3V0cygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUJvdHRvbVRvb2xiYXIoKTtcbiAgfVxuXG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIEVkaXRvciAmIENvbmZpZ3VyYXRpb24gU2V0dXBcbiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAvKipcbiAgICogRW5zdXJlIHRoZSBkaWZmIHN0YXRlIGZpZWxkIGlzIGFwcGVuZGVkIHRvIHRoZSBDb2RlTWlycm9yIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVFZGl0b3IoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmVkaXRvclZpZXcuc3RhdGUuZmllbGQoZGlmZkZpZWxkLCBmYWxzZSkpIHtcbiAgICAgIHRoaXMuZWRpdG9yVmlldy5kaXNwYXRjaCh7XG4gICAgICAgIGVmZmVjdHM6IFN0YXRlRWZmZWN0LmFwcGVuZENvbmZpZy5vZihbZGlmZkZpZWxkXSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0dXAga2V5Ym9hcmQgc2hvcnRjdXRzIChlLmcuIENtZCtFbnRlcikgZm9yIHRyaWdnZXJpbmcgc3VnZ2VzdGlvbnMuXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVLZXlib2FyZFNob3J0Y3V0cygpOiB2b2lkIHtcbiAgICB0aGlzLmVkaXRvclZpZXcuZG9tLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS5tZXRhS2V5ICYmIGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLnRyaWdnZXJTdWdnZXN0aW9uKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGxhY2Vob2xkZXIgdG8gdHJpZ2dlciB0aGUgc3VnZ2VzdGlvbiBmbG93LlxuICAgKiBJbnRlZ3JhdGUgd2l0aCB5b3VyIG1vZGFsIG9yIFVJIGxvZ2ljIGFzIG5lZWRlZC5cbiAgICovXG4gIHByaXZhdGUgdHJpZ2dlclN1Z2dlc3Rpb24oKTogdm9pZCB7XG4gICAgLy8gRm9yIGV4YW1wbGUsIHJldHJpZXZlIGluc3RydWN0aW9ucyBmcm9tIGEgbW9kYWwgdGV4dGFyZWEgYW5kIGNhbGwgc3VnZ2VzdEVkaXRzLlxuICAgIC8vIGNvbnN0IGluc3RydWN0aW9ucyA9IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2luc3RydWN0aW9ucy10ZXh0YXJlYVwiKSBhcyBIVE1MVGV4dEFyZWFFbGVtZW50KT8udmFsdWU7XG4gICAgLy8gaWYgKGluc3RydWN0aW9ucykgdGhpcy5zdWdnZXN0RWRpdHMoaW5zdHJ1Y3Rpb25zKTtcbiAgfVxuXG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIFRleHQgTm9ybWFsaXphdGlvbiAmIFBvc2l0aW9uaW5nXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbiAgLyoqXG4gICAqIE5vcm1hbGl6ZSBsaW5lIGVuZGluZ3MgYW5kIHByZXNlcnZlIHRyYWlsaW5nIG5ld2xpbmVzLlxuICAgKi9cbiAgcHJpdmF0ZSBub3JtYWxpemVUZXh0KHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IG5vcm1hbGl6ZWQgPSB0ZXh0LnJlcGxhY2UoL1xcclxcbj8vZywgXCJcXG5cIik7XG4gICAgY29uc3QgaGFkVHJhaWxpbmdOZXdsaW5lID0gLyhcXHJcXG58XFxuKSQvLnRlc3QodGV4dCk7XG4gICAgY29uc3QgaGFzVHJhaWxpbmdOZXdsaW5lID0gbm9ybWFsaXplZC5lbmRzV2l0aChcIlxcblwiKTtcbiAgICBpZiAoaGFkVHJhaWxpbmdOZXdsaW5lICYmICFoYXNUcmFpbGluZ05ld2xpbmUpIHtcbiAgICAgIG5vcm1hbGl6ZWQgKz0gXCJcXG5cIjtcbiAgICB9IGVsc2UgaWYgKCFoYWRUcmFpbGluZ05ld2xpbmUgJiYgaGFzVHJhaWxpbmdOZXdsaW5lKSB7XG4gICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5zbGljZSgwLCAtMSk7XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVkO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGUgYW4gRWRpdG9yUG9zaXRpb24gZnJvbSBhIGNoYXJhY3RlciBvZmZzZXQsXG4gICAqIGFjY291bnRpbmcgZm9yIHRhYnMgYW5kIGxpbmUgYnJlYWtzLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFeGFjdFBvc2l0aW9uKHRleHQ6IHN0cmluZywgb2Zmc2V0OiBudW1iZXIpOiBFZGl0b3JQb3NpdGlvbiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IHRoaXMubm9ybWFsaXplVGV4dCh0ZXh0LnNsaWNlKDAsIG9mZnNldCkpO1xuICAgIGNvbnN0IGxpbmVzID0gbm9ybWFsaXplZC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBsaW5lID0gbGluZXMubGVuZ3RoIC0gMTtcbiAgICBsZXQgY2ggPSAwO1xuICAgIGNvbnN0IHRhYlNpemUgPSB0aGlzLmVkaXRvclZpZXcuc3RhdGUudGFiU2l6ZSB8fCA0O1xuICAgIGZvciAoY29uc3QgY2hhciBvZiBsaW5lc1tsaW5lXSkge1xuICAgICAgaWYgKGNoYXIgPT09IFwiXFx0XCIpIHtcbiAgICAgICAgY2ggPSBNYXRoLmZsb29yKChjaCArIHRhYlNpemUpIC8gdGFiU2l6ZSkgKiB0YWJTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2grKztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgbGluZSwgY2ggfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGp1c3QgYSBnaXZlbiBFZGl0b3JQb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBzZWxlY3Rpb24sXG4gICAqIGlmIGFueS5cbiAgICovXG4gIHByaXZhdGUgYWRqdXN0UG9zaXRpb24ocG9zOiBFZGl0b3JQb3NpdGlvbik6IEVkaXRvclBvc2l0aW9uIHtcbiAgICBpZiAoIXRoaXMuc2VsZWN0aW9uUmFuZ2UpIHJldHVybiBwb3M7XG4gICAgY29uc3QgYmFzZVBvcyA9IHRoaXMuc2VsZWN0aW9uUmFuZ2UuZnJvbTtcbiAgICByZXR1cm4gcG9zLmxpbmUgPT09IDBcbiAgICAgID8geyBsaW5lOiBiYXNlUG9zLmxpbmUsIGNoOiBiYXNlUG9zLmNoICsgcG9zLmNoIH1cbiAgICAgIDogeyBsaW5lOiBiYXNlUG9zLmxpbmUgKyBwb3MubGluZSwgY2g6IHBvcy5jaCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYW4gRWRpdG9yUG9zaXRpb24gdG8gYW4gYWJzb2x1dGUgZG9jdW1lbnQgb2Zmc2V0LlxuICAgKi9cbiAgcHJpdmF0ZSByZXNvbHZlUG9zaXRpb24odmlldzogRWRpdG9yVmlldywgcG9zOiBFZGl0b3JQb3NpdGlvbik6IG51bWJlciB7XG4gICAgY29uc3QgbGluZSA9IHZpZXcuc3RhdGUuZG9jLmxpbmUocG9zLmxpbmUgKyAxKTtcbiAgICByZXR1cm4gbGluZS5mcm9tICsgcG9zLmNoO1xuICB9XG5cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgRGlmZiBDb21wdXRhdGlvbiAmIERlY29yYXRpb24gUmVuZGVyaW5nXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbiAgLyoqXG4gICAqIENvbXB1dGUgZGlmZiBjaHVua3MgYmV0d2VlbiBvcmlnaW5hbCBhbmQgbW9kaWZpZWQgdGV4dCBhdCB0aGUgbGluZSBsZXZlbC5cbiAgICogVGhpcyB2ZXJzaW9uIGVuc3VyZXMgc3RyaWN0IGxpbmUtYnktbGluZSBkaWZmaW5nLlxuICAgKi9cbiAgcHJpdmF0ZSBjb21wdXRlRGlmZkNodW5rcyhvcmlnaW5hbDogc3RyaW5nLCBtb2RpZmllZDogc3RyaW5nKTogRGlmZkNodW5rW10ge1xuICAgIGNvbnN0IG5vcm1PcmlnID0gdGhpcy5ub3JtYWxpemVUZXh0KG9yaWdpbmFsKTtcbiAgICBjb25zdCBub3JtTW9kID0gdGhpcy5ub3JtYWxpemVUZXh0KG1vZGlmaWVkKTtcblxuICAgIGNvbnN0IG9yaWdMaW5lcyA9IG5vcm1PcmlnLnNwbGl0KFwiXFxuXCIpO1xuICAgIGNvbnN0IG1vZExpbmVzID0gbm9ybU1vZC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBjaHVua3M6IERpZmZDaHVua1tdID0gW107XG4gICAgbGV0IGlkID0gMDtcblxuICAgIC8vIENvbXBhcmUgbGluZXMgb25lIGJ5IG9uZVxuICAgIGNvbnN0IG1heExpbmVzID0gTWF0aC5tYXgob3JpZ0xpbmVzLmxlbmd0aCwgbW9kTGluZXMubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1heExpbmVzOyBpKyspIHtcbiAgICAgIGNvbnN0IG9yaWdMaW5lID0gb3JpZ0xpbmVzW2ldID8/IFwiXCI7XG4gICAgICBjb25zdCBtb2RMaW5lID0gbW9kTGluZXNbaV0gPz8gXCJcIjtcblxuICAgICAgaWYgKG9yaWdMaW5lID09PSBtb2RMaW5lKSBjb250aW51ZTtcblxuICAgICAgaWYgKCFvcmlnTGluZSAmJiBtb2RMaW5lKSB7XG4gICAgICAgIC8vIExpbmUgaW5zZXJ0aW9uXG4gICAgICAgIGNodW5rcy5wdXNoKHtcbiAgICAgICAgICBpZDogaWQrKyxcbiAgICAgICAgICB0eXBlOiBcImluc2VydFwiLFxuICAgICAgICAgIGZyb206IHsgbGluZTogaSwgY2g6IDAgfSxcbiAgICAgICAgICB0bzogeyBsaW5lOiBpLCBjaDogMCB9LFxuICAgICAgICAgIG5ld1RleHQ6IG1vZExpbmUsXG4gICAgICAgICAgYXBwbGllZDogZmFsc2UsXG4gICAgICAgICAgbGluZU51bWJlcjogaSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKG9yaWdMaW5lICYmICFtb2RMaW5lKSB7XG4gICAgICAgIC8vIExpbmUgZGVsZXRpb25cbiAgICAgICAgY2h1bmtzLnB1c2goe1xuICAgICAgICAgIGlkOiBpZCsrLFxuICAgICAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICAgICAgZnJvbTogeyBsaW5lOiBpLCBjaDogMCB9LFxuICAgICAgICAgIHRvOiB7IGxpbmU6IGksIGNoOiBvcmlnTGluZS5sZW5ndGggfSxcbiAgICAgICAgICBvcmlnaW5hbFRleHQ6IG9yaWdMaW5lLFxuICAgICAgICAgIGFwcGxpZWQ6IGZhbHNlLFxuICAgICAgICAgIGxpbmVOdW1iZXI6IGksXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTGluZSByZXBsYWNlbWVudFxuICAgICAgICBjaHVua3MucHVzaCh7XG4gICAgICAgICAgaWQ6IGlkKyssXG4gICAgICAgICAgdHlwZTogXCJyZXBsYWNlXCIsXG4gICAgICAgICAgZnJvbTogeyBsaW5lOiBpLCBjaDogMCB9LFxuICAgICAgICAgIHRvOiB7IGxpbmU6IGksIGNoOiBvcmlnTGluZS5sZW5ndGggfSxcbiAgICAgICAgICBvcmlnaW5hbFRleHQ6IG9yaWdMaW5lLFxuICAgICAgICAgIG5ld1RleHQ6IG1vZExpbmUsXG4gICAgICAgICAgYXBwbGllZDogZmFsc2UsXG4gICAgICAgICAgbGluZU51bWJlcjogaSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNodW5rcztcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCBDb2RlTWlycm9yIGRlY29yYXRpb25zIChtYXJrcyBhbmQgd2lkZ2V0cykgZnJvbSBkaWZmIGNodW5rcy5cbiAgICovXG4gIHByaXZhdGUgYnVpbGREaWZmRGVjb3JhdGlvbnMoXG4gICAgdmlldzogRWRpdG9yVmlldyxcbiAgICBjaHVua3M6IERpZmZDaHVua1tdXG4gICk6IERlY29yYXRpb25TZXQge1xuICAgIGNvbnN0IGRlY29yYXRpb25zOiBSYW5nZTxEZWNvcmF0aW9uPltdID0gW107XG5cbiAgICAvLyBTaG93IGEgcHJvY2Vzc2luZyB3aWRnZXQgYXQgdGhlIHRvcCB3aGVuIHN0cmVhbWluZy5cbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nKSB7XG4gICAgICBkZWNvcmF0aW9ucy5wdXNoKFxuICAgICAgICBEZWNvcmF0aW9uLndpZGdldCh7XG4gICAgICAgICAgd2lkZ2V0OiBuZXcgUHJvY2Vzc2luZ1dpZGdldCgpLFxuICAgICAgICAgIHNpZGU6IC0xLFxuICAgICAgICB9KS5yYW5nZSgwKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHcm91cCBjaHVua3MgYnkgbGluZSBudW1iZXIgdG8gYXZvaWQgb3ZlcmxhcHBpbmcgd2lkZ2V0c1xuICAgIGNvbnN0IGNodW5rc0J5TGluZSA9IG5ldyBNYXA8bnVtYmVyLCBEaWZmQ2h1bms+KCk7XG4gICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcbiAgICAgIGlmICghY2h1bmsuYXBwbGllZCkge1xuICAgICAgICBjaHVua3NCeUxpbmUuc2V0KGNodW5rLmxpbmVOdW1iZXIsIGNodW5rKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZGVjb3JhdGlvbnMgZm9yIGVhY2ggdW5pcXVlIGxpbmUncyBjaHVua1xuICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzQnlMaW5lLnZhbHVlcygpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBhZGp1c3RlZEZyb20gPSB0aGlzLnJlc29sdmVQb3NpdGlvbihcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuYWRqdXN0UG9zaXRpb24oY2h1bmsuZnJvbSlcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgYWRqdXN0ZWRUbyA9IHRoaXMucmVzb2x2ZVBvc2l0aW9uKFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5hZGp1c3RQb3NpdGlvbihjaHVuay50bylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBPbmx5IGFkZCBkZWNvcmF0aW9ucyBpZiB3ZSBoYXZlIGEgdmFsaWQgcmFuZ2VcbiAgICAgICAgaWYgKGFkanVzdGVkRnJvbSA9PT0gYWRqdXN0ZWRUbykgY29udGludWU7XG5cbiAgICAgICAgLy8gVXNlIGEgcmVwbGFjZSBkZWNvcmF0aW9uIHRoYXQgaW5jbHVkZXMgYm90aCB0aGUgd2lkZ2V0IGFuZCBoaWRlcyB0aGUgb3JpZ2luYWwgdGV4dFxuICAgICAgICBkZWNvcmF0aW9ucy5wdXNoKFxuICAgICAgICAgIERlY29yYXRpb24ucmVwbGFjZSh7XG4gICAgICAgICAgICB3aWRnZXQ6IG5ldyBVbmlmaWVkRGlmZldpZGdldChjaHVuaywgdGhpcyksXG4gICAgICAgICAgICBibG9jazogZmFsc2UsIC8vIFVzZSBpbmxpbmUgcmVwbGFjZW1lbnRcbiAgICAgICAgICB9KS5yYW5nZShhZGp1c3RlZEZyb20sIGFkanVzdGVkVG8pIGFzIFJhbmdlPERlY29yYXRpb24+XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYnVpbGRpbmcgZGlmZiBkZWNvcmF0aW9uOlwiLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIERlY29yYXRpb24uc2V0KGRlY29yYXRpb25zLCB0cnVlKTsgLy8gVXNlIHRydWUgdG8gc29ydCBkZWNvcmF0aW9uc1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY3VycmVudCBkaWZmIGRlY29yYXRpb25zIG9uIHRoZSBlZGl0b3IuXG4gICAqL1xuICBwcml2YXRlIHNob3dEaWZmKGNodW5rczogRGlmZkNodW5rW10pOiB2b2lkIHtcbiAgICBjb25zdCBkZWNvU2V0ID0gdGhpcy5idWlsZERpZmZEZWNvcmF0aW9ucyh0aGlzLmVkaXRvclZpZXcsIGNodW5rcyk7XG4gICAgdGhpcy5lZGl0b3JWaWV3LmRpc3BhdGNoKHsgZWZmZWN0czogc2V0RGlmZkVmZmVjdC5vZihkZWNvU2V0KSB9KTtcbiAgICB0aGlzLnVwZGF0ZUJvdHRvbVRvb2xiYXJWaXNpYmlsaXR5KCk7XG4gIH1cblxuICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICBFZGl0b3IgQ29udGVudCAmIFNlbGVjdGlvbiBIZWxwZXJzXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgdGV4dCB0byBiZSBlZGl0ZWQ6IGVpdGhlciB0aGUgY3VycmVudCBzZWxlY3Rpb24gb3IgdGhlIHdob2xlIGRvY3VtZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFZGl0YWJsZUNvbnRlbnQoKTogeyBjb250ZW50OiBzdHJpbmc7IGlzU2VsZWN0aW9uOiBib29sZWFuIH0ge1xuICAgIHRoaXMuc2VsZWN0aW9uUmFuZ2UgPSB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25SYW5nZSgpO1xuICAgIGlmICh0aGlzLnNlbGVjdGlvblJhbmdlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb250ZW50OiB0aGlzLmVkaXRvci5nZXRSYW5nZShcbiAgICAgICAgICB0aGlzLnNlbGVjdGlvblJhbmdlLmZyb20sXG4gICAgICAgICAgdGhpcy5zZWxlY3Rpb25SYW5nZS50b1xuICAgICAgICApLFxuICAgICAgICBpc1NlbGVjdGlvbjogdHJ1ZSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IGNvbnRlbnQ6IHRoaXMuZWRpdG9yLmdldFZhbHVlKCksIGlzU2VsZWN0aW9uOiBmYWxzZSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzZWxlY3Rpb24gcmFuZ2UsIG9yIG51bGwgaWYgbm8gdGV4dCBpcyBzZWxlY3RlZC5cbiAgICovXG4gIHByaXZhdGUgZ2V0Q3VycmVudFNlbGVjdGlvblJhbmdlKCk6IHtcbiAgICBmcm9tOiBFZGl0b3JQb3NpdGlvbjtcbiAgICB0bzogRWRpdG9yUG9zaXRpb247XG4gIH0gfCBudWxsIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSB0aGlzLmVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICBpZiAoIXNlbGVjdGlvbiB8fCBzZWxlY3Rpb24udHJpbSgpID09PSBcIlwiKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4ge1xuICAgICAgZnJvbTogdGhpcy5lZGl0b3IuZ2V0Q3Vyc29yKFwiZnJvbVwiKSxcbiAgICAgIHRvOiB0aGlzLmVkaXRvci5nZXRDdXJzb3IoXCJ0b1wiKSxcbiAgICB9O1xuICB9XG5cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgQXBwbHlpbmcgRGlmZiBDaGFuZ2VzXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbiAgLyoqXG4gICAqIEFwcGx5IHRoZSBjaGFuZ2VzIGZvciBhIGRpZmYgY2h1bmsgKGluc2VydGlvbiwgZGVsZXRpb24sIG9yIHJlcGxhY2VtZW50KVxuICAgKiB1c2luZyBwcmVjaXNlIHBvc2l0aW9uIGFkanVzdG1lbnRzLlxuICAgKi9cbiAgcHJpdmF0ZSBhcHBseUNodW5rVG9FZGl0b3IoY2h1bms6IERpZmZDaHVuayk6IHZvaWQge1xuICAgIGNvbnN0IGZyb20gPSB0aGlzLmFkanVzdFBvc2l0aW9uKGNodW5rLmZyb20pO1xuICAgIGNvbnN0IHRvID0gdGhpcy5hZGp1c3RQb3NpdGlvbihjaHVuay50byk7XG5cbiAgICAvLyBEZWJ1ZyBjaHVuayBib3VuZGFyaWVzXG4gICAgY29uc29sZS5sb2coXG4gICAgICBcIkFwcGx5aW5nIGNodW5rOlwiLFxuICAgICAgXCJJRDpcIixcbiAgICAgIGNodW5rLmlkLFxuICAgICAgXCJUeXBlOlwiLFxuICAgICAgY2h1bmsudHlwZSxcbiAgICAgIFwiRnJvbTpcIixcbiAgICAgIGZyb20sXG4gICAgICBcIlRvOlwiLFxuICAgICAgdG8sXG4gICAgICBcIk9yaWdpbmFsOlwiLFxuICAgICAgY2h1bmsub3JpZ2luYWxUZXh0LFxuICAgICAgXCJOZXc6XCIsXG4gICAgICBjaHVuay5uZXdUZXh0XG4gICAgKTtcblxuICAgIGlmIChjaHVuay50eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAvLyBIYW5kbGUgc2luZ2xlLWxpbmUgZGVsZXRpb25cbiAgICAgIGlmIChmcm9tLmxpbmUgPT09IHRvLmxpbmUpIHtcbiAgICAgICAgY29uc3QgbGluZVRleHQgPSB0aGlzLmVkaXRvci5nZXRMaW5lKGZyb20ubGluZSkgPz8gXCJcIjtcbiAgICAgICAgY29uc3QgZnVsbExpbmUgPSBmcm9tLmNoID09PSAwICYmIHRvLmNoID49IGxpbmVUZXh0Lmxlbmd0aDtcblxuICAgICAgICBpZiAoZnVsbExpbmUpIHtcbiAgICAgICAgICAvLyBSZW1vdmUgb25seSB0aGUgbGluZSdzIGNvbnRlbnRzLCBwcmVzZXJ2aW5nIHRoZSBuZXdsaW5lXG4gICAgICAgICAgdGhpcy5lZGl0b3IucmVwbGFjZVJhbmdlKFxuICAgICAgICAgICAgXCJcIixcbiAgICAgICAgICAgIHsgbGluZTogZnJvbS5saW5lLCBjaDogMCB9LFxuICAgICAgICAgICAgeyBsaW5lOiBmcm9tLmxpbmUsIGNoOiBsaW5lVGV4dC5sZW5ndGggfVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gUGFydGlhbCBsaW5lIGRlbGV0ZVxuICAgICAgICAgIHRoaXMuZWRpdG9yLnJlcGxhY2VSYW5nZShcIlwiLCBmcm9tLCB0byk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE11bHRpLWxpbmUgZGVsZXRpb24gLSByZW1vdmUgY29udGVudCBidXQgcHJlc2VydmUgbGluZSBzdHJ1Y3R1cmVcbiAgICAgICAgZm9yIChsZXQgbGluZSA9IGZyb20ubGluZTsgbGluZSA8PSB0by5saW5lOyBsaW5lKyspIHtcbiAgICAgICAgICBjb25zdCBsaW5lVGV4dCA9IHRoaXMuZWRpdG9yLmdldExpbmUobGluZSkgPz8gXCJcIjtcbiAgICAgICAgICBpZiAobGluZSA9PT0gZnJvbS5saW5lKSB7XG4gICAgICAgICAgICAvLyBGaXJzdCBsaW5lOiBjbGVhciBmcm9tIHN0YXJ0IHBvc2l0aW9uIHRvIGVuZCBvZiBsaW5lXG4gICAgICAgICAgICB0aGlzLmVkaXRvci5yZXBsYWNlUmFuZ2UoXG4gICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgIHsgbGluZSwgY2g6IGZyb20uY2ggfSxcbiAgICAgICAgICAgICAgeyBsaW5lLCBjaDogbGluZVRleHQubGVuZ3RoIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsaW5lID09PSB0by5saW5lKSB7XG4gICAgICAgICAgICAvLyBMYXN0IGxpbmU6IGNsZWFyIGZyb20gc3RhcnQgdG8gZW5kIHBvc2l0aW9uXG4gICAgICAgICAgICB0aGlzLmVkaXRvci5yZXBsYWNlUmFuZ2UoXG4gICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgIHsgbGluZSwgY2g6IDAgfSxcbiAgICAgICAgICAgICAgeyBsaW5lLCBjaDogTWF0aC5taW4odG8uY2gsIGxpbmVUZXh0Lmxlbmd0aCkgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTWlkZGxlIGxpbmVzOiBjbGVhciBlbnRpcmUgbGluZSBjb250ZW50XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5yZXBsYWNlUmFuZ2UoXG4gICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgIHsgbGluZSwgY2g6IDAgfSxcbiAgICAgICAgICAgICAgeyBsaW5lLCBjaDogbGluZVRleHQubGVuZ3RoIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGluc2VydGlvbnMgYW5kIHJlcGxhY2VtZW50c1xuICAgIGlmIChjaHVuay50eXBlID09PSBcImluc2VydFwiICYmIGNodW5rLm5ld1RleHQpIHtcbiAgICAgIHRoaXMuZWRpdG9yLnJlcGxhY2VSYW5nZSh0aGlzLm5vcm1hbGl6ZVRleHQoY2h1bmsubmV3VGV4dCksIGZyb20sIGZyb20pO1xuICAgIH0gZWxzZSBpZiAoY2h1bmsudHlwZSA9PT0gXCJyZXBsYWNlXCIgJiYgY2h1bmsubmV3VGV4dCkge1xuICAgICAgdGhpcy5lZGl0b3IucmVwbGFjZVJhbmdlKHRoaXMubm9ybWFsaXplVGV4dChjaHVuay5uZXdUZXh0KSwgZnJvbSwgdG8pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgbWV0aG9kIHRvIGFjY2VwdCBvciByZWplY3QgYSBkaWZmIGNodW5rIGJ5IGl0cyBJRC5cbiAgICogT24gYWNjZXB0YW5jZSwgdGhlIGNoYW5nZSBpcyBhcHBsaWVkIHRvIHRoZSBlZGl0b3IuXG4gICAqL1xuICBwdWJsaWMgYXBwbHlDaHVua0NoYW5nZShjaHVua0lkOiBudW1iZXIsIGFjY2VwdDogYm9vbGVhbik6IHZvaWQge1xuICAgIGNvbnN0IGNodW5rID0gdGhpcy5kaWZmQ2h1bmtzLmZpbmQoKGMpID0+IGMuaWQgPT09IGNodW5rSWQpO1xuICAgIGlmICghY2h1bmspIHJldHVybjtcbiAgICBpZiAoYWNjZXB0KSB7XG4gICAgICB0aGlzLmFwcGx5Q2h1bmtUb0VkaXRvcihjaHVuayk7XG4gICAgfVxuICAgIC8vIE1hcmsgdGhlIGNodW5rIGFzIGFwcGxpZWQgc28gaXQgbm8gbG9uZ2VyIGFwcGVhcnMgaW4gdGhlIGRpZmYgdmlldy5cbiAgICBjaHVuay5hcHBsaWVkID0gdHJ1ZTtcbiAgICB0aGlzLnNob3dEaWZmKHRoaXMuZGlmZkNodW5rcyk7XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgYWxsIHVuYXBwbGllZCBkaWZmIGNodW5rcy4gJ2FjY2VwdCcgcGFyYW1ldGVyIGRldGVybWluZXMgd2hldGhlciB0byBhY2NlcHQgb3IgcmVqZWN0IHRoZW0uXG4gICAqL1xuICBwcml2YXRlIGFwcGx5QWxsQ2hhbmdlcyhhY2NlcHQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpZmZDaHVua3NcbiAgICAgIC5maWx0ZXIoKGNodW5rKSA9PiAhY2h1bmsuYXBwbGllZClcbiAgICAgIC5mb3JFYWNoKChjaHVuaykgPT4gdGhpcy5hcHBseUNodW5rQ2hhbmdlKGNodW5rLmlkLCBhY2NlcHQpKTtcbiAgICB0aGlzLnVwZGF0ZUJvdHRvbVRvb2xiYXJWaXNpYmlsaXR5KCk7XG4gIH1cblxuICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICBCb3R0b20gVG9vbGJhciBmb3IgR2xvYmFsIEFjdGlvbnNcbiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgYm90dG9tIHRvb2xiYXIgd2l0aCBcIkFjY2VwdCBBbGxcIiBhbmQgXCJSZWplY3QgQWxsXCIgYnV0dG9ucy5cbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUJvdHRvbVRvb2xiYXIoKTogdm9pZCB7XG4gICAgdGhpcy5ib3R0b21Ub29sYmFyPy5yZW1vdmUoKTtcblxuICAgIHRoaXMuYm90dG9tVG9vbGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5ib3R0b21Ub29sYmFyLmNsYXNzTmFtZSA9IFwiZGlmZi1ib3R0b20tdG9vbGJhclwiO1xuICAgIHRoaXMuZWRpdG9yVmlldy5kb20uYXBwZW5kQ2hpbGQodGhpcy5ib3R0b21Ub29sYmFyKTtcblxuICAgIC8vIEFjY2VwdCBBbGwgQnV0dG9uLlxuICAgIGNvbnN0IGFjY2VwdEFsbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgYWNjZXB0QWxsQnRuLmNsYXNzTmFtZSA9IFwiZGlmZi1idG4gZGlmZi1hY2NlcHRcIjtcbiAgICBzZXRJY29uKGFjY2VwdEFsbEJ0biwgXCJjaGVja1wiKTtcbiAgICBjb25zdCBhY2NlcHRUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgYWNjZXB0VGV4dC50ZXh0Q29udGVudCA9IFwiQWNjZXB0IEFsbFwiO1xuICAgIGFjY2VwdEFsbEJ0bi5hcHBlbmRDaGlsZChhY2NlcHRUZXh0KTtcbiAgICBhY2NlcHRBbGxCdG4udGl0bGUgPSBcIkFjY2VwdCBhbGwgY2hhbmdlc1wiO1xuICAgIGFjY2VwdEFsbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5hcHBseUFsbENoYW5nZXModHJ1ZSkpO1xuICAgIHRoaXMuYm90dG9tVG9vbGJhci5hcHBlbmRDaGlsZChhY2NlcHRBbGxCdG4pO1xuXG4gICAgLy8gUmVqZWN0IEFsbCBCdXR0b24uXG4gICAgY29uc3QgcmVqZWN0QWxsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICByZWplY3RBbGxCdG4uY2xhc3NOYW1lID0gXCJkaWZmLWJ0biBkaWZmLXJlamVjdFwiO1xuICAgIHNldEljb24ocmVqZWN0QWxsQnRuLCBcInhcIik7XG4gICAgY29uc3QgcmVqZWN0VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIHJlamVjdFRleHQudGV4dENvbnRlbnQgPSBcIlJlamVjdCBBbGxcIjtcbiAgICByZWplY3RBbGxCdG4uYXBwZW5kQ2hpbGQocmVqZWN0VGV4dCk7XG4gICAgcmVqZWN0QWxsQnRuLnRpdGxlID0gXCJSZWplY3QgYWxsIGNoYW5nZXNcIjtcbiAgICByZWplY3RBbGxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuYXBwbHlBbGxDaGFuZ2VzKGZhbHNlKSk7XG4gICAgdGhpcy5ib3R0b21Ub29sYmFyLmFwcGVuZENoaWxkKHJlamVjdEFsbEJ0bik7XG5cbiAgICB0aGlzLnVwZGF0ZUJvdHRvbVRvb2xiYXJWaXNpYmlsaXR5KCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBib3R0b20gdG9vbGJhciBiYXNlZCBvbiB3aGV0aGVyIGFueSBkaWZmIGNodW5rcyByZW1haW4gdW5hcHBsaWVkLlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVCb3R0b21Ub29sYmFyVmlzaWJpbGl0eSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuYm90dG9tVG9vbGJhcikgcmV0dXJuO1xuICAgIGNvbnN0IGhhc1BlbmRpbmcgPSB0aGlzLmRpZmZDaHVua3Muc29tZSgoY2h1bmspID0+ICFjaHVuay5hcHBsaWVkKTtcbiAgICB0aGlzLmJvdHRvbVRvb2xiYXIuY2xhc3NMaXN0LnRvZ2dsZShcInZpc2libGVcIiwgaGFzUGVuZGluZyk7XG4gIH1cblxuICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICBBSSBTdWdnZXN0aW9uICYgU3RyZWFtaW5nXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbiAgLyoqXG4gICAqIFJlcXVlc3QgQUktc3VnZ2VzdGVkIGVkaXRzICh3aXRoIHN0cmVhbWluZykgYW5kIHVwZGF0ZSBkaWZmIGNodW5rcyBhcyBuZXcgY29udGVudCBhcnJpdmVzLlxuICAgKiBAcGFyYW0gaW5zdHJ1Y3Rpb25zIC0gVGhlIHVzZXItcHJvdmlkZWQgZWRpdGluZyBpbnN0cnVjdGlvbnMuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc3VnZ2VzdEVkaXRzKGluc3RydWN0aW9uczogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY29udGVudDogb3JpZ2luYWxDb250ZW50LCBpc1NlbGVjdGlvbiB9ID1cbiAgICAgICAgdGhpcy5nZXRFZGl0YWJsZUNvbnRlbnQoKTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICB0aGlzLmRpZmZDaHVua3MgPSBbXTtcbiAgICAgIHRoaXMuc2hvd0RpZmYoW10pOyAvLyBTaG93IHByb2Nlc3Npbmcgd2lkZ2V0LlxuXG4gICAgICBsZXQgYWNjdW11bGF0ZWRDb250ZW50ID0gXCJcIjtcbiAgICAgIGxldCB1cGRhdGVUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICAgICAgbGV0IGxhc3RQcm9jZXNzZWRMZW5ndGggPSAwO1xuXG4gICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHRoaXMuYWlTZXJ2aWNlLnN0cmVhbU1lc3NhZ2Uoe1xuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgY29udGVudDogb3JpZ2luYWxDb250ZW50LFxuICAgICAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgY29udGVudDogYCR7XG4gICAgICAgICAgICAgIGlzU2VsZWN0aW9uID8gXCJQbGVhc2Ugb25seSBtb2RpZnkgdGhlIHNlbGVjdGVkIHRleHQuIFwiIDogXCJcIlxuICAgICAgICAgICAgfSR7aW5zdHJ1Y3Rpb25zfWAsXG4gICAgICAgICAgICBtZXNzYWdlX2lkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIG1vZGVsOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGU6IFwidGV4dF9tb2RpZmljYXRpb25cIixcbiAgICAgICAgb25FcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkFJIHNlcnZpY2UgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoYEZhaWxlZCB0byBtb2RpZnkgdGV4dDogJHtlcnJvcn1gLCBcImVycm9yXCIpO1xuICAgICAgICB9LFxuICAgICAgfSkpIHtcbiAgICAgICAgaWYgKGNodW5rLmNvbnRlbnQpIHtcbiAgICAgICAgICBhY2N1bXVsYXRlZENvbnRlbnQgKz0gY2h1bmsuY29udGVudDtcbiAgICAgICAgICBpZiAoYWNjdW11bGF0ZWRDb250ZW50Lmxlbmd0aCA+IGxhc3RQcm9jZXNzZWRMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmICh1cGRhdGVUaW1lb3V0KSBjbGVhclRpbWVvdXQodXBkYXRlVGltZW91dCk7XG4gICAgICAgICAgICB1cGRhdGVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDaHVua3MgPSB0aGlzLmNvbXB1dGVEaWZmQ2h1bmtzKFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsQ29udGVudCxcbiAgICAgICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZVRleHQoYWNjdW11bGF0ZWRDb250ZW50KVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBpZiAoY3VycmVudENodW5rcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaWZmQ2h1bmtzID0gY3VycmVudENodW5rcztcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dEaWZmKGN1cnJlbnRDaHVua3MpO1xuICAgICAgICAgICAgICAgIGxhc3RQcm9jZXNzZWRMZW5ndGggPSBhY2N1bXVsYXRlZENvbnRlbnQubGVuZ3RoO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh1cGRhdGVUaW1lb3V0KSBjbGVhclRpbWVvdXQodXBkYXRlVGltZW91dCk7XG4gICAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IHRoaXMubm9ybWFsaXplVGV4dChhY2N1bXVsYXRlZENvbnRlbnQpO1xuICAgICAgY29uc3QgZmluYWxDaHVua3MgPSB0aGlzLmNvbXB1dGVEaWZmQ2h1bmtzKFxuICAgICAgICBvcmlnaW5hbENvbnRlbnQsXG4gICAgICAgIG5vcm1hbGl6ZWRDb250ZW50XG4gICAgICApO1xuICAgICAgaWYgKGZpbmFsQ2h1bmtzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5kaWZmQ2h1bmtzID0gZmluYWxDaHVua3M7XG4gICAgICAgIHRoaXMuc2hvd0RpZmYoZmluYWxDaHVua3MpO1xuICAgICAgfVxuICAgICAgdGhpcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgc3VnZ2VzdEVkaXRzOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIHN1Z2dlc3QgZWRpdHMuIFBsZWFzZSB0cnkgYWdhaW4uXCIpO1xuICAgICAgdGhpcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmRpZmZDaHVua3MgPSBbXTtcbiAgICAgIHRoaXMuc2hvd0RpZmYoW10pO1xuICAgIH1cbiAgfVxuXG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIENsZWFudXBcbiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAvKipcbiAgICogQ2xlYW4gdXAgYW55IGF0dGFjaGVkIFVJIGVsZW1lbnRzIChzdWNoIGFzIHRoZSBib3R0b20gdG9vbGJhcikgd2hlbiB1bmxvYWRpbmcgdGhlIGVkaXRvci5cbiAgICovXG4gIHB1YmxpYyBvbnVubG9hZCgpOiB2b2lkIHtcbiAgICB0aGlzLmJvdHRvbVRvb2xiYXI/LnJlbW92ZSgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQ3VzdG9tUHJvdmlkZXIgfSBmcm9tIFwic3JjL3R5cGVzL2xsbVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwic3JjL21haW5cIjtcblxuaW50ZXJmYWNlIFRlc3RDb25uZWN0aW9uUmVzdWx0IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIG1vZGVscz86IHN0cmluZ1tdO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIE9wZW5Sb3V0ZXJNb2RlbCB7XG4gIGlkOiBzdHJpbmc7XG4gIHByaWNpbmc6IHtcbiAgICBwcm9tcHQ6IHN0cmluZztcbiAgICBjb21wbGV0aW9uOiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlclNlcnZpY2Uge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBzdGF0aWMgY29ubmVjdGlvblRlc3RDYWNoZTogTWFwPFxuICAgIHN0cmluZyxcbiAgICB7XG4gICAgICByZXN1bHQ6IFRlc3RDb25uZWN0aW9uUmVzdWx0O1xuICAgICAgdGltZXN0YW1wOiBudW1iZXI7XG4gICAgfVxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHN0YXRpYyBjb25uZWN0aW9uVGVzdFByb21pc2VzOiBNYXA8XG4gICAgc3RyaW5nLFxuICAgIFByb21pc2U8VGVzdENvbm5lY3Rpb25SZXN1bHQ+XG4gID4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgQ0FDSEVfRFVSQVRJT04gPSAzMCAqIDYwICogMTAwMDsgLy8gMzAgbWludXRlc1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5sb2dnZXIgPSBjb25zb2xlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRlc3QgY29ubmVjdGlvbiB0byBhIHByb3ZpZGVyIGJ5IGF0dGVtcHRpbmcgdG8gZmV0Y2ggYXZhaWxhYmxlIG1vZGVsc1xuICAgKiBGb3IgT3BlblJvdXRlciwgd2UgYWxzbyB2YWxpZGF0ZSB0aGUgQVBJIGtleSBieSBtYWtpbmcgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdFxuICAgKi9cbiAgYXN5bmMgdGVzdENvbm5lY3Rpb24oXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyXG4gICk6IFByb21pc2U8VGVzdENvbm5lY3Rpb25SZXN1bHQ+IHtcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgIGNvbnN0IGNhY2hlZCA9IEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdENhY2hlLmdldChwcm92aWRlci5pZCk7XG4gICAgaWYgKGNhY2hlZCAmJiBEYXRlLm5vdygpIC0gY2FjaGVkLnJlc3VsdC50aW1lc3RhbXAgPCB0aGlzLkNBQ0hFX0RVUkFUSU9OKSB7XG4gICAgICByZXR1cm4gY2FjaGVkLnJlc3VsdDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBhbHJlYWR5IHRlc3RpbmcgdGhpcyBwcm92aWRlclxuICAgIGNvbnN0IGV4aXN0aW5nUHJvbWlzZSA9IEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdFByb21pc2VzLmdldChcbiAgICAgIHByb3ZpZGVyLmlkXG4gICAgKTtcbiAgICBpZiAoZXhpc3RpbmdQcm9taXNlKSB7XG4gICAgICByZXR1cm4gZXhpc3RpbmdQcm9taXNlO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IG5ldyB0ZXN0XG4gICAgY29uc3QgdGVzdFByb21pc2UgPSB0aGlzLnBlcmZvcm1Db25uZWN0aW9uVGVzdChwcm92aWRlcik7XG4gICAgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlLmNvbm5lY3Rpb25UZXN0UHJvbWlzZXMuc2V0KHByb3ZpZGVyLmlkLCB0ZXN0UHJvbWlzZSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVzdFByb21pc2U7XG4gICAgICAvLyBDYWNoZSBzdWNjZXNzZnVsIHJlc3VsdHNcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RDYWNoZS5zZXQocHJvdmlkZXIuaWQsIHtcbiAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdFByb21pc2VzLmRlbGV0ZShwcm92aWRlci5pZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEludGVybmFsIG1ldGhvZCB0byBhY3R1YWxseSBwZXJmb3JtIHRoZSBjb25uZWN0aW9uIHRlc3RcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcGVyZm9ybUNvbm5lY3Rpb25UZXN0KFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlclxuICApOiBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMuZ2V0TW9kZWxzKHByb3ZpZGVyKTtcblxuICAgICAgLy8gRm9yIE9wZW5Sb3V0ZXIsIHdlIG5lZWQgdG8gdmFsaWRhdGUgdGhlIEFQSSBrZXkgYnkgbWFraW5nIGEgdGVzdCBjb21wbGV0aW9uXG4gICAgICBpZiAocHJvdmlkZXIuZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGVPcGVuUm91dGVyS2V5KHByb3ZpZGVyLCBtb2RlbHMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtb2RlbHMsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiQ29ubmVjdGlvbiB0ZXN0IGZhaWxlZDpcIiwgZXJyb3IpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHRoaXMuZ2V0RXJyb3JNZXNzYWdlKGVycm9yKSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgT3BlblJvdXRlciBBUEkga2V5IGJ5IG1ha2luZyBhIG1pbmltYWwgY29tcGxldGlvbiByZXF1ZXN0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlT3BlblJvdXRlcktleShcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIsXG4gICAgbW9kZWxJZHM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YCxcbiAgICAgIFwiSFRUUC1SZWZlcmVyXCI6IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCIsXG4gICAgICBcIlgtVGl0bGVcIjogXCJTeXN0ZW1TY3VscHQgQUlcIixcbiAgICB9O1xuXG4gICAgLy8gTWFrZSBhIG1pbmltYWwgY29tcGxldGlvbiByZXF1ZXN0IHdpdGggdGhlIGZyZWUgbW9kZWxcbiAgICBjb25zdCBjb21wbGV0aW9uUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBtb2RlbDogXCJtZXRhLWxsYW1hL2xsYW1hLTMtOGItaW5zdHJ1Y3Q6ZnJlZVwiLFxuICAgICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogXCJIaVwiIH1dLFxuICAgICAgICAgIG1heF90b2tlbnM6IDEsXG4gICAgICAgIH0pLFxuICAgICAgICBzaWduYWw6IEFib3J0U2lnbmFsLnRpbWVvdXQoMTAwMDApLFxuICAgICAgfVxuICAgICk7XG5cbiAgICBpZiAoIWNvbXBsZXRpb25SZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgY29tcGxldGlvblJlc3BvbnNlLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcbiAgICAgIGlmIChjb21wbGV0aW9uUmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBBUEkga2V5LiBQbGVhc2UgY2hlY2sgeW91ciBPcGVuUm91dGVyIEFQSSBrZXkgYW5kIHRyeSBhZ2Fpbi5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChjb21wbGV0aW9uUmVzcG9uc2Uuc3RhdHVzID09PSA0MDIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiSW5zdWZmaWNpZW50IGNyZWRpdHMuIFBsZWFzZSBhZGQgY3JlZGl0cyB0byB5b3VyIE9wZW5Sb3V0ZXIgYWNjb3VudC5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChjb21wbGV0aW9uUmVzcG9uc2Uuc3RhdHVzID09PSA0MjkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiUmF0ZSBsaW1pdCBleGNlZWRlZC4gUGxlYXNlIHRyeSBhZ2FpbiBpbiBhIGZldyBtaW51dGVzLlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBBUEkga2V5IHZhbGlkYXRpb24gZmFpbGVkOiAke1xuICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBjb21wbGV0aW9uUmVzcG9uc2Uuc3RhdHVzVGV4dFxuICAgICAgICB9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYXZhaWxhYmxlIG1vZGVscyBmcm9tIGEgcHJvdmlkZXJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0TW9kZWxzKHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlcik6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfTtcblxuICAgIC8vIEFkZCBBUEkga2V5IGlmIHByZXNlbnRcbiAgICBpZiAocHJvdmlkZXIuYXBpS2V5KSB7XG4gICAgICBpZiAocHJvdmlkZXIuZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpKSB7XG4gICAgICAgIGhlYWRlcnNbXCJBdXRob3JpemF0aW9uXCJdID0gYEJlYXJlciAke3Byb3ZpZGVyLmFwaUtleX1gO1xuICAgICAgICBoZWFkZXJzW1wiSFRUUC1SZWZlcmVyXCJdID0gXCJodHRwczovL3N5c3RlbXNjdWxwdC5jb21cIjsgLy8gUmVxdWlyZWQgYnkgT3BlblJvdXRlclxuICAgICAgICBoZWFkZXJzW1wiWC1UaXRsZVwiXSA9IFwiU3lzdGVtU2N1bHB0IEFJXCI7IC8vIFJlcXVpcmVkIGJ5IE9wZW5Sb3V0ZXJcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhlYWRlcnNbXCJBdXRob3JpemF0aW9uXCJdID0gYEJlYXJlciAke3Byb3ZpZGVyLmFwaUtleX1gO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIERpZmZlcmVudCBlbmRwb2ludHMgYmFzZWQgb24gcHJvdmlkZXIgdHlwZSBhbmQgVVJMXG4gICAgbGV0IGVuZHBvaW50OiBzdHJpbmc7XG4gICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgZW5kcG9pbnQgPSBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvbW9kZWxzXCI7IC8vIE9wZW5Sb3V0ZXIgaGFzIGEgc3BlY2lmaWMgbW9kZWxzIGVuZHBvaW50XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBPcGVuQUktY29tcGF0aWJsZSBlbmRwb2ludHMsIGVuc3VyZSB3ZSdyZSB1c2luZyB0aGUgL3YxL21vZGVscyBwYXRoXG4gICAgICBjb25zdCBiYXNlVXJsID0gcHJvdmlkZXIuZW5kcG9pbnQucmVwbGFjZSgvXFwvKyQvLCBcIlwiKTsgLy8gUmVtb3ZlIHRyYWlsaW5nIHNsYXNoZXNcbiAgICAgIGVuZHBvaW50ID0gYmFzZVVybC5lbmRzV2l0aChcIi92MVwiKVxuICAgICAgICA/IGAke2Jhc2VVcmx9L21vZGVsc2BcbiAgICAgICAgOiBiYXNlVXJsLmVuZHNXaXRoKFwiL3YxL21vZGVsc1wiKVxuICAgICAgICA/IGJhc2VVcmxcbiAgICAgICAgOiBgJHtiYXNlVXJsfS92MS9tb2RlbHNgO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnMsXG4gICAgICAvLyBBZGQgdGltZW91dFxuICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDEwMDAwKSwgLy8gMTAgc2Vjb25kIHRpbWVvdXRcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJJbnZhbGlkIEFQSSBrZXkuIFBsZWFzZSBjaGVjayB5b3VyIEFQSSBrZXkgYW5kIHRyeSBhZ2Fpbi5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJBY2Nlc3MgZGVuaWVkLiBQbGVhc2UgdmVyaWZ5IHlvdXIgQVBJIGtleSBoYXMgdGhlIGNvcnJlY3QgcGVybWlzc2lvbnMuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQVBJIGVuZHBvaW50IG5vdCBmb3VuZC4gUGxlYXNlIGNoZWNrIHRoZSBVUkwgYW5kIHRyeSBhZ2Fpbi5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSFRUUCBlcnJvcjogJHtlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAvLyBBbGwgcHJvdmlkZXJzIHVzZSBPcGVuQUkgZm9ybWF0OiB7IGRhdGE6IFt7IGlkOiBzdHJpbmcsIC4uLiB9XSB9XG4gICAgcmV0dXJuIChkYXRhLmRhdGE/Lm1hcCgobW9kZWw6IGFueSkgPT4gbW9kZWwuaWQpIHx8IFtdKS5maWx0ZXIoXG4gICAgICAoaWQ6IHN0cmluZykgPT4gIWlkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJ3aGlzcGVyXCIpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSB1c2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2UgZnJvbSBhbiBlcnJvciBvYmplY3RcbiAgICovXG4gIHByaXZhdGUgZ2V0RXJyb3JNZXNzYWdlKGVycm9yOiBhbnkpOiBzdHJpbmcge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IubmFtZSA9PT0gXCJBYm9ydEVycm9yXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiQ29ubmVjdGlvbiB0aW1lZCBvdXQuIFBsZWFzZSBjaGVjayB5b3VyIGludGVybmV0IGNvbm5lY3Rpb24gYW5kIHRyeSBhZ2Fpbi5cIjtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIHRoZSBlcnJvciBtZXNzYWdlIGRpcmVjdGx5IHNpbmNlIHdlJ3ZlIGFscmVhZHkgbWFkZSBpdCB1c2VyLWZyaWVuZGx5XG4gICAgICAvLyBpbiB2YWxpZGF0ZU9wZW5Sb3V0ZXJLZXkgYW5kIGdldE1vZGVscyBtZXRob2RzXG4gICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcbiAgICB9XG5cbiAgICByZXR1cm4gXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIG9yIGNvbnRhY3Qgc3VwcG9ydCBpZiB0aGUgaXNzdWUgcGVyc2lzdHMuXCI7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgVGFza3NTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG5cbiAgcHJpdmF0ZSBsYXN0VGFza0ZpbGVSZW9yZGVyOiBudW1iZXI7XG4gIHByaXZhdGUgcmVvcmRlckRlYm91bmNlOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IocHVibGljIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgLy8gSW5pdGlhbGl6ZSBhcHAgYW5kIHNldHRpbmdzIGZpcnN0XG4gICAgdGhpcy5hcHAgPSBwbHVnaW4uYXBwO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBwbHVnaW4uc2V0dGluZ3M7XG5cbiAgICAvLyBUcmFjayBsYXN0IHJlb3JkZXIgdG8gcHJldmVudCBpbW1lZGlhdGUgcmUtZWRpdHMgY2F1c2luZyBpbmZpbml0ZSBsb29wczpcbiAgICB0aGlzLmxhc3RUYXNrRmlsZVJlb3JkZXIgPSAwO1xuICAgIHRoaXMucmVvcmRlckRlYm91bmNlID0gMDsgLy8gTm8gZGVsYXkgLSBwcm9jZXNzIGltbWVkaWF0ZWx5XG5cbiAgICAvLyBSZWdpc3RlciBldmVudCBmb3IgZGV0ZWN0aW5nIGNoYW5nZXMgdG8gdGhlIHRhc2tzIGZpbGU6XG4gICAgdGhpcy5yZWdpc3RlclRhc2tzRmlsZVdhdGNoZXIoKTtcbiAgfVxuXG4gIGFzeW5jIG9wZW5PckNyZWF0ZVRhc2tzRmlsZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0YXNrc0RpciA9IHRoaXMuc2V0dGluZ3MudGFza3NEaXJlY3Rvcnk7XG4gICAgY29uc3QgZmlsZU5hbWUgPSBgJHt0YXNrc0Rpcn0vVGFza3MubWRgO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKHRhc2tzRGlyKTtcblxuICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgVGFza3MubWQgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCEoYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5leGlzdHMoZmlsZU5hbWUpKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZU5hbWUsIGAjIFRhc2tzXFxuXFxuLSBbIF0gU2FtcGxlIHRhc2tcXG5gKTtcbiAgICAgIH1cblxuICAgICAgLy8gT3BlbiB0aGUgZmlsZVxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlTmFtZSk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGZpbGUgaXMgYWxyZWFkeSBvcGVuIGluIGFueSBsZWFmXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZVxuICAgICAgICAgIC5nZXRMZWF2ZXNPZlR5cGUoXCJtYXJrZG93blwiKVxuICAgICAgICAgIC5maW5kKChsZWFmKSA9PiBsZWFmLnZpZXcuZ2V0U3RhdGUoKS5maWxlID09PSBmaWxlLnBhdGgpO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0xlYWYpIHtcbiAgICAgICAgICAvLyBGb2N1cyBleGlzdGluZyB0YWJcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihleGlzdGluZ0xlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gT3BlbiBpbiBuZXcgdGFiXG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShmaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGhhbmRsZSB0YXNrcyBmaWxlOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyVGFza3NGaWxlV2F0Y2hlcigpOiB2b2lkIHtcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAudmF1bHQub24oXCJtb2RpZnlcIiwgYXN5bmMgKGZpbGUpID0+IHtcbiAgICAgICAgY29uc3QgdGFza3NEaXIgPSB0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5O1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgbW9kaWZpZWQgZmlsZSBpcyBhIG1hcmtkb3duIGZpbGUgd2l0aGluIHRoZSB0YXNrcyBkaXJlY3RvcnlcbiAgICAgICAgaWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKHRhc2tzRGlyKSAmJiBmaWxlLnBhdGguZW5kc1dpdGgoXCIubWRcIikpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlb3JkZXJDb21wbGV0ZWRUYXNrcyhmaWxlIGFzIFRGaWxlKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZW9yZGVyQ29tcGxldGVkVGFza3MoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBJZiBtb3ZpbmcgY29tcGxldGVkIHRhc2tzIGRvd24gaXMgZGlzYWJsZWQsIGRvIG5vdGhpbmdcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MubW92ZUNvbXBsZXRlZFRhc2tzRG93bikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNraXAgaWYgZmlsZSBpcyBub3QgaW4gdGFza3MgZGlyZWN0b3J5XG4gICAgaWYgKCFmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNraXAgaWYgbm90IGEgbWFya2Rvd24gZmlsZVxuICAgIGlmICghZmlsZS5wYXRoLmVuZHNXaXRoKFwiLm1kXCIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgb3JpZ2luYWwgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgIGNvbnN0IHJlb3JkZXJlZCA9IHRoaXMucmVvcmRlckNvbnRlbnQob3JpZ2luYWwpO1xuICAgIC8vIElmIG5vIGNoYW5nZSwgZG8gbm90aGluZyB0byBwcmV2ZW50IGFuIGVuZGxlc3MgbW9kaWZ5IGxvb3BcbiAgICBpZiAocmVvcmRlcmVkICE9PSBvcmlnaW5hbCkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIHJlb3JkZXJlZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW9yZGVyQ29udGVudChjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBvdXRwdXQ6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IGxpc3RCdWZmZXI6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdCBmbHVzaEJ1ZmZlciA9ICgpID0+IHtcbiAgICAgIGlmIChsaXN0QnVmZmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3V0cHV0LnB1c2goLi4udGhpcy5yZW9yZGVyTGlzdEJsb2NrKGxpc3RCdWZmZXIpKTtcbiAgICAgICAgbGlzdEJ1ZmZlciA9IFtdO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIC8vIElmIHRoZSBsaW5lIGlzIGEgdGFzayBsaXN0IGl0ZW0sIGFkZCB0byBvdXIgYnVmZmVyOyBvdGhlcndpc2UgZmx1c2ggaXQuXG4gICAgICBpZiAoL15cXHMqLVxccypcXFtbeFxcc11cXF0vLnRlc3QobGluZSkpIHtcbiAgICAgICAgbGlzdEJ1ZmZlci5wdXNoKGxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmx1c2hCdWZmZXIoKTtcbiAgICAgICAgb3V0cHV0LnB1c2gobGluZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGZsdXNoQnVmZmVyKCk7XG4gICAgcmV0dXJuIG91dHB1dC5qb2luKFwiXFxuXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGEgY29udGlndW91cyBibG9jayBvZiB0YXNrIGxpbmVzLCBidWlsZCBhIHRyZWUgYmFzZWQgb24gaW5kZW50IGxldmVsc1xuICAgKiBhbmQgdGhlbiByZWN1cnNpdmVseSByZW9yZGVyIGVhY2ggZ3JvdXAgc28gdGhhdCB3aXRoaW4gZWFjaCBncm91cCwgaW5jb21wbGV0ZVxuICAgKiB0YXNrcyBhcHBlYXIgYWJvdmUgY29tcGxldGVkIHRhc2tzIHdoaWxlIGtlZXBpbmcgbmVzdGVkIHN1YnRhc2tzIHdpdGggdGhlaXIgcGFyZW50LlxuICAgKi9cbiAgcHJpdmF0ZSByZW9yZGVyTGlzdEJsb2NrKGxpbmVzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICB0eXBlIFRhc2tOb2RlID0ge1xuICAgICAgbGluZTogc3RyaW5nO1xuICAgICAgY2hpbGRyZW46IFRhc2tOb2RlW107XG4gICAgICBpbmRlbnQ6IG51bWJlcjtcbiAgICB9O1xuXG4gICAgLy8gSGVscGVyOiBjb3VudCBsZWFkaW5nIHdoaXRlc3BhY2UgKGluZGVudGF0aW9uKVxuICAgIGZ1bmN0aW9uIGdldEluZGVudChsaW5lOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLm1hdGNoKC9eKFxccyopLyk7XG4gICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXS5sZW5ndGggOiAwO1xuICAgIH1cblxuICAgIC8vIEJ1aWxkIHRoZSB0cmVlOiBlYWNoIHRhc2sgYmVjb21lcyBhIG5vZGUsIGFuZCBzdWJzZXF1ZW50IGxpbmVzIHdpdGggZ3JlYXRlciBpbmRlbnQgYmVjb21lIGl0cyBjaGlsZHJlbi5cbiAgICBjb25zdCBub2RlczogVGFza05vZGVbXSA9IFtdO1xuICAgIGNvbnN0IHN0YWNrOiBUYXNrTm9kZVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIGNvbnN0IGluZGVudCA9IGdldEluZGVudChsaW5lKTtcbiAgICAgIGNvbnN0IG5vZGU6IFRhc2tOb2RlID0geyBsaW5lLCBjaGlsZHJlbjogW10sIGluZGVudCB9O1xuICAgICAgLy8gUG9wIGZyb20gdGhlIHN0YWNrIHVudGlsIGZpbmRpbmcgYSBub2RlIHdpdGggbG93ZXIgaW5kZW50YXRpb25cbiAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwICYmIGluZGVudCA8PSBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5pbmRlbnQpIHtcbiAgICAgICAgc3RhY2sucG9wKCk7XG4gICAgICB9XG4gICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIHN0YWNrLnB1c2gobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBBZGQgYXMgYSBjaGlsZCBvZiB0aGUgbm9kZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFja1xuICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgICAgICBzdGFjay5wdXNoKG5vZGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlY3Vyc2l2ZWx5IHJlb3JkZXIgbm9kZXMgYnkgbW92aW5nIGNvbXBsZXRlZCB0YXNrcyAodGhvc2Ugd2hvc2UgY2hlY2tib3ggaXMgW3hdKSBiZWxvdyBpbmNvbXBsZXRlIG9uZXMuXG4gICAgZnVuY3Rpb24gcmVvcmRlck5vZGVzKG5vZGVzOiBUYXNrTm9kZVtdKTogVGFza05vZGVbXSB7XG4gICAgICAvLyBGaXJzdCwgcHJvY2VzcyBjaGlsZHJlbiByZWN1cnNpdmVseS5cbiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcykge1xuICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IHJlb3JkZXJOb2Rlcyhub2RlLmNoaWxkcmVuKTtcbiAgICAgICAgICAvLyBTb3J0IGNoaWxkcmVuIHNvIHRoYXQgaW5jb21wbGV0ZSB0YXNrcyBjb21lIGJlZm9yZSBjb21wbGV0ZSBvbmVzLlxuICAgICAgICAgIG5vZGUuY2hpbGRyZW4uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgYUNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChhLmxpbmUpID8gMSA6IDA7XG4gICAgICAgICAgICBjb25zdCBiQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGIubGluZSkgPyAxIDogMDtcbiAgICAgICAgICAgIHJldHVybiBhQ29tcGxldGUgLSBiQ29tcGxldGU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFRoZW4gc29ydCB0aGUgY3VycmVudCBsZXZlbCBvZiBub2RlcyBzaW1pbGFybHkuXG4gICAgICBub2Rlcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIGNvbnN0IGFDb21wbGV0ZSA9IC9eXFxzKi1cXHMqXFxbeFxcXS9pLnRlc3QoYS5saW5lKSA/IDEgOiAwO1xuICAgICAgICBjb25zdCBiQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGIubGluZSkgPyAxIDogMDtcbiAgICAgICAgcmV0dXJuIGFDb21wbGV0ZSAtIGJDb21wbGV0ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5vZGVzO1xuICAgIH1cblxuICAgIGNvbnN0IHJlb3JkZXJlZE5vZGVzID0gcmVvcmRlck5vZGVzKG5vZGVzKTtcblxuICAgIC8vIEZsYXR0ZW4gdGhlIHRyZWUgYmFjayB0byBhbiBhcnJheSBvZiBsaW5lc1xuICAgIGNvbnN0IGZsYXR0ZW5lZDogc3RyaW5nW10gPSBbXTtcbiAgICBmdW5jdGlvbiBmbGF0dGVuKG5vZGVzOiBUYXNrTm9kZVtdKSB7XG4gICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICAgICAgZmxhdHRlbmVkLnB1c2gobm9kZS5saW5lKTtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZsYXR0ZW4obm9kZS5jaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZmxhdHRlbihyZW9yZGVyZWROb2Rlcyk7XG4gICAgcmV0dXJuIGZsYXR0ZW5lZDtcbiAgfVxufVxuIiwgImltcG9ydCB7IFN5c3RlbVNjdWxwdE1vZGVsLCBDdXN0b21Qcm92aWRlciwgRmF2b3JpdGVNb2RlbCB9IGZyb20gXCIuLi90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyU2VydmljZSB9IGZyb20gXCIuL0N1c3RvbVByb3ZpZGVyU2VydmljZVwiO1xuXG5leHBvcnQgY2xhc3MgTW9kZWxTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBjdXN0b21Qcm92aWRlclNlcnZpY2U6IEN1c3RvbVByb3ZpZGVyU2VydmljZTtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IE1vZGVsU2VydmljZTtcbiAgcHJpdmF0ZSBsb2FkaW5nUHJvbWlzZTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UgPSBjdXN0b21Qcm92aWRlclNlcnZpY2U7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2VcbiAgKTogTW9kZWxTZXJ2aWNlIHtcbiAgICBpZiAoIU1vZGVsU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgTW9kZWxTZXJ2aWNlLmluc3RhbmNlID0gbmV3IE1vZGVsU2VydmljZShwbHVnaW4sIGN1c3RvbVByb3ZpZGVyU2VydmljZSk7XG4gICAgfVxuICAgIHJldHVybiBNb2RlbFNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBtb2RlbHMgKHN5c3RlbSBhbmQgY3VzdG9tKS5cbiAgICogVGhpcyBzaG91bGQgYmUgdGhlIG9ubHkgbWV0aG9kIHVzZWQgdG8gZ2V0IG1vZGVscyB0aHJvdWdob3V0IHRoZSBhcHAuXG4gICAqIE5vdyBhbHdheXMgZmV0Y2hlcyBmcmVzaCBkYXRhIGZyb20gdGhlIHNlcnZlci5cbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgLy8gSWYgYWxyZWFkeSBsb2FkaW5nLCByZXR1cm4gdGhlIGV4aXN0aW5nIHByb21pc2UgdG8gcHJldmVudCBjb25jdXJyZW50IHJlcXVlc3RzXG4gICAgaWYgKHRoaXMubG9hZGluZ1Byb21pc2UpIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRpbmdQcm9taXNlO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IG5ldyBsb2FkXG4gICAgdGhpcy5sb2FkaW5nUHJvbWlzZSA9IHRoaXMubG9hZE1vZGVscygpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLmxvYWRpbmdQcm9taXNlO1xuICAgICAgcmV0dXJuIG1vZGVscztcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5sb2FkaW5nUHJvbWlzZSA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEludGVybmFsIG1ldGhvZCB0byBsb2FkIG1vZGVscyBmcm9tIGJvdGggU3lzdGVtU2N1bHB0J3MgQVBJIGFuZCBjdXN0b20gcHJvdmlkZXJzLlxuICAgKiBOb3cgYWx3YXlzIGZldGNoZXMgZnJlc2ggZGF0YS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9hZE1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gTG9hZCBzeXN0ZW0gbW9kZWxzIChub3cgb25seSByZXR1cm5zIHN5c3RlbSBtb2RlbHMpXG4gICAgICBjb25zdCBzeXN0ZW1Nb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5haVNlcnZpY2UuZ2V0TW9kZWxzKCk7XG5cbiAgICAgIC8vIExvYWQgY3VzdG9tIHByb3ZpZGVyIG1vZGVscyAoYWx3YXlzIGZyZXNoKVxuICAgICAgY29uc3QgY3VzdG9tTW9kZWxzID0gYXdhaXQgdGhpcy5sb2FkQ3VzdG9tUHJvdmlkZXJNb2RlbHMoKTtcblxuICAgICAgLy8gQ29tYmluZSBhbGwgbW9kZWxzXG4gICAgICBjb25zdCBhbGxNb2RlbHMgPSBbLi4uc3lzdGVtTW9kZWxzLCAuLi5jdXN0b21Nb2RlbHNdO1xuXG4gICAgICAvLyBTZXQgZmF2b3JpdGUgc3RhdHVzXG4gICAgICBjb25zdCBmYXZvcml0ZU1vZGVscyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzIHx8IFtdO1xuICAgICAgZm9yIChjb25zdCBtb2RlbCBvZiBhbGxNb2RlbHMpIHtcbiAgICAgICAgbW9kZWwuaXNGYXZvcml0ZSA9IGZhdm9yaXRlTW9kZWxzLnNvbWUoXG4gICAgICAgICAgKGZhdikgPT4gZmF2Lm1vZGVsSWQgPT09IG1vZGVsLmlkICYmIGZhdi5wcm92aWRlciA9PT0gbW9kZWwucHJvdmlkZXJcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFsbE1vZGVscztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIG1vZGVsczpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdOyAvLyBSZXR1cm4gZW1wdHkgYXJyYXkgb24gZXJyb3IgaW5zdGVhZCBvZiB1c2luZyBjYWNoZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkcyBtb2RlbHMgZnJvbSBhbGwgZW5hYmxlZCBjdXN0b20gcHJvdmlkZXJzLlxuICAgKiBOb3cgYWx3YXlzIGZldGNoZXMgZnJlc2ggZGF0YS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9hZEN1c3RvbVByb3ZpZGVyTW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIGNvbnN0IHsgY3VzdG9tUHJvdmlkZXJzIH0gPSB0aGlzLnBsdWdpbi5zZXR0aW5ncztcblxuICAgIGNvbnN0IGZldGNoZXMgPSBjdXN0b21Qcm92aWRlcnNcbiAgICAgIC5maWx0ZXIoKHApID0+IHAuaXNFbmFibGVkKVxuICAgICAgLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIEFsd2F5cyB0ZXN0IGNvbm5lY3Rpb24gYW5kIGdldCBmcmVzaCBtb2RlbHNcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZS50ZXN0Q29ubmVjdGlvbihwKTtcbiAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0Lm1vZGVscykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQ3VzdG9tTW9kZWxzKHAsIHJlc3VsdC5tb2RlbHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBtb2RlbHMgZnJvbSAke3AubmFtZX06YCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGZldGNoZXMpO1xuICAgIHJldHVybiByZXN1bHRzLmZsYXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIFN5c3RlbVNjdWxwdE1vZGVsIG9iamVjdHMgZm9yIGEgZ2l2ZW4gY3VzdG9tIHByb3ZpZGVyLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVDdXN0b21Nb2RlbHMoXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyLFxuICAgIG1vZGVsSWRzOiBzdHJpbmdbXVxuICApOiBTeXN0ZW1TY3VscHRNb2RlbFtdIHtcbiAgICByZXR1cm4gbW9kZWxJZHMubWFwKChtb2RlbElkKSA9PiAoe1xuICAgICAgaWQ6IG1vZGVsSWQsXG4gICAgICBuYW1lOiBtb2RlbElkLFxuICAgICAgcHJvdmlkZXI6IHByb3ZpZGVyLm5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgIGlzRmF2b3JpdGU6IGZhbHNlLFxuICAgICAgY29udGV4dF9sZW5ndGg6IDAsXG4gICAgICBjYXBhYmlsaXRpZXM6IFtdLFxuICAgICAgcHJpY2luZzoge1xuICAgICAgICBwcm9tcHQ6IFwiMFwiLFxuICAgICAgICBjb21wbGV0aW9uOiBcIjBcIixcbiAgICAgICAgaW1hZ2U6IFwiMFwiLFxuICAgICAgICByZXF1ZXN0OiBcIjBcIixcbiAgICAgIH0sXG4gICAgICBhcmNoaXRlY3R1cmU6IHtcbiAgICAgICAgbW9kYWxpdHk6IFwidGV4dC0+dGV4dFwiLFxuICAgICAgICB0b2tlbml6ZXI6IFwiXCIsXG4gICAgICAgIGluc3RydWN0X3R5cGU6IG51bGwsXG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb246IGAke3Byb3ZpZGVyLm5hbWV9IG1vZGVsYCxcbiAgICAgIGlkZW50aWZpZXI6IHtcbiAgICAgICAgcHJvdmlkZXJJZDogcHJvdmlkZXIubmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICBtb2RlbElkOiBtb2RlbElkLFxuICAgICAgICBkaXNwbGF5TmFtZTogbW9kZWxJZCxcbiAgICAgIH0sXG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSBmYXZvcml0ZSBzdGF0dXMgZm9yIGEgbW9kZWxcbiAgICovXG4gIHB1YmxpYyBhc3luYyB0b2dnbGVGYXZvcml0ZShtb2RlbDogU3lzdGVtU2N1bHB0TW9kZWwpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBpc05vd0Zhdm9yaXRlID0gIW1vZGVsLmlzRmF2b3JpdGU7XG4gICAgbW9kZWwuaXNGYXZvcml0ZSA9IGlzTm93RmF2b3JpdGU7XG5cbiAgICAvLyBVcGRhdGUgcGx1Z2luIHNldHRpbmdzXG4gICAgaWYgKGlzTm93RmF2b3JpdGUpIHtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLnB1c2goe1xuICAgICAgICBwcm92aWRlcjogbW9kZWwucHJvdmlkZXIsXG4gICAgICAgIG1vZGVsSWQ6IG1vZGVsLmlkLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzID1cbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMuZmlsdGVyKFxuICAgICAgICAgIChmYXYpID0+XG4gICAgICAgICAgICAhKGZhdi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmYXYucHJvdmlkZXIgPT09IG1vZGVsLnByb3ZpZGVyKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7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
