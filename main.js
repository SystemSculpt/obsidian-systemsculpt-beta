/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[Object.keys(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// src/services/SystemPromptService.ts
var _SystemPromptService, SystemPromptService;
var init_SystemPromptService = __esm({
  "src/services/SystemPromptService.ts"() {
    _SystemPromptService = class {
      constructor(app) {
        this.app = app;
        if (!_SystemPromptService.initPromise && !_SystemPromptService.isInitializing) {
          _SystemPromptService.initializeCache();
        }
      }
      static setSystemSculptService(service) {
        _SystemPromptService.systemSculptService = service;
      }
      static isCacheValid() {
        if (!_SystemPromptService.cache)
          return false;
        const now = Date.now();
        return now - _SystemPromptService.cache.timestamp < _SystemPromptService.CACHE_DURATION;
      }
      static updateCache(prompts) {
        const byId = {};
        prompts.forEach((prompt) => {
          byId[prompt.id] = prompt;
        });
        _SystemPromptService.cache = {
          prompts,
          timestamp: Date.now(),
          byId
        };
      }
      static initializeCache() {
        if (_SystemPromptService.initPromise) {
          return _SystemPromptService.initPromise;
        }
        if (!_SystemPromptService.systemSculptService) {
          return Promise.reject(new Error("SystemSculptService not initialized"));
        }
        _SystemPromptService.isInitializing = true;
        _SystemPromptService.initPromise = fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`).then(async (response) => {
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
        }).catch((error) => {
          console.error("Error initializing system prompts cache:", error);
          _SystemPromptService.initPromise = null;
        }).finally(() => {
          _SystemPromptService.isInitializing = false;
        });
        return _SystemPromptService.initPromise;
      }
      async ensureCacheInitialized() {
        if (_SystemPromptService.isCacheValid())
          return;
        if (_SystemPromptService.initPromise) {
          await _SystemPromptService.initPromise;
          return;
        }
        await _SystemPromptService.initializeCache();
      }
      async getSystemPrompts() {
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && _SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
          return data.prompts;
        } catch (error) {
          console.error("Error fetching system prompts:", error);
          if (_SystemPromptService.cache) {
            return _SystemPromptService.cache.prompts;
          }
          throw error;
        }
      }
      async getSystemPromptById(id) {
        var _a, _b, _c;
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && ((_a = _SystemPromptService.cache) == null ? void 0 : _a.byId[id])) {
            return _SystemPromptService.cache.byId[id];
          }
          await this.getSystemPrompts();
          return ((_b = _SystemPromptService.cache) == null ? void 0 : _b.byId[id]) || null;
        } catch (error) {
          console.error(`Error fetching system prompt ${id}:`, error);
          if ((_c = _SystemPromptService.cache) == null ? void 0 : _c.byId[id]) {
            return _SystemPromptService.cache.byId[id];
          }
          throw error;
        }
      }
      async getSystemPromptTemplate() {
        try {
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts/template`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompt template: ${response.statusText}`);
          }
          const data = await response.json();
          return data.template;
        } catch (error) {
          console.error("Error fetching system prompt template:", error);
          throw error;
        }
      }
      async refreshCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
        await _SystemPromptService.initializeCache();
      }
      static clearCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
      }
    };
    SystemPromptService = _SystemPromptService;
    SystemPromptService.cache = null;
    SystemPromptService.CACHE_DURATION = 60 * 60 * 1e3;
    SystemPromptService.initPromise = null;
    SystemPromptService.isInitializing = false;
  }
});

// src/utils/errors.ts
function getErrorMessage(code, model) {
  const message = ERROR_MESSAGES[code];
  if (typeof message === "function") {
    return message(model);
  }
  return message;
}
var ERROR_CODES, ERROR_MESSAGES, SystemSculptError;
var init_errors = __esm({
  "src/utils/errors.ts"() {
    ERROR_CODES = {
      INVALID_LICENSE: "INVALID_LICENSE",
      LICENSE_EXPIRED: "LICENSE_EXPIRED",
      LICENSE_DISABLED: "LICENSE_DISABLED",
      PRO_REQUIRED: "PRO_REQUIRED",
      MODEL_UNAVAILABLE: "MODEL_UNAVAILABLE",
      MODEL_REQUEST_ERROR: "MODEL_REQUEST_ERROR",
      STREAM_ERROR: "STREAM_ERROR",
      INVALID_RESPONSE: "INVALID_RESPONSE",
      NO_IMAGE: "NO_IMAGE",
      FILE_NOT_FOUND: "FILE_NOT_FOUND",
      FILE_TOO_LARGE: "FILE_TOO_LARGE",
      UNSUPPORTED_FORMAT: "UNSUPPORTED_FORMAT",
      PROCESSING_ERROR: "PROCESSING_ERROR",
      UNKNOWN_ERROR: "UNKNOWN_ERROR",
      QUOTA_EXCEEDED: "QUOTA_EXCEEDED"
    };
    ERROR_MESSAGES = {
      [ERROR_CODES.INVALID_LICENSE]: "Invalid license key. Please check and try again.",
      [ERROR_CODES.LICENSE_EXPIRED]: "Your license has expired.",
      [ERROR_CODES.LICENSE_DISABLED]: "This license has been disabled.",
      [ERROR_CODES.PRO_REQUIRED]: "This feature requires a Pro subscription. Please upgrade.",
      [ERROR_CODES.MODEL_UNAVAILABLE]: (model) => `Model ${model || ""} is currently unavailable.`,
      [ERROR_CODES.MODEL_REQUEST_ERROR]: (model) => `Model ${model || ""} cannot process this request.`,
      [ERROR_CODES.STREAM_ERROR]: "Streaming failed. Please try again.",
      [ERROR_CODES.INVALID_RESPONSE]: "Invalid response received from server. Please try again.",
      [ERROR_CODES.UNKNOWN_ERROR]: "An unexpected error occurred. Please try again or contact support.",
      [ERROR_CODES.QUOTA_EXCEEDED]: "You have exceeded your quota. Please upgrade your plan.",
      [ERROR_CODES.NO_IMAGE]: "No image in clipboard",
      [ERROR_CODES.FILE_NOT_FOUND]: "File not found",
      [ERROR_CODES.FILE_TOO_LARGE]: "File too large (max 10MB)",
      [ERROR_CODES.UNSUPPORTED_FORMAT]: "Unsupported file format",
      [ERROR_CODES.PROCESSING_ERROR]: "Failed to process file"
    };
    SystemSculptError = class extends Error {
      constructor(message, code = ERROR_CODES.UNKNOWN_ERROR, statusCode = 500, metadata) {
        super(message);
        this.code = code;
        this.statusCode = statusCode;
        this.metadata = metadata;
        this.name = "SystemSculptError";
      }
    };
  }
});

// src/utils/ImageProcessor.ts
var _ImageProcessor, ImageProcessor;
var init_ImageProcessor = __esm({
  "src/utils/ImageProcessor.ts"() {
    init_errors();
    _ImageProcessor = class {
      static async processImage(file, app) {
        if (!file) {
          throw new SystemSculptError("File not found", "FILE_NOT_FOUND", 404);
        }
        if (file.stat.size > _ImageProcessor.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        const extension = file.extension.toLowerCase();
        if (!_ImageProcessor.SUPPORTED_FORMATS.has(extension)) {
          throw new SystemSculptError("Unsupported image format", "UNSUPPORTED_FORMAT", 415);
        }
        try {
          const arrayBuffer = await app.vault.readBinary(file);
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              const dataUrl = reader.result;
              resolve(dataUrl);
            };
            reader.onerror = () => reject(reader.error);
            const type = `image/${extension === "jpg" ? "jpeg" : extension}`;
            const blob = new Blob([arrayBuffer], { type });
            reader.readAsDataURL(blob);
          });
          return base64;
        } catch (error) {
          console.error("Image processing failed:", error);
          throw new SystemSculptError("Failed to process image", "PROCESSING_ERROR", 500);
        }
      }
      static async processClipboardImage(clipboardData) {
        const file = clipboardData.files[0];
        if (!file || !file.type.startsWith("image/")) {
          throw new SystemSculptError("No image in clipboard", "NO_IMAGE", 400);
        }
        if (file.size > this.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(reader.error);
          reader.readAsDataURL(file);
        });
      }
    };
    ImageProcessor = _ImageProcessor;
    ImageProcessor.MAX_FILE_SIZE = 10 * 1024 * 1024;
    ImageProcessor.SUPPORTED_FORMATS = new Set([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp"
    ]);
  }
});

// src/constants/api.ts
var API_BASE_URL, SYSTEMSCULPT_API_ENDPOINTS, SYSTEMSCULPT_API_HEADERS;
var init_api = __esm({
  "src/constants/api.ts"() {
    API_BASE_URL = window.location.hostname === "localhost" ? "http://localhost:3001/api/v1" : "https://api.systemsculpt.com/api/v1";
    SYSTEMSCULPT_API_ENDPOINTS = {
      LICENSE: {
        VALIDATE: (key) => `/api/v1/license/validate/${key}`
      },
      MODELS: {
        LIST: "/api/v1/models",
        GET: (modelId) => `/api/v1/models/${modelId}`
      },
      CHAT: {
        COMPLETIONS: "/api/v1/chat/completions"
      },
      SYSTEM_PROMPTS: {
        GET: (id) => `/api/v1/system-prompts/${id}`,
        LIST: "/api/v1/system-prompts"
      },
      DOCUMENTS: {
        PROCESS: "/api/v1/documents/process",
        GET: (id) => `/api/v1/documents/${id}`,
        DOWNLOAD: (id) => `/api/v1/documents/${id}/download`
      }
    };
    SYSTEMSCULPT_API_HEADERS = {
      DEFAULT: {
        "Content-Type": "application/json"
      },
      WITH_LICENSE: (licenseKey) => ({
        ...SYSTEMSCULPT_API_HEADERS.DEFAULT,
        Authorization: `Bearer ${licenseKey}`
      })
    };
  }
});

// src/services/SystemSculptService.ts
function generateUUID() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var import_obsidian, _SystemSculptService, SystemSculptService;
var init_SystemSculptService = __esm({
  "src/services/SystemSculptService.ts"() {
    import_obsidian = __toModule(require("obsidian"));
    init_SystemPromptService();
    init_errors();
    init_ImageProcessor();
    init_api();
    _SystemSculptService = class {
      constructor(settings, app) {
        this.isInsideThinkTags = false;
        this.hasLoggedDevMode = false;
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
        this.app = app;
      }
      get baseUrl() {
        if (!this.hasLoggedDevMode) {
          this.hasLoggedDevMode = true;
        }
        if (this.settings.developmentMode) {
          return this.settings.serverUrl;
        }
        return "https://api.systemsculpt.com";
      }
      get extractionsDirectory() {
        var _a;
        return (_a = this.settings.extractionsDirectory) != null ? _a : "";
      }
      static getInstance(settings, app) {
        if (!_SystemSculptService.instance) {
          _SystemSculptService.instance = new _SystemSculptService(settings, app);
        } else {
          _SystemSculptService.instance.settings = settings;
          _SystemSculptService.instance.licenseKey = settings.licenseKey;
        }
        return _SystemSculptService.instance;
      }
      updateSettings(settings) {
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
      }
      async makeRequest(endpoint, options = {}) {
        if (options.requiresPro && !endpoint.includes("/license/validate")) {
          const isValid = await this.validateLicense(true);
          if (!isValid) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.PRO_REQUIRED), ERROR_CODES.PRO_REQUIRED, 403);
          }
        }
        const headers = this.licenseKey ? SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey) : SYSTEMSCULPT_API_HEADERS.DEFAULT;
        const url = `${this.baseUrl}${endpoint}`;
        const response = await (0, import_obsidian.requestUrl)({
          url,
          method: options.method || "GET",
          headers: {
            ...headers,
            ...options.headers || {}
          },
          body: options.body,
          throw: false
        });
        let apiResponse;
        try {
          apiResponse = response.json;
        } catch (e) {
          throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, response.status);
        }
        if (response.status !== 200 || apiResponse.status === "error") {
          this.handleApiError(endpoint, response, apiResponse);
        }
        return apiResponse.data !== void 0 ? apiResponse.data : apiResponse;
      }
      handleApiError(endpoint, response, apiResponse) {
        if (apiResponse.error) {
          const errorCode = apiResponse.error.code || ERROR_CODES.UNKNOWN_ERROR;
          const statusCode = apiResponse.error.statusCode || response.status;
          const errorMessage = getErrorMessage(errorCode, apiResponse.error.model);
          const metadata = {};
          if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
            metadata.shouldResubmit = true;
            metadata.model = apiResponse.error.model;
          }
          throw new SystemSculptError(errorMessage, errorCode, statusCode, metadata);
        }
        throw new SystemSculptError(getErrorMessage(ERROR_CODES.UNKNOWN_ERROR), ERROR_CODES.UNKNOWN_ERROR, response.status);
      }
      async handleStreamError(response, isCustomProvider = false) {
        var _a, _b, _c, _d;
        console.error("Stream error response:", {
          status: response.status,
          statusText: response.statusText,
          contentType: response.headers.get("content-type"),
          isCustomProvider
        });
        let errorCode = ERROR_CODES.STREAM_ERROR;
        let metadata = {};
        try {
          const errorData = await response.json();
          console.error("Stream error data:", errorData);
          if (isCustomProvider) {
            metadata.rawError = errorData;
            metadata.provider = "custom";
            if (response.status === 401) {
              errorCode = ERROR_CODES.INVALID_LICENSE;
              throw new SystemSculptError(((_a = errorData.error) == null ? void 0 : _a.message) || "Invalid API key for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 429) {
              errorCode = ERROR_CODES.QUOTA_EXCEEDED;
              throw new SystemSculptError(((_b = errorData.error) == null ? void 0 : _b.message) || "Rate limit exceeded for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 404) {
              errorCode = ERROR_CODES.MODEL_UNAVAILABLE;
              throw new SystemSculptError(((_c = errorData.error) == null ? void 0 : _c.message) || "Model not found or endpoint incorrect", errorCode, response.status, metadata);
            }
            throw new SystemSculptError(((_d = errorData.error) == null ? void 0 : _d.message) || response.statusText, errorCode, response.status, metadata);
          }
          if (errorData.error) {
            errorCode = errorData.error.code || ERROR_CODES.STREAM_ERROR;
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata = {
                model: errorData.error.model,
                shouldResubmit: true,
                rawError: errorData
              };
            }
          }
        } catch (e) {
          console.error("Error parsing error response:", e);
          if (e instanceof SystemSculptError) {
            throw e;
          }
          errorCode = ERROR_CODES.STREAM_ERROR;
        }
        throw new SystemSculptError(getErrorMessage(errorCode, metadata.model), errorCode, response.status, metadata);
      }
      async validateLicense(forceCheck = false) {
        if (!this.licenseKey)
          return false;
        try {
          await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
            method: "GET",
            headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
          });
          return true;
        } catch (e) {
          return false;
        }
      }
      async getModels() {
        try {
          const response = await this.makeRequest("/api/v1/models", {
            method: "GET"
          });
          if (!response || !Array.isArray(response.models)) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, 500);
          }
          const systemsculptModels = response.models.map((model) => ({
            ...model,
            provider: "systemsculpt"
          }));
          return systemsculptModels;
        } catch (error) {
          throw error;
        }
      }
      async getTokenBalance() {
        const isValid = await this.validateLicense(true);
        if (!isValid)
          return 0;
        const licenseInfo = await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
          method: "GET",
          headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
        });
        return licenseInfo.credits_balance || 0;
      }
      async getContextFileContents(filePath) {
        try {
          const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
          const cleanPath = linkText.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            if (resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
              const base64 = await ImageProcessor.processImage(resolvedFile, this.app);
              return { type: "image", base64 };
            }
            const content = await this.app.vault.read(resolvedFile);
            return content;
          }
          const fileName = cleanPath.split("/").pop();
          if (fileName) {
            const allFiles = this.app.vault.getFiles();
            const matchingFile = allFiles.find((f) => f.name === fileName);
            if (matchingFile) {
              if (matchingFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
                const base64 = await ImageProcessor.processImage(matchingFile, this.app);
                return { type: "image", base64 };
              }
              const content = await this.app.vault.read(matchingFile);
              return content;
            }
          }
          return null;
        } catch (error) {
          return null;
        }
      }
      async buildContextMessageFromFile(filePath) {
        const content = await this.getContextFileContents(filePath);
        const displayName = filePath.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
        if (content) {
          if (typeof content === "string") {
            return {
              role: "user",
              content: `Context from ${displayName}:

${content}`,
              message_id: generateUUID()
            };
          } else if (content.type === "image") {
            return {
              role: "user",
              content: [
                {
                  type: "text",
                  text: `Context from ${displayName}:

`
                },
                {
                  type: "image_url",
                  image_url: {
                    url: `data:image/png;base64,${content.base64.replace(/^data:.*;base64,/, "")}`
                  }
                }
              ],
              message_id: generateUUID()
            };
          }
        }
        return null;
      }
      async prepareMessagesWithContext(messages, contextFiles, systemPromptType, systemPromptPath) {
        const preparedMessages = [];
        let systemPromptContent;
        if (systemPromptType === "custom" && systemPromptPath) {
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(systemPromptPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            systemPromptContent = await this.app.vault.read(resolvedFile);
          } else {
            const fileWithExt = this.app.vault.getAbstractFileByPath(`${systemPromptPath}.md`);
            if (fileWithExt instanceof import_obsidian.TFile) {
              systemPromptContent = await this.app.vault.read(fileWithExt);
            } else {
              const fileInSystemPromptsDir = this.app.vault.getAbstractFileByPath(`SystemSculpt/System Prompts/${systemPromptPath}.md`);
              if (fileInSystemPromptsDir instanceof import_obsidian.TFile) {
                systemPromptContent = await this.app.vault.read(fileInSystemPromptsDir);
              }
            }
          }
        } else if (systemPromptType) {
          try {
            const systemPromptService = new SystemPromptService(this.app);
            const preset = await systemPromptService.getSystemPromptById(systemPromptType);
            if (preset) {
              systemPromptContent = preset.systemPrompt;
            }
          } catch (error) {
          }
        }
        if (systemPromptContent) {
          preparedMessages.push({
            role: "system",
            content: systemPromptContent,
            message_id: crypto.randomUUID(),
            systemPromptType,
            systemPromptPath
          });
        }
        const documentIds = [];
        for (const filePath of contextFiles) {
          if (filePath.startsWith("doc:")) {
            const documentId = filePath.substring(4);
            documentIds.push(documentId);
          } else {
            const contextMessage = await this.buildContextMessageFromFile(filePath);
            if (contextMessage) {
              preparedMessages.push(contextMessage);
            }
          }
        }
        if (documentIds.length > 0) {
          const firstMessage = messages[0];
          if (firstMessage) {
            firstMessage.documentContext = { documentIds };
          }
        }
        for (const msg of messages) {
          preparedMessages.push({
            role: msg.role,
            content: msg.content,
            message_id: msg.message_id || generateUUID(),
            documentContext: msg.documentContext,
            systemPromptType: msg.systemPromptType,
            systemPromptPath: msg.systemPromptPath
          });
        }
        return preparedMessages;
      }
      normalizeDataPrefix(line) {
        if (!(line == null ? void 0 : line.trim()))
          return "";
        const trimmed = line.trim();
        if (trimmed === "data:" || trimmed === "data: " || trimmed === "[DONE]" || trimmed.startsWith(": OPENROUTER")) {
          return "";
        }
        return trimmed.replace(/^(?:data:\s*)+/, "");
      }
      isValidStreamEvent(data, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _i;
        if (!data)
          return false;
        try {
          const parsed = JSON.parse(data);
          return !!(parsed && (((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || ((_i = (_h = (_g = parsed.choices) == null ? void 0 : _g[0]) == null ? void 0 : _h.delta) == null ? void 0 : _i.function_call) || parsed.error));
        } catch (e) {
          return false;
        }
      }
      processStreamLine(line, isCustomProvider = false) {
        if (!line.trim().startsWith("data:")) {
          return null;
        }
        const normalized = this.normalizeDataPrefix(line);
        return this.isValidStreamEvent(normalized, isCustomProvider) ? normalized : null;
      }
      async handleStreamEvent(event, model, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f;
        if (!event)
          return null;
        try {
          let parsed;
          try {
            parsed = JSON.parse(event);
          } catch (parseError) {
            return null;
          }
          if (!parsed)
            return null;
          if (parsed.error) {
            const errorCode = parsed.error.code || ERROR_CODES.STREAM_ERROR;
            let errorMessage = parsed.error.message || getErrorMessage(errorCode, model);
            const metadata = {
              model,
              shouldResubmit: false,
              rawError: parsed.error,
              originalEvent: event
            };
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata.shouldResubmit = true;
            }
            throw new SystemSculptError(errorMessage, errorCode, parsed.error.statusCode || 500, metadata);
          }
          const content = ((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || null;
          const reasoning = ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || null;
          if (this.isInsideThinkTags) {
            let combinedText = "";
            if (reasoning)
              combinedText += reasoning;
            if (content)
              combinedText += content;
            const thinkEndMatch = combinedText.match(/(.*?)\s*<\/think>\s*(.*)/);
            if (thinkEndMatch) {
              this.isInsideThinkTags = false;
              return {
                reasoning: thinkEndMatch[1] || "",
                content: thinkEndMatch[2] || ""
              };
            }
            return {
              content: null,
              reasoning: combinedText || null
            };
          } else {
            if (content) {
              const thinkStartMatch = content.match(/<think>\s*(.*)/);
              if (thinkStartMatch) {
                this.isInsideThinkTags = true;
                return {
                  content: null,
                  reasoning: thinkStartMatch[1] || ""
                };
              }
            }
          }
          return { content, reasoning };
        } catch (e) {
          if (e instanceof SystemSculptError) {
            throw e;
          }
          return null;
        }
      }
      async processStreamChunk(chunk, buffer, model, isCustomProvider = false) {
        const decoded = _SystemSculptService.decoder.decode(chunk, { stream: true });
        const fullChunk = buffer + decoded;
        const lines = fullChunk.split("\n");
        const contents = [];
        const reasonings = [];
        for (let i = 0; i < lines.length - 1; i++) {
          const event = this.processStreamLine(lines[i], isCustomProvider);
          if (event) {
            const result = await this.handleStreamEvent(event, model, isCustomProvider);
            if (result) {
              if (result.content)
                contents.push(result.content);
              if (result.reasoning)
                reasonings.push(result.reasoning);
            }
          }
        }
        const newBuffer = lines[lines.length - 1].trim() ? lines[lines.length - 1] : "";
        return { newBuffer, contents, reasonings };
      }
      stripProviderPrefixes(modelId) {
        return modelId.replace(/^openrouter\//, "");
      }
      async getModelInfo(modelId) {
        if (this.settings.activeProvider.type === "custom") {
          const activeProvider = this.settings.customProviders.find((p) => p.id === this.settings.activeProvider.id && p.isEnabled);
          if (!activeProvider) {
            throw new SystemSculptError(`Provider ${this.settings.activeProvider.name} not found or disabled`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
          }
          return {
            isCustom: true,
            provider: activeProvider,
            actualModelId: modelId
          };
        }
        return {
          isCustom: false,
          actualModelId: this.stripProviderPrefixes(modelId)
        };
      }
      async handleCustomProviderCompletion(provider, messages, temperature, modelId, signal) {
        const endpoint = provider.endpoint.trim().replace(/\/$/, "");
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${provider.apiKey}`
        };
        if (endpoint.includes("openrouter.ai")) {
          headers["HTTP-Referer"] = "https://systemsculpt.com";
          headers["X-Title"] = "SystemSculpt AI";
        }
        const baseRequestBody = {
          model: modelId,
          messages: messages.map((msg) => ({
            role: msg.role,
            content: msg.content
          })),
          stream: true
        };
        const requestBody = {
          ...baseRequestBody,
          ...!endpoint.includes("api.openai.com") && { temperature },
          ...endpoint.includes("openrouter.ai") && {
            include_reasoning: true
          },
          ...endpoint.includes("api.openai.com") && modelId === "o3-mini" && {
            reasoning_effort: "high"
          }
        };
        if (endpoint.includes("api.openai.com") && modelId === "o3-mini") {
          console.log("Making OpenAI API call with o3-mini model:", {
            endpoint,
            modelId,
            requestBody
          });
        }
        const response = await fetch(`${endpoint}/chat/completions`, {
          method: "POST",
          headers,
          body: JSON.stringify(requestBody),
          signal
        });
        if (!response.ok) {
          await this.handleStreamError(response, true);
        }
        return response;
      }
      async *streamMessage({
        messages,
        model,
        temperature = 0.7,
        onError,
        contextFiles,
        systemPromptType,
        systemPromptPath,
        signal
      }) {
        try {
          this.isInsideThinkTags = false;
          const preparedMessages = await this.prepareMessagesWithContext(messages, contextFiles || new Set(), systemPromptType, systemPromptPath);
          const { isCustom, provider, actualModelId } = await this.getModelInfo(model);
          let response;
          if (isCustom && provider) {
            response = await this.handleCustomProviderCompletion(provider, preparedMessages, temperature, actualModelId, signal);
          } else {
            const requestBody = {
              model: actualModelId,
              messages: preparedMessages,
              temperature,
              stream: true,
              include_reasoning: true
            };
            response = await fetch(`${this.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.CHAT.COMPLETIONS}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "text/event-stream",
                "Cache-Control": "no-cache",
                "X-Request-ID": crypto.randomUUID(),
                "x-license-key": this.licenseKey
              },
              body: JSON.stringify(requestBody),
              signal
            });
          }
          if (!response.ok) {
            await this.handleStreamError(response, !!provider);
          }
          if (!response.body) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.STREAM_ERROR), ERROR_CODES.STREAM_ERROR, response.status);
          }
          const reader = response.body.getReader();
          let buffer = "";
          try {
            while (true) {
              const { done, value } = await reader.read();
              if (done) {
                const finalChunk = _SystemSculptService.decoder.decode();
                if (finalChunk) {
                  const event = this.processStreamLine(finalChunk);
                  if (event) {
                    const result = await this.handleStreamEvent(event, model, !!provider);
                    if (result) {
                      if (result.content || result.reasoning) {
                        yield {
                          content: result.content || void 0,
                          reasoning: result.reasoning || void 0
                        };
                      }
                    }
                  }
                }
                break;
              }
              const { newBuffer, contents, reasonings } = await this.processStreamChunk(value, buffer, model, !!provider);
              buffer = newBuffer;
              for (let i = 0; i < Math.max(contents.length, reasonings.length); i++) {
                yield {
                  content: contents[i],
                  reasoning: reasonings[i]
                };
              }
            }
          } finally {
            reader.releaseLock();
          }
        } catch (error) {
          if (error instanceof DOMException && error.name === "AbortError") {
            return;
          }
          if (onError) {
            let errorMessage = error instanceof Error ? error.message : getErrorMessage(ERROR_CODES.UNKNOWN_ERROR);
            if (error instanceof SystemSculptError && error.code === ERROR_CODES.STREAM_ERROR && error.statusCode === 400) {
              errorMessage += "\nPlease try again in a few moments. If the issue persists, try selecting a different model.";
            }
            onError(errorMessage);
          }
          throw error;
        }
      }
      async uploadDocument(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/documents/process`, {
            method: "POST",
            headers: {
              "x-license-key": this.licenseKey
            },
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          throw error;
        }
      }
      async uploadAudio(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/audio/transcriptions`, {
            method: "POST",
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Audio upload failed: ${response.status}`);
          }
          const result = await response.json();
          return result;
        } catch (error) {
          throw error;
        }
      }
      async preloadModels() {
        return Promise.resolve();
      }
    };
    SystemSculptService = _SystemSculptService;
    SystemSculptService.decoder = new TextDecoder();
  }
});

// src/core/ui/components/LoadingIndicator.ts
var init_LoadingIndicator = __esm({
  "src/core/ui/components/LoadingIndicator.ts"() {
  }
});

// src/core/ui/components/Button.ts
var init_Button = __esm({
  "src/core/ui/components/Button.ts"() {
  }
});

// src/core/ui/modals/TextAreaModal.ts
var import_obsidian2, TextAreaModal;
var init_TextAreaModal = __esm({
  "src/core/ui/modals/TextAreaModal.ts"() {
    import_obsidian2 = __toModule(require("obsidian"));
    TextAreaModal = class extends import_obsidian2.Modal {
      constructor(app, title, initialContent, options) {
        super(app);
        this.title = title;
        this.initialContent = initialContent;
        this.options = options;
        this.result = null;
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
      }
      onOpen() {
        var _a, _b, _c, _d, _e, _f;
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText(this.title);
        this.titleEl.addClass("systemsculpt-modal-title");
        const textAreaContainer = contentEl.createDiv("systemsculpt-textarea-container");
        if (((_a = this.options) == null ? void 0 : _a.presetButtons) && this.options.presetButtons.length > 0) {
          const presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
          this.options.presetButtons.forEach((preset) => {
            const button = presetButtonContainer.createEl("button", {
              text: preset.label,
              cls: "systemsculpt-preset-button"
            });
            button.onclick = () => {
              this.textArea.value = preset.value;
              const event = new Event("input", { bubbles: true });
              this.textArea.dispatchEvent(event);
            };
          });
        }
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            rows: ((_c = (_b = this.options) == null ? void 0 : _b.rows) == null ? void 0 : _c.toString()) || "10",
            placeholder: ((_d = this.options) == null ? void 0 : _d.placeholder) || ""
          }
        });
        this.textArea.value = this.initialContent;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = contentEl.createDiv("systemsculpt-button-container");
        if ((_e = this.options) == null ? void 0 : _e.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            text: this.options.secondaryButton,
            cls: "systemsculpt-button"
          });
          secondaryButton.onclick = () => {
            this.result = null;
            this.close();
          };
        }
        const primaryButton = buttonContainer.createEl("button", {
          text: ((_f = this.options) == null ? void 0 : _f.primaryButton) || "Save",
          cls: "systemsculpt-button mod-cta"
        });
        primaryButton.onclick = () => {
          this.result = this.textArea.value;
          this.close();
        };
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/core/ui/modals/PopupModal.ts
async function showPopup(app, message, options = {}) {
  const popup = new PopupComponent(app, message, options);
  return popup.open();
}
var import_obsidian3, PopupComponent;
var init_PopupModal = __esm({
  "src/core/ui/modals/PopupModal.ts"() {
    import_obsidian3 = __toModule(require("obsidian"));
    PopupComponent = class {
      constructor(app, message, options = {}) {
        this.result = null;
        this.app = app;
        this.message = message;
        this.options = options;
      }
      createPopup() {
        this.containerEl = document.createElement("div");
        this.containerEl.addClass("systemsculpt-popup-container");
        document.body.appendChild(this.containerEl);
        const popupEl = this.containerEl.createDiv({ cls: "systemsculpt-popup" });
        const content = popupEl.createDiv({ cls: "systemsculpt-popup-content" });
        if (this.options.title) {
          const titleEl = content.createDiv({ cls: "systemsculpt-popup-title" });
          if (this.options.icon) {
            const iconEl = titleEl.createSpan({ cls: "systemsculpt-popup-icon" });
            (0, import_obsidian3.setIcon)(iconEl, this.options.icon);
          }
          titleEl.createSpan({ text: this.options.title });
        }
        if (this.message) {
          content.createDiv({
            cls: "systemsculpt-popup-message",
            text: this.message
          });
        }
        if (this.options.description) {
          content.createDiv({
            cls: "systemsculpt-popup-description",
            text: this.options.description
          });
        }
        if (this.options.inputs) {
          const inputsContainer = content.createDiv({
            cls: "systemsculpt-popup-inputs"
          });
          this.options.inputs.forEach((input) => {
            if (input.type === "textarea") {
              inputsContainer.createEl("textarea", {
                cls: `systemsculpt-popup-textarea ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            } else {
              inputsContainer.createEl("input", {
                type: input.type,
                cls: `systemsculpt-popup-input ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            }
          });
        }
        const buttonContainer = popupEl.createDiv({
          cls: "systemsculpt-popup-buttons"
        });
        if (this.options.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            cls: "systemsculpt-popup-button systemsculpt-popup-button-secondary",
            text: this.options.secondaryButton
          });
          secondaryButton.addEventListener("click", () => {
            this.result = { confirmed: false };
            this.close();
          });
        }
        const primaryButton = buttonContainer.createEl("button", {
          cls: `systemsculpt-popup-button ${this.options.primaryButton === "Become A Patron" || this.options.primaryButton === "Become a Patron" ? "systemsculpt-popup-button-patron" : "systemsculpt-popup-button-primary"}`,
          text: this.options.primaryButton || "OK"
        });
        primaryButton.addEventListener("click", () => {
          if (this.options.inputs) {
            const inputs = Array.from(popupEl.querySelectorAll("input, textarea"));
            const hasEmptyRequired = inputs.some((input) => input.required && !input.value.trim());
            if (hasEmptyRequired) {
              return;
            }
            this.result = {
              confirmed: true,
              inputs: inputs.map((input) => input.value)
            };
          } else {
            this.result = { confirmed: true };
          }
          this.close();
        });
        this.containerEl.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            this.result = { confirmed: false };
            this.close();
          }
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey) {
            primaryButton.click();
          }
        });
        this.containerEl.addEventListener("mousedown", (e) => {
          if (e.target === this.containerEl) {
            this.result = { confirmed: false };
            this.close();
          }
        });
      }
      close() {
        this.containerEl.addClass("systemsculpt-popup-closing");
        setTimeout(() => {
          this.containerEl.remove();
          if (this.resolvePromise) {
            this.resolvePromise(this.result);
          }
        }, 200);
      }
      open() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.createPopup();
        });
      }
    };
  }
});

// src/core/ui/components/Notice.ts
function showEnhancedNotice(message, type, error) {
  if (error) {
    console.error("Notice error details:", {
      error,
      message: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
  }
  let duration;
  switch (type) {
    case "error":
      duration = 1e4;
      break;
    case "warning":
      duration = 5e3;
      break;
    default:
      duration = 3e3;
  }
  const notice = new import_obsidian4.Notice(message, duration);
  return notice;
}
var import_obsidian4;
var init_Notice = __esm({
  "src/core/ui/components/Notice.ts"() {
    import_obsidian4 = __toModule(require("obsidian"));
    init_errors();
  }
});

// src/core/ui/notifications.ts
function showNotice(message, options = {}) {
  const { type = "info", duration = 4e3 } = options;
  let prefix = "";
  switch (type) {
    case "success":
      prefix = "\u2728 ";
      break;
    case "error":
      prefix = "\u274C ";
      break;
    case "warning":
      prefix = "\u26A0\uFE0F ";
      break;
    case "info":
      prefix = "\u2139\uFE0F ";
      break;
  }
  new import_obsidian5.Notice(prefix + message, duration);
}
async function showAlert(app, message, options = {}) {
  const {
    title = options.type === "error" ? "Error" : options.type === "warning" ? "Warning" : "Alert",
    primaryButton = "OK",
    secondaryButton,
    icon = options.type === "error" ? "alert-circle" : options.type === "warning" ? "alert-triangle" : "info"
  } = options;
  const result = await showPopup(app, message, {
    title,
    primaryButton,
    secondaryButton,
    icon
  });
  return { confirmed: (result == null ? void 0 : result.confirmed) || false };
}
var import_obsidian5;
var init_notifications = __esm({
  "src/core/ui/notifications.ts"() {
    import_obsidian5 = __toModule(require("obsidian"));
    init_PopupModal();
  }
});

// src/core/ui/index.ts
var init_ui = __esm({
  "src/core/ui/index.ts"() {
    init_LoadingIndicator();
    init_Button();
    init_TextAreaModal();
    init_PopupModal();
    init_Notice();
    init_notifications();
  }
});

// src/components/FileSuggester.ts
function getFileSuggestions(app, directory) {
  const files = app.vault.getAllLoadedFiles().filter((file) => {
    var _a;
    if (!(file instanceof import_obsidian9.TFile))
      return false;
    const fileDir = (_a = file.parent) == null ? void 0 : _a.path;
    return fileDir === directory && file.extension === "md";
  });
  return new Set(files.map((file) => file.path));
}
function attachFileSuggester(inputEl, onSelect, app, directory) {
  return new FileSuggester(inputEl, onSelect, app, directory);
}
var import_obsidian9, FileSuggester;
var init_FileSuggester = __esm({
  "src/components/FileSuggester.ts"() {
    import_obsidian9 = __toModule(require("obsidian"));
    FileSuggester = class extends import_obsidian9.AbstractInputSuggest {
      constructor(inputEl, onSelectCb, app, directory) {
        super(app, inputEl);
        this.inputEl = inputEl;
        this.onSelectCb = onSelectCb;
        this.directory = directory;
        this.content = getFileSuggestions(app, directory);
      }
      getSuggestions(inputStr) {
        const lowerCaseInputStr = inputStr.toLowerCase();
        return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
      }
      renderSuggestion(content, el) {
        let display = content.replace(/\.md$/, "");
        el.setText(display);
      }
      selectSuggestion(content, evt) {
        this.onSelectCb(content);
        this.inputEl.value = content.replace(/\.md$/, "");
        this.inputEl.blur();
        this.close();
      }
    };
  }
});

// src/modals/PostProcessingPromptModal.ts
var PostProcessingPromptModal_exports = {};
__export(PostProcessingPromptModal_exports, {
  PostProcessingPromptModal: () => PostProcessingPromptModal,
  showPostProcessingPromptModal: () => showPostProcessingPromptModal
});
async function showPostProcessingPromptModal(app, plugin, currentPrompt, options) {
  const modal = new PostProcessingPromptModal(app, plugin, currentPrompt, options == null ? void 0 : options.systemPromptsDirectory, options == null ? void 0 : options.currentCustomPath);
  return await modal.openAndGetValue();
}
var import_obsidian11, PostProcessingPromptModal;
var init_PostProcessingPromptModal = __esm({
  "src/modals/PostProcessingPromptModal.ts"() {
    import_obsidian11 = __toModule(require("obsidian"));
    init_ui();
    init_FileSuggester();
    init_SystemSculptService();
    PostProcessingPromptModal = class extends import_obsidian11.Modal {
      constructor(app, plugin, currentPrompt, systemPromptsDirectory = "SystemSculpt/System Prompts", currentCustomPath) {
        super(app);
        this.plugin = plugin;
        this.currentPrompt = currentPrompt;
        this.systemPromptsDirectory = systemPromptsDirectory;
        this.currentCustomPath = currentCustomPath;
        this.result = null;
        this.activePreset = "general";
        this.prompts = [];
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        this.sculptService = SystemSculptService.getInstance(plugin.settings, app);
      }
      showLoading(show) {
        if (!this.loadingIndicator || !this.contentContainer)
          return;
        this.loadingIndicator.style.display = show ? "flex" : "none";
        this.contentContainer.style.display = show ? "none" : "block";
      }
      async loadPrompts() {
        try {
          this.showLoading(true);
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/post-transcription-prompts`);
          if (!response.ok) {
            throw new Error("Failed to load prompts");
          }
          const data = await response.json();
          this.prompts = data.data.prompts;
          this.createPresetButtons();
          this.showLoading(false);
        } catch (error) {
          console.error("Failed to load post-transcription prompts:", error);
          this.showLoading(false);
          await showPopup(this.app, "", {
            title: "Error",
            description: "Failed to load prompts. Please try again later.",
            primaryButton: "OK"
          });
        }
      }
      createPresetButtons() {
        if (!this.presetButtonContainer)
          return;
        this.presetButtonContainer.empty();
        if (this.currentCustomPath) {
          this.activePreset = "custom";
        } else {
          this.prompts.forEach((preset) => {
            if (preset.systemPrompt === this.currentPrompt) {
              this.activePreset = preset.id;
            }
          });
        }
        this.prompts.forEach((preset) => {
          const button = this.presetButtonContainer.createEl("button", {
            text: preset.label,
            cls: "systemsculpt-preset-button"
          });
          if (preset.description) {
            button.setAttribute("aria-label", preset.description);
            button.addClass("has-tooltip");
          }
          if (preset.id === this.activePreset) {
            button.addClass("active");
            if (this.textArea) {
              this.textArea.value = preset.systemPrompt;
              this.textArea.readOnly = !preset.isUserConfigurable;
            }
          }
          button.onclick = () => {
            this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
            button.addClass("active");
            this.activePreset = preset.id;
            if (preset.id === "custom") {
              this.customSection.style.display = "block";
              this.customInput.focus();
              if (this.textArea) {
                this.textArea.readOnly = false;
              }
            } else {
              this.customSection.style.display = "none";
              if (this.textArea) {
                this.textArea.value = preset.systemPrompt;
                this.textArea.readOnly = !preset.isUserConfigurable;
              }
            }
          };
        });
        if (this.activePreset === "custom") {
          this.customSection.style.display = "block";
          if (this.currentCustomPath) {
            this.customInput.value = this.currentCustomPath;
          }
        }
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Edit Post-Processing Prompt");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Configure how your transcriptions should be post-processed");
        descriptionEl.style.color = "var(--text-muted)";
        descriptionEl.style.fontSize = "0.9em";
        descriptionEl.style.marginTop = "0.2em";
        this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
        this.loadingIndicator.style.display = "none";
        this.loadingIndicator.style.justifyContent = "center";
        this.loadingIndicator.style.alignItems = "center";
        this.loadingIndicator.style.padding = "20px";
        const loadingText = this.loadingIndicator.createSpan();
        loadingText.setText("Loading prompts...");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
        this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
        this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
        this.customSection.style.display = "none";
        const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
        const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
        inputWrapper.style.display = "flex";
        inputWrapper.style.gap = "8px";
        inputWrapper.style.alignItems = "center";
        this.customInput = inputWrapper.createEl("input", {
          type: "text",
          placeholder: "Search for a system prompt file...",
          cls: "systemsculpt-custom-input"
        });
        const createButton2 = inputWrapper.createEl("button", {
          cls: "systemsculpt-create-button"
        });
        createButton2.style.padding = "4px 8px";
        createButton2.style.borderRadius = "4px";
        createButton2.style.cursor = "pointer";
        (0, import_obsidian11.setIcon)(createButton2, "plus");
        createButton2.addEventListener("click", async () => {
          var _a, _b;
          let templateContent = "";
          try {
            const response = await fetch(`${this.sculptService.baseUrl}/api/v1/system-prompts/template`);
            if (!response.ok) {
              throw new Error("Failed to fetch template");
            }
            const data = await response.json();
            templateContent = data.template;
          } catch (error) {
            console.error("Error fetching system prompt template:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: "Failed to fetch system prompt template. Please try again later.",
              primaryButton: "OK"
            });
            return;
          }
          const result = await showPopup(this.app, "", {
            title: "Create New System Prompt",
            description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
            primaryButton: "Create",
            secondaryButton: "Cancel",
            inputs: [
              {
                type: "text",
                placeholder: "My Custom Assistant",
                required: true,
                className: "systemsculpt-prompt-creation-title-input"
              },
              {
                type: "textarea",
                value: templateContent,
                required: true,
                className: "systemsculpt-prompt-creation-content"
              }
            ]
          });
          if (!(result == null ? void 0 : result.confirmed) || !((_a = result.inputs) == null ? void 0 : _a[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
            return;
          }
          const [title, content] = result.inputs;
          const fileName = title.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
          const filePath = `${this.systemPromptsDirectory}/${fileName}`;
          try {
            await this.app.vault.createFolder(this.systemPromptsDirectory).catch(() => {
            });
            const fileContent = `# ${title}

${content}`;
            const file = await this.app.vault.create(filePath + ".md", fileContent);
            if (!file) {
              throw new Error("Failed to create file");
            }
            if (this.textArea) {
              this.textArea.value = fileContent;
              this.textArea.readOnly = false;
            }
            this.customInput.value = filePath;
            await showPopup(this.app, "", {
              title: "Success",
              description: "System prompt file created successfully!",
              primaryButton: "OK"
            });
          } catch (error) {
            console.error("Error creating system prompt file:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: error instanceof Error ? error.message : "Failed to create system prompt file",
              primaryButton: "OK"
            });
          }
        });
        attachFileSuggester(this.customInput, async (selectedPath) => {
          try {
            const file = this.app.vault.getAbstractFileByPath(selectedPath);
            if (file instanceof import_obsidian11.TFile) {
              const content = await this.app.vault.read(file);
              this.textArea.value = content;
              this.textArea.readOnly = false;
              this.customInput.value = selectedPath.replace(/\.md$/, "");
            }
          } catch (error) {
            console.error("Error reading system prompt file:", error);
          }
        }, this.app, this.systemPromptsDirectory);
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            placeholder: "Enter post-processing prompt"
          }
        });
        this.textArea.value = this.currentPrompt;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        const primaryButton = buttonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          const activePreset = this.prompts.find((p) => p.id === this.activePreset);
          this.result = {
            content: this.textArea.value,
            type: (activePreset == null ? void 0 : activePreset.id) || "custom",
            path: this.activePreset === "custom" ? this.customInput.value : void 0
          };
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
        await this.loadPrompts();
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/main.ts
__export(exports, {
  default: () => SystemSculptPlugin
});
var import_obsidian31 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/modals/SettingsTab.ts
var import_obsidian12 = __toModule(require("obsidian"));
init_ui();

// src/types/llm.ts
var DEFAULT_FILTER_SETTINGS = {
  showVisionModels: false,
  showReasoningModels: false,
  showCreativeModels: false
};

// src/types.ts
var PATREON_URL = "https://www.patreon.com/systemsculpt/membership";
var DEFAULT_SETTINGS = {
  licenseKey: "",
  licenseValid: false,
  selectedModelId: "",
  chatsDirectory: "SystemSculpt/Chats",
  lastValidated: 0,
  systemPrompt: "You are a helpful AI assistant. You help users with their questions and tasks in a clear and concise way.",
  recordingsDirectory: "SystemSculpt/Recordings",
  developmentMode: false,
  preferredMicrophoneId: "",
  autoTranscribeRecordings: true,
  autoPasteTranscription: true,
  postProcessingPrompt: "You are a transcription post-processor. Your task is to fix any transcription errors, correct grammar and punctuation, and ensure the text is properly formatted. Keep the original meaning intact while making the text more readable.",
  postProcessingEnabled: false,
  showModelTooltips: false,
  showVisionModelsOnly: false,
  showTopPicksOnly: false,
  selectedProvider: "all",
  serverUrl: "http://localhost:3001",
  attachmentsDirectory: "SystemSculpt/Attachments",
  extractionsDirectory: "SystemSculpt/Extractions",
  systemPromptsDirectory: "SystemSculpt/System Prompts",
  tasksDirectory: "SystemSculpt/Tasks",
  moveCompletedTasksDown: true,
  systemPromptType: "general-use",
  systemPromptPath: "",
  customProviders: [],
  modelFilterSettings: DEFAULT_FILTER_SETTINGS,
  favoriteModels: [],
  favoriteChats: [],
  activeProvider: {
    id: "systemsculpt",
    name: "SystemSculpt",
    type: "native"
  }
};

// src/modals/SettingsTab.ts
init_SystemSculptService();

// src/modals/ModelSelectionModal.ts
var import_obsidian7 = __toModule(require("obsidian"));

// src/services/SearchService.ts
var SearchService = class {
  constructor() {
    this.DEFAULT_INITIAL_RESULTS_LIMIT = 25;
    this.DEFAULT_MAX_FILTERED_RESULTS = 50;
  }
  search(items, query, getSearchableFields, options) {
    var _a, _b;
    const initialLimit = (_a = options == null ? void 0 : options.initialResultsLimit) != null ? _a : this.DEFAULT_INITIAL_RESULTS_LIMIT;
    const maxFiltered = (_b = options == null ? void 0 : options.maxFilteredResults) != null ? _b : this.DEFAULT_MAX_FILTERED_RESULTS;
    if (!query.trim()) {
      return items.slice(0, initialLimit).map((item) => ({
        item,
        matches: [],
        score: 0
      }));
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
    const results = items.map((item) => {
      const fields = getSearchableFields(item);
      const matches = [];
      let totalScore = 0;
      const searchText = fields.map((f) => {
        var _a2;
        return ((_a2 = f.text) == null ? void 0 : _a2.toLowerCase()) || "";
      }).join(" ");
      const allTermsExist = searchTerms.every((term) => searchText.includes(term));
      if (!allTermsExist) {
        return { item, matches: [], score: 0 };
      }
      searchTerms.forEach((term) => {
        var _a2;
        let pos = 0;
        const termMatches = new Set();
        while ((pos = searchText.indexOf(term, pos)) !== -1) {
          let currentPos = 0;
          for (const field of fields) {
            const fieldText = ((_a2 = field.text) == null ? void 0 : _a2.toLowerCase()) || "";
            const fieldEnd = currentPos + fieldText.length;
            if (pos >= currentPos && pos < fieldEnd) {
              const relativePos = pos - currentPos;
              const quality = this.getMatchQuality(fieldText, term, relativePos);
              matches.push({
                field: field.field,
                text: field.text || "",
                indices: Array.from({ length: term.length }, (_, i) => relativePos + i),
                matchQuality: quality
              });
              totalScore += field.weight * quality;
              break;
            }
            currentPos = fieldEnd + 1;
          }
          pos += 1;
        }
      });
      if (searchTerms.length > 1 && matches.length > 0) {
        const positions = matches.flatMap((m) => m.indices[0]);
        const maxDistance = Math.max(...positions) - Math.min(...positions);
        if (maxDistance < 50) {
          totalScore *= 1.5;
        }
      }
      return {
        item,
        matches,
        score: totalScore
      };
    });
    return results.filter((result) => result.score > 0).sort((a, b) => b.score - a.score).slice(0, maxFiltered);
  }
  getMatchQuality(text, term, position) {
    const beforeChar = position > 0 ? text[position - 1] : " ";
    const afterChar = position + term.length < text.length ? text[position + term.length] : " ";
    if ((/\s/.test(beforeChar) || /\W/.test(beforeChar)) && (/\s/.test(afterChar) || /\W/.test(afterChar))) {
      return 1;
    }
    return 0.8;
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const searchTerms = searchQuery.toLowerCase().trim().split(/\s+/).filter(Boolean);
    const regex = new RegExp(`(${searchTerms.map((term) => this.escapeRegExp(term)).join("|")})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-search-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
    }
    return fragment;
  }
  escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }
};

// src/modals/ModelSelectionHelper.ts
var ModelSelectionHelper = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.logger = console;
    this.filterSettings = { ...this.plugin.settings.modelFilterSettings };
  }
  getFilterSettings() {
    return this.filterSettings;
  }
  async setFilterSetting(key, value) {
    this.filterSettings[key] = value;
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  async resetFilterSettings() {
    this.filterSettings = { ...DEFAULT_FILTER_SETTINGS };
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  formatPrice(price) {
    try {
      if (price === null || price === void 0 || price === "0") {
        return "Free";
      }
      const numericPrice = typeof price === "string" ? parseFloat(price) : price;
      if (isNaN(numericPrice) || numericPrice === 0) {
        return "Free";
      }
      const pricePerMillion = numericPrice * 1e6;
      return `$${pricePerMillion.toFixed(2)}`;
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error formatting price", {
        price,
        error
      });
      return "Price error";
    }
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        const textNode = document.createTextNode(text.slice(lastIndex, match.index));
        fragment.appendChild(textNode);
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-model-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      const textNode = document.createTextNode(text.slice(lastIndex));
      fragment.appendChild(textNode);
    }
    return fragment;
  }
  sortModels(models) {
    const tiers = {
      favorites: [],
      essential: [],
      advanced: [],
      professional: [],
      custom: []
    };
    models.forEach((model) => {
      if (model.isFavorite) {
        tiers.favorites.push(model);
        return;
      }
      if (model.provider === "custom") {
        tiers.custom.push(model);
      } else {
      }
    });
    Object.values(tiers).forEach((tierModels) => {
      tierModels.sort((a, b) => a.name.localeCompare(b.name));
    });
    const sortedModels = [];
    if (tiers.favorites.length > 0) {
      sortedModels.push(...tiers.favorites);
    }
    sortedModels.push(...tiers.essential);
    sortedModels.push(...tiers.advanced);
    sortedModels.push(...tiers.professional);
    sortedModels.push(...tiers.custom);
    return sortedModels;
  }
  filterModels(models) {
    try {
      return models.filter((model) => {
        var _a, _b, _c;
        try {
          const hasVisionCapability = ((_a = model.capabilities) == null ? void 0 : _a.includes("vision")) || false;
          const hasReasoningCapability = ((_b = model.capabilities) == null ? void 0 : _b.includes("reasoning")) || false;
          const hasCreativeCapability = ((_c = model.capabilities) == null ? void 0 : _c.includes("creative")) || false;
          if (!Object.values(this.filterSettings).some((value) => value)) {
            return true;
          }
          return (!this.filterSettings.showVisionModels || hasVisionCapability) && (!this.filterSettings.showReasoningModels || hasReasoningCapability) && (!this.filterSettings.showCreativeModels || hasCreativeCapability);
        } catch (error) {
          this.logger.error("ModelSelectionHelper: Error filtering individual model", {
            model,
            error
          });
          return false;
        }
      });
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error in filterModels", error);
      return models;
    }
  }
};

// src/modals/CustomProviderModal.ts
var import_obsidian6 = __toModule(require("obsidian"));
var CustomProviderManagerModal = class extends import_obsidian6.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  renderProviderCard(provider, container) {
    const card = container.createDiv("systemsculpt-custom-provider-card");
    const header = card.createDiv("systemsculpt-custom-provider-card-header");
    header.createEl("h3", {
      text: provider.name,
      cls: "systemsculpt-custom-provider-card-name"
    });
    const actions = header.createDiv("systemsculpt-custom-provider-card-actions");
    const deleteBtn = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-card-action delete"
    });
    (0, import_obsidian6.setIcon)(deleteBtn, "trash-2");
    deleteBtn.addEventListener("click", async (e) => {
      e.stopPropagation();
      this.plugin.settings.customProviders = this.plugin.settings.customProviders.filter((p) => p.id !== provider.id);
      await this.plugin.saveSettings();
      await this.plugin.modelService.getModels();
      this.renderProviderList();
    });
    const details = card.createDiv("systemsculpt-custom-provider-card-details");
    const typeDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian6.setIcon)(typeDetail.createSpan(), "box");
    typeDetail.createSpan({
      text: "OpenAI Compatible"
    });
    const endpointDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian6.setIcon)(endpointDetail.createSpan(), "link");
    endpointDetail.createSpan({ text: provider.endpoint });
    const statusDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    const toggleContainer = statusDetail.createDiv({
      cls: "systemsculpt-custom-provider-toggle-container"
    });
    toggleContainer.createSpan({
      text: provider.isEnabled ? "Enabled" : "Disabled",
      cls: "systemsculpt-custom-provider-toggle-label"
    });
    const toggle = toggleContainer.createDiv({
      cls: `checkbox-container ${provider.isEnabled ? "is-enabled" : ""}`
    });
    toggle.createDiv({ cls: "checkbox-toggle" });
    toggle.addEventListener("click", async (e) => {
      e.stopPropagation();
      if (provider.isEnabled) {
        provider.isEnabled = false;
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.renderProviderList();
        return;
      }
      toggle.addClass("testing");
      const result = await this.plugin.customProviderService.testConnection(provider);
      toggle.removeClass("testing");
      if (result.success) {
        provider.isEnabled = true;
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.renderProviderList();
      } else {
        new import_obsidian6.Notice(`Failed to enable ${provider.name}: ${result.error || "Connection failed"}`, 5e3);
      }
    });
  }
  renderProviderList() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-manager-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-manager-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-back"
    });
    (0, import_obsidian6.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Models" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Custom Providers" });
    const content = contentEl.createDiv("systemsculpt-custom-provider-manager-content");
    const listContainer = content.createDiv("systemsculpt-custom-provider-manager-list");
    const providers = this.plugin.settings.customProviders;
    if (providers.length === 0) {
      const emptyState = listContainer.createDiv("systemsculpt-custom-provider-manager-empty");
      const emptyIcon = emptyState.createDiv("systemsculpt-custom-provider-manager-empty-icon");
      (0, import_obsidian6.setIcon)(emptyIcon, "server-off");
      emptyState.createDiv({
        cls: "systemsculpt-custom-provider-manager-empty-text",
        text: "No custom providers added yet"
      });
    } else {
      providers.forEach((provider) => {
        this.renderProviderCard(provider, listContainer);
      });
    }
    const actions = content.createDiv("systemsculpt-custom-provider-manager-actions");
    const addButton = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-button systemsculpt-custom-provider-manager-button-primary",
      text: "Add Provider"
    });
    (0, import_obsidian6.setIcon)(addButton.createSpan(), "plus");
    addButton.addEventListener("click", () => {
      this.close();
      const customProviderModal = new CustomProviderModal(this.app, this.plugin, () => {
        const managerModal = new CustomProviderManagerModal(this.app, this.plugin, this.onBack);
        managerModal.open();
      });
      customProviderModal.open();
    });
  }
  onOpen() {
    this.renderProviderList();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var CustomProviderModal = class extends import_obsidian6.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-back"
    });
    (0, import_obsidian6.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Providers" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Add Custom Provider" });
    const form = contentEl.createDiv("systemsculpt-custom-provider-form");
    const nameGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    nameGroup.createEl("label", { text: "Provider Name" });
    const nameInput = nameGroup.createEl("input", {
      type: "text",
      placeholder: "e.g., LM Studio, OpenAI",
      attr: {
        maxlength: "25"
      }
    });
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const urlGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    urlGroup.createEl("label", { text: "API Endpoint URL" });
    const presetContainer = urlGroup.createDiv("systemsculpt-custom-provider-presets");
    presetContainer.createEl("label", { text: "Quick Setup:" });
    const presetButtons = presetContainer.createDiv("systemsculpt-custom-provider-preset-buttons");
    const openAIButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenAI"
    });
    openAIButton.addEventListener("click", () => {
      nameInput.value = "OpenAI";
      urlInput.value = "https://api.openai.com/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const openRouterButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenRouter"
    });
    openRouterButton.addEventListener("click", () => {
      nameInput.value = "OpenRouter";
      urlInput.value = "https://openrouter.ai/api/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const groqButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Groq"
    });
    groqButton.addEventListener("click", () => {
      nameInput.value = "Groq";
      urlInput.value = "https://api.groq.com/openai/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const lmStudioButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "LM Studio"
    });
    lmStudioButton.addEventListener("click", () => {
      nameInput.value = "LM Studio";
      urlInput.value = "http://localhost:1234/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const ollamaButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Ollama"
    });
    ollamaButton.addEventListener("click", () => {
      nameInput.value = "Ollama";
      urlInput.value = "http://localhost:11434/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const urlInput = urlGroup.createEl("input", {
      type: "text",
      placeholder: "https://your-api-endpoint.com"
    });
    const urlError = urlGroup.createDiv({
      cls: "systemsculpt-custom-provider-error systemsculpt-custom-provider-error-hidden",
      text: " "
    });
    const validateEndpointUrl = (url) => {
      try {
        const parsedUrl = new URL(url);
        const isLocal = parsedUrl.hostname === "localhost" || parsedUrl.hostname === "127.0.0.1";
        if (isLocal && parsedUrl.protocol !== "http:") {
          return { isValid: false, error: "Local endpoints must use HTTP" };
        }
        if (!isLocal && parsedUrl.protocol !== "https:") {
          return { isValid: false, error: "Remote endpoints must use HTTPS" };
        }
        if (isLocal && !parsedUrl.port) {
          return {
            isValid: false,
            error: "Local endpoints require a port number"
          };
        }
        return { isValid: true };
      } catch (e) {
        return { isValid: false, error: "Invalid URL format" };
      }
    };
    const apiKeyGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    apiKeyGroup.createEl("label", { text: "API Key (Optional)" });
    const apiKeyInput = apiKeyGroup.createEl("input", {
      type: "password",
      placeholder: "Enter your API key"
    });
    const resetValidation = () => {
      isConnectionTested = false;
      testResult = null;
      updateButtonState("test");
      urlError.addClass("systemsculpt-custom-provider-error-hidden");
      urlError.removeClass("systemsculpt-custom-provider-success");
    };
    nameInput.addEventListener("input", resetValidation);
    urlInput.addEventListener("input", resetValidation);
    apiKeyInput.addEventListener("input", resetValidation);
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const formActions = form.createDiv("systemsculpt-custom-provider-form-actions");
    const cancelButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-secondary",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    const actionButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-primary",
      text: "Test Connection"
    });
    let isConnectionTested = false;
    let testResult = null;
    const createProviderFromForm = () => ({
      id: crypto.randomUUID(),
      name: nameInput.value.trim(),
      endpoint: urlInput.value.trim(),
      apiKey: apiKeyInput.value.trim(),
      isEnabled: true,
      lastTested: Date.now()
    });
    const updateButtonState = (state) => {
      switch (state) {
        case "test":
          actionButton.setText("Test Connection");
          actionButton.removeAttribute("disabled");
          break;
        case "testing":
          actionButton.setText("Testing...");
          actionButton.setAttribute("disabled", "true");
          break;
        case "retry":
          actionButton.setText("Try Again");
          actionButton.removeAttribute("disabled");
          break;
        case "save":
          actionButton.setText("Save Provider");
          actionButton.removeAttribute("disabled");
          break;
      }
    };
    const validateForm = () => {
      if (!nameInput.value.trim()) {
        return { isValid: false, error: "Provider name is required" };
      }
      const urlValidation = validateEndpointUrl(urlInput.value);
      if (!urlValidation.isValid) {
        return urlValidation;
      }
      const isLocal = urlInput.value.includes("localhost") || urlInput.value.includes("127.0.0.1");
      if (!isLocal && !apiKeyInput.value.trim()) {
        return {
          isValid: false,
          error: "API key is required for remote endpoints"
        };
      }
      return { isValid: true };
    };
    actionButton.addEventListener("click", async () => {
      var _a;
      const validation = validateForm();
      if (!validation.isValid) {
        urlError.textContent = validation.error || "Invalid form data";
        urlError.removeClass("systemsculpt-custom-provider-error-hidden");
        return;
      }
      if (!isConnectionTested) {
        updateButtonState("testing");
        const provider = createProviderFromForm();
        const result = await this.plugin.customProviderService.testConnection(provider);
        if (result.success) {
          isConnectionTested = true;
          updateButtonState("save");
          testResult = result;
          urlError.textContent = `Connection successful! Found ${((_a = result.models) == null ? void 0 : _a.length) || 0} models.`;
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.addClass("systemsculpt-custom-provider-success");
        } else {
          updateButtonState("retry");
          urlError.textContent = result.error || "Connection failed";
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.removeClass("systemsculpt-custom-provider-success");
        }
      } else {
        const provider = createProviderFromForm();
        this.plugin.settings.customProviders = [
          ...this.plugin.settings.customProviders,
          provider
        ];
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.close();
        this.onBack();
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/ModelSelectionModal.ts
var ModelSelectionModal = class extends import_obsidian7.Modal {
  constructor(app, currentModelId, onSelect, plugin) {
    super(app);
    this.allModels = [];
    this.selectedCardIndex = -1;
    this.modelCards = [];
    this.isClosing = false;
    this.getSearchableFields = (model) => {
      return [
        { field: "name", text: model.name, weight: 200 },
        ...model.name.split(/[\s\-:\.]+/).map((part) => ({
          field: "name",
          text: part,
          weight: 150
        })),
        ...model.provider === "custom" ? [{ field: "provider", text: model.id.split("-")[0], weight: 180 }] : [],
        { field: "description", text: model.description || "", weight: 50 }
      ];
    };
    this.selectedModelId = currentModelId;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.logger = console;
    this.helper = new ModelSelectionHelper(plugin);
    this.searchService = new SearchService();
  }
  async onOpen() {
    try {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.addClass("systemsculpt-model-selection-modal");
      this.createSearchUI();
      this.createModelGrid();
      this.setupSearch();
      const loadingContainer = this.modelGrid.createDiv({
        cls: "systemsculpt-loading-container"
      });
      const loadingSpinner = loadingContainer.createDiv({
        cls: "systemsculpt-loading-spinner"
      });
      (0, import_obsidian7.setIcon)(loadingSpinner, "loader-2");
      loadingContainer.createDiv({
        cls: "systemsculpt-loading-text",
        text: "Loading models..."
      });
      this.allModels = await this.plugin.getInitialModels();
      this.renderModels(this.getVisibleModels());
    } catch (error) {
      this.logger.error("ModelSelectionModal: Error in onOpen", error);
      this.contentEl.createDiv({
        cls: "systemsculpt-error-message",
        text: "Error loading model selection modal"
      });
    }
  }
  getVisibleModels() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.allModels.map((m) => ({ item: m, matches: [], score: 0 }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.allModels, query, (model) => this.getSearchableFields(model), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
  createSearchUI() {
    const searchContainer = this.contentEl.createDiv({
      cls: "systemsculpt-search-container"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search models...",
      cls: "systemsculpt-search-input"
    });
    const providersButton = searchContainer.createEl("button", {
      cls: "systemsculpt-providers-button"
    });
    (0, import_obsidian7.setIcon)(providersButton.createSpan(), "settings");
    providersButton.createSpan({ text: "Providers" });
    providersButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modelSelectionModal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modelSelectionModal.open();
      });
      managerModal.open();
    });
  }
  createModelGrid() {
    this.modelGrid = this.contentEl.createDiv({
      cls: "systemsculpt-model-grid"
    });
  }
  setupSearch() {
    var _a, _b, _c;
    this.searchInput.addEventListener("input", () => {
      const results = this.getVisibleModels();
      this.renderModels(results);
    });
    this.contentEl.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey) {
          this.selectedCardIndex = this.selectedCardIndex <= 0 ? this.modelCards.length - 1 : this.selectedCardIndex - 1;
        } else {
          this.selectedCardIndex = this.selectedCardIndex >= this.modelCards.length - 1 ? 0 : this.selectedCardIndex + 1;
        }
        this.modelCards.forEach((card, i) => {
          const isSelected = i === this.selectedCardIndex;
          card.classList.toggle("systemsculpt-keyboard-selected", isSelected);
          if (isSelected) {
            card.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }
        });
        this.searchInput.focus();
      } else if (e.key === "Enter") {
        const highlightedCard = this.modelCards[this.selectedCardIndex];
        if (highlightedCard) {
          e.preventDefault();
          const modelId = highlightedCard.dataset.modelId;
          if (modelId) {
            this.onSelect(modelId);
            this.close();
          }
        }
      }
    });
    (_a = this.modelGrid) == null ? void 0 : _a.addEventListener("wheel", () => {
    }, { passive: true });
    (_b = this.modelGrid) == null ? void 0 : _b.addEventListener("touchstart", () => {
    }, { passive: true });
    (_c = this.modelGrid) == null ? void 0 : _c.addEventListener("touchmove", () => {
    }, { passive: true });
  }
  renderModels(searchResults) {
    var _a, _b;
    if (!this.modelGrid)
      return;
    this.modelGrid.empty();
    this.modelCards = [];
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const hasValidLicense = (_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim();
    const favorites = [];
    const nonFavorites = [];
    const visibleModels = searchResults.map((sr) => sr.item);
    visibleModels.forEach((model) => {
      if (!hasValidLicense && model.provider === "systemsculpt") {
        return;
      }
      if (model.isFavorite) {
        favorites.push(model);
      } else {
        nonFavorites.push(model);
      }
    });
    if (favorites.length > 0) {
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => {
        if (a.provider === "systemsculpt" && b.provider !== "systemsculpt")
          return -1;
        if (a.provider !== "systemsculpt" && b.provider === "systemsculpt")
          return 1;
        if (a.provider !== b.provider) {
          return a.provider.localeCompare(b.provider);
        }
        return a.name.localeCompare(b.name);
      });
      favorites.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    const modelsByProvider = new Map();
    nonFavorites.forEach((model) => {
      var _a2;
      const provider = model.provider;
      if (!modelsByProvider.has(provider)) {
        modelsByProvider.set(provider, []);
      }
      (_a2 = modelsByProvider.get(provider)) == null ? void 0 : _a2.push(model);
    });
    const systemsculptHeader = this.modelGrid.createDiv({
      cls: "systemsculpt-provider-header"
    });
    systemsculptHeader.createSpan({ text: "SystemSculpt Models" });
    if (!hasValidLicense && searchResults.some((sr) => sr.item.provider === "systemsculpt")) {
      this.createProInfoMessage(this.modelGrid);
    }
    if (hasValidLicense && modelsByProvider.has("systemsculpt")) {
      const systemsculptModels = modelsByProvider.get("systemsculpt") || [];
      const sortedSystemsculptModels = systemsculptModels.sort((a, b) => a.name.localeCompare(b.name));
      sortedSystemsculptModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    modelsByProvider.delete("systemsculpt");
    const sortedProviders = Array.from(modelsByProvider.keys()).sort((a, b) => a.localeCompare(b));
    sortedProviders.forEach((provider) => {
      const models = modelsByProvider.get(provider) || [];
      if (models.length === 0)
        return;
      const sortedModels = models.sort((a, b) => a.name.localeCompare(b.name));
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      const providerName = `${provider.charAt(0).toUpperCase() + provider.slice(1)} Models`;
      header.createSpan({ text: providerName });
      sortedModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    });
    if (this.modelCards.length === 0) {
      if ((_b = this.searchInput) == null ? void 0 : _b.value) {
        const noResultsCard = this.renderNoResultsCard();
        this.modelGrid.appendChild(noResultsCard);
      } else {
        this.createCustomProviderInfoMessage(this.modelGrid);
      }
    }
  }
  renderNoResultsCard() {
    const card = createDiv({ cls: "systemsculpt-model-card" });
    const iconsContainer = card.createDiv({ cls: "systemsculpt-model-icons" });
    const searchIcon = iconsContainer.createDiv({
      cls: "systemsculpt-model-icon systemsculpt-pricing-low"
    });
    (0, import_obsidian7.setIcon)(searchIcon, "search");
    const nameContainer = card.createDiv({
      cls: "systemsculpt-model-name-container"
    });
    nameContainer.createDiv({
      cls: "systemsculpt-model-name",
      text: "No models found"
    });
    const description = card.createDiv({
      cls: "systemsculpt-model-description",
      text: "No models match your current search criteria. Click here to reset all filters."
    });
    card.createDiv({ cls: "systemsculpt-model-details" });
    card.addEventListener("click", () => {
      if (this.searchInput) {
        this.searchInput.value = "";
      }
      this.renderModels(this.allModels.map((m) => ({ item: m, matches: [], score: 0 })));
    });
    return card;
  }
  renderModelCard(model, matches = []) {
    var _a, _b, _c, _d, _e, _f, _g;
    const card = document.createElement("div");
    card.className = "systemsculpt-model-card";
    if (model.provider !== "systemsculpt") {
      card.classList.add("systemsculpt-custom-model-card");
    }
    card.setAttribute("tabindex", "0");
    card.dataset.modelId = model.id;
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${model.isFavorite ? "is-favorite" : ""}`,
      attr: {
        "aria-label": model.isFavorite ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian7.setIcon)(favoriteButton, "star");
    favoriteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isFavorite = !model.isFavorite;
      model.isFavorite = isFavorite;
      favoriteButton.classList.toggle("is-favorite", isFavorite);
      favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
      if (!Array.isArray(this.plugin.settings.favoriteModels)) {
        this.plugin.settings.favoriteModels = [];
      }
      if (isFavorite) {
        const newFav = { provider: model.provider, modelId: model.id };
        if (!this.plugin.settings.favoriteModels.some((f) => f.modelId === model.id && f.provider === model.provider)) {
          this.plugin.settings.favoriteModels.push(newFav);
        }
      } else {
        this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((f) => !(f.modelId === model.id && f.provider === model.provider));
      }
      await this.plugin.saveSettings();
      this.renderModels(this.getVisibleModels());
    });
    if (model.provider !== "systemsculpt") {
      const nameContainer = card.createDiv({
        cls: "systemsculpt-custom-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-custom-model-name"
      });
      const providerPrefix = `[${model.provider.toUpperCase()}] `;
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_a = this.searchInput) == null ? void 0 : _a.value));
    } else {
      const iconsContainer = card.createDiv({
        cls: "systemsculpt-model-icons"
      });
      const completionPrice = parseFloat(model.pricing.completion) * 1e6;
      const pricingIndicator = iconsContainer.createDiv({
        cls: "systemsculpt-model-icon",
        attr: {
          "aria-label": `Approx ~$${completionPrice.toFixed(2)} per million tokens`
        }
      });
      (0, import_obsidian7.setIcon)(pricingIndicator, "wallet");
      if ((_b = model.capabilities) == null ? void 0 : _b.includes("fast")) {
        const speedIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-speed-indicator",
          attr: { "aria-label": "Blazing fast responses" }
        });
        (0, import_obsidian7.setIcon)(speedIndicator, "zap");
      }
      if ((_c = model.capabilities) == null ? void 0 : _c.includes("reasoning")) {
        const reasonIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-reasoning-indicator",
          attr: { "aria-label": "Complex reasoning" }
        });
        (0, import_obsidian7.setIcon)(reasonIndicator, "brain");
      }
      if ((_d = model.capabilities) == null ? void 0 : _d.includes("creative")) {
        const creativeIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-creative-indicator",
          attr: { "aria-label": "Creative writing" }
        });
        (0, import_obsidian7.setIcon)(creativeIndicator, "brush");
      }
      if (((_e = model.architecture) == null ? void 0 : _e.modality) === "text+image->text") {
        const visionIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-vision-indicator",
          attr: { "aria-label": "Vision/image input" }
        });
        (0, import_obsidian7.setIcon)(visionIndicator, "eye");
      }
      const nameContainer = card.createDiv({
        cls: "systemsculpt-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-model-name"
      });
      const providerPrefix = "[SYSTEMSCULPT] ";
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_f = this.searchInput) == null ? void 0 : _f.value));
      const description = card.createDiv({
        cls: "systemsculpt-model-description"
      });
      description.append(this.helper.highlightText(model.description, matches, (_g = this.searchInput) == null ? void 0 : _g.value));
      description.setAttribute("aria-label", model.description);
      description.addClass("has-tooltip");
      const details = card.createDiv({ cls: "systemsculpt-model-details" });
      const contextLength = details.createDiv({
        cls: "systemsculpt-model-detail"
      });
      contextLength.createSpan({
        text: "Context: ",
        cls: "systemsculpt-detail-label"
      });
      contextLength.createSpan({
        text: `${model.context_length.toLocaleString()} tokens`,
        cls: "systemsculpt-detail-value"
      });
    }
    card.addEventListener("click", async () => {
      const customProvider = this.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === model.provider.toLowerCase());
      if (customProvider) {
        this.plugin.settings.activeProvider = {
          id: customProvider.id,
          name: customProvider.name,
          type: "custom"
        };
      } else {
        this.plugin.settings.activeProvider = {
          id: "systemsculpt",
          name: "SystemSculpt",
          type: "native"
        };
      }
      await this.plugin.saveSettings();
      this.onSelect(model.id);
      this.close();
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        this.onSelect(model.id);
        this.close();
      }
    });
    card.addEventListener("focus", () => {
      this.modelCards.forEach((c) => c.classList.remove("systemsculpt-keyboard-selected"));
      card.classList.add("systemsculpt-keyboard-selected");
      this.searchInput.focus();
    });
    return card;
  }
  onClose() {
    this.isClosing = true;
    this.contentEl.empty();
  }
  setModels(models) {
    if (!Array.isArray(models)) {
      this.logger.error("Invalid models data", { models });
      return;
    }
    this.allModels = models;
    if (this.modelGrid) {
      this.renderModels(this.getVisibleModels());
    }
  }
  createProInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian7.setIcon)(iconContainer, "sparkles");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Unlock Pro Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get instant access to o3 Mini, DeepSeek R1, and other state-of-the-art models. Always up to date so you don't have to guess which model to use."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian7.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    const patronBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const patronIcon = patronBtn.createSpan();
    (0, import_obsidian7.setIcon)(patronIcon, "heart");
    patronBtn.createSpan({ text: "Become A Patron" });
    patronBtn.addEventListener("click", () => {
      window.open(PATREON_URL, "_blank");
    });
    return infoEl;
  }
  createCustomProviderInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian7.setIcon)(iconContainer, "server");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Add Your Own Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get started by adding your own custom provider like Ollama, LM Studio, or OpenAI. You can use your own models or connect to other AI services."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian7.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    return infoEl;
  }
};

// src/components/FolderSuggester.ts
var import_obsidian8 = __toModule(require("obsidian"));
var FolderSuggester = class extends import_obsidian8.AbstractInputSuggest {
  constructor(inputEl, onSelectCb, app) {
    super(app, inputEl);
    this.inputEl = inputEl;
    this.onSelectCb = onSelectCb;
    this.content = getFolderSuggestions(app);
  }
  getSuggestions(inputStr) {
    const lowerCaseInputStr = inputStr.toLowerCase();
    return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
  }
  renderSuggestion(content, el) {
    el.setText(content);
  }
  selectSuggestion(content, evt) {
    this.onSelectCb(content);
    this.inputEl.value = content;
    this.inputEl.blur();
    this.close();
  }
};
function getFolderSuggestions(app) {
  const folders = app.vault.getAllLoadedFiles().filter((file) => file instanceof import_obsidian8.TFolder);
  return new Set(folders.map((folder) => folder.path));
}
function attachFolderSuggester(inputEl, onSelect, app) {
  return new FolderSuggester(inputEl, onSelect, app);
}

// src/modals/SystemPromptModal.ts
var import_obsidian10 = __toModule(require("obsidian"));
init_FileSuggester();
init_ui();
init_SystemPromptService();
function sanitizeFileName(name) {
  return name.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
}
function getSystemPromptPath(directory, fileName) {
  return `${directory}/${fileName}.md`;
}
var SystemPromptModal = class extends import_obsidian10.Modal {
  constructor(app, currentPrompt, options) {
    super(app);
    this.currentPrompt = currentPrompt;
    this.result = null;
    this.systemPrompts = [];
    this.activePreset = null;
    var _a;
    this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
    this.options = {
      ...options,
      systemPromptsDirectory: (_a = options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts"
    };
    this.systemPromptService = new SystemPromptService(app);
  }
  showLoading(show) {
    if (!this.loadingIndicator || !this.contentContainer)
      return;
    this.loadingIndicator.style.display = show ? "flex" : "none";
    this.contentContainer.style.display = show ? "none" : "block";
  }
  async loadSystemPrompts() {
    try {
      this.showLoading(true);
      this.systemPrompts = await this.systemPromptService.getSystemPrompts();
      this.createPresetButtons();
      this.showLoading(false);
    } catch (error) {
      console.error("Failed to load system prompts:", error);
      this.showLoading(false);
      await showPopup(this.app, "", {
        title: "Error",
        description: "Failed to load system prompts. Please try again later.",
        primaryButton: "OK"
      });
    }
  }
  createPresetButtons() {
    if (!this.presetButtonContainer)
      return;
    this.presetButtonContainer.empty();
    this.systemPrompts.forEach((preset) => {
      if (preset.systemPrompt === this.currentPrompt) {
        this.activePreset = preset.label;
      }
    });
    if (!this.activePreset && this.currentPrompt) {
      const generalUsePreset = this.systemPrompts.find((p) => p.id === "general-use");
      if (generalUsePreset && generalUsePreset.systemPrompt.trim() === this.currentPrompt.trim()) {
        this.activePreset = generalUsePreset.label;
      } else {
        this.activePreset = "General-use";
        if (this.textArea && generalUsePreset) {
          this.textArea.value = generalUsePreset.systemPrompt;
        }
      }
    }
    const presetButtons = [
      ...this.systemPrompts,
      ...!this.systemPrompts.some((p) => p.id === "custom") ? [
        {
          id: "custom",
          label: "Custom",
          isUserConfigurable: true,
          systemPrompt: ""
        }
      ] : []
    ].map((preset) => {
      const button = this.presetButtonContainer.createEl("button", {
        text: preset.label,
        cls: "systemsculpt-preset-button"
      });
      if (preset.label === this.activePreset) {
        button.addClass("active");
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
        }
      }
      button.onclick = () => {
        this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
        button.addClass("active");
        this.activePreset = preset.label;
        if (preset.label === "Custom") {
          this.customSection.style.display = "block";
          this.customInput.focus();
          if (this.textArea) {
            this.textArea.readOnly = false;
          }
        } else {
          this.customSection.style.display = "none";
          if (this.textArea) {
            this.textArea.value = preset.systemPrompt;
            this.textArea.readOnly = !preset.isUserConfigurable;
          }
        }
      };
      return button;
    });
  }
  async onOpen() {
    var _a, _b;
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-modal-content");
    this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
    this.loadingIndicator.style.display = "none";
    this.loadingIndicator.style.justifyContent = "center";
    this.loadingIndicator.style.alignItems = "center";
    this.loadingIndicator.style.padding = "20px";
    const loadingText = this.loadingIndicator.createSpan();
    loadingText.setText("Loading system prompts...");
    this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
    const title = this.options.mode === "default" ? "Edit Default System Prompt" : "Chat View Settings";
    const description = this.options.mode === "default" ? "Changes will apply as the default for all new chat views" : "Configure settings for this specific chat view";
    this.titleEl.setText(title);
    this.titleEl.addClass("systemsculpt-modal-title");
    const descriptionEl = this.titleEl.createDiv();
    descriptionEl.addClass("systemsculpt-modal-description");
    descriptionEl.setText(description);
    descriptionEl.style.color = "var(--text-muted)";
    descriptionEl.style.fontSize = "0.9em";
    descriptionEl.style.marginTop = "0.2em";
    const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
    this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
    this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
    this.customSection.style.display = "none";
    const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
    const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
    inputWrapper.style.display = "flex";
    inputWrapper.style.gap = "8px";
    inputWrapper.style.alignItems = "center";
    this.customInput = inputWrapper.createEl("input", {
      type: "text",
      placeholder: "Search for a system prompt file...",
      cls: "systemsculpt-custom-input"
    });
    const createButton2 = inputWrapper.createEl("button", {
      cls: "systemsculpt-create-button"
    });
    createButton2.style.padding = "4px 8px";
    createButton2.style.borderRadius = "4px";
    createButton2.style.cursor = "pointer";
    (0, import_obsidian10.setIcon)(createButton2, "plus");
    createButton2.addEventListener("click", async () => {
      var _a2, _b2, _c;
      let templateContent = "";
      try {
        templateContent = await this.systemPromptService.getSystemPromptTemplate();
      } catch (error) {
        console.error("Error fetching system prompt template:", error);
        await showPopup(this.app, "", {
          title: "Error",
          description: "Failed to fetch system prompt template. Please try again later.",
          primaryButton: "OK"
        });
        return;
      }
      const result = await showPopup(this.app, "", {
        title: "Create New System Prompt",
        description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
        primaryButton: "Create",
        secondaryButton: "Cancel",
        inputs: [
          {
            type: "text",
            placeholder: "My Custom Assistant",
            required: true,
            className: "systemsculpt-prompt-creation-title-input"
          },
          {
            type: "textarea",
            value: templateContent,
            required: true,
            className: "systemsculpt-prompt-creation-content"
          }
        ]
      });
      if (!(result == null ? void 0 : result.confirmed) || !((_a2 = result.inputs) == null ? void 0 : _a2[0]) || !((_b2 = result.inputs) == null ? void 0 : _b2[1])) {
        return;
      }
      const [title2, content] = result.inputs;
      const promptsDirectory = (_c = this.options.systemPromptsDirectory) != null ? _c : "SystemSculpt/System Prompts";
      const fileName = sanitizeFileName(title2);
      const filePath = getSystemPromptPath(promptsDirectory, fileName);
      try {
        await this.app.vault.createFolder(promptsDirectory).catch(() => {
        });
        const fileContent = `# ${title2}

${content}`;
        const file = await this.app.vault.create(filePath, fileContent);
        if (!file) {
          throw new Error("Failed to create file");
        }
        if (this.textArea) {
          this.textArea.value = fileContent;
          this.textArea.readOnly = false;
        }
        this.customInput.value = filePath;
        await showPopup(this.app, "", {
          title: "Success",
          description: "System prompt file created successfully!",
          primaryButton: "OK"
        });
      } catch (error) {
        console.error("Error creating system prompt file:", error);
        const errorMessage = error instanceof Error ? error.message : "Failed to create system prompt file. Please try again.";
        await showPopup(this.app, "", {
          title: "Error",
          description: errorMessage,
          primaryButton: "OK"
        });
      }
    });
    if (this.customInput) {
      attachFileSuggester(this.customInput, async (selectedPath) => {
        try {
          const file = this.app.vault.getAbstractFileByPath(selectedPath);
          if (file && file instanceof import_obsidian10.TFile) {
            const content = await this.app.vault.read(file);
            this.textArea.value = content;
            this.textArea.readOnly = false;
            this.customInput.value = selectedPath.replace(/\.md$/, "");
          }
        } catch (error) {
          console.error("Error reading system prompt file:", error);
        }
      }, this.app, (_a = this.options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts");
    }
    this.textArea = textAreaContainer.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter system prompt",
        readOnly: this.activePreset !== "Custom"
      }
    });
    this.textArea.value = this.currentPrompt;
    if (this.options.mode === "chat-specific") {
      const tokenLimitContainer = textAreaContainer.createDiv({
        cls: "systemsculpt-token-limit-container"
      });
      tokenLimitContainer.style.display = "flex";
      tokenLimitContainer.style.justifyContent = "flex-end";
      tokenLimitContainer.style.alignItems = "center";
      tokenLimitContainer.style.marginTop = "1rem";
      tokenLimitContainer.style.gap = "8px";
      const tokenLimitWrapper = tokenLimitContainer.createDiv({
        cls: "systemsculpt-token-limit-wrapper"
      });
      tokenLimitWrapper.style.display = "flex";
      tokenLimitWrapper.style.flexDirection = "column";
      tokenLimitWrapper.style.alignItems = "flex-end";
      tokenLimitWrapper.style.width = "50%";
      const tokenLimitLabel = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-label",
        text: "Context Token Limit"
      });
      tokenLimitLabel.style.fontWeight = "500";
      tokenLimitLabel.style.marginBottom = "4px";
      tokenLimitLabel.style.fontSize = "14px";
      const inputWrapper2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-input-wrapper"
      });
      inputWrapper2.style.display = "flex";
      inputWrapper2.style.alignItems = "center";
      inputWrapper2.style.gap = "4px";
      inputWrapper2.style.width = "100%";
      this.tokenLimitInput = inputWrapper2.createEl("input", {
        type: "range",
        cls: "systemsculpt-token-limit-input",
        attr: {
          min: "0",
          max: "100",
          step: "1",
          value: ((_b = this.options.tokenLimitPercentage) == null ? void 0 : _b.toString()) || "0"
        }
      });
      this.tokenLimitInput.style.width = "100%";
      const valueDisplay = inputWrapper2.createDiv({
        cls: "systemsculpt-token-limit-display",
        text: this.options.tokenLimitPercentage ? this.options.modelContextLength ? `${Math.floor(this.options.tokenLimitPercentage / 100 * this.options.modelContextLength / 1e3)}K` : `${this.options.tokenLimitPercentage}%` : "\u221E"
      });
      valueDisplay.style.minWidth = "45px";
      valueDisplay.style.textAlign = "right";
      valueDisplay.style.fontVariantNumeric = "tabular-nums";
      valueDisplay.style.fontSize = "14px";
      valueDisplay.style.fontWeight = "500";
      valueDisplay.style.color = "var(--text-accent)";
      const description2 = tokenLimitWrapper.createDiv({
        cls: "systemsculpt-token-limit-description",
        text: this.options.modelContextLength ? `Model max: ${Math.floor(this.options.modelContextLength / 1e3)}K tokens` : "Set to 0% for no limit"
      });
      description2.style.fontSize = "12px";
      description2.style.color = "var(--text-muted)";
      description2.style.marginTop = "4px";
      this.tokenLimitInput.addEventListener("input", (e) => {
        const percentage = parseInt(e.target.value, 10);
        if (percentage === 0) {
          valueDisplay.setText("\u221E");
        } else if (this.options.modelContextLength) {
          const tokens = Math.floor(percentage / 100 * this.options.modelContextLength / 1e3);
          valueDisplay.setText(`${tokens}K`);
        } else {
          valueDisplay.setText(`${percentage}%`);
        }
      });
    }
    if (this.activePreset === "Custom" && this.options.customPromptFilePath) {
      this.customInput.value = this.options.customPromptFilePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    }
    const resizeObserver = new ResizeObserver(() => {
      this.textArea.style.height = "auto";
      this.textArea.style.height = this.textArea.scrollHeight + "px";
    });
    resizeObserver.observe(this.textArea);
    const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
    const secondaryButton = buttonContainer.createEl("button", {
      text: "Cancel",
      cls: "systemsculpt-button"
    });
    const handleCancel = () => {
      this.result = null;
      this.close();
    };
    secondaryButton.onclick = handleCancel;
    const primaryButton = buttonContainer.createEl("button", {
      text: "Save",
      cls: "systemsculpt-button mod-cta"
    });
    const handleSave = () => {
      var _a2, _b2;
      const activeButton = this.modalEl.querySelector(".systemsculpt-preset-button.active");
      const activePresetLabel = (_a2 = activeButton == null ? void 0 : activeButton.textContent) != null ? _a2 : "";
      let result;
      if (activePresetLabel === "Custom" && this.customInput.value) {
        const path = this.customInput.value.replace(/\.md$/, "");
        result = {
          content: this.textArea.value,
          type: "custom",
          path
        };
      } else {
        const preset = this.systemPrompts.find((p) => p.label === activePresetLabel);
        if (preset) {
          result = {
            content: preset.systemPrompt,
            type: preset.id
          };
        } else {
          result = {
            content: this.textArea.value,
            type: "custom"
          };
        }
      }
      if (this.options.mode === "chat-specific" && ((_b2 = this.tokenLimitInput) == null ? void 0 : _b2.value)) {
        const percentage = parseInt(this.tokenLimitInput.value, 10);
        if (percentage > 0) {
          result.tokenLimitPercentage = percentage;
          if (this.options.modelContextLength) {
            result.tokenLimit = Math.floor(percentage / 100 * this.options.modelContextLength);
          }
        }
      }
      this.result = result;
      this.close();
    };
    primaryButton.onclick = handleSave;
    this.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
        e.preventDefault();
        handleSave();
      } else if (e.key === "Escape") {
        e.preventDefault();
        handleCancel();
      }
    });
    this.textArea.focus();
    this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
    await this.loadSystemPrompts();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
      this.resolvePromise(this.result);
    }
  }
  async openAndGetValue() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
};
async function showSystemPromptModal(app, currentPrompt, options) {
  const defaultOptions = {
    systemPromptsDirectory: "SystemSculpt/System Prompts",
    mode: "default",
    modelContextLength: void 0
  };
  const modal = new SystemPromptModal(app, currentPrompt, {
    ...defaultOptions,
    ...options
  });
  const result = await modal.openAndGetValue();
  if (result !== null && (options == null ? void 0 : options.onSave)) {
    await options.onSave(result.content);
  }
  return result;
}

// src/modals/SettingsTab.ts
var SystemSculptSettingTab = class extends import_obsidian12.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.debounceTimer = null;
    this.plugin = plugin;
    this.systemSculptService = SystemSculptService.getInstance(plugin.settings, this.app);
  }
  validateDirectory(path) {
    if (!path)
      return true;
    return !path.includes("..") && !path.startsWith("/") && !path.startsWith("\\");
  }
  async handleDirectoryChange(value, settingKey) {
    if (!this.validateDirectory(value)) {
      showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
      return;
    }
    if (this.debounceTimer)
      clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(async () => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    }, 500);
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    const mainContainer = containerEl.createDiv("systemsculpt-settings-container");
    mainContainer.createEl("h2", { text: "SystemSculpt AI Settings" });
    const tabContainer = mainContainer.createDiv("systemsculpt-settings-tabs");
    const contentContainer = mainContainer.createDiv("systemsculpt-settings-content");
    const tabs = [
      { id: "license", label: "License" },
      { id: "directories", label: "Directories" },
      { id: "recorder", label: "Recorder" },
      { id: "chat", label: "Chat" },
      { id: "tasks", label: "Tasks" },
      { id: "advanced", label: "Advanced" }
    ];
    tabs.forEach((tab) => {
      const tabButton = tabContainer.createEl("button", {
        cls: "systemsculpt-tab-button",
        text: tab.label
      });
      tabButton.dataset.tab = tab.id;
      if (tab.id === "license")
        tabButton.addClass("active");
    });
    const isProActive = this.plugin.settings.licenseValid === true;
    const licenseContent = contentContainer.createDiv("systemsculpt-tab-content active");
    const directoriesContent = contentContainer.createDiv("systemsculpt-tab-content");
    const recorderContent = contentContainer.createDiv("systemsculpt-tab-content");
    const chatContent = contentContainer.createDiv("systemsculpt-tab-content");
    const tasksContent = contentContainer.createDiv("systemsculpt-tab-content");
    const advancedContent = contentContainer.createDiv("systemsculpt-tab-content");
    this.displayLicenseTab(licenseContent, isProActive);
    this.displayDirectoriesTab(directoriesContent, isProActive);
    this.displayRecorderTab(recorderContent);
    this.displayChatTab(chatContent);
    this.displayTasksTab(tasksContent);
    this.displayAdvancedTab(advancedContent);
    tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((button) => {
      button.addEventListener("click", (e) => {
        var _a;
        const target = e.target;
        const tabId = target.dataset.tab;
        tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((b) => b.classList.remove("active"));
        contentContainer.querySelectorAll(".systemsculpt-tab-content").forEach((c) => c.classList.remove("active"));
        target.classList.add("active");
        (_a = contentContainer.querySelector(`[data-tab="${tabId}"]`)) == null ? void 0 : _a.classList.add("active");
      });
    });
    if (!document.getElementById("systemsculpt-settings-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-settings-styles";
      style.textContent = `
      .systemsculpt-settings-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 16px;
        border-bottom: 1px solid var(--background-modifier-border);
        padding-bottom: 8px;
        max-width: 100%;
      }
      
      .systemsculpt-tab-button {
        background: none;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: var(--text-normal);
        transition: all 0.2s ease;
        font-size: 0.9em;
        flex: 1 1 auto;
        min-width: 120px;
        text-align: center;
      }
      
      .systemsculpt-tab-button:hover {
        background-color: var(--background-modifier-hover);
      }
      
      .systemsculpt-tab-button.active {
        background-color: var(--interactive-accent);
        color: var(--text-on-accent);
      }
      
      .systemsculpt-tab-content {
        display: none;
        max-width: 100%;
        overflow-x: hidden;
      }
      
      .systemsculpt-tab-content.active {
        display: block;
        padding: 0 8px;
      }
      
      /* License Tab Styling */
      .systemsculpt-license-input {
        width: 100%;
        max-width: 400px;
      }
      
      .pro-badge {
        background: var(--interactive-accent);
        color: var(--text-on-accent);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: 600;
        margin-left: 8px;
        vertical-align: middle;
      }
      
      .token-balance-value {
        font-weight: 600;
        color: var(--text-accent);
        margin-left: 8px;
      }
      
      .pro-features-grid .setting-item {
        padding: 8px;
        border-radius: 4px;
        background: var(--background-secondary-alt);
        margin: 4px 0;
      }
      
      .pro-benefits-list {
        margin: 16px 0;
        padding-left: 20px;
        color: var(--text-muted);
      }
      
      .pro-benefits-list li {
        margin: 8px 0;
        list-style-type: '\u2192';
        padding-left: 20px;
        text-indent: -12px;
        word-break: break-word;
      }
    `;
      mainContainer.appendChild(style);
    }
  }
  displayLicenseTab(containerEl, isProActive) {
    containerEl.dataset.tab = "license";
    const licenseSettingContainer = containerEl.createDiv("systemsculpt-license-settings");
    licenseSettingContainer.createEl("h3", {
      text: "SystemSculpt License"
    });
    const licenseSetting = new import_obsidian12.Setting(licenseSettingContainer).setName("License Key").setDesc("Unlock Pro features with your license key").addText((text) => {
      text.setPlaceholder("Paste license key").setValue(this.plugin.settings.licenseKey).onChange(async (value) => {
        this.plugin.settings.licenseKey = value;
        await this.plugin.saveSettings();
      }).inputEl.addClass("systemsculpt-license-input");
      text.inputEl.type = "password";
      text.inputEl.style.fontFamily = "monospace";
      text.inputEl.addEventListener("focus", () => {
        text.inputEl.type = "text";
        text.inputEl.style.fontFamily = "inherit";
      });
      text.inputEl.addEventListener("blur", () => {
        text.inputEl.type = "password";
        text.inputEl.style.fontFamily = "monospace";
      });
      return text;
    }).addToggle((toggle) => {
      toggle.setValue(isProActive).setTooltip(isProActive ? "Disable Pro features" : "Enable Pro features").onChange(async (value) => {
        if (value) {
          const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true, true);
          if (!isValid) {
            toggle.setValue(false);
            showPopup(this.app, "Invalid license key - Pro features disabled");
          }
        } else {
          this.plugin.settings.licenseValid = false;
          await this.plugin.saveSettings();
        }
        this.display();
      });
      if (isProActive) {
        toggle.toggleEl.addClass("mod-cta");
      }
    });
    if (isProActive) {
      const statusSetting = new import_obsidian12.Setting(licenseSettingContainer).setName("Pro Status").setDesc("Active subscription \u2022 Premium features enabled");
      statusSetting.nameEl.createSpan({
        cls: "pro-badge",
        text: "ACTIVE"
      });
      const balanceEl = createSpan({
        cls: "token-balance-value",
        text: "Loading..."
      });
      statusSetting.addExtraButton((button) => {
        button.setIcon("sparkles").setTooltip("Available credits").setDisabled(true);
        statusSetting.controlEl.appendChild(balanceEl);
      });
      this.displayTokenBalance(balanceEl);
    }
    this.displayProPromotionSection(licenseSettingContainer, isProActive);
    const betaNoticeEl = licenseSettingContainer.createEl("div", {
      cls: "systemsculpt-beta-notice"
    });
    const headerContainer = betaNoticeEl.createEl("div", {
      cls: "beta-notice-header"
    });
    new import_obsidian12.Setting(headerContainer).setHeading().setName("Beta Testing Phase").addExtraButton((button) => {
      button.setIcon("rocket").setDisabled(true).extraSettingsEl.addClass("beta-header-icon");
    });
    betaNoticeEl.createEl("p", {
      text: "Thank you for trying out SystemSculpt! While some core features are available to everyone during this beta phase, certain advanced capabilities are currently limited to Patreon members to help manage the testing group size.",
      cls: "beta-notice-text"
    });
    betaNoticeEl.createEl("p", {
      text: "As a solo developer, your feedback is incredibly valuable in shaping SystemSculpt. Feel free to test the available features, and if you'd like access to the full beta experience, consider becoming a Patreon supporter!",
      cls: "beta-notice-text"
    });
    if (!document.getElementById("systemsculpt-beta-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-beta-styles";
      style.textContent = `
        .systemsculpt-beta-notice {
          margin-top: 32px;
          padding: 20px;
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .beta-notice-header {
          margin-bottom: 16px;
        }

        .beta-notice-header .setting-item {
          padding: 0;
          border: none;
        }

        .beta-notice-header .setting-item-name {
          font-size: 1.2em;
          font-weight: 600;
          color: var(--text-normal);
        }

        .beta-header-icon {
          color: var(--interactive-accent) !important;
          background: none !important;
          padding: 0 !important;
          margin-right: 8px !important;
        }

        .beta-notice-text {
          margin: 12px 0;
          color: var(--text-normal);
          line-height: 1.6;
          font-size: 0.95em;
        }

        .theme-dark .systemsculpt-beta-notice {
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
      `;
      containerEl.appendChild(style);
    }
  }
  async displayTokenBalance(containerEl) {
    try {
      const balance = await this.systemSculptService.getTokenBalance();
      containerEl.setText(`Available Credits: ${balance.toLocaleString()}`);
    } catch (error) {
      containerEl.setText("Unable to fetch credit balance");
      console.error("Failed to fetch token balance:", error);
    }
  }
  displayProPromotionSection(containerEl, isProActive) {
    if (!isProActive) {
      const proPromotionEl = containerEl.createEl("div", {
        cls: "systemsculpt-pro-promotion"
      });
      const headerContainer = proPromotionEl.createEl("div", {
        cls: "pro-promotion-header"
      });
      new import_obsidian12.Setting(headerContainer).setHeading().setName("Upgrade to Pro").addExtraButton((button) => {
        button.setIcon("sparkles").setDisabled(true).extraSettingsEl.addClass("pro-header-icon");
      });
      proPromotionEl.createEl("p", {
        text: "Transform your workflow with powerful AI features designed for serious productivity.",
        cls: "pro-promotion-text"
      });
      const benefitsList = proPromotionEl.createEl("ul", {
        cls: "pro-benefits-list"
      });
      [
        "Audio Recording & Instant Transcription",
        "Smart Document Processing",
        "Real-time Voice-to-Text in Notes & Chat",
        "Multi-format Support (PDF, Audio, Images)",
        "AI Templates & Custom Personalities",
        "Priority Access to New Features",
        "1-on-1 Support via Patreon DMs",
        "Support SystemSculpt's Development"
      ].forEach((benefit) => {
        benefitsList.createEl("li", { text: benefit });
      });
      new import_obsidian12.Setting(proPromotionEl).addButton((button) => button.setButtonText("Become a Patron").setCta().onClick(() => {
        window.open(PATREON_URL, "_blank");
      }));
    }
  }
  displayChatTab(containerEl) {
    containerEl.dataset.tab = "chat";
    containerEl.createEl("h3", { text: "Chat Settings" });
    const modelSetting = new import_obsidian12.Setting(containerEl).setName("AI Model").setDesc("Select which AI model to use for chat");
    modelSetting.addButton((button) => button.setButtonText("Select Model").onClick(async () => {
      button.setDisabled(true);
      try {
        const models = await this.systemSculptService.getModels();
        const modal = new ModelSelectionModal(this.app, this.plugin.settings.selectedModelId, async (modelId) => {
          this.plugin.settings.selectedModelId = modelId;
          await this.plugin.saveSettings();
          const modelDisplay = containerEl.querySelector(".systemsculpt-current-model");
          if (modelDisplay) {
            modelDisplay.setText(`Current model: ${modelId}`);
          }
        }, this.plugin);
        modal.open();
      } catch (error) {
        console.error("Error loading models:", error);
        showPopup(this.app, "Failed to load available models");
      } finally {
        button.setDisabled(false);
      }
    }));
    modelSetting.descEl.createEl("div", {
      text: `Current model: ${this.plugin.settings.selectedModelId}`,
      cls: "systemsculpt-current-model"
    });
    new import_obsidian12.Setting(containerEl).setName("Chat System Prompt").setDesc("Customize the system prompt used for all new chats").addButton((button) => {
      button.setButtonText("Edit Prompt").onClick(async () => {
        const result = await showSystemPromptModal(this.app, this.plugin.settings.systemPrompt, {
          onSave: async (newPrompt) => {
            this.plugin.settings.systemPrompt = newPrompt;
            await this.plugin.saveSettings();
          },
          systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
          mode: "default",
          customPromptFilePath: this.plugin.settings.systemPromptPath
        });
        if (result == null ? void 0 : result.content) {
          this.plugin.settings.systemPrompt = result.content;
          this.plugin.settings.systemPromptType = result.type;
          if ((result == null ? void 0 : result.type) === "custom" && (result == null ? void 0 : result.path)) {
            this.plugin.settings.systemPromptPath = result.path;
          } else {
            this.plugin.settings.systemPromptPath = "";
          }
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayAdvancedTab(containerEl) {
    containerEl.dataset.tab = "advanced";
    new import_obsidian12.Setting(containerEl).setName("Development Mode").setDesc("Toggle between development and production API endpoints").addToggle((toggle) => toggle.setValue(this.plugin.settings.developmentMode).onChange(async (value) => {
      this.plugin.settings.developmentMode = value;
      this.plugin.settings.serverUrl = value ? "http://localhost:3001" : "https://api.systemsculpt.com";
      await this.plugin.saveSettings();
      new import_obsidian12.Notice(`Switched to ${value ? "development" : "production"} mode (${this.systemSculptService.baseUrl})`);
    }));
    new import_obsidian12.Setting(containerEl).setName("Reset to Factory Settings").setDesc("Clear all custom settings and restore defaults for this plugin.").addButton((btn) => {
      btn.setButtonText("Reset\u2026").onClick(async () => {
        const confirm = await showPopup(this.app, "Reset to Factory Defaults", {
          description: "This will delete ALL saved settings and customizations for SystemSculpt, returning everything to default. Do you want to continue?",
          primaryButton: "Reset & Reload",
          secondaryButton: "Cancel"
        });
        if (!confirm || !confirm.confirmed) {
          return;
        }
        try {
          await this.plugin.saveData(null);
          await this.plugin.getSettingsManager().updateSettings(DEFAULT_SETTINGS);
          window.location.reload();
        } catch (error) {
          console.error("Error resetting to factory settings:", error);
          showPopup(this.app, "Failed to reset: " + String(error));
        }
      });
    });
  }
  async displayDirectoriesTab(containerEl, isProActive) {
    containerEl.dataset.tab = "directories";
    containerEl.createEl("h3", { text: "Directory Settings" });
    this.createDirectorySetting(containerEl, "Chats Directory", "Select the directory for your chat history", "chatsDirectory", "SystemSculpt/Chats");
    this.createDirectorySetting(containerEl, "Recordings Directory", "Select the directory for your recordings", "recordingsDirectory", "SystemSculpt/Recordings");
    this.createDirectorySetting(containerEl, "System Prompts Directory", "Select the directory for your custom system prompts", "systemPromptsDirectory", "SystemSculpt/System Prompts");
    this.createDirectorySetting(containerEl, "Attachments Directory", "Select the directory for saved images and attachments", "attachmentsDirectory", "SystemSculpt/Attachments");
    this.createDirectorySetting(containerEl, "Extractions Directory", "Select the directory where extracted PDFs/docs will be placed", "extractionsDirectory", "SystemSculpt/Extractions");
    this.createDirectorySetting(containerEl, "Tasks Directory", "Select the directory for your task lists", "tasksDirectory", "SystemSculpt/Tasks");
  }
  createDirectorySetting(containerEl, name, desc, settingKey, placeholder) {
    new import_obsidian12.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      text.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
        await this.handleDirectoryChange(value, settingKey);
      });
      attachFolderSuggester(text.inputEl, async (selectedPath) => {
        if (this.validateDirectory(selectedPath)) {
          this.plugin.settings[settingKey] = selectedPath;
          text.setValue(selectedPath);
          await this.plugin.saveSettings();
        } else {
          showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
        }
      }, this.app);
      return text;
    });
  }
  displayRecorderTab(containerEl) {
    containerEl.dataset.tab = "recorder";
    containerEl.createEl("h3", { text: "Recording Settings" });
    const microphoneSetting = new import_obsidian12.Setting(containerEl).setName("Preferred Microphone").setDesc("Select your preferred microphone for recordings");
    const micSelect = microphoneSetting.controlEl.createEl("select", {
      cls: "systemsculpt-microphone-select"
    });
    micSelect.createEl("option", {
      value: "",
      text: "Loading microphones..."
    }).setAttribute("disabled", "true");
    micSelect.disabled = true;
    try {
      navigator.mediaDevices.enumerateDevices().then((devices) => {
        var _a;
        const microphones = devices.filter((device) => device.kind === "audioinput");
        micSelect.disabled = false;
        (_a = micSelect.firstElementChild) == null ? void 0 : _a.remove();
        microphones.forEach((mic) => {
          const option = micSelect.createEl("option", {
            value: mic.deviceId,
            text: mic.label || `Microphone ${mic.deviceId.slice(0, 8)}...`
          });
          if (mic.deviceId === this.plugin.settings.preferredMicrophoneId) {
            option.selected = true;
          }
        });
      }).catch((error) => {
        console.error("Error enumerating audio devices:", error);
        micSelect.createEl("option", {
          value: "",
          text: "Unable to list microphones"
        });
      });
    } catch (error) {
      console.error("Microphone initialization failed:", error);
    }
    micSelect.addEventListener("change", async () => {
      this.plugin.settings.preferredMicrophoneId = micSelect.value;
      await this.plugin.saveSettings();
    });
    new import_obsidian12.Setting(containerEl).setName("Auto-Transcribe Recordings").setDesc("Automatically transcribe recordings when they are completed").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoTranscribeRecordings).onChange(async (value) => {
      this.plugin.settings.autoTranscribeRecordings = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian12.Setting(containerEl).setName("Auto-Paste Transcription").setDesc("Automatically paste transcriptions into the active document").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoPasteTranscription).onChange(async (value) => {
      this.plugin.settings.autoPasteTranscription = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian12.Setting(containerEl).setName("Post-Processing").setDesc("Configure how transcriptions should be post-processed").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.postProcessingEnabled).setTooltip("Enable/disable post-processing").onChange(async (value) => {
        this.plugin.settings.postProcessingEnabled = value;
        await this.plugin.saveSettings();
      });
      return toggle;
    }).addButton((button) => {
      button.setButtonText("Edit Prompt").setTooltip("Configure the post-processing prompt").onClick(async () => {
        const { showPostProcessingPromptModal: showPostProcessingPromptModal2 } = await Promise.resolve().then(() => (init_PostProcessingPromptModal(), PostProcessingPromptModal_exports));
        const result = await showPostProcessingPromptModal2(this.app, this.plugin, this.plugin.settings.postProcessingPrompt);
        if (result) {
          this.plugin.settings.postProcessingPrompt = result.content;
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayTasksTab(containerEl) {
    containerEl.dataset.tab = "tasks";
    containerEl.createEl("h3", { text: "Tasks Settings" });
    new import_obsidian12.Setting(containerEl).setName("Auto-Move Completed Tasks").setDesc("Automatically move completed tasks to the bottom of the list").addToggle((toggle) => toggle.setValue(this.plugin.settings.moveCompletedTasksDown).onChange(async (value) => {
      this.plugin.settings.moveCompletedTasksDown = value;
      await this.plugin.saveSettings();
    }));
  }
};

// src/services/RecorderService.ts
var import_obsidian26 = __toModule(require("obsidian"));

// src/modals/AudioTranscriptionModal.ts
var import_obsidian13 = __toModule(require("obsidian"));

// src/services/TranscriptionService.ts
init_SystemSculptService();
var SUPPORTED_AUDIO_EXTENSIONS = ["wav", "m4a", "webm", "ogg", "mp3"];
var MIME_TYPE_MAP = {
  wav: "audio/wav",
  m4a: "audio/mp4",
  webm: "audio/webm",
  ogg: "audio/ogg;codecs=opus",
  mp3: "audio/mpeg"
};
var TranscriptionService = class {
  constructor(plugin) {
    this.isTranscribing = false;
    this.plugin = plugin;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!TranscriptionService.instance) {
      TranscriptionService.instance = new TranscriptionService(plugin);
    }
    return TranscriptionService.instance;
  }
  async parseErrorResponse(response) {
    try {
      const data = await response.json();
      if (data.error) {
        if (typeof data.error === "string") {
          return { message: data.error, data };
        }
        if (data.error.message) {
          return { message: data.error.message, data };
        }
        return { message: JSON.stringify(data.error), data };
      }
      return { message: response.statusText, data };
    } catch (e) {
      return { message: response.statusText };
    }
  }
  async transcribeFile(file, context) {
    var _a, _b, _c, _d;
    console.log("TranscriptionService.transcribeFile called with:", {
      fileName: file.name,
      context
    });
    if (this.isTranscribing) {
      throw new Error("Already transcribing a file");
    }
    const extension = file.extension.toLowerCase();
    if (!SUPPORTED_AUDIO_EXTENSIONS.includes(extension)) {
      throw new Error(`Unsupported file type: ${extension}`);
    }
    this.isTranscribing = true;
    (_a = context == null ? void 0 : context.onProgress) == null ? void 0 : _a.call(context, 0, "Reading audio file...");
    const arrayBuffer = await this.plugin.app.vault.readBinary(file);
    const blob = new Blob([arrayBuffer], {
      type: MIME_TYPE_MAP[extension]
    });
    const formData = new FormData();
    formData.append("file", blob, file.name);
    if (context == null ? void 0 : context.timestamped) {
      formData.append("timestamped", "true");
    }
    try {
      (_b = context == null ? void 0 : context.onProgress) == null ? void 0 : _b.call(context, 20, "Uploading audio...");
      const response = await fetch(`${this.sculptService.baseUrl}/api/v1/audio/transcriptions`, {
        method: "POST",
        headers: {
          "x-license-key": this.plugin.settings.licenseKey
        },
        body: formData
      });
      console.log("Raw server response:", {
        status: response.status,
        ok: response.ok,
        contentType: response.headers.get("content-type")
      });
      let data;
      if (!response.ok) {
        const { message: errorMessage, data: parsedData } = await this.parseErrorResponse(response);
        console.log("Error response parsed:", { errorMessage, parsedData });
        if (response.status === 400 && errorMessage === "Credits charged successfully") {
          console.log("Credits charged successfully, continuing with transcription...");
          data = parsedData;
        } else {
          throw new Error(`Failed to transcribe file: ${response.status} - ${errorMessage}`);
        }
      } else {
        const responseText = await response.text();
        console.log("Raw response text:", responseText);
        try {
          data = JSON.parse(responseText);
          console.log("Parsed response data:", data);
        } catch (e) {
          console.error("Failed to parse response JSON:", e);
          throw new Error("Invalid JSON response from server");
        }
      }
      (_c = context == null ? void 0 : context.onProgress) == null ? void 0 : _c.call(context, 60, "Processing audio...");
      console.log("Final data object:", {
        hasData: !!data,
        dataType: typeof data,
        keys: data ? Object.keys(data) : null,
        textType: (data == null ? void 0 : data.text) ? typeof data.text : null,
        textLength: (data == null ? void 0 : data.text) ? data.text.length : null,
        textPreview: (data == null ? void 0 : data.text) ? data.text.substring(0, 100) + "..." : null
      });
      if (!data || typeof data.text !== "string") {
        console.error("Invalid response data:", data);
        throw new Error("No transcription text received from server");
      }
      const trimmedText = data.text.trim();
      console.log("Trimmed text:", {
        length: trimmedText.length,
        preview: trimmedText.substring(0, 100) + "..."
      });
      if (!trimmedText) {
        console.error("Empty transcription text after trimming:", data);
        throw new Error("Empty transcription text received from server");
      }
      (_d = context == null ? void 0 : context.onProgress) == null ? void 0 : _d.call(context, 100, "Transcription complete!");
      return trimmedText;
    } catch (error) {
      console.error("Transcription error:", error);
      throw error;
    } finally {
      this.isTranscribing = false;
    }
  }
  unload() {
  }
};

// src/services/PostProcessingService.ts
init_SystemSculptService();
var PostProcessingService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.defaultModelId = null;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!PostProcessingService.instance) {
      PostProcessingService.instance = new PostProcessingService(plugin);
    }
    return PostProcessingService.instance;
  }
  async findDefaultModel() {
    if (this.defaultModelId)
      return this.defaultModelId;
    try {
      const models = await this.sculptService.getModels();
      const defaultModel = models.find((model) => {
        var _a;
        return (_a = model.name) == null ? void 0 : _a.match(/\(Default\)/i);
      });
      if (!defaultModel) {
        throw new Error("Default model not found");
      }
      this.defaultModelId = defaultModel.id;
      return defaultModel.id;
    } catch (error) {
      console.error("Error finding default model:", error);
      throw error;
    }
  }
  async processTranscription(text) {
    if (!this.plugin.settings.postProcessingEnabled) {
      return text;
    }
    try {
      const modelId = await this.findDefaultModel();
      const messages = [
        {
          role: "system",
          content: this.plugin.settings.postProcessingPrompt,
          message_id: crypto.randomUUID()
        },
        {
          role: "user",
          content: text,
          message_id: crypto.randomUUID()
        }
      ];
      let processedText = "";
      for await (const chunk of this.sculptService.streamMessage({
        messages,
        model: modelId,
        temperature: 0.3
      })) {
        if (chunk.content) {
          processedText += chunk.content;
        }
      }
      return processedText.trim();
    } catch (error) {
      console.error("Error post-processing transcription:", error);
      return text;
    }
  }
};

// src/modals/AudioTranscriptionModal.ts
var PersistentTranscriptionNotice = class extends import_obsidian13.Notice {
  constructor() {
    super("", 0);
    this.noticeEl.addClass("systemsculpt-transcription-notice");
    const progressContainer = this.noticeEl.createDiv("transcription-progress");
    const statusContainer = progressContainer.createDiv("transcription-status");
    this.statusIcon = statusContainer.createDiv("transcription-status-icon");
    this.statusText = statusContainer.createDiv("transcription-status-text");
    const progressBarContainer = progressContainer.createDiv("transcription-progress-bar-container");
    this.progressBar = progressBarContainer.createDiv("transcription-progress-bar");
    if (!document.getElementById("systemsculpt-transcription-notice-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-transcription-notice-styles";
      style.textContent = `
        .systemsculpt-transcription-notice {
          padding: 8px 12px !important;
          min-width: 260px;
        }

        .transcription-progress {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .transcription-status {
          display: flex;
          align-items: center;
          gap: 8px;
          color: var(--text-normal);
        }

        .transcription-status-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--text-accent);
        }

        .transcription-status-text {
          flex: 1;
          font-size: 14px;
        }

        .transcription-progress-bar-container {
          width: 100%;
          height: 4px;
          background: var(--background-modifier-border);
          border-radius: 2px;
          overflow: hidden;
        }

        .transcription-progress-bar {
          height: 100%;
          background: var(--text-accent);
          border-radius: 2px;
          transition: width 0.3s ease;
          width: 0%;
        }

        .notice-success .transcription-progress-bar {
          background: var(--text-success) !important;
        }

        .notice-error .transcription-progress-bar {
          background: var(--text-error) !important;
        }
      `;
      document.head.appendChild(style);
    }
  }
  updateProgress({ progress, status, icon }) {
    this.progressBar.style.width = `${progress}%`;
    this.statusText.setText(status);
    this.statusIcon.empty();
    (0, import_obsidian13.setIcon)(this.statusIcon, icon);
    this.noticeEl.removeClass("notice-success", "notice-error");
    if (progress === 100) {
      this.noticeEl.addClass("notice-success");
    } else if (progress === 0 && icon === "x-circle") {
      this.noticeEl.addClass("notice-error");
    }
  }
};
var AudioTranscriptionModal = class {
  constructor(app, options) {
    this.options = options;
    this.transcriptionService = TranscriptionService.getInstance(options.plugin);
    this.postProcessingService = PostProcessingService.getInstance(options.plugin);
  }
  open() {
    this.notice = new PersistentTranscriptionNotice();
    this.startTranscription();
  }
  async startTranscription() {
    try {
      this.notice.updateProgress({
        progress: 0,
        status: "Starting transcription...",
        icon: "mic"
      });
      const text = await this.transcriptionService.transcribeFile(this.options.file, {
        type: this.options.isChat ? "chat" : "note",
        timestamped: this.options.timestamped,
        onProgress: (progress, status) => {
          this.notice.updateProgress({
            progress,
            status,
            icon: "audio-lines"
          });
        }
      });
      if (!text) {
        throw new Error("Failed to get transcription text");
      }
      let finalText = text;
      if (!this.options.isChat && this.options.plugin.settings.postProcessingEnabled) {
        this.notice.updateProgress({
          progress: 80,
          status: "Post-processing transcription...",
          icon: "wand"
        });
        const processedText = await this.postProcessingService.processTranscription(text);
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}

## Processed Transcription
${processedText}`;
      } else {
        finalText = this.options.isChat ? text : `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}`;
      }
      if (this.options.onTranscriptionComplete) {
        this.options.onTranscriptionComplete(finalText);
      }
      await navigator.clipboard.writeText(finalText);
      this.notice.updateProgress({
        progress: 100,
        status: "Transcription complete!",
        icon: "check-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 2e3);
    } catch (error) {
      console.error("Transcription error:", error);
      this.notice.updateProgress({
        progress: 0,
        status: `Error: ${error instanceof Error ? error.message : String(error)}`,
        icon: "x-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 4e3);
    }
  }
};
async function showAudioTranscriptionModal(app, options) {
  const modal = new AudioTranscriptionModal(app, options);
  modal.open();
}

// src/views/ChatView.ts
var import_obsidian25 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/services/ChatStorageService.ts
var import_obsidian14 = __toModule(require("obsidian"));
var ChatStorageService = class {
  constructor(app, chatDirectory) {
    this.app = app;
    this.chatDirectory = chatDirectory;
  }
  async saveChat(chatId, messages, selectedModelId, contextFiles, customPromptFilePath, systemPromptType, systemPromptPath, title, tokenLimit, tokenLimitPercentage) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const contextFileObjects = contextFiles ? Array.from(contextFiles).map((path) => {
        const isExtraction = path.includes("/Extractions/");
        return {
          path,
          type: isExtraction ? "extraction" : "source"
        };
      }) : [];
      const metadata = {
        id: chatId,
        model: selectedModelId,
        created: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        title: title || "Untitled Chat",
        context_files: contextFileObjects,
        systemMessage: systemPromptType ? {
          type: systemPromptType,
          path: systemPromptType === "custom" && systemPromptPath ? `[[${systemPromptPath}]]` : void 0,
          tokenLimit,
          tokenLimitPercentage
        } : void 0
      };
      const content = `---
${(0, import_obsidian14.stringifyYaml)(metadata)}---

${messages.map((msg) => {
        const messageStart = `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`;
        return `${messageStart}
${msg.content}
<!-- SYSTEMSCULPT-MESSAGE-END -->`;
      }).join("\n\n")}`;
      await this.app.vault.adapter.mkdir(this.chatDirectory);
      await this.app.vault.adapter.write(filePath, content);
    } catch (error) {
      console.error("Failed to save chat:", error);
      throw new Error("Failed to save chat");
    }
  }
  async loadChats() {
    try {
      const files = await this.app.vault.adapter.list(this.chatDirectory);
      const chatFiles = files.files.filter((f) => f.endsWith(".md"));
      const chats = await Promise.all(chatFiles.map(async (filePath) => {
        const content = await this.app.vault.adapter.read(filePath);
        return this.parseMarkdownContent(content);
      }));
      return chats.filter((chat) => chat !== null);
    } catch (error) {
      console.error("Failed to load chats:", error);
      return [];
    }
  }
  async loadChat(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian14.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMarkdownContent(content);
    } catch (error) {
      console.error("Failed to load chat:", error);
      return null;
    }
  }
  generateMarkdownContent(metadata, messages) {
    const yamlMetadata = {
      systemsculpt_chat: true,
      ...metadata
    };
    const metadataSection = [
      "---",
      (0, import_obsidian14.stringifyYaml)(yamlMetadata).trim(),
      "---",
      ""
    ].join("\n");
    const messagesSection = messages.map((msg) => [
      `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`,
      msg.content,
      "<!-- SYSTEMSCULPT-MESSAGE-END -->",
      ""
    ].join("\n")).join("\n");
    return metadataSection + messagesSection;
  }
  parseMetadata(content) {
    try {
      const metadataMatch = content.match(/---\n([\s\S]*?)\n---/);
      if (!metadataMatch)
        return null;
      const parsed = (0, import_obsidian14.parseYaml)(metadataMatch[1]);
      if (!parsed || typeof parsed !== "object")
        return null;
      const {
        id,
        model,
        created,
        lastModified,
        title,
        context_files,
        systemMessage
      } = parsed;
      if (!id || !model || !created || !lastModified)
        return null;
      const processedContextFiles = context_files == null ? void 0 : context_files.map((file) => {
        if (typeof file === "string") {
          const isExtraction = file.includes("/Extractions/");
          return {
            path: file,
            type: isExtraction ? "extraction" : "source"
          };
        }
        return {
          path: file.path,
          type: file.type
        };
      });
      if (systemMessage == null ? void 0 : systemMessage.path) {
        systemMessage.path = systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      return {
        id,
        model,
        created,
        lastModified,
        title: title || "Untitled Chat",
        context_files: processedContextFiles || [],
        systemMessage
      };
    } catch (error) {
      console.error("Failed to parse metadata:", error);
      return null;
    }
  }
  async parseMarkdownContent(content) {
    var _a, _b, _c;
    try {
      const metadata = this.parseMetadata(content);
      if (!metadata)
        return null;
      const messages = [];
      const messageRegex = /<!-- SYSTEMSCULPT-MESSAGE-START role="(user|assistant)" message-id="([^"]+)" -->\n([\s\S]*?)\n<!-- SYSTEMSCULPT-MESSAGE-END -->/g;
      let msgMatch;
      while ((msgMatch = messageRegex.exec(content)) !== null) {
        const [, role, messageId, messageContent] = msgMatch;
        messages.push({
          role,
          content: messageContent.trim(),
          message_id: messageId
        });
      }
      const contextFiles = (_a = metadata.context_files) == null ? void 0 : _a.map((file) => typeof file === "string" ? file : file.path);
      return {
        id: metadata.id,
        messages,
        selectedModelId: metadata.model,
        lastModified: new Date(metadata.lastModified).getTime(),
        title: metadata.title,
        context_files: contextFiles,
        customPromptFilePath: (_b = metadata.systemMessage) == null ? void 0 : _b.path,
        tokenLimit: (_c = metadata.systemMessage) == null ? void 0 : _c.tokenLimit
      };
    } catch (error) {
      console.error("Failed to parse markdown content:", error);
      return null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async getMetadata(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian14.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMetadata(content);
    } catch (error) {
      console.error("Failed to get metadata:", error);
      return null;
    }
  }
};

// src/services/ScrollManagerService.ts
var import_obsidian15 = __toModule(require("obsidian"));
var ScrollManagerService = class {
  constructor(config) {
    this.state = {
      isAutoScrollEnabled: true,
      isUserScrolling: false,
      lastContentHeight: 0
    };
    this.handleScroll = (0, import_obsidian15.debounce)(() => {
      const isAtBottom = this.isScrolledToBottom();
      if (isAtBottom && !this.state.isAutoScrollEnabled) {
        this.enableAutoScroll();
      } else if (!isAtBottom && this.state.isAutoScrollEnabled) {
        this.disableAutoScroll();
      }
    }, 150);
    this.handleWheel = (e) => {
      if (e.deltaY < 0) {
        this.disableAutoScroll();
      }
    };
    this.handleTouchStart = () => {
      this.state.isUserScrolling = true;
    };
    this.handleTouchEnd = () => {
      this.state.isUserScrolling = false;
      if (this.isScrolledToBottom()) {
        this.enableAutoScroll();
      }
    };
    this.container = config.container;
    this.onScrollStateChange = config.onScrollStateChange;
    this.attachEventListeners();
  }
  attachEventListeners() {
    this.container.addEventListener("scroll", this.handleScroll);
    this.container.addEventListener("wheel", this.handleWheel);
    this.container.addEventListener("touchstart", this.handleTouchStart);
    this.container.addEventListener("touchend", this.handleTouchEnd);
  }
  isScrolledToBottom() {
    const { scrollHeight, scrollTop, clientHeight } = this.container;
    return Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
  }
  scrollToBottom() {
    if (!this.state.isAutoScrollEnabled)
      return;
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      this.container.scrollTo({
        top: this.container.scrollHeight,
        behavior: this.state.isUserScrolling ? "smooth" : "auto"
      });
      this.state.lastContentHeight = this.container.scrollHeight;
    });
  }
  enableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = true;
    this.state.isUserScrolling = false;
    this.state.lastContentHeight = this.container.scrollHeight;
    this.scrollToBottom();
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, true);
  }
  disableAutoScroll() {
    var _a;
    this.state.isAutoScrollEnabled = false;
    (_a = this.onScrollStateChange) == null ? void 0 : _a.call(this, false);
  }
  updateContentHeight() {
    void this.container.offsetHeight;
    requestAnimationFrame(() => {
      const currentHeight = this.container.scrollHeight;
      if (currentHeight !== this.state.lastContentHeight) {
        this.state.lastContentHeight = currentHeight;
        if (!this.container.scrollTop || this.isScrolledToBottom()) {
          this.scrollToBottom();
        }
      }
    });
  }
  cleanup() {
    this.container.removeEventListener("scroll", this.handleScroll);
    this.container.removeEventListener("wheel", this.handleWheel);
    this.container.removeEventListener("touchstart", this.handleTouchStart);
    this.container.removeEventListener("touchend", this.handleTouchEnd);
  }
};

// src/views/ChatView.ts
init_ui();
init_errors();

// src/views/components/DrawerComponent.ts
var import_obsidian16 = __toModule(require("obsidian"));
var DrawerComponent = class extends import_obsidian16.Component {
  constructor(options) {
    super();
    this.isMouseInProximity = false;
    this.hideTimeout = null;
    this.options = options;
    this.initializeDrawer();
    this.setupEventListeners();
  }
  initializeDrawer() {
    this.drawer = this.options.container.createEl("div", {
      cls: `systemsculpt-drawer ${this.options.cls || ""}`
    });
    this.header = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-header"
    });
    const titleEl = this.header.createEl("div", {
      cls: "systemsculpt-drawer-title"
    });
    titleEl.createSpan({ text: this.options.title });
    this.toggle = this.header.createSpan({
      cls: "systemsculpt-drawer-toggle",
      text: "\u25BC"
    });
    this.content = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-content"
    });
    this.setVisibility(false);
  }
  setupEventListeners() {
    this.drawer.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true);
    });
    this.content.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true);
    });
    this.drawer.addEventListener("mouseleave", (e) => {
      const rect = this.drawer.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY >= rect.bottom && e.clientY <= rect.bottom + buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.content.addEventListener("mouseleave", (e) => {
      const rect = this.content.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY <= rect.top && e.clientY >= rect.top - buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.header.addEventListener("click", () => {
      const isVisible = this.content.style.opacity === "1";
      this.setVisibility(!isVisible);
    });
  }
  clearHideTimeout() {
    if (this.hideTimeout) {
      clearTimeout(this.hideTimeout);
      this.hideTimeout = null;
    }
  }
  scheduleHide() {
    this.clearHideTimeout();
    this.hideTimeout = setTimeout(() => {
      if (!this.isMouseInProximity) {
        this.setVisibility(false);
      }
    }, 100);
  }
  setVisibility(visible) {
    this.content.style.opacity = visible ? "1" : "0";
    this.content.style.pointerEvents = visible ? "all" : "none";
    this.content.style.transform = `translateY(${visible ? "0" : "-8px"})`;
    this.toggle.style.transform = visible ? "rotate(0)" : "rotate(-90deg)";
    if (this.options.onVisibilityChange) {
      this.options.onVisibilityChange(visible);
    }
  }
  getContent() {
    return this.content;
  }
  getDrawer() {
    return this.drawer;
  }
  getHeader() {
    return this.header;
  }
  onunload() {
    this.clearHideTimeout();
    super.onunload();
  }
};

// src/views/components/MessageRenderer.ts
var import_obsidian17 = __toModule(require("obsidian"));
init_ui();
var MessageRenderer = class extends import_obsidian17.Component {
  constructor(app) {
    super();
    this.app = app;
  }
  async renderMessage({
    app,
    messageId,
    role,
    content
  }) {
    const messageEl = document.createElement("div");
    messageEl.classList.add("systemsculpt-message");
    messageEl.classList.add(`systemsculpt-${role}-message`);
    messageEl.dataset.messageId = messageId;
    const contentEl = messageEl.createEl("div", {
      cls: "systemsculpt-message-content"
    });
    if (typeof content === "string") {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(content, contentEl, "", this);
    } else if (Array.isArray(content)) {
      const parts = content;
      for (const part of parts) {
        if (part.type === "text") {
          const p = contentEl.createEl("p");
          p.setText(part.text);
        } else if (part.type === "image_url") {
          const img = contentEl.createEl("img", {
            attr: { src: part.image_url.url }
          });
          img.classList.add("systemsculpt-message-image");
        }
      }
    } else {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(String(content), contentEl, "", this);
    }
    this.setupImageHandlers(contentEl);
    return { messageEl, contentEl };
  }
  async renderMarkdownContent(content, containerEl) {
    containerEl.empty();
    const markdownWrapper = containerEl.createEl("div", {
      cls: "systemsculpt-markdown-wrapper"
    });
    const normalizedContent = content.replace(/\n{3,}/g, "\n\n");
    await import_obsidian17.MarkdownRenderer.renderMarkdown(normalizedContent, markdownWrapper, "", this);
    markdownWrapper.querySelectorAll("pre").forEach((preEl) => {
      var _a;
      const codeBlockWrapper = createEl("div", {
        cls: "systemsculpt-code-block-wrapper"
      });
      (_a = preEl.parentNode) == null ? void 0 : _a.replaceChild(codeBlockWrapper, preEl);
      codeBlockWrapper.appendChild(preEl);
    });
  }
  setupImageHandlers(containerEl) {
    containerEl.querySelectorAll("img").forEach((img) => {
      img.style.cursor = "pointer";
      img.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();
        const src = img.getAttribute("src");
        if (!src)
          return;
        if (src.startsWith("app://")) {
          const path = src.replace("app://local/", "");
          this.app.workspace.openLinkText(path, "", true);
        }
      });
    });
  }
  setToolbarVisibility(toolbar, visible, expanded = false) {
    toolbar.style.opacity = visible ? "1" : "0";
    toolbar.style.pointerEvents = visible ? "all" : "none";
    toolbar.style.transform = `translateY(calc(100% + ${expanded ? "4" : "8"}px))`;
  }
  addMessageButtonToolbar(messageEl, content, role, messageId) {
    const buttonToolbar = messageEl.createEl("div", {
      cls: "systemsculpt-message-button-toolbar"
    });
    const copyButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    copyButton.setAttribute("title", "Copy message to clipboard");
    (0, import_obsidian17.setIcon)(copyButton, "copy");
    copyButton.addEventListener("click", () => {
      navigator.clipboard.writeText(content);
      (0, import_obsidian17.setIcon)(copyButton, "check");
      copyButton.classList.add("success");
      setTimeout(() => {
        (0, import_obsidian17.setIcon)(copyButton, "copy");
        copyButton.classList.remove("success");
        this.setToolbarVisibility(buttonToolbar, false);
      }, 2e3);
    });
    if (role === "user") {
      const resubmitButton = buttonToolbar.createEl("button", {
        cls: "systemsculpt-message-button"
      });
      resubmitButton.setAttribute("title", "Resubmit this message");
      (0, import_obsidian17.setIcon)(resubmitButton, "rotate-ccw");
      resubmitButton.dataset.originalIcon = "rotate-ccw";
      resubmitButton.addEventListener("click", async (e) => {
        e.stopPropagation();
        const isConfirming = resubmitButton.dataset.confirming === "true";
        if (!isConfirming) {
          resubmitButton.dataset.confirming = "true";
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmit?" });
          resubmitButton.classList.add("confirming", "success");
          const timeoutId = setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 3e3);
          resubmitButton.dataset.timeoutId = timeoutId.toString();
        } else {
          const timeoutId = resubmitButton.dataset.timeoutId;
          if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
          }
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmitting..." });
          messageEl.dispatchEvent(new CustomEvent("resubmit", {
            bubbles: true,
            detail: { messageId, content }
          }));
          setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 1e3);
        }
      });
    }
    const editButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    editButton.setAttribute("title", "Edit this message");
    (0, import_obsidian17.setIcon)(editButton, "pencil");
    editButton.dataset.originalIcon = "pencil";
    editButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const currentContent = messageEl.dataset.content || content;
      const modal = new TextAreaModal(this.app, "Edit Message", currentContent, {
        primaryButton: "Save",
        secondaryButton: "Cancel",
        rows: 10
      });
      const newText = await modal.openAndGetValue();
      if (newText !== null && newText !== currentContent) {
        messageEl.dispatchEvent(new CustomEvent("edit", {
          bubbles: true,
          detail: {
            messageId,
            oldContent: currentContent,
            newContent: newText
          }
        }));
      }
    });
    const deleteButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button danger"
    });
    deleteButton.setAttribute("title", "Delete this message");
    (0, import_obsidian17.setIcon)(deleteButton, "trash");
    deleteButton.dataset.originalIcon = "trash";
    deleteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isConfirming = deleteButton.dataset.confirming === "true";
      if (!isConfirming) {
        deleteButton.dataset.confirming = "true";
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Delete?" });
        deleteButton.classList.add("confirming");
        const timeoutId = setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 3e3);
        deleteButton.dataset.timeoutId = timeoutId.toString();
      } else {
        const timeoutId = deleteButton.dataset.timeoutId;
        if (timeoutId) {
          clearTimeout(parseInt(timeoutId));
        }
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Deleting..." });
        messageEl.dispatchEvent(new CustomEvent("delete", {
          bubbles: true,
          detail: { messageId }
        }));
        setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 1e3);
      }
    });
    messageEl.addEventListener("mouseenter", () => {
      this.setToolbarVisibility(buttonToolbar, true, true);
    });
    messageEl.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !buttonToolbar.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
    buttonToolbar.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !messageEl.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
  }
  createReasoningContainer(messageEl) {
    const container = messageEl.createEl("div", {
      cls: "systemsculpt-reasoning-container"
    });
    const header = container.createEl("div", {
      cls: "systemsculpt-reasoning-header"
    });
    (0, import_obsidian17.setIcon)(header, "brain");
    header.createSpan({ text: "Reasoning" });
    header.addEventListener("click", () => {
      container.classList.toggle("collapsed");
    });
    const content = container.createEl("div", {
      cls: "systemsculpt-reasoning-content"
    });
    return { container, content };
  }
  updateReasoningContent(messageEl, reasoning, isComplete = false) {
    let container = messageEl.querySelector(".systemsculpt-reasoning-container");
    let content = messageEl.querySelector(".systemsculpt-reasoning-content");
    if (!container || !content) {
      const elements = this.createReasoningContainer(messageEl);
      container = elements.container;
      content = elements.content;
      messageEl.prepend(container);
    }
    content.textContent = reasoning;
    container.classList.add("visible");
    if (isComplete) {
      container.classList.add("collapsed");
    }
  }
};

// src/views/components/InputHandler.ts
var import_obsidian18 = __toModule(require("obsidian"));
init_errors();
init_ui();
init_ImageProcessor();
var InputHandler = class extends import_obsidian18.Component {
  constructor(options) {
    super();
    this.isGenerating = false;
    this.renderTimeout = null;
    this.recorderVisualizer = null;
    this.isRecording = false;
    this.abortController = null;
    this.stopButton = null;
    this.webSearchEnabled = false;
    this.app = options.app;
    this.container = options.container;
    this.aiService = options.aiService;
    this.getMessages = options.getMessages;
    this.getSelectedModelId = options.getSelectedModelId;
    this.getContextFiles = options.getContextFiles;
    this.getSystemPrompt = options.getSystemPrompt;
    this.chatContainer = options.chatContainer;
    this.scrollManager = options.scrollManager;
    this.messageRenderer = options.messageRenderer;
    this.onMessageSubmit = options.onMessageSubmit;
    this.onAssistantResponse = options.onAssistantResponse;
    this.onContextFileAdd = options.onContextFileAdd;
    this.onError = options.onError;
    this.onAddContextFile = options.onAddContextFile;
    this.onEditSystemPrompt = options.onEditSystemPrompt;
    this.plugin = options.plugin;
    this.chatView = options.chatView;
    console.log("Initializing InputHandler with RecorderService");
    this.recorderService = RecorderService.getInstance(this.app, this.plugin, {
      isInChat: true,
      onTranscriptionComplete: (text) => {
        console.log("Received transcription, inserting at cursor position");
        this.insertTextAtCursor(text);
      }
    });
    const originalMessageSubmit = options.onMessageSubmit;
    this.onMessageSubmit = async (message) => {
      await originalMessageSubmit(message);
    };
    const originalAssistantResponse = options.onAssistantResponse;
    this.onAssistantResponse = async (message) => {
      await originalAssistantResponse(message);
    };
    this.setupInput();
  }
  setupInput() {
    var _a;
    this.inputContainer = this.container.createEl("div", {
      cls: "systemsculpt-input-container"
    });
    this.buttonGrid = this.inputContainer.createEl("div", {
      cls: "systemsculpt-button-grid"
    });
    const attachButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Add attachment" }
    });
    (0, import_obsidian18.setIcon)(attachButton, "paperclip");
    attachButton.addEventListener("click", (e) => {
      if (e.shiftKey) {
        this.handleDocumentUpload();
      } else {
        this.onAddContextFile();
      }
    });
    const settingsButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "System prompt settings" }
    });
    (0, import_obsidian18.setIcon)(settingsButton, "settings");
    settingsButton.addEventListener("click", () => {
      this.onEditSystemPrompt();
    });
    const webSearchButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Toggle web search" }
    });
    this.webSearchButton = webSearchButton;
    (0, import_obsidian18.setIcon)(webSearchButton, "globe");
    webSearchButton.addEventListener("click", async () => {
      const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
      const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
      const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
      if (!isNativeProvider && !isOpenRouter) {
        const result = await showPopup(this.app, "Web search allows the AI to access real-time information from the internet to provide up-to-date answers.", {
          title: "Feature Restriction - Web Search",
          description: "Web search is only available for SystemSculpt and OpenRouter models. Please switch to a compatible model to use this feature.",
          primaryButton: "OK"
        });
        return;
      }
      this.webSearchEnabled = !this.webSearchEnabled;
      webSearchButton.classList.toggle("is-enabled", this.webSearchEnabled);
    });
    const hasProLicense = ((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && this.plugin.settings.licenseValid;
    const micButton = this.buttonGrid.createEl("button", {
      cls: `systemsculpt-input-action-button systemsculpt-mic-button${hasProLicense ? "" : " pro-feature"}`,
      attr: {
        "aria-label": hasProLicense ? "Record audio message" : "Record audio message (Pro feature)",
        "aria-disabled": (!hasProLicense).toString(),
        title: hasProLicense ? "Record audio message" : "Recording is a Pro feature. Click to learn more."
      }
    });
    (0, import_obsidian18.setIcon)(micButton, "mic");
    micButton.classList.toggle("disabled", !hasProLicense);
    micButton.addEventListener("click", async () => {
      if (!hasProLicense) {
        const result = await showPopup(this.app, "Voice recording allows you to quickly capture your thoughts by speaking instead of typing. This feature includes automatic transcription of your recordings to text.", {
          title: "Pro Feature - Voice Recording",
          description: "Support SystemSculpt's development and unlock voice recording, transcription, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        });
        if (result == null ? void 0 : result.confirmed) {
          window.open(PATREON_URL, "_blank");
        }
        return;
      }
      this.handleMicClick();
    });
    const sendButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-send-button",
      attr: { "aria-label": "Send message" }
    });
    (0, import_obsidian18.setIcon)(sendButton, "send");
    sendButton.addEventListener("click", this.handleSendMessage.bind(this));
    this.stopButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-stop-button",
      attr: { "aria-label": "Stop generation" }
    });
    (0, import_obsidian18.setIcon)(this.stopButton, "square");
    this.stopButton.style.display = "none";
    this.stopButton.addEventListener("click", this.handleStopGeneration.bind(this));
    this.input = this.inputContainer.createEl("textarea", {
      cls: "systemsculpt-input systemsculpt-chat-input",
      attr: {
        rows: "1",
        placeholder: "Type a message..."
      }
    });
    this.input.addEventListener("keydown", this.handleKeyDown.bind(this));
    this.input.addEventListener("input", this.adjustInputHeight.bind(this));
    this.input.addEventListener("paste", this.handlePaste.bind(this));
    this.recorderService.onToggle((isRecording) => {
      this.isRecording = isRecording;
      const micButton2 = this.buttonGrid.querySelector(".systemsculpt-mic-button");
      if (micButton2) {
        micButton2.classList.toggle("active", isRecording);
      }
    });
    this.updateGeneratingState = () => {
      this.input.disabled = this.isGenerating;
      sendButton.disabled = this.isGenerating;
      micButton.disabled = this.isGenerating;
      attachButton.disabled = this.isGenerating;
      settingsButton.disabled = this.isGenerating;
      webSearchButton.disabled = this.isGenerating;
      if (this.stopButton) {
        this.stopButton.style.display = this.isGenerating ? "flex" : "none";
        sendButton.style.display = this.isGenerating ? "none" : "flex";
      }
      this.input.placeholder = this.isGenerating ? "Waiting for response..." : "Type a message...";
      this.input.classList.toggle("disabled", this.isGenerating);
      sendButton.classList.toggle("disabled", this.isGenerating);
      micButton.classList.toggle("disabled", this.isGenerating);
      attachButton.classList.toggle("disabled", this.isGenerating);
      settingsButton.classList.toggle("disabled", this.isGenerating);
      webSearchButton.classList.toggle("disabled", this.isGenerating);
    };
  }
  handleStopGeneration() {
    if (this.abortController) {
      this.abortController.abort();
      this.abortController = null;
      this.isGenerating = false;
      this.updateGeneratingState();
    }
  }
  async handleSendMessage() {
    const currentModelId = this.getSelectedModelId();
    if (!currentModelId || currentModelId.trim() === "") {
      const result = await showPopup(this.app, "No model selected", {
        description: "Please select an AI model before sending a message.",
        primaryButton: "Select Model",
        secondaryButton: "Cancel"
      });
      if (result == null ? void 0 : result.confirmed) {
        const modal = new ModelSelectionModal(this.app, "", async (modelId) => {
          await this.chatView.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected. Please re-send your message.", "info");
        }, this.plugin);
        modal.open();
      }
      return;
    }
    if (this.plugin.settings.activeProvider.type === "native" && (!this.plugin.settings.licenseKey || !this.plugin.settings.licenseKey.trim())) {
      showPopup(this.app, "You don't have a license key. Please add a valid license key in settings to use SystemSculpt AI specific models.", {
        description: "License Key Required",
        primaryButton: "OK"
      });
      return;
    }
    const content = this.input.value.trim();
    if (!content || this.isGenerating)
      return;
    this.input.value = "";
    this.adjustInputHeight();
    try {
      const userMessageId = this.generateMessageId();
      const userMessage = {
        role: "user",
        content,
        message_id: userMessageId
      };
      const modelId = this.webSearchEnabled ? `${this.getSelectedModelId()}:online` : this.getSelectedModelId();
      await this.onMessageSubmit(userMessage);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      const { messageEl, contentEl } = this.createAssistantMessageContainer();
      messageEl.setAttribute("data-message-id", this.generateMessageId());
      messageEl.appendChild(contentEl);
      let fullResponse = "";
      let accumulatedReasoning = "";
      this.isGenerating = true;
      this.updateGeneratingState();
      const loadingEl = contentEl.createEl("span", {
        cls: "systemsculpt-loading",
        text: " \u25CF Thinking..."
      });
      this.chatContainer.appendChild(messageEl);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      this.abortController = new AbortController();
      const systemPrompt = this.getSystemPrompt();
      try {
        for await (const chunk of this.aiService.streamMessage({
          messages: this.getMessages(),
          model: modelId,
          contextFiles: this.getContextFiles(),
          systemPromptType: systemPrompt.type,
          systemPromptPath: systemPrompt.path,
          signal: this.abortController.signal
        })) {
          if (!fullResponse) {
            loadingEl.textContent = " \u25CF Generating...";
          }
          if (chunk.content) {
            fullResponse += chunk.content;
            await this.scheduleRender(fullResponse, contentEl);
            contentEl.appendChild(loadingEl);
          }
          if (chunk.reasoning) {
            accumulatedReasoning += chunk.reasoning;
            this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning);
          }
          this.scrollManager.updateContentHeight();
          this.scrollManager.scrollToBottom();
        }
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        if (accumulatedReasoning) {
          this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning, true);
        }
        const assistantMessage = {
          role: "assistant",
          content: fullResponse,
          message_id: messageEl.getAttribute("data-message-id") || this.generateMessageId()
        };
        await this.onAssistantResponse(assistantMessage);
        this.messageRenderer.addMessageButtonToolbar(messageEl, fullResponse, "assistant", assistantMessage.message_id);
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
        messageEl.addEventListener("delete", async (e) => {
          const { messageId } = e.detail;
          const messages = this.getMessages();
          const index = messages.findIndex((msg) => msg.message_id === messageId);
          if (index !== -1) {
            messageEl.remove();
            this.scrollManager.updateContentHeight();
          }
        });
      } catch (error) {
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        messageEl.remove();
        console.error("Chat message error:", {
          error,
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : void 0
        });
        this.onError(error);
      } finally {
        this.isGenerating = false;
        this.abortController = null;
        this.updateGeneratingState();
        this.focus();
      }
    } catch (error) {
      console.error("Outer message handling error:", {
        error,
        message: error instanceof Error ? error.message : String(error),
        stack: error instanceof Error ? error.stack : void 0
      });
      this.isGenerating = false;
      this.abortController = null;
      this.updateGeneratingState();
      this.focus();
      this.onError(error);
    }
  }
  handleMicClick() {
    if (this.isGenerating)
      return;
    this.toggleRecording();
  }
  async toggleRecording() {
    await this.recorderService.toggleRecording();
    this.input.focus();
  }
  async handlePaste(e) {
    var _a;
    const dt = e.clipboardData;
    if (!dt)
      return;
    const pastedText = (_a = dt.getData("text/plain")) != null ? _a : "";
    const allFiles = Array.from(dt.files);
    if (!allFiles.length && pastedText) {
      return;
    }
    e.preventDefault();
    if (!allFiles.length) {
      return;
    }
    for (const file of allFiles) {
      try {
        let extension = "bin";
        if (file.name && file.name.includes(".")) {
          const dotIdx = file.name.lastIndexOf(".");
          if (dotIdx >= 0) {
            extension = file.name.substring(dotIdx + 1).toLowerCase();
          }
        } else if (file.type) {
          const mimeParts = file.type.split("/");
          if (mimeParts.length === 2) {
            extension = mimeParts[1].toLowerCase().replace(/[^a-z0-9]/g, "");
          }
        }
        const now = new Date();
        const isoString = now.toISOString().replace(/[:.]/g, "-");
        const newFileName = `pasted-${isoString}.${extension}`;
        const arrayBuffer = await file.arrayBuffer();
        const attachmentsDir = this.plugin.settings.attachmentsDirectory || "Attachments";
        const finalPath = `${attachmentsDir}/${newFileName}`;
        await this.ensureDirectoryExists(attachmentsDir);
        await this.app.vault.createBinary(finalPath, arrayBuffer);
        const createdFile = this.app.vault.getAbstractFileByPath(finalPath);
        if (createdFile instanceof import_obsidian18.TFile) {
          await this.chatView.addFileToContext(createdFile);
          new import_obsidian18.Notice(`Pasted file saved & added to context: ${createdFile.name}`);
        } else {
          throw new Error("Failed to locate pasted file in vault.");
        }
      } catch (err) {
        console.error("Error handling pasted file:", err);
        new import_obsidian18.Notice(`Failed to handle pasted file: ${err}`);
      }
    }
    if (pastedText) {
      this.insertTextAtCursor(pastedText);
    }
  }
  async handleKeyDown(event) {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      await this.handleSendMessage();
    }
  }
  async handleImagePaste(clipboardData) {
    const file = clipboardData.files[0];
    if (!file || !file.type.startsWith("image/")) {
      throw new SystemSculptError("No image in clipboard", ERROR_CODES.NO_IMAGE, 400);
    }
    const base64 = await ImageProcessor.processClipboardImage(clipboardData);
    return base64;
  }
  adjustInputHeight() {
    if (!this.input)
      return;
    this.input.style.height = "auto";
    const newHeight = Math.min(Math.max(this.input.scrollHeight, 48), 200);
    this.input.style.height = newHeight + "px";
  }
  focus() {
    this.input.focus();
  }
  getValue() {
    return this.input.value;
  }
  setValue(value) {
    if (!this.input) {
      console.error("Input element not found in setValue");
      return;
    }
    try {
      this.input.value = value;
      const inputEvent = new Event("input", {
        bubbles: true,
        cancelable: true
      });
      this.input.dispatchEvent(inputEvent);
      this.adjustInputHeight();
      this.input.focus();
      this.input.setSelectionRange(value.length, value.length);
    } catch (error) {
      console.error("Error in setValue:", error);
      new import_obsidian18.Notice("\u274C Failed to set input value");
    }
  }
  unload() {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    this.recorderService.setVisualizerCanvas(null);
    if (this.recorderVisualizer) {
      this.recorderVisualizer.remove();
      this.recorderVisualizer = null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  createAssistantMessageContainer() {
    return {
      messageEl: createDiv({
        cls: "systemsculpt-message systemsculpt-assistant-message"
      }),
      contentEl: createDiv({ cls: "systemsculpt-message-content" })
    };
  }
  async scheduleRender(content, containerEl) {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    const currentHeight = containerEl.offsetHeight;
    const tempContainer = containerEl.querySelector(".temp-text") || containerEl.createEl("div", { cls: "temp-text" });
    tempContainer.style.visibility = "hidden";
    tempContainer.style.position = "absolute";
    tempContainer.style.width = containerEl.offsetWidth + "px";
    await this.messageRenderer.renderMarkdownContent(content, tempContainer);
    if (currentHeight !== tempContainer.offsetHeight) {
      await this.messageRenderer.renderMarkdownContent(content, containerEl);
    } else {
      const lastChild = containerEl.lastChild;
      if (lastChild && lastChild.nodeType === Node.TEXT_NODE) {
        lastChild.textContent = content;
      } else {
        containerEl.appendChild(document.createTextNode(content));
      }
    }
    tempContainer.remove();
    return Promise.resolve();
  }
  async handleDocumentUpload() {
    var _a;
    try {
      if (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !this.plugin.settings.licenseValid) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Support SystemSculpt's development and unlock document processing, analysis, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result2) => {
          if (result2 == null ? void 0 : result2.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true);
      if (!isValid) {
        this.plugin.settings.licenseValid = false;
        await this.plugin.saveSettings();
        await showPopup(this.app, "Your license appears to be invalid. Please check your license key in settings.", {
          title: "License Invalid",
          primaryButton: "OK"
        });
        return;
      }
      const files = this.app.vault.getFiles();
      if (!files.length) {
        new import_obsidian18.Notice("No files found to upload.");
        return;
      }
      const firstFile = files[0];
      const result = await this.aiService.uploadDocument(firstFile);
      new import_obsidian18.Notice(`Uploaded doc. ID: ${result.documentId}, status: ${result.status}`);
    } catch (error) {
      if ((error == null ? void 0 : error.statusCode) === 401 || (error == null ? void 0 : error.statusCode) === 403) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Document processing requires an active Pro subscription. Support SystemSculpt's development by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result) => {
          if (result == null ? void 0 : result.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      new import_obsidian18.Notice(`Error uploading doc: ${error}`);
    }
  }
  insertTextAtCursor(text) {
    const cursorPos = this.input.selectionStart;
    const currentValue = this.input.value;
    if (cursorPos !== null) {
      const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
      this.input.value = newValue;
      this.input.selectionStart = this.input.selectionEnd = cursorPos + text.length;
    } else {
      this.input.value = currentValue + text;
      this.input.selectionStart = this.input.selectionEnd = this.input.value.length;
    }
    this.input.dispatchEvent(new Event("input"));
    this.input.focus();
  }
  updateWebSearchButtonState() {
    if (!this.webSearchButton)
      return;
    const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
    const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
    const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
    const webSearchAllowed = isNativeProvider || isOpenRouter;
    if (!webSearchAllowed && this.webSearchEnabled) {
      this.webSearchEnabled = false;
      this.webSearchButton.classList.remove("is-enabled");
    }
    this.webSearchButton.classList.toggle("disabled", !webSearchAllowed);
    this.webSearchButton.setAttribute("aria-disabled", (!webSearchAllowed).toString());
  }
  onModelChange() {
    this.updateWebSearchButtonState();
  }
  async ensureDirectoryExists(dirPath) {
    try {
      await this.app.vault.adapter.mkdir(dirPath);
    } catch (err) {
      if (!err.message.includes("already exists"))
        throw err;
    }
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian22 = __toModule(require("obsidian"));

// src/modals/ContextSelectionModal.ts
var import_obsidian20 = __toModule(require("obsidian"));
var import_obsidian21 = __toModule(require("obsidian"));

// src/services/TokenCounterService.ts
var import_obsidian19 = __toModule(require("obsidian"));
var TokenCounterService = class {
  constructor() {
    this.cache = new Map();
    this.fileCache = new Map();
    this.cacheSize = 1e3;
    this.handleFileModify = this.handleFileModify.bind(this);
    this.handleFileDelete = this.handleFileDelete.bind(this);
    this.handleFileRename = this.handleFileRename.bind(this);
  }
  handleFileModify(file) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileDelete(file) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileRename(file, oldPath) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(oldPath);
    }
  }
  static getInstance() {
    if (!TokenCounterService.instance) {
      TokenCounterService.instance = new TokenCounterService();
    }
    return TokenCounterService.instance;
  }
  setApp(app) {
    this.app = app;
    this.app.vault.on("modify", this.handleFileModify);
    this.app.vault.on("delete", this.handleFileDelete);
    this.app.vault.on("rename", this.handleFileRename);
  }
  async getFileTokenCount(file) {
    const cached = this.fileCache.get(file.path);
    if (cached && cached.mtime === file.stat.mtime) {
      return cached.tokens;
    }
    const content = await this.app.vault.read(file);
    const tokens = this.approximateTokenCount(content);
    this.fileCache.set(file.path, {
      tokens,
      mtime: file.stat.mtime
    });
    return tokens;
  }
  approximateTokenCount(text) {
    if (!text)
      return 0;
    const cacheKey = `${text.slice(0, 100)}_${text.length}`;
    const cached = this.cache.get(cacheKey);
    if (cached !== void 0)
      return cached;
    text = text.replace(/\s+/g, " ").trim();
    let tokenCount = 0;
    const commonPatterns = [
      /^https?:\/\/\S+/gm,
      /[@#]\w+/g,
      /:[a-z_]+:/g,
      /[A-Z]{2,}/g,
      /\d{1,16}/g,
      /[.,!?;:(){}\[\]"']/g
    ];
    for (const pattern of commonPatterns) {
      const matches = text.match(pattern);
      if (matches) {
        tokenCount += matches.reduce((sum, match) => {
          if (match.startsWith("http")) {
            return sum + Math.ceil(match.length / 4);
          } else if (match.length <= 4) {
            return sum + 1;
          } else {
            return sum + Math.ceil(match.length / 3);
          }
        }, 0);
        text = text.replace(pattern, " ");
      }
    }
    const words = text.split(/\s+/).filter((w) => w.length > 0);
    for (const word of words) {
      let wordTokens = 1;
      if (word.length > 4) {
        wordTokens += Math.floor((word.length - 4) / 3);
      }
      if (/[a-z][A-Z]/.test(word)) {
        wordTokens += (word.match(/[A-Z]/g) || []).length;
      }
      const nonAscii = (word.match(/[^\x00-\x7F]/g) || []).length;
      if (nonAscii > 0) {
        wordTokens += Math.ceil(nonAscii * 1.5);
      }
      tokenCount += wordTokens;
    }
    tokenCount = Math.ceil(tokenCount * 1.1);
    this.cacheResult(cacheKey, tokenCount);
    return tokenCount;
  }
  cacheResult(key, value) {
    if (this.cache.size >= this.cacheSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
  clearCache() {
    this.cache.clear();
    this.fileCache.clear();
  }
  unload() {
    if (this.app) {
      this.app.vault.off("modify", this.handleFileModify);
      this.app.vault.off("delete", this.handleFileDelete);
      this.app.vault.off("rename", this.handleFileRename);
    }
  }
  formatTokenCount(count) {
    if (count === 0)
      return "";
    if (count < 100)
      return "< 100 tokens";
    if (count >= 1e3) {
      const inK = Math.ceil(count / 1e3);
      return `~${inK}K tokens`;
    } else {
      const inHundreds = Math.ceil(count / 100) * 100;
      return `~${inHundreds} tokens`;
    }
  }
};

// src/core/license/LicenseChecker.ts
init_ui();
var LicenseChecker = class {
  static requiresProLicense(extension) {
    return this.PRO_EXTENSIONS.includes(extension.toLowerCase());
  }
  static hasValidLicense(plugin) {
    var _a;
    return ((_a = plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && plugin.settings.licenseValid;
  }
  static async showProFeaturePopup(app) {
    const result = await showPopup(app, "Support SystemSculpt's development and unlock powerful document processing features. Upgrade to Pro to process PDFs, Word documents, and audio files.", {
      title: "Pro Feature Required",
      primaryButton: "Become a Patron",
      secondaryButton: "Maybe Later",
      icon: "sparkles"
    });
    if (result == null ? void 0 : result.confirmed) {
      window.open(PATREON_URL, "_blank");
    }
    return (result == null ? void 0 : result.confirmed) || false;
  }
  static async checkLicenseForFile(file, app, plugin) {
    if (this.requiresProLicense(file.extension.toLowerCase())) {
      if (!this.hasValidLicense(plugin)) {
        await this.showProFeaturePopup(app);
        return false;
      }
    }
    return true;
  }
};
LicenseChecker.PRO_EXTENSIONS = [
  "pdf",
  "doc",
  "docx",
  "ppt",
  "pptx",
  "xls",
  "xlsx",
  "mp3",
  "wav",
  "m4a",
  "ogg",
  "webm"
];

// src/modals/ContextSelectionModal.ts
var SUPPORTED_EXTENSIONS = {
  documents: ["md", "txt"],
  proDocuments: ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"],
  images: ["png", "jpg", "jpeg", "gif", "svg", "webp"],
  audio: ["mp3", "wav", "m4a", "ogg", "webm"]
};
var ALL_SUPPORTED_EXTENSIONS = Object.values(SUPPORTED_EXTENSIONS).flat();
var ContextSelectionModal = class extends import_obsidian20.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.tokenCounts = new Map();
    this.currentSearchResults = [];
    this.searchTimeout = null;
    this.selectedExtensions = new Set();
    this.extensionButtons = new Map();
    this.selectedFiles = new Set();
    this.selectedIndex = 0;
    this.resultElements = [];
    this.onSelect = onSelect;
    this.searchService = new SearchService();
    this.tokenCounter = TokenCounterService.getInstance();
    this.plugin = plugin;
    this.files = this.getAvailableFiles();
    this.selectedExtensions.add("md");
  }
  getAvailableFiles() {
    return this.app.vault.getFiles().filter((file) => ALL_SUPPORTED_EXTENSIONS.includes(file.extension.toLowerCase()));
  }
  getSearchFields(file) {
    return [
      { field: "title", text: file.basename, weight: 100 },
      { field: "path", text: file.path, weight: 75 },
      { field: "extension", text: file.extension, weight: 50 }
    ];
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
  highlightText(text, matches = []) {
    var _a;
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendText(text.slice(lastIndex, match.index));
      }
      const span = fragment.createSpan({
        cls: "systemsculpt-highlight",
        text: match[0]
      });
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  createLoadingIndicator() {
    const container = createDiv({ cls: "systemsculpt-context-loading" });
    (0, import_obsidian21.setIcon)(container, "loader-2");
    container.appendChild(createSpan({ text: "Loading..." }));
    return container;
  }
  createEmptyState() {
    const container = createDiv({ cls: "systemsculpt-context-empty" });
    (0, import_obsidian21.setIcon)(container, "search");
    container.appendChild(createSpan({ text: "No matching files found" }));
    return container;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  createCard(file, result) {
    var _a;
    const card = createDiv({ cls: "systemsculpt-context-card" });
    card.setAttribute("tabindex", "0");
    const cardContent = card.createDiv({ cls: "systemsculpt-card-content" });
    if (file.extension.match(/png|jpe?g|gif|svg|webp/i)) {
      const thumbContainer = cardContent.createDiv({
        cls: "systemsculpt-context-thumbnail"
      });
      (async () => {
        try {
          const arrayBuffer = await this.app.vault.readBinary(file);
          const blob = new Blob([arrayBuffer]);
          const objectUrl = URL.createObjectURL(blob);
          const img = thumbContainer.createEl("img", {
            cls: "systemsculpt-context-thumb-img",
            attr: { src: objectUrl }
          });
        } catch (err) {
          console.error("Error loading thumbnail:", err);
        }
      })();
    }
    if (this.selectedFiles.has(file)) {
      card.addClass("is-added");
      const checkIcon = card.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    const textContainer = cardContent.createDiv({
      cls: "systemsculpt-card-text"
    });
    const title = textContainer.createDiv({
      cls: "systemsculpt-context-title"
    });
    title.appendChild(this.highlightText(file.basename, result.matches.filter((m) => m.field === "title")));
    const path = textContainer.createDiv({ cls: "systemsculpt-context-path" });
    path.appendChild(this.highlightText(file.path, result.matches.filter((m) => m.field === "path")));
    const meta = textContainer.createDiv({ cls: "systemsculpt-context-meta" });
    const typeGroup = meta.createDiv({
      cls: "systemsculpt-context-type-group"
    });
    const type = typeGroup.createDiv({ cls: "systemsculpt-context-type" });
    type.setText(file.extension.toUpperCase());
    if (LicenseChecker.requiresProLicense(file.extension)) {
      const proBadge = typeGroup.createDiv({
        cls: "systemsculpt-context-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge.createSpan(), "sparkles");
      proBadge.createSpan({ text: "Pro" });
    }
    const metaGroup = meta.createDiv({
      cls: "systemsculpt-context-meta-group"
    });
    const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
    size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
    if (file.extension === "md" || file.extension === "txt") {
      const tokenCount = metaGroup.createDiv({
        cls: "systemsculpt-context-token-count"
      });
      const count = this.tokenCounts.get(file.path) || 0;
      tokenCount.setText(this.tokenCounter.formatTokenCount(count));
      if (!this.tokenCounts.has(file.path)) {
        this.updateTokenCount(file).then(() => {
          tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
        });
      }
    }
    card.addEventListener("click", () => {
      this.toggleFileSelection(file, card);
    });
    card.addEventListener("mouseenter", () => {
      const index = this.resultElements.indexOf(card);
      if (index >= 0) {
        this.selectedIndex = index;
        this.updateSelectedResult();
      }
    });
    return card;
  }
  updateSelectedResult() {
    this.resultElements.forEach((el, index) => {
      el.toggleClass("is-selected", index === this.selectedIndex && this.selectedIndex >= 0);
    });
    if (this.selectedIndex >= 0 && this.selectedIndex < this.resultElements.length) {
      this.resultElements[this.selectedIndex].scrollIntoView({
        behavior: "smooth",
        block: "nearest"
      });
    }
  }
  async toggleFileSelection(file, cardEl) {
    var _a;
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (this.selectedFiles.has(file)) {
      this.selectedFiles.delete(file);
      cardEl.removeClass("is-added");
      (_a = cardEl.querySelector(".systemsculpt-context-check")) == null ? void 0 : _a.remove();
    } else {
      this.selectedFiles.add(file);
      cardEl.addClass("is-added");
      const checkIcon = cardEl.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    this.updateActionButton();
  }
  updateActionButton() {
    const actionButton = this.containerEl.querySelector(".systemsculpt-context-action-button");
    if (actionButton) {
      const count = this.selectedFiles.size;
      actionButton.setText(count > 0 ? `Add ${count} selected file${count === 1 ? "" : "s"}` : "Select files to add as context");
      actionButton.toggleClass("is-active", count > 0);
    }
  }
  renderResults(searchResults) {
    this.resultsContainer.empty();
    this.resultElements = [];
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      this.emptyState.style.display = "flex";
      return;
    }
    this.emptyState.style.display = "none";
    const grid = this.resultsContainer.createDiv({
      cls: "systemsculpt-context-grid"
    });
    searchResults.forEach((result, index) => {
      const card = this.createCard(result.item, result);
      grid.appendChild(card);
      this.resultElements.push(card);
    });
  }
  getUniqueExtensions() {
    const extensions = new Set();
    this.files.forEach((file) => {
      if (file.extension) {
        extensions.add(file.extension.toLowerCase());
      }
    });
    return Array.from(extensions).sort((a, b) => {
      if (a === "md")
        return -1;
      if (b === "md")
        return 1;
      const aIsPro = LicenseChecker.requiresProLicense(a);
      const bIsPro = LicenseChecker.requiresProLicense(b);
      if (aIsPro && !bIsPro)
        return 1;
      if (!aIsPro && bIsPro)
        return -1;
      return a.localeCompare(b);
    });
  }
  createExtensionButton(extension) {
    const button = createDiv({
      cls: "systemsculpt-extension-button"
    });
    const iconContainer = button.createSpan({
      cls: "systemsculpt-extension-icon"
    });
    if (SUPPORTED_EXTENSIONS.documents.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "file-text");
    } else if (SUPPORTED_EXTENSIONS.images.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "image");
    } else if (SUPPORTED_EXTENSIONS.audio.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "headphones");
    }
    button.createSpan({
      text: extension.toUpperCase(),
      cls: "systemsculpt-extension-text"
    });
    if (LicenseChecker.requiresProLicense(extension)) {
      const proBadge = button.createSpan({
        cls: "systemsculpt-extension-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge, "sparkles");
    }
    button.addEventListener("click", () => {
      if (this.selectedExtensions.has(extension)) {
        this.selectedExtensions.delete(extension);
        button.removeClass("is-selected");
      } else {
        this.selectedExtensions.add(extension);
        button.addClass("is-selected");
      }
      this.performSearch(this.searchInput.value);
    });
    return button;
  }
  performSearch(query) {
    let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
    results.sort((a, b) => {
      if (b.score !== a.score)
        return b.score - a.score;
      return a.item.basename.localeCompare(b.item.basename);
    });
    this.renderResults(results);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-context-modal");
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-context-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search files to add as context..."
    });
    const extensionContainer = contentEl.createDiv({
      cls: "systemsculpt-extension-container"
    });
    const extensions = this.getUniqueExtensions();
    extensions.forEach((ext) => {
      const button = this.createExtensionButton(ext);
      this.extensionButtons.set(ext, button);
      extensionContainer.appendChild(button);
    });
    const mdBtn = this.extensionButtons.get("md");
    if (mdBtn)
      mdBtn.addClass("is-selected");
    this.loadingIndicator = this.createLoadingIndicator();
    contentEl.appendChild(this.loadingIndicator);
    this.emptyState = this.createEmptyState();
    this.emptyState.style.display = "none";
    contentEl.appendChild(this.emptyState);
    const scrollContainer = contentEl.createDiv({
      cls: "systemsculpt-scroll-container"
    });
    this.resultsContainer = scrollContainer.createDiv();
    const actionContainer = contentEl.createDiv({
      cls: "systemsculpt-action-container"
    });
    const actionButton = actionContainer.createEl("button", {
      cls: "systemsculpt-context-action-button",
      text: "Select files to add as context"
    });
    actionButton.addEventListener("click", () => {
      if (this.selectedFiles.size > 0) {
        this.onSelect(Array.from(this.selectedFiles));
        this.close();
      }
    });
    this.updateActionButton();
    this.loadingIndicator.style.display = "flex";
    this.resultsContainer.empty();
    this.setupEventListeners();
    this.containerEl.addEventListener("keydown", (e) => {
      if (document.activeElement === this.searchInput)
        return;
      if (this.currentSearchResults.length === 0)
        return;
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey && this.selectedIndex === 0) {
          this.searchInput.focus();
          return;
        }
        if (e.shiftKey) {
          this.selectedIndex = (this.selectedIndex - 1 + this.resultElements.length) % this.resultElements.length;
        } else {
          this.selectedIndex = (this.selectedIndex + 1) % this.resultElements.length;
        }
        this.updateSelectedResult();
        return;
      }
      if (e.code === "Space") {
        e.preventDefault();
        const file = this.currentSearchResults[this.selectedIndex].item;
        const cardEl = this.resultElements[this.selectedIndex];
        this.toggleFileSelection(file, cardEl);
        return;
      }
      if (e.key === "Enter") {
        e.preventDefault();
        if (this.selectedFiles.size > 0) {
          this.onSelect(Array.from(this.selectedFiles));
          this.close();
        }
        return;
      }
    });
    this.searchInput.focus();
    this.performSearch("");
    this.loadingIndicator.style.display = "none";
  }
  setupEventListeners() {
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        e.stopPropagation();
        if (this.resultElements.length > 0) {
          if (e.shiftKey) {
            this.selectedIndex = this.resultElements.length - 1;
          } else {
            this.selectedIndex = 0;
          }
          this.updateSelectedResult();
          this.resultElements[this.selectedIndex].focus();
        }
      }
    });
    this.searchInput.addEventListener("focus", () => {
      this.selectedIndex = -1;
      this.updateSelectedResult();
    });
    this.searchInput.addEventListener("input", () => {
      if (this.searchTimeout) {
        window.clearTimeout(this.searchTimeout);
      }
      this.searchTimeout = window.setTimeout(() => {
        const query = this.searchInput.value;
        let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
        results.sort((a, b) => {
          if (b.score !== a.score)
            return b.score - a.score;
          return a.item.basename.localeCompare(b.item.basename);
        });
        this.renderResults(results);
      }, 150);
    });
  }
  onClose() {
    if (this.searchTimeout) {
      window.clearTimeout(this.searchTimeout);
    }
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian23 = __toModule(require("obsidian"));
var FileContextManager = class extends import_obsidian22.Component {
  constructor(options) {
    super();
    this.contextFiles = new Set();
    this.processingStatus = null;
    this.processingFiles = new Map();
    this.processingTimeouts = new Map();
    this.syncStatusEl = null;
    this.isSyncing = false;
    this.tokenCounts = new Map();
    this.app = options.app;
    this.onContextChange = options.onContextChange;
    this.sculptService = options.sculptService;
    this.plugin = options.plugin;
    this.tokenCounter = TokenCounterService.getInstance();
    this.drawer = new DrawerComponent({
      container: options.container,
      title: options.title || "Files"
    });
    this.contextPanel = this.drawer.getDrawer();
    this.setupContextPanel();
    this.initializeProcessingStatus();
  }
  initializeProcessingStatus() {
    this.processingStatus = this.contextPanel.createEl("div", {
      cls: "systemsculpt-processing-status"
    });
    this.processingStatus.style.display = "none";
  }
  updateProcessingStatus(file, status, icon, remove = false) {
    const fileId = file.path;
    let statusEl = this.processingFiles.get(fileId);
    const existingTimeout = this.processingTimeouts.get(fileId);
    if (existingTimeout) {
      clearTimeout(existingTimeout);
      this.processingTimeouts.delete(fileId);
    }
    if (!statusEl && !remove && this.processingStatus) {
      statusEl = this.processingStatus.createEl("div", {
        cls: "systemsculpt-file-status"
      });
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
      this.processingFiles.set(fileId, statusEl);
    } else if (statusEl && !remove) {
      statusEl.empty();
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
    } else if (statusEl && remove) {
      statusEl.remove();
      this.processingFiles.delete(fileId);
    }
    if (this.processingStatus) {
      this.processingStatus.style.display = this.processingFiles.size > 0 ? "block" : "none";
    }
    if (remove || status.includes("successfully") || status.includes("completed") || status.includes("Error:")) {
      const timeout = setTimeout(() => {
        this.updateProcessingStatus(file, "", "", true);
        this.processingTimeouts.delete(fileId);
      }, 3e3);
      this.processingTimeouts.set(fileId, timeout);
    }
  }
  setupContextPanel() {
    const titleEl = this.contextPanel.querySelector(".systemsculpt-drawer-title");
    if (!titleEl)
      return;
    const contextCount = titleEl.createSpan({
      cls: "systemsculpt-drawer-count",
      text: "0"
    });
    this.syncStatusEl = titleEl.createSpan({
      cls: "systemsculpt-sync-status synced"
    });
    (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    const contextButton = titleEl.createEl("button", {
      cls: "systemsculpt-context-add-button"
    });
    (0, import_obsidian22.setIcon)(contextButton, "plus");
    contextButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.addContextFile();
    });
    this.updateContextPanel();
  }
  updateSyncStatus(syncing = false) {
    if (!this.syncStatusEl)
      return;
    this.isSyncing = syncing;
    this.syncStatusEl.empty();
    if (syncing) {
      this.syncStatusEl.removeClass("synced");
      this.syncStatusEl.addClass("syncing");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "loader-2");
    } else {
      this.syncStatusEl.removeClass("syncing");
      this.syncStatusEl.addClass("synced");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    }
  }
  async checkSyncStatus() {
    if (this.contextFiles.size === 0) {
      this.updateSyncStatus(false);
      return;
    }
    this.updateSyncStatus(true);
    this.updateSyncStatus(false);
  }
  updateContextPanel() {
    var _a;
    if (!this.contextPanel)
      return;
    const header = this.contextPanel.querySelector(".systemsculpt-drawer-header");
    const content = this.contextPanel.querySelector(".systemsculpt-drawer-content");
    const count = this.contextPanel.querySelector(".systemsculpt-drawer-count");
    if (!header || !content || !count)
      return;
    count.textContent = this.contextFiles.size.toString();
    content.empty();
    if (this.contextFiles.size === 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-empty",
        text: "No context files added yet. Click the plus button to add files in your chat."
      });
      return;
    }
    const categories = {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
    const documentGroups = new Map();
    const nonExtractedFiles = new Set();
    for (const filePath of this.contextFiles) {
      const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      if (cleanPath.includes("/Extractions/")) {
        const parts = cleanPath.split("/");
        const extractionDirIndex = parts.indexOf("Extractions");
        if (extractionDirIndex >= 0 && extractionDirIndex + 1 < parts.length) {
          const sourceDoc = parts[extractionDirIndex + 1];
          if (!documentGroups.has(sourceDoc)) {
            documentGroups.set(sourceDoc, new Set());
          }
          (_a = documentGroups.get(sourceDoc)) == null ? void 0 : _a.add(filePath);
        } else {
          nonExtractedFiles.add(filePath);
        }
      } else {
        nonExtractedFiles.add(filePath);
      }
    }
    this.categorizeFiles(Array.from(nonExtractedFiles), categories);
    for (const categoryKey of ["text", "images", "audio"]) {
      const category = categories[categoryKey];
      if (category.files.length > 0) {
        this.renderCategory(content, category);
      }
    }
    if (categories.documents.files.length > 0 || documentGroups.size > 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-category",
        text: "Documents"
      });
      this.renderFiles(content, categories.documents.files);
      for (const [sourceDoc, extractedFiles] of documentGroups) {
        content.createEl("div", {
          cls: "systemsculpt-drawer-category",
          text: `\u{1F4C4} ${sourceDoc} Extractions`
        });
        const extractedCategories = this.createCategories();
        this.categorizeFiles(Array.from(extractedFiles), extractedCategories);
        const textFiles = extractedCategories.text.files;
        if (textFiles.length > 0) {
          this.renderFiles(content, textFiles);
        }
        const imageFiles = extractedCategories.images.files;
        if (imageFiles.length > 0) {
          this.renderFiles(content, imageFiles);
        }
        const otherFiles = [
          ...extractedCategories.audio.files,
          ...extractedCategories.documents.files
        ];
        if (otherFiles.length > 0) {
          this.renderFiles(content, otherFiles);
        }
      }
    }
  }
  createCategories() {
    return {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
  }
  categorizeFiles(files, categories) {
    for (const filePath of files) {
      const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
      if (resolvedFile instanceof import_obsidian22.TFile) {
        const extension = resolvedFile.extension.toLowerCase();
        let categoryFound = false;
        for (const [category, info] of Object.entries(categories)) {
          if (info.extensions.includes(extension)) {
            info.files.push({ file: resolvedFile, path: filePath, linkText });
            categoryFound = true;
            break;
          }
        }
        if (!categoryFound) {
          categories.documents.files.push({
            file: resolvedFile,
            path: filePath,
            linkText
          });
        }
      }
    }
  }
  renderCategory(container, category) {
    if (category.files.length === 0)
      return;
    container.createEl("div", {
      cls: "systemsculpt-drawer-category",
      text: category.label
    });
    this.renderFiles(container, category.files);
  }
  renderFiles(container, files) {
    files.sort((a, b) => a.file.basename.localeCompare(b.file.basename));
    const imagePreview = document.body.createEl("img", {
      cls: "systemsculpt-preview systemsculpt-image-preview"
    });
    const markdownPreview = document.body.createDiv({
      cls: "systemsculpt-preview systemsculpt-markdown-preview"
    });
    let isMarkdownPreviewVisible = false;
    const handleWheel = (e) => {
      if (!isMarkdownPreviewVisible)
        return;
      e.preventDefault();
      const scrollAmount = e.deltaY;
      markdownPreview.scrollTop += scrollAmount;
    };
    document.addEventListener("wheel", handleWheel, { passive: false });
    this.register(() => {
      document.removeEventListener("wheel", handleWheel);
    });
    const calculatePreviewDimensions = (naturalWidth, naturalHeight, viewportWidth, viewportHeight) => {
      const maxWidth = Math.min(viewportWidth * 0.4, naturalWidth);
      const maxHeight = Math.min(viewportHeight * 0.6, naturalHeight);
      let width = naturalWidth;
      let height = naturalHeight;
      if (width > maxWidth) {
        width = maxWidth;
        height = naturalHeight * maxWidth / naturalWidth;
      }
      if (height > maxHeight) {
        height = maxHeight;
        width = naturalWidth * maxHeight / naturalHeight;
      }
      return { width, height };
    };
    const updatePreviewPosition = (e, previewEl) => {
      if (!previewEl)
        return;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const rect = previewEl.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      let x = e.clientX + 16;
      let y = e.clientY + 16;
      if (x + width > viewportWidth) {
        x = e.clientX - width - 16;
      }
      if (y + height > viewportHeight) {
        y = e.clientY - height - 16;
      }
      previewEl.style.left = `${x}px`;
      previewEl.style.top = `${y}px`;
    };
    this.register(() => {
      imagePreview.remove();
      markdownPreview.remove();
    });
    for (const { file, path, linkText } of files) {
      const item = container.createEl("div", {
        cls: "systemsculpt-drawer-item"
      });
      const pathEl = item.createEl("div", {
        cls: "systemsculpt-drawer-item-path"
      });
      const iconContainer = pathEl.createSpan({
        cls: "systemsculpt-file-icon"
      });
      const extension = file.extension.toLowerCase();
      let iconName = "file";
      const link = pathEl.createEl("a", {
        cls: "internal-link",
        text: file.basename,
        attr: {
          href: path,
          "data-href": path
        }
      });
      if (["md", "txt", "markdown"].includes(extension)) {
        iconName = "file-text";
        const showMarkdownPreview = async (e) => {
          try {
            const mdFile = this.app.vault.getAbstractFileByPath(file.path);
            if (mdFile instanceof import_obsidian22.TFile) {
              const content = await this.app.vault.read(mdFile);
              markdownPreview.empty();
              markdownPreview.createDiv({
                cls: "systemsculpt-preview-header",
                text: file.basename
              });
              const contentEl = markdownPreview.createDiv();
              await import_obsidian23.MarkdownRenderer.renderMarkdown(content.length > 4e3 ? content.slice(0, 4e3) + "\n\n---\n\n**Click to view full document** (showing first 4000 of " + content.length + " characters)" : content, contentEl, file.path, this);
              markdownPreview.classList.add("visible");
              isMarkdownPreviewVisible = true;
              updatePreviewPosition(e, markdownPreview);
            }
          } catch (error) {
            console.error("Failed to load markdown preview:", error);
          }
        };
        const hideMarkdownPreview = () => {
          markdownPreview.classList.remove("visible");
          markdownPreview.empty();
          isMarkdownPreviewVisible = false;
          markdownPreview.scrollTop = 0;
        };
        item.addEventListener("mouseenter", showMarkdownPreview);
        item.addEventListener("mouseleave", hideMarkdownPreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, markdownPreview));
        markdownPreview.addEventListener("mouseleave", hideMarkdownPreview);
        this.register(() => {
          markdownPreview.removeEventListener("mouseleave", hideMarkdownPreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideMarkdownPreview);
      } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        iconName = "image";
        const showImagePreview = async (e) => {
          try {
            const imageFile = this.app.vault.getAbstractFileByPath(file.path);
            if (imageFile instanceof import_obsidian22.TFile) {
              const arrayBuffer = await this.app.vault.readBinary(imageFile);
              const blob = new Blob([arrayBuffer]);
              const url = URL.createObjectURL(blob);
              imagePreview.src = url;
              imagePreview.onload = () => {
                URL.revokeObjectURL(url);
                imagePreview.classList.add("visible");
                const { width, height } = calculatePreviewDimensions(imagePreview.naturalWidth, imagePreview.naturalHeight, window.innerWidth, window.innerHeight);
                imagePreview.style.width = `${width}px`;
                imagePreview.style.height = `${height}px`;
                updatePreviewPosition(e, imagePreview);
              };
            }
          } catch (error) {
            console.error("Failed to load image preview:", error);
          }
        };
        const hideImagePreview = () => {
          imagePreview.classList.remove("visible");
          imagePreview.src = "";
          imagePreview.style.width = "";
          imagePreview.style.height = "";
        };
        item.addEventListener("mouseenter", showImagePreview);
        item.addEventListener("mouseleave", hideImagePreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, imagePreview));
        imagePreview.addEventListener("mouseleave", hideImagePreview);
        this.register(() => {
          imagePreview.removeEventListener("mouseleave", hideImagePreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideImagePreview);
      } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
        iconName = "audio-lines";
      } else if (["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"].includes(extension)) {
        iconName = "file";
      }
      (0, import_obsidian22.setIcon)(iconContainer, iconName);
      link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        this.app.workspace.openLinkText(linkText, "", true);
      });
      const meta = item.createDiv({ cls: "systemsculpt-context-meta" });
      const removeBtn = meta.createEl("button", {
        cls: "systemsculpt-drawer-item-remove",
        text: "\xD7"
      });
      removeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        this.removeContextFile(path);
      });
      const updateMetaInfo = () => {
        var _a;
        const availableWidth = container.offsetWidth - 40;
        const fileNameWidth = link.offsetWidth;
        const removeBtnWidth = 24;
        const remainingWidth = availableWidth - fileNameWidth - removeBtnWidth;
        const existingMeta = meta.querySelectorAll(".systemsculpt-context-type, .systemsculpt-context-size, .systemsculpt-context-token-count");
        existingMeta.forEach((el) => el.remove());
        if (remainingWidth > 150) {
          if (remainingWidth > 200) {
            const type = meta.createDiv({ cls: "systemsculpt-context-type" });
            type.setText(file.extension.toUpperCase());
          }
          if (remainingWidth > 100) {
            const size = meta.createDiv({ cls: "systemsculpt-context-size" });
            size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
          }
          if (remainingWidth > 250 && (file.extension === "md" || file.extension === "txt")) {
            const tokenCount = meta.createDiv({
              cls: "systemsculpt-context-token-count"
            });
            const count = this.tokenCounts.get(file.path) || 0;
            tokenCount.setText(this.tokenCounter.formatTokenCount(count));
            if (!this.tokenCounts.has(file.path)) {
              this.updateTokenCount(file).then(() => {
                tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
              });
            }
          }
        }
      };
      updateMetaInfo();
      const resizeObserver = new ResizeObserver(() => {
        updateMetaInfo();
      });
      resizeObserver.observe(container);
      this.register(() => {
        resizeObserver.disconnect();
      });
    }
  }
  async addContextFile() {
    const modal = new ContextSelectionModal(this.app, async (files) => {
      for (const file of files) {
        try {
          await this.addFileToContext(file);
        } catch (error) {
          this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
          setTimeout(() => {
            this.updateProcessingStatus(file, "", "", true);
          }, 3e3);
        }
      }
    }, this.plugin);
    modal.open();
  }
  async removeContextFile(filePath) {
    const normalizedPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    this.contextFiles.delete(filePath);
    this.contextFiles.delete(`[[${normalizedPath}]]`);
    this.updateContextPanel();
    await this.onContextChange();
  }
  async addFileToContext(file) {
    const extension = file.extension.toLowerCase();
    const datalabDocExtensions = [
      "pdf",
      "doc",
      "docx",
      "xls",
      "xlsx",
      "ppt",
      "pptx"
    ];
    const audioExtensions = ["wav", "m4a", "webm", "ogg", "mp3"];
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (datalabDocExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processDocumentFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else if (audioExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processAudioFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else {
      const wikiLink = `[[${file.path}]]`;
      this.contextFiles.add(wikiLink);
    }
    this.updateContextPanel();
    await this.onContextChange();
  }
  async processDocumentFile(file) {
    var _a, _b;
    this.updateProcessingStatus(file, "Uploading...", "upload");
    const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
    if (!cached) {
      this.updateProcessingStatus(file, "Processing...", "loader-2");
      const success = await this.pollUntilComplete(documentId);
      if (!success) {
        throw new Error("Document processing not completed in time.");
      }
    }
    this.updateProcessingStatus(file, "Downloading results...", "download");
    const extractionData = await this.downloadExtraction(documentId);
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
    await this.app.vault.createFolder(parentPath).catch(() => {
    });
    const extractedText = this.getExtractionMarkdown(extractionData);
    const newMdPath = `${parentPath}/${baseName}.md`;
    try {
      await this.app.vault.create(newMdPath, extractedText);
    } catch (error) {
      if (!(error instanceof Error) || !error.message.includes("already exists")) {
        throw error;
      }
    }
    const mdWikiLink = `[[${newMdPath}]]`;
    this.contextFiles.add(mdWikiLink);
    if (extractionData.images && typeof extractionData.images === "object") {
      for (const [filename, base64Data] of Object.entries(extractionData.images)) {
        const imagePath = `${parentPath}/${filename.replace(/[\\/:*?"<>|]/g, "-").trim()}`;
        try {
          await this.app.vault.createBinary(imagePath, this.decodeBase64(base64Data));
        } catch (error) {
          if (!(error instanceof Error) || !error.message.includes("already exists")) {
            throw error;
          }
        }
        const imageWikiLink = `[[${imagePath}]]`;
        this.contextFiles.add(imageWikiLink);
      }
    }
    return newMdPath;
  }
  getExtractionMarkdown(extractionData) {
    var _a, _b, _c;
    const text = (_a = extractionData == null ? void 0 : extractionData.text) != null ? _a : "";
    const metadata = (_b = extractionData == null ? void 0 : extractionData.metadata) != null ? _b : {};
    const pageCount = (_c = extractionData == null ? void 0 : extractionData.pageCount) != null ? _c : 0;
    return `# Document Extraction
Page Count: ${pageCount}

${text}

${metadata ? `
# Metadata
${JSON.stringify(metadata, null, 2)}` : ""}
`;
  }
  decodeBase64(base64String) {
    const binaryStr = window.atob(base64String);
    const len = binaryStr.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryStr.charCodeAt(i);
    }
    return bytes.buffer;
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  getContextFiles() {
    return this.contextFiles;
  }
  async setContextFiles(files) {
    this.contextFiles = new Set(files);
    this.updateContextPanel();
    await this.checkSyncStatus();
  }
  getContainer() {
    return this.contextPanel;
  }
  unload() {
    this.processingTimeouts.forEach((timeout) => {
      clearTimeout(timeout);
    });
    this.processingTimeouts.clear();
    this.processingFiles.forEach((statusEl) => {
      statusEl.remove();
    });
    this.processingFiles.clear();
    if (this.processingStatus) {
      this.processingStatus.style.display = "none";
    }
    this.drawer.unload();
  }
  async processAudioFile(file, timestamped = false) {
    var _a, _b;
    this.updateProcessingStatus(file, "Transcribing audio...", "loader-2");
    try {
      const transcriptionService = TranscriptionService.getInstance(this.plugin);
      const text = await transcriptionService.transcribeFile(file, {
        type: "note",
        timestamped,
        onProgress: (progress, status) => {
          this.updateProcessingStatus(file, status, "loader-2");
        }
      });
      const extractionFolder = this.sculptService.extractionsDirectory;
      const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
      const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
      await this.app.vault.createFolder(parentPath).catch(() => {
      });
      const outputPath = `${parentPath}/${baseName}.md`;
      const finalContent = `# Audio Transcription
Source: ${file.basename}
Transcribed: ${new Date().toISOString()}

${text}`;
      try {
        const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
        if (existingFile instanceof import_obsidian22.TFile) {
          await this.app.vault.modify(existingFile, finalContent);
        } else {
          await this.app.vault.create(outputPath, finalContent);
        }
      } catch (error) {
        console.error("File operation failed:", error);
        throw error;
      }
      this.updateProcessingStatus(file, "Added successfully!", "check-circle");
      return outputPath;
    } catch (error) {
      console.error("Audio transcription error:", error);
      this.updateProcessingStatus(file, `Error: ${error instanceof Error ? error.message : String(error)}`, "x-circle");
      throw error;
    }
  }
  async pollUntilComplete(documentId) {
    var _a, _b, _c;
    const maxTries = 50;
    for (let i = 0; i < maxTries; i++) {
      await this.sleep(3e3);
      const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}`;
      const resp = await fetch(url);
      if (!resp.ok)
        continue;
      const data = await resp.json();
      if (((_a = data == null ? void 0 : data.data) == null ? void 0 : _a.status) === "completed")
        return true;
      if (((_b = data == null ? void 0 : data.data) == null ? void 0 : _b.status) === "error") {
        throw new Error(((_c = data == null ? void 0 : data.data) == null ? void 0 : _c.error) || "Processing failed");
      }
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}/download`;
    const resp = await fetch(url);
    if (!resp.ok) {
      throw new Error(`Download extraction failed: ${resp.status}`);
    }
    const data = await resp.json();
    if (!data.success) {
      throw new Error(data.error || "Failed to download extraction");
    }
    return data.data.extractionResult;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
};

// src/views/ChatView.ts
init_SystemPromptService();

// src/modals/LoadChatModal.ts
var import_obsidian24 = __toModule(require("obsidian"));
init_SystemPromptService();
var LoadChatModal = class extends import_obsidian24.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.chatItems = [];
    this.flattenedItems = [];
    this.selectedChatId = null;
    this.selectedCardIndex = 0;
    this.chatCards = [];
    this.currentSearchResults = [];
    this.isKeyboardNavActive = false;
    this.batchSize = 20;
    this.currentBatch = 0;
    this.isLoading = false;
    this.cardCache = new Map();
    this.getSearchableFields = (chat) => {
      return [
        { field: "title", text: chat.title, weight: 200 },
        { field: "content", text: chat.messages.map((m) => this.getMessageContent(m)).join(" "), weight: 100 }
      ];
    };
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.searchService = new SearchService();
    this.chatStorage = new ChatStorageService(app, plugin.settings.chatsDirectory);
    this.setupVirtualScroller();
  }
  setupVirtualScroller() {
    this.virtualScroller = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !this.isLoading) {
          this.loadNextBatch();
        }
      });
    }, {
      root: null,
      rootMargin: "100px",
      threshold: 0.1
    });
  }
  async loadNextBatch() {
    if (this.isLoading || this.currentBatch * this.batchSize >= this.currentSearchResults.length) {
      return;
    }
    this.isLoading = true;
    const start = this.currentBatch * this.batchSize;
    const end = Math.min(start + this.batchSize, this.currentSearchResults.length);
    const batch = this.currentSearchResults.slice(start, end);
    const fragment = document.createDocumentFragment();
    const sectionsContainer = fragment.createDiv({
      cls: "systemsculpt-chat-sections-container"
    });
    await Promise.all(batch.map(async (result) => {
      await this.renderChatCard(result.item, result.matches || [], sectionsContainer);
    }));
    this.chatGrid.appendChild(fragment);
    this.currentBatch++;
    this.isLoading = false;
    if (end < this.currentSearchResults.length) {
      const sentinel = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-sentinel"
      });
      this.virtualScroller.observe(sentinel);
    }
  }
  async flattenChatItem(item) {
    const modelName = await this.getModelName(item.selectedModelId);
    const promptLabel = await this.getPromptLabel(item);
    const lastMessage = item.messages[item.messages.length - 1];
    const messageContent = item.messages.map((msg) => this.getMessageContent(msg)).join("\n");
    return {
      id: item.id,
      searchText: `${messageContent} ${modelName} ${promptLabel}`.toLowerCase(),
      modelName,
      promptLabel,
      lastMessage: lastMessage ? this.getMessageContent(lastMessage) : "",
      messageContent,
      item
    };
  }
  createProgressModal() {
    const { contentEl } = this;
    this.progressContainer = contentEl.createDiv({
      cls: "systemsculpt-progress-overlay"
    });
    const statusContainer = this.progressContainer.createDiv({
      cls: "systemsculpt-progress-status"
    });
    const statusIcon = statusContainer.createDiv({
      cls: "systemsculpt-progress-status-icon"
    });
    (0, import_obsidian24.setIcon)(statusIcon, "loader-2");
    this.progressText = statusContainer.createSpan({
      text: "Loading chats..."
    });
  }
  updateProgress(current, total) {
    if (current === total) {
      this.progressContainer.remove();
    }
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-chat-modal");
    this.createProgressModal();
    try {
      const chats = await this.chatStorage.loadChats();
      this.chatItems = chats.sort((a, b) => b.lastModified - a.lastModified);
      this.flattenedItems = await Promise.all(this.chatItems.map(async (item, index) => {
        const flatItem = await this.flattenChatItem(item);
        this.updateProgress(index + 1, this.chatItems.length);
        return flatItem;
      }));
    } catch (error) {
      console.error("Failed to load chats:", error);
      this.chatItems = [];
      this.flattenedItems = [];
    }
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search chats..."
    });
    this.chatGrid = contentEl.createDiv({ cls: "systemsculpt-chat-grid" });
    await this.renderChats(this.flattenedItems.map((item) => ({
      item: item.item,
      matches: [],
      score: 0
    })));
    const buttonContainer = contentEl.createDiv({
      cls: "systemsculpt-button-container"
    });
    const newChatButton = buttonContainer.createEl("button", {
      cls: "systemsculpt-button",
      text: "Open New Chat Instead"
    });
    newChatButton.addEventListener("click", () => this.openNewChat());
    this.setupEventListeners();
    this.containerEl.style.display = "";
    this.searchInput.focus();
  }
  setupEventListeners() {
    this.searchInput.addEventListener("input", () => {
      const query = this.searchInput.value;
      if (!query) {
        this.currentSearchResults = this.flattenedItems.map((item) => ({
          item: item.item,
          matches: [],
          score: 0
        }));
        this.selectedCardIndex = 0;
        this.isKeyboardNavActive = false;
        this.renderChats(this.currentSearchResults);
        return;
      }
      if (query.length < 3) {
        this.chatGrid.empty();
        this.chatCards = [];
        this.selectedCardIndex = 0;
        this.isKeyboardNavActive = false;
        const messageEl = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        messageEl.setText(`Please enter at least 3 characters to search (${query.length}/3)`);
        return;
      }
      const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
      const results = this.flattenedItems.map((flatItem) => {
        const allTermsExist = searchTerms.every((term) => flatItem.searchText.includes(term));
        if (!allTermsExist) {
          return { item: flatItem.item, matches: [], score: 0 };
        }
        let score = 0;
        const matches = [];
        searchTerms.forEach((term) => {
          let pos = 0;
          while ((pos = flatItem.searchText.indexOf(term, pos)) !== -1) {
            score += 1;
            matches.push({
              field: "content",
              text: flatItem.searchText.slice(Math.max(0, pos - 20), pos + term.length + 20),
              indices: [pos],
              matchQuality: 1
            });
            pos += 1;
          }
        });
        if (flatItem.searchText.includes(query.toLowerCase())) {
          score *= 2;
        }
        return {
          item: flatItem.item,
          matches,
          score
        };
      }).filter((result) => result.score > 0).sort((a, b) => {
        if (b.score !== a.score) {
          return b.score - a.score;
        }
        return b.item.lastModified - a.item.lastModified;
      });
      this.currentSearchResults = results;
      this.selectedCardIndex = 0;
      this.isKeyboardNavActive = false;
      this.renderChats(results);
    });
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (this.chatCards.length === 0)
          return;
        if (!this.isKeyboardNavActive) {
          this.isKeyboardNavActive = true;
          this.selectedCardIndex = 0;
        } else {
          if (e.shiftKey) {
            this.selectedCardIndex = (this.selectedCardIndex - 1 + this.chatCards.length) % this.chatCards.length;
          } else {
            this.selectedCardIndex = (this.selectedCardIndex + 1) % this.chatCards.length;
          }
        }
        this.updateSelectedCard();
      } else if (e.key === "Enter" && this.isKeyboardNavActive && this.chatCards.length > 0) {
        e.preventDefault();
        const selectedCard = this.chatCards[this.selectedCardIndex];
        if (selectedCard == null ? void 0 : selectedCard.dataset.chatId) {
          this.onSelect(selectedCard.dataset.chatId);
          this.close();
        }
      } else if (e.key === "Escape") {
        if (this.isKeyboardNavActive) {
          e.preventDefault();
          this.isKeyboardNavActive = false;
          this.updateSelectedCard();
        }
      }
    });
    this.contentEl.addEventListener("click", () => {
      if (this.isKeyboardNavActive) {
        this.isKeyboardNavActive = false;
        this.updateSelectedCard();
      }
    });
  }
  renderChats(searchResults) {
    var _a;
    if (!this.chatGrid)
      return;
    this.chatGrid.empty();
    this.chatCards = [];
    this.currentBatch = 0;
    this.selectedCardIndex = 0;
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const favorites = [];
    const nonFavorites = [];
    searchResults.forEach((sr) => {
      if (this.plugin.settings.favoriteChats.includes(sr.item.id)) {
        favorites.push(sr.item);
      } else {
        nonFavorites.push(sr.item);
      }
    });
    if (favorites.length > 0) {
      const header = this.chatGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => b.lastModified - a.lastModified);
      favorites.forEach((chat) => {
        const matches = srMap.get(chat.id) || [];
        const card = this.renderChatCard(chat, matches);
        if (card) {
          this.chatGrid.appendChild(card);
        }
      });
    }
    if (nonFavorites.length > 0) {
      const recentHeader = this.chatGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      recentHeader.createSpan({ text: "Recent Chats" });
      nonFavorites.sort((a, b) => b.lastModified - a.lastModified);
      nonFavorites.forEach((chat) => {
        const matches = srMap.get(chat.id) || [];
        const card = this.renderChatCard(chat, matches);
        if (card) {
          this.chatGrid.appendChild(card);
        }
      });
    }
    if (favorites.length === 0 && nonFavorites.length === 0) {
      if ((_a = this.searchInput) == null ? void 0 : _a.value) {
        const emptyState = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        emptyState.setText("No chats found matching your search.");
      } else {
        const emptyState = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        emptyState.setText("No chat history found.");
      }
    }
    if (this.virtualScroller) {
      const sentinel = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-sentinel"
      });
      this.virtualScroller.observe(sentinel);
    }
    if (this.isKeyboardNavActive && this.chatCards.length > 0) {
      this.updateSelectedCard();
    }
  }
  attachCardEventListeners(card, item) {
    card.addEventListener("click", () => {
      this.onSelect(item.id);
      this.close();
    });
    const favoriteButton = card.querySelector(".systemsculpt-favorite-button");
    if (favoriteButton) {
      favoriteButton.addEventListener("click", async (e) => {
        var _a;
        e.stopPropagation();
        const target = e.target;
        const chatCard = target.closest(".systemsculpt-chat-card");
        if (!chatCard)
          return;
        const isFavorite = !this.plugin.settings.favoriteChats.includes(item.id);
        favoriteButton.classList.toggle("is-favorite", isFavorite);
        favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
        if (!Array.isArray(this.plugin.settings.favoriteChats)) {
          this.plugin.settings.favoriteChats = [];
        }
        if (isFavorite) {
          if (!this.plugin.settings.favoriteChats.includes(item.id)) {
            this.plugin.settings.favoriteChats.push(item.id);
          }
        } else {
          this.plugin.settings.favoriteChats = this.plugin.settings.favoriteChats.filter((id) => id !== item.id);
        }
        await this.plugin.saveSettings();
        if (isFavorite) {
          let favoritesHeader2 = this.chatGrid.querySelector(".systemsculpt-provider-header");
          if (!favoritesHeader2 || !((_a = favoritesHeader2.textContent) == null ? void 0 : _a.includes("Favorites"))) {
            favoritesHeader2 = this.chatGrid.createDiv({ cls: "systemsculpt-provider-header" });
            favoritesHeader2.createSpan({ text: "Favorites" });
            this.chatGrid.insertBefore(favoritesHeader2, this.chatGrid.firstChild);
          }
          const nextElement = Array.from(this.chatGrid.children).find((el, index) => {
            if (index <= 1)
              return false;
            return !this.plugin.settings.favoriteChats.includes(el.dataset.chatId || "");
          });
          if (nextElement) {
            this.chatGrid.insertBefore(chatCard, nextElement);
          } else {
            const recentHeader2 = Array.from(this.chatGrid.children).find((el) => {
              var _a2;
              return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
            });
            this.chatGrid.insertBefore(chatCard, recentHeader2 || null);
          }
        } else {
          let recentHeader2 = Array.from(this.chatGrid.children).find((el) => {
            var _a2;
            return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
          });
          if (!recentHeader2) {
            recentHeader2 = this.chatGrid.createDiv({ cls: "systemsculpt-provider-header" });
            recentHeader2.createSpan({ text: "Recent Chats" });
            this.chatGrid.appendChild(recentHeader2);
          }
          if (recentHeader2.nextSibling) {
            this.chatGrid.insertBefore(chatCard, recentHeader2.nextSibling);
          } else {
            this.chatGrid.appendChild(chatCard);
          }
        }
        const favoritesHeader = this.chatGrid.querySelector(".systemsculpt-provider-header");
        const recentHeader = Array.from(this.chatGrid.children).find((el) => {
          var _a2;
          return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
        });
        if (favoritesHeader && !this.plugin.settings.favoriteChats.length) {
          favoritesHeader.remove();
        }
        if (recentHeader) {
          const hasRecentChats = Array.from(this.chatGrid.children).some((el) => el.classList.contains("systemsculpt-chat-card") && !this.plugin.settings.favoriteChats.includes(el.dataset.chatId || ""));
          if (!hasRecentChats) {
            recentHeader.remove();
          }
        }
      });
    }
  }
  renderChatCard(item, matches = [], sectionsContainer) {
    var _a;
    const cachedCard = this.cardCache.get(item.id);
    if (cachedCard) {
      const card2 = cachedCard.cloneNode(true);
      if (matches.length > 0) {
        this.updateCardHighlights(card2, matches);
      }
      this.attachCardEventListeners(card2, item);
      card2.dataset.chatId = item.id;
      this.chatCards.push(card2);
      return card2;
    }
    const flatItem = this.flattenedItems.find((f) => f.id === item.id);
    if (!flatItem)
      return document.createElement("div");
    const isSelected = this.isKeyboardNavActive && this.chatCards.length === this.selectedCardIndex;
    const card = document.createElement("div");
    card.className = `systemsculpt-chat-card ${item.id === this.selectedChatId ? "selected" : ""} ${isSelected ? "systemsculpt-keyboard-selected" : ""}`;
    card.dataset.chatId = item.id;
    this.chatCards.push(card);
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${this.plugin.settings.favoriteChats.includes(item.id) ? "is-favorite" : ""}`,
      attr: {
        "aria-label": this.plugin.settings.favoriteChats.includes(item.id) ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian24.setIcon)(favoriteButton, "star");
    const header = card.createDiv({ cls: "systemsculpt-chat-card-header" });
    const leftContainer = header.createDiv({ cls: "systemsculpt-chat-header-left" });
    const modelBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
    (0, import_obsidian24.setIcon)(modelBadge, "bot");
    modelBadge.appendText(flatItem.modelName);
    const promptBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
    (0, import_obsidian24.setIcon)(promptBadge, "command");
    promptBadge.appendText(flatItem.promptLabel);
    if (item.context_files && item.context_files.length > 0) {
      const docBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
      (0, import_obsidian24.setIcon)(docBadge, "file-text");
      docBadge.appendText(`${item.context_files.length} Document${item.context_files.length > 1 ? "s" : ""}`);
    }
    const preview = card.createDiv({ cls: "systemsculpt-chat-preview" });
    if (matches.length > 0) {
      const searchQuery = (_a = this.searchInput) == null ? void 0 : _a.value;
      const searchTerms = (searchQuery == null ? void 0 : searchQuery.toLowerCase().split(/\s+/).filter(Boolean)) || [];
      const contextText = this.getMatchContext(flatItem.messageContent, matches, searchTerms);
      preview.appendChild(this.searchService.highlightText(contextText, matches, searchQuery));
    } else {
      preview.appendText(flatItem.lastMessage);
    }
    const meta = card.createDiv({ cls: "systemsculpt-chat-meta" });
    const dateEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian24.setIcon)(dateEl, "calendar");
    dateEl.createSpan({ text: this.formatDate(item.lastModified) });
    const messagesEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian24.setIcon)(messagesEl, "message-square");
    messagesEl.createSpan({ text: `${item.messages.length} message${item.messages.length !== 1 ? "s" : ""}` });
    const titleEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian24.setIcon)(titleEl, "file");
    titleEl.createSpan({ text: item.title });
    this.attachCardEventListeners(card, item);
    this.cardCache.set(item.id, card.cloneNode(true));
    return card;
  }
  updateCardHighlights(card, matches) {
    var _a;
    const preview = card.querySelector(".systemsculpt-chat-preview");
    if (!preview)
      return;
    const searchQuery = (_a = this.searchInput) == null ? void 0 : _a.value;
    const searchTerms = (searchQuery == null ? void 0 : searchQuery.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const flatItem = this.flattenedItems.find((f) => f.id === card.dataset.chatId);
    if (!flatItem)
      return;
    const contextText = this.getMatchContext(flatItem.messageContent, matches, searchTerms);
    preview.innerHTML = "";
    preview.appendChild(this.searchService.highlightText(contextText, matches, searchQuery));
  }
  formatDate(timestamp) {
    return new Date(timestamp).toLocaleString();
  }
  getMessageContent(message) {
    if (typeof message.content === "string") {
      return message.content;
    }
    return "Image message";
  }
  async getModelName(modelId) {
    try {
      const models = await this.plugin.modelService.getModels();
      if (!models)
        return modelId;
      const model = models.find((m) => m.id === modelId || m.identifier && `${m.identifier.providerId}/${m.identifier.modelId}` === modelId);
      if (model == null ? void 0 : model.identifier) {
        return model.identifier.displayName || model.identifier.modelId;
      }
      return (model == null ? void 0 : model.name) || modelId;
    } catch (error) {
      console.error("Failed to get model name:", error);
      return modelId;
    }
  }
  async getPromptLabel(item) {
    var _a;
    if (item.customPromptFilePath) {
      return ((_a = item.customPromptFilePath.split("/").pop()) == null ? void 0 : _a.replace(/\.md$/, "")) || "Custom Prompt";
    }
    if (item.systemPromptType) {
      try {
        const systemPromptService = new SystemPromptService(this.app);
        const preset = await systemPromptService.getSystemPromptById(item.systemPromptType);
        if (preset) {
          return preset.label;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
      }
    }
    return "Default";
  }
  updateSelectedCard() {
    this.chatCards.forEach((card, index) => {
      if (index === this.selectedCardIndex && this.isKeyboardNavActive) {
        card.classList.add("systemsculpt-keyboard-selected");
        card.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        card.classList.remove("systemsculpt-keyboard-selected");
      }
    });
  }
  openNewChat() {
    this.close();
    const leaf = this.app.workspace.getLeaf(true);
    leaf.setViewState({
      type: CHAT_VIEW_TYPE,
      state: {}
    });
    this.app.workspace.setActiveLeaf(leaf);
  }
  onClose() {
    if (this.virtualScroller) {
      this.virtualScroller.disconnect();
    }
    const { contentEl } = this;
    contentEl.empty();
  }
  getMatchContext(text, matches, searchTerms) {
    if (!matches.length)
      return text;
    const positions = [];
    searchTerms.forEach((term) => {
      let pos = 0;
      const textLower = text.toLowerCase();
      while ((pos = textLower.indexOf(term, pos)) !== -1) {
        positions.push(pos);
        pos += 1;
      }
    });
    if (!positions.length)
      return text;
    positions.sort((a, b) => a - b);
    const CONTEXT_SIZE = 75;
    let bestStart = positions[0];
    let bestEnd = positions[0];
    let bestSpan = Infinity;
    for (let i = 0; i < positions.length; i++) {
      const start = positions[i];
      let end = start;
      let matchCount = 1;
      for (let j = i + 1; j < positions.length; j++) {
        if (positions[j] - start > CONTEXT_SIZE * 2)
          break;
        end = positions[j];
        matchCount++;
      }
      const span = end - start;
      if (matchCount > 1 && span < bestSpan) {
        bestStart = start;
        bestEnd = end;
        bestSpan = span;
      }
    }
    const contextStart = Math.max(0, bestStart - CONTEXT_SIZE);
    const contextEnd = Math.min(text.length, bestEnd + CONTEXT_SIZE);
    let previewStart = contextStart;
    while (previewStart > 0 && !/[\s.!?\n]/.test(text[previewStart - 1])) {
      previewStart--;
    }
    let previewEnd = contextEnd;
    while (previewEnd < text.length && !/[\s.!?\n]/.test(text[previewEnd])) {
      previewEnd++;
    }
    let preview = text.slice(previewStart, previewEnd).trim();
    if (previewStart > 0)
      preview = "..." + preview;
    if (previewEnd < text.length)
      preview = preview + "...";
    return preview;
  }
  getVisibleChats() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.flattenedItems.map((item) => ({
        item: item.item,
        matches: [],
        score: 0
      }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.flattenedItems.map((f) => f.item), query, (chat) => this.getSearchableFields(chat), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
};

// src/views/ChatView.ts
var CHAT_VIEW_TYPE = "systemsculpt-chat-view";
var ChatView = class extends import_obsidian25.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.messages = [];
    this.currentModelName = "";
    this.isGenerating = false;
    this.refreshInterval = null;
    this.lastRefreshTime = 0;
    this.awaitingStateRestore = false;
    this.chatTitle = "Untitled Chat";
    this.plugin = plugin;
    this.aiService = SystemSculptService.getInstance(plugin.settings, this.app);
    this.chatStorage = new ChatStorageService(this.app, plugin.settings.chatsDirectory);
    this.selectedModelId = plugin.settings.selectedModelId;
    this.messages = [];
    this.lastRefreshTime = 0;
    this.isGenerating = false;
    this.awaitingStateRestore = true;
    this.messageRenderer = new MessageRenderer(this.app);
    this.systemPromptType = this.plugin.settings.systemPromptType || "general-use";
    if (this.systemPromptType === "custom" && this.plugin.settings.systemPromptPath) {
      this.systemPromptPath = this.plugin.settings.systemPromptPath;
    } else {
      this.systemPromptPath = void 0;
    }
    this.layoutChangeHandler = this.onLayoutChange.bind(this);
  }
  getViewType() {
    return CHAT_VIEW_TYPE;
  }
  getDisplayText() {
    const allChats = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (allChats.length <= 1) {
      return this.chatTitle;
    }
    const chatNumber = allChats.indexOf(this.leaf) + 1;
    return `${this.chatTitle} ${chatNumber}`;
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    container.addClass("systemsculpt-chat-container");
    this.setupDragAndDrop(container);
    const headerContainer = container.createEl("div", {
      cls: "systemsculpt-chat-header"
    });
    const headerRow = headerContainer.createEl("div", {
      cls: "systemsculpt-chat-header-row"
    });
    const leftSection = headerRow.createEl("div", {
      cls: "systemsculpt-header-section-left"
    });
    this.contextManager = new FileContextManager({
      app: this.app,
      container: leftSection,
      onContextChange: async () => {
        await this.saveChat();
        await this.contextManager.checkSyncStatus();
      },
      sculptService: this.aiService,
      plugin: this.plugin
    });
    const rightSection = headerRow.createEl("div", {
      cls: "systemsculpt-header-section-right"
    });
    this.actionsDrawer = new DrawerComponent({
      container: rightSection,
      title: "Actions"
    });
    const actionsContent = this.actionsDrawer.getContent();
    const modelSelectionAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item"
    });
    this.modelIndicator = modelSelectionAction.createEl("div", {
      cls: "systemsculpt-model-indicator-drawer",
      text: `Current Model: ${this.selectedModelId}`
    });
    this.updateModelIndicator();
    actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-separator"
    });
    const openHistoryAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Open Chat History File"
    });
    openHistoryAction.addEventListener("click", () => {
      const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian25.TFile) {
        this.app.workspace.getLeaf().openFile(file);
      }
    });
    const loadDifferentChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Load A Different Chat"
    });
    loadDifferentChatAction.addEventListener("click", () => {
      const leaf = this.app.workspace.getLeaf(true);
      new LoadChatModal(this.app, async (chatId) => {
        const view = await leaf.setViewState({
          type: CHAT_VIEW_TYPE,
          state: { chatId }
        });
        this.app.workspace.setActiveLeaf(leaf);
      }, this.plugin).open();
    });
    const copyChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item",
      text: "Copy Chat to Clipboard"
    });
    copyChatAction.addEventListener("click", async () => {
      await this.copyToClipboard();
    });
    const deleteChatAction = actionsContent.createEl("div", {
      cls: "systemsculpt-drawer-item systemsculpt-drawer-item-danger",
      text: "Delete This Chat"
    });
    deleteChatAction.addEventListener("click", async () => {
      const deleteConfirmed = await showPopup(this.app, "Are you sure you want to delete this chat?", {
        primaryButton: "Delete",
        secondaryButton: "Cancel"
      });
      if (deleteConfirmed == null ? void 0 : deleteConfirmed.confirmed) {
        const filePath = `${this.plugin.settings.chatsDirectory}/${this.chatId}.md`;
        const file = this.app.vault.getAbstractFileByPath(filePath);
        if (file instanceof import_obsidian25.TFile) {
          await this.app.vault.delete(file);
        }
        this.leaf.detach();
      }
    });
    this.chatContainer = container.createEl("div", {
      cls: "systemsculpt-messages-container"
    });
    this.scrollManager = new ScrollManagerService({
      container: this.chatContainer
    });
    this.inputHandler = new InputHandler({
      app: this.app,
      container,
      aiService: this.aiService,
      getMessages: () => [...this.messages],
      getSelectedModelId: () => this.selectedModelId,
      getContextFiles: () => this.contextManager.getContextFiles(),
      getSystemPrompt: () => ({
        type: this.systemPromptType,
        path: this.systemPromptPath
      }),
      chatContainer: this.chatContainer,
      scrollManager: this.scrollManager,
      messageRenderer: this.messageRenderer,
      onMessageSubmit: async (message) => {
        this.messages.push(message);
        await this.saveChat();
        await this.addMessage(message.role, message.content, message.message_id);
      },
      onAssistantResponse: async (message) => {
        this.messages.push(message);
        await this.saveChat();
      },
      onContextFileAdd: async (wikilink) => {
        const files = this.contextManager.getContextFiles();
        files.add(wikilink);
        this.contextManager.setContextFiles(Array.from(files));
        await this.saveChat();
      },
      onError: (error) => this.handleError(error),
      onAddContextFile: () => {
        const contextButton = this.contextManager.getContainer().querySelector(".systemsculpt-context-add-button");
        if (contextButton instanceof HTMLElement) {
          contextButton.click();
        }
      },
      onEditSystemPrompt: () => {
        this.handleSystemPromptEdit();
      },
      plugin: this.plugin,
      chatView: this
    });
    this.inputHandler.onModelChange();
    this.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf === this.leaf) {
        this.checkForUpdates();
        this.inputHandler.focus();
      }
    });
    this.inputHandler.focus();
    await this.checkForUpdates();
    if (!this.awaitingStateRestore && this.messages.length === 0) {
      if (!this.chatId) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const hour = String(now.getHours()).padStart(2, "0");
        const minute = String(now.getMinutes()).padStart(2, "0");
        const second = String(now.getSeconds()).padStart(2, "0");
        this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
        this.chatTitle = `Chat ${now.toLocaleString()}`;
        await this.saveChat();
      }
    }
    setTimeout(async () => {
      if (!this.plugin.settings.selectedModelId) {
        const result = await showPopup(this.app, "You don't have a default model selected yet. Would you like to choose one now? This will be used as the default for all new chats.", {
          title: "Select Default Model",
          icon: "bot",
          primaryButton: "Choose Model",
          secondaryButton: "Maybe Later"
        });
        if (result == null ? void 0 : result.confirmed) {
          try {
            const models = await this.plugin.modelService.getModels();
            const modal = new ModelSelectionModal(this.app, "", async (modelId) => {
              this.plugin.settings.selectedModelId = modelId;
              await this.plugin.saveSettings();
              this.selectedModelId = modelId;
              await this.updateModelIndicator();
            }, this.plugin);
            modal.open();
          } catch (error) {
            console.error("Error loading models:", error);
            showPopup(this.app, "Failed to load available models");
          }
        }
      }
    }, 100);
  }
  async loadMessages() {
    if (!this.chatContainer)
      return;
    const scrollTop = this.chatContainer.scrollTop;
    const scrollHeight = this.chatContainer.scrollHeight;
    const clientHeight = this.chatContainer.clientHeight;
    const wasAtBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
    this.chatContainer.empty();
    for (const message of this.messages) {
      await this.addMessage(message.role, message.content, message.message_id);
    }
    if (wasAtBottom) {
      this.scrollManager.scrollToBottom();
    } else {
      this.chatContainer.scrollTop = scrollTop;
    }
  }
  async updateModelIndicator() {
    if (this.modelIndicator) {
      const newModelIndicator = this.modelIndicator.cloneNode(true);
      this.modelIndicator.replaceWith(newModelIndicator);
      this.modelIndicator = newModelIndicator;
      this.modelIndicator.addEventListener("click", async () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId || "", async (modelId) => {
          await this.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected successfully", "info");
        }, this.plugin);
        modal.open();
      });
      if (!this.selectedModelId || this.selectedModelId.trim() === "") {
        this.modelIndicator.empty();
        this.modelIndicator.createSpan({ text: "No model selected" });
        this.modelIndicator.addClass("systemsculpt-no-model");
      } else {
        try {
          const models = await this.plugin.modelService.getModels();
          const currentModel = models.find((model) => model.id === this.selectedModelId);
          let providerPrefix = "";
          if (currentModel) {
            if (currentModel.provider === "systemsculpt") {
              providerPrefix = "[SYSTEMSCULPT] ";
            } else {
              providerPrefix = `[${currentModel.provider.toUpperCase()}] `;
            }
          }
          this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
          this.modelIndicator.empty();
          this.modelIndicator.removeClass("systemsculpt-no-model");
          this.modelIndicator.createSpan({ text: "Current Model: " });
          this.modelIndicator.createSpan({
            text: providerPrefix + this.currentModelName
          });
        } catch (error) {
          this.currentModelName = this.selectedModelId;
          this.modelIndicator.empty();
          this.modelIndicator.removeClass("systemsculpt-no-model");
          this.modelIndicator.createSpan({ text: "Current Model: " });
          this.modelIndicator.createSpan({ text: this.currentModelName });
        }
      }
    }
  }
  async checkForUpdates() {
    if (this.isGenerating)
      return;
    try {
      const savedChats = await this.chatStorage.loadChats();
      const currentChat = savedChats.find((c) => c.id === this.chatId);
      if (!currentChat)
        return;
      const hasChanges = currentChat.messages.length !== this.messages.length || currentChat.selectedModelId !== this.selectedModelId || JSON.stringify(Array.from(this.contextManager.getContextFiles())) !== JSON.stringify(currentChat.context_files) || JSON.stringify(currentChat.messages) !== JSON.stringify(this.messages);
      if (hasChanges) {
        this.messages = currentChat.messages;
        this.selectedModelId = currentChat.selectedModelId;
        if (currentChat.context_files) {
          await this.contextManager.setContextFiles(currentChat.context_files);
        }
        await this.loadMessages();
        this.updateModelIndicator();
      } else {
        await this.contextManager.checkSyncStatus();
      }
    } catch (error) {
      console.error("Failed to check for updates:", error);
    }
  }
  async saveChat() {
    if (!this.chatId) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      const hour = String(now.getHours()).padStart(2, "0");
      const minute = String(now.getMinutes()).padStart(2, "0");
      const second = String(now.getSeconds()).padStart(2, "0");
      this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
      this.chatTitle = this.chatTitle || this.chatId;
    }
    try {
      await this.chatStorage.saveChat(this.chatId, this.messages, this.selectedModelId, this.contextManager.getContextFiles(), void 0, this.systemPromptType, this.systemPromptPath, this.chatTitle, this.tokenLimit, this.tokenLimitPercentage);
    } catch (error) {
      this.handleError("Failed to save chat");
    }
  }
  async handleError(error) {
    console.error("Chat error:", {
      error,
      message: typeof error === "string" ? error : error.message,
      code: error instanceof SystemSculptError ? error.code : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
    let errorMessage = typeof error === "string" ? error : error.message;
    if (error instanceof SystemSculptError && (error.code === "MODEL_UNAVAILABLE" || error.code === "MODEL_REQUEST_ERROR" || error.code === "QUOTA_EXCEEDED")) {
      showEnhancedNotice(errorMessage, "error", error);
      const modal = new ModelSelectionModal(this.app, this.selectedModelId, async (modelId) => {
        this.selectedModelId = modelId;
        this.updateModelIndicator();
        showEnhancedNotice("Model changed. You can now retry your message.", "info");
        this.focusInput();
      }, this.plugin);
      modal.open();
      try {
        const models = await this.plugin.modelService.getModels();
        modal.setModels(models);
      } catch (err) {
        console.error("Failed to fetch models:", err);
        showEnhancedNotice("Failed to fetch available models", "error", err);
      }
      const lastMessage = this.chatContainer.querySelector(".systemsculpt-message:last-child");
      if (lastMessage) {
        lastMessage.remove();
      }
      const lastUserMessage = [...this.messages].reverse().find((msg) => msg.role === "user");
      if (lastUserMessage) {
        const index = this.messages.findIndex((msg) => msg.message_id === lastUserMessage.message_id);
        if (index !== -1) {
          this.messages.splice(index);
          const allMessages = this.chatContainer.querySelectorAll(".systemsculpt-message");
          for (let i = index; i < allMessages.length; i++) {
            allMessages[i].remove();
          }
          this.inputHandler.setValue(typeof lastUserMessage.content === "string" ? lastUserMessage.content : JSON.stringify(lastUserMessage.content));
          this.inputHandler.focus();
        }
      }
    } else {
      showEnhancedNotice(errorMessage, "error", error);
    }
  }
  async onLayoutChange() {
    var _a;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian25.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.lastRefreshTime = 0;
      await this.checkForUpdates();
      this.inputHandler.focus();
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async handleSystemPromptEdit() {
    let currentContent = "";
    if (this.systemPromptType === "custom") {
      const file = this.app.vault.getAbstractFileByPath((this.systemPromptPath || "") + ".md");
      if (file instanceof import_obsidian25.TFile) {
        currentContent = await this.app.vault.read(file);
      } else {
        currentContent = this.plugin.settings.systemPrompt;
      }
    } else {
      const systemPromptService = new SystemPromptService(this.app);
      try {
        const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
        if (preset) {
          currentContent = preset.systemPrompt;
        } else {
          currentContent = this.plugin.settings.systemPrompt;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
        currentContent = this.plugin.settings.systemPrompt;
      }
    }
    let modelContextLength;
    try {
      const models = await this.plugin.modelService.getModels();
      const currentModel = models.find((model) => model.id === this.selectedModelId);
      if (currentModel) {
        modelContextLength = currentModel.context_length;
      }
    } catch (error) {
      console.error("Failed to get model context length:", error);
    }
    const result = await showSystemPromptModal(this.app, currentContent, {
      mode: "chat-specific",
      customPromptFilePath: this.systemPromptPath || this.plugin.settings.systemPromptPath,
      systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
      modelContextLength,
      tokenLimitPercentage: this.tokenLimitPercentage
    });
    if (result) {
      this.systemPromptType = result.type;
      if (result.type === "custom" && result.path) {
        this.systemPromptPath = result.path;
      } else {
        this.systemPromptPath = void 0;
      }
      this.tokenLimitPercentage = result.tokenLimitPercentage;
      this.tokenLimit = result.tokenLimit;
      await this.saveChat();
    }
  }
  async addMessage(role, content, existingMessageId) {
    const messageId = existingMessageId || this.generateMessageId();
    const { messageEl, contentEl } = await this.messageRenderer.renderMessage({
      app: this.app,
      messageId,
      role,
      content
    });
    const contentStr = typeof content === "string" ? content : JSON.stringify(content);
    messageEl.dataset.content = contentStr;
    this.messageRenderer.addMessageButtonToolbar(messageEl, typeof content === "string" ? content : JSON.stringify(content), role, messageId);
    messageEl.addEventListener("resubmit", async (e) => {
      const { messageId: messageId2, content: content2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index);
        await this.saveChat();
        this.chatContainer.empty();
        for (const msg of this.messages) {
          await this.addMessage(msg.role, msg.content, msg.message_id);
        }
        this.inputHandler.setValue(content2);
        this.inputHandler.focus();
      }
    });
    messageEl.addEventListener("edit", async (e) => {
      const { messageId: messageId2, oldContent, newContent } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages[index].content = newContent;
        await this.saveChat();
        const { contentEl: newContentEl } = await this.messageRenderer.renderMessage({
          app: this.app,
          messageId: messageId2,
          role: this.messages[index].role,
          content: this.messages[index].content
        });
        const oldContentEl = messageEl.querySelector(".systemsculpt-message-content");
        if (oldContentEl && newContentEl) {
          oldContentEl.replaceWith(newContentEl);
          this.messageRenderer.setupImageHandlers(newContentEl);
        }
        const updatedStr = typeof this.messages[index].content === "string" ? this.messages[index].content : JSON.stringify(this.messages[index].content);
        messageEl.dataset.content = updatedStr;
      }
    });
    messageEl.addEventListener("delete", async (e) => {
      const { messageId: messageId2 } = e.detail;
      const index = this.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        this.messages.splice(index, 1);
        await this.saveChat();
        messageEl.remove();
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
      }
    });
    this.chatContainer.appendChild(messageEl);
    this.scrollManager.updateContentHeight();
    this.scrollManager.scrollToBottom();
  }
  getInputValue() {
    return this.inputHandler.getValue();
  }
  onunload() {
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
      this.refreshInterval = null;
    }
    this.scrollManager.cleanup();
    this.app.workspace.off("active-leaf-change", this.checkForUpdates.bind(this));
    this.actionsDrawer.unload();
    this.contextManager.unload();
    this.inputHandler.unload();
  }
  getState() {
    return {
      chatId: this.chatId,
      selectedModelId: this.selectedModelId
    };
  }
  async setState(state) {
    var _a;
    if (state.chatId) {
      await this.loadChatById(state.chatId);
    }
    this.awaitingStateRestore = false;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian25.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.inputHandler.focus();
    }
  }
  async loadChatById(chatId) {
    try {
      const chatData = await this.chatStorage.loadChat(chatId);
      if (!chatData) {
        this.handleError("Failed to load chat");
        return;
      }
      this.chatContainer.empty();
      this.messages = chatData.messages;
      this.chatId = chatData.id;
      this.selectedModelId = chatData.selectedModelId;
      this.chatTitle = chatData.title || "Untitled Chat";
      const metadata = await this.chatStorage.getMetadata(chatId);
      if (metadata == null ? void 0 : metadata.systemMessage) {
        this.systemPromptType = metadata.systemMessage.type;
        this.tokenLimit = metadata.systemMessage.tokenLimit;
        this.tokenLimitPercentage = metadata.systemMessage.tokenLimitPercentage;
        if (metadata.systemMessage.path) {
          this.systemPromptPath = metadata.systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
        }
      }
      try {
        const models = await this.plugin.modelService.getModels();
        const currentModel = models.find((model) => model.id === this.selectedModelId);
        this.currentModelName = (currentModel == null ? void 0 : currentModel.name) || this.selectedModelId;
      } catch (error) {
        this.currentModelName = this.selectedModelId;
      }
      if (chatData.context_files) {
        await this.contextManager.setContextFiles(chatData.context_files);
      }
      for (const message of this.messages) {
        await this.addMessage(message.role, message.content, message.message_id);
      }
      this.updateModelIndicator();
      this.inputHandler.onModelChange();
    } catch (error) {
      console.error("[SystemSculpt] Error in loadChatById:", error);
      this.handleError("Failed to load chat");
    }
  }
  async addFileToContext(file) {
    await this.contextManager.addFileToContext(file);
  }
  async copyToClipboard() {
    try {
      const content = await this.getMarkdown();
      await navigator.clipboard.writeText(content);
      showNotice("Chat copied to clipboard", { type: "success" });
    } catch (error) {
      showNotice("Failed to copy chat to clipboard", { type: "error" });
    }
  }
  getTokenLimit() {
    return this.tokenLimit;
  }
  focusInput() {
    this.inputHandler.focus();
  }
  setupDragAndDrop(container) {
    const overlay = container.createEl("div", {
      cls: "systemsculpt-drag-overlay"
    });
    const message = overlay.createEl("div", {
      cls: "systemsculpt-drag-message",
      text: "Drop files to add to context"
    });
    const MAX_FILES = 100;
    const parseObsidianUri = (uri) => {
      try {
        if (!uri.startsWith("obsidian://open"))
          return null;
        const url = new URL(uri);
        return decodeURIComponent(url.searchParams.get("file") || "");
      } catch (e) {
        console.error("[DragDrop] Error parsing URI:", uri, e);
        return null;
      }
    };
    const getFilesFromFolder = (folder) => {
      const files = [];
      const processFolder = (currentFolder) => {
        for (const child of currentFolder.children) {
          if (child instanceof import_obsidian25.TFile) {
            files.push(child);
          } else if (child instanceof import_obsidian25.TFolder) {
            processFolder(child);
          }
        }
      };
      processFolder(folder);
      const result = files.slice(0, MAX_FILES);
      return result;
    };
    const getFileCount = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        return 0;
      }
      const remainingSlots = MAX_FILES - currentContextSize;
      let newFileCount = 0;
      let filesToProcess = [];
      if (dt.items && dt.items.length > 0) {
        for (const item of Array.from(dt.items)) {
          if (item.type === "text/plain") {
            const text = await new Promise((resolve) => {
              item.getAsString(resolve);
            });
            const lines = text.split("\n").filter((line) => line.trim());
            for (const line of lines) {
              let filePath = line;
              let abstractFile = null;
              if (line.startsWith("obsidian://")) {
                filePath = parseObsidianUri(line) || line;
              }
              abstractFile = this.app.vault.getAbstractFileByPath(filePath);
              if (abstractFile instanceof import_obsidian25.TFolder) {
                filesToProcess.push(abstractFile);
              } else if (abstractFile instanceof import_obsidian25.TFile) {
                filesToProcess.push(abstractFile);
              } else if (!filePath.includes(".")) {
                const mdPath = `${filePath}.md`;
                const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                if (mdFile instanceof import_obsidian25.TFile) {
                  filesToProcess.push(mdFile);
                }
              }
            }
          }
        }
      }
      for (const item of filesToProcess) {
        if (item instanceof import_obsidian25.TFolder) {
          const folderFiles = getFilesFromFolder(item).length;
          newFileCount += folderFiles;
        } else if (item instanceof import_obsidian25.TFile) {
          newFileCount++;
        }
      }
      if (newFileCount === 0 && dt.types.includes("text/uri-list")) {
        const uriData = await new Promise((resolve) => {
          dt.items[1].getAsString(resolve);
        });
        const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
        for (const uri of uris) {
          const filePath = parseObsidianUri(uri);
          if (!filePath)
            continue;
          const abstractFile = this.app.vault.getAbstractFileByPath(filePath);
          if (abstractFile instanceof import_obsidian25.TFolder) {
            const folderFiles = getFilesFromFolder(abstractFile).length;
            newFileCount += folderFiles;
          } else if (abstractFile instanceof import_obsidian25.TFile) {
            newFileCount++;
          }
        }
      }
      const finalCount = Math.min(newFileCount, remainingSlots);
      return finalCount;
    };
    const updateMessage = async (dt) => {
      const currentContextSize = this.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        message.textContent = `Cannot add more files (max ${MAX_FILES} reached)`;
        return;
      }
      const fileCount = await getFileCount(dt);
      if (fileCount > 0) {
        message.textContent = `Add ${fileCount} file${fileCount > 1 ? "s" : ""} to context (${currentContextSize + fileCount}/${MAX_FILES} total)`;
      } else {
        message.textContent = `Drop files to add to context (${currentContextSize}/${MAX_FILES})`;
      }
    };
    let dragCounter = 0;
    container.addEventListener("dragenter", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter++;
      if (dragCounter === 1) {
        container.addClass("systemsculpt-drag-active");
        if (e.dataTransfer) {
          updateMessage(e.dataTransfer);
        }
      }
    });
    container.addEventListener("dragleave", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter--;
      if (dragCounter === 0) {
        container.removeClass("systemsculpt-drag-active");
      }
    });
    container.addEventListener("dragover", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (e.dataTransfer) {
        await updateMessage(e.dataTransfer);
      }
    });
    container.addEventListener("drop", async (e) => {
      var _a, _b, _c;
      e.preventDefault();
      e.stopPropagation();
      dragCounter = 0;
      container.removeClass("systemsculpt-drag-active");
      const dt = e.dataTransfer;
      if (!dt) {
        return;
      }
      const startingContextSize = this.contextManager.getContextFiles().size;
      if (startingContextSize >= MAX_FILES) {
        const { confirmed } = await showAlert(this.app, `Cannot add more files (max ${MAX_FILES} reached)`, {
          type: "info",
          icon: "alert-triangle"
        });
        return;
      }
      try {
        let filesToProcess = [];
        if (dt.items && dt.items.length > 0) {
          for (const item of Array.from(dt.items)) {
            if (item.type === "text/plain") {
              const text = await new Promise((resolve) => {
                item.getAsString(resolve);
              });
              const lines = text.split("\n").filter((line) => line.trim());
              for (const line of lines) {
                let filePath = line;
                let abstractFile = null;
                if (line.startsWith("obsidian://")) {
                  filePath = parseObsidianUri(line) || line;
                }
                abstractFile = this.app.vault.getAbstractFileByPath(filePath);
                if (abstractFile instanceof import_obsidian25.TFolder) {
                  filesToProcess.push(abstractFile);
                } else if (abstractFile instanceof import_obsidian25.TFile) {
                  const extension = abstractFile.extension.toLowerCase();
                  const requiresPro = [
                    "pdf",
                    "doc",
                    "docx",
                    "mp3",
                    "wav",
                    "m4a",
                    "ogg",
                    "webm"
                  ].includes(extension);
                  if (requiresPro && (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !this.plugin.settings.licenseValid)) {
                    await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                      title: "Pro Feature",
                      primaryButton: "Become a Patron",
                      secondaryButton: "Maybe Later"
                    }).then((result) => {
                      if (result == null ? void 0 : result.confirmed) {
                        window.open(PATREON_URL, "_blank");
                      }
                    });
                    return;
                  }
                  filesToProcess.push(abstractFile);
                } else if (!filePath.includes(".")) {
                  const mdPath = `${filePath}.md`;
                  const mdFile = this.app.vault.getAbstractFileByPath(mdPath);
                  if (mdFile instanceof import_obsidian25.TFile) {
                    filesToProcess.push(mdFile);
                  }
                }
              }
            }
          }
        }
        if (filesToProcess.length === 0 && dt.types.includes("text/uri-list")) {
          const uriData = await new Promise((resolve) => {
            dt.items[1].getAsString(resolve);
          });
          const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
          for (const uri of uris) {
            const filePath = parseObsidianUri(uri);
            if (!filePath)
              continue;
            let abstractFile = this.app.vault.getAbstractFileByPath(filePath);
            if (abstractFile instanceof import_obsidian25.TFile) {
              const extension = abstractFile.extension.toLowerCase();
              const requiresPro = [
                "pdf",
                "doc",
                "docx",
                "mp3",
                "wav",
                "m4a",
                "ogg",
                "webm"
              ].includes(extension);
              if (requiresPro && (!((_b = this.plugin.settings.licenseKey) == null ? void 0 : _b.trim()) || !this.plugin.settings.licenseValid)) {
                await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                  title: "Pro Feature",
                  primaryButton: "Become a Patron",
                  secondaryButton: "Maybe Later"
                }).then((result) => {
                  if (result == null ? void 0 : result.confirmed) {
                    window.open(PATREON_URL, "_blank");
                  }
                });
                return;
              }
            }
            if (abstractFile instanceof import_obsidian25.TFile || abstractFile instanceof import_obsidian25.TFolder) {
              filesToProcess.push(abstractFile);
            }
          }
        }
        let totalFilesAdded = 0;
        const remainingSlots = MAX_FILES - startingContextSize;
        for (const item of filesToProcess) {
          if (item instanceof import_obsidian25.TFolder) {
            const files = getFilesFromFolder(item);
            for (const file of files) {
              const currentContextSize = this.contextManager.getContextFiles().size;
              if (currentContextSize >= MAX_FILES) {
                const { confirmed } = await showAlert(this.app, `File limit reached (${MAX_FILES} total)`, {
                  type: "info",
                  icon: "alert-triangle"
                });
                return;
              }
              const extension = file.extension.toLowerCase();
              const requiresPro = [
                "pdf",
                "doc",
                "docx",
                "mp3",
                "wav",
                "m4a",
                "ogg",
                "webm"
              ].includes(extension);
              if (requiresPro && (!((_c = this.plugin.settings.licenseKey) == null ? void 0 : _c.trim()) || !this.plugin.settings.licenseValid)) {
                await showPopup(this.app, "Document processing is a Pro feature. Support SystemSculpt's development and unlock this feature by becoming a Patreon member!", {
                  title: "Pro Feature",
                  primaryButton: "Become a Patron",
                  secondaryButton: "Maybe Later"
                }).then((result) => {
                  if (result == null ? void 0 : result.confirmed) {
                    window.open(PATREON_URL, "_blank");
                  }
                });
                return;
              }
              try {
                await this.contextManager.addFileToContext(file);
                totalFilesAdded++;
                const updatedContextSize = this.contextManager.getContextFiles().size;
                showNotice(`Added ${file.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
              } catch (error) {
                console.error("[DragDrop] Error adding file from folder:", {
                  file: file.path,
                  error
                });
              }
            }
          } else if (item instanceof import_obsidian25.TFile) {
            const currentContextSize = this.contextManager.getContextFiles().size;
            if (currentContextSize >= MAX_FILES) {
              const { confirmed } = await showAlert(this.app, `File limit reached (${MAX_FILES} total)`, {
                type: "info",
                icon: "alert-triangle"
              });
              return;
            }
            await this.contextManager.addFileToContext(item);
            totalFilesAdded++;
            const updatedContextSize = this.contextManager.getContextFiles().size;
            showNotice(`Added ${item.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
          }
        }
      } catch (error) {
        console.error("[DragDrop] Error processing drop:", error);
        await showAlert(this.app, "Failed to process dropped files", {
          type: "error"
        });
      }
    });
  }
  getSelectedModelId() {
    return this.selectedModelId;
  }
  async setSelectedModelId(modelId) {
    this.selectedModelId = modelId;
    await this.updateModelIndicator();
    await this.saveChat();
    const models = await this.plugin.modelService.getModels();
    const selectedModel = models.find((model) => model.id === modelId);
    if (this.tokenLimitPercentage && (selectedModel == null ? void 0 : selectedModel.context_length)) {
      this.tokenLimit = Math.floor(this.tokenLimitPercentage / 100 * selectedModel.context_length);
      await this.saveChat();
    }
    this.inputHandler.onModelChange();
    this.focusInput();
  }
  async getMarkdown() {
    let chatContent = "";
    if (this.systemPromptType) {
      let systemPromptContent = "";
      if (this.systemPromptType === "custom" && this.systemPromptPath) {
        const file = this.app.vault.getAbstractFileByPath(this.systemPromptPath + ".md");
        if (file instanceof import_obsidian25.TFile) {
          systemPromptContent = await this.app.vault.read(file);
        }
      } else {
        const systemPromptService = new SystemPromptService(this.app);
        try {
          const preset = await systemPromptService.getSystemPromptById(this.systemPromptType);
          if (preset) {
            systemPromptContent = preset.systemPrompt;
          }
        } catch (error) {
          console.error("Failed to fetch system prompt:", error);
        }
      }
      if (systemPromptContent) {
        chatContent += `System Prompt:
"""""
${systemPromptContent}
"""""

`;
      }
    }
    const contextFiles = this.contextManager.getContextFiles();
    if (contextFiles.size > 0) {
      chatContent += "Context Files:\n\n";
      for (const filePath of contextFiles) {
        if (!filePath.startsWith("doc:")) {
          const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1").replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian25.TFile && !resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
            const content = await this.app.vault.read(resolvedFile);
            chatContent += `[${cleanPath}]
"""""
${content}
"""""

`;
          }
        }
      }
    }
    chatContent += "Chat History Thus Far:\n\n";
    for (const message of this.messages) {
      const role = message.role === "assistant" ? "A" : "User";
      if (typeof message.content === "string") {
        chatContent += `${role}:
"""""
${message.content}
"""""

`;
      }
    }
    return chatContent;
  }
};

// src/services/RecorderService.ts
var RECORDING_FORMATS = [
  { mimeType: "audio/webm;codecs=opus", extension: "webm", sampleRate: 16e3 },
  { mimeType: "audio/webm", extension: "webm", sampleRate: 48e3 },
  { mimeType: "audio/ogg;codecs=opus", extension: "ogg", sampleRate: 48e3 },
  { mimeType: "audio/wav", extension: "wav", sampleRate: 48e3 }
];
var RecorderService = class {
  constructor(app, plugin, options = {}) {
    this.isRecording = false;
    this.onToggleCallbacks = new Set();
    this.mediaStream = null;
    this.mediaRecorder = null;
    this.chunks = [];
    this.selectedFormat = null;
    this.lastRecordedFilePath = null;
    this.audioContext = null;
    this.analyser = null;
    this.animationFrame = null;
    this.smoothingFactor = 0.4;
    this.visualizerCanvas = null;
    this.currentContext = null;
    this.recordingModal = null;
    this.dragCleanup = null;
    this.editorHandler = null;
    this.draw = () => {
      if (!this.isRecording || !this.analyser || !this.visualizerCanvas) {
        if (this.animationFrame) {
          cancelAnimationFrame(this.animationFrame);
          this.animationFrame = null;
        }
        return;
      }
      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
        this.animationFrame = null;
      }
      const bufferLength = this.analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      this.analyser.getByteFrequencyData(dataArray);
      const ctx = this.visualizerCanvas.getContext("2d");
      if (!ctx)
        return;
      ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      const rect = this.visualizerCanvas.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      const centerY = height / 2;
      const centerX = width / 2;
      const isMobile = width <= 400;
      const overlap = isMobile ? 3 : 5;
      const centerOverlapScale = isMobile ? 4 : 8;
      const amplitudeScale = isMobile ? 0.8 : 0.95;
      const edgeZoneScale = isMobile ? 0.15 : 0.2;
      const computedStyle = getComputedStyle(document.documentElement);
      let accentColor = computedStyle.getPropertyValue("--text-accent").trim();
      if (!accentColor) {
        accentColor = "#5871ef";
      }
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, accentColor);
      gradient.addColorStop(0.5, accentColor);
      gradient.addColorStop(1, accentColor);
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      const halfBufferLength = Math.floor(bufferLength / 2);
      const sliceWidth = width / 2 / halfBufferLength;
      const centerOverlap = sliceWidth * centerOverlapScale;
      const getEdgeTaper = (i, total) => {
        const edgeZone = total * edgeZoneScale;
        if (i < edgeZone) {
          return 0.3 + 0.7 * (i / edgeZone);
        } else if (i > total - edgeZone) {
          return 0.3 + 0.7 * ((total - i) / edgeZone);
        }
        return 1;
      };
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const value = dataArray[Math.abs(i)] / 255;
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        this.smoothedValues[index] = this.smoothedValues[index] * this.smoothingFactor + value * (1 - this.smoothingFactor);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      if (this.isRecording) {
        this.animationFrame = requestAnimationFrame(this.draw);
      }
    };
    this.app = app;
    this.plugin = plugin;
    this.smoothedValues = new Float32Array(128);
    this.updateContext(options);
    console.log("RecorderService initialized");
  }
  static getInstance(app, plugin, options = {}) {
    if (!RecorderService.instance) {
      console.log("Creating new RecorderService instance");
      RecorderService.instance = new RecorderService(app, plugin);
    }
    RecorderService.instance.updateContext(options);
    return RecorderService.instance;
  }
  getActiveViewInfo() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      return { isChat: false, viewIdentifier: "unknown" };
    }
    const viewState = activeLeaf.getViewState();
    const viewType = viewState.type;
    if (viewType === CHAT_VIEW_TYPE) {
      return { isChat: true, viewIdentifier: "chat" };
    }
    const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian26.MarkdownView);
    if (markdownView == null ? void 0 : markdownView.file) {
      return {
        isChat: false,
        viewIdentifier: `note-${markdownView.file.path}`
      };
    }
    return { isChat: false, viewIdentifier: "unknown" };
  }
  updateContext(options) {
    const { isChat } = this.getActiveViewInfo();
    this.currentContext = {
      isInChat: isChat,
      onTranscriptionComplete: options.onTranscriptionComplete
    };
  }
  insertTextIntoActiveView(text) {
    const { isChat } = this.getActiveViewInfo();
    if (isChat) {
      const chatView = this.app.workspace.getActiveViewOfType(ChatView);
      if (chatView) {
        const input = chatView.containerEl.querySelector(".systemsculpt-chat-input");
        if (input) {
          const cursorPos = input.selectionStart;
          const currentValue = input.value;
          if (cursorPos !== null) {
            const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
            input.value = newValue;
            input.selectionStart = input.selectionEnd = cursorPos + text.length;
          } else {
            input.value = currentValue + text;
            input.selectionStart = input.selectionEnd = input.value.length;
          }
          input.dispatchEvent(new Event("input"));
          input.focus();
          new import_obsidian26.Notice("\u2728 Transcription pasted into chat");
        } else {
          console.warn("Chat input element not found");
          new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no chat input)");
        }
      } else {
        console.warn("No active chat view found");
        new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no active chat)");
      }
    } else {
      const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian26.MarkdownView);
      if (!(markdownView == null ? void 0 : markdownView.editor)) {
        console.warn("No active markdown editor found");
        new import_obsidian26.Notice("\u2728 Transcription copied to clipboard (no active note)");
        return;
      }
      const editor = markdownView.editor;
      const cursor = editor.getCursor();
      const lineContent = editor.getLine(cursor.line);
      const textToInsert = text ? cursor.ch > 0 && lineContent.length > 0 ? "\n" + text : text : "";
      if (!textToInsert) {
        console.warn("No text to insert");
        return;
      }
      editor.replaceRange(textToInsert, cursor);
      const lines = textToInsert.split("\n");
      const lastLine = lines[lines.length - 1] || "";
      editor.setCursor({
        line: cursor.line + lines.length - 1,
        ch: lastLine.length
      });
      new import_obsidian26.Notice("\u2728 Transcription pasted into note");
    }
  }
  async transcribeLastRecording() {
    var _a, _b;
    if (!this.lastRecordedFilePath)
      return;
    try {
      const file = this.plugin.app.vault.getAbstractFileByPath(this.lastRecordedFilePath);
      if (!file || !(file instanceof import_obsidian26.TFile))
        return;
      const modal = new AudioTranscriptionModal(this.app, {
        file,
        isChat: (_b = (_a = this.currentContext) == null ? void 0 : _a.isInChat) != null ? _b : false,
        onTranscriptionComplete: (text) => {
          var _a2;
          if ((_a2 = this.currentContext) == null ? void 0 : _a2.onTranscriptionComplete) {
            this.currentContext.onTranscriptionComplete(text);
          } else {
            this.insertTextIntoActiveView(text);
          }
        },
        plugin: this.plugin
      });
      modal.open();
      try {
        await this.plugin.app.vault.delete(file);
      } catch (error) {
        console.warn("Failed to clean up recording file:", error);
      }
    } catch (error) {
      console.error("Auto-transcription failed:", error);
      new import_obsidian26.Notice("\u274C Failed to transcribe audio");
      throw error;
    }
  }
  createRecordingModal() {
    if (this.recordingModal) {
      if (this.dragCleanup) {
        this.dragCleanup();
        this.dragCleanup = null;
      }
      this.recordingModal.remove();
      this.recordingModal = null;
    }
    this.recordingModal = document.createElement("div");
    this.recordingModal.className = "systemsculpt-recorder-modal";
    const content = document.createElement("div");
    content.className = "systemsculpt-recorder-content";
    const liveIndicator = document.createElement("div");
    liveIndicator.className = "systemsculpt-recorder-live";
    liveIndicator.textContent = "\u25CF Live";
    content.appendChild(liveIndicator);
    const canvas = document.createElement("canvas");
    canvas.className = "systemsculpt-recorder-canvas";
    content.appendChild(canvas);
    this.recordingModal.appendChild(content);
    document.body.appendChild(this.recordingModal);
    this.dragCleanup = this.setupDraggable(this.recordingModal);
    this.setVisualizerCanvas(canvas);
  }
  setupDraggable(element) {
    let pos = { x: 0, y: 0 };
    const cleanup = () => {
      element.classList.remove("dragging");
    };
    const onMove = (clientX, clientY) => {
      const rect = element.getBoundingClientRect();
      pos.x = Math.min(Math.max(0, clientX - rect.width / 2), window.innerWidth - rect.width);
      pos.y = Math.min(Math.max(0, clientY - rect.height / 2), window.innerHeight - rect.height);
      element.style.bottom = "";
      element.style.right = "";
      element.style.left = `${pos.x}px`;
      element.style.top = `${pos.y}px`;
    };
    const onPointerDown = (e) => {
      if (e.button !== 0 && e.button !== -1)
        return;
      element.classList.add("dragging");
      element.setPointerCapture(e.pointerId);
      const rect = element.getBoundingClientRect();
      pos.x = rect.left;
      pos.y = rect.top;
      onMove(e.clientX, e.clientY);
    };
    const onPointerMove = (e) => {
      if (element.hasPointerCapture(e.pointerId)) {
        onMove(e.clientX, e.clientY);
      }
    };
    const onPointerUp = (e) => {
      cleanup();
      element.releasePointerCapture(e.pointerId);
    };
    element.addEventListener("pointerdown", onPointerDown);
    element.addEventListener("pointermove", onPointerMove);
    element.addEventListener("pointerup", onPointerUp);
    element.addEventListener("pointercancel", cleanup);
    return () => {
      element.removeEventListener("pointerdown", onPointerDown);
      element.removeEventListener("pointermove", onPointerMove);
      element.removeEventListener("pointerup", onPointerUp);
      element.removeEventListener("pointercancel", cleanup);
    };
  }
  async toggleRecording() {
    try {
      if (!this.isRecording) {
        const { isChat, viewIdentifier } = this.getActiveViewInfo();
        if (viewIdentifier === "unknown") {
          new import_obsidian26.Notice("\u26A0\uFE0F Please open a note or chat before recording");
          return;
        }
        console.log("Starting recording in view:", {
          isChat,
          viewIdentifier
        });
        this.updateContext({
          isInChat: isChat
        });
        this.createRecordingModal();
      }
      if (this.isRecording) {
        await this.stopRecording();
        if (this.recordingModal) {
          if (this.dragCleanup) {
            this.dragCleanup();
            this.dragCleanup = null;
          }
          this.recordingModal.remove();
          this.recordingModal = null;
        }
      } else {
        await this.startRecording();
        if (this.recordingModal) {
          this.recordingModal.classList.add("recording");
        }
      }
    } catch (error) {
      console.error("Error toggling recording:", error);
      new import_obsidian26.Notice("\u274C Failed to toggle recording");
    }
  }
  async ensureRecordingDirectory() {
    const dir = this.plugin.settings.recordingsDirectory;
    try {
      await this.plugin.app.vault.adapter.mkdir(dir);
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : "Unknown error";
      console.error("Failed to create recordings directory:", errorMessage);
      throw new Error(`Failed to create recordings directory: ${errorMessage}`);
    }
  }
  async detectSupportedFormat() {
    for (const format of RECORDING_FORMATS) {
      try {
        if (MediaRecorder.isTypeSupported(format.mimeType)) {
          console.log(`Selected recording format: ${format.mimeType}`);
          return format;
        }
      } catch (error) {
        console.warn(`Format ${format.mimeType} check failed:`, error);
      }
    }
    throw new Error("No supported audio recording format found");
  }
  generateFileName() {
    var _a;
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-").replace("T", "_").split(".")[0];
    return `${timestamp}.${((_a = this.selectedFormat) == null ? void 0 : _a.extension) || "audio"}`;
  }
  resetVisualizationState() {
    this.smoothedValues = new Float32Array(128);
    if (this.animationFrame) {
      cancelAnimationFrame(this.animationFrame);
      this.animationFrame = null;
    }
    if (this.analyser) {
      this.analyser.disconnect();
      this.analyser = null;
    }
    if (this.audioContext) {
      this.audioContext.close();
      this.audioContext = null;
    }
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
  }
  setupVisualization() {
    if (!this.mediaStream)
      return;
    this.audioContext = new AudioContext({
      sampleRate: 16e3,
      latencyHint: "interactive"
    });
    const source = this.audioContext.createMediaStreamSource(this.mediaStream);
    this.analyser = this.audioContext.createAnalyser();
    this.analyser.fftSize = 256;
    this.analyser.smoothingTimeConstant = 0.7;
    source.connect(this.analyser);
    if (this.visualizerCanvas) {
      this.updateCanvasSize();
      this.draw();
    }
  }
  setVisualizerCanvas(canvas) {
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
    if (!canvas) {
      this.resetVisualizationState();
    }
    this.visualizerCanvas = canvas;
    if (canvas && this.isRecording) {
      this.updateCanvasSize();
      if (!this.audioContext || !this.analyser) {
        this.setupVisualization();
      } else {
        this.draw();
      }
    }
  }
  updateCanvasSize() {
    if (!this.visualizerCanvas)
      return;
    const rect = this.visualizerCanvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    this.visualizerCanvas.width = rect.width * dpr;
    this.visualizerCanvas.height = rect.height * dpr;
    const ctx = this.visualizerCanvas.getContext("2d");
    if (ctx) {
      ctx.scale(dpr, dpr);
    }
  }
  async startRecording() {
    if (this.isRecording)
      return;
    this.resetVisualizationState();
    try {
      await this.ensureRecordingDirectory();
      const permissionResult = await navigator.permissions.query({
        name: "microphone"
      });
      if (permissionResult.state === "denied") {
        throw new Error("Microphone permission denied");
      }
      this.selectedFormat = await this.detectSupportedFormat();
      const audioConstraints = {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 16e3,
        channelCount: 1
      };
      if (this.plugin.settings.preferredMicrophoneId) {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const preferredDevice = devices.find((device) => device.kind === "audioinput" && device.deviceId === this.plugin.settings.preferredMicrophoneId);
          if (preferredDevice) {
            audioConstraints.deviceId = {
              exact: this.plugin.settings.preferredMicrophoneId
            };
          } else {
            this.plugin.settings.preferredMicrophoneId = "";
            await this.plugin.saveSettings();
            console.log("Preferred microphone not found, falling back to default");
          }
        } catch (error) {
          console.error("Error checking microphone devices:", error);
        }
      }
      this.mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: audioConstraints
      });
      this.mediaRecorder = new MediaRecorder(this.mediaStream, {
        mimeType: this.selectedFormat.mimeType
      });
      this.chunks = [];
      this.mediaRecorder.ondataavailable = async (e) => {
        var _a, _b;
        if (e.data.size > 0) {
          this.chunks.push({
            blob: e.data,
            sampleRate: (_b = (_a = this.selectedFormat) == null ? void 0 : _a.sampleRate) != null ? _b : 48e3
          });
        }
      };
      this.mediaRecorder.onstop = async () => {
        var _a;
        try {
          const fileName = this.generateFileName();
          const filePath = `${this.plugin.settings.recordingsDirectory}/${fileName}`;
          const blob = new Blob(this.chunks.map((chunk) => chunk.blob), { type: (_a = this.selectedFormat) == null ? void 0 : _a.mimeType });
          const arrayBuffer = await blob.arrayBuffer();
          await this.plugin.app.vault.adapter.writeBinary(filePath, arrayBuffer);
          this.lastRecordedFilePath = filePath;
          await this.transcribeLastRecording();
        } catch (error) {
          console.error("Failed to save recording:", error);
          new import_obsidian26.Notice("\u274C Failed to save recording");
        }
      };
      this.mediaRecorder.start(1e3);
      this.setupVisualization();
      this.isRecording = true;
      this.notifyListeners();
      if (this.visualizerCanvas) {
        this.draw();
      }
    } catch (error) {
      console.error("Recording error:", error);
      const errorMessage = error instanceof Error ? error.message : "Recording failed";
      throw error;
    }
  }
  async stopRecording() {
    if (!this.isRecording)
      return;
    if (this.mediaRecorder && this.mediaRecorder.state !== "inactive") {
      this.mediaRecorder.stop();
    }
    if (this.mediaStream) {
      this.mediaStream.getTracks().forEach((track) => track.stop());
      this.mediaStream = null;
    }
    this.resetVisualizationState();
    if (this.recordingModal) {
      this.recordingModal.classList.remove("recording");
    }
    this.mediaRecorder = null;
    this.isRecording = false;
    this.notifyListeners();
  }
  onToggle(callback) {
    this.onToggleCallbacks.add(callback);
  }
  notifyListeners() {
    this.onToggleCallbacks.forEach((cb) => cb(this.isRecording));
  }
  unload() {
    this.stopRecording();
    this.onToggleCallbacks.clear();
  }
};

// src/components/SystemSculptContextMenu.ts
var import_obsidian27 = __toModule(require("obsidian"));
init_api();
var SystemSculptContextMenu = class {
  constructor(app, sculptService, plugin) {
    this.statusBarItem = null;
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
    this.app = app;
    this.sculptService = sculptService;
    this.plugin = plugin;
    this.transcriptionService = TranscriptionService.getInstance(plugin);
    this.registerContextMenu();
    this.initializeStatusBar();
  }
  initializeStatusBar() {
    this.statusBarItem = this.app.workspace.containerEl.createDiv({
      cls: "systemsculpt-status-bar"
    });
    this.statusBarItem.style.display = "none";
  }
  registerContextMenu() {
    this.app.workspace.on("editor-menu", (menu, editor, view) => {
      if (!(view instanceof import_obsidian27.MarkdownView))
        return;
      const selection = editor.getSelection();
      if (!selection)
        return;
    });
    this.app.workspace.on("file-menu", (menu, file) => {
      if (!(file instanceof import_obsidian27.TFile))
        return;
      const extension = file.extension.toLowerCase();
      if (["md", "txt", "markdown"].includes(extension) || ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"].includes(extension) || ["mp3", "wav", "m4a", "ogg", "webm"].includes(extension) || ["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Chat with File").setIcon("message-square").onClick(async () => {
            try {
              const leaf = this.app.workspace.getLeaf("tab");
              const view = new ChatView(leaf, this.plugin);
              await leaf.open(view);
              await new Promise((resolve) => setTimeout(resolve, 50));
              this.app.workspace.setActiveLeaf(leaf, { focus: true });
              await view.addFileToContext(file);
            } catch (error) {
              new import_obsidian27.Notice("Failed to open chat with file");
              console.error("Chat open error:", error);
            }
          });
        });
      }
      if (file.extension === "mp3" || file.extension === "wav" || file.extension === "webm") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio").setIcon("microphone").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, false);
            } catch (error) {
              new import_obsidian27.Notice("Failed to transcribe audio file");
              console.error("Transcription error:", error);
            }
          });
        });
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio (Timestamped)").setIcon("clock").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, true);
            } catch (error) {
              new import_obsidian27.Notice("Failed to transcribe audio file with timestamps");
              console.error("Timestamped transcription error:", error);
            }
          });
        });
      }
      if (file.extension === "pdf" || file.extension === "docx" || file.extension === "doc") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Convert to Markdown").setIcon("file-text").onClick(async () => {
            try {
              await this.handleDocumentConversion(file);
            } catch (error) {
              new import_obsidian27.Notice("Failed to convert document");
              console.error("Document conversion error:", error);
            }
          });
        });
      }
    });
  }
  async handleDocumentConversion(file) {
    this.createProgressModal();
    this.updateProgressModal(0, "Processing your document...", "loader-2");
    try {
      await this.sleep(1e3);
      this.updateProgressModal(10, "Uploading document...", "upload");
      const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
      if (cached) {
        this.updateProgressModal(50, "Found cached version", "check");
        const extractionData2 = await this.downloadExtraction(documentId);
        const extractionPath2 = await this.saveExtractionResults(file, extractionData2);
        this.updateProgressModal(100, "Processing complete!", "check-circle");
        this.showCompletionButtons(extractionPath2);
        return;
      }
      this.updateProgressModal(30, "Processing document...", "loader-2");
      const pollResult = await this.pollUntilComplete(documentId);
      if (!pollResult) {
        this.updateProgressModal(0, "Processing incomplete", "alert-circle");
        await this.sleep(3e3);
        this.closeProgressModal();
        return;
      }
      this.updateProgressModal(80, "Downloading results...", "download");
      const extractionData = await this.downloadExtraction(documentId);
      const extractionPath = await this.saveExtractionResults(file, extractionData);
      this.updateProgressModal(100, "Processing complete!", "check-circle");
      this.showCompletionButtons(extractionPath);
    } catch (e) {
      console.error("SystemSculpt error", e);
      this.updateProgressModal(0, `Error: ${e instanceof Error ? e.message : String(e)}`, "x-circle");
      await this.sleep(5e3);
      this.closeProgressModal();
    }
  }
  async handleAudioTranscription(file, timestamped) {
    try {
      await showAudioTranscriptionModal(this.app, {
        file,
        timestamped,
        plugin: this.plugin,
        onTranscriptionComplete: async (text) => {
          var _a;
          const baseName = file.basename;
          const fileExtension = timestamped ? "srt" : "md";
          const outputPath = `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}.${fileExtension}`;
          const content = timestamped ? text : text;
          let transcriptionFile;
          const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
          if (existingFile instanceof import_obsidian27.TFile) {
            await this.app.vault.modify(existingFile, content);
            transcriptionFile = existingFile;
          } else {
            transcriptionFile = await this.app.vault.create(outputPath, content);
          }
          const leaf = this.app.workspace.getLeaf("tab");
          await leaf.openFile(transcriptionFile);
          this.app.workspace.setActiveLeaf(leaf, { focus: true });
        }
      });
    } catch (error) {
      console.error("Audio transcription error:", error);
      throw error;
    }
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  createProgressModal() {
    if (this.progressModal)
      return;
    this.progressModal = document.createElement("div");
    this.progressModal.className = "systemsculpt-progress-modal";
    this.progressBar = this.progressModal.createDiv("systemsculpt-progress-bar");
    this.progressStatus = this.progressModal.createDiv("systemsculpt-progress-status");
    this.progressButtons = this.progressModal.createDiv("systemsculpt-progress-buttons");
    document.body.appendChild(this.progressModal);
  }
  updateProgressModal(progress, status, icon) {
    if (!this.progressModal || !this.progressBar || !this.progressStatus)
      return;
    this.progressBar.style.width = `${progress}%`;
    this.progressStatus.empty();
    (0, import_obsidian27.setIcon)(this.progressStatus, icon);
    this.progressStatus.createSpan({ text: status });
  }
  showCompletionButtons(extractionPath) {
    if (!this.progressButtons)
      return;
    this.progressButtons.empty();
    const viewButton = this.progressButtons.createEl("button", {
      text: "View Result",
      cls: "mod-cta"
    });
    viewButton.addEventListener("click", async () => {
      const file = this.app.vault.getAbstractFileByPath(extractionPath);
      if (file instanceof import_obsidian27.TFile) {
        await this.app.workspace.getLeaf().openFile(file);
      }
      this.closeProgressModal();
    });
    const closeButton = this.progressButtons.createEl("button", {
      text: "Close"
    });
    closeButton.addEventListener("click", () => {
      this.closeProgressModal();
    });
  }
  closeProgressModal() {
    if (this.progressModal && this.progressModal.parentNode) {
      this.progressModal.parentNode.removeChild(this.progressModal);
    }
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
  }
  async pollUntilComplete(documentId, maxAttempts = 30) {
    for (let i = 0; i < maxAttempts; i++) {
      const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.GET(documentId)}`, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      if (!response.ok) {
        throw new Error(`Failed to check status: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === "completed") {
        return true;
      } else if (data.status === "failed") {
        throw new Error(data.error || "Processing failed");
      }
      const progress = Math.min(30 + i / maxAttempts * 50, 80);
      this.updateProgressModal(progress, "Processing document...", "loader-2");
      await this.sleep(2e3);
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.DOWNLOAD(documentId)}`, {
      headers: {
        "Content-Type": "application/json"
      }
    });
    if (!response.ok) {
      throw new Error(`Failed to download extraction: ${response.statusText}`);
    }
    return response.json();
  }
  async saveExtractionResults(file, data) {
    var _a;
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = this.sanitizeFilename(file.basename);
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}`;
    await this.createFolder(parentPath);
    const extractionPath = this.normalizePath(`${parentPath}/${baseName}-extraction.md`);
    const content = this.formatExtractionContent(data);
    const existingFile = this.app.vault.getAbstractFileByPath(extractionPath);
    if (existingFile instanceof import_obsidian27.TFile) {
      await this.app.vault.modify(existingFile, content);
    } else {
      await this.app.vault.create(extractionPath, content);
    }
    return extractionPath;
  }
  sanitizeFilename(filename) {
    return filename.replace(/[^a-zA-Z0-9-_ ]/g, "");
  }
  normalizePath(path) {
    return path.replace(/\\/g, "/").replace(/\/+/g, "/");
  }
  async createFolder(path) {
    const normalizedPath = this.normalizePath(path);
    if (!(this.app.vault.getAbstractFileByPath(normalizedPath) instanceof import_obsidian27.TFolder)) {
      await this.app.vault.createFolder(normalizedPath);
    }
  }
  formatExtractionContent(data) {
    return `# ${data.title || "Document Extraction"}

${data.content || ""}

---
Extracted with SystemSculpt
`;
  }
};

// src/core/settings/SettingsManager.ts
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.settings = DEFAULT_SETTINGS;
  }
  async loadSettings() {
    const loadedData = await this.plugin.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
    if (this.settings.developmentMode) {
      this.settings.serverUrl = "http://localhost:3001";
    } else {
      this.settings.serverUrl = "https://api.systemsculpt.com";
    }
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
    this.plugin.aiService.updateSettings(this.settings);
  }
  getSettings() {
    return this.settings;
  }
  async updateSettings(newSettings) {
    if (newSettings === DEFAULT_SETTINGS) {
      this.settings = { ...DEFAULT_SETTINGS };
      await this.saveSettings();
      return;
    }
    if (newSettings.developmentMode !== void 0) {
      newSettings.serverUrl = newSettings.developmentMode ? "http://localhost:3001" : "https://api.systemsculpt.com";
    }
    this.settings = { ...this.settings, ...newSettings };
    await this.saveSettings();
  }
};

// src/core/license/LicenseManager.ts
init_ui();
var LicenseManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  async initializeLicense() {
    var _a;
    if ((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) {
      await this.validateLicenseKey(true, false);
    }
  }
  async validateLicenseKey(force = false, showReloadPrompt = true) {
    if (!this.plugin.settings.licenseKey) {
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
    try {
      const isValid = await this.plugin.aiService.validateLicense(force);
      this.plugin.settings.licenseValid = isValid;
      await this.plugin.saveSettings();
      if (isValid && showReloadPrompt) {
        const result = await showPopup(this.app, "Pro features have been successfully activated! To ensure all features work properly, Obsidian needs to be reloaded.", {
          title: "Reload to Complete Upgrade",
          description: "Click the button below to reload Obsidian and start using your Pro features.",
          primaryButton: "Reload & Upgrade",
          icon: "sparkles"
        });
        if (result == null ? void 0 : result.confirmed) {
          window.location.reload();
        }
      }
      return isValid;
    } catch (error) {
      console.error("License validation error:", error);
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
  }
};

// src/modals/JanitorModal.ts
var import_obsidian28 = __toModule(require("obsidian"));
init_ui();
var JanitorModal = class extends import_obsidian28.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  calculateSize(files) {
    const totalBytes = files.reduce((acc, file) => acc + file.stat.size, 0);
    if (totalBytes === 0) {
      return "empty";
    } else if (totalBytes < 1024) {
      return `${totalBytes} bytes`;
    } else if (totalBytes < 1024 * 1024) {
      return `${(totalBytes / 1024).toFixed(1)} KB`;
    } else if (totalBytes < 1024 * 1024 * 1024) {
      return `${(totalBytes / (1024 * 1024)).toFixed(1)} MB`;
    } else {
      return `${(totalBytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;
    }
  }
  getFilesInDirectory(directory) {
    return this.app.vault.getFiles().filter((file) => file.path.startsWith(directory));
  }
  disableButton(button) {
    button.disabled = true;
    button.addClass("mod-disabled");
    button.removeClass("mod-warning");
  }
  updateButtonState(button, files, type) {
    const size = this.calculateSize(files);
    const hasFiles = files.length > 0;
    if (hasFiles) {
      button.disabled = false;
      button.removeClass("mod-disabled");
      button.addClass("mod-warning");
      button.setText(`Clear All ${type} (${size})`);
    } else {
      button.disabled = true;
      button.addClass("mod-disabled");
      button.removeClass("mod-warning");
      button.setText(`No ${type}`);
    }
  }
  async cleanDirectory(directory) {
    if (!directory || directory === "/" || directory === "." || directory === "..") {
      throw new Error("Cannot delete root or system directories");
    }
    const files = this.getFilesInDirectory(directory);
    for (const file of files) {
      await this.app.vault.trash(file, true);
    }
    const folder = this.app.vault.getAbstractFileByPath(directory);
    if (folder instanceof import_obsidian28.TFolder) {
      const subdirs = folder.children.filter((child) => child instanceof import_obsidian28.TFolder).sort((a, b) => b.path.length - a.path.length);
      for (const subdir of subdirs) {
        if (subdir.children.length === 0) {
          await this.app.vault.trash(subdir, true);
        }
      }
      if (folder.children.length === 0) {
        await this.app.vault.trash(folder, true);
      }
    }
  }
  showFilePreview(files, type) {
    var _a, _b;
    const container = document.createElement("div");
    container.className = "systemsculpt-file-tree nav-folder";
    const summary = document.createElement("div");
    summary.className = "nav-folder-title";
    summary.textContent = `${files.length} ${type} (${this.calculateSize(files)})`;
    container.appendChild(summary);
    const sortedFiles = files.sort((a, b) => a.path.localeCompare(b.path));
    const filesByDir = new Map();
    for (const file of sortedFiles) {
      const dir = ((_a = file.parent) == null ? void 0 : _a.path) || "";
      if (!filesByDir.has(dir)) {
        filesByDir.set(dir, []);
      }
      (_b = filesByDir.get(dir)) == null ? void 0 : _b.push(file);
    }
    for (const [dir, dirFiles] of filesByDir) {
      if (dir) {
        const folderDiv = document.createElement("div");
        folderDiv.className = "nav-folder";
        const folderTitle = document.createElement("div");
        folderTitle.className = "nav-folder-title";
        (0, import_obsidian28.setIcon)(folderTitle, "folder");
        folderTitle.createSpan({ text: dir });
        folderDiv.appendChild(folderTitle);
        const folderContent = document.createElement("div");
        folderContent.className = "nav-folder-children";
        folderDiv.appendChild(folderContent);
        for (const file of dirFiles) {
          folderContent.appendChild(this.createFileItem(file));
        }
        container.appendChild(folderDiv);
      } else {
        for (const file of dirFiles) {
          container.appendChild(this.createFileItem(file));
        }
      }
    }
    return container;
  }
  createFileItem(file) {
    const fileDiv = document.createElement("div");
    fileDiv.className = "nav-file";
    const fileTitle = document.createElement("div");
    fileTitle.className = "nav-file-title";
    const extension = file.extension.toLowerCase();
    let iconName = "file";
    if (["md", "txt", "markdown"].includes(extension)) {
      iconName = "file-text";
    } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
      iconName = "image";
    } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
      iconName = "audio-lines";
    } else if (["pdf"].includes(extension)) {
      iconName = "file-text";
    }
    (0, import_obsidian28.setIcon)(fileTitle, iconName);
    fileTitle.createSpan({ text: file.name });
    const sizeSpan = document.createElement("span");
    sizeSpan.className = "nav-file-size";
    sizeSpan.textContent = this.calculateSize([file]);
    fileTitle.appendChild(sizeSpan);
    fileDiv.appendChild(fileTitle);
    return fileDiv;
  }
  async showConfirmationDialog(files, type, directory, button) {
    const confirmModal = new import_obsidian28.Modal(this.app);
    confirmModal.titleEl.setText(`Clear ${type}`);
    const content = confirmModal.contentEl;
    content.createDiv({
      cls: "systemsculpt-modal-description",
      text: `\u26A0\uFE0F WARNING: The following files will be moved to the Obsidian trash. You can restore them from the trash if needed.`
    });
    content.appendChild(this.showFilePreview(files, type));
    const buttonContainer = content.createDiv({
      cls: "systemsculpt-modal-buttons"
    });
    const cancelButton = buttonContainer.createEl("button", { text: "Cancel" });
    cancelButton.addEventListener("click", () => confirmModal.close());
    const confirmButton = buttonContainer.createEl("button", {
      cls: "mod-warning",
      text: "Move to Trash"
    });
    confirmButton.addEventListener("click", async () => {
      try {
        await this.cleanDirectory(directory);
        this.disableButton(button);
        button.setText(`No ${type}`);
        showPopup(this.app, `Successfully moved ${files.length} ${type.toLowerCase()} files (${this.calculateSize(files)}) to trash`, { title: "Success" });
      } catch (error) {
        console.error(`Error clearing ${type.toLowerCase()}:`, error);
        showPopup(this.app, `Failed to clear ${type.toLowerCase()}`, {
          title: "Error"
        });
      }
      confirmModal.close();
    });
    confirmModal.open();
  }
  async isEmptyFile(file) {
    if (file.stat.size === 0)
      return true;
    const extension = file.extension.toLowerCase();
    if (["md", "txt", "markdown"].includes(extension)) {
      const content = await this.app.vault.read(file);
      const contentWithoutFrontmatter = content.replace(/^---[\s\S]*?---/, "").trim();
      return !contentWithoutFrontmatter;
    }
    if ([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp",
      "svg",
      "mp3",
      "wav",
      "ogg",
      "m4a"
    ].includes(extension)) {
      return file.stat.size === 0;
    }
    if (file.path.includes("/Extractions/")) {
      const content = await this.app.vault.read(file);
      const hasOnlyHeaders = !content.replace(/^#.*$/gm, "").trim();
      const hasErrorMessage = content.includes("Error extracting") || content.includes("Processing failed");
      return hasOnlyHeaders || hasErrorMessage;
    }
    return false;
  }
  async getEmptyFiles() {
    const allFiles = this.app.vault.getFiles();
    const emptyFiles = [];
    for (const file of allFiles) {
      if (await this.isEmptyFile(file)) {
        emptyFiles.push(file);
      }
    }
    return emptyFiles;
  }
  async getEmptyFolders() {
    const emptyFolders = [];
    const checkFolder = (folder) => {
      const hasNonEmptyChildren = folder.children.some((child) => {
        if (child instanceof import_obsidian28.TFile) {
          return child.stat.size > 0;
        }
        if (child instanceof import_obsidian28.TFolder) {
          return !checkFolder(child);
        }
        return false;
      });
      if (!hasNonEmptyChildren) {
        emptyFolders.push(folder);
        return true;
      }
      return false;
    };
    const rootFolder = this.app.vault.getRoot();
    for (const child of rootFolder.children) {
      if (child instanceof import_obsidian28.TFolder) {
        checkFolder(child);
      }
    }
    return emptyFolders;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-janitor-modal");
    const titleEl = contentEl.createDiv({ cls: "systemsculpt-modal-title" });
    titleEl.setText("SystemSculpt Janitor");
    const descriptionEl = titleEl.createDiv({
      cls: "systemsculpt-modal-description"
    });
    descriptionEl.setText("Clean up and optimize your SystemSculpt workspace");
    const mainContent = contentEl.createDiv({
      cls: "systemsculpt-janitor-content"
    });
    const sectionsContainer = mainContent.createDiv({
      cls: "systemsculpt-sections-container"
    });
    this.createEmptyContentSection(sectionsContainer);
    this.createChatHistorySection(sectionsContainer);
    this.createExtractionsSection(sectionsContainer);
    this.createRecordingsSection(sectionsContainer);
  }
  async createEmptyContentSection(container) {
    const emptySection = this.createSection(container, "Empty Content", "Clean up empty files and folders");
    const emptyFiles = await this.getEmptyFiles();
    const emptyFolders = await this.getEmptyFolders();
    const totalEmpty = emptyFiles.length + emptyFolders.length;
    const clearEmptyButton = emptySection.createEl("button", {
      cls: "systemsculpt-button",
      text: totalEmpty > 0 ? `Clear Empty Content (${totalEmpty} items)` : "No Empty Content"
    });
    this.updateButtonState(clearEmptyButton, emptyFiles, "Empty Content");
    if (totalEmpty > 0) {
      clearEmptyButton.addEventListener("click", async () => {
        if (clearEmptyButton.disabled)
          return;
        const confirmModal = new import_obsidian28.Modal(this.app);
        confirmModal.titleEl.setText("Clear Empty Content");
        const content = confirmModal.contentEl;
        content.createDiv({
          cls: "systemsculpt-modal-description",
          text: `\u26A0\uFE0F WARNING: The following empty items will be moved to the Obsidian trash. You can restore them from the trash if needed.`
        });
        if (emptyFiles.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Files"
          });
          content.appendChild(this.showFilePreview(emptyFiles, "Empty Files"));
        }
        if (emptyFolders.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Folders"
          });
          const folderList = content.createDiv({
            cls: "systemsculpt-file-tree nav-folder"
          });
          for (const folder of emptyFolders) {
            const folderItem = folderList.createDiv({
              cls: "nav-folder-title"
            });
            (0, import_obsidian28.setIcon)(folderItem, "folder");
            folderItem.createSpan({ text: folder.path });
          }
        }
        const buttonContainer = content.createDiv({
          cls: "systemsculpt-modal-buttons"
        });
        const cancelButton = buttonContainer.createEl("button", {
          text: "Cancel"
        });
        cancelButton.addEventListener("click", () => confirmModal.close());
        const confirmButton = buttonContainer.createEl("button", {
          cls: "mod-warning",
          text: "Move to Trash"
        });
        confirmButton.addEventListener("click", async () => {
          try {
            for (const file of emptyFiles) {
              await this.app.vault.trash(file, true);
            }
            const sortedFolders = emptyFolders.sort((a, b) => b.path.length - a.path.length);
            for (const folder of sortedFolders) {
              await this.app.vault.trash(folder, true);
            }
            this.disableButton(clearEmptyButton);
            clearEmptyButton.setText("No Empty Content");
            showPopup(this.app, `Successfully moved ${totalEmpty} empty items to trash`, { title: "Success" });
          } catch (error) {
            console.error("Error clearing empty content:", error);
            showPopup(this.app, "Failed to clear empty content", {
              title: "Error"
            });
          }
          confirmModal.close();
        });
        confirmModal.open();
      });
    }
  }
  createChatHistorySection(container) {
    const historySection = this.createSection(container, "Chat History", "Delete all chat history and conversations permanently");
    const chatFiles = this.getFilesInDirectory(this.plugin.settings.chatsDirectory);
    const chatSize = this.calculateSize(chatFiles);
    const hasChatFiles = chatFiles.length > 0;
    const clearHistoryButton = historySection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasChatFiles ? `Clear All Chat History (${chatSize})` : "No Chat History"
    });
    this.updateButtonState(clearHistoryButton, chatFiles, "Chat History");
    if (hasChatFiles) {
      clearHistoryButton.addEventListener("click", async () => {
        if (clearHistoryButton.disabled)
          return;
        await this.showConfirmationDialog(chatFiles, "Chat History", this.plugin.settings.chatsDirectory, clearHistoryButton);
      });
    }
  }
  createExtractionsSection(container) {
    const extractionsSection = this.createSection(container, "Document Extractions", "Delete all extracted document content (PDFs, documents, etc.)");
    const extractionFiles = this.getFilesInDirectory(this.plugin.settings.extractionsDirectory);
    const extractionsSize = this.calculateSize(extractionFiles);
    const hasExtractionFiles = extractionFiles.length > 0;
    const clearExtractionsButton = extractionsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasExtractionFiles ? `Clear All Extractions (${extractionsSize})` : "No Extractions"
    });
    this.updateButtonState(clearExtractionsButton, extractionFiles, "Extractions");
    if (hasExtractionFiles) {
      clearExtractionsButton.addEventListener("click", async () => {
        if (clearExtractionsButton.disabled)
          return;
        await this.showConfirmationDialog(extractionFiles, "Extractions", this.plugin.settings.extractionsDirectory, clearExtractionsButton);
      });
    }
  }
  createRecordingsSection(container) {
    const recordingsSection = this.createSection(container, "Audio Recordings", "Delete all audio recordings (this won't affect transcriptions)");
    const recordingFiles = this.getFilesInDirectory(this.plugin.settings.recordingsDirectory);
    const recordingsSize = this.calculateSize(recordingFiles);
    const hasRecordingFiles = recordingFiles.length > 0;
    const clearRecordingsButton = recordingsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasRecordingFiles ? `Clear All Recordings (${recordingsSize})` : "No Recordings"
    });
    this.updateButtonState(clearRecordingsButton, recordingFiles, "Recordings");
    if (hasRecordingFiles) {
      clearRecordingsButton.addEventListener("click", async () => {
        if (clearRecordingsButton.disabled)
          return;
        await this.showConfirmationDialog(recordingFiles, "Recordings", this.plugin.settings.recordingsDirectory, clearRecordingsButton);
      });
    }
  }
  createSection(container, title, description) {
    const section = container.createDiv({
      cls: "systemsculpt-janitor-section"
    });
    const header = section.createDiv({ cls: "systemsculpt-section-header" });
    header.setText(title);
    const desc = section.createDiv({ cls: "systemsculpt-section-description" });
    desc.setText(description);
    return section;
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/core/plugin/ribbons.ts
var RibbonManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
  }
  initialize() {
    this.registerRibbonIcons();
  }
  registerRibbonIcons() {
    this.plugin.addRibbonIcon("message-square", "Open SystemSculpt Chat", async () => {
      await this.openChatView();
    });
    this.plugin.addRibbonIcon("history", "Open SystemSculpt Chat History", () => {
      this.openChatHistoryModal();
    });
    this.plugin.addRibbonIcon("trash", "Open SystemSculpt Janitor", () => {
      this.openJanitorModal();
    });
  }
  async openChatView() {
    const { workspace } = this.app;
    const leaf = workspace.getLeaf("tab");
    const view = new ChatView(leaf, this.plugin);
    await leaf.open(view);
    workspace.setActiveLeaf(leaf, { focus: true });
  }
  openChatHistoryModal() {
    const modal = new LoadChatModal(this.app, async (chatId) => {
      const leaf = this.app.workspace.getLeaf("tab");
      const view = new ChatView(leaf, this.plugin);
      await leaf.open(view);
      await view.loadChatById(chatId);
      this.app.workspace.setActiveLeaf(leaf, { focus: true });
    }, this.plugin);
    modal.open();
  }
  openJanitorModal() {
    new JanitorModal(this.app, this.plugin).open();
  }
};

// src/core/plugin/views.ts
var ViewManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  initialize() {
    this.registerView();
    this.ribbonManager.initialize();
    this.app.workspace.onLayoutReady(() => {
      this.restoreChatViews();
    });
  }
  async restoreChatViews() {
    const leaves = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (leaves.length === 0)
      return;
    for (const leaf of leaves) {
      const view = leaf.view;
      const state = leaf.getViewState();
      if (state && state.state && state.state.chatId) {
        await view.setState(state.state);
      }
    }
  }
  registerView() {
    this.plugin.registerView(CHAT_VIEW_TYPE, (leaf) => new ChatView(leaf, this.plugin));
  }
  unloadViews() {
    this.app.workspace.detachLeavesOfType(CHAT_VIEW_TYPE);
  }
};

// src/core/plugin/commands.ts
var import_obsidian29 = __toModule(require("obsidian"));
init_ui();
var CommandManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  registerCommands() {
    this.registerOpenTasksFile();
    this.registerToggleAudioRecorder();
    this.registerOpenChat();
    this.registerOpenChatHistory();
    this.registerOpenJanitor();
    this.registerReloadObsidian();
    this.registerOpenSettings();
    this.registerChangeChatModel();
    this.registerChatWithFile();
    this.registerTaskMovementCommands();
  }
  registerOpenTasksFile() {
    this.plugin.addCommand({
      id: "open-tasks-file",
      name: "Open Tasks File",
      callback: async () => {
        await this.plugin.tasksService.openOrCreateTasksFile();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "t" }]
    });
  }
  registerToggleAudioRecorder() {
    this.plugin.addCommand({
      id: "toggle-audio-recorder",
      name: "Toggle Audio Recorder",
      callback: () => {
        this.plugin.getRecorderService().toggleRecording();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "r" }]
    });
  }
  registerOpenChat() {
    this.plugin.addCommand({
      id: "open-systemsculpt-chat",
      name: "Open SystemSculpt Chat",
      callback: async () => {
        await this.ribbonManager.openChatView();
      }
    });
  }
  registerOpenChatHistory() {
    this.plugin.addCommand({
      id: "open-chat-history",
      name: "Open SystemSculpt Chat History",
      callback: () => {
        this.ribbonManager.openChatHistoryModal();
      }
    });
  }
  registerOpenJanitor() {
    this.plugin.addCommand({
      id: "open-systemsculpt-janitor",
      name: "Open SystemSculpt Janitor",
      callback: () => {
        this.ribbonManager.openJanitorModal();
      }
    });
  }
  registerReloadObsidian() {
    this.plugin.addCommand({
      id: "reload-obsidian",
      name: "Reload Obsidian",
      callback: () => {
        window.location.reload();
      }
    });
  }
  registerOpenSettings() {
    this.plugin.addCommand({
      id: "open-systemsculpt-settings",
      name: "Open SystemSculpt AI Settings",
      callback: () => {
        this.app.setting.open();
        this.app.setting.openTabById(this.plugin.manifest.id);
      }
    });
  }
  registerChangeChatModel() {
    this.plugin.addCommand({
      id: "change-chat-model",
      name: "Change Chat Model",
      checkCallback: (checking) => {
        const chatView = this.app.workspace.getActiveViewOfType(ChatView);
        if (!chatView) {
          if (!checking) {
            showEnhancedNotice("You need to be within a SystemSculpt chatview to change the model.", "warning");
          }
          return false;
        }
        if (!checking) {
          (async () => {
            try {
              await this.plugin.modelService.getModels();
              const modal = new ModelSelectionModal(this.app, chatView.getSelectedModelId(), async (modelId) => {
                await chatView.setSelectedModelId(modelId);
                showEnhancedNotice("Model changed successfully", "info");
              }, this.plugin);
              modal.open();
            } catch (err) {
              console.error("Failed to open model selection:", err);
              showEnhancedNotice("Failed to fetch available models", "error");
            }
          })();
        }
        return true;
      }
    });
  }
  registerChatWithFile() {
    this.plugin.addCommand({
      id: "chat-with-file",
      name: "Chat with File",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (!activeFile)
          return false;
        const extension = activeFile.extension.toLowerCase();
        const supportedExtensions = [
          "md",
          "txt",
          "markdown",
          "pdf",
          "doc",
          "docx",
          "ppt",
          "pptx",
          "xls",
          "xlsx",
          "mp3",
          "wav",
          "m4a",
          "ogg",
          "webm",
          "jpg",
          "jpeg",
          "png",
          "gif",
          "webp",
          "svg"
        ];
        if (!supportedExtensions.includes(extension))
          return false;
        if (!checking) {
          const leaf = this.app.workspace.getLeaf("tab");
          const view = new ChatView(leaf, this.plugin);
          leaf.open(view).then(async () => {
            await new Promise((resolve) => setTimeout(resolve, 50));
            this.app.workspace.setActiveLeaf(leaf, { focus: true });
            await view.addFileToContext(activeFile);
            view.focusInput();
          });
        }
        return true;
      }
    });
  }
  registerTaskMovementCommands() {
    this.plugin.addCommand({
      id: "move-task-up",
      name: "Move Task Up",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian29.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.moveTaskUp(activeView.editor);
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "ArrowUp" }]
    });
    this.plugin.addCommand({
      id: "move-task-down",
      name: "Move Task Down",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian29.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.moveTaskDown(activeView.editor);
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "ArrowDown" }]
    });
    this.plugin.addCommand({
      id: "indent-task-right",
      name: "Indent Task Right",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian29.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.indentTaskRight(activeView.editor);
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "ArrowRight" }]
    });
    this.plugin.addCommand({
      id: "indent-task-left",
      name: "Indent Task Left",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian29.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.indentTaskLeft(activeView.editor);
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "ArrowLeft" }]
    });
  }
};

// src/services/CustomProviderService.ts
var _CustomProviderService = class {
  constructor(plugin) {
    this.CACHE_DURATION = 30 * 60 * 1e3;
    this.plugin = plugin;
    this.logger = console;
  }
  async testConnection(provider) {
    const cached = _CustomProviderService.connectionTestCache.get(provider.id);
    if (cached && Date.now() - cached.result.timestamp < this.CACHE_DURATION) {
      return cached.result;
    }
    const existingPromise = _CustomProviderService.connectionTestPromises.get(provider.id);
    if (existingPromise) {
      return existingPromise;
    }
    const testPromise = this.performConnectionTest(provider);
    _CustomProviderService.connectionTestPromises.set(provider.id, testPromise);
    try {
      const result = await testPromise;
      if (result.success) {
        _CustomProviderService.connectionTestCache.set(provider.id, {
          result,
          timestamp: Date.now()
        });
      }
      return result;
    } finally {
      _CustomProviderService.connectionTestPromises.delete(provider.id);
    }
  }
  async performConnectionTest(provider) {
    try {
      const models = await this.getModels(provider);
      if (provider.endpoint.includes("openrouter.ai")) {
        await this.validateOpenRouterKey(provider, models);
      }
      return {
        success: true,
        models,
        timestamp: Date.now()
      };
    } catch (error) {
      this.logger.error("Connection test failed:", error);
      return {
        success: false,
        error: this.getErrorMessage(error),
        timestamp: Date.now()
      };
    }
  }
  async validateOpenRouterKey(provider, modelIds) {
    var _a;
    const headers = {
      "Content-Type": "application/json",
      Authorization: `Bearer ${provider.apiKey}`,
      "HTTP-Referer": "https://systemsculpt.com",
      "X-Title": "SystemSculpt AI"
    };
    const completionResponse = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers,
      body: JSON.stringify({
        model: "meta-llama/llama-3-8b-instruct:free",
        messages: [{ role: "user", content: "Hi" }],
        max_tokens: 1
      }),
      signal: AbortSignal.timeout(1e4)
    });
    if (!completionResponse.ok) {
      const errorData = await completionResponse.json().catch(() => ({}));
      if (completionResponse.status === 401) {
        throw new Error("Invalid API key. Please check your OpenRouter API key and try again.");
      } else if (completionResponse.status === 402) {
        throw new Error("Insufficient credits. Please add credits to your OpenRouter account.");
      } else if (completionResponse.status === 429) {
        throw new Error("Rate limit exceeded. Please try again in a few minutes.");
      }
      throw new Error(`API key validation failed: ${((_a = errorData.error) == null ? void 0 : _a.message) || completionResponse.statusText}`);
    }
  }
  async getModels(provider) {
    var _a, _b;
    const headers = {
      "Content-Type": "application/json"
    };
    if (provider.apiKey) {
      if (provider.endpoint.includes("openrouter.ai")) {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
        headers["HTTP-Referer"] = "https://systemsculpt.com";
        headers["X-Title"] = "SystemSculpt AI";
      } else {
        headers["Authorization"] = `Bearer ${provider.apiKey}`;
      }
    }
    let endpoint;
    if (provider.endpoint.includes("openrouter.ai")) {
      endpoint = "https://openrouter.ai/api/v1/models";
    } else {
      const baseUrl = provider.endpoint.replace(/\/+$/, "");
      endpoint = baseUrl.endsWith("/v1") ? `${baseUrl}/models` : baseUrl.endsWith("/v1/models") ? baseUrl : `${baseUrl}/v1/models`;
    }
    const response = await fetch(endpoint, {
      method: "GET",
      headers,
      signal: AbortSignal.timeout(1e4)
    });
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      if (response.status === 401) {
        throw new Error("Invalid API key. Please check your API key and try again.");
      } else if (response.status === 403) {
        throw new Error("Access denied. Please verify your API key has the correct permissions.");
      } else if (response.status === 404) {
        throw new Error("API endpoint not found. Please check the URL and try again.");
      }
      throw new Error(`HTTP error: ${((_a = errorData.error) == null ? void 0 : _a.message) || response.statusText}`);
    }
    const data = await response.json();
    return (((_b = data.data) == null ? void 0 : _b.map((model) => model.id)) || []).filter((id) => !id.toLowerCase().includes("whisper"));
  }
  getErrorMessage(error) {
    if (error instanceof Error) {
      if (error.name === "AbortError") {
        return "Connection timed out. Please check your internet connection and try again.";
      }
      return error.message;
    }
    return "An unexpected error occurred. Please try again or contact support if the issue persists.";
  }
};
var CustomProviderService = _CustomProviderService;
CustomProviderService.connectionTestCache = new Map();
CustomProviderService.connectionTestPromises = new Map();

// src/main.ts
init_SystemPromptService();

// src/services/TasksService.ts
var import_obsidian30 = __toModule(require("obsidian"));
var TasksService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.taskToggleStates = new Map();
    this.app = plugin.app;
    this.settings = plugin.settings;
    this.lastTaskFileReorder = 0;
    this.reorderDebounce = 0;
    this.registerTasksFileWatcher();
    this.registerWorkspaceEvents();
    this.registerMetadataWatcher();
  }
  registerWorkspaceEvents() {
    this.plugin.registerEvent(this.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf) {
        this.handleLeafChange(leaf);
      }
    }));
    this.plugin.registerEvent(this.app.workspace.on("layout-change", () => {
      this.app.workspace.iterateAllLeaves((leaf) => {
        this.handleLeafChange(leaf);
      });
    }));
    this.plugin.registerEvent(this.app.metadataCache.on("changed", (file) => {
      if (file.path.startsWith(this.settings.tasksDirectory)) {
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a;
          if (leaf.view instanceof import_obsidian30.MarkdownView && ((_a = leaf.view.file) == null ? void 0 : _a.path) === file.path) {
            this.handleLeafChange(leaf);
          }
        });
      }
    }));
  }
  async handleLeafChange(leaf) {
    var _a;
    const view = leaf.view;
    if (!(view instanceof import_obsidian30.MarkdownView))
      return;
    const file = view.file;
    const editorContainer = view.contentEl.querySelector(".cm-editor");
    const readerContainer = view.contentEl;
    if (editorContainer) {
      editorContainer.querySelectorAll(".systemsculpt-tasks-toggle").forEach((el) => el.remove());
    }
    if (readerContainer) {
      readerContainer.querySelectorAll(".systemsculpt-tasks-toggle").forEach((el) => el.remove());
    }
    if (!file || !file.path.startsWith(this.settings.tasksDirectory))
      return;
    const contentContainer = view.getMode() === "source" ? editorContainer : readerContainer;
    if (!contentContainer)
      return;
    const cache = this.app.metadataCache.getCache(file.path);
    const isHidden = ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.hideCompleted) === true;
    this.taskToggleStates.set(file.path, isHidden);
    const toggleContainer = this.createToggleContainer(file.path, isHidden);
    contentContainer.insertBefore(toggleContainer, contentContainer.firstChild);
    this.updateTaskVisibility(file.path, isHidden);
  }
  createToggleContainer(filePath, initialState) {
    const toggleContainer = document.createElement("div");
    toggleContainer.className = "systemsculpt-tasks-toggle";
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.className = "task-toggle-checkbox";
    checkbox.checked = initialState;
    const label = document.createElement("label");
    label.textContent = "Hide completed tasks";
    label.className = "task-toggle-label";
    checkbox.addEventListener("change", async (e) => {
      const isChecked = e.target.checked;
      await this.updateToggleState(filePath, isChecked);
    });
    toggleContainer.appendChild(checkbox);
    toggleContainer.appendChild(label);
    return toggleContainer;
  }
  registerMetadataWatcher() {
    this.plugin.registerEvent(this.app.metadataCache.on("changed", (file) => {
      var _a;
      if (file.path.startsWith(this.settings.tasksDirectory)) {
        const cache = this.app.metadataCache.getCache(file.path);
        const isHidden = ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.hideCompleted) === true;
        this.taskToggleStates.set(file.path, isHidden);
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a2;
          if (leaf.view instanceof import_obsidian30.MarkdownView && ((_a2 = leaf.view.file) == null ? void 0 : _a2.path) === file.path) {
            const editorContainer = leaf.view.contentEl.querySelector(".cm-editor");
            const readerContainer = leaf.view.contentEl;
            const containers = [editorContainer, readerContainer];
            containers.forEach((container) => {
              if (container) {
                const toggle = container.querySelector(".task-toggle-checkbox");
                if (toggle) {
                  toggle.checked = isHidden;
                }
              }
            });
            this.updateTaskVisibility(file.path, isHidden);
          }
        });
      }
    }));
  }
  async updateToggleState(filePath, isChecked) {
    this.taskToggleStates.set(filePath, isChecked);
    this.updateTaskVisibility(filePath, isChecked);
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (file instanceof import_obsidian30.TFile) {
      const content = await this.app.vault.read(file);
      const hasYamlFrontmatter = content.startsWith("---\n");
      let newContent;
      if (hasYamlFrontmatter) {
        const [frontmatter, ...rest] = content.split("---\n").filter(Boolean);
        const yamlLines = frontmatter.split("\n");
        const hideCompletedIndex = yamlLines.findIndex((line) => line.startsWith("hideCompleted:"));
        if (hideCompletedIndex >= 0) {
          yamlLines[hideCompletedIndex] = `hideCompleted: ${isChecked}`;
        } else {
          yamlLines.push(`hideCompleted: ${isChecked}`);
        }
        newContent = `---
${yamlLines.join("\n")}
---
${rest.join("---\n")}`;
      } else {
        newContent = `---
hideCompleted: ${isChecked}
---

${content}`;
      }
      try {
        await this.app.vault.modify(file, newContent);
      } catch (error) {
        console.error("Failed to update hideCompleted in frontmatter:", error);
        this.taskToggleStates.set(filePath, !isChecked);
        this.updateTaskVisibility(filePath, !isChecked);
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a;
          if (leaf.view instanceof import_obsidian30.MarkdownView && ((_a = leaf.view.file) == null ? void 0 : _a.path) === filePath) {
            const editorContainer = leaf.view.contentEl.querySelector(".cm-editor");
            const readerContainer = leaf.view.contentEl;
            const containers = [editorContainer, readerContainer];
            containers.forEach((container) => {
              if (container) {
                const toggle = container.querySelector(".task-toggle-checkbox");
                if (toggle) {
                  toggle.checked = !isChecked;
                }
              }
            });
          }
        });
      }
    }
  }
  updateTaskVisibility(filePath, isHidden) {
    var _a, _b;
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (!file)
      return;
    const leaves = this.app.workspace.getLeavesOfType("markdown");
    for (const leaf of leaves) {
      const view = leaf.view;
      if (((_a = view.file) == null ? void 0 : _a.path) !== file.path)
        continue;
      const contentEl = view.contentEl;
      if (isHidden) {
        contentEl.classList.add("hide-completed-tasks");
      } else {
        contentEl.classList.remove("hide-completed-tasks");
      }
      if (view.getMode() === "source") {
        const editor = view.editor;
        if (editor) {
          editor.refresh();
        }
      } else {
        (_b = view.previewMode) == null ? void 0 : _b.rerender(true);
      }
    }
  }
  async openOrCreateTasksFile() {
    const tasksDir = this.settings.tasksDirectory;
    const fileName = `${tasksDir}/Tasks.md`;
    try {
      await this.app.vault.adapter.mkdir(tasksDir);
      if (!await this.app.vault.adapter.exists(fileName)) {
        await this.app.vault.create(fileName, `# Tasks

- [ ] Sample task
`);
      }
      const file = this.app.vault.getAbstractFileByPath(fileName);
      if (file instanceof import_obsidian30.TFile) {
        const existingLeaf = this.app.workspace.getLeavesOfType("markdown").find((leaf) => leaf.view.getState().file === file.path);
        if (existingLeaf) {
          this.app.workspace.setActiveLeaf(existingLeaf, { focus: true });
        } else {
          await this.app.workspace.getLeaf().openFile(file);
        }
      }
    } catch (error) {
      console.error("Failed to handle tasks file:", error);
      throw error;
    }
  }
  registerTasksFileWatcher() {
    this.plugin.registerEvent(this.app.vault.on("modify", async (file) => {
      const tasksDir = this.settings.tasksDirectory;
      if (file.path.startsWith(tasksDir) && file.path.endsWith(".md")) {
        await this.reorderCompletedTasks(file);
      }
    }));
  }
  async reorderCompletedTasks(file) {
    if (!this.settings.moveCompletedTasksDown) {
      return;
    }
    if (!file.path.startsWith(this.settings.tasksDirectory)) {
      return;
    }
    if (!file.path.endsWith(".md")) {
      return;
    }
    const original = await this.app.vault.read(file);
    const reordered = this.reorderContent(original);
    if (reordered !== original) {
      await this.app.vault.modify(file, reordered);
    }
  }
  reorderContent(content) {
    const lines = content.split("\n");
    const output = [];
    let listBuffer = [];
    const flushBuffer = () => {
      if (listBuffer.length > 0) {
        output.push(...this.reorderListBlock(listBuffer));
        listBuffer = [];
      }
    };
    for (const line of lines) {
      if (/^\s*-\s*\[[x\s]\]/.test(line)) {
        listBuffer.push(line);
      } else {
        flushBuffer();
        output.push(line);
      }
    }
    flushBuffer();
    return output.join("\n");
  }
  reorderListBlock(lines) {
    function getIndent(line) {
      const match = line.match(/^(\s*)/);
      return match ? match[1].length : 0;
    }
    const nodes = [];
    const stack = [];
    for (const line of lines) {
      const indent = getIndent(line);
      const node = { line, children: [], indent };
      while (stack.length > 0 && indent <= stack[stack.length - 1].indent) {
        stack.pop();
      }
      if (stack.length === 0) {
        nodes.push(node);
        stack.push(node);
      } else {
        stack[stack.length - 1].children.push(node);
        stack.push(node);
      }
    }
    function reorderNodes(nodes2) {
      for (const node of nodes2) {
        if (node.children.length > 0) {
          node.children = reorderNodes(node.children);
          node.children.sort((a, b) => {
            const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
            const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
            return aComplete - bComplete;
          });
        }
      }
      nodes2.sort((a, b) => {
        const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
        const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
        return aComplete - bComplete;
      });
      return nodes2;
    }
    const reorderedNodes = reorderNodes(nodes);
    const flattened = [];
    function flatten(nodes2) {
      for (const node of nodes2) {
        flattened.push(node.line);
        if (node.children.length > 0) {
          flatten(node.children);
        }
      }
    }
    flatten(reorderedNodes);
    return flattened;
  }
  isTasksFile(filePath) {
    return filePath.startsWith(this.settings.tasksDirectory);
  }
  getTaskTreeRange(editor, startLine) {
    const startIndent = this.getIndentLevel(editor.getLine(startLine));
    let endLine = startLine;
    for (let i = startLine + 1; i < editor.lineCount(); i++) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent <= startIndent) {
        break;
      }
      endLine = i;
    }
    return { start: startLine, end: endLine };
  }
  getPreviousTaskTreeRange(editor, currentLine, currentIndent) {
    for (let i = currentLine - 1; i >= 0; i--) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent === currentIndent && this.isTaskLine(line)) {
        return this.getTaskTreeRange(editor, i);
      }
      if (indent < currentIndent) {
        break;
      }
    }
    return null;
  }
  getNextTaskTreeRange(editor, currentLine, currentIndent) {
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    for (let i = currentTreeRange.end + 1; i < editor.lineCount(); i++) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent === currentIndent && this.isTaskLine(line)) {
        return this.getTaskTreeRange(editor, i);
      }
      if (indent < currentIndent) {
        break;
      }
    }
    return null;
  }
  getRangeText(editor, range) {
    let text = "";
    for (let i = range.start; i <= range.end; i++) {
      text += editor.getLine(i) + "\n";
    }
    return text;
  }
  moveTaskUp(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    if (currentLine === 0)
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    const previousTreeRange = this.getPreviousTaskTreeRange(editor, currentLine, currentIndent);
    if (previousTreeRange) {
      const currentTreeText = this.getRangeText(editor, currentTreeRange);
      const previousTreeText = this.getRangeText(editor, previousTreeRange);
      editor.transaction({
        changes: [
          {
            from: { line: previousTreeRange.start, ch: 0 },
            to: { line: previousTreeRange.end + 1, ch: 0 },
            text: currentTreeText
          },
          {
            from: { line: currentTreeRange.start, ch: 0 },
            to: { line: currentTreeRange.end + 1, ch: 0 },
            text: previousTreeText
          }
        ]
      });
      const moveDistance = currentTreeRange.start - previousTreeRange.start;
      const newLine = currentLine - moveDistance;
      const newLineContent = editor.getLine(newLine);
      editor.setCursor({ line: newLine, ch: newLineContent.length });
    }
  }
  moveTaskDown(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    const nextTreeRange = this.getNextTaskTreeRange(editor, currentLine, currentIndent);
    if (nextTreeRange) {
      const currentTreeText = this.getRangeText(editor, currentTreeRange);
      const nextTreeText = this.getRangeText(editor, nextTreeRange);
      editor.transaction({
        changes: [
          {
            from: { line: currentTreeRange.start, ch: 0 },
            to: { line: currentTreeRange.end + 1, ch: 0 },
            text: nextTreeText
          },
          {
            from: { line: nextTreeRange.start, ch: 0 },
            to: { line: nextTreeRange.end + 1, ch: 0 },
            text: currentTreeText
          }
        ]
      });
      const nextTreeSize = nextTreeRange.end - nextTreeRange.start + 1;
      const newLine = currentLine + nextTreeSize;
      const newLineContent = editor.getLine(newLine);
      editor.setCursor({ line: newLine, ch: newLineContent.length });
    }
  }
  indentTaskRight(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    editor.setLine(currentLine, "  " + lineContent);
    const newLineContent = editor.getLine(currentLine);
    editor.setCursor({ line: currentLine, ch: newLineContent.length });
  }
  indentTaskLeft(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    if (currentIndent >= 2) {
      editor.setLine(currentLine, lineContent.substring(2));
      const newLineContent = editor.getLine(currentLine);
      editor.setCursor({ line: currentLine, ch: newLineContent.length });
    }
  }
  isTaskLine(line) {
    return /^\s*-\s*\[[x\s]\]/.test(line);
  }
  getIndentLevel(line) {
    const match = line.match(/^(\s*)/);
    return match ? match[1].length : 0;
  }
};

// src/services/ModelService.ts
var ModelService = class {
  constructor(plugin, customProviderService) {
    this.loadingPromise = null;
    this.plugin = plugin;
    this.customProviderService = customProviderService;
  }
  static getInstance(plugin, customProviderService) {
    if (!ModelService.instance) {
      ModelService.instance = new ModelService(plugin, customProviderService);
    }
    return ModelService.instance;
  }
  async getModels() {
    if (this.loadingPromise) {
      return this.loadingPromise;
    }
    this.loadingPromise = this.loadModels();
    try {
      const models = await this.loadingPromise;
      return models;
    } finally {
      this.loadingPromise = null;
    }
  }
  async loadModels() {
    try {
      const systemModels = await this.plugin.aiService.getModels();
      const customModels = await this.loadCustomProviderModels();
      const allModels = [...systemModels, ...customModels];
      const favoriteModels = this.plugin.settings.favoriteModels || [];
      for (const model of allModels) {
        model.isFavorite = favoriteModels.some((fav) => fav.modelId === model.id && fav.provider === model.provider);
      }
      return allModels;
    } catch (error) {
      console.error("Failed to load models:", error);
      return [];
    }
  }
  async loadCustomProviderModels() {
    const { customProviders } = this.plugin.settings;
    const fetches = customProviders.filter((p) => p.isEnabled).map(async (p) => {
      try {
        const result = await this.customProviderService.testConnection(p);
        if (result.success && result.models) {
          return this.createCustomModels(p, result.models);
        }
      } catch (error) {
        console.error(`Failed to load models from ${p.name}:`, error);
      }
      return [];
    });
    const results = await Promise.all(fetches);
    return results.flat();
  }
  createCustomModels(provider, modelIds) {
    return modelIds.map((modelId) => ({
      id: modelId,
      name: modelId,
      provider: provider.name.toLowerCase(),
      isFavorite: false,
      context_length: 0,
      capabilities: [],
      pricing: {
        prompt: "0",
        completion: "0",
        image: "0",
        request: "0"
      },
      architecture: {
        modality: "text->text",
        tokenizer: "",
        instruct_type: null
      },
      description: `${provider.name} model`,
      identifier: {
        providerId: provider.name.toLowerCase(),
        modelId,
        displayName: modelId
      }
    }));
  }
  async toggleFavorite(model) {
    const isNowFavorite = !model.isFavorite;
    model.isFavorite = isNowFavorite;
    if (isNowFavorite) {
      this.plugin.settings.favoriteModels.push({
        provider: model.provider,
        modelId: model.id
      });
    } else {
      this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((fav) => !(fav.modelId === model.id && fav.provider === model.provider));
    }
    await this.plugin.saveSettings();
  }
};

// src/main.ts
var SystemSculptPlugin = class extends import_obsidian31.Plugin {
  async onload() {
    try {
      this.settingsManager = new SettingsManager(this);
      await this.settingsManager.loadSettings();
      this.settings = this.settingsManager.getSettings();
      try {
        const registeredExtensions = this.app.viewRegistry.typeByExtension;
        if (!(registeredExtensions == null ? void 0 : registeredExtensions.srt)) {
          this.registerExtensions(["srt"], "markdown");
        }
      } catch (error) {
        console.error("Failed to register .srt extension:", error);
      }
      try {
        this.customProviderService = new CustomProviderService(this);
        this.modelService = ModelService.getInstance(this, this.customProviderService);
        this.aiService = SystemSculptService.getInstance(this.settings, this.app);
        this.transcriptionService = TranscriptionService.getInstance(this);
        this.recorderService = RecorderService.getInstance(this.app, this);
        this.contextMenu = new SystemSculptContextMenu(this.app, this.aiService, this);
        SystemPromptService.setSystemSculptService(this.aiService);
      } catch (error) {
        console.error("Failed to initialize core services:", error);
        throw error;
      }
      this.settingsTab = new SystemSculptSettingTab(this.app, this);
      this.addSettingTab(this.settingsTab);
      try {
        this.licenseManager = new LicenseManager(this, this.app);
        this.tasksService = new TasksService(this);
        this.viewManager = new ViewManager(this, this.app);
        this.commandManager = new CommandManager(this, this.app);
        this.viewManager.initialize();
        this.commandManager.registerCommands();
      } catch (error) {
        console.error("Failed to initialize managers:", error);
        throw error;
      }
      SystemPromptService.initializeCache().catch((error) => {
        console.error("Failed to initialize system prompts cache:", error);
      });
      await this.getLicenseManager().initializeLicense();
    } catch (error) {
      console.error("Failed to load SystemSculpt plugin:", error);
      throw error;
    }
  }
  async onunload() {
    console.log("SystemSculpt AI plugin unloading...");
    try {
      if (this.settingsTab) {
      }
      if (this.commandManager) {
        const commands = [
          "open-tasks-file",
          "toggle-audio-recorder",
          "open-systemsculpt-chat",
          "open-chat-history",
          "open-systemsculpt-janitor",
          "reload-obsidian",
          "open-systemsculpt-settings",
          "change-chat-model",
          "chat-with-file",
          "suggest-edits",
          "clear-suggested-edits",
          "move-task-up",
          "move-task-down",
          "indent-task-right",
          "indent-task-left"
        ];
        commands.forEach((id) => {
          this.app.commands.removeCommand(`${this.manifest.id}:${id}`);
        });
      }
      if (this.viewManager) {
        this.viewManager.unloadViews();
      }
      if (this.contextMenu) {
      }
      if (this.recorderService) {
        this.recorderService.unload();
      }
      if (this.transcriptionService) {
        this.transcriptionService.unload();
        TranscriptionService.instance = null;
      }
      if (this.aiService) {
        SystemSculptService.instance = null;
      }
      if (this.modelService) {
        ModelService.instance = null;
      }
      if (this.customProviderService) {
      }
      SystemPromptService.clearCache();
      try {
        const registeredExtensions = this.app.viewRegistry.typeByExtension;
        if (registeredExtensions == null ? void 0 : registeredExtensions.srt) {
          delete registeredExtensions.srt;
        }
      } catch (error) {
        console.error("Failed to unregister .srt extension:", error);
      }
      console.log("SystemSculpt AI plugin unloaded successfully");
    } catch (error) {
      console.error("Error during plugin cleanup:", error);
      throw error;
    }
  }
  async loadData() {
    return super.loadData();
  }
  async saveData(data) {
    return super.saveData(data);
  }
  async saveSettings() {
    await this.settingsManager.saveSettings();
  }
  getRecorderService() {
    return this.recorderService;
  }
  getTranscriptionService() {
    return this.transcriptionService;
  }
  getLicenseManager() {
    return this.licenseManager;
  }
  getSettingsManager() {
    return this.settingsManager;
  }
  getInitialModels() {
    return this.modelService.getModels();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2UudHMiLCAic3JjL3V0aWxzL2Vycm9ycy50cyIsICJzcmMvdXRpbHMvSW1hZ2VQcm9jZXNzb3IudHMiLCAic3JjL2NvbnN0YW50cy9hcGkudHMiLCAic3JjL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2UudHMiLCAic3JjL2NvcmUvdWkvY29tcG9uZW50cy9Mb2FkaW5nSW5kaWNhdG9yLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvQnV0dG9uLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9UZXh0QXJlYU1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL21vZGFscy9Qb3B1cE1vZGFsLnRzIiwgInNyYy9jb3JlL3VpL2NvbXBvbmVudHMvTm90aWNlLnRzIiwgInNyYy9jb3JlL3VpL25vdGlmaWNhdGlvbnMudHMiLCAic3JjL2NvcmUvdWkvaW5kZXgudHMiLCAic3JjL2NvbXBvbmVudHMvRmlsZVN1Z2dlc3Rlci50cyIsICJzcmMvbW9kYWxzL1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwudHMiLCAic3JjL21haW4udHMiLCAic3JjL21vZGFscy9TZXR0aW5nc1RhYi50cyIsICJzcmMvdHlwZXMvbGxtLnRzIiwgInNyYy90eXBlcy50cyIsICJzcmMvbW9kYWxzL01vZGVsU2VsZWN0aW9uTW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2UudHMiLCAic3JjL21vZGFscy9Nb2RlbFNlbGVjdGlvbkhlbHBlci50cyIsICJzcmMvbW9kYWxzL0N1c3RvbVByb3ZpZGVyTW9kYWwudHMiLCAic3JjL2NvbXBvbmVudHMvRm9sZGVyU3VnZ2VzdGVyLnRzIiwgInNyYy9tb2RhbHMvU3lzdGVtUHJvbXB0TW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL1JlY29yZGVyU2VydmljZS50cyIsICJzcmMvbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLnRzIiwgInNyYy92aWV3cy9DaGF0Vmlldy50cyIsICJzcmMvc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZS50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9EcmF3ZXJDb21wb25lbnQudHMiLCAic3JjL3ZpZXdzL2NvbXBvbmVudHMvTWVzc2FnZVJlbmRlcmVyLnRzIiwgInNyYy92aWV3cy9jb21wb25lbnRzL0lucHV0SGFuZGxlci50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9GaWxlQ29udGV4dE1hbmFnZXIudHMiLCAic3JjL21vZGFscy9Db250ZXh0U2VsZWN0aW9uTW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL1Rva2VuQ291bnRlclNlcnZpY2UudHMiLCAic3JjL2NvcmUvbGljZW5zZS9MaWNlbnNlQ2hlY2tlci50cyIsICJzcmMvbW9kYWxzL0xvYWRDaGF0TW9kYWwudHMiLCAic3JjL2NvbXBvbmVudHMvU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUudHMiLCAic3JjL2NvcmUvc2V0dGluZ3MvU2V0dGluZ3NNYW5hZ2VyLnRzIiwgInNyYy9jb3JlL2xpY2Vuc2UvTGljZW5zZU1hbmFnZXIudHMiLCAic3JjL21vZGFscy9KYW5pdG9yTW9kYWwudHMiLCAic3JjL2NvcmUvcGx1Z2luL3JpYmJvbnMudHMiLCAic3JjL2NvcmUvcGx1Z2luL3ZpZXdzLnRzIiwgInNyYy9jb3JlL3BsdWdpbi9jb21tYW5kcy50cyIsICJzcmMvc2VydmljZXMvQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9UYXNrc1NlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL01vZGVsU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5cbmludGVyZmFjZSBTeXN0ZW1Qcm9tcHRDYWNoZSB7XG4gIHByb21wdHM6IFN5c3RlbVByb21wdFByZXNldFtdO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgYnlJZDogeyBba2V5OiBzdHJpbmddOiBTeXN0ZW1Qcm9tcHRQcmVzZXQgfTtcbn1cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVByb21wdFNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBjYWNoZTogU3lzdGVtUHJvbXB0Q2FjaGUgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ0FDSEVfRFVSQVRJT04gPSA2MCAqIDYwICogMTAwMDsgLy8gMSBob3VyIGluIG1pbGxpc2Vjb25kc1xuICBwcml2YXRlIHN0YXRpYyBpbml0UHJvbWlzZTogUHJvbWlzZTx2b2lkPiB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyBpc0luaXRpYWxpemluZyA9IGZhbHNlO1xuICBwcml2YXRlIHN0YXRpYyBzeXN0ZW1TY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHApIHtcbiAgICAvLyBTdGFydCBjYWNoZSBpbml0aWFsaXphdGlvbiBpZiBub3QgYWxyZWFkeSBzdGFydGVkXG4gICAgaWYgKFxuICAgICAgIVN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgJiZcbiAgICAgICFTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzSW5pdGlhbGl6aW5nXG4gICAgKSB7XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRpYWxpemVDYWNoZSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgc2V0U3lzdGVtU2N1bHB0U2VydmljZShzZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlKSB7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5zeXN0ZW1TY3VscHRTZXJ2aWNlID0gc2VydmljZTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGlzQ2FjaGVWYWxpZCgpOiBib29sZWFuIHtcbiAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIHJldHVybiAoXG4gICAgICBub3cgLSBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLnRpbWVzdGFtcCA8XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLkNBQ0hFX0RVUkFUSU9OXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHVwZGF0ZUNhY2hlKHByb21wdHM6IFN5c3RlbVByb21wdFByZXNldFtdKTogdm9pZCB7XG4gICAgY29uc3QgYnlJZDogeyBba2V5OiBzdHJpbmddOiBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSA9IHt9O1xuICAgIHByb21wdHMuZm9yRWFjaCgocHJvbXB0KSA9PiB7XG4gICAgICBieUlkW3Byb21wdC5pZF0gPSBwcm9tcHQ7XG4gICAgfSk7XG5cbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlID0ge1xuICAgICAgcHJvbXB0cyxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGJ5SWQsXG4gICAgfTtcbiAgfVxuXG4gIC8vIEluaXRpYWxpemUgY2FjaGUgd2l0aG91dCBibG9ja2luZ1xuICBwdWJsaWMgc3RhdGljIGluaXRpYWxpemVDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSkge1xuICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2U7XG4gICAgfVxuXG4gICAgaWYgKCFTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJTeXN0ZW1TY3VscHRTZXJ2aWNlIG5vdCBpbml0aWFsaXplZFwiKSk7XG4gICAgfVxuXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0luaXRpYWxpemluZyA9IHRydWU7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSA9IGZldGNoKFxuICAgICAgYCR7U3lzdGVtUHJvbXB0U2VydmljZS5zeXN0ZW1TY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9zeXN0ZW0tcHJvbXB0c2BcbiAgICApXG4gICAgICAudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdHM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnVwZGF0ZUNhY2hlKGRhdGEucHJvbXB0cyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW5pdGlhbGl6aW5nIHN5c3RlbSBwcm9tcHRzIGNhY2hlOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIENsZWFyIHRoZSBwcm9taXNlIHNvIHdlIGNhbiByZXRyeSBsYXRlclxuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gbnVsbDtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2U7XG4gIH1cblxuICAvLyBFbnN1cmUgY2FjaGUgaXMgaW5pdGlhbGl6ZWQgYmVmb3JlIHByb2NlZWRpbmdcbiAgcHJpdmF0ZSBhc3luYyBlbnN1cmVDYWNoZUluaXRpYWxpemVkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQ2FjaGVWYWxpZCgpKSByZXR1cm47XG5cbiAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSkge1xuICAgICAgYXdhaXQgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRpYWxpemVDYWNoZSgpO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3lzdGVtUHJvbXB0cygpOiBQcm9taXNlPFN5c3RlbVByb21wdFByZXNldFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZW5zdXJlQ2FjaGVJbml0aWFsaXplZCgpO1xuXG4gICAgICAvLyBSZXR1cm4gY2FjaGVkIGRhdGEgaWYgdmFsaWRcbiAgICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQ2FjaGVWYWxpZCgpICYmIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUpIHtcbiAgICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUucHJvbXB0cztcbiAgICAgIH1cblxuICAgICAgLy8gSWYgY2FjaGUgaXMgaW52YWxpZCBvciBtaXNzaW5nLCBmZXRjaCBmcmVzaCBkYXRhXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzYFxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdHM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnVwZGF0ZUNhY2hlKGRhdGEucHJvbXB0cyk7XG4gICAgICByZXR1cm4gZGF0YS5wcm9tcHRzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgIC8vIElmIGNhY2hlIGV4aXN0cyBidXQgZXhwaXJlZCwgcmV0dXJuIGl0IGFzIGZhbGxiYWNrXG4gICAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSkge1xuICAgICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZS5wcm9tcHRzO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0U3lzdGVtUHJvbXB0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTeXN0ZW1Qcm9tcHRQcmVzZXQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZW5zdXJlQ2FjaGVJbml0aWFsaXplZCgpO1xuXG4gICAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgICAgaWYgKFxuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQ2FjaGVWYWxpZCgpICYmXG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGU/LmJ5SWRbaWRdXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUuYnlJZFtpZF07XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGNhY2hlIGlzIG1pc3Npbmcgb3IgaW52YWxpZCwgZmV0Y2ggYWxsIHByb21wdHMgdG8gcmVmcmVzaCBjYWNoZVxuICAgICAgYXdhaXQgdGhpcy5nZXRTeXN0ZW1Qcm9tcHRzKCk7XG5cbiAgICAgIC8vIFJldHVybiBmcm9tIHJlZnJlc2hlZCBjYWNoZVxuICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGU/LmJ5SWRbaWRdIHx8IG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGZldGNoaW5nIHN5c3RlbSBwcm9tcHQgJHtpZH06YCwgZXJyb3IpO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gY2FjaGUgZXZlbiBpZiBleHBpcmVkXG4gICAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8uYnlJZFtpZF0pIHtcbiAgICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUuYnlJZFtpZF07XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTeXN0ZW1Qcm9tcHRUZW1wbGF0ZSgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzL3RlbXBsYXRlYFxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gZGF0YS50ZW1wbGF0ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGU6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZvcmNlIHJlZnJlc2ggdGhlIGNhY2hlXG4gIGFzeW5jIHJlZnJlc2hDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlID0gbnVsbDtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gbnVsbDtcbiAgICBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRpYWxpemVDYWNoZSgpO1xuICB9XG5cbiAgLy8gQ2xlYXIgdGhlIGNhY2hlXG4gIHN0YXRpYyBjbGVhckNhY2hlKCk6IHZvaWQge1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSBudWxsO1xuICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UgPSBudWxsO1xuICB9XG59XG4iLCAiZXhwb3J0IGNvbnN0IEVSUk9SX0NPREVTID0ge1xuICAvLyBBdXRoZW50aWNhdGlvbiBFcnJvcnNcbiAgSU5WQUxJRF9MSUNFTlNFOiBcIklOVkFMSURfTElDRU5TRVwiLFxuICBMSUNFTlNFX0VYUElSRUQ6IFwiTElDRU5TRV9FWFBJUkVEXCIsXG4gIExJQ0VOU0VfRElTQUJMRUQ6IFwiTElDRU5TRV9ESVNBQkxFRFwiLFxuICBQUk9fUkVRVUlSRUQ6IFwiUFJPX1JFUVVJUkVEXCIsXG5cbiAgLy8gTW9kZWwgRXJyb3JzXG4gIE1PREVMX1VOQVZBSUxBQkxFOiBcIk1PREVMX1VOQVZBSUxBQkxFXCIsXG4gIE1PREVMX1JFUVVFU1RfRVJST1I6IFwiTU9ERUxfUkVRVUVTVF9FUlJPUlwiLFxuXG4gIC8vIFN0cmVhbSBFcnJvcnNcbiAgU1RSRUFNX0VSUk9SOiBcIlNUUkVBTV9FUlJPUlwiLFxuICBJTlZBTElEX1JFU1BPTlNFOiBcIklOVkFMSURfUkVTUE9OU0VcIixcbiAgTk9fSU1BR0U6IFwiTk9fSU1BR0VcIixcblxuICAvLyBGaWxlIFByb2Nlc3NpbmcgRXJyb3JzXG4gIEZJTEVfTk9UX0ZPVU5EOiBcIkZJTEVfTk9UX0ZPVU5EXCIsXG4gIEZJTEVfVE9PX0xBUkdFOiBcIkZJTEVfVE9PX0xBUkdFXCIsXG4gIFVOU1VQUE9SVEVEX0ZPUk1BVDogXCJVTlNVUFBPUlRFRF9GT1JNQVRcIixcbiAgUFJPQ0VTU0lOR19FUlJPUjogXCJQUk9DRVNTSU5HX0VSUk9SXCIsXG5cbiAgLy8gR2VuZXJpYyBFcnJvcnNcbiAgVU5LTk9XTl9FUlJPUjogXCJVTktOT1dOX0VSUk9SXCIsXG4gIFFVT1RBX0VYQ0VFREVEOiBcIlFVT1RBX0VYQ0VFREVEXCIsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBFcnJvckNvZGUgPSAodHlwZW9mIEVSUk9SX0NPREVTKVtrZXlvZiB0eXBlb2YgRVJST1JfQ09ERVNdO1xuXG50eXBlIEVycm9yTWVzc2FnZUZ1bmN0aW9uID0gKG1vZGVsPzogc3RyaW5nKSA9PiBzdHJpbmc7XG50eXBlIEVycm9yTWVzc2FnZVZhbHVlID0gc3RyaW5nIHwgRXJyb3JNZXNzYWdlRnVuY3Rpb247XG5cbmV4cG9ydCBjb25zdCBFUlJPUl9NRVNTQUdFUzogUmVjb3JkPEVycm9yQ29kZSwgRXJyb3JNZXNzYWdlVmFsdWU+ID0ge1xuICBbRVJST1JfQ09ERVMuSU5WQUxJRF9MSUNFTlNFXTpcbiAgICBcIkludmFsaWQgbGljZW5zZSBrZXkuIFBsZWFzZSBjaGVjayBhbmQgdHJ5IGFnYWluLlwiLFxuICBbRVJST1JfQ09ERVMuTElDRU5TRV9FWFBJUkVEXTogXCJZb3VyIGxpY2Vuc2UgaGFzIGV4cGlyZWQuXCIsXG4gIFtFUlJPUl9DT0RFUy5MSUNFTlNFX0RJU0FCTEVEXTogXCJUaGlzIGxpY2Vuc2UgaGFzIGJlZW4gZGlzYWJsZWQuXCIsXG4gIFtFUlJPUl9DT0RFUy5QUk9fUkVRVUlSRURdOlxuICAgIFwiVGhpcyBmZWF0dXJlIHJlcXVpcmVzIGEgUHJvIHN1YnNjcmlwdGlvbi4gUGxlYXNlIHVwZ3JhZGUuXCIsXG4gIFtFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRV06IChtb2RlbD86IHN0cmluZykgPT5cbiAgICBgTW9kZWwgJHttb2RlbCB8fCBcIlwifSBpcyBjdXJyZW50bHkgdW5hdmFpbGFibGUuYCxcbiAgW0VSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JdOiAobW9kZWw/OiBzdHJpbmcpID0+XG4gICAgYE1vZGVsICR7bW9kZWwgfHwgXCJcIn0gY2Fubm90IHByb2Nlc3MgdGhpcyByZXF1ZXN0LmAsXG4gIFtFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1JdOiBcIlN0cmVhbWluZyBmYWlsZWQuIFBsZWFzZSB0cnkgYWdhaW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5JTlZBTElEX1JFU1BPTlNFXTpcbiAgICBcIkludmFsaWQgcmVzcG9uc2UgcmVjZWl2ZWQgZnJvbSBzZXJ2ZXIuIFBsZWFzZSB0cnkgYWdhaW4uXCIsXG4gIFtFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SXTpcbiAgICBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4gb3IgY29udGFjdCBzdXBwb3J0LlwiLFxuICBbRVJST1JfQ09ERVMuUVVPVEFfRVhDRUVERURdOlxuICAgIFwiWW91IGhhdmUgZXhjZWVkZWQgeW91ciBxdW90YS4gUGxlYXNlIHVwZ3JhZGUgeW91ciBwbGFuLlwiLFxuICBbRVJST1JfQ09ERVMuTk9fSU1BR0VdOiBcIk5vIGltYWdlIGluIGNsaXBib2FyZFwiLFxuICBbRVJST1JfQ09ERVMuRklMRV9OT1RfRk9VTkRdOiBcIkZpbGUgbm90IGZvdW5kXCIsXG4gIFtFUlJPUl9DT0RFUy5GSUxFX1RPT19MQVJHRV06IFwiRmlsZSB0b28gbGFyZ2UgKG1heCAxME1CKVwiLFxuICBbRVJST1JfQ09ERVMuVU5TVVBQT1JURURfRk9STUFUXTogXCJVbnN1cHBvcnRlZCBmaWxlIGZvcm1hdFwiLFxuICBbRVJST1JfQ09ERVMuUFJPQ0VTU0lOR19FUlJPUl06IFwiRmFpbGVkIHRvIHByb2Nlc3MgZmlsZVwiLFxufTtcblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgcHVibGljIGNvZGU6IEVycm9yQ29kZSA9IEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IsXG4gICAgcHVibGljIHN0YXR1c0NvZGU6IG51bWJlciA9IDUwMCxcbiAgICBwdWJsaWMgbWV0YWRhdGE/OiB7XG4gICAgICBwcm92aWRlcj86IHN0cmluZztcbiAgICAgIG1vZGVsPzogc3RyaW5nO1xuICAgICAgc2hvdWxkUmVzdWJtaXQ/OiBib29sZWFuO1xuICAgICAgW2tleTogc3RyaW5nXTogYW55O1xuICAgIH1cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gXCJTeXN0ZW1TY3VscHRFcnJvclwiO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoY29kZTogRXJyb3JDb2RlLCBtb2RlbD86IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IG1lc3NhZ2UgPSBFUlJPUl9NRVNTQUdFU1tjb2RlXTtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICByZXR1cm4gbWVzc2FnZShtb2RlbCk7XG4gIH1cbiAgcmV0dXJuIG1lc3NhZ2U7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi9lcnJvcnNcIjtcblxuZXhwb3J0IGNsYXNzIEltYWdlUHJvY2Vzc29yIHtcbiAgcHJpdmF0ZSBzdGF0aWMgTUFYX0ZJTEVfU0laRSA9IDEwICogMTAyNCAqIDEwMjQ7IFxuICBwcml2YXRlIHN0YXRpYyBTVVBQT1JURURfRk9STUFUUyA9IG5ldyBTZXQoW1xuICAgIFwianBnXCIsXG4gICAgXCJqcGVnXCIsXG4gICAgXCJwbmdcIixcbiAgICBcImdpZlwiLFxuICAgIFwid2VicFwiLFxuICBdKTtcblxuICBzdGF0aWMgYXN5bmMgcHJvY2Vzc0ltYWdlKGZpbGU6IFRGaWxlLCBhcHA6IEFwcCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgXG4gICAgaWYgKCFmaWxlKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXCJGaWxlIG5vdCBmb3VuZFwiLCBcIkZJTEVfTk9UX0ZPVU5EXCIsIDQwNCk7XG4gICAgfVxuXG4gICAgXG4gICAgaWYgKGZpbGUuc3RhdC5zaXplID4gSW1hZ2VQcm9jZXNzb3IuTUFYX0ZJTEVfU0laRSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIkltYWdlIHRvbyBsYXJnZSAobWF4IDEwTUIpXCIsXG4gICAgICAgIFwiRklMRV9UT09fTEFSR0VcIixcbiAgICAgICAgNDEzXG4gICAgICApO1xuICAgIH1cblxuICAgIFxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCFJbWFnZVByb2Nlc3Nvci5TVVBQT1JURURfRk9STUFUUy5oYXMoZXh0ZW5zaW9uKSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIlVuc3VwcG9ydGVkIGltYWdlIGZvcm1hdFwiLFxuICAgICAgICBcIlVOU1VQUE9SVEVEX0ZPUk1BVFwiLFxuICAgICAgICA0MTVcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIFxuICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBhcHAudmF1bHQucmVhZEJpbmFyeShmaWxlKTtcblxuICAgICAgXG4gICAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBkYXRhVXJsID0gcmVhZGVyLnJlc3VsdCBhcyBzdHJpbmc7XG4gICAgICAgICAgcmVzb2x2ZShkYXRhVXJsKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiByZWplY3QocmVhZGVyLmVycm9yKTtcblxuICAgICAgICBcbiAgICAgICAgY29uc3QgdHlwZSA9IGBpbWFnZS8ke2V4dGVuc2lvbiA9PT0gXCJqcGdcIiA/IFwianBlZ1wiIDogZXh0ZW5zaW9ufWA7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdLCB7IHR5cGUgfSk7XG5cbiAgICAgICAgXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBiYXNlNjQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbWFnZSBwcm9jZXNzaW5nIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIkZhaWxlZCB0byBwcm9jZXNzIGltYWdlXCIsXG4gICAgICAgIFwiUFJPQ0VTU0lOR19FUlJPUlwiLFxuICAgICAgICA1MDBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIHByb2Nlc3NDbGlwYm9hcmRJbWFnZShcbiAgICBjbGlwYm9hcmREYXRhOiBEYXRhVHJhbnNmZXJcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBmaWxlID0gY2xpcGJvYXJkRGF0YS5maWxlc1swXTtcbiAgICBpZiAoIWZpbGUgfHwgIWZpbGUudHlwZS5zdGFydHNXaXRoKFwiaW1hZ2UvXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXCJObyBpbWFnZSBpbiBjbGlwYm9hcmRcIiwgXCJOT19JTUFHRVwiLCA0MDApO1xuICAgIH1cblxuICAgIGlmIChmaWxlLnNpemUgPiB0aGlzLk1BWF9GSUxFX1NJWkUpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJJbWFnZSB0b28gbGFyZ2UgKG1heCAxME1CKVwiLFxuICAgICAgICBcIkZJTEVfVE9PX0xBUkdFXCIsXG4gICAgICAgIDQxM1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nKTtcbiAgICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KHJlYWRlci5lcnJvcik7XG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9KTtcbiAgfVxufVxuIiwgIi8vIEJhc2UgVVJMIGZvciBBUEkgcmVxdWVzdHNcbmV4cG9ydCBjb25zdCBBUElfQkFTRV9VUkwgPVxuICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCJcbiAgICA/IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxL2FwaS92MVwiXG4gICAgOiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb20vYXBpL3YxXCI7XG5cbmV4cG9ydCBjb25zdCBTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUyA9IHtcbiAgTElDRU5TRToge1xuICAgIFZBTElEQVRFOiAoa2V5OiBzdHJpbmcpID0+IGAvYXBpL3YxL2xpY2Vuc2UvdmFsaWRhdGUvJHtrZXl9YCxcbiAgfSxcbiAgTU9ERUxTOiB7XG4gICAgTElTVDogXCIvYXBpL3YxL21vZGVsc1wiLFxuICAgIEdFVDogKG1vZGVsSWQ6IHN0cmluZykgPT4gYC9hcGkvdjEvbW9kZWxzLyR7bW9kZWxJZH1gLFxuICB9LFxuICBDSEFUOiB7XG4gICAgQ09NUExFVElPTlM6IFwiL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gIH0sXG4gIFNZU1RFTV9QUk9NUFRTOiB7XG4gICAgR0VUOiAoaWQ6IHN0cmluZykgPT4gYC9hcGkvdjEvc3lzdGVtLXByb21wdHMvJHtpZH1gLFxuICAgIExJU1Q6IFwiL2FwaS92MS9zeXN0ZW0tcHJvbXB0c1wiLFxuICB9LFxuICBET0NVTUVOVFM6IHtcbiAgICBQUk9DRVNTOiBcIi9hcGkvdjEvZG9jdW1lbnRzL3Byb2Nlc3NcIixcbiAgICBHRVQ6IChpZDogc3RyaW5nKSA9PiBgL2FwaS92MS9kb2N1bWVudHMvJHtpZH1gLFxuICAgIERPV05MT0FEOiAoaWQ6IHN0cmluZykgPT4gYC9hcGkvdjEvZG9jdW1lbnRzLyR7aWR9L2Rvd25sb2FkYCxcbiAgfSxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBPUEVOUk9VVEVSX0FQSV9FTkRQT0lOVFMgPSB7XG4gIENIQVQ6IHtcbiAgICBDT01QTEVUSU9OOiBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICAgIE1PREVMUzogXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL21vZGVsc1wiLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IExPQ0FMX0FQSV9FTkRQT0lOVFMgPSB7XG4gIENIQVQ6IHtcbiAgICBDT01QTEVUSU9OOiBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gICAgTU9ERUxTOiBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC92MS9tb2RlbHNcIixcbiAgfSxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpRXJyb3JEZXRhaWxzIHtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBjb2RlOiBzdHJpbmc7XG4gIHN0YXR1c0NvZGU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcGlSZXNwb25zZTxUPiB7XG4gIHN0YXR1czogXCJzdWNjZXNzXCIgfCBcImVycm9yXCI7XG4gIGRhdGE6IFQgfCBudWxsO1xuICBlcnJvcj86IEFwaUVycm9yRGV0YWlscztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaWNlbnNlVmFsaWRhdGlvblJlc3BvbnNlIHtcbiAgZW1haWw6IHN0cmluZztcbiAgY3JlZGl0c19iYWxhbmNlOiBudW1iZXI7XG4gIHN1YnNjcmlwdGlvbl9zdGF0dXM6IHN0cmluZztcbiAgbGljZW5zZV9rZXk6IHN0cmluZztcbiAgaXNfcHJvOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuQmFsYW5jZVJlc3BvbnNlIHtcbiAgYmFsYW5jZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoZWNrb3V0UmVzcG9uc2Uge1xuICBjaGVja291dFVybDogc3RyaW5nO1xuICBzZXNzaW9uSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcGVuUm91dGVyQ29tcGxldGlvblJlc3BvbnNlIHtcbiAgaWQ6IHN0cmluZztcbiAgY2hvaWNlczogQXJyYXk8e1xuICAgIG1lc3NhZ2U6IHtcbiAgICAgIHJvbGU6IHN0cmluZztcbiAgICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICB9O1xuICAgIGZpbmlzaF9yZWFzb246IHN0cmluZztcbiAgfT47XG59XG5cbmV4cG9ydCBjb25zdCBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMgPSB7XG4gIERFRkFVTFQ6IHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbiAgV0lUSF9MSUNFTlNFOiAobGljZW5zZUtleTogc3RyaW5nKSA9PiAoe1xuICAgIC4uLlNZU1RFTVNDVUxQVF9BUElfSEVBREVSUy5ERUZBVUxULFxuICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtsaWNlbnNlS2V5fWAsXG4gIH0pLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IE9QRU5ST1VURVJfQVBJX0hFQURFUlMgPSB7XG4gIERFRkFVTFQ6IChhcGlLZXk6IHN0cmluZykgPT4gKHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXBpS2V5fWAsXG4gICAgXCJIVFRQLVJlZmVyZXJcIjogXCJodHRwczovL3N5c3RlbXNjdWxwdC5jb21cIixcbiAgICBcIlgtVGl0bGVcIjogXCJTeXN0ZW1TY3VscHQgQVBJXCIsXG4gIH0pLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IExPQ0FMX0FQSV9IRUFERVJTID0ge1xuICBERUZBVUxUOiB7XG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIHJlcXVlc3RVcmwgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQge1xuICBDaGF0TWVzc2FnZSxcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG4gIFN5c3RlbVNjdWxwdFN0cmVhbUNodW5rLFxuICBTeXN0ZW1TY3VscHRTZXR0aW5ncyxcbiAgQ3VzdG9tUHJvdmlkZXIsXG59IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHtcbiAgU3lzdGVtU2N1bHB0RXJyb3IsXG4gIEVSUk9SX0NPREVTLFxuICBFcnJvckNvZGUsXG4gIGdldEVycm9yTWVzc2FnZSxcbn0gZnJvbSBcIi4uL3V0aWxzL2Vycm9yc1wiO1xuaW1wb3J0IHsgSW1hZ2VQcm9jZXNzb3IgfSBmcm9tIFwiLi4vdXRpbHMvSW1hZ2VQcm9jZXNzb3JcIjtcbmltcG9ydCB7XG4gIFNZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLFxuICBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMsXG4gIExpY2Vuc2VWYWxpZGF0aW9uUmVzcG9uc2UsXG59IGZyb20gXCIuLi9jb25zdGFudHMvYXBpXCI7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpOiBzdHJpbmcge1xuICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1TY3VscHRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBsaWNlbnNlS2V5OiBzdHJpbmc7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzO1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSBzdGF0aWMgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xuICBwcml2YXRlIGlzSW5zaWRlVGhpbmtUYWdzID0gZmFsc2U7XG4gIHByaXZhdGUgaGFzTG9nZ2VkRGV2TW9kZSA9IGZhbHNlOyAvLyBUcmFjayBpZiB3ZSd2ZSBsb2dnZWQgZGV2IG1vZGUgc3RhdHVzXG5cbiAgcHVibGljIGdldCBiYXNlVXJsKCk6IHN0cmluZyB7XG4gICAgLy8gT25seSBsb2cgZGV2IG1vZGUgc3RhdHVzIG9uY2VcbiAgICBpZiAoIXRoaXMuaGFzTG9nZ2VkRGV2TW9kZSkge1xuICAgICAgdGhpcy5oYXNMb2dnZWREZXZNb2RlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBJZiBpbiBkZXZlbG9wbWVudCBtb2RlLCB1c2Ugc2VydmVyVXJsICh3aGljaCBkZWZhdWx0cyB0byBsb2NhbGhvc3Q6MzAwMSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnNlcnZlclVybDtcbiAgICB9XG5cbiAgICAvLyBJbiBwcm9kdWN0aW9uLCB1c2UgdGhlIHByb2R1Y3Rpb24gVVJMXG4gICAgcmV0dXJuIFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICB9XG5cbiAgcHVibGljIGdldCBleHRyYWN0aW9uc0RpcmVjdG9yeSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnNldHRpbmdzLmV4dHJhY3Rpb25zRGlyZWN0b3J5ID8/IFwiXCI7XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncywgYXBwOiBBcHApIHtcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgdGhpcy5saWNlbnNlS2V5ID0gc2V0dGluZ3MubGljZW5zZUtleTtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShcbiAgICBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MsXG4gICAgYXBwOiBBcHBcbiAgKTogU3lzdGVtU2N1bHB0U2VydmljZSB7XG4gICAgaWYgKCFTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFN5c3RlbVNjdWxwdFNlcnZpY2Uoc2V0dGluZ3MsIGFwcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2Uuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgIFN5c3RlbVNjdWxwdFNlcnZpY2UuaW5zdGFuY2UubGljZW5zZUtleSA9IHNldHRpbmdzLmxpY2Vuc2VLZXk7XG4gICAgfVxuICAgIHJldHVybiBTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZVNldHRpbmdzKHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyk6IHZvaWQge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLmxpY2Vuc2VLZXkgPSBzZXR0aW5ncy5saWNlbnNlS2V5O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBtYWtlUmVxdWVzdDxUPihcbiAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIG1ldGhvZD86IHN0cmluZztcbiAgICAgIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICAgICAgYm9keT86IHN0cmluZztcbiAgICAgIHNob3dOb3RpY2VzPzogYm9vbGVhbjtcbiAgICAgIHJlcXVpcmVzUHJvPzogYm9vbGVhbjtcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgaWYgKG9wdGlvbnMucmVxdWlyZXNQcm8gJiYgIWVuZHBvaW50LmluY2x1ZGVzKFwiL2xpY2Vuc2UvdmFsaWRhdGVcIikpIHtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGljZW5zZSh0cnVlKTtcbiAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLlBST19SRVFVSVJFRCksXG4gICAgICAgICAgRVJST1JfQ09ERVMuUFJPX1JFUVVJUkVELFxuICAgICAgICAgIDQwM1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGhlYWRlcnMgPSB0aGlzLmxpY2Vuc2VLZXlcbiAgICAgID8gU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLldJVEhfTElDRU5TRSh0aGlzLmxpY2Vuc2VLZXkpXG4gICAgICA6IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUy5ERUZBVUxUO1xuXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfSR7ZW5kcG9pbnR9YDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3RVcmwoe1xuICAgICAgdXJsLFxuICAgICAgbWV0aG9kOiBvcHRpb25zLm1ldGhvZCB8fCBcIkdFVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAuLi5oZWFkZXJzLFxuICAgICAgICAuLi4ob3B0aW9ucy5oZWFkZXJzIHx8IHt9KSxcbiAgICAgIH0sXG4gICAgICBib2R5OiBvcHRpb25zLmJvZHksXG4gICAgICB0aHJvdzogZmFsc2UsXG4gICAgfSk7XG5cbiAgICBsZXQgYXBpUmVzcG9uc2U6IGFueTtcbiAgICB0cnkge1xuICAgICAgYXBpUmVzcG9uc2UgPSByZXNwb25zZS5qc29uO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLklOVkFMSURfUkVTUE9OU0UpLFxuICAgICAgICBFUlJPUl9DT0RFUy5JTlZBTElEX1JFU1BPTlNFLFxuICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwIHx8IGFwaVJlc3BvbnNlLnN0YXR1cyA9PT0gXCJlcnJvclwiKSB7XG4gICAgICB0aGlzLmhhbmRsZUFwaUVycm9yKGVuZHBvaW50LCByZXNwb25zZSwgYXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSByZXNwb25zZSBpcyB3cmFwcGVkIGluIGEgZGF0YSBmaWVsZCwgcmV0dXJuIHRoYXQsIG90aGVyd2lzZSByZXR1cm4gdGhlIHdob2xlIHJlc3BvbnNlXG4gICAgcmV0dXJuIChcbiAgICAgIGFwaVJlc3BvbnNlLmRhdGEgIT09IHVuZGVmaW5lZCA/IGFwaVJlc3BvbnNlLmRhdGEgOiBhcGlSZXNwb25zZVxuICAgICkgYXMgVDtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQXBpRXJyb3IoXG4gICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICByZXNwb25zZTogeyBzdGF0dXM6IG51bWJlciB9LFxuICAgIGFwaVJlc3BvbnNlOiBhbnlcbiAgKTogbmV2ZXIge1xuICAgIGlmIChhcGlSZXNwb25zZS5lcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JDb2RlID0gKGFwaVJlc3BvbnNlLmVycm9yLmNvZGUgfHxcbiAgICAgICAgRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUikgYXMgRXJyb3JDb2RlO1xuICAgICAgY29uc3Qgc3RhdHVzQ29kZSA9IGFwaVJlc3BvbnNlLmVycm9yLnN0YXR1c0NvZGUgfHwgcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2V0RXJyb3JNZXNzYWdlKGVycm9yQ29kZSwgYXBpUmVzcG9uc2UuZXJyb3IubW9kZWwpO1xuXG4gICAgICBjb25zdCBtZXRhZGF0YTogU3lzdGVtU2N1bHB0RXJyb3JbXCJtZXRhZGF0YVwiXSA9IHt9O1xuXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9SRVFVRVNUX0VSUk9SXG4gICAgICApIHtcbiAgICAgICAgbWV0YWRhdGEuc2hvdWxkUmVzdWJtaXQgPSB0cnVlO1xuICAgICAgICBtZXRhZGF0YS5tb2RlbCA9IGFwaVJlc3BvbnNlLmVycm9yLm1vZGVsO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICBzdGF0dXNDb2RlLFxuICAgICAgICBtZXRhZGF0YVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUiksXG4gICAgICBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SLFxuICAgICAgcmVzcG9uc2Uuc3RhdHVzXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU3RyZWFtRXJyb3IoXG4gICAgcmVzcG9uc2U6IFJlc3BvbnNlLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBQcm9taXNlPG5ldmVyPiB7XG4gICAgLy8gTG9nIHJhdyByZXNwb25zZSBmaXJzdFxuICAgIGNvbnNvbGUuZXJyb3IoXCJTdHJlYW0gZXJyb3IgcmVzcG9uc2U6XCIsIHtcbiAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgIGNvbnRlbnRUeXBlOiByZXNwb25zZS5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSxcbiAgICAgIGlzQ3VzdG9tUHJvdmlkZXIsXG4gICAgfSk7XG5cbiAgICBsZXQgZXJyb3JDb2RlOiBFcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1I7XG4gICAgbGV0IG1ldGFkYXRhOiBTeXN0ZW1TY3VscHRFcnJvcltcIm1ldGFkYXRhXCJdID0ge307XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgY29uc29sZS5lcnJvcihcIlN0cmVhbSBlcnJvciBkYXRhOlwiLCBlcnJvckRhdGEpO1xuXG4gICAgICAvLyBIYW5kbGUgY3VzdG9tIHByb3ZpZGVyIGVycm9yc1xuICAgICAgaWYgKGlzQ3VzdG9tUHJvdmlkZXIpIHtcbiAgICAgICAgLy8gUHJlc2VydmUgcmF3IGVycm9yIGRhdGFcbiAgICAgICAgbWV0YWRhdGEucmF3RXJyb3IgPSBlcnJvckRhdGE7XG4gICAgICAgIG1ldGFkYXRhLnByb3ZpZGVyID0gXCJjdXN0b21cIjtcblxuICAgICAgICAvLyBDb21tb24gZXJyb3Igc3RhdHVzIGNvZGVzIGZvciBPcGVuQUktY29tcGF0aWJsZSBBUElzXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgIGVycm9yQ29kZSA9IEVSUk9SX0NPREVTLklOVkFMSURfTElDRU5TRTtcbiAgICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgXCJJbnZhbGlkIEFQSSBrZXkgZm9yIGN1c3RvbSBwcm92aWRlclwiLFxuICAgICAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuUVVPVEFfRVhDRUVERUQ7XG4gICAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgICAgZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8XG4gICAgICAgICAgICAgIFwiUmF0ZSBsaW1pdCBleGNlZWRlZCBmb3IgY3VzdG9tIHByb3ZpZGVyXCIsXG4gICAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICBlcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRTtcbiAgICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgXCJNb2RlbCBub3QgZm91bmQgb3IgZW5kcG9pbnQgaW5jb3JyZWN0XCIsXG4gICAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3Igb3RoZXIgZXJyb3JzLCBwYXNzIHRocm91Z2ggdGhlIHByb3ZpZGVyJ3MgZXJyb3IgbWVzc2FnZVxuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3JEYXRhLmVycm9yKSB7XG4gICAgICAgIGVycm9yQ29kZSA9IChlcnJvckRhdGEuZXJyb3IuY29kZSB8fFxuICAgICAgICAgIEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUikgYXMgRXJyb3JDb2RlO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFIHx8XG4gICAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9SRVFVRVNUX0VSUk9SXG4gICAgICAgICkge1xuICAgICAgICAgIG1ldGFkYXRhID0ge1xuICAgICAgICAgICAgbW9kZWw6IGVycm9yRGF0YS5lcnJvci5tb2RlbCxcbiAgICAgICAgICAgIHNob3VsZFJlc3VibWl0OiB0cnVlLFxuICAgICAgICAgICAgcmF3RXJyb3I6IGVycm9yRGF0YSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gTG9nIHBhcnNlIGVycm9yXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcGFyc2luZyBlcnJvciByZXNwb25zZTpcIiwgZSk7XG5cbiAgICAgIC8vIElmIHdlIGNhbid0IHBhcnNlIHRoZSBlcnJvciByZXNwb25zZSBvciBpdCdzIGFscmVhZHkgYSBTeXN0ZW1TY3VscHRFcnJvciwgdGhyb3cgaXRcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIC8vIE90aGVyd2lzZSB1c2UgZGVmYXVsdCBzdHJlYW0gZXJyb3JcbiAgICAgIGVycm9yQ29kZSA9IEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUjtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBtZXRhZGF0YS5tb2RlbCksXG4gICAgICBlcnJvckNvZGUsXG4gICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICBtZXRhZGF0YVxuICAgICk7XG4gIH1cblxuICBhc3luYyB2YWxpZGF0ZUxpY2Vuc2UoZm9yY2VDaGVjayA9IGZhbHNlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmxpY2Vuc2VLZXkpIHJldHVybiBmYWxzZTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PExpY2Vuc2VWYWxpZGF0aW9uUmVzcG9uc2U+KFxuICAgICAgICBTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5MSUNFTlNFLlZBTElEQVRFKHRoaXMubGljZW5zZUtleSksXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgaGVhZGVyczogU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLldJVEhfTElDRU5TRSh0aGlzLmxpY2Vuc2VLZXkpLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0TW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgcmVndWxhciBtb2RlbHNcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDx7IG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSB9PihcbiAgICAgICAgXCIvYXBpL3YxL21vZGVsc1wiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlIHx8ICFBcnJheS5pc0FycmF5KHJlc3BvbnNlLm1vZGVscykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5JTlZBTElEX1JFU1BPTlNFKSxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5JTlZBTElEX1JFU1BPTlNFLFxuICAgICAgICAgIDUwMFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgcHJvdmlkZXIgdG8gc3lzdGVtc2N1bHB0IGZvciBvdXIgbW9kZWxzXG4gICAgICBjb25zdCBzeXN0ZW1zY3VscHRNb2RlbHMgPSByZXNwb25zZS5tb2RlbHMubWFwKChtb2RlbCkgPT4gKHtcbiAgICAgICAgLi4ubW9kZWwsXG4gICAgICAgIHByb3ZpZGVyOiBcInN5c3RlbXNjdWxwdFwiLFxuICAgICAgfSkpO1xuXG4gICAgICAvLyBSZXR1cm4gb25seSBzeXN0ZW0gbW9kZWxzXG4gICAgICByZXR1cm4gc3lzdGVtc2N1bHB0TW9kZWxzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRUb2tlbkJhbGFuY2UoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpY2Vuc2UodHJ1ZSk7XG4gICAgaWYgKCFpc1ZhbGlkKSByZXR1cm4gMDtcblxuICAgIC8vIHJlLXZhbGlkYXRlIHRvIGdldCBmcmVzaCBsaWNlbnNlIGRhdGFcbiAgICBjb25zdCBsaWNlbnNlSW5mbyA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8TGljZW5zZVZhbGlkYXRpb25SZXNwb25zZT4oXG4gICAgICBTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5MSUNFTlNFLlZBTElEQVRFKHRoaXMubGljZW5zZUtleSksXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgaGVhZGVyczogU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTLldJVEhfTElDRU5TRSh0aGlzLmxpY2Vuc2VLZXkpLFxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGxpY2Vuc2VJbmZvLmNyZWRpdHNfYmFsYW5jZSB8fCAwO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDb250ZXh0RmlsZUNvbnRlbnRzKFxuICAgIGZpbGVQYXRoOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsIHwgeyB0eXBlOiBcImltYWdlXCI7IGJhc2U2NDogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW4gdGhlIHdpa2ktbGluayBmb3JtYXQ6IFtbcGF0aF1dIC0+IHBhdGhcbiAgICAgIGNvbnN0IGxpbmtUZXh0ID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG5cbiAgICAgIC8vIFJlbW92ZSBhbnkgbWF0aCBkaXNwbGF5IG1hcmtlcnMgaWYgcHJlc2VudFxuICAgICAgY29uc3QgY2xlYW5QYXRoID0gbGlua1RleHQucmVwbGFjZShcbiAgICAgICAgL1xcJGJlZ2luOm1hdGg6ZGlzcGxheVxcJFxcWyguKj8pXFwkZW5kOm1hdGg6ZGlzcGxheVxcJF0vZyxcbiAgICAgICAgXCIkMVwiXG4gICAgICApO1xuXG4gICAgICAvLyBUcnkgdG8gcmVzb2x2ZSB0aGUgZmlsZSB1c2luZyB0aGUgY2xlYW5lZCBwYXRoXG4gICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICBjbGVhblBhdGgsXG4gICAgICAgIFwiXCJcbiAgICAgICk7XG5cbiAgICAgIGlmIChyZXNvbHZlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBpZiAocmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi5tYXRjaCgvXihqcGd8anBlZ3xwbmd8Z2lmfHdlYnApJC9pKSkge1xuICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IEltYWdlUHJvY2Vzc29yLnByb2Nlc3NJbWFnZShcbiAgICAgICAgICAgIHJlc29sdmVkRmlsZSxcbiAgICAgICAgICAgIHRoaXMuYXBwXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4geyB0eXBlOiBcImltYWdlXCIsIGJhc2U2NCB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKHJlc29sdmVkRmlsZSk7XG4gICAgICAgIHJldHVybiBjb250ZW50O1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBmaWxlIG5vdCBmb3VuZCwgdHJ5IHJlc29sdmluZyB3aXRob3V0IHRoZSBmb2xkZXIgc3RydWN0dXJlXG4gICAgICBjb25zdCBmaWxlTmFtZSA9IGNsZWFuUGF0aC5zcGxpdChcIi9cIikucG9wKCk7XG4gICAgICBpZiAoZmlsZU5hbWUpIHtcbiAgICAgICAgY29uc3QgYWxsRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpO1xuICAgICAgICBjb25zdCBtYXRjaGluZ0ZpbGUgPSBhbGxGaWxlcy5maW5kKChmKSA9PiBmLm5hbWUgPT09IGZpbGVOYW1lKTtcbiAgICAgICAgaWYgKG1hdGNoaW5nRmlsZSkge1xuICAgICAgICAgIGlmIChtYXRjaGluZ0ZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9eKGpwZ3xqcGVnfHBuZ3xnaWZ8d2VicCkkL2kpKSB7XG4gICAgICAgICAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCBJbWFnZVByb2Nlc3Nvci5wcm9jZXNzSW1hZ2UoXG4gICAgICAgICAgICAgIG1hdGNoaW5nRmlsZSxcbiAgICAgICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4geyB0eXBlOiBcImltYWdlXCIsIGJhc2U2NCB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChtYXRjaGluZ0ZpbGUpO1xuICAgICAgICAgIHJldHVybiBjb250ZW50O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGJ1aWxkQ29udGV4dE1lc3NhZ2VGcm9tRmlsZShcbiAgICBmaWxlUGF0aDogc3RyaW5nXG4gICk6IFByb21pc2U8Q2hhdE1lc3NhZ2UgfCBudWxsPiB7XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dEZpbGVDb250ZW50cyhmaWxlUGF0aCk7XG4gICAgY29uc3QgZGlzcGxheU5hbWUgPSBmaWxlUGF0aC5yZXBsYWNlKFxuICAgICAgL1xcJGJlZ2luOm1hdGg6ZGlzcGxheVxcJFxcWyguKj8pXFwkZW5kOm1hdGg6ZGlzcGxheVxcJF0vZyxcbiAgICAgIFwiJDFcIlxuICAgICk7XG5cbiAgICBpZiAoY29udGVudCkge1xuICAgICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogYENvbnRleHQgZnJvbSAke2Rpc3BsYXlOYW1lfTpcXG5cXG4ke2NvbnRlbnR9YCxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBnZW5lcmF0ZVVVSUQoKSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAoY29udGVudC50eXBlID09PSBcImltYWdlXCIpIHtcbiAgICAgICAgLy8gQ29uc3RydWN0IGEgXCJ0eXBlOmltYWdlX3VybFwiIGFycmF5IGVudHJ5OlxuICAgICAgICAvLyBPcHRpb25hbGx5IHByZWZpeCB3aXRoIGEgXCJ0eXBlOnRleHRcIiBlbnRyeSBmb3IgYW55IGxhYmVsIG9yIG1lbnRpb24gb2YgdGhlIGZpbGVcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgICB0ZXh0OiBgQ29udGV4dCBmcm9tICR7ZGlzcGxheU5hbWV9OlxcblxcbmAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcImltYWdlX3VybFwiLFxuICAgICAgICAgICAgICBpbWFnZV91cmw6IHtcbiAgICAgICAgICAgICAgICAvLyBJZiBwb3NzaWJsZSwgcHJlZml4IHdpdGggZGF0YTppbWFnZS88ZXh0PlxuICAgICAgICAgICAgICAgIHVybDogYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2NvbnRlbnQuYmFzZTY0LnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICAvXmRhdGE6Lio7YmFzZTY0LC8sXG4gICAgICAgICAgICAgICAgICBcIlwiXG4gICAgICAgICAgICAgICAgKX1gLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJlcGFyZU1lc3NhZ2VzV2l0aENvbnRleHQoXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10sXG4gICAgY29udGV4dEZpbGVzOiBTZXQ8c3RyaW5nPixcbiAgICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nLFxuICAgIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxDaGF0TWVzc2FnZVtdPiB7XG4gICAgY29uc3QgcHJlcGFyZWRNZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtdO1xuXG4gICAgLy8gQWRkIHN5c3RlbSBtZXNzYWdlIGZpcnN0XG4gICAgbGV0IHN5c3RlbVByb21wdENvbnRlbnQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBpZiAoc3lzdGVtUHJvbXB0VHlwZSA9PT0gXCJjdXN0b21cIiAmJiBzeXN0ZW1Qcm9tcHRQYXRoKSB7XG4gICAgICAvLyBGb3IgY3VzdG9tIHByb21wdHMsIHJlYWQgZnJvbSB0aGUgZmlsZVxuICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgdGhlIGZpbGUgdXNpbmcgdGhlIGNsZWFuZWQgcGF0aFxuICAgICAgY29uc3QgcmVzb2x2ZWRGaWxlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgICAgXCJcIlxuICAgICAgKTtcblxuICAgICAgaWYgKHJlc29sdmVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKHJlc29sdmVkRmlsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBub3QgZm91bmQsIHRyeSB3aXRoIC5tZCBleHRlbnNpb25cbiAgICAgICAgY29uc3QgZmlsZVdpdGhFeHQgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoXG4gICAgICAgICAgYCR7c3lzdGVtUHJvbXB0UGF0aH0ubWRgXG4gICAgICAgICk7XG4gICAgICAgIGlmIChmaWxlV2l0aEV4dCBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZVdpdGhFeHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRyeSBpbiB0aGUgc3lzdGVtIHByb21wdHMgZGlyZWN0b3J5XG4gICAgICAgICAgY29uc3QgZmlsZUluU3lzdGVtUHJvbXB0c0RpciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgICAgIGBTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHMvJHtzeXN0ZW1Qcm9tcHRQYXRofS5tZGBcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChmaWxlSW5TeXN0ZW1Qcm9tcHRzRGlyIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKFxuICAgICAgICAgICAgICBmaWxlSW5TeXN0ZW1Qcm9tcHRzRGlyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3lzdGVtUHJvbXB0VHlwZSkge1xuICAgICAgLy8gRm9yIG5vbi1jdXN0b20gcHJvbXB0cywgZmV0Y2ggZnJvbSBzZXJ2ZXJcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gSWdub3JlIGVycm9yIGFuZCBjb250aW51ZSB3aXRob3V0IHN5c3RlbSBwcm9tcHRcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgc3lzdGVtIG1lc3NhZ2UgaWYgd2UgaGF2ZSBjb250ZW50XG4gICAgaWYgKHN5c3RlbVByb21wdENvbnRlbnQpIHtcbiAgICAgIHByZXBhcmVkTWVzc2FnZXMucHVzaCh7XG4gICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgIGNvbnRlbnQ6IHN5c3RlbVByb21wdENvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGUsXG4gICAgICAgIHN5c3RlbVByb21wdFBhdGgsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIGNvbnRleHQgZmlsZXMgYW5kIGNvbGxlY3QgZG9jdW1lbnQgSURzIGZvciB0aGUgc2VydmVyXG4gICAgY29uc3QgZG9jdW1lbnRJZHM6IHN0cmluZ1tdID0gW107XG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBjb250ZXh0RmlsZXMpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBkb2N1bWVudCByZWZlcmVuY2UgKHN0YXJ0cyB3aXRoIFwiZG9jOlwiKVxuICAgICAgaWYgKGZpbGVQYXRoLnN0YXJ0c1dpdGgoXCJkb2M6XCIpKSB7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50SWQgPSBmaWxlUGF0aC5zdWJzdHJpbmcoNCk7XG4gICAgICAgIGRvY3VtZW50SWRzLnB1c2goZG9jdW1lbnRJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBIYW5kbGUgcmVndWxhciBmaWxlIGNvbnRleHRzIGFzIGJlZm9yZVxuICAgICAgICBjb25zdCBjb250ZXh0TWVzc2FnZSA9IGF3YWl0IHRoaXMuYnVpbGRDb250ZXh0TWVzc2FnZUZyb21GaWxlKGZpbGVQYXRoKTtcbiAgICAgICAgaWYgKGNvbnRleHRNZXNzYWdlKSB7XG4gICAgICAgICAgcHJlcGFyZWRNZXNzYWdlcy5wdXNoKGNvbnRleHRNZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCBkb2N1bWVudCBjb250ZXh0IHRvIHRoZSBmaXJzdCBtZXNzYWdlIGlmIHdlIGhhdmUgZG9jdW1lbnQgSURzXG4gICAgaWYgKGRvY3VtZW50SWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpcnN0TWVzc2FnZSA9IG1lc3NhZ2VzWzBdO1xuICAgICAgaWYgKGZpcnN0TWVzc2FnZSkge1xuICAgICAgICBmaXJzdE1lc3NhZ2UuZG9jdW1lbnRDb250ZXh0ID0geyBkb2N1bWVudElkcyB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgYWN0dWFsIGNoYXQgbWVzc2FnZXNcbiAgICBmb3IgKGNvbnN0IG1zZyBvZiBtZXNzYWdlcykge1xuICAgICAgcHJlcGFyZWRNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgcm9sZTogbXNnLnJvbGUsXG4gICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50LFxuICAgICAgICBtZXNzYWdlX2lkOiBtc2cubWVzc2FnZV9pZCB8fCBnZW5lcmF0ZVVVSUQoKSxcbiAgICAgICAgZG9jdW1lbnRDb250ZXh0OiBtc2cuZG9jdW1lbnRDb250ZXh0LFxuICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlOiBtc2cuc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aDogbXNnLnN5c3RlbVByb21wdFBhdGgsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJlcGFyZWRNZXNzYWdlcztcbiAgfVxuXG4gIHByaXZhdGUgbm9ybWFsaXplRGF0YVByZWZpeChsaW5lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICghbGluZT8udHJpbSgpKSByZXR1cm4gXCJcIjtcbiAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XG5cbiAgICAvLyBTa2lwIHNwZWNpYWwgbWVzc2FnZXNcbiAgICBpZiAoXG4gICAgICB0cmltbWVkID09PSBcImRhdGE6XCIgfHxcbiAgICAgIHRyaW1tZWQgPT09IFwiZGF0YTogXCIgfHxcbiAgICAgIHRyaW1tZWQgPT09IFwiW0RPTkVdXCIgfHxcbiAgICAgIHRyaW1tZWQuc3RhcnRzV2l0aChcIjogT1BFTlJPVVRFUlwiKVxuICAgICkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyaW1tZWQucmVwbGFjZSgvXig/OmRhdGE6XFxzKikrLywgXCJcIik7XG4gIH1cblxuICBwcml2YXRlIGlzVmFsaWRTdHJlYW1FdmVudChkYXRhOiBzdHJpbmcsIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZSk6IGJvb2xlYW4ge1xuICAgIGlmICghZGF0YSkgcmV0dXJuIGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAvLyBBbGwgcHJvdmlkZXJzIHVzZSBPcGVuQUkgZm9ybWF0XG4gICAgICByZXR1cm4gISEoXG4gICAgICAgIHBhcnNlZCAmJlxuICAgICAgICAocGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LmNvbnRlbnQgfHxcbiAgICAgICAgICBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8ucmVhc29uaW5nIHx8XG4gICAgICAgICAgcGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LmZ1bmN0aW9uX2NhbGwgfHxcbiAgICAgICAgICBwYXJzZWQuZXJyb3IpXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHByb2Nlc3NTdHJlYW1MaW5lKFxuICAgIGxpbmU6IHN0cmluZyxcbiAgICBpc0N1c3RvbVByb3ZpZGVyID0gZmFsc2VcbiAgKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKCFsaW5lLnRyaW0oKS5zdGFydHNXaXRoKFwiZGF0YTpcIikpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB0aGlzLm5vcm1hbGl6ZURhdGFQcmVmaXgobGluZSk7XG4gICAgcmV0dXJuIHRoaXMuaXNWYWxpZFN0cmVhbUV2ZW50KG5vcm1hbGl6ZWQsIGlzQ3VzdG9tUHJvdmlkZXIpXG4gICAgICA/IG5vcm1hbGl6ZWRcbiAgICAgIDogbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU3RyZWFtRXZlbnQoXG4gICAgZXZlbnQ6IHN0cmluZyxcbiAgICBtb2RlbDogc3RyaW5nLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBQcm9taXNlPHsgY29udGVudDogc3RyaW5nIHwgbnVsbDsgcmVhc29uaW5nOiBzdHJpbmcgfCBudWxsIH0gfCBudWxsPiB7XG4gICAgaWYgKCFldmVudCkgcmV0dXJuIG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgbGV0IHBhcnNlZDogU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bms7XG4gICAgICB0cnkge1xuICAgICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGV2ZW50KTtcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICghcGFyc2VkKSByZXR1cm4gbnVsbDtcblxuICAgICAgLy8gSGFuZGxlIGVycm9yc1xuICAgICAgaWYgKHBhcnNlZC5lcnJvcikge1xuICAgICAgICBjb25zdCBlcnJvckNvZGUgPSAocGFyc2VkLmVycm9yLmNvZGUgfHxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IpIGFzIEVycm9yQ29kZTtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgcGFyc2VkLmVycm9yLm1lc3NhZ2UgfHwgZ2V0RXJyb3JNZXNzYWdlKGVycm9yQ29kZSwgbW9kZWwpO1xuXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0ge1xuICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgIHNob3VsZFJlc3VibWl0OiBmYWxzZSxcbiAgICAgICAgICByYXdFcnJvcjogcGFyc2VkLmVycm9yLFxuICAgICAgICAgIG9yaWdpbmFsRXZlbnQ6IGV2ZW50LFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFIHx8XG4gICAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9SRVFVRVNUX0VSUk9SXG4gICAgICAgICkge1xuICAgICAgICAgIG1ldGFkYXRhLnNob3VsZFJlc3VibWl0ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICAgIHBhcnNlZC5lcnJvci5zdGF0dXNDb2RlIHx8IDUwMCxcbiAgICAgICAgICBtZXRhZGF0YVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBBbGwgcHJvdmlkZXJzIHVzZSBPcGVuQUkgZm9ybWF0XG4gICAgICBjb25zdCBjb250ZW50ID0gcGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LmNvbnRlbnQgfHwgbnVsbDtcbiAgICAgIGNvbnN0IHJlYXNvbmluZyA9IHBhcnNlZC5jaG9pY2VzPy5bMF0/LmRlbHRhPy5yZWFzb25pbmcgfHwgbnVsbDtcblxuICAgICAgLy8gSWYgd2UncmUgaW4gdGhpbmsgbW9kZSwgYWxsIGNvbnRlbnQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgcmVhc29uaW5nIHVudGlsIHdlIHNlZSA8L3RoaW5rPlxuICAgICAgaWYgKHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MpIHtcbiAgICAgICAgLy8gQ2hlY2sgYm90aCBjb250ZW50IGFuZCByZWFzb25pbmcgZm9yIDwvdGhpbms+XG4gICAgICAgIGxldCBjb21iaW5lZFRleHQgPSBcIlwiO1xuICAgICAgICBpZiAocmVhc29uaW5nKSBjb21iaW5lZFRleHQgKz0gcmVhc29uaW5nO1xuICAgICAgICBpZiAoY29udGVudCkgY29tYmluZWRUZXh0ICs9IGNvbnRlbnQ7XG5cbiAgICAgICAgY29uc3QgdGhpbmtFbmRNYXRjaCA9IGNvbWJpbmVkVGV4dC5tYXRjaCgvKC4qPylcXHMqPFxcL3RoaW5rPlxccyooLiopLyk7XG4gICAgICAgIGlmICh0aGlua0VuZE1hdGNoKSB7XG4gICAgICAgICAgdGhpcy5pc0luc2lkZVRoaW5rVGFncyA9IGZhbHNlO1xuICAgICAgICAgIC8vIEV2ZXJ5dGhpbmcgYmVmb3JlIDwvdGhpbms+IGlzIHJlYXNvbmluZywgZXZlcnl0aGluZyBhZnRlciBpcyBjb250ZW50XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlYXNvbmluZzogdGhpbmtFbmRNYXRjaFsxXSB8fCBcIlwiLFxuICAgICAgICAgICAgY29udGVudDogdGhpbmtFbmRNYXRjaFsyXSB8fCBcIlwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBubyA8L3RoaW5rPiBmb3VuZCwgZXZlcnl0aGluZyBpcyBzdGlsbCByZWFzb25pbmdcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjb250ZW50OiBudWxsLFxuICAgICAgICAgIHJlYXNvbmluZzogY29tYmluZWRUZXh0IHx8IG51bGwsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDaGVjayBpZiBjb250ZW50IGNvbnRhaW5zIDx0aGluaz5cbiAgICAgICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgICAgICBjb25zdCB0aGlua1N0YXJ0TWF0Y2ggPSBjb250ZW50Lm1hdGNoKC88dGhpbms+XFxzKiguKikvKTtcbiAgICAgICAgICBpZiAodGhpbmtTdGFydE1hdGNoKSB7XG4gICAgICAgICAgICB0aGlzLmlzSW5zaWRlVGhpbmtUYWdzID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgICAgIHJlYXNvbmluZzogdGhpbmtTdGFydE1hdGNoWzFdIHx8IFwiXCIsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBjb250ZW50LCByZWFzb25pbmcgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yKSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NTdHJlYW1DaHVuayhcbiAgICBjaHVuazogVWludDhBcnJheSxcbiAgICBidWZmZXI6IHN0cmluZyxcbiAgICBtb2RlbDogc3RyaW5nLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBQcm9taXNlPHtcbiAgICBuZXdCdWZmZXI6IHN0cmluZztcbiAgICBjb250ZW50czogc3RyaW5nW107XG4gICAgcmVhc29uaW5nczogc3RyaW5nW107XG4gIH0+IHtcbiAgICBjb25zdCBkZWNvZGVkID0gU3lzdGVtU2N1bHB0U2VydmljZS5kZWNvZGVyLmRlY29kZShjaHVuaywgeyBzdHJlYW06IHRydWUgfSk7XG4gICAgY29uc3QgZnVsbENodW5rID0gYnVmZmVyICsgZGVjb2RlZDtcblxuICAgIGNvbnN0IGxpbmVzID0gZnVsbENodW5rLnNwbGl0KFwiXFxuXCIpO1xuICAgIGNvbnN0IGNvbnRlbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHJlYXNvbmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBQcm9jZXNzIGFsbCBsaW5lcyBleGNlcHQgcG90ZW50aWFsbHkgaW5jb21wbGV0ZSBsYXN0IGxpbmVcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLnByb2Nlc3NTdHJlYW1MaW5lKGxpbmVzW2ldLCBpc0N1c3RvbVByb3ZpZGVyKTtcbiAgICAgIGlmIChldmVudCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmhhbmRsZVN0cmVhbUV2ZW50KFxuICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgIGlzQ3VzdG9tUHJvdmlkZXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIGlmIChyZXN1bHQuY29udGVudCkgY29udGVudHMucHVzaChyZXN1bHQuY29udGVudCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5yZWFzb25pbmcpIHJlYXNvbmluZ3MucHVzaChyZXN1bHQucmVhc29uaW5nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEtlZXAgbGFzdCBsaW5lIGFzIGJ1ZmZlciBpZiBub24tZW1wdHlcbiAgICBjb25zdCBuZXdCdWZmZXIgPSBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXS50cmltKClcbiAgICAgID8gbGluZXNbbGluZXMubGVuZ3RoIC0gMV1cbiAgICAgIDogXCJcIjtcblxuICAgIHJldHVybiB7IG5ld0J1ZmZlciwgY29udGVudHMsIHJlYXNvbmluZ3MgfTtcbiAgfVxuXG4gIHByaXZhdGUgc3RyaXBQcm92aWRlclByZWZpeGVzKG1vZGVsSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gT25seSByZW1vdmUgdGhlIG9wZW5yb3V0ZXIvIHByZWZpeCwga2VlcCB0aGUgcHJvdmlkZXIgaWRlbnRpZmllclxuICAgIHJldHVybiBtb2RlbElkLnJlcGxhY2UoL15vcGVucm91dGVyXFwvLywgXCJcIik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldE1vZGVsSW5mbyhtb2RlbElkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICBpc0N1c3RvbTogYm9vbGVhbjtcbiAgICBwcm92aWRlcj86IEN1c3RvbVByb3ZpZGVyO1xuICAgIGFjdHVhbE1vZGVsSWQ6IHN0cmluZztcbiAgfT4ge1xuICAgIC8vIEZvciBjdXN0b20gcHJvdmlkZXJzLCBmaW5kIHRoZSBhY3RpdmUgb25lXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIudHlwZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgY29uc3QgYWN0aXZlUHJvdmlkZXIgPSB0aGlzLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maW5kKFxuICAgICAgICAocCkgPT4gcC5pZCA9PT0gdGhpcy5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci5pZCAmJiBwLmlzRW5hYmxlZFxuICAgICAgKTtcblxuICAgICAgaWYgKCFhY3RpdmVQcm92aWRlcikge1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgYFByb3ZpZGVyICR7dGhpcy5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci5uYW1lfSBub3QgZm91bmQgb3IgZGlzYWJsZWRgLFxuICAgICAgICAgIEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFLFxuICAgICAgICAgIDQwNFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0N1c3RvbTogdHJ1ZSxcbiAgICAgICAgcHJvdmlkZXI6IGFjdGl2ZVByb3ZpZGVyLFxuICAgICAgICBhY3R1YWxNb2RlbElkOiBtb2RlbElkLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBOYXRpdmUgU3lzdGVtU2N1bHB0IHByb3ZpZGVyXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzQ3VzdG9tOiBmYWxzZSxcbiAgICAgIGFjdHVhbE1vZGVsSWQ6IHRoaXMuc3RyaXBQcm92aWRlclByZWZpeGVzKG1vZGVsSWQpLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUN1c3RvbVByb3ZpZGVyQ29tcGxldGlvbihcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIsXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10sXG4gICAgdGVtcGVyYXR1cmU6IG51bWJlcixcbiAgICBtb2RlbElkOiBzdHJpbmcsXG4gICAgc2lnbmFsPzogQWJvcnRTaWduYWxcbiAgKTogUHJvbWlzZTxSZXNwb25zZT4ge1xuICAgIGNvbnN0IGVuZHBvaW50ID0gcHJvdmlkZXIuZW5kcG9pbnQudHJpbSgpLnJlcGxhY2UoL1xcLyQvLCBcIlwiKTtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cHJvdmlkZXIuYXBpS2V5fWAsXG4gICAgfTtcblxuICAgIC8vIEFkZCBPcGVuUm91dGVyIHNwZWNpZmljIGhlYWRlcnMgaWYgaXQncyBhbiBPcGVuUm91dGVyIGVuZHBvaW50XG4gICAgaWYgKGVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgaGVhZGVyc1tcIkhUVFAtUmVmZXJlclwiXSA9IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCI7XG4gICAgICBoZWFkZXJzW1wiWC1UaXRsZVwiXSA9IFwiU3lzdGVtU2N1bHB0IEFJXCI7XG4gICAgfVxuXG4gICAgLy8gQmFzZSByZXF1ZXN0IGJvZHlcbiAgICBjb25zdCBiYXNlUmVxdWVzdEJvZHkgPSB7XG4gICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcy5tYXAoKG1zZykgPT4gKHtcbiAgICAgICAgcm9sZTogbXNnLnJvbGUsXG4gICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50LFxuICAgICAgfSkpLFxuICAgICAgc3RyZWFtOiB0cnVlLFxuICAgIH07XG5cbiAgICAvLyBBZGQgcHJvdmlkZXItc3BlY2lmaWMgcGFyYW1ldGVyc1xuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgLi4uYmFzZVJlcXVlc3RCb2R5LFxuICAgICAgLy8gQWRkIHRlbXBlcmF0dXJlIG9ubHkgZm9yIG5vbi1PcGVuQUkgZW5kcG9pbnRzXG4gICAgICAuLi4oIWVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIikgJiYgeyB0ZW1wZXJhdHVyZSB9KSxcbiAgICAgIC8vIEFkZCBpbmNsdWRlX3JlYXNvbmluZyBmb3IgT3BlblJvdXRlciBlbmRwb2ludHNcbiAgICAgIC4uLihlbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIikgJiYge1xuICAgICAgICBpbmNsdWRlX3JlYXNvbmluZzogdHJ1ZSxcbiAgICAgIH0pLFxuICAgICAgLy8gQWRkIHJlYXNvbmluZ19lZmZvcnQgZm9yIE9wZW5BSSdzIG8zLW1pbmkgbW9kZWxcbiAgICAgIC4uLihlbmRwb2ludC5pbmNsdWRlcyhcImFwaS5vcGVuYWkuY29tXCIpICYmXG4gICAgICAgIG1vZGVsSWQgPT09IFwibzMtbWluaVwiICYmIHtcbiAgICAgICAgICByZWFzb25pbmdfZWZmb3J0OiBcImhpZ2hcIixcbiAgICAgICAgfSksXG4gICAgfTtcblxuICAgIC8vIExvZyB0aGUgcmVxdWVzdCBib2R5IGlmIGl0J3MgT3BlbkFJIGFuZCBvMy1taW5pXG4gICAgaWYgKGVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIikgJiYgbW9kZWxJZCA9PT0gXCJvMy1taW5pXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWFraW5nIE9wZW5BSSBBUEkgY2FsbCB3aXRoIG8zLW1pbmkgbW9kZWw6XCIsIHtcbiAgICAgICAgZW5kcG9pbnQsXG4gICAgICAgIG1vZGVsSWQsXG4gICAgICAgIHJlcXVlc3RCb2R5LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtlbmRwb2ludH0vY2hhdC9jb21wbGV0aW9uc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgc2lnbmFsLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTdHJlYW1FcnJvcihyZXNwb25zZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgYXN5bmMgKnN0cmVhbU1lc3NhZ2Uoe1xuICAgIG1lc3NhZ2VzLFxuICAgIG1vZGVsLFxuICAgIHRlbXBlcmF0dXJlID0gMC43LFxuICAgIG9uRXJyb3IsXG4gICAgY29udGV4dEZpbGVzLFxuICAgIHN5c3RlbVByb21wdFR5cGUsXG4gICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICBzaWduYWwsXG4gIH06IHtcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgICBtb2RlbDogc3RyaW5nO1xuICAgIHRlbXBlcmF0dXJlPzogbnVtYmVyO1xuICAgIG9uRXJyb3I/OiAoZXJyb3I6IHN0cmluZykgPT4gdm9pZDtcbiAgICBjb250ZXh0RmlsZXM/OiBTZXQ8c3RyaW5nPjtcbiAgICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nO1xuICAgIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmc7XG4gICAgc2lnbmFsPzogQWJvcnRTaWduYWw7XG4gIH0pOiBBc3luY0dlbmVyYXRvcjx7IGNvbnRlbnQ/OiBzdHJpbmc7IHJlYXNvbmluZz86IHN0cmluZyB9LCB2b2lkLCB1bmtub3duPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlc2V0IHRoaW5rIHRhZyBzdGF0ZSBhdCBzdGFydCBvZiBzdHJlYW1cbiAgICAgIHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MgPSBmYWxzZTtcblxuICAgICAgY29uc3QgcHJlcGFyZWRNZXNzYWdlcyA9IGF3YWl0IHRoaXMucHJlcGFyZU1lc3NhZ2VzV2l0aENvbnRleHQoXG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBjb250ZXh0RmlsZXMgfHwgbmV3IFNldCgpLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoXG4gICAgICApO1xuXG4gICAgICAvLyBHZXQgbW9kZWwgaW5mb1xuICAgICAgY29uc3QgeyBpc0N1c3RvbSwgcHJvdmlkZXIsIGFjdHVhbE1vZGVsSWQgfSA9IGF3YWl0IHRoaXMuZ2V0TW9kZWxJbmZvKFxuICAgICAgICBtb2RlbFxuICAgICAgKTtcblxuICAgICAgbGV0IHJlc3BvbnNlOiBSZXNwb25zZTtcblxuICAgICAgaWYgKGlzQ3VzdG9tICYmIHByb3ZpZGVyKSB7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5oYW5kbGVDdXN0b21Qcm92aWRlckNvbXBsZXRpb24oXG4gICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgcHJlcGFyZWRNZXNzYWdlcyxcbiAgICAgICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgICAgICBhY3R1YWxNb2RlbElkLFxuICAgICAgICAgIHNpZ25hbFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciBTeXN0ZW1TY3VscHQgQVBJIHJlcXVlc3RcbiAgICAgICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XG4gICAgICAgICAgbW9kZWw6IGFjdHVhbE1vZGVsSWQsXG4gICAgICAgICAgbWVzc2FnZXM6IHByZXBhcmVkTWVzc2FnZXMsXG4gICAgICAgICAgdGVtcGVyYXR1cmUsXG4gICAgICAgICAgc3RyZWFtOiB0cnVlLFxuICAgICAgICAgIGluY2x1ZGVfcmVhc29uaW5nOiB0cnVlLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgYCR7dGhpcy5iYXNlVXJsfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuQ0hBVC5DT01QTEVUSU9OU31gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICBBY2NlcHQ6IFwidGV4dC9ldmVudC1zdHJlYW1cIixcbiAgICAgICAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIixcbiAgICAgICAgICAgICAgXCJYLVJlcXVlc3QtSURcIjogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMubGljZW5zZUtleSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksXG4gICAgICAgICAgICBzaWduYWwsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXJyb3IocmVzcG9uc2UsICEhcHJvdmlkZXIpO1xuICAgICAgfVxuICAgICAgaWYgKCFyZXNwb25zZS5ib2R5KSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SKSxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IsXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7XG4gICAgICBsZXQgYnVmZmVyID0gXCJcIjtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICBjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuXG4gICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgZmluYWwgY2h1bmsgaWYgYW55XG4gICAgICAgICAgICBjb25zdCBmaW5hbENodW5rID0gU3lzdGVtU2N1bHB0U2VydmljZS5kZWNvZGVyLmRlY29kZSgpO1xuICAgICAgICAgICAgaWYgKGZpbmFsQ2h1bmspIHtcbiAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLnByb2Nlc3NTdHJlYW1MaW5lKGZpbmFsQ2h1bmspO1xuICAgICAgICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmhhbmRsZVN0cmVhbUV2ZW50KFxuICAgICAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgICAgICEhcHJvdmlkZXJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29udGVudCB8fCByZXN1bHQucmVhc29uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXN1bHQuY29udGVudCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgcmVhc29uaW5nOiByZXN1bHQucmVhc29uaW5nIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFByb2Nlc3MgY2h1bmsgYW5kIHlpZWxkIGNvbnRlbnRzXG4gICAgICAgICAgY29uc3QgeyBuZXdCdWZmZXIsIGNvbnRlbnRzLCByZWFzb25pbmdzIH0gPVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzU3RyZWFtQ2h1bmsodmFsdWUsIGJ1ZmZlciwgbW9kZWwsICEhcHJvdmlkZXIpO1xuICAgICAgICAgIGJ1ZmZlciA9IG5ld0J1ZmZlcjtcblxuICAgICAgICAgIC8vIFlpZWxkIGJvdGggY29udGVudCBhbmQgcmVhc29uaW5nIGNodW5rc1xuICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBpIDwgTWF0aC5tYXgoY29udGVudHMubGVuZ3RoLCByZWFzb25pbmdzLmxlbmd0aCk7XG4gICAgICAgICAgICBpKytcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgY29udGVudDogY29udGVudHNbaV0sXG4gICAgICAgICAgICAgIHJlYXNvbmluZzogcmVhc29uaW5nc1tpXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICByZWFkZXIucmVsZWFzZUxvY2soKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uICYmIGVycm9yLm5hbWUgPT09IFwiQWJvcnRFcnJvclwiKSB7XG4gICAgICAgIC8vIEhhbmRsZSBhYm9ydCBncmFjZWZ1bGx5XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUik7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgJiZcbiAgICAgICAgICBlcnJvci5jb2RlID09PSBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IgJiZcbiAgICAgICAgICBlcnJvci5zdGF0dXNDb2RlID09PSA0MDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlICs9XG4gICAgICAgICAgICBcIlxcblBsZWFzZSB0cnkgYWdhaW4gaW4gYSBmZXcgbW9tZW50cy4gSWYgdGhlIGlzc3VlIHBlcnNpc3RzLCB0cnkgc2VsZWN0aW5nIGEgZGlmZmVyZW50IG1vZGVsLlwiO1xuICAgICAgICB9XG4gICAgICAgIG9uRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGxvYWRzIGEgZmlsZSB0byB0aGUgc2VydmVyIGZvciBkb2N1bWVudCBwcm9jZXNzaW5nLlxuICAgKiBSZXR1cm5zIHtkb2N1bWVudElkLCBzdGF0dXM6IFwicXVldWVkXCIgfCBcInByb2Nlc3NpbmdcIiB8IFwiY29tcGxldGVkXCIsIGNhY2hlZD86IGJvb2xlYW59IGlmIHN1Y2Nlc3NmdWwuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdXBsb2FkRG9jdW1lbnQoXG4gICAgZmlsZTogVEZpbGVcbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50SWQ6IHN0cmluZzsgc3RhdHVzOiBzdHJpbmc7IGNhY2hlZD86IGJvb2xlYW4gfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZWFkIGZpbGUgZnJvbSB2YXVsdFxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG5cbiAgICAgIC8vIFByZXBhcmUgbXVsdGlwYXJ0IGZvcm0gZGF0YVxuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZGF0YV0sIHsgdHlwZTogXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIiB9KTtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgYmxvYiwgZmlsZS5uYW1lKTtcblxuICAgICAgLy8gTWFrZSByZXF1ZXN0IHRvIC9hcGkvdjEvZG9jdW1lbnRzL3Byb2Nlc3NcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hcGkvdjEvZG9jdW1lbnRzL3Byb2Nlc3NgLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIngtbGljZW5zZS1rZXlcIjogdGhpcy5saWNlbnNlS2V5LFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVXBsb2FkIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBsb2FkcyBhbiBhdWRpbyBmaWxlIHRvIHRoZSBzZXJ2ZXIgZm9yIHNwZWVjaC10by10ZXh0IGV4dHJhY3Rpb24uXG4gICAqIFJldHVybnMge2RvY3VtZW50SWQsIHN0YXR1czogXCJxdWV1ZWRcInxcInByb2Nlc3NpbmdcInxcImNvbXBsZXRlZFwiLCBjYWNoZWQ/OiBib29sZWFufSBpZiBzdWNjZXNzZnVsLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHVwbG9hZEF1ZGlvKFxuICAgIGZpbGU6IFRGaWxlXG4gICk6IFByb21pc2U8eyBkb2N1bWVudElkOiBzdHJpbmc7IHN0YXR1czogc3RyaW5nOyBjYWNoZWQ/OiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVhZCBmaWxlIGZyb20gdmF1bHRcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuXG4gICAgICAvLyBQcmVwYXJlIG11bHRpcGFydCBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGFdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIgfSk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGJsb2IsIGZpbGUubmFtZSk7XG5cbiAgICAgIC8vIE1ha2UgcmVxdWVzdCB0byAvYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zIGVuZHBvaW50XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLmJhc2VVcmx9L2FwaS92MS9hdWRpby90cmFuc2NyaXB0aW9uc2AsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF1ZGlvIHVwbG9hZCBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHByZWxvYWRNb2RlbHMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gUmVtb3ZlIHByZWxvYWRpbmcgc2luY2Ugd2UncmUgbm90IGNhY2hpbmdcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cbn1cbiIsICJleHBvcnQgY29uc3QgY3JlYXRlTG9hZGluZ0luZGljYXRvciA9ICgpID0+IHtcbiAgY29uc3QgaW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgaW5kaWNhdG9yLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LWxvYWRpbmdcIjtcbiAgaW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJcdTI1Q0ZcIjtcbiAgcmV0dXJuIGluZGljYXRvcjtcbn07XG4iLCAiZXhwb3J0IGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IChcbiAgdGV4dDogc3RyaW5nLFxuICBvbkNsaWNrOiAoKSA9PiB2b2lkLFxuICBjbGFzc05hbWUgPSBcIlwiXG4pID0+IHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgYnV0dG9uLmNsYXNzTmFtZSA9IGBzeXN0ZW1zY3VscHQtYnV0dG9uICR7Y2xhc3NOYW1lfWA7XG4gIGJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIGJ1dHRvbi5vbmNsaWNrID0gb25DbGljaztcbiAgcmV0dXJuIGJ1dHRvbjtcbn07XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRBcmVhTW9kYWxPcHRpb25zIHtcbiAgcHJpbWFyeUJ1dHRvbj86IHN0cmluZztcbiAgc2Vjb25kYXJ5QnV0dG9uPzogc3RyaW5nO1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgcm93cz86IG51bWJlcjtcbiAgcHJlc2V0QnV0dG9ucz86IHtcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gIH1bXTtcbn1cblxuZXhwb3J0IGNsYXNzIFRleHRBcmVhTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcmVzdWx0OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBzdHJpbmcgfCBudWxsKSA9PiB2b2lkO1xuICBwcml2YXRlIHRleHRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgdGl0bGU6IHN0cmluZyxcbiAgICBwcml2YXRlIGluaXRpYWxDb250ZW50OiBzdHJpbmcsXG4gICAgcHJpdmF0ZSBvcHRpb25zPzogVGV4dEFyZWFNb2RhbE9wdGlvbnNcbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm1vZGFsRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWxcIiwgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtbW9kYWxcIik7XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWNvbnRlbnRcIik7XG5cbiAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dCh0aGlzLnRpdGxlKTtcbiAgICB0aGlzLnRpdGxlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIik7XG5cbiAgICBjb25zdCB0ZXh0QXJlYUNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnMgaWYgdGhleSBleGlzdFxuICAgIGlmICh0aGlzLm9wdGlvbnM/LnByZXNldEJ1dHRvbnMgJiYgdGhpcy5vcHRpb25zLnByZXNldEJ1dHRvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgICBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgICApO1xuXG4gICAgICB0aGlzLm9wdGlvbnMucHJlc2V0QnV0dG9ucy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gcHJlc2V0QnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgICB0ZXh0OiBwcmVzZXQubGFiZWwsXG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnZhbHVlO1xuICAgICAgICAgIC8vIFRyaWdnZXIgcmVzaXplIG9ic2VydmVyXG4gICAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSk7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMudGV4dEFyZWEgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWFcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcm93czogdGhpcy5vcHRpb25zPy5yb3dzPy50b1N0cmluZygpIHx8IFwiMTBcIixcbiAgICAgICAgcGxhY2Vob2xkZXI6IHRoaXMub3B0aW9ucz8ucGxhY2Vob2xkZXIgfHwgXCJcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRoaXMuaW5pdGlhbENvbnRlbnQ7XG5cbiAgICAvLyBBZGQgcmVzaXplIG9ic2VydmVyIHRvIGhhbmRsZSBkeW5hbWljIGNvbnRlbnRcbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSB0aGlzLnRleHRBcmVhLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICB9KTtcbiAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMudGV4dEFyZWEpO1xuXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zPy5zZWNvbmRhcnlCdXR0b24pIHtcbiAgICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5zZWNvbmRhcnlCdXR0b24sXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB9KTtcbiAgICAgIHNlY29uZGFyeUJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiB0aGlzLm9wdGlvbnM/LnByaW1hcnlCdXR0b24gfHwgXCJTYXZlXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLnRleHRBcmVhLnZhbHVlO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG5cbiAgICAvLyBGb2N1cyB0aGUgdGV4dGFyZWEgYW5kIHBsYWNlIGN1cnNvciBhdCB0aGUgZW5kXG4gICAgdGhpcy50ZXh0QXJlYS5mb2N1cygpO1xuICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UoXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aCxcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoXG4gICAgKTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgaWYgKHRoaXMucmVzb2x2ZVByb21pc2UpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dUZXh0YXJlYVBvcHVwKFxuICBhcHA6IEFwcCxcbiAgdGl0bGU6IHN0cmluZyxcbiAgaW5pdGlhbENvbnRlbnQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IFRleHRBcmVhTW9kYWxPcHRpb25zXG4pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgVGV4dEFyZWFNb2RhbChhcHAsIHRpdGxlLCBpbml0aWFsQ29udGVudCwgb3B0aW9ucyk7XG4gIHJldHVybiBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIFBvcHVwT3B0aW9ucyB7XG4gIHByaW1hcnlCdXR0b24/OiBzdHJpbmc7XG4gIHNlY29uZGFyeUJ1dHRvbj86IHN0cmluZztcbiAgdGl0bGU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpY29uPzogc3RyaW5nO1xuICBpbnB1dHM/OiB7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gIH1bXTtcbn1cblxuZXhwb3J0IGNsYXNzIFBvcHVwQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBtZXNzYWdlOiBzdHJpbmc7XG4gIHByaXZhdGUgb3B0aW9uczogUG9wdXBPcHRpb25zO1xuICBwcml2YXRlIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKFxuICAgIHZhbHVlOiB7IGNvbmZpcm1lZDogYm9vbGVhbjsgaW5wdXRzPzogc3RyaW5nW10gfSB8IG51bGxcbiAgKSA9PiB2b2lkO1xuICBwcml2YXRlIHJlc3VsdDogeyBjb25maXJtZWQ6IGJvb2xlYW47IGlucHV0cz86IHN0cmluZ1tdIH0gfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgbWVzc2FnZTogc3RyaW5nLCBvcHRpb25zOiBQb3B1cE9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUG9wdXAoKSB7XG4gICAgLy8gQ3JlYXRlIGNvbnRhaW5lclxuICAgIHRoaXMuY29udGFpbmVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtcG9wdXAtY29udGFpbmVyXCIpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXJFbCk7XG5cbiAgICAvLyBDcmVhdGUgcG9wdXBcbiAgICBjb25zdCBwb3B1cEVsID0gdGhpcy5jb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwXCIgfSk7XG4gICAgY29uc3QgY29udGVudCA9IHBvcHVwRWwuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1jb250ZW50XCIgfSk7XG5cbiAgICAvLyBBZGQgdGl0bGUgaWYgcHJvdmlkZWRcbiAgICBpZiAodGhpcy5vcHRpb25zLnRpdGxlKSB7XG4gICAgICBjb25zdCB0aXRsZUVsID0gY29udGVudC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLXRpdGxlXCIgfSk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmljb24pIHtcbiAgICAgICAgY29uc3QgaWNvbkVsID0gdGl0bGVFbC5jcmVhdGVTcGFuKHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1pY29uXCIgfSk7XG4gICAgICAgIHNldEljb24oaWNvbkVsLCB0aGlzLm9wdGlvbnMuaWNvbik7XG4gICAgICB9XG4gICAgICB0aXRsZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiB0aGlzLm9wdGlvbnMudGl0bGUgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIG1haW4gbWVzc2FnZVxuICAgIGlmICh0aGlzLm1lc3NhZ2UpIHtcbiAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1tZXNzYWdlXCIsXG4gICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvbiBpZiBwcm92aWRlZFxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGVzY3JpcHRpb24pIHtcbiAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1kZXNjcmlwdGlvblwiLFxuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMuZGVzY3JpcHRpb24sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgaW5wdXRzIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRoaXMub3B0aW9ucy5pbnB1dHMpIHtcbiAgICAgIGNvbnN0IGlucHV0c0NvbnRhaW5lciA9IGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1pbnB1dHNcIixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLm9wdGlvbnMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgIGlmIChpbnB1dC50eXBlID09PSBcInRleHRhcmVhXCIpIHtcbiAgICAgICAgICBpbnB1dHNDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICAgICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtcG9wdXAtdGV4dGFyZWEgJHtpbnB1dC5jbGFzc05hbWUgfHwgXCJcIn1gLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGlucHV0LnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgdmFsdWU6IGlucHV0LnZhbHVlIHx8IFwiXCIsXG4gICAgICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBpbnB1dC5yZXF1aXJlZCA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnB1dHNDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LXBvcHVwLWlucHV0ICR7aW5wdXQuY2xhc3NOYW1lIHx8IFwiXCJ9YCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBpbnB1dC5wbGFjZWhvbGRlcixcbiAgICAgICAgICAgIHZhbHVlOiBpbnB1dC52YWx1ZSB8fCBcIlwiLFxuICAgICAgICAgICAgYXR0cjoge1xuICAgICAgICAgICAgICByZXF1aXJlZDogaW5wdXQucmVxdWlyZWQgPyB0cnVlIDogbnVsbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBidXR0b25zXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gcG9wdXBFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLnNlY29uZGFyeUJ1dHRvbikge1xuICAgICAgY29uc3Qgc2Vjb25kYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b24gc3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnNlY29uZGFyeUJ1dHRvbixcbiAgICAgIH0pO1xuICAgICAgc2Vjb25kYXJ5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0geyBjb25maXJtZWQ6IGZhbHNlIH07XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbiAke1xuICAgICAgICB0aGlzLm9wdGlvbnMucHJpbWFyeUJ1dHRvbiA9PT0gXCJCZWNvbWUgQSBQYXRyb25cIiB8fFxuICAgICAgICB0aGlzLm9wdGlvbnMucHJpbWFyeUJ1dHRvbiA9PT0gXCJCZWNvbWUgYSBQYXRyb25cIlxuICAgICAgICAgID8gXCJzeXN0ZW1zY3VscHQtcG9wdXAtYnV0dG9uLXBhdHJvblwiXG4gICAgICAgICAgOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b24tcHJpbWFyeVwiXG4gICAgICB9YCxcbiAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5wcmltYXJ5QnV0dG9uIHx8IFwiT0tcIixcbiAgICB9KTtcblxuICAgIHByaW1hcnlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5wdXRzKSB7XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oXG4gICAgICAgICAgcG9wdXBFbC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHRleHRhcmVhXCIpIGFzIE5vZGVMaXN0T2Y8XG4gICAgICAgICAgICBIVE1MSW5wdXRFbGVtZW50IHwgSFRNTFRleHRBcmVhRWxlbWVudFxuICAgICAgICAgID5cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBpZiBhbnkgcmVxdWlyZWQgaW5wdXRzIGFyZSBlbXB0eVxuICAgICAgICBjb25zdCBoYXNFbXB0eVJlcXVpcmVkID0gaW5wdXRzLnNvbWUoXG4gICAgICAgICAgKGlucHV0KSA9PiBpbnB1dC5yZXF1aXJlZCAmJiAhaW5wdXQudmFsdWUudHJpbSgpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChoYXNFbXB0eVJlcXVpcmVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7XG4gICAgICAgICAgY29uZmlybWVkOiB0cnVlLFxuICAgICAgICAgIGlucHV0czogaW5wdXRzLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0geyBjb25maXJtZWQ6IHRydWUgfTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBrZXlib2FyZCBoYW5kbGVyc1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICB0aGlzLnJlc3VsdCA9IHsgY29uZmlybWVkOiBmYWxzZSB9O1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZS5pc0NvbXBvc2luZyAmJiAhZS5zaGlmdEtleSkge1xuICAgICAgICBwcmltYXJ5QnV0dG9uLmNsaWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDbG9zZSBvbiBiYWNrZ3JvdW5kIGNsaWNrXG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuY29udGFpbmVyRWwpIHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7IGNvbmZpcm1lZDogZmFsc2UgfTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjbG9zZSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lckVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LXBvcHVwLWNsb3NpbmdcIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRhaW5lckVsLnJlbW92ZSgpO1xuICAgICAgaWYgKHRoaXMucmVzb2x2ZVByb21pc2UpIHtcbiAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTsgLy8gTWF0Y2ggdGhlIGFuaW1hdGlvbiBkdXJhdGlvblxuICB9XG5cbiAgcHVibGljIG9wZW4oKTogUHJvbWlzZTx7IGNvbmZpcm1lZDogYm9vbGVhbjsgaW5wdXRzPzogc3RyaW5nW10gfSB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5jcmVhdGVQb3B1cCgpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93UG9wdXAoXG4gIGFwcDogQXBwLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIG9wdGlvbnM6IFBvcHVwT3B0aW9ucyA9IHt9XG4pOiBQcm9taXNlPHsgY29uZmlybWVkOiBib29sZWFuOyBpbnB1dHM/OiBzdHJpbmdbXSB9IHwgbnVsbD4ge1xuICBjb25zdCBwb3B1cCA9IG5ldyBQb3B1cENvbXBvbmVudChhcHAsIG1lc3NhZ2UsIG9wdGlvbnMpO1xuICByZXR1cm4gcG9wdXAub3BlbigpO1xufVxuIiwgImltcG9ydCB7IE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvZXJyb3JzXCI7XG5cbnR5cGUgTm90aWNlVHlwZSA9IFwiaW5mb1wiIHwgXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcInN1Y2Nlc3NcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHNob3dFbmhhbmNlZE5vdGljZShcbiAgbWVzc2FnZTogc3RyaW5nLFxuICB0eXBlPzogTm90aWNlVHlwZSxcbiAgZXJyb3I/OiBFcnJvciB8IFN5c3RlbVNjdWxwdEVycm9yIHwgdW5rbm93blxuKSB7XG4gIC8vIEFsd2F5cyBsb2cgZXJyb3JzIHRvIGNvbnNvbGUgaWYgcHJlc2VudFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiTm90aWNlIGVycm9yIGRldGFpbHM6XCIsIHtcbiAgICAgIGVycm9yLFxuICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIG1ldGFkYXRhOiBlcnJvciBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yID8gZXJyb3IubWV0YWRhdGEgOiB1bmRlZmluZWQsXG4gICAgfSk7XG4gIH1cblxuICBsZXQgZHVyYXRpb246IG51bWJlcjtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBkdXJhdGlvbiA9IDEwMDAwOyAvLyAxMCBzZWNvbmRzIGZvciBlcnJvcnNcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ3YXJuaW5nXCI6XG4gICAgICBkdXJhdGlvbiA9IDUwMDA7IC8vIDUgc2Vjb25kcyBmb3Igd2FybmluZ3NcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBkdXJhdGlvbiA9IDMwMDA7IC8vIDMgc2Vjb25kcyBmb3IgaW5mbyBhbmQgc3VjY2Vzc1xuICB9XG5cbiAgY29uc3Qgbm90aWNlID0gbmV3IE5vdGljZShtZXNzYWdlLCBkdXJhdGlvbik7XG4gIHJldHVybiBub3RpY2U7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuL21vZGFscy9Qb3B1cE1vZGFsXCI7XG5cbmludGVyZmFjZSBOb3RpZmljYXRpb25PcHRpb25zIHtcbiAgdHlwZT86IFwic3VjY2Vzc1wiIHwgXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcImluZm9cIjtcbiAgZHVyYXRpb24/OiBudW1iZXI7XG4gIGljb24/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBBbGVydE9wdGlvbnMge1xuICB0aXRsZT86IHN0cmluZztcbiAgcHJpbWFyeUJ1dHRvbj86IHN0cmluZztcbiAgc2Vjb25kYXJ5QnV0dG9uPzogc3RyaW5nO1xuICBpY29uPzogc3RyaW5nO1xuICB0eXBlPzogXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcImluZm9cIjtcbn1cblxuLyoqXG4gKiBTaG93IGEgcXVpY2sgbm90aWZpY2F0aW9uIGZvciBub24tY3JpdGljYWwgaW5mb3JtYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dOb3RpY2UobWVzc2FnZTogc3RyaW5nLCBvcHRpb25zOiBOb3RpZmljYXRpb25PcHRpb25zID0ge30pIHtcbiAgY29uc3QgeyB0eXBlID0gXCJpbmZvXCIsIGR1cmF0aW9uID0gNDAwMCB9ID0gb3B0aW9ucztcbiAgbGV0IHByZWZpeCA9IFwiXCI7XG5cbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcInN1Y2Nlc3NcIjpcbiAgICAgIHByZWZpeCA9IFwiXHUyNzI4IFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBwcmVmaXggPSBcIlx1Mjc0QyBcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ3YXJuaW5nXCI6XG4gICAgICBwcmVmaXggPSBcIlx1MjZBMFx1RkUwRiBcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJpbmZvXCI6XG4gICAgICBwcmVmaXggPSBcIlx1MjEzOVx1RkUwRiBcIjtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgbmV3IE5vdGljZShwcmVmaXggKyBtZXNzYWdlLCBkdXJhdGlvbik7XG59XG5cbi8qKlxuICogU2hvdyBhbiBhbGVydCBwb3B1cCBmb3IgaW1wb3J0YW50IG1lc3NhZ2VzIHRoYXQgbmVlZCB1c2VyIGF0dGVudGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd0FsZXJ0KFxuICBhcHA6IEFwcCxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBvcHRpb25zOiBBbGVydE9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTx7IGNvbmZpcm1lZDogYm9vbGVhbiB9PiB7XG4gIGNvbnN0IHtcbiAgICB0aXRsZSA9IG9wdGlvbnMudHlwZSA9PT0gXCJlcnJvclwiXG4gICAgICA/IFwiRXJyb3JcIlxuICAgICAgOiBvcHRpb25zLnR5cGUgPT09IFwid2FybmluZ1wiXG4gICAgICA/IFwiV2FybmluZ1wiXG4gICAgICA6IFwiQWxlcnRcIixcbiAgICBwcmltYXJ5QnV0dG9uID0gXCJPS1wiLFxuICAgIHNlY29uZGFyeUJ1dHRvbixcbiAgICBpY29uID0gb3B0aW9ucy50eXBlID09PSBcImVycm9yXCJcbiAgICAgID8gXCJhbGVydC1jaXJjbGVcIlxuICAgICAgOiBvcHRpb25zLnR5cGUgPT09IFwid2FybmluZ1wiXG4gICAgICA/IFwiYWxlcnQtdHJpYW5nbGVcIlxuICAgICAgOiBcImluZm9cIixcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKGFwcCwgbWVzc2FnZSwge1xuICAgIHRpdGxlLFxuICAgIHByaW1hcnlCdXR0b24sXG4gICAgc2Vjb25kYXJ5QnV0dG9uLFxuICAgIGljb24sXG4gIH0pO1xuXG4gIHJldHVybiB7IGNvbmZpcm1lZDogcmVzdWx0Py5jb25maXJtZWQgfHwgZmFsc2UgfTtcbn1cblxuLyoqXG4gKiBTaG93IGEgY29uZmlybWF0aW9uIHBvcHVwIGZvciBhY3Rpb25zIHRoYXQgbmVlZCB1c2VyIGFwcHJvdmFsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93Q29uZmlybShcbiAgYXBwOiBBcHAsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgb3B0aW9uczogQWxlcnRPcHRpb25zID0ge31cbik6IFByb21pc2U8eyBjb25maXJtZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7XG4gICAgdGl0bGUgPSBcIkNvbmZpcm0gQWN0aW9uXCIsXG4gICAgcHJpbWFyeUJ1dHRvbiA9IFwiQ29uZmlybVwiLFxuICAgIHNlY29uZGFyeUJ1dHRvbiA9IFwiQ2FuY2VsXCIsXG4gICAgaWNvbiA9IFwiaGVscC1jaXJjbGVcIixcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKGFwcCwgbWVzc2FnZSwge1xuICAgIHRpdGxlLFxuICAgIHByaW1hcnlCdXR0b24sXG4gICAgc2Vjb25kYXJ5QnV0dG9uLFxuICAgIGljb24sXG4gIH0pO1xuXG4gIHJldHVybiB7IGNvbmZpcm1lZDogcmVzdWx0Py5jb25maXJtZWQgfHwgZmFsc2UgfTtcbn1cbiIsICJleHBvcnQgeyBjcmVhdGVMb2FkaW5nSW5kaWNhdG9yIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Mb2FkaW5nSW5kaWNhdG9yXCI7XG5leHBvcnQgeyBjcmVhdGVCdXR0b24gfSBmcm9tIFwiLi9jb21wb25lbnRzL0J1dHRvblwiO1xuZXhwb3J0IHtcbiAgVGV4dEFyZWFNb2RhbCxcbiAgdHlwZSBUZXh0QXJlYU1vZGFsT3B0aW9ucyxcbiAgc2hvd1RleHRhcmVhUG9wdXAsXG59IGZyb20gXCIuL21vZGFscy9UZXh0QXJlYU1vZGFsXCI7XG5leHBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi9tb2RhbHMvUG9wdXBNb2RhbFwiO1xuZXhwb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Ob3RpY2VcIjtcbmV4cG9ydCB7IHNob3dOb3RpY2UsIHNob3dBbGVydCwgc2hvd0NvbmZpcm0gfSBmcm9tIFwiLi9ub3RpZmljYXRpb25zXCI7XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgQWJzdHJhY3RJbnB1dFN1Z2dlc3QgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGNsYXNzIEZpbGVTdWdnZXN0ZXIgZXh0ZW5kcyBBYnN0cmFjdElucHV0U3VnZ2VzdDxzdHJpbmc+IHtcbiAgcHJpdmF0ZSBjb250ZW50OiBTZXQ8c3RyaW5nPjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gICAgcHJpdmF0ZSBvblNlbGVjdENiOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZCxcbiAgICBhcHA6IEFwcCxcbiAgICBwcml2YXRlIGRpcmVjdG9yeTogc3RyaW5nXG4gICkge1xuICAgIHN1cGVyKGFwcCwgaW5wdXRFbCk7XG4gICAgdGhpcy5jb250ZW50ID0gZ2V0RmlsZVN1Z2dlc3Rpb25zKGFwcCwgZGlyZWN0b3J5KTtcbiAgfVxuXG4gIGdldFN1Z2dlc3Rpb25zKGlucHV0U3RyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgbG93ZXJDYXNlSW5wdXRTdHIgPSBpbnB1dFN0ci50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBbLi4udGhpcy5jb250ZW50XS5maWx0ZXIoKGNvbnRlbnQpID0+XG4gICAgICBjb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlSW5wdXRTdHIpXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBlbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAvLyBSZW1vdmUgYW55IHRyYWlsaW5nIFwiLm1kXCIgZXh0ZW5zaW9uIHRvIGF2b2lkIGNsdXR0ZXJcbiAgICBsZXQgZGlzcGxheSA9IGNvbnRlbnQucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgZWwuc2V0VGV4dChkaXNwbGF5KTtcbiAgfVxuXG4gIHNlbGVjdFN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5vblNlbGVjdENiKGNvbnRlbnQpO1xuICAgIHRoaXMuaW5wdXRFbC52YWx1ZSA9IGNvbnRlbnQucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgdGhpcy5pbnB1dEVsLmJsdXIoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbGVTdWdnZXN0aW9ucyhhcHA6IEFwcCwgZGlyZWN0b3J5OiBzdHJpbmcpOiBTZXQ8c3RyaW5nPiB7XG4gIGNvbnN0IGZpbGVzID0gYXBwLnZhdWx0LmdldEFsbExvYWRlZEZpbGVzKCkuZmlsdGVyKChmaWxlKTogZmlsZSBpcyBURmlsZSA9PiB7XG4gICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkgcmV0dXJuIGZhbHNlO1xuICAgIC8vIE9ubHkgaW5jbHVkZSAubWQgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHNwZWNpZmllZCBkaXJlY3RvcnkgKG5vdCBpbiBzdWJkaXJlY3RvcmllcylcbiAgICBjb25zdCBmaWxlRGlyID0gZmlsZS5wYXJlbnQ/LnBhdGg7XG4gICAgcmV0dXJuIGZpbGVEaXIgPT09IGRpcmVjdG9yeSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiO1xuICB9KTtcbiAgcmV0dXJuIG5ldyBTZXQoZmlsZXMubWFwKChmaWxlKSA9PiBmaWxlLnBhdGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaEZpbGVTdWdnZXN0ZXIoXG4gIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHZvaWQsXG4gIGFwcDogQXBwLFxuICBkaXJlY3Rvcnk6IHN0cmluZ1xuKTogRmlsZVN1Z2dlc3RlciB7XG4gIHJldHVybiBuZXcgRmlsZVN1Z2dlc3RlcihpbnB1dEVsLCBvblNlbGVjdCwgYXBwLCBkaXJlY3RvcnkpO1xufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgYXR0YWNoRmlsZVN1Z2dlc3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVTdWdnZXN0ZXJcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9zdFRyYW5zY3JpcHRpb25Qcm9tcHRUeXBlIHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjtcbiAgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHR5cGU6IFwiZ2VuZXJhbFwiIHwgXCJyaHltZVwiIHwgXCJjdXN0b21cIjtcbiAgcGF0aD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFBvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcmVzdWx0OiBQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVzZXRCdXR0b25Db250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbVNlY3Rpb246IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbUlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIGFjdGl2ZVByZXNldDogc3RyaW5nIHwgbnVsbCA9IFwiZ2VuZXJhbFwiOyAvLyBEZWZhdWx0IHRvIGdlbmVyYWxcbiAgcHJpdmF0ZSBwcm9tcHRzOiBQb3N0VHJhbnNjcmlwdGlvblByb21wdFR5cGVbXSA9IFtdO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBwcml2YXRlIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgICBwcml2YXRlIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZyA9IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gICAgcHJpdmF0ZSBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZ1xuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiLCBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1tb2RhbFwiKTtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKHBsdWdpbi5zZXR0aW5ncywgYXBwKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd0xvYWRpbmcoc2hvdzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5sb2FkaW5nSW5kaWNhdG9yIHx8ICF0aGlzLmNvbnRlbnRDb250YWluZXIpIHJldHVybjtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG4gIH1cblxuICBhc3luYyBsb2FkUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyh0cnVlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvcG9zdC10cmFuc2NyaXB0aW9uLXByb21wdHNgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBwcm9tcHRzXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHRoaXMucHJvbXB0cyA9IGRhdGEuZGF0YS5wcm9tcHRzO1xuXG4gICAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgYWZ0ZXIgbG9hZGluZyBkYXRhXG4gICAgICB0aGlzLmNyZWF0ZVByZXNldEJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgcG9zdC10cmFuc2NyaXB0aW9uIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkZhaWxlZCB0byBsb2FkIHByb21wdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJlc2V0QnV0dG9ucygpIHtcbiAgICBpZiAoIXRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICAvLyBDbGVhciBleGlzdGluZyBidXR0b25zXG4gICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuZW1wdHkoKTtcblxuICAgIC8vIEluaXRpYWxpemUgYWN0aXZlIHByZXNldCBiYXNlZCBvbiBjdXJyZW50IHByb21wdCBhbmQgcGF0aFxuICAgIGlmICh0aGlzLmN1cnJlbnRDdXN0b21QYXRoKSB7XG4gICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IFwiY3VzdG9tXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvbXB0cy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgaWYgKHByZXNldC5zeXN0ZW1Qcm9tcHQgPT09IHRoaXMuY3VycmVudFByb21wdCkge1xuICAgICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmlkO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgZm9yIGVhY2ggcHJvbXB0XG4gICAgdGhpcy5wcm9tcHRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBwcmVzZXQubGFiZWwsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCB0b29sdGlwIHdpdGggZGVzY3JpcHRpb24gaWYgYXZhaWxhYmxlXG4gICAgICBpZiAocHJlc2V0LmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHByZXNldC5kZXNjcmlwdGlvbik7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImhhcy10b29sdGlwXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgaW5pdGlhbCBhY3RpdmUgc3RhdGVcbiAgICAgIGlmIChwcmVzZXQuaWQgPT09IHRoaXMuYWN0aXZlUHJlc2V0KSB7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gIXByZXNldC5pc1VzZXJDb25maWd1cmFibGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3RpdmUgY2xhc3MgZnJvbSBhbGwgYnV0dG9uc1xuICAgICAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lclxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIpXG4gICAgICAgICAgLmZvckVhY2goKGJ0bikgPT4gYnRuLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IHByZXNldC5pZDtcblxuICAgICAgICAvLyBTaG93L2hpZGUgY3VzdG9tIHNlY3Rpb25cbiAgICAgICAgaWYgKHByZXNldC5pZCA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgIHRoaXMuY3VzdG9tSW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBTaG93IGN1c3RvbSBzZWN0aW9uIGlmIGl0J3MgYWN0aXZlXG4gICAgaWYgKHRoaXMuYWN0aXZlUHJlc2V0ID09PSBcImN1c3RvbVwiKSB7XG4gICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRDdXN0b21QYXRoKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSB0aGlzLmN1cnJlbnRDdXN0b21QYXRoO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtY29udGVudFwiKTtcblxuICAgIC8vIEFkZCB0aXRsZVxuICAgIHRoaXMudGl0bGVFbC5zZXRUZXh0KFwiRWRpdCBQb3N0LVByb2Nlc3NpbmcgUHJvbXB0XCIpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aGlzLnRpdGxlRWwuY3JlYXRlRGl2KCk7XG4gICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbkVsLnNldFRleHQoXG4gICAgICBcIkNvbmZpZ3VyZSBob3cgeW91ciB0cmFuc2NyaXB0aW9ucyBzaG91bGQgYmUgcG9zdC1wcm9jZXNzZWRcIlxuICAgICk7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmZvbnRTaXplID0gXCIwLjllbVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUubWFyZ2luVG9wID0gXCIwLjJlbVwiO1xuXG4gICAgLy8gQ3JlYXRlIGxvYWRpbmcgaW5kaWNhdG9yXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IHRoaXMubG9hZGluZ0luZGljYXRvci5jcmVhdGVTcGFuKCk7XG4gICAgbG9hZGluZ1RleHQuc2V0VGV4dChcIkxvYWRpbmcgcHJvbXB0cy4uLlwiKTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9uIGNvbnRhaW5lclxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHNlY3Rpb24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuY3VzdG9tU2VjdGlvbiA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1zZWN0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBjdXN0b21JbnB1dENvbnRhaW5lciA9IHRoaXMuY3VzdG9tU2VjdGlvbi5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgYW5kIGJ1dHRvblxuICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGN1c3RvbUlucHV0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LXdyYXBwZXJcIlxuICAgICk7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdGhlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuY3VzdG9tSW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmb3IgYSBzeXN0ZW0gcHJvbXB0IGZpbGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNyZWF0ZSBuZXcgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnV0dG9uID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3JlYXRlLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gXCI0cHggOHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHNldEljb24oY3JlYXRlQnV0dG9uLCBcInBsdXNcIik7XG5cbiAgICBjcmVhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnQgPSBcIlwiO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzL3RlbXBsYXRlYFxuICAgICAgICApO1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRlbXBsYXRlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIHRlbXBsYXRlQ29udGVudCA9IGRhdGEudGVtcGxhdGU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJDcmVhdGUgTmV3IFN5c3RlbSBQcm9tcHRcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJFbnRlciBhIHRpdGxlIGFuZCBjb250ZW50IGZvciB5b3VyIG5ldyBzeXN0ZW0gcHJvbXB0LiBUaGUgdGl0bGUgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIG1hcmtkb3duIGZpbGUgdGhhdCB5b3UgY2FuIGN1c3RvbWl6ZSBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJDcmVhdGVcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIk15IEN1c3RvbSBBc3Npc3RhbnRcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tdGl0bGUtaW5wdXRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgICAgIHZhbHVlOiB0ZW1wbGF0ZUNvbnRlbnQsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLWNvbnRlbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzdWx0Py5jb25maXJtZWQgfHwgIXJlc3VsdC5pbnB1dHM/LlswXSB8fCAhcmVzdWx0LmlucHV0cz8uWzFdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3RpdGxlLCBjb250ZW50XSA9IHJlc3VsdC5pbnB1dHM7XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHRpdGxlLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKS5yZXBsYWNlKC8gL2csIFwiLVwiKTtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5fS8ke2ZpbGVOYW1lfWA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHRcbiAgICAgICAgICAuY3JlYXRlRm9sZGVyKHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSlcbiAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgLyogRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QgKi9cbiAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGAjICR7dGl0bGV9XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGggKyBcIi5tZFwiLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSB0ZXh0YXJlYSB3aXRoIHRoZSBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGZpbGVDb250ZW50O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgZmlsZVxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gZmlsZVBhdGg7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN5c3RlbSBwcm9tcHQgZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgOiBcIkZhaWxlZCB0byBjcmVhdGUgc3lzdGVtIHByb21wdCBmaWxlXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEF0dGFjaCBmaWxlIHN1Z2dlc3RlciBmb3IgY3VzdG9tIHByb21wdHNcbiAgICBhdHRhY2hGaWxlU3VnZ2VzdGVyKFxuICAgICAgdGhpcy5jdXN0b21JbnB1dCxcbiAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBjb250ZW50O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlIHdpdGhvdXQgLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHNlbGVjdGVkUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeVxuICAgICk7XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHBvc3QtcHJvY2Vzc2luZyBwcm9tcHRcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRoaXMuY3VycmVudFByb21wdDtcblxuICAgIC8vIEFkZCByZXNpemUgb2JzZXJ2ZXIgdG8gaGFuZGxlIGR5bmFtaWMgY29udGVudFxuICAgIGNvbnN0IHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMudGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgIH0pO1xuICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy50ZXh0QXJlYSk7XG5cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdCA9IG51bGw7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBzZWNvbmRhcnlCdXR0b24ub25jbGljayA9IGhhbmRsZUNhbmNlbDtcblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJTYXZlXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlU2F2ZSA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGl2ZVByZXNldCA9IHRoaXMucHJvbXB0cy5maW5kKChwKSA9PiBwLmlkID09PSB0aGlzLmFjdGl2ZVByZXNldCk7XG4gICAgICB0aGlzLnJlc3VsdCA9IHtcbiAgICAgICAgY29udGVudDogdGhpcy50ZXh0QXJlYS52YWx1ZSxcbiAgICAgICAgdHlwZTogKGFjdGl2ZVByZXNldD8uaWQgfHwgXCJjdXN0b21cIikgYXMgXCJnZW5lcmFsXCIgfCBcInJoeW1lXCIgfCBcImN1c3RvbVwiLFxuICAgICAgICBwYXRoOlxuICAgICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID09PSBcImN1c3RvbVwiID8gdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBwcmltYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVTYXZlO1xuXG4gICAgLy8gSGFuZGxlIGtleWJvYXJkIGV2ZW50c1xuICAgIHRoaXMubW9kYWxFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLmtleSA9PT0gXCJFbnRlclwiICYmXG4gICAgICAgICFlLmlzQ29tcG9zaW5nICYmXG4gICAgICAgICFlLnNoaWZ0S2V5ICYmXG4gICAgICAgIGUudGFyZ2V0ICE9PSB0aGlzLnRleHRBcmVhXG4gICAgICApIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVTYXZlKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlQ2FuY2VsKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGb2N1cyB0aGUgdGV4dGFyZWEgYW5kIHBsYWNlIGN1cnNvciBhdCB0aGUgZW5kXG4gICAgdGhpcy50ZXh0QXJlYS5mb2N1cygpO1xuICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UoXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aCxcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoXG4gICAgKTtcblxuICAgIC8vIFN0YXJ0IGxvYWRpbmcgcHJvbXB0cyBhZnRlciBVSSBpcyBzZXQgdXBcbiAgICBhd2FpdCB0aGlzLmxvYWRQcm9tcHRzKCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8UG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93UG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbChcbiAgYXBwOiBBcHAsXG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiB7XG4gICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeT86IHN0cmluZztcbiAgICBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZztcbiAgfVxuKTogUHJvbWlzZTxQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgUG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbChcbiAgICBhcHAsXG4gICAgcGx1Z2luLFxuICAgIGN1cnJlbnRQcm9tcHQsXG4gICAgb3B0aW9ucz8uc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSxcbiAgICBvcHRpb25zPy5jdXJyZW50Q3VzdG9tUGF0aFxuICApO1xuICByZXR1cm4gYXdhaXQgbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG59XG4iLCAiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCB9IGZyb20gXCIuL3R5cGVzL2xsbVwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNldHRpbmdUYWIgfSBmcm9tIFwiLi9tb2RhbHMvU2V0dGluZ3NUYWJcIjtcbmltcG9ydCB7IFJlY29yZGVyU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1JlY29yZGVyU2VydmljZVwiO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUgfSBmcm9tIFwiLi9jb21wb25lbnRzL1N5c3RlbVNjdWxwdENvbnRleHRNZW51XCI7XG5pbXBvcnQgeyBTZXR0aW5nc01hbmFnZXIgfSBmcm9tIFwiLi9jb3JlL3NldHRpbmdzL1NldHRpbmdzTWFuYWdlclwiO1xuaW1wb3J0IHsgTGljZW5zZU1hbmFnZXIgfSBmcm9tIFwiLi9jb3JlL2xpY2Vuc2UvTGljZW5zZU1hbmFnZXJcIjtcbmltcG9ydCB7IFZpZXdNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9wbHVnaW4vdmlld3NcIjtcbmltcG9ydCB7IENvbW1hbmRNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9wbHVnaW4vY29tbWFuZHNcIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL0N1c3RvbVByb3ZpZGVyU2VydmljZVwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7IFRhc2tzU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1Rhc2tzU2VydmljZVwiO1xuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvTW9kZWxTZXJ2aWNlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN5c3RlbVNjdWxwdFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcbiAgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBzZXR0aW5nc1RhYjogU3lzdGVtU2N1bHB0U2V0dGluZ1RhYjtcbiAgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2U7XG4gIHByaXZhdGUgcmVjb3JkZXJTZXJ2aWNlOiBSZWNvcmRlclNlcnZpY2U7XG4gIHByaXZhdGUgdHJhbnNjcmlwdGlvblNlcnZpY2U6IFRyYW5zY3JpcHRpb25TZXJ2aWNlO1xuICBwcml2YXRlIHNldHRpbmdzTWFuYWdlcjogU2V0dGluZ3NNYW5hZ2VyO1xuICBwcml2YXRlIGxpY2Vuc2VNYW5hZ2VyOiBMaWNlbnNlTWFuYWdlcjtcbiAgcHVibGljIHRhc2tzU2VydmljZTogVGFza3NTZXJ2aWNlO1xuICBwcml2YXRlIHZpZXdNYW5hZ2VyOiBWaWV3TWFuYWdlcjtcbiAgcHJpdmF0ZSBjb21tYW5kTWFuYWdlcjogQ29tbWFuZE1hbmFnZXI7XG4gIHByaXZhdGUgY29udGV4dE1lbnU6IFN5c3RlbVNjdWxwdENvbnRleHRNZW51O1xuICBwdWJsaWMgbW9kZWxTZXJ2aWNlOiBNb2RlbFNlcnZpY2U7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBJbml0aWFsaXplIHNldHRpbmdzIGZpcnN0IGFzIG90aGVyIHNlcnZpY2VzIGRlcGVuZCBvbiBpdFxuICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIgPSBuZXcgU2V0dGluZ3NNYW5hZ2VyKHRoaXMpO1xuICAgICAgYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIubG9hZFNldHRpbmdzKCk7XG4gICAgICB0aGlzLnNldHRpbmdzID0gdGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZ3MoKTtcblxuICAgICAgLy8gT25seSByZWdpc3RlciAuc3J0IGV4dGVuc2lvbiBpZiBub3QgYWxyZWFkeSByZWdpc3RlcmVkXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZWdpc3RlcmVkRXh0ZW5zaW9ucyA9ICh0aGlzLmFwcCBhcyBhbnkpLnZpZXdSZWdpc3RyeVxuICAgICAgICAgIC50eXBlQnlFeHRlbnNpb247XG4gICAgICAgIGlmICghcmVnaXN0ZXJlZEV4dGVuc2lvbnM/LnNydCkge1xuICAgICAgICAgIHRoaXMucmVnaXN0ZXJFeHRlbnNpb25zKFtcInNydFwiXSwgXCJtYXJrZG93blwiKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciAuc3J0IGV4dGVuc2lvbjpcIiwgZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsaXplIGNvcmUgc2VydmljZXMgaW4gdGhlIGNvcnJlY3Qgb3JkZXJcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuY3VzdG9tUHJvdmlkZXJTZXJ2aWNlID0gbmV3IEN1c3RvbVByb3ZpZGVyU2VydmljZSh0aGlzKTtcbiAgICAgICAgdGhpcy5tb2RlbFNlcnZpY2UgPSBNb2RlbFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICB0aGlzLmFwcFxuICAgICAgICApO1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcyk7XG4gICAgICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlID0gUmVjb3JkZXJTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwLCB0aGlzKTtcbiAgICAgICAgdGhpcy5jb250ZXh0TWVudSA9IG5ldyBTeXN0ZW1TY3VscHRDb250ZXh0TWVudShcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICB0aGlzLmFpU2VydmljZSxcbiAgICAgICAgICB0aGlzXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gU2V0IFN5c3RlbVNjdWxwdFNlcnZpY2UgaW4gU3lzdGVtUHJvbXB0U2VydmljZVxuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnNldFN5c3RlbVNjdWxwdFNlcnZpY2UodGhpcy5haVNlcnZpY2UpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIGNvcmUgc2VydmljZXM6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IHRvIHByZXZlbnQgcGFydGlhbCBpbml0aWFsaXphdGlvblxuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsaXplIFVJIGNvbXBvbmVudHNcbiAgICAgIHRoaXMuc2V0dGluZ3NUYWIgPSBuZXcgU3lzdGVtU2N1bHB0U2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcyk7XG4gICAgICB0aGlzLmFkZFNldHRpbmdUYWIodGhpcy5zZXR0aW5nc1RhYik7XG5cbiAgICAgIC8vIEluaXRpYWxpemUgbWFuYWdlcnNcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMubGljZW5zZU1hbmFnZXIgPSBuZXcgTGljZW5zZU1hbmFnZXIodGhpcywgdGhpcy5hcHApO1xuICAgICAgICB0aGlzLnRhc2tzU2VydmljZSA9IG5ldyBUYXNrc1NlcnZpY2UodGhpcyk7XG4gICAgICAgIHRoaXMudmlld01hbmFnZXIgPSBuZXcgVmlld01hbmFnZXIodGhpcywgdGhpcy5hcHApO1xuICAgICAgICB0aGlzLmNvbW1hbmRNYW5hZ2VyID0gbmV3IENvbW1hbmRNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHZpZXdzIGFuZCBjb21tYW5kc1xuICAgICAgICB0aGlzLnZpZXdNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgICAgdGhpcy5jb21tYW5kTWFuYWdlci5yZWdpc3RlckNvbW1hbmRzKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgbWFuYWdlcnM6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IHRvIHByZXZlbnQgcGFydGlhbCBpbml0aWFsaXphdGlvblxuICAgICAgfVxuXG4gICAgICAvLyBTdGFydCBsb2FkaW5nIHN5c3RlbSBwcm9tcHRzIGNhY2hlIGluIHRoZSBiYWNrZ3JvdW5kXG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRpYWxpemVDYWNoZSgpLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgc3lzdGVtIHByb21wdHMgY2FjaGU6XCIsIGVycm9yKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBJbml0aWFsaXplIGxpY2Vuc2UgdmFsaWRhdGlvblxuICAgICAgYXdhaXQgdGhpcy5nZXRMaWNlbnNlTWFuYWdlcigpLmluaXRpYWxpemVMaWNlbnNlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBTeXN0ZW1TY3VscHQgcGx1Z2luOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gZW5zdXJlIE9ic2lkaWFuIGtub3dzIGluaXRpYWxpemF0aW9uIGZhaWxlZFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9udW5sb2FkKCkge1xuICAgIGNvbnNvbGUubG9nKFwiU3lzdGVtU2N1bHB0IEFJIHBsdWdpbiB1bmxvYWRpbmcuLi5cIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW51cCBVSSBjb21wb25lbnRzIGZpcnN0XG4gICAgICBpZiAodGhpcy5zZXR0aW5nc1RhYikge1xuICAgICAgICAvLyBTZXR0aW5ncyB0YWIgaXMgYXV0b21hdGljYWxseSBjbGVhbmVkIHVwIGJ5IE9ic2lkaWFuXG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFudXAgbWFuYWdlcnMgYW5kIHZpZXdzXG4gICAgICBpZiAodGhpcy5jb21tYW5kTWFuYWdlcikge1xuICAgICAgICAvLyBVbnJlZ2lzdGVyIGFsbCBjb21tYW5kcyBieSB0aGVpciBJRHNcbiAgICAgICAgY29uc3QgY29tbWFuZHMgPSBbXG4gICAgICAgICAgXCJvcGVuLXRhc2tzLWZpbGVcIixcbiAgICAgICAgICBcInRvZ2dsZS1hdWRpby1yZWNvcmRlclwiLFxuICAgICAgICAgIFwib3Blbi1zeXN0ZW1zY3VscHQtY2hhdFwiLFxuICAgICAgICAgIFwib3Blbi1jaGF0LWhpc3RvcnlcIixcbiAgICAgICAgICBcIm9wZW4tc3lzdGVtc2N1bHB0LWphbml0b3JcIixcbiAgICAgICAgICBcInJlbG9hZC1vYnNpZGlhblwiLFxuICAgICAgICAgIFwib3Blbi1zeXN0ZW1zY3VscHQtc2V0dGluZ3NcIixcbiAgICAgICAgICBcImNoYW5nZS1jaGF0LW1vZGVsXCIsXG4gICAgICAgICAgXCJjaGF0LXdpdGgtZmlsZVwiLFxuICAgICAgICAgIFwic3VnZ2VzdC1lZGl0c1wiLFxuICAgICAgICAgIFwiY2xlYXItc3VnZ2VzdGVkLWVkaXRzXCIsXG4gICAgICAgICAgXCJtb3ZlLXRhc2stdXBcIixcbiAgICAgICAgICBcIm1vdmUtdGFzay1kb3duXCIsXG4gICAgICAgICAgXCJpbmRlbnQtdGFzay1yaWdodFwiLFxuICAgICAgICAgIFwiaW5kZW50LXRhc2stbGVmdFwiXG4gICAgICAgIF07XG4gICAgICAgIGNvbW1hbmRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgICAgLy8gQHRzLWlnbm9yZSAtIHJlbW92ZUNvbW1hbmQgZXhpc3RzIGJ1dCBpc24ndCBpbiB0aGUgdHlwZXNcbiAgICAgICAgICB0aGlzLmFwcC5jb21tYW5kcy5yZW1vdmVDb21tYW5kKGAke3RoaXMubWFuaWZlc3QuaWR9OiR7aWR9YCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbnVwIHZpZXdzXG4gICAgICBpZiAodGhpcy52aWV3TWFuYWdlcikge1xuICAgICAgICB0aGlzLnZpZXdNYW5hZ2VyLnVubG9hZFZpZXdzKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFudXAgc2VydmljZXMgaW4gcmV2ZXJzZSBvcmRlciBvZiBpbml0aWFsaXphdGlvblxuICAgICAgaWYgKHRoaXMuY29udGV4dE1lbnUpIHtcbiAgICAgICAgLy8gQ29udGV4dCBtZW51IGlzIGNsZWFuZWQgdXAgYXV0b21hdGljYWxseVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMucmVjb3JkZXJTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlLnVubG9hZCgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZS51bmxvYWQoKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIGFjY2Vzc2luZyBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZVxuICAgICAgICBUcmFuc2NyaXB0aW9uU2VydmljZS5pbnN0YW5jZSA9IG51bGw7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5haVNlcnZpY2UpIHtcbiAgICAgICAgLy8gUmVzZXQgU3lzdGVtU2N1bHB0U2VydmljZSBzaW5nbGV0b25cbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIGFjY2Vzc2luZyBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZVxuICAgICAgICBTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1vZGVsU2VydmljZSkge1xuICAgICAgICAvLyBSZXNldCBNb2RlbFNlcnZpY2Ugc2luZ2xldG9uXG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBhY2Nlc3NpbmcgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2VcbiAgICAgICAgTW9kZWxTZXJ2aWNlLmluc3RhbmNlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSkge1xuICAgICAgICAvLyBDdXN0b20gcHJvdmlkZXIgY2xlYW51cCBpZiBuZWVkZWRcbiAgICAgIH1cbiAgICAgIC8vIFRhc2tzU2VydmljZSBjbGVhbnVwIGlzIGhhbmRsZWQgYXV0b21hdGljYWxseSBieSBPYnNpZGlhbidzIGV2ZW50IHN5c3RlbVxuICAgICAgLy8gd2hlbiB0aGUgcGx1Z2luIGlzIHVubG9hZGVkXG5cbiAgICAgIC8vIFJlc2V0IHN5c3RlbSBwcm9tcHQgc2VydmljZSBzdGF0ZVxuICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5jbGVhckNhY2hlKCk7XG5cbiAgICAgIC8vIENsZWFyIGFueSByZWdpc3RlcmVkIGV4dGVuc2lvbnNcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlZ2lzdGVyZWRFeHRlbnNpb25zID0gKHRoaXMuYXBwIGFzIGFueSkudmlld1JlZ2lzdHJ5XG4gICAgICAgICAgLnR5cGVCeUV4dGVuc2lvbjtcbiAgICAgICAgaWYgKHJlZ2lzdGVyZWRFeHRlbnNpb25zPy5zcnQpIHtcbiAgICAgICAgICBkZWxldGUgcmVnaXN0ZXJlZEV4dGVuc2lvbnMuc3J0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVucmVnaXN0ZXIgLnNydCBleHRlbnNpb246XCIsIGVycm9yKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXCJTeXN0ZW1TY3VscHQgQUkgcGx1Z2luIHVubG9hZGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBwbHVnaW4gY2xlYW51cDpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IHRvIGVuc3VyZSBPYnNpZGlhbiBrbm93cyBhYm91dCB0aGUgY2xlYW51cCBmYWlsdXJlXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZERhdGEoKSB7XG4gICAgcmV0dXJuIHN1cGVyLmxvYWREYXRhKCk7XG4gIH1cblxuICBhc3luYyBzYXZlRGF0YShkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gc3VwZXIuc2F2ZURhdGEoZGF0YSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBnZXRSZWNvcmRlclNlcnZpY2UoKTogUmVjb3JkZXJTZXJ2aWNlIHtcbiAgICByZXR1cm4gdGhpcy5yZWNvcmRlclNlcnZpY2U7XG4gIH1cblxuICBnZXRUcmFuc2NyaXB0aW9uU2VydmljZSgpOiBUcmFuc2NyaXB0aW9uU2VydmljZSB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIH1cblxuICBnZXRMaWNlbnNlTWFuYWdlcigpOiBMaWNlbnNlTWFuYWdlciB7XG4gICAgcmV0dXJuIHRoaXMubGljZW5zZU1hbmFnZXI7XG4gIH1cblxuICBnZXRTZXR0aW5nc01hbmFnZXIoKTogU2V0dGluZ3NNYW5hZ2VyIHtcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5nc01hbmFnZXI7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZyZXNoIG1vZGVscyBmcm9tIHRoZSBtb2RlbCBzZXJ2aWNlXG4gICAqL1xuICBwdWJsaWMgZ2V0SW5pdGlhbE1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IERFRkFVTFRfU0VUVElOR1MsIFBBVFJFT05fVVJMIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBhdHRhY2hGb2xkZXJTdWdnZXN0ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb2xkZXJTdWdnZXN0ZXJcIjtcbmltcG9ydCB7IHJlcXVlc3RVcmwgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IHNob3dTeXN0ZW1Qcm9tcHRNb2RhbCB9IGZyb20gXCIuL1N5c3RlbVByb21wdE1vZGFsXCI7XG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIHN5c3RlbVNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZGVib3VuY2VUaW1lcjogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHRoaXMuYXBwXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVEaXJlY3RvcnkocGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCFwYXRoKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gKFxuICAgICAgIXBhdGguaW5jbHVkZXMoXCIuLlwiKSAmJiAhcGF0aC5zdGFydHNXaXRoKFwiL1wiKSAmJiAhcGF0aC5zdGFydHNXaXRoKFwiXFxcXFwiKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZURpcmVjdG9yeUNoYW5nZShcbiAgICB2YWx1ZTogc3RyaW5nLFxuICAgIHNldHRpbmdLZXk6XG4gICAgICB8IFwiYXR0YWNobWVudHNEaXJlY3RvcnlcIlxuICAgICAgfCBcInJlY29yZGluZ3NEaXJlY3RvcnlcIlxuICAgICAgfCBcImNoYXRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJleHRyYWN0aW9uc0RpcmVjdG9yeVwiXG4gICAgICB8IFwic3lzdGVtUHJvbXB0c0RpcmVjdG9yeVwiXG4gICAgICB8IFwidGFza3NEaXJlY3RvcnlcIlxuICApIHtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGVEaXJlY3RvcnkodmFsdWUpKSB7XG4gICAgICBzaG93UG9wdXAoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkludmFsaWQgZGlyZWN0b3J5IHBhdGguIFBsZWFzZSB1c2UgcmVsYXRpdmUgcGF0aHMgd2l0aG91dCAnLi4nIG9yIGxlYWRpbmcgc2xhc2hlcy5cIlxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZWJvdW5jZVRpbWVyKSBjbGVhclRpbWVvdXQodGhpcy5kZWJvdW5jZVRpbWVyKTtcblxuICAgIHRoaXMuZGVib3VuY2VUaW1lciA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0gPSB2YWx1ZTtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgIH0sIDUwMCk7XG4gIH1cblxuICBhc3luYyBkaXNwbGF5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIC8vIE1haW4gY29udGFpbmVyIHdpdGggdGFic1xuICAgIGNvbnN0IG1haW5Db250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1jb250YWluZXJcIlxuICAgICk7XG4gICAgbWFpbkNvbnRhaW5lci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJTeXN0ZW1TY3VscHQgQUkgU2V0dGluZ3NcIiB9KTtcblxuICAgIC8vIFRhYiBuYXZpZ2F0aW9uXG4gICAgY29uc3QgdGFiQ29udGFpbmVyID0gbWFpbkNvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3MtdGFic1wiKTtcbiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gbWFpbkNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1jb250ZW50XCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHRhYnNcbiAgICBjb25zdCB0YWJzID0gW1xuICAgICAgeyBpZDogXCJsaWNlbnNlXCIsIGxhYmVsOiBcIkxpY2Vuc2VcIiB9LFxuICAgICAgeyBpZDogXCJkaXJlY3Rvcmllc1wiLCBsYWJlbDogXCJEaXJlY3Rvcmllc1wiIH0sXG4gICAgICB7IGlkOiBcInJlY29yZGVyXCIsIGxhYmVsOiBcIlJlY29yZGVyXCIgfSxcbiAgICAgIHsgaWQ6IFwiY2hhdFwiLCBsYWJlbDogXCJDaGF0XCIgfSxcbiAgICAgIHsgaWQ6IFwidGFza3NcIiwgbGFiZWw6IFwiVGFza3NcIiB9LFxuICAgICAgeyBpZDogXCJhZHZhbmNlZFwiLCBsYWJlbDogXCJBZHZhbmNlZFwiIH0sXG4gICAgXTtcblxuICAgIC8vIEFkZCB0YWIgYnV0dG9uc1xuICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PiB7XG4gICAgICBjb25zdCB0YWJCdXR0b24gPSB0YWJDb250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRhYi1idXR0b25cIixcbiAgICAgICAgdGV4dDogdGFiLmxhYmVsLFxuICAgICAgfSk7XG4gICAgICB0YWJCdXR0b24uZGF0YXNldC50YWIgPSB0YWIuaWQ7XG4gICAgICBpZiAodGFiLmlkID09PSBcImxpY2Vuc2VcIikgdGFiQnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRhYiBjb250ZW50IHNlY3Rpb25zXG4gICAgY29uc3QgaXNQcm9BY3RpdmUgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPT09IHRydWU7XG4gICAgY29uc3QgbGljZW5zZUNvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50IGFjdGl2ZVwiXG4gICAgKTtcbiAgICBjb25zdCBkaXJlY3Rvcmllc0NvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCJcbiAgICApO1xuICAgIGNvbnN0IHJlY29yZGVyQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgY2hhdENvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiKTtcbiAgICBjb25zdCB0YXNrc0NvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiKTtcbiAgICBjb25zdCBhZHZhbmNlZENvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCJcbiAgICApO1xuXG4gICAgLy8gQWRkIGNvbnRlbnQgdG8gZWFjaCB0YWJcbiAgICB0aGlzLmRpc3BsYXlMaWNlbnNlVGFiKGxpY2Vuc2VDb250ZW50LCBpc1Byb0FjdGl2ZSk7XG4gICAgdGhpcy5kaXNwbGF5RGlyZWN0b3JpZXNUYWIoZGlyZWN0b3JpZXNDb250ZW50LCBpc1Byb0FjdGl2ZSk7XG4gICAgdGhpcy5kaXNwbGF5UmVjb3JkZXJUYWIocmVjb3JkZXJDb250ZW50KTtcbiAgICB0aGlzLmRpc3BsYXlDaGF0VGFiKGNoYXRDb250ZW50KTtcbiAgICB0aGlzLmRpc3BsYXlUYXNrc1RhYih0YXNrc0NvbnRlbnQpO1xuICAgIHRoaXMuZGlzcGxheUFkdmFuY2VkVGFiKGFkdmFuY2VkQ29udGVudCk7XG5cbiAgICAvLyBBZGQgdGFiIGNsaWNrIGhhbmRsZXJzXG4gICAgdGFiQ29udGFpbmVyXG4gICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvblwiKVxuICAgICAgLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgY29uc3QgdGFiSWQgPSB0YXJnZXQuZGF0YXNldC50YWI7XG5cbiAgICAgICAgICAvLyBSZW1vdmUgYWN0aXZlIGNsYXNzZXNcbiAgICAgICAgICB0YWJDb250YWluZXJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uXCIpXG4gICAgICAgICAgICAuZm9yRWFjaCgoYikgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpKTtcbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIilcbiAgICAgICAgICAgIC5mb3JFYWNoKChjKSA9PiBjLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xuXG4gICAgICAgICAgLy8gQWRkIGFjdGl2ZSBjbGFzc2VzIHRvIHNlbGVjdGVkIHRhYlxuICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICAgIGNvbnRlbnRDb250YWluZXJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWI9XCIke3RhYklkfVwiXWApXG4gICAgICAgICAgICA/LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyBBZGQgc3R5bGVzIGlmIG5vdCBhbHJlYWR5IGFkZGVkXG4gICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1zdHlsZXNcIikpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgICAgc3R5bGUuaWQgPSBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1zdHlsZXNcIjtcbiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgLnN5c3RlbXNjdWxwdC1zZXR0aW5ncy10YWJzIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgZmxleC13cmFwOiB3cmFwO1xuICAgICAgICBnYXA6IDRweDtcbiAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTtcbiAgICAgICAgcGFkZGluZy1ib3R0b206IDhweDtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDAlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1idXR0b24ge1xuICAgICAgICBiYWNrZ3JvdW5kOiBub25lO1xuICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgIHBhZGRpbmc6IDZweCAxMnB4O1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTtcbiAgICAgICAgZm9udC1zaXplOiAwLjllbTtcbiAgICAgICAgZmxleDogMSAxIGF1dG87XG4gICAgICAgIG1pbi13aWR0aDogMTIwcHg7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uOmhvdmVyIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ob3Zlcik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvbi5hY3RpdmUge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1vbi1hY2NlbnQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1jb250ZW50IHtcbiAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDAlO1xuICAgICAgICBvdmVyZmxvdy14OiBoaWRkZW47XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnQuYWN0aXZlIHtcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIHBhZGRpbmc6IDAgOHB4O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvKiBMaWNlbnNlIFRhYiBTdHlsaW5nICovXG4gICAgICAuc3lzdGVtc2N1bHB0LWxpY2Vuc2UtaW5wdXQge1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgbWF4LXdpZHRoOiA0MDBweDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnByby1iYWRnZSB7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgICAgIHBhZGRpbmc6IDJweCA4cHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgZm9udC1zaXplOiAwLjhlbTtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgICAgICAgbWFyZ2luLWxlZnQ6IDhweDtcbiAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnRva2VuLWJhbGFuY2UtdmFsdWUge1xuICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICBtYXJnaW4tbGVmdDogOHB4O1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWZlYXR1cmVzLWdyaWQgLnNldHRpbmctaXRlbSB7XG4gICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeS1hbHQpO1xuICAgICAgICBtYXJnaW46IDRweCAwO1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWJlbmVmaXRzLWxpc3Qge1xuICAgICAgICBtYXJnaW46IDE2cHggMDtcbiAgICAgICAgcGFkZGluZy1sZWZ0OiAyMHB4O1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5wcm8tYmVuZWZpdHMtbGlzdCBsaSB7XG4gICAgICAgIG1hcmdpbjogOHB4IDA7XG4gICAgICAgIGxpc3Qtc3R5bGUtdHlwZTogJ1x1MjE5Mic7XG4gICAgICAgIHBhZGRpbmctbGVmdDogMjBweDtcbiAgICAgICAgdGV4dC1pbmRlbnQ6IC0xMnB4O1xuICAgICAgICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICAgICAgfVxuICAgIGA7XG4gICAgICBtYWluQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlMaWNlbnNlVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgaXNQcm9BY3RpdmU6IGJvb2xlYW4pIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwibGljZW5zZVwiO1xuICAgIGNvbnN0IGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtbGljZW5zZS1zZXR0aW5nc1wiXG4gICAgKTtcblxuICAgIGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiaDNcIiwge1xuICAgICAgdGV4dDogXCJTeXN0ZW1TY3VscHQgTGljZW5zZVwiLFxuICAgIH0pO1xuXG4gICAgLy8gTGljZW5zZSBLZXkgU2VjdGlvblxuICAgIGNvbnN0IGxpY2Vuc2VTZXR0aW5nID0gbmV3IFNldHRpbmcobGljZW5zZVNldHRpbmdDb250YWluZXIpXG4gICAgICAuc2V0TmFtZShcIkxpY2Vuc2UgS2V5XCIpXG4gICAgICAuc2V0RGVzYyhcIlVubG9jayBQcm8gZmVhdHVyZXMgd2l0aCB5b3VyIGxpY2Vuc2Uga2V5XCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiUGFzdGUgbGljZW5zZSBrZXlcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5ID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5pbnB1dEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWxpY2Vuc2UtaW5wdXRcIik7XG4gICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gXCJwYXNzd29yZFwiO1xuICAgICAgICB0ZXh0LmlucHV0RWwuc3R5bGUuZm9udEZhbWlseSA9IFwibW9ub3NwYWNlXCI7XG4gICAgICAgIHRleHQuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gXCJ0ZXh0XCI7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBcImluaGVyaXRcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIHRleHQuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCAoKSA9PiB7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnR5cGUgPSBcInBhc3N3b3JkXCI7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBcIm1vbm9zcGFjZVwiO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICB9KVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZShpc1Byb0FjdGl2ZSlcbiAgICAgICAgICAuc2V0VG9vbHRpcChcbiAgICAgICAgICAgIGlzUHJvQWN0aXZlID8gXCJEaXNhYmxlIFBybyBmZWF0dXJlc1wiIDogXCJFbmFibGUgUHJvIGZlYXR1cmVzXCJcbiAgICAgICAgICApXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgIC8vIE9ubHkgdmFsaWRhdGUgd2hlbiB0b2dnbGluZyBPTlxuICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICAgICAuZ2V0TGljZW5zZU1hbmFnZXIoKVxuICAgICAgICAgICAgICAgIC52YWxpZGF0ZUxpY2Vuc2VLZXkodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICBcIkludmFsaWQgbGljZW5zZSBrZXkgLSBQcm8gZmVhdHVyZXMgZGlzYWJsZWRcIlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChpc1Byb0FjdGl2ZSkge1xuICAgICAgICAgIHRvZ2dsZS50b2dnbGVFbC5hZGRDbGFzcyhcIm1vZC1jdGFcIik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgaWYgKGlzUHJvQWN0aXZlKSB7XG4gICAgICBjb25zdCBzdGF0dXNTZXR0aW5nID0gbmV3IFNldHRpbmcobGljZW5zZVNldHRpbmdDb250YWluZXIpXG4gICAgICAgIC5zZXROYW1lKFwiUHJvIFN0YXR1c1wiKVxuICAgICAgICAuc2V0RGVzYyhcIkFjdGl2ZSBzdWJzY3JpcHRpb24gXHUyMDIyIFByZW1pdW0gZmVhdHVyZXMgZW5hYmxlZFwiKTtcblxuICAgICAgc3RhdHVzU2V0dGluZy5uYW1lRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJwcm8tYmFkZ2VcIixcbiAgICAgICAgdGV4dDogXCJBQ1RJVkVcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBiYWxhbmNlRWwgPSBjcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInRva2VuLWJhbGFuY2UtdmFsdWVcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nLi4uXCIsXG4gICAgICB9KTtcblxuICAgICAgc3RhdHVzU2V0dGluZy5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRJY29uKFwic3BhcmtsZXNcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkF2YWlsYWJsZSBjcmVkaXRzXCIpXG4gICAgICAgICAgLnNldERpc2FibGVkKHRydWUpO1xuICAgICAgICBzdGF0dXNTZXR0aW5nLmNvbnRyb2xFbC5hcHBlbmRDaGlsZChiYWxhbmNlRWwpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmRpc3BsYXlUb2tlbkJhbGFuY2UoYmFsYW5jZUVsKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgUHJvIHByb21vdGlvbiBzZWN0aW9uIGlmIG5vdCBhY3RpdmVcbiAgICB0aGlzLmRpc3BsYXlQcm9Qcm9tb3Rpb25TZWN0aW9uKGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLCBpc1Byb0FjdGl2ZSk7XG5cbiAgICAvLyBBZGQgYmV0YSBub3RpY2Ugc2VjdGlvblxuICAgIGNvbnN0IGJldGFOb3RpY2VFbCA9IGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYmV0YS1ub3RpY2VcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IGJldGFOb3RpY2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwiYmV0YS1ub3RpY2UtaGVhZGVyXCIsXG4gICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhoZWFkZXJDb250YWluZXIpXG4gICAgICAuc2V0SGVhZGluZygpXG4gICAgICAuc2V0TmFtZShcIkJldGEgVGVzdGluZyBQaGFzZVwiKVxuICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uXG4gICAgICAgICAgLnNldEljb24oXCJyb2NrZXRcIilcbiAgICAgICAgICAuc2V0RGlzYWJsZWQodHJ1ZSlcbiAgICAgICAgICAuZXh0cmFTZXR0aW5nc0VsLmFkZENsYXNzKFwiYmV0YS1oZWFkZXItaWNvblwiKTtcbiAgICAgIH0pO1xuXG4gICAgYmV0YU5vdGljZUVsLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBcIlRoYW5rIHlvdSBmb3IgdHJ5aW5nIG91dCBTeXN0ZW1TY3VscHQhIFdoaWxlIHNvbWUgY29yZSBmZWF0dXJlcyBhcmUgYXZhaWxhYmxlIHRvIGV2ZXJ5b25lIGR1cmluZyB0aGlzIGJldGEgcGhhc2UsIGNlcnRhaW4gYWR2YW5jZWQgY2FwYWJpbGl0aWVzIGFyZSBjdXJyZW50bHkgbGltaXRlZCB0byBQYXRyZW9uIG1lbWJlcnMgdG8gaGVscCBtYW5hZ2UgdGhlIHRlc3RpbmcgZ3JvdXAgc2l6ZS5cIixcbiAgICAgIGNsczogXCJiZXRhLW5vdGljZS10ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBiZXRhTm90aWNlRWwuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgIHRleHQ6IFwiQXMgYSBzb2xvIGRldmVsb3BlciwgeW91ciBmZWVkYmFjayBpcyBpbmNyZWRpYmx5IHZhbHVhYmxlIGluIHNoYXBpbmcgU3lzdGVtU2N1bHB0LiBGZWVsIGZyZWUgdG8gdGVzdCB0aGUgYXZhaWxhYmxlIGZlYXR1cmVzLCBhbmQgaWYgeW91J2QgbGlrZSBhY2Nlc3MgdG8gdGhlIGZ1bGwgYmV0YSBleHBlcmllbmNlLCBjb25zaWRlciBiZWNvbWluZyBhIFBhdHJlb24gc3VwcG9ydGVyIVwiLFxuICAgICAgY2xzOiBcImJldGEtbm90aWNlLXRleHRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LWJldGEtc3R5bGVzXCIpKSB7XG4gICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgICAgIHN0eWxlLmlkID0gXCJzeXN0ZW1zY3VscHQtYmV0YS1zdHlsZXNcIjtcbiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgICAuc3lzdGVtc2N1bHB0LWJldGEtbm90aWNlIHtcbiAgICAgICAgICBtYXJnaW4tdG9wOiAzMnB4O1xuICAgICAgICAgIHBhZGRpbmc6IDIwcHg7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgICAgICBib3gtc2hhZG93OiAwIDFweCAzcHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtbm90aWNlLWhlYWRlciB7XG4gICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLW5vdGljZS1oZWFkZXIgLnNldHRpbmctaXRlbSB7XG4gICAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtaGVhZGVyIC5zZXR0aW5nLWl0ZW0tbmFtZSB7XG4gICAgICAgICAgZm9udC1zaXplOiAxLjJlbTtcbiAgICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1oZWFkZXItaWNvbiB7XG4gICAgICAgICAgY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCkgIWltcG9ydGFudDtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xuICAgICAgICAgIG1hcmdpbi1yaWdodDogOHB4ICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtdGV4dCB7XG4gICAgICAgICAgbWFyZ2luOiAxMnB4IDA7XG4gICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgICBsaW5lLWhlaWdodDogMS42O1xuICAgICAgICAgIGZvbnQtc2l6ZTogMC45NWVtO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRoZW1lLWRhcmsgLnN5c3RlbXNjdWxwdC1iZXRhLW5vdGljZSB7XG4gICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwgMCwgMCwgMC4yKTtcbiAgICAgICAgfVxuICAgICAgYDtcbiAgICAgIGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRpc3BsYXlUb2tlbkJhbGFuY2UoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCB0aGlzLnN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0VG9rZW5CYWxhbmNlKCk7XG4gICAgICBjb250YWluZXJFbC5zZXRUZXh0KGBBdmFpbGFibGUgQ3JlZGl0czogJHtiYWxhbmNlLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnRhaW5lckVsLnNldFRleHQoXCJVbmFibGUgdG8gZmV0Y2ggY3JlZGl0IGJhbGFuY2VcIik7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRva2VuIGJhbGFuY2U6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlQcm9Qcm9tb3Rpb25TZWN0aW9uKFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcbiAgICBpc1Byb0FjdGl2ZTogYm9vbGVhblxuICApIHtcbiAgICBpZiAoIWlzUHJvQWN0aXZlKSB7XG4gICAgICBjb25zdCBwcm9Qcm9tb3Rpb25FbCA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm8tcHJvbW90aW9uXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaGVhZGVyQ29udGFpbmVyID0gcHJvUHJvbW90aW9uRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwicHJvLXByb21vdGlvbi1oZWFkZXJcIixcbiAgICAgIH0pO1xuXG4gICAgICBuZXcgU2V0dGluZyhoZWFkZXJDb250YWluZXIpXG4gICAgICAgIC5zZXRIZWFkaW5nKClcbiAgICAgICAgLnNldE5hbWUoXCJVcGdyYWRlIHRvIFByb1wiKVxuICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIGJ1dHRvblxuICAgICAgICAgICAgLnNldEljb24oXCJzcGFya2xlc1wiKVxuICAgICAgICAgICAgLnNldERpc2FibGVkKHRydWUpXG4gICAgICAgICAgICAuZXh0cmFTZXR0aW5nc0VsLmFkZENsYXNzKFwicHJvLWhlYWRlci1pY29uXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgcHJvUHJvbW90aW9uRWwuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgICAgdGV4dDogXCJUcmFuc2Zvcm0geW91ciB3b3JrZmxvdyB3aXRoIHBvd2VyZnVsIEFJIGZlYXR1cmVzIGRlc2lnbmVkIGZvciBzZXJpb3VzIHByb2R1Y3Rpdml0eS5cIixcbiAgICAgICAgY2xzOiBcInByby1wcm9tb3Rpb24tdGV4dFwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJlbmVmaXRzTGlzdCA9IHByb1Byb21vdGlvbkVsLmNyZWF0ZUVsKFwidWxcIiwge1xuICAgICAgICBjbHM6IFwicHJvLWJlbmVmaXRzLWxpc3RcIixcbiAgICAgIH0pO1xuXG4gICAgICBbXG4gICAgICAgIFwiQXVkaW8gUmVjb3JkaW5nICYgSW5zdGFudCBUcmFuc2NyaXB0aW9uXCIsXG4gICAgICAgIFwiU21hcnQgRG9jdW1lbnQgUHJvY2Vzc2luZ1wiLFxuICAgICAgICBcIlJlYWwtdGltZSBWb2ljZS10by1UZXh0IGluIE5vdGVzICYgQ2hhdFwiLFxuICAgICAgICBcIk11bHRpLWZvcm1hdCBTdXBwb3J0IChQREYsIEF1ZGlvLCBJbWFnZXMpXCIsXG4gICAgICAgIFwiQUkgVGVtcGxhdGVzICYgQ3VzdG9tIFBlcnNvbmFsaXRpZXNcIixcbiAgICAgICAgXCJQcmlvcml0eSBBY2Nlc3MgdG8gTmV3IEZlYXR1cmVzXCIsXG4gICAgICAgIFwiMS1vbi0xIFN1cHBvcnQgdmlhIFBhdHJlb24gRE1zXCIsXG4gICAgICAgIFwiU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBEZXZlbG9wbWVudFwiLFxuICAgICAgXS5mb3JFYWNoKChiZW5lZml0KSA9PiB7XG4gICAgICAgIGJlbmVmaXRzTGlzdC5jcmVhdGVFbChcImxpXCIsIHsgdGV4dDogYmVuZWZpdCB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBuZXcgU2V0dGluZyhwcm9Qcm9tb3Rpb25FbCkuYWRkQnV0dG9uKChidXR0b24pID0+XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQmVjb21lIGEgUGF0cm9uXCIpXG4gICAgICAgICAgLnNldEN0YSgpXG4gICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheUNoYXRUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImNoYXRcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJDaGF0IFNldHRpbmdzXCIgfSk7XG5cbiAgICAvLyBBSSBNb2RlbCBTZXR0aW5nXG4gICAgY29uc3QgbW9kZWxTZXR0aW5nID0gbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkFJIE1vZGVsXCIpXG4gICAgICAuc2V0RGVzYyhcIlNlbGVjdCB3aGljaCBBSSBtb2RlbCB0byB1c2UgZm9yIGNoYXRcIik7XG5cbiAgICBtb2RlbFNldHRpbmcuYWRkQnV0dG9uKChidXR0b24pID0+XG4gICAgICBidXR0b24uc2V0QnV0dG9uVGV4dChcIlNlbGVjdCBNb2RlbFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgYnV0dG9uLnNldERpc2FibGVkKHRydWUpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMuc3lzdGVtU2N1bHB0U2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICBhc3luYyAobW9kZWxJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAgICAgICAgIGNvbnN0IG1vZGVsRGlzcGxheSA9IGNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgXCIuc3lzdGVtc2N1bHB0LWN1cnJlbnQtbW9kZWxcIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBpZiAobW9kZWxEaXNwbGF5KSB7XG4gICAgICAgICAgICAgICAgbW9kZWxEaXNwbGF5LnNldFRleHQoYEN1cnJlbnQgbW9kZWw6ICR7bW9kZWxJZH1gKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBtb2RlbHM6XCIsIGVycm9yKTtcbiAgICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiRmFpbGVkIHRvIGxvYWQgYXZhaWxhYmxlIG1vZGVsc1wiKTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICBidXR0b24uc2V0RGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBtb2RlbFNldHRpbmcuZGVzY0VsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIHRleHQ6IGBDdXJyZW50IG1vZGVsOiAke3RoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZH1gLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXJyZW50LW1vZGVsXCIsXG4gICAgfSk7XG5cbiAgICAvLyBTeXN0ZW0gUHJvbXB0IFNldHRpbmdcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQ2hhdCBTeXN0ZW0gUHJvbXB0XCIpXG4gICAgICAuc2V0RGVzYyhcIkN1c3RvbWl6ZSB0aGUgc3lzdGVtIHByb21wdCB1c2VkIGZvciBhbGwgbmV3IGNoYXRzXCIpXG4gICAgICAuYWRkQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoXCJFZGl0IFByb21wdFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93U3lzdGVtUHJvbXB0TW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgb25TYXZlOiBhc3luYyAobmV3UHJvbXB0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0ID0gbmV3UHJvbXB0O1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OlxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdHNEaXJlY3RvcnksXG4gICAgICAgICAgICAgIG1vZGU6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDogdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKHJlc3VsdD8uY29udGVudCkge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0ID0gcmVzdWx0LmNvbnRlbnQ7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlID0gcmVzdWx0LnR5cGU7XG4gICAgICAgICAgICBpZiAocmVzdWx0Py50eXBlID09PSBcImN1c3RvbVwiICYmIHJlc3VsdD8ucGF0aCkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoID0gcmVzdWx0LnBhdGg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidXR0b247XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheUFkdmFuY2VkVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJhZHZhbmNlZFwiO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkRldmVsb3BtZW50IE1vZGVcIilcbiAgICAgIC5zZXREZXNjKFwiVG9nZ2xlIGJldHdlZW4gZGV2ZWxvcG1lbnQgYW5kIHByb2R1Y3Rpb24gQVBJIGVuZHBvaW50c1wiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VydmVyVXJsID0gdmFsdWVcbiAgICAgICAgICAgICAgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiXG4gICAgICAgICAgICAgIDogXCJodHRwczovL2FwaS5zeXN0ZW1zY3VscHQuY29tXCI7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgICAgICAgIGBTd2l0Y2hlZCB0byAke3ZhbHVlID8gXCJkZXZlbG9wbWVudFwiIDogXCJwcm9kdWN0aW9uXCJ9IG1vZGUgKCR7XG4gICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlLmJhc2VVcmxcbiAgICAgICAgICAgICAgfSlgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgLy8gUmVzZXQgdG8gRmFjdG9yeSBTZXR0aW5ncyBidXR0b25cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUmVzZXQgdG8gRmFjdG9yeSBTZXR0aW5nc1wiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiQ2xlYXIgYWxsIGN1c3RvbSBzZXR0aW5ncyBhbmQgcmVzdG9yZSBkZWZhdWx0cyBmb3IgdGhpcyBwbHVnaW4uXCJcbiAgICAgIClcbiAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xuICAgICAgICBidG4uc2V0QnV0dG9uVGV4dChcIlJlc2V0XHUyMDI2XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbmZpcm0gPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIFwiUmVzZXQgdG8gRmFjdG9yeSBEZWZhdWx0c1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgICBcIlRoaXMgd2lsbCBkZWxldGUgQUxMIHNhdmVkIHNldHRpbmdzIGFuZCBjdXN0b21pemF0aW9ucyBmb3IgU3lzdGVtU2N1bHB0LCByZXR1cm5pbmcgZXZlcnl0aGluZyB0byBkZWZhdWx0LiBEbyB5b3Ugd2FudCB0byBjb250aW51ZT9cIixcbiAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJSZXNldCAmIFJlbG9hZFwiLFxuICAgICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWNvbmZpcm0gfHwgIWNvbmZpcm0uY29uZmlybWVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKG51bGwpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICAgLmdldFNldHRpbmdzTWFuYWdlcigpXG4gICAgICAgICAgICAgIC51cGRhdGVTZXR0aW5ncyhERUZBVUxUX1NFVFRJTkdTKTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlc2V0dGluZyB0byBmYWN0b3J5IHNldHRpbmdzOlwiLCBlcnJvcik7XG4gICAgICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiRmFpbGVkIHRvIHJlc2V0OiBcIiArIFN0cmluZyhlcnJvcikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZGlzcGxheURpcmVjdG9yaWVzVGFiKFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcbiAgICBpc1Byb0FjdGl2ZTogYm9vbGVhblxuICApIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwiZGlyZWN0b3JpZXNcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJEaXJlY3RvcnkgU2V0dGluZ3NcIiB9KTtcblxuICAgIC8vIENvcmUgZGlyZWN0b3JpZXMgKGFsd2F5cyBhdmFpbGFibGUpXG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIkNoYXRzIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSBmb3IgeW91ciBjaGF0IGhpc3RvcnlcIixcbiAgICAgIFwiY2hhdHNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L0NoYXRzXCJcbiAgICApO1xuXG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIlJlY29yZGluZ3MgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIHJlY29yZGluZ3NcIixcbiAgICAgIFwicmVjb3JkaW5nc0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvUmVjb3JkaW5nc1wiXG4gICAgKTtcblxuICAgIC8vIENoYW5nZWQgdG8gXCJTeXN0ZW0gUHJvbXB0c1wiXG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIlN5c3RlbSBQcm9tcHRzIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSBmb3IgeW91ciBjdXN0b20gc3lzdGVtIHByb21wdHNcIixcbiAgICAgIFwic3lzdGVtUHJvbXB0c0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIlxuICAgICk7XG5cbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiQXR0YWNobWVudHMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciBzYXZlZCBpbWFnZXMgYW5kIGF0dGFjaG1lbnRzXCIsXG4gICAgICBcImF0dGFjaG1lbnRzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9BdHRhY2htZW50c1wiXG4gICAgKTtcblxuICAgIC8vIEFsd2F5cyBkaXNwbGF5IHRoZXNlIGRpcmVjdG9yaWVzXG4gICAgdGhpcy5jcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgICAgY29udGFpbmVyRWwsXG4gICAgICBcIkV4dHJhY3Rpb25zIERpcmVjdG9yeVwiLFxuICAgICAgXCJTZWxlY3QgdGhlIGRpcmVjdG9yeSB3aGVyZSBleHRyYWN0ZWQgUERGcy9kb2NzIHdpbGwgYmUgcGxhY2VkXCIsXG4gICAgICBcImV4dHJhY3Rpb25zRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9FeHRyYWN0aW9uc1wiXG4gICAgKTtcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiVGFza3MgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIHRhc2sgbGlzdHNcIixcbiAgICAgIFwidGFza3NEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L1Rhc2tzXCJcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEaXJlY3RvcnlTZXR0aW5nKFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgZGVzYzogc3RyaW5nLFxuICAgIHNldHRpbmdLZXk6XG4gICAgICB8IFwiYXR0YWNobWVudHNEaXJlY3RvcnlcIlxuICAgICAgfCBcInJlY29yZGluZ3NEaXJlY3RvcnlcIlxuICAgICAgfCBcImNoYXRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJleHRyYWN0aW9uc0RpcmVjdG9yeVwiXG4gICAgICB8IFwic3lzdGVtUHJvbXB0c0RpcmVjdG9yeVwiXG4gICAgICB8IFwidGFza3NEaXJlY3RvcnlcIixcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nXG4gICkge1xuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUobmFtZSlcbiAgICAgIC5zZXREZXNjKGRlc2MpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZURpcmVjdG9yeUNoYW5nZSh2YWx1ZSwgc2V0dGluZ0tleSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgYXR0YWNoRm9sZGVyU3VnZ2VzdGVyKFxuICAgICAgICAgIHRleHQuaW5wdXRFbCxcbiAgICAgICAgICBhc3luYyAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnZhbGlkYXRlRGlyZWN0b3J5KHNlbGVjdGVkUGF0aCkpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0gPSBzZWxlY3RlZFBhdGg7XG4gICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgXCJJbnZhbGlkIGRpcmVjdG9yeSBwYXRoLiBQbGVhc2UgdXNlIHJlbGF0aXZlIHBhdGhzIHdpdGhvdXQgJy4uJyBvciBsZWFkaW5nIHNsYXNoZXMuXCJcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMuYXBwXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlSZWNvcmRlclRhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwicmVjb3JkZXJcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJSZWNvcmRpbmcgU2V0dGluZ3NcIiB9KTtcblxuICAgIGNvbnN0IG1pY3JvcGhvbmVTZXR0aW5nID0gbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlByZWZlcnJlZCBNaWNyb3Bob25lXCIpXG4gICAgICAuc2V0RGVzYyhcIlNlbGVjdCB5b3VyIHByZWZlcnJlZCBtaWNyb3Bob25lIGZvciByZWNvcmRpbmdzXCIpO1xuXG4gICAgY29uc3QgbWljU2VsZWN0ID0gbWljcm9waG9uZVNldHRpbmcuY29udHJvbEVsLmNyZWF0ZUVsKFwic2VsZWN0XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWljcm9waG9uZS1zZWxlY3RcIixcbiAgICB9KTtcblxuICAgIG1pY1NlbGVjdFxuICAgICAgLmNyZWF0ZUVsKFwib3B0aW9uXCIsIHtcbiAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgIHRleHQ6IFwiTG9hZGluZyBtaWNyb3Bob25lcy4uLlwiLFxuICAgICAgfSlcbiAgICAgIC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG5cbiAgICBtaWNTZWxlY3QuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgdHJ5IHtcbiAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXNcbiAgICAgICAgLmVudW1lcmF0ZURldmljZXMoKVxuICAgICAgICAudGhlbigoZGV2aWNlcykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1pY3JvcGhvbmVzID0gZGV2aWNlcy5maWx0ZXIoXG4gICAgICAgICAgICAoZGV2aWNlKSA9PiBkZXZpY2Uua2luZCA9PT0gXCJhdWRpb2lucHV0XCJcbiAgICAgICAgICApO1xuICAgICAgICAgIG1pY1NlbGVjdC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgIG1pY1NlbGVjdC5maXJzdEVsZW1lbnRDaGlsZD8ucmVtb3ZlKCk7IC8vIFJlbW92ZSBsb2FkaW5nIG1lc3NhZ2VcbiAgICAgICAgICBtaWNyb3Bob25lcy5mb3JFYWNoKChtaWMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IG1pY1NlbGVjdC5jcmVhdGVFbChcIm9wdGlvblwiLCB7XG4gICAgICAgICAgICAgIHZhbHVlOiBtaWMuZGV2aWNlSWQsXG4gICAgICAgICAgICAgIHRleHQ6IG1pYy5sYWJlbCB8fCBgTWljcm9waG9uZSAke21pYy5kZXZpY2VJZC5zbGljZSgwLCA4KX0uLi5gLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAobWljLmRldmljZUlkID09PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQpIHtcbiAgICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBlbnVtZXJhdGluZyBhdWRpbyBkZXZpY2VzOlwiLCBlcnJvcik7XG4gICAgICAgICAgbWljU2VsZWN0LmNyZWF0ZUVsKFwib3B0aW9uXCIsIHtcbiAgICAgICAgICAgIHZhbHVlOiBcIlwiLFxuICAgICAgICAgICAgdGV4dDogXCJVbmFibGUgdG8gbGlzdCBtaWNyb3Bob25lc1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1pY3JvcGhvbmUgaW5pdGlhbGl6YXRpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgfVxuXG4gICAgbWljU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlZmVycmVkTWljcm9waG9uZUlkID0gbWljU2VsZWN0LnZhbHVlO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQXV0by1UcmFuc2NyaWJlIFJlY29yZGluZ3NcIilcbiAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSB0cmFuc2NyaWJlIHJlY29yZGluZ3Mgd2hlbiB0aGV5IGFyZSBjb21wbGV0ZWRcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9UcmFuc2NyaWJlUmVjb3JkaW5ncylcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvVHJhbnNjcmliZVJlY29yZGluZ3MgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkF1dG8tUGFzdGUgVHJhbnNjcmlwdGlvblwiKVxuICAgICAgLnNldERlc2MoXCJBdXRvbWF0aWNhbGx5IHBhc3RlIHRyYW5zY3JpcHRpb25zIGludG8gdGhlIGFjdGl2ZSBkb2N1bWVudFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1Bhc3RlVHJhbnNjcmlwdGlvbilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvUGFzdGVUcmFuc2NyaXB0aW9uID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIC8vIEFkZCBuZXcgcG9zdC1wcm9jZXNzaW5nIHByb21wdCBzZXR0aW5nXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlBvc3QtUHJvY2Vzc2luZ1wiKVxuICAgICAgLnNldERlc2MoXCJDb25maWd1cmUgaG93IHRyYW5zY3JpcHRpb25zIHNob3VsZCBiZSBwb3N0LXByb2Nlc3NlZFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ0VuYWJsZWQpXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJFbmFibGUvZGlzYWJsZSBwb3N0LXByb2Nlc3NpbmdcIilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ0VuYWJsZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdG9nZ2xlO1xuICAgICAgfSlcbiAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkVkaXQgUHJvbXB0XCIpXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJDb25maWd1cmUgdGhlIHBvc3QtcHJvY2Vzc2luZyBwcm9tcHRcIilcbiAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHNob3dQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsIH0gPSBhd2FpdCBpbXBvcnQoXG4gICAgICAgICAgICAgIFwiLi9Qb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbChcbiAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ1Byb21wdFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ1Byb21wdCA9IHJlc3VsdC5jb250ZW50O1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5VGFza3NUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcInRhc2tzXCI7XG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoM1wiLCB7IHRleHQ6IFwiVGFza3MgU2V0dGluZ3NcIiB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBdXRvLU1vdmUgQ29tcGxldGVkIFRhc2tzXCIpXG4gICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgbW92ZSBjb21wbGV0ZWQgdGFza3MgdG8gdGhlIGJvdHRvbSBvZiB0aGUgbGlzdFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubW92ZUNvbXBsZXRlZFRhc2tzRG93bilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb3ZlQ29tcGxldGVkVGFza3NEb3duID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxufVxuIiwgImV4cG9ydCBpbnRlcmZhY2UgTW9kZWxBcmNoaXRlY3R1cmUge1xuICBtb2RhbGl0eTogc3RyaW5nO1xuICB0b2tlbml6ZXI6IHN0cmluZztcbiAgaW5zdHJ1Y3RfdHlwZTogc3RyaW5nIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbFByaWNpbmcge1xuICBwcm9tcHQ6IHN0cmluZztcbiAgY29tcGxldGlvbjogc3RyaW5nO1xuICBpbWFnZTogc3RyaW5nO1xuICByZXF1ZXN0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9wUHJvdmlkZXIge1xuICBjb250ZXh0X2xlbmd0aDogbnVtYmVyO1xuICBtYXhfY29tcGxldGlvbl90b2tlbnM6IG51bWJlciB8IG51bGw7XG4gIGlzX21vZGVyYXRlZDogYm9vbGVhbjtcbn1cblxuLy8gTmV3IGludGVyZmFjZSBmb3Igc3RvcmluZyBmYXZvcml0ZSBtb2RlbHNcbmV4cG9ydCBpbnRlcmZhY2UgRmF2b3JpdGVNb2RlbCB7XG4gIHByb3ZpZGVyOiBzdHJpbmc7XG4gIG1vZGVsSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbElkZW50aWZpZXIge1xuICBwcm92aWRlcklkOiBzdHJpbmc7IC8vIGUuZy4gXCJvcGVucm91dGVyXCIsIFwic3lzdGVtc2N1bHB0XCJcbiAgbW9kZWxJZDogc3RyaW5nOyAvLyBlLmcuIFwiZ3B0LTRcIiwgXCJtaXN0cmFsLTdiXCJcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmc7IC8vIE9wdGlvbmFsIGRpc3BsYXkgbmFtZSBvdmVycmlkZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVNjdWxwdE1vZGVsIHtcbiAgaWRlbnRpZmllcjogTW9kZWxJZGVudGlmaWVyOyAvLyBOZXcgc3RydWN0dXJlZCBpZGVudGlmaWVyXG4gIGlkOiBzdHJpbmc7IC8vIEtlcHQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBjb250ZXh0X2xlbmd0aDogbnVtYmVyO1xuICBjYXBhYmlsaXRpZXM6IHN0cmluZ1tdO1xuICBhcmNoaXRlY3R1cmU6IHtcbiAgICBtb2RhbGl0eTogc3RyaW5nO1xuICAgIHRva2VuaXplcj86IHN0cmluZztcbiAgICBpbnN0cnVjdF90eXBlPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgcHJpY2luZzoge1xuICAgIHByb21wdDogc3RyaW5nO1xuICAgIGNvbXBsZXRpb246IHN0cmluZztcbiAgICBpbWFnZTogc3RyaW5nO1xuICAgIHJlcXVlc3Q6IHN0cmluZztcbiAgfTtcbiAgcHJvdmlkZXI6IHN0cmluZztcbiAgdG9wX3Byb3ZpZGVyPzoge1xuICAgIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gICAgbWF4X2NvbXBsZXRpb25fdG9rZW5zOiBudW1iZXIgfCBudWxsO1xuICAgIGlzX21vZGVyYXRlZDogYm9vbGVhbjtcbiAgfTtcbiAgaXNGYXZvcml0ZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3VzdG9tUHJvdmlkZXIge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGVuZHBvaW50OiBzdHJpbmc7XG4gIGFwaUtleTogc3RyaW5nO1xuICBpc0VuYWJsZWQ6IGJvb2xlYW47XG4gIGxhc3RUZXN0ZWQ/OiBudW1iZXI7IC8vIFRpbWVzdGFtcCBvZiBsYXN0IGNvbm5lY3Rpb24gdGVzdFxuICBjYWNoZWRNb2RlbHM/OiBzdHJpbmdbXTsgLy8gQ2FjaGVkIGxpc3Qgb2YgbW9kZWwgSURzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aXZlUHJvdmlkZXIge1xuICBpZDogc3RyaW5nOyAvLyBVbmlxdWUgSUQgb2YgdGhlIHByb3ZpZGVyXG4gIG5hbWU6IHN0cmluZzsgLy8gRGlzcGxheSBuYW1lIChlLmcuLCBcIlN5c3RlbVNjdWxwdFwiLCBcIk9sbGFtYVwiLCBldGMuKVxuICB0eXBlOiBcIm5hdGl2ZVwiIHwgXCJjdXN0b21cIjsgLy8gV2hldGhlciBpdCdzIHRoZSBuYXRpdmUgU3lzdGVtU2N1bHB0IG9yIGEgY3VzdG9tIHByb3ZpZGVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kZWxGaWx0ZXJTZXR0aW5ncyB7XG4gIHNob3dWaXNpb25Nb2RlbHM6IGJvb2xlYW47XG4gIHNob3dSZWFzb25pbmdNb2RlbHM6IGJvb2xlYW47XG4gIHNob3dDcmVhdGl2ZU1vZGVsczogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTOiBNb2RlbEZpbHRlclNldHRpbmdzID0ge1xuICBzaG93VmlzaW9uTW9kZWxzOiBmYWxzZSxcbiAgc2hvd1JlYXNvbmluZ01vZGVsczogZmFsc2UsXG4gIHNob3dDcmVhdGl2ZU1vZGVsczogZmFsc2UsXG59O1xuIiwgImltcG9ydCB7IEFwcCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IFNjcm9sbE1hbmFnZXJTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB7IE1lc3NhZ2VSZW5kZXJlciB9IGZyb20gXCIuL3ZpZXdzL2NvbXBvbmVudHMvTWVzc2FnZVJlbmRlcmVyXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB0eXBlIHtcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG4gIEN1c3RvbVByb3ZpZGVyLFxuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBBY3RpdmVQcm92aWRlcixcbiAgRmF2b3JpdGVNb2RlbCxcbn0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5pbXBvcnQgeyBERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyB9IGZyb20gXCIuL3R5cGVzL2xsbVwiO1xuXG4vLyBSZS1leHBvcnQgZm9yIGNvbnZlbmllbmNlXG5leHBvcnQgdHlwZSB7XG4gIFN5c3RlbVNjdWxwdE1vZGVsLFxuICBDdXN0b21Qcm92aWRlcixcbiAgTW9kZWxGaWx0ZXJTZXR0aW5ncyxcbiAgQWN0aXZlUHJvdmlkZXIsXG4gIEZhdm9yaXRlTW9kZWwsXG59IGZyb20gXCIuL3R5cGVzL2xsbVwiO1xuXG5leHBvcnQgY29uc3QgUEFUUkVPTl9VUkwgPSBcImh0dHBzOi8vd3d3LnBhdHJlb24uY29tL3N5c3RlbXNjdWxwdC9tZW1iZXJzaGlwXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0U2V0dGluZ3Mge1xuICBsaWNlbnNlS2V5OiBzdHJpbmc7XG4gIGxpY2Vuc2VWYWxpZDogYm9vbGVhbjtcbiAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIGNoYXRzRGlyZWN0b3J5OiBzdHJpbmc7XG4gIGxhc3RWYWxpZGF0ZWQ6IG51bWJlcjtcbiAgLyoqXG4gICAqIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB3ZSdsbCBrZWVwIHN5c3RlbVByb21wdCBhcyB0aGUgbGFzdC1zYXZlZFxuICAgKiB1c2VyLWNob3NlbiB0ZXh0LiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgZGlyZWN0IHN0b3JhZ2UgaWYgdGhlIHVzZXJcbiAgICogcGlja3MgYSBwcmVzZXQgb3IgdHlwZWQgY29udGVudC4gQnV0IGlmIHN5c3RlbVByb21wdFR5cGUgaXMgXCJjdXN0b21cIixcbiAgICogd2UnbGwgcmVhZCBmcm9tIHN5c3RlbVByb21wdFBhdGguXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHQ6IHN0cmluZztcbiAgcmVjb3JkaW5nc0RpcmVjdG9yeTogc3RyaW5nO1xuICBkZXZlbG9wbWVudE1vZGU6IGJvb2xlYW47XG4gIHByZWZlcnJlZE1pY3JvcGhvbmVJZDogc3RyaW5nO1xuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IGJvb2xlYW47XG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IGJvb2xlYW47XG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OiBzdHJpbmc7XG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogYm9vbGVhbjtcbiAgc2hvd01vZGVsVG9vbHRpcHM6IGJvb2xlYW47XG4gIHNob3dWaXNpb25Nb2RlbHNPbmx5OiBib29sZWFuO1xuICBzaG93VG9wUGlja3NPbmx5OiBib29sZWFuO1xuICBzZWxlY3RlZFByb3ZpZGVyOiBzdHJpbmc7XG4gIHNlcnZlclVybDogc3RyaW5nO1xuICBhdHRhY2htZW50c0RpcmVjdG9yeTogc3RyaW5nO1xuICBleHRyYWN0aW9uc0RpcmVjdG9yeTogc3RyaW5nO1xuICAvLyBDaGFuZ2VkIGJlbG93IHRvIFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIgd2l0aCBhIHNwYWNlXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZztcbiAgdGFza3NEaXJlY3Rvcnk6IHN0cmluZztcbiAgbW92ZUNvbXBsZXRlZFRhc2tzRG93bjogYm9vbGVhbjtcblxuICAvKipcbiAgICogTkVXIEZJRUxEUzpcbiAgICogc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiXG4gICAqIHN5c3RlbVByb21wdFBhdGg6IHBhdGggdG8gdGhlIGZpbGUgdGhhdCBob2xkcyB0aGUgY3VzdG9tIHN5c3RlbSBwcm9tcHQgKGlmIGFueSkuXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHN5c3RlbVByb21wdFBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogQ3VzdG9tIHByb3ZpZGVyIHNldHRpbmdzXG4gICAqL1xuICBjdXN0b21Qcm92aWRlcnM6IEN1c3RvbVByb3ZpZGVyW107XG5cbiAgbW9kZWxGaWx0ZXJTZXR0aW5nczogTW9kZWxGaWx0ZXJTZXR0aW5ncztcblxuICBmYXZvcml0ZU1vZGVsczogRmF2b3JpdGVNb2RlbFtdO1xuXG4gIGZhdm9yaXRlQ2hhdHM6IHN0cmluZ1tdO1xuXG4gIGFjdGl2ZVByb3ZpZGVyOiBBY3RpdmVQcm92aWRlcjtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFN5c3RlbVNjdWxwdFNldHRpbmdzID0ge1xuICBsaWNlbnNlS2V5OiBcIlwiLFxuICBsaWNlbnNlVmFsaWQ6IGZhbHNlLFxuICBzZWxlY3RlZE1vZGVsSWQ6IFwiXCIsXG4gIGNoYXRzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9DaGF0c1wiLFxuICBsYXN0VmFsaWRhdGVkOiAwLFxuICAvLyBUaGlzIGlzIHRoZSBmYWxsYmFjayBzeXN0ZW0gcHJvbXB0IGlmIHRoZSB1c2VyIGhhc24ndCBjaG9zZW4gYSBjdXN0b20gb3IgcHJlc2V0XG4gIHN5c3RlbVByb21wdDpcbiAgICBcIllvdSBhcmUgYSBoZWxwZnVsIEFJIGFzc2lzdGFudC4gWW91IGhlbHAgdXNlcnMgd2l0aCB0aGVpciBxdWVzdGlvbnMgYW5kIHRhc2tzIGluIGEgY2xlYXIgYW5kIGNvbmNpc2Ugd2F5LlwiLFxuICByZWNvcmRpbmdzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9SZWNvcmRpbmdzXCIsXG4gIGRldmVsb3BtZW50TW9kZTogZmFsc2UsXG4gIHByZWZlcnJlZE1pY3JvcGhvbmVJZDogXCJcIixcbiAgYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzOiB0cnVlLFxuICBhdXRvUGFzdGVUcmFuc2NyaXB0aW9uOiB0cnVlLFxuICBwb3N0UHJvY2Vzc2luZ1Byb21wdDpcbiAgICBcIllvdSBhcmUgYSB0cmFuc2NyaXB0aW9uIHBvc3QtcHJvY2Vzc29yLiBZb3VyIHRhc2sgaXMgdG8gZml4IGFueSB0cmFuc2NyaXB0aW9uIGVycm9ycywgY29ycmVjdCBncmFtbWFyIGFuZCBwdW5jdHVhdGlvbiwgYW5kIGVuc3VyZSB0aGUgdGV4dCBpcyBwcm9wZXJseSBmb3JtYXR0ZWQuIEtlZXAgdGhlIG9yaWdpbmFsIG1lYW5pbmcgaW50YWN0IHdoaWxlIG1ha2luZyB0aGUgdGV4dCBtb3JlIHJlYWRhYmxlLlwiLFxuICBwb3N0UHJvY2Vzc2luZ0VuYWJsZWQ6IGZhbHNlLFxuICBzaG93TW9kZWxUb29sdGlwczogZmFsc2UsXG4gIHNob3dWaXNpb25Nb2RlbHNPbmx5OiBmYWxzZSxcbiAgc2hvd1RvcFBpY2tzT25seTogZmFsc2UsXG4gIHNlbGVjdGVkUHJvdmlkZXI6IFwiYWxsXCIsXG4gIHNlcnZlclVybDogXCJodHRwOi8vbG9jYWxob3N0OjMwMDFcIixcbiAgYXR0YWNobWVudHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0F0dGFjaG1lbnRzXCIsXG4gIGV4dHJhY3Rpb25zRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9FeHRyYWN0aW9uc1wiLFxuICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiLFxuICB0YXNrc0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvVGFza3NcIixcbiAgbW92ZUNvbXBsZXRlZFRhc2tzRG93bjogdHJ1ZSxcblxuICAvKipcbiAgICogTkVXIEZJRUxEUyBERUZBVUxUUzpcbiAgICovXG4gIHN5c3RlbVByb21wdFR5cGU6IFwiZ2VuZXJhbC11c2VcIixcbiAgc3lzdGVtUHJvbXB0UGF0aDogXCJcIixcblxuICAvKipcbiAgICogQ3VzdG9tIHByb3ZpZGVyIGRlZmF1bHRzXG4gICAqL1xuICBjdXN0b21Qcm92aWRlcnM6IFtdLFxuXG4gIG1vZGVsRmlsdGVyU2V0dGluZ3M6IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTLFxuXG4gIGZhdm9yaXRlTW9kZWxzOiBbXSxcblxuICBmYXZvcml0ZUNoYXRzOiBbXSxcblxuICBhY3RpdmVQcm92aWRlcjoge1xuICAgIGlkOiBcInN5c3RlbXNjdWxwdFwiLFxuICAgIG5hbWU6IFwiU3lzdGVtU2N1bHB0XCIsXG4gICAgdHlwZTogXCJuYXRpdmVcIixcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCBTRU5TSVRJVkVfU0VUVElOR1M6IFBhcnRpYWw8XG4gIFJlY29yZDxrZXlvZiBTeXN0ZW1TY3VscHRTZXR0aW5ncywgXCJub25lXCIgfCBcImJvdGhcIiB8IFwidmFsdWVcIj5cbj4gPSB7XG4gIGxpY2Vuc2VLZXk6IFwiYm90aFwiLFxuICBzZWxlY3RlZE1vZGVsSWQ6IFwibm9uZVwiLFxuICBjaGF0c0RpcmVjdG9yeTogXCJub25lXCIsXG4gIGxhc3RWYWxpZGF0ZWQ6IFwibm9uZVwiLFxuICBzeXN0ZW1Qcm9tcHQ6IFwibm9uZVwiLFxuICByZWNvcmRpbmdzRGlyZWN0b3J5OiBcIm5vbmVcIixcbiAgZGV2ZWxvcG1lbnRNb2RlOiBcIm5vbmVcIixcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBcIm5vbmVcIixcbiAgYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzOiBcIm5vbmVcIixcbiAgYXV0b1Bhc3RlVHJhbnNjcmlwdGlvbjogXCJub25lXCIsXG4gIHRhc2tzRGlyZWN0b3J5OiBcIm5vbmVcIixcbn07XG5cbmV4cG9ydCB0eXBlIENoYXRSb2xlID0gXCJ1c2VyXCIgfCBcImFzc2lzdGFudFwiIHwgXCJzeXN0ZW1cIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbWFnZUNvbnRlbnQge1xuICB0eXBlOiBcImltYWdlX3VybFwiO1xuICBpbWFnZV91cmw6IHtcbiAgICB1cmw6IHN0cmluZztcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0Q29udGVudCB7XG4gIHR5cGU6IFwidGV4dFwiO1xuICB0ZXh0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIE11bHRpUGFydENvbnRlbnQgPSBUZXh0Q29udGVudCB8IEltYWdlQ29udGVudDtcblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1Qcm9tcHRJbmZvIHtcbiAgdHlwZTogc3RyaW5nO1xuICBwYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElucHV0SGFuZGxlck9wdGlvbnMge1xuICBhcHA6IEFwcDtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBnZXRNZXNzYWdlczogKCkgPT4gQ2hhdE1lc3NhZ2VbXTtcbiAgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiBzdHJpbmc7XG4gIGdldENvbnRleHRGaWxlczogKCkgPT4gU2V0PHN0cmluZz47XG4gIGdldFN5c3RlbVByb21wdDogKCkgPT4gU3lzdGVtUHJvbXB0SW5mbztcbiAgY2hhdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgb25NZXNzYWdlU3VibWl0OiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIG9uQXNzaXN0YW50UmVzcG9uc2U6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Db250ZXh0RmlsZUFkZDogKHdpa2lsaW5rOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIG9uRXJyb3I6IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkO1xuICBvbkFkZENvbnRleHRGaWxlOiAoKSA9PiB2b2lkO1xuICBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHZvaWQ7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRNZXNzYWdlIHtcbiAgcm9sZTogQ2hhdFJvbGU7XG4gIGNvbnRlbnQ6IHN0cmluZyB8IE11bHRpUGFydENvbnRlbnRbXTtcbiAgbWVzc2FnZV9pZDogc3RyaW5nO1xuICBkb2N1bWVudENvbnRleHQ/OiB7XG4gICAgZG9jdW1lbnRJZHM6IHN0cmluZ1tdO1xuICB9O1xuICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nO1xuICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVNjdWxwdFJlc3BvbnNlIHtcbiAgaWQ6IHN0cmluZztcbiAgY2hvaWNlczoge1xuICAgIG1lc3NhZ2U6IENoYXRNZXNzYWdlO1xuICB9W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bmsge1xuICBpZD86IHN0cmluZztcbiAgY2hvaWNlcz86IEFycmF5PHtcbiAgICBkZWx0YT86IHtcbiAgICAgIGNvbnRlbnQ/OiBzdHJpbmc7XG4gICAgICB0ZXh0Pzogc3RyaW5nO1xuICAgICAgcmVhc29uaW5nPzogc3RyaW5nO1xuICAgIH07XG4gIH0+O1xuICBjb21wbGV0aW9uPzogc3RyaW5nO1xuICBkZWx0YT86IHtcbiAgICB0ZXh0Pzogc3RyaW5nO1xuICAgIHJlYXNvbmluZz86IHN0cmluZztcbiAgfTtcbiAgZXJyb3I/OiB7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBzdGF0dXNDb2RlPzogbnVtYmVyO1xuICAgIG1vZGVsPzogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdFByZXNldCB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47XG4gIHN5c3RlbVByb21wdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdFR5cGUge1xuICBpZDogc3RyaW5nOyAvLyBlLmcuLCBcInRleHRfbW9kaWZpY2F0aW9uXCJcbiAgbGFiZWw6IHN0cmluZzsgLy8gZS5nLiwgXCJUZXh0IE1vZGlmaWNhdGlvblwiXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nOyAvLyBPcHRpb25hbCBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoaXMgcHJvbXB0IHR5cGUgZG9lc1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47IC8vIFdoZXRoZXIgdXNlciBjYW4gY3VzdG9taXplIHRoZSBwcm9tcHRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0TW9kaWZpY2F0aW9uU3RhdGUge1xuICBvcmlnaW5hbFRleHQ6IHN0cmluZztcbiAgbW9kaWZpZWRUZXh0OiBzdHJpbmc7XG4gIGlzU3RyZWFtaW5nOiBib29sZWFuO1xuICBzdHJlYW1Db21wbGV0ZTogYm9vbGVhbjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwgfSBmcm9tIFwiLi4vdHlwZXMvbGxtXCI7XG5pbXBvcnQge1xuICBTZWFyY2hTZXJ2aWNlLFxuICBTZWFyY2hNYXRjaCxcbiAgU2VhcmNoUmVzdWx0LFxuICBTZWFyY2hhYmxlRmllbGQsXG59IGZyb20gXCIuLi9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbkhlbHBlciB9IGZyb20gXCIuL01vZGVsU2VsZWN0aW9uSGVscGVyXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbCB9IGZyb20gXCIuL0N1c3RvbVByb3ZpZGVyTW9kYWxcIjtcbmltcG9ydCB7IFBBVFJFT05fVVJMIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBNb2RlbFNlbGVjdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIGFsbE1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuICBwcml2YXRlIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICBwcml2YXRlIG9uU2VsZWN0OiAobW9kZWxJZDogc3RyaW5nKSA9PiB2b2lkO1xuICBwcml2YXRlIHNlYXJjaElucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIG1vZGVsR3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENhcmRJbmRleDogbnVtYmVyID0gLTE7XG4gIHByaXZhdGUgbW9kZWxDYXJkczogSFRNTEVsZW1lbnRbXSA9IFtdO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBpc0Nsb3Npbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBoZWxwZXI6IE1vZGVsU2VsZWN0aW9uSGVscGVyO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIGN1cnJlbnRNb2RlbElkOiBzdHJpbmcsXG4gICAgb25TZWxlY3Q6IChtb2RlbElkOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IGN1cnJlbnRNb2RlbElkO1xuICAgIHRoaXMub25TZWxlY3QgPSBvblNlbGVjdDtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmxvZ2dlciA9IGNvbnNvbGU7XG4gICAgdGhpcy5oZWxwZXIgPSBuZXcgTW9kZWxTZWxlY3Rpb25IZWxwZXIocGx1Z2luKTtcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2UgPSBuZXcgU2VhcmNoU2VydmljZSgpO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGVsLXNlbGVjdGlvbi1tb2RhbFwiKTtcblxuICAgICAgLy8gQ3JlYXRlIFVJIGVsZW1lbnRzXG4gICAgICB0aGlzLmNyZWF0ZVNlYXJjaFVJKCk7XG4gICAgICB0aGlzLmNyZWF0ZU1vZGVsR3JpZCgpO1xuICAgICAgdGhpcy5zZXR1cFNlYXJjaCgpO1xuXG4gICAgICAvLyBTaG93IGxvYWRpbmcgc3RhdGVcbiAgICAgIGNvbnN0IGxvYWRpbmdDb250YWluZXIgPSB0aGlzLm1vZGVsR3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWxvYWRpbmctY29udGFpbmVyXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGxvYWRpbmdTcGlubmVyID0gbG9hZGluZ0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWxvYWRpbmctc3Bpbm5lclwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGxvYWRpbmdTcGlubmVyLCBcImxvYWRlci0yXCIpO1xuICAgICAgbG9hZGluZ0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWxvYWRpbmctdGV4dFwiLFxuICAgICAgICB0ZXh0OiBcIkxvYWRpbmcgbW9kZWxzLi4uXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gVXNlIHRoZSBwbHVnaW4ncyBpbml0aWFsIG1vZGVscyBwcm9taXNlXG4gICAgICB0aGlzLmFsbE1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLmdldEluaXRpYWxNb2RlbHMoKTtcblxuICAgICAgLy8gSW5pdGlhbCByZW5kZXJcbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJNb2RlbFNlbGVjdGlvbk1vZGFsOiBFcnJvciBpbiBvbk9wZW5cIiwgZXJyb3IpO1xuICAgICAgdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1lcnJvci1tZXNzYWdlXCIsXG4gICAgICAgIHRleHQ6IFwiRXJyb3IgbG9hZGluZyBtb2RlbCBzZWxlY3Rpb24gbW9kYWxcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmlzaWJsZU1vZGVscygpOiBTZWFyY2hSZXN1bHQ8U3lzdGVtU2N1bHB0TW9kZWw+W10ge1xuICAgIC8vIElmIHRoZXJlJ3Mgbm8gc2VhcmNoIHF1ZXJ5LCBqdXN0IHJldHVybiB0aGVtIGFsbCBzb3J0ZWQgYnkgcHJvdmlkZXJcbiAgICBpZiAoIXRoaXMuc2VhcmNoSW5wdXQgfHwgIXRoaXMuc2VhcmNoSW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbGxNb2RlbHMubWFwKChtKSA9PiAoeyBpdGVtOiBtLCBtYXRjaGVzOiBbXSwgc2NvcmU6IDAgfSkpO1xuICAgIH1cblxuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgICAvLyBBcHBseSBzZWFyY2ggYW5kIGZpbHRlclxuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgdGhpcy5hbGxNb2RlbHMsXG4gICAgICBxdWVyeSxcbiAgICAgIChtb2RlbCkgPT4gdGhpcy5nZXRTZWFyY2hhYmxlRmllbGRzKG1vZGVsKSxcbiAgICAgIHtcbiAgICAgICAgaW5pdGlhbFJlc3VsdHNMaW1pdDogMjUsXG4gICAgICAgIG1heEZpbHRlcmVkUmVzdWx0czogNTAsXG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIEZpbHRlciBvdXQgcmVzdWx0cyB3aXRoIG5vIG1hdGNoZXMgb3IgbG93IHNjb3Jlc1xuICAgIGNvbnN0IGZpbHRlcmVkUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKFxuICAgICAgKHJlc3VsdCkgPT4gcmVzdWx0Lm1hdGNoZXMubGVuZ3RoID4gMCAmJiByZXN1bHQuc2NvcmUgPiAwXG4gICAgKTtcblxuICAgIC8vIFNvcnQgcmVzdWx0cyBieSBzY29yZVxuICAgIHJldHVybiBmaWx0ZXJlZFJlc3VsdHMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZWFyY2hhYmxlRmllbGRzID0gKFxuICAgIG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbFxuICApOiBTZWFyY2hhYmxlRmllbGRbXSA9PiB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHsgZmllbGQ6IFwibmFtZVwiLCB0ZXh0OiBtb2RlbC5uYW1lLCB3ZWlnaHQ6IDIwMCB9LFxuICAgICAgLi4ubW9kZWwubmFtZS5zcGxpdCgvW1xcc1xcLTpcXC5dKy8pLm1hcCgocGFydCkgPT4gKHtcbiAgICAgICAgZmllbGQ6IFwibmFtZVwiLFxuICAgICAgICB0ZXh0OiBwYXJ0LFxuICAgICAgICB3ZWlnaHQ6IDE1MCxcbiAgICAgIH0pKSxcbiAgICAgIC4uLihtb2RlbC5wcm92aWRlciA9PT0gXCJjdXN0b21cIlxuICAgICAgICA/IFt7IGZpZWxkOiBcInByb3ZpZGVyXCIsIHRleHQ6IG1vZGVsLmlkLnNwbGl0KFwiLVwiKVswXSwgd2VpZ2h0OiAxODAgfV1cbiAgICAgICAgOiBbXSksXG4gICAgICB7IGZpZWxkOiBcImRlc2NyaXB0aW9uXCIsIHRleHQ6IG1vZGVsLmRlc2NyaXB0aW9uIHx8IFwiXCIsIHdlaWdodDogNTAgfSxcbiAgICBdO1xuICB9O1xuXG4gIHByaXZhdGUgY3JlYXRlU2VhcmNoVUkoKSB7XG4gICAgY29uc3Qgc2VhcmNoQ29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VhcmNoLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBtb2RlbHMuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VhcmNoLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgcHJvdmlkZXJzIGJ1dHRvblxuICAgIGNvbnN0IHByb3ZpZGVyc0J1dHRvbiA9IHNlYXJjaENvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVycy1idXR0b25cIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHByb3ZpZGVyc0J1dHRvbi5jcmVhdGVTcGFuKCksIFwic2V0dGluZ3NcIik7XG4gICAgcHJvdmlkZXJzQnV0dG9uLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlByb3ZpZGVyc1wiIH0pO1xuXG4gICAgcHJvdmlkZXJzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcblxuICAgICAgLy8gT3BlbiBjdXN0b20gcHJvdmlkZXIgbWFuYWdlciBtb2RhbFxuICAgICAgY29uc3QgbWFuYWdlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAvLyBPbiBiYWNrXG4gICAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb25Nb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QsXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgbW9kZWxTZWxlY3Rpb25Nb2RhbC5vcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBtYW5hZ2VyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVNb2RlbEdyaWQoKSB7XG4gICAgdGhpcy5tb2RlbEdyaWQgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1ncmlkXCIsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwU2VhcmNoKCkge1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmdldFZpc2libGVNb2RlbHMoKTtcbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHJlc3VsdHMpO1xuICAgIH0pO1xuXG4gICAgLy8gS2V5Ym9hcmQgbmF2XG4gICAgdGhpcy5jb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IDw9IDBcbiAgICAgICAgICAgICAgPyB0aGlzLm1vZGVsQ2FyZHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggLSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPVxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA+PSB0aGlzLm1vZGVsQ2FyZHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgOiB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ICsgMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vZGVsQ2FyZHMuZm9yRWFjaCgoY2FyZCwgaSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBpID09PSB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4O1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnRvZ2dsZShcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiLCBpc1NlbGVjdGVkKTtcbiAgICAgICAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgICAgICAgY2FyZC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiBcInNtb290aFwiLCBibG9jazogXCJuZWFyZXN0XCIgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGNvbnN0IGhpZ2hsaWdodGVkQ2FyZCA9IHRoaXMubW9kZWxDYXJkc1t0aGlzLnNlbGVjdGVkQ2FyZEluZGV4XTtcbiAgICAgICAgaWYgKGhpZ2hsaWdodGVkQ2FyZCkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zdCBtb2RlbElkID0gaGlnaGxpZ2h0ZWRDYXJkLmRhdGFzZXQubW9kZWxJZDtcbiAgICAgICAgICBpZiAobW9kZWxJZCkge1xuICAgICAgICAgICAgdGhpcy5vblNlbGVjdChtb2RlbElkKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFBhc3NpdmUgc2Nyb2xsL3RvdWNoXG4gICAgdGhpcy5tb2RlbEdyaWQ/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcIndoZWVsXCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIGp1c3QgYSBuby1vcFxuICAgICAgfSxcbiAgICAgIHsgcGFzc2l2ZTogdHJ1ZSB9XG4gICAgKTtcbiAgICB0aGlzLm1vZGVsR3JpZD8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKCkgPT4ge30sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICB0aGlzLm1vZGVsR3JpZD8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCAoKSA9PiB7fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgYWxsIGN1cnJlbnRseSB2aXNpYmxlIG1vZGVscyBidXQgaW4gMiBzaW1wbGUgc2VjdGlvbnM6XG4gICAqIC0gU3lzdGVtU2N1bHB0IG1vZGVsc1xuICAgKiAtIEN1c3RvbSBwcm92aWRlciBtb2RlbHNcbiAgICovXG4gIHByaXZhdGUgcmVuZGVyTW9kZWxzKHNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxTeXN0ZW1TY3VscHRNb2RlbD5bXSkge1xuICAgIGlmICghdGhpcy5tb2RlbEdyaWQpIHJldHVybjtcblxuICAgIHRoaXMubW9kZWxHcmlkLmVtcHR5KCk7XG4gICAgdGhpcy5tb2RlbENhcmRzID0gW107XG5cbiAgICAvLyBDcmVhdGUgYSBsb29rdXAgZm9yIHNlYXJjaE1hdGNoZXNcbiAgICBjb25zdCBzck1hcCA9IG5ldyBNYXAoXG4gICAgICBzZWFyY2hSZXN1bHRzLm1hcCgoc3IpID0+IFtzci5pdGVtLmlkLCBzci5tYXRjaGVzIHx8IFtdXSlcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgbGljZW5zZSBzdGF0dXMgb25jZVxuICAgIGNvbnN0IGhhc1ZhbGlkTGljZW5zZSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKTtcblxuICAgIC8vIEZpcnN0LCBzZXBhcmF0ZSBmYXZvcml0ZXMgZnJvbSBvdGhlciBtb2RlbHNcbiAgICBjb25zdCBmYXZvcml0ZXM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcbiAgICBjb25zdCBub25GYXZvcml0ZXM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcblxuICAgIC8vIE9ubHkgcHJvY2VzcyBtb2RlbHMgdGhhdCBhcmUgaW4gb3VyIHNlYXJjaCByZXN1bHRzXG4gICAgY29uc3QgdmlzaWJsZU1vZGVscyA9IHNlYXJjaFJlc3VsdHMubWFwKChzcikgPT4gc3IuaXRlbSk7XG4gICAgdmlzaWJsZU1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgLy8gU2tpcCBTeXN0ZW1TY3VscHQgbW9kZWxzIGlmIG5vIHZhbGlkIGxpY2Vuc2VcbiAgICAgIGlmICghaGFzVmFsaWRMaWNlbnNlICYmIG1vZGVsLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKG1vZGVsLmlzRmF2b3JpdGUpIHtcbiAgICAgICAgZmF2b3JpdGVzLnB1c2gobW9kZWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9uRmF2b3JpdGVzLnB1c2gobW9kZWwpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUmVuZGVyIGZhdm9yaXRlcyBzZWN0aW9uIGlmIHRoZXJlIGFyZSBhbnkgZmF2b3JpdGVzXG4gICAgaWYgKGZhdm9yaXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBBZGQgZmF2b3JpdGVzIGhlYWRlclxuICAgICAgY29uc3QgaGVhZGVyID0gdGhpcy5tb2RlbEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIixcbiAgICAgIH0pO1xuICAgICAgaGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkZhdm9yaXRlc1wiIH0pO1xuXG4gICAgICAvLyBTb3J0IGZhdm9yaXRlczogU3lzdGVtU2N1bHB0IGZpcnN0LCB0aGVuIGJ5IHByb3ZpZGVyIGFuZCBuYW1lXG4gICAgICBmYXZvcml0ZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAvLyBTeXN0ZW1TY3VscHQgbW9kZWxzIGNvbWUgZmlyc3RcbiAgICAgICAgaWYgKGEucHJvdmlkZXIgPT09IFwic3lzdGVtc2N1bHB0XCIgJiYgYi5wcm92aWRlciAhPT0gXCJzeXN0ZW1zY3VscHRcIilcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIGlmIChhLnByb3ZpZGVyICE9PSBcInN5c3RlbXNjdWxwdFwiICYmIGIucHJvdmlkZXIgPT09IFwic3lzdGVtc2N1bHB0XCIpXG4gICAgICAgICAgcmV0dXJuIDE7XG5cbiAgICAgICAgLy8gVGhlbiBzb3J0IGJ5IHByb3ZpZGVyXG4gICAgICAgIGlmIChhLnByb3ZpZGVyICE9PSBiLnByb3ZpZGVyKSB7XG4gICAgICAgICAgcmV0dXJuIGEucHJvdmlkZXIubG9jYWxlQ29tcGFyZShiLnByb3ZpZGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsbHkgc29ydCBieSBuYW1lXG4gICAgICAgIHJldHVybiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlbmRlciBmYXZvcml0ZSBtb2RlbHNcbiAgICAgIGZhdm9yaXRlcy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gc3JNYXAuZ2V0KG1vZGVsLmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyTW9kZWxDYXJkKG1vZGVsLCBtYXRjaGVzKTtcbiAgICAgICAgaWYgKGNhcmQpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsR3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgICB0aGlzLm1vZGVsQ2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR3JvdXAgcmVtYWluaW5nIG1vZGVscyBieSBwcm92aWRlclxuICAgIGNvbnN0IG1vZGVsc0J5UHJvdmlkZXIgPSBuZXcgTWFwPHN0cmluZywgU3lzdGVtU2N1bHB0TW9kZWxbXT4oKTtcbiAgICBub25GYXZvcml0ZXMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gbW9kZWwucHJvdmlkZXI7XG4gICAgICBpZiAoIW1vZGVsc0J5UHJvdmlkZXIuaGFzKHByb3ZpZGVyKSkge1xuICAgICAgICBtb2RlbHNCeVByb3ZpZGVyLnNldChwcm92aWRlciwgW10pO1xuICAgICAgfVxuICAgICAgbW9kZWxzQnlQcm92aWRlci5nZXQocHJvdmlkZXIpPy5wdXNoKG1vZGVsKTtcbiAgICB9KTtcblxuICAgIC8vIEFsd2F5cyBzaG93IFN5c3RlbVNjdWxwdCBzZWN0aW9uIGZpcnN0XG4gICAgY29uc3Qgc3lzdGVtc2N1bHB0SGVhZGVyID0gdGhpcy5tb2RlbEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIsXG4gICAgfSk7XG4gICAgc3lzdGVtc2N1bHB0SGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlN5c3RlbVNjdWxwdCBNb2RlbHNcIiB9KTtcblxuICAgIC8vIFNob3cgcHJvIGluZm8gbWVzc2FnZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHZhbGlkIGxpY2Vuc2UgYW5kIHRoZXJlIGFyZSBTeXN0ZW1TY3VscHQgbW9kZWxzXG4gICAgaWYgKFxuICAgICAgIWhhc1ZhbGlkTGljZW5zZSAmJlxuICAgICAgc2VhcmNoUmVzdWx0cy5zb21lKChzcikgPT4gc3IuaXRlbS5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIilcbiAgICApIHtcbiAgICAgIHRoaXMuY3JlYXRlUHJvSW5mb01lc3NhZ2UodGhpcy5tb2RlbEdyaWQpO1xuICAgIH1cblxuICAgIC8vIElmIHdlIGhhdmUgU3lzdGVtU2N1bHB0IG1vZGVscyBhbmQgYSB2YWxpZCBsaWNlbnNlLCBzaG93IHRoZW1cbiAgICBpZiAoaGFzVmFsaWRMaWNlbnNlICYmIG1vZGVsc0J5UHJvdmlkZXIuaGFzKFwic3lzdGVtc2N1bHB0XCIpKSB7XG4gICAgICBjb25zdCBzeXN0ZW1zY3VscHRNb2RlbHMgPSBtb2RlbHNCeVByb3ZpZGVyLmdldChcInN5c3RlbXNjdWxwdFwiKSB8fCBbXTtcbiAgICAgIGNvbnN0IHNvcnRlZFN5c3RlbXNjdWxwdE1vZGVscyA9IHN5c3RlbXNjdWxwdE1vZGVscy5zb3J0KChhLCBiKSA9PlxuICAgICAgICBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpXG4gICAgICApO1xuXG4gICAgICBzb3J0ZWRTeXN0ZW1zY3VscHRNb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChtb2RlbC5pZCkgfHwgW107XG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLnJlbmRlck1vZGVsQ2FyZChtb2RlbCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICAgICAgdGhpcy5tb2RlbENhcmRzLnB1c2goY2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBTeXN0ZW1TY3VscHQgZnJvbSB0aGUgbWFwIHNpbmNlIHdlJ3ZlIGhhbmRsZWQgaXRcbiAgICBtb2RlbHNCeVByb3ZpZGVyLmRlbGV0ZShcInN5c3RlbXNjdWxwdFwiKTtcblxuICAgIC8vIFJlbmRlciByZW1haW5pbmcgcHJvdmlkZXJzXG4gICAgY29uc3Qgc29ydGVkUHJvdmlkZXJzID0gQXJyYXkuZnJvbShtb2RlbHNCeVByb3ZpZGVyLmtleXMoKSkuc29ydCgoYSwgYikgPT5cbiAgICAgIGEubG9jYWxlQ29tcGFyZShiKVxuICAgICk7XG5cbiAgICAvLyBSZW5kZXIgZWFjaCByZW1haW5pbmcgcHJvdmlkZXIgc2VjdGlvblxuICAgIHNvcnRlZFByb3ZpZGVycy5mb3JFYWNoKChwcm92aWRlcikgPT4ge1xuICAgICAgY29uc3QgbW9kZWxzID0gbW9kZWxzQnlQcm92aWRlci5nZXQocHJvdmlkZXIpIHx8IFtdO1xuXG4gICAgICAvLyBTa2lwIGVtcHR5IHByb3ZpZGVyc1xuICAgICAgaWYgKG1vZGVscy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgLy8gU29ydCBtb2RlbHMgYWxwaGFiZXRpY2FsbHlcbiAgICAgIGNvbnN0IHNvcnRlZE1vZGVscyA9IG1vZGVscy5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcblxuICAgICAgLy8gQWRkIHByb3ZpZGVyIGhlYWRlclxuICAgICAgY29uc3QgaGVhZGVyID0gdGhpcy5tb2RlbEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIixcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcHJvdmlkZXJOYW1lID0gYCR7XG4gICAgICAgIHByb3ZpZGVyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvdmlkZXIuc2xpY2UoMSlcbiAgICAgIH0gTW9kZWxzYDtcbiAgICAgIGhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogcHJvdmlkZXJOYW1lIH0pO1xuXG4gICAgICAvLyBSZW5kZXIgbW9kZWxzIGZvciB0aGlzIHByb3ZpZGVyXG4gICAgICBzb3J0ZWRNb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChtb2RlbC5pZCkgfHwgW107XG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLnJlbmRlck1vZGVsQ2FyZChtb2RlbCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICAgICAgdGhpcy5tb2RlbENhcmRzLnB1c2goY2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gSWYgbm8gY2FyZHMgYXQgYWxsLCBzaG93IGFwcHJvcHJpYXRlIG1lc3NhZ2UgYmFzZWQgb24gY29udGV4dFxuICAgIGlmICh0aGlzLm1vZGVsQ2FyZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dD8udmFsdWUpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUncyBhIHNlYXJjaCBxdWVyeSwgc2hvdyB0aGUgbm8gcmVzdWx0cyBjYXJkXG4gICAgICAgIGNvbnN0IG5vUmVzdWx0c0NhcmQgPSB0aGlzLnJlbmRlck5vUmVzdWx0c0NhcmQoKTtcbiAgICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQobm9SZXN1bHRzQ2FyZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiB0aGVyZSdzIG5vIHNlYXJjaCBxdWVyeSBhbmQgbm8gbW9kZWxzLCBzaG93IHRoZSBjdXN0b20gcHJvdmlkZXIgaW5mb1xuICAgICAgICB0aGlzLmNyZWF0ZUN1c3RvbVByb3ZpZGVySW5mb01lc3NhZ2UodGhpcy5tb2RlbEdyaWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTm9SZXN1bHRzQ2FyZCgpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY2FyZCA9IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtY2FyZFwiIH0pO1xuXG4gICAgY29uc3QgaWNvbnNDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbnNcIiB9KTtcbiAgICBjb25zdCBzZWFyY2hJY29uID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtcHJpY2luZy1sb3dcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKHNlYXJjaEljb24sIFwic2VhcmNoXCIpO1xuXG4gICAgY29uc3QgbmFtZUNvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbmFtZS1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICBuYW1lQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW5hbWVcIixcbiAgICAgIHRleHQ6IFwiTm8gbW9kZWxzIGZvdW5kXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGVzY3JpcHRpb25cIixcbiAgICAgIHRleHQ6IFwiTm8gbW9kZWxzIG1hdGNoIHlvdXIgY3VycmVudCBzZWFyY2ggY3JpdGVyaWEuIENsaWNrIGhlcmUgdG8gcmVzZXQgYWxsIGZpbHRlcnMuXCIsXG4gICAgfSk7XG5cbiAgICBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGV0YWlsc1wiIH0pO1xuXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VhcmNoSW5wdXQpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICB9XG4gICAgICB0aGlzLnJlbmRlck1vZGVscyhcbiAgICAgICAgdGhpcy5hbGxNb2RlbHMubWFwKChtKSA9PiAoeyBpdGVtOiBtLCBtYXRjaGVzOiBbXSwgc2NvcmU6IDAgfSkpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNhcmQ7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlck1vZGVsQ2FyZChcbiAgICBtb2RlbDogU3lzdGVtU2N1bHB0TW9kZWwsXG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdXG4gICk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjYXJkLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LW1vZGVsLWNhcmRcIjtcbiAgICBpZiAobW9kZWwucHJvdmlkZXIgIT09IFwic3lzdGVtc2N1bHB0XCIpIHtcbiAgICAgIGNhcmQuY2xhc3NMaXN0LmFkZChcInN5c3RlbXNjdWxwdC1jdXN0b20tbW9kZWwtY2FyZFwiKTtcbiAgICB9XG4gICAgY2FyZC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCBcIjBcIik7XG4gICAgY2FyZC5kYXRhc2V0Lm1vZGVsSWQgPSBtb2RlbC5pZDtcblxuICAgIC8vIEZhdm9yaXRlIHN0YXJcbiAgICBjb25zdCBmYXZvcml0ZUJ1dHRvbiA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1mYXZvcml0ZS1idXR0b24gJHtcbiAgICAgICAgbW9kZWwuaXNGYXZvcml0ZSA/IFwiaXMtZmF2b3JpdGVcIiA6IFwiXCJcbiAgICAgIH1gLFxuICAgICAgYXR0cjoge1xuICAgICAgICBcImFyaWEtbGFiZWxcIjogbW9kZWwuaXNGYXZvcml0ZVxuICAgICAgICAgID8gXCJSZW1vdmUgZnJvbSBmYXZvcml0ZXNcIlxuICAgICAgICAgIDogXCJBZGQgdG8gZmF2b3JpdGVzXCIsXG4gICAgICAgIHJvbGU6IFwiYnV0dG9uXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHNldEljb24oZmF2b3JpdGVCdXR0b24sIFwic3RhclwiKTtcblxuICAgIC8vIEZhdm9yaXRlIHRvZ2dsZVxuICAgIGZhdm9yaXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IGlzRmF2b3JpdGUgPSAhbW9kZWwuaXNGYXZvcml0ZTtcbiAgICAgIG1vZGVsLmlzRmF2b3JpdGUgPSBpc0Zhdm9yaXRlO1xuXG4gICAgICBmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiaXMtZmF2b3JpdGVcIiwgaXNGYXZvcml0ZSk7XG4gICAgICBmYXZvcml0ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIFwiYXJpYS1sYWJlbFwiLFxuICAgICAgICBpc0Zhdm9yaXRlID8gXCJSZW1vdmUgZnJvbSBmYXZvcml0ZXNcIiA6IFwiQWRkIHRvIGZhdm9yaXRlc1wiXG4gICAgICApO1xuXG4gICAgICAvLyBFbnN1cmUgYXJyYXlcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscykpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMgPSBbXTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIG9yIHJlbW92ZSBmcm9tIHNldHRpbmdzXG4gICAgICBpZiAoaXNGYXZvcml0ZSkge1xuICAgICAgICBjb25zdCBuZXdGYXYgPSB7IHByb3ZpZGVyOiBtb2RlbC5wcm92aWRlciwgbW9kZWxJZDogbW9kZWwuaWQgfTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5zb21lKFxuICAgICAgICAgICAgKGYpID0+IGYubW9kZWxJZCA9PT0gbW9kZWwuaWQgJiYgZi5wcm92aWRlciA9PT0gbW9kZWwucHJvdmlkZXJcbiAgICAgICAgICApXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLnB1c2gobmV3RmF2KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMgPVxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLmZpbHRlcihcbiAgICAgICAgICAgIChmKSA9PiAhKGYubW9kZWxJZCA9PT0gbW9kZWwuaWQgJiYgZi5wcm92aWRlciA9PT0gbW9kZWwucHJvdmlkZXIpXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAvLyBSZS1yZW5kZXIgdG8gbW92ZSB0aGUgbW9kZWwgdG8gaXRzIG5ldyBzZWN0aW9uXG4gICAgICB0aGlzLnJlbmRlck1vZGVscyh0aGlzLmdldFZpc2libGVNb2RlbHMoKSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgbWFpbiBjb250ZW50XG4gICAgaWYgKG1vZGVsLnByb3ZpZGVyICE9PSBcInN5c3RlbXNjdWxwdFwiKSB7XG4gICAgICAvLyBKdXN0IHNob3cgbW9kZWwgbmFtZSBmb3IgY3VzdG9tIHByb3ZpZGVyc1xuICAgICAgY29uc3QgbmFtZUNvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tbW9kZWwtbmFtZS1jb250YWluZXJcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtb2RlbE5hbWUgPSBuYW1lQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLW1vZGVsLW5hbWVcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgcHJvdmlkZXIgcHJlZml4IGluIGJyYWNrZXRzXG4gICAgICBjb25zdCBwcm92aWRlclByZWZpeCA9IGBbJHttb2RlbC5wcm92aWRlci50b1VwcGVyQ2FzZSgpfV0gYDtcbiAgICAgIGNvbnN0IG5hbWVUZXh0ID0gcHJvdmlkZXJQcmVmaXggKyBtb2RlbC5uYW1lO1xuXG4gICAgICBtb2RlbE5hbWUuYXBwZW5kKFxuICAgICAgICB0aGlzLmhlbHBlci5oaWdobGlnaHRUZXh0KG5hbWVUZXh0LCBtYXRjaGVzLCB0aGlzLnNlYXJjaElucHV0Py52YWx1ZSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5vcm1hbCBzeXN0ZW0gbW9kZWwgY2FyZFxuICAgICAgY29uc3QgaWNvbnNDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbnNcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaW1wbGUgY29zdCBpbmRpY2F0b3JcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25QcmljZSA9IHBhcnNlRmxvYXQobW9kZWwucHJpY2luZy5jb21wbGV0aW9uKSAqIDFfMDAwXzAwMDtcbiAgICAgIGNvbnN0IHByaWNpbmdJbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb25cIixcbiAgICAgICAgYXR0cjoge1xuICAgICAgICAgIFwiYXJpYS1sYWJlbFwiOiBgQXBwcm94IH4kJHtjb21wbGV0aW9uUHJpY2UudG9GaXhlZChcbiAgICAgICAgICAgIDJcbiAgICAgICAgICApfSBwZXIgbWlsbGlvbiB0b2tlbnNgLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKHByaWNpbmdJbmRpY2F0b3IsIFwid2FsbGV0XCIpO1xuXG4gICAgICAvLyBjYXBhYmlsaXR5IGljb25zXG4gICAgICBpZiAobW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcImZhc3RcIikpIHtcbiAgICAgICAgY29uc3Qgc3BlZWRJbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtc3BlZWQtaW5kaWNhdG9yXCIsXG4gICAgICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJCbGF6aW5nIGZhc3QgcmVzcG9uc2VzXCIgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNldEljb24oc3BlZWRJbmRpY2F0b3IsIFwiemFwXCIpO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJyZWFzb25pbmdcIikpIHtcbiAgICAgICAgY29uc3QgcmVhc29uSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LXJlYXNvbmluZy1pbmRpY2F0b3JcIixcbiAgICAgICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkNvbXBsZXggcmVhc29uaW5nXCIgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNldEljb24ocmVhc29uSW5kaWNhdG9yLCBcImJyYWluXCIpO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJjcmVhdGl2ZVwiKSkge1xuICAgICAgICBjb25zdCBjcmVhdGl2ZUluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1jcmVhdGl2ZS1pbmRpY2F0b3JcIixcbiAgICAgICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkNyZWF0aXZlIHdyaXRpbmdcIiB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SWNvbihjcmVhdGl2ZUluZGljYXRvciwgXCJicnVzaFwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RlbC5hcmNoaXRlY3R1cmU/Lm1vZGFsaXR5ID09PSBcInRleHQraW1hZ2UtPnRleHRcIikge1xuICAgICAgICBjb25zdCB2aXNpb25JbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtdmlzaW9uLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiVmlzaW9uL2ltYWdlIGlucHV0XCIgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNldEljb24odmlzaW9uSW5kaWNhdG9yLCBcImV5ZVwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmFtZUNvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lLWNvbnRhaW5lclwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBtb2RlbE5hbWUgPSBuYW1lQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbmFtZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBwcm92aWRlciBwcmVmaXggaW4gYnJhY2tldHMgZm9yIFN5c3RlbVNjdWxwdCBtb2RlbHNcbiAgICAgIGNvbnN0IHByb3ZpZGVyUHJlZml4ID0gXCJbU1lTVEVNU0NVTFBUXSBcIjtcbiAgICAgIGNvbnN0IG5hbWVUZXh0ID0gcHJvdmlkZXJQcmVmaXggKyBtb2RlbC5uYW1lO1xuXG4gICAgICBtb2RlbE5hbWUuYXBwZW5kKFxuICAgICAgICB0aGlzLmhlbHBlci5oaWdobGlnaHRUZXh0KG5hbWVUZXh0LCBtYXRjaGVzLCB0aGlzLnNlYXJjaElucHV0Py52YWx1ZSlcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRlc2NyaXB0aW9uXCIsXG4gICAgICB9KTtcbiAgICAgIGRlc2NyaXB0aW9uLmFwcGVuZChcbiAgICAgICAgdGhpcy5oZWxwZXIuaGlnaGxpZ2h0VGV4dChcbiAgICAgICAgICBtb2RlbC5kZXNjcmlwdGlvbixcbiAgICAgICAgICBtYXRjaGVzLFxuICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIG1vZGVsLmRlc2NyaXB0aW9uKTtcbiAgICAgIGRlc2NyaXB0aW9uLmFkZENsYXNzKFwiaGFzLXRvb2x0aXBcIik7XG5cbiAgICAgIGNvbnN0IGRldGFpbHMgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGV0YWlsc1wiIH0pO1xuICAgICAgY29uc3QgY29udGV4dExlbmd0aCA9IGRldGFpbHMuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXRhaWxcIixcbiAgICAgIH0pO1xuICAgICAgY29udGV4dExlbmd0aC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogXCJDb250ZXh0OiBcIixcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kZXRhaWwtbGFiZWxcIixcbiAgICAgIH0pO1xuICAgICAgY29udGV4dExlbmd0aC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogYCR7bW9kZWwuY29udGV4dF9sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gdG9rZW5zYCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kZXRhaWwtdmFsdWVcIixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBjbGljayBoYW5kbGVyXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gSWYgY3VzdG9tLCBwaWNrIHRoYXQgYXMgcHJvdmlkZXJcbiAgICAgIGNvbnN0IGN1c3RvbVByb3ZpZGVyID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgIChwKSA9PiBwLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbW9kZWwucHJvdmlkZXIudG9Mb3dlckNhc2UoKVxuICAgICAgKTtcbiAgICAgIGlmIChjdXN0b21Qcm92aWRlcikge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlciA9IHtcbiAgICAgICAgICBpZDogY3VzdG9tUHJvdmlkZXIuaWQsXG4gICAgICAgICAgbmFtZTogY3VzdG9tUHJvdmlkZXIubmFtZSxcbiAgICAgICAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIgPSB7XG4gICAgICAgICAgaWQ6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgICAgICAgbmFtZTogXCJTeXN0ZW1TY3VscHRcIixcbiAgICAgICAgICB0eXBlOiBcIm5hdGl2ZVwiLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICB0aGlzLm9uU2VsZWN0KG1vZGVsLmlkKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIEtleWJvYXJkIG5hdlxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5vblNlbGVjdChtb2RlbC5pZCk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsICgpID0+IHtcbiAgICAgIHRoaXMubW9kZWxDYXJkcy5mb3JFYWNoKChjKSA9PlxuICAgICAgICBjLmNsYXNzTGlzdC5yZW1vdmUoXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIilcbiAgICAgICk7XG4gICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIik7XG4gICAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgdGhpcy5pc0Nsb3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuY29udGVudEVsLmVtcHR5KCk7XG4gIH1cblxuICAvKipcbiAgICogQWxsb3dzIHlvdSB0byBwcm9ncmFtbWF0aWNhbGx5IHNldCBtb2RlbHMgaWYgbmVlZGVkIChvbGQgdXNhZ2UpLlxuICAgKi9cbiAgcHVibGljIHNldE1vZGVscyhtb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10pOiB2b2lkIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobW9kZWxzKSkge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJJbnZhbGlkIG1vZGVscyBkYXRhXCIsIHsgbW9kZWxzIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmFsbE1vZGVscyA9IG1vZGVscztcbiAgICBpZiAodGhpcy5tb2RlbEdyaWQpIHtcbiAgICAgIHRoaXMucmVuZGVyTW9kZWxzKHRoaXMuZ2V0VmlzaWJsZU1vZGVscygpKTtcbiAgICB9XG4gIH1cblxuICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSBwcm8taW5mbyBtZXNzYWdlXG4gIHByaXZhdGUgY3JlYXRlUHJvSW5mb01lc3NhZ2UoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGluZm9FbCA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgaWNvbiBjb250YWluZXJcbiAgICBjb25zdCBpY29uQ29udGFpbmVyID0gaW5mb0VsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24tY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihpY29uQ29udGFpbmVyLCBcInNwYXJrbGVzXCIpO1xuXG4gICAgLy8gQ3JlYXRlIG1haW4gbWVzc2FnZVxuICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSBpbmZvRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbWVzc2FnZS1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby10aXRsZVwiLFxuICAgICAgdGV4dDogXCJVbmxvY2sgUHJvIE1vZGVsc1wiLFxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBcIkdldCBpbnN0YW50IGFjY2VzcyB0byBvMyBNaW5pLCBEZWVwU2VlayBSMSwgYW5kIG90aGVyIHN0YXRlLW9mLXRoZS1hcnQgbW9kZWxzLiBBbHdheXMgdXAgdG8gZGF0ZSBzbyB5b3UgZG9uJ3QgaGF2ZSB0byBndWVzcyB3aGljaCBtb2RlbCB0byB1c2UuXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgYnV0dG9uIGNvbnRhaW5lclxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgcHJvdmlkZXIgYnV0dG9uXG4gICAgY29uc3QgYWRkUHJvdmlkZXJCdG4gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbmZvLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGFkZFByb3ZpZGVySWNvbiA9IGFkZFByb3ZpZGVyQnRuLmNyZWF0ZVNwYW4oKTtcbiAgICBzZXRJY29uKGFkZFByb3ZpZGVySWNvbiwgXCJwbHVzXCIpO1xuICAgIGFkZFByb3ZpZGVyQnRuLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkFkZCBBIFByb3ZpZGVyXCIgfSk7XG4gICAgYWRkUHJvdmlkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICBjb25zdCBtYW5hZ2VyTW9kYWwgPSBuZXcgQ3VzdG9tUHJvdmlkZXJNYW5hZ2VyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICAgICAgdGhpcy5vblNlbGVjdCxcbiAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgKTtcbiAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBtYW5hZ2VyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuXG4gICAgLy8gQmVjb21lIHBhdHJvbiBidXR0b25cbiAgICBjb25zdCBwYXRyb25CdG4gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbmZvLWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgcGF0cm9uSWNvbiA9IHBhdHJvbkJ0bi5jcmVhdGVTcGFuKCk7XG4gICAgc2V0SWNvbihwYXRyb25JY29uLCBcImhlYXJ0XCIpO1xuICAgIHBhdHJvbkJ0bi5jcmVhdGVTcGFuKHsgdGV4dDogXCJCZWNvbWUgQSBQYXRyb25cIiB9KTtcbiAgICBwYXRyb25CdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBpbmZvRWw7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUN1c3RvbVByb3ZpZGVySW5mb01lc3NhZ2UoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGluZm9FbCA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgaWNvbiBjb250YWluZXJcbiAgICBjb25zdCBpY29uQ29udGFpbmVyID0gaW5mb0VsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24tY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihpY29uQ29udGFpbmVyLCBcInNlcnZlclwiKTtcblxuICAgIC8vIENyZWF0ZSBtYWluIG1lc3NhZ2VcbiAgICBjb25zdCBtZXNzYWdlQ29udGFpbmVyID0gaW5mb0VsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW1lc3NhZ2UtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tdGl0bGVcIixcbiAgICAgIHRleHQ6IFwiQWRkIFlvdXIgT3duIE1vZGVsc1wiLFxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBcIkdldCBzdGFydGVkIGJ5IGFkZGluZyB5b3VyIG93biBjdXN0b20gcHJvdmlkZXIgbGlrZSBPbGxhbWEsIExNIFN0dWRpbywgb3IgT3BlbkFJLiBZb3UgY2FuIHVzZSB5b3VyIG93biBtb2RlbHMgb3IgY29ubmVjdCB0byBvdGhlciBBSSBzZXJ2aWNlcy5cIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBidXR0b24gY29udGFpbmVyXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLWJ1dHRvbnNcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBwcm92aWRlciBidXR0b25cbiAgICBjb25zdCBhZGRQcm92aWRlckJ0biA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWluZm8tYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBjb25zdCBhZGRQcm92aWRlckljb24gPSBhZGRQcm92aWRlckJ0bi5jcmVhdGVTcGFuKCk7XG4gICAgc2V0SWNvbihhZGRQcm92aWRlckljb24sIFwicGx1c1wiKTtcbiAgICBhZGRQcm92aWRlckJ0bi5jcmVhdGVTcGFuKHsgdGV4dDogXCJBZGQgQSBQcm92aWRlclwiIH0pO1xuICAgIGFkZFByb3ZpZGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgY29uc3QgbWFuYWdlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QsXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBpbmZvRWw7XG4gIH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIFNlYXJjaGFibGVGaWVsZCB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG4gIHdlaWdodDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaE1hdGNoIHtcbiAgZmllbGQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICBpbmRpY2VzOiBudW1iZXJbXTtcbiAgbWF0Y2hRdWFsaXR5OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoUmVzdWx0PFQ+IHtcbiAgaXRlbTogVDtcbiAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXTtcbiAgc2NvcmU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hVSU9wdGlvbnM8VD4ge1xuICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQ7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICBnZXRJdGVtVGl0bGU6IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIGdldEl0ZW1EZXNjcmlwdGlvbj86IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIGdldEl0ZW1CYWRnZT86IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIGdldEl0ZW1Db250ZXh0PzogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgZ2V0SXRlbU1ldGE/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBvblNlbGVjdDogKGl0ZW06IFQpID0+IHZvaWQ7XG4gIGluaXRpYWxRdWVyeT86IHN0cmluZztcbiAgaW5pdGlhbFJlc3VsdHNMaW1pdD86IG51bWJlcjtcbiAgbWF4RmlsdGVyZWRSZXN1bHRzPzogbnVtYmVyO1xuICBlbXB0eVN0YXRlVGV4dD86IHN0cmluZztcbiAgaXNMb2FkaW5nPzogYm9vbGVhbjtcbiAgbG9hZGluZ1N0YXRlVGV4dD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGbGF0dGVuZWRTZWFyY2hJdGVtPFQ+IHtcbiAgaXRlbTogVDtcbiAgc2VhcmNoVGV4dDogc3RyaW5nO1xuICBmaWVsZFdlaWdodHM6IE1hcDxzdHJpbmcsIG51bWJlcj47XG59XG5cbmV4cG9ydCBjbGFzcyBTZWFyY2hTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX0lOSVRJQUxfUkVTVUxUU19MSU1JVCA9IDI1O1xuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfTUFYX0ZJTFRFUkVEX1JFU1VMVFMgPSA1MDtcblxuICBwdWJsaWMgc2VhcmNoPFQ+KFxuICAgIGl0ZW1zOiBUW10sXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBnZXRTZWFyY2hhYmxlRmllbGRzOiAoaXRlbTogVCkgPT4gU2VhcmNoYWJsZUZpZWxkW10sXG4gICAgb3B0aW9ucz86IHsgaW5pdGlhbFJlc3VsdHNMaW1pdD86IG51bWJlcjsgbWF4RmlsdGVyZWRSZXN1bHRzPzogbnVtYmVyIH1cbiAgKTogU2VhcmNoUmVzdWx0PFQ+W10ge1xuICAgIGNvbnN0IGluaXRpYWxMaW1pdCA9IG9wdGlvbnM/LmluaXRpYWxSZXN1bHRzTGltaXQgPz8gdGhpcy5ERUZBVUxUX0lOSVRJQUxfUkVTVUxUU19MSU1JVDtcbiAgICBjb25zdCBtYXhGaWx0ZXJlZCA9IG9wdGlvbnM/Lm1heEZpbHRlcmVkUmVzdWx0cyA/PyB0aGlzLkRFRkFVTFRfTUFYX0ZJTFRFUkVEX1JFU1VMVFM7XG5cbiAgICAvLyBJZiBubyBxdWVyeSwgcmV0dXJuIGluaXRpYWwgaXRlbXMgd2l0aCBubyBtYXRjaGVzXG4gICAgaWYgKCFxdWVyeS50cmltKCkpIHtcbiAgICAgIHJldHVybiBpdGVtcy5zbGljZSgwLCBpbml0aWFsTGltaXQpLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAgICAgaXRlbSxcbiAgICAgICAgbWF0Y2hlczogW10sXG4gICAgICAgIHNjb3JlOiAwLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8vIFNwbGl0IHF1ZXJ5IGludG8gdGVybXMgYW5kIG5vcm1hbGl6ZVxuICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gcXVlcnkudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKTtcbiAgICBcbiAgICAvLyBGYXN0IHNlYXJjaCB1c2luZyBmbGF0dGVuZWQgc3RydWN0dXJlXG4gICAgY29uc3QgcmVzdWx0cyA9IGl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IGdldFNlYXJjaGFibGVGaWVsZHMoaXRlbSk7XG4gICAgICBjb25zdCBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW107XG4gICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG5cbiAgICAgIC8vIENvbWJpbmUgYWxsIHNlYXJjaGFibGUgdGV4dCB3aXRoIGZpZWxkIHdlaWdodHNcbiAgICAgIGNvbnN0IHNlYXJjaFRleHQgPSBmaWVsZHMubWFwKGYgPT4gZi50ZXh0Py50b0xvd2VyQ2FzZSgpIHx8ICcnKS5qb2luKCcgJyk7XG4gICAgICBcbiAgICAgIC8vIFF1aWNrIGNoZWNrIGlmIGFsbCB0ZXJtcyBleGlzdFxuICAgICAgY29uc3QgYWxsVGVybXNFeGlzdCA9IHNlYXJjaFRlcm1zLmV2ZXJ5KHRlcm0gPT4gc2VhcmNoVGV4dC5pbmNsdWRlcyh0ZXJtKSk7XG4gICAgICBpZiAoIWFsbFRlcm1zRXhpc3QpIHtcbiAgICAgICAgcmV0dXJuIHsgaXRlbSwgbWF0Y2hlczogW10sIHNjb3JlOiAwIH07XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgbWF0Y2hlcyBhbmQgY2FsY3VsYXRlIHNjb3JlXG4gICAgICBzZWFyY2hUZXJtcy5mb3JFYWNoKHRlcm0gPT4ge1xuICAgICAgICBsZXQgcG9zID0gMDtcbiAgICAgICAgY29uc3QgdGVybU1hdGNoZXMgPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICAgICAgXG4gICAgICAgIHdoaWxlICgocG9zID0gc2VhcmNoVGV4dC5pbmRleE9mKHRlcm0sIHBvcykpICE9PSAtMSkge1xuICAgICAgICAgIC8vIEZpbmQgd2hpY2ggZmllbGQgdGhpcyBtYXRjaCBiZWxvbmdzIHRvXG4gICAgICAgICAgbGV0IGN1cnJlbnRQb3MgPSAwO1xuICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZFRleHQgPSBmaWVsZC50ZXh0Py50b0xvd2VyQ2FzZSgpIHx8ICcnO1xuICAgICAgICAgICAgY29uc3QgZmllbGRFbmQgPSBjdXJyZW50UG9zICsgZmllbGRUZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHBvcyA+PSBjdXJyZW50UG9zICYmIHBvcyA8IGZpZWxkRW5kKSB7XG4gICAgICAgICAgICAgIC8vIE1hdGNoIGlzIGluIHRoaXMgZmllbGRcbiAgICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVQb3MgPSBwb3MgLSBjdXJyZW50UG9zO1xuICAgICAgICAgICAgICBjb25zdCBxdWFsaXR5ID0gdGhpcy5nZXRNYXRjaFF1YWxpdHkoZmllbGRUZXh0LCB0ZXJtLCByZWxhdGl2ZVBvcyk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZC5maWVsZCxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmaWVsZC50ZXh0IHx8ICcnLFxuICAgICAgICAgICAgICAgIGluZGljZXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHRlcm0ubGVuZ3RoIH0sIChfLCBpKSA9PiByZWxhdGl2ZVBvcyArIGkpLFxuICAgICAgICAgICAgICAgIG1hdGNoUXVhbGl0eTogcXVhbGl0eVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHRvdGFsU2NvcmUgKz0gZmllbGQud2VpZ2h0ICogcXVhbGl0eTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50UG9zID0gZmllbGRFbmQgKyAxOyAvLyArMSBmb3IgdGhlIHNwYWNlIHdlIGFkZGVkIGJldHdlZW4gZmllbGRzXG4gICAgICAgICAgfVxuICAgICAgICAgIHBvcyArPSAxO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHByb3hpbWl0eSBib251cyBmb3IgbXVsdGlwbGUgdGVybXNcbiAgICAgIGlmIChzZWFyY2hUZXJtcy5sZW5ndGggPiAxICYmIG1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBtYXRjaGVzLmZsYXRNYXAobSA9PiBtLmluZGljZXNbMF0pO1xuICAgICAgICBjb25zdCBtYXhEaXN0YW5jZSA9IE1hdGgubWF4KC4uLnBvc2l0aW9ucykgLSBNYXRoLm1pbiguLi5wb3NpdGlvbnMpO1xuICAgICAgICBpZiAobWF4RGlzdGFuY2UgPCA1MCkge1xuICAgICAgICAgIHRvdGFsU2NvcmUgKj0gMS41O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIG1hdGNoZXMsXG4gICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gRmlsdGVyIGFuZCBzb3J0IHJlc3VsdHNcbiAgICByZXR1cm4gcmVzdWx0c1xuICAgICAgLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LnNjb3JlID4gMClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSlcbiAgICAgIC5zbGljZSgwLCBtYXhGaWx0ZXJlZCk7XG4gIH1cblxuICBwcml2YXRlIGdldE1hdGNoUXVhbGl0eSh0ZXh0OiBzdHJpbmcsIHRlcm06IHN0cmluZywgcG9zaXRpb246IG51bWJlcik6IG51bWJlciB7XG4gICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIHdvcmQgYm91bmRhcnkgbWF0Y2hcbiAgICBjb25zdCBiZWZvcmVDaGFyID0gcG9zaXRpb24gPiAwID8gdGV4dFtwb3NpdGlvbiAtIDFdIDogJyAnO1xuICAgIGNvbnN0IGFmdGVyQ2hhciA9IHBvc2l0aW9uICsgdGVybS5sZW5ndGggPCB0ZXh0Lmxlbmd0aCA/IHRleHRbcG9zaXRpb24gKyB0ZXJtLmxlbmd0aF0gOiAnICc7XG4gICAgXG4gICAgaWYgKCgvXFxzLy50ZXN0KGJlZm9yZUNoYXIpIHx8IC9cXFcvLnRlc3QoYmVmb3JlQ2hhcikpICYmIFxuICAgICAgICAoL1xccy8udGVzdChhZnRlckNoYXIpIHx8IC9cXFcvLnRlc3QoYWZ0ZXJDaGFyKSkpIHtcbiAgICAgIHJldHVybiAxLjA7IC8vIFBlcmZlY3Qgd29yZCBib3VuZGFyeSBtYXRjaFxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gMC44OyAvLyBQYXJ0aWFsIG1hdGNoXG4gIH1cblxuICBwdWJsaWMgaGlnaGxpZ2h0VGV4dCh0ZXh0OiBzdHJpbmcsIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXSwgc2VhcmNoUXVlcnk/OiBzdHJpbmcpOiBEb2N1bWVudEZyYWdtZW50IHtcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDAgfHwgIXNlYXJjaFF1ZXJ5KSB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgIGZyYWdtZW50LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgIHJldHVybiBmcmFnbWVudDtcbiAgICB9XG5cbiAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9IHNlYXJjaFF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpLnNwbGl0KC9cXHMrLykuZmlsdGVyKEJvb2xlYW4pO1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7c2VhcmNoVGVybXMubWFwKHRlcm0gPT4gdGhpcy5lc2NhcGVSZWdFeHAodGVybSkpLmpvaW4oJ3wnKX0pYCwgXCJnaVwiKTtcbiAgICBsZXQgbGFzdEluZGV4ID0gMDtcbiAgICBsZXQgbWF0Y2g7XG5cbiAgICB3aGlsZSAoKG1hdGNoID0gcmVnZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcbiAgICAgIC8vIEFkZCBub24taGlnaGxpZ2h0ZWQgdGV4dCBiZWZvcmUgbWF0Y2hcbiAgICAgIGlmIChtYXRjaC5pbmRleCA+IGxhc3RJbmRleCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCBtYXRjaFxuICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgc3Bhbi5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1zZWFyY2gtaGlnaGxpZ2h0XCI7XG4gICAgICBzcGFuLnRleHRDb250ZW50ID0gbWF0Y2hbMF07XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzcGFuKTtcblxuICAgICAgbGFzdEluZGV4ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlbWFpbmluZyB0ZXh0XG4gICAgaWYgKGxhc3RJbmRleCA8IHRleHQubGVuZ3RoKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBwcml2YXRlIGVzY2FwZVJlZ0V4cChzdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpOyAvLyAkJiBtZWFucyB0aGUgd2hvbGUgbWF0Y2hlZCBzdHJpbmdcbiAgfVxufVxuIiwgImltcG9ydCB7XG4gIE1vZGVsRmlsdGVyU2V0dGluZ3MsXG4gIERFRkFVTFRfRklMVEVSX1NFVFRJTkdTLFxuICBTeXN0ZW1TY3VscHRNb2RlbCxcbn0gZnJvbSBcIi4uL3R5cGVzL2xsbVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgU2VhcmNoTWF0Y2ggfSBmcm9tIFwiLi4vc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRpZXJJbmZvIHtcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBjbGFzc05hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFRJRVJfSU5GTzogeyBba2V5OiBzdHJpbmddOiBUaWVySW5mbyB9ID0ge1xuICBmYXZvcml0ZXM6IHtcbiAgICBuYW1lOiBcIkZhdm9yaXRlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIllvdXIgZmF2b3JpdGUgbW9kZWxzIGZvciBxdWljayBhY2Nlc3NcIixcbiAgICBjbGFzc05hbWU6IFwiZmF2b3JpdGVcIixcbiAgfSxcbiAgZXNzZW50aWFsOiB7XG4gICAgbmFtZTogXCJFc3NlbnRpYWxcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiQnVkZ2V0LWZyaWVuZGx5LCBncmVhdCBmb3IgZGFpbHkgdGFza3MsIGluY2x1ZGVzIHZpc2lvbiBhbmQgcmVhc29uaW5nIGNhcGFiaWxpdGllcywgZXhjZWxsZW50IHZhbHVlXCIsXG4gICAgY2xhc3NOYW1lOiBcImVzc2VudGlhbFwiLFxuICB9LFxuICBhZHZhbmNlZDoge1xuICAgIG5hbWU6IFwiQWR2YW5jZWRcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiQmFsYW5jZWQgcGVyZm9ybWFuY2UsIGVuaGFuY2VkIGNhcGFiaWxpdGllcywgaWRlYWwgZm9yIGNvbXBsZXggdGFza3MsIGVmZmljaWVudCByZXNvdXJjZSB1c2FnZVwiLFxuICAgIGNsYXNzTmFtZTogXCJhZHZhbmNlZFwiLFxuICB9LFxuICBwcm9mZXNzaW9uYWw6IHtcbiAgICBuYW1lOiBcIlByb2Zlc3Npb25hbFwiLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgXCJNYXhpbXVtIHBlcmZvcm1hbmNlLCBhZHZhbmNlZCBmZWF0dXJlcywgc3BlY2lhbGl6ZWQgd29ya2Zsb3dzLCBlbnRlcnByaXNlLWdyYWRlIGNhcGFiaWxpdGllc1wiLFxuICAgIGNsYXNzTmFtZTogXCJwcm9mZXNzaW9uYWxcIixcbiAgfSxcbiAgY3VzdG9tOiB7XG4gICAgbmFtZTogXCJDdXN0b20gTW9kZWxzXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIllvdXIgcGVyc29uYWxseSBjb25maWd1cmVkIG1vZGVscyBmcm9tIGN1c3RvbSBwcm92aWRlcnMsIGFsbG93aW5nIGZ1bGwgY29udHJvbCBvdmVyIG1vZGVsIHNlbGVjdGlvblwiLFxuICAgIGNsYXNzTmFtZTogXCJjdXN0b21cIixcbiAgfSxcbiAgLy8gRmFsbGJhY2sgZm9yIGFueSB1bmtub3duIHRpZXJcbiAgZGVmYXVsdDoge1xuICAgIG5hbWU6IFwiTW9kZWxzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQXZhaWxhYmxlIG1vZGVsc1wiLFxuICAgIGNsYXNzTmFtZTogXCJkZWZhdWx0XCIsXG4gIH0sXG59O1xuXG5leHBvcnQgY2xhc3MgTW9kZWxTZWxlY3Rpb25IZWxwZXIge1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBmaWx0ZXJTZXR0aW5nczogTW9kZWxGaWx0ZXJTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICAvLyBJbml0aWFsaXplIHdpdGggc2F2ZWQgc2V0dGluZ3Mgb3IgZGVmYXVsdHNcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzIH07XG4gIH1cblxuICBnZXRGaWx0ZXJTZXR0aW5ncygpOiBNb2RlbEZpbHRlclNldHRpbmdzIHtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXJTZXR0aW5ncztcbiAgfVxuXG4gIGFzeW5jIHNldEZpbHRlclNldHRpbmcoa2V5OiBrZXlvZiBNb2RlbEZpbHRlclNldHRpbmdzLCB2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuZmlsdGVyU2V0dGluZ3Nba2V5XSA9IHZhbHVlO1xuICAgIC8vIFVwZGF0ZSBwbHVnaW4gc2V0dGluZ3MgYW5kIHNhdmVcbiAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLmZpbHRlclNldHRpbmdzIH07XG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBhc3luYyByZXNldEZpbHRlclNldHRpbmdzKCkge1xuICAgIHRoaXMuZmlsdGVyU2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfRklMVEVSX1NFVFRJTkdTIH07XG4gICAgLy8gVXBkYXRlIHBsdWdpbiBzZXR0aW5ncyBhbmQgc2F2ZVxuICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vZGVsRmlsdGVyU2V0dGluZ3MgPSB7IC4uLnRoaXMuZmlsdGVyU2V0dGluZ3MgfTtcbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgfVxuXG4gIGZvcm1hdFByaWNlKHByaWNlOiBudW1iZXIgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBpZiAocHJpY2UgPT09IG51bGwgfHwgcHJpY2UgPT09IHVuZGVmaW5lZCB8fCBwcmljZSA9PT0gXCIwXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiRnJlZVwiO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBudW1lcmljUHJpY2UgPVxuICAgICAgICB0eXBlb2YgcHJpY2UgPT09IFwic3RyaW5nXCIgPyBwYXJzZUZsb2F0KHByaWNlKSA6IHByaWNlO1xuXG4gICAgICBpZiAoaXNOYU4obnVtZXJpY1ByaWNlKSB8fCBudW1lcmljUHJpY2UgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFwiRnJlZVwiO1xuICAgICAgfVxuXG4gICAgICAvLyBNdWx0aXBseSBieSAxLDAwMCwwMDAgdG8gY29udmVydCBmcm9tIHBlciB0b2tlbiB0byBwZXIgMU0gdG9rZW5zXG4gICAgICBjb25zdCBwcmljZVBlck1pbGxpb24gPSBudW1lcmljUHJpY2UgKiAxMDAwMDAwO1xuXG4gICAgICAvLyBBbHdheXMgc2hvdyBleGFjdGx5IDIgZGVjaW1hbCBwbGFjZXNcbiAgICAgIHJldHVybiBgJCR7cHJpY2VQZXJNaWxsaW9uLnRvRml4ZWQoMil9YDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJNb2RlbFNlbGVjdGlvbkhlbHBlcjogRXJyb3IgZm9ybWF0dGluZyBwcmljZVwiLCB7XG4gICAgICAgIHByaWNlLFxuICAgICAgICBlcnJvcixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFwiUHJpY2UgZXJyb3JcIjtcbiAgICB9XG4gIH1cblxuICBoaWdobGlnaHRUZXh0KFxuICAgIHRleHQ6IHN0cmluZyxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW10sXG4gICAgc2VhcmNoUXVlcnk/OiBzdHJpbmdcbiAgKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwIHx8ICFzZWFyY2hRdWVyeSkge1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgICAvLyBVc2UgcmVnZXggdG8gZmluZCB3aG9sZSB3b3JkIG9yIHBocmFzZSBtYXRjaGVzXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoJHtub3JtYWxpemVkUXVlcnl9KWAsIFwiZ2lcIik7XG4gICAgbGV0IGxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoO1xuXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyBBZGQgbm9uLWhpZ2hsaWdodGVkIHRleHQgYmVmb3JlIG1hdGNoXG4gICAgICBpZiAobWF0Y2guaW5kZXggPiBsYXN0SW5kZXgpIHtcbiAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcbiAgICAgICAgICB0ZXh0LnNsaWNlKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpXG4gICAgICAgICk7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGhpZ2hsaWdodGVkIG1hdGNoXG4gICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICBzcGFuLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LW1vZGVsLWhpZ2hsaWdodFwiO1xuICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IG1hdGNoWzBdO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7XG5cbiAgICAgIGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnNsaWNlKGxhc3RJbmRleCkpO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGV4dE5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiBmcmFnbWVudDtcbiAgfVxuXG4gIHNvcnRNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogU3lzdGVtU2N1bHB0TW9kZWxbXSB7XG4gICAgLy8gQ3JlYXRlIHRpZXIgZ3JvdXBzIGluY2x1ZGluZyBmYXZvcml0ZXNcbiAgICBjb25zdCB0aWVycyA9IHtcbiAgICAgIGZhdm9yaXRlczogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGVzc2VudGlhbDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGFkdmFuY2VkOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgICAgcHJvZmVzc2lvbmFsOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgICAgY3VzdG9tOiBbXSBhcyBTeXN0ZW1TY3VscHRNb2RlbFtdLFxuICAgIH07XG5cbiAgICAvLyBGaXJzdCBwYXNzOiBkaXN0cmlidXRlIG1vZGVscyB0byB0aGVpciByZXNwZWN0aXZlIHRpZXJzXG4gICAgbW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAvLyBGYXZvcml0ZWQgbW9kZWxzIE9OTFkgZ28gdG8gZmF2b3JpdGVzIHRpZXJcbiAgICAgIGlmIChtb2RlbC5pc0Zhdm9yaXRlKSB7XG4gICAgICAgIHRpZXJzLmZhdm9yaXRlcy5wdXNoKG1vZGVsKTtcbiAgICAgICAgcmV0dXJuOyAvLyBTa2lwIGFkZGluZyB0byBvdGhlciB0aWVyc1xuICAgICAgfVxuXG4gICAgICAvLyBOb24tZmF2b3JpdGVzIGdvIHRvIHRoZWlyIHJlc3BlY3RpdmUgdGllcnNcbiAgICAgIGlmIChtb2RlbC5wcm92aWRlciA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICB0aWVycy5jdXN0b20ucHVzaChtb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU29ydCBtb2RlbHMgd2l0aGluIGVhY2ggdGllciBieSBuYW1lXG4gICAgT2JqZWN0LnZhbHVlcyh0aWVycykuZm9yRWFjaCgodGllck1vZGVscykgPT4ge1xuICAgICAgdGllck1vZGVscy5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcbiAgICB9KTtcblxuICAgIC8vIENvbWJpbmUgdGllcnMgaW4gdGhlIGNvcnJlY3Qgb3JkZXIsIG9ubHkgaW5jbHVkaW5nIG5vbi1lbXB0eSB0aWVyc1xuICAgIGNvbnN0IHNvcnRlZE1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSA9IFtdO1xuXG4gICAgLy8gRmF2b3JpdGVzIGFsd2F5cyBmaXJzdCAoaWYgYW55IGV4aXN0KVxuICAgIGlmICh0aWVycy5mYXZvcml0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuZmF2b3JpdGVzKTtcbiAgICB9XG5cbiAgICAvLyBUaGVuIHRoZSBzdGFuZGFyZCB0aWVycyBpbiBvcmRlclxuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmVzc2VudGlhbCk7XG4gICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuYWR2YW5jZWQpO1xuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLnByb2Zlc3Npb25hbCk7XG5cbiAgICAvLyBDdXN0b20gbW9kZWxzIGxhc3RcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5jdXN0b20pO1xuXG4gICAgcmV0dXJuIHNvcnRlZE1vZGVscztcbiAgfVxuXG4gIGZpbHRlck1vZGVscyhtb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10pOiBTeXN0ZW1TY3VscHRNb2RlbFtdIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIG1vZGVscy5maWx0ZXIoKG1vZGVsKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaGFzVmlzaW9uQ2FwYWJpbGl0eSA9XG4gICAgICAgICAgICBtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwidmlzaW9uXCIpIHx8IGZhbHNlO1xuICAgICAgICAgIGNvbnN0IGhhc1JlYXNvbmluZ0NhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInJlYXNvbmluZ1wiKSB8fCBmYWxzZTtcbiAgICAgICAgICBjb25zdCBoYXNDcmVhdGl2ZUNhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcImNyZWF0aXZlXCIpIHx8IGZhbHNlO1xuXG4gICAgICAgICAgLy8gSWYgbm8gZmlsdGVycyBhcmUgYWN0aXZlLCBzaG93IGFsbCBtb2RlbHNcbiAgICAgICAgICBpZiAoIU9iamVjdC52YWx1ZXModGhpcy5maWx0ZXJTZXR0aW5ncykuc29tZSgodmFsdWUpID0+IHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hlY2sgZWFjaCBhY3RpdmUgZmlsdGVyXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICghdGhpcy5maWx0ZXJTZXR0aW5ncy5zaG93VmlzaW9uTW9kZWxzIHx8IGhhc1Zpc2lvbkNhcGFiaWxpdHkpICYmXG4gICAgICAgICAgICAoIXRoaXMuZmlsdGVyU2V0dGluZ3Muc2hvd1JlYXNvbmluZ01vZGVscyB8fFxuICAgICAgICAgICAgICBoYXNSZWFzb25pbmdDYXBhYmlsaXR5KSAmJlxuICAgICAgICAgICAgKCF0aGlzLmZpbHRlclNldHRpbmdzLnNob3dDcmVhdGl2ZU1vZGVscyB8fCBoYXNDcmVhdGl2ZUNhcGFiaWxpdHkpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGZpbHRlcmluZyBpbmRpdmlkdWFsIG1vZGVsXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGluIGZpbHRlck1vZGVsc1wiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbW9kZWxzO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIE5vdGljZSwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwic3JjL21haW5cIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyIH0gZnJvbSBcInNyYy90eXBlcy9sbG1cIjtcblxuZXhwb3J0IGNsYXNzIEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBvbkJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBvbkJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLm9uQmFjayA9IG9uQmFjaztcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvdmlkZXJDYXJkKHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlciwgY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGNhcmQgPSBjb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkXCIpO1xuXG4gICAgLy8gSGVhZGVyIHdpdGggbmFtZSBhbmQgYWN0aW9uc1xuICAgIGNvbnN0IGhlYWRlciA9IGNhcmQuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWhlYWRlclwiKTtcbiAgICBoZWFkZXIuY3JlYXRlRWwoXCJoM1wiLCB7XG4gICAgICB0ZXh0OiBwcm92aWRlci5uYW1lLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1uYW1lXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhY3Rpb25zID0gaGVhZGVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWFjdGlvbnNcIlxuICAgICk7XG5cbiAgICAvLyBEZWxldGUgYnV0dG9uXG4gICAgY29uc3QgZGVsZXRlQnRuID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWFjdGlvbiBkZWxldGVcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGRlbGV0ZUJ0biwgXCJ0cmFzaC0yXCIpO1xuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIFJlbW92ZSBwcm92aWRlclxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzID1cbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbHRlcihcbiAgICAgICAgICAocCkgPT4gcC5pZCAhPT0gcHJvdmlkZXIuaWRcbiAgICAgICAgKTtcblxuICAgICAgLy8gU2F2ZSBzZXR0aW5nc1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgIC8vIEdldCBmcmVzaCBtb2RlbHMgYW5kIHVwZGF0ZSBVSVxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuXG4gICAgICAvLyBSZS1yZW5kZXIgbGlzdFxuICAgICAgdGhpcy5yZW5kZXJQcm92aWRlckxpc3QoKTtcbiAgICB9KTtcblxuICAgIC8vIERldGFpbHMgc2VjdGlvblxuICAgIGNvbnN0IGRldGFpbHMgPSBjYXJkLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1kZXRhaWxzXCIpO1xuXG4gICAgLy8gVHlwZVxuICAgIGNvbnN0IHR5cGVEZXRhaWwgPSBkZXRhaWxzLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbFwiXG4gICAgKTtcbiAgICBzZXRJY29uKHR5cGVEZXRhaWwuY3JlYXRlU3BhbigpLCBcImJveFwiKTtcbiAgICB0eXBlRGV0YWlsLmNyZWF0ZVNwYW4oe1xuICAgICAgdGV4dDogXCJPcGVuQUkgQ29tcGF0aWJsZVwiLFxuICAgIH0pO1xuXG4gICAgLy8gRW5kcG9pbnRcbiAgICBjb25zdCBlbmRwb2ludERldGFpbCA9IGRldGFpbHMuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtZGV0YWlsXCJcbiAgICApO1xuICAgIHNldEljb24oZW5kcG9pbnREZXRhaWwuY3JlYXRlU3BhbigpLCBcImxpbmtcIik7XG4gICAgZW5kcG9pbnREZXRhaWwuY3JlYXRlU3Bhbih7IHRleHQ6IHByb3ZpZGVyLmVuZHBvaW50IH0pO1xuXG4gICAgLy8gU3RhdHVzXG4gICAgY29uc3Qgc3RhdHVzRGV0YWlsID0gZGV0YWlscy5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1kZXRhaWxcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgdG9nZ2xlIGNvbnRhaW5lclxuICAgIGNvbnN0IHRvZ2dsZUNvbnRhaW5lciA9IHN0YXR1c0RldGFpbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItdG9nZ2xlLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGxhYmVsXG4gICAgdG9nZ2xlQ29udGFpbmVyLmNyZWF0ZVNwYW4oe1xuICAgICAgdGV4dDogcHJvdmlkZXIuaXNFbmFibGVkID8gXCJFbmFibGVkXCIgOiBcIkRpc2FibGVkXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci10b2dnbGUtbGFiZWxcIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0b2dnbGUgc3dpdGNoXG4gICAgY29uc3QgdG9nZ2xlID0gdG9nZ2xlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IGBjaGVja2JveC1jb250YWluZXIgJHtwcm92aWRlci5pc0VuYWJsZWQgPyBcImlzLWVuYWJsZWRcIiA6IFwiXCJ9YCxcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0aGUgdG9nZ2xlIHRyYWNrIGFuZCB0aHVtYlxuICAgIHRvZ2dsZS5jcmVhdGVEaXYoeyBjbHM6IFwiY2hlY2tib3gtdG9nZ2xlXCIgfSk7XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlciBmb3Igc3RhdHVzIHRvZ2dsZVxuICAgIHRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIElmIGFscmVhZHkgZW5hYmxlZCwganVzdCBkaXNhYmxlXG4gICAgICBpZiAocHJvdmlkZXIuaXNFbmFibGVkKSB7XG4gICAgICAgIHByb3ZpZGVyLmlzRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGVuYWJsaW5nLCB0ZXN0IGNvbm5lY3Rpb24gZmlyc3RcbiAgICAgIHRvZ2dsZS5hZGRDbGFzcyhcInRlc3RpbmdcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24oXG4gICAgICAgIHByb3ZpZGVyXG4gICAgICApO1xuICAgICAgdG9nZ2xlLnJlbW92ZUNsYXNzKFwidGVzdGluZ1wiKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHByb3ZpZGVyLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgIHRoaXMucmVuZGVyUHJvdmlkZXJMaXN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTaG93IGVycm9yIG5vdGljZVxuICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgIGBGYWlsZWQgdG8gZW5hYmxlICR7cHJvdmlkZXIubmFtZX06ICR7XG4gICAgICAgICAgICByZXN1bHQuZXJyb3IgfHwgXCJDb25uZWN0aW9uIGZhaWxlZFwiXG4gICAgICAgICAgfWAsXG4gICAgICAgICAgNTAwMFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJQcm92aWRlckxpc3QoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG5cbiAgICAvLyBDbGVhciBleGlzdGluZyBjb250ZW50XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLW1vZGFsXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGhlYWRlciB3aXRoIGJhY2sgYnV0dG9uXG4gICAgY29uc3QgaGVhZGVyID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWhlYWRlclwiXG4gICAgKTtcbiAgICBjb25zdCBiYWNrQnV0dG9uID0gaGVhZGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItYmFja1wiLFxuICAgIH0pO1xuICAgIHNldEljb24oYmFja0J1dHRvbi5jcmVhdGVTcGFuKCksIFwiYXJyb3ctbGVmdFwiKTtcbiAgICBiYWNrQnV0dG9uLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkJhY2sgdG8gTW9kZWxzXCIgfSk7XG5cbiAgICBiYWNrQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB0aGlzLm9uQmFjaygpO1xuICAgIH0pO1xuXG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIkN1c3RvbSBQcm92aWRlcnNcIiB9KTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIGNvbnN0IGNvbnRlbnQgPSBjb250ZW50RWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItY29udGVudFwiXG4gICAgKTtcbiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1saXN0XCJcbiAgICApO1xuXG4gICAgLy8gR2V0IHByb3ZpZGVycyBmcm9tIHNldHRpbmdzXG4gICAgY29uc3QgcHJvdmlkZXJzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzO1xuXG4gICAgaWYgKHByb3ZpZGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIFNob3cgZW1wdHkgc3RhdGVcbiAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSBsaXN0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItZW1wdHlcIlxuICAgICAgKTtcbiAgICAgIGNvbnN0IGVtcHR5SWNvbiA9IGVtcHR5U3RhdGUuY3JlYXRlRGl2KFxuICAgICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1lbXB0eS1pY29uXCJcbiAgICAgICk7XG4gICAgICBzZXRJY29uKGVtcHR5SWNvbiwgXCJzZXJ2ZXItb2ZmXCIpO1xuICAgICAgZW1wdHlTdGF0ZS5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWVtcHR5LXRleHRcIixcbiAgICAgICAgdGV4dDogXCJObyBjdXN0b20gcHJvdmlkZXJzIGFkZGVkIHlldFwiLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlbmRlciBwcm92aWRlciBjYXJkc1xuICAgICAgcHJvdmlkZXJzLmZvckVhY2goKHByb3ZpZGVyKSA9PiB7XG4gICAgICAgIHRoaXMucmVuZGVyUHJvdmlkZXJDYXJkKHByb3ZpZGVyLCBsaXN0Q29udGFpbmVyKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhY3Rpb25zIGNvbnRhaW5lclxuICAgIGNvbnN0IGFjdGlvbnMgPSBjb250ZW50LmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWFjdGlvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgcHJvdmlkZXIgYnV0dG9uXG4gICAgY29uc3QgYWRkQnV0dG9uID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJ1dHRvbiBzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItYnV0dG9uLXByaW1hcnlcIixcbiAgICAgIHRleHQ6IFwiQWRkIFByb3ZpZGVyXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihhZGRCdXR0b24uY3JlYXRlU3BhbigpLCBcInBsdXNcIik7XG5cbiAgICBhZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIGNvbnN0IGN1c3RvbVByb3ZpZGVyTW9kYWwgPSBuZXcgQ3VzdG9tUHJvdmlkZXJNb2RhbChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWFuYWdlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgICAgIHRoaXMub25CYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgICBtYW5hZ2VyTW9kYWwub3BlbigpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgY3VzdG9tUHJvdmlkZXJNb2RhbC5vcGVuKCk7XG4gICAgfSk7XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgdGhpcy5yZW5kZXJQcm92aWRlckxpc3QoKTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEN1c3RvbVByb3ZpZGVyTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgbG9nZ2VyOiBDb25zb2xlO1xuICBwcml2YXRlIG9uQmFjazogKCkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIG9uQmFjazogKCkgPT4gdm9pZCkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5sb2dnZXIgPSBjb25zb2xlO1xuICAgIHRoaXMub25CYWNrID0gb25CYWNrO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbW9kYWxcIik7XG5cbiAgICAvLyBDcmVhdGUgaGVhZGVyIHdpdGggYmFjayBidXR0b25cbiAgICBjb25zdCBoZWFkZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1oZWFkZXJcIik7XG5cbiAgICBjb25zdCBiYWNrQnV0dG9uID0gaGVhZGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJhY2tcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGJhY2tCdXR0b24uY3JlYXRlU3BhbigpLCBcImFycm93LWxlZnRcIik7XG4gICAgYmFja0J1dHRvbi5jcmVhdGVTcGFuKHsgdGV4dDogXCJCYWNrIHRvIFByb3ZpZGVyc1wiIH0pO1xuXG4gICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIGhlYWRlci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJBZGQgQ3VzdG9tIFByb3ZpZGVyXCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgZm9ybSBjb250YWluZXJcbiAgICBjb25zdCBmb3JtID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybVwiKTtcblxuICAgIC8vIFByb3ZpZGVyIE5hbWVcbiAgICBjb25zdCBuYW1lR3JvdXAgPSBmb3JtLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1ncm91cFwiKTtcbiAgICBuYW1lR3JvdXAuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUHJvdmlkZXIgTmFtZVwiIH0pO1xuICAgIGNvbnN0IG5hbWVJbnB1dCA9IG5hbWVHcm91cC5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiZS5nLiwgTE0gU3R1ZGlvLCBPcGVuQUlcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgbWF4bGVuZ3RoOiBcIjI1XCIsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGlucHV0IHJ1bGVzIGZvciBwcm92aWRlciBuYW1lXG4gICAgbmFtZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG5hbWVJbnB1dC52YWx1ZTtcblxuICAgICAgLy8gQ2FwaXRhbGl6ZSBmaXJzdCBsZXR0ZXIgb2YgZWFjaCB3b3JkXG4gICAgICBjb25zdCBmb3JtYXR0ZWRWYWx1ZSA9IHZhbHVlXG4gICAgICAgIC5zcGxpdChcIiBcIilcbiAgICAgICAgLm1hcCgod29yZCkgPT4gd29yZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSkpXG4gICAgICAgIC5qb2luKFwiIFwiKTtcblxuICAgICAgLy8gT25seSB1cGRhdGUgaWYgdGhlIHZhbHVlIGhhcyBjaGFuZ2VkIHRvIHByZXZlbnQgY3Vyc29yIGp1bXBpbmdcbiAgICAgIGlmIChmb3JtYXR0ZWRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gZm9ybWF0dGVkVmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBFbmRwb2ludCBVUkxcbiAgICBjb25zdCB1cmxHcm91cCA9IGZvcm0uY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1mb3JtLWdyb3VwXCIpO1xuICAgIHVybEdyb3VwLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIkFQSSBFbmRwb2ludCBVUkxcIiB9KTtcblxuICAgIC8vIEFkZCBwcmVzZXQgYnV0dG9uc1xuICAgIGNvbnN0IHByZXNldENvbnRhaW5lciA9IHVybEdyb3VwLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1wcmVzZXRzXCJcbiAgICApO1xuICAgIHByZXNldENvbnRhaW5lci5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogXCJRdWljayBTZXR1cDpcIiB9KTtcblxuICAgIC8vIEFkZCBwcmVzZXQgYnV0dG9ucyBjb250YWluZXJcbiAgICBjb25zdCBwcmVzZXRCdXR0b25zID0gcHJlc2V0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1wcmVzZXQtYnV0dG9uc1wiXG4gICAgKTtcblxuICAgIC8vIEFkZCBPcGVuQUkgcHJlc2V0XG4gICAgY29uc3Qgb3BlbkFJQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIk9wZW5BSVwiLFxuICAgIH0pO1xuXG4gICAgb3BlbkFJQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSBcIk9wZW5BSVwiO1xuICAgICAgdXJsSW5wdXQudmFsdWUgPSBcImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjFcIjtcbiAgICAgIGFwaUtleUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIE9wZW5Sb3V0ZXIgcHJlc2V0XG4gICAgY29uc3Qgb3BlblJvdXRlckJ1dHRvbiA9IHByZXNldEJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJPcGVuUm91dGVyXCIsXG4gICAgfSk7XG5cbiAgICBvcGVuUm91dGVyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSBcIk9wZW5Sb3V0ZXJcIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBHcm9xIHByZXNldFxuICAgIGNvbnN0IGdyb3FCdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiR3JvcVwiLFxuICAgIH0pO1xuXG4gICAgZ3JvcUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJHcm9xXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cHM6Ly9hcGkuZ3JvcS5jb20vb3BlbmFpL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBMTSBTdHVkaW8gcHJlc2V0XG4gICAgY29uc3QgbG1TdHVkaW9CdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiTE0gU3R1ZGlvXCIsXG4gICAgfSk7XG5cbiAgICBsbVN0dWRpb0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJMTSBTdHVkaW9cIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwOi8vbG9jYWxob3N0OjEyMzQvdjFcIjtcbiAgICAgIGFwaUtleUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIE9sbGFtYSBwcmVzZXRcbiAgICBjb25zdCBvbGxhbWFCdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiT2xsYW1hXCIsXG4gICAgfSk7XG5cbiAgICBvbGxhbWFCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IFwiT2xsYW1hXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cDovL2xvY2FsaG9zdDoxMTQzNC92MVwiO1xuICAgICAgYXBpS2V5SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCB1cmxJbnB1dCA9IHVybEdyb3VwLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJodHRwczovL3lvdXItYXBpLWVuZHBvaW50LmNvbVwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGVycm9yIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgY29uc3QgdXJsRXJyb3IgPSB1cmxHcm91cC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3Igc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvci1oaWRkZW5cIixcbiAgICAgIHRleHQ6IFwiIFwiLCAvLyBTcGFjZSB0byBtYWludGFpbiBoZWlnaHRcbiAgICB9KTtcblxuICAgIC8vIFVSTCB2YWxpZGF0aW9uIGZ1bmN0aW9uXG4gICAgY29uc3QgdmFsaWRhdGVFbmRwb2ludFVybCA9IChcbiAgICAgIHVybDogc3RyaW5nXG4gICAgKTogeyBpc1ZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9ID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZFVybCA9IG5ldyBVUkwodXJsKTtcbiAgICAgICAgY29uc3QgaXNMb2NhbCA9XG4gICAgICAgICAgcGFyc2VkVXJsLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiIHx8XG4gICAgICAgICAgcGFyc2VkVXJsLmhvc3RuYW1lID09PSBcIjEyNy4wLjAuMVwiO1xuXG4gICAgICAgIGlmIChpc0xvY2FsICYmIHBhcnNlZFVybC5wcm90b2NvbCAhPT0gXCJodHRwOlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkxvY2FsIGVuZHBvaW50cyBtdXN0IHVzZSBIVFRQXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNMb2NhbCAmJiBwYXJzZWRVcmwucHJvdG9jb2wgIT09IFwiaHR0cHM6XCIpIHtcbiAgICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiUmVtb3RlIGVuZHBvaW50cyBtdXN0IHVzZSBIVFRQU1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNMb2NhbCAmJiAhcGFyc2VkVXJsLnBvcnQpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogXCJMb2NhbCBlbmRwb2ludHMgcmVxdWlyZSBhIHBvcnQgbnVtYmVyXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUgfTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBVUkwgZm9ybWF0XCIgfTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gQVBJIEtleVxuICAgIGNvbnN0IGFwaUtleUdyb3VwID0gZm9ybS5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1ncm91cFwiXG4gICAgKTtcbiAgICBhcGlLZXlHcm91cC5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogXCJBUEkgS2V5IChPcHRpb25hbClcIiB9KTtcbiAgICBjb25zdCBhcGlLZXlJbnB1dCA9IGFwaUtleUdyb3VwLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiRW50ZXIgeW91ciBBUEkga2V5XCIsXG4gICAgfSk7XG5cbiAgICAvLyBGdW5jdGlvbiB0byByZXNldCB2YWxpZGF0aW9uIHN0YXRlXG4gICAgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgICAgaXNDb25uZWN0aW9uVGVzdGVkID0gZmFsc2U7XG4gICAgICB0ZXN0UmVzdWx0ID0gbnVsbDtcbiAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKFwidGVzdFwiKTtcbiAgICAgIHVybEVycm9yLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvci1oaWRkZW5cIik7XG4gICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItc3VjY2Vzc1wiKTtcbiAgICB9O1xuXG4gICAgLy8gQWRkIGNoYW5nZSBsaXN0ZW5lcnMgdG8gYWxsIGlucHV0c1xuICAgIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgcmVzZXRWYWxpZGF0aW9uKTtcbiAgICB1cmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgcmVzZXRWYWxpZGF0aW9uKTtcbiAgICBhcGlLZXlJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgcmVzZXRWYWxpZGF0aW9uKTtcblxuICAgIC8vIEFkZCBpbnB1dCBydWxlcyBmb3IgcHJvdmlkZXIgbmFtZVxuICAgIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBuYW1lSW5wdXQudmFsdWU7XG5cbiAgICAgIC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyIG9mIGVhY2ggd29yZFxuICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgIC5tYXAoKHdvcmQpID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKVxuICAgICAgICAuam9pbihcIiBcIik7XG5cbiAgICAgIC8vIE9ubHkgdXBkYXRlIGlmIHRoZSB2YWx1ZSBoYXMgY2hhbmdlZCB0byBwcmV2ZW50IGN1cnNvciBqdW1waW5nXG4gICAgICBpZiAoZm9ybWF0dGVkVmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IGZvcm1hdHRlZFZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGZvcm0gYWN0aW9ucyBjb250YWluZXJcbiAgICBjb25zdCBmb3JtQWN0aW9ucyA9IGZvcm0uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tYWN0aW9uc1wiXG4gICAgKTtcblxuICAgIC8vIEFkZCBjYW5jZWwgYnV0dG9uIGZpcnN0IChvbiB0aGUgbGVmdClcbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBmb3JtQWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24gc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgIH0pO1xuXG4gICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB0aGlzLm9uQmFjaygpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRlc3Qvc2F2ZSBidXR0b24gKG9uIHRoZSByaWdodClcbiAgICBjb25zdCBhY3Rpb25CdXR0b24gPSBmb3JtQWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24gc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tcHJpbWFyeVwiLFxuICAgICAgdGV4dDogXCJUZXN0IENvbm5lY3Rpb25cIixcbiAgICB9KTtcblxuICAgIGxldCBpc0Nvbm5lY3Rpb25UZXN0ZWQgPSBmYWxzZTtcbiAgICBsZXQgdGVzdFJlc3VsdDogeyBzdWNjZXNzOiBib29sZWFuOyBtb2RlbHM/OiBzdHJpbmdbXSB9IHwgbnVsbCA9IG51bGw7XG5cbiAgICAvLyBGdW5jdGlvbiB0byBjcmVhdGUgYSBwcm92aWRlciBvYmplY3QgZnJvbSBmb3JtIGRhdGFcbiAgICBjb25zdCBjcmVhdGVQcm92aWRlckZyb21Gb3JtID0gKCk6IEN1c3RvbVByb3ZpZGVyID0+ICh7XG4gICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgIG5hbWU6IG5hbWVJbnB1dC52YWx1ZS50cmltKCksXG4gICAgICBlbmRwb2ludDogdXJsSW5wdXQudmFsdWUudHJpbSgpLFxuICAgICAgYXBpS2V5OiBhcGlLZXlJbnB1dC52YWx1ZS50cmltKCksXG4gICAgICBpc0VuYWJsZWQ6IHRydWUsXG4gICAgICBsYXN0VGVzdGVkOiBEYXRlLm5vdygpLFxuICAgIH0pO1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gdXBkYXRlIGJ1dHRvbiBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZUJ1dHRvblN0YXRlID0gKFxuICAgICAgc3RhdGU6IFwidGVzdFwiIHwgXCJ0ZXN0aW5nXCIgfCBcInJldHJ5XCIgfCBcInNhdmVcIlxuICAgICkgPT4ge1xuICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICBjYXNlIFwidGVzdFwiOlxuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFwiVGVzdCBDb25uZWN0aW9uXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInRlc3RpbmdcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlRlc3RpbmcuLi5cIik7XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJldHJ5XCI6XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXCJUcnkgQWdhaW5cIik7XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic2F2ZVwiOlxuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFwiU2F2ZSBQcm92aWRlclwiKTtcbiAgICAgICAgICBhY3Rpb25CdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBpbnB1dHNcbiAgICBjb25zdCB2YWxpZGF0ZUZvcm0gPSAoKTogeyBpc1ZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9ID0+IHtcbiAgICAgIC8vIENoZWNrIG5hbWVcbiAgICAgIGlmICghbmFtZUlucHV0LnZhbHVlLnRyaW0oKSkge1xuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiUHJvdmlkZXIgbmFtZSBpcyByZXF1aXJlZFwiIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIFVSTFxuICAgICAgY29uc3QgdXJsVmFsaWRhdGlvbiA9IHZhbGlkYXRlRW5kcG9pbnRVcmwodXJsSW5wdXQudmFsdWUpO1xuICAgICAgaWYgKCF1cmxWYWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIHVybFZhbGlkYXRpb247XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIEFQSSBrZXkgKHJlcXVpcmVkIGZvciBub24tbG9jYWwgZW5kcG9pbnRzKVxuICAgICAgY29uc3QgaXNMb2NhbCA9XG4gICAgICAgIHVybElucHV0LnZhbHVlLmluY2x1ZGVzKFwibG9jYWxob3N0XCIpIHx8XG4gICAgICAgIHVybElucHV0LnZhbHVlLmluY2x1ZGVzKFwiMTI3LjAuMC4xXCIpO1xuICAgICAgaWYgKCFpc0xvY2FsICYmICFhcGlLZXlJbnB1dC52YWx1ZS50cmltKCkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogXCJBUEkga2V5IGlzIHJlcXVpcmVkIGZvciByZW1vdGUgZW5kcG9pbnRzXCIsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUgfTtcbiAgICB9O1xuXG4gICAgLy8gSGFuZGxlIGJ1dHRvbiBjbGlja1xuICAgIGFjdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlRm9ybSgpO1xuXG4gICAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICAvLyBTaG93IGVycm9yXG4gICAgICAgIHVybEVycm9yLnRleHRDb250ZW50ID0gdmFsaWRhdGlvbi5lcnJvciB8fCBcIkludmFsaWQgZm9ybSBkYXRhXCI7XG4gICAgICAgIHVybEVycm9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvci1oaWRkZW5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc0Nvbm5lY3Rpb25UZXN0ZWQpIHtcbiAgICAgICAgLy8gVGVzdCBjb25uZWN0aW9uXG4gICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKFwidGVzdGluZ1wiKTtcblxuICAgICAgICBjb25zdCBwcm92aWRlciA9IGNyZWF0ZVByb3ZpZGVyRnJvbUZvcm0oKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wbHVnaW4uY3VzdG9tUHJvdmlkZXJTZXJ2aWNlLnRlc3RDb25uZWN0aW9uKFxuICAgICAgICAgIHByb3ZpZGVyXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgaXNDb25uZWN0aW9uVGVzdGVkID0gdHJ1ZTtcbiAgICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInNhdmVcIik7XG4gICAgICAgICAgdGVzdFJlc3VsdCA9IHJlc3VsdDtcblxuICAgICAgICAgIC8vIFNob3cgc3VjY2VzcyBtZXNzYWdlXG4gICAgICAgICAgdXJsRXJyb3IudGV4dENvbnRlbnQgPSBgQ29ubmVjdGlvbiBzdWNjZXNzZnVsISBGb3VuZCAke1xuICAgICAgICAgICAgcmVzdWx0Lm1vZGVscz8ubGVuZ3RoIHx8IDBcbiAgICAgICAgICB9IG1vZGVscy5gO1xuICAgICAgICAgIHVybEVycm9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1lcnJvci1oaWRkZW5cIik7XG4gICAgICAgICAgdXJsRXJyb3IuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXN1Y2Nlc3NcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoXCJyZXRyeVwiKTtcblxuICAgICAgICAgIC8vIFNob3cgZXJyb3IgbWVzc2FnZVxuICAgICAgICAgIHVybEVycm9yLnRleHRDb250ZW50ID0gcmVzdWx0LmVycm9yIHx8IFwiQ29ubmVjdGlvbiBmYWlsZWRcIjtcbiAgICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgICAgIHVybEVycm9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1zdWNjZXNzXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTYXZlIHByb3ZpZGVyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gY3JlYXRlUHJvdmlkZXJGcm9tRm9ybSgpO1xuXG4gICAgICAgIC8vIEFkZCB0byBzZXR0aW5nc1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMgPSBbXG4gICAgICAgICAgLi4udGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLFxuICAgICAgICAgIHByb3ZpZGVyLFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIFNhdmUgc2V0dGluZ3NcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gR2V0IGZyZXNoIG1vZGVsc1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG5cbiAgICAgICAgLy8gQ2xvc2UgYW5kIGdvIGJhY2tcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB0aGlzLm9uQmFjaygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZvbGRlciwgQWJzdHJhY3RJbnB1dFN1Z2dlc3QgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGNsYXNzIEZvbGRlclN1Z2dlc3RlciBleHRlbmRzIEFic3RyYWN0SW5wdXRTdWdnZXN0PHN0cmluZz4ge1xuICBwcml2YXRlIGNvbnRlbnQ6IFNldDxzdHJpbmc+O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudCxcbiAgICBwcml2YXRlIG9uU2VsZWN0Q2I6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkLFxuICAgIGFwcDogQXBwXG4gICkge1xuICAgIHN1cGVyKGFwcCwgaW5wdXRFbCk7XG4gICAgdGhpcy5jb250ZW50ID0gZ2V0Rm9sZGVyU3VnZ2VzdGlvbnMoYXBwKTtcbiAgfVxuXG4gIGdldFN1Z2dlc3Rpb25zKGlucHV0U3RyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgbG93ZXJDYXNlSW5wdXRTdHIgPSBpbnB1dFN0ci50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBbLi4udGhpcy5jb250ZW50XS5maWx0ZXIoKGNvbnRlbnQpID0+XG4gICAgICBjb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlSW5wdXRTdHIpXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBlbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBlbC5zZXRUZXh0KGNvbnRlbnQpO1xuICB9XG5cbiAgc2VsZWN0U3VnZ2VzdGlvbihjb250ZW50OiBzdHJpbmcsIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLm9uU2VsZWN0Q2IoY29udGVudCk7XG4gICAgdGhpcy5pbnB1dEVsLnZhbHVlID0gY29udGVudDtcbiAgICB0aGlzLmlucHV0RWwuYmx1cigpO1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Rm9sZGVyU3VnZ2VzdGlvbnMoYXBwOiBBcHApOiBTZXQ8c3RyaW5nPiB7XG4gIGNvbnN0IGZvbGRlcnMgPSBhcHAudmF1bHRcbiAgICAuZ2V0QWxsTG9hZGVkRmlsZXMoKVxuICAgIC5maWx0ZXIoKGZpbGUpID0+IGZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSBhcyBURm9sZGVyW107XG4gIHJldHVybiBuZXcgU2V0KGZvbGRlcnMubWFwKChmb2xkZXIpID0+IGZvbGRlci5wYXRoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhdHRhY2hGb2xkZXJTdWdnZXN0ZXIoXG4gIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHZvaWQsXG4gIGFwcDogQXBwXG4pOiBGb2xkZXJTdWdnZXN0ZXIge1xuICByZXR1cm4gbmV3IEZvbGRlclN1Z2dlc3RlcihpbnB1dEVsLCBvblNlbGVjdCwgYXBwKTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBURmlsZSwgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgYXR0YWNoRmlsZVN1Z2dlc3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVTdWdnZXN0ZXJcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFByZXNldCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtUHJvbXB0U2VydmljZVwiO1xuXG5mdW5jdGlvbiBzYW5pdGl6ZUZpbGVOYW1lKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKS5yZXBsYWNlKC8gL2csIFwiLVwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0U3lzdGVtUHJvbXB0UGF0aChkaXJlY3Rvcnk6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtkaXJlY3Rvcnl9LyR7ZmlsZU5hbWV9Lm1kYDtcbn1cblxuZXhwb3J0IHR5cGUgU3lzdGVtUHJvbXB0TW9kZSA9IFwiZGVmYXVsdFwiIHwgXCJjaGF0LXNwZWNpZmljXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zIHtcbiAgb25TYXZlPzogKG5ld1Byb21wdDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5Pzogc3RyaW5nO1xuICBtb2RlOiBTeXN0ZW1Qcm9tcHRNb2RlO1xuICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZztcbiAgbW9kZWxDb250ZXh0TGVuZ3RoPzogbnVtYmVyO1xuICB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1Qcm9tcHRSZXN1bHQge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHR5cGU6IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIjtcbiAgcGF0aD86IHN0cmluZztcbiAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1Qcm9tcHRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSByZXN1bHQ6IFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGwpID0+IHZvaWQ7XG4gIHByaXZhdGUgdGV4dEFyZWE6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tU2VjdGlvbjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgb3B0aW9uczogU3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zO1xuICBwcml2YXRlIHN5c3RlbVByb21wdFNlcnZpY2U6IFN5c3RlbVByb21wdFNlcnZpY2U7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10gPSBbXTtcbiAgcHJpdmF0ZSB0b2tlbkxpbWl0SW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgbG9hZGluZ0luZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY29udGVudENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcHJlc2V0QnV0dG9uQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBhY3RpdmVQcmVzZXQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgY3VycmVudFByb21wdDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IFN5c3RlbVByb21wdE1vZGFsT3B0aW9uc1xuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiLCBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1tb2RhbFwiKTtcbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTpcbiAgICAgICAgb3B0aW9ucy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5ID8/IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gICAgfTtcbiAgICB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZShhcHApO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93TG9hZGluZyhzaG93OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLmxvYWRpbmdJbmRpY2F0b3IgfHwgIXRoaXMuY29udGVudENvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcbiAgICB0aGlzLmNvbnRlbnRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcIm5vbmVcIiA6IFwiYmxvY2tcIjtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTeXN0ZW1Qcm9tcHRzKCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKHRydWUpO1xuICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRzID0gYXdhaXQgdGhpcy5zeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdHMoKTtcblxuICAgICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b25zIGFmdGVyIGxvYWRpbmcgZGF0YVxuICAgICAgdGhpcy5jcmVhdGVQcmVzZXRCdXR0b25zKCk7XG5cbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc3lzdGVtIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkZhaWxlZCB0byBsb2FkIHN5c3RlbSBwcm9tcHRzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVByZXNldEJ1dHRvbnMoKSB7XG4gICAgaWYgKCF0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgLy8gQ2xlYXIgZXhpc3RpbmcgYnV0dG9uc1xuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICAvLyBJbml0aWFsaXplIGFjdGl2ZSBwcmVzZXQgYmFzZWQgb24gY3VycmVudCBwcm9tcHRcbiAgICB0aGlzLnN5c3RlbVByb21wdHMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICBpZiAocHJlc2V0LnN5c3RlbVByb21wdCA9PT0gdGhpcy5jdXJyZW50UHJvbXB0KSB7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmxhYmVsO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSWYgbm8gcHJlc2V0IG1hdGNoZXMsIGNoZWNrIGZvciBnZW5lcmFsLXVzZSBtYXRjaFxuICAgIGlmICghdGhpcy5hY3RpdmVQcmVzZXQgJiYgdGhpcy5jdXJyZW50UHJvbXB0KSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGUgXCJnZW5lcmFsLXVzZVwiIHByb21wdCB0ZXh0IGV4YWN0bHkgbWF0Y2hlcyB0aGUgdXNlcidzIGN1cnJlbnQgcHJvbXB0XG4gICAgICBjb25zdCBnZW5lcmFsVXNlUHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQoXG4gICAgICAgIChwKSA9PiBwLmlkID09PSBcImdlbmVyYWwtdXNlXCJcbiAgICAgICk7XG4gICAgICBpZiAoXG4gICAgICAgIGdlbmVyYWxVc2VQcmVzZXQgJiZcbiAgICAgICAgZ2VuZXJhbFVzZVByZXNldC5zeXN0ZW1Qcm9tcHQudHJpbSgpID09PSB0aGlzLmN1cnJlbnRQcm9tcHQudHJpbSgpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBnZW5lcmFsVXNlUHJlc2V0LmxhYmVsOyAvLyBlLmcuIFwiR2VuZXJhbC11c2VcIlxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGdlbmVyYWwtdXNlIGFuZCB1c2UgaXRzIHN5c3RlbSBwcm9tcHRcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBcIkdlbmVyYWwtdXNlXCI7XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhICYmIGdlbmVyYWxVc2VQcmVzZXQpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gZ2VuZXJhbFVzZVByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgZm9yIGVhY2ggc3lzdGVtIHByb21wdFxuICAgIGNvbnN0IHByZXNldEJ1dHRvbnMgPSBbXG4gICAgICAuLi50aGlzLnN5c3RlbVByb21wdHMsXG4gICAgICAvLyBPbmx5IGFkZCBjdXN0b20gaWYgaXQncyBub3QgYWxyZWFkeSBpbiBzeXN0ZW1Qcm9tcHRzXG4gICAgICAuLi4oIXRoaXMuc3lzdGVtUHJvbXB0cy5zb21lKChwKSA9PiBwLmlkID09PSBcImN1c3RvbVwiKVxuICAgICAgICA/IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICAgIGxhYmVsOiBcIkN1c3RvbVwiLFxuICAgICAgICAgICAgICBpc1VzZXJDb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgIHN5c3RlbVByb21wdDogXCJcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXVxuICAgICAgICA6IFtdKSxcbiAgICBdLm1hcCgocHJlc2V0KSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIHRleHQ6IHByZXNldC5sYWJlbCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gU2V0IGluaXRpYWwgYWN0aXZlIHN0YXRlXG4gICAgICBpZiAocHJlc2V0LmxhYmVsID09PSB0aGlzLmFjdGl2ZVByZXNldCkge1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGlmIChwcmVzZXQubGFiZWwgPT09IFwiQ3VzdG9tXCIpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2ZSBjbGFzcyBmcm9tIGFsbCBidXR0b25zXG4gICAgICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyXG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIilcbiAgICAgICAgICAuZm9yRWFjaCgoYnRuKSA9PiBidG4ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmxhYmVsO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0ZXh0IGFyZWEgYW5kIGN1c3RvbSBzZWN0aW9uIGJhc2VkIG9uIHByZXNldFxuICAgICAgICBpZiAocHJlc2V0LmxhYmVsID09PSBcIkN1c3RvbVwiKSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC5mb2N1cygpO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9ICFwcmVzZXQuaXNVc2VyQ29uZmlndXJhYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBidXR0b247XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWNvbnRlbnRcIik7XG5cbiAgICAvLyBDcmVhdGUgbG9hZGluZyBpbmRpY2F0b3JcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3IgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWxvYWRpbmdcIik7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUucGFkZGluZyA9IFwiMjBweFwiO1xuICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gdGhpcy5sb2FkaW5nSW5kaWNhdG9yLmNyZWF0ZVNwYW4oKTtcbiAgICBsb2FkaW5nVGV4dC5zZXRUZXh0KFwiTG9hZGluZyBzeXN0ZW0gcHJvbXB0cy4uLlwiKTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIFNldCB0aXRsZSBhbmQgZGVzY3JpcHRpb24gYmFzZWQgb24gbW9kZVxuICAgIGNvbnN0IHRpdGxlID1cbiAgICAgIHRoaXMub3B0aW9ucy5tb2RlID09PSBcImRlZmF1bHRcIlxuICAgICAgICA/IFwiRWRpdCBEZWZhdWx0IFN5c3RlbSBQcm9tcHRcIlxuICAgICAgICA6IFwiQ2hhdCBWaWV3IFNldHRpbmdzXCI7XG5cbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9XG4gICAgICB0aGlzLm9wdGlvbnMubW9kZSA9PT0gXCJkZWZhdWx0XCJcbiAgICAgICAgPyBcIkNoYW5nZXMgd2lsbCBhcHBseSBhcyB0aGUgZGVmYXVsdCBmb3IgYWxsIG5ldyBjaGF0IHZpZXdzXCJcbiAgICAgICAgOiBcIkNvbmZpZ3VyZSBzZXR0aW5ncyBmb3IgdGhpcyBzcGVjaWZpYyBjaGF0IHZpZXdcIjtcblxuICAgIC8vIEFkZCB0aXRsZVxuICAgIHRoaXMudGl0bGVFbC5zZXRUZXh0KHRpdGxlKTtcbiAgICB0aGlzLnRpdGxlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIik7XG5cbiAgICAvLyBBZGQgZGVzY3JpcHRpb24gdGV4dCBkaXJlY3RseSBhZnRlciB0aXRsZVxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aGlzLnRpdGxlRWwuY3JlYXRlRGl2KCk7XG4gICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbkVsLnNldFRleHQoZGVzY3JpcHRpb24pO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5mb250U2l6ZSA9IFwiMC45ZW1cIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLm1hcmdpblRvcCA9IFwiMC4yZW1cIjtcblxuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9uIGNvbnRhaW5lciBidXQgZG9uJ3QgcG9wdWxhdGUgeWV0XG4gICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBjdXN0b20gc2VjdGlvbiAoaGlkZGVuIGJ5IGRlZmF1bHQpXG4gICAgdGhpcy5jdXN0b21TZWN0aW9uID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXNlY3Rpb25cIlxuICAgICk7XG4gICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGNvbnN0IGN1c3RvbUlucHV0Q29udGFpbmVyID0gdGhpcy5jdXN0b21TZWN0aW9uLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1pbnB1dC1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgYSBjb250YWluZXIgZm9yIHRoZSBpbnB1dCBhbmQgYnV0dG9uXG4gICAgY29uc3QgaW5wdXRXcmFwcGVyID0gY3VzdG9tSW5wdXRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtaW5wdXQtd3JhcHBlclwiXG4gICAgKTtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5nYXAgPSBcIjhweFwiO1xuICAgIGlucHV0V3JhcHBlci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcblxuICAgIC8vIEFkZCB0aGUgc2VhcmNoIGlucHV0XG4gICAgdGhpcy5jdXN0b21JbnB1dCA9IGlucHV0V3JhcHBlci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoIGZvciBhIHN5c3RlbSBwcm9tcHQgZmlsZS4uLlwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aGUgY3JlYXRlIG5ldyBidXR0b25cbiAgICBjb25zdCBjcmVhdGVCdXR0b24gPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jcmVhdGUtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLnBhZGRpbmcgPSBcIjRweCA4cHhcIjtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI0cHhcIjtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XG4gICAgc2V0SWNvbihjcmVhdGVCdXR0b24sIFwicGx1c1wiKTtcblxuICAgIGNyZWF0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHRlbXBsYXRlQ29udGVudCA9IFwiXCI7XG4gICAgICB0cnkge1xuICAgICAgICB0ZW1wbGF0ZUNvbnRlbnQgPVxuICAgICAgICAgIGF3YWl0IHRoaXMuc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRUZW1wbGF0ZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGU6XCIsIGVycm9yKTtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIFwiRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGUuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgdGl0bGU6IFwiQ3JlYXRlIE5ldyBTeXN0ZW0gUHJvbXB0XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgIFwiRW50ZXIgYSB0aXRsZSBhbmQgY29udGVudCBmb3IgeW91ciBuZXcgc3lzdGVtIHByb21wdC4gVGhlIHRpdGxlIHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgYSBtYXJrZG93biBmaWxlIHRoYXQgeW91IGNhbiBjdXN0b21pemUgbGF0ZXIuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiQ3JlYXRlXCIsXG4gICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgaW5wdXRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJNeSBDdXN0b20gQXNzaXN0YW50XCIsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLXRpdGxlLWlucHV0XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRhcmVhXCIsXG4gICAgICAgICAgICB2YWx1ZTogdGVtcGxhdGVDb250ZW50LFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3lzdGVtc2N1bHB0LXByb21wdC1jcmVhdGlvbi1jb250ZW50XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3VsdD8uY29uZmlybWVkIHx8ICFyZXN1bHQuaW5wdXRzPy5bMF0gfHwgIXJlc3VsdC5pbnB1dHM/LlsxXSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFt0aXRsZSwgY29udGVudF0gPSByZXN1bHQuaW5wdXRzO1xuICAgICAgY29uc3QgcHJvbXB0c0RpcmVjdG9yeSA9XG4gICAgICAgIHRoaXMub3B0aW9ucy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5ID8/IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCI7XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHNhbml0aXplRmlsZU5hbWUodGl0bGUpO1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBnZXRTeXN0ZW1Qcm9tcHRQYXRoKHByb21wdHNEaXJlY3RvcnksIGZpbGVOYW1lKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIocHJvbXB0c0RpcmVjdG9yeSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgIC8qIERpcmVjdG9yeSBtaWdodCBhbHJlYWR5IGV4aXN0ICovXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGZpbGVDb250ZW50ID0gYCMgJHt0aXRsZX1cXG5cXG4ke2NvbnRlbnR9YDtcbiAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShmaWxlUGF0aCwgZmlsZUNvbnRlbnQpO1xuXG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgZmlsZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdGV4dGFyZWEgd2l0aCB0aGUgY29udGVudFxuICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBmaWxlQ29udGVudDtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIGlucHV0IHRvIHNob3cgdGhlIHNlbGVjdGVkIGZpbGVcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IGZpbGVQYXRoO1xuXG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTeXN0ZW0gcHJvbXB0IGZpbGUgY3JlYXRlZCBzdWNjZXNzZnVsbHkhXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBzeXN0ZW0gcHJvbXB0IGZpbGU6XCIsIGVycm9yKTtcblxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiBcIkZhaWxlZCB0byBjcmVhdGUgc3lzdGVtIHByb21wdCBmaWxlLiBQbGVhc2UgdHJ5IGFnYWluLlwiO1xuXG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGVycm9yTWVzc2FnZSxcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gT25seSBhdHRhY2ggZmlsZSBzdWdnZXN0ZXIgYWZ0ZXIgaW5wdXQgaXMgY3JlYXRlZFxuICAgIGlmICh0aGlzLmN1c3RvbUlucHV0KSB7XG4gICAgICBhdHRhY2hGaWxlU3VnZ2VzdGVyKFxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LFxuICAgICAgICBhc3luYyAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChzZWxlY3RlZFBhdGgpO1xuICAgICAgICAgICAgaWYgKGZpbGUgJiYgZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gY29udGVudDtcbiAgICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWUgd2l0aG91dCAubWQgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSBzZWxlY3RlZFBhdGgucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZWFkaW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5ID8/IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy50ZXh0QXJlYSA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZUVsKFwidGV4dGFyZWFcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYVwiLFxuICAgICAgYXR0cjoge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJFbnRlciBzeXN0ZW0gcHJvbXB0XCIsXG4gICAgICAgIHJlYWRPbmx5OiB0aGlzLmFjdGl2ZVByZXNldCAhPT0gXCJDdXN0b21cIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRoaXMuY3VycmVudFByb21wdDtcblxuICAgIC8vIEFkZCB0b2tlbiBsaW1pdCBzZWN0aW9uIG9ubHkgZm9yIGNoYXQtc3BlY2lmaWMgbW9kZSwgYWZ0ZXIgdGhlIHRleHRhcmVhXG4gICAgaWYgKHRoaXMub3B0aW9ucy5tb2RlID09PSBcImNoYXQtc3BlY2lmaWNcIikge1xuICAgICAgY29uc3QgdG9rZW5MaW1pdENvbnRhaW5lciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdG9rZW4tbGltaXQtY29udGFpbmVyXCIsXG4gICAgICB9KTtcbiAgICAgIHRva2VuTGltaXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgdG9rZW5MaW1pdENvbnRhaW5lci5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1lbmRcIjtcbiAgICAgIHRva2VuTGltaXRDb250YWluZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgICB0b2tlbkxpbWl0Q29udGFpbmVyLnN0eWxlLm1hcmdpblRvcCA9IFwiMXJlbVwiO1xuICAgICAgdG9rZW5MaW1pdENvbnRhaW5lci5zdHlsZS5nYXAgPSBcIjhweFwiO1xuXG4gICAgICBjb25zdCB0b2tlbkxpbWl0V3JhcHBlciA9IHRva2VuTGltaXRDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC13cmFwcGVyXCIsXG4gICAgICB9KTtcbiAgICAgIHRva2VuTGltaXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIHRva2VuTGltaXRXcmFwcGVyLnN0eWxlLmZsZXhEaXJlY3Rpb24gPSBcImNvbHVtblwiO1xuICAgICAgdG9rZW5MaW1pdFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiZmxleC1lbmRcIjtcbiAgICAgIHRva2VuTGltaXRXcmFwcGVyLnN0eWxlLndpZHRoID0gXCI1MCVcIjtcblxuICAgICAgY29uc3QgdG9rZW5MaW1pdExhYmVsID0gdG9rZW5MaW1pdFdyYXBwZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1sYWJlbFwiLFxuICAgICAgICB0ZXh0OiBcIkNvbnRleHQgVG9rZW4gTGltaXRcIixcbiAgICAgIH0pO1xuICAgICAgdG9rZW5MaW1pdExhYmVsLnN0eWxlLmZvbnRXZWlnaHQgPSBcIjUwMFwiO1xuICAgICAgdG9rZW5MaW1pdExhYmVsLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiNHB4XCI7XG4gICAgICB0b2tlbkxpbWl0TGFiZWwuc3R5bGUuZm9udFNpemUgPSBcIjE0cHhcIjtcblxuICAgICAgY29uc3QgaW5wdXRXcmFwcGVyID0gdG9rZW5MaW1pdFdyYXBwZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1pbnB1dC13cmFwcGVyXCIsXG4gICAgICB9KTtcbiAgICAgIGlucHV0V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI0cHhcIjtcbiAgICAgIGlucHV0V3JhcHBlci5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXG4gICAgICB0aGlzLnRva2VuTGltaXRJbnB1dCA9IGlucHV0V3JhcHBlci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgICAgdHlwZTogXCJyYW5nZVwiLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWlucHV0XCIsXG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBtaW46IFwiMFwiLFxuICAgICAgICAgIG1heDogXCIxMDBcIixcbiAgICAgICAgICBzdGVwOiBcIjFcIixcbiAgICAgICAgICB2YWx1ZTogdGhpcy5vcHRpb25zLnRva2VuTGltaXRQZXJjZW50YWdlPy50b1N0cmluZygpIHx8IFwiMFwiLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICB0aGlzLnRva2VuTGltaXRJbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXG4gICAgICBjb25zdCB2YWx1ZURpc3BsYXkgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC10b2tlbi1saW1pdC1kaXNwbGF5XCIsXG4gICAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy50b2tlbkxpbWl0UGVyY2VudGFnZVxuICAgICAgICAgID8gdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aFxuICAgICAgICAgICAgPyBgJHtNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICgodGhpcy5vcHRpb25zLnRva2VuTGltaXRQZXJjZW50YWdlIC8gMTAwKSAqXG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoKSAvXG4gICAgICAgICAgICAgICAgICAxMDAwXG4gICAgICAgICAgICAgICl9S2BcbiAgICAgICAgICAgIDogYCR7dGhpcy5vcHRpb25zLnRva2VuTGltaXRQZXJjZW50YWdlfSVgXG4gICAgICAgICAgOiBcIlx1MjIxRVwiLFxuICAgICAgfSk7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUubWluV2lkdGggPSBcIjQ1cHhcIjtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS50ZXh0QWxpZ24gPSBcInJpZ2h0XCI7XG4gICAgICB2YWx1ZURpc3BsYXkuc3R5bGUuZm9udFZhcmlhbnROdW1lcmljID0gXCJ0YWJ1bGFyLW51bXNcIjtcbiAgICAgIHZhbHVlRGlzcGxheS5zdHlsZS5mb250U2l6ZSA9IFwiMTRweFwiO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLmZvbnRXZWlnaHQgPSBcIjUwMFwiO1xuICAgICAgdmFsdWVEaXNwbGF5LnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LWFjY2VudClcIjtcblxuICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSB0b2tlbkxpbWl0V3JhcHBlci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRva2VuLWxpbWl0LWRlc2NyaXB0aW9uXCIsXG4gICAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGhcbiAgICAgICAgICA/IGBNb2RlbCBtYXg6ICR7TWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1vZGVsQ29udGV4dExlbmd0aCAvIDEwMDBcbiAgICAgICAgICAgICl9SyB0b2tlbnNgXG4gICAgICAgICAgOiBcIlNldCB0byAwJSBmb3Igbm8gbGltaXRcIixcbiAgICAgIH0pO1xuICAgICAgZGVzY3JpcHRpb24uc3R5bGUuZm9udFNpemUgPSBcIjEycHhcIjtcbiAgICAgIGRlc2NyaXB0aW9uLnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW11dGVkKVwiO1xuICAgICAgZGVzY3JpcHRpb24uc3R5bGUubWFyZ2luVG9wID0gXCI0cHhcIjtcblxuICAgICAgLy8gVXBkYXRlIGRpc3BsYXkgd2hlbiBzbGlkZXIgY2hhbmdlc1xuICAgICAgdGhpcy50b2tlbkxpbWl0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSBwYXJzZUludCgoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUsIDEwKTtcbiAgICAgICAgaWYgKHBlcmNlbnRhZ2UgPT09IDApIHtcbiAgICAgICAgICB2YWx1ZURpc3BsYXkuc2V0VGV4dChcIlx1MjIxRVwiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgdG9rZW5zID0gTWF0aC5mbG9vcihcbiAgICAgICAgICAgICgocGVyY2VudGFnZSAvIDEwMCkgKiB0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoKSAvIDEwMDBcbiAgICAgICAgICApO1xuICAgICAgICAgIHZhbHVlRGlzcGxheS5zZXRUZXh0KGAke3Rva2Vuc31LYCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsdWVEaXNwbGF5LnNldFRleHQoYCR7cGVyY2VudGFnZX0lYCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIElmIFwiQ3VzdG9tXCIgaXMgYWN0aXZlLCBmaWxsIHRoZSBjdXN0b21JbnB1dCB3aXRoIHRoZSB1c2VyLXByb3ZpZGVkIHBhdGhcbiAgICBpZiAodGhpcy5hY3RpdmVQcmVzZXQgPT09IFwiQ3VzdG9tXCIgJiYgdGhpcy5vcHRpb25zLmN1c3RvbVByb21wdEZpbGVQYXRoKSB7XG4gICAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIHJlbGF0aXZlIGxpbmsgbWFya2Vyc1xuICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHRoaXMub3B0aW9ucy5jdXN0b21Qcm9tcHRGaWxlUGF0aC5yZXBsYWNlKFxuICAgICAgICAvXlxcW1xcWyguKj8pXFxdXFxdJC8sXG4gICAgICAgIFwiJDFcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmVzaXplIG9ic2VydmVyIHRvIGhhbmRsZSBkeW5hbWljIGNvbnRlbnRcbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSB0aGlzLnRleHRBcmVhLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICB9KTtcbiAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMudGV4dEFyZWEpO1xuXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVDYW5jZWw7XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiU2F2ZVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZVNhdmUgPSAoKSA9PiB7XG4gICAgICAvLyBGaW5kIHdoaWNoIHByZXNldCBpcyBhY3RpdmVcbiAgICAgIGNvbnN0IGFjdGl2ZUJ1dHRvbiA9IHRoaXMubW9kYWxFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIi5zeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi5hY3RpdmVcIlxuICAgICAgKTtcbiAgICAgIGNvbnN0IGFjdGl2ZVByZXNldExhYmVsID0gYWN0aXZlQnV0dG9uPy50ZXh0Q29udGVudCA/PyBcIlwiO1xuXG4gICAgICBsZXQgcmVzdWx0OiBTeXN0ZW1Qcm9tcHRSZXN1bHQ7XG5cbiAgICAgIGlmIChhY3RpdmVQcmVzZXRMYWJlbCA9PT0gXCJDdXN0b21cIiAmJiB0aGlzLmN1c3RvbUlucHV0LnZhbHVlKSB7XG4gICAgICAgIC8vIFJlbW92ZSAubWQgZXh0ZW5zaW9uIGFuZCBjb252ZXJ0IHRvIHJlbGF0aXZlIGxpbmsgZm9ybWF0XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmN1c3RvbUlucHV0LnZhbHVlLnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgY29udGVudDogdGhpcy50ZXh0QXJlYS52YWx1ZSxcbiAgICAgICAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBwcmVzZXQgPSB0aGlzLnN5c3RlbVByb21wdHMuZmluZChcbiAgICAgICAgICAocCkgPT4gcC5sYWJlbCA9PT0gYWN0aXZlUHJlc2V0TGFiZWxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHByZXNldC5zeXN0ZW1Qcm9tcHQsXG4gICAgICAgICAgICB0eXBlOiBwcmVzZXQuaWQgYXMgXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRmFsbGJhY2sgdG8gY3VycmVudCBjb250ZW50IGlmIG5vIHByZXNldCBmb3VuZFxuICAgICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMudGV4dEFyZWEudmFsdWUsXG4gICAgICAgICAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQWRkIHRva2VuIGxpbWl0IGlmIGluIGNoYXQtc3BlY2lmaWMgbW9kZSBhbmQgYSB2YWx1ZSBpcyBzZXRcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5vcHRpb25zLm1vZGUgPT09IFwiY2hhdC1zcGVjaWZpY1wiICYmXG4gICAgICAgIHRoaXMudG9rZW5MaW1pdElucHV0Py52YWx1ZVxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSBwYXJzZUludCh0aGlzLnRva2VuTGltaXRJbnB1dC52YWx1ZSwgMTApO1xuICAgICAgICBpZiAocGVyY2VudGFnZSA+IDApIHtcbiAgICAgICAgICAvLyBTdG9yZSB0aGUgcGVyY2VudGFnZSB2YWx1ZSBkaXJlY3RseVxuICAgICAgICAgIHJlc3VsdC50b2tlbkxpbWl0UGVyY2VudGFnZSA9IHBlcmNlbnRhZ2U7XG4gICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIG1vZGVsIGNvbnRleHQgbGVuZ3RoLCBhbHNvIGNhbGN1bGF0ZSBhbmQgc3RvcmUgdGhlIGFjdHVhbCB0b2tlbiBsaW1pdFxuICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZWxDb250ZXh0TGVuZ3RoKSB7XG4gICAgICAgICAgICByZXN1bHQudG9rZW5MaW1pdCA9IE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgIChwZXJjZW50YWdlIC8gMTAwKSAqIHRoaXMub3B0aW9ucy5tb2RlbENvbnRleHRMZW5ndGhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0O1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlU2F2ZTtcblxuICAgIC8vIEhhbmRsZSBrZXlib2FyZCBldmVudHNcbiAgICB0aGlzLm1vZGFsRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIC8vIE9ubHkgaGFuZGxlIEVudGVyIGlmIG5vdCBpbiB0ZXh0YXJlYSAod2hlcmUgd2Ugd2FudCB0byBhbGxvdyBuZXdsaW5lcylcbiAgICAgIGlmIChcbiAgICAgICAgZS5rZXkgPT09IFwiRW50ZXJcIiAmJlxuICAgICAgICAhZS5pc0NvbXBvc2luZyAmJlxuICAgICAgICAhZS5zaGlmdEtleSAmJlxuICAgICAgICBlLnRhcmdldCAhPT0gdGhpcy50ZXh0QXJlYVxuICAgICAgKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlU2F2ZSgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUNhbmNlbCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgdGhlIHRleHRhcmVhIGFuZCBwbGFjZSBjdXJzb3IgYXQgdGhlIGVuZFxuICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICB0aGlzLnRleHRBcmVhLnNldFNlbGVjdGlvblJhbmdlKFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aFxuICAgICk7XG5cbiAgICAvLyBTdGFydCBsb2FkaW5nIHByb21wdHMgYWZ0ZXIgVUkgaXMgc2V0IHVwXG4gICAgYXdhaXQgdGhpcy5sb2FkU3lzdGVtUHJvbXB0cygpO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucmVzb2x2ZVByb21pc2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dTeXN0ZW1Qcm9tcHRNb2RhbChcbiAgYXBwOiBBcHAsXG4gIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IFBhcnRpYWw8U3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zPlxuKTogUHJvbWlzZTxTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnMgPSB7XG4gICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIixcbiAgICBtb2RlOiBcImRlZmF1bHRcIixcbiAgICBtb2RlbENvbnRleHRMZW5ndGg6IHVuZGVmaW5lZCxcbiAgfTtcblxuICBjb25zdCBtb2RhbCA9IG5ldyBTeXN0ZW1Qcm9tcHRNb2RhbChhcHAsIGN1cnJlbnRQcm9tcHQsIHtcbiAgICAuLi5kZWZhdWx0T3B0aW9ucyxcbiAgICAuLi5vcHRpb25zLFxuICB9KTtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG5cbiAgaWYgKHJlc3VsdCAhPT0gbnVsbCAmJiBvcHRpb25zPy5vblNhdmUpIHtcbiAgICBhd2FpdCBvcHRpb25zLm9uU2F2ZShyZXN1bHQuY29udGVudCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuIiwgImltcG9ydCB7IEFwcCwgTWFya2Rvd25WaWV3LCBOb3RpY2UsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7XG4gIFRyYW5zY3JpcHRpb25TZXJ2aWNlLFxuICB0eXBlIFRyYW5zY3JpcHRpb25Db250ZXh0LFxufSBmcm9tIFwiLi9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBDSEFUX1ZJRVdfVFlQRSwgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vdmlld3MvQ2hhdFZpZXdcIjtcblxuLy8gRWRpdG9ySGFuZGxlciBpbnRlcmZhY2UgYW5kIGltcGxlbWVudGF0aW9uc1xuaW50ZXJmYWNlIEVkaXRvckhhbmRsZXIge1xuICBpbnNlcnRUZXh0KHRleHQ6IHN0cmluZyk6IHZvaWQ7XG59XG5cbmNsYXNzIE1hcmtkb3duRWRpdG9ySGFuZGxlciBpbXBsZW1lbnRzIEVkaXRvckhhbmRsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwcDogQXBwKSB7fVxuXG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgaWYgKCFhY3RpdmVWaWV3Py5lZGl0b3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIGFjdGl2ZSBtYXJrZG93biBlZGl0b3IgZm91bmQgZm9yIHBhc3RpbmdcIik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gYWN0aXZlIG5vdGUpXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGVkaXRvciA9IGFjdGl2ZVZpZXcuZWRpdG9yO1xuICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcbiAgICBjb25zdCBsaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKTtcblxuICAgIGNvbnN0IHRleHRUb0luc2VydCA9IHRleHRcbiAgICAgID8gY3Vyc29yLmNoID4gMCAmJiBsaW5lQ29udGVudC5sZW5ndGggPiAwXG4gICAgICAgID8gXCJcXG5cIiArIHRleHRcbiAgICAgICAgOiB0ZXh0XG4gICAgICA6IFwiXCI7XG5cbiAgICBpZiAoIXRleHRUb0luc2VydCkge1xuICAgICAgY29uc29sZS53YXJuKFwiTm8gdGV4dCB0byBpbnNlcnRcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZWRpdG9yLnJlcGxhY2VSYW5nZSh0ZXh0VG9JbnNlcnQsIGN1cnNvcik7XG4gICAgY29uc3QgbGluZXMgPSB0ZXh0VG9JbnNlcnQuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3QgbGFzdExpbmUgPSBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXSB8fCBcIlwiO1xuXG4gICAgZWRpdG9yLnNldEN1cnNvcih7XG4gICAgICBsaW5lOiBjdXJzb3IubGluZSArIGxpbmVzLmxlbmd0aCAtIDEsXG4gICAgICBjaDogbGFzdExpbmUubGVuZ3RoLFxuICAgIH0pO1xuXG4gICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIHBhc3RlZCBpbnRvIG5vdGVcIik7XG4gIH1cbn1cblxuY2xhc3MgQ2hhdEVkaXRvckhhbmRsZXIgaW1wbGVtZW50cyBFZGl0b3JIYW5kbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogKCh0ZXh0OiBzdHJpbmcpID0+IHZvaWQpIHwgdW5kZWZpbmVkXG4gICkge31cblxuICBpbnNlcnRUZXh0KHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKSB7XG4gICAgICB0aGlzLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKHRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyBjaGF0IGhhbmRsZXIgZm91bmQgZm9yIHRyYW5zY3JpcHRpb25cIik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAoY2hhdCBoYW5kbGVyIG1pc3NpbmcpXCIpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBQcmlvcml0aXplZCBNSU1FIHR5cGVzIGZvciByZWNvcmRpbmdcbmNvbnN0IFJFQ09SRElOR19GT1JNQVRTID0gW1xuICB7IG1pbWVUeXBlOiBcImF1ZGlvL3dlYm07Y29kZWNzPW9wdXNcIiwgZXh0ZW5zaW9uOiBcIndlYm1cIiwgc2FtcGxlUmF0ZTogMTYwMDAgfSwgLy8gT3B0aW1hbCBmb3Igc3BlZWNoLCBzbWFsbCBzaXplXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vd2VibVwiLCBleHRlbnNpb246IFwid2VibVwiLCBzYW1wbGVSYXRlOiA0ODAwMCB9LCAvLyBGYWxsYmFjayB3aXRoIGRlZmF1bHQgY29kZWNcbiAgeyBtaW1lVHlwZTogXCJhdWRpby9vZ2c7Y29kZWNzPW9wdXNcIiwgZXh0ZW5zaW9uOiBcIm9nZ1wiLCBzYW1wbGVSYXRlOiA0ODAwMCB9LCAvLyBBbHRlcm5hdGl2ZSBPcHVzIGNvbnRhaW5lclxuICB7IG1pbWVUeXBlOiBcImF1ZGlvL3dhdlwiLCBleHRlbnNpb246IFwid2F2XCIsIHNhbXBsZVJhdGU6IDQ4MDAwIH0sIC8vIExhc3QgcmVzb3J0IGZhbGxiYWNrXG5dIGFzIGNvbnN0O1xuXG5pbnRlcmZhY2UgQXVkaW9DaHVuayB7XG4gIGJsb2I6IEJsb2I7XG4gIHNhbXBsZVJhdGU6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFJlY29yZGVyT3B0aW9ucyB7XG4gIGlzSW5DaGF0PzogYm9vbGVhbjtcbiAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU/OiAodGV4dDogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgUmVjb3JkaW5nQ29udGV4dCB7XG4gIGlzSW5DaGF0OiBib29sZWFuO1xuICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZT86ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBSZWNvcmRlclNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUmVjb3JkZXJTZXJ2aWNlO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIGlzUmVjb3JkaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgb25Ub2dnbGVDYWxsYmFja3M6IFNldDwoaXNSZWNvcmRpbmc6IGJvb2xlYW4pID0+IHZvaWQ+ID0gbmV3IFNldCgpO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIG1lZGlhU3RyZWFtOiBNZWRpYVN0cmVhbSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIG1lZGlhUmVjb3JkZXI6IE1lZGlhUmVjb3JkZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBjaHVua3M6IEF1ZGlvQ2h1bmtbXSA9IFtdO1xuICBwcml2YXRlIHNlbGVjdGVkRm9ybWF0OiAodHlwZW9mIFJFQ09SRElOR19GT1JNQVRTKVtudW1iZXJdIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbGFzdFJlY29yZGVkRmlsZVBhdGg6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGF1ZGlvQ29udGV4dDogQXVkaW9Db250ZXh0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYW5hbHlzZXI6IEFuYWx5c2VyTm9kZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGFuaW1hdGlvbkZyYW1lOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzbW9vdGhlZFZhbHVlczogRmxvYXQzMkFycmF5O1xuICBwcml2YXRlIHJlYWRvbmx5IHNtb290aGluZ0ZhY3RvciA9IDAuNDtcbiAgcHJpdmF0ZSB2aXN1YWxpemVyQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGN1cnJlbnRDb250ZXh0OiBSZWNvcmRpbmdDb250ZXh0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVjb3JkaW5nTW9kYWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZHJhZ0NsZWFudXA6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGVkaXRvckhhbmRsZXI6IEVkaXRvckhhbmRsZXIgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICAgIG9wdGlvbnM6IFJlY29yZGVyT3B0aW9ucyA9IHt9XG4gICkge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc21vb3RoZWRWYWx1ZXMgPSBuZXcgRmxvYXQzMkFycmF5KDEyOCk7XG4gICAgdGhpcy51cGRhdGVDb250ZXh0KG9wdGlvbnMpO1xuICAgIGNvbnNvbGUubG9nKFwiUmVjb3JkZXJTZXJ2aWNlIGluaXRpYWxpemVkXCIpO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIGFwcDogQXBwLFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICAgIG9wdGlvbnM6IFJlY29yZGVyT3B0aW9ucyA9IHt9XG4gICk6IFJlY29yZGVyU2VydmljZSB7XG4gICAgaWYgKCFSZWNvcmRlclNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgbmV3IFJlY29yZGVyU2VydmljZSBpbnN0YW5jZVwiKTtcbiAgICAgIFJlY29yZGVyU2VydmljZS5pbnN0YW5jZSA9IG5ldyBSZWNvcmRlclNlcnZpY2UoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyB1cGRhdGUgY29udGV4dCB3aGVuIGdldEluc3RhbmNlIGlzIGNhbGxlZFxuICAgIFJlY29yZGVyU2VydmljZS5pbnN0YW5jZS51cGRhdGVDb250ZXh0KG9wdGlvbnMpO1xuICAgIHJldHVybiBSZWNvcmRlclNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGdldEFjdGl2ZVZpZXdJbmZvKCk6IHsgaXNDaGF0OiBib29sZWFuOyB2aWV3SWRlbnRpZmllcjogc3RyaW5nIH0ge1xuICAgIGNvbnN0IGFjdGl2ZUxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZjtcbiAgICBpZiAoIWFjdGl2ZUxlYWYpIHtcbiAgICAgIHJldHVybiB7IGlzQ2hhdDogZmFsc2UsIHZpZXdJZGVudGlmaWVyOiBcInVua25vd25cIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IHZpZXdTdGF0ZSA9IGFjdGl2ZUxlYWYuZ2V0Vmlld1N0YXRlKCk7XG4gICAgY29uc3Qgdmlld1R5cGUgPSB2aWV3U3RhdGUudHlwZTtcblxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSBjaGF0IHZpZXdcbiAgICBpZiAodmlld1R5cGUgPT09IENIQVRfVklFV19UWVBFKSB7XG4gICAgICByZXR1cm4geyBpc0NoYXQ6IHRydWUsIHZpZXdJZGVudGlmaWVyOiBcImNoYXRcIiB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSBtYXJrZG93biB2aWV3XG4gICAgY29uc3QgbWFya2Rvd25WaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICBpZiAobWFya2Rvd25WaWV3Py5maWxlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0NoYXQ6IGZhbHNlLFxuICAgICAgICB2aWV3SWRlbnRpZmllcjogYG5vdGUtJHttYXJrZG93blZpZXcuZmlsZS5wYXRofWAsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IGlzQ2hhdDogZmFsc2UsIHZpZXdJZGVudGlmaWVyOiBcInVua25vd25cIiB9O1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDb250ZXh0KG9wdGlvbnM6IFJlY29yZGVyT3B0aW9ucykge1xuICAgIGNvbnN0IHsgaXNDaGF0IH0gPSB0aGlzLmdldEFjdGl2ZVZpZXdJbmZvKCk7XG4gICAgdGhpcy5jdXJyZW50Q29udGV4dCA9IHtcbiAgICAgIGlzSW5DaGF0OiBpc0NoYXQsXG4gICAgICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogb3B0aW9ucy5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnRUZXh0SW50b0FjdGl2ZVZpZXcodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgeyBpc0NoYXQgfSA9IHRoaXMuZ2V0QWN0aXZlVmlld0luZm8oKTtcblxuICAgIGlmIChpc0NoYXQpIHtcbiAgICAgIGNvbnN0IGNoYXRWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoQ2hhdFZpZXcpO1xuICAgICAgaWYgKGNoYXRWaWV3KSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gY2hhdFZpZXcuY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBcIi5zeXN0ZW1zY3VscHQtY2hhdC1pbnB1dFwiXG4gICAgICAgICkgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgY29uc3QgY3Vyc29yUG9zID0gaW5wdXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gaW5wdXQudmFsdWU7XG5cbiAgICAgICAgICBpZiAoY3Vyc29yUG9zICE9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBJbnNlcnQgYXQgY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9XG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZS5zbGljZSgwLCBjdXJzb3JQb3MpICtcbiAgICAgICAgICAgICAgdGV4dCArXG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZS5zbGljZShjdXJzb3JQb3MpO1xuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIC8vIE1vdmUgY3Vyc29yIHRvIGVuZCBvZiBpbnNlcnRlZCB0ZXh0XG4gICAgICAgICAgICBpbnB1dC5zZWxlY3Rpb25TdGFydCA9IGlucHV0LnNlbGVjdGlvbkVuZCA9IGN1cnNvclBvcyArIHRleHQubGVuZ3RoO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBBcHBlbmQgdG8gZW5kIGlmIG5vIGN1cnNvciBwb3NpdGlvblxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsdWUgKyB0ZXh0O1xuICAgICAgICAgICAgaW5wdXQuc2VsZWN0aW9uU3RhcnQgPSBpbnB1dC5zZWxlY3Rpb25FbmQgPSBpbnB1dC52YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVHJpZ2dlciBpbnB1dCBldmVudCBmb3IgaGVpZ2h0IGFkanVzdG1lbnQgYW5kIHRva2VuIGNvdW50aW5nXG4gICAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiKSk7XG4gICAgICAgICAgLy8gRm9jdXMgdGhlIGlucHV0IGFmdGVyIGluc2VydGlvblxuICAgICAgICAgIGlucHV0LmZvY3VzKCk7XG5cbiAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gcGFzdGVkIGludG8gY2hhdFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXCJDaGF0IGlucHV0IGVsZW1lbnQgbm90IGZvdW5kXCIpO1xuICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChubyBjaGF0IGlucHV0KVwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiTm8gYWN0aXZlIGNoYXQgdmlldyBmb3VuZFwiKTtcbiAgICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKG5vIGFjdGl2ZSBjaGF0KVwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbWFya2Rvd25WaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgIGlmICghbWFya2Rvd25WaWV3Py5lZGl0b3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiTm8gYWN0aXZlIG1hcmtkb3duIGVkaXRvciBmb3VuZFwiKTtcbiAgICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKG5vIGFjdGl2ZSBub3RlKVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBlZGl0b3IgPSBtYXJrZG93blZpZXcuZWRpdG9yO1xuICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgY29uc3QgbGluZUNvbnRlbnQgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSk7XG4gICAgICBjb25zdCB0ZXh0VG9JbnNlcnQgPSB0ZXh0XG4gICAgICAgID8gY3Vyc29yLmNoID4gMCAmJiBsaW5lQ29udGVudC5sZW5ndGggPiAwXG4gICAgICAgICAgPyBcIlxcblwiICsgdGV4dFxuICAgICAgICAgIDogdGV4dFxuICAgICAgICA6IFwiXCI7XG5cbiAgICAgIGlmICghdGV4dFRvSW5zZXJ0KSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIk5vIHRleHQgdG8gaW5zZXJ0XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UodGV4dFRvSW5zZXJ0LCBjdXJzb3IpO1xuICAgICAgY29uc3QgbGluZXMgPSB0ZXh0VG9JbnNlcnQuc3BsaXQoXCJcXG5cIik7XG4gICAgICBjb25zdCBsYXN0TGluZSA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdIHx8IFwiXCI7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yKHtcbiAgICAgICAgbGluZTogY3Vyc29yLmxpbmUgKyBsaW5lcy5sZW5ndGggLSAxLFxuICAgICAgICBjaDogbGFzdExpbmUubGVuZ3RoLFxuICAgICAgfSk7XG5cbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBwYXN0ZWQgaW50byBub3RlXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdHJhbnNjcmliZUxhc3RSZWNvcmRpbmcoKSB7XG4gICAgaWYgKCF0aGlzLmxhc3RSZWNvcmRlZEZpbGVQYXRoKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoXG4gICAgICAgIHRoaXMubGFzdFJlY29yZGVkRmlsZVBhdGhcbiAgICAgICk7XG4gICAgICBpZiAoIWZpbGUgfHwgIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsKHRoaXMuYXBwLCB7XG4gICAgICAgIGZpbGUsXG4gICAgICAgIGlzQ2hhdDogdGhpcy5jdXJyZW50Q29udGV4dD8uaXNJbkNoYXQgPz8gZmFsc2UsXG4gICAgICAgIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiAodGV4dDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbnRleHQ/Lm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDb250ZXh0Lm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKHRleHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydFRleHRJbnRvQWN0aXZlVmlldyh0ZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBsdWdpbjogdGhpcy5wbHVnaW4sXG4gICAgICB9KTtcbiAgICAgIG1vZGFsLm9wZW4oKTtcblxuICAgICAgLy8gQ2xlYW4gdXAgdGhlIHJlY29yZGluZyBmaWxlXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZGVsZXRlKGZpbGUpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGNsZWFuIHVwIHJlY29yZGluZyBmaWxlOlwiLCBlcnJvcik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRvLXRyYW5zY3JpcHRpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byB0cmFuc2NyaWJlIGF1ZGlvXCIpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZWNvcmRpbmdNb2RhbCgpOiB2b2lkIHtcbiAgICAvLyBDbGVhbnVwIGFueSBvbGQgaW5zdGFuY2VcbiAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgaWYgKHRoaXMuZHJhZ0NsZWFudXApIHtcbiAgICAgICAgdGhpcy5kcmFnQ2xlYW51cCgpO1xuICAgICAgICB0aGlzLmRyYWdDbGVhbnVwID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwucmVtb3ZlKCk7XG4gICAgICB0aGlzLnJlY29yZGluZ01vZGFsID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGhlIG5ldyBmbG9hdGluZyBtb2RhbFxuICAgIHRoaXMucmVjb3JkaW5nTW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtcmVjb3JkZXItbW9kYWxcIjtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnRlbnQuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtcmVjb3JkZXItY29udGVudFwiO1xuXG4gICAgY29uc3QgbGl2ZUluZGljYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbGl2ZUluZGljYXRvci5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1saXZlXCI7XG4gICAgbGl2ZUluZGljYXRvci50ZXh0Q29udGVudCA9IFwiXHUyNUNGIExpdmVcIjtcbiAgICBjb250ZW50LmFwcGVuZENoaWxkKGxpdmVJbmRpY2F0b3IpO1xuXG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtcmVjb3JkZXItY2FudmFzXCI7XG4gICAgY29udGVudC5hcHBlbmRDaGlsZChjYW52YXMpO1xuXG4gICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5hcHBlbmRDaGlsZChjb250ZW50KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMucmVjb3JkaW5nTW9kYWwpO1xuXG4gICAgdGhpcy5kcmFnQ2xlYW51cCA9IHRoaXMuc2V0dXBEcmFnZ2FibGUodGhpcy5yZWNvcmRpbmdNb2RhbCk7XG4gICAgdGhpcy5zZXRWaXN1YWxpemVyQ2FudmFzKGNhbnZhcyk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwRHJhZ2dhYmxlKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogKCkgPT4gdm9pZCB7XG4gICAgLy8gVHJhY2sgcG9zaXRpb24gc3RhdGVcbiAgICBsZXQgcG9zID0geyB4OiAwLCB5OiAwIH07XG5cbiAgICAvLyBDbGVhbiBldmVudCBoYW5kbGluZ1xuICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkcmFnZ2luZ1wiKTtcbiAgICB9O1xuXG4gICAgLy8gU2ltcGxlIG1vdmUgaGFuZGxlciB3aXRoIGJvdW5kcyBjaGVja2luZ1xuICAgIGNvbnN0IG9uTW92ZSA9IChjbGllbnRYOiBudW1iZXIsIGNsaWVudFk6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBwb3MueCA9IE1hdGgubWluKFxuICAgICAgICBNYXRoLm1heCgwLCBjbGllbnRYIC0gcmVjdC53aWR0aCAvIDIpLFxuICAgICAgICB3aW5kb3cuaW5uZXJXaWR0aCAtIHJlY3Qud2lkdGhcbiAgICAgICk7XG4gICAgICBwb3MueSA9IE1hdGgubWluKFxuICAgICAgICBNYXRoLm1heCgwLCBjbGllbnRZIC0gcmVjdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgd2luZG93LmlubmVySGVpZ2h0IC0gcmVjdC5oZWlnaHRcbiAgICAgICk7XG5cbiAgICAgIC8vIFJlbW92ZSBib3R0b20vcmlnaHQgcG9zaXRpb25pbmcgd2hlbiBkcmFnZ2luZyBzdGFydHNcbiAgICAgIGVsZW1lbnQuc3R5bGUuYm90dG9tID0gXCJcIjtcbiAgICAgIGVsZW1lbnQuc3R5bGUucmlnaHQgPSBcIlwiO1xuXG4gICAgICAvLyBBcHBseSBuZXcgcG9zaXRpb25cbiAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3Bvcy54fXB4YDtcbiAgICAgIGVsZW1lbnQuc3R5bGUudG9wID0gYCR7cG9zLnl9cHhgO1xuICAgIH07XG5cbiAgICAvLyBQb2ludGVyIGV2ZW50IGhhbmRsZXJzXG4gICAgY29uc3Qgb25Qb2ludGVyRG93biA9IChlOiBQb2ludGVyRXZlbnQpID0+IHtcbiAgICAgIC8vIE9ubHkgaGFuZGxlIGxlZnQgY2xpY2sgb3IgdG91Y2hcbiAgICAgIGlmIChlLmJ1dHRvbiAhPT0gMCAmJiBlLmJ1dHRvbiAhPT0gLTEpIHJldHVybjtcblxuICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHJhZ2dpbmdcIik7XG4gICAgICBlbGVtZW50LnNldFBvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKTtcblxuICAgICAgLy8gU2V0IGluaXRpYWwgcG9zaXRpb24gYmFzZWQgb24gY3VycmVudCBsb2NhdGlvblxuICAgICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBwb3MueCA9IHJlY3QubGVmdDtcbiAgICAgIHBvcy55ID0gcmVjdC50b3A7XG5cbiAgICAgIC8vIEluaXRpYWwgbW92ZSB0byBwcmV2ZW50IGp1bXBzXG4gICAgICBvbk1vdmUoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgIH07XG5cbiAgICBjb25zdCBvblBvaW50ZXJNb3ZlID0gKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xuICAgICAgaWYgKGVsZW1lbnQuaGFzUG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpKSB7XG4gICAgICAgIG9uTW92ZShlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IG9uUG9pbnRlclVwID0gKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xuICAgICAgY2xlYW51cCgpO1xuICAgICAgZWxlbWVudC5yZWxlYXNlUG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpO1xuICAgIH07XG5cbiAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmRvd25cIiwgb25Qb2ludGVyRG93bik7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgb25Qb2ludGVyTW92ZSk7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIG9uUG9pbnRlclVwKTtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsIGNsZWFudXApO1xuXG4gICAgLy8gQ2xlYW51cCBmdW5jdGlvbiBmb3IgcmVtb3ZpbmcgbGlzdGVuZXJzXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIG9uUG9pbnRlckRvd24pO1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgb25Qb2ludGVyTW92ZSk7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIiwgb25Qb2ludGVyVXApO1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcmNhbmNlbFwiLCBjbGVhbnVwKTtcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgdG9nZ2xlUmVjb3JkaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRoaXMuaXNSZWNvcmRpbmcpIHtcbiAgICAgICAgY29uc3QgeyBpc0NoYXQsIHZpZXdJZGVudGlmaWVyIH0gPSB0aGlzLmdldEFjdGl2ZVZpZXdJbmZvKCk7XG5cbiAgICAgICAgaWYgKHZpZXdJZGVudGlmaWVyID09PSBcInVua25vd25cIikge1xuICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI2QTBcdUZFMEYgUGxlYXNlIG9wZW4gYSBub3RlIG9yIGNoYXQgYmVmb3JlIHJlY29yZGluZ1wiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0aW5nIHJlY29yZGluZyBpbiB2aWV3OlwiLCB7XG4gICAgICAgICAgaXNDaGF0LFxuICAgICAgICAgIHZpZXdJZGVudGlmaWVyLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgY29udGV4dCB3aXRoIGN1cnJlbnQgdmlldyBpbmZvXG4gICAgICAgIHRoaXMudXBkYXRlQ29udGV4dCh7XG4gICAgICAgICAgaXNJbkNoYXQ6IGlzQ2hhdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWx3YXlzIGNyZWF0ZSB0aGUgZHJhZ2dhYmxlIG1vZGFsXG4gICAgICAgIHRoaXMuY3JlYXRlUmVjb3JkaW5nTW9kYWwoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNSZWNvcmRpbmcpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zdG9wUmVjb3JkaW5nKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucmVjb3JkaW5nTW9kYWwpIHtcbiAgICAgICAgICBpZiAodGhpcy5kcmFnQ2xlYW51cCkge1xuICAgICAgICAgICAgdGhpcy5kcmFnQ2xlYW51cCgpO1xuICAgICAgICAgICAgdGhpcy5kcmFnQ2xlYW51cCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwucmVtb3ZlKCk7XG4gICAgICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc3RhcnRSZWNvcmRpbmcoKTtcbiAgICAgICAgaWYgKHRoaXMucmVjb3JkaW5nTW9kYWwpIHtcbiAgICAgICAgICB0aGlzLnJlY29yZGluZ01vZGFsLmNsYXNzTGlzdC5hZGQoXCJyZWNvcmRpbmdcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHRvZ2dsaW5nIHJlY29yZGluZzpcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gdG9nZ2xlIHJlY29yZGluZ1wiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuc3VyZVJlY29yZGluZ0RpcmVjdG9yeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBkaXIgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWNvcmRpbmdzRGlyZWN0b3J5O1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuYWRhcHRlci5ta2RpcihkaXIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiO1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgcmVjb3JkaW5ncyBkaXJlY3Rvcnk6XCIsIGVycm9yTWVzc2FnZSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgcmVjb3JkaW5ncyBkaXJlY3Rvcnk6ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0U3VwcG9ydGVkRm9ybWF0KCk6IFByb21pc2U8XG4gICAgKHR5cGVvZiBSRUNPUkRJTkdfRk9STUFUUylbbnVtYmVyXVxuICA+IHtcbiAgICBmb3IgKGNvbnN0IGZvcm1hdCBvZiBSRUNPUkRJTkdfRk9STUFUUykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKE1lZGlhUmVjb3JkZXIuaXNUeXBlU3VwcG9ydGVkKGZvcm1hdC5taW1lVHlwZSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgU2VsZWN0ZWQgcmVjb3JkaW5nIGZvcm1hdDogJHtmb3JtYXQubWltZVR5cGV9YCk7XG4gICAgICAgICAgcmV0dXJuIGZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBGb3JtYXQgJHtmb3JtYXQubWltZVR5cGV9IGNoZWNrIGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHN1cHBvcnRlZCBhdWRpbyByZWNvcmRpbmcgZm9ybWF0IGZvdW5kXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUZpbGVOYW1lKCk6IHN0cmluZyB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBub3dcbiAgICAgIC50b0lTT1N0cmluZygpXG4gICAgICAucmVwbGFjZSgvWzouXS9nLCBcIi1cIilcbiAgICAgIC5yZXBsYWNlKFwiVFwiLCBcIl9cIilcbiAgICAgIC5zcGxpdChcIi5cIilbMF07XG4gICAgcmV0dXJuIGAke3RpbWVzdGFtcH0uJHt0aGlzLnNlbGVjdGVkRm9ybWF0Py5leHRlbnNpb24gfHwgXCJhdWRpb1wifWA7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0VmlzdWFsaXphdGlvblN0YXRlKCk6IHZvaWQge1xuICAgIC8vIFJlc2V0IHNtb290aGVkIHZhbHVlc1xuICAgIHRoaXMuc21vb3RoZWRWYWx1ZXMgPSBuZXcgRmxvYXQzMkFycmF5KDEyOCk7XG5cbiAgICAvLyBDYW5jZWwgYW55IG9uZ29pbmcgYW5pbWF0aW9uXG4gICAgaWYgKHRoaXMuYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0aW9uRnJhbWUpO1xuICAgICAgdGhpcy5hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gUHJvcGVybHkgZGlzY29ubmVjdCBhbmQgbnVsbCBvdXQgYW5hbHl6ZXJcbiAgICBpZiAodGhpcy5hbmFseXNlcikge1xuICAgICAgdGhpcy5hbmFseXNlci5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLmFuYWx5c2VyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDbG9zZSBhbmQgbnVsbCBvdXQgYXVkaW8gY29udGV4dFxuICAgIGlmICh0aGlzLmF1ZGlvQ29udGV4dCkge1xuICAgICAgdGhpcy5hdWRpb0NvbnRleHQuY2xvc2UoKTtcbiAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBjYW52YXMgaWYgaXQgZXhpc3RzXG4gICAgaWYgKHRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGlmIChjdHgpIHtcbiAgICAgICAgY3R4LmNsZWFyUmVjdChcbiAgICAgICAgICAwLFxuICAgICAgICAgIDAsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoLFxuICAgICAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy5oZWlnaHRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldHVwVmlzdWFsaXphdGlvbigpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMubWVkaWFTdHJlYW0pIHJldHVybjtcblxuICAgIC8vIENyZWF0ZSBuZXcgYXVkaW8gY29udGV4dFxuICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCh7XG4gICAgICBzYW1wbGVSYXRlOiAxNjAwMCxcbiAgICAgIGxhdGVuY3lIaW50OiBcImludGVyYWN0aXZlXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgYW5kIGNvbm5lY3QgbWVkaWEgc3RyZWFtIHNvdXJjZVxuICAgIGNvbnN0IHNvdXJjZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKHRoaXMubWVkaWFTdHJlYW0pO1xuXG4gICAgLy8gQ3JlYXRlIGFuZCBjb25maWd1cmUgYW5hbHl6ZXJcbiAgICB0aGlzLmFuYWx5c2VyID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTtcbiAgICB0aGlzLmFuYWx5c2VyLmZmdFNpemUgPSAyNTY7XG4gICAgdGhpcy5hbmFseXNlci5zbW9vdGhpbmdUaW1lQ29uc3RhbnQgPSAwLjc7XG5cbiAgICAvLyBDb25uZWN0IHNvdXJjZSB0byBhbmFseXplclxuICAgIHNvdXJjZS5jb25uZWN0KHRoaXMuYW5hbHlzZXIpO1xuXG4gICAgLy8gU3RhcnQgdmlzdWFsaXphdGlvbiBpZiBjYW52YXMgZXhpc3RzXG4gICAgaWYgKHRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgdGhpcy51cGRhdGVDYW52YXNTaXplKCk7XG4gICAgICB0aGlzLmRyYXcoKTtcbiAgICB9XG4gIH1cblxuICBzZXRWaXN1YWxpemVyQ2FudmFzKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgfCBudWxsKTogdm9pZCB7XG4gICAgLy8gQ2xlYW4gdXAgb2xkIGNhbnZhc1xuICAgIGlmICh0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgIGNvbnN0IGN0eCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBpZiAoY3R4KSB7XG4gICAgICAgIGN0eC5jbGVhclJlY3QoXG4gICAgICAgICAgMCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy53aWR0aCxcbiAgICAgICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuaGVpZ2h0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgc3RhdGUgaWYgcmVtb3ZpbmcgY2FudmFzXG4gICAgaWYgKCFjYW52YXMpIHtcbiAgICAgIHRoaXMucmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMgPSBjYW52YXM7XG5cbiAgICAvLyBJbml0aWFsaXplIG5ldyBjYW52YXMgaWYgcmVjb3JkaW5nXG4gICAgaWYgKGNhbnZhcyAmJiB0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNhbnZhc1NpemUoKTtcbiAgICAgIC8vIFJlaW5pdGlhbGl6ZSB2aXN1YWxpemF0aW9uIGlmIG5lZWRlZFxuICAgICAgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCB8fCAhdGhpcy5hbmFseXNlcikge1xuICAgICAgICB0aGlzLnNldHVwVmlzdWFsaXphdGlvbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDYW52YXNTaXplKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy52aXN1YWxpemVyQ2FudmFzKSByZXR1cm47XG5cbiAgICBjb25zdCByZWN0ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG5cbiAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMud2lkdGggPSByZWN0LndpZHRoICogZHByO1xuICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy5oZWlnaHQgPSByZWN0LmhlaWdodCAqIGRwcjtcblxuICAgIGNvbnN0IGN0eCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgaWYgKGN0eCkge1xuICAgICAgY3R4LnNjYWxlKGRwciwgZHByKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHN0YXJ0UmVjb3JkaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmlzUmVjb3JkaW5nKSByZXR1cm47XG5cbiAgICAvLyBSZXNldCBhbGwgdmlzdWFsaXphdGlvbiBzdGF0ZSBiZWZvcmUgc3RhcnRpbmdcbiAgICB0aGlzLnJlc2V0VmlzdWFsaXphdGlvblN0YXRlKCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVSZWNvcmRpbmdEaXJlY3RvcnkoKTtcblxuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgd2UgaGF2ZSBwZXJtaXNzaW9uXG4gICAgICBjb25zdCBwZXJtaXNzaW9uUmVzdWx0ID0gYXdhaXQgbmF2aWdhdG9yLnBlcm1pc3Npb25zLnF1ZXJ5KHtcbiAgICAgICAgbmFtZTogXCJtaWNyb3Bob25lXCIgYXMgUGVybWlzc2lvbk5hbWUsXG4gICAgICB9KTtcblxuICAgICAgaWYgKHBlcm1pc3Npb25SZXN1bHQuc3RhdGUgPT09IFwiZGVuaWVkXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWljcm9waG9uZSBwZXJtaXNzaW9uIGRlbmllZFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gRGV0ZWN0IHN1cHBvcnRlZCBmb3JtYXQgYmVmb3JlIHN0YXJ0aW5nXG4gICAgICB0aGlzLnNlbGVjdGVkRm9ybWF0ID0gYXdhaXQgdGhpcy5kZXRlY3RTdXBwb3J0ZWRGb3JtYXQoKTtcblxuICAgICAgY29uc3QgYXVkaW9Db25zdHJhaW50czogTWVkaWFUcmFja0NvbnN0cmFpbnRzID0ge1xuICAgICAgICBlY2hvQ2FuY2VsbGF0aW9uOiB0cnVlLFxuICAgICAgICBub2lzZVN1cHByZXNzaW9uOiB0cnVlLFxuICAgICAgICBzYW1wbGVSYXRlOiAxNjAwMCxcbiAgICAgICAgY2hhbm5lbENvdW50OiAxLCAvLyBNb25vIGZvciBzcGVlY2hcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBkZXZpY2VzID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCk7XG4gICAgICAgICAgY29uc3QgcHJlZmVycmVkRGV2aWNlID0gZGV2aWNlcy5maW5kKFxuICAgICAgICAgICAgKGRldmljZSkgPT5cbiAgICAgICAgICAgICAgZGV2aWNlLmtpbmQgPT09IFwiYXVkaW9pbnB1dFwiICYmXG4gICAgICAgICAgICAgIGRldmljZS5kZXZpY2VJZCA9PT0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlZmVycmVkTWljcm9waG9uZUlkXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChwcmVmZXJyZWREZXZpY2UpIHtcbiAgICAgICAgICAgIGF1ZGlvQ29uc3RyYWludHMuZGV2aWNlSWQgPSB7XG4gICAgICAgICAgICAgIGV4YWN0OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQgPSBcIlwiO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgXCJQcmVmZXJyZWQgbWljcm9waG9uZSBub3QgZm91bmQsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0XCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBtaWNyb3Bob25lIGRldmljZXM6XCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSZXF1ZXN0IG1lZGlhIHN0cmVhbVxuICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgYXVkaW86IGF1ZGlvQ29uc3RyYWludHMsXG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIG1lZGlhIHJlY29yZGVyXG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcih0aGlzLm1lZGlhU3RyZWFtLCB7XG4gICAgICAgIG1pbWVUeXBlOiB0aGlzLnNlbGVjdGVkRm9ybWF0Lm1pbWVUeXBlLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCB1cCBkYXRhIGhhbmRsaW5nXG4gICAgICB0aGlzLmNodW5rcyA9IFtdO1xuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLm9uZGF0YWF2YWlsYWJsZSA9IGFzeW5jIChlOiBCbG9iRXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGUuZGF0YS5zaXplID4gMCkge1xuICAgICAgICAgIHRoaXMuY2h1bmtzLnB1c2goe1xuICAgICAgICAgICAgYmxvYjogZS5kYXRhLFxuICAgICAgICAgICAgc2FtcGxlUmF0ZTogdGhpcy5zZWxlY3RlZEZvcm1hdD8uc2FtcGxlUmF0ZSA/PyA0ODAwMCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gSGFuZGxlIHJlY29yZGluZyBzdG9wXG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIub25zdG9wID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFNhdmUgdGhlIHJlY29yZGluZ1xuICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5nZW5lcmF0ZUZpbGVOYW1lKCk7XG4gICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWNvcmRpbmdzRGlyZWN0b3J5fS8ke2ZpbGVOYW1lfWA7XG5cbiAgICAgICAgICAvLyBDb21iaW5lIGFsbCBjaHVua3MgaW50byBhIHNpbmdsZSBibG9iXG4gICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFxuICAgICAgICAgICAgdGhpcy5jaHVua3MubWFwKChjaHVuaykgPT4gY2h1bmsuYmxvYiksXG4gICAgICAgICAgICB7IHR5cGU6IHRoaXMuc2VsZWN0ZWRGb3JtYXQ/Lm1pbWVUeXBlIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQ29udmVydCBibG9iIHRvIGFycmF5IGJ1ZmZlclxuICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpO1xuXG4gICAgICAgICAgLy8gU2F2ZSB0byBmaWxlXG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmFkYXB0ZXIud3JpdGVCaW5hcnkoXG4gICAgICAgICAgICBmaWxlUGF0aCxcbiAgICAgICAgICAgIGFycmF5QnVmZmVyXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIFN0b3JlIHRoZSBwYXRoIGZvciB0cmFuc2NyaXB0aW9uXG4gICAgICAgICAgdGhpcy5sYXN0UmVjb3JkZWRGaWxlUGF0aCA9IGZpbGVQYXRoO1xuXG4gICAgICAgICAgLy8gU3RhcnQgdHJhbnNjcmlwdGlvblxuICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNjcmliZUxhc3RSZWNvcmRpbmcoKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgcmVjb3JkaW5nOlwiLCBlcnJvcik7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gc2F2ZSByZWNvcmRpbmdcIik7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIFN0YXJ0IHJlY29yZGluZyB3aXRoIGEgc21hbGxlciB0aW1lc2xpY2UgZm9yIG1vcmUgZnJlcXVlbnQgb25kYXRhYXZhaWxhYmxlIGV2ZW50c1xuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXJ0KDEwMDApO1xuXG4gICAgICAvLyBTZXQgdXAgdmlzdWFsaXphdGlvbiBjaGFpblxuICAgICAgdGhpcy5zZXR1cFZpc3VhbGl6YXRpb24oKTtcblxuICAgICAgdGhpcy5pc1JlY29yZGluZyA9IHRydWU7XG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpO1xuXG4gICAgICAvLyBTdGFydCB2aXN1YWxpemF0aW9uIGltbWVkaWF0ZWx5XG4gICAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiUmVjb3JkaW5nIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiUmVjb3JkaW5nIGZhaWxlZFwiO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdG9wUmVjb3JkaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc1JlY29yZGluZykgcmV0dXJuO1xuXG4gICAgLy8gU3RvcCBtZWRpYSByZWNvcmRlciBmaXJzdFxuICAgIGlmICh0aGlzLm1lZGlhUmVjb3JkZXIgJiYgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlICE9PSBcImluYWN0aXZlXCIpIHtcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5zdG9wKCk7XG4gICAgfVxuXG4gICAgLy8gU3RvcCBhbGwgbWVkaWEgdHJhY2tzXG4gICAgaWYgKHRoaXMubWVkaWFTdHJlYW0pIHtcbiAgICAgIHRoaXMubWVkaWFTdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCgodHJhY2spID0+IHRyYWNrLnN0b3AoKSk7XG4gICAgICB0aGlzLm1lZGlhU3RyZWFtID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBSZXNldCBhbGwgdmlzdWFsaXphdGlvbiBzdGF0ZVxuICAgIHRoaXMucmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTtcblxuICAgIC8vIFJlbW92ZSByZWNvcmRpbmcgY2xhc3MgZnJvbSBtb2RhbFxuICAgIGlmICh0aGlzLnJlY29yZGluZ01vZGFsKSB7XG4gICAgICB0aGlzLnJlY29yZGluZ01vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJyZWNvcmRpbmdcIik7XG4gICAgfVxuXG4gICAgdGhpcy5tZWRpYVJlY29yZGVyID0gbnVsbDtcbiAgICB0aGlzLmlzUmVjb3JkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgZHJhdyA9ICgpID0+IHtcbiAgICBpZiAoIXRoaXMuaXNSZWNvcmRpbmcgfHwgIXRoaXMuYW5hbHlzZXIgfHwgIXRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25GcmFtZSk7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFueSBleGlzdGluZyBhbmltYXRpb24gZnJhbWUgYmVmb3JlIHN0YXJ0aW5nIG5ldyBvbmVcbiAgICBpZiAodGhpcy5hbmltYXRpb25GcmFtZSkge1xuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25GcmFtZSk7XG4gICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50O1xuICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlckxlbmd0aCk7XG4gICAgdGhpcy5hbmFseXNlci5nZXRCeXRlRnJlcXVlbmN5RGF0YShkYXRhQXJyYXkpO1xuXG4gICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBpZiAoIWN0eCkgcmV0dXJuO1xuXG4gICAgLy8gQ2xlYXIgdGhlIGNhbnZhcyBiZWZvcmUgZHJhd2luZ1xuICAgIGN0eC5jbGVhclJlY3QoXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy53aWR0aCxcbiAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy5oZWlnaHRcbiAgICApO1xuXG4gICAgY29uc3QgcmVjdCA9IHRoaXMudmlzdWFsaXplckNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB3aWR0aCA9IHJlY3Qud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG4gICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7XG4gICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjtcblxuICAgIC8vIENhbGN1bGF0ZSByZXNwb25zaXZlIHZhbHVlcyBiYXNlZCBvbiBzY3JlZW4gd2lkdGhcbiAgICBjb25zdCBpc01vYmlsZSA9IHdpZHRoIDw9IDQwMDtcbiAgICBjb25zdCBvdmVybGFwID0gaXNNb2JpbGUgPyAzIDogNTsgLy8gUmVkdWNlZCBvdmVybGFwIHBvaW50cyBmb3IgbW9iaWxlXG4gICAgY29uc3QgY2VudGVyT3ZlcmxhcFNjYWxlID0gaXNNb2JpbGUgPyA0IDogODsgLy8gUmVkdWNlZCBjZW50ZXIgb3ZlcmxhcCBmb3IgbW9iaWxlXG4gICAgY29uc3QgYW1wbGl0dWRlU2NhbGUgPSBpc01vYmlsZSA/IDAuOCA6IDAuOTU7IC8vIFNsaWdodGx5IHJlZHVjZWQgYW1wbGl0dWRlIGZvciBtb2JpbGVcbiAgICBjb25zdCBlZGdlWm9uZVNjYWxlID0gaXNNb2JpbGUgPyAwLjE1IDogMC4yOyAvLyBBZGp1c3RlZCBlZGdlIHRhcGVyIHpvbmUgZm9yIG1vYmlsZVxuXG4gICAgLy8gR2V0IHRoZSBjb21wdXRlZCBhY2NlbnQgY29sb3Igd2l0aCBmYWxsYmFja1xuICAgIGNvbnN0IGNvbXB1dGVkU3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7XG4gICAgbGV0IGFjY2VudENvbG9yID0gY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwiLS10ZXh0LWFjY2VudFwiKS50cmltKCk7XG4gICAgaWYgKCFhY2NlbnRDb2xvcikge1xuICAgICAgYWNjZW50Q29sb3IgPSBcIiM1ODcxZWZcIjtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZ3JhZGllbnRcbiAgICBjb25zdCBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoZWlnaHQpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCBhY2NlbnRDb2xvcik7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuNSwgYWNjZW50Q29sb3IpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgxLCBhY2NlbnRDb2xvcik7XG4gICAgY3R4LmZpbGxTdHlsZSA9IGdyYWRpZW50O1xuXG4gICAgLy8gRHJhdyB0aGUgd2F2ZWZvcm1cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhjZW50ZXJYLCBjZW50ZXJZKTtcblxuICAgIGNvbnN0IGhhbGZCdWZmZXJMZW5ndGggPSBNYXRoLmZsb29yKGJ1ZmZlckxlbmd0aCAvIDIpO1xuICAgIGNvbnN0IHNsaWNlV2lkdGggPSB3aWR0aCAvIDIgLyBoYWxmQnVmZmVyTGVuZ3RoO1xuICAgIGNvbnN0IGNlbnRlck92ZXJsYXAgPSBzbGljZVdpZHRoICogY2VudGVyT3ZlcmxhcFNjYWxlO1xuXG4gICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBlZGdlIHRhcGVyXG4gICAgY29uc3QgZ2V0RWRnZVRhcGVyID0gKGk6IG51bWJlciwgdG90YWw6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgZWRnZVpvbmUgPSB0b3RhbCAqIGVkZ2Vab25lU2NhbGU7XG4gICAgICBpZiAoaSA8IGVkZ2Vab25lKSB7XG4gICAgICAgIHJldHVybiAwLjMgKyAwLjcgKiAoaSAvIGVkZ2Vab25lKTtcbiAgICAgIH0gZWxzZSBpZiAoaSA+IHRvdGFsIC0gZWRnZVpvbmUpIHtcbiAgICAgICAgcmV0dXJuIDAuMyArIDAuNyAqICgodG90YWwgLSBpKSAvIGVkZ2Vab25lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAxO1xuICAgIH07XG5cbiAgICAvLyBEcmF3IHJpZ2h0IHNpZGUgKHRvcCBoYWxmKVxuICAgIGZvciAobGV0IGkgPSAtb3ZlcmxhcDsgaSA8IGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwOyBpKyspIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZGF0YUFycmF5W01hdGguYWJzKGkpXSAvIDI1NS4wO1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihNYXRoLmFicyhpKSwgaGFsZkJ1ZmZlckxlbmd0aCAtIDEpO1xuICAgICAgdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gPVxuICAgICAgICB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIHRoaXMuc21vb3RoaW5nRmFjdG9yICtcbiAgICAgICAgdmFsdWUgKiAoMSAtIHRoaXMuc21vb3RoaW5nRmFjdG9yKTtcblxuICAgICAgY29uc3QgeCA9IGNlbnRlclggKyBpICogc2xpY2VXaWR0aCAtIGNlbnRlck92ZXJsYXA7XG4gICAgICBjb25zdCB0YXBlciA9IGdldEVkZ2VUYXBlcihpICsgb3ZlcmxhcCwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgKiAyKTtcbiAgICAgIGNvbnN0IHkgPVxuICAgICAgICBjZW50ZXJZIC0gdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiBjZW50ZXJZICogYW1wbGl0dWRlU2NhbGUgKiB0YXBlcjtcbiAgICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgLy8gRHJhdyByaWdodCBzaWRlIChib3R0b20gaGFsZilcbiAgICBmb3IgKGxldCBpID0gaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgLSAxOyBpID49IC1vdmVybGFwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYICsgaSAqIHNsaWNlV2lkdGggLSBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSArIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIC8vIERyYXcgbGVmdCBzaWRlIChib3R0b20gaGFsZilcbiAgICBmb3IgKGxldCBpID0gLW92ZXJsYXA7IGkgPCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcDsgaSsrKSB7XG4gICAgICBjb25zdCBpbmRleCA9IE1hdGgubWluKE1hdGguYWJzKGkpLCBoYWxmQnVmZmVyTGVuZ3RoIC0gMSk7XG4gICAgICBjb25zdCB4ID0gY2VudGVyWCAtIGkgKiBzbGljZVdpZHRoICsgY2VudGVyT3ZlcmxhcDtcbiAgICAgIGNvbnN0IHRhcGVyID0gZ2V0RWRnZVRhcGVyKGkgKyBvdmVybGFwLCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAqIDIpO1xuICAgICAgY29uc3QgeSA9XG4gICAgICAgIGNlbnRlclkgKyB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIGNlbnRlclkgKiBhbXBsaXR1ZGVTY2FsZSAqIHRhcGVyO1xuICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICB9XG5cbiAgICAvLyBEcmF3IGxlZnQgc2lkZSAodG9wIGhhbGYpXG4gICAgZm9yIChsZXQgaSA9IGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwIC0gMTsgaSA+PSAtb3ZlcmxhcDsgaS0tKSB7XG4gICAgICBjb25zdCBpbmRleCA9IE1hdGgubWluKE1hdGguYWJzKGkpLCBoYWxmQnVmZmVyTGVuZ3RoIC0gMSk7XG4gICAgICBjb25zdCB4ID0gY2VudGVyWCAtIGkgKiBzbGljZVdpZHRoICsgY2VudGVyT3ZlcmxhcDtcbiAgICAgIGNvbnN0IHRhcGVyID0gZ2V0RWRnZVRhcGVyKGkgKyBvdmVybGFwLCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAqIDIpO1xuICAgICAgY29uc3QgeSA9XG4gICAgICAgIGNlbnRlclkgLSB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIGNlbnRlclkgKiBhbXBsaXR1ZGVTY2FsZSAqIHRhcGVyO1xuICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICB9XG5cbiAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgY3R4LmZpbGwoKTtcblxuICAgIC8vIFNjaGVkdWxlIG5leHQgZnJhbWUgb25seSBpZiBzdGlsbCByZWNvcmRpbmdcbiAgICBpZiAodGhpcy5pc1JlY29yZGluZykge1xuICAgICAgdGhpcy5hbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmRyYXcpO1xuICAgIH1cbiAgfTtcblxuICBvblRvZ2dsZShjYWxsYmFjazogKGlzUmVjb3JkaW5nOiBib29sZWFuKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vblRvZ2dsZUNhbGxiYWNrcy5hZGQoY2FsbGJhY2spO1xuICB9XG5cbiAgcHJpdmF0ZSBub3RpZnlMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5vblRvZ2dsZUNhbGxiYWNrcy5mb3JFYWNoKChjYikgPT4gY2IodGhpcy5pc1JlY29yZGluZykpO1xuICB9XG5cbiAgdW5sb2FkKCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcFJlY29yZGluZygpO1xuICAgIHRoaXMub25Ub2dnbGVDYWxsYmFja3MuY2xlYXIoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTm90aWNlLCBzZXRJY29uLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgUG9zdFByb2Nlc3NpbmdTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1Bvc3RQcm9jZXNzaW5nU2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGlvVHJhbnNjcmlwdGlvblByb2dyZXNzIHtcbiAgcHJvZ3Jlc3M6IG51bWJlcjtcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIGljb246IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zIHtcbiAgZmlsZTogVEZpbGU7XG4gIHRpbWVzdGFtcGVkPzogYm9vbGVhbjtcbiAgaXNDaGF0PzogYm9vbGVhbjtcbiAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU/OiAodGV4dDogc3RyaW5nKSA9PiB2b2lkO1xuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbn1cblxuY2xhc3MgUGVyc2lzdGVudFRyYW5zY3JpcHRpb25Ob3RpY2UgZXh0ZW5kcyBOb3RpY2Uge1xuICBwcml2YXRlIHByb2dyZXNzQmFyOiBIVE1MRGl2RWxlbWVudDtcbiAgcHJpdmF0ZSBzdGF0dXNUZXh0OiBIVE1MRGl2RWxlbWVudDtcbiAgcHJpdmF0ZSBzdGF0dXNJY29uOiBIVE1MRGl2RWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihcIlwiLCAwKTsgLy8gTmV2ZXIgYXV0by1oaWRlXG4gICAgdGhpcy5ub3RpY2VFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC10cmFuc2NyaXB0aW9uLW5vdGljZVwiKTtcblxuICAgIC8vIENyZWF0ZSBwcm9ncmVzcyBjb250YWluZXJcbiAgICBjb25zdCBwcm9ncmVzc0NvbnRhaW5lciA9IHRoaXMubm90aWNlRWwuY3JlYXRlRGl2KFwidHJhbnNjcmlwdGlvbi1wcm9ncmVzc1wiKTtcblxuICAgIC8vIEFkZCBzdGF0dXMgY29udGFpbmVyIHdpdGggaWNvbiBhbmQgdGV4dFxuICAgIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IHByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tc3RhdHVzXCIpO1xuICAgIHRoaXMuc3RhdHVzSWNvbiA9IHN0YXR1c0NvbnRhaW5lci5jcmVhdGVEaXYoXCJ0cmFuc2NyaXB0aW9uLXN0YXR1cy1pY29uXCIpO1xuICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5jcmVhdGVEaXYoXCJ0cmFuc2NyaXB0aW9uLXN0YXR1cy10ZXh0XCIpO1xuXG4gICAgLy8gQWRkIHByb2dyZXNzIGJhclxuICAgIGNvbnN0IHByb2dyZXNzQmFyQ29udGFpbmVyID0gcHJvZ3Jlc3NDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJ0cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhci1jb250YWluZXJcIlxuICAgICk7XG4gICAgdGhpcy5wcm9ncmVzc0JhciA9IHByb2dyZXNzQmFyQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwidHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXJcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgc3R5bGVzIGlmIG5vdCBhbHJlYWR5IGFkZGVkXG4gICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN5c3RlbXNjdWxwdC10cmFuc2NyaXB0aW9uLW5vdGljZS1zdHlsZXNcIikpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgICAgc3R5bGUuaWQgPSBcInN5c3RlbXNjdWxwdC10cmFuc2NyaXB0aW9uLW5vdGljZS1zdHlsZXNcIjtcbiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgICAuc3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlIHtcbiAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweCAhaW1wb3J0YW50O1xuICAgICAgICAgIG1pbi13aWR0aDogMjYwcHg7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcyB7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgICAgICAgIGdhcDogOHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tc3RhdHVzIHtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgZ2FwOiA4cHg7XG4gICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXN0YXR1cy1pY29uIHtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtYWNjZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXN0YXR1cy10ZXh0IHtcbiAgICAgICAgICBmbGV4OiAxO1xuICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhci1jb250YWluZXIge1xuICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgIGhlaWdodDogNHB4O1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTtcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7XG4gICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhciB7XG4gICAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtYWNjZW50KTtcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7XG4gICAgICAgICAgdHJhbnNpdGlvbjogd2lkdGggMC4zcyBlYXNlO1xuICAgICAgICAgIHdpZHRoOiAwJTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5ub3RpY2Utc3VjY2VzcyAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtc3VjY2VzcykgIWltcG9ydGFudDtcbiAgICAgICAgfVxuXG4gICAgICAgIC5ub3RpY2UtZXJyb3IgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS10ZXh0LWVycm9yKSAhaW1wb3J0YW50O1xuICAgICAgICB9XG4gICAgICBgO1xuICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlUHJvZ3Jlc3MoeyBwcm9ncmVzcywgc3RhdHVzLCBpY29uIH06IEF1ZGlvVHJhbnNjcmlwdGlvblByb2dyZXNzKSB7XG4gICAgdGhpcy5wcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IGAke3Byb2dyZXNzfSVgO1xuICAgIHRoaXMuc3RhdHVzVGV4dC5zZXRUZXh0KHN0YXR1cyk7XG4gICAgdGhpcy5zdGF0dXNJY29uLmVtcHR5KCk7XG4gICAgc2V0SWNvbih0aGlzLnN0YXR1c0ljb24sIGljb24pO1xuXG4gICAgLy8gVXBkYXRlIG5vdGljZSBjbGFzcyBiYXNlZCBvbiBzdGF0dXNcbiAgICB0aGlzLm5vdGljZUVsLnJlbW92ZUNsYXNzKFwibm90aWNlLXN1Y2Nlc3NcIiwgXCJub3RpY2UtZXJyb3JcIik7XG4gICAgaWYgKHByb2dyZXNzID09PSAxMDApIHtcbiAgICAgIHRoaXMubm90aWNlRWwuYWRkQ2xhc3MoXCJub3RpY2Utc3VjY2Vzc1wiKTtcbiAgICB9IGVsc2UgaWYgKHByb2dyZXNzID09PSAwICYmIGljb24gPT09IFwieC1jaXJjbGVcIikge1xuICAgICAgdGhpcy5ub3RpY2VFbC5hZGRDbGFzcyhcIm5vdGljZS1lcnJvclwiKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIHtcbiAgcHJpdmF0ZSB0cmFuc2NyaXB0aW9uU2VydmljZTogVHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgcG9zdFByb2Nlc3NpbmdTZXJ2aWNlOiBQb3N0UHJvY2Vzc2luZ1NlcnZpY2U7XG4gIHByaXZhdGUgb3B0aW9uczogQXVkaW9UcmFuc2NyaXB0aW9uT3B0aW9ucztcbiAgcHJpdmF0ZSBub3RpY2U6IFBlcnNpc3RlbnRUcmFuc2NyaXB0aW9uTm90aWNlO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvcHRpb25zOiBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zKSB7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBvcHRpb25zLnBsdWdpblxuICAgICk7XG4gICAgdGhpcy5wb3N0UHJvY2Vzc2luZ1NlcnZpY2UgPSBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBvcHRpb25zLnBsdWdpblxuICAgICk7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMubm90aWNlID0gbmV3IFBlcnNpc3RlbnRUcmFuc2NyaXB0aW9uTm90aWNlKCk7XG4gICAgdGhpcy5zdGFydFRyYW5zY3JpcHRpb24oKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc3RhcnRUcmFuc2NyaXB0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBTaG93IGluaXRpYWwgc3RhdHVzXG4gICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgICBzdGF0dXM6IFwiU3RhcnRpbmcgdHJhbnNjcmlwdGlvbi4uLlwiLFxuICAgICAgICBpY29uOiBcIm1pY1wiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnRyYW5zY3JpYmVGaWxlKFxuICAgICAgICB0aGlzLm9wdGlvbnMuZmlsZSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IHRoaXMub3B0aW9ucy5pc0NoYXQgPyBcImNoYXRcIiA6IFwibm90ZVwiLFxuICAgICAgICAgIHRpbWVzdGFtcGVkOiB0aGlzLm9wdGlvbnMudGltZXN0YW1wZWQsXG4gICAgICAgICAgb25Qcm9ncmVzczogKHByb2dyZXNzLCBzdGF0dXMpID0+IHtcbiAgICAgICAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgICAgICAgcHJvZ3Jlc3MsXG4gICAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICAgICAgaWNvbjogXCJhdWRpby1saW5lc1wiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBnZXQgdHJhbnNjcmlwdGlvbiB0ZXh0XCIpO1xuICAgICAgfVxuXG4gICAgICBsZXQgZmluYWxUZXh0ID0gdGV4dDtcblxuICAgICAgLy8gU2tpcCBwb3N0LXByb2Nlc3NpbmcgZm9yIGNoYXQgdmlld3MgdG8gZW5zdXJlIHJhdyB0cmFuc2NyaXB0aW9uXG4gICAgICBpZiAoIXRoaXMub3B0aW9ucy5pc0NoYXQgJiYgdGhpcy5vcHRpb25zLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ0VuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICAgIHByb2dyZXNzOiA4MCxcbiAgICAgICAgICBzdGF0dXM6IFwiUG9zdC1wcm9jZXNzaW5nIHRyYW5zY3JpcHRpb24uLi5cIixcbiAgICAgICAgICBpY29uOiBcIndhbmRcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NlZFRleHQgPSBhd2FpdCB0aGlzLnBvc3RQcm9jZXNzaW5nU2VydmljZS5wcm9jZXNzVHJhbnNjcmlwdGlvbihcbiAgICAgICAgICB0ZXh0XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gRm9ybWF0IHRoZSBmaW5hbCB0ZXh0IHdpdGggYm90aCB2ZXJzaW9ucyBmb3Igbm90ZXNcbiAgICAgICAgZmluYWxUZXh0ID0gYCMgQXVkaW8gVHJhbnNjcmlwdGlvblxuU291cmNlOiAke3RoaXMub3B0aW9ucy5maWxlLmJhc2VuYW1lfVxuVHJhbnNjcmliZWQ6ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4jIyBSYXcgVHJhbnNjcmlwdGlvblxuJHt0ZXh0fVxuXG4jIyBQcm9jZXNzZWQgVHJhbnNjcmlwdGlvblxuJHtwcm9jZXNzZWRUZXh0fWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgY2hhdCB2aWV3cyBvciB3aGVuIHBvc3QtcHJvY2Vzc2luZyBpcyBkaXNhYmxlZCwganVzdCB1c2UgdGhlIHJhdyB0cmFuc2NyaXB0aW9uXG4gICAgICAgIGZpbmFsVGV4dCA9IHRoaXMub3B0aW9ucy5pc0NoYXQgPyB0ZXh0IDogYCMgQXVkaW8gVHJhbnNjcmlwdGlvblxuU291cmNlOiAke3RoaXMub3B0aW9ucy5maWxlLmJhc2VuYW1lfVxuVHJhbnNjcmliZWQ6ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4jIyBSYXcgVHJhbnNjcmlwdGlvblxuJHt0ZXh0fWA7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgdGhlIGNvbXBsZXRpb24gY2FsbGJhY2sgaWYgcHJvdmlkZWRcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlKGZpbmFsVGV4dCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvcHkgdGV4dCB0byBjbGlwYm9hcmRcbiAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGZpbmFsVGV4dCk7XG5cbiAgICAgIC8vIFNob3cgc3VjY2VzcyBtZXNzYWdlXG4gICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgIHByb2dyZXNzOiAxMDAsXG4gICAgICAgIHN0YXR1czogXCJUcmFuc2NyaXB0aW9uIGNvbXBsZXRlIVwiLFxuICAgICAgICBpY29uOiBcImNoZWNrLWNpcmNsZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEhpZGUgbm90aWNlIGFmdGVyIHN1Y2Nlc3NcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLm5vdGljZS5oaWRlKCk7XG4gICAgICB9LCAyMDAwKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgIHN0YXR1czogYEVycm9yOiAke1xuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgICAgICB9YCxcbiAgICAgICAgaWNvbjogXCJ4LWNpcmNsZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEhpZGUgbm90aWNlIGFmdGVyIGVycm9yXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5ub3RpY2UuaGlkZSgpO1xuICAgICAgfSwgNDAwMCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwoXG4gIGFwcDogQXBwLFxuICBvcHRpb25zOiBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwoYXBwLCBvcHRpb25zKTtcbiAgbW9kYWwub3BlbigpO1xufVxuIiwgImltcG9ydCB7IFBsdWdpbiwgTm90aWNlLCBNZW51LCBURmlsZSwgTWFya2Rvd25WaWV3IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4vU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcblxuLy8gTWF0Y2ggc2VydmVyLXNpZGUgY29uZmlndXJhdGlvblxuY29uc3QgU1VQUE9SVEVEX0FVRElPX0VYVEVOU0lPTlMgPSBbXCJ3YXZcIiwgXCJtNGFcIiwgXCJ3ZWJtXCIsIFwib2dnXCIsIFwibXAzXCJdO1xuY29uc3QgTUlNRV9UWVBFX01BUCA9IHtcbiAgd2F2OiBcImF1ZGlvL3dhdlwiLFxuICBtNGE6IFwiYXVkaW8vbXA0XCIsXG4gIHdlYm06IFwiYXVkaW8vd2VibVwiLFxuICBvZ2c6IFwiYXVkaW8vb2dnO2NvZGVjcz1vcHVzXCIsXG4gIG1wMzogXCJhdWRpby9tcGVnXCIsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zY3JpcHRpb25Db250ZXh0IHtcbiAgdHlwZTogXCJub3RlXCIgfCBcImNoYXRcIjtcbiAgdGltZXN0YW1wZWQ/OiBib29sZWFuO1xuICBvblByb2dyZXNzPzogKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgVHJhbnNjcmlwdGlvblNlcnZpY2Uge1xuICBwcml2YXRlIHBsdWdpbjogUGx1Z2luICYgeyBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MgfTtcbiAgcHJpdmF0ZSBpc1RyYW5zY3JpYmluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogVHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHBsdWdpbjogUGx1Z2luICYgeyBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBwbHVnaW4uc2V0dGluZ3MsXG4gICAgICBwbHVnaW4uYXBwXG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShcbiAgICBwbHVnaW46IFBsdWdpbiAmIHsgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzIH1cbiAgKTogVHJhbnNjcmlwdGlvblNlcnZpY2Uge1xuICAgIGlmICghVHJhbnNjcmlwdGlvblNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFRyYW5zY3JpcHRpb25TZXJ2aWNlLmluc3RhbmNlID0gbmV3IFRyYW5zY3JpcHRpb25TZXJ2aWNlKHBsdWdpbik7XG4gICAgfVxuICAgIHJldHVybiBUcmFuc2NyaXB0aW9uU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcGFyc2VFcnJvclJlc3BvbnNlKFxuICAgIHJlc3BvbnNlOiBSZXNwb25zZVxuICApOiBQcm9taXNlPHsgbWVzc2FnZTogc3RyaW5nOyBkYXRhPzogYW55IH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YS5lcnJvciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIHJldHVybiB7IG1lc3NhZ2U6IGRhdGEuZXJyb3IsIGRhdGEgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS5lcnJvci5tZXNzYWdlKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogZGF0YS5lcnJvci5tZXNzYWdlLCBkYXRhIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZGF0YS5lcnJvciksIGRhdGEgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IG1lc3NhZ2U6IHJlc3BvbnNlLnN0YXR1c1RleHQsIGRhdGEgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4geyBtZXNzYWdlOiByZXNwb25zZS5zdGF0dXNUZXh0IH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdHJhbnNjcmliZUZpbGUoXG4gICAgZmlsZTogVEZpbGUsXG4gICAgY29udGV4dD86IFRyYW5zY3JpcHRpb25Db250ZXh0XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc29sZS5sb2coXCJUcmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlRmlsZSBjYWxsZWQgd2l0aDpcIiwge1xuICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSxcbiAgICAgIGNvbnRleHQsXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5pc1RyYW5zY3JpYmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSB0cmFuc2NyaWJpbmcgYSBmaWxlXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCFTVVBQT1JURURfQVVESU9fRVhURU5TSU9OUy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGZpbGUgdHlwZTogJHtleHRlbnNpb259YCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc1RyYW5zY3JpYmluZyA9IHRydWU7XG5cbiAgICAvLyBSZXBvcnQgaW5pdGlhbCBwcm9ncmVzc1xuICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/LigwLCBcIlJlYWRpbmcgYXVkaW8gZmlsZS4uLlwiKTtcblxuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHtcbiAgICAgIHR5cGU6IE1JTUVfVFlQRV9NQVBbZXh0ZW5zaW9uIGFzIGtleW9mIHR5cGVvZiBNSU1FX1RZUEVfTUFQXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBibG9iLCBmaWxlLm5hbWUpO1xuICAgIGlmIChjb250ZXh0Py50aW1lc3RhbXBlZCkge1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwidGltZXN0YW1wZWRcIiwgXCJ0cnVlXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBSZXBvcnQgdXBsb2FkIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMjAsIFwiVXBsb2FkaW5nIGF1ZGlvLi4uXCIpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zYCxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc29sZS5sb2coXCJSYXcgc2VydmVyIHJlc3BvbnNlOlwiLCB7XG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICBvazogcmVzcG9uc2Uub2ssXG4gICAgICAgIGNvbnRlbnRUeXBlOiByZXNwb25zZS5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSxcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgZGF0YTogYW55O1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgZGF0YTogcGFyc2VkRGF0YSB9ID1cbiAgICAgICAgICBhd2FpdCB0aGlzLnBhcnNlRXJyb3JSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgcmVzcG9uc2UgcGFyc2VkOlwiLCB7IGVycm9yTWVzc2FnZSwgcGFyc2VkRGF0YSB9KTtcbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlOiBDUkVESVRfVVBEQVRFIGlzIGFjdHVhbGx5IGEgc3VjY2Vzc1xuICAgICAgICBpZiAoXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDAgJiZcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPT09IFwiQ3JlZGl0cyBjaGFyZ2VkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIENvbnRpbnVlIHByb2Nlc3NpbmcgLSB0aGlzIGlzIG5vdCBhY3R1YWxseSBhbiBlcnJvclxuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJDcmVkaXRzIGNoYXJnZWQgc3VjY2Vzc2Z1bGx5LCBjb250aW51aW5nIHdpdGggdHJhbnNjcmlwdGlvbi4uLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBkYXRhID0gcGFyc2VkRGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgRmFpbGVkIHRvIHRyYW5zY3JpYmUgZmlsZTogJHtyZXNwb25zZS5zdGF0dXN9IC0gJHtlcnJvck1lc3NhZ2V9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJSYXcgcmVzcG9uc2UgdGV4dDpcIiwgcmVzcG9uc2VUZXh0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGFyc2VkIHJlc3BvbnNlIGRhdGE6XCIsIGRhdGEpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSByZXNwb25zZSBKU09OOlwiLCBlKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIEpTT04gcmVzcG9uc2UgZnJvbSBzZXJ2ZXJcIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVwb3J0IHByb2Nlc3NpbmcgcHJvZ3Jlc3NcbiAgICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/Lig2MCwgXCJQcm9jZXNzaW5nIGF1ZGlvLi4uXCIpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIkZpbmFsIGRhdGEgb2JqZWN0OlwiLCB7XG4gICAgICAgIGhhc0RhdGE6ICEhZGF0YSxcbiAgICAgICAgZGF0YVR5cGU6IHR5cGVvZiBkYXRhLFxuICAgICAgICBrZXlzOiBkYXRhID8gT2JqZWN0LmtleXMoZGF0YSkgOiBudWxsLFxuICAgICAgICB0ZXh0VHlwZTogZGF0YT8udGV4dCA/IHR5cGVvZiBkYXRhLnRleHQgOiBudWxsLFxuICAgICAgICB0ZXh0TGVuZ3RoOiBkYXRhPy50ZXh0ID8gZGF0YS50ZXh0Lmxlbmd0aCA6IG51bGwsXG4gICAgICAgIHRleHRQcmV2aWV3OiBkYXRhPy50ZXh0ID8gZGF0YS50ZXh0LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIiA6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgdmFsaWQgdHJhbnNjcmlwdGlvbiB0ZXh0XG4gICAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEudGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCByZXNwb25zZSBkYXRhOlwiLCBkYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdHJhbnNjcmlwdGlvbiB0ZXh0IHJlY2VpdmVkIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSB0ZXh0IGlzIG5vdCBlbXB0eSBhZnRlciB0cmltbWluZ1xuICAgICAgY29uc3QgdHJpbW1lZFRleHQgPSBkYXRhLnRleHQudHJpbSgpO1xuICAgICAgY29uc29sZS5sb2coXCJUcmltbWVkIHRleHQ6XCIsIHtcbiAgICAgICAgbGVuZ3RoOiB0cmltbWVkVGV4dC5sZW5ndGgsXG4gICAgICAgIHByZXZpZXc6IHRyaW1tZWRUZXh0LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRyaW1tZWRUZXh0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFbXB0eSB0cmFuc2NyaXB0aW9uIHRleHQgYWZ0ZXIgdHJpbW1pbmc6XCIsIGRhdGEpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbXB0eSB0cmFuc2NyaXB0aW9uIHRleHQgcmVjZWl2ZWQgZnJvbSBzZXJ2ZXJcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcG9ydCBjb21wbGV0aW9uIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMTAwLCBcIlRyYW5zY3JpcHRpb24gY29tcGxldGUhXCIpO1xuXG4gICAgICByZXR1cm4gdHJpbW1lZFRleHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUcmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc1RyYW5zY3JpYmluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHVubG9hZCgpIHtcbiAgICAvLyBOb3RoaW5nIHRvIHVubG9hZCBjdXJyZW50bHlcbiAgfVxufVxuIiwgImltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUG9zdFByb2Nlc3NpbmdTZXJ2aWNlO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZGVmYXVsdE1vZGVsSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UoXG4gICAgICBwbHVnaW4uc2V0dGluZ3MsXG4gICAgICBwbHVnaW4uYXBwXG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZShwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbik6IFBvc3RQcm9jZXNzaW5nU2VydmljZSB7XG4gICAgaWYgKCFQb3N0UHJvY2Vzc2luZ1NlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFBvc3RQcm9jZXNzaW5nU2VydmljZS5pbnN0YW5jZSA9IG5ldyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UocGx1Z2luKTtcbiAgICB9XG4gICAgcmV0dXJuIFBvc3RQcm9jZXNzaW5nU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZmluZERlZmF1bHRNb2RlbCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICh0aGlzLmRlZmF1bHRNb2RlbElkKSByZXR1cm4gdGhpcy5kZWZhdWx0TW9kZWxJZDtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICBjb25zdCBkZWZhdWx0TW9kZWwgPSBtb2RlbHMuZmluZCgobW9kZWwpID0+XG4gICAgICAgIG1vZGVsLm5hbWU/Lm1hdGNoKC9cXChEZWZhdWx0XFwpL2kpXG4gICAgICApO1xuICAgICAgaWYgKCFkZWZhdWx0TW9kZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGVmYXVsdCBtb2RlbCBub3QgZm91bmRcIik7XG4gICAgICB9XG4gICAgICB0aGlzLmRlZmF1bHRNb2RlbElkID0gZGVmYXVsdE1vZGVsLmlkO1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbC5pZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZpbmRpbmcgZGVmYXVsdCBtb2RlbDpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcHJvY2Vzc1RyYW5zY3JpcHRpb24odGV4dDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vZGVsSWQgPSBhd2FpdCB0aGlzLmZpbmREZWZhdWx0TW9kZWwoKTtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ1Byb21wdCxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogdGV4dCxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbGV0IHByb2Nlc3NlZFRleHQgPSBcIlwiO1xuICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiB0aGlzLnNjdWxwdFNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuMywgLy8gTG93ZXIgdGVtcGVyYXR1cmUgZm9yIG1vcmUgY29uc2lzdGVudCBvdXRwdXRcbiAgICAgIH0pKSB7XG4gICAgICAgIGlmIChjaHVuay5jb250ZW50KSB7XG4gICAgICAgICAgcHJvY2Vzc2VkVGV4dCArPSBjaHVuay5jb250ZW50O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwcm9jZXNzZWRUZXh0LnRyaW0oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHBvc3QtcHJvY2Vzc2luZyB0cmFuc2NyaXB0aW9uOlwiLCBlcnJvcik7XG4gICAgICAvLyBPbiBlcnJvciwgcmV0dXJuIG9yaWdpbmFsIHRleHRcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEl0ZW1WaWV3LCBXb3Jrc3BhY2VMZWFmLCBURmlsZSwgVEZvbGRlciwgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBDaGF0Um9sZSwgTXVsdGlQYXJ0Q29udGVudCwgUEFUUkVPTl9VUkwgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IENoYXRTdG9yYWdlU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9DaGF0U3RvcmFnZVNlcnZpY2VcIjtcbmltcG9ydCB7IFNjcm9sbE1hbmFnZXJTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1Njcm9sbE1hbmFnZXJTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL01vZGVsU2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7XG4gIHNob3dFbmhhbmNlZE5vdGljZSxcbiAgc2hvd1BvcHVwLFxuICBzaG93Tm90aWNlLFxuICBzaG93QWxlcnQsXG59IGZyb20gXCIuLi9jb3JlL3VpL1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBEcmF3ZXJDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnRzL0RyYXdlckNvbXBvbmVudFwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9NZXNzYWdlUmVuZGVyZXJcIjtcbmltcG9ydCB7IElucHV0SGFuZGxlciB9IGZyb20gXCIuL2NvbXBvbmVudHMvSW5wdXRIYW5kbGVyXCI7XG5pbXBvcnQgeyBGaWxlQ29udGV4dE1hbmFnZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL0ZpbGVDb250ZXh0TWFuYWdlclwiO1xuaW1wb3J0IHsgc2hvd1N5c3RlbVByb21wdE1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9TeXN0ZW1Qcm9tcHRNb2RhbFwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBMb2FkQ2hhdE1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9Mb2FkQ2hhdE1vZGFsXCI7XG5pbXBvcnQgeyBTZXR0aW5nIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjb25zdCBDSEFUX1ZJRVdfVFlQRSA9IFwic3lzdGVtc2N1bHB0LWNoYXQtdmlld1wiO1xuXG5leHBvcnQgY2xhc3MgQ2hhdFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gIHByaXZhdGUgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXTtcbiAgcHJpdmF0ZSBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgY2hhdFN0b3JhZ2U6IENoYXRTdG9yYWdlU2VydmljZTtcbiAgcHJpdmF0ZSBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBpbnB1dEhhbmRsZXI6IElucHV0SGFuZGxlcjtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBjaGF0SWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBtb2RlbEluZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VycmVudE1vZGVsTmFtZTogc3RyaW5nID0gXCJcIjtcbiAgcHJpdmF0ZSBpc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBjb250ZXh0TWFuYWdlcjogRmlsZUNvbnRleHRNYW5hZ2VyO1xuICBwcml2YXRlIHJlZnJlc2hJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBsYXN0UmVmcmVzaFRpbWUgPSAwO1xuICBwcml2YXRlIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBwcml2YXRlIGxheW91dENoYW5nZUhhbmRsZXI6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgYXdhaXRpbmdTdGF0ZVJlc3RvcmUgPSBmYWxzZTtcbiAgcHJpdmF0ZSBhY3Rpb25zRHJhd2VyOiBEcmF3ZXJDb21wb25lbnQ7XG4gIHByaXZhdGUgbWVzc2FnZVJlbmRlcmVyOiBNZXNzYWdlUmVuZGVyZXI7XG4gIC8qKlxuICAgKiBzeXN0ZW1Qcm9tcHRUeXBlIGFuZCBzeXN0ZW1Qcm9tcHRQYXRoIGFyZSB0aGUgZGVmYXVsdCBzeXN0ZW0gcHJvbXB0IGZvciB0aGlzIGNoYXRcbiAgICogaWYgdGhlIHVzZXIgaGFzIG5vdCBvdmVycmlkZGVuIHRoZW0geWV0LlxuICAgKi9cbiAgcHJpdmF0ZSBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICBwcml2YXRlIGNoYXRUaXRsZTogc3RyaW5nID0gXCJVbnRpdGxlZCBDaGF0XCI7XG4gIHByaXZhdGUgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IobGVhZjogV29ya3NwYWNlTGVhZiwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICBzdXBlcihsZWFmKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luLnNldHRpbmdzLCB0aGlzLmFwcCk7XG4gICAgdGhpcy5jaGF0U3RvcmFnZSA9IG5ldyBDaGF0U3RvcmFnZVNlcnZpY2UoXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBwbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkO1xuICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICB0aGlzLmxhc3RSZWZyZXNoVGltZSA9IDA7XG4gICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmF3YWl0aW5nU3RhdGVSZXN0b3JlID0gdHJ1ZTtcbiAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlciA9IG5ldyBNZXNzYWdlUmVuZGVyZXIodGhpcy5hcHApO1xuXG4gICAgLy8gSW5zdGVhZCBvZiBtYXRjaGluZyBwcmVzZXRzLCByZWFkIGZyb20gcGx1Z2luIHNldHRpbmdzOlxuICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlIHx8IFwiZ2VuZXJhbC11c2VcIjtcbiAgICBpZiAoXG4gICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGhcbiAgICApIHtcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB0aGlzLmxheW91dENoYW5nZUhhbmRsZXIgPSB0aGlzLm9uTGF5b3V0Q2hhbmdlLmJpbmQodGhpcyk7XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBDSEFUX1ZJRVdfVFlQRTtcbiAgfVxuXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XG4gICAgY29uc3QgYWxsQ2hhdHMgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKENIQVRfVklFV19UWVBFKTtcblxuICAgIC8vIElmIHRoZXJlJ3Mgb25seSBvbmUgY2hhdCwganVzdCBzaG93IHRoZSB0aXRsZVxuICAgIGlmIChhbGxDaGF0cy5sZW5ndGggPD0gMSkge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhdFRpdGxlO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlIGFyZSBtdWx0aXBsZSBjaGF0cywgYXBwZW5kIGEgbnVtYmVyXG4gICAgY29uc3QgY2hhdE51bWJlciA9IGFsbENoYXRzLmluZGV4T2YodGhpcy5sZWFmKSArIDE7XG4gICAgcmV0dXJuIGAke3RoaXMuY2hhdFRpdGxlfSAke2NoYXROdW1iZXJ9YDtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jaGF0LWNvbnRhaW5lclwiKTtcblxuICAgIC8vIEFkZCBkcmFnIGFuZCBkcm9wIGV2ZW50IGhhbmRsZXJzXG4gICAgdGhpcy5zZXR1cERyYWdBbmREcm9wKGNvbnRhaW5lcik7XG5cbiAgICBjb25zdCBoZWFkZXJDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgaGVhZGVyUm93ID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1oZWFkZXItcm93XCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgbGVmdCBzZWN0aW9uIGZvciBjb250ZXh0IGZpbGVzXG4gICAgY29uc3QgbGVmdFNlY3Rpb24gPSBoZWFkZXJSb3cuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1oZWFkZXItc2VjdGlvbi1sZWZ0XCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRleHRNYW5hZ2VyID0gbmV3IEZpbGVDb250ZXh0TWFuYWdlcih7XG4gICAgICBhcHA6IHRoaXMuYXBwLFxuICAgICAgY29udGFpbmVyOiBsZWZ0U2VjdGlvbixcbiAgICAgIG9uQ29udGV4dENoYW5nZTogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuY2hlY2tTeW5jU3RhdHVzKCk7XG4gICAgICB9LFxuICAgICAgc2N1bHB0U2VydmljZTogdGhpcy5haVNlcnZpY2UsXG4gICAgICBwbHVnaW46IHRoaXMucGx1Z2luLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHJpZ2h0IHNlY3Rpb24gZm9yIGFjdGlvbnNcbiAgICBjb25zdCByaWdodFNlY3Rpb24gPSBoZWFkZXJSb3cuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1oZWFkZXItc2VjdGlvbi1yaWdodFwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5hY3Rpb25zRHJhd2VyID0gbmV3IERyYXdlckNvbXBvbmVudCh7XG4gICAgICBjb250YWluZXI6IHJpZ2h0U2VjdGlvbixcbiAgICAgIHRpdGxlOiBcIkFjdGlvbnNcIixcbiAgICB9KTtcbiAgICBjb25zdCBhY3Rpb25zQ29udGVudCA9IHRoaXMuYWN0aW9uc0RyYXdlci5nZXRDb250ZW50KCk7XG5cbiAgICAvLyBBZGQgbW9kZWwgc2VsZWN0aW9uIGFzIGZpcnN0IGl0ZW0gaW4gYWN0aW9ucyBkcmF3ZXJcbiAgICBjb25zdCBtb2RlbFNlbGVjdGlvbkFjdGlvbiA9IGFjdGlvbnNDb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW1cIixcbiAgICB9KTtcbiAgICBcbiAgICAvLyBDcmVhdGUgbW9kZWwgaW5kaWNhdG9yIGluc2lkZSB0aGUgZHJhd2VyIGl0ZW1cbiAgICB0aGlzLm1vZGVsSW5kaWNhdG9yID0gbW9kZWxTZWxlY3Rpb25BY3Rpb24uY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmRpY2F0b3ItZHJhd2VyXCIsXG4gICAgICB0ZXh0OiBgQ3VycmVudCBNb2RlbDogJHt0aGlzLnNlbGVjdGVkTW9kZWxJZH1gLFxuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuXG4gICAgLy8gQWRkIHNlcGFyYXRvciBhZnRlciBtb2RlbCBzZWxlY3Rpb25cbiAgICBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1zZXBhcmF0b3JcIlxuICAgIH0pO1xuXG4gICAgY29uc3Qgb3Blbkhpc3RvcnlBY3Rpb24gPSBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtXCIsXG4gICAgICB0ZXh0OiBcIk9wZW4gQ2hhdCBIaXN0b3J5IEZpbGVcIixcbiAgICB9KTtcbiAgICBvcGVuSGlzdG9yeUFjdGlvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeX0vJHt0aGlzLmNoYXRJZH0ubWRgO1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBsb2FkRGlmZmVyZW50Q2hhdEFjdGlvbiA9IGFjdGlvbnNDb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW1cIixcbiAgICAgIHRleHQ6IFwiTG9hZCBBIERpZmZlcmVudCBDaGF0XCIsXG4gICAgfSk7XG4gICAgbG9hZERpZmZlcmVudENoYXRBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBuZXcgbGVhZi90YWJcbiAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKTtcbiAgICAgIC8vIE9wZW4gTG9hZENoYXRNb2RhbCB3aXRoIGNhbGxiYWNrIHRvIGxvYWQgc2VsZWN0ZWQgY2hhdCBpbiBuZXcgbGVhZlxuICAgICAgbmV3IExvYWRDaGF0TW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBhc3luYyAoY2hhdElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBjb25zdCB2aWV3ID0gYXdhaXQgbGVhZi5zZXRWaWV3U3RhdGUoe1xuICAgICAgICAgICAgdHlwZTogQ0hBVF9WSUVXX1RZUEUsXG4gICAgICAgICAgICBzdGF0ZTogeyBjaGF0SWQgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBBY3RpdmF0ZSB0aGUgbmV3IGxlYWZcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICkub3BlbigpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29weUNoYXRBY3Rpb24gPSBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtXCIsXG4gICAgICB0ZXh0OiBcIkNvcHkgQ2hhdCB0byBDbGlwYm9hcmRcIixcbiAgICB9KTtcbiAgICBjb3B5Q2hhdEFjdGlvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5jb3B5VG9DbGlwYm9hcmQoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlbGV0ZUNoYXRBY3Rpb24gPSBhY3Rpb25zQ29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtIHN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbS1kYW5nZXJcIixcbiAgICAgIHRleHQ6IFwiRGVsZXRlIFRoaXMgQ2hhdFwiLFxuICAgIH0pO1xuICAgIGRlbGV0ZUNoYXRBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbGV0ZUNvbmZpcm1lZCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGNoYXQ/XCIsXG4gICAgICAgIHtcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkRlbGV0ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKGRlbGV0ZUNvbmZpcm1lZD8uY29uZmlybWVkKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdHNEaXJlY3Rvcnl9LyR7dGhpcy5jaGF0SWR9Lm1kYDtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5kZWxldGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZWFmLmRldGFjaCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5jaGF0Q29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZXMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIgPSBuZXcgU2Nyb2xsTWFuYWdlclNlcnZpY2Uoe1xuICAgICAgY29udGFpbmVyOiB0aGlzLmNoYXRDb250YWluZXIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmlucHV0SGFuZGxlciA9IG5ldyBJbnB1dEhhbmRsZXIoe1xuICAgICAgYXBwOiB0aGlzLmFwcCxcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIGFpU2VydmljZTogdGhpcy5haVNlcnZpY2UsXG4gICAgICBnZXRNZXNzYWdlczogKCkgPT4gWy4uLnRoaXMubWVzc2FnZXNdLFxuICAgICAgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgIGdldENvbnRleHRGaWxlczogKCkgPT4gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKSxcbiAgICAgIGdldFN5c3RlbVByb21wdDogKCkgPT4gKHtcbiAgICAgICAgdHlwZTogdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBwYXRoOiB0aGlzLnN5c3RlbVByb21wdFBhdGgsXG4gICAgICB9KSxcbiAgICAgIGNoYXRDb250YWluZXI6IHRoaXMuY2hhdENvbnRhaW5lcixcbiAgICAgIHNjcm9sbE1hbmFnZXI6IHRoaXMuc2Nyb2xsTWFuYWdlcixcbiAgICAgIG1lc3NhZ2VSZW5kZXJlcjogdGhpcy5tZXNzYWdlUmVuZGVyZXIsXG4gICAgICBvbk1lc3NhZ2VTdWJtaXQ6IGFzeW5jIChtZXNzYWdlKSA9PiB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuICAgICAgICBhd2FpdCB0aGlzLmFkZE1lc3NhZ2UoXG4gICAgICAgICAgbWVzc2FnZS5yb2xlLFxuICAgICAgICAgIG1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICBtZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBvbkFzc2lzdGFudFJlc3BvbnNlOiBhc3luYyAobWVzc2FnZSkgPT4ge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgIH0sXG4gICAgICBvbkNvbnRleHRGaWxlQWRkOiBhc3luYyAod2lraWxpbmspID0+IHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpO1xuICAgICAgICBmaWxlcy5hZGQod2lraWxpbmspO1xuICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLnNldENvbnRleHRGaWxlcyhBcnJheS5mcm9tKGZpbGVzKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUNoYXQoKTtcbiAgICAgIH0sXG4gICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpLFxuICAgICAgb25BZGRDb250ZXh0RmlsZTogKCkgPT4ge1xuICAgICAgICBjb25zdCBjb250ZXh0QnV0dG9uID0gdGhpcy5jb250ZXh0TWFuYWdlclxuICAgICAgICAgIC5nZXRDb250YWluZXIoKVxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLnN5c3RlbXNjdWxwdC1jb250ZXh0LWFkZC1idXR0b25cIik7XG4gICAgICAgIGlmIChjb250ZXh0QnV0dG9uIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgICBjb250ZXh0QnV0dG9uLmNsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVTeXN0ZW1Qcm9tcHRFZGl0KCk7XG4gICAgICB9LFxuICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgIGNoYXRWaWV3OiB0aGlzLFxuICAgIH0pO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB3ZWIgc2VhcmNoIGJ1dHRvbiBzdGF0ZVxuICAgIHRoaXMuaW5wdXRIYW5kbGVyLm9uTW9kZWxDaGFuZ2UoKTtcblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLCAobGVhZikgPT4ge1xuICAgICAgaWYgKGxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgICB0aGlzLmNoZWNrRm9yVXBkYXRlcygpO1xuICAgICAgICAvLyBGb2N1cyBpbnB1dCB3aGVuIHRoaXMgdmlldyBiZWNvbWVzIGFjdGl2ZVxuICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgc2V0dXBcbiAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuXG4gICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcblxuICAgIGlmICghdGhpcy5hd2FpdGluZ1N0YXRlUmVzdG9yZSAmJiB0aGlzLm1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKCF0aGlzLmNoYXRJZCkge1xuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKG5vdy5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICBjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICBjb25zdCBob3VyID0gU3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IG1pbnV0ZSA9IFN0cmluZyhub3cuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIGNvbnN0IHNlY29uZCA9IFN0cmluZyhub3cuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgIHRoaXMuY2hhdElkID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9ICR7aG91cn0tJHttaW51dGV9LSR7c2Vjb25kfWA7XG4gICAgICAgIHRoaXMuY2hhdFRpdGxlID0gYENoYXQgJHtub3cudG9Mb2NhbGVTdHJpbmcoKX1gO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWZ0ZXIgZXZlcnl0aGluZyBpcyBpbml0aWFsaXplZCwgY2hlY2sgZm9yIG1vZGVsIHNlbGVjdGlvblxuICAgIC8vIFVzZSBzZXRUaW1lb3V0IHRvIGVuc3VyZSB0aGlzIHJ1bnMgYWZ0ZXIgdGhlIHZpZXcgaXMgZnVsbHkgbG9hZGVkXG4gICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJZb3UgZG9uJ3QgaGF2ZSBhIGRlZmF1bHQgbW9kZWwgc2VsZWN0ZWQgeWV0LiBXb3VsZCB5b3UgbGlrZSB0byBjaG9vc2Ugb25lIG5vdz8gVGhpcyB3aWxsIGJlIHVzZWQgYXMgdGhlIGRlZmF1bHQgZm9yIGFsbCBuZXcgY2hhdHMuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiU2VsZWN0IERlZmF1bHQgTW9kZWxcIixcbiAgICAgICAgICAgIGljb246IFwiYm90XCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkNob29zZSBNb2RlbFwiLFxuICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgXCJcIixcbiAgICAgICAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFNldCBhcyBkZWZhdWx0IG1vZGVsIGluIHNldHRpbmdzXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblxuICAgICAgICAgICAgICAgIC8vIEFsc28gc2V0IGZvciB0aGlzIGNoYXQgdmlld1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBtb2RlbHM6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gbG9hZCBhdmFpbGFibGUgbW9kZWxzXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDEwMCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRNZXNzYWdlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY2hhdENvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgY29uc3Qgc2Nyb2xsVG9wID0gdGhpcy5jaGF0Q29udGFpbmVyLnNjcm9sbFRvcDtcbiAgICBjb25zdCBzY3JvbGxIZWlnaHQgPSB0aGlzLmNoYXRDb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIGNvbnN0IGNsaWVudEhlaWdodCA9IHRoaXMuY2hhdENvbnRhaW5lci5jbGllbnRIZWlnaHQ7XG4gICAgY29uc3Qgd2FzQXRCb3R0b20gPSBNYXRoLmFicyhzY3JvbGxIZWlnaHQgLSBzY3JvbGxUb3AgLSBjbGllbnRIZWlnaHQpIDwgMTA7XG5cbiAgICB0aGlzLmNoYXRDb250YWluZXIuZW1wdHkoKTtcbiAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgdGhpcy5tZXNzYWdlcykge1xuICAgICAgYXdhaXQgdGhpcy5hZGRNZXNzYWdlKG1lc3NhZ2Uucm9sZSwgbWVzc2FnZS5jb250ZW50LCBtZXNzYWdlLm1lc3NhZ2VfaWQpO1xuICAgIH1cblxuICAgIGlmICh3YXNBdEJvdHRvbSkge1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhdENvbnRhaW5lci5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVNb2RlbEluZGljYXRvcigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5tb2RlbEluZGljYXRvcikge1xuICAgICAgLy8gUmVtb3ZlIGFueSBleGlzdGluZyBjbGljayBsaXN0ZW5lcnMgdG8gcHJldmVudCBkdXBsaWNhdGVzXG4gICAgICBjb25zdCBuZXdNb2RlbEluZGljYXRvciA9IHRoaXMubW9kZWxJbmRpY2F0b3IuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5yZXBsYWNlV2l0aChuZXdNb2RlbEluZGljYXRvcik7XG4gICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yID0gbmV3TW9kZWxJbmRpY2F0b3IgYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIHRoYXQgd2lsbCBiZSB1c2VkIGluIGJvdGggY2FzZXNcbiAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCB8fCBcIlwiLFxuICAgICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0U2VsZWN0ZWRNb2RlbElkKG1vZGVsSWQpO1xuICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiTW9kZWwgc2VsZWN0ZWQgc3VjY2Vzc2Z1bGx5XCIsIFwiaW5mb1wiKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBJZiBubyBtb2RlbCBpcyBzZWxlY3RlZCwgc2hvdyBhIHByb21wdCB0ZXh0IGluc3RlYWRcbiAgICAgIGlmICghdGhpcy5zZWxlY3RlZE1vZGVsSWQgfHwgdGhpcy5zZWxlY3RlZE1vZGVsSWQudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHsgdGV4dDogXCJObyBtb2RlbCBzZWxlY3RlZFwiIH0pO1xuICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgICAgICAobW9kZWwpID0+IG1vZGVsLmlkID09PSB0aGlzLnNlbGVjdGVkTW9kZWxJZFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBHZXQgdGhlIHByb3ZpZGVyIHByZWZpeFxuICAgICAgICAgIGxldCBwcm92aWRlclByZWZpeCA9IFwiXCI7XG4gICAgICAgICAgaWYgKGN1cnJlbnRNb2RlbCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRNb2RlbC5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgICAgICAgICBwcm92aWRlclByZWZpeCA9IFwiW1NZU1RFTVNDVUxQVF0gXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwcm92aWRlclByZWZpeCA9IGBbJHtjdXJyZW50TW9kZWwucHJvdmlkZXIudG9VcHBlckNhc2UoKX1dIGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5jdXJyZW50TW9kZWxOYW1lID0gY3VycmVudE1vZGVsPy5uYW1lIHx8IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuZW1wdHkoKTtcbiAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHtcbiAgICAgICAgICAgIHRleHQ6IHByb3ZpZGVyUHJlZml4ICsgdGhpcy5jdXJyZW50TW9kZWxOYW1lLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuZW1wdHkoKTtcbiAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LW5vLW1vZGVsXCIpO1xuICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgdGhpcy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHsgdGV4dDogdGhpcy5jdXJyZW50TW9kZWxOYW1lIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjaGVja0ZvclVwZGF0ZXMoKSB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2F2ZWRDaGF0cyA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXRzKCk7XG4gICAgICBjb25zdCBjdXJyZW50Q2hhdCA9IHNhdmVkQ2hhdHMuZmluZCgoYykgPT4gYy5pZCA9PT0gdGhpcy5jaGF0SWQpO1xuXG4gICAgICBpZiAoIWN1cnJlbnRDaGF0KSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGhhc0NoYW5nZXMgPVxuICAgICAgICBjdXJyZW50Q2hhdC5tZXNzYWdlcy5sZW5ndGggIT09IHRoaXMubWVzc2FnZXMubGVuZ3RoIHx8XG4gICAgICAgIGN1cnJlbnRDaGF0LnNlbGVjdGVkTW9kZWxJZCAhPT0gdGhpcy5zZWxlY3RlZE1vZGVsSWQgfHxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoQXJyYXkuZnJvbSh0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpKSkgIT09XG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoY3VycmVudENoYXQuY29udGV4dF9maWxlcykgfHxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY3VycmVudENoYXQubWVzc2FnZXMpICE9PSBKU09OLnN0cmluZ2lmeSh0aGlzLm1lc3NhZ2VzKTtcblxuICAgICAgaWYgKGhhc0NoYW5nZXMpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IGN1cnJlbnRDaGF0Lm1lc3NhZ2VzO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IGN1cnJlbnRDaGF0LnNlbGVjdGVkTW9kZWxJZDtcblxuICAgICAgICBpZiAoY3VycmVudENoYXQuY29udGV4dF9maWxlcykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKGN1cnJlbnRDaGF0LmNvbnRleHRfZmlsZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkTWVzc2FnZXMoKTtcbiAgICAgICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXZlbiBpZiB0aGVyZSBhcmUgbm8gY2hhbmdlcywgY2hlY2sgc3luYyBzdGF0dXMgb2YgY29udGV4dCBmaWxlc1xuICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmNoZWNrU3luY1N0YXR1cygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGZvciB1cGRhdGVzOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzYXZlQ2hhdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY2hhdElkKSB7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICBjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3QgaG91ciA9IFN0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3QgbWludXRlID0gU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIGNvbnN0IHNlY29uZCA9IFN0cmluZyhub3cuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICB0aGlzLmNoYXRJZCA9IGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fSAke2hvdXJ9LSR7bWludXRlfS0ke3NlY29uZH1gO1xuICAgICAgdGhpcy5jaGF0VGl0bGUgPSB0aGlzLmNoYXRUaXRsZSB8fCB0aGlzLmNoYXRJZDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5zYXZlQ2hhdChcbiAgICAgICAgdGhpcy5jaGF0SWQsXG4gICAgICAgIHRoaXMubWVzc2FnZXMsXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoLFxuICAgICAgICB0aGlzLmNoYXRUaXRsZSxcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0LFxuICAgICAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKFwiRmFpbGVkIHRvIHNhdmUgY2hhdFwiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUVycm9yKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcik6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIExvZyBlcnJvciBmaXJzdFxuICAgIGNvbnNvbGUuZXJyb3IoXCJDaGF0IGVycm9yOlwiLCB7XG4gICAgICBlcnJvcixcbiAgICAgIG1lc3NhZ2U6IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3IubWVzc2FnZSxcbiAgICAgIGNvZGU6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5jb2RlIDogdW5kZWZpbmVkLFxuICAgICAgbWV0YWRhdGE6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5tZXRhZGF0YSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcblxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yLm1lc3NhZ2U7XG5cbiAgICBpZiAoXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yICYmXG4gICAgICAoZXJyb3IuY29kZSA9PT0gXCJNT0RFTF9VTkFWQUlMQUJMRVwiIHx8XG4gICAgICAgIGVycm9yLmNvZGUgPT09IFwiTU9ERUxfUkVRVUVTVF9FUlJPUlwiIHx8XG4gICAgICAgIGVycm9yLmNvZGUgPT09IFwiUVVPVEFfRVhDRUVERURcIilcbiAgICApIHtcbiAgICAgIHNob3dFbmhhbmNlZE5vdGljZShlcnJvck1lc3NhZ2UsIFwiZXJyb3JcIiwgZXJyb3IpO1xuXG4gICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgICAgICAgdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICAgIFwiTW9kZWwgY2hhbmdlZC4gWW91IGNhbiBub3cgcmV0cnkgeW91ciBtZXNzYWdlLlwiLFxuICAgICAgICAgICAgXCJpbmZvXCJcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgbW9kZWwgc2VsZWN0aW9uXG4gICAgICAgICAgdGhpcy5mb2N1c0lucHV0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucGx1Z2luXG4gICAgICApO1xuXG4gICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgIG1vZGFsLnNldE1vZGVscyhtb2RlbHMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggbW9kZWxzOlwiLCBlcnIpO1xuICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggYXZhaWxhYmxlIG1vZGVsc1wiLCBcImVycm9yXCIsIGVycik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gdGhpcy5jaGF0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiLnN5c3RlbXNjdWxwdC1tZXNzYWdlOmxhc3QtY2hpbGRcIlxuICAgICAgKTtcbiAgICAgIGlmIChsYXN0TWVzc2FnZSkge1xuICAgICAgICBsYXN0TWVzc2FnZS5yZW1vdmUoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGFzdFVzZXJNZXNzYWdlID0gWy4uLnRoaXMubWVzc2FnZXNdXG4gICAgICAgIC5yZXZlcnNlKClcbiAgICAgICAgLmZpbmQoKG1zZykgPT4gbXNnLnJvbGUgPT09IFwidXNlclwiKTtcbiAgICAgIGlmIChsYXN0VXNlck1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbGFzdFVzZXJNZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIHRoaXMubWVzc2FnZXMuc3BsaWNlKGluZGV4KTtcblxuICAgICAgICAgIGNvbnN0IGFsbE1lc3NhZ2VzID0gdGhpcy5jaGF0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICBcIi5zeXN0ZW1zY3VscHQtbWVzc2FnZVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCBhbGxNZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYWxsTWVzc2FnZXNbaV0ucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuc2V0VmFsdWUoXG4gICAgICAgICAgICB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgPyBsYXN0VXNlck1lc3NhZ2UuY29udGVudFxuICAgICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzaG93RW5oYW5jZWROb3RpY2UoZXJyb3JNZXNzYWdlLCBcImVycm9yXCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9uTGF5b3V0Q2hhbmdlKCkge1xuICAgIGlmICh0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShJdGVtVmlldyk/LmxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgdGhpcy5sYXN0UmVmcmVzaFRpbWUgPSAwO1xuICAgICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcbiAgICAgIC8vIEZvY3VzIGlucHV0IHdoZW4gdGhpcyB2aWV3IGlzIGFjdGl2ZSBhZnRlciBsYXlvdXQgY2hhbmdlXG4gICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVNZXNzYWdlSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIChjKSA9PiB7XG4gICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwO1xuICAgICAgY29uc3QgdiA9IGMgPT09IFwieFwiID8gciA6IChyICYgMHgzKSB8IDB4ODtcbiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU3lzdGVtUHJvbXB0RWRpdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBSZXRyaWV2ZSB0aGUgY3VycmVudCBwcm9tcHQgZnJvbSBwbHVnaW4gc2V0dGluZ3MgaWYgc3lzdGVtUHJvbXB0VHlwZSBpcyBcImN1c3RvbVwiXG4gICAgLy8gZWxzZSBmYWxsYmFjayB0byB0aGUgY29udGVudCBmcm9tIHRoZSBzdG9yZWQgdGV4dCBvciBwcmVzZXQuXG4gICAgbGV0IGN1cnJlbnRDb250ZW50ID0gXCJcIjtcbiAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAvLyBBdHRlbXB0IHRvIHJlYWQgZnJvbSBmaWxlIHVzaW5nIGNoYXQncyBzeXN0ZW1Qcm9tcHRQYXRoOlxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgKHRoaXMuc3lzdGVtUHJvbXB0UGF0aCB8fCBcIlwiKSArIFwiLm1kXCJcbiAgICAgICk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGN1cnJlbnRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZhbGxiYWNrIHRvIHBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRcbiAgICAgICAgY3VycmVudENvbnRlbnQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIHdlIGhhdmUgYSBrbm93biBwcmVzZXQsIHdlIGxvYWQgdGhhdCB2YWx1ZSBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBuZXcgU3lzdGVtUHJvbXB0U2VydmljZSh0aGlzLmFwcCk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcmVzZXQgPSBhd2FpdCBzeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdEJ5SWQoXG4gICAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICBjdXJyZW50Q29udGVudCA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudENvbnRlbnQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgICBjdXJyZW50Q29udGVudCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbW9kZWwncyBjb250ZXh0IGxlbmd0aFxuICAgIGxldCBtb2RlbENvbnRleHRMZW5ndGg6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgY29uc3QgY3VycmVudE1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgIChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMuc2VsZWN0ZWRNb2RlbElkXG4gICAgICApO1xuICAgICAgaWYgKGN1cnJlbnRNb2RlbCkge1xuICAgICAgICBtb2RlbENvbnRleHRMZW5ndGggPSBjdXJyZW50TW9kZWwuY29udGV4dF9sZW5ndGg7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IG1vZGVsIGNvbnRleHQgbGVuZ3RoOlwiLCBlcnJvcik7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1N5c3RlbVByb21wdE1vZGFsKHRoaXMuYXBwLCBjdXJyZW50Q29udGVudCwge1xuICAgICAgbW9kZTogXCJjaGF0LXNwZWNpZmljXCIsXG4gICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDpcbiAgICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoIHx8IHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdFBhdGgsXG4gICAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgICAgbW9kZWxDb250ZXh0TGVuZ3RoLFxuICAgICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U6IHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UsXG4gICAgfSk7XG5cbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICAvLyBVcGRhdGUgbG9jYWwgc3RhdGVzXG4gICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGUgPSByZXN1bHQudHlwZTtcbiAgICAgIGlmIChyZXN1bHQudHlwZSA9PT0gXCJjdXN0b21cIiAmJiByZXN1bHQucGF0aCkge1xuICAgICAgICB0aGlzLnN5c3RlbVByb21wdFBhdGggPSByZXN1bHQucGF0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcmUgYm90aCB0aGUgcGVyY2VudGFnZSBhbmQgY2FsY3VsYXRlZCB0b2tlbiBsaW1pdFxuICAgICAgdGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSA9IHJlc3VsdC50b2tlbkxpbWl0UGVyY2VudGFnZTtcbiAgICAgIHRoaXMudG9rZW5MaW1pdCA9IHJlc3VsdC50b2tlbkxpbWl0O1xuXG4gICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhZGRNZXNzYWdlKFxuICAgIHJvbGU6IENoYXRSb2xlLFxuICAgIGNvbnRlbnQ6IHN0cmluZyB8IE11bHRpUGFydENvbnRlbnRbXSxcbiAgICBleGlzdGluZ01lc3NhZ2VJZD86IHN0cmluZ1xuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBtZXNzYWdlSWQgPSBleGlzdGluZ01lc3NhZ2VJZCB8fCB0aGlzLmdlbmVyYXRlTWVzc2FnZUlkKCk7XG5cbiAgICBjb25zdCB7IG1lc3NhZ2VFbCwgY29udGVudEVsIH0gPSBhd2FpdCB0aGlzLm1lc3NhZ2VSZW5kZXJlci5yZW5kZXJNZXNzYWdlKHtcbiAgICAgIGFwcDogdGhpcy5hcHAsXG4gICAgICBtZXNzYWdlSWQsXG4gICAgICByb2xlLFxuICAgICAgY29udGVudCxcbiAgICB9KTtcblxuICAgIC8vIFN0b3JlIGN1cnJlbnQgY29udGVudCBpbiBkYXRhc2V0IGZvciBlYXN5IHJldHJpZXZhbFxuICAgIGNvbnN0IGNvbnRlbnRTdHIgPVxuICAgICAgdHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIgPyBjb250ZW50IDogSlNPTi5zdHJpbmdpZnkoY29udGVudCk7XG4gICAgbWVzc2FnZUVsLmRhdGFzZXQuY29udGVudCA9IGNvbnRlbnRTdHI7XG5cbiAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlci5hZGRNZXNzYWdlQnV0dG9uVG9vbGJhcihcbiAgICAgIG1lc3NhZ2VFbCxcbiAgICAgIHR5cGVvZiBjb250ZW50ID09PSBcInN0cmluZ1wiID8gY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQpLFxuICAgICAgcm9sZSxcbiAgICAgIG1lc3NhZ2VJZFxuICAgICk7XG5cbiAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcInJlc3VibWl0XCIsIGFzeW5jIChlOiBDdXN0b21FdmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBtZXNzYWdlSWQsIGNvbnRlbnQgfSA9IGUuZGV0YWlsO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaW5kZXgpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAgICAgdGhpcy5jaGF0Q29udGFpbmVyLmVtcHR5KCk7XG4gICAgICAgIGZvciAoY29uc3QgbXNnIG9mIHRoaXMubWVzc2FnZXMpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFkZE1lc3NhZ2UobXNnLnJvbGUsIG1zZy5jb250ZW50LCBtc2cubWVzc2FnZV9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5zZXRWYWx1ZShjb250ZW50KTtcbiAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiZWRpdFwiLCBhc3luYyAoZTogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHsgbWVzc2FnZUlkLCBvbGRDb250ZW50LCBuZXdDb250ZW50IH0gPSBlLmRldGFpbDtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5tZXNzYWdlcy5maW5kSW5kZXgoXG4gICAgICAgIChtc2cpID0+IG1zZy5tZXNzYWdlX2lkID09PSBtZXNzYWdlSWRcbiAgICAgICk7XG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgbWVzc2FnZSBjb250ZW50XG4gICAgICAgIHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQgPSBuZXdDb250ZW50O1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAgICAgLy8gUmUtcmVuZGVyIElOIFBMQUNFIGJ5IHVwZGF0aW5nIGV4aXN0aW5nIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbDogbmV3Q29udGVudEVsIH0gPVxuICAgICAgICAgIGF3YWl0IHRoaXMubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1lc3NhZ2Uoe1xuICAgICAgICAgICAgYXBwOiB0aGlzLmFwcCxcbiAgICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICAgIHJvbGU6IHRoaXMubWVzc2FnZXNbaW5kZXhdLnJvbGUsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLm1lc3NhZ2VzW2luZGV4XS5jb250ZW50LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlcGxhY2UganVzdCB0aGUgY29udGVudCBwb3J0aW9uIHRvIG1haW50YWluIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IG9sZENvbnRlbnRFbCA9IG1lc3NhZ2VFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLnN5c3RlbXNjdWxwdC1tZXNzYWdlLWNvbnRlbnRcIlxuICAgICAgICApO1xuICAgICAgICBpZiAob2xkQ29udGVudEVsICYmIG5ld0NvbnRlbnRFbCkge1xuICAgICAgICAgIG9sZENvbnRlbnRFbC5yZXBsYWNlV2l0aChuZXdDb250ZW50RWwpO1xuICAgICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLnNldHVwSW1hZ2VIYW5kbGVycyhuZXdDb250ZW50RWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGRhdGFzZXQgd2l0aCBuZXcgY29udGVudFxuICAgICAgICBjb25zdCB1cGRhdGVkU3RyID1cbiAgICAgICAgICB0eXBlb2YgdGhpcy5tZXNzYWdlc1tpbmRleF0uY29udGVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgPyB0aGlzLm1lc3NhZ2VzW2luZGV4XS5jb250ZW50XG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KHRoaXMubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQpO1xuICAgICAgICBtZXNzYWdlRWwuZGF0YXNldC5jb250ZW50ID0gdXBkYXRlZFN0cjtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiZGVsZXRlXCIsIGFzeW5jIChlOiBDdXN0b21FdmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBtZXNzYWdlSWQgfSA9IGUuZGV0YWlsO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1lc3NhZ2VzLmZpbmRJbmRleChcbiAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgICAgIG1lc3NhZ2VFbC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQobWVzc2FnZUVsKTtcbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRJbnB1dFZhbHVlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRIYW5kbGVyLmdldFZhbHVlKCk7XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICBpZiAodGhpcy5yZWZyZXNoSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5yZWZyZXNoSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5yZWZyZXNoSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIuY2xlYW51cCgpO1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vZmYoXG4gICAgICBcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLFxuICAgICAgdGhpcy5jaGVja0ZvclVwZGF0ZXMuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5hY3Rpb25zRHJhd2VyLnVubG9hZCgpO1xuICAgIHRoaXMuY29udGV4dE1hbmFnZXIudW5sb2FkKCk7XG4gICAgdGhpcy5pbnB1dEhhbmRsZXIudW5sb2FkKCk7XG4gIH1cblxuICBnZXRTdGF0ZSgpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICBjaGF0SWQ6IHRoaXMuY2hhdElkLFxuICAgICAgc2VsZWN0ZWRNb2RlbElkOiB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgc2V0U3RhdGUoc3RhdGU6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChzdGF0ZS5jaGF0SWQpIHtcbiAgICAgIGF3YWl0IHRoaXMubG9hZENoYXRCeUlkKHN0YXRlLmNoYXRJZCk7XG4gICAgfVxuICAgIHRoaXMuYXdhaXRpbmdTdGF0ZVJlc3RvcmUgPSBmYWxzZTtcbiAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBzdGF0ZSByZXN0b3JlIGlmIHRoaXMgdmlldyBpcyBhY3RpdmVcbiAgICBpZiAodGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoSXRlbVZpZXcpPy5sZWFmID09PSB0aGlzLmxlYWYpIHtcbiAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENoYXRCeUlkKGNoYXRJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoYXREYXRhID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5sb2FkQ2hhdChjaGF0SWQpO1xuICAgICAgaWYgKCFjaGF0RGF0YSkge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNoYXRDb250YWluZXIuZW1wdHkoKTtcbiAgICAgIHRoaXMubWVzc2FnZXMgPSBjaGF0RGF0YS5tZXNzYWdlcztcbiAgICAgIHRoaXMuY2hhdElkID0gY2hhdERhdGEuaWQ7XG4gICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IGNoYXREYXRhLnNlbGVjdGVkTW9kZWxJZDtcbiAgICAgIHRoaXMuY2hhdFRpdGxlID0gY2hhdERhdGEudGl0bGUgfHwgXCJVbnRpdGxlZCBDaGF0XCI7XG5cbiAgICAgIC8vIFVwZGF0ZSBzeXN0ZW0gcHJvbXB0IHNldHRpbmdzIGZyb20gbWV0YWRhdGFcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5nZXRNZXRhZGF0YShjaGF0SWQpO1xuICAgICAgaWYgKG1ldGFkYXRhPy5zeXN0ZW1NZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UudHlwZTtcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0ID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS50b2tlbkxpbWl0O1xuICAgICAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlID0gbWV0YWRhdGEuc3lzdGVtTWVzc2FnZS50b2tlbkxpbWl0UGVyY2VudGFnZTtcbiAgICAgICAgaWYgKG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UucGF0aCkge1xuICAgICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCA9IG1ldGFkYXRhLnN5c3RlbU1lc3NhZ2UucGF0aC5yZXBsYWNlKFxuICAgICAgICAgICAgL15cXFtcXFsoLio/KVxcXVxcXSQvLFxuICAgICAgICAgICAgXCIkMVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbCA9IG1vZGVscy5maW5kKFxuICAgICAgICAgIChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMuc2VsZWN0ZWRNb2RlbElkXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IGN1cnJlbnRNb2RlbD8ubmFtZSB8fCB0aGlzLnNlbGVjdGVkTW9kZWxJZDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsTmFtZSA9IHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2hhdERhdGEuY29udGV4dF9maWxlcykge1xuICAgICAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLnNldENvbnRleHRGaWxlcyhjaGF0RGF0YS5jb250ZXh0X2ZpbGVzKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIHRoaXMubWVzc2FnZXMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGRNZXNzYWdlKFxuICAgICAgICAgIG1lc3NhZ2Uucm9sZSxcbiAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQsXG4gICAgICAgICAgbWVzc2FnZS5tZXNzYWdlX2lkXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcblxuICAgICAgLy8gVXBkYXRlIHdlYiBzZWFyY2ggYnV0dG9uIHN0YXRlXG4gICAgICB0aGlzLmlucHV0SGFuZGxlci5vbk1vZGVsQ2hhbmdlKCk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIltTeXN0ZW1TY3VscHRdIEVycm9yIGluIGxvYWRDaGF0QnlJZDpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRcIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWRkRmlsZVRvQ29udGV4dChmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgfVxuXG4gIGFzeW5jIGNvcHlUb0NsaXBib2FyZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuZ2V0TWFya2Rvd24oKTtcbiAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvbnRlbnQpO1xuICAgICAgc2hvd05vdGljZShcIkNoYXQgY29waWVkIHRvIGNsaXBib2FyZFwiLCB7IHR5cGU6IFwic3VjY2Vzc1wiIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzaG93Tm90aWNlKFwiRmFpbGVkIHRvIGNvcHkgY2hhdCB0byBjbGlwYm9hcmRcIiwgeyB0eXBlOiBcImVycm9yXCIgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldFRva2VuTGltaXQoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy50b2tlbkxpbWl0O1xuICB9XG5cbiAgcHVibGljIGZvY3VzSW5wdXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBEcmFnQW5kRHJvcChjb250YWluZXI6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgLy8gQ3JlYXRlIG92ZXJsYXkgZWxlbWVudHNcbiAgICBjb25zdCBvdmVybGF5ID0gY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhZy1vdmVybGF5XCIsXG4gICAgfSk7XG4gICAgY29uc3QgbWVzc2FnZSA9IG92ZXJsYXkuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmFnLW1lc3NhZ2VcIixcbiAgICAgIHRleHQ6IFwiRHJvcCBmaWxlcyB0byBhZGQgdG8gY29udGV4dFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgTUFYX0ZJTEVTID0gMTAwO1xuXG4gICAgLy8gUGFyc2UgT2JzaWRpYW4gVVJJIHRvIGdldCBmaWxlIHBhdGhcbiAgICBjb25zdCBwYXJzZU9ic2lkaWFuVXJpID0gKHVyaTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIXVyaS5zdGFydHNXaXRoKFwib2JzaWRpYW46Ly9vcGVuXCIpKSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTCh1cmkpO1xuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwiZmlsZVwiKSB8fCBcIlwiKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltEcmFnRHJvcF0gRXJyb3IgcGFyc2luZyBVUkk6XCIsIHVyaSwgZSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBHZXQgZmlsZXMgZnJvbSBmb2xkZXIgcmVjdXJzaXZlbHlcbiAgICBjb25zdCBnZXRGaWxlc0Zyb21Gb2xkZXIgPSAoZm9sZGVyOiBURm9sZGVyKTogVEZpbGVbXSA9PiB7XG4gICAgICBjb25zdCBmaWxlczogVEZpbGVbXSA9IFtdO1xuICAgICAgY29uc3QgcHJvY2Vzc0ZvbGRlciA9IChjdXJyZW50Rm9sZGVyOiBURm9sZGVyKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY3VycmVudEZvbGRlci5jaGlsZHJlbikge1xuICAgICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgICAgcHJvY2Vzc0ZvbGRlcihjaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcHJvY2Vzc0ZvbGRlcihmb2xkZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWxlcy5zbGljZSgwLCBNQVhfRklMRVMpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgLy8gR2V0IGZpbGUgY291bnQgZnJvbSBkYXRhIHRyYW5zZmVyXG4gICAgY29uc3QgZ2V0RmlsZUNvdW50ID0gYXN5bmMgKGR0OiBEYXRhVHJhbnNmZXIpOiBQcm9taXNlPG51bWJlcj4gPT4ge1xuICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuXG4gICAgICBpZiAoY3VycmVudENvbnRleHRTaXplID49IE1BWF9GSUxFUykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVtYWluaW5nU2xvdHMgPSBNQVhfRklMRVMgLSBjdXJyZW50Q29udGV4dFNpemU7XG5cbiAgICAgIGxldCBuZXdGaWxlQ291bnQgPSAwO1xuICAgICAgbGV0IGZpbGVzVG9Qcm9jZXNzOiAoVEZpbGUgfCBURm9sZGVyKVtdID0gW107XG5cbiAgICAgIC8vIFRyeSB0byBnZXQgZmlsZXMgZnJvbSB0ZXh0L3BsYWluIChmb2xkZXIgZHJvcHMpXG4gICAgICBpZiAoZHQuaXRlbXMgJiYgZHQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgQXJyYXkuZnJvbShkdC5pdGVtcykpIHtcbiAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSBcInRleHQvcGxhaW5cIikge1xuICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgaXRlbS5nZXRBc1N0cmluZyhyZXNvbHZlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTcGxpdCBieSBuZXdsaW5lcyBpbiBjYXNlIG9mIG11bHRpcGxlIFVSSXNcbiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKS5maWx0ZXIoKGxpbmUpID0+IGxpbmUudHJpbSgpKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgIGxldCBmaWxlUGF0aCA9IGxpbmU7XG4gICAgICAgICAgICAgIGxldCBhYnN0cmFjdEZpbGUgPSBudWxsO1xuXG4gICAgICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSBhcyBPYnNpZGlhbiBVUkkgZmlyc3RcbiAgICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcIm9ic2lkaWFuOi8vXCIpKSB7XG4gICAgICAgICAgICAgICAgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKGxpbmUpIHx8IGxpbmU7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBUcnkgdG8gZ2V0IHRoZSBmaWxlXG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgICAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZpbGVQYXRoLmluY2x1ZGVzKFwiLlwiKSkge1xuICAgICAgICAgICAgICAgIC8vIFRyeSB3aXRoIC5tZCBleHRlbnNpb25cbiAgICAgICAgICAgICAgICBjb25zdCBtZFBhdGggPSBgJHtmaWxlUGF0aH0ubWRgO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1kRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChtZFBhdGgpO1xuICAgICAgICAgICAgICAgIGlmIChtZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgICAgZmlsZXNUb1Byb2Nlc3MucHVzaChtZEZpbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDb3VudCBmaWxlcyBmcm9tIHRoZSBwcm9jZXNzZWQgaXRlbXNcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBmaWxlc1RvUHJvY2Vzcykge1xuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICBjb25zdCBmb2xkZXJGaWxlcyA9IGdldEZpbGVzRnJvbUZvbGRlcihpdGVtKS5sZW5ndGg7XG4gICAgICAgICAgbmV3RmlsZUNvdW50ICs9IGZvbGRlckZpbGVzO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIG5ld0ZpbGVDb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIElmIG5vIGZpbGVzIGZvdW5kIHlldCwgdHJ5IFVSSSBsaXN0XG4gICAgICBpZiAobmV3RmlsZUNvdW50ID09PSAwICYmIGR0LnR5cGVzLmluY2x1ZGVzKFwidGV4dC91cmktbGlzdFwiKSkge1xuICAgICAgICBjb25zdCB1cmlEYXRhID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgIGR0Lml0ZW1zWzFdLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB1cmlzID0gdXJpRGF0YVxuICAgICAgICAgIC5zcGxpdChcIm9ic2lkaWFuOi8vb3BlblwiKVxuICAgICAgICAgIC5maWx0ZXIoKHVyaSkgPT4gdXJpLnRyaW0oKSlcbiAgICAgICAgICAubWFwKCh1cmkpID0+IFwib2JzaWRpYW46Ly9vcGVuXCIgKyB1cmkudHJpbSgpKTtcblxuICAgICAgICBmb3IgKGNvbnN0IHVyaSBvZiB1cmlzKSB7XG4gICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKHVyaSk7XG4gICAgICAgICAgaWYgKCFmaWxlUGF0aCkgY29udGludWU7XG5cbiAgICAgICAgICBjb25zdCBhYnN0cmFjdEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICBjb25zdCBmb2xkZXJGaWxlcyA9IGdldEZpbGVzRnJvbUZvbGRlcihhYnN0cmFjdEZpbGUpLmxlbmd0aDtcbiAgICAgICAgICAgIG5ld0ZpbGVDb3VudCArPSBmb2xkZXJGaWxlcztcbiAgICAgICAgICB9IGVsc2UgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBuZXdGaWxlQ291bnQrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZmluYWxDb3VudCA9IE1hdGgubWluKG5ld0ZpbGVDb3VudCwgcmVtYWluaW5nU2xvdHMpO1xuICAgICAgcmV0dXJuIGZpbmFsQ291bnQ7XG4gICAgfTtcblxuICAgIC8vIFVwZGF0ZSBtZXNzYWdlIGNvbnRlbnRcbiAgICBjb25zdCB1cGRhdGVNZXNzYWdlID0gYXN5bmMgKGR0OiBEYXRhVHJhbnNmZXIpID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb250ZXh0U2l6ZSA9IHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBgQ2Fubm90IGFkZCBtb3JlIGZpbGVzIChtYXggJHtNQVhfRklMRVN9IHJlYWNoZWQpYDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaWxlQ291bnQgPSBhd2FpdCBnZXRGaWxlQ291bnQoZHQpO1xuICAgICAgaWYgKGZpbGVDb3VudCA+IDApIHtcbiAgICAgICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGBBZGQgJHtmaWxlQ291bnR9IGZpbGUke1xuICAgICAgICAgIGZpbGVDb3VudCA+IDEgPyBcInNcIiA6IFwiXCJcbiAgICAgICAgfSB0byBjb250ZXh0ICgke2N1cnJlbnRDb250ZXh0U2l6ZSArIGZpbGVDb3VudH0vJHtNQVhfRklMRVN9IHRvdGFsKWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gYERyb3AgZmlsZXMgdG8gYWRkIHRvIGNvbnRleHQgKCR7Y3VycmVudENvbnRleHRTaXplfS8ke01BWF9GSUxFU30pYDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gVHJhY2sgZHJhZyBzdGF0ZVxuICAgIGxldCBkcmFnQ291bnRlciA9IDA7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbnRlclwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyKys7XG4gICAgICBpZiAoZHJhZ0NvdW50ZXIgPT09IDEpIHtcbiAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWRyYWctYWN0aXZlXCIpO1xuICAgICAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgICB1cGRhdGVNZXNzYWdlKGUuZGF0YVRyYW5zZmVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnbGVhdmVcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBkcmFnQ291bnRlci0tO1xuICAgICAgaWYgKGRyYWdDb3VudGVyID09PSAwKSB7XG4gICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1kcmFnLWFjdGl2ZVwiKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgYXdhaXQgdXBkYXRlTWVzc2FnZShlLmRhdGFUcmFuc2Zlcik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBkcmFnQ291bnRlciA9IDA7XG4gICAgICBjb250YWluZXIucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtZHJhZy1hY3RpdmVcIik7XG5cbiAgICAgIGNvbnN0IGR0ID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICBpZiAoIWR0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RhcnRpbmdDb250ZXh0U2l6ZSA9IHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgIGlmIChzdGFydGluZ0NvbnRleHRTaXplID49IE1BWF9GSUxFUykge1xuICAgICAgICBjb25zdCB7IGNvbmZpcm1lZCB9ID0gYXdhaXQgc2hvd0FsZXJ0KFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIGBDYW5ub3QgYWRkIG1vcmUgZmlsZXMgKG1heCAke01BWF9GSUxFU30gcmVhY2hlZClgLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwiaW5mb1wiLFxuICAgICAgICAgICAgaWNvbjogXCJhbGVydC10cmlhbmdsZVwiLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBsZXQgZmlsZXNUb1Byb2Nlc3M6IChURmlsZSB8IFRGb2xkZXIpW10gPSBbXTtcblxuICAgICAgICAvLyBGaXJzdCB0cnkgdG8gaGFuZGxlIGl0IGFzIGEgZm9sZGVyIGRyb3BcbiAgICAgICAgaWYgKGR0Lml0ZW1zICYmIGR0Lml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgQXJyYXkuZnJvbShkdC5pdGVtcykpIHtcbiAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgaXRlbS5nZXRBc1N0cmluZyhyZXNvbHZlKTtcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgLy8gU3BsaXQgYnkgbmV3bGluZXMgaW4gY2FzZSBvZiBtdWx0aXBsZSBVUklzXG4gICAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKS5maWx0ZXIoKGxpbmUpID0+IGxpbmUudHJpbSgpKTtcblxuICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgICAgICBsZXQgZmlsZVBhdGggPSBsaW5lO1xuICAgICAgICAgICAgICAgIGxldCBhYnN0cmFjdEZpbGUgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIE9ic2lkaWFuIFVSSSBmaXJzdFxuICAgICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoXCJvYnNpZGlhbjovL1wiKSkge1xuICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKGxpbmUpIHx8IGxpbmU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGdldCB0aGUgZmlsZVxuICAgICAgICAgICAgICAgIGFic3RyYWN0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgICAgICAgICAgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGZpbGUgcmVxdWlyZXMgcHJvIGZlYXR1cmVzXG4gICAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhYnN0cmFjdEZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCByZXF1aXJlc1BybyA9IFtcbiAgICAgICAgICAgICAgICAgICAgXCJwZGZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkb2NcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkb2N4XCIsXG4gICAgICAgICAgICAgICAgICAgIFwibXAzXCIsXG4gICAgICAgICAgICAgICAgICAgIFwid2F2XCIsXG4gICAgICAgICAgICAgICAgICAgIFwibTRhXCIsXG4gICAgICAgICAgICAgICAgICAgIFwib2dnXCIsXG4gICAgICAgICAgICAgICAgICAgIFwid2VibVwiLFxuICAgICAgICAgICAgICAgICAgXS5pbmNsdWRlcyhleHRlbnNpb24pO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVzUHJvICYmXG4gICAgICAgICAgICAgICAgICAgICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZClcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICAgICAgXCJEb2N1bWVudCBwcm9jZXNzaW5nIGlzIGEgUHJvIGZlYXR1cmUuIFN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYW5kIHVubG9jayB0aGlzIGZlYXR1cmUgYnkgYmVjb21pbmcgYSBQYXRyZW9uIG1lbWJlciFcIixcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJCZWNvbWUgYSBQYXRyb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFmaWxlUGF0aC5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgICAgICAgICAgICAgIC8vIFRyeSB3aXRoIC5tZCBleHRlbnNpb25cbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1kUGF0aCA9IGAke2ZpbGVQYXRofS5tZGA7XG4gICAgICAgICAgICAgICAgICBjb25zdCBtZEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgobWRQYXRoKTtcbiAgICAgICAgICAgICAgICAgIGlmIChtZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlc1RvUHJvY2Vzcy5wdXNoKG1kRmlsZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgbm8gZm9sZGVycyBmb3VuZCwgdHJ5IGhhbmRsaW5nIGFzIFVSSSBsaXN0XG4gICAgICAgIGlmIChmaWxlc1RvUHJvY2Vzcy5sZW5ndGggPT09IDAgJiYgZHQudHlwZXMuaW5jbHVkZXMoXCJ0ZXh0L3VyaS1saXN0XCIpKSB7XG4gICAgICAgICAgY29uc3QgdXJpRGF0YSA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGR0Lml0ZW1zWzFdLmdldEFzU3RyaW5nKHJlc29sdmUpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgdXJpcyA9IHVyaURhdGFcbiAgICAgICAgICAgIC5zcGxpdChcIm9ic2lkaWFuOi8vb3BlblwiKVxuICAgICAgICAgICAgLmZpbHRlcigodXJpKSA9PiB1cmkudHJpbSgpKVxuICAgICAgICAgICAgLm1hcCgodXJpKSA9PiBcIm9ic2lkaWFuOi8vb3BlblwiICsgdXJpLnRyaW0oKSk7XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IHVyaSBvZiB1cmlzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkodXJpKTtcbiAgICAgICAgICAgIGlmICghZmlsZVBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBsZXQgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIGZpbGUgcmVxdWlyZXMgcHJvIGZlYXR1cmVzXG4gICAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGFic3RyYWN0RmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZXNQcm8gPSBbXG4gICAgICAgICAgICAgICAgXCJwZGZcIixcbiAgICAgICAgICAgICAgICBcImRvY1wiLFxuICAgICAgICAgICAgICAgIFwiZG9jeFwiLFxuICAgICAgICAgICAgICAgIFwibXAzXCIsXG4gICAgICAgICAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgICAgICAgICBcIm00YVwiLFxuICAgICAgICAgICAgICAgIFwib2dnXCIsXG4gICAgICAgICAgICAgICAgXCJ3ZWJtXCIsXG4gICAgICAgICAgICAgIF0uaW5jbHVkZXMoZXh0ZW5zaW9uKTtcblxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQcm8gJiZcbiAgICAgICAgICAgICAgICAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSB8fFxuICAgICAgICAgICAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZClcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICBcIkRvY3VtZW50IHByb2Nlc3NpbmcgaXMgYSBQcm8gZmVhdHVyZS4gU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBkZXZlbG9wbWVudCBhbmQgdW5sb2NrIHRoaXMgZmVhdHVyZSBieSBiZWNvbWluZyBhIFBhdHJlb24gbWVtYmVyIVwiLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZVwiLFxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSB8fFxuICAgICAgICAgICAgICBhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0b3RhbEZpbGVzQWRkZWQgPSAwO1xuICAgICAgICBjb25zdCByZW1haW5pbmdTbG90cyA9IE1BWF9GSUxFUyAtIHN0YXJ0aW5nQ29udGV4dFNpemU7XG5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGZpbGVzVG9Qcm9jZXNzKSB7XG4gICAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IGdldEZpbGVzRnJvbUZvbGRlcihpdGVtKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb250ZXh0U2l6ZSA9XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgICAgICAgICBpZiAoY3VycmVudENvbnRleHRTaXplID49IE1BWF9GSUxFUykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgY29uZmlybWVkIH0gPSBhd2FpdCBzaG93QWxlcnQoXG4gICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgIGBGaWxlIGxpbWl0IHJlYWNoZWQgKCR7TUFYX0ZJTEVTfSB0b3RhbClgLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImluZm9cIixcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJhbGVydC10cmlhbmdsZVwiLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSByZXF1aXJlcyBwcm8gZmVhdHVyZXNcbiAgICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZXNQcm8gPSBbXG4gICAgICAgICAgICAgICAgXCJwZGZcIixcbiAgICAgICAgICAgICAgICBcImRvY1wiLFxuICAgICAgICAgICAgICAgIFwiZG9jeFwiLFxuICAgICAgICAgICAgICAgIFwibXAzXCIsXG4gICAgICAgICAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgICAgICAgICBcIm00YVwiLFxuICAgICAgICAgICAgICAgIFwib2dnXCIsXG4gICAgICAgICAgICAgICAgXCJ3ZWJtXCIsXG4gICAgICAgICAgICAgIF0uaW5jbHVkZXMoZXh0ZW5zaW9uKTtcblxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQcm8gJiZcbiAgICAgICAgICAgICAgICAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSB8fFxuICAgICAgICAgICAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZClcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICBcIkRvY3VtZW50IHByb2Nlc3NpbmcgaXMgYSBQcm8gZmVhdHVyZS4gU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBkZXZlbG9wbWVudCBhbmQgdW5sb2NrIHRoaXMgZmVhdHVyZSBieSBiZWNvbWluZyBhIFBhdHJlb24gbWVtYmVyIVwiLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZVwiLFxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgICAgICAgICAgICAgICB0b3RhbEZpbGVzQWRkZWQrKztcbiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkQ29udGV4dFNpemUgPVxuICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgICAgICAgICAgIHNob3dOb3RpY2UoXG4gICAgICAgICAgICAgICAgICBgQWRkZWQgJHtmaWxlLm5hbWV9IHRvIGNvbnRleHQgKCR7dXBkYXRlZENvbnRleHRTaXplfS8ke01BWF9GSUxFU30pYCxcbiAgICAgICAgICAgICAgICAgIHsgdHlwZTogXCJzdWNjZXNzXCIgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIltEcmFnRHJvcF0gRXJyb3IgYWRkaW5nIGZpbGUgZnJvbSBmb2xkZXI6XCIsIHtcbiAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGUucGF0aCxcbiAgICAgICAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChpdGVtIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb250ZXh0U2l6ZSA9XG4gICAgICAgICAgICAgIHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgY29uZmlybWVkIH0gPSBhd2FpdCBzaG93QWxlcnQoXG4gICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgYEZpbGUgbGltaXQgcmVhY2hlZCAoJHtNQVhfRklMRVN9IHRvdGFsKWAsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbmZvXCIsXG4gICAgICAgICAgICAgICAgICBpY29uOiBcImFsZXJ0LXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuYWRkRmlsZVRvQ29udGV4dChpdGVtKTtcbiAgICAgICAgICAgIHRvdGFsRmlsZXNBZGRlZCsrO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbnRleHRTaXplID1cbiAgICAgICAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgICAgICAgc2hvd05vdGljZShcbiAgICAgICAgICAgICAgYEFkZGVkICR7aXRlbS5uYW1lfSB0byBjb250ZXh0ICgke3VwZGF0ZWRDb250ZXh0U2l6ZX0vJHtNQVhfRklMRVN9KWAsXG4gICAgICAgICAgICAgIHsgdHlwZTogXCJzdWNjZXNzXCIgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbRHJhZ0Ryb3BdIEVycm9yIHByb2Nlc3NpbmcgZHJvcDpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93QWxlcnQodGhpcy5hcHAsIFwiRmFpbGVkIHRvIHByb2Nlc3MgZHJvcHBlZCBmaWxlc1wiLCB7XG4gICAgICAgICAgdHlwZTogXCJlcnJvclwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBtb2RlbCBJRCBmb3IgdGhpcyBjaGF0IHZpZXdcbiAgICovXG4gIHB1YmxpYyBnZXRTZWxlY3RlZE1vZGVsSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZE1vZGVsSWQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBtb2RlbCBJRCBmb3IgdGhpcyBjaGF0IHZpZXcgYW5kIHVwZGF0ZSB0aGUgVUlcbiAgICovXG4gIHB1YmxpYyBhc3luYyBzZXRTZWxlY3RlZE1vZGVsSWQobW9kZWxJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBtb2RlbElkO1xuICAgIGF3YWl0IHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcbiAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG5cbiAgICAvLyBSZWNhbGN1bGF0ZSB0b2tlbiBsaW1pdCBpZiBuZWVkZWRcbiAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgY29uc3Qgc2VsZWN0ZWRNb2RlbCA9IG1vZGVscy5maW5kKChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IG1vZGVsSWQpO1xuICAgIGlmICh0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlICYmIHNlbGVjdGVkTW9kZWw/LmNvbnRleHRfbGVuZ3RoKSB7XG4gICAgICB0aGlzLnRva2VuTGltaXQgPSBNYXRoLmZsb29yKFxuICAgICAgICAodGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSAvIDEwMCkgKiBzZWxlY3RlZE1vZGVsLmNvbnRleHRfbGVuZ3RoXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ2hhdCgpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB3ZWIgc2VhcmNoIGJ1dHRvbiBzdGF0ZVxuICAgIHRoaXMuaW5wdXRIYW5kbGVyLm9uTW9kZWxDaGFuZ2UoKTtcblxuICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIG1vZGVsIHNlbGVjdGlvblxuICAgIHRoaXMuZm9jdXNJbnB1dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRNYXJrZG93bigpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGxldCBjaGF0Q29udGVudCA9IFwiXCI7XG5cbiAgICAvLyBBZGQgc3lzdGVtIHByb21wdCBpZiBleGlzdHNcbiAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlKSB7XG4gICAgICBsZXQgc3lzdGVtUHJvbXB0Q29udGVudCA9IFwiXCI7XG4gICAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCkge1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCArIFwiLm1kXCJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHRTZXJ2aWNlID0gbmV3IFN5c3RlbVByb21wdFNlcnZpY2UodGhpcy5hcHApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IHN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0QnlJZChcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgICAgc3lzdGVtUHJvbXB0Q29udGVudCA9IHByZXNldC5zeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoc3lzdGVtUHJvbXB0Q29udGVudCkge1xuICAgICAgICBjaGF0Q29udGVudCArPSBgU3lzdGVtIFByb21wdDpcXG5cIlwiXCJcIlwiXFxuJHtzeXN0ZW1Qcm9tcHRDb250ZW50fVxcblwiXCJcIlwiXCJcXG5cXG5gO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCBjb250ZXh0IGZpbGVzXG4gICAgY29uc3QgY29udGV4dEZpbGVzID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKTtcbiAgICBpZiAoY29udGV4dEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICBjaGF0Q29udGVudCArPSBcIkNvbnRleHQgRmlsZXM6XFxuXFxuXCI7XG4gICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgICBpZiAoIWZpbGVQYXRoLnN0YXJ0c1dpdGgoXCJkb2M6XCIpKSB7XG4gICAgICAgICAgLy8gU2tpcCBkb2N1bWVudCByZWZlcmVuY2VzXG4gICAgICAgICAgLy8gQ2xlYW4gdGhlIHdpa2ktbGluayBmb3JtYXQgYW5kIG1hdGggZGlzcGxheSBtYXJrZXJzXG4gICAgICAgICAgY29uc3QgY2xlYW5QYXRoID0gZmlsZVBhdGhcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKVxuICAgICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAgIC9cXCRiZWdpbjptYXRoOmRpc3BsYXlcXCRcXFsoLio/KVxcJGVuZDptYXRoOmRpc3BsYXlcXCRdL2csXG4gICAgICAgICAgICAgIFwiJDFcIlxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIFRyeSB0byByZXNvbHZlIGFuZCByZWFkIHRoZSBmaWxlXG4gICAgICAgICAgY29uc3QgcmVzb2x2ZWRGaWxlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChcbiAgICAgICAgICAgIGNsZWFuUGF0aCxcbiAgICAgICAgICAgIFwiXCJcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHJlc29sdmVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmXG4gICAgICAgICAgICAhcmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi5tYXRjaCgvXihqcGd8anBlZ3xwbmd8Z2lmfHdlYnApJC9pKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQocmVzb2x2ZWRGaWxlKTtcbiAgICAgICAgICAgIGNoYXRDb250ZW50ICs9IGBbJHtjbGVhblBhdGh9XVxcblwiXCJcIlwiXCJcXG4ke2NvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGNoYXQgbWVzc2FnZXNcbiAgICBjaGF0Q29udGVudCArPSBcIkNoYXQgSGlzdG9yeSBUaHVzIEZhcjpcXG5cXG5cIjtcbiAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgdGhpcy5tZXNzYWdlcykge1xuICAgICAgY29uc3Qgcm9sZSA9IG1lc3NhZ2Uucm9sZSA9PT0gXCJhc3Npc3RhbnRcIiA/IFwiQVwiIDogXCJVc2VyXCI7XG4gICAgICBpZiAodHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjaGF0Q29udGVudCArPSBgJHtyb2xlfTpcXG5cIlwiXCJcIlwiXFxuJHttZXNzYWdlLmNvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNoYXRDb250ZW50O1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgcGFyc2VZYW1sLCBzdHJpbmdpZnlZYW1sIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSwgQ2hhdFJvbGUsIFN5c3RlbVByb21wdFByZXNldCB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5pbnRlcmZhY2UgQ29udGV4dEZpbGUge1xuICBwYXRoOiBzdHJpbmc7XG4gIHR5cGU6IFwic291cmNlXCIgfCBcImV4dHJhY3Rpb25cIjtcbn1cblxuaW50ZXJmYWNlIENoYXRNZXRhZGF0YSB7XG4gIGlkOiBzdHJpbmc7XG4gIG1vZGVsOiBzdHJpbmc7XG4gIGNyZWF0ZWQ6IHN0cmluZztcbiAgbGFzdE1vZGlmaWVkOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRleHRfZmlsZXM/OiBDb250ZXh0RmlsZVtdO1xuICBzeXN0ZW1NZXNzYWdlPzoge1xuICAgIHR5cGU6IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIjtcbiAgICBwYXRoPzogc3RyaW5nO1xuICAgIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBDaGF0U3RvcmFnZVNlcnZpY2Uge1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIGNoYXREaXJlY3Rvcnk6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgY2hhdERpcmVjdG9yeTogc3RyaW5nKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5jaGF0RGlyZWN0b3J5ID0gY2hhdERpcmVjdG9yeTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVDaGF0KFxuICAgIGNoYXRJZDogc3RyaW5nLFxuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLFxuICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nLFxuICAgIGNvbnRleHRGaWxlcz86IFNldDxzdHJpbmc+LFxuICAgIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nLFxuICAgIHN5c3RlbVByb21wdFR5cGU/OiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCIsXG4gICAgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZyxcbiAgICB0aXRsZT86IHN0cmluZyxcbiAgICB0b2tlbkxpbWl0PzogbnVtYmVyLFxuICAgIHRva2VuTGltaXRQZXJjZW50YWdlPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuY2hhdERpcmVjdG9yeX0vJHtjaGF0SWR9Lm1kYDtcblxuICAgICAgLy8gQ29udmVydCBTZXQ8c3RyaW5nPiB0byBDb250ZXh0RmlsZVtdXG4gICAgICBjb25zdCBjb250ZXh0RmlsZU9iamVjdHMgPSBjb250ZXh0RmlsZXNcbiAgICAgICAgPyBBcnJheS5mcm9tKGNvbnRleHRGaWxlcykubWFwKChwYXRoKSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGFuIGV4dHJhY3Rpb24gYnkgbG9va2luZyBhdCB0aGUgcGF0aFxuICAgICAgICAgICAgY29uc3QgaXNFeHRyYWN0aW9uID0gcGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIik7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgICB0eXBlOiBpc0V4dHJhY3Rpb25cbiAgICAgICAgICAgICAgICA/IChcImV4dHJhY3Rpb25cIiBhcyBjb25zdClcbiAgICAgICAgICAgICAgICA6IChcInNvdXJjZVwiIGFzIGNvbnN0KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSlcbiAgICAgICAgOiBbXTtcblxuICAgICAgY29uc3QgbWV0YWRhdGE6IENoYXRNZXRhZGF0YSA9IHtcbiAgICAgICAgaWQ6IGNoYXRJZCxcbiAgICAgICAgbW9kZWw6IHNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBsYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8IFwiVW50aXRsZWQgQ2hhdFwiLFxuICAgICAgICBjb250ZXh0X2ZpbGVzOiBjb250ZXh0RmlsZU9iamVjdHMsXG4gICAgICAgIHN5c3RlbU1lc3NhZ2U6IHN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgdHlwZTogc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgICAgICAgcGF0aDpcbiAgICAgICAgICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHN5c3RlbVByb21wdFBhdGhcbiAgICAgICAgICAgICAgICAgID8gYFtbJHtzeXN0ZW1Qcm9tcHRQYXRofV1dYFxuICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHRva2VuTGltaXQsXG4gICAgICAgICAgICAgIHRva2VuTGltaXRQZXJjZW50YWdlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGVudCA9IGAtLS1cXG4ke3N0cmluZ2lmeVlhbWwobWV0YWRhdGEpfS0tLVxcblxcbiR7bWVzc2FnZXNcbiAgICAgICAgLm1hcCgobXNnKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWVzc2FnZVN0YXJ0ID0gYDwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtU1RBUlQgcm9sZT1cIiR7bXNnLnJvbGV9XCIgbWVzc2FnZS1pZD1cIiR7bXNnLm1lc3NhZ2VfaWR9XCIgLS0+YDtcbiAgICAgICAgICByZXR1cm4gYCR7bWVzc2FnZVN0YXJ0fVxcbiR7bXNnLmNvbnRlbnR9XFxuPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+YDtcbiAgICAgICAgfSlcbiAgICAgICAgLmpvaW4oXCJcXG5cXG5cIil9YDtcblxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2Rpcih0aGlzLmNoYXREaXJlY3RvcnkpO1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci53cml0ZShmaWxlUGF0aCwgY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBjaGF0OlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBjaGF0XCIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRDaGF0cygpOiBQcm9taXNlPFxuICAgIHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICAgICAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICAgICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gICAgfVtdXG4gID4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIubGlzdCh0aGlzLmNoYXREaXJlY3RvcnkpO1xuICAgICAgY29uc3QgY2hhdEZpbGVzID0gZmlsZXMuZmlsZXMuZmlsdGVyKChmKSA9PiBmLmVuZHNXaXRoKFwiLm1kXCIpKTtcblxuICAgICAgY29uc3QgY2hhdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgY2hhdEZpbGVzLm1hcChhc3luYyAoZmlsZVBhdGgpID0+IHtcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5yZWFkKGZpbGVQYXRoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZU1hcmtkb3duQ29udGVudChjb250ZW50KTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBjaGF0cy5maWx0ZXIoXG4gICAgICAgIChjaGF0KTogY2hhdCBpcyBOb25OdWxsYWJsZTx0eXBlb2YgY2hhdD4gPT4gY2hhdCAhPT0gbnVsbFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRzOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENoYXQoY2hhdElkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICBpZDogc3RyaW5nO1xuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICAgIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICAgIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICAgIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gIH0gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5jaGF0RGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VNYXJrZG93bkNvbnRlbnQoY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBjaGF0OlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWFya2Rvd25Db250ZW50KFxuICAgIG1ldGFkYXRhOiBDaGF0TWV0YWRhdGEsXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW11cbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCB5YW1sTWV0YWRhdGEgPSB7XG4gICAgICBzeXN0ZW1zY3VscHRfY2hhdDogdHJ1ZSxcbiAgICAgIC4uLm1ldGFkYXRhLFxuICAgIH07XG5cbiAgICBjb25zdCBtZXRhZGF0YVNlY3Rpb24gPSBbXG4gICAgICBcIi0tLVwiLFxuICAgICAgc3RyaW5naWZ5WWFtbCh5YW1sTWV0YWRhdGEpLnRyaW0oKSxcbiAgICAgIFwiLS0tXCIsXG4gICAgICBcIlwiLFxuICAgIF0uam9pbihcIlxcblwiKTtcblxuICAgIGNvbnN0IG1lc3NhZ2VzU2VjdGlvbiA9IG1lc3NhZ2VzXG4gICAgICAubWFwKChtc2cpID0+XG4gICAgICAgIFtcbiAgICAgICAgICBgPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1TVEFSVCByb2xlPVwiJHttc2cucm9sZX1cIiBtZXNzYWdlLWlkPVwiJHttc2cubWVzc2FnZV9pZH1cIiAtLT5gLFxuICAgICAgICAgIG1zZy5jb250ZW50LFxuICAgICAgICAgIFwiPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+XCIsXG4gICAgICAgICAgXCJcIixcbiAgICAgICAgXS5qb2luKFwiXFxuXCIpXG4gICAgICApXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIHJldHVybiBtZXRhZGF0YVNlY3Rpb24gKyBtZXNzYWdlc1NlY3Rpb247XG4gIH1cblxuICBwcml2YXRlIHBhcnNlTWV0YWRhdGEoY29udGVudDogc3RyaW5nKTogQ2hhdE1ldGFkYXRhIHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1ldGFkYXRhTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC8tLS1cXG4oW1xcc1xcU10qPylcXG4tLS0vKTtcbiAgICAgIGlmICghbWV0YWRhdGFNYXRjaCkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlWWFtbChtZXRhZGF0YU1hdGNoWzFdKTtcbiAgICAgIGlmICghcGFyc2VkIHx8IHR5cGVvZiBwYXJzZWQgIT09IFwib2JqZWN0XCIpIHJldHVybiBudWxsO1xuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGlkLFxuICAgICAgICBtb2RlbCxcbiAgICAgICAgY3JlYXRlZCxcbiAgICAgICAgbGFzdE1vZGlmaWVkLFxuICAgICAgICB0aXRsZSxcbiAgICAgICAgY29udGV4dF9maWxlcyxcbiAgICAgICAgc3lzdGVtTWVzc2FnZSxcbiAgICAgIH0gPSBwYXJzZWQ7XG4gICAgICBpZiAoIWlkIHx8ICFtb2RlbCB8fCAhY3JlYXRlZCB8fCAhbGFzdE1vZGlmaWVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgLy8gQ29udmVydCBvbGQgZm9ybWF0IChzdHJpbmdbXSkgdG8gbmV3IGZvcm1hdCAoQ29udGV4dEZpbGVbXSlcbiAgICAgIGNvbnN0IHByb2Nlc3NlZENvbnRleHRGaWxlcyA9IGNvbnRleHRfZmlsZXM/Lm1hcChcbiAgICAgICAgKGZpbGU6IHN0cmluZyB8IENvbnRleHRGaWxlKSA9PiB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBmaWxlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAvLyBMZWdhY3kgZm9ybWF0IC0gY29udmVydCB0byBuZXcgZm9ybWF0XG4gICAgICAgICAgICBjb25zdCBpc0V4dHJhY3Rpb24gPSBmaWxlLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBhdGg6IGZpbGUsXG4gICAgICAgICAgICAgIHR5cGU6IGlzRXh0cmFjdGlvblxuICAgICAgICAgICAgICAgID8gKFwiZXh0cmFjdGlvblwiIGFzIGNvbnN0KVxuICAgICAgICAgICAgICAgIDogKFwic291cmNlXCIgYXMgY29uc3QpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGg6IGZpbGUucGF0aCxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBDbGVhbiB1cCBzeXN0ZW0gbWVzc2FnZSBwYXRoIGlmIGl0IGV4aXN0c1xuICAgICAgaWYgKHN5c3RlbU1lc3NhZ2U/LnBhdGgpIHtcbiAgICAgICAgc3lzdGVtTWVzc2FnZS5wYXRoID0gc3lzdGVtTWVzc2FnZS5wYXRoLnJlcGxhY2UoXG4gICAgICAgICAgL15cXFtcXFsoLio/KVxcXVxcXSQvLFxuICAgICAgICAgIFwiJDFcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZCxcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIGNyZWF0ZWQsXG4gICAgICAgIGxhc3RNb2RpZmllZCxcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8IFwiVW50aXRsZWQgQ2hhdFwiLFxuICAgICAgICBjb250ZXh0X2ZpbGVzOiBwcm9jZXNzZWRDb250ZXh0RmlsZXMgfHwgW10sXG4gICAgICAgIHN5c3RlbU1lc3NhZ2UsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIG1ldGFkYXRhOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBhcnNlTWFya2Rvd25Db250ZW50KGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gICAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gICAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgfSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLnBhcnNlTWV0YWRhdGEoY29udGVudCk7XG4gICAgICBpZiAoIW1ldGFkYXRhKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXTtcblxuICAgICAgLy8gUGFyc2UgdXNlciBhbmQgYXNzaXN0YW50IG1lc3NhZ2VzXG4gICAgICBjb25zdCBtZXNzYWdlUmVnZXggPVxuICAgICAgICAvPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1TVEFSVCByb2xlPVwiKHVzZXJ8YXNzaXN0YW50KVwiIG1lc3NhZ2UtaWQ9XCIoW15cIl0rKVwiIC0tPlxcbihbXFxzXFxTXSo/KVxcbjwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtRU5EIC0tPi9nO1xuXG4gICAgICBsZXQgbXNnTWF0Y2g7XG4gICAgICB3aGlsZSAoKG1zZ01hdGNoID0gbWVzc2FnZVJlZ2V4LmV4ZWMoY29udGVudCkpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IFssIHJvbGUsIG1lc3NhZ2VJZCwgbWVzc2FnZUNvbnRlbnRdID0gbXNnTWF0Y2g7XG4gICAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgIHJvbGU6IHJvbGUgYXMgQ2hhdFJvbGUsXG4gICAgICAgICAgY29udGVudDogbWVzc2FnZUNvbnRlbnQudHJpbSgpLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvbnZlcnQgQ29udGV4dEZpbGVbXSB0byBzdHJpbmdbXSBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgY29uc3QgY29udGV4dEZpbGVzID0gbWV0YWRhdGEuY29udGV4dF9maWxlcz8ubWFwKChmaWxlKSA9PlxuICAgICAgICB0eXBlb2YgZmlsZSA9PT0gXCJzdHJpbmdcIiA/IGZpbGUgOiBmaWxlLnBhdGhcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBtZXRhZGF0YS5pZCxcbiAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgIHNlbGVjdGVkTW9kZWxJZDogbWV0YWRhdGEubW9kZWwsXG4gICAgICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUobWV0YWRhdGEubGFzdE1vZGlmaWVkKS5nZXRUaW1lKCksXG4gICAgICAgIHRpdGxlOiBtZXRhZGF0YS50aXRsZSxcbiAgICAgICAgY29udGV4dF9maWxlczogY29udGV4dEZpbGVzLFxuICAgICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDogbWV0YWRhdGEuc3lzdGVtTWVzc2FnZT8ucGF0aCxcbiAgICAgICAgdG9rZW5MaW1pdDogbWV0YWRhdGEuc3lzdGVtTWVzc2FnZT8udG9rZW5MaW1pdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgbWFya2Rvd24gY29udGVudDpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lc3NhZ2VJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0TWV0YWRhdGEoY2hhdElkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRNZXRhZGF0YSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLmNoYXREaXJlY3Rvcnl9LyR7Y2hhdElkfS5tZGA7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZU1ldGFkYXRhKGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBtZXRhZGF0YTpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIFNjcm9sbFN0YXRlIHtcbiAgaXNBdXRvU2Nyb2xsRW5hYmxlZDogYm9vbGVhbjtcbiAgaXNVc2VyU2Nyb2xsaW5nOiBib29sZWFuO1xuICBsYXN0Q29udGVudEhlaWdodDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU2Nyb2xsQ29uZmlnIHtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgb25TY3JvbGxTdGF0ZUNoYW5nZT86IChpc0F1dG9TY3JvbGxFbmFibGVkOiBib29sZWFuKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgU2Nyb2xsTWFuYWdlclNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRlOiBTY3JvbGxTdGF0ZSA9IHtcbiAgICBpc0F1dG9TY3JvbGxFbmFibGVkOiB0cnVlLFxuICAgIGlzVXNlclNjcm9sbGluZzogZmFsc2UsXG4gICAgbGFzdENvbnRlbnRIZWlnaHQ6IDAsXG4gIH07XG4gIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvblNjcm9sbFN0YXRlQ2hhbmdlPzogKGlzQXV0b1Njcm9sbEVuYWJsZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBTY3JvbGxDb25maWcpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbmZpZy5jb250YWluZXI7XG4gICAgdGhpcy5vblNjcm9sbFN0YXRlQ2hhbmdlID0gY29uZmlnLm9uU2Nyb2xsU3RhdGVDaGFuZ2U7XG4gICAgdGhpcy5hdHRhY2hFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhdHRhY2hFdmVudExpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgdGhpcy5oYW5kbGVXaGVlbCk7XG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdGhpcy5oYW5kbGVUb3VjaFN0YXJ0KTtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5oYW5kbGVUb3VjaEVuZCk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVNjcm9sbCA9IGRlYm91bmNlKCgpID0+IHtcbiAgICBjb25zdCBpc0F0Qm90dG9tID0gdGhpcy5pc1Njcm9sbGVkVG9Cb3R0b20oKTtcbiAgICBpZiAoaXNBdEJvdHRvbSAmJiAhdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkKSB7XG4gICAgICB0aGlzLmVuYWJsZUF1dG9TY3JvbGwoKTtcbiAgICB9IGVsc2UgaWYgKCFpc0F0Qm90dG9tICYmIHRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCkge1xuICAgICAgdGhpcy5kaXNhYmxlQXV0b1Njcm9sbCgpO1xuICAgIH1cbiAgfSwgMTUwKTtcblxuICBwcml2YXRlIGhhbmRsZVdoZWVsID0gKGU6IFdoZWVsRXZlbnQpID0+IHtcbiAgICBpZiAoZS5kZWx0YVkgPCAwKSB7XG4gICAgICB0aGlzLmRpc2FibGVBdXRvU2Nyb2xsKCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgaGFuZGxlVG91Y2hTdGFydCA9ICgpID0+IHtcbiAgICB0aGlzLnN0YXRlLmlzVXNlclNjcm9sbGluZyA9IHRydWU7XG4gIH07XG5cbiAgcHJpdmF0ZSBoYW5kbGVUb3VjaEVuZCA9ICgpID0+IHtcbiAgICB0aGlzLnN0YXRlLmlzVXNlclNjcm9sbGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmlzU2Nyb2xsZWRUb0JvdHRvbSgpKSB7XG4gICAgICB0aGlzLmVuYWJsZUF1dG9TY3JvbGwoKTtcbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSBpc1Njcm9sbGVkVG9Cb3R0b20oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyBzY3JvbGxIZWlnaHQsIHNjcm9sbFRvcCwgY2xpZW50SGVpZ2h0IH0gPSB0aGlzLmNvbnRhaW5lcjtcbiAgICByZXR1cm4gTWF0aC5hYnMoc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wIC0gY2xpZW50SGVpZ2h0KSA8IDEwO1xuICB9XG5cbiAgcHVibGljIHNjcm9sbFRvQm90dG9tKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkKSByZXR1cm47XG5cbiAgICAvLyBGb3JjZSBsYXlvdXQgcmVjYWxjdWxhdGlvbiB0byBlbnN1cmUgcHJvcGVyIHNjcm9sbGluZ1xuICAgIC8vIFRoaXMgaXMgbmVlZGVkIGVzcGVjaWFsbHkgZm9yIHRoZSBmaXJzdCBtZXNzYWdlIHdoZW4gdGhlcmUncyBubyBzY3JvbGxiYXIgeWV0XG4gICAgdm9pZCB0aGlzLmNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG8oe1xuICAgICAgICB0b3A6IHRoaXMuY29udGFpbmVyLnNjcm9sbEhlaWdodCxcbiAgICAgICAgYmVoYXZpb3I6IHRoaXMuc3RhdGUuaXNVc2VyU2Nyb2xsaW5nID8gXCJzbW9vdGhcIiA6IFwiYXV0b1wiLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnN0YXRlLmxhc3RDb250ZW50SGVpZ2h0ID0gdGhpcy5jb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBlbmFibGVBdXRvU2Nyb2xsKCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCA9IHRydWU7XG4gICAgdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXRlLmxhc3RDb250ZW50SGVpZ2h0ID0gdGhpcy5jb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICB0aGlzLm9uU2Nyb2xsU3RhdGVDaGFuZ2U/Lih0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzYWJsZUF1dG9TY3JvbGwoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5vblNjcm9sbFN0YXRlQ2hhbmdlPy4oZmFsc2UpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUNvbnRlbnRIZWlnaHQoKTogdm9pZCB7XG4gICAgLy8gRm9yY2UgbGF5b3V0IHJlY2FsY3VsYXRpb25cbiAgICB2b2lkIHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodDtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50SGVpZ2h0ID0gdGhpcy5jb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgICAgaWYgKGN1cnJlbnRIZWlnaHQgIT09IHRoaXMuc3RhdGUubGFzdENvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5sYXN0Q29udGVudEhlaWdodCA9IGN1cnJlbnRIZWlnaHQ7XG4gICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IGNvbnRlbnQgKG5vIHNjcm9sbCB5ZXQpIG9yIHdlJ3JlIGFscmVhZHkgYXQgYm90dG9tXG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wIHx8IHRoaXMuaXNTY3JvbGxlZFRvQm90dG9tKCkpIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhbnVwKCk6IHZvaWQge1xuICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5oYW5kbGVTY3JvbGwpO1xuICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCB0aGlzLmhhbmRsZVdoZWVsKTtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCB0aGlzLmhhbmRsZVRvdWNoU3RhcnQpO1xuICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLmhhbmRsZVRvdWNoRW5kKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IENvbXBvbmVudCwgUGxhdGZvcm0gfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGludGVyZmFjZSBEcmF3ZXJPcHRpb25zIHtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgdGl0bGU6IHN0cmluZztcbiAgY2xzPzogc3RyaW5nO1xuICBvblZpc2liaWxpdHlDaGFuZ2U/OiAodmlzaWJsZTogYm9vbGVhbikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIERyYXdlckNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgZHJhd2VyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBoZWFkZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGNvbnRlbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHRvZ2dsZTogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgaXNNb3VzZUluUHJveGltaXR5ID0gZmFsc2U7XG4gIHByaXZhdGUgaGlkZVRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb3B0aW9uczogRHJhd2VyT3B0aW9ucztcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBEcmF3ZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuaW5pdGlhbGl6ZURyYXdlcigpO1xuICAgIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRHJhd2VyKCk6IHZvaWQge1xuICAgIHRoaXMuZHJhd2VyID0gdGhpcy5vcHRpb25zLmNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtZHJhd2VyICR7dGhpcy5vcHRpb25zLmNscyB8fCBcIlwifWAsXG4gICAgfSk7XG5cbiAgICB0aGlzLmhlYWRlciA9IHRoaXMuZHJhd2VyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWhlYWRlclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGl0bGVFbCA9IHRoaXMuaGVhZGVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLXRpdGxlXCIsXG4gICAgfSk7XG4gICAgdGl0bGVFbC5jcmVhdGVTcGFuKHsgdGV4dDogdGhpcy5vcHRpb25zLnRpdGxlIH0pO1xuXG4gICAgdGhpcy50b2dnbGUgPSB0aGlzLmhlYWRlci5jcmVhdGVTcGFuKHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLXRvZ2dsZVwiLFxuICAgICAgdGV4dDogXCJcdTI1QkNcIixcbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudCA9IHRoaXMuZHJhd2VyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNvbnRlbnRcIixcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0VmlzaWJpbGl0eShmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgLy8gVXNlIGhvdmVyIGJlaGF2aW9yIGZvciBhbGwgZGV2aWNlc1xuICAgIHRoaXMuZHJhd2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jb250ZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5kcmF3ZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmRyYXdlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IDI1O1xuXG4gICAgICBpZiAoXG4gICAgICAgIGUuY2xpZW50WSA+PSByZWN0LmJvdHRvbSAmJlxuICAgICAgICBlLmNsaWVudFkgPD0gcmVjdC5ib3R0b20gKyBidWZmZXIgJiZcbiAgICAgICAgZS5jbGllbnRYID49IHJlY3QubGVmdCAmJlxuICAgICAgICBlLmNsaWVudFggPD0gcmVjdC5yaWdodFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NoZWR1bGVIaWRlKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNvbnRlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCBidWZmZXIgPSAyNTtcblxuICAgICAgaWYgKFxuICAgICAgICBlLmNsaWVudFkgPD0gcmVjdC50b3AgJiZcbiAgICAgICAgZS5jbGllbnRZID49IHJlY3QudG9wIC0gYnVmZmVyICYmXG4gICAgICAgIGUuY2xpZW50WCA+PSByZWN0LmxlZnQgJiZcbiAgICAgICAgZS5jbGllbnRYIDw9IHJlY3QucmlnaHRcbiAgICAgICkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaXNNb3VzZUluUHJveGltaXR5ID0gZmFsc2U7XG4gICAgICB0aGlzLnNjaGVkdWxlSGlkZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGNsaWNrIGJlaGF2aW9yIGZvciBhbGwgZGV2aWNlc1xuICAgIHRoaXMuaGVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBpc1Zpc2libGUgPSB0aGlzLmNvbnRlbnQuc3R5bGUub3BhY2l0eSA9PT0gXCIxXCI7XG4gICAgICB0aGlzLnNldFZpc2liaWxpdHkoIWlzVmlzaWJsZSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFySGlkZVRpbWVvdXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGlkZVRpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmhpZGVUaW1lb3V0KTtcbiAgICAgIHRoaXMuaGlkZVRpbWVvdXQgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2NoZWR1bGVIaWRlKCk6IHZvaWQge1xuICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgIHRoaXMuaGlkZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkpIHtcbiAgICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCAxMDApO1xuICB9XG5cbiAgcHVibGljIHNldFZpc2liaWxpdHkodmlzaWJsZTogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuY29udGVudC5zdHlsZS5vcGFjaXR5ID0gdmlzaWJsZSA/IFwiMVwiIDogXCIwXCI7XG4gICAgdGhpcy5jb250ZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSB2aXNpYmxlID8gXCJhbGxcIiA6IFwibm9uZVwiO1xuICAgIHRoaXMuY29udGVudC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgke3Zpc2libGUgPyBcIjBcIiA6IFwiLThweFwifSlgO1xuICAgIHRoaXMudG9nZ2xlLnN0eWxlLnRyYW5zZm9ybSA9IHZpc2libGUgPyBcInJvdGF0ZSgwKVwiIDogXCJyb3RhdGUoLTkwZGVnKVwiO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5vblZpc2liaWxpdHlDaGFuZ2UpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5vblZpc2liaWxpdHlDaGFuZ2UodmlzaWJsZSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldENvbnRlbnQoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0RHJhd2VyKCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5kcmF3ZXI7XG4gIH1cblxuICBwdWJsaWMgZ2V0SGVhZGVyKCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5oZWFkZXI7XG4gIH1cblxuICBvbnVubG9hZCgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFySGlkZVRpbWVvdXQoKTtcbiAgICBzdXBlci5vbnVubG9hZCgpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgTWFya2Rvd25SZW5kZXJlciwgVEZpbGUsIEFwcCwgQ29tcG9uZW50LCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0Um9sZSwgSW1hZ2VDb250ZW50LCBNdWx0aVBhcnRDb250ZW50IH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAsIFRleHRBcmVhTW9kYWwgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VSZW5kZXJPcHRpb25zIHtcbiAgYXBwOiBBcHA7XG4gIG1lc3NhZ2VJZDogc3RyaW5nO1xuICByb2xlOiBDaGF0Um9sZTtcbiAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xufVxuXG5leHBvcnQgY2xhc3MgTWVzc2FnZVJlbmRlcmVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVuZGVyTWVzc2FnZSh7XG4gICAgYXBwLFxuICAgIG1lc3NhZ2VJZCxcbiAgICByb2xlLFxuICAgIGNvbnRlbnQsXG4gIH06IHtcbiAgICBhcHA6IEFwcDtcbiAgICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgICByb2xlOiBDaGF0Um9sZTtcbiAgICBjb250ZW50OiBzdHJpbmcgfCBNdWx0aVBhcnRDb250ZW50W107XG4gIH0pOiBQcm9taXNlPHsgbWVzc2FnZUVsOiBIVE1MRWxlbWVudDsgY29udGVudEVsOiBIVE1MRWxlbWVudCB9PiB7XG4gICAgY29uc3QgbWVzc2FnZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtZXNzYWdlRWwuY2xhc3NMaXN0LmFkZChcInN5c3RlbXNjdWxwdC1tZXNzYWdlXCIpO1xuICAgIG1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKGBzeXN0ZW1zY3VscHQtJHtyb2xlfS1tZXNzYWdlYCk7XG4gICAgbWVzc2FnZUVsLmRhdGFzZXQubWVzc2FnZUlkID0gbWVzc2FnZUlkO1xuXG4gICAgY29uc3QgY29udGVudEVsID0gbWVzc2FnZUVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIC8vIEV4aXN0aW5nIHBhdGg6IHRyZWF0IGl0IGFzIG1hcmtkb3duIHRleHRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oY29udGVudCwgY29udGVudEVsLCBcIlwiLCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudCBhcyBNdWx0aVBhcnRDb250ZW50W107XG4gICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHtcbiAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAvLyBTaW1wbGUgdGV4dCBzbmlwcGV0XG4gICAgICAgICAgY29uc3QgcCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcInBcIik7XG4gICAgICAgICAgcC5zZXRUZXh0KHBhcnQudGV4dCk7XG4gICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBcImltYWdlX3VybFwiKSB7XG4gICAgICAgICAgLy8gSW5zZXJ0IHRoZSA8aW1nPlxuICAgICAgICAgIGNvbnN0IGltZyA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImltZ1wiLCB7XG4gICAgICAgICAgICBhdHRyOiB7IHNyYzogcGFydC5pbWFnZV91cmwudXJsIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaW1nLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1pbWFnZVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjayBpZiBuZWVkZWRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgIFN0cmluZyhjb250ZW50KSxcbiAgICAgICAgY29udGVudEVsLFxuICAgICAgICBcIlwiLFxuICAgICAgICB0aGlzXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnNldHVwSW1hZ2VIYW5kbGVycyhjb250ZW50RWwpO1xuXG4gICAgcmV0dXJuIHsgbWVzc2FnZUVsLCBjb250ZW50RWwgfTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZW5kZXJNYXJrZG93bkNvbnRlbnQoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29uc3QgbWFya2Rvd25XcmFwcGVyID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tYXJrZG93bi13cmFwcGVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvXFxuezMsfS9nLCBcIlxcblxcblwiKTtcblxuICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICBub3JtYWxpemVkQ29udGVudCxcbiAgICAgIG1hcmtkb3duV3JhcHBlcixcbiAgICAgIFwiXCIsXG4gICAgICB0aGlzXG4gICAgKTtcblxuICAgIG1hcmtkb3duV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKFwicHJlXCIpLmZvckVhY2goKHByZUVsKSA9PiB7XG4gICAgICBjb25zdCBjb2RlQmxvY2tXcmFwcGVyID0gY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvZGUtYmxvY2std3JhcHBlclwiLFxuICAgICAgfSk7XG5cbiAgICAgIHByZUVsLnBhcmVudE5vZGU/LnJlcGxhY2VDaGlsZChjb2RlQmxvY2tXcmFwcGVyLCBwcmVFbCk7XG4gICAgICBjb2RlQmxvY2tXcmFwcGVyLmFwcGVuZENoaWxkKHByZUVsKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXR1cEltYWdlSGFuZGxlcnMoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29udGFpbmVyRWwucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKS5mb3JFYWNoKChpbWcpID0+IHtcbiAgICAgIGltZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGNvbnN0IHNyYyA9IGltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gICAgICAgIGlmICghc3JjKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHNyYy5zdGFydHNXaXRoKFwiYXBwOi8vXCIpKSB7XG4gICAgICAgICAgY29uc3QgcGF0aCA9IHNyYy5yZXBsYWNlKFwiYXBwOi8vbG9jYWwvXCIsIFwiXCIpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQocGF0aCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb29sYmFyVmlzaWJpbGl0eShcbiAgICB0b29sYmFyOiBIVE1MRWxlbWVudCxcbiAgICB2aXNpYmxlOiBib29sZWFuLFxuICAgIGV4cGFuZGVkOiBib29sZWFuID0gZmFsc2VcbiAgKTogdm9pZCB7XG4gICAgdG9vbGJhci5zdHlsZS5vcGFjaXR5ID0gdmlzaWJsZSA/IFwiMVwiIDogXCIwXCI7XG4gICAgdG9vbGJhci5zdHlsZS5wb2ludGVyRXZlbnRzID0gdmlzaWJsZSA/IFwiYWxsXCIgOiBcIm5vbmVcIjtcbiAgICB0b29sYmFyLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKGNhbGMoMTAwJSArICR7XG4gICAgICBleHBhbmRlZCA/IFwiNFwiIDogXCI4XCJcbiAgICB9cHgpKWA7XG4gIH1cblxuICBwdWJsaWMgYWRkTWVzc2FnZUJ1dHRvblRvb2xiYXIoXG4gICAgbWVzc2FnZUVsOiBIVE1MRWxlbWVudCxcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgcm9sZTogQ2hhdFJvbGUsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmdcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYnV0dG9uVG9vbGJhciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uLXRvb2xiYXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvcHlCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb3B5QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiQ29weSBtZXNzYWdlIHRvIGNsaXBib2FyZFwiKTtcbiAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICBjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb250ZW50KTtcbiAgICAgIHNldEljb24oY29weUJ1dHRvbiwgXCJjaGVja1wiKTtcbiAgICAgIGNvcHlCdXR0b24uY2xhc3NMaXN0LmFkZChcInN1Y2Nlc3NcIik7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICAgICAgY29weUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic3VjY2Vzc1wiKTtcbiAgICAgICAgdGhpcy5zZXRUb29sYmFyVmlzaWJpbGl0eShidXR0b25Ub29sYmFyLCBmYWxzZSk7XG4gICAgICB9LCAyMDAwKTtcbiAgICB9KTtcblxuICAgIGlmIChyb2xlID09PSBcInVzZXJcIikge1xuICAgICAgY29uc3QgcmVzdWJtaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlLWJ1dHRvblwiLFxuICAgICAgfSk7XG4gICAgICByZXN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlJlc3VibWl0IHRoaXMgbWVzc2FnZVwiKTtcbiAgICAgIHNldEljb24ocmVzdWJtaXRCdXR0b24sIFwicm90YXRlLWNjd1wiKTtcbiAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJyb3RhdGUtY2N3XCI7XG5cbiAgICAgIHJlc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBpc0NvbmZpcm1pbmcgPSByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPT09IFwidHJ1ZVwiO1xuXG4gICAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJ0cnVlXCI7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0P1wiIH0pO1xuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcblxuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZCA9IHRpbWVvdXRJZC50b1N0cmluZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHJlc3VibWl0QnV0dG9uLmRhdGFzZXQudGltZW91dElkO1xuICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0dGluZy4uLlwiIH0pO1xuXG4gICAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJyZXN1Ym1pdFwiLCB7XG4gICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQsIGNvbnRlbnQgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFuIFwiRWRpdFwiIGJ1dHRvblxuICAgIGNvbnN0IGVkaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBlZGl0QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRWRpdCB0aGlzIG1lc3NhZ2VcIik7XG4gICAgc2V0SWNvbihlZGl0QnV0dG9uLCBcInBlbmNpbFwiKTtcbiAgICBlZGl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJwZW5jaWxcIjtcblxuICAgIC8vIEhhbmRsZSBjbGljayBcdTIxOTIgb3BlbiBhbiBlZGl0aW5nIG1vZGFsXG4gICAgZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIFVzZSBleGlzdGluZyB0ZXh0LWFyZWEgbW9kYWwgZm9yIGVkaXRpbmdcbiAgICAgIC8vIEdldCBjdXJyZW50IGNvbnRlbnQgZnJvbSBkYXRhc2V0IHdoaWNoIGlzIGFsd2F5cyB1cC10by1kYXRlXG4gICAgICBjb25zdCBjdXJyZW50Q29udGVudCA9IG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgfHwgY29udGVudDtcbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IFRleHRBcmVhTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkVkaXQgTWVzc2FnZVwiLFxuICAgICAgICBjdXJyZW50Q29udGVudCxcbiAgICAgICAge1xuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiU2F2ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICByb3dzOiAxMCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgbmV3VGV4dCA9IGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xuICAgICAgaWYgKG5ld1RleHQgIT09IG51bGwgJiYgbmV3VGV4dCAhPT0gY3VycmVudENvbnRlbnQpIHtcbiAgICAgICAgLy8gRGlzcGF0Y2ggZWRpdCBldmVudCB3aXRoIG9sZCBhbmQgbmV3IGNvbnRlbnRcbiAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KFwiZWRpdFwiLCB7XG4gICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgZGV0YWlsOiB7XG4gICAgICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICAgICAgb2xkQ29udGVudDogY3VycmVudENvbnRlbnQsXG4gICAgICAgICAgICAgIG5ld0NvbnRlbnQ6IG5ld1RleHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZWxldGVCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b24gZGFuZ2VyXCIsXG4gICAgfSk7XG4gICAgZGVsZXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRGVsZXRlIHRoaXMgbWVzc2FnZVwiKTtcbiAgICBzZXRJY29uKGRlbGV0ZUJ1dHRvbiwgXCJ0cmFzaFwiKTtcbiAgICBkZWxldGVCdXR0b24uZGF0YXNldC5vcmlnaW5hbEljb24gPSBcInRyYXNoXCI7XG5cbiAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgaXNDb25maXJtaW5nID0gZGVsZXRlQnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9PT0gXCJ0cnVlXCI7XG5cbiAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcInRydWVcIjtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmVtcHR5KCk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIkRlbGV0ZT9cIiB9KTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIpO1xuXG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDMwMDApO1xuICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC50aW1lb3V0SWQgPSB0aW1lb3V0SWQudG9TdHJpbmcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZDtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGVCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNyZWF0ZUVsKFwic3BhblwiLCB7IHRleHQ6IFwiRGVsZXRpbmcuLi5cIiB9KTtcblxuICAgICAgICBtZXNzYWdlRWwuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJkZWxldGVcIiwge1xuICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQgfSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgdHJ1ZSwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgIWUucmVsYXRlZFRhcmdldCB8fFxuICAgICAgICAhYnV0dG9uVG9vbGJhci5jb250YWlucyhlLnJlbGF0ZWRUYXJnZXQgYXMgTm9kZSlcbiAgICAgICkge1xuICAgICAgICB0aGlzLnNldFRvb2xiYXJWaXNpYmlsaXR5KGJ1dHRvblRvb2xiYXIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGJ1dHRvblRvb2xiYXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFtZXNzYWdlRWwuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0IGFzIE5vZGUpKSB7XG4gICAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVJlYXNvbmluZ0NvbnRhaW5lcihtZXNzYWdlRWw6IEhUTUxFbGVtZW50KToge1xuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgY29udGVudDogSFRNTEVsZW1lbnQ7XG4gIH0ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1oZWFkZXJcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGhlYWRlciwgXCJicmFpblwiKTtcbiAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiUmVhc29uaW5nXCIgfSk7XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlciB0byB0b2dnbGUgY29sbGFwc2VcbiAgICBoZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKFwiY29sbGFwc2VkXCIpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBjb250YWluZXIsIGNvbnRlbnQgfTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVSZWFzb25pbmdDb250ZW50KFxuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQsXG4gICAgcmVhc29uaW5nOiBzdHJpbmcsXG4gICAgaXNDb21wbGV0ZTogYm9vbGVhbiA9IGZhbHNlXG4gICk6IHZvaWQge1xuICAgIGxldCBjb250YWluZXIgPSBtZXNzYWdlRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGFpbmVyXCJcbiAgICApO1xuICAgIGxldCBjb250ZW50ID0gbWVzc2FnZUVsLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIpO1xuXG4gICAgaWYgKCFjb250YWluZXIgfHwgIWNvbnRlbnQpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5jcmVhdGVSZWFzb25pbmdDb250YWluZXIobWVzc2FnZUVsKTtcbiAgICAgIGNvbnRhaW5lciA9IGVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgICAgIGNvbnRlbnQgPSBlbGVtZW50cy5jb250ZW50O1xuICAgICAgbWVzc2FnZUVsLnByZXBlbmQoY29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBjb250ZW50LnRleHRDb250ZW50ID0gcmVhc29uaW5nO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcblxuICAgIC8vIEF1dG8tY29sbGFwc2Ugd2hlbiBzdHJlYW1pbmcgaXMgY29tcGxldGVcbiAgICBpZiAoaXNDb21wbGV0ZSkge1xuICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJjb2xsYXBzZWRcIik7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgc2V0SWNvbiwgQ29tcG9uZW50LCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7XG4gIENoYXRNZXNzYWdlLFxuICBTeXN0ZW1Qcm9tcHRJbmZvLFxuICBDaGF0Um9sZSxcbiAgTXVsdGlQYXJ0Q29udGVudCxcbiAgUEFUUkVPTl9VUkwsXG59IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBFUlJPUl9DT0RFUywgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi4vLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UsIHNob3dQb3B1cCB9IGZyb20gXCIuLi8uLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBJbWFnZVByb2Nlc3NvciB9IGZyb20gXCIuLi8uLi91dGlscy9JbWFnZVByb2Nlc3NvclwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB7IE1lc3NhZ2VSZW5kZXJlciB9IGZyb20gXCIuL01lc3NhZ2VSZW5kZXJlclwiO1xuaW1wb3J0IHsgUmVjb3JkZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1JlY29yZGVyU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5wdXRIYW5kbGVyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIGdldE1lc3NhZ2VzOiAoKSA9PiBDaGF0TWVzc2FnZVtdO1xuICBnZXRTZWxlY3RlZE1vZGVsSWQ6ICgpID0+IHN0cmluZztcbiAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiBTeXN0ZW1Qcm9tcHRJbmZvO1xuICBjaGF0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIG1lc3NhZ2VSZW5kZXJlcjogTWVzc2FnZVJlbmRlcmVyO1xuICBvbk1lc3NhZ2VTdWJtaXQ6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBvbkNvbnRleHRGaWxlQWRkOiAod2lraWxpbms6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25FcnJvcjogKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcikgPT4gdm9pZDtcbiAgb25BZGRDb250ZXh0RmlsZTogKCkgPT4gdm9pZDtcbiAgb25FZGl0U3lzdGVtUHJvbXB0OiAoKSA9PiB2b2lkO1xuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgY2hhdFZpZXc6IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIElucHV0SGFuZGxlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBhaVNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZ2V0TWVzc2FnZXM6ICgpID0+IENoYXRNZXNzYWdlW107XG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiBzdHJpbmc7XG4gIHByaXZhdGUgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBTZXQ8c3RyaW5nPjtcbiAgcHJpdmF0ZSBnZXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IFN5c3RlbVByb21wdEluZm87XG4gIHByaXZhdGUgY2hhdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2Nyb2xsTWFuYWdlcjogU2Nyb2xsTWFuYWdlclNlcnZpY2U7XG4gIHByaXZhdGUgbWVzc2FnZVJlbmRlcmVyOiBNZXNzYWdlUmVuZGVyZXI7XG4gIHByaXZhdGUgb25NZXNzYWdlU3VibWl0OiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgb25Bc3Npc3RhbnRSZXNwb25zZTogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIG9uQ29udGV4dEZpbGVBZGQ6ICh3aWtpbGluazogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIG9uRXJyb3I6IChlcnJvcjogc3RyaW5nIHwgU3lzdGVtU2N1bHB0RXJyb3IpID0+IHZvaWQ7XG4gIHByaXZhdGUgb25BZGRDb250ZXh0RmlsZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgaW5wdXQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHByaXZhdGUgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gIHByaXZhdGUgcmVuZGVyVGltZW91dDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWNvcmRlclNlcnZpY2U6IFJlY29yZGVyU2VydmljZTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBpbnB1dENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgYnV0dG9uR3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcmVjb3JkZXJWaXN1YWxpemVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzUmVjb3JkaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgdXBkYXRlR2VuZXJhdGluZ1N0YXRlOiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIGFib3J0Q29udHJvbGxlcjogQWJvcnRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc3RvcEJ1dHRvbjogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBjaGF0VmlldzogYW55O1xuICBwcml2YXRlIHdlYlNlYXJjaEVuYWJsZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSB3ZWJTZWFyY2hCdXR0b246IEhUTUxFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElucHV0SGFuZGxlck9wdGlvbnMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYXBwID0gb3B0aW9ucy5hcHA7XG4gICAgdGhpcy5jb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjtcbiAgICB0aGlzLmFpU2VydmljZSA9IG9wdGlvbnMuYWlTZXJ2aWNlO1xuICAgIHRoaXMuZ2V0TWVzc2FnZXMgPSBvcHRpb25zLmdldE1lc3NhZ2VzO1xuICAgIHRoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkID0gb3B0aW9ucy5nZXRTZWxlY3RlZE1vZGVsSWQ7XG4gICAgdGhpcy5nZXRDb250ZXh0RmlsZXMgPSBvcHRpb25zLmdldENvbnRleHRGaWxlcztcbiAgICB0aGlzLmdldFN5c3RlbVByb21wdCA9IG9wdGlvbnMuZ2V0U3lzdGVtUHJvbXB0O1xuICAgIHRoaXMuY2hhdENvbnRhaW5lciA9IG9wdGlvbnMuY2hhdENvbnRhaW5lcjtcbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIgPSBvcHRpb25zLnNjcm9sbE1hbmFnZXI7XG4gICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIgPSBvcHRpb25zLm1lc3NhZ2VSZW5kZXJlcjtcbiAgICB0aGlzLm9uTWVzc2FnZVN1Ym1pdCA9IG9wdGlvbnMub25NZXNzYWdlU3VibWl0O1xuICAgIHRoaXMub25Bc3Npc3RhbnRSZXNwb25zZSA9IG9wdGlvbnMub25Bc3Npc3RhbnRSZXNwb25zZTtcbiAgICB0aGlzLm9uQ29udGV4dEZpbGVBZGQgPSBvcHRpb25zLm9uQ29udGV4dEZpbGVBZGQ7XG4gICAgdGhpcy5vbkVycm9yID0gb3B0aW9ucy5vbkVycm9yO1xuICAgIHRoaXMub25BZGRDb250ZXh0RmlsZSA9IG9wdGlvbnMub25BZGRDb250ZXh0RmlsZTtcbiAgICB0aGlzLm9uRWRpdFN5c3RlbVByb21wdCA9IG9wdGlvbnMub25FZGl0U3lzdGVtUHJvbXB0O1xuICAgIHRoaXMucGx1Z2luID0gb3B0aW9ucy5wbHVnaW47XG4gICAgdGhpcy5jaGF0VmlldyA9IG9wdGlvbnMuY2hhdFZpZXc7XG5cbiAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyBJbnB1dEhhbmRsZXIgd2l0aCBSZWNvcmRlclNlcnZpY2VcIik7XG4gICAgdGhpcy5yZWNvcmRlclNlcnZpY2UgPSBSZWNvcmRlclNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcy5hcHAsIHRoaXMucGx1Z2luLCB7XG4gICAgICBpc0luQ2hhdDogdHJ1ZSxcbiAgICAgIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiAodGV4dDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUmVjZWl2ZWQgdHJhbnNjcmlwdGlvbiwgaW5zZXJ0aW5nIGF0IGN1cnNvciBwb3NpdGlvblwiKTtcbiAgICAgICAgdGhpcy5pbnNlcnRUZXh0QXRDdXJzb3IodGV4dCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gU2ltcGxpZnkgbWVzc2FnZSBoYW5kbGVyc1xuICAgIGNvbnN0IG9yaWdpbmFsTWVzc2FnZVN1Ym1pdCA9IG9wdGlvbnMub25NZXNzYWdlU3VibWl0O1xuICAgIHRoaXMub25NZXNzYWdlU3VibWl0ID0gYXN5bmMgKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiB7XG4gICAgICBhd2FpdCBvcmlnaW5hbE1lc3NhZ2VTdWJtaXQobWVzc2FnZSk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9yaWdpbmFsQXNzaXN0YW50UmVzcG9uc2UgPSBvcHRpb25zLm9uQXNzaXN0YW50UmVzcG9uc2U7XG4gICAgdGhpcy5vbkFzc2lzdGFudFJlc3BvbnNlID0gYXN5bmMgKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiB7XG4gICAgICBhd2FpdCBvcmlnaW5hbEFzc2lzdGFudFJlc3BvbnNlKG1lc3NhZ2UpO1xuICAgIH07XG5cbiAgICB0aGlzLnNldHVwSW5wdXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBJbnB1dCgpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0Q29udGFpbmVyID0gdGhpcy5jb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIHRoaXMuYnV0dG9uR3JpZCA9IHRoaXMuaW5wdXRDb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24tZ3JpZFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXR0YWNoQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJBZGQgYXR0YWNobWVudFwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihhdHRhY2hCdXR0b24sIFwicGFwZXJjbGlwXCIpO1xuICAgIGF0dGFjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgIC8vIFNISUZULWNsaWNrID0+IGRpcmVjdCB1cGxvYWQgdG8gc2VydmVyXG4gICAgICAgIHRoaXMuaGFuZGxlRG9jdW1lbnRVcGxvYWQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlZ3VsYXIgY2xpY2sgPT4gYWRkIGNvbnRleHQgZmlsZSBhcyBiZWZvcmVcbiAgICAgICAgdGhpcy5vbkFkZENvbnRleHRGaWxlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBzZXR0aW5nc0J1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiU3lzdGVtIHByb21wdCBzZXR0aW5nc1wiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihzZXR0aW5nc0J1dHRvbiwgXCJzZXR0aW5nc1wiKTtcbiAgICBzZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vbkVkaXRTeXN0ZW1Qcm9tcHQoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHdlYlNlYXJjaEJ1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiVG9nZ2xlIHdlYiBzZWFyY2hcIiB9LFxuICAgIH0pO1xuICAgIHRoaXMud2ViU2VhcmNoQnV0dG9uID0gd2ViU2VhcmNoQnV0dG9uO1xuICAgIHNldEljb24od2ViU2VhcmNoQnV0dG9uLCBcImdsb2JlXCIpO1xuICAgIHdlYlNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2V0IGN1cnJlbnQgcHJvdmlkZXIgaW5mb1xuICAgICAgY29uc3QgaXNOYXRpdmVQcm92aWRlciA9XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLnR5cGUgPT09IFwibmF0aXZlXCI7XG4gICAgICBjb25zdCBjdXJyZW50UHJvdmlkZXIgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMuZmluZChcbiAgICAgICAgKHApID0+IHAuaWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLmlkXG4gICAgICApO1xuICAgICAgY29uc3QgaXNPcGVuUm91dGVyID0gY3VycmVudFByb3ZpZGVyPy5lbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIik7XG5cbiAgICAgIC8vIE9ubHkgYWxsb3cgd2ViIHNlYXJjaCBmb3IgbmF0aXZlIG1vZGVscyBvciBPcGVuUm91dGVyXG4gICAgICBpZiAoIWlzTmF0aXZlUHJvdmlkZXIgJiYgIWlzT3BlblJvdXRlcikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJXZWIgc2VhcmNoIGFsbG93cyB0aGUgQUkgdG8gYWNjZXNzIHJlYWwtdGltZSBpbmZvcm1hdGlvbiBmcm9tIHRoZSBpbnRlcm5ldCB0byBwcm92aWRlIHVwLXRvLWRhdGUgYW5zd2Vycy5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJGZWF0dXJlIFJlc3RyaWN0aW9uIC0gV2ViIFNlYXJjaFwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICAgIFwiV2ViIHNlYXJjaCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgU3lzdGVtU2N1bHB0IGFuZCBPcGVuUm91dGVyIG1vZGVscy4gUGxlYXNlIHN3aXRjaCB0byBhIGNvbXBhdGlibGUgbW9kZWwgdG8gdXNlIHRoaXMgZmVhdHVyZS5cIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy53ZWJTZWFyY2hFbmFibGVkID0gIXRoaXMud2ViU2VhcmNoRW5hYmxlZDtcbiAgICAgIHdlYlNlYXJjaEJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiaXMtZW5hYmxlZFwiLCB0aGlzLndlYlNlYXJjaEVuYWJsZWQpO1xuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgcHJvIGxpY2Vuc2VcbiAgICBjb25zdCBoYXNQcm9MaWNlbnNlID1cbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSAmJlxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkO1xuXG4gICAgLy8gQ3JlYXRlIG1pYyBidXR0b24gd2l0aCBwcm8tb25seSBoYW5kbGluZ1xuICAgIGNvbnN0IG1pY0J1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvbiBzeXN0ZW1zY3VscHQtbWljLWJ1dHRvbiR7XG4gICAgICAgIGhhc1Byb0xpY2Vuc2UgPyBcIlwiIDogXCIgcHJvLWZlYXR1cmVcIlxuICAgICAgfWAsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIFwiYXJpYS1sYWJlbFwiOiBoYXNQcm9MaWNlbnNlXG4gICAgICAgICAgPyBcIlJlY29yZCBhdWRpbyBtZXNzYWdlXCJcbiAgICAgICAgICA6IFwiUmVjb3JkIGF1ZGlvIG1lc3NhZ2UgKFBybyBmZWF0dXJlKVwiLFxuICAgICAgICBcImFyaWEtZGlzYWJsZWRcIjogKCFoYXNQcm9MaWNlbnNlKS50b1N0cmluZygpLFxuICAgICAgICB0aXRsZTogaGFzUHJvTGljZW5zZVxuICAgICAgICAgID8gXCJSZWNvcmQgYXVkaW8gbWVzc2FnZVwiXG4gICAgICAgICAgOiBcIlJlY29yZGluZyBpcyBhIFBybyBmZWF0dXJlLiBDbGljayB0byBsZWFybiBtb3JlLlwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKG1pY0J1dHRvbiwgXCJtaWNcIik7XG5cbiAgICAvLyBBZGQvcmVtb3ZlIGRpc2FibGVkIGNsYXNzIGJhc2VkIG9uIGxpY2Vuc2Ugc3RhdHVzXG4gICAgbWljQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCAhaGFzUHJvTGljZW5zZSk7XG5cbiAgICBtaWNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghaGFzUHJvTGljZW5zZSkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJWb2ljZSByZWNvcmRpbmcgYWxsb3dzIHlvdSB0byBxdWlja2x5IGNhcHR1cmUgeW91ciB0aG91Z2h0cyBieSBzcGVha2luZyBpbnN0ZWFkIG9mIHR5cGluZy4gVGhpcyBmZWF0dXJlIGluY2x1ZGVzIGF1dG9tYXRpYyB0cmFuc2NyaXB0aW9uIG9mIHlvdXIgcmVjb3JkaW5ncyB0byB0ZXh0LlwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlIC0gVm9pY2UgUmVjb3JkaW5nXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgXCJTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgdm9pY2UgcmVjb3JkaW5nLCB0cmFuc2NyaXB0aW9uLCBhbmQgb3RoZXIgcHJlbWl1bSBmZWF0dXJlcyBieSBiZWNvbWluZyBhIFBhdHJlb24gbWVtYmVyIVwiLFxuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJCZWNvbWUgYSBQYXRyb25cIixcbiAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmhhbmRsZU1pY0NsaWNrKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzZW5kQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvbiBzeXN0ZW1zY3VscHQtc2VuZC1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiU2VuZCBtZXNzYWdlXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKHNlbmRCdXR0b24sIFwic2VuZFwiKTtcbiAgICBzZW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhhbmRsZVNlbmRNZXNzYWdlLmJpbmQodGhpcykpO1xuXG4gICAgLy8gQ3JlYXRlIHN0b3AgYnV0dG9uIChoaWRkZW4gYnkgZGVmYXVsdClcbiAgICB0aGlzLnN0b3BCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1zdG9wLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJTdG9wIGdlbmVyYXRpb25cIiB9LFxuICAgIH0pO1xuICAgIHNldEljb24odGhpcy5zdG9wQnV0dG9uLCBcInNxdWFyZVwiKTtcbiAgICB0aGlzLnN0b3BCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHRoaXMuc3RvcEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJjbGlja1wiLFxuICAgICAgdGhpcy5oYW5kbGVTdG9wR2VuZXJhdGlvbi5iaW5kKHRoaXMpXG4gICAgKTtcblxuICAgIHRoaXMuaW5wdXQgPSB0aGlzLmlucHV0Q29udGFpbmVyLmNyZWF0ZUVsKFwidGV4dGFyZWFcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dCBzeXN0ZW1zY3VscHQtY2hhdC1pbnB1dFwiLFxuICAgICAgYXR0cjoge1xuICAgICAgICByb3dzOiBcIjFcIixcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiVHlwZSBhIG1lc3NhZ2UuLi5cIixcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmUgdG9rZW4gY291bnRlciBlbGVtZW50IGNyZWF0aW9uIGFuZCBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCB0aGlzLmFkanVzdElucHV0SGVpZ2h0LmJpbmQodGhpcykpO1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcInBhc3RlXCIsIHRoaXMuaGFuZGxlUGFzdGUuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBTaW1wbGlmaWVkIHJlY29yZGVyIGhhbmRsaW5nXG4gICAgdGhpcy5yZWNvcmRlclNlcnZpY2Uub25Ub2dnbGUoKGlzUmVjb3JkaW5nKSA9PiB7XG4gICAgICB0aGlzLmlzUmVjb3JkaW5nID0gaXNSZWNvcmRpbmc7XG4gICAgICBjb25zdCBtaWNCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuc3lzdGVtc2N1bHB0LW1pYy1idXR0b25cIlxuICAgICAgKTtcbiAgICAgIGlmIChtaWNCdXR0b24pIHtcbiAgICAgICAgbWljQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmVcIiwgaXNSZWNvcmRpbmcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIFVJIHdoZW4gZ2VuZXJhdGluZyBzdGF0ZSBjaGFuZ2VzXG4gICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUgPSAoKSA9PiB7XG4gICAgICB0aGlzLmlucHV0LmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBzZW5kQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBtaWNCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIGF0dGFjaEJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgc2V0dGluZ3NCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIHdlYlNlYXJjaEJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuXG4gICAgICBpZiAodGhpcy5zdG9wQnV0dG9uKSB7XG4gICAgICAgIHRoaXMuc3RvcEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5pc0dlbmVyYXRpbmcgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgICAgICBzZW5kQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmlzR2VuZXJhdGluZyA/IFwibm9uZVwiIDogXCJmbGV4XCI7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLmlzR2VuZXJhdGluZ1xuICAgICAgICA/IFwiV2FpdGluZyBmb3IgcmVzcG9uc2UuLi5cIlxuICAgICAgICA6IFwiVHlwZSBhIG1lc3NhZ2UuLi5cIjtcblxuICAgICAgLy8gVG9nZ2xlIGRpc2FibGVkIGNsYXNzZXNcbiAgICAgIHRoaXMuaW5wdXQuY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIHNlbmRCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIG1pY0J1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgYXR0YWNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICBzZXR0aW5nc0J1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU3RvcEdlbmVyYXRpb24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuYWJvcnRDb250cm9sbGVyKSB7XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMudXBkYXRlR2VuZXJhdGluZ1N0YXRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTZW5kTWVzc2FnZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBGaXJzdCwgY2hlY2sgaWYgYSBtb2RlbCBpcyBzZWxlY3RlZFxuICAgIGNvbnN0IGN1cnJlbnRNb2RlbElkID0gdGhpcy5nZXRTZWxlY3RlZE1vZGVsSWQoKTtcbiAgICBpZiAoIWN1cnJlbnRNb2RlbElkIHx8IGN1cnJlbnRNb2RlbElkLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIk5vIG1vZGVsIHNlbGVjdGVkXCIsIHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUGxlYXNlIHNlbGVjdCBhbiBBSSBtb2RlbCBiZWZvcmUgc2VuZGluZyBhIG1lc3NhZ2UuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiU2VsZWN0IE1vZGVsXCIsXG4gICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgIH0pO1xuICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgIC8vIE9wZW4gdGhlIG1vZGVsIHNlbGVjdGlvbiBtb2RhbFxuICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIFwiXCIsIC8vIG5vIG1vZGVsIGlzIHNlbGVjdGVkIGN1cnJlbnRseVxuICAgICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY2hhdCB2aWV3IHdpdGggdGhlIGNob3NlbiBtb2RlbFxuICAgICAgICAgICAgYXdhaXQgKHRoaXMuY2hhdFZpZXcgYXMgYW55KS5zZXRTZWxlY3RlZE1vZGVsSWQobW9kZWxJZCk7XG4gICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXG4gICAgICAgICAgICAgIFwiTW9kZWwgc2VsZWN0ZWQuIFBsZWFzZSByZS1zZW5kIHlvdXIgbWVzc2FnZS5cIixcbiAgICAgICAgICAgICAgXCJpbmZvXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICApO1xuICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47IC8vIERvIG5vdCBwcm9jZWVkIHdpdGggc2VuZGluZyB0aGUgbWVzc2FnZVxuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBsaWNlbnNlIGtleSBvbmx5IHdoZW4gdXNpbmcgbmF0aXZlIFN5c3RlbVNjdWxwdCBtb2RlbHNcbiAgICBpZiAoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci50eXBlID09PSBcIm5hdGl2ZVwiICYmXG4gICAgICAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXkgfHxcbiAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXkudHJpbSgpKVxuICAgICkge1xuICAgICAgc2hvd1BvcHVwKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgXCJZb3UgZG9uJ3QgaGF2ZSBhIGxpY2Vuc2Uga2V5LiBQbGVhc2UgYWRkIGEgdmFsaWQgbGljZW5zZSBrZXkgaW4gc2V0dGluZ3MgdG8gdXNlIFN5c3RlbVNjdWxwdCBBSSBzcGVjaWZpYyBtb2RlbHMuXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJMaWNlbnNlIEtleSBSZXF1aXJlZFwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjb250ZW50ID0gdGhpcy5pbnB1dC52YWx1ZS50cmltKCk7XG4gICAgaWYgKCFjb250ZW50IHx8IHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG5cbiAgICB0aGlzLmlucHV0LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLmFkanVzdElucHV0SGVpZ2h0KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIHVzZXIgbWVzc2FnZVxuICAgICAgY29uc3QgdXNlck1lc3NhZ2VJZCA9IHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKTtcbiAgICAgIGNvbnN0IHVzZXJNZXNzYWdlOiBDaGF0TWVzc2FnZSA9IHtcbiAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgIGNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IHVzZXJNZXNzYWdlSWQsXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2RpZnkgdGhlIG1vZGVsIElEIGlmIHdlYiBzZWFyY2ggaXMgZW5hYmxlZFxuICAgICAgY29uc3QgbW9kZWxJZCA9IHRoaXMud2ViU2VhcmNoRW5hYmxlZFxuICAgICAgICA/IGAke3RoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkKCl9Om9ubGluZWBcbiAgICAgICAgOiB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCgpO1xuXG4gICAgICAvLyBTZW5kIHRoZSBtZXNzYWdlIGFuZCBwcmVwYXJlIGZvciBhc3Npc3RhbnQgcmVzcG9uc2VcbiAgICAgIGF3YWl0IHRoaXMub25NZXNzYWdlU3VibWl0KHVzZXJNZXNzYWdlKTtcblxuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuXG4gICAgICAvLyBQcmVwYXJlIGFzc2lzdGFudCBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgY29uc3QgeyBtZXNzYWdlRWwsIGNvbnRlbnRFbCB9ID0gdGhpcy5jcmVhdGVBc3Npc3RhbnRNZXNzYWdlQ29udGFpbmVyKCk7XG4gICAgICBtZXNzYWdlRWwuc2V0QXR0cmlidXRlKFwiZGF0YS1tZXNzYWdlLWlkXCIsIHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKSk7XG4gICAgICBtZXNzYWdlRWwuYXBwZW5kQ2hpbGQoY29udGVudEVsKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSByZXNwb25zZSBoYW5kbGluZ1xuICAgICAgbGV0IGZ1bGxSZXNwb25zZSA9IFwiXCI7XG4gICAgICBsZXQgYWNjdW11bGF0ZWRSZWFzb25pbmcgPSBcIlwiO1xuICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUoKTtcblxuICAgICAgY29uc3QgbG9hZGluZ0VsID0gY29udGVudEVsLmNyZWF0ZUVsKFwic3BhblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbG9hZGluZ1wiLFxuICAgICAgICB0ZXh0OiBcIiBcdTI1Q0YgVGhpbmtpbmcuLi5cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgdG8gRE9NIGFuZCBzY3JvbGxcbiAgICAgIHRoaXMuY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWwpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuXG4gICAgICAvLyBDcmVhdGUgbmV3IGFib3J0IGNvbnRyb2xsZXIgZm9yIHRoaXMgcmVxdWVzdFxuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG5cbiAgICAgIC8vIEdldCBzeXN0ZW0gcHJvbXB0IGluZm9cbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IHRoaXMuZ2V0U3lzdGVtUHJvbXB0KCk7XG5cbiAgICAgIC8vIFN0cmVhbSB0aGUgcmVzcG9uc2VcbiAgICAgIHRyeSB7XG4gICAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgdGhpcy5haVNlcnZpY2Uuc3RyZWFtTWVzc2FnZSh7XG4gICAgICAgICAgbWVzc2FnZXM6IHRoaXMuZ2V0TWVzc2FnZXMoKSxcbiAgICAgICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgICAgICBjb250ZXh0RmlsZXM6IHRoaXMuZ2V0Q29udGV4dEZpbGVzKCksXG4gICAgICAgICAgc3lzdGVtUHJvbXB0VHlwZTogc3lzdGVtUHJvbXB0LnR5cGUsXG4gICAgICAgICAgc3lzdGVtUHJvbXB0UGF0aDogc3lzdGVtUHJvbXB0LnBhdGgsXG4gICAgICAgICAgc2lnbmFsOiB0aGlzLmFib3J0Q29udHJvbGxlci5zaWduYWwsXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgaWYgKCFmdWxsUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGxvYWRpbmdFbC50ZXh0Q29udGVudCA9IFwiIFx1MjVDRiBHZW5lcmF0aW5nLi4uXCI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSGFuZGxlIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBjaHVua3NcbiAgICAgICAgICBpZiAoY2h1bmsuY29udGVudCkge1xuICAgICAgICAgICAgZnVsbFJlc3BvbnNlICs9IGNodW5rLmNvbnRlbnQ7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjaGVkdWxlUmVuZGVyKGZ1bGxSZXNwb25zZSwgY29udGVudEVsKTtcbiAgICAgICAgICAgIGNvbnRlbnRFbC5hcHBlbmRDaGlsZChsb2FkaW5nRWwpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChjaHVuay5yZWFzb25pbmcpIHtcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkUmVhc29uaW5nICs9IGNodW5rLnJlYXNvbmluZztcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLnVwZGF0ZVJlYXNvbmluZ0NvbnRlbnQoXG4gICAgICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRW5zdXJlIHByb3BlciBzY3JvbGwgYWZ0ZXIgZWFjaCBjaHVua1xuICAgICAgICAgIHRoaXMuc2Nyb2xsTWFuYWdlci51cGRhdGVDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5hbGl6ZSBhc3Npc3RhbnQgcmVzcG9uc2VcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICBsb2FkaW5nRWwucmVtb3ZlKCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHJlYXNvbmluZyBvbmUgZmluYWwgdGltZSB3aXRoIGlzQ29tcGxldGU9dHJ1ZSB0byB0cmlnZ2VyIGF1dG8tY29sbGFwc2VcbiAgICAgICAgaWYgKGFjY3VtdWxhdGVkUmVhc29uaW5nKSB7XG4gICAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIudXBkYXRlUmVhc29uaW5nQ29udGVudChcbiAgICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkUmVhc29uaW5nLFxuICAgICAgICAgICAgdHJ1ZSAvLyBNYXJrIGFzIGNvbXBsZXRlIHRvIHRyaWdnZXIgYXV0by1jb2xsYXBzZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhc3Npc3RhbnRNZXNzYWdlOiBDaGF0TWVzc2FnZSA9IHtcbiAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGZ1bGxSZXNwb25zZSxcbiAgICAgICAgICBtZXNzYWdlX2lkOlxuICAgICAgICAgICAgbWVzc2FnZUVsLmdldEF0dHJpYnV0ZShcImRhdGEtbWVzc2FnZS1pZFwiKSB8fFxuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGF3YWl0IHRoaXMub25Bc3Npc3RhbnRSZXNwb25zZShhc3Npc3RhbnRNZXNzYWdlKTtcblxuICAgICAgICAvLyBBZGQgbWVzc2FnZSB0b29sYmFyIGFmdGVyIHJlc3BvbnNlIGlzIGNvbXBsZXRlXG4gICAgICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyLmFkZE1lc3NhZ2VCdXR0b25Ub29sYmFyKFxuICAgICAgICAgIG1lc3NhZ2VFbCxcbiAgICAgICAgICBmdWxsUmVzcG9uc2UsXG4gICAgICAgICAgXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICBhc3Npc3RhbnRNZXNzYWdlLm1lc3NhZ2VfaWRcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBGaW5hbCBzY3JvbGwgdG8gYm90dG9tIGFmdGVyIHRvb2xiYXIgaXMgYWRkZWRcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgICAgLy8gSGFuZGxlIG1lc3NhZ2UgdG9vbGJhciBldmVudHNcbiAgICAgICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJkZWxldGVcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBtZXNzYWdlSWQgfSA9IGUuZGV0YWlsO1xuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gdGhpcy5nZXRNZXNzYWdlcygpO1xuICAgICAgICAgIGNvbnN0IGluZGV4ID0gbWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgICAgICAgKG1zZykgPT4gbXNnLm1lc3NhZ2VfaWQgPT09IG1lc3NhZ2VJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICBsb2FkaW5nRWwucmVtb3ZlKCk7XG4gICAgICAgIG1lc3NhZ2VFbC5yZW1vdmUoKTtcblxuICAgICAgICAvLyBMb2cgYWxsIGVycm9ycyB0byBjb25zb2xlIGZpcnN0XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDaGF0IG1lc3NhZ2UgZXJyb3I6XCIsIHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGVycm9yIGZpbHRlcmluZyAtIGFsd2F5cyBzaG93IGVycm9yc1xuICAgICAgICB0aGlzLm9uRXJyb3IoZXJyb3IpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgdGhpcy5pc0dlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuICAgICAgICAvLyBGb2N1cyBpbnB1dCBhZnRlciBpdCdzIHJlLWVuYWJsZWRcbiAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBMb2cgb3V0ZXIgZXJyb3IgYXMgd2VsbFxuICAgICAgY29uc29sZS5lcnJvcihcIk91dGVyIG1lc3NhZ2UgaGFuZGxpbmcgZXJyb3I6XCIsIHtcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBudWxsO1xuICAgICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUoKTtcbiAgICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIGl0J3MgcmUtZW5hYmxlZFxuICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgdGhpcy5vbkVycm9yKGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZU1pY0NsaWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzR2VuZXJhdGluZykgcmV0dXJuO1xuICAgIHRoaXMudG9nZ2xlUmVjb3JkaW5nKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHRvZ2dsZVJlY29yZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnJlY29yZGVyU2VydmljZS50b2dnbGVSZWNvcmRpbmcoKTtcbiAgICAvLyBLZWVwIGZvY3VzL2N1cnNvciBpbiBjaGF0XG4gICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVQYXN0ZShlOiBDbGlwYm9hcmRFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGR0ID0gZS5jbGlwYm9hcmREYXRhO1xuICAgIGlmICghZHQpIHJldHVybjtcblxuICAgIC8vIFJldHJpZXZlIGFueSBwbGFpbiB0ZXh0XG4gICAgY29uc3QgcGFzdGVkVGV4dCA9IGR0LmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpID8/IFwiXCI7XG5cbiAgICAvLyBSZXRyaWV2ZSBmaWxlc1xuICAgIGNvbnN0IGFsbEZpbGVzID0gQXJyYXkuZnJvbShkdC5maWxlcyk7XG5cbiAgICAvLyBJZiB3ZSBoYXZlIG5vIGZpbGVzIGJ1dCBkbyBoYXZlIHRleHQsIGxldCB0aGUgbm9ybWFsIHBhc3RlIGhhcHBlblxuICAgIGlmICghYWxsRmlsZXMubGVuZ3RoICYmIHBhc3RlZFRleHQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIGZpbGVzIChhbmQgcG9zc2libHkgYWxzbyB0ZXh0KSwgcHJldmVudCBkZWZhdWx0IHNvIHdlIGNhbiBoYW5kbGUgdGhlbVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICghYWxsRmlsZXMubGVuZ3RoKSB7XG4gICAgICAvLyBJZiBubyBmaWxlcyBhdCBhbGwsIGJ1dCBjb2RlIGhhcyBub3QgcmV0dXJuZWQgeWV0LCBpdCBtZWFucyB0aGVyZSdzIG5vIHRleHQgZWl0aGVyXG4gICAgICAvLyBKdXN0IHJldHVybiBzbyB3ZSBkb24ndCBicmVhayBkZWZhdWx0IGJlaGF2aW9yIGluIGEgY29ybmVyIGNhc2VcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIGFsbCBmaWxlcyBpbiB0aGUgY2xpcGJvYXJkXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBEZXJpdmUgZXh0ZW5zaW9uIGZyb20gZmlsZW5hbWUgb3IgTUlNRSB0eXBlXG4gICAgICAgIGxldCBleHRlbnNpb24gPSBcImJpblwiO1xuICAgICAgICBpZiAoZmlsZS5uYW1lICYmIGZpbGUubmFtZS5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgICAgICBjb25zdCBkb3RJZHggPSBmaWxlLm5hbWUubGFzdEluZGV4T2YoXCIuXCIpO1xuICAgICAgICAgIGlmIChkb3RJZHggPj0gMCkge1xuICAgICAgICAgICAgZXh0ZW5zaW9uID0gZmlsZS5uYW1lLnN1YnN0cmluZyhkb3RJZHggKyAxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChmaWxlLnR5cGUpIHtcbiAgICAgICAgICBjb25zdCBtaW1lUGFydHMgPSBmaWxlLnR5cGUuc3BsaXQoXCIvXCIpO1xuICAgICAgICAgIGlmIChtaW1lUGFydHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICBleHRlbnNpb24gPSBtaW1lUGFydHNbMV0udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0vZywgXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQnVpbGQgYSB0aW1lc3RhbXAtYmFzZWQgZmlsZSBuYW1lXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGlzb1N0cmluZyA9IG5vdy50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgXCItXCIpO1xuICAgICAgICBjb25zdCBuZXdGaWxlTmFtZSA9IGBwYXN0ZWQtJHtpc29TdHJpbmd9LiR7ZXh0ZW5zaW9ufWA7XG5cbiAgICAgICAgLy8gUmVhZCB0aGUgY2xpcGJvYXJkIGZpbGUgYXMgYmluYXJ5XG4gICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpO1xuXG4gICAgICAgIC8vIERldGVybWluZSBhdHRhY2htZW50cyBwYXRoIGZyb20gcGx1Z2luIHNldHRpbmdzXG4gICAgICAgIGNvbnN0IGF0dGFjaG1lbnRzRGlyID1cbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdHRhY2htZW50c0RpcmVjdG9yeSB8fCBcIkF0dGFjaG1lbnRzXCI7XG4gICAgICAgIGNvbnN0IGZpbmFsUGF0aCA9IGAke2F0dGFjaG1lbnRzRGlyfS8ke25ld0ZpbGVOYW1lfWA7XG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRGlyZWN0b3J5RXhpc3RzKGF0dGFjaG1lbnRzRGlyKTtcblxuICAgICAgICAvLyBDcmVhdGUgdGhlIGZpbGUgaW4gdGhlIHZhdWx0XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUJpbmFyeShmaW5hbFBhdGgsIGFycmF5QnVmZmVyKTtcblxuICAgICAgICAvLyBBdHRlbXB0IHRvIGxvYWQgdGhlIG5ld2x5IGNyZWF0ZWQgZmlsZVxuICAgICAgICBjb25zdCBjcmVhdGVkRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaW5hbFBhdGgpO1xuICAgICAgICBpZiAoY3JlYXRlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIC8vIEFkZCB0byB0aGlzIGNoYXQncyBjb250ZXh0XG4gICAgICAgICAgYXdhaXQgdGhpcy5jaGF0Vmlldy5hZGRGaWxlVG9Db250ZXh0KGNyZWF0ZWRGaWxlKTtcbiAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgYFBhc3RlZCBmaWxlIHNhdmVkICYgYWRkZWQgdG8gY29udGV4dDogJHtjcmVhdGVkRmlsZS5uYW1lfWBcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2NhdGUgcGFzdGVkIGZpbGUgaW4gdmF1bHQuXCIpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGhhbmRsaW5nIHBhc3RlZCBmaWxlOlwiLCBlcnIpO1xuICAgICAgICBuZXcgTm90aWNlKGBGYWlsZWQgdG8gaGFuZGxlIHBhc3RlZCBmaWxlOiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5hbGx5LCBpZiB0aGVyZSdzIGFsc28gdGV4dCBpbiB0aGUgc2FtZSBwYXN0ZSBldmVudCwgaW5zZXJ0IHRoYXQgYWZ0ZXIgZmlsZSBoYW5kbGluZ1xuICAgIGlmIChwYXN0ZWRUZXh0KSB7XG4gICAgICB0aGlzLmluc2VydFRleHRBdEN1cnNvcihwYXN0ZWRUZXh0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUtleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTZW5kTWVzc2FnZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlSW1hZ2VQYXN0ZShjbGlwYm9hcmREYXRhOiBEYXRhVHJhbnNmZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZpbGUgPSBjbGlwYm9hcmREYXRhLmZpbGVzWzBdO1xuICAgIGlmICghZmlsZSB8fCAhZmlsZS50eXBlLnN0YXJ0c1dpdGgoXCJpbWFnZS9cIikpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJObyBpbWFnZSBpbiBjbGlwYm9hcmRcIixcbiAgICAgICAgRVJST1JfQ09ERVMuTk9fSU1BR0UsXG4gICAgICAgIDQwMFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCBJbWFnZVByb2Nlc3Nvci5wcm9jZXNzQ2xpcGJvYXJkSW1hZ2UoY2xpcGJvYXJkRGF0YSk7XG4gICAgcmV0dXJuIGJhc2U2NDtcbiAgfVxuXG4gIHByaXZhdGUgYWRqdXN0SW5wdXRIZWlnaHQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlucHV0KSByZXR1cm47XG5cbiAgICB0aGlzLmlucHV0LnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgIGNvbnN0IG5ld0hlaWdodCA9IE1hdGgubWluKE1hdGgubWF4KHRoaXMuaW5wdXQuc2Nyb2xsSGVpZ2h0LCA0OCksIDIwMCk7IC8vIE1pbiA0OHB4LCBtYXggMjAwcHhcbiAgICB0aGlzLmlucHV0LnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodCArIFwicHhcIjtcbiAgfVxuXG4gIHB1YmxpYyBmb2N1cygpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0VmFsdWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dC52YWx1ZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRWYWx1ZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlucHV0KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiSW5wdXQgZWxlbWVudCBub3QgZm91bmQgaW4gc2V0VmFsdWVcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNldCB0aGUgdmFsdWUgZGlyZWN0bHlcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSB2YWx1ZTtcblxuICAgICAgLy8gVHJpZ2dlciBpbnB1dCBldmVudCBmb3IgYW55IGxpc3RlbmVyc1xuICAgICAgY29uc3QgaW5wdXRFdmVudCA9IG5ldyBFdmVudChcImlucHV0XCIsIHtcbiAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KGlucHV0RXZlbnQpO1xuXG4gICAgICAvLyBBZGp1c3QgaGVpZ2h0IGFmdGVyIHZhbHVlIGlzIHNldFxuICAgICAgdGhpcy5hZGp1c3RJbnB1dEhlaWdodCgpO1xuXG4gICAgICAvLyBGb2N1cyB0aGUgaW5wdXQgYW5kIG1vdmUgY3Vyc29yIHRvIGVuZFxuICAgICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICAgICAgdGhpcy5pbnB1dC5zZXRTZWxlY3Rpb25SYW5nZSh2YWx1ZS5sZW5ndGgsIHZhbHVlLmxlbmd0aCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBzZXRWYWx1ZTpcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlx1Mjc0QyBGYWlsZWQgdG8gc2V0IGlucHV0IHZhbHVlXCIpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1bmxvYWQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucmVuZGVyVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVuZGVyVGltZW91dCk7XG4gICAgfVxuICAgIC8vIEVuc3VyZSByZWNvcmRlciBzZXJ2aWNlIGNsZWFudXBcbiAgICB0aGlzLnJlY29yZGVyU2VydmljZS5zZXRWaXN1YWxpemVyQ2FudmFzKG51bGwpO1xuICAgIGlmICh0aGlzLnJlY29yZGVyVmlzdWFsaXplcikge1xuICAgICAgdGhpcy5yZWNvcmRlclZpc3VhbGl6ZXIucmVtb3ZlKCk7XG4gICAgICB0aGlzLnJlY29yZGVyVmlzdWFsaXplciA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lc3NhZ2VJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBc3Npc3RhbnRNZXNzYWdlQ29udGFpbmVyKCk6IHtcbiAgICBtZXNzYWdlRWw6IEhUTUxFbGVtZW50O1xuICAgIGNvbnRlbnRFbDogSFRNTEVsZW1lbnQ7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBtZXNzYWdlRWw6IGNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZSBzeXN0ZW1zY3VscHQtYXNzaXN0YW50LW1lc3NhZ2VcIixcbiAgICAgIH0pLFxuICAgICAgY29udGVudEVsOiBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtY29udGVudFwiIH0pLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNjaGVkdWxlUmVuZGVyKFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnRcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMucmVuZGVyVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVuZGVyVGltZW91dCk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGN1cnJlbnQgaGVpZ2h0XG4gICAgY29uc3QgY3VycmVudEhlaWdodCA9IGNvbnRhaW5lckVsLm9mZnNldEhlaWdodDtcblxuICAgIC8vIFVwZGF0ZSB0ZXh0IGluIGEgdGVtcG9yYXJ5IGNvbnRhaW5lciB0byBjaGVjayBoZWlnaHRcbiAgICBjb25zdCB0ZW1wQ29udGFpbmVyID1cbiAgICAgIChjb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFwiLnRlbXAtdGV4dFwiKSBhcyBIVE1MRWxlbWVudCkgfHxcbiAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcInRlbXAtdGV4dFwiIH0pO1xuICAgIHRlbXBDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgdGVtcENvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB0ZW1wQ29udGFpbmVyLnN0eWxlLndpZHRoID0gY29udGFpbmVyRWwub2Zmc2V0V2lkdGggKyBcInB4XCI7XG4gICAgYXdhaXQgdGhpcy5tZXNzYWdlUmVuZGVyZXIucmVuZGVyTWFya2Rvd25Db250ZW50KGNvbnRlbnQsIHRlbXBDb250YWluZXIpO1xuXG4gICAgLy8gSWYgaGVpZ2h0IGNoYW5nZWQsIGRvIGEgZnVsbCByZW5kZXJcbiAgICBpZiAoY3VycmVudEhlaWdodCAhPT0gdGVtcENvbnRhaW5lci5vZmZzZXRIZWlnaHQpIHtcbiAgICAgIGF3YWl0IHRoaXMubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1hcmtkb3duQ29udGVudChjb250ZW50LCBjb250YWluZXJFbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSBqdXN0IHVwZGF0ZSB0aGUgdmlzaWJsZSB0ZXh0XG4gICAgICBjb25zdCBsYXN0Q2hpbGQgPSBjb250YWluZXJFbC5sYXN0Q2hpbGQ7XG4gICAgICBpZiAobGFzdENoaWxkICYmIGxhc3RDaGlsZC5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgICAgbGFzdENoaWxkLnRleHRDb250ZW50ID0gY29udGVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhbiB1cFxuICAgIHRlbXBDb250YWluZXIucmVtb3ZlKCk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVEb2N1bWVudFVwbG9hZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdXNlciBoYXMgYSB2YWxpZCBsaWNlbnNlIGtleVxuICAgICAgaWYgKFxuICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8XG4gICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWRcbiAgICAgICkge1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJVcGxvYWQgYW5kIHByb2Nlc3MgZG9jdW1lbnRzIGRpcmVjdGx5IGluIHlvdXIgY2hhdCBjb252ZXJzYXRpb25zLiBTeXN0ZW1TY3VscHQgd2lsbCBhdXRvbWF0aWNhbGx5IGV4dHJhY3QgYW5kIGFuYWx5emUgdGhlIGNvbnRlbnQuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvIEZlYXR1cmUgLSBEb2N1bWVudCBQcm9jZXNzaW5nXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgXCJTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgZG9jdW1lbnQgcHJvY2Vzc2luZywgYW5hbHlzaXMsIGFuZCBvdGhlciBwcmVtaXVtIGZlYXR1cmVzIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgfVxuICAgICAgICApLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRG91YmxlIGNoZWNrIGxpY2Vuc2UgaXMgc3RpbGwgdmFsaWQgd2l0aCBzZXJ2ZXJcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB0aGlzLnBsdWdpblxuICAgICAgICAuZ2V0TGljZW5zZU1hbmFnZXIoKVxuICAgICAgICAudmFsaWRhdGVMaWNlbnNlS2V5KHRydWUpO1xuICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIFwiWW91ciBsaWNlbnNlIGFwcGVhcnMgdG8gYmUgaW52YWxpZC4gUGxlYXNlIGNoZWNrIHlvdXIgbGljZW5zZSBrZXkgaW4gc2V0dGluZ3MuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiTGljZW5zZSBJbnZhbGlkXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE5vdyBwcm9jZWVkIHdpdGggZG9jdW1lbnQgdXBsb2FkXG4gICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgICBpZiAoIWZpbGVzLmxlbmd0aCkge1xuICAgICAgICBuZXcgTm90aWNlKFwiTm8gZmlsZXMgZm91bmQgdG8gdXBsb2FkLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaXJzdEZpbGUgPSBmaWxlc1swXTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWlTZXJ2aWNlLnVwbG9hZERvY3VtZW50KGZpcnN0RmlsZSk7XG4gICAgICBuZXcgTm90aWNlKFxuICAgICAgICBgVXBsb2FkZWQgZG9jLiBJRDogJHtyZXN1bHQuZG9jdW1lbnRJZH0sIHN0YXR1czogJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBzcGVjaWZpYyA0MDEvNDAzIGVycm9ycyBncmFjZWZ1bGx5XG4gICAgICBpZiAoZXJyb3I/LnN0YXR1c0NvZGUgPT09IDQwMSB8fCBlcnJvcj8uc3RhdHVzQ29kZSA9PT0gNDAzKSB7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlVwbG9hZCBhbmQgcHJvY2VzcyBkb2N1bWVudHMgZGlyZWN0bHkgaW4geW91ciBjaGF0IGNvbnZlcnNhdGlvbnMuIFN5c3RlbVNjdWxwdCB3aWxsIGF1dG9tYXRpY2FsbHkgZXh0cmFjdCBhbmQgYW5hbHl6ZSB0aGUgY29udGVudC5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZSAtIERvY3VtZW50IFByb2Nlc3NpbmdcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIkRvY3VtZW50IHByb2Nlc3NpbmcgcmVxdWlyZXMgYW4gYWN0aXZlIFBybyBzdWJzY3JpcHRpb24uIFN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYnkgYmVjb21pbmcgYSBQYXRyZW9uIG1lbWJlciFcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICB9XG4gICAgICAgICkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgb3RoZXIgZXJyb3JzXG4gICAgICBuZXcgTm90aWNlKGBFcnJvciB1cGxvYWRpbmcgZG9jOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0VGV4dEF0Q3Vyc29yKHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnNvclBvcyA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTtcblxuICAgIGlmIChjdXJzb3JQb3MgIT09IG51bGwpIHtcbiAgICAgIC8vIEluc2VydCBhdCBjdXJzb3IgcG9zaXRpb25cbiAgICAgIGNvbnN0IG5ld1ZhbHVlID1cbiAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKDAsIGN1cnNvclBvcykgKyB0ZXh0ICsgY3VycmVudFZhbHVlLnNsaWNlKGN1cnNvclBvcyk7XG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAvLyBNb3ZlIGN1cnNvciB0byBlbmQgb2YgaW5zZXJ0ZWQgdGV4dFxuICAgICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uRW5kID1cbiAgICAgICAgY3Vyc29yUG9zICsgdGV4dC5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFwcGVuZCB0byBlbmQgaWYgbm8gY3Vyc29yIHBvc2l0aW9uXG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gY3VycmVudFZhbHVlICsgdGV4dDtcbiAgICAgIHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmlucHV0LnNlbGVjdGlvbkVuZCA9XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIFRyaWdnZXIgaW5wdXQgZXZlbnQgZm9yIGhlaWdodCBhZGp1c3RtZW50XG4gICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcblxuICAgIC8vIEZvY3VzIHRoZSBpbnB1dCBhZnRlciBpbnNlcnRpb25cbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVdlYlNlYXJjaEJ1dHRvblN0YXRlKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy53ZWJTZWFyY2hCdXR0b24pIHJldHVybjtcblxuICAgIGNvbnN0IGlzTmF0aXZlUHJvdmlkZXIgPVxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIudHlwZSA9PT0gXCJuYXRpdmVcIjtcbiAgICBjb25zdCBjdXJyZW50UHJvdmlkZXIgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci5pZFxuICAgICk7XG4gICAgY29uc3QgaXNPcGVuUm91dGVyID0gY3VycmVudFByb3ZpZGVyPy5lbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIik7XG5cbiAgICBjb25zdCB3ZWJTZWFyY2hBbGxvd2VkID0gaXNOYXRpdmVQcm92aWRlciB8fCBpc09wZW5Sb3V0ZXI7XG5cbiAgICAvLyBSZXNldCB3ZWIgc2VhcmNoIHN0YXRlIGlmIGl0IHdhcyBlbmFibGVkIGJ1dCBpcyBubyBsb25nZXIgYWxsb3dlZFxuICAgIGlmICghd2ViU2VhcmNoQWxsb3dlZCAmJiB0aGlzLndlYlNlYXJjaEVuYWJsZWQpIHtcbiAgICAgIHRoaXMud2ViU2VhcmNoRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy53ZWJTZWFyY2hCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImlzLWVuYWJsZWRcIik7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGJ1dHRvbiBzdGF0ZVxuICAgIHRoaXMud2ViU2VhcmNoQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCAhd2ViU2VhcmNoQWxsb3dlZCk7XG4gICAgdGhpcy53ZWJTZWFyY2hCdXR0b24uc2V0QXR0cmlidXRlKFxuICAgICAgXCJhcmlhLWRpc2FibGVkXCIsXG4gICAgICAoIXdlYlNlYXJjaEFsbG93ZWQpLnRvU3RyaW5nKClcbiAgICApO1xuICB9XG5cbiAgLy8gQ2FsbCB0aGlzIHdoZW4gbW9kZWwgY2hhbmdlc1xuICBwdWJsaWMgb25Nb2RlbENoYW5nZSgpOiB2b2lkIHtcbiAgICB0aGlzLnVwZGF0ZVdlYlNlYXJjaEJ1dHRvblN0YXRlKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuc3VyZURpcmVjdG9yeUV4aXN0cyhkaXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2RpcihkaXJQYXRoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoXCJhbHJlYWR5IGV4aXN0c1wiKSkgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIHNldEljb24sIENvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgRHJhd2VyQ29tcG9uZW50IH0gZnJvbSBcIi4vRHJhd2VyQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBDb250ZXh0U2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0NvbnRleHRTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNYXJrZG93blJlbmRlcmVyIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgVG9rZW5Db3VudGVyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9Ub2tlbkNvdW50ZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWxcIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi8uLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBMaWNlbnNlQ2hlY2tlciB9IGZyb20gXCIuLi8uLi9jb3JlL2xpY2Vuc2UvTGljZW5zZUNoZWNrZXJcIjtcblxuaW50ZXJmYWNlIENvbnRleHRGaWxlIHtcbiAgcGF0aDogc3RyaW5nO1xuICB0eXBlOiBcInNvdXJjZVwiIHwgXCJleHRyYWN0aW9uXCI7XG59XG5cbmludGVyZmFjZSBDYXRlZ29yeUZpbGUge1xuICBmaWxlOiBURmlsZTtcbiAgcGF0aDogc3RyaW5nO1xuICBsaW5rVGV4dDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ2F0ZWdvcnkge1xuICBsYWJlbDogc3RyaW5nO1xuICBmaWxlczogQ2F0ZWdvcnlGaWxlW107XG4gIGV4dGVuc2lvbnM6IHN0cmluZ1tdO1xufVxuXG5pbnRlcmZhY2UgRmlsZUNvbnRleHRNYW5hZ2VyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICB0aXRsZT86IHN0cmluZztcbiAgb25Db250ZXh0Q2hhbmdlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwbHVnaW46IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIEZpbGVDb250ZXh0TWFuYWdlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY29udGV4dEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIHByaXZhdGUgZHJhd2VyOiBEcmF3ZXJDb21wb25lbnQ7XG4gIHByaXZhdGUgY29udGV4dFBhbmVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvbkNvbnRleHRDaGFuZ2U6ICgpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgcHJvY2Vzc2luZ1N0YXR1czogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nRmlsZXMgPSBuZXcgTWFwPHN0cmluZywgSFRNTEVsZW1lbnQ+KCk7XG4gIHByaXZhdGUgcHJvY2Vzc2luZ1RpbWVvdXRzID0gbmV3IE1hcDxzdHJpbmcsIE5vZGVKUy5UaW1lb3V0PigpO1xuICBwcml2YXRlIHN5bmNTdGF0dXNFbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpc1N5bmNpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHBsdWdpbjogYW55O1xuICBwcml2YXRlIHRva2VuQ291bnRlcjogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogRmlsZUNvbnRleHRNYW5hZ2VyT3B0aW9ucykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hcHAgPSBvcHRpb25zLmFwcDtcbiAgICB0aGlzLm9uQ29udGV4dENoYW5nZSA9IG9wdGlvbnMub25Db250ZXh0Q2hhbmdlO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IG9wdGlvbnMuc2N1bHB0U2VydmljZTtcbiAgICB0aGlzLnBsdWdpbiA9IG9wdGlvbnMucGx1Z2luO1xuICAgIHRoaXMudG9rZW5Db3VudGVyID0gVG9rZW5Db3VudGVyU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4gICAgdGhpcy5kcmF3ZXIgPSBuZXcgRHJhd2VyQ29tcG9uZW50KHtcbiAgICAgIGNvbnRhaW5lcjogb3B0aW9ucy5jb250YWluZXIsXG4gICAgICB0aXRsZTogb3B0aW9ucy50aXRsZSB8fCBcIkZpbGVzXCIsXG4gICAgfSk7XG4gICAgdGhpcy5jb250ZXh0UGFuZWwgPSB0aGlzLmRyYXdlci5nZXREcmF3ZXIoKTtcblxuICAgIHRoaXMuc2V0dXBDb250ZXh0UGFuZWwoKTtcbiAgICB0aGlzLmluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCkge1xuICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cyA9IHRoaXMuY29udGV4dFBhbmVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvY2Vzc2luZy1zdGF0dXNcIixcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIHN0YXR1czogc3RyaW5nLFxuICAgIGljb246IHN0cmluZyxcbiAgICByZW1vdmU6IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICBjb25zdCBmaWxlSWQgPSBmaWxlLnBhdGg7XG4gICAgbGV0IHN0YXR1c0VsID0gdGhpcy5wcm9jZXNzaW5nRmlsZXMuZ2V0KGZpbGVJZCk7XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZW91dCBmb3IgdGhpcyBmaWxlXG4gICAgY29uc3QgZXhpc3RpbmdUaW1lb3V0ID0gdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZ2V0KGZpbGVJZCk7XG4gICAgaWYgKGV4aXN0aW5nVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGV4aXN0aW5nVGltZW91dCk7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICB9XG5cbiAgICBpZiAoIXN0YXR1c0VsICYmICFyZW1vdmUgJiYgdGhpcy5wcm9jZXNzaW5nU3RhdHVzKSB7XG4gICAgICBzdGF0dXNFbCA9IHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZmlsZS1zdGF0dXNcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG5cbiAgICAgIHN0YXR1c0VsLmNyZWF0ZVNwYW4oe1xuICAgICAgICB0ZXh0OiBgJHtmaWxlLmJhc2VuYW1lfTogJHtzdGF0dXN9YCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtdGV4dFwiLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLnNldChmaWxlSWQsIHN0YXR1c0VsKTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1c0VsICYmICFyZW1vdmUpIHtcbiAgICAgIHN0YXR1c0VsLmVtcHR5KCk7XG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG4gICAgICBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogYCR7ZmlsZS5iYXNlbmFtZX06ICR7c3RhdHVzfWAsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLXRleHRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc3RhdHVzRWwgJiYgcmVtb3ZlKSB7XG4gICAgICBzdGF0dXNFbC5yZW1vdmUoKTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmRlbGV0ZShmaWxlSWQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnByb2Nlc3NpbmdTdGF0dXMpIHtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5zdHlsZS5kaXNwbGF5ID1cbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuc2l6ZSA+IDAgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGlzIGlzIGEgc3VjY2VzcyBvciBlcnJvciBtZXNzYWdlLCBvciBleHBsaWNpdCByZW1vdmFsIHJlcXVlc3RlZCwgc2V0IGEgdGltZW91dCB0byByZW1vdmUgaXRcbiAgICBpZiAoXG4gICAgICByZW1vdmUgfHxcbiAgICAgIHN0YXR1cy5pbmNsdWRlcyhcInN1Y2Nlc3NmdWxseVwiKSB8fFxuICAgICAgc3RhdHVzLmluY2x1ZGVzKFwiY29tcGxldGVkXCIpIHx8XG4gICAgICBzdGF0dXMuaW5jbHVkZXMoXCJFcnJvcjpcIilcbiAgICApIHtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICAgIH0sIDMwMDApO1xuICAgICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuc2V0KGZpbGVJZCwgdGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cENvbnRleHRQYW5lbCgpOiB2b2lkIHtcbiAgICBjb25zdCB0aXRsZUVsID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItdGl0bGVcIlxuICAgICk7XG4gICAgaWYgKCF0aXRsZUVsKSByZXR1cm47XG5cbiAgICBjb25zdCBjb250ZXh0Q291bnQgPSB0aXRsZUVsLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY291bnRcIixcbiAgICAgIHRleHQ6IFwiMFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHN5bmMgc3RhdHVzIGVsZW1lbnRcbiAgICB0aGlzLnN5bmNTdGF0dXNFbCA9IHRpdGxlRWwuY3JlYXRlU3Bhbih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXN5bmMtc3RhdHVzIHN5bmNlZFwiLFxuICAgIH0pO1xuICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwiY2hlY2tcIik7XG5cbiAgICBjb25zdCBjb250ZXh0QnV0dG9uID0gdGl0bGVFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtYWRkLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIHNldEljb24oY29udGV4dEJ1dHRvbiwgXCJwbHVzXCIpO1xuICAgIGNvbnRleHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5hZGRDb250ZXh0RmlsZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU3luY1N0YXR1cyhzeW5jaW5nOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoIXRoaXMuc3luY1N0YXR1c0VsKSByZXR1cm47XG5cbiAgICB0aGlzLmlzU3luY2luZyA9IHN5bmNpbmc7XG4gICAgdGhpcy5zeW5jU3RhdHVzRWwuZW1wdHkoKTtcblxuICAgIGlmIChzeW5jaW5nKSB7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5yZW1vdmVDbGFzcyhcInN5bmNlZFwiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwibG9hZGVyLTJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLnJlbW92ZUNsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2VkXCIpO1xuICAgICAgc2V0SWNvbih0aGlzLnN5bmNTdGF0dXNFbCwgXCJjaGVja1wiKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY2hlY2tTeW5jU3RhdHVzKCkge1xuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlU3luY1N0YXR1cyh0cnVlKTtcbiAgICAvLyBObyBuZWVkIHRvIHNpbXVsYXRlLCBqdXN0IHVwZGF0ZSBzdGF0dXNcbiAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDb250ZXh0UGFuZWwoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNvbnRleHRQYW5lbCkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVhZGVyID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItaGVhZGVyXCJcbiAgICApO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmNvbnRleHRQYW5lbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuc3lzdGVtc2N1bHB0LWRyYXdlci1jb250ZW50XCJcbiAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtZHJhd2VyLWNvdW50XCIpO1xuXG4gICAgaWYgKCFoZWFkZXIgfHwgIWNvbnRlbnQgfHwgIWNvdW50KSByZXR1cm47XG5cbiAgICBjb3VudC50ZXh0Q29udGVudCA9IHRoaXMuY29udGV4dEZpbGVzLnNpemUudG9TdHJpbmcoKTtcblxuICAgIGNvbnRlbnQuZW1wdHkoKTtcblxuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICBjb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItZW1wdHlcIixcbiAgICAgICAgdGV4dDogXCJObyBjb250ZXh0IGZpbGVzIGFkZGVkIHlldC4gQ2xpY2sgdGhlIHBsdXMgYnV0dG9uIHRvIGFkZCBmaWxlcyBpbiB5b3VyIGNoYXQuXCIsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT4gPSB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIGxhYmVsOiBcIlRleHQgRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtZFwiLCBcInR4dFwiLCBcIm1hcmtkb3duXCJdLFxuICAgICAgfSxcbiAgICAgIGltYWdlczoge1xuICAgICAgICBsYWJlbDogXCJJbWFnZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJqcGdcIiwgXCJqcGVnXCIsIFwicG5nXCIsIFwiZ2lmXCIsIFwid2VicFwiLCBcInN2Z1wiXSxcbiAgICAgIH0sXG4gICAgICBhdWRpbzoge1xuICAgICAgICBsYWJlbDogXCJBdWRpbyBGaWxlc1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXSxcbiAgICAgIH0sXG4gICAgICBkb2N1bWVudHM6IHtcbiAgICAgICAgbGFiZWw6IFwiRG9jdW1lbnRzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wiZG9jXCIsIFwiZG9jeFwiLCBcInBwdFwiLCBcInBwdHhcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwicGRmXCJdLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgLy8gR3JvdXAgZXh0cmFjdGVkIGZpbGVzIGJ5IHRoZWlyIHNvdXJjZSBkb2N1bWVudFxuICAgIGNvbnN0IGRvY3VtZW50R3JvdXBzID0gbmV3IE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+PigpO1xuICAgIGNvbnN0IG5vbkV4dHJhY3RlZEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIHRoaXMuY29udGV4dEZpbGVzKSB7XG4gICAgICBjb25zdCBjbGVhblBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcblxuICAgICAgaWYgKGNsZWFuUGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIikpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBjbGVhblBhdGguc3BsaXQoXCIvXCIpO1xuICAgICAgICBjb25zdCBleHRyYWN0aW9uRGlySW5kZXggPSBwYXJ0cy5pbmRleE9mKFwiRXh0cmFjdGlvbnNcIik7XG4gICAgICAgIGlmIChleHRyYWN0aW9uRGlySW5kZXggPj0gMCAmJiBleHRyYWN0aW9uRGlySW5kZXggKyAxIDwgcGFydHMubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3Qgc291cmNlRG9jID0gcGFydHNbZXh0cmFjdGlvbkRpckluZGV4ICsgMV07XG4gICAgICAgICAgaWYgKCFkb2N1bWVudEdyb3Vwcy5oYXMoc291cmNlRG9jKSkge1xuICAgICAgICAgICAgZG9jdW1lbnRHcm91cHMuc2V0KHNvdXJjZURvYywgbmV3IFNldCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZG9jdW1lbnRHcm91cHMuZ2V0KHNvdXJjZURvYyk/LmFkZChmaWxlUGF0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaXJzdCwgY2F0ZWdvcml6ZSBub24tZXh0cmFjdGVkIGZpbGVzXG4gICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShub25FeHRyYWN0ZWRGaWxlcyksIGNhdGVnb3JpZXMpO1xuXG4gICAgLy8gUmVuZGVyIHJlZ3VsYXIgY2F0ZWdvcmllcyBmaXJzdFxuICAgIGZvciAoY29uc3QgY2F0ZWdvcnlLZXkgb2YgW1widGV4dFwiLCBcImltYWdlc1wiLCBcImF1ZGlvXCJdKSB7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGNhdGVnb3JpZXNbY2F0ZWdvcnlLZXldO1xuICAgICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5yZW5kZXJDYXRlZ29yeShjb250ZW50LCBjYXRlZ29yeSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZG9jdW1lbnRzIGNhdGVnb3J5XG4gICAgaWYgKGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLmxlbmd0aCA+IDAgfHwgZG9jdW1lbnRHcm91cHMuc2l6ZSA+IDApIHtcbiAgICAgIC8vIE1haW4gXCJEb2N1bWVudHNcIiBjYXRlZ29yeSBoZWFkZXJcbiAgICAgIGNvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1jYXRlZ29yeVwiLFxuICAgICAgICB0ZXh0OiBcIkRvY3VtZW50c1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEZpcnN0IHJlbmRlciBzdGFuZGFsb25lIGRvY3VtZW50c1xuICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBjYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyk7XG5cbiAgICAgIC8vIFRoZW4gcmVuZGVyIGVhY2ggZG9jdW1lbnQgZ3JvdXAgYXMgYSBzdWJjYXRlZ29yeVxuICAgICAgZm9yIChjb25zdCBbc291cmNlRG9jLCBleHRyYWN0ZWRGaWxlc10gb2YgZG9jdW1lbnRHcm91cHMpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgc3ViY2F0ZWdvcnkgZm9yIHRoaXMgZG9jdW1lbnRcbiAgICAgICAgY29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY2F0ZWdvcnlcIixcbiAgICAgICAgICB0ZXh0OiBgXHVEODNEXHVEQ0M0ICR7c291cmNlRG9jfSBFeHRyYWN0aW9uc2AsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhdGVnb3JpemUgZXh0cmFjdGVkIGZpbGVzXG4gICAgICAgIGNvbnN0IGV4dHJhY3RlZENhdGVnb3JpZXMgPSB0aGlzLmNyZWF0ZUNhdGVnb3JpZXMoKTtcbiAgICAgICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShleHRyYWN0ZWRGaWxlcyksIGV4dHJhY3RlZENhdGVnb3JpZXMpO1xuXG4gICAgICAgIC8vIEZpcnN0IHJlbmRlciB0ZXh0IGZpbGVzIChtZCwgdHh0LCBtYXJrZG93bilcbiAgICAgICAgY29uc3QgdGV4dEZpbGVzID0gZXh0cmFjdGVkQ2F0ZWdvcmllcy50ZXh0LmZpbGVzO1xuICAgICAgICBpZiAodGV4dEZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZpbGVzKGNvbnRlbnQsIHRleHRGaWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGVuIHJlbmRlciBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VGaWxlcyA9IGV4dHJhY3RlZENhdGVnb3JpZXMuaW1hZ2VzLmZpbGVzO1xuICAgICAgICBpZiAoaW1hZ2VGaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBpbWFnZUZpbGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsbHkgcmVuZGVyIGFueSBvdGhlciB0eXBlcyBpZiB0aGV5IGV4aXN0XG4gICAgICAgIGNvbnN0IG90aGVyRmlsZXMgPSBbXG4gICAgICAgICAgLi4uZXh0cmFjdGVkQ2F0ZWdvcmllcy5hdWRpby5maWxlcyxcbiAgICAgICAgICAuLi5leHRyYWN0ZWRDYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyxcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKG90aGVyRmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGVudCwgb3RoZXJGaWxlcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNhdGVnb3JpZXMoKTogUmVjb3JkPHN0cmluZywgQ2F0ZWdvcnk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgdGV4dDoge1xuICAgICAgICBsYWJlbDogXCJUZXh0IEZpbGVzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXSxcbiAgICAgIH0sXG4gICAgICBpbWFnZXM6IHtcbiAgICAgICAgbGFiZWw6IFwiSW1hZ2VzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0sXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgbGFiZWw6IFwiQXVkaW8gRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJvZ2dcIiwgXCJtNGFcIl0sXG4gICAgICB9LFxuICAgICAgZG9jdW1lbnRzOiB7XG4gICAgICAgIGxhYmVsOiBcIkRvY3VtZW50c1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcInBkZlwiXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUZpbGVzKFxuICAgIGZpbGVzOiBzdHJpbmdbXSxcbiAgICBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT5cbiAgKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIGxpbmtUZXh0LFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gcmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQgY2F0ZWdvcnlGb3VuZCA9IGZhbHNlO1xuXG4gICAgICAgIGZvciAoY29uc3QgW2NhdGVnb3J5LCBpbmZvXSBvZiBPYmplY3QuZW50cmllcyhjYXRlZ29yaWVzKSkge1xuICAgICAgICAgIGlmIChpbmZvLmV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgaW5mby5maWxlcy5wdXNoKHsgZmlsZTogcmVzb2x2ZWRGaWxlLCBwYXRoOiBmaWxlUGF0aCwgbGlua1RleHQgfSk7XG4gICAgICAgICAgICBjYXRlZ29yeUZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY2F0ZWdvcnlGb3VuZCkge1xuICAgICAgICAgIGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLnB1c2goe1xuICAgICAgICAgICAgZmlsZTogcmVzb2x2ZWRGaWxlLFxuICAgICAgICAgICAgcGF0aDogZmlsZVBhdGgsXG4gICAgICAgICAgICBsaW5rVGV4dCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyQ2F0ZWdvcnkoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgY2F0ZWdvcnk6IENhdGVnb3J5KTogdm9pZCB7XG4gICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNhdGVnb3J5XCIsXG4gICAgICB0ZXh0OiBjYXRlZ29yeS5sYWJlbCxcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGFpbmVyLCBjYXRlZ29yeS5maWxlcyk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckZpbGVzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGZpbGVzOiBDYXRlZ29yeUZpbGVbXSk6IHZvaWQge1xuICAgIGZpbGVzLnNvcnQoKGEsIGIpID0+IGEuZmlsZS5iYXNlbmFtZS5sb2NhbGVDb21wYXJlKGIuZmlsZS5iYXNlbmFtZSkpO1xuXG4gICAgLy8gQ3JlYXRlIHByZXZpZXcgZWxlbWVudHMgb25jZSBhbmQgcmV1c2VcbiAgICBjb25zdCBpbWFnZVByZXZpZXcgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZUVsKFwiaW1nXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldyBzeXN0ZW1zY3VscHQtaW1hZ2UtcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWFya2Rvd25QcmV2aWV3ID0gZG9jdW1lbnQuYm9keS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmV2aWV3IHN5c3RlbXNjdWxwdC1tYXJrZG93bi1wcmV2aWV3XCIsXG4gICAgfSk7XG5cbiAgICAvLyBUcmFjayBpZiBtYXJrZG93biBwcmV2aWV3IGlzIHZpc2libGVcbiAgICBsZXQgaXNNYXJrZG93blByZXZpZXdWaXNpYmxlID0gZmFsc2U7XG5cbiAgICAvLyBIYW5kbGUgd2hlZWwgZXZlbnRzIGZvciBtYXJrZG93biBwcmV2aWV3IHNjcm9sbGluZ1xuICAgIGNvbnN0IGhhbmRsZVdoZWVsID0gKGU6IFdoZWVsRXZlbnQpID0+IHtcbiAgICAgIGlmICghaXNNYXJrZG93blByZXZpZXdWaXNpYmxlKSByZXR1cm47XG5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHNjcm9sbEFtb3VudCA9IGUuZGVsdGFZO1xuICAgICAgbWFya2Rvd25QcmV2aWV3LnNjcm9sbFRvcCArPSBzY3JvbGxBbW91bnQ7XG4gICAgfTtcblxuICAgIC8vIEFkZCB3aGVlbCBldmVudCBsaXN0ZW5lciB0byBkb2N1bWVudFxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcblxuICAgIC8vIENsZWFuIHVwIHdoZWVsIGV2ZW50IGxpc3RlbmVyIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjYWxjdWxhdGVQcmV2aWV3RGltZW5zaW9ucyA9IChcbiAgICAgIG5hdHVyYWxXaWR0aDogbnVtYmVyLFxuICAgICAgbmF0dXJhbEhlaWdodDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRXaWR0aDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlclxuICAgICkgPT4ge1xuICAgICAgLy8gTWF4aW11bSBzaXplIHNob3VsZCBiZSBhIHBlcmNlbnRhZ2Ugb2Ygdmlld3BvcnRcbiAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4odmlld3BvcnRXaWR0aCAqIDAuNCwgbmF0dXJhbFdpZHRoKTsgLy8gNDAlIG9mIHZpZXdwb3J0IHdpZHRoXG4gICAgICBjb25zdCBtYXhIZWlnaHQgPSBNYXRoLm1pbih2aWV3cG9ydEhlaWdodCAqIDAuNiwgbmF0dXJhbEhlaWdodCk7IC8vIDYwJSBvZiB2aWV3cG9ydCBoZWlnaHRcblxuICAgICAgLy8gQ2FsY3VsYXRlIGRpbWVuc2lvbnMgbWFpbnRhaW5pbmcgYXNwZWN0IHJhdGlvXG4gICAgICBsZXQgd2lkdGggPSBuYXR1cmFsV2lkdGg7XG4gICAgICBsZXQgaGVpZ2h0ID0gbmF0dXJhbEhlaWdodDtcblxuICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgd2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgaGVpZ2h0ID0gKG5hdHVyYWxIZWlnaHQgKiBtYXhXaWR0aCkgLyBuYXR1cmFsV2lkdGg7XG4gICAgICB9XG5cbiAgICAgIGlmIChoZWlnaHQgPiBtYXhIZWlnaHQpIHtcbiAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICAgICAgICB3aWR0aCA9IChuYXR1cmFsV2lkdGggKiBtYXhIZWlnaHQpIC8gbmF0dXJhbEhlaWdodDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9O1xuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVQcmV2aWV3UG9zaXRpb24gPSAoZTogTW91c2VFdmVudCwgcHJldmlld0VsOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgaWYgKCFwcmV2aWV3RWwpIHJldHVybjtcblxuICAgICAgLy8gR2V0IHZpZXdwb3J0IGRpbWVuc2lvbnNcbiAgICAgIGNvbnN0IHZpZXdwb3J0V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgIGNvbnN0IHZpZXdwb3J0SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAvLyBHZXQgcHJldmlldyBkaW1lbnNpb25zXG4gICAgICBjb25zdCByZWN0ID0gcHJldmlld0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3Qgd2lkdGggPSByZWN0LndpZHRoO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwb3NpdGlvblxuICAgICAgbGV0IHggPSBlLmNsaWVudFggKyAxNjsgLy8gRGVmYXVsdCBvZmZzZXQgZnJvbSBjdXJzb3JcbiAgICAgIGxldCB5ID0gZS5jbGllbnRZICsgMTY7XG5cbiAgICAgIC8vIENoZWNrIGlmIHByZXZpZXcgd291bGQgZ28gb2ZmIHNjcmVlblxuICAgICAgaWYgKHggKyB3aWR0aCA+IHZpZXdwb3J0V2lkdGgpIHtcbiAgICAgICAgeCA9IGUuY2xpZW50WCAtIHdpZHRoIC0gMTY7IC8vIFNob3cgb24gbGVmdCBzaWRlIG9mIGN1cnNvclxuICAgICAgfVxuICAgICAgaWYgKHkgKyBoZWlnaHQgPiB2aWV3cG9ydEhlaWdodCkge1xuICAgICAgICB5ID0gZS5jbGllbnRZIC0gaGVpZ2h0IC0gMTY7IC8vIFNob3cgYWJvdmUgY3Vyc29yXG4gICAgICB9XG5cbiAgICAgIHByZXZpZXdFbC5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7XG4gICAgICBwcmV2aWV3RWwuc3R5bGUudG9wID0gYCR7eX1weGA7XG4gICAgfTtcblxuICAgIC8vIENsZWFuIHVwIHByZXZpZXdzIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGltYWdlUHJldmlldy5yZW1vdmUoKTtcbiAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgeyBmaWxlLCBwYXRoLCBsaW5rVGV4dCB9IG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBpdGVtID0gY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHBhdGhFbCA9IGl0ZW0uY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtLXBhdGhcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uQ29udGFpbmVyID0gcGF0aEVsLmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtaWNvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgaWNvbk5hbWUgPSBcImZpbGVcIjtcblxuICAgICAgLy8gQ3JlYXRlIGxpbmsgZmlyc3Qgc28gd2UgY2FuIHJlZmVyZW5jZSBpdCBmb3IgaG92ZXIgZXZlbnRzXG4gICAgICBjb25zdCBsaW5rID0gcGF0aEVsLmNyZWF0ZUVsKFwiYVwiLCB7XG4gICAgICAgIGNsczogXCJpbnRlcm5hbC1saW5rXCIsXG4gICAgICAgIHRleHQ6IGZpbGUuYmFzZW5hbWUsXG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBocmVmOiBwYXRoLFxuICAgICAgICAgIFwiZGF0YS1ocmVmXCI6IHBhdGgsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIGZvciBtYXJrZG93biBmaWxlc1xuICAgICAgICBjb25zdCBzaG93TWFya2Rvd25QcmV2aWV3ID0gYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGUucGF0aCk7XG4gICAgICAgICAgICBpZiAobWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQobWRGaWxlKTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgaGVhZGVyIHdpdGggZmlsZW5hbWVcbiAgICAgICAgICAgICAgbWFya2Rvd25QcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldy1oZWFkZXJcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBmaWxlLmJhc2VuYW1lLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXIgYW5kIHJlbmRlciBtYXJrZG93blxuICAgICAgICAgICAgICBjb25zdCBjb250ZW50RWwgPSBtYXJrZG93blByZXZpZXcuY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBmaXJzdCA0MDAwIGNoYXJhY3RlcnMgd2l0aCBtZXNzYWdlIGlmIGxvbmdlclxuICAgICAgICAgICAgICAgIGNvbnRlbnQubGVuZ3RoID4gNDAwMFxuICAgICAgICAgICAgICAgICAgPyBjb250ZW50LnNsaWNlKDAsIDQwMDApICtcbiAgICAgICAgICAgICAgICAgICAgICBcIlxcblxcbi0tLVxcblxcbioqQ2xpY2sgdG8gdmlldyBmdWxsIGRvY3VtZW50KiogKHNob3dpbmcgZmlyc3QgNDAwMCBvZiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudC5sZW5ndGggK1xuICAgICAgICAgICAgICAgICAgICAgIFwiIGNoYXJhY3RlcnMpXCJcbiAgICAgICAgICAgICAgICAgIDogY29udGVudCxcbiAgICAgICAgICAgICAgICBjb250ZW50RWwsXG4gICAgICAgICAgICAgICAgZmlsZS5wYXRoLFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBtYXJrZG93blByZXZpZXcuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XG4gICAgICAgICAgICAgIGlzTWFya2Rvd25QcmV2aWV3VmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBtYXJrZG93blByZXZpZXcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgbWFya2Rvd24gcHJldmlldzpcIiwgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoaWRlTWFya2Rvd25QcmV2aWV3ID0gKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuZW1wdHkoKTtcbiAgICAgICAgICBpc01hcmtkb3duUHJldmlld1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAvLyBSZXNldCBzY3JvbGwgcG9zaXRpb24gd2hlbiBoaWRpbmdcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBZGQgaG92ZXIgaGFuZGxlcnMgdG8gdGhlIGVudGlyZSBpdGVtIGNvbnRhaW5lclxuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIHNob3dNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgKGUpID0+XG4gICAgICAgICAgdXBkYXRlUHJldmlld1Bvc2l0aW9uKGUsIG1hcmtkb3duUHJldmlldylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBZGQgbW91c2VsZWF2ZSBoYW5kbGVyIHRvIHRoZSBwcmV2aWV3IGl0c2VsZlxuICAgICAgICBtYXJrZG93blByZXZpZXcuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZU1hcmtkb3duUHJldmlldyk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIHByZXZpZXcncyBtb3VzZWxlYXZlIGhhbmRsZXIgb24gdW5sb2FkXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgXCJtb3VzZWxlYXZlXCIsXG4gICAgICAgICAgICBoaWRlTWFya2Rvd25QcmV2aWV3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9yY2UgdGhlIHByZXZpZXcgdG8gaGlkZSB3aGVuZXZlciB0aGUgcG9pbnRlciBsZWF2ZXMgdGhlIHdob2xlIHBhbmVsXG4gICAgICAgIHRoaXMuY29udGV4dFBhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJpbWFnZVwiO1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBoYW5kbGVycyBmb3IgaW1hZ2VzXG4gICAgICAgIGNvbnN0IHNob3dJbWFnZVByZXZpZXcgPSBhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGlmIChpbWFnZUZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoaW1hZ2VGaWxlKTtcbiAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0pO1xuICAgICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5zcmMgPSB1cmw7XG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb24gYW5kIHNpemUgaW1tZWRpYXRlbHkgYWZ0ZXIgaW1hZ2UgbG9hZHNcbiAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbGN1bGF0ZVByZXZpZXdEaW1lbnNpb25zKFxuICAgICAgICAgICAgICAgICAgaW1hZ2VQcmV2aWV3Lm5hdHVyYWxXaWR0aCxcbiAgICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5uYXR1cmFsSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgd2luZG93LmlubmVyV2lkdGgsXG4gICAgICAgICAgICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDtcbiAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3UG9zaXRpb24oZSwgaW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGltYWdlIHByZXZpZXc6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaGlkZUltYWdlUHJldmlldyA9ICgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnNyYyA9IFwiXCI7XG4gICAgICAgICAgLy8gUmVzZXQgZGltZW5zaW9uc1xuICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IFwiXCI7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnN0eWxlLmhlaWdodCA9IFwiXCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIHRvIHRoZSBlbnRpcmUgaXRlbSBjb250YWluZXJcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBzaG93SW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIChlKSA9PlxuICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBpbWFnZVByZXZpZXcpXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQWRkIG1vdXNlbGVhdmUgaGFuZGxlciB0byB0aGUgcHJldmlldyBpdHNlbGZcbiAgICAgICAgaW1hZ2VQcmV2aWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVJbWFnZVByZXZpZXcpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSBwcmV2aWV3J3MgbW91c2VsZWF2ZSBoYW5kbGVyIG9uIHVubG9hZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZUltYWdlUHJldmlldyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvcmNlIHRoZSBwcmV2aWV3IHRvIGhpZGUgd2hlbmV2ZXIgdGhlIHBvaW50ZXIgbGVhdmVzIHRoZSB3aG9sZSBwYW5lbFxuICAgICAgICB0aGlzLmNvbnRleHRQYW5lbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgIH0gZWxzZSBpZiAoW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgaWNvbk5hbWUgPSBcImF1ZGlvLWxpbmVzXCI7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBbXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJwZGZcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJmaWxlXCI7XG4gICAgICB9XG5cbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgaWNvbk5hbWUpO1xuXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQobGlua1RleHQsIFwiXCIsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBtZXRhIGNvbnRhaW5lciBidXQgZG9uJ3QgYWRkIGVsZW1lbnRzIHlldFxuICAgICAgY29uc3QgbWV0YSA9IGl0ZW0uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1ldGFcIiB9KTtcblxuICAgICAgLy8gQ3JlYXRlIHJlbW92ZSBidXR0b24gZmlyc3QgKGFsd2F5cyB2aXNpYmxlKVxuICAgICAgY29uc3QgcmVtb3ZlQnRuID0gbWV0YS5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW0tcmVtb3ZlXCIsXG4gICAgICAgIHRleHQ6IFwiXHUwMEQ3XCIsXG4gICAgICB9KTtcbiAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZW1vdmVDb250ZXh0RmlsZShwYXRoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgbWV0YSBpbmZvIGJhc2VkIG9uIGF2YWlsYWJsZSB3aWR0aFxuICAgICAgY29uc3QgdXBkYXRlTWV0YUluZm8gPSAoKSA9PiB7XG4gICAgICAgIC8vIEdldCBhdmFpbGFibGUgd2lkdGggKGNvbnRhaW5lciB3aWR0aCBtaW51cyBwYWRkaW5nIGFuZCBpY29uKVxuICAgICAgICBjb25zdCBhdmFpbGFibGVXaWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aCAtIDQwOyAvLyA0MHB4IGZvciBwYWRkaW5nIGFuZCBpY29uXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lV2lkdGggPSBsaW5rLm9mZnNldFdpZHRoO1xuICAgICAgICBjb25zdCByZW1vdmVCdG5XaWR0aCA9IDI0OyAvLyBGaXhlZCB3aWR0aCBvZiByZW1vdmUgYnV0dG9uXG4gICAgICAgIFxuICAgICAgICAvLyBDYWxjdWxhdGUgcmVtYWluaW5nIHdpZHRoXG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1dpZHRoID0gYXZhaWxhYmxlV2lkdGggLSBmaWxlTmFtZVdpZHRoIC0gcmVtb3ZlQnRuV2lkdGg7XG5cbiAgICAgICAgLy8gQ2xlYXIgZXhpc3RpbmcgbWV0YSBlbGVtZW50c1xuICAgICAgICBjb25zdCBleGlzdGluZ01ldGEgPSBtZXRhLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zeXN0ZW1zY3VscHQtY29udGV4dC10eXBlLCAuc3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZSwgLnN5c3RlbXNjdWxwdC1jb250ZXh0LXRva2VuLWNvdW50Jyk7XG4gICAgICAgIGV4aXN0aW5nTWV0YS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcblxuICAgICAgICAvLyBPbmx5IGFkZCBtZXRhIGVsZW1lbnRzIGlmIHdlIGhhdmUgZW5vdWdoIHNwYWNlXG4gICAgICAgIGlmIChyZW1haW5pbmdXaWR0aCA+IDE1MCkgeyAvLyBNaW5pbXVtIHdpZHRoIG5lZWRlZCBmb3IgbWV0YSBpbmZvXG4gICAgICAgICAgLy8gQWRkIGZpbGUgdHlwZSAoaWYgd2UgaGF2ZSByb29tKVxuICAgICAgICAgIGlmIChyZW1haW5pbmdXaWR0aCA+IDIwMCkge1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IG1ldGEuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXR5cGVcIiB9KTtcbiAgICAgICAgICAgIHR5cGUuc2V0VGV4dChmaWxlLmV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBBZGQgZmlsZSBzaXplIChpZiB3ZSBoYXZlIHJvb20pXG4gICAgICAgICAgaWYgKHJlbWFpbmluZ1dpZHRoID4gMTAwKSB7XG4gICAgICAgICAgICBjb25zdCBzaXplID0gbWV0YS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZVwiIH0pO1xuICAgICAgICAgICAgc2l6ZS5zZXRUZXh0KHRoaXMuZm9ybWF0RmlsZVNpemUoZmlsZS5zdGF0Py5zaXplIHx8IDApKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBBZGQgdG9rZW4gY291bnQgZm9yIHRleHQgZmlsZXMgKGlmIHdlIGhhdmUgcm9vbSlcbiAgICAgICAgICBpZiAocmVtYWluaW5nV2lkdGggPiAyNTAgJiYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpKSB7XG4gICAgICAgICAgICBjb25zdCB0b2tlbkNvdW50ID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdG9rZW4tY291bnRcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDA7XG4gICAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQodGhpcy50b2tlbkNvdW50ZXIuZm9ybWF0VG9rZW5Db3VudChjb3VudCkpO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG9rZW4gY291bnQgaWYgbm90IGFscmVhZHkgZG9uZVxuICAgICAgICAgICAgaWYgKCF0aGlzLnRva2VuQ291bnRzLmhhcyhmaWxlLnBhdGgpKSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlVG9rZW5Db3VudChmaWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQoXG4gICAgICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDBcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEluaXRpYWwgdXBkYXRlXG4gICAgICB1cGRhdGVNZXRhSW5mbygpO1xuXG4gICAgICAvLyBVcGRhdGUgb24gcmVzaXplXG4gICAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICAgIHVwZGF0ZU1ldGFJbmZvKCk7XG4gICAgICB9KTtcbiAgICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUoY29udGFpbmVyKTtcblxuICAgICAgLy8gQ2xlYW4gdXAgb2JzZXJ2ZXIgd2hlbiBjb21wb25lbnQgdW5sb2Fkc1xuICAgICAgdGhpcy5yZWdpc3RlcigoKSA9PiB7XG4gICAgICAgIHJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYWRkQ29udGV4dEZpbGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgQ29udGV4dFNlbGVjdGlvbk1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICBhc3luYyAoZmlsZXM6IFRGaWxlW10pID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICBgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGhpcy5wbHVnaW5cbiAgICApO1xuICAgIG1vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVtb3ZlQ29udGV4dEZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMuZGVsZXRlKGZpbGVQYXRoKTtcbiAgICB0aGlzLmNvbnRleHRGaWxlcy5kZWxldGUoYFtbJHtub3JtYWxpemVkUGF0aH1dXWApO1xuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gICAgYXdhaXQgdGhpcy5vbkNvbnRleHRDaGFuZ2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBhZGRGaWxlVG9Db250ZXh0KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBkYXRhbGFiRG9jRXh0ZW5zaW9ucyA9IFtcbiAgICAgIFwicGRmXCIsXG4gICAgICBcImRvY1wiLFxuICAgICAgXCJkb2N4XCIsXG4gICAgICBcInhsc1wiLFxuICAgICAgXCJ4bHN4XCIsXG4gICAgICBcInBwdFwiLFxuICAgICAgXCJwcHR4XCIsXG4gICAgXTtcbiAgICBjb25zdCBhdWRpb0V4dGVuc2lvbnMgPSBbXCJ3YXZcIiwgXCJtNGFcIiwgXCJ3ZWJtXCIsIFwib2dnXCIsIFwibXAzXCJdO1xuXG4gICAgLy8gQ2hlY2sgbGljZW5zZSBiZWZvcmUgcHJvY2Vzc2luZ1xuICAgIGlmIChcbiAgICAgICEoYXdhaXQgTGljZW5zZUNoZWNrZXIuY2hlY2tMaWNlbnNlRm9yRmlsZShmaWxlLCB0aGlzLmFwcCwgdGhpcy5wbHVnaW4pKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIGZpbGUgaXMgYSBkb2N1bWVudCB0aGF0IG5lZWRzIERhdGFsYWIgcHJvY2Vzc2luZ1xuICAgIGlmIChkYXRhbGFiRG9jRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NEb2N1bWVudEZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGF1ZGlvRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NBdWRpb0ZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3JpZ2luYWwgbG9naWMgZm9yIG5vcm1hbCBmaWxlXG4gICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7ZmlsZS5wYXRofV1dYDtcbiAgICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZCh3aWtpTGluayk7XG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgICBhd2FpdCB0aGlzLm9uQ29udGV4dENoYW5nZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzRG9jdW1lbnRGaWxlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSB1cGxvYWRpbmdcbiAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJVcGxvYWRpbmcuLi5cIiwgXCJ1cGxvYWRcIik7XG4gICAgY29uc3QgeyBkb2N1bWVudElkLCBzdGF0dXMsIGNhY2hlZCB9ID1cbiAgICAgIGF3YWl0IHRoaXMuc2N1bHB0U2VydmljZS51cGxvYWREb2N1bWVudChmaWxlKTtcblxuICAgIC8vIElmIGRvY3VtZW50IGlzIGNhY2hlZCwgc2tpcCBwb2xsXG4gICAgaWYgKCFjYWNoZWQpIHtcbiAgICAgIC8vIEluZGljYXRlIHdlJ3JlIHByb2Nlc3NpbmdcbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlByb2Nlc3NpbmcuLi5cIiwgXCJsb2FkZXItMlwiKTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLnBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQpO1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvY3VtZW50IHByb2Nlc3Npbmcgbm90IGNvbXBsZXRlZCBpbiB0aW1lLlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSBkb3dubG9hZGluZyByZXN1bHRzXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiRG93bmxvYWRpbmcgcmVzdWx0cy4uLlwiLCBcImRvd25sb2FkXCIpO1xuICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG5cbiAgICAvLyBDcmVhdGUgc3ViZm9sZGVyIGFuZCAubWQgd2l0aCBleHRyYWN0ZWQgdGV4dFxuICAgIGNvbnN0IGV4dHJhY3Rpb25Gb2xkZXIgPSB0aGlzLnNjdWxwdFNlcnZpY2UuZXh0cmFjdGlvbnNEaXJlY3Rvcnk7XG4gICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lLnJlcGxhY2UoL1tcXFxcLzoqP1wiPD58XS9nLCBcIi1cIikudHJpbSgpO1xuICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCA/PyBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIocGFyZW50UGF0aCkuY2F0Y2goKCkgPT4ge1xuICAgICAgLyogZm9sZGVyIG1heSBleGlzdCAqL1xuICAgIH0pO1xuXG4gICAgY29uc3QgZXh0cmFjdGVkVGV4dCA9IHRoaXMuZ2V0RXh0cmFjdGlvbk1hcmtkb3duKGV4dHJhY3Rpb25EYXRhKTtcbiAgICBjb25zdCBuZXdNZFBhdGggPSBgJHtwYXJlbnRQYXRofS8ke2Jhc2VOYW1lfS5tZGA7XG5cbiAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBtYXJrZG93biBmaWxlLCBpZiBpdCBleGlzdHMsIHdlJ2xsIHVzZSB0aGUgZXhpc3Rpbmcgb25lXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShuZXdNZFBhdGgsIGV4dHJhY3RlZFRleHQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBGaWxlIGV4aXN0cywgdGhhdCdzIG9rYXkgLSB3ZSdsbCB1c2UgaXRcbiAgICAgIGlmIChcbiAgICAgICAgIShlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB8fFxuICAgICAgICAhZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IGlmIGl0J3Mgbm90IGEgXCJmaWxlIGV4aXN0c1wiIGVycm9yXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBtYXJrZG93biBmaWxlIHRvIGNvbnRleHRcbiAgICBjb25zdCBtZFdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZChtZFdpa2lMaW5rKTtcblxuICAgIC8vIEhhbmRsZSBpbWFnZXMgYW5kIGFkZCB0aGVtIHRvIGNvbnRleHRcbiAgICBpZiAoZXh0cmFjdGlvbkRhdGEuaW1hZ2VzICYmIHR5cGVvZiBleHRyYWN0aW9uRGF0YS5pbWFnZXMgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGZvciAoY29uc3QgW2ZpbGVuYW1lLCBiYXNlNjREYXRhXSBvZiBPYmplY3QuZW50cmllcyhcbiAgICAgICAgZXh0cmFjdGlvbkRhdGEuaW1hZ2VzXG4gICAgICApKSB7XG4gICAgICAgIGNvbnN0IGltYWdlUGF0aCA9IGAke3BhcmVudFBhdGh9LyR7ZmlsZW5hbWVcbiAgICAgICAgICAucmVwbGFjZSgvW1xcXFwvOio/XCI8PnxdL2csIFwiLVwiKVxuICAgICAgICAgIC50cmltKCl9YDtcblxuICAgICAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBpbWFnZSBmaWxlLCBpZiBpdCBleGlzdHMsIHdlJ2xsIHVzZSB0aGUgZXhpc3Rpbmcgb25lXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlQmluYXJ5KFxuICAgICAgICAgICAgaW1hZ2VQYXRoLFxuICAgICAgICAgICAgdGhpcy5kZWNvZGVCYXNlNjQoYmFzZTY0RGF0YSBhcyBzdHJpbmcpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAvLyBGaWxlIGV4aXN0cywgdGhhdCdzIG9rYXkgLSB3ZSdsbCB1c2UgaXRcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHx8XG4gICAgICAgICAgICAhZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgaWYgaXQncyBub3QgYSBcImZpbGUgZXhpc3RzXCIgZXJyb3JcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgZWFjaCBpbWFnZSB0byBjb250ZXh0XG4gICAgICAgIGNvbnN0IGltYWdlV2lraUxpbmsgPSBgW1ske2ltYWdlUGF0aH1dXWA7XG4gICAgICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZChpbWFnZVdpa2lMaW5rKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3TWRQYXRoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeHRyYWN0aW9uTWFya2Rvd24oZXh0cmFjdGlvbkRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGV4dCA9IGV4dHJhY3Rpb25EYXRhPy50ZXh0ID8/IFwiXCI7XG4gICAgY29uc3QgbWV0YWRhdGEgPSBleHRyYWN0aW9uRGF0YT8ubWV0YWRhdGEgPz8ge307XG4gICAgY29uc3QgcGFnZUNvdW50ID0gZXh0cmFjdGlvbkRhdGE/LnBhZ2VDb3VudCA/PyAwO1xuICAgIHJldHVybiBgIyBEb2N1bWVudCBFeHRyYWN0aW9uXG5QYWdlIENvdW50OiAke3BhZ2VDb3VudH1cblxuJHt0ZXh0fVxuXG4ke21ldGFkYXRhID8gYFxcbiMgTWV0YWRhdGFcXG4ke0pTT04uc3RyaW5naWZ5KG1ldGFkYXRhLCBudWxsLCAyKX1gIDogXCJcIn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGRlY29kZUJhc2U2NChiYXNlNjRTdHJpbmc6IHN0cmluZyk6IEFycmF5QnVmZmVyIHtcbiAgICBjb25zdCBiaW5hcnlTdHIgPSB3aW5kb3cuYXRvYihiYXNlNjRTdHJpbmcpO1xuICAgIGNvbnN0IGxlbiA9IGJpbmFyeVN0ci5sZW5ndGg7XG4gICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShsZW4pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGJ5dGVzW2ldID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgfVxuICAgIHJldHVybiBieXRlcy5idWZmZXI7XG4gIH1cblxuICBwcml2YXRlIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIGdldENvbnRleHRGaWxlcygpOiBTZXQ8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuY29udGV4dEZpbGVzO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNldENvbnRleHRGaWxlcyhmaWxlczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmNvbnRleHRGaWxlcyA9IG5ldyBTZXQoZmlsZXMpO1xuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gICAgYXdhaXQgdGhpcy5jaGVja1N5bmNTdGF0dXMoKTtcbiAgfVxuXG4gIGdldENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuY29udGV4dFBhbmVsO1xuICB9XG5cbiAgdW5sb2FkKCk6IHZvaWQge1xuICAgIC8vIENsZWFyIGFsbCBwcm9jZXNzaW5nIHRpbWVvdXRzXG4gICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZm9yRWFjaCgodGltZW91dCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgIH0pO1xuICAgIHRoaXMucHJvY2Vzc2luZ1RpbWVvdXRzLmNsZWFyKCk7XG5cbiAgICAvLyBDbGVhciBhbGwgcHJvY2Vzc2luZyBzdGF0dXNlc1xuICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmZvckVhY2goKHN0YXR1c0VsKSA9PiB7XG4gICAgICBzdGF0dXNFbC5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5jbGVhcigpO1xuXG4gICAgaWYgKHRoaXMucHJvY2Vzc2luZ1N0YXR1cykge1xuICAgICAgdGhpcy5wcm9jZXNzaW5nU3RhdHVzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICB0aGlzLmRyYXdlci51bmxvYWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0F1ZGlvRmlsZShcbiAgICBmaWxlOiBURmlsZSxcbiAgICB0aW1lc3RhbXBlZDogYm9vbGVhbiA9IGZhbHNlXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gSW5kaWNhdGUgd2UncmUgdHJhbnNjcmliaW5nXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiVHJhbnNjcmliaW5nIGF1ZGlvLi4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIFRyYW5zY3JpcHRpb25TZXJ2aWNlIGRpcmVjdGx5XG4gICAgICBjb25zdCB0cmFuc2NyaXB0aW9uU2VydmljZSA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0cmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlRmlsZShmaWxlLCB7XG4gICAgICAgIHR5cGU6IFwibm90ZVwiLFxuICAgICAgICB0aW1lc3RhbXBlZCxcbiAgICAgICAgb25Qcm9ncmVzczogKHByb2dyZXNzLCBzdGF0dXMpID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgc3RhdHVzLCBcImxvYWRlci0yXCIpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBzdWJmb2xkZXIgKyAubWQgd2l0aCB0cmFuc2NyaWJlZCB0ZXh0XG4gICAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lLnJlcGxhY2UoL1tcXFxcLzoqP1wiPD58XS9nLCBcIi1cIikudHJpbSgpO1xuICAgICAgY29uc3QgcGFyZW50UGF0aCA9IGV4dHJhY3Rpb25Gb2xkZXJcbiAgICAgICAgPyBgJHtleHRyYWN0aW9uRm9sZGVyfS8ke2Jhc2VOYW1lfWBcbiAgICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCA/PyBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKS5jYXRjaCgoKSA9PiB7fSk7XG5cbiAgICAgIGNvbnN0IG91dHB1dFBhdGggPSBgJHtwYXJlbnRQYXRofS8ke2Jhc2VOYW1lfS5tZGA7XG4gICAgICBjb25zdCBmaW5hbENvbnRlbnQgPSBgIyBBdWRpbyBUcmFuc2NyaXB0aW9uXG5Tb3VyY2U6ICR7ZmlsZS5iYXNlbmFtZX1cblRyYW5zY3JpYmVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cblxuJHt0ZXh0fWA7XG5cbiAgICAgIC8vIFRyeSBjcmVhdGluZyB0aGUgLm1kXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgob3V0cHV0UGF0aCk7XG4gICAgICAgIGlmIChleGlzdGluZ0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGZpbmFsQ29udGVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKG91dHB1dFBhdGgsIGZpbmFsQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGaWxlIG9wZXJhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIkFkZGVkIHN1Y2Nlc3NmdWxseSFcIiwgXCJjaGVjay1jaXJjbGVcIik7XG4gICAgICByZXR1cm4gb3V0cHV0UGF0aDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1ZGlvIHRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICAgICAgZmlsZSxcbiAgICAgICAgYEVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IG1heFRyaWVzID0gNTA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhUcmllczsgaSsrKSB7XG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDMwMDApO1xuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9kb2N1bWVudHMvJHtkb2N1bWVudElkfWA7XG4gICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgIGlmICghcmVzcC5vaykgY29udGludWU7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICBpZiAoZGF0YT8uZGF0YT8uc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChkYXRhPy5kYXRhPy5zdGF0dXMgPT09IFwiZXJyb3JcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YT8uZGF0YT8uZXJyb3IgfHwgXCJQcm9jZXNzaW5nIGZhaWxlZFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9kb2N1bWVudHMvJHtkb2N1bWVudElkfS9kb3dubG9hZGA7XG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgaWYgKCFyZXNwLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERvd25sb2FkIGV4dHJhY3Rpb24gZmFpbGVkOiAke3Jlc3Auc3RhdHVzfWApO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgaWYgKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yIHx8IFwiRmFpbGVkIHRvIGRvd25sb2FkIGV4dHJhY3Rpb25cIik7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLmRhdGEuZXh0cmFjdGlvblJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiIHx8IGZpbGUuZXh0ZW5zaW9uID09PSBcInR4dFwiKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICByZXR1cm4gdGhpcy50b2tlbkNvdW50ZXIuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxjdWxhdGluZyB0b2tlbnMgZm9yIGZpbGU6XCIsIGZpbGUucGF0aCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZSk7XG4gICAgdGhpcy50b2tlbkNvdW50cy5zZXQoZmlsZS5wYXRoLCBjb3VudCk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChieXRlcyA8IDEwMjQpIHJldHVybiBieXRlcyArIFwiIEJcIjtcbiAgICBjb25zdCBrYiA9IGJ5dGVzIC8gMTAyNDtcbiAgICBpZiAoa2IgPCAxMDI0KSByZXR1cm4ga2IudG9GaXhlZCgxKSArIFwiIEtCXCI7XG4gICAgY29uc3QgbWIgPSBrYiAvIDEwMjQ7XG4gICAgcmV0dXJuIG1iLnRvRml4ZWQoMSkgKyBcIiBNQlwiO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFNlYXJjaFNlcnZpY2UgfSBmcm9tIFwic3JjL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2VcIjtcbmltcG9ydCB7IHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRva2VuQ291bnRlclNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvVG9rZW5Db3VudGVyU2VydmljZVwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IExpY2Vuc2VDaGVja2VyIH0gZnJvbSBcIi4uL2NvcmUvbGljZW5zZS9MaWNlbnNlQ2hlY2tlclwiO1xuXG4vLyBEZWZpbmUgc3VwcG9ydGVkIGZpbGUgdHlwZXNcbmNvbnN0IFNVUFBPUlRFRF9FWFRFTlNJT05TID0ge1xuICBkb2N1bWVudHM6IFtcIm1kXCIsIFwidHh0XCJdLFxuICBwcm9Eb2N1bWVudHM6IFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiXSxcbiAgaW1hZ2VzOiBbXCJwbmdcIiwgXCJqcGdcIiwgXCJqcGVnXCIsIFwiZ2lmXCIsIFwic3ZnXCIsIFwid2VicFwiXSxcbiAgYXVkaW86IFtcIm1wM1wiLCBcIndhdlwiLCBcIm00YVwiLCBcIm9nZ1wiLCBcIndlYm1cIl0sXG59O1xuXG4vLyBGbGF0dGVuIGFsbCBzdXBwb3J0ZWQgZXh0ZW5zaW9ucyBpbnRvIGEgc2luZ2xlIGFycmF5XG5jb25zdCBBTExfU1VQUE9SVEVEX0VYVEVOU0lPTlMgPSBPYmplY3QudmFsdWVzKFNVUFBPUlRFRF9FWFRFTlNJT05TKS5mbGF0KCk7XG5cbmludGVyZmFjZSBTZWFyY2hNYXRjaCB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgaW5kaWNlczogbnVtYmVyW107XG4gIG1hdGNoUXVhbGl0eTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU2VhcmNoUmVzdWx0PFQ+IHtcbiAgaXRlbTogVDtcbiAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXTtcbiAgc2NvcmU6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIENvbnRleHRDYXJkIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgcGF0aDogc3RyaW5nO1xuICBzaXplOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIENvbnRleHRTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlO1xuICBwcml2YXRlIHRva2VuQ291bnRlcjogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChmaWxlczogVEZpbGVbXSkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBmaWxlczogVEZpbGVbXTtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSByZXN1bHRzQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXJyZW50U2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PFRGaWxlPltdID0gW107XG4gIHByaXZhdGUgbG9hZGluZ0luZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgZW1wdHlTdGF0ZTogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoVGltZW91dDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2VsZWN0ZWRFeHRlbnNpb25zOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBleHRlbnNpb25CdXR0b25zOiBNYXA8c3RyaW5nLCBIVE1MRWxlbWVudD4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgc2VsZWN0ZWRGaWxlczogU2V0PFRGaWxlPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBzZWxlY3RlZEluZGV4ID0gMDtcbiAgcHJpdmF0ZSByZXN1bHRFbGVtZW50czogSFRNTEVsZW1lbnRbXSA9IFtdO1xuICBwcml2YXRlIHBsdWdpbjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblNlbGVjdDogKGZpbGVzOiBURmlsZVtdKSA9PiB2b2lkLCBwbHVnaW46IGFueSkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5vblNlbGVjdCA9IG9uU2VsZWN0O1xuICAgIHRoaXMuc2VhcmNoU2VydmljZSA9IG5ldyBTZWFyY2hTZXJ2aWNlKCk7XG4gICAgdGhpcy50b2tlbkNvdW50ZXIgPSBUb2tlbkNvdW50ZXJTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5maWxlcyA9IHRoaXMuZ2V0QXZhaWxhYmxlRmlsZXMoKTtcbiAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5hZGQoXCJtZFwiKTsgLy8gRGVmYXVsdCB0byBNYXJrZG93biBmaWx0ZXJcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXZhaWxhYmxlRmlsZXMoKTogVEZpbGVbXSB7XG4gICAgLy8gU2hvdyBvbmx5IHN1cHBvcnRlZCBmaWxlc1xuICAgIHJldHVybiB0aGlzLmFwcC52YXVsdFxuICAgICAgLmdldEZpbGVzKClcbiAgICAgIC5maWx0ZXIoKGZpbGUpID0+XG4gICAgICAgIEFMTF9TVVBQT1JURURfRVhURU5TSU9OUy5pbmNsdWRlcyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKVxuICAgICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VhcmNoRmllbGRzKGZpbGU6IFRGaWxlKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHsgZmllbGQ6IFwidGl0bGVcIiwgdGV4dDogZmlsZS5iYXNlbmFtZSwgd2VpZ2h0OiAxMDAgfSxcbiAgICAgIHsgZmllbGQ6IFwicGF0aFwiLCB0ZXh0OiBmaWxlLnBhdGgsIHdlaWdodDogNzUgfSxcbiAgICAgIHsgZmllbGQ6IFwiZXh0ZW5zaW9uXCIsIHRleHQ6IGZpbGUuZXh0ZW5zaW9uLCB3ZWlnaHQ6IDUwIH0sXG4gICAgXTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGJ5dGVzIDwgMTAyNCkgcmV0dXJuIGJ5dGVzICsgXCIgQlwiO1xuICAgIGNvbnN0IGtiID0gYnl0ZXMgLyAxMDI0O1xuICAgIGlmIChrYiA8IDEwMjQpIHJldHVybiBrYi50b0ZpeGVkKDEpICsgXCIgS0JcIjtcbiAgICBjb25zdCBtYiA9IGtiIC8gMTAyNDtcbiAgICByZXR1cm4gbWIudG9GaXhlZCgxKSArIFwiIE1CXCI7XG4gIH1cblxuICBwcml2YXRlIGhpZ2hsaWdodFRleHQoXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXVxuICApOiBEb2N1bWVudEZyYWdtZW50IHtcbiAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoKTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dCk7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBjcmVhdGVGcmFnbWVudCgpO1xuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dD8udmFsdWUgfHwgXCJcIjtcblxuICAgIC8vIFVzZSByZWdleCB0byBmaW5kIHdob2xlIHdvcmQgb3IgcGhyYXNlIG1hdGNoZXNcbiAgICBjb25zdCBub3JtYWxpemVkUXVlcnkgPSBzZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYCgke25vcm1hbGl6ZWRRdWVyeX0pYCwgXCJnaVwiKTtcbiAgICBsZXQgbGFzdEluZGV4ID0gMDtcbiAgICBsZXQgbWF0Y2g7XG5cbiAgICB3aGlsZSAoKG1hdGNoID0gcmVnZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcbiAgICAgIC8vIEFkZCBub24taGlnaGxpZ2h0ZWQgdGV4dCBiZWZvcmUgbWF0Y2hcbiAgICAgIGlmIChtYXRjaC5pbmRleCA+IGxhc3RJbmRleCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4LCBtYXRjaC5pbmRleCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgaGlnaGxpZ2h0ZWQgbWF0Y2hcbiAgICAgIGNvbnN0IHNwYW4gPSBmcmFnbWVudC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1oaWdobGlnaHRcIixcbiAgICAgICAgdGV4dDogbWF0Y2hbMF0sXG4gICAgICB9KTtcblxuICAgICAgbGFzdEluZGV4ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgfVxuXG4gICAgaWYgKGxhc3RJbmRleCA8IHRleHQubGVuZ3RoKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRUZXh0KHRleHQuc2xpY2UobGFzdEluZGV4KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZyYWdtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVMb2FkaW5nSW5kaWNhdG9yKCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbG9hZGluZ1wiIH0pO1xuICAgIHNldEljb24oY29udGFpbmVyLCBcImxvYWRlci0yXCIpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVTcGFuKHsgdGV4dDogXCJMb2FkaW5nLi4uXCIgfSkpO1xuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUVtcHR5U3RhdGUoKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1lbXB0eVwiIH0pO1xuICAgIHNldEljb24oY29udGFpbmVyLCBcInNlYXJjaFwiKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlU3Bhbih7IHRleHQ6IFwiTm8gbWF0Y2hpbmcgZmlsZXMgZm91bmRcIiB9KSk7XG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiIHx8IGZpbGUuZXh0ZW5zaW9uID09PSBcInR4dFwiKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICByZXR1cm4gdGhpcy50b2tlbkNvdW50ZXIuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxjdWxhdGluZyB0b2tlbnMgZm9yIGZpbGU6XCIsIGZpbGUucGF0aCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZSk7XG4gICAgdGhpcy50b2tlbkNvdW50cy5zZXQoZmlsZS5wYXRoLCBjb3VudCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNhcmQoZmlsZTogVEZpbGUsIHJlc3VsdDogU2VhcmNoUmVzdWx0PFRGaWxlPik6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWNhcmRcIiB9KTtcbiAgICBjYXJkLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMFwiKTtcbiAgICBjb25zdCBjYXJkQ29udGVudCA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jYXJkLWNvbnRlbnRcIiB9KTtcblxuICAgIC8vIEFkZCB0aHVtYm5haWwgZm9yIGltYWdlIGZpbGVzXG4gICAgaWYgKGZpbGUuZXh0ZW5zaW9uLm1hdGNoKC9wbmd8anBlP2d8Z2lmfHN2Z3x3ZWJwL2kpKSB7XG4gICAgICBjb25zdCB0aHVtYkNvbnRhaW5lciA9IGNhcmRDb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10aHVtYm5haWxcIixcbiAgICAgIH0pO1xuXG4gICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZEJpbmFyeShmaWxlKTtcbiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2FycmF5QnVmZmVyXSk7XG4gICAgICAgICAgY29uc3Qgb2JqZWN0VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcblxuICAgICAgICAgIGNvbnN0IGltZyA9IHRodW1iQ29udGFpbmVyLmNyZWF0ZUVsKFwiaW1nXCIsIHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10aHVtYi1pbWdcIixcbiAgICAgICAgICAgIGF0dHI6IHsgc3JjOiBvYmplY3RVcmwgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgdGh1bWJuYWlsOlwiLCBlcnIpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNlbGVjdGVkRmlsZXMuaGFzKGZpbGUpKSB7XG4gICAgICBjYXJkLmFkZENsYXNzKFwiaXMtYWRkZWRcIik7XG4gICAgICBjb25zdCBjaGVja0ljb24gPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1jaGVja1wiIH0pO1xuICAgICAgc2V0SWNvbihjaGVja0ljb24sIFwiY2hlY2tcIik7XG4gICAgfVxuXG4gICAgY29uc3QgdGV4dENvbnRhaW5lciA9IGNhcmRDb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNhcmQtdGV4dFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGl0bGUgPSB0ZXh0Q29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdGl0bGVcIixcbiAgICB9KTtcbiAgICB0aXRsZS5hcHBlbmRDaGlsZChcbiAgICAgIHRoaXMuaGlnaGxpZ2h0VGV4dChcbiAgICAgICAgZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgcmVzdWx0Lm1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLmZpZWxkID09PSBcInRpdGxlXCIpXG4gICAgICApXG4gICAgKTtcblxuICAgIGNvbnN0IHBhdGggPSB0ZXh0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1wYXRoXCIgfSk7XG4gICAgcGF0aC5hcHBlbmRDaGlsZChcbiAgICAgIHRoaXMuaGlnaGxpZ2h0VGV4dChcbiAgICAgICAgZmlsZS5wYXRoLFxuICAgICAgICByZXN1bHQubWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwicGF0aFwiKVxuICAgICAgKVxuICAgICk7XG5cbiAgICBjb25zdCBtZXRhID0gdGV4dENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbWV0YVwiIH0pO1xuXG4gICAgY29uc3QgdHlwZUdyb3VwID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXR5cGUtZ3JvdXBcIixcbiAgICB9KTtcbiAgICBjb25zdCB0eXBlID0gdHlwZUdyb3VwLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10eXBlXCIgfSk7XG4gICAgdHlwZS5zZXRUZXh0KGZpbGUuZXh0ZW5zaW9uLnRvVXBwZXJDYXNlKCkpO1xuXG4gICAgLy8gQWRkIHBybyBiYWRnZSBuZXh0IHRvIGZpbGUgZXh0ZW5zaW9uIGlmIHJlcXVpcmVkXG4gICAgaWYgKExpY2Vuc2VDaGVja2VyLnJlcXVpcmVzUHJvTGljZW5zZShmaWxlLmV4dGVuc2lvbikpIHtcbiAgICAgIGNvbnN0IHByb0JhZGdlID0gdHlwZUdyb3VwLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1iYWRnZSBwcm8tYmFkZ2VcIixcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihwcm9CYWRnZS5jcmVhdGVTcGFuKCksIFwic3BhcmtsZXNcIik7XG4gICAgICBwcm9CYWRnZS5jcmVhdGVTcGFuKHsgdGV4dDogXCJQcm9cIiB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXRhR3JvdXAgPSBtZXRhLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbWV0YS1ncm91cFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2l6ZSA9IG1ldGFHcm91cC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZVwiIH0pO1xuICAgIHNpemUuc2V0VGV4dCh0aGlzLmZvcm1hdEZpbGVTaXplKGZpbGUuc3RhdD8uc2l6ZSB8fCAwKSk7XG5cbiAgICBpZiAoZmlsZS5leHRlbnNpb24gPT09IFwibWRcIiB8fCBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ0eHRcIikge1xuICAgICAgY29uc3QgdG9rZW5Db3VudCA9IG1ldGFHcm91cC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdG9rZW4tY291bnRcIixcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY291bnQgPSB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDA7XG4gICAgICB0b2tlbkNvdW50LnNldFRleHQodGhpcy50b2tlbkNvdW50ZXIuZm9ybWF0VG9rZW5Db3VudChjb3VudCkpO1xuXG4gICAgICBpZiAoIXRoaXMudG9rZW5Db3VudHMuaGFzKGZpbGUucGF0aCkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVUb2tlbkNvdW50KGZpbGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRva2VuQ291bnQuc2V0VGV4dChcbiAgICAgICAgICAgIHRoaXMudG9rZW5Db3VudGVyLmZvcm1hdFRva2VuQ291bnQoXG4gICAgICAgICAgICAgIHRoaXMudG9rZW5Db3VudHMuZ2V0KGZpbGUucGF0aCkgfHwgMFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMudG9nZ2xlRmlsZVNlbGVjdGlvbihmaWxlLCBjYXJkKTtcbiAgICB9KTtcblxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlc3VsdEVsZW1lbnRzLmluZGV4T2YoY2FyZCk7XG4gICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSBpbmRleDtcbiAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJlc3VsdCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNhcmQ7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkUmVzdWx0KCkge1xuICAgIHRoaXMucmVzdWx0RWxlbWVudHMuZm9yRWFjaCgoZWwsIGluZGV4KSA9PiB7XG4gICAgICBlbC50b2dnbGVDbGFzcyhcbiAgICAgICAgXCJpcy1zZWxlY3RlZFwiLFxuICAgICAgICBpbmRleCA9PT0gdGhpcy5zZWxlY3RlZEluZGV4ICYmIHRoaXMuc2VsZWN0ZWRJbmRleCA+PSAwXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID49IDAgJiZcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA8IHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoXG4gICAgKSB7XG4gICAgICB0aGlzLnJlc3VsdEVsZW1lbnRzW3RoaXMuc2VsZWN0ZWRJbmRleF0uc2Nyb2xsSW50b1ZpZXcoe1xuICAgICAgICBiZWhhdmlvcjogXCJzbW9vdGhcIixcbiAgICAgICAgYmxvY2s6IFwibmVhcmVzdFwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB0b2dnbGVGaWxlU2VsZWN0aW9uKGZpbGU6IFRGaWxlLCBjYXJkRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgLy8gQ2hlY2sgbGljZW5zZSBiZWZvcmUgYWxsb3dpbmcgc2VsZWN0aW9uXG4gICAgaWYgKFxuICAgICAgIShhd2FpdCBMaWNlbnNlQ2hlY2tlci5jaGVja0xpY2Vuc2VGb3JGaWxlKGZpbGUsIHRoaXMuYXBwLCB0aGlzLnBsdWdpbikpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlcy5oYXMoZmlsZSkpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcy5kZWxldGUoZmlsZSk7XG4gICAgICBjYXJkRWwucmVtb3ZlQ2xhc3MoXCJpcy1hZGRlZFwiKTtcbiAgICAgIGNhcmRFbC5xdWVyeVNlbGVjdG9yKFwiLnN5c3RlbXNjdWxwdC1jb250ZXh0LWNoZWNrXCIpPy5yZW1vdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzLmFkZChmaWxlKTtcbiAgICAgIGNhcmRFbC5hZGRDbGFzcyhcImlzLWFkZGVkXCIpO1xuICAgICAgY29uc3QgY2hlY2tJY29uID0gY2FyZEVsLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1jaGVja1wiIH0pO1xuICAgICAgc2V0SWNvbihjaGVja0ljb24sIFwiY2hlY2tcIik7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlQWN0aW9uQnV0dG9uKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUFjdGlvbkJ1dHRvbigpIHtcbiAgICBjb25zdCBhY3Rpb25CdXR0b24gPSB0aGlzLmNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5zeXN0ZW1zY3VscHQtY29udGV4dC1hY3Rpb24tYnV0dG9uXCJcbiAgICApO1xuICAgIGlmIChhY3Rpb25CdXR0b24pIHtcbiAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5zZWxlY3RlZEZpbGVzLnNpemU7XG4gICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcbiAgICAgICAgY291bnQgPiAwXG4gICAgICAgICAgPyBgQWRkICR7Y291bnR9IHNlbGVjdGVkIGZpbGUke2NvdW50ID09PSAxID8gXCJcIiA6IFwic1wifWBcbiAgICAgICAgICA6IFwiU2VsZWN0IGZpbGVzIHRvIGFkZCBhcyBjb250ZXh0XCJcbiAgICAgICk7XG4gICAgICBhY3Rpb25CdXR0b24udG9nZ2xlQ2xhc3MoXCJpcy1hY3RpdmVcIiwgY291bnQgPiAwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclJlc3VsdHMoc2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PFRGaWxlPltdKSB7XG4gICAgdGhpcy5yZXN1bHRzQ29udGFpbmVyLmVtcHR5KCk7XG4gICAgdGhpcy5yZXN1bHRFbGVtZW50cyA9IFtdO1xuICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSBzZWFyY2hSZXN1bHRzO1xuXG4gICAgaWYgKHNlYXJjaFJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZW1wdHlTdGF0ZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBncmlkID0gdGhpcy5yZXN1bHRzQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtZ3JpZFwiLFxuICAgIH0pO1xuXG4gICAgc2VhcmNoUmVzdWx0cy5mb3JFYWNoKChyZXN1bHQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjYXJkID0gdGhpcy5jcmVhdGVDYXJkKHJlc3VsdC5pdGVtLCByZXN1bHQpO1xuICAgICAgZ3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgIHRoaXMucmVzdWx0RWxlbWVudHMucHVzaChjYXJkKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VW5pcXVlRXh0ZW5zaW9ucygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgZXh0ZW5zaW9ucyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIHRoaXMuZmlsZXMuZm9yRWFjaCgoZmlsZSkgPT4ge1xuICAgICAgaWYgKGZpbGUuZXh0ZW5zaW9uKSB7XG4gICAgICAgIGV4dGVuc2lvbnMuYWRkKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQ3VzdG9tIHNvcnRpbmc6IE1EIGZpcnN0LCB0aGVuIG5vbi1wcm8sIHRoZW4gcHJvXG4gICAgcmV0dXJuIEFycmF5LmZyb20oZXh0ZW5zaW9ucykuc29ydCgoYSwgYikgPT4ge1xuICAgICAgLy8gTUQgZmlsZXMgYWx3YXlzIGNvbWUgZmlyc3RcbiAgICAgIGlmIChhID09PSBcIm1kXCIpIHJldHVybiAtMTtcbiAgICAgIGlmIChiID09PSBcIm1kXCIpIHJldHVybiAxO1xuXG4gICAgICBjb25zdCBhSXNQcm8gPSBMaWNlbnNlQ2hlY2tlci5yZXF1aXJlc1Byb0xpY2Vuc2UoYSk7XG4gICAgICBjb25zdCBiSXNQcm8gPSBMaWNlbnNlQ2hlY2tlci5yZXF1aXJlc1Byb0xpY2Vuc2UoYik7XG5cbiAgICAgIC8vIFRoZW4gc29ydCBieSBwcm8vbm9uLXByb1xuICAgICAgaWYgKGFJc1BybyAmJiAhYklzUHJvKSByZXR1cm4gMTtcbiAgICAgIGlmICghYUlzUHJvICYmIGJJc1BybykgcmV0dXJuIC0xO1xuXG4gICAgICAvLyBGaW5hbGx5IHNvcnQgYWxwaGFiZXRpY2FsbHkgd2l0aGluIHRoZWlyIGdyb3Vwc1xuICAgICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXh0ZW5zaW9uQnV0dG9uKGV4dGVuc2lvbjogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGJ1dHRvbiA9IGNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi1idXR0b25cIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBpY29uIGJhc2VkIG9uIGZpbGUgdHlwZVxuICAgIGNvbnN0IGljb25Db250YWluZXIgPSBidXR0b24uY3JlYXRlU3Bhbih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi1pY29uXCIsXG4gICAgfSk7XG5cbiAgICBpZiAoU1VQUE9SVEVEX0VYVEVOU0lPTlMuZG9jdW1lbnRzLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgXCJmaWxlLXRleHRcIik7XG4gICAgfSBlbHNlIGlmIChTVVBQT1JURURfRVhURU5TSU9OUy5pbWFnZXMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgc2V0SWNvbihpY29uQ29udGFpbmVyLCBcImltYWdlXCIpO1xuICAgIH0gZWxzZSBpZiAoU1VQUE9SVEVEX0VYVEVOU0lPTlMuYXVkaW8uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgc2V0SWNvbihpY29uQ29udGFpbmVyLCBcImhlYWRwaG9uZXNcIik7IC8vIENoYW5nZWQgZnJvbSAnYXVkaW8nIHRvICdoZWFkcGhvbmVzJ1xuICAgIH1cblxuICAgIGJ1dHRvbi5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IGV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24tdGV4dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHBybyBiYWRnZSBpZiBuZWVkZWRcbiAgICBpZiAoTGljZW5zZUNoZWNrZXIucmVxdWlyZXNQcm9MaWNlbnNlKGV4dGVuc2lvbikpIHtcbiAgICAgIGNvbnN0IHByb0JhZGdlID0gYnV0dG9uLmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi1iYWRnZSBwcm8tYmFkZ2VcIixcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihwcm9CYWRnZSwgXCJzcGFya2xlc1wiKTtcbiAgICB9XG5cbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5oYXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5kZWxldGUoZXh0ZW5zaW9uKTtcbiAgICAgICAgYnV0dG9uLnJlbW92ZUNsYXNzKFwiaXMtc2VsZWN0ZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5hZGQoZXh0ZW5zaW9uKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiaXMtc2VsZWN0ZWRcIik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGVyZm9ybVNlYXJjaCh0aGlzLnNlYXJjaElucHV0LnZhbHVlKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBidXR0b247XG4gIH1cblxuICBwcml2YXRlIHBlcmZvcm1TZWFyY2gocXVlcnk6IHN0cmluZykge1xuICAgIGxldCByZXN1bHRzID0gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaChcbiAgICAgIHRoaXMuZmlsZXMuZmlsdGVyKFxuICAgICAgICAoZmlsZSkgPT5cbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5zaXplID09PSAwIHx8XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuaGFzKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpXG4gICAgICApLFxuICAgICAgcXVlcnksXG4gICAgICAoZmlsZSkgPT4gdGhpcy5nZXRTZWFyY2hGaWVsZHMoZmlsZSlcbiAgICApO1xuXG4gICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgcmV0dXJuIGEuaXRlbS5iYXNlbmFtZS5sb2NhbGVDb21wYXJlKGIuaXRlbS5iYXNlbmFtZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlbmRlclJlc3VsdHMocmVzdWx0cyk7XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWNvbnRleHQtbW9kYWxcIik7XG5cbiAgICBjb25zdCBzZWFyY2hDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1zZWFyY2hcIixcbiAgICB9KTtcbiAgICB0aGlzLnNlYXJjaElucHV0ID0gc2VhcmNoQ29udGFpbmVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2ggZmlsZXMgdG8gYWRkIGFzIGNvbnRleHQuLi5cIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGV4dGVuc2lvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1leHRlbnNpb24tY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBleHRlbnNpb25zID0gdGhpcy5nZXRVbmlxdWVFeHRlbnNpb25zKCk7XG4gICAgZXh0ZW5zaW9ucy5mb3JFYWNoKChleHQpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuY3JlYXRlRXh0ZW5zaW9uQnV0dG9uKGV4dCk7XG4gICAgICB0aGlzLmV4dGVuc2lvbkJ1dHRvbnMuc2V0KGV4dCwgYnV0dG9uKTtcbiAgICAgIGV4dGVuc2lvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pO1xuICAgIH0pO1xuXG4gICAgLy8gTWFyayBNRCBidXR0b24gYXMgc2VsZWN0ZWQgYnkgZGVmYXVsdFxuICAgIGNvbnN0IG1kQnRuID0gdGhpcy5leHRlbnNpb25CdXR0b25zLmdldChcIm1kXCIpO1xuICAgIGlmIChtZEJ0bikgbWRCdG4uYWRkQ2xhc3MoXCJpcy1zZWxlY3RlZFwiKTtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvciA9IHRoaXMuY3JlYXRlTG9hZGluZ0luZGljYXRvcigpO1xuICAgIGNvbnRlbnRFbC5hcHBlbmRDaGlsZCh0aGlzLmxvYWRpbmdJbmRpY2F0b3IpO1xuXG4gICAgdGhpcy5lbXB0eVN0YXRlID0gdGhpcy5jcmVhdGVFbXB0eVN0YXRlKCk7XG4gICAgdGhpcy5lbXB0eVN0YXRlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBjb250ZW50RWwuYXBwZW5kQ2hpbGQodGhpcy5lbXB0eVN0YXRlKTtcblxuICAgIGNvbnN0IHNjcm9sbENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zY3JvbGwtY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgdGhpcy5yZXN1bHRzQ29udGFpbmVyID0gc2Nyb2xsQ29udGFpbmVyLmNyZWF0ZURpdigpO1xuXG4gICAgY29uc3QgYWN0aW9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWFjdGlvbi1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGFjdGlvbkJ1dHRvbiA9IGFjdGlvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJTZWxlY3QgZmlsZXMgdG8gYWRkIGFzIGNvbnRleHRcIixcbiAgICB9KTtcblxuICAgIGFjdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlcy5zaXplID4gMCkge1xuICAgICAgICB0aGlzLm9uU2VsZWN0KEFycmF5LmZyb20odGhpcy5zZWxlY3RlZEZpbGVzKSk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMudXBkYXRlQWN0aW9uQnV0dG9uKCk7XG5cbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIHRoaXMucmVzdWx0c0NvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgdGhpcy5zZXR1cEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICB0aGlzLmNvbnRhaW5lckVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcy5zZWFyY2hJbnB1dCkgcmV0dXJuO1xuICAgICAgaWYgKHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMubGVuZ3RoID09PSAwKSByZXR1cm47XG5cbiAgICAgIGlmIChlLmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKGUuc2hpZnRLZXkgJiYgdGhpcy5zZWxlY3RlZEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID1cbiAgICAgICAgICAgICh0aGlzLnNlbGVjdGVkSW5kZXggLSAxICsgdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGgpICVcbiAgICAgICAgICAgIHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9XG4gICAgICAgICAgICAodGhpcy5zZWxlY3RlZEluZGV4ICsgMSkgJSB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUmVzdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGUuY29kZSA9PT0gXCJTcGFjZVwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHNbdGhpcy5zZWxlY3RlZEluZGV4XS5pdGVtO1xuICAgICAgICBjb25zdCBjYXJkRWwgPSB0aGlzLnJlc3VsdEVsZW1lbnRzW3RoaXMuc2VsZWN0ZWRJbmRleF07XG4gICAgICAgIHRoaXMudG9nZ2xlRmlsZVNlbGVjdGlvbihmaWxlLCBjYXJkRWwpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlcy5zaXplID4gMCkge1xuICAgICAgICAgIHRoaXMub25TZWxlY3QoQXJyYXkuZnJvbSh0aGlzLnNlbGVjdGVkRmlsZXMpKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuXG4gICAgdGhpcy5wZXJmb3JtU2VhcmNoKFwiXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIH1cblxuICBwcml2YXRlIHNldHVwRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBpZiAodGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIC8vIFNISUZUK1RhYiA9PiBmb2N1cyBsYXN0IHJlc3VsdFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGggLSAxO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBub3JtYWwgVGFiID0+IGZvY3VzIGZpcnN0IHJlc3VsdFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJlc3VsdCgpO1xuICAgICAgICAgIHRoaXMucmVzdWx0RWxlbWVudHNbdGhpcy5zZWxlY3RlZEluZGV4XS5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNlYXJjaFRpbWVvdXQpIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnNlYXJjaFRpbWVvdXQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNlYXJjaFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dC52YWx1ZTtcblxuICAgICAgICBsZXQgcmVzdWx0cyA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICAgICAgdGhpcy5maWxlcy5maWx0ZXIoXG4gICAgICAgICAgICAoZmlsZSkgPT5cbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEV4dGVuc2lvbnMuc2l6ZSA9PT0gMCB8fFxuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5oYXMoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICApLFxuICAgICAgICAgIHF1ZXJ5LFxuICAgICAgICAgIChmaWxlKSA9PiB0aGlzLmdldFNlYXJjaEZpZWxkcyhmaWxlKVxuICAgICAgICApO1xuXG4gICAgICAgIHJlc3VsdHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgcmV0dXJuIGEuaXRlbS5iYXNlbmFtZS5sb2NhbGVDb21wYXJlKGIuaXRlbS5iYXNlbmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVuZGVyUmVzdWx0cyhyZXN1bHRzKTtcbiAgICAgIH0sIDE1MCk7XG4gICAgfSk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGlmICh0aGlzLnNlYXJjaFRpbWVvdXQpIHtcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5zZWFyY2hUaW1lb3V0KTtcbiAgICB9XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBFdmVudHMgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIEZpbGVUb2tlbkNhY2hlIHtcbiAgdG9rZW5zOiBudW1iZXI7XG4gIG10aW1lOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBUb2tlbkNvdW50ZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFRva2VuQ291bnRlclNlcnZpY2U7XG4gIHByaXZhdGUgY2FjaGU6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgZmlsZUNhY2hlOiBNYXA8c3RyaW5nLCBGaWxlVG9rZW5DYWNoZT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FjaGVTaXplID0gMTAwMDtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIEJpbmQgdGhlIGV2ZW50IGhhbmRsZXJzXG4gICAgdGhpcy5oYW5kbGVGaWxlTW9kaWZ5ID0gdGhpcy5oYW5kbGVGaWxlTW9kaWZ5LmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVGaWxlRGVsZXRlID0gdGhpcy5oYW5kbGVGaWxlRGVsZXRlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVGaWxlUmVuYW1lID0gdGhpcy5oYW5kbGVGaWxlUmVuYW1lLmJpbmQodGhpcyk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVNb2RpZnkoZmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICB0aGlzLmZpbGVDYWNoZS5kZWxldGUoZmlsZS5wYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVEZWxldGUoZmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICB0aGlzLmZpbGVDYWNoZS5kZWxldGUoZmlsZS5wYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUZpbGVSZW5hbWUoZmlsZTogVEZpbGUsIG9sZFBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHRoaXMuZmlsZUNhY2hlLmRlbGV0ZShvbGRQYXRoKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogVG9rZW5Db3VudGVyU2VydmljZSB7XG4gICAgaWYgKCFUb2tlbkNvdW50ZXJTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBUb2tlbkNvdW50ZXJTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFRva2VuQ291bnRlclNlcnZpY2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIFRva2VuQ291bnRlclNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBzZXRBcHAoYXBwOiBBcHApOiB2b2lkIHtcbiAgICB0aGlzLmFwcCA9IGFwcDtcblxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLmFwcC52YXVsdC5vbihcIm1vZGlmeVwiLCB0aGlzLmhhbmRsZUZpbGVNb2RpZnkpO1xuICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwiZGVsZXRlXCIsIHRoaXMuaGFuZGxlRmlsZURlbGV0ZSk7XG4gICAgdGhpcy5hcHAudmF1bHQub24oXCJyZW5hbWVcIiwgdGhpcy5oYW5kbGVGaWxlUmVuYW1lKTtcbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGEgdmFsaWQgY2FjaGVkIGNvdW50XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5maWxlQ2FjaGUuZ2V0KGZpbGUucGF0aCk7XG4gICAgaWYgKGNhY2hlZCAmJiBjYWNoZWQubXRpbWUgPT09IGZpbGUuc3RhdC5tdGltZSkge1xuICAgICAgcmV0dXJuIGNhY2hlZC50b2tlbnM7XG4gICAgfVxuXG4gICAgLy8gUmVhZCBhbmQgY291bnQgdG9rZW5zXG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgY29uc3QgdG9rZW5zID0gdGhpcy5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG5cbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0IHdpdGggdGhlIGN1cnJlbnQgbXRpbWVcbiAgICB0aGlzLmZpbGVDYWNoZS5zZXQoZmlsZS5wYXRoLCB7XG4gICAgICB0b2tlbnMsXG4gICAgICBtdGltZTogZmlsZS5zdGF0Lm10aW1lLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRva2VucztcbiAgfVxuXG4gIGFwcHJveGltYXRlVG9rZW5Db3VudCh0ZXh0OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGlmICghdGV4dCkgcmV0dXJuIDA7XG5cbiAgICAvLyBDYWNoZSBjaGVja1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7dGV4dC5zbGljZSgwLCAxMDApfV8ke3RleHQubGVuZ3RofWA7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5jYWNoZS5nZXQoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGNhY2hlZDtcblxuICAgIC8vIFByZS1wcm9jZXNzIHRleHQgZm9yIG1vcmUgYWNjdXJhdGUgY291bnRpbmdcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XG5cbiAgICBsZXQgdG9rZW5Db3VudCA9IDA7XG5cbiAgICAvLyBDb3VudCBzcGVjaWFsIHBhdHRlcm5zIHRoYXQgY29tbW9ubHkgbWFwIHRvIHNpbmdsZSB0b2tlbnNcbiAgICBjb25zdCBjb21tb25QYXR0ZXJucyA9IFtcbiAgICAgIC9eaHR0cHM/OlxcL1xcL1xcUysvZ20sIC8vIFVSTHNcbiAgICAgIC9bQCNdXFx3Ky9nLCAvLyBNZW50aW9ucyBhbmQgaGFzaHRhZ3NcbiAgICAgIC86W2Etel9dKzovZywgLy8gRW1vamkgY29kZXNcbiAgICAgIC9bQS1aXXsyLH0vZywgLy8gQWNyb255bXNcbiAgICAgIC9cXGR7MSwxNn0vZywgLy8gTnVtYmVyc1xuICAgICAgL1suLCE/OzooKXt9XFxbXFxdXCInXS9nLCAvLyBDb21tb24gcHVuY3R1YXRpb25cbiAgICBdO1xuXG4gICAgLy8gUmVtb3ZlIGFuZCBjb3VudCBzcGVjaWFsIHBhdHRlcm5zIGZpcnN0XG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGNvbW1vblBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaGVzID0gdGV4dC5tYXRjaChwYXR0ZXJuKTtcbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIHRva2VuQ291bnQgKz0gbWF0Y2hlcy5yZWR1Y2UoKHN1bSwgbWF0Y2gpID0+IHtcbiAgICAgICAgICAvLyBBZGp1c3QgdG9rZW4gY291bnQgYmFzZWQgb24gcGF0dGVybiB0eXBlIGFuZCBsZW5ndGhcbiAgICAgICAgICBpZiAobWF0Y2guc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBzdW0gKyBNYXRoLmNlaWwobWF0Y2gubGVuZ3RoIC8gNCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPD0gNCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIDE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzdW0gKyBNYXRoLmNlaWwobWF0Y2gubGVuZ3RoIC8gMyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShwYXR0ZXJuLCBcIiBcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BsaXQgcmVtYWluaW5nIHRleHQgYW5kIGNvdW50XG4gICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9cXHMrLykuZmlsdGVyKCh3KSA9PiB3Lmxlbmd0aCA+IDApO1xuICAgIGZvciAoY29uc3Qgd29yZCBvZiB3b3Jkcykge1xuICAgICAgLy8gQmFzZSB0b2tlbiBjb3VudFxuICAgICAgbGV0IHdvcmRUb2tlbnMgPSAxO1xuXG4gICAgICAvLyBBZGp1c3QgZm9yIHdvcmQgbGVuZ3RoIChtb3N0IG1vZGVscyBzcGxpdCBsb25nIHdvcmRzKVxuICAgICAgaWYgKHdvcmQubGVuZ3RoID4gNCkge1xuICAgICAgICB3b3JkVG9rZW5zICs9IE1hdGguZmxvb3IoKHdvcmQubGVuZ3RoIC0gNCkgLyAzKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRqdXN0IGZvciBtaXhlZCBjYXNlIChwb3RlbnRpYWwgc3Vid29yZCB0b2tlbnMpXG4gICAgICBpZiAoL1thLXpdW0EtWl0vLnRlc3Qod29yZCkpIHtcbiAgICAgICAgd29yZFRva2VucyArPSAod29yZC5tYXRjaCgvW0EtWl0vZykgfHwgW10pLmxlbmd0aDtcbiAgICAgIH1cblxuICAgICAgLy8gQWRqdXN0IGZvciBub24tQVNDSUkgY2hhcmFjdGVyc1xuICAgICAgY29uc3Qgbm9uQXNjaWkgPSAod29yZC5tYXRjaCgvW15cXHgwMC1cXHg3Rl0vZykgfHwgW10pLmxlbmd0aDtcbiAgICAgIGlmIChub25Bc2NpaSA+IDApIHtcbiAgICAgICAgd29yZFRva2VucyArPSBNYXRoLmNlaWwobm9uQXNjaWkgKiAxLjUpO1xuICAgICAgfVxuXG4gICAgICB0b2tlbkNvdW50ICs9IHdvcmRUb2tlbnM7XG4gICAgfVxuXG4gICAgLy8gQWRkIDEwJSBzYWZldHkgbWFyZ2luIGZvciBvdmVyZXN0aW1hdGlvblxuICAgIHRva2VuQ291bnQgPSBNYXRoLmNlaWwodG9rZW5Db3VudCAqIDEuMSk7XG5cbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgdGhpcy5jYWNoZVJlc3VsdChjYWNoZUtleSwgdG9rZW5Db3VudCk7XG5cbiAgICByZXR1cm4gdG9rZW5Db3VudDtcbiAgfVxuXG4gIHByaXZhdGUgY2FjaGVSZXN1bHQoa2V5OiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jYWNoZS5zaXplID49IHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMuY2FjaGUua2V5cygpLm5leHQoKS52YWx1ZTtcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGZpcnN0S2V5KTtcbiAgICB9XG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB2YWx1ZSk7XG4gIH1cblxuICBjbGVhckNhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgICB0aGlzLmZpbGVDYWNoZS5jbGVhcigpO1xuICB9XG5cbiAgdW5sb2FkKCk6IHZvaWQge1xuICAgIC8vIENsZWFuIHVwIGV2ZW50IGxpc3RlbmVycyB3aGVuIHBsdWdpbiBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLmFwcCkge1xuICAgICAgdGhpcy5hcHAudmF1bHQub2ZmKFwibW9kaWZ5XCIsIHRoaXMuaGFuZGxlRmlsZU1vZGlmeSk7XG4gICAgICB0aGlzLmFwcC52YXVsdC5vZmYoXCJkZWxldGVcIiwgdGhpcy5oYW5kbGVGaWxlRGVsZXRlKTtcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9mZihcInJlbmFtZVwiLCB0aGlzLmhhbmRsZUZpbGVSZW5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGZvcm1hdFRva2VuQ291bnQoY291bnQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGNvdW50ID09PSAwKSByZXR1cm4gXCJcIjtcbiAgICBpZiAoY291bnQgPCAxMDApIHJldHVybiBcIjwgMTAwIHRva2Vuc1wiO1xuICAgIGlmIChjb3VudCA+PSAxMDAwKSB7XG4gICAgICAvLyBSb3VuZCB1cCB0byBuZWFyZXN0IHRob3VzYW5kXG4gICAgICBjb25zdCBpbksgPSBNYXRoLmNlaWwoY291bnQgLyAxMDAwKTtcbiAgICAgIHJldHVybiBgfiR7aW5LfUsgdG9rZW5zYDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUm91bmQgdXAgdG8gbmVhcmVzdCBodW5kcmVkXG4gICAgICBjb25zdCBpbkh1bmRyZWRzID0gTWF0aC5jZWlsKGNvdW50IC8gMTAwKSAqIDEwMDtcbiAgICAgIHJldHVybiBgfiR7aW5IdW5kcmVkc30gdG9rZW5zYDtcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vdWlcIjtcbmltcG9ydCB7IFBBVFJFT05fVVJMIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBMaWNlbnNlQ2hlY2tlciB7XG4gIHByaXZhdGUgc3RhdGljIFBST19FWFRFTlNJT05TID0gW1xuICAgIFwicGRmXCIsXG4gICAgXCJkb2NcIixcbiAgICBcImRvY3hcIixcbiAgICBcInBwdFwiLFxuICAgIFwicHB0eFwiLFxuICAgIFwieGxzXCIsXG4gICAgXCJ4bHN4XCIsXG4gICAgXCJtcDNcIixcbiAgICBcIndhdlwiLFxuICAgIFwibTRhXCIsXG4gICAgXCJvZ2dcIixcbiAgICBcIndlYm1cIixcbiAgXTtcblxuICBwdWJsaWMgc3RhdGljIHJlcXVpcmVzUHJvTGljZW5zZShleHRlbnNpb246IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLlBST19FWFRFTlNJT05TLmluY2x1ZGVzKGV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgaGFzVmFsaWRMaWNlbnNlKHBsdWdpbjogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5Py50cmltKCkgJiYgcGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZDtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgc2hvd1Byb0ZlYXR1cmVQb3B1cChhcHA6IEFwcCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgIGFwcCxcbiAgICAgIFwiU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBkZXZlbG9wbWVudCBhbmQgdW5sb2NrIHBvd2VyZnVsIGRvY3VtZW50IHByb2Nlc3NpbmcgZmVhdHVyZXMuIFVwZ3JhZGUgdG8gUHJvIHRvIHByb2Nlc3MgUERGcywgV29yZCBkb2N1bWVudHMsIGFuZCBhdWRpbyBmaWxlcy5cIixcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6IFwiUHJvIEZlYXR1cmUgUmVxdWlyZWRcIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJCZWNvbWUgYSBQYXRyb25cIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgIGljb246IFwic3BhcmtsZXNcIixcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdD8uY29uZmlybWVkIHx8IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBhc3luYyBjaGVja0xpY2Vuc2VGb3JGaWxlKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIGFwcDogQXBwLFxuICAgIHBsdWdpbjogYW55XG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICh0aGlzLnJlcXVpcmVzUHJvTGljZW5zZShmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgaWYgKCF0aGlzLmhhc1ZhbGlkTGljZW5zZShwbHVnaW4pKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2hvd1Byb0ZlYXR1cmVQb3B1cChhcHApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgc2V0SWNvbiwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBTZWFyY2hTZXJ2aWNlLCBTZWFyY2hhYmxlRmllbGQsIFNlYXJjaE1hdGNoLCBTZWFyY2hSZXN1bHQgfSBmcm9tIFwiLi4vc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuaW1wb3J0IHsgQ2hhdFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL0NoYXRTdG9yYWdlU2VydmljZVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDSEFUX1ZJRVdfVFlQRSB9IGZyb20gXCIuLi92aWV3cy9DaGF0Vmlld1wiO1xuXG5pbnRlcmZhY2UgQ2hhdEhpc3RvcnlJdGVtIHtcbiAgaWQ6IHN0cmluZztcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICBsYXN0TW9kaWZpZWQ6IG51bWJlcjtcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICBjdXN0b21Qcm9tcHRGaWxlUGF0aD86IHN0cmluZztcbiAgc3lzdGVtUHJvbXB0VHlwZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEZsYXR0ZW5lZENoYXRJdGVtIHtcbiAgaWQ6IHN0cmluZztcbiAgc2VhcmNoVGV4dDogc3RyaW5nO1xuICBtb2RlbE5hbWU6IHN0cmluZztcbiAgcHJvbXB0TGFiZWw6IHN0cmluZztcbiAgbGFzdE1lc3NhZ2U6IHN0cmluZztcbiAgbWVzc2FnZUNvbnRlbnQ6IHN0cmluZztcbiAgaXRlbTogQ2hhdEhpc3RvcnlJdGVtO1xufVxuXG5leHBvcnQgY2xhc3MgTG9hZENoYXRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBjaGF0SXRlbXM6IENoYXRIaXN0b3J5SXRlbVtdID0gW107XG4gIHByaXZhdGUgZmxhdHRlbmVkSXRlbXM6IEZsYXR0ZW5lZENoYXRJdGVtW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENoYXRJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb25TZWxlY3Q6IChjaGF0SWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjaGF0R3JpZDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTtcbiAgcHJpdmF0ZSBzZWxlY3RlZENhcmRJbmRleDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBjaGF0Q2FyZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBjdXJyZW50U2VhcmNoUmVzdWx0czogU2VhcmNoUmVzdWx0PENoYXRIaXN0b3J5SXRlbT5bXSA9IFtdO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGlzS2V5Ym9hcmROYXZBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBjaGF0U3RvcmFnZTogQ2hhdFN0b3JhZ2VTZXJ2aWNlO1xuICBwcml2YXRlIHZpcnR1YWxTY3JvbGxlcjogSW50ZXJzZWN0aW9uT2JzZXJ2ZXI7XG4gIHByaXZhdGUgYmF0Y2hTaXplOiBudW1iZXIgPSAyMDtcbiAgcHJpdmF0ZSBjdXJyZW50QmF0Y2g6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgaXNMb2FkaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgY2FyZENhY2hlOiBNYXA8c3RyaW5nLCBIVE1MRWxlbWVudD4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgcHJvZ3Jlc3NNb2RhbDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHByb2dyZXNzVGV4dDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcHJvZ3Jlc3NDb250YWluZXI6IEhUTUxFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIG9uU2VsZWN0OiAoY2hhdElkOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgICB0aGlzLmNoYXRTdG9yYWdlID0gbmV3IENoYXRTdG9yYWdlU2VydmljZShcbiAgICAgIGFwcCxcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gICAgdGhpcy5zZXR1cFZpcnR1YWxTY3JvbGxlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cFZpcnR1YWxTY3JvbGxlcigpIHtcbiAgICB0aGlzLnZpcnR1YWxTY3JvbGxlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihcbiAgICAgIChlbnRyaWVzKSA9PiB7XG4gICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcgJiYgIXRoaXMuaXNMb2FkaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWROZXh0QmF0Y2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcm9vdDogbnVsbCxcbiAgICAgICAgcm9vdE1hcmdpbjogXCIxMDBweFwiLFxuICAgICAgICB0aHJlc2hvbGQ6IDAuMSxcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2FkTmV4dEJhdGNoKCkge1xuICAgIGlmICh0aGlzLmlzTG9hZGluZyB8fCB0aGlzLmN1cnJlbnRCYXRjaCAqIHRoaXMuYmF0Y2hTaXplID49IHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5jdXJyZW50QmF0Y2ggKiB0aGlzLmJhdGNoU2l6ZTtcbiAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihzdGFydCArIHRoaXMuYmF0Y2hTaXplLCB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzLmxlbmd0aCk7XG4gICAgY29uc3QgYmF0Y2ggPSB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzLnNsaWNlKHN0YXJ0LCBlbmQpO1xuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3Qgc2VjdGlvbnNDb250YWluZXIgPSBmcmFnbWVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlY3Rpb25zLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBiYXRjaC5tYXAoYXN5bmMgKHJlc3VsdCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRDYXJkKHJlc3VsdC5pdGVtLCByZXN1bHQubWF0Y2hlcyB8fCBbXSwgc2VjdGlvbnNDb250YWluZXIpO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5jaGF0R3JpZC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgdGhpcy5jdXJyZW50QmF0Y2grKztcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgLy8gQWRkIHNlbnRpbmVsIGVsZW1lbnQgZm9yIGluZmluaXRlIHNjcm9sbFxuICAgIGlmIChlbmQgPCB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgY29uc3Qgc2VudGluZWwgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1zZW50aW5lbFwiLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnZpcnR1YWxTY3JvbGxlci5vYnNlcnZlKHNlbnRpbmVsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGZsYXR0ZW5DaGF0SXRlbShpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pOiBQcm9taXNlPEZsYXR0ZW5lZENoYXRJdGVtPiB7XG4gICAgY29uc3QgbW9kZWxOYW1lID0gYXdhaXQgdGhpcy5nZXRNb2RlbE5hbWUoaXRlbS5zZWxlY3RlZE1vZGVsSWQpO1xuICAgIGNvbnN0IHByb21wdExhYmVsID0gYXdhaXQgdGhpcy5nZXRQcm9tcHRMYWJlbChpdGVtKTtcbiAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGl0ZW0ubWVzc2FnZXNbaXRlbS5tZXNzYWdlcy5sZW5ndGggLSAxXTtcbiAgICBjb25zdCBtZXNzYWdlQ29udGVudCA9IGl0ZW0ubWVzc2FnZXMubWFwKG1zZyA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG1zZykpLmpvaW4oXCJcXG5cIik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICBzZWFyY2hUZXh0OiBgJHttZXNzYWdlQ29udGVudH0gJHttb2RlbE5hbWV9ICR7cHJvbXB0TGFiZWx9YC50b0xvd2VyQ2FzZSgpLFxuICAgICAgbW9kZWxOYW1lLFxuICAgICAgcHJvbXB0TGFiZWwsXG4gICAgICBsYXN0TWVzc2FnZTogbGFzdE1lc3NhZ2UgPyB0aGlzLmdldE1lc3NhZ2VDb250ZW50KGxhc3RNZXNzYWdlKSA6IFwiXCIsXG4gICAgICBtZXNzYWdlQ29udGVudCxcbiAgICAgIGl0ZW1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcm9ncmVzc01vZGFsKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIHRoaXMucHJvZ3Jlc3NDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogJ3N5c3RlbXNjdWxwdC1wcm9ncmVzcy1vdmVybGF5J1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gdGhpcy5wcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiAnc3lzdGVtc2N1bHB0LXByb2dyZXNzLXN0YXR1cydcbiAgICB9KTtcblxuICAgIGNvbnN0IHN0YXR1c0ljb24gPSBzdGF0dXNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogJ3N5c3RlbXNjdWxwdC1wcm9ncmVzcy1zdGF0dXMtaWNvbidcbiAgICB9KTtcbiAgICBzZXRJY29uKHN0YXR1c0ljb24sICdsb2FkZXItMicpO1xuXG4gICAgdGhpcy5wcm9ncmVzc1RleHQgPSBzdGF0dXNDb250YWluZXIuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiAnTG9hZGluZyBjaGF0cy4uLidcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUHJvZ3Jlc3MoY3VycmVudDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSB7XG4gICAgaWYgKGN1cnJlbnQgPT09IHRvdGFsKSB7XG4gICAgICB0aGlzLnByb2dyZXNzQ29udGFpbmVyLnJlbW92ZSgpO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIGFzeW5jIG9uT3BlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY2hhdC1tb2RhbFwiKTtcblxuICAgIC8vIENyZWF0ZSBhbmQgc2hvdyBwcm9ncmVzcyBtb2RhbFxuICAgIHRoaXMuY3JlYXRlUHJvZ3Jlc3NNb2RhbCgpO1xuXG4gICAgLy8gTG9hZCBhbmQgcHJlcGFyZSBjaGF0c1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjaGF0cyA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXRzKCk7XG4gICAgICB0aGlzLmNoYXRJdGVtcyA9IGNoYXRzLnNvcnQoKGEsIGIpID0+IGIubGFzdE1vZGlmaWVkIC0gYS5sYXN0TW9kaWZpZWQpO1xuICAgICAgXG4gICAgICAvLyBQcmUtZmxhdHRlbiBhbGwgaXRlbXMgaW4gcGFyYWxsZWxcbiAgICAgIHRoaXMuZmxhdHRlbmVkSXRlbXMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgdGhpcy5jaGF0SXRlbXMubWFwKGFzeW5jIChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGZsYXRJdGVtID0gYXdhaXQgdGhpcy5mbGF0dGVuQ2hhdEl0ZW0oaXRlbSk7XG4gICAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcyhpbmRleCArIDEsIHRoaXMuY2hhdEl0ZW1zLmxlbmd0aCk7XG4gICAgICAgICAgcmV0dXJuIGZsYXRJdGVtO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmNoYXRJdGVtcyA9IFtdO1xuICAgICAgdGhpcy5mbGF0dGVuZWRJdGVtcyA9IFtdO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBVSVxuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlYXJjaFwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBjaGF0cy4uLlwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5jaGF0R3JpZCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtZ3JpZFwiIH0pO1xuXG4gICAgLy8gSW5pdGlhbCByZW5kZXJcbiAgICBhd2FpdCB0aGlzLnJlbmRlckNoYXRzKHRoaXMuZmxhdHRlbmVkSXRlbXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgIGl0ZW06IGl0ZW0uaXRlbSxcbiAgICAgIG1hdGNoZXM6IFtdLFxuICAgICAgc2NvcmU6IDBcbiAgICB9KSkpO1xuXG4gICAgLy8gQWRkIHRoZSBuZXcgY2hhdCBidXR0b25cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIGNvbnN0IG5ld0NoYXRCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIHRleHQ6IFwiT3BlbiBOZXcgQ2hhdCBJbnN0ZWFkXCIsXG4gICAgfSk7XG4gICAgbmV3Q2hhdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5vcGVuTmV3Q2hhdCgpKTtcblxuICAgIC8vIFNldHVwIGV2ZW50IGxpc3RlbmVyc1xuICAgIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpO1xuICAgIFxuICAgIC8vIFNob3cgbW9kYWwgYW5kIGZvY3VzIHNlYXJjaFxuICAgIHRoaXMuY29udGFpbmVyRWwuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBFdmVudExpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQudmFsdWU7XG4gICAgICBcbiAgICAgIGlmICghcXVlcnkpIHtcbiAgICAgICAgLy8gU2hvdyBhbGwgY2hhdHMgc29ydGVkIGJ5IGRhdGVcbiAgICAgICAgdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyA9IHRoaXMuZmxhdHRlbmVkSXRlbXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICBpdGVtOiBpdGVtLml0ZW0sXG4gICAgICAgICAgbWF0Y2hlczogW10sXG4gICAgICAgICAgc2NvcmU6IDAsXG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlbmRlckNoYXRzKHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChxdWVyeS5sZW5ndGggPCAzKSB7XG4gICAgICAgIHRoaXMuY2hhdEdyaWQuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5jaGF0Q2FyZHMgPSBbXTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBtZXNzYWdlRWwgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWVtcHR5XCIsXG4gICAgICAgIH0pO1xuICAgICAgICBtZXNzYWdlRWwuc2V0VGV4dChgUGxlYXNlIGVudGVyIGF0IGxlYXN0IDMgY2hhcmFjdGVycyB0byBzZWFyY2ggKCR7cXVlcnkubGVuZ3RofS8zKWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEZhc3Qgc2VhcmNoIHVzaW5nIGZsYXR0ZW5lZCBpdGVtc1xuICAgICAgY29uc3Qgc2VhcmNoVGVybXMgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9cXHMrLykuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuZmxhdHRlbmVkSXRlbXNcbiAgICAgICAgLm1hcChmbGF0SXRlbSA9PiB7XG4gICAgICAgICAgLy8gUXVpY2sgY2hlY2sgaWYgYWxsIHRlcm1zIGV4aXN0XG4gICAgICAgICAgY29uc3QgYWxsVGVybXNFeGlzdCA9IHNlYXJjaFRlcm1zLmV2ZXJ5KHRlcm0gPT4gXG4gICAgICAgICAgICBmbGF0SXRlbS5zZWFyY2hUZXh0LmluY2x1ZGVzKHRlcm0pXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmICghYWxsVGVybXNFeGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaXRlbTogZmxhdEl0ZW0uaXRlbSwgbWF0Y2hlczogW10sIHNjb3JlOiAwIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIHNjb3JlIGFuZCBmaW5kIG1hdGNoZXNcbiAgICAgICAgICBsZXQgc2NvcmUgPSAwO1xuICAgICAgICAgIGNvbnN0IG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXTtcblxuICAgICAgICAgIHNlYXJjaFRlcm1zLmZvckVhY2godGVybSA9PiB7XG4gICAgICAgICAgICBsZXQgcG9zID0gMDtcbiAgICAgICAgICAgIHdoaWxlICgocG9zID0gZmxhdEl0ZW0uc2VhcmNoVGV4dC5pbmRleE9mKHRlcm0sIHBvcykpICE9PSAtMSkge1xuICAgICAgICAgICAgICBzY29yZSArPSAxO1xuICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZpZWxkOiBcImNvbnRlbnRcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBmbGF0SXRlbS5zZWFyY2hUZXh0LnNsaWNlKE1hdGgubWF4KDAsIHBvcyAtIDIwKSwgcG9zICsgdGVybS5sZW5ndGggKyAyMCksXG4gICAgICAgICAgICAgICAgaW5kaWNlczogW3Bvc10sXG4gICAgICAgICAgICAgICAgbWF0Y2hRdWFsaXR5OiAxXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBwb3MgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIEJvb3N0IHNjb3JlIGZvciBleGFjdCBtYXRjaGVzXG4gICAgICAgICAgaWYgKGZsYXRJdGVtLnNlYXJjaFRleHQuaW5jbHVkZXMocXVlcnkudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgIHNjb3JlICo9IDI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGl0ZW06IGZsYXRJdGVtLml0ZW0sXG4gICAgICAgICAgICBtYXRjaGVzLFxuICAgICAgICAgICAgc2NvcmVcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgICAuZmlsdGVyKHJlc3VsdCA9PiByZXN1bHQuc2NvcmUgPiAwKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBiLml0ZW0ubGFzdE1vZGlmaWVkIC0gYS5pdGVtLmxhc3RNb2RpZmllZDtcbiAgICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7XG4gICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgPSBmYWxzZTtcbiAgICAgIHRoaXMucmVuZGVyQ2hhdHMocmVzdWx0cyk7XG4gICAgfSk7XG5cbiAgICAvLyBLZXlib2FyZCBuYXZpZ2F0aW9uXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMuY2hhdENhcmRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIGlmICghdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlKSB7XG4gICAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9ICh0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IC0gMSArIHRoaXMuY2hhdENhcmRzLmxlbmd0aCkgJSB0aGlzLmNoYXRDYXJkcy5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAodGhpcy5zZWxlY3RlZENhcmRJbmRleCArIDEpICUgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQ2FyZCgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFbnRlclwiICYmIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSAmJiB0aGlzLmNoYXRDYXJkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRDYXJkID0gdGhpcy5jaGF0Q2FyZHNbdGhpcy5zZWxlY3RlZENhcmRJbmRleF07XG4gICAgICAgIGlmIChzZWxlY3RlZENhcmQ/LmRhdGFzZXQuY2hhdElkKSB7XG4gICAgICAgICAgdGhpcy5vblNlbGVjdChzZWxlY3RlZENhcmQuZGF0YXNldC5jaGF0SWQpO1xuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBpZiAodGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlKSB7XG4gICAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQ2FyZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJDaGF0cyhzZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8Q2hhdEhpc3RvcnlJdGVtPltdKSB7XG4gICAgaWYgKCF0aGlzLmNoYXRHcmlkKSByZXR1cm47XG5cbiAgICB0aGlzLmNoYXRHcmlkLmVtcHR5KCk7XG4gICAgdGhpcy5jaGF0Q2FyZHMgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRCYXRjaCA9IDA7IC8vIFJlc2V0IGJhdGNoIGNvdW50ZXIgZm9yIGluZmluaXRlIHNjcm9sbFxuICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwOyAvLyBSZXNldCBzZWxlY3RlZCBjYXJkIGluZGV4XG5cbiAgICAvLyBDcmVhdGUgYSBsb29rdXAgZm9yIHNlYXJjaE1hdGNoZXNcbiAgICBjb25zdCBzck1hcCA9IG5ldyBNYXAoXG4gICAgICBzZWFyY2hSZXN1bHRzLm1hcCgoc3IpID0+IFtzci5pdGVtLmlkLCBzci5tYXRjaGVzIHx8IFtdXSlcbiAgICApO1xuXG4gICAgLy8gU2VwYXJhdGUgZmF2b3JpdGVzIGZyb20gb3RoZXIgY2hhdHNcbiAgICBjb25zdCBmYXZvcml0ZXM6IENoYXRIaXN0b3J5SXRlbVtdID0gW107XG4gICAgY29uc3Qgbm9uRmF2b3JpdGVzOiBDaGF0SGlzdG9yeUl0ZW1bXSA9IFtdO1xuXG4gICAgLy8gT25seSBwcm9jZXNzIGNoYXRzIHRoYXQgYXJlIGluIG91ciBzZWFyY2ggcmVzdWx0c1xuICAgIHNlYXJjaFJlc3VsdHMuZm9yRWFjaCgoc3IpID0+IHtcbiAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKHNyLml0ZW0uaWQpKSB7XG4gICAgICAgIGZhdm9yaXRlcy5wdXNoKHNyLml0ZW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9uRmF2b3JpdGVzLnB1c2goc3IuaXRlbSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZW5kZXIgZmF2b3JpdGVzIHNlY3Rpb24gaWYgdGhlcmUgYXJlIGFueSBmYXZvcml0ZXNcbiAgICBpZiAoZmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEFkZCBmYXZvcml0ZXMgaGVhZGVyXG4gICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIsXG4gICAgICB9KTtcbiAgICAgIGhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogXCJGYXZvcml0ZXNcIiB9KTtcblxuICAgICAgLy8gU29ydCBmYXZvcml0ZXMgYnkgbGFzdCBtb2RpZmllZCBkYXRlXG4gICAgICBmYXZvcml0ZXMuc29ydCgoYSwgYikgPT4gYi5sYXN0TW9kaWZpZWQgLSBhLmxhc3RNb2RpZmllZCk7XG5cbiAgICAgIC8vIFJlbmRlciBmYXZvcml0ZSBjaGF0c1xuICAgICAgZmF2b3JpdGVzLmZvckVhY2goKGNoYXQpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChjaGF0LmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyQ2hhdENhcmQoY2hhdCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5jaGF0R3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlY2VudCBjaGF0cyBoZWFkZXJcbiAgICBpZiAobm9uRmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHJlY2VudEhlYWRlciA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIixcbiAgICAgIH0pO1xuICAgICAgcmVjZW50SGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlJlY2VudCBDaGF0c1wiIH0pO1xuXG4gICAgICAvLyBTb3J0IG5vbi1mYXZvcml0ZXMgYnkgbGFzdCBtb2RpZmllZCBkYXRlXG4gICAgICBub25GYXZvcml0ZXMuc29ydCgoYSwgYikgPT4gYi5sYXN0TW9kaWZpZWQgLSBhLmxhc3RNb2RpZmllZCk7XG5cbiAgICAgIC8vIFJlbmRlciBub24tZmF2b3JpdGUgY2hhdHNcbiAgICAgIG5vbkZhdm9yaXRlcy5mb3JFYWNoKChjaGF0KSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBzck1hcC5nZXQoY2hhdC5pZCkgfHwgW107XG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLnJlbmRlckNoYXRDYXJkKGNoYXQsIG1hdGNoZXMpO1xuICAgICAgICBpZiAoY2FyZCkge1xuICAgICAgICAgIHRoaXMuY2hhdEdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIElmIG5vIGNhcmRzIGF0IGFsbCwgc2hvdyBhcHByb3ByaWF0ZSBtZXNzYWdlXG4gICAgaWYgKGZhdm9yaXRlcy5sZW5ndGggPT09IDAgJiYgbm9uRmF2b3JpdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWVtcHR5XCIsXG4gICAgICAgIH0pO1xuICAgICAgICBlbXB0eVN0YXRlLnNldFRleHQoXCJObyBjaGF0cyBmb3VuZCBtYXRjaGluZyB5b3VyIHNlYXJjaC5cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbXB0eVN0YXRlID0gdGhpcy5jaGF0R3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1lbXB0eVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgZW1wdHlTdGF0ZS5zZXRUZXh0KFwiTm8gY2hhdCBoaXN0b3J5IGZvdW5kLlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXNldCBpbmZpbml0ZSBzY3JvbGwgaWYgbmVlZGVkXG4gICAgaWYgKHRoaXMudmlydHVhbFNjcm9sbGVyKSB7XG4gICAgICBjb25zdCBzZW50aW5lbCA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlbnRpbmVsXCIsXG4gICAgICB9KTtcbiAgICAgIHRoaXMudmlydHVhbFNjcm9sbGVyLm9ic2VydmUoc2VudGluZWwpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBrZXlib2FyZCBuYXZpZ2F0aW9uIGlmIGFjdGl2ZVxuICAgIGlmICh0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgJiYgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZENhcmQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaENhcmRFdmVudExpc3RlbmVycyhjYXJkOiBIVE1MRWxlbWVudCwgaXRlbTogQ2hhdEhpc3RvcnlJdGVtKTogdm9pZCB7XG4gICAgLy8gQWRkIGNsaWNrIGhhbmRsZXIgZm9yIGNhcmQgc2VsZWN0aW9uXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vblNlbGVjdChpdGVtLmlkKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBmYXZvcml0ZSBidXR0b24gaGFuZGxlclxuICAgIGNvbnN0IGZhdm9yaXRlQnV0dG9uID0gY2FyZC5xdWVyeVNlbGVjdG9yKCcuc3lzdGVtc2N1bHB0LWZhdm9yaXRlLWJ1dHRvbicpO1xuICAgIGlmIChmYXZvcml0ZUJ1dHRvbikge1xuICAgICAgZmF2b3JpdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBjb25zdCBjaGF0Q2FyZCA9IHRhcmdldC5jbG9zZXN0KCcuc3lzdGVtc2N1bHB0LWNoYXQtY2FyZCcpO1xuICAgICAgICBpZiAoIWNoYXRDYXJkKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgaXNGYXZvcml0ZSA9ICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKGl0ZW0uaWQpO1xuXG4gICAgICAgIGZhdm9yaXRlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpcy1mYXZvcml0ZVwiLCBpc0Zhdm9yaXRlKTtcbiAgICAgICAgZmF2b3JpdGVCdXR0b24uc2V0QXR0cmlidXRlKFxuICAgICAgICAgIFwiYXJpYS1sYWJlbFwiLFxuICAgICAgICAgIGlzRmF2b3JpdGUgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiIDogXCJBZGQgdG8gZmF2b3JpdGVzXCJcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBFbnN1cmUgYXJyYXkgZXhpc3RzXG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzKSkge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlQ2hhdHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBvciByZW1vdmUgZnJvbSBzZXR0aW5nc1xuICAgICAgICBpZiAoaXNGYXZvcml0ZSkge1xuICAgICAgICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcyhpdGVtLmlkKSkge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5wdXNoKGl0ZW0uaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5maWx0ZXIoXG4gICAgICAgICAgICAoaWQpID0+IGlkICE9PSBpdGVtLmlkXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblxuICAgICAgICAvLyBNb3ZlIHRoZSBjYXJkIHRvIHRoZSBhcHByb3ByaWF0ZSBzZWN0aW9uXG4gICAgICAgIGlmIChpc0Zhdm9yaXRlKSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgZmF2b3JpdGVzIHNlY3Rpb24gZXhpc3RzLCBjcmVhdGUgaWYgbm90XG4gICAgICAgICAgbGV0IGZhdm9yaXRlc0hlYWRlciA9IHRoaXMuY2hhdEdyaWQucXVlcnlTZWxlY3RvcignLnN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXInKTtcbiAgICAgICAgICBpZiAoIWZhdm9yaXRlc0hlYWRlciB8fCAhZmF2b3JpdGVzSGVhZGVyLnRleHRDb250ZW50Py5pbmNsdWRlcygnRmF2b3JpdGVzJykpIHtcbiAgICAgICAgICAgIGZhdm9yaXRlc0hlYWRlciA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIiB9KTtcbiAgICAgICAgICAgIGZhdm9yaXRlc0hlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogXCJGYXZvcml0ZXNcIiB9KTtcbiAgICAgICAgICAgIHRoaXMuY2hhdEdyaWQuaW5zZXJ0QmVmb3JlKGZhdm9yaXRlc0hlYWRlciwgdGhpcy5jaGF0R3JpZC5maXJzdENoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRmluZCB3aGVyZSB0byBpbnNlcnQgdGhlIGNhcmQgKGFmdGVyIGhlYWRlciwgYmVmb3JlIGZpcnN0IG5vbi1mYXZvcml0ZSlcbiAgICAgICAgICBjb25zdCBuZXh0RWxlbWVudCA9IEFycmF5LmZyb20odGhpcy5jaGF0R3JpZC5jaGlsZHJlbikuZmluZCgoZWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPD0gMSkgcmV0dXJuIGZhbHNlOyAvLyBTa2lwIGhlYWRlclxuICAgICAgICAgICAgcmV0dXJuICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAoZWwgYXMgSFRNTEVsZW1lbnQpLmRhdGFzZXQuY2hhdElkIHx8ICcnXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChuZXh0RWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5jaGF0R3JpZC5pbnNlcnRCZWZvcmUoY2hhdENhcmQsIG5leHRFbGVtZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgbm8gbm9uLWZhdm9yaXRlcywgaW5zZXJ0IGJlZm9yZSB0aGUgXCJSZWNlbnQgQ2hhdHNcIiBoZWFkZXIgb3IgYXQgdGhlIGVuZFxuICAgICAgICAgICAgY29uc3QgcmVjZW50SGVhZGVyID0gQXJyYXkuZnJvbSh0aGlzLmNoYXRHcmlkLmNoaWxkcmVuKS5maW5kKFxuICAgICAgICAgICAgICBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3N5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXInKSAmJiBcbiAgICAgICAgICAgICAgICAgICAoZWwgYXMgSFRNTEVsZW1lbnQpLnRleHRDb250ZW50Py5pbmNsdWRlcygnUmVjZW50IENoYXRzJylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmNoYXRHcmlkLmluc2VydEJlZm9yZShjaGF0Q2FyZCwgcmVjZW50SGVhZGVyIHx8IG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBNb3ZlIHRvIHJlY2VudCBjaGF0cyBzZWN0aW9uXG4gICAgICAgICAgbGV0IHJlY2VudEhlYWRlciA9IEFycmF5LmZyb20odGhpcy5jaGF0R3JpZC5jaGlsZHJlbikuZmluZChcbiAgICAgICAgICAgIGVsID0+IGVsLmNsYXNzTGlzdC5jb250YWlucygnc3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlcicpICYmIFxuICAgICAgICAgICAgICAgICAoZWwgYXMgSFRNTEVsZW1lbnQpLnRleHRDb250ZW50Py5pbmNsdWRlcygnUmVjZW50IENoYXRzJylcbiAgICAgICAgICApO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENyZWF0ZSByZWNlbnQgaGVhZGVyIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgICBpZiAoIXJlY2VudEhlYWRlcikge1xuICAgICAgICAgICAgcmVjZW50SGVhZGVyID0gdGhpcy5jaGF0R3JpZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiIH0pO1xuICAgICAgICAgICAgcmVjZW50SGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlJlY2VudCBDaGF0c1wiIH0pO1xuICAgICAgICAgICAgdGhpcy5jaGF0R3JpZC5hcHBlbmRDaGlsZChyZWNlbnRIZWFkZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJbnNlcnQgYWZ0ZXIgcmVjZW50IGhlYWRlclxuICAgICAgICAgIGlmIChyZWNlbnRIZWFkZXIubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhdEdyaWQuaW5zZXJ0QmVmb3JlKGNoYXRDYXJkLCByZWNlbnRIZWFkZXIubmV4dFNpYmxpbmcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNoYXRHcmlkLmFwcGVuZENoaWxkKGNoYXRDYXJkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDbGVhbiB1cCBlbXB0eSBzZWN0aW9uc1xuICAgICAgICBjb25zdCBmYXZvcml0ZXNIZWFkZXIgPSB0aGlzLmNoYXRHcmlkLnF1ZXJ5U2VsZWN0b3IoJy5zeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyJyk7XG4gICAgICAgIGNvbnN0IHJlY2VudEhlYWRlciA9IEFycmF5LmZyb20odGhpcy5jaGF0R3JpZC5jaGlsZHJlbikuZmluZChcbiAgICAgICAgICBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3N5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXInKSAmJiBcbiAgICAgICAgICAgICAgIChlbCBhcyBIVE1MRWxlbWVudCkudGV4dENvbnRlbnQ/LmluY2x1ZGVzKCdSZWNlbnQgQ2hhdHMnKVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFJlbW92ZSBmYXZvcml0ZXMgaGVhZGVyIGlmIG5vIGZhdm9yaXRlc1xuICAgICAgICBpZiAoZmF2b3JpdGVzSGVhZGVyICYmICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmxlbmd0aCkge1xuICAgICAgICAgIGZhdm9yaXRlc0hlYWRlci5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSByZWNlbnQgaGVhZGVyIGlmIG5vIHJlY2VudCBjaGF0c1xuICAgICAgICBpZiAocmVjZW50SGVhZGVyKSB7XG4gICAgICAgICAgY29uc3QgaGFzUmVjZW50Q2hhdHMgPSBBcnJheS5mcm9tKHRoaXMuY2hhdEdyaWQuY2hpbGRyZW4pLnNvbWUoZWwgPT4gXG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3N5c3RlbXNjdWxwdC1jaGF0LWNhcmQnKSAmJiBcbiAgICAgICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKChlbCBhcyBIVE1MRWxlbWVudCkuZGF0YXNldC5jaGF0SWQgfHwgJycpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWhhc1JlY2VudENoYXRzKSB7XG4gICAgICAgICAgICByZWNlbnRIZWFkZXIucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckNoYXRDYXJkKFxuICAgIGl0ZW06IENoYXRIaXN0b3J5SXRlbSxcbiAgICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW10sXG4gICAgc2VjdGlvbnNDb250YWluZXI/OiBIVE1MRWxlbWVudFxuICApOiBIVE1MRWxlbWVudCB7XG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWRDYXJkID0gdGhpcy5jYXJkQ2FjaGUuZ2V0KGl0ZW0uaWQpO1xuICAgIGlmIChjYWNoZWRDYXJkKSB7XG4gICAgICBjb25zdCBjYXJkID0gY2FjaGVkQ2FyZC5jbG9uZU5vZGUodHJ1ZSkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ2FyZEhpZ2hsaWdodHMoY2FyZCwgbWF0Y2hlcyk7XG4gICAgICB9XG4gICAgICB0aGlzLmF0dGFjaENhcmRFdmVudExpc3RlbmVycyhjYXJkLCBpdGVtKTtcbiAgICAgIGNhcmQuZGF0YXNldC5jaGF0SWQgPSBpdGVtLmlkO1xuICAgICAgdGhpcy5jaGF0Q2FyZHMucHVzaChjYXJkKTtcbiAgICAgIHJldHVybiBjYXJkO1xuICAgIH1cblxuICAgIGNvbnN0IGZsYXRJdGVtID0gdGhpcy5mbGF0dGVuZWRJdGVtcy5maW5kKGYgPT4gZi5pZCA9PT0gaXRlbS5pZCk7XG4gICAgaWYgKCFmbGF0SXRlbSkgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyAvLyBSZXR1cm4gZW1wdHkgZGl2IGlmIGl0ZW0gbm90IGZvdW5kXG5cbiAgICBjb25zdCBpc1NlbGVjdGVkID0gdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlICYmIHRoaXMuY2hhdENhcmRzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleDtcblxuICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYXJkLmNsYXNzTmFtZSA9IGBzeXN0ZW1zY3VscHQtY2hhdC1jYXJkICR7aXRlbS5pZCA9PT0gdGhpcy5zZWxlY3RlZENoYXRJZCA/IFwic2VsZWN0ZWRcIiA6IFwiXCJ9ICR7aXNTZWxlY3RlZCA/IFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIgOiBcIlwifWA7XG5cbiAgICBjYXJkLmRhdGFzZXQuY2hhdElkID0gaXRlbS5pZDtcbiAgICB0aGlzLmNoYXRDYXJkcy5wdXNoKGNhcmQpO1xuXG4gICAgLy8gQWRkIGZhdm9yaXRlIGJ1dHRvblxuICAgIGNvbnN0IGZhdm9yaXRlQnV0dG9uID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LWZhdm9yaXRlLWJ1dHRvbiAke1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKGl0ZW0uaWQpID8gXCJpcy1mYXZvcml0ZVwiIDogXCJcIlxuICAgICAgfWAsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIFwiYXJpYS1sYWJlbFwiOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzLmluY2x1ZGVzKGl0ZW0uaWQpXG4gICAgICAgICAgPyBcIlJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiXG4gICAgICAgICAgOiBcIkFkZCB0byBmYXZvcml0ZXNcIixcbiAgICAgICAgcm9sZTogXCJidXR0b25cIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihmYXZvcml0ZUJ1dHRvbiwgXCJzdGFyXCIpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtY2FyZC1oZWFkZXJcIiB9KTtcbiAgICBjb25zdCBsZWZ0Q29udGFpbmVyID0gaGVhZGVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1oZWFkZXItbGVmdFwiIH0pO1xuXG4gICAgLy8gQWRkIG1vZGVsIGJhZGdlXG4gICAgY29uc3QgbW9kZWxCYWRnZSA9IGxlZnRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIgfSk7XG4gICAgc2V0SWNvbihtb2RlbEJhZGdlLCBcImJvdFwiKTtcbiAgICBtb2RlbEJhZGdlLmFwcGVuZFRleHQoZmxhdEl0ZW0ubW9kZWxOYW1lKTtcblxuICAgIC8vIEFkZCBwcm9tcHQgYmFkZ2VcbiAgICBjb25zdCBwcm9tcHRCYWRnZSA9IGxlZnRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIgfSk7XG4gICAgc2V0SWNvbihwcm9tcHRCYWRnZSwgXCJjb21tYW5kXCIpO1xuICAgIHByb21wdEJhZGdlLmFwcGVuZFRleHQoZmxhdEl0ZW0ucHJvbXB0TGFiZWwpO1xuXG4gICAgLy8gQWRkIGRvY3VtZW50IGNvbnRleHQgYmFkZ2UgaWYgcHJlc2VudFxuICAgIGlmIChpdGVtLmNvbnRleHRfZmlsZXMgJiYgaXRlbS5jb250ZXh0X2ZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGRvY0JhZGdlID0gbGVmdENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtYmFkZ2VcIiB9KTtcbiAgICAgIHNldEljb24oZG9jQmFkZ2UsIFwiZmlsZS10ZXh0XCIpO1xuICAgICAgZG9jQmFkZ2UuYXBwZW5kVGV4dChgJHtpdGVtLmNvbnRleHRfZmlsZXMubGVuZ3RofSBEb2N1bWVudCR7aXRlbS5jb250ZXh0X2ZpbGVzLmxlbmd0aCA+IDEgPyBcInNcIiA6IFwiXCJ9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJldmlldyA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXByZXZpZXdcIiB9KTtcbiAgICBcbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlO1xuICAgICAgY29uc3Qgc2VhcmNoVGVybXMgPSBzZWFyY2hRdWVyeT8udG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKSB8fCBbXTtcbiAgICAgIGNvbnN0IGNvbnRleHRUZXh0ID0gdGhpcy5nZXRNYXRjaENvbnRleHQoZmxhdEl0ZW0ubWVzc2FnZUNvbnRlbnQsIG1hdGNoZXMsIHNlYXJjaFRlcm1zKTtcbiAgICAgIHByZXZpZXcuYXBwZW5kQ2hpbGQodGhpcy5zZWFyY2hTZXJ2aWNlLmhpZ2hsaWdodFRleHQoY29udGV4dFRleHQsIG1hdGNoZXMsIHNlYXJjaFF1ZXJ5KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByZXZpZXcuYXBwZW5kVGV4dChmbGF0SXRlbS5sYXN0TWVzc2FnZSk7XG4gICAgfVxuXG4gICAgY29uc3QgbWV0YSA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LW1ldGFcIiB9KTtcblxuICAgIGNvbnN0IGRhdGVFbCA9IG1ldGEuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWluZm9cIiB9KTtcbiAgICBzZXRJY29uKGRhdGVFbCwgXCJjYWxlbmRhclwiKTtcbiAgICBkYXRlRWwuY3JlYXRlU3Bhbih7IHRleHQ6IHRoaXMuZm9ybWF0RGF0ZShpdGVtLmxhc3RNb2RpZmllZCkgfSk7XG5cbiAgICBjb25zdCBtZXNzYWdlc0VsID0gbWV0YS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaW5mb1wiIH0pO1xuICAgIHNldEljb24obWVzc2FnZXNFbCwgXCJtZXNzYWdlLXNxdWFyZVwiKTtcbiAgICBtZXNzYWdlc0VsLmNyZWF0ZVNwYW4oeyB0ZXh0OiBgJHtpdGVtLm1lc3NhZ2VzLmxlbmd0aH0gbWVzc2FnZSR7aXRlbS5tZXNzYWdlcy5sZW5ndGggIT09IDEgPyBcInNcIiA6IFwiXCJ9YCB9KTtcblxuICAgIGNvbnN0IHRpdGxlRWwgPSBtZXRhLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIgfSk7XG4gICAgc2V0SWNvbih0aXRsZUVsLCBcImZpbGVcIik7XG4gICAgdGl0bGVFbC5jcmVhdGVTcGFuKHsgdGV4dDogaXRlbS50aXRsZSB9KTtcblxuICAgIC8vIEF0dGFjaCBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLmF0dGFjaENhcmRFdmVudExpc3RlbmVycyhjYXJkLCBpdGVtKTtcblxuICAgIC8vIENhY2hlIHRoZSBjYXJkXG4gICAgdGhpcy5jYXJkQ2FjaGUuc2V0KGl0ZW0uaWQsIGNhcmQuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50KTtcblxuICAgIHJldHVybiBjYXJkO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDYXJkSGlnaGxpZ2h0cyhjYXJkOiBIVE1MRWxlbWVudCwgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSkge1xuICAgIGNvbnN0IHByZXZpZXcgPSBjYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LWNoYXQtcHJldmlld1wiKTtcbiAgICBpZiAoIXByZXZpZXcpIHJldHVybjtcblxuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dD8udmFsdWU7XG4gICAgY29uc3Qgc2VhcmNoVGVybXMgPSBzZWFyY2hRdWVyeT8udG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKSB8fCBbXTtcbiAgICBjb25zdCBmbGF0SXRlbSA9IHRoaXMuZmxhdHRlbmVkSXRlbXMuZmluZChmID0+IGYuaWQgPT09IGNhcmQuZGF0YXNldC5jaGF0SWQpO1xuICAgIGlmICghZmxhdEl0ZW0pIHJldHVybjtcblxuICAgIGNvbnN0IGNvbnRleHRUZXh0ID0gdGhpcy5nZXRNYXRjaENvbnRleHQoZmxhdEl0ZW0ubWVzc2FnZUNvbnRlbnQsIG1hdGNoZXMsIHNlYXJjaFRlcm1zKTtcbiAgICBwcmV2aWV3LmlubmVySFRNTCA9IFwiXCI7XG4gICAgcHJldmlldy5hcHBlbmRDaGlsZCh0aGlzLnNlYXJjaFNlcnZpY2UuaGlnaGxpZ2h0VGV4dChjb250ZXh0VGV4dCwgbWF0Y2hlcywgc2VhcmNoUXVlcnkpKTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RGF0ZSh0aW1lc3RhbXA6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHRpbWVzdGFtcCkudG9Mb2NhbGVTdHJpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWVzc2FnZUNvbnRlbnQobWVzc2FnZTogQ2hhdE1lc3NhZ2UpOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgbWVzc2FnZS5jb250ZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gbWVzc2FnZS5jb250ZW50O1xuICAgIH1cbiAgICByZXR1cm4gXCJJbWFnZSBtZXNzYWdlXCI7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldE1vZGVsTmFtZShtb2RlbElkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICBpZiAoIW1vZGVscykgcmV0dXJuIG1vZGVsSWQ7XG5cbiAgICAgIGNvbnN0IG1vZGVsID0gbW9kZWxzLmZpbmQoXG4gICAgICAgIChtOiB7IGlkOiBzdHJpbmc7IGlkZW50aWZpZXI/OiB7IHByb3ZpZGVySWQ6IHN0cmluZzsgbW9kZWxJZDogc3RyaW5nOyBkaXNwbGF5TmFtZT86IHN0cmluZzsgfTsgfSkgPT5cbiAgICAgICAgICBtLmlkID09PSBtb2RlbElkIHx8XG4gICAgICAgICAgKG0uaWRlbnRpZmllciAmJiBgJHttLmlkZW50aWZpZXIucHJvdmlkZXJJZH0vJHttLmlkZW50aWZpZXIubW9kZWxJZH1gID09PSBtb2RlbElkKVxuICAgICAgKTtcblxuICAgICAgaWYgKG1vZGVsPy5pZGVudGlmaWVyKSB7XG4gICAgICAgIHJldHVybiBtb2RlbC5pZGVudGlmaWVyLmRpc3BsYXlOYW1lIHx8IG1vZGVsLmlkZW50aWZpZXIubW9kZWxJZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1vZGVsPy5uYW1lIHx8IG1vZGVsSWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IG1vZGVsIG5hbWU6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBtb2RlbElkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0UHJvbXB0TGFiZWwoaXRlbTogQ2hhdEhpc3RvcnlJdGVtKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoaXRlbS5jdXN0b21Qcm9tcHRGaWxlUGF0aCkge1xuICAgICAgcmV0dXJuIGl0ZW0uY3VzdG9tUHJvbXB0RmlsZVBhdGguc3BsaXQoXCIvXCIpLnBvcCgpPy5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKSB8fCBcIkN1c3RvbSBQcm9tcHRcIjtcbiAgICB9XG4gICAgaWYgKGl0ZW0uc3lzdGVtUHJvbXB0VHlwZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0U2VydmljZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKHRoaXMuYXBwKTtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gYXdhaXQgc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKGl0ZW0uc3lzdGVtUHJvbXB0VHlwZSk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICByZXR1cm4gcHJlc2V0LmxhYmVsO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQ6XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFwiRGVmYXVsdFwiO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZENhcmQoKSB7XG4gICAgdGhpcy5jaGF0Q2FyZHMuZm9yRWFjaCgoY2FyZCwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleCAmJiB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgICBjYXJkLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcIm5lYXJlc3RcIiB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZShcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbk5ld0NoYXQoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKTtcbiAgICBsZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIHN0YXRlOiB7fSxcbiAgICB9KTtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmKTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgaWYgKHRoaXMudmlydHVhbFNjcm9sbGVyKSB7XG4gICAgICB0aGlzLnZpcnR1YWxTY3JvbGxlci5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNYXRjaENvbnRleHQodGV4dDogc3RyaW5nLCBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdLCBzZWFyY2hUZXJtczogc3RyaW5nW10pOiBzdHJpbmcge1xuICAgIGlmICghbWF0Y2hlcy5sZW5ndGgpIHJldHVybiB0ZXh0O1xuXG4gICAgLy8gRmluZCBhbGwgdGVybSBwb3NpdGlvbnNcbiAgICBjb25zdCBwb3NpdGlvbnM6IG51bWJlcltdID0gW107XG4gICAgc2VhcmNoVGVybXMuZm9yRWFjaCh0ZXJtID0+IHtcbiAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgY29uc3QgdGV4dExvd2VyID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgICAgd2hpbGUgKChwb3MgPSB0ZXh0TG93ZXIuaW5kZXhPZih0ZXJtLCBwb3MpKSAhPT0gLTEpIHtcbiAgICAgICAgcG9zaXRpb25zLnB1c2gocG9zKTtcbiAgICAgICAgcG9zICs9IDE7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIXBvc2l0aW9ucy5sZW5ndGgpIHJldHVybiB0ZXh0O1xuXG4gICAgLy8gU29ydCBwb3NpdGlvbnMgYW5kIGZpbmQgdGhlIGJlc3QgY2x1c3RlclxuICAgIHBvc2l0aW9ucy5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgXG4gICAgY29uc3QgQ09OVEVYVF9TSVpFID0gNzU7XG4gICAgbGV0IGJlc3RTdGFydCA9IHBvc2l0aW9uc1swXTtcbiAgICBsZXQgYmVzdEVuZCA9IHBvc2l0aW9uc1swXTtcbiAgICBsZXQgYmVzdFNwYW4gPSBJbmZpbml0eTtcblxuICAgIC8vIEZpbmQgc21hbGxlc3Qgd2luZG93IGNvbnRhaW5pbmcgbW9zdCBtYXRjaGVzXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcG9zaXRpb25zW2ldO1xuICAgICAgbGV0IGVuZCA9IHN0YXJ0O1xuICAgICAgbGV0IG1hdGNoQ291bnQgPSAxO1xuXG4gICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCBwb3NpdGlvbnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKHBvc2l0aW9uc1tqXSAtIHN0YXJ0ID4gQ09OVEVYVF9TSVpFICogMikgYnJlYWs7XG4gICAgICAgIGVuZCA9IHBvc2l0aW9uc1tqXTtcbiAgICAgICAgbWF0Y2hDb3VudCsrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzcGFuID0gZW5kIC0gc3RhcnQ7XG4gICAgICBpZiAobWF0Y2hDb3VudCA+IDEgJiYgc3BhbiA8IGJlc3RTcGFuKSB7XG4gICAgICAgIGJlc3RTdGFydCA9IHN0YXJ0O1xuICAgICAgICBiZXN0RW5kID0gZW5kO1xuICAgICAgICBiZXN0U3BhbiA9IHNwYW47XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHByZXZpZXcgd2luZG93XG4gICAgY29uc3QgY29udGV4dFN0YXJ0ID0gTWF0aC5tYXgoMCwgYmVzdFN0YXJ0IC0gQ09OVEVYVF9TSVpFKTtcbiAgICBjb25zdCBjb250ZXh0RW5kID0gTWF0aC5taW4odGV4dC5sZW5ndGgsIGJlc3RFbmQgKyBDT05URVhUX1NJWkUpO1xuXG4gICAgLy8gRmluZCBjbGVhbiB3b3JkIGJvdW5kYXJpZXNcbiAgICBsZXQgcHJldmlld1N0YXJ0ID0gY29udGV4dFN0YXJ0O1xuICAgIHdoaWxlIChwcmV2aWV3U3RhcnQgPiAwICYmICEvW1xccy4hP1xcbl0vLnRlc3QodGV4dFtwcmV2aWV3U3RhcnQgLSAxXSkpIHtcbiAgICAgIHByZXZpZXdTdGFydC0tO1xuICAgIH1cblxuICAgIGxldCBwcmV2aWV3RW5kID0gY29udGV4dEVuZDtcbiAgICB3aGlsZSAocHJldmlld0VuZCA8IHRleHQubGVuZ3RoICYmICEvW1xccy4hP1xcbl0vLnRlc3QodGV4dFtwcmV2aWV3RW5kXSkpIHtcbiAgICAgIHByZXZpZXdFbmQrKztcbiAgICB9XG5cbiAgICBsZXQgcHJldmlldyA9IHRleHQuc2xpY2UocHJldmlld1N0YXJ0LCBwcmV2aWV3RW5kKS50cmltKCk7XG4gICAgXG4gICAgLy8gQWRkIGVsbGlwc2lzXG4gICAgaWYgKHByZXZpZXdTdGFydCA+IDApIHByZXZpZXcgPSBcIi4uLlwiICsgcHJldmlldztcbiAgICBpZiAocHJldmlld0VuZCA8IHRleHQubGVuZ3RoKSBwcmV2aWV3ID0gcHJldmlldyArIFwiLi4uXCI7XG5cbiAgICByZXR1cm4gcHJldmlldztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmlzaWJsZUNoYXRzKCk6IFNlYXJjaFJlc3VsdDxDaGF0SGlzdG9yeUl0ZW0+W10ge1xuICAgIC8vIElmIHRoZXJlJ3Mgbm8gc2VhcmNoIHF1ZXJ5LCBqdXN0IHJldHVybiB0aGVtIGFsbCBzb3J0ZWQgYnkgZGF0ZVxuICAgIGlmICghdGhpcy5zZWFyY2hJbnB1dCB8fCAhdGhpcy5zZWFyY2hJbnB1dC52YWx1ZS50cmltKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmZsYXR0ZW5lZEl0ZW1zLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAgICAgaXRlbTogaXRlbS5pdGVtLFxuICAgICAgICBtYXRjaGVzOiBbXSxcbiAgICAgICAgc2NvcmU6IDAsXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlLnRyaW0oKTtcblxuICAgIC8vIEFwcGx5IHNlYXJjaCBhbmQgZmlsdGVyXG4gICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuc2VhcmNoU2VydmljZS5zZWFyY2goXG4gICAgICB0aGlzLmZsYXR0ZW5lZEl0ZW1zLm1hcChmID0+IGYuaXRlbSksXG4gICAgICBxdWVyeSxcbiAgICAgIChjaGF0KSA9PiB0aGlzLmdldFNlYXJjaGFibGVGaWVsZHMoY2hhdCksXG4gICAgICB7XG4gICAgICAgIGluaXRpYWxSZXN1bHRzTGltaXQ6IDI1LFxuICAgICAgICBtYXhGaWx0ZXJlZFJlc3VsdHM6IDUwLFxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBGaWx0ZXIgb3V0IHJlc3VsdHMgd2l0aCBubyBtYXRjaGVzIG9yIGxvdyBzY29yZXNcbiAgICBjb25zdCBmaWx0ZXJlZFJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihcbiAgICAgIChyZXN1bHQpID0+IHJlc3VsdC5tYXRjaGVzLmxlbmd0aCA+IDAgJiYgcmVzdWx0LnNjb3JlID4gMFxuICAgICk7XG5cbiAgICAvLyBTb3J0IHJlc3VsdHMgYnkgc2NvcmVcbiAgICByZXR1cm4gZmlsdGVyZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VhcmNoYWJsZUZpZWxkcyA9IChcbiAgICAgIGNoYXQ6IENoYXRIaXN0b3J5SXRlbVxuICApOiBTZWFyY2hhYmxlRmllbGRbXSA9PiB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7IGZpZWxkOiBcInRpdGxlXCIsIHRleHQ6IGNoYXQudGl0bGUsIHdlaWdodDogMjAwIH0sXG4gICAgICAgIHsgZmllbGQ6IFwiY29udGVudFwiLCB0ZXh0OiBjaGF0Lm1lc3NhZ2VzLm1hcChtID0+IHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobSkpLmpvaW4oXCIgXCIpLCB3ZWlnaHQ6IDEwMCB9LFxuICAgICAgXTtcbiAgfTtcbn1cbiIsICJpbXBvcnQge1xuICBBcHAsXG4gIE1lbnUsXG4gIE5vdGljZSxcbiAgVEZpbGUsXG4gIFRGb2xkZXIsXG4gIFZhdWx0LFxuICBzZXRJY29uLFxuICBNYXJrZG93blZpZXcsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUyB9IGZyb20gXCIuLi9jb25zdGFudHMvYXBpXCI7XG5pbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsXCI7XG5cbi8vIEZvciBhIHR5cGljYWwgT2JzaWRpYW4gcGx1Z2luLCB5b3UnZCBpbml0aWFsaXplIHRoaXMgaW4geW91ciBtYWluIHBsdWdpbiBjbGFzcy5cblxuZXhwb3J0IGNsYXNzIFN5c3RlbVNjdWxwdENvbnRleHRNZW51IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzdGF0dXNCYXJJdGVtOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzTW9kYWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NTdGF0dXM6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCdXR0b25zOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gc2N1bHB0U2VydmljZTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dE1lbnUoKTtcbiAgICB0aGlzLmluaXRpYWxpemVTdGF0dXNCYXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVN0YXR1c0JhcigpIHtcbiAgICB0aGlzLnN0YXR1c0Jhckl0ZW0gPSB0aGlzLmFwcC53b3Jrc3BhY2UuY29udGFpbmVyRWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLWJhclwiLFxuICAgIH0pO1xuICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ29udGV4dE1lbnUoKSB7XG4gICAgLy8gUmVnaXN0ZXIgdGhlIGVkaXRvciBtZW51IGV2ZW50IGZvciB0ZXh0IG1vZGlmaWNhdGlvblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImVkaXRvci1tZW51XCIsIChtZW51LCBlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgIGlmICghKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIGlmICghc2VsZWN0aW9uKSByZXR1cm47XG5cbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIHRoZSBmaWxlIG1lbnUgZXZlbnQgZm9yIGF1ZGlvIGZpbGVzXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiZmlsZS1tZW51XCIsIChtZW51LCBmaWxlKSA9PiB7XG4gICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIC8vIEFkZCBcIkNoYXQgd2l0aCBGaWxlXCIgZm9yIGFsbCBzdXBwb3J0ZWQgZmlsZSB0eXBlc1xuICAgICAgaWYgKFxuICAgICAgICAvLyBUZXh0IGZpbGVzXG4gICAgICAgIFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSB8fFxuICAgICAgICAvLyBEb2N1bWVudHMgKHdpbGwgYmUgYXV0by1leHRyYWN0ZWQpXG4gICAgICAgIFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiXS5pbmNsdWRlcyhcbiAgICAgICAgICBleHRlbnNpb25cbiAgICAgICAgKSB8fFxuICAgICAgICAvLyBBdWRpbyBmaWxlcyAod2lsbCBiZSBhdXRvLXRyYW5zY3JpYmVkKVxuICAgICAgICBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJtNGFcIiwgXCJvZ2dcIiwgXCJ3ZWJtXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikgfHxcbiAgICAgICAgLy8gSW1hZ2VzIChmb3IgdmlzaW9uIG1vZGVscylcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENoYXQgd2l0aCBGaWxlXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcIm1lc3NhZ2Utc3F1YXJlXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdmlldy5hZGRGaWxlVG9Db250ZXh0KGZpbGUpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gb3BlbiBjaGF0IHdpdGggZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2hhdCBvcGVuIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGF1ZGlvIGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIm1wM1wiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndhdlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcIndlYm1cIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIFRyYW5zY3JpYmUgQXVkaW9cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwibWljcm9waG9uZVwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQXVkaW9UcmFuc2NyaXB0aW9uKGZpbGUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIHRyYW5zY3JpYmUgYXVkaW8gZmlsZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5ldyBtZW51IGl0ZW0gZm9yIHRpbWVzdGFtcGVkIHRyYW5zY3JpcHRpb25cbiAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XG4gICAgICAgICAgaXRlbVxuICAgICAgICAgICAgLnNldFRpdGxlKFwiU3lzdGVtU2N1bHB0IC0gVHJhbnNjcmliZSBBdWRpbyAoVGltZXN0YW1wZWQpXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcImNsb2NrXCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oZmlsZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byB0cmFuc2NyaWJlIGF1ZGlvIGZpbGUgd2l0aCB0aW1lc3RhbXBzXCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaW1lc3RhbXBlZCB0cmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGRvY3VtZW50IGZpbGVzXG4gICAgICBpZiAoXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcInBkZlwiIHx8XG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSBcImRvY3hcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJkb2NcIlxuICAgICAgKSB7XG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIENvbnZlcnQgdG8gTWFya2Rvd25cIilcbiAgICAgICAgICAgIC5zZXRJY29uKFwiZmlsZS10ZXh0XCIpXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVEb2N1bWVudENvbnZlcnNpb24oZmlsZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byBjb252ZXJ0IGRvY3VtZW50XCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEb2N1bWVudCBjb252ZXJzaW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRG9jdW1lbnRDb252ZXJzaW9uKGZpbGU6IFRGaWxlKSB7XG4gICAgdGhpcy5jcmVhdGVQcm9ncmVzc01vZGFsKCk7XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDAsIFwiUHJvY2Vzc2luZyB5b3VyIGRvY3VtZW50Li4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gU21hbGwgZGVsYXkgdG8gZW5zdXJlIHVzZXJzIHNlZSB0aGUgaW5pdGlhbCBwcm9jZXNzaW5nIG1lc3NhZ2VcbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwMCk7XG5cbiAgICAgIC8vIFNob3cgdXBsb2FkIHN0YXR1c1xuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDEwLCBcIlVwbG9hZGluZyBkb2N1bWVudC4uLlwiLCBcInVwbG9hZFwiKTtcblxuICAgICAgLy8gVXBsb2FkIHRoZSBmaWxlXG4gICAgICBjb25zdCB7IGRvY3VtZW50SWQsIHN0YXR1cywgY2FjaGVkIH0gPVxuICAgICAgICBhd2FpdCB0aGlzLnNjdWxwdFNlcnZpY2UudXBsb2FkRG9jdW1lbnQoZmlsZSk7XG5cbiAgICAgIGlmIChjYWNoZWQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDUwLCBcIkZvdW5kIGNhY2hlZCB2ZXJzaW9uXCIsIFwiY2hlY2tcIik7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG4gICAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgICAgZmlsZSxcbiAgICAgICAgICBleHRyYWN0aW9uRGF0YVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgICB0aGlzLnNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDMwLCBcIlByb2Nlc3NpbmcgZG9jdW1lbnQuLi5cIiwgXCJsb2FkZXItMlwiKTtcblxuICAgICAgLy8gUG9sbCBmb3Igc3RhdHVzIHVudGlsIGNvbXBsZXRlZFxuICAgICAgY29uc3QgcG9sbFJlc3VsdCA9IGF3YWl0IHRoaXMucG9sbFVudGlsQ29tcGxldGUoZG9jdW1lbnRJZCk7XG5cbiAgICAgIGlmICghcG9sbFJlc3VsdCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMCwgXCJQcm9jZXNzaW5nIGluY29tcGxldGVcIiwgXCJhbGVydC1jaXJjbGVcIik7XG4gICAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMzAwMCk7XG4gICAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDgwLCBcIkRvd25sb2FkaW5nIHJlc3VsdHMuLi5cIiwgXCJkb3dubG9hZFwiKTtcblxuICAgICAgLy8gRG93bmxvYWQgZXh0cmFjdGlvblxuICAgICAgY29uc3QgZXh0cmFjdGlvbkRhdGEgPSBhd2FpdCB0aGlzLmRvd25sb2FkRXh0cmFjdGlvbihkb2N1bWVudElkKTtcbiAgICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gYXdhaXQgdGhpcy5zYXZlRXh0cmFjdGlvblJlc3VsdHMoXG4gICAgICAgIGZpbGUsXG4gICAgICAgIGV4dHJhY3Rpb25EYXRhXG4gICAgICApO1xuXG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoMTAwLCBcIlByb2Nlc3NpbmcgY29tcGxldGUhXCIsIFwiY2hlY2stY2lyY2xlXCIpO1xuICAgICAgdGhpcy5zaG93Q29tcGxldGlvbkJ1dHRvbnMoZXh0cmFjdGlvblBhdGgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTeXN0ZW1TY3VscHQgZXJyb3JcIiwgZSk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwoXG4gICAgICAgIDAsXG4gICAgICAgIGBFcnJvcjogJHtlIGluc3RhbmNlb2YgRXJyb3IgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSl9YCxcbiAgICAgICAgXCJ4LWNpcmNsZVwiXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy5zbGVlcCg1MDAwKTtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVBdWRpb1RyYW5zY3JpcHRpb24oXG4gICAgZmlsZTogVEZpbGUsXG4gICAgdGltZXN0YW1wZWQ6IGJvb2xlYW5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNob3dBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCh0aGlzLmFwcCwge1xuICAgICAgICBmaWxlLFxuICAgICAgICB0aW1lc3RhbXBlZCxcbiAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6IGFzeW5jICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAvLyBDcmVhdGUgdGhlIG91dHB1dCBmaWxlXG4gICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lO1xuICAgICAgICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSB0aW1lc3RhbXBlZCA/IFwic3J0XCIgOiBcIm1kXCI7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0UGF0aCA9IGAke1xuICAgICAgICAgICAgZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIlxuICAgICAgICAgIH0vJHtiYXNlTmFtZX0uJHtmaWxlRXh0ZW5zaW9ufWA7XG5cbiAgICAgICAgICAvLyBGb3IgU1JUIGZpbGVzLCB1c2UgcmF3IHRleHQuIEZvciBNRCBmaWxlcywgdGhlIHRleHQgaXMgYWxyZWFkeSBmb3JtYXR0ZWRcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGltZXN0YW1wZWQgPyB0ZXh0IDogdGV4dDtcblxuICAgICAgICAgIC8vIENyZWF0ZSBvciB1cGRhdGUgdGhlIGZpbGVcbiAgICAgICAgICBsZXQgdHJhbnNjcmlwdGlvbkZpbGU6IFRGaWxlO1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChvdXRwdXRQYXRoKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgdHJhbnNjcmlwdGlvbkZpbGUgPSBleGlzdGluZ0ZpbGU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyYW5zY3JpcHRpb25GaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKFxuICAgICAgICAgICAgICBvdXRwdXRQYXRoLFxuICAgICAgICAgICAgICBjb250ZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIE9wZW4gdGhlIHRyYW5zY3JpcHRpb24gZmlsZSBpbiBhIG5ldyBsZWFmXG4gICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUodHJhbnNjcmlwdGlvbkZpbGUpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1ZGlvIHRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcm9ncmVzc01vZGFsKCkge1xuICAgIGlmICh0aGlzLnByb2dyZXNzTW9kYWwpIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NNb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5wcm9ncmVzc01vZGFsLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLW1vZGFsXCI7XG5cbiAgICB0aGlzLnByb2dyZXNzQmFyID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLWJhclwiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzID0gdGhpcy5wcm9ncmVzc01vZGFsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByb2dyZXNzLXN0YXR1c1wiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzQnV0dG9ucyA9IHRoaXMucHJvZ3Jlc3NNb2RhbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1idXR0b25zXCJcbiAgICApO1xuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9ncmVzc01vZGFsKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nLCBpY29uOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMucHJvZ3Jlc3NNb2RhbCB8fCAhdGhpcy5wcm9ncmVzc0JhciB8fCAhdGhpcy5wcm9ncmVzc1N0YXR1cylcbiAgICAgIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBgJHtwcm9ncmVzc30lYDtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmVtcHR5KCk7XG4gICAgc2V0SWNvbih0aGlzLnByb2dyZXNzU3RhdHVzLCBpY29uKTtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzLmNyZWF0ZVNwYW4oeyB0ZXh0OiBzdGF0dXMgfSk7XG4gIH1cblxuICBwcml2YXRlIHNob3dDb21wbGV0aW9uQnV0dG9ucyhleHRyYWN0aW9uUGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnByb2dyZXNzQnV0dG9ucykgcmV0dXJuO1xuXG4gICAgdGhpcy5wcm9ncmVzc0J1dHRvbnMuZW1wdHkoKTtcblxuICAgIC8vIFZpZXcgYnV0dG9uXG4gICAgY29uc3Qgdmlld0J1dHRvbiA9IHRoaXMucHJvZ3Jlc3NCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiVmlldyBSZXN1bHRcIixcbiAgICAgIGNsczogXCJtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgdmlld0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChleHRyYWN0aW9uUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xvc2UgYnV0dG9uXG4gICAgY29uc3QgY2xvc2VCdXR0b24gPSB0aGlzLnByb2dyZXNzQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNsb3NlXCIsXG4gICAgfSk7XG4gICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VQcm9ncmVzc01vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlUHJvZ3Jlc3NNb2RhbCgpIHtcbiAgICBpZiAodGhpcy5wcm9ncmVzc01vZGFsICYmIHRoaXMucHJvZ3Jlc3NNb2RhbC5wYXJlbnROb2RlKSB7XG4gICAgICB0aGlzLnByb2dyZXNzTW9kYWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnByb2dyZXNzTW9kYWwpO1xuICAgIH1cbiAgICB0aGlzLnByb2dyZXNzTW9kYWwgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NTdGF0dXMgPSBudWxsO1xuICAgIHRoaXMucHJvZ3Jlc3NCdXR0b25zID0gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcG9sbFVudGlsQ29tcGxldGUoXG4gICAgZG9jdW1lbnRJZDogc3RyaW5nLFxuICAgIG1heEF0dGVtcHRzID0gMzBcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhBdHRlbXB0czsgaSsrKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtcbiAgICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgICB9JHtTWVNURU1TQ1VMUFRfQVBJX0VORFBPSU5UUy5ET0NVTUVOVFMuR0VUKGRvY3VtZW50SWQpfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNoZWNrIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvciB8fCBcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYmFzZWQgb24gYXR0ZW1wdCBudW1iZXJcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oMzAgKyAoaSAvIG1heEF0dGVtcHRzKSAqIDUwLCA4MCk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzTW9kYWwocHJvZ3Jlc3MsIFwiUHJvY2Vzc2luZyBkb2N1bWVudC4uLlwiLCBcImxvYWRlci0yXCIpO1xuXG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDIwMDApO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGAke1xuICAgICAgICB0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybFxuICAgICAgfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuRE9DVU1FTlRTLkRPV05MT0FEKGRvY3VtZW50SWQpfWAsXG4gICAgICB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZG93bmxvYWQgZXh0cmFjdGlvbjogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVFeHRyYWN0aW9uUmVzdWx0cyhmaWxlOiBURmlsZSwgZGF0YTogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgIGNvbnN0IGJhc2VOYW1lID0gdGhpcy5zYW5pdGl6ZUZpbGVuYW1lKGZpbGUuYmFzZW5hbWUpO1xuICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCB8fCBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICAvLyBDcmVhdGUgdGhlIHRhcmdldCBmb2xkZXJcbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKTtcblxuICAgIC8vIENyZWF0ZSBleHRyYWN0aW9uIGZpbGUgcGF0aFxuICAgIGNvbnN0IGV4dHJhY3Rpb25QYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKFxuICAgICAgYCR7cGFyZW50UGF0aH0vJHtiYXNlTmFtZX0tZXh0cmFjdGlvbi5tZGBcbiAgICApO1xuXG4gICAgLy8gU2F2ZSB0aGUgZXh0cmFjdGlvbiBjb250ZW50XG4gICAgY29uc3QgY29udGVudCA9IHRoaXMuZm9ybWF0RXh0cmFjdGlvbkNvbnRlbnQoZGF0YSk7XG4gICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGV4dHJhY3Rpb25QYXRoKTtcbiAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZXh0cmFjdGlvblBhdGgsIGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBleHRyYWN0aW9uUGF0aDtcbiAgfVxuXG4gIHByaXZhdGUgc2FuaXRpemVGaWxlbmFtZShmaWxlbmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZmlsZW5hbWUucmVwbGFjZSgvW15hLXpBLVowLTktXyBdL2csIFwiXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVQYXRoKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFxcXC9nLCBcIi9cIikucmVwbGFjZSgvXFwvKy9nLCBcIi9cIik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUZvbGRlcihwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICBpZiAoXG4gICAgICAhKHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChub3JtYWxpemVkUGF0aCkgaW5zdGFuY2VvZiBURm9sZGVyKVxuICAgICkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKG5vcm1hbGl6ZWRQYXRoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEV4dHJhY3Rpb25Db250ZW50KGRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAjICR7ZGF0YS50aXRsZSB8fCBcIkRvY3VtZW50IEV4dHJhY3Rpb25cIn1cblxuJHtkYXRhLmNvbnRlbnQgfHwgXCJcIn1cblxuLS0tXG5FeHRyYWN0ZWQgd2l0aCBTeXN0ZW1TY3VscHRcbmA7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuXG5leHBvcnQgY2xhc3MgU2V0dGluZ3NNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zZXR0aW5ncyA9IERFRkFVTFRfU0VUVElOR1M7XG4gIH1cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgY29uc3QgbG9hZGVkRGF0YSA9IGF3YWl0IHRoaXMucGx1Z2luLmxvYWREYXRhKCk7XG4gICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGxvYWRlZERhdGEpO1xuXG4gICAgLy8gRW5zdXJlIHNlcnZlciBVUkwgbWF0Y2hlcyBkZXZlbG9wbWVudCBtb2RlXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlKSB7XG4gICAgICB0aGlzLnNldHRpbmdzLnNlcnZlclVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0dGluZ3Muc2VydmVyVXJsID0gXCJodHRwczovL2FwaS5zeXN0ZW1zY3VscHQuY29tXCI7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIHRoaXMucGx1Z2luLmFpU2VydmljZS51cGRhdGVTZXR0aW5ncyh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIGdldFNldHRpbmdzKCk6IFN5c3RlbVNjdWxwdFNldHRpbmdzIHtcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5ncztcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVNldHRpbmdzKG5ld1NldHRpbmdzOiBQYXJ0aWFsPFN5c3RlbVNjdWxwdFNldHRpbmdzPikge1xuICAgIC8vIEZvciBhIGNvbXBsZXRlIHJlc2V0IHRvIGRlZmF1bHRzLCByZXBsYWNlIGVudGlyZSBzZXR0aW5ncyBvYmplY3RcbiAgICBpZiAobmV3U2V0dGluZ3MgPT09IERFRkFVTFRfU0VUVElOR1MpIHtcbiAgICAgIHRoaXMuc2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfU0VUVElOR1MgfTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRm9yIHBhcnRpYWwgdXBkYXRlcywgbWVyZ2Ugd2l0aCBleGlzdGluZyBzZXR0aW5nc1xuICAgIGlmIChuZXdTZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3U2V0dGluZ3Muc2VydmVyVXJsID0gbmV3U2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlXG4gICAgICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjMwMDFcIlxuICAgICAgICA6IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgIH1cbiAgICB0aGlzLnNldHRpbmdzID0geyAuLi50aGlzLnNldHRpbmdzLCAuLi5uZXdTZXR0aW5ncyB9O1xuICAgIGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwIH0gZnJvbSBcIi4uL3VpXCI7XG5cbmV4cG9ydCBjbGFzcyBMaWNlbnNlTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBhc3luYyBpbml0aWFsaXplTGljZW5zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpKSB7XG4gICAgICAvLyBWYWxpZGF0ZSBsaWNlbnNlIG9uIGluaXRpYWxpemF0aW9uIGlmIGEga2V5IGV4aXN0c1xuICAgICAgYXdhaXQgdGhpcy52YWxpZGF0ZUxpY2Vuc2VLZXkodHJ1ZSwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlTGljZW5zZUtleShmb3JjZSA9IGZhbHNlLCBzaG93UmVsb2FkUHJvbXB0ID0gdHJ1ZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSkge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gZmFsc2U7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMucGx1Z2luLmFpU2VydmljZS52YWxpZGF0ZUxpY2Vuc2UoZm9yY2UpO1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gaXNWYWxpZDtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICBpZiAoaXNWYWxpZCAmJiBzaG93UmVsb2FkUHJvbXB0KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlBybyBmZWF0dXJlcyBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IGFjdGl2YXRlZCEgVG8gZW5zdXJlIGFsbCBmZWF0dXJlcyB3b3JrIHByb3Blcmx5LCBPYnNpZGlhbiBuZWVkcyB0byBiZSByZWxvYWRlZC5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJSZWxvYWQgdG8gQ29tcGxldGUgVXBncmFkZVwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQ2xpY2sgdGhlIGJ1dHRvbiBiZWxvdyB0byByZWxvYWQgT2JzaWRpYW4gYW5kIHN0YXJ0IHVzaW5nIHlvdXIgUHJvIGZlYXR1cmVzLlwiLFxuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJSZWxvYWQgJiBVcGdyYWRlXCIsXG4gICAgICAgICAgICBpY29uOiBcInNwYXJrbGVzXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMaWNlbnNlIHZhbGlkYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVEZpbGUsIFRGb2xkZXIsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5cbmV4cG9ydCBjbGFzcyBKYW5pdG9yTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU2l6ZShmaWxlczogVEZpbGVbXSk6IHN0cmluZyB7XG4gICAgY29uc3QgdG90YWxCeXRlcyA9IGZpbGVzLnJlZHVjZSgoYWNjLCBmaWxlKSA9PiBhY2MgKyBmaWxlLnN0YXQuc2l6ZSwgMCk7XG4gICAgaWYgKHRvdGFsQnl0ZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBcImVtcHR5XCI7XG4gICAgfSBlbHNlIGlmICh0b3RhbEJ5dGVzIDwgMTAyNCkge1xuICAgICAgcmV0dXJuIGAke3RvdGFsQnl0ZXN9IGJ5dGVzYDtcbiAgICB9IGVsc2UgaWYgKHRvdGFsQnl0ZXMgPCAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gMTAyNCkudG9GaXhlZCgxKX0gS0JgO1xuICAgIH0gZWxzZSBpZiAodG90YWxCeXRlcyA8IDEwMjQgKiAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgxKX0gTUJgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7KHRvdGFsQnl0ZXMgLyAoMTAyNCAqIDEwMjQgKiAxMDI0KSkudG9GaXhlZCgxKX0gR0JgO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RmlsZXNJbkRpcmVjdG9yeShkaXJlY3Rvcnk6IHN0cmluZyk6IFRGaWxlW10ge1xuICAgIHJldHVybiB0aGlzLmFwcC52YXVsdFxuICAgICAgLmdldEZpbGVzKClcbiAgICAgIC5maWx0ZXIoKGZpbGUpID0+IGZpbGUucGF0aC5zdGFydHNXaXRoKGRpcmVjdG9yeSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNhYmxlQnV0dG9uKGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQpIHtcbiAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJtb2Qtd2FybmluZ1wiKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQnV0dG9uU3RhdGUoXG4gICAgYnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudCxcbiAgICBmaWxlczogVEZpbGVbXSxcbiAgICB0eXBlOiBzdHJpbmdcbiAgKSB7XG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuY2FsY3VsYXRlU2l6ZShmaWxlcyk7XG4gICAgY29uc3QgaGFzRmlsZXMgPSBmaWxlcy5sZW5ndGggPiAwO1xuXG4gICAgaWYgKGhhc0ZpbGVzKSB7XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC13YXJuaW5nXCIpO1xuICAgICAgYnV0dG9uLnNldFRleHQoYENsZWFyIEFsbCAke3R5cGV9ICgke3NpemV9KWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgYnV0dG9uLmFkZENsYXNzKFwibW9kLWRpc2FibGVkXCIpO1xuICAgICAgYnV0dG9uLnJlbW92ZUNsYXNzKFwibW9kLXdhcm5pbmdcIik7XG4gICAgICBidXR0b24uc2V0VGV4dChgTm8gJHt0eXBlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2xlYW5EaXJlY3RvcnkoZGlyZWN0b3J5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBTYWZldHkgY2hlY2s6IHByZXZlbnQgZGVsZXRpb24gb2Ygcm9vdCBvciBzeXN0ZW0gZGlyZWN0b3JpZXNcbiAgICBpZiAoXG4gICAgICAhZGlyZWN0b3J5IHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiL1wiIHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiLlwiIHx8XG4gICAgICBkaXJlY3RvcnkgPT09IFwiLi5cIlxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlbGV0ZSByb290IG9yIHN5c3RlbSBkaXJlY3Rvcmllc1wiKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgYWxsIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShkaXJlY3RvcnkpO1xuXG4gICAgLy8gTW92ZSBmaWxlcyB0byB0cmFzaFxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZmlsZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLy8gQWZ0ZXIgZmlsZXMgYXJlIG1vdmVkIHRvIHRyYXNoLCBjbGVhbiB1cCBlbXB0eSBkaXJlY3Rvcmllc1xuICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChkaXJlY3RvcnkpO1xuICAgIGlmIChmb2xkZXIgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAvLyBHZXQgYWxsIHN1YmRpcmVjdG9yaWVzXG4gICAgICBjb25zdCBzdWJkaXJzID0gZm9sZGVyLmNoaWxkcmVuXG4gICAgICAgIC5maWx0ZXIoKGNoaWxkKTogY2hpbGQgaXMgVEZvbGRlciA9PiBjaGlsZCBpbnN0YW5jZW9mIFRGb2xkZXIpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLnBhdGgubGVuZ3RoIC0gYS5wYXRoLmxlbmd0aCk7IC8vIFNvcnQgYnkgcGF0aCBsZW5ndGggZGVzY2VuZGluZyB0byBkZWxldGUgZGVlcGVzdCBmaXJzdFxuXG4gICAgICAvLyBEZWxldGUgc3ViZGlyZWN0b3JpZXMgaWYgdGhleSdyZSBlbXB0eVxuICAgICAgZm9yIChjb25zdCBzdWJkaXIgb2Ygc3ViZGlycykge1xuICAgICAgICBpZiAoc3ViZGlyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKHN1YmRpciwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlIHRoZSBtYWluIGRpcmVjdG9yeSBpZiBpdCdzIGVtcHR5XG4gICAgICBpZiAoZm9sZGVyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC50cmFzaChmb2xkZXIsIHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvd0ZpbGVQcmV2aWV3KGZpbGVzOiBURmlsZVtdLCB0eXBlOiBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtZmlsZS10cmVlIG5hdi1mb2xkZXJcIjtcblxuICAgIC8vIEFkZCBzdW1tYXJ5IHRleHRcbiAgICBjb25zdCBzdW1tYXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBzdW1tYXJ5LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlci10aXRsZVwiO1xuICAgIHN1bW1hcnkudGV4dENvbnRlbnQgPSBgJHtmaWxlcy5sZW5ndGh9ICR7dHlwZX0gKCR7dGhpcy5jYWxjdWxhdGVTaXplKFxuICAgICAgZmlsZXNcbiAgICApfSlgO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdW1tYXJ5KTtcblxuICAgIC8vIFNvcnQgZmlsZXMgYnkgcGF0aCBmb3IgYmV0dGVyIG9yZ2FuaXphdGlvblxuICAgIGNvbnN0IHNvcnRlZEZpbGVzID0gZmlsZXMuc29ydCgoYSwgYikgPT4gYS5wYXRoLmxvY2FsZUNvbXBhcmUoYi5wYXRoKSk7XG5cbiAgICAvLyBHcm91cCBmaWxlcyBieSBkaXJlY3RvcnlcbiAgICBjb25zdCBmaWxlc0J5RGlyID0gbmV3IE1hcDxzdHJpbmcsIFRGaWxlW10+KCk7XG4gICAgZm9yIChjb25zdCBmaWxlIG9mIHNvcnRlZEZpbGVzKSB7XG4gICAgICBjb25zdCBkaXIgPSBmaWxlLnBhcmVudD8ucGF0aCB8fCBcIlwiO1xuICAgICAgaWYgKCFmaWxlc0J5RGlyLmhhcyhkaXIpKSB7XG4gICAgICAgIGZpbGVzQnlEaXIuc2V0KGRpciwgW10pO1xuICAgICAgfVxuICAgICAgZmlsZXNCeURpci5nZXQoZGlyKT8ucHVzaChmaWxlKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZmlsZSB0cmVlXG4gICAgZm9yIChjb25zdCBbZGlyLCBkaXJGaWxlc10gb2YgZmlsZXNCeURpcikge1xuICAgICAgaWYgKGRpcikge1xuICAgICAgICBjb25zdCBmb2xkZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJEaXYuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyXCI7XG5cbiAgICAgICAgY29uc3QgZm9sZGVyVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJUaXRsZS5jbGFzc05hbWUgPSBcIm5hdi1mb2xkZXItdGl0bGVcIjtcbiAgICAgICAgc2V0SWNvbihmb2xkZXJUaXRsZSwgXCJmb2xkZXJcIik7XG4gICAgICAgIGZvbGRlclRpdGxlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBkaXIgfSk7XG4gICAgICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJUaXRsZSk7XG5cbiAgICAgICAgY29uc3QgZm9sZGVyQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGZvbGRlckNvbnRlbnQuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyLWNoaWxkcmVuXCI7XG4gICAgICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJDb250ZW50KTtcblxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZGlyRmlsZXMpIHtcbiAgICAgICAgICBmb2xkZXJDb250ZW50LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRmlsZUl0ZW0oZmlsZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZvbGRlckRpdik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWxlcyBpbiByb290XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBkaXJGaWxlcykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUZpbGVJdGVtKGZpbGUpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUZpbGVJdGVtKGZpbGU6IFRGaWxlKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGZpbGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGZpbGVEaXYuY2xhc3NOYW1lID0gXCJuYXYtZmlsZVwiO1xuXG4gICAgY29uc3QgZmlsZVRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBmaWxlVGl0bGUuY2xhc3NOYW1lID0gXCJuYXYtZmlsZS10aXRsZVwiO1xuXG4gICAgLy8gU2V0IGFwcHJvcHJpYXRlIGljb24gYmFzZWQgb24gZmlsZSB0eXBlXG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgaWNvbk5hbWUgPSBcImZpbGVcIjtcbiAgICBpZiAoW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIFtcImpwZ1wiLCBcImpwZWdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJ3ZWJwXCIsIFwic3ZnXCJdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICApIHtcbiAgICAgIGljb25OYW1lID0gXCJpbWFnZVwiO1xuICAgIH0gZWxzZSBpZiAoW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIGljb25OYW1lID0gXCJhdWRpby1saW5lc1wiO1xuICAgIH0gZWxzZSBpZiAoW1wicGRmXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgIGljb25OYW1lID0gXCJmaWxlLXRleHRcIjtcbiAgICB9XG4gICAgc2V0SWNvbihmaWxlVGl0bGUsIGljb25OYW1lKTtcblxuICAgIC8vIEZpbGUgbmFtZVxuICAgIGZpbGVUaXRsZS5jcmVhdGVTcGFuKHsgdGV4dDogZmlsZS5uYW1lIH0pO1xuXG4gICAgLy8gRmlsZSBzaXplXG4gICAgY29uc3Qgc2l6ZVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBzaXplU3Bhbi5jbGFzc05hbWUgPSBcIm5hdi1maWxlLXNpemVcIjtcbiAgICBzaXplU3Bhbi50ZXh0Q29udGVudCA9IHRoaXMuY2FsY3VsYXRlU2l6ZShbZmlsZV0pO1xuICAgIGZpbGVUaXRsZS5hcHBlbmRDaGlsZChzaXplU3Bhbik7XG5cbiAgICBmaWxlRGl2LmFwcGVuZENoaWxkKGZpbGVUaXRsZSk7XG4gICAgcmV0dXJuIGZpbGVEaXY7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgZmlsZXM6IFRGaWxlW10sXG4gICAgdHlwZTogc3RyaW5nLFxuICAgIGRpcmVjdG9yeTogc3RyaW5nLFxuICAgIGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnRcbiAgKSB7XG4gICAgY29uc3QgY29uZmlybU1vZGFsID0gbmV3IE1vZGFsKHRoaXMuYXBwKTtcbiAgICBjb25maXJtTW9kYWwudGl0bGVFbC5zZXRUZXh0KGBDbGVhciAke3R5cGV9YCk7XG5cbiAgICBjb25zdCBjb250ZW50ID0gY29uZmlybU1vZGFsLmNvbnRlbnRFbDtcbiAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBgXHUyNkEwXHVGRTBGIFdBUk5JTkc6IFRoZSBmb2xsb3dpbmcgZmlsZXMgd2lsbCBiZSBtb3ZlZCB0byB0aGUgT2JzaWRpYW4gdHJhc2guIFlvdSBjYW4gcmVzdG9yZSB0aGVtIGZyb20gdGhlIHRyYXNoIGlmIG5lZWRlZC5gLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGZpbGUgcHJldmlldyBsaXN0XG4gICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLnNob3dGaWxlUHJldmlldyhmaWxlcywgdHlwZSkpO1xuXG4gICAgLy8gQWRkIGJ1dHRvbnNcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWJ1dHRvbnNcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiQ2FuY2VsXCIgfSk7XG4gICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjb25maXJtTW9kYWwuY2xvc2UoKSk7XG5cbiAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJtb2Qtd2FybmluZ1wiLFxuICAgICAgdGV4dDogXCJNb3ZlIHRvIFRyYXNoXCIsXG4gICAgfSk7XG4gICAgY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGVhbkRpcmVjdG9yeShkaXJlY3RvcnkpO1xuICAgICAgICB0aGlzLmRpc2FibGVCdXR0b24oYnV0dG9uKTtcbiAgICAgICAgYnV0dG9uLnNldFRleHQoYE5vICR7dHlwZX1gKTtcblxuICAgICAgICBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgYFN1Y2Nlc3NmdWxseSBtb3ZlZCAke1xuICAgICAgICAgICAgZmlsZXMubGVuZ3RoXG4gICAgICAgICAgfSAke3R5cGUudG9Mb3dlckNhc2UoKX0gZmlsZXMgKCR7dGhpcy5jYWxjdWxhdGVTaXplKFxuICAgICAgICAgICAgZmlsZXNcbiAgICAgICAgICApfSkgdG8gdHJhc2hgLFxuICAgICAgICAgIHsgdGl0bGU6IFwiU3VjY2Vzc1wiIH1cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNsZWFyaW5nICR7dHlwZS50b0xvd2VyQ2FzZSgpfTpgLCBlcnJvcik7XG4gICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgYEZhaWxlZCB0byBjbGVhciAke3R5cGUudG9Mb3dlckNhc2UoKX1gLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25maXJtTW9kYWwuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGlzRW1wdHlGaWxlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gQ2hlY2sgZmlsZSBzaXplIGZpcnN0XG4gICAgaWYgKGZpbGUuc3RhdC5zaXplID09PSAwKSByZXR1cm4gdHJ1ZTtcblxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAvLyBGb3IgbWFya2Rvd24gZmlsZXMsIGNoZWNrIGNvbnRlbnRcbiAgICBpZiAoW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIC8vIFJlbW92ZSBmcm9udG1hdHRlciBhbmQgY2hlY2sgaWYgcmVtYWluaW5nIGNvbnRlbnQgaXMgZW1wdHlcbiAgICAgIGNvbnN0IGNvbnRlbnRXaXRob3V0RnJvbnRtYXR0ZXIgPSBjb250ZW50XG4gICAgICAgIC5yZXBsYWNlKC9eLS0tW1xcc1xcU10qPy0tLS8sIFwiXCIpXG4gICAgICAgIC50cmltKCk7XG4gICAgICByZXR1cm4gIWNvbnRlbnRXaXRob3V0RnJvbnRtYXR0ZXI7XG4gICAgfVxuXG4gICAgLy8gRm9yIGltYWdlcyBhbmQgYmluYXJ5IGZpbGVzLCBqdXN0IGNoZWNrIHNpemVcbiAgICBpZiAoXG4gICAgICBbXG4gICAgICAgIFwianBnXCIsXG4gICAgICAgIFwianBlZ1wiLFxuICAgICAgICBcInBuZ1wiLFxuICAgICAgICBcImdpZlwiLFxuICAgICAgICBcIndlYnBcIixcbiAgICAgICAgXCJzdmdcIixcbiAgICAgICAgXCJtcDNcIixcbiAgICAgICAgXCJ3YXZcIixcbiAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgXCJtNGFcIixcbiAgICAgIF0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICkge1xuICAgICAgcmV0dXJuIGZpbGUuc3RhdC5zaXplID09PSAwO1xuICAgIH1cblxuICAgIC8vIEZvciBleHRyYWN0aW9ucywgY2hlY2sgaWYgaXQncyBqdXN0IGhlYWRlcnMgb3IgZXJyb3IgbWVzc2FnZXNcbiAgICBpZiAoZmlsZS5wYXRoLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKSkge1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICBjb25zdCBoYXNPbmx5SGVhZGVycyA9ICFjb250ZW50LnJlcGxhY2UoL14jLiokL2dtLCBcIlwiKS50cmltKCk7XG4gICAgICBjb25zdCBoYXNFcnJvck1lc3NhZ2UgPVxuICAgICAgICBjb250ZW50LmluY2x1ZGVzKFwiRXJyb3IgZXh0cmFjdGluZ1wiKSB8fFxuICAgICAgICBjb250ZW50LmluY2x1ZGVzKFwiUHJvY2Vzc2luZyBmYWlsZWRcIik7XG4gICAgICByZXR1cm4gaGFzT25seUhlYWRlcnMgfHwgaGFzRXJyb3JNZXNzYWdlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RW1wdHlGaWxlcygpOiBQcm9taXNlPFRGaWxlW10+IHtcbiAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XG4gICAgY29uc3QgZW1wdHlGaWxlczogVEZpbGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4gICAgICBpZiAoYXdhaXQgdGhpcy5pc0VtcHR5RmlsZShmaWxlKSkge1xuICAgICAgICBlbXB0eUZpbGVzLnB1c2goZmlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVtcHR5RmlsZXM7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEVtcHR5Rm9sZGVycygpOiBQcm9taXNlPFRGb2xkZXJbXT4ge1xuICAgIGNvbnN0IGVtcHR5Rm9sZGVyczogVEZvbGRlcltdID0gW107XG4gICAgY29uc3QgY2hlY2tGb2xkZXIgPSAoZm9sZGVyOiBURm9sZGVyKTogYm9vbGVhbiA9PiB7XG4gICAgICAvLyBDaGVjayBpZiBmb2xkZXIgaGFzIGFueSBub24tZW1wdHkgY2hpbGRyZW5cbiAgICAgIGNvbnN0IGhhc05vbkVtcHR5Q2hpbGRyZW4gPSBmb2xkZXIuY2hpbGRyZW4uc29tZSgoY2hpbGQpID0+IHtcbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGQuc3RhdC5zaXplID4gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgICAgcmV0dXJuICFjaGVja0ZvbGRlcihjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghaGFzTm9uRW1wdHlDaGlsZHJlbikge1xuICAgICAgICBlbXB0eUZvbGRlcnMucHVzaChmb2xkZXIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgY29uc3Qgcm9vdEZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldFJvb3QoKTtcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHJvb3RGb2xkZXIuY2hpbGRyZW4pIHtcbiAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgY2hlY2tGb2xkZXIoY2hpbGQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbXB0eUZvbGRlcnM7XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWphbml0b3ItbW9kYWxcIik7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICBjb25zdCB0aXRsZUVsID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIiB9KTtcbiAgICB0aXRsZUVsLnNldFRleHQoXCJTeXN0ZW1TY3VscHQgSmFuaXRvclwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aXRsZUVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLWRlc2NyaXB0aW9uXCIsXG4gICAgfSk7XG4gICAgZGVzY3JpcHRpb25FbC5zZXRUZXh0KFwiQ2xlYW4gdXAgYW5kIG9wdGltaXplIHlvdXIgU3lzdGVtU2N1bHB0IHdvcmtzcGFjZVwiKTtcblxuICAgIC8vIENyZWF0ZSBtYWluIGNvbnRlbnQgY29udGFpbmVyXG4gICAgY29uc3QgbWFpbkNvbnRlbnQgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtamFuaXRvci1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgc2VjdGlvbnMgY29udGFpbmVyXG4gICAgY29uc3Qgc2VjdGlvbnNDb250YWluZXIgPSBtYWluQ29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9ucy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBFbXB0eSBDb250ZW50IFNlY3Rpb25cbiAgICB0aGlzLmNyZWF0ZUVtcHR5Q29udGVudFNlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIENoYXQgSGlzdG9yeSBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVDaGF0SGlzdG9yeVNlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIEV4dHJhY3Rpb25zIFNlY3Rpb25cbiAgICB0aGlzLmNyZWF0ZUV4dHJhY3Rpb25zU2VjdGlvbihzZWN0aW9uc0NvbnRhaW5lcik7XG5cbiAgICAvLyBBZGQgUmVjb3JkaW5ncyBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVSZWNvcmRpbmdzU2VjdGlvbihzZWN0aW9uc0NvbnRhaW5lcik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUVtcHR5Q29udGVudFNlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGVtcHR5U2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiRW1wdHkgQ29udGVudFwiLFxuICAgICAgXCJDbGVhbiB1cCBlbXB0eSBmaWxlcyBhbmQgZm9sZGVyc1wiXG4gICAgKTtcblxuICAgIGNvbnN0IGVtcHR5RmlsZXMgPSBhd2FpdCB0aGlzLmdldEVtcHR5RmlsZXMoKTtcbiAgICBjb25zdCBlbXB0eUZvbGRlcnMgPSBhd2FpdCB0aGlzLmdldEVtcHR5Rm9sZGVycygpO1xuICAgIGNvbnN0IHRvdGFsRW1wdHkgPSBlbXB0eUZpbGVzLmxlbmd0aCArIGVtcHR5Rm9sZGVycy5sZW5ndGg7XG5cbiAgICBjb25zdCBjbGVhckVtcHR5QnV0dG9uID0gZW1wdHlTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OlxuICAgICAgICB0b3RhbEVtcHR5ID4gMFxuICAgICAgICAgID8gYENsZWFyIEVtcHR5IENvbnRlbnQgKCR7dG90YWxFbXB0eX0gaXRlbXMpYFxuICAgICAgICAgIDogXCJObyBFbXB0eSBDb250ZW50XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG5cbiAgICB0aGlzLnVwZGF0ZUJ1dHRvblN0YXRlKGNsZWFyRW1wdHlCdXR0b24sIGVtcHR5RmlsZXMsIFwiRW1wdHkgQ29udGVudFwiKTtcblxuICAgIGlmICh0b3RhbEVtcHR5ID4gMCkge1xuICAgICAgY2xlYXJFbXB0eUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJFbXB0eUJ1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhIHByZXZpZXcgdGhhdCBpbmNsdWRlcyBib3RoIGZpbGVzIGFuZCBmb2xkZXJzXG4gICAgICAgIGNvbnN0IGNvbmZpcm1Nb2RhbCA9IG5ldyBNb2RhbCh0aGlzLmFwcCk7XG4gICAgICAgIGNvbmZpcm1Nb2RhbC50aXRsZUVsLnNldFRleHQoXCJDbGVhciBFbXB0eSBDb250ZW50XCIpO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb25maXJtTW9kYWwuY29udGVudEVsO1xuICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgICAgICAgIHRleHQ6IGBcdTI2QTBcdUZFMEYgV0FSTklORzogVGhlIGZvbGxvd2luZyBlbXB0eSBpdGVtcyB3aWxsIGJlIG1vdmVkIHRvIHRoZSBPYnNpZGlhbiB0cmFzaC4gWW91IGNhbiByZXN0b3JlIHRoZW0gZnJvbSB0aGUgdHJhc2ggaWYgbmVlZGVkLmAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNob3cgZW1wdHkgZmlsZXNcbiAgICAgICAgaWYgKGVtcHR5RmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1oZWFkZXJcIixcbiAgICAgICAgICAgIHRleHQ6IFwiRW1wdHkgRmlsZXNcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHRoaXMuc2hvd0ZpbGVQcmV2aWV3KGVtcHR5RmlsZXMsIFwiRW1wdHkgRmlsZXNcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyBlbXB0eSBmb2xkZXJzXG4gICAgICAgIGlmIChlbXB0eUZvbGRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1oZWFkZXJcIixcbiAgICAgICAgICAgIHRleHQ6IFwiRW1wdHkgRm9sZGVyc1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGZvbGRlckxpc3QgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtdHJlZSBuYXYtZm9sZGVyXCIsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBlbXB0eUZvbGRlcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlckl0ZW0gPSBmb2xkZXJMaXN0LmNyZWF0ZURpdih7XG4gICAgICAgICAgICAgIGNsczogXCJuYXYtZm9sZGVyLXRpdGxlXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNldEljb24oZm9sZGVySXRlbSwgXCJmb2xkZXJcIik7XG4gICAgICAgICAgICBmb2xkZXJJdGVtLmNyZWF0ZVNwYW4oeyB0ZXh0OiBmb2xkZXIucGF0aCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgYnV0dG9uc1xuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1idXR0b25zXCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY29uZmlybU1vZGFsLmNsb3NlKCkpO1xuXG4gICAgICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICAgIGNsczogXCJtb2Qtd2FybmluZ1wiLFxuICAgICAgICAgIHRleHQ6IFwiTW92ZSB0byBUcmFzaFwiLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIERlbGV0ZSBlbXB0eSBmaWxlcyBmaXJzdFxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGVtcHR5RmlsZXMpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZmlsZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRoZW4gZGVsZXRlIGVtcHR5IGZvbGRlcnMgKGRlZXBlc3QgZmlyc3QpXG4gICAgICAgICAgICBjb25zdCBzb3J0ZWRGb2xkZXJzID0gZW1wdHlGb2xkZXJzLnNvcnQoXG4gICAgICAgICAgICAgIChhLCBiKSA9PiBiLnBhdGgubGVuZ3RoIC0gYS5wYXRoLmxlbmd0aFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIHNvcnRlZEZvbGRlcnMpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZm9sZGVyLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKGNsZWFyRW1wdHlCdXR0b24pO1xuICAgICAgICAgICAgY2xlYXJFbXB0eUJ1dHRvbi5zZXRUZXh0KFwiTm8gRW1wdHkgQ29udGVudFwiKTtcblxuICAgICAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgYFN1Y2Nlc3NmdWxseSBtb3ZlZCAke3RvdGFsRW1wdHl9IGVtcHR5IGl0ZW1zIHRvIHRyYXNoYCxcbiAgICAgICAgICAgICAgeyB0aXRsZTogXCJTdWNjZXNzXCIgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNsZWFyaW5nIGVtcHR5IGNvbnRlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gY2xlYXIgZW1wdHkgY29udGVudFwiLCB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uZmlybU1vZGFsLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNoYXRIaXN0b3J5U2VjdGlvbihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgaGlzdG9yeVNlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkNoYXQgSGlzdG9yeVwiLFxuICAgICAgXCJEZWxldGUgYWxsIGNoYXQgaGlzdG9yeSBhbmQgY29udmVyc2F0aW9ucyBwZXJtYW5lbnRseVwiXG4gICAgKTtcblxuICAgIGNvbnN0IGNoYXRGaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5XG4gICAgKTtcbiAgICBjb25zdCBjaGF0U2l6ZSA9IHRoaXMuY2FsY3VsYXRlU2l6ZShjaGF0RmlsZXMpO1xuICAgIGNvbnN0IGhhc0NoYXRGaWxlcyA9IGNoYXRGaWxlcy5sZW5ndGggPiAwO1xuXG4gICAgY29uc3QgY2xlYXJIaXN0b3J5QnV0dG9uID0gaGlzdG9yeVNlY3Rpb24uY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIHRleHQ6IGhhc0NoYXRGaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgQ2hhdCBIaXN0b3J5ICgke2NoYXRTaXplfSlgXG4gICAgICAgIDogXCJObyBDaGF0IEhpc3RvcnlcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoY2xlYXJIaXN0b3J5QnV0dG9uLCBjaGF0RmlsZXMsIFwiQ2hhdCBIaXN0b3J5XCIpO1xuXG4gICAgaWYgKGhhc0NoYXRGaWxlcykge1xuICAgICAgY2xlYXJIaXN0b3J5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChjbGVhckhpc3RvcnlCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgYXdhaXQgdGhpcy5zaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgICAgICAgIGNoYXRGaWxlcyxcbiAgICAgICAgICBcIkNoYXQgSGlzdG9yeVwiLFxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5LFxuICAgICAgICAgIGNsZWFySGlzdG9yeUJ1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFeHRyYWN0aW9uc1NlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGV4dHJhY3Rpb25zU2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiRG9jdW1lbnQgRXh0cmFjdGlvbnNcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBleHRyYWN0ZWQgZG9jdW1lbnQgY29udGVudCAoUERGcywgZG9jdW1lbnRzLCBldGMuKVwiXG4gICAgKTtcblxuICAgIGNvbnN0IGV4dHJhY3Rpb25GaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4dHJhY3Rpb25zRGlyZWN0b3J5XG4gICAgKTtcbiAgICBjb25zdCBleHRyYWN0aW9uc1NpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoZXh0cmFjdGlvbkZpbGVzKTtcbiAgICBjb25zdCBoYXNFeHRyYWN0aW9uRmlsZXMgPSBleHRyYWN0aW9uRmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFyRXh0cmFjdGlvbnNCdXR0b24gPSBleHRyYWN0aW9uc1NlY3Rpb24uY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICAgIHRleHQ6IGhhc0V4dHJhY3Rpb25GaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgRXh0cmFjdGlvbnMgKCR7ZXh0cmFjdGlvbnNTaXplfSlgXG4gICAgICAgIDogXCJObyBFeHRyYWN0aW9uc1wiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShcbiAgICAgIGNsZWFyRXh0cmFjdGlvbnNCdXR0b24sXG4gICAgICBleHRyYWN0aW9uRmlsZXMsXG4gICAgICBcIkV4dHJhY3Rpb25zXCJcbiAgICApO1xuXG4gICAgaWYgKGhhc0V4dHJhY3Rpb25GaWxlcykge1xuICAgICAgY2xlYXJFeHRyYWN0aW9uc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJFeHRyYWN0aW9uc0J1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuICAgICAgICBhd2FpdCB0aGlzLnNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgICAgICAgZXh0cmFjdGlvbkZpbGVzLFxuICAgICAgICAgIFwiRXh0cmFjdGlvbnNcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHRyYWN0aW9uc0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhckV4dHJhY3Rpb25zQnV0dG9uXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVJlY29yZGluZ3NTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWNvcmRpbmdzU2VjdGlvbiA9IHRoaXMuY3JlYXRlU2VjdGlvbihcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIFwiQXVkaW8gUmVjb3JkaW5nc1wiLFxuICAgICAgXCJEZWxldGUgYWxsIGF1ZGlvIHJlY29yZGluZ3MgKHRoaXMgd29uJ3QgYWZmZWN0IHRyYW5zY3JpcHRpb25zKVwiXG4gICAgKTtcblxuICAgIGNvbnN0IHJlY29yZGluZ0ZpbGVzID0gdGhpcy5nZXRGaWxlc0luRGlyZWN0b3J5KFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgcmVjb3JkaW5nc1NpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUocmVjb3JkaW5nRmlsZXMpO1xuICAgIGNvbnN0IGhhc1JlY29yZGluZ0ZpbGVzID0gcmVjb3JkaW5nRmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFyUmVjb3JkaW5nc0J1dHRvbiA9IHJlY29yZGluZ3NTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNSZWNvcmRpbmdGaWxlc1xuICAgICAgICA/IGBDbGVhciBBbGwgUmVjb3JkaW5ncyAoJHtyZWNvcmRpbmdzU2l6ZX0pYFxuICAgICAgICA6IFwiTm8gUmVjb3JkaW5nc1wiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShjbGVhclJlY29yZGluZ3NCdXR0b24sIHJlY29yZGluZ0ZpbGVzLCBcIlJlY29yZGluZ3NcIik7XG5cbiAgICBpZiAoaGFzUmVjb3JkaW5nRmlsZXMpIHtcbiAgICAgIGNsZWFyUmVjb3JkaW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJSZWNvcmRpbmdzQnV0dG9uLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIGF3YWl0IHRoaXMuc2hvd0NvbmZpcm1hdGlvbkRpYWxvZyhcbiAgICAgICAgICByZWNvcmRpbmdGaWxlcyxcbiAgICAgICAgICBcIlJlY29yZGluZ3NcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWNvcmRpbmdzRGlyZWN0b3J5LFxuICAgICAgICAgIGNsZWFyUmVjb3JkaW5nc0J1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTZWN0aW9uKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gICk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBzZWN0aW9uID0gY29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWphbml0b3Itc2VjdGlvblwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgaGVhZGVyID0gc2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIgfSk7XG4gICAgaGVhZGVyLnNldFRleHQodGl0bGUpO1xuXG4gICAgY29uc3QgZGVzYyA9IHNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWRlc2NyaXB0aW9uXCIgfSk7XG4gICAgZGVzYy5zZXRUZXh0KGRlc2NyaXB0aW9uKTtcblxuICAgIHJldHVybiBzZWN0aW9uO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IEphbml0b3JNb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvSmFuaXRvck1vZGFsXCI7XG5pbXBvcnQgeyBMb2FkQ2hhdE1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Mb2FkQ2hhdE1vZGFsXCI7XG5cbmV4cG9ydCBjbGFzcyBSaWJib25NYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgYXBwOiBBcHApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSByaWJib24gbWFuYWdlciBhbmQgcmVnaXN0ZXIgYWxsIHJpYmJvbiBpY29uc1xuICAgKi9cbiAgaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyUmliYm9uSWNvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhbGwgcmliYm9uIGljb25zIGluIHRoZSBjb3JyZWN0IG9yZGVyOlxuICAgKiAxLiBTeXN0ZW1TY3VscHQgQ2hhdFxuICAgKiAyLiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XG4gICAqIDMuIFN5c3RlbVNjdWxwdCBKYW5pdG9yXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyUmliYm9uSWNvbnMoKSB7XG4gICAgLy8gMS4gU3lzdGVtU2N1bHB0IENoYXRcbiAgICB0aGlzLnBsdWdpbi5hZGRSaWJib25JY29uKFxuICAgICAgXCJtZXNzYWdlLXNxdWFyZVwiLFxuICAgICAgXCJPcGVuIFN5c3RlbVNjdWxwdCBDaGF0XCIsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMub3BlbkNoYXRWaWV3KCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIDIuIENoYXQgSGlzdG9yeVxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXG4gICAgICBcImhpc3RvcnlcIixcbiAgICAgIFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMub3BlbkNoYXRIaXN0b3J5TW9kYWwoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gMy4gSmFuaXRvclxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXCJ0cmFzaFwiLCBcIk9wZW4gU3lzdGVtU2N1bHB0IEphbml0b3JcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vcGVuSmFuaXRvck1vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogT3BlbiBhIG5ldyBTeXN0ZW1TY3VscHQgQ2hhdCB2aWV3IGluIGEgbmV3IHRhYlxuICAgKi9cbiAgcHVibGljIGFzeW5jIG9wZW5DaGF0VmlldygpIHtcbiAgICBjb25zdCB7IHdvcmtzcGFjZSB9ID0gdGhpcy5hcHA7XG4gICAgY29uc3QgbGVhZiA9IHdvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICB3b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBDaGF0IEhpc3RvcnkgbW9kYWxcbiAgICovXG4gIHB1YmxpYyBvcGVuQ2hhdEhpc3RvcnlNb2RhbCgpIHtcbiAgICBjb25zdCBtb2RhbCA9IG5ldyBMb2FkQ2hhdE1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICBhc3luYyAoY2hhdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICAgICAgY29uc3QgdmlldyA9IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbik7XG4gICAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgICAgYXdhaXQgdmlldy5sb2FkQ2hhdEJ5SWQoY2hhdElkKTtcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcbiAgICAgIH0sXG4gICAgICB0aGlzLnBsdWdpblxuICAgICk7XG4gICAgbW9kYWwub3BlbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBKYW5pdG9yIG1vZGFsXG4gICAqL1xuICBwdWJsaWMgb3Blbkphbml0b3JNb2RhbCgpIHtcbiAgICBuZXcgSmFuaXRvck1vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbikub3BlbigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBDaGF0VmlldywgQ0hBVF9WSUVXX1RZUEUgfSBmcm9tIFwiLi4vLi4vdmlld3MvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IFJpYmJvbk1hbmFnZXIgfSBmcm9tIFwiLi9yaWJib25zXCI7XG5cbmV4cG9ydCBjbGFzcyBWaWV3TWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgcmliYm9uTWFuYWdlcjogUmliYm9uTWFuYWdlcjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgYXBwOiBBcHApIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLnJpYmJvbk1hbmFnZXIgPSBuZXcgUmliYm9uTWFuYWdlcihwbHVnaW4sIGFwcCk7XG4gIH1cblxuICBpbml0aWFsaXplKCkge1xuICAgIHRoaXMucmVnaXN0ZXJWaWV3KCk7XG4gICAgdGhpcy5yaWJib25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XG4gICAgICB0aGlzLnJlc3RvcmVDaGF0Vmlld3MoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHJlc3RvcmVDaGF0Vmlld3MoKSB7XG4gICAgY29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShDSEFUX1ZJRVdfVFlQRSk7XG5cbiAgICBpZiAobGVhdmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xuICAgICAgY29uc3QgdmlldyA9IGxlYWYudmlldyBhcyBDaGF0VmlldztcbiAgICAgIGNvbnN0IHN0YXRlID0gbGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5zdGF0ZSAmJiBzdGF0ZS5zdGF0ZS5jaGF0SWQpIHtcbiAgICAgICAgYXdhaXQgdmlldy5zZXRTdGF0ZShzdGF0ZS5zdGF0ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJWaWV3KCkge1xuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyVmlldyhcbiAgICAgIENIQVRfVklFV19UWVBFLFxuICAgICAgKGxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbilcbiAgICApO1xuICB9XG5cbiAgdW5sb2FkVmlld3MoKSB7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZShDSEFUX1ZJRVdfVFlQRSk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldyB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vLi4vbWFpblwiO1xuaW1wb3J0IHsgUmliYm9uTWFuYWdlciB9IGZyb20gXCIuL3JpYmJvbnNcIjtcbmltcG9ydCB7IENoYXRWaWV3IH0gZnJvbSBcIi4uLy4uL3ZpZXdzL0NoYXRWaWV3XCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuXG5leHBvcnQgY2xhc3MgQ29tbWFuZE1hbmFnZXIge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIHJpYmJvbk1hbmFnZXI6IFJpYmJvbk1hbmFnZXI7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5yaWJib25NYW5hZ2VyID0gbmV3IFJpYmJvbk1hbmFnZXIocGx1Z2luLCBhcHApO1xuICB9XG5cbiAgcmVnaXN0ZXJDb21tYW5kcygpIHtcbiAgICB0aGlzLnJlZ2lzdGVyT3BlblRhc2tzRmlsZSgpO1xuICAgIHRoaXMucmVnaXN0ZXJUb2dnbGVBdWRpb1JlY29yZGVyKCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5DaGF0KCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5DaGF0SGlzdG9yeSgpO1xuICAgIHRoaXMucmVnaXN0ZXJPcGVuSmFuaXRvcigpO1xuICAgIHRoaXMucmVnaXN0ZXJSZWxvYWRPYnNpZGlhbigpO1xuICAgIHRoaXMucmVnaXN0ZXJPcGVuU2V0dGluZ3MoKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ2hhbmdlQ2hhdE1vZGVsKCk7XG4gICAgdGhpcy5yZWdpc3RlckNoYXRXaXRoRmlsZSgpO1xuICAgIHRoaXMucmVnaXN0ZXJUYXNrTW92ZW1lbnRDb21tYW5kcygpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9wZW5UYXNrc0ZpbGUoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLXRhc2tzLWZpbGVcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBUYXNrcyBGaWxlXCIsXG4gICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi50YXNrc1NlcnZpY2Uub3Blbk9yQ3JlYXRlVGFza3NGaWxlKCk7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIl0sIGtleTogXCJ0XCIgfV0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyVG9nZ2xlQXVkaW9SZWNvcmRlcigpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcInRvZ2dsZS1hdWRpby1yZWNvcmRlclwiLFxuICAgICAgbmFtZTogXCJUb2dnbGUgQXVkaW8gUmVjb3JkZXJcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucGx1Z2luLmdldFJlY29yZGVyU2VydmljZSgpLnRvZ2dsZVJlY29yZGluZygpO1xuICAgICAgfSxcbiAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiTW9kXCJdLCBrZXk6IFwiclwiIH1dLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9wZW5DaGF0KCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwib3Blbi1zeXN0ZW1zY3VscHQtY2hhdFwiLFxuICAgICAgbmFtZTogXCJPcGVuIFN5c3RlbVNjdWxwdCBDaGF0XCIsXG4gICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnJpYmJvbk1hbmFnZXIub3BlbkNoYXRWaWV3KCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9wZW5DaGF0SGlzdG9yeSgpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tY2hhdC1oaXN0b3J5XCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IENoYXQgSGlzdG9yeVwiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5yaWJib25NYW5hZ2VyLm9wZW5DaGF0SGlzdG9yeU1vZGFsKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9wZW5KYW5pdG9yKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwib3Blbi1zeXN0ZW1zY3VscHQtamFuaXRvclwiLFxuICAgICAgbmFtZTogXCJPcGVuIFN5c3RlbVNjdWxwdCBKYW5pdG9yXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICB0aGlzLnJpYmJvbk1hbmFnZXIub3Blbkphbml0b3JNb2RhbCgpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJSZWxvYWRPYnNpZGlhbigpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcInJlbG9hZC1vYnNpZGlhblwiLFxuICAgICAgbmFtZTogXCJSZWxvYWQgT2JzaWRpYW5cIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyT3BlblNldHRpbmdzKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwib3Blbi1zeXN0ZW1zY3VscHQtc2V0dGluZ3NcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBTeXN0ZW1TY3VscHQgQUkgU2V0dGluZ3NcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgXHUyMDEzIHRoaXMgaXMgYSBrbm93biBPYnNpZGlhbiBBUEkgYnVnXG4gICAgICAgIHRoaXMuYXBwLnNldHRpbmcub3BlbigpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHRoaXMuYXBwLnNldHRpbmcub3BlblRhYkJ5SWQodGhpcy5wbHVnaW4ubWFuaWZlc3QuaWQpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFuZ2VDaGF0TW9kZWwoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjaGFuZ2UtY2hhdC1tb2RlbFwiLFxuICAgICAgbmFtZTogXCJDaGFuZ2UgQ2hhdCBNb2RlbFwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGNoYXRWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoQ2hhdFZpZXcpO1xuICAgICAgICBpZiAoIWNoYXRWaWV3KSB7XG4gICAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFxuICAgICAgICAgICAgICBcIllvdSBuZWVkIHRvIGJlIHdpdGhpbiBhIFN5c3RlbVNjdWxwdCBjaGF0dmlldyB0byBjaGFuZ2UgdGhlIG1vZGVsLlwiLFxuICAgICAgICAgICAgICBcIndhcm5pbmdcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgIGNoYXRWaWV3LmdldFNlbGVjdGVkTW9kZWxJZCgpLFxuICAgICAgICAgICAgICAgIGFzeW5jIChtb2RlbElkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBhd2FpdCBjaGF0Vmlldy5zZXRTZWxlY3RlZE1vZGVsSWQobW9kZWxJZCk7XG4gICAgICAgICAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJNb2RlbCBjaGFuZ2VkIHN1Y2Nlc3NmdWxseVwiLCBcImluZm9cIik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBvcGVuIG1vZGVsIHNlbGVjdGlvbjpcIiwgZXJyKTtcbiAgICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGF0V2l0aEZpbGUoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjaGF0LXdpdGgtZmlsZVwiLFxuICAgICAgbmFtZTogXCJDaGF0IHdpdGggRmlsZVwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICAgICAgICBpZiAoIWFjdGl2ZUZpbGUpIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gYWN0aXZlRmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3Qgc3VwcG9ydGVkRXh0ZW5zaW9ucyA9IFtcbiAgICAgICAgICBcIm1kXCIsXG4gICAgICAgICAgXCJ0eHRcIixcbiAgICAgICAgICBcIm1hcmtkb3duXCIsXG4gICAgICAgICAgXCJwZGZcIixcbiAgICAgICAgICBcImRvY1wiLFxuICAgICAgICAgIFwiZG9jeFwiLFxuICAgICAgICAgIFwicHB0XCIsXG4gICAgICAgICAgXCJwcHR4XCIsXG4gICAgICAgICAgXCJ4bHNcIixcbiAgICAgICAgICBcInhsc3hcIixcbiAgICAgICAgICBcIm1wM1wiLFxuICAgICAgICAgIFwid2F2XCIsXG4gICAgICAgICAgXCJtNGFcIixcbiAgICAgICAgICBcIm9nZ1wiLFxuICAgICAgICAgIFwid2VibVwiLFxuICAgICAgICAgIFwianBnXCIsXG4gICAgICAgICAgXCJqcGVnXCIsXG4gICAgICAgICAgXCJwbmdcIixcbiAgICAgICAgICBcImdpZlwiLFxuICAgICAgICAgIFwid2VicFwiLFxuICAgICAgICAgIFwic3ZnXCIsXG4gICAgICAgIF07XG4gICAgICAgIGlmICghc3VwcG9ydGVkRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoXCJ0YWJcIik7XG4gICAgICAgICAgY29uc3QgdmlldyA9IG5ldyBDaGF0VmlldyhsZWFmLCB0aGlzLnBsdWdpbik7XG4gICAgICAgICAgbGVhZi5vcGVuKHZpZXcpLnRoZW4oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgICAgICBhd2FpdCB2aWV3LmFkZEZpbGVUb0NvbnRleHQoYWN0aXZlRmlsZSk7XG4gICAgICAgICAgICB2aWV3LmZvY3VzSW5wdXQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYWxsIHRhc2sgbW92ZW1lbnQgcmVsYXRlZCBjb21tYW5kc1xuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RlclRhc2tNb3ZlbWVudENvbW1hbmRzKCkge1xuICAgIC8vIE1vdmUgdGFzayB1cFxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwibW92ZS10YXNrLXVwXCIsXG4gICAgICBuYW1lOiBcIk1vdmUgVGFzayBVcFwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZpbGUgPSBhY3RpdmVWaWV3LmZpbGU7XG4gICAgICAgIGlmICghZmlsZSB8fCAhdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLmlzVGFza3NGaWxlKGZpbGUucGF0aCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLm1vdmVUYXNrVXAoYWN0aXZlVmlldy5lZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiTW9kXCIsIFwiU2hpZnRcIl0sIGtleTogXCJBcnJvd1VwXCIgfV1cbiAgICB9KTtcblxuICAgIC8vIE1vdmUgdGFzayBkb3duXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJtb3ZlLXRhc2stZG93blwiLFxuICAgICAgbmFtZTogXCJNb3ZlIFRhc2sgRG93blwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZpbGUgPSBhY3RpdmVWaWV3LmZpbGU7XG4gICAgICAgIGlmICghZmlsZSB8fCAhdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLmlzVGFza3NGaWxlKGZpbGUucGF0aCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLm1vdmVUYXNrRG93bihhY3RpdmVWaWV3LmVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIiwgXCJTaGlmdFwiXSwga2V5OiBcIkFycm93RG93blwiIH1dXG4gICAgfSk7XG5cbiAgICAvLyBJbmRlbnQgdGFzayByaWdodFxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiaW5kZW50LXRhc2stcmlnaHRcIixcbiAgICAgIG5hbWU6IFwiSW5kZW50IFRhc2sgUmlnaHRcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaWxlID0gYWN0aXZlVmlldy5maWxlO1xuICAgICAgICBpZiAoIWZpbGUgfHwgIXRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5pc1Rhc2tzRmlsZShmaWxlLnBhdGgpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5pbmRlbnRUYXNrUmlnaHQoYWN0aXZlVmlldy5lZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiTW9kXCIsIFwiU2hpZnRcIl0sIGtleTogXCJBcnJvd1JpZ2h0XCIgfV1cbiAgICB9KTtcblxuICAgIC8vIEluZGVudCB0YXNrIGxlZnRcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImluZGVudC10YXNrLWxlZnRcIixcbiAgICAgIG5hbWU6IFwiSW5kZW50IFRhc2sgTGVmdFwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZpbGUgPSBhY3RpdmVWaWV3LmZpbGU7XG4gICAgICAgIGlmICghZmlsZSB8fCAhdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLmlzVGFza3NGaWxlKGZpbGUucGF0aCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLmluZGVudFRhc2tMZWZ0KGFjdGl2ZVZpZXcuZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICBob3RrZXlzOiBbeyBtb2RpZmllcnM6IFtcIk1vZFwiLCBcIlNoaWZ0XCJdLCBrZXk6IFwiQXJyb3dMZWZ0XCIgfV1cbiAgICB9KTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEN1c3RvbVByb3ZpZGVyIH0gZnJvbSBcInNyYy90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcInNyYy9tYWluXCI7XG5cbmludGVyZmFjZSBUZXN0Q29ubmVjdGlvblJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yPzogc3RyaW5nO1xuICBtb2RlbHM/OiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBPcGVuUm91dGVyTW9kZWwge1xuICBpZDogc3RyaW5nO1xuICBwcmljaW5nOiB7XG4gICAgcHJvbXB0OiBzdHJpbmc7XG4gICAgY29tcGxldGlvbjogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgc3RhdGljIGNvbm5lY3Rpb25UZXN0Q2FjaGU6IE1hcDxcbiAgICBzdHJpbmcsXG4gICAge1xuICAgICAgcmVzdWx0OiBUZXN0Q29ubmVjdGlvblJlc3VsdDtcbiAgICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICAgIH1cbiAgPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBzdGF0aWMgY29ubmVjdGlvblRlc3RQcm9taXNlczogTWFwPFxuICAgIHN0cmluZyxcbiAgICBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PlxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IENBQ0hFX0RVUkFUSU9OID0gMzAgKiA2MCAqIDEwMDA7IC8vIDMwIG1pbnV0ZXNcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IGNvbm5lY3Rpb24gdG8gYSBwcm92aWRlciBieSBhdHRlbXB0aW5nIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcbiAgICogRm9yIE9wZW5Sb3V0ZXIsIHdlIGFsc28gdmFsaWRhdGUgdGhlIEFQSSBrZXkgYnkgbWFraW5nIGEgbWluaW1hbCBjb21wbGV0aW9uIHJlcXVlc3RcbiAgICovXG4gIGFzeW5jIHRlc3RDb25uZWN0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlclxuICApOiBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PiB7XG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RDYWNoZS5nZXQocHJvdmlkZXIuaWQpO1xuICAgIGlmIChjYWNoZWQgJiYgRGF0ZS5ub3coKSAtIGNhY2hlZC5yZXN1bHQudGltZXN0YW1wIDwgdGhpcy5DQUNIRV9EVVJBVElPTikge1xuICAgICAgcmV0dXJuIGNhY2hlZC5yZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSB0ZXN0aW5nIHRoaXMgcHJvdmlkZXJcbiAgICBjb25zdCBleGlzdGluZ1Byb21pc2UgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5nZXQoXG4gICAgICBwcm92aWRlci5pZFxuICAgICk7XG4gICAgaWYgKGV4aXN0aW5nUHJvbWlzZSkge1xuICAgICAgcmV0dXJuIGV4aXN0aW5nUHJvbWlzZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBuZXcgdGVzdFxuICAgIGNvbnN0IHRlc3RQcm9taXNlID0gdGhpcy5wZXJmb3JtQ29ubmVjdGlvblRlc3QocHJvdmlkZXIpO1xuICAgIEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdFByb21pc2VzLnNldChwcm92aWRlci5pZCwgdGVzdFByb21pc2UpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RQcm9taXNlO1xuICAgICAgLy8gQ2FjaGUgc3VjY2Vzc2Z1bCByZXN1bHRzXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlLmNvbm5lY3Rpb25UZXN0Q2FjaGUuc2V0KHByb3ZpZGVyLmlkLCB7XG4gICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5kZWxldGUocHJvdmlkZXIuaWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gYWN0dWFsbHkgcGVyZm9ybSB0aGUgY29ubmVjdGlvbiB0ZXN0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1Db25uZWN0aW9uVGVzdChcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXJcbiAgKTogUHJvbWlzZTxUZXN0Q29ubmVjdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLmdldE1vZGVscyhwcm92aWRlcik7XG5cbiAgICAgIC8vIEZvciBPcGVuUm91dGVyLCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBBUEkga2V5IGJ5IG1ha2luZyBhIHRlc3QgY29tcGxldGlvblxuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnZhbGlkYXRlT3BlblJvdXRlcktleShwcm92aWRlciwgbW9kZWxzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbW9kZWxzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIkNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6XCIsIGVycm9yKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB0aGlzLmdldEVycm9yTWVzc2FnZShlcnJvciksXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIE9wZW5Sb3V0ZXIgQVBJIGtleSBieSBtYWtpbmcgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZU9wZW5Sb3V0ZXJLZXkoXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyLFxuICAgIG1vZGVsSWRzOiBzdHJpbmdbXVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cHJvdmlkZXIuYXBpS2V5fWAsXG4gICAgICBcIkhUVFAtUmVmZXJlclwiOiBcImh0dHBzOi8vc3lzdGVtc2N1bHB0LmNvbVwiLFxuICAgICAgXCJYLVRpdGxlXCI6IFwiU3lzdGVtU2N1bHB0IEFJXCIsXG4gICAgfTtcblxuICAgIC8vIE1ha2UgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdCB3aXRoIHRoZSBmcmVlIG1vZGVsXG4gICAgY29uc3QgY29tcGxldGlvblJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6IFwibWV0YS1sbGFtYS9sbGFtYS0zLThiLWluc3RydWN0OmZyZWVcIixcbiAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IFwiSGlcIiB9XSxcbiAgICAgICAgICBtYXhfdG9rZW5zOiAxLFxuICAgICAgICB9KSxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDEwMDAwKSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFjb21wbGV0aW9uUmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IGNvbXBsZXRpb25SZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkludmFsaWQgQVBJIGtleS4gUGxlYXNlIGNoZWNrIHlvdXIgT3BlblJvdXRlciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkluc3VmZmljaWVudCBjcmVkaXRzLiBQbGVhc2UgYWRkIGNyZWRpdHMgdG8geW91ciBPcGVuUm91dGVyIGFjY291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlJhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gaW4gYSBmZXcgbWludXRlcy5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQVBJIGtleSB2YWxpZGF0aW9uIGZhaWxlZDogJHtcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgY29tcGxldGlvblJlc3BvbnNlLnN0YXR1c1RleHRcbiAgICAgICAgfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSBhIHByb3ZpZGVyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldE1vZGVscyhwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH07XG5cbiAgICAvLyBBZGQgQVBJIGtleSBpZiBwcmVzZW50XG4gICAgaWYgKHByb3ZpZGVyLmFwaUtleSkge1xuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgICAgaGVhZGVyc1tcIkhUVFAtUmVmZXJlclwiXSA9IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCI7IC8vIFJlcXVpcmVkIGJ5IE9wZW5Sb3V0ZXJcbiAgICAgICAgaGVhZGVyc1tcIlgtVGl0bGVcIl0gPSBcIlN5c3RlbVNjdWxwdCBBSVwiOyAvLyBSZXF1aXJlZCBieSBPcGVuUm91dGVyXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEaWZmZXJlbnQgZW5kcG9pbnRzIGJhc2VkIG9uIHByb3ZpZGVyIHR5cGUgYW5kIFVSTFxuICAgIGxldCBlbmRwb2ludDogc3RyaW5nO1xuICAgIGlmIChwcm92aWRlci5lbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIikpIHtcbiAgICAgIGVuZHBvaW50ID0gXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL21vZGVsc1wiOyAvLyBPcGVuUm91dGVyIGhhcyBhIHNwZWNpZmljIG1vZGVscyBlbmRwb2ludFxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3IgT3BlbkFJLWNvbXBhdGlibGUgZW5kcG9pbnRzLCBlbnN1cmUgd2UncmUgdXNpbmcgdGhlIC92MS9tb2RlbHMgcGF0aFxuICAgICAgY29uc3QgYmFzZVVybCA9IHByb3ZpZGVyLmVuZHBvaW50LnJlcGxhY2UoL1xcLyskLywgXCJcIik7IC8vIFJlbW92ZSB0cmFpbGluZyBzbGFzaGVzXG4gICAgICBlbmRwb2ludCA9IGJhc2VVcmwuZW5kc1dpdGgoXCIvdjFcIilcbiAgICAgICAgPyBgJHtiYXNlVXJsfS9tb2RlbHNgXG4gICAgICAgIDogYmFzZVVybC5lbmRzV2l0aChcIi92MS9tb2RlbHNcIilcbiAgICAgICAgPyBiYXNlVXJsXG4gICAgICAgIDogYCR7YmFzZVVybH0vdjEvbW9kZWxzYDtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgLy8gQWRkIHRpbWVvdXRcbiAgICAgIHNpZ25hbDogQWJvcnRTaWduYWwudGltZW91dCgxMDAwMCksIC8vIDEwIHNlY29uZCB0aW1lb3V0XG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBBUEkga2V5LiBQbGVhc2UgY2hlY2sgeW91ciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQWNjZXNzIGRlbmllZC4gUGxlYXNlIHZlcmlmeSB5b3VyIEFQSSBrZXkgaGFzIHRoZSBjb3JyZWN0IHBlcm1pc3Npb25zLlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkFQSSBlbmRwb2ludCBub3QgZm91bmQuIFBsZWFzZSBjaGVjayB0aGUgVVJMIGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEhUVFAgZXJyb3I6ICR7ZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgLy8gQWxsIHByb3ZpZGVycyB1c2UgT3BlbkFJIGZvcm1hdDogeyBkYXRhOiBbeyBpZDogc3RyaW5nLCAuLi4gfV0gfVxuICAgIHJldHVybiAoZGF0YS5kYXRhPy5tYXAoKG1vZGVsOiBhbnkpID0+IG1vZGVsLmlkKSB8fCBbXSkuZmlsdGVyKFxuICAgICAgKGlkOiBzdHJpbmcpID0+ICFpZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwid2hpc3BlclwiKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgdXNlci1mcmllbmRseSBlcnJvciBtZXNzYWdlIGZyb20gYW4gZXJyb3Igb2JqZWN0XG4gICAqL1xuICBwcml2YXRlIGdldEVycm9yTWVzc2FnZShlcnJvcjogYW55KTogc3RyaW5nIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgaWYgKGVycm9yLm5hbWUgPT09IFwiQWJvcnRFcnJvclwiKSB7XG4gICAgICAgIHJldHVybiBcIkNvbm5lY3Rpb24gdGltZWQgb3V0LiBQbGVhc2UgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCB0cnkgYWdhaW4uXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiB0aGUgZXJyb3IgbWVzc2FnZSBkaXJlY3RseSBzaW5jZSB3ZSd2ZSBhbHJlYWR5IG1hZGUgaXQgdXNlci1mcmllbmRseVxuICAgICAgLy8gaW4gdmFsaWRhdGVPcGVuUm91dGVyS2V5IGFuZCBnZXRNb2RlbHMgbWV0aG9kc1xuICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQgaWYgdGhlIGlzc3VlIHBlcnNpc3RzLlwiO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgTWFya2Rvd25WaWV3LCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgRWRpdG9yIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBUYXNrc1NlcnZpY2Uge1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcbiAgcHJpdmF0ZSB0YXNrVG9nZ2xlU3RhdGVzOiBNYXA8c3RyaW5nLCBib29sZWFuPiA9IG5ldyBNYXAoKTtcblxuICBwcml2YXRlIGxhc3RUYXNrRmlsZVJlb3JkZXI6IG51bWJlcjtcbiAgcHJpdmF0ZSByZW9yZGVyRGVib3VuY2U6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICAvLyBJbml0aWFsaXplIGFwcCBhbmQgc2V0dGluZ3MgZmlyc3RcbiAgICB0aGlzLmFwcCA9IHBsdWdpbi5hcHA7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHBsdWdpbi5zZXR0aW5ncztcblxuICAgIC8vIFRyYWNrIGxhc3QgcmVvcmRlciB0byBwcmV2ZW50IGltbWVkaWF0ZSByZS1lZGl0cyBjYXVzaW5nIGluZmluaXRlIGxvb3BzOlxuICAgIHRoaXMubGFzdFRhc2tGaWxlUmVvcmRlciA9IDA7XG4gICAgdGhpcy5yZW9yZGVyRGVib3VuY2UgPSAwOyAvLyBObyBkZWxheSAtIHByb2Nlc3MgaW1tZWRpYXRlbHlcblxuICAgIC8vIFJlZ2lzdGVyIGV2ZW50IGZvciBkZXRlY3RpbmcgY2hhbmdlcyB0byB0aGUgdGFza3MgZmlsZTpcbiAgICB0aGlzLnJlZ2lzdGVyVGFza3NGaWxlV2F0Y2hlcigpO1xuICAgIFxuICAgIC8vIFJlZ2lzdGVyIHdvcmtzcGFjZSBldmVudHMgZm9yIGhhbmRsaW5nIExpdmUgUHJldmlld1xuICAgIHRoaXMucmVnaXN0ZXJXb3Jrc3BhY2VFdmVudHMoKTtcblxuICAgIC8vIFJlZ2lzdGVyIG1ldGFkYXRhIGNoYW5nZXMgdG8gc3luYyBoaWRlQ29tcGxldGVkIHN0YXRlXG4gICAgdGhpcy5yZWdpc3Rlck1ldGFkYXRhV2F0Y2hlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlcldvcmtzcGFjZUV2ZW50cygpIHtcbiAgICAvLyBIYW5kbGUgYWN0aXZlIGxlYWYgY2hhbmdlc1xuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIChsZWFmKSA9PiB7XG4gICAgICAgIGlmIChsZWFmKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVMZWFmQ2hhbmdlKGxlYWYpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBIYW5kbGUgbGF5b3V0IGNoYW5nZXNcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKCdsYXlvdXQtY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcyhsZWFmID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUxlYWZDaGFuZ2UobGVhZik7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gSGFuZGxlIGZpbGUgY2hhbmdlc1xuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgKGZpbGUpID0+IHtcbiAgICAgICAgaWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKHRoaXMuc2V0dGluZ3MudGFza3NEaXJlY3RvcnkpKSB7XG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLml0ZXJhdGVBbGxMZWF2ZXMobGVhZiA9PiB7XG4gICAgICAgICAgICBpZiAobGVhZi52aWV3IGluc3RhbmNlb2YgTWFya2Rvd25WaWV3ICYmIGxlYWYudmlldy5maWxlPy5wYXRoID09PSBmaWxlLnBhdGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVMZWFmQ2hhbmdlKGxlYWYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZUxlYWZDaGFuZ2UobGVhZjogV29ya3NwYWNlTGVhZikge1xuICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXc7XG4gICAgaWYgKCEodmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykpIHJldHVybjtcbiAgICBcbiAgICBjb25zdCBmaWxlID0gdmlldy5maWxlO1xuICAgIFxuICAgIC8vIFJlbW92ZSBhbnkgZXhpc3RpbmcgdG9nZ2xlcyBmcm9tIGJvdGggZWRpdG9yIGFuZCByZWFkZXIgY29udGFpbmVyc1xuICAgIGNvbnN0IGVkaXRvckNvbnRhaW5lciA9IHZpZXcuY29udGVudEVsLnF1ZXJ5U2VsZWN0b3IoJy5jbS1lZGl0b3InKTtcbiAgICBjb25zdCByZWFkZXJDb250YWluZXIgPSB2aWV3LmNvbnRlbnRFbDtcbiAgICBcbiAgICAvLyBDbGVhbiB1cCB0b2dnbGVzIGZyb20gYm90aCBjb250YWluZXJzIHJlZ2FyZGxlc3Mgb2YgY3VycmVudCB2aWV3IG1vZGVcbiAgICBpZiAoZWRpdG9yQ29udGFpbmVyKSB7XG4gICAgICBlZGl0b3JDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnN5c3RlbXNjdWxwdC10YXNrcy10b2dnbGUnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcbiAgICB9XG4gICAgaWYgKHJlYWRlckNvbnRhaW5lcikge1xuICAgICAgcmVhZGVyQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zeXN0ZW1zY3VscHQtdGFza3MtdG9nZ2xlJykuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7XG4gICAgfVxuXG4gICAgLy8gSWYgbm90IGEgdGFza3MgZmlsZSBvciBubyBmaWxlIGlzIG9wZW4sIHJldHVybiBlYXJseSBhZnRlciBjbGVhbnVwXG4gICAgaWYgKCFmaWxlIHx8ICFmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KSkgcmV0dXJuO1xuXG4gICAgLy8gR2V0IHRoZSBhcHByb3ByaWF0ZSBjb250YWluZXIgYmFzZWQgb24gY3VycmVudCB2aWV3IG1vZGVcbiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gdmlldy5nZXRNb2RlKCkgPT09ICdzb3VyY2UnID8gZWRpdG9yQ29udGFpbmVyIDogcmVhZGVyQ29udGFpbmVyO1xuICAgIGlmICghY29udGVudENvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgLy8gTG9hZCB0aGUgc3RhdGUgZnJvbSBmcm9udG1hdHRlciBmaXJzdFxuICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRDYWNoZShmaWxlLnBhdGgpO1xuICAgIGNvbnN0IGlzSGlkZGVuID0gY2FjaGU/LmZyb250bWF0dGVyPy5oaWRlQ29tcGxldGVkID09PSB0cnVlO1xuICAgIFxuICAgIC8vIFVwZGF0ZSBpbnRlcm5hbCBzdGF0ZSB0byBtYXRjaCBmcm9udG1hdHRlclxuICAgIHRoaXMudGFza1RvZ2dsZVN0YXRlcy5zZXQoZmlsZS5wYXRoLCBpc0hpZGRlbik7XG5cbiAgICAvLyBDcmVhdGUgYW5kIGluc2VydCB0b2dnbGUgYXQgdGhlIHRvcCB3aXRoIHRoZSBjdXJyZW50IHN0YXRlXG4gICAgY29uc3QgdG9nZ2xlQ29udGFpbmVyID0gdGhpcy5jcmVhdGVUb2dnbGVDb250YWluZXIoZmlsZS5wYXRoLCBpc0hpZGRlbik7XG4gICAgY29udGVudENvbnRhaW5lci5pbnNlcnRCZWZvcmUodG9nZ2xlQ29udGFpbmVyLCBjb250ZW50Q29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuXG4gICAgLy8gQXBwbHkgdGhlIHZpc2liaWxpdHlcbiAgICB0aGlzLnVwZGF0ZVRhc2tWaXNpYmlsaXR5KGZpbGUucGF0aCwgaXNIaWRkZW4pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUb2dnbGVDb250YWluZXIoZmlsZVBhdGg6IHN0cmluZywgaW5pdGlhbFN0YXRlOiBib29sZWFuKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IHRvZ2dsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRvZ2dsZUNvbnRhaW5lci5jbGFzc05hbWUgPSAnc3lzdGVtc2N1bHB0LXRhc2tzLXRvZ2dsZSc7XG5cbiAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgY2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7XG4gICAgY2hlY2tib3guY2xhc3NOYW1lID0gJ3Rhc2stdG9nZ2xlLWNoZWNrYm94JztcbiAgICBjaGVja2JveC5jaGVja2VkID0gaW5pdGlhbFN0YXRlO1xuXG4gICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ0hpZGUgY29tcGxldGVkIHRhc2tzJztcbiAgICBsYWJlbC5jbGFzc05hbWUgPSAndGFzay10b2dnbGUtbGFiZWwnO1xuXG4gICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9IChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5jaGVja2VkO1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVUb2dnbGVTdGF0ZShmaWxlUGF0aCwgaXNDaGVja2VkKTtcbiAgICB9KTtcblxuICAgIHRvZ2dsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGVja2JveCk7XG4gICAgdG9nZ2xlQ29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTtcblxuICAgIHJldHVybiB0b2dnbGVDb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyTWV0YWRhdGFXYXRjaGVyKCk6IHZvaWQge1xuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgKGZpbGUpID0+IHtcbiAgICAgICAgaWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKHRoaXMuc2V0dGluZ3MudGFza3NEaXJlY3RvcnkpKSB7XG4gICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldENhY2hlKGZpbGUucGF0aCk7XG4gICAgICAgICAgY29uc3QgaXNIaWRkZW4gPSBjYWNoZT8uZnJvbnRtYXR0ZXI/LmhpZGVDb21wbGV0ZWQgPT09IHRydWU7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWx3YXlzIHVwZGF0ZSBpbnRlcm5hbCBzdGF0ZSB0byBtYXRjaCBmcm9udG1hdHRlclxuICAgICAgICAgIHRoaXMudGFza1RvZ2dsZVN0YXRlcy5zZXQoZmlsZS5wYXRoLCBpc0hpZGRlbik7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVXBkYXRlIGFueSB2aXNpYmxlIHRvZ2dsZXMgZm9yIHRoaXMgZmlsZVxuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5pdGVyYXRlQWxsTGVhdmVzKGxlYWYgPT4ge1xuICAgICAgICAgICAgaWYgKGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldyAmJiBsZWFmLnZpZXcuZmlsZT8ucGF0aCA9PT0gZmlsZS5wYXRoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGVkaXRvckNvbnRhaW5lciA9IGxlYWYudmlldy5jb250ZW50RWwucXVlcnlTZWxlY3RvcignLmNtLWVkaXRvcicpO1xuICAgICAgICAgICAgICBjb25zdCByZWFkZXJDb250YWluZXIgPSBsZWFmLnZpZXcuY29udGVudEVsO1xuICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJzID0gW2VkaXRvckNvbnRhaW5lciwgcmVhZGVyQ29udGFpbmVyXTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGNvbnRhaW5lcnMuZm9yRWFjaChjb250YWluZXIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRvZ2dsZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcudGFzay10b2dnbGUtY2hlY2tib3gnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgaWYgKHRvZ2dsZSkge1xuICAgICAgICAgICAgICAgICAgICB0b2dnbGUuY2hlY2tlZCA9IGlzSGlkZGVuO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBVcGRhdGUgdmlzaWJpbGl0eSBhZnRlciB1cGRhdGluZyB0b2dnbGVzXG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlVGFza1Zpc2liaWxpdHkoZmlsZS5wYXRoLCBpc0hpZGRlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVG9nZ2xlU3RhdGUoZmlsZVBhdGg6IHN0cmluZywgaXNDaGVja2VkOiBib29sZWFuKSB7XG4gICAgLy8gVXBkYXRlIHRoZSBpbnRlcm5hbCBzdGF0ZSBmaXJzdFxuICAgIHRoaXMudGFza1RvZ2dsZVN0YXRlcy5zZXQoZmlsZVBhdGgsIGlzQ2hlY2tlZCk7XG4gICAgdGhpcy51cGRhdGVUYXNrVmlzaWJpbGl0eShmaWxlUGF0aCwgaXNDaGVja2VkKTtcblxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgY29uc3QgaGFzWWFtbEZyb250bWF0dGVyID0gY29udGVudC5zdGFydHNXaXRoKCctLS1cXG4nKTtcbiAgICAgIFxuICAgICAgbGV0IG5ld0NvbnRlbnQ6IHN0cmluZztcbiAgICAgIGlmIChoYXNZYW1sRnJvbnRtYXR0ZXIpIHtcbiAgICAgICAgY29uc3QgW2Zyb250bWF0dGVyLCAuLi5yZXN0XSA9IGNvbnRlbnQuc3BsaXQoJy0tLVxcbicpLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgY29uc3QgeWFtbExpbmVzID0gZnJvbnRtYXR0ZXIuc3BsaXQoJ1xcbicpO1xuICAgICAgICBjb25zdCBoaWRlQ29tcGxldGVkSW5kZXggPSB5YW1sTGluZXMuZmluZEluZGV4KGxpbmUgPT4gbGluZS5zdGFydHNXaXRoKCdoaWRlQ29tcGxldGVkOicpKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChoaWRlQ29tcGxldGVkSW5kZXggPj0gMCkge1xuICAgICAgICAgIHlhbWxMaW5lc1toaWRlQ29tcGxldGVkSW5kZXhdID0gYGhpZGVDb21wbGV0ZWQ6ICR7aXNDaGVja2VkfWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgeWFtbExpbmVzLnB1c2goYGhpZGVDb21wbGV0ZWQ6ICR7aXNDaGVja2VkfWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBuZXdDb250ZW50ID0gYC0tLVxcbiR7eWFtbExpbmVzLmpvaW4oJ1xcbicpfVxcbi0tLVxcbiR7cmVzdC5qb2luKCctLS1cXG4nKX1gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3Q29udGVudCA9IGAtLS1cXG5oaWRlQ29tcGxldGVkOiAke2lzQ2hlY2tlZH1cXG4tLS1cXG5cXG4ke2NvbnRlbnR9YDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIGEgdHJ5LWNhdGNoIHRvIGhhbmRsZSBwb3RlbnRpYWwgZmlsZSBtb2RpZmljYXRpb24gZXJyb3JzXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZmlsZSwgbmV3Q29udGVudCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIGhpZGVDb21wbGV0ZWQgaW4gZnJvbnRtYXR0ZXI6JywgZXJyb3IpO1xuICAgICAgICAvLyBSZXZlcnQgdGhlIHRvZ2dsZSBzdGF0ZSBpZiB0aGUgZmlsZSBtb2RpZmljYXRpb24gZmFpbGVkXG4gICAgICAgIHRoaXMudGFza1RvZ2dsZVN0YXRlcy5zZXQoZmlsZVBhdGgsICFpc0NoZWNrZWQpO1xuICAgICAgICB0aGlzLnVwZGF0ZVRhc2tWaXNpYmlsaXR5KGZpbGVQYXRoLCAhaXNDaGVja2VkKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgVUkgdG9nZ2xlIGJhY2sgdG8gaXRzIHByZXZpb3VzIHN0YXRlXG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5pdGVyYXRlQWxsTGVhdmVzKGxlYWYgPT4ge1xuICAgICAgICAgIGlmIChsZWFmLnZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcgJiYgbGVhZi52aWV3LmZpbGU/LnBhdGggPT09IGZpbGVQYXRoKSB7XG4gICAgICAgICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBsZWFmLnZpZXcuY29udGVudEVsLnF1ZXJ5U2VsZWN0b3IoJy5jbS1lZGl0b3InKTtcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlckNvbnRhaW5lciA9IGxlYWYudmlldy5jb250ZW50RWw7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXJzID0gW2VkaXRvckNvbnRhaW5lciwgcmVhZGVyQ29udGFpbmVyXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29udGFpbmVycy5mb3JFYWNoKGNvbnRhaW5lciA9PiB7XG4gICAgICAgICAgICAgIGlmIChjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2dnbGUgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnRhc2stdG9nZ2xlLWNoZWNrYm94JykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgICAgICAgICBpZiAodG9nZ2xlKSB7XG4gICAgICAgICAgICAgICAgICB0b2dnbGUuY2hlY2tlZCA9ICFpc0NoZWNrZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlVGFza1Zpc2liaWxpdHkoZmlsZVBhdGg6IHN0cmluZywgaXNIaWRkZW46IGJvb2xlYW4pIHtcbiAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICBpZiAoIWZpbGUpIHJldHVybjtcblxuICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ21hcmtkb3duJyk7XG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xuICAgICAgY29uc3QgdmlldyA9IGxlYWYudmlldyBhcyBNYXJrZG93blZpZXc7XG4gICAgICBpZiAodmlldy5maWxlPy5wYXRoICE9PSBmaWxlLnBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAvLyBBcHBseSB0byBib3RoIHRoZSBjb250ZW50IGVsZW1lbnQgYW5kIGFueSBlZGl0b3IgaW5zdGFuY2VzXG4gICAgICBjb25zdCBjb250ZW50RWwgPSB2aWV3LmNvbnRlbnRFbDtcbiAgICAgIGlmIChpc0hpZGRlbikge1xuICAgICAgICBjb250ZW50RWwuY2xhc3NMaXN0LmFkZCgnaGlkZS1jb21wbGV0ZWQtdGFza3MnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRlbnRFbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlLWNvbXBsZXRlZC10YXNrcycpO1xuICAgICAgfVxuXG4gICAgICAvLyBGb3JjZSByZWZyZXNoIHRoZSB2aWV3XG4gICAgICBpZiAodmlldy5nZXRNb2RlKCkgPT09ICdzb3VyY2UnKSB7XG4gICAgICAgIC8vIEZvciBzb3VyY2UgdmlldywgdHJpZ2dlciBhIHJlZnJlc2ggb2YgdGhlIGVkaXRvclxuICAgICAgICBjb25zdCBlZGl0b3IgPSB2aWV3LmVkaXRvcjtcbiAgICAgICAgaWYgKGVkaXRvcikge1xuICAgICAgICAgIGVkaXRvci5yZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciByZWFkaW5nIHZpZXcsIGZvcmNlIGEgcmUtcmVuZGVyXG4gICAgICAgIHZpZXcucHJldmlld01vZGU/LnJlcmVuZGVyKHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5PckNyZWF0ZVRhc2tzRmlsZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0YXNrc0RpciA9IHRoaXMuc2V0dGluZ3MudGFza3NEaXJlY3Rvcnk7XG4gICAgY29uc3QgZmlsZU5hbWUgPSBgJHt0YXNrc0Rpcn0vVGFza3MubWRgO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKHRhc2tzRGlyKTtcblxuICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgVGFza3MubWQgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCEoYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5leGlzdHMoZmlsZU5hbWUpKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZU5hbWUsIGAjIFRhc2tzXFxuXFxuLSBbIF0gU2FtcGxlIHRhc2tcXG5gKTtcbiAgICAgIH1cblxuICAgICAgLy8gT3BlbiB0aGUgZmlsZVxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlTmFtZSk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGZpbGUgaXMgYWxyZWFkeSBvcGVuIGluIGFueSBsZWFmXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZVxuICAgICAgICAgIC5nZXRMZWF2ZXNPZlR5cGUoXCJtYXJrZG93blwiKVxuICAgICAgICAgIC5maW5kKChsZWFmKSA9PiBsZWFmLnZpZXcuZ2V0U3RhdGUoKS5maWxlID09PSBmaWxlLnBhdGgpO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0xlYWYpIHtcbiAgICAgICAgICAvLyBGb2N1cyBleGlzdGluZyB0YWJcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihleGlzdGluZ0xlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gT3BlbiBpbiBuZXcgdGFiXG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShmaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGhhbmRsZSB0YXNrcyBmaWxlOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyVGFza3NGaWxlV2F0Y2hlcigpOiB2b2lkIHtcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAudmF1bHQub24oXCJtb2RpZnlcIiwgYXN5bmMgKGZpbGUpID0+IHtcbiAgICAgICAgY29uc3QgdGFza3NEaXIgPSB0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5O1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgbW9kaWZpZWQgZmlsZSBpcyBhIG1hcmtkb3duIGZpbGUgd2l0aGluIHRoZSB0YXNrcyBkaXJlY3RvcnlcbiAgICAgICAgaWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKHRhc2tzRGlyKSAmJiBmaWxlLnBhdGguZW5kc1dpdGgoXCIubWRcIikpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlb3JkZXJDb21wbGV0ZWRUYXNrcyhmaWxlIGFzIFRGaWxlKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZW9yZGVyQ29tcGxldGVkVGFza3MoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBJZiBtb3ZpbmcgY29tcGxldGVkIHRhc2tzIGRvd24gaXMgZGlzYWJsZWQsIGRvIG5vdGhpbmdcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MubW92ZUNvbXBsZXRlZFRhc2tzRG93bikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNraXAgaWYgZmlsZSBpcyBub3QgaW4gdGFza3MgZGlyZWN0b3J5XG4gICAgaWYgKCFmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNraXAgaWYgbm90IGEgbWFya2Rvd24gZmlsZVxuICAgIGlmICghZmlsZS5wYXRoLmVuZHNXaXRoKFwiLm1kXCIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgb3JpZ2luYWwgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgIGNvbnN0IHJlb3JkZXJlZCA9IHRoaXMucmVvcmRlckNvbnRlbnQob3JpZ2luYWwpO1xuICAgIC8vIElmIG5vIGNoYW5nZSwgZG8gbm90aGluZyB0byBwcmV2ZW50IGFuIGVuZGxlc3MgbW9kaWZ5IGxvb3BcbiAgICBpZiAocmVvcmRlcmVkICE9PSBvcmlnaW5hbCkge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIHJlb3JkZXJlZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW9yZGVyQ29udGVudChjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBvdXRwdXQ6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IGxpc3RCdWZmZXI6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdCBmbHVzaEJ1ZmZlciA9ICgpID0+IHtcbiAgICAgIGlmIChsaXN0QnVmZmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3V0cHV0LnB1c2goLi4udGhpcy5yZW9yZGVyTGlzdEJsb2NrKGxpc3RCdWZmZXIpKTtcbiAgICAgICAgbGlzdEJ1ZmZlciA9IFtdO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIC8vIElmIHRoZSBsaW5lIGlzIGEgdGFzayBsaXN0IGl0ZW0sIGFkZCB0byBvdXIgYnVmZmVyOyBvdGhlcndpc2UgZmx1c2ggaXQuXG4gICAgICBpZiAoL15cXHMqLVxccypcXFtbeFxcc11cXF0vLnRlc3QobGluZSkpIHtcbiAgICAgICAgbGlzdEJ1ZmZlci5wdXNoKGxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmx1c2hCdWZmZXIoKTtcbiAgICAgICAgb3V0cHV0LnB1c2gobGluZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGZsdXNoQnVmZmVyKCk7XG4gICAgcmV0dXJuIG91dHB1dC5qb2luKFwiXFxuXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGEgY29udGlndW91cyBibG9jayBvZiB0YXNrIGxpbmVzLCBidWlsZCBhIHRyZWUgYmFzZWQgb24gaW5kZW50IGxldmVsc1xuICAgKiBhbmQgdGhlbiByZWN1cnNpdmVseSByZW9yZGVyIGVhY2ggZ3JvdXAgc28gdGhhdCB3aXRoaW4gZWFjaCBncm91cCwgaW5jb21wbGV0ZVxuICAgKiB0YXNrcyBhcHBlYXIgYWJvdmUgY29tcGxldGVkIHRhc2tzIHdoaWxlIGtlZXBpbmcgbmVzdGVkIHN1YnRhc2tzIHdpdGggdGhlaXIgcGFyZW50LlxuICAgKi9cbiAgcHJpdmF0ZSByZW9yZGVyTGlzdEJsb2NrKGxpbmVzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICB0eXBlIFRhc2tOb2RlID0ge1xuICAgICAgbGluZTogc3RyaW5nO1xuICAgICAgY2hpbGRyZW46IFRhc2tOb2RlW107XG4gICAgICBpbmRlbnQ6IG51bWJlcjtcbiAgICB9O1xuXG4gICAgLy8gSGVscGVyOiBjb3VudCBsZWFkaW5nIHdoaXRlc3BhY2UgKGluZGVudGF0aW9uKVxuICAgIGZ1bmN0aW9uIGdldEluZGVudChsaW5lOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLm1hdGNoKC9eKFxccyopLyk7XG4gICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXS5sZW5ndGggOiAwO1xuICAgIH1cblxuICAgIC8vIEJ1aWxkIHRoZSB0cmVlOiBlYWNoIHRhc2sgYmVjb21lcyBhIG5vZGUsIGFuZCBzdWJzZXF1ZW50IGxpbmVzIHdpdGggZ3JlYXRlciBpbmRlbnQgYmVjb21lIGl0cyBjaGlsZHJlbi5cbiAgICBjb25zdCBub2RlczogVGFza05vZGVbXSA9IFtdO1xuICAgIGNvbnN0IHN0YWNrOiBUYXNrTm9kZVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIGNvbnN0IGluZGVudCA9IGdldEluZGVudChsaW5lKTtcbiAgICAgIGNvbnN0IG5vZGU6IFRhc2tOb2RlID0geyBsaW5lLCBjaGlsZHJlbjogW10sIGluZGVudCB9O1xuICAgICAgLy8gUG9wIGZyb20gdGhlIHN0YWNrIHVudGlsIGZpbmRpbmcgYSBub2RlIHdpdGggbG93ZXIgaW5kZW50YXRpb25cbiAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwICYmIGluZGVudCA8PSBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5pbmRlbnQpIHtcbiAgICAgICAgc3RhY2sucG9wKCk7XG4gICAgICB9XG4gICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIHN0YWNrLnB1c2gobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBBZGQgYXMgYSBjaGlsZCBvZiB0aGUgbm9kZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFja1xuICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgICAgICBzdGFjay5wdXNoKG5vZGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlY3Vyc2l2ZWx5IHJlb3JkZXIgbm9kZXMgYnkgbW92aW5nIGNvbXBsZXRlZCB0YXNrcyAodGhvc2Ugd2hvc2UgY2hlY2tib3ggaXMgW3hdKSBiZWxvdyBpbmNvbXBsZXRlIG9uZXMuXG4gICAgZnVuY3Rpb24gcmVvcmRlck5vZGVzKG5vZGVzOiBUYXNrTm9kZVtdKTogVGFza05vZGVbXSB7XG4gICAgICAvLyBGaXJzdCwgcHJvY2VzcyBjaGlsZHJlbiByZWN1cnNpdmVseS5cbiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcykge1xuICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IHJlb3JkZXJOb2Rlcyhub2RlLmNoaWxkcmVuKTtcbiAgICAgICAgICAvLyBTb3J0IGNoaWxkcmVuIHNvIHRoYXQgaW5jb21wbGV0ZSB0YXNrcyBjb21lIGJlZm9yZSBjb21wbGV0ZSBvbmVzLlxuICAgICAgICAgIG5vZGUuY2hpbGRyZW4uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgYUNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChhLmxpbmUpID8gMSA6IDA7XG4gICAgICAgICAgICBjb25zdCBiQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGIubGluZSkgPyAxIDogMDtcbiAgICAgICAgICAgIHJldHVybiBhQ29tcGxldGUgLSBiQ29tcGxldGU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFRoZW4gc29ydCB0aGUgY3VycmVudCBsZXZlbCBvZiBub2RlcyBzaW1pbGFybHkuXG4gICAgICBub2Rlcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIGNvbnN0IGFDb21wbGV0ZSA9IC9eXFxzKi1cXHMqXFxbeFxcXS9pLnRlc3QoYS5saW5lKSA/IDEgOiAwO1xuICAgICAgICBjb25zdCBiQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGIubGluZSkgPyAxIDogMDtcbiAgICAgICAgcmV0dXJuIGFDb21wbGV0ZSAtIGJDb21wbGV0ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5vZGVzO1xuICAgIH1cblxuICAgIGNvbnN0IHJlb3JkZXJlZE5vZGVzID0gcmVvcmRlck5vZGVzKG5vZGVzKTtcblxuICAgIC8vIEZsYXR0ZW4gdGhlIHRyZWUgYmFjayB0byBhbiBhcnJheSBvZiBsaW5lc1xuICAgIGNvbnN0IGZsYXR0ZW5lZDogc3RyaW5nW10gPSBbXTtcbiAgICBmdW5jdGlvbiBmbGF0dGVuKG5vZGVzOiBUYXNrTm9kZVtdKSB7XG4gICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICAgICAgZmxhdHRlbmVkLnB1c2gobm9kZS5saW5lKTtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZsYXR0ZW4obm9kZS5jaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZmxhdHRlbihyZW9yZGVyZWROb2Rlcyk7XG4gICAgcmV0dXJuIGZsYXR0ZW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIHRvIGNoZWNrIGlmIGEgZmlsZSBpcyBpbiB0aGUgdGFza3MgZGlyZWN0b3J5XG4gICAqL1xuICBwdWJsaWMgaXNUYXNrc0ZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmaWxlUGF0aC5zdGFydHNXaXRoKHRoaXMuc2V0dGluZ3MudGFza3NEaXJlY3RvcnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcmFuZ2Ugb2YgbGluZXMgdGhhdCBtYWtlIHVwIGEgdGFzayB0cmVlICh0aGUgdGFzayBhbmQgYWxsIGl0cyBzdWJ0YXNrcylcbiAgICovXG4gIHByaXZhdGUgZ2V0VGFza1RyZWVSYW5nZShlZGl0b3I6IEVkaXRvciwgc3RhcnRMaW5lOiBudW1iZXIpOiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyIH0ge1xuICAgIGNvbnN0IHN0YXJ0SW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChlZGl0b3IuZ2V0TGluZShzdGFydExpbmUpKTtcbiAgICBsZXQgZW5kTGluZSA9IHN0YXJ0TGluZTtcbiAgICBcbiAgICAvLyBMb29rIGF0IHN1YnNlcXVlbnQgbGluZXMgdG8gZmluZCB0aGUgZW5kIG9mIHRoZSB0cmVlXG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0TGluZSArIDE7IGkgPCBlZGl0b3IubGluZUNvdW50KCk7IGkrKykge1xuICAgICAgY29uc3QgbGluZSA9IGVkaXRvci5nZXRMaW5lKGkpO1xuICAgICAgY29uc3QgaW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChsaW5lKTtcbiAgICAgIFxuICAgICAgLy8gSWYgd2UgZmluZCBhIGxpbmUgd2l0aCBzYW1lIG9yIGxvd2VyIGluZGVudCwgd2UndmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSB0cmVlXG4gICAgICBpZiAoaW5kZW50IDw9IHN0YXJ0SW5kZW50KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZW5kTGluZSA9IGk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IHN0YXJ0OiBzdGFydExpbmUsIGVuZDogZW5kTGluZSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcmFuZ2Ugb2YgdGhlIHByZXZpb3VzIHRhc2sgdHJlZSBhdCB0aGUgc2FtZSBsZXZlbFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRQcmV2aW91c1Rhc2tUcmVlUmFuZ2UoZWRpdG9yOiBFZGl0b3IsIGN1cnJlbnRMaW5lOiBudW1iZXIsIGN1cnJlbnRJbmRlbnQ6IG51bWJlcik6IHsgc3RhcnQ6IG51bWJlcjsgZW5kOiBudW1iZXIgfSB8IG51bGwge1xuICAgIC8vIExvb2sgYmFja3dhcmRzIGZvciBhIHRhc2sgYXQgdGhlIHNhbWUgbGV2ZWxcbiAgICBmb3IgKGxldCBpID0gY3VycmVudExpbmUgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgbGluZSA9IGVkaXRvci5nZXRMaW5lKGkpO1xuICAgICAgY29uc3QgaW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChsaW5lKTtcbiAgICAgIFxuICAgICAgLy8gSWYgd2UgZmluZCBhIHRhc2sgYXQgdGhlIHNhbWUgbGV2ZWxcbiAgICAgIGlmIChpbmRlbnQgPT09IGN1cnJlbnRJbmRlbnQgJiYgdGhpcy5pc1Rhc2tMaW5lKGxpbmUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRhc2tUcmVlUmFuZ2UoZWRpdG9yLCBpKTtcbiAgICAgIH1cbiAgICAgIC8vIElmIHdlIGZpbmQgc29tZXRoaW5nIHdpdGggbG93ZXIgaW5kZW50LCBzdG9wIGxvb2tpbmdcbiAgICAgIGlmIChpbmRlbnQgPCBjdXJyZW50SW5kZW50KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJhbmdlIG9mIHRoZSBuZXh0IHRhc2sgdHJlZSBhdCB0aGUgc2FtZSBsZXZlbFxuICAgKi9cbiAgcHJpdmF0ZSBnZXROZXh0VGFza1RyZWVSYW5nZShlZGl0b3I6IEVkaXRvciwgY3VycmVudExpbmU6IG51bWJlciwgY3VycmVudEluZGVudDogbnVtYmVyKTogeyBzdGFydDogbnVtYmVyOyBlbmQ6IG51bWJlciB9IHwgbnVsbCB7XG4gICAgY29uc3QgY3VycmVudFRyZWVSYW5nZSA9IHRoaXMuZ2V0VGFza1RyZWVSYW5nZShlZGl0b3IsIGN1cnJlbnRMaW5lKTtcbiAgICBcbiAgICAvLyBMb29rIGZvcndhcmQgZnJvbSB0aGUgZW5kIG9mIGN1cnJlbnQgdHJlZSBmb3IgYSB0YXNrIGF0IHRoZSBzYW1lIGxldmVsXG4gICAgZm9yIChsZXQgaSA9IGN1cnJlbnRUcmVlUmFuZ2UuZW5kICsgMTsgaSA8IGVkaXRvci5saW5lQ291bnQoKTsgaSsrKSB7XG4gICAgICBjb25zdCBsaW5lID0gZWRpdG9yLmdldExpbmUoaSk7XG4gICAgICBjb25zdCBpbmRlbnQgPSB0aGlzLmdldEluZGVudExldmVsKGxpbmUpO1xuICAgICAgXG4gICAgICAvLyBJZiB3ZSBmaW5kIGEgdGFzayBhdCB0aGUgc2FtZSBsZXZlbFxuICAgICAgaWYgKGluZGVudCA9PT0gY3VycmVudEluZGVudCAmJiB0aGlzLmlzVGFza0xpbmUobGluZSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGFza1RyZWVSYW5nZShlZGl0b3IsIGkpO1xuICAgICAgfVxuICAgICAgLy8gSWYgd2UgZmluZCBzb21ldGhpbmcgd2l0aCBsb3dlciBpbmRlbnQsIHN0b3AgbG9va2luZ1xuICAgICAgaWYgKGluZGVudCA8IGN1cnJlbnRJbmRlbnQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdGV4dCBjb250ZW50IG9mIGEgcmFuZ2Ugb2YgbGluZXNcbiAgICovXG4gIHByaXZhdGUgZ2V0UmFuZ2VUZXh0KGVkaXRvcjogRWRpdG9yLCByYW5nZTogeyBzdGFydDogbnVtYmVyOyBlbmQ6IG51bWJlciB9KTogc3RyaW5nIHtcbiAgICBsZXQgdGV4dCA9ICcnO1xuICAgIGZvciAobGV0IGkgPSByYW5nZS5zdGFydDsgaSA8PSByYW5nZS5lbmQ7IGkrKykge1xuICAgICAgdGV4dCArPSBlZGl0b3IuZ2V0TGluZShpKSArICdcXG4nO1xuICAgIH1cbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBjdXJyZW50IHRhc2sgdHJlZSB1cFxuICAgKi9cbiAgcHVibGljIG1vdmVUYXNrVXAoZWRpdG9yOiBFZGl0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50TGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgbGluZSBpcyBhIHRhc2tcbiAgICBpZiAoIXRoaXMuaXNUYXNrTGluZShsaW5lQ29udGVudCkpIHJldHVybjtcbiAgICBcbiAgICAvLyBDYW4ndCBtb3ZlIHVwIGlmIHdlJ3JlIGF0IHRoZSBmaXJzdCBsaW5lXG4gICAgaWYgKGN1cnJlbnRMaW5lID09PSAwKSByZXR1cm47XG4gICAgXG4gICAgY29uc3QgY3VycmVudEluZGVudCA9IHRoaXMuZ2V0SW5kZW50TGV2ZWwobGluZUNvbnRlbnQpO1xuICAgIGNvbnN0IGN1cnJlbnRUcmVlUmFuZ2UgPSB0aGlzLmdldFRhc2tUcmVlUmFuZ2UoZWRpdG9yLCBjdXJyZW50TGluZSk7XG4gICAgY29uc3QgcHJldmlvdXNUcmVlUmFuZ2UgPSB0aGlzLmdldFByZXZpb3VzVGFza1RyZWVSYW5nZShlZGl0b3IsIGN1cnJlbnRMaW5lLCBjdXJyZW50SW5kZW50KTtcbiAgICBcbiAgICBpZiAocHJldmlvdXNUcmVlUmFuZ2UpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRUcmVlVGV4dCA9IHRoaXMuZ2V0UmFuZ2VUZXh0KGVkaXRvciwgY3VycmVudFRyZWVSYW5nZSk7XG4gICAgICBjb25zdCBwcmV2aW91c1RyZWVUZXh0ID0gdGhpcy5nZXRSYW5nZVRleHQoZWRpdG9yLCBwcmV2aW91c1RyZWVSYW5nZSk7XG4gICAgICBcbiAgICAgIGVkaXRvci50cmFuc2FjdGlvbih7XG4gICAgICAgIGNoYW5nZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmcm9tOiB7IGxpbmU6IHByZXZpb3VzVHJlZVJhbmdlLnN0YXJ0LCBjaDogMCB9LFxuICAgICAgICAgICAgdG86IHsgbGluZTogcHJldmlvdXNUcmVlUmFuZ2UuZW5kICsgMSwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRleHQ6IGN1cnJlbnRUcmVlVGV4dFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZnJvbTogeyBsaW5lOiBjdXJyZW50VHJlZVJhbmdlLnN0YXJ0LCBjaDogMCB9LFxuICAgICAgICAgICAgdG86IHsgbGluZTogY3VycmVudFRyZWVSYW5nZS5lbmQgKyAxLCBjaDogMCB9LFxuICAgICAgICAgICAgdGV4dDogcHJldmlvdXNUcmVlVGV4dFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIE1vdmUgdGhlIGN1cnNvciB1cCB3aXRoIHRoZSB0YXNrIHRyZWUgYW5kIHRvIHRoZSBlbmQgb2YgdGhlIGxpbmVcbiAgICAgIGNvbnN0IG1vdmVEaXN0YW5jZSA9IGN1cnJlbnRUcmVlUmFuZ2Uuc3RhcnQgLSBwcmV2aW91c1RyZWVSYW5nZS5zdGFydDtcbiAgICAgIGNvbnN0IG5ld0xpbmUgPSBjdXJyZW50TGluZSAtIG1vdmVEaXN0YW5jZTtcbiAgICAgIGNvbnN0IG5ld0xpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUobmV3TGluZSk7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yKHsgbGluZTogbmV3TGluZSwgY2g6IG5ld0xpbmVDb250ZW50Lmxlbmd0aCB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgY3VycmVudCB0YXNrIHRyZWUgZG93blxuICAgKi9cbiAgcHVibGljIG1vdmVUYXNrRG93bihlZGl0b3I6IEVkaXRvcik6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnRMaW5lID0gZWRpdG9yLmdldEN1cnNvcigpLmxpbmU7XG4gICAgY29uc3QgbGluZUNvbnRlbnQgPSBlZGl0b3IuZ2V0TGluZShjdXJyZW50TGluZSk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgY3VycmVudCBsaW5lIGlzIGEgdGFza1xuICAgIGlmICghdGhpcy5pc1Rhc2tMaW5lKGxpbmVDb250ZW50KSkgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRJbmRlbnQgPSB0aGlzLmdldEluZGVudExldmVsKGxpbmVDb250ZW50KTtcbiAgICBjb25zdCBjdXJyZW50VHJlZVJhbmdlID0gdGhpcy5nZXRUYXNrVHJlZVJhbmdlKGVkaXRvciwgY3VycmVudExpbmUpO1xuICAgIGNvbnN0IG5leHRUcmVlUmFuZ2UgPSB0aGlzLmdldE5leHRUYXNrVHJlZVJhbmdlKGVkaXRvciwgY3VycmVudExpbmUsIGN1cnJlbnRJbmRlbnQpO1xuICAgIFxuICAgIGlmIChuZXh0VHJlZVJhbmdlKSB7XG4gICAgICBjb25zdCBjdXJyZW50VHJlZVRleHQgPSB0aGlzLmdldFJhbmdlVGV4dChlZGl0b3IsIGN1cnJlbnRUcmVlUmFuZ2UpO1xuICAgICAgY29uc3QgbmV4dFRyZWVUZXh0ID0gdGhpcy5nZXRSYW5nZVRleHQoZWRpdG9yLCBuZXh0VHJlZVJhbmdlKTtcbiAgICAgIFxuICAgICAgZWRpdG9yLnRyYW5zYWN0aW9uKHtcbiAgICAgICAgY2hhbmdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZyb206IHsgbGluZTogY3VycmVudFRyZWVSYW5nZS5zdGFydCwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRvOiB7IGxpbmU6IGN1cnJlbnRUcmVlUmFuZ2UuZW5kICsgMSwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRleHQ6IG5leHRUcmVlVGV4dFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZnJvbTogeyBsaW5lOiBuZXh0VHJlZVJhbmdlLnN0YXJ0LCBjaDogMCB9LFxuICAgICAgICAgICAgdG86IHsgbGluZTogbmV4dFRyZWVSYW5nZS5lbmQgKyAxLCBjaDogMCB9LFxuICAgICAgICAgICAgdGV4dDogY3VycmVudFRyZWVUZXh0XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBzaXplIG9mIHRoZSBuZXh0IHRyZWUgd2UncmUgbW92aW5nIHBhc3RcbiAgICAgIGNvbnN0IG5leHRUcmVlU2l6ZSA9IG5leHRUcmVlUmFuZ2UuZW5kIC0gbmV4dFRyZWVSYW5nZS5zdGFydCArIDE7XG4gICAgICBcbiAgICAgIC8vIE1vdmUgdGhlIGN1cnNvciB0byB0aGUgbmV3IHBvc2l0aW9uLCBhY2NvdW50aW5nIGZvciB0aGUgc2l6ZSBvZiB0aGUgdHJlZSB3ZSBtb3ZlZCBwYXN0XG4gICAgICBjb25zdCBuZXdMaW5lID0gY3VycmVudExpbmUgKyBuZXh0VHJlZVNpemU7XG4gICAgICBjb25zdCBuZXdMaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKG5ld0xpbmUpO1xuICAgICAgZWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IG5ld0xpbmUsIGNoOiBuZXdMaW5lQ29udGVudC5sZW5ndGggfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluZGVudCB0aGUgY3VycmVudCB0YXNrIGxpbmUgcmlnaHRcbiAgICovXG4gIHB1YmxpYyBpbmRlbnRUYXNrUmlnaHQoZWRpdG9yOiBFZGl0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50TGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgbGluZSBpcyBhIHRhc2tcbiAgICBpZiAoIXRoaXMuaXNUYXNrTGluZShsaW5lQ29udGVudCkpIHJldHVybjtcbiAgICBcbiAgICAvLyBBZGQgdHdvIHNwYWNlcyBmb3IgaW5kZW50YXRpb25cbiAgICBlZGl0b3Iuc2V0TGluZShjdXJyZW50TGluZSwgJyAgJyArIGxpbmVDb250ZW50KTtcbiAgICBcbiAgICAvLyBNb3ZlIGN1cnNvciB0byBlbmQgb2YgbGluZVxuICAgIGNvbnN0IG5ld0xpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBjdXJyZW50TGluZSwgY2g6IG5ld0xpbmVDb250ZW50Lmxlbmd0aCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRlbnQgdGhlIGN1cnJlbnQgdGFzayBsaW5lIGxlZnRcbiAgICovXG4gIHB1YmxpYyBpbmRlbnRUYXNrTGVmdChlZGl0b3I6IEVkaXRvcik6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnRMaW5lID0gZWRpdG9yLmdldEN1cnNvcigpLmxpbmU7XG4gICAgY29uc3QgbGluZUNvbnRlbnQgPSBlZGl0b3IuZ2V0TGluZShjdXJyZW50TGluZSk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgY3VycmVudCBsaW5lIGlzIGEgdGFza1xuICAgIGlmICghdGhpcy5pc1Rhc2tMaW5lKGxpbmVDb250ZW50KSkgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRJbmRlbnQgPSB0aGlzLmdldEluZGVudExldmVsKGxpbmVDb250ZW50KTtcbiAgICBpZiAoY3VycmVudEluZGVudCA+PSAyKSB7XG4gICAgICAvLyBSZW1vdmUgdHdvIHNwYWNlcyBmcm9tIGluZGVudGF0aW9uXG4gICAgICBlZGl0b3Iuc2V0TGluZShjdXJyZW50TGluZSwgbGluZUNvbnRlbnQuc3Vic3RyaW5nKDIpKTtcbiAgICAgIFxuICAgICAgLy8gTW92ZSBjdXJzb3IgdG8gZW5kIG9mIGxpbmVcbiAgICAgIGNvbnN0IG5ld0xpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgICAgZWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IGN1cnJlbnRMaW5lLCBjaDogbmV3TGluZUNvbnRlbnQubGVuZ3RoIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgdG8gY2hlY2sgaWYgYSBsaW5lIGlzIGEgdGFza1xuICAgKi9cbiAgcHJpdmF0ZSBpc1Rhc2tMaW5lKGxpbmU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAvXlxccyotXFxzKlxcW1t4XFxzXVxcXS8udGVzdChsaW5lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgdG8gZ2V0IGluZGVudGF0aW9uIGxldmVsIChudW1iZXIgb2Ygc3BhY2VzIGJlZm9yZSBjb250ZW50KVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRJbmRlbnRMZXZlbChsaW5lOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKS8pO1xuICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdLmxlbmd0aCA6IDA7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCwgQ3VzdG9tUHJvdmlkZXIsIEZhdm9yaXRlTW9kZWwgfSBmcm9tIFwiLi4vdHlwZXMvbGxtXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlclNlcnZpY2UgfSBmcm9tIFwiLi9DdXN0b21Qcm92aWRlclNlcnZpY2VcIjtcblxuZXhwb3J0IGNsYXNzIE1vZGVsU2VydmljZSB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2U7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBNb2RlbFNlcnZpY2U7XG4gIHByaXZhdGUgbG9hZGluZ1Byb21pc2U6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4gfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICAgIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuY3VzdG9tUHJvdmlkZXJTZXJ2aWNlID0gY3VzdG9tUHJvdmlkZXJTZXJ2aWNlO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICAgIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlXG4gICk6IE1vZGVsU2VydmljZSB7XG4gICAgaWYgKCFNb2RlbFNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIE1vZGVsU2VydmljZS5pbnN0YW5jZSA9IG5ldyBNb2RlbFNlcnZpY2UocGx1Z2luLCBjdXN0b21Qcm92aWRlclNlcnZpY2UpO1xuICAgIH1cbiAgICByZXR1cm4gTW9kZWxTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgbW9kZWxzIChzeXN0ZW0gYW5kIGN1c3RvbSkuXG4gICAqIFRoaXMgc2hvdWxkIGJlIHRoZSBvbmx5IG1ldGhvZCB1c2VkIHRvIGdldCBtb2RlbHMgdGhyb3VnaG91dCB0aGUgYXBwLlxuICAgKiBOb3cgYWx3YXlzIGZldGNoZXMgZnJlc2ggZGF0YSBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0TW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIC8vIElmIGFscmVhZHkgbG9hZGluZywgcmV0dXJuIHRoZSBleGlzdGluZyBwcm9taXNlIHRvIHByZXZlbnQgY29uY3VycmVudCByZXF1ZXN0c1xuICAgIGlmICh0aGlzLmxvYWRpbmdQcm9taXNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkaW5nUHJvbWlzZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBuZXcgbG9hZFxuICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSB0aGlzLmxvYWRNb2RlbHMoKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5sb2FkaW5nUHJvbWlzZTtcbiAgICAgIHJldHVybiBtb2RlbHM7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gbG9hZCBtb2RlbHMgZnJvbSBib3RoIFN5c3RlbVNjdWxwdCdzIEFQSSBhbmQgY3VzdG9tIHByb3ZpZGVycy5cbiAgICogTm93IGFsd2F5cyBmZXRjaGVzIGZyZXNoIGRhdGEuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIExvYWQgc3lzdGVtIG1vZGVscyAobm93IG9ubHkgcmV0dXJucyBzeXN0ZW0gbW9kZWxzKVxuICAgICAgY29uc3Qgc3lzdGVtTW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4uYWlTZXJ2aWNlLmdldE1vZGVscygpO1xuXG4gICAgICAvLyBMb2FkIGN1c3RvbSBwcm92aWRlciBtb2RlbHMgKGFsd2F5cyBmcmVzaClcbiAgICAgIGNvbnN0IGN1c3RvbU1vZGVscyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbVByb3ZpZGVyTW9kZWxzKCk7XG5cbiAgICAgIC8vIENvbWJpbmUgYWxsIG1vZGVsc1xuICAgICAgY29uc3QgYWxsTW9kZWxzID0gWy4uLnN5c3RlbU1vZGVscywgLi4uY3VzdG9tTW9kZWxzXTtcblxuICAgICAgLy8gU2V0IGZhdm9yaXRlIHN0YXR1c1xuICAgICAgY29uc3QgZmF2b3JpdGVNb2RlbHMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyB8fCBbXTtcbiAgICAgIGZvciAoY29uc3QgbW9kZWwgb2YgYWxsTW9kZWxzKSB7XG4gICAgICAgIG1vZGVsLmlzRmF2b3JpdGUgPSBmYXZvcml0ZU1vZGVscy5zb21lKFxuICAgICAgICAgIChmYXYpID0+IGZhdi5tb2RlbElkID09PSBtb2RlbC5pZCAmJiBmYXYucHJvdmlkZXIgPT09IG1vZGVsLnByb3ZpZGVyXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhbGxNb2RlbHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBtb2RlbHM6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTsgLy8gUmV0dXJuIGVtcHR5IGFycmF5IG9uIGVycm9yIGluc3RlYWQgb2YgdXNpbmcgY2FjaGVcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9hZHMgbW9kZWxzIGZyb20gYWxsIGVuYWJsZWQgY3VzdG9tIHByb3ZpZGVycy5cbiAgICogTm93IGFsd2F5cyBmZXRjaGVzIGZyZXNoIGRhdGEuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRDdXN0b21Qcm92aWRlck1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICBjb25zdCB7IGN1c3RvbVByb3ZpZGVycyB9ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG5cbiAgICBjb25zdCBmZXRjaGVzID0gY3VzdG9tUHJvdmlkZXJzXG4gICAgICAuZmlsdGVyKChwKSA9PiBwLmlzRW5hYmxlZClcbiAgICAgIC5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBBbHdheXMgdGVzdCBjb25uZWN0aW9uIGFuZCBnZXQgZnJlc2ggbW9kZWxzXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24ocCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIHJlc3VsdC5tb2RlbHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUN1c3RvbU1vZGVscyhwLCByZXN1bHQubW9kZWxzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgbW9kZWxzIGZyb20gJHtwLm5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChmZXRjaGVzKTtcbiAgICByZXR1cm4gcmVzdWx0cy5mbGF0KCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBTeXN0ZW1TY3VscHRNb2RlbCBvYmplY3RzIGZvciBhIGdpdmVuIGN1c3RvbSBwcm92aWRlci5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlQ3VzdG9tTW9kZWxzKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlcixcbiAgICBtb2RlbElkczogc3RyaW5nW11cbiAgKTogU3lzdGVtU2N1bHB0TW9kZWxbXSB7XG4gICAgcmV0dXJuIG1vZGVsSWRzLm1hcCgobW9kZWxJZCkgPT4gKHtcbiAgICAgIGlkOiBtb2RlbElkLFxuICAgICAgbmFtZTogbW9kZWxJZCxcbiAgICAgIHByb3ZpZGVyOiBwcm92aWRlci5uYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICBpc0Zhdm9yaXRlOiBmYWxzZSxcbiAgICAgIGNvbnRleHRfbGVuZ3RoOiAwLFxuICAgICAgY2FwYWJpbGl0aWVzOiBbXSxcbiAgICAgIHByaWNpbmc6IHtcbiAgICAgICAgcHJvbXB0OiBcIjBcIixcbiAgICAgICAgY29tcGxldGlvbjogXCIwXCIsXG4gICAgICAgIGltYWdlOiBcIjBcIixcbiAgICAgICAgcmVxdWVzdDogXCIwXCIsXG4gICAgICB9LFxuICAgICAgYXJjaGl0ZWN0dXJlOiB7XG4gICAgICAgIG1vZGFsaXR5OiBcInRleHQtPnRleHRcIixcbiAgICAgICAgdG9rZW5pemVyOiBcIlwiLFxuICAgICAgICBpbnN0cnVjdF90eXBlOiBudWxsLFxuICAgICAgfSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgJHtwcm92aWRlci5uYW1lfSBtb2RlbGAsXG4gICAgICBpZGVudGlmaWVyOiB7XG4gICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLm5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgbW9kZWxJZDogbW9kZWxJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IG1vZGVsSWQsXG4gICAgICB9LFxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGUgZmF2b3JpdGUgc3RhdHVzIGZvciBhIG1vZGVsXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdG9nZ2xlRmF2b3JpdGUobW9kZWw6IFN5c3RlbVNjdWxwdE1vZGVsKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgaXNOb3dGYXZvcml0ZSA9ICFtb2RlbC5pc0Zhdm9yaXRlO1xuICAgIG1vZGVsLmlzRmF2b3JpdGUgPSBpc05vd0Zhdm9yaXRlO1xuXG4gICAgLy8gVXBkYXRlIHBsdWdpbiBzZXR0aW5nc1xuICAgIGlmIChpc05vd0Zhdm9yaXRlKSB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5wdXNoKHtcbiAgICAgICAgcHJvdmlkZXI6IG1vZGVsLnByb3ZpZGVyLFxuICAgICAgICBtb2RlbElkOiBtb2RlbC5pZCxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLmZpbHRlcihcbiAgICAgICAgICAoZmF2KSA9PlxuICAgICAgICAgICAgIShmYXYubW9kZWxJZCA9PT0gbW9kZWwuaWQgJiYgZmF2LnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlcilcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7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
