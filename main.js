/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[Object.keys(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// src/services/SystemPromptService.ts
var _SystemPromptService, SystemPromptService;
var init_SystemPromptService = __esm({
  "src/services/SystemPromptService.ts"() {
    _SystemPromptService = class {
      constructor(app) {
        this.app = app;
        _SystemPromptService.loadCachedPrompts();
      }
      static loadCachedPrompts() {
        try {
          const cached = localStorage.getItem(_SystemPromptService.localStorageKey);
          if (cached) {
            const { cache, timestamp } = JSON.parse(cached);
            if (Date.now() - timestamp < _SystemPromptService.CACHE_DURATION) {
              _SystemPromptService.cache = cache;
            }
          }
        } catch (error) {
          console.warn("[SystemSculpt] Failed to load prompts from cache:", error);
        }
      }
      static saveCachedPrompts() {
        try {
          if (_SystemPromptService.cache) {
            localStorage.setItem(_SystemPromptService.localStorageKey, JSON.stringify({
              cache: _SystemPromptService.cache,
              timestamp: Date.now()
            }));
          }
        } catch (error) {
          console.warn("[SystemSculpt] Failed to save prompts to cache:", error);
        }
      }
      static getInstance(app) {
        if (!this.instance) {
          this.instance = new _SystemPromptService(app);
        }
        return this.instance;
      }
      static setSystemSculptService(service) {
        _SystemPromptService.systemSculptService = service;
        if (!_SystemPromptService.isCacheValid() && !_SystemPromptService.isInitializing) {
          _SystemPromptService.initializeCache();
        }
      }
      static getCachedPrompts() {
        var _a;
        return ((_a = _SystemPromptService.cache) == null ? void 0 : _a.prompts) || null;
      }
      static isCacheValid() {
        if (!_SystemPromptService.cache)
          return false;
        const now = Date.now();
        return now - _SystemPromptService.cache.timestamp < _SystemPromptService.CACHE_DURATION;
      }
      static updateCache(prompts) {
        const byId = {};
        prompts.forEach((prompt) => {
          byId[prompt.id] = prompt;
        });
        _SystemPromptService.cache = {
          prompts,
          timestamp: Date.now(),
          byId
        };
      }
      static initializeCache() {
        if (_SystemPromptService.initPromise) {
          return _SystemPromptService.initPromise;
        }
        if (!_SystemPromptService.systemSculptService) {
          return Promise.reject(new Error("SystemSculptService not initialized"));
        }
        if (_SystemPromptService.isCacheValid()) {
          return Promise.resolve();
        }
        _SystemPromptService.isInitializing = true;
        _SystemPromptService.initPromise = _SystemPromptService.loadWithRetry(async () => {
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompts: ${response.statusText}`);
          }
          const data = await response.json();
          _SystemPromptService.updateCache(data.prompts);
          _SystemPromptService.saveCachedPrompts();
        }, 3, 1e3).catch((error) => {
          console.error("Error initializing system prompts cache:", error);
          _SystemPromptService.initPromise = null;
        }).finally(() => {
          _SystemPromptService.isInitializing = false;
          _SystemPromptService.isInitialLoadDone = true;
        });
        return _SystemPromptService.initPromise;
      }
      static async loadWithRetry(fn, maxRetries, delay) {
        for (let i = 0; i < maxRetries; i++) {
          try {
            return await Promise.race([
              fn(),
              new Promise((_, reject) => setTimeout(() => reject(new Error("Operation timeout")), 5e3))
            ]);
          } catch (error) {
            if (i === maxRetries - 1)
              throw error;
            await new Promise((resolve) => setTimeout(resolve, delay));
          }
        }
        throw new Error("Max retries exceeded");
      }
      async ensureCacheInitialized() {
        if (_SystemPromptService.isCacheValid())
          return;
        if (_SystemPromptService.initPromise) {
          await _SystemPromptService.initPromise;
          return;
        }
        await _SystemPromptService.initializeCache();
      }
      async getSystemPrompts() {
        var _a, _b, _c, _d, _e;
        try {
          if ((_a = _SystemPromptService.cache) == null ? void 0 : _a.prompts) {
            if (!_SystemPromptService.isCacheValid() && !_SystemPromptService.isBackgroundRefreshScheduled && !_SystemPromptService.isInitialLoadDone) {
              _SystemPromptService.isInitialLoadDone = true;
              this.refreshCacheInBackground();
            }
            return _SystemPromptService.cache.prompts;
          }
          await this.ensureCacheInitialized();
          return (_c = (_b = _SystemPromptService.cache) == null ? void 0 : _b.prompts) != null ? _c : [];
        } catch (error) {
          console.error("Error fetching system prompts:", error);
          return (_e = (_d = _SystemPromptService.cache) == null ? void 0 : _d.prompts) != null ? _e : [];
        }
      }
      refreshCacheInBackground() {
        if (_SystemPromptService.isBackgroundRefreshScheduled)
          return;
        _SystemPromptService.isBackgroundRefreshScheduled = true;
        setTimeout(async () => {
          try {
            await _SystemPromptService.initializeCache();
          } catch (error) {
            console.warn("[SystemSculpt] Background cache refresh failed:", error);
          } finally {
            _SystemPromptService.isBackgroundRefreshScheduled = false;
          }
        }, 0);
      }
      async getSystemPromptById(id) {
        var _a, _b, _c;
        try {
          await this.ensureCacheInitialized();
          if (_SystemPromptService.isCacheValid() && ((_a = _SystemPromptService.cache) == null ? void 0 : _a.byId[id])) {
            return _SystemPromptService.cache.byId[id];
          }
          await this.getSystemPrompts();
          return ((_b = _SystemPromptService.cache) == null ? void 0 : _b.byId[id]) || null;
        } catch (error) {
          console.error(`Error fetching system prompt ${id}:`, error);
          if ((_c = _SystemPromptService.cache) == null ? void 0 : _c.byId[id]) {
            return _SystemPromptService.cache.byId[id];
          }
          throw error;
        }
      }
      async getSystemPromptTemplate() {
        try {
          const response = await fetch(`${_SystemPromptService.systemSculptService.baseUrl}/api/v1/system-prompts/template`);
          if (!response.ok) {
            throw new Error(`Failed to fetch system prompt template: ${response.statusText}`);
          }
          const data = await response.json();
          return data.template;
        } catch (error) {
          console.error("Error fetching system prompt template:", error);
          throw error;
        }
      }
      async refreshCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
        await _SystemPromptService.initializeCache();
      }
      static clearCache() {
        _SystemPromptService.cache = null;
        _SystemPromptService.initPromise = null;
      }
    };
    SystemPromptService = _SystemPromptService;
    SystemPromptService.instance = null;
    SystemPromptService.cache = null;
    SystemPromptService.CACHE_DURATION = 4 * 60 * 60 * 1e3;
    SystemPromptService.initPromise = null;
    SystemPromptService.isInitializing = false;
    SystemPromptService.isBackgroundRefreshScheduled = false;
    SystemPromptService.localStorageKey = "systemsculpt-prompts-cache";
    SystemPromptService.isInitialLoadDone = false;
  }
});

// src/utils/errors.ts
function getErrorMessage(code, model) {
  const message = ERROR_MESSAGES[code];
  if (typeof message === "function") {
    return message(model);
  }
  return message;
}
var ERROR_CODES, ERROR_MESSAGES, SystemSculptError;
var init_errors = __esm({
  "src/utils/errors.ts"() {
    ERROR_CODES = {
      INVALID_LICENSE: "INVALID_LICENSE",
      LICENSE_EXPIRED: "LICENSE_EXPIRED",
      LICENSE_DISABLED: "LICENSE_DISABLED",
      PRO_REQUIRED: "PRO_REQUIRED",
      MODEL_UNAVAILABLE: "MODEL_UNAVAILABLE",
      MODEL_REQUEST_ERROR: "MODEL_REQUEST_ERROR",
      STREAM_ERROR: "STREAM_ERROR",
      INVALID_RESPONSE: "INVALID_RESPONSE",
      NO_IMAGE: "NO_IMAGE",
      FILE_NOT_FOUND: "FILE_NOT_FOUND",
      FILE_TOO_LARGE: "FILE_TOO_LARGE",
      UNSUPPORTED_FORMAT: "UNSUPPORTED_FORMAT",
      PROCESSING_ERROR: "PROCESSING_ERROR",
      UNKNOWN_ERROR: "UNKNOWN_ERROR",
      QUOTA_EXCEEDED: "QUOTA_EXCEEDED"
    };
    ERROR_MESSAGES = {
      [ERROR_CODES.INVALID_LICENSE]: "Invalid license key. Please check and try again.",
      [ERROR_CODES.LICENSE_EXPIRED]: "Your license has expired.",
      [ERROR_CODES.LICENSE_DISABLED]: "This license has been disabled.",
      [ERROR_CODES.PRO_REQUIRED]: "This feature requires a Pro subscription. Please upgrade.",
      [ERROR_CODES.MODEL_UNAVAILABLE]: (model) => `Model ${model || ""} is currently unavailable.`,
      [ERROR_CODES.MODEL_REQUEST_ERROR]: (model) => `Model ${model || ""} cannot process this request.`,
      [ERROR_CODES.STREAM_ERROR]: "Streaming failed. Please try again.",
      [ERROR_CODES.INVALID_RESPONSE]: "Invalid response received from server. Please try again.",
      [ERROR_CODES.UNKNOWN_ERROR]: "An unexpected error occurred. Please try again or contact support.",
      [ERROR_CODES.QUOTA_EXCEEDED]: "You have exceeded your quota. Please upgrade your plan.",
      [ERROR_CODES.NO_IMAGE]: "No image in clipboard",
      [ERROR_CODES.FILE_NOT_FOUND]: "File not found",
      [ERROR_CODES.FILE_TOO_LARGE]: "File too large (max 10MB)",
      [ERROR_CODES.UNSUPPORTED_FORMAT]: "Unsupported file format",
      [ERROR_CODES.PROCESSING_ERROR]: "Failed to process file"
    };
    SystemSculptError = class extends Error {
      constructor(message, code = ERROR_CODES.UNKNOWN_ERROR, statusCode = 500, metadata) {
        super(message);
        this.code = code;
        this.statusCode = statusCode;
        this.metadata = metadata;
        this.name = "SystemSculptError";
      }
    };
  }
});

// src/utils/ImageProcessor.ts
var _ImageProcessor, ImageProcessor;
var init_ImageProcessor = __esm({
  "src/utils/ImageProcessor.ts"() {
    init_errors();
    _ImageProcessor = class {
      static async processImage(file, app) {
        if (!file) {
          throw new SystemSculptError("File not found", "FILE_NOT_FOUND", 404);
        }
        if (file.stat.size > _ImageProcessor.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        const extension = file.extension.toLowerCase();
        if (!_ImageProcessor.SUPPORTED_FORMATS.has(extension)) {
          throw new SystemSculptError("Unsupported image format", "UNSUPPORTED_FORMAT", 415);
        }
        try {
          const arrayBuffer = await app.vault.readBinary(file);
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              const dataUrl = reader.result;
              resolve(dataUrl);
            };
            reader.onerror = () => reject(reader.error);
            const type = `image/${extension === "jpg" ? "jpeg" : extension}`;
            const blob = new Blob([arrayBuffer], { type });
            reader.readAsDataURL(blob);
          });
          return base64;
        } catch (error) {
          console.error("Image processing failed:", error);
          throw new SystemSculptError("Failed to process image", "PROCESSING_ERROR", 500);
        }
      }
      static async processClipboardImage(clipboardData) {
        const file = clipboardData.files[0];
        if (!file || !file.type.startsWith("image/")) {
          throw new SystemSculptError("No image in clipboard", "NO_IMAGE", 400);
        }
        if (file.size > this.MAX_FILE_SIZE) {
          throw new SystemSculptError("Image too large (max 10MB)", "FILE_TOO_LARGE", 413);
        }
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(reader.error);
          reader.readAsDataURL(file);
        });
      }
    };
    ImageProcessor = _ImageProcessor;
    ImageProcessor.MAX_FILE_SIZE = 10 * 1024 * 1024;
    ImageProcessor.SUPPORTED_FORMATS = new Set([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp"
    ]);
  }
});

// src/constants/api.ts
var API_BASE_URL, SYSTEMSCULPT_API_ENDPOINTS, SYSTEMSCULPT_API_HEADERS;
var init_api = __esm({
  "src/constants/api.ts"() {
    API_BASE_URL = window.location.hostname === "localhost" ? "http://localhost:3001/api/v1" : "https://api.systemsculpt.com/api/v1";
    SYSTEMSCULPT_API_ENDPOINTS = {
      LICENSE: {
        VALIDATE: (key) => `/api/v1/license/validate/${key}`
      },
      MODELS: {
        LIST: "/api/v1/models",
        GET: (modelId) => `/api/v1/models/${modelId}`
      },
      CHAT: {
        COMPLETIONS: "/api/v1/chat/completions"
      },
      SYSTEM_PROMPTS: {
        GET: (id) => `/api/v1/system-prompts/${id}`,
        LIST: "/api/v1/system-prompts"
      },
      DOCUMENTS: {
        PROCESS: "/api/v1/documents/process",
        GET: (id) => `/api/v1/documents/${id}`,
        DOWNLOAD: (id) => `/api/v1/documents/${id}/download`
      }
    };
    SYSTEMSCULPT_API_HEADERS = {
      DEFAULT: {
        "Content-Type": "application/json"
      },
      WITH_LICENSE: (licenseKey) => ({
        ...SYSTEMSCULPT_API_HEADERS.DEFAULT,
        Authorization: `Bearer ${licenseKey}`
      })
    };
  }
});

// src/services/CustomProviderService.ts
var _CustomProviderService, CustomProviderService;
var init_CustomProviderService = __esm({
  "src/services/CustomProviderService.ts"() {
    _CustomProviderService = class {
      constructor(plugin) {
        this.CACHE_DURATION = 30 * 60 * 1e3;
        this.plugin = plugin;
        this.logger = console;
      }
      async testConnection(provider) {
        const cached = _CustomProviderService.connectionTestCache.get(provider.id);
        if (cached && Date.now() - cached.result.timestamp < this.CACHE_DURATION) {
          return cached.result;
        }
        const existingPromise = _CustomProviderService.connectionTestPromises.get(provider.id);
        if (existingPromise) {
          return existingPromise;
        }
        const testPromise = this.performConnectionTest(provider);
        _CustomProviderService.connectionTestPromises.set(provider.id, testPromise);
        try {
          const result = await testPromise;
          if (result.success) {
            _CustomProviderService.connectionTestCache.set(provider.id, {
              result,
              timestamp: Date.now()
            });
          }
          return result;
        } finally {
          _CustomProviderService.connectionTestPromises.delete(provider.id);
        }
      }
      async performConnectionTest(provider) {
        try {
          const models = await this.getModels(provider);
          if (provider.endpoint.includes("openrouter.ai")) {
            await this.validateOpenRouterKey(provider, models);
          }
          return {
            success: true,
            models,
            timestamp: Date.now()
          };
        } catch (error) {
          this.logger.error("Connection test failed:", error);
          return {
            success: false,
            error: this.getErrorMessage(error),
            timestamp: Date.now()
          };
        }
      }
      async validateOpenRouterKey(provider, modelIds) {
        var _a;
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${provider.apiKey}`,
          "HTTP-Referer": "https://systemsculpt.com",
          "X-Title": "SystemSculpt AI"
        };
        const completionResponse = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers,
          body: JSON.stringify({
            model: "meta-llama/llama-3-8b-instruct:free",
            messages: [{ role: "user", content: "Hi" }],
            max_tokens: 1
          }),
          signal: AbortSignal.timeout(1e4)
        });
        if (!completionResponse.ok) {
          const errorData = await completionResponse.json().catch(() => ({}));
          if (completionResponse.status === 401) {
            throw new Error("Invalid API key. Please check your OpenRouter API key and try again.");
          } else if (completionResponse.status === 402) {
            throw new Error("Insufficient credits. Please add credits to your OpenRouter account.");
          } else if (completionResponse.status === 429) {
            throw new Error("Rate limit exceeded. Please try again in a few minutes.");
          }
          throw new Error(`API key validation failed: ${((_a = errorData.error) == null ? void 0 : _a.message) || completionResponse.statusText}`);
        }
      }
      async getModels(provider) {
        var _a, _b;
        const headers = {
          "Content-Type": "application/json"
        };
        if (provider.apiKey) {
          if (provider.endpoint.includes("openrouter.ai")) {
            headers["Authorization"] = `Bearer ${provider.apiKey}`;
            headers["HTTP-Referer"] = "https://systemsculpt.com";
            headers["X-Title"] = "SystemSculpt AI";
          } else {
            headers["Authorization"] = `Bearer ${provider.apiKey}`;
          }
        }
        let endpoint;
        if (provider.endpoint.includes("openrouter.ai")) {
          endpoint = "https://openrouter.ai/api/v1/models";
        } else {
          const baseUrl = provider.endpoint.replace(/\/+$/, "");
          endpoint = baseUrl.endsWith("/v1") ? `${baseUrl}/models` : baseUrl.endsWith("/v1/models") ? baseUrl : `${baseUrl}/v1/models`;
        }
        const response = await fetch(endpoint, {
          method: "GET",
          headers,
          signal: AbortSignal.timeout(1e4)
        });
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          if (response.status === 401) {
            throw new Error("Invalid API key. Please check your API key and try again.");
          } else if (response.status === 403) {
            throw new Error("Access denied. Please verify your API key has the correct permissions.");
          } else if (response.status === 404) {
            throw new Error("API endpoint not found. Please check the URL and try again.");
          }
          throw new Error(`HTTP error: ${((_a = errorData.error) == null ? void 0 : _a.message) || response.statusText}`);
        }
        const data = await response.json();
        return (((_b = data.data) == null ? void 0 : _b.map((model) => model.id)) || []).filter((id) => !id.toLowerCase().includes("whisper"));
      }
      getErrorMessage(error) {
        if (error instanceof Error) {
          if (error.name === "AbortError") {
            return "Connection timed out. Please check your internet connection and try again.";
          }
          return error.message;
        }
        return "An unexpected error occurred. Please try again or contact support if the issue persists.";
      }
    };
    CustomProviderService = _CustomProviderService;
    CustomProviderService.connectionTestCache = new Map();
    CustomProviderService.connectionTestPromises = new Map();
  }
});

// src/services/SystemSculptService.ts
function generateUUID() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}
var import_obsidian, _SystemSculptService, SystemSculptService;
var init_SystemSculptService = __esm({
  "src/services/SystemSculptService.ts"() {
    import_obsidian = __toModule(require("obsidian"));
    init_SystemPromptService();
    init_errors();
    init_ImageProcessor();
    init_api();
    init_CustomProviderService();
    _SystemSculptService = class {
      constructor(settings, app) {
        this.isInsideThinkTags = false;
        this.hasLoggedDevMode = false;
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
        this.app = app;
      }
      get baseUrl() {
        if (!this.hasLoggedDevMode) {
          this.hasLoggedDevMode = true;
        }
        if (this.settings.developmentMode) {
          return this.settings.serverUrl;
        }
        return "https://api.systemsculpt.com";
      }
      get extractionsDirectory() {
        var _a;
        return (_a = this.settings.extractionsDirectory) != null ? _a : "";
      }
      static getInstance(settings, app) {
        if (!_SystemSculptService.instance) {
          _SystemSculptService.instance = new _SystemSculptService(settings, app);
        } else {
          _SystemSculptService.instance.settings = settings;
          _SystemSculptService.instance.licenseKey = settings.licenseKey;
        }
        return _SystemSculptService.instance;
      }
      updateSettings(settings, plugin) {
        this.settings = settings;
        this.licenseKey = settings.licenseKey;
        if (!this.customProviderService && plugin) {
          this.customProviderService = new CustomProviderService(plugin);
        }
      }
      async makeRequest(endpoint, options = {}) {
        if (options.requiresPro && !endpoint.includes("/license/validate")) {
          const isValid = await this.validateLicense(true);
          if (!isValid) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.PRO_REQUIRED), ERROR_CODES.PRO_REQUIRED, 403);
          }
        }
        const headers = this.licenseKey ? SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey) : SYSTEMSCULPT_API_HEADERS.DEFAULT;
        const url = `${this.baseUrl}${endpoint}`;
        const response = await (0, import_obsidian.requestUrl)({
          url,
          method: options.method || "GET",
          headers: {
            ...headers,
            ...options.headers || {}
          },
          body: options.body,
          throw: false
        });
        let apiResponse;
        try {
          apiResponse = response.json;
        } catch (e) {
          throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, response.status);
        }
        if (response.status !== 200 || apiResponse.status === "error") {
          this.handleApiError(endpoint, response, apiResponse);
        }
        return apiResponse.data !== void 0 ? apiResponse.data : apiResponse;
      }
      handleApiError(endpoint, response, apiResponse) {
        if (apiResponse.error) {
          const errorCode = apiResponse.error.code || ERROR_CODES.UNKNOWN_ERROR;
          const statusCode = apiResponse.error.statusCode || response.status;
          const errorMessage = getErrorMessage(errorCode, apiResponse.error.model);
          const metadata = {};
          if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
            metadata.shouldResubmit = true;
            metadata.model = apiResponse.error.model;
          }
          throw new SystemSculptError(errorMessage, errorCode, statusCode, metadata);
        }
        throw new SystemSculptError(getErrorMessage(ERROR_CODES.UNKNOWN_ERROR), ERROR_CODES.UNKNOWN_ERROR, response.status);
      }
      async handleStreamError(response, isCustomProvider = false) {
        var _a, _b, _c, _d;
        console.error("Stream error response:", {
          status: response.status,
          statusText: response.statusText,
          contentType: response.headers.get("content-type"),
          isCustomProvider
        });
        let errorCode = ERROR_CODES.STREAM_ERROR;
        let metadata = {};
        try {
          const errorData = await response.json();
          console.error("Stream error data:", errorData);
          if (isCustomProvider) {
            metadata.rawError = errorData;
            metadata.provider = "custom";
            if (response.status === 401) {
              errorCode = ERROR_CODES.INVALID_LICENSE;
              throw new SystemSculptError(((_a = errorData.error) == null ? void 0 : _a.message) || "Invalid API key for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 429) {
              errorCode = ERROR_CODES.QUOTA_EXCEEDED;
              throw new SystemSculptError(((_b = errorData.error) == null ? void 0 : _b.message) || "Rate limit exceeded for custom provider", errorCode, response.status, metadata);
            } else if (response.status === 404) {
              errorCode = ERROR_CODES.MODEL_UNAVAILABLE;
              throw new SystemSculptError(((_c = errorData.error) == null ? void 0 : _c.message) || "Model not found or endpoint incorrect", errorCode, response.status, metadata);
            }
            throw new SystemSculptError(((_d = errorData.error) == null ? void 0 : _d.message) || response.statusText, errorCode, response.status, metadata);
          }
          if (errorData.error) {
            errorCode = errorData.error.code || ERROR_CODES.STREAM_ERROR;
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata = {
                model: errorData.error.model,
                shouldResubmit: true,
                rawError: errorData
              };
            }
          }
        } catch (e) {
          console.error("Error parsing error response:", e);
          if (e instanceof SystemSculptError) {
            throw e;
          }
          errorCode = ERROR_CODES.STREAM_ERROR;
        }
        throw new SystemSculptError(getErrorMessage(errorCode, metadata.model), errorCode, response.status, metadata);
      }
      async validateLicense(forceCheck = false) {
        if (!this.licenseKey)
          return false;
        try {
          await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
            method: "GET",
            headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
          });
          return true;
        } catch (e) {
          return false;
        }
      }
      async getModels() {
        try {
          const response = await this.makeRequest("/api/v1/models", {
            method: "GET"
          });
          if (!response || !Array.isArray(response.models)) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.INVALID_RESPONSE), ERROR_CODES.INVALID_RESPONSE, 500);
          }
          const systemsculptModels = response.models.map((model) => ({
            ...model,
            provider: "systemsculpt"
          }));
          return systemsculptModels;
        } catch (error) {
          throw error;
        }
      }
      async getTokenBalance() {
        const isValid = await this.validateLicense(true);
        if (!isValid)
          return 0;
        const licenseInfo = await this.makeRequest(SYSTEMSCULPT_API_ENDPOINTS.LICENSE.VALIDATE(this.licenseKey), {
          method: "GET",
          headers: SYSTEMSCULPT_API_HEADERS.WITH_LICENSE(this.licenseKey)
        });
        return licenseInfo.credits_balance || 0;
      }
      async getContextFileContents(filePath) {
        try {
          const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
          const cleanPath = linkText.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            if (resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
              const base64 = await ImageProcessor.processImage(resolvedFile, this.app);
              return { type: "image", base64 };
            }
            const content = await this.app.vault.read(resolvedFile);
            return content;
          }
          const fileName = cleanPath.split("/").pop();
          if (fileName) {
            const allFiles = this.app.vault.getFiles();
            const matchingFile = allFiles.find((f) => f.name === fileName);
            if (matchingFile) {
              if (matchingFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
                const base64 = await ImageProcessor.processImage(matchingFile, this.app);
                return { type: "image", base64 };
              }
              const content = await this.app.vault.read(matchingFile);
              return content;
            }
          }
          return null;
        } catch (error) {
          return null;
        }
      }
      async buildContextMessageFromFile(filePath) {
        const content = await this.getContextFileContents(filePath);
        const displayName = filePath.replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
        if (content) {
          if (typeof content === "string") {
            return {
              role: "user",
              content: `Context from ${displayName}:

${content}`,
              message_id: generateUUID()
            };
          } else if (content.type === "image") {
            return {
              role: "user",
              content: [
                {
                  type: "text",
                  text: `Context from ${displayName}:

`
                },
                {
                  type: "image_url",
                  image_url: {
                    url: `data:image/png;base64,${content.base64.replace(/^data:.*;base64,/, "")}`
                  }
                }
              ],
              message_id: generateUUID()
            };
          }
        }
        return null;
      }
      async prepareMessagesWithContext(messages, contextFiles, systemPromptType, systemPromptPath) {
        const preparedMessages = [];
        let systemPromptContent;
        if (systemPromptType === "custom" && systemPromptPath) {
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(systemPromptPath, "");
          if (resolvedFile instanceof import_obsidian.TFile) {
            systemPromptContent = await this.app.vault.read(resolvedFile);
          } else {
            const fileWithExt = this.app.vault.getAbstractFileByPath(`${systemPromptPath}.md`);
            if (fileWithExt instanceof import_obsidian.TFile) {
              systemPromptContent = await this.app.vault.read(fileWithExt);
            } else {
              const fileInSystemPromptsDir = this.app.vault.getAbstractFileByPath(`SystemSculpt/System Prompts/${systemPromptPath}.md`);
              if (fileInSystemPromptsDir instanceof import_obsidian.TFile) {
                systemPromptContent = await this.app.vault.read(fileInSystemPromptsDir);
              }
            }
          }
        } else if (systemPromptType) {
          try {
            const preset = await SystemPromptService.getInstance(this.app).getSystemPromptById(systemPromptType);
            if (preset) {
              systemPromptContent = preset.systemPrompt;
            }
          } catch (error) {
          }
        }
        if (systemPromptContent) {
          preparedMessages.push({
            role: "system",
            content: systemPromptContent,
            message_id: crypto.randomUUID(),
            systemPromptType,
            systemPromptPath
          });
        }
        const documentIds = [];
        for (const filePath of contextFiles) {
          if (filePath.startsWith("doc:")) {
            const documentId = filePath.substring(4);
            documentIds.push(documentId);
          } else {
            const contextMessage = await this.buildContextMessageFromFile(filePath);
            if (contextMessage) {
              preparedMessages.push(contextMessage);
            }
          }
        }
        if (documentIds.length > 0) {
          const firstMessage = messages[0];
          if (firstMessage) {
            firstMessage.documentContext = { documentIds };
          }
        }
        for (const msg of messages) {
          preparedMessages.push({
            role: msg.role,
            content: msg.content,
            message_id: msg.message_id || generateUUID(),
            documentContext: msg.documentContext,
            systemPromptType: msg.systemPromptType,
            systemPromptPath: msg.systemPromptPath
          });
        }
        return preparedMessages;
      }
      normalizeDataPrefix(line) {
        if (!(line == null ? void 0 : line.trim()))
          return "";
        const trimmed = line.trim();
        if (trimmed === "data:" || trimmed === "data: " || trimmed === "[DONE]" || trimmed.startsWith(": OPENROUTER")) {
          return "";
        }
        return trimmed.replace(/^(?:data:\s*)+/, "");
      }
      isValidStreamEvent(data, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _i;
        if (!data)
          return false;
        try {
          const parsed = JSON.parse(data);
          return !!(parsed && (((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || ((_i = (_h = (_g = parsed.choices) == null ? void 0 : _g[0]) == null ? void 0 : _h.delta) == null ? void 0 : _i.function_call) || parsed.error));
        } catch (e) {
          return false;
        }
      }
      processStreamLine(line, isCustomProvider = false) {
        if (!line.trim().startsWith("data:")) {
          return null;
        }
        const normalized = this.normalizeDataPrefix(line);
        return this.isValidStreamEvent(normalized, isCustomProvider) ? normalized : null;
      }
      async handleStreamEvent(event, model, isCustomProvider = false) {
        var _a, _b, _c, _d, _e, _f;
        if (!event)
          return null;
        try {
          let parsed;
          try {
            parsed = JSON.parse(event);
          } catch (parseError) {
            return null;
          }
          if (!parsed)
            return null;
          if (parsed.error) {
            const errorCode = parsed.error.code || ERROR_CODES.STREAM_ERROR;
            let errorMessage = parsed.error.message || getErrorMessage(errorCode, model);
            const metadata = {
              model,
              shouldResubmit: false,
              rawError: parsed.error,
              originalEvent: event
            };
            if (errorCode === ERROR_CODES.MODEL_UNAVAILABLE || errorCode === ERROR_CODES.MODEL_REQUEST_ERROR) {
              metadata.shouldResubmit = true;
            }
            throw new SystemSculptError(errorMessage, errorCode, parsed.error.statusCode || 500, metadata);
          }
          const content = ((_c = (_b = (_a = parsed.choices) == null ? void 0 : _a[0]) == null ? void 0 : _b.delta) == null ? void 0 : _c.content) || null;
          const reasoning = ((_f = (_e = (_d = parsed.choices) == null ? void 0 : _d[0]) == null ? void 0 : _e.delta) == null ? void 0 : _f.reasoning) || null;
          if (this.isInsideThinkTags) {
            let combinedText = "";
            if (reasoning)
              combinedText += reasoning;
            if (content)
              combinedText += content;
            const thinkEndMatch = combinedText.match(/(.*?)\s*<\/think>\s*(.*)/);
            if (thinkEndMatch) {
              this.isInsideThinkTags = false;
              return {
                reasoning: thinkEndMatch[1] || "",
                content: thinkEndMatch[2] || ""
              };
            }
            return {
              content: null,
              reasoning: combinedText || null
            };
          } else {
            if (content) {
              const thinkStartMatch = content.match(/<think>\s*(.*)/);
              if (thinkStartMatch) {
                this.isInsideThinkTags = true;
                return {
                  content: null,
                  reasoning: thinkStartMatch[1] || ""
                };
              }
            }
          }
          return { content, reasoning };
        } catch (e) {
          if (e instanceof SystemSculptError) {
            throw e;
          }
          return null;
        }
      }
      async processStreamChunk(chunk, buffer, model, isCustomProvider = false) {
        const decoded = _SystemSculptService.decoder.decode(chunk, { stream: true });
        const fullChunk = buffer + decoded;
        const lines = fullChunk.split("\n");
        const contents = [];
        const reasonings = [];
        for (let i = 0; i < lines.length - 1; i++) {
          const event = this.processStreamLine(lines[i], isCustomProvider);
          if (event) {
            const result = await this.handleStreamEvent(event, model, isCustomProvider);
            if (result) {
              if (result.content)
                contents.push(result.content);
              if (result.reasoning)
                reasonings.push(result.reasoning);
            }
          }
        }
        const newBuffer = lines[lines.length - 1].trim() ? lines[lines.length - 1] : "";
        return { newBuffer, contents, reasonings };
      }
      stripProviderPrefixes(modelId) {
        return modelId.replace(/^openrouter\//, "");
      }
      async getModelInfo(modelId) {
        var _a;
        console.log("[SystemSculpt] Getting model info:", {
          modelId,
          activeProvider: this.settings.activeProvider,
          customProviders: this.settings.customProviders.map((p) => ({
            id: p.id,
            name: p.name,
            isEnabled: p.isEnabled
          }))
        });
        try {
          const systemModels = await this.getModels();
          const baseModelId = modelId.replace(/:online$/, "");
          const isSystemModel = systemModels.some((m) => m.id === baseModelId);
          if (isSystemModel) {
            console.log("[SystemSculpt] Found as native SystemSculpt model:", modelId);
            return {
              isCustom: false,
              actualModelId: this.stripProviderPrefixes(modelId)
            };
          }
        } catch (error) {
          console.error("[SystemSculpt] Error checking system models:", error);
        }
        const activeProvider = this.settings.activeProvider;
        if (activeProvider.type !== "custom") {
          console.log("[SystemSculpt] No custom provider active but model not found in native models:", modelId);
          throw new SystemSculptError(`Model ${modelId} not found in native models and no custom provider is active`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
        }
        const customProvider = this.settings.customProviders.find((p) => p.id === activeProvider.id && p.isEnabled);
        if (!customProvider) {
          console.log("[SystemSculpt] Active custom provider not found or disabled:", activeProvider);
          throw new SystemSculptError(`Provider ${activeProvider.name} not found or disabled`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
        }
        try {
          const result = await this.customProviderService.testConnection(customProvider);
          if (!result.success || !((_a = result.models) == null ? void 0 : _a.includes(modelId))) {
            console.log("[SystemSculpt] Model not found in active custom provider:", {
              modelId,
              provider: customProvider.name,
              availableModels: result.models
            });
            throw new SystemSculptError(`Model ${modelId} not found in provider ${customProvider.name}`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
          }
        } catch (error) {
          if (error instanceof SystemSculptError)
            throw error;
          console.error("[SystemSculpt] Error verifying model in provider:", error);
          throw new SystemSculptError(`Failed to verify model ${modelId} with provider ${customProvider.name}`, ERROR_CODES.MODEL_UNAVAILABLE, 404);
        }
        console.log("[SystemSculpt] Using custom provider:", {
          id: customProvider.id,
          name: customProvider.name,
          endpoint: customProvider.endpoint,
          modelId
        });
        return {
          isCustom: true,
          provider: customProvider,
          actualModelId: modelId
        };
      }
      async handleCustomProviderCompletion(provider, messages, temperature, modelId, signal) {
        console.log("[SystemSculpt] Custom Provider Request Details:", {
          provider: {
            id: provider.id,
            name: provider.name,
            endpoint: provider.endpoint,
            isEnabled: provider.isEnabled
          },
          modelId,
          temperature,
          isOpenRouter: provider.endpoint.includes("openrouter.ai"),
          isOpenAI: provider.endpoint.includes("api.openai.com")
        });
        const endpoint = provider.endpoint.trim().replace(/\/$/, "");
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${provider.apiKey}`
        };
        if (endpoint.includes("openrouter.ai")) {
          headers["HTTP-Referer"] = "https://systemsculpt.com";
          headers["X-Title"] = "SystemSculpt AI";
        }
        const baseRequestBody = {
          model: modelId,
          messages: messages.map((msg) => ({
            role: msg.role,
            content: msg.content
          })),
          stream: true
        };
        const requestBody = {
          ...baseRequestBody,
          ...!endpoint.includes("api.openai.com") && { temperature },
          ...endpoint.includes("openrouter.ai") && {
            include_reasoning: true
          },
          ...endpoint.includes("api.openai.com") && modelId === "o3-mini" && {
            reasoning_effort: "high"
          }
        };
        if (endpoint.includes("api.openai.com") && modelId === "o3-mini") {
          console.log("Making OpenAI API call with o3-mini model:", {
            endpoint,
            modelId,
            requestBody
          });
        }
        const response = await fetch(`${endpoint}/chat/completions`, {
          method: "POST",
          headers,
          body: JSON.stringify(requestBody),
          signal
        });
        if (!response.ok) {
          await this.handleStreamError(response, true);
        }
        return response;
      }
      async *streamMessage({
        messages,
        model,
        temperature = 0.7,
        onError,
        contextFiles,
        systemPromptType,
        systemPromptPath,
        signal,
        forceSystemSculptApi = false
      }) {
        try {
          this.isInsideThinkTags = false;
          const preparedMessages = await this.prepareMessagesWithContext(messages, contextFiles || new Set(), systemPromptType, systemPromptPath);
          const { isCustom, provider, actualModelId } = forceSystemSculptApi ? { isCustom: false, provider: void 0, actualModelId: model } : await this.getModelInfo(model);
          let response;
          if (isCustom && provider) {
            response = await this.handleCustomProviderCompletion(provider, preparedMessages, temperature, actualModelId, signal);
          } else {
            const requestBody = {
              model: actualModelId,
              messages: preparedMessages,
              temperature,
              stream: true,
              include_reasoning: true
            };
            response = await fetch(`${this.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.CHAT.COMPLETIONS}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "text/event-stream",
                "Cache-Control": "no-cache",
                "X-Request-ID": crypto.randomUUID(),
                "x-license-key": this.licenseKey
              },
              body: JSON.stringify(requestBody),
              signal
            });
          }
          if (!response.ok) {
            await this.handleStreamError(response, !!provider);
          }
          if (!response.body) {
            throw new SystemSculptError(getErrorMessage(ERROR_CODES.STREAM_ERROR), ERROR_CODES.STREAM_ERROR, response.status);
          }
          const reader = response.body.getReader();
          let buffer = "";
          try {
            while (true) {
              const { done, value } = await reader.read();
              if (done) {
                const finalChunk = _SystemSculptService.decoder.decode();
                if (finalChunk) {
                  const event = this.processStreamLine(finalChunk);
                  if (event) {
                    const result = await this.handleStreamEvent(event, model, !!provider);
                    if (result) {
                      if (result.content || result.reasoning) {
                        yield {
                          content: result.content || void 0,
                          reasoning: result.reasoning || void 0
                        };
                      }
                    }
                  }
                }
                break;
              }
              const { newBuffer, contents, reasonings } = await this.processStreamChunk(value, buffer, model, !!provider);
              buffer = newBuffer;
              for (let i = 0; i < Math.max(contents.length, reasonings.length); i++) {
                yield {
                  content: contents[i],
                  reasoning: reasonings[i]
                };
              }
            }
          } finally {
            reader.releaseLock();
          }
        } catch (error) {
          if (error instanceof DOMException && error.name === "AbortError") {
            return;
          }
          if (onError) {
            let errorMessage = error instanceof Error ? error.message : getErrorMessage(ERROR_CODES.UNKNOWN_ERROR);
            if (error instanceof SystemSculptError && error.code === ERROR_CODES.STREAM_ERROR && error.statusCode === 400) {
              errorMessage += "\nPlease try again in a few moments. If the issue persists, try selecting a different model.";
            }
            onError(errorMessage);
          }
          throw error;
        }
      }
      async uploadDocument(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/documents/process`, {
            method: "POST",
            headers: {
              "x-license-key": this.licenseKey
            },
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          throw error;
        }
      }
      async uploadAudio(file) {
        try {
          const data = await this.app.vault.readBinary(file);
          const formData = new FormData();
          const blob = new Blob([data], { type: "application/octet-stream" });
          formData.append("file", blob, file.name);
          const response = await fetch(`${this.baseUrl}/api/v1/audio/transcriptions`, {
            method: "POST",
            body: formData
          });
          if (!response.ok) {
            throw new Error(`Audio upload failed: ${response.status}`);
          }
          const result = await response.json();
          return result;
        } catch (error) {
          throw error;
        }
      }
      async preloadModels() {
        return Promise.resolve();
      }
    };
    SystemSculptService = _SystemSculptService;
    SystemSculptService.decoder = new TextDecoder();
  }
});

// src/core/ui/components/LoadingIndicator.ts
var init_LoadingIndicator = __esm({
  "src/core/ui/components/LoadingIndicator.ts"() {
  }
});

// src/core/ui/components/Button.ts
var init_Button = __esm({
  "src/core/ui/components/Button.ts"() {
  }
});

// src/services/TitleGenerationService.ts
var import_obsidian2, TitleGenerationService;
var init_TitleGenerationService = __esm({
  "src/services/TitleGenerationService.ts"() {
    init_SystemSculptService();
    import_obsidian2 = __toModule(require("obsidian"));
    TitleGenerationService = class {
      constructor(plugin) {
        this.plugin = plugin;
        this.titleGenerationModel = null;
        this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
      }
      static getInstance(plugin) {
        if (!TitleGenerationService.instance) {
          TitleGenerationService.instance = new TitleGenerationService(plugin);
        }
        return TitleGenerationService.instance;
      }
      async getModel() {
        if (this.titleGenerationModel)
          return this.titleGenerationModel;
        try {
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/title-generation-prompts`);
          if (!response.ok) {
            throw new Error("Failed to fetch title generation configuration");
          }
          const data = await response.json();
          if (!data.data.model) {
            throw new Error("No title generation model configured on server");
          }
          this.titleGenerationModel = data.data.model;
          return this.titleGenerationModel;
        } catch (error) {
          console.error("Error fetching title generation model:", error);
          throw error;
        }
      }
      async generateTitle(messages, onProgress, onStatusUpdate) {
        try {
          const modelId = await this.getModel();
          if (!modelId) {
            throw new Error("Failed to get title generation model from server");
          }
          let contentXml = "";
          if (messages instanceof import_obsidian2.TFile) {
            onStatusUpdate == null ? void 0 : onStatusUpdate(20, "Reading note content...");
            const content = await this.plugin.app.vault.read(messages);
            contentXml = `<content_to_generate_title_from>
<note_title>${messages.basename}</note_title>
<note_content>
${content}
</note_content>
</content_to_generate_title_from>`;
          } else {
            onStatusUpdate == null ? void 0 : onStatusUpdate(20, "Processing chat messages...");
            const messagesToUse = messages.slice(0, 25);
            contentXml = `<content_to_generate_title_from>
${messagesToUse.map((msg) => {
              const content = typeof msg.content === "string" ? msg.content : JSON.stringify(msg.content);
              return `[${msg.role}]: ${content}`;
            }).join("\n")}
</content_to_generate_title_from>`;
          }
          onStatusUpdate == null ? void 0 : onStatusUpdate(40, "Analyzing content...");
          const promptMessages = [
            {
              role: "system",
              content: this.plugin.settings.titleGenerationPrompt,
              message_id: crypto.randomUUID()
            },
            {
              role: "user",
              content: contentXml,
              message_id: crypto.randomUUID()
            }
          ];
          let generatedTitle = "";
          onStatusUpdate == null ? void 0 : onStatusUpdate(60, "Generating title...");
          for await (const chunk of this.sculptService.streamMessage({
            messages: promptMessages,
            model: modelId,
            temperature: 0.7,
            forceSystemSculptApi: true
          })) {
            if (chunk.content) {
              generatedTitle += chunk.content;
              if (onProgress) {
                onProgress(generatedTitle.trim());
              }
            }
          }
          onStatusUpdate == null ? void 0 : onStatusUpdate(80, "Finalizing title...");
          return generatedTitle.trim();
        } catch (error) {
          console.error("Error generating title:", error);
          throw error;
        }
      }
    };
  }
});

// src/core/ui/modals/TextAreaModal.ts
var import_obsidian3, TextAreaModal;
var init_TextAreaModal = __esm({
  "src/core/ui/modals/TextAreaModal.ts"() {
    import_obsidian3 = __toModule(require("obsidian"));
    init_TitleGenerationService();
    TextAreaModal = class extends import_obsidian3.Modal {
      constructor(app, title, initialValue, options = {}) {
        super(app);
        this.title = title;
        this.initialValue = initialValue;
        this.options = options;
        this.result = null;
        this.titleGenerationService = null;
        this.generateButton = null;
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        if (options.plugin && options.messages) {
          this.titleGenerationService = TitleGenerationService.getInstance(options.plugin);
        }
      }
      onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText(this.title);
        this.titleEl.addClass("systemsculpt-modal-title");
        const textAreaContainer = contentEl.createDiv("systemsculpt-textarea-container");
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            rows: this.options.rows || 1,
            placeholder: this.options.placeholder || ""
          }
        });
        this.textArea.value = this.initialValue;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = contentEl.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: this.options.secondaryButton || "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        if (this.titleGenerationService && this.options.messages) {
          this.generateButton = buttonContainer.createEl("button", {
            text: "Generate Title",
            cls: "systemsculpt-button"
          });
          this.generateButton.onclick = async () => {
            var _a;
            if (this.generateButton) {
              this.generateButton.setAttr("disabled", "true");
              this.generateButton.setText("Generating...");
            }
            try {
              await ((_a = this.titleGenerationService) == null ? void 0 : _a.generateTitle(this.options.messages, (title) => {
                if (this.textArea) {
                  this.textArea.value = title;
                }
              }));
            } catch (error) {
              console.error("Error generating title:", error);
            } finally {
              if (this.generateButton) {
                this.generateButton.removeAttribute("disabled");
                this.generateButton.setText("Generate Title");
              }
            }
          };
        }
        const primaryButton = buttonContainer.createEl("button", {
          text: this.options.primaryButton || "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          this.result = this.textArea.value;
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && this.options.rows === 1) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/core/ui/modals/PopupModal.ts
async function showPopup(app, message, options = {}) {
  const popup = new PopupComponent(app, message, options);
  return popup.open();
}
var import_obsidian4, PopupComponent;
var init_PopupModal = __esm({
  "src/core/ui/modals/PopupModal.ts"() {
    import_obsidian4 = __toModule(require("obsidian"));
    PopupComponent = class {
      constructor(app, message, options = {}) {
        this.result = null;
        this.app = app;
        this.message = message;
        this.options = options;
      }
      createPopup() {
        this.containerEl = document.createElement("div");
        this.containerEl.addClass("systemsculpt-popup-container");
        document.body.appendChild(this.containerEl);
        const popupEl = this.containerEl.createDiv({ cls: "systemsculpt-popup" });
        const content = popupEl.createDiv({ cls: "systemsculpt-popup-content" });
        if (this.options.title) {
          const titleEl = content.createDiv({ cls: "systemsculpt-popup-title" });
          if (this.options.icon) {
            const iconEl = titleEl.createSpan({ cls: "systemsculpt-popup-icon" });
            (0, import_obsidian4.setIcon)(iconEl, this.options.icon);
          }
          titleEl.createSpan({ text: this.options.title });
        }
        if (this.message) {
          content.createDiv({
            cls: "systemsculpt-popup-message",
            text: this.message
          });
        }
        if (this.options.description) {
          content.createDiv({
            cls: "systemsculpt-popup-description",
            text: this.options.description
          });
        }
        if (this.options.inputs) {
          const inputsContainer = content.createDiv({
            cls: "systemsculpt-popup-inputs"
          });
          this.options.inputs.forEach((input) => {
            if (input.type === "textarea") {
              inputsContainer.createEl("textarea", {
                cls: `systemsculpt-popup-textarea ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            } else {
              inputsContainer.createEl("input", {
                type: input.type,
                cls: `systemsculpt-popup-input ${input.className || ""}`,
                placeholder: input.placeholder,
                value: input.value || "",
                attr: {
                  required: input.required ? true : null
                }
              });
            }
          });
        }
        const buttonContainer = popupEl.createDiv({
          cls: "systemsculpt-popup-buttons"
        });
        if (this.options.secondaryButton) {
          const secondaryButton = buttonContainer.createEl("button", {
            cls: "systemsculpt-popup-button systemsculpt-popup-button-secondary",
            text: this.options.secondaryButton
          });
          secondaryButton.addEventListener("click", () => {
            this.result = { confirmed: false };
            this.close();
          });
        }
        const primaryButton = buttonContainer.createEl("button", {
          cls: `systemsculpt-popup-button ${this.options.primaryButton === "Become A Patron" || this.options.primaryButton === "Become a Patron" ? "systemsculpt-popup-button-patron" : "systemsculpt-popup-button-primary"}`,
          text: this.options.primaryButton || "OK"
        });
        primaryButton.addEventListener("click", () => {
          if (this.options.inputs) {
            const inputs = Array.from(popupEl.querySelectorAll("input, textarea"));
            const hasEmptyRequired = inputs.some((input) => input.required && !input.value.trim());
            if (hasEmptyRequired) {
              return;
            }
            this.result = {
              confirmed: true,
              inputs: inputs.map((input) => input.value)
            };
          } else {
            this.result = { confirmed: true };
          }
          this.close();
        });
        this.containerEl.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            this.result = { confirmed: false };
            this.close();
          }
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey) {
            primaryButton.click();
          }
        });
        this.containerEl.addEventListener("mousedown", (e) => {
          if (e.target === this.containerEl) {
            this.result = { confirmed: false };
            this.close();
          }
        });
      }
      close() {
        this.containerEl.addClass("systemsculpt-popup-closing");
        setTimeout(() => {
          this.containerEl.remove();
          if (this.resolvePromise) {
            this.resolvePromise(this.result);
          }
        }, 200);
      }
      open() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.createPopup();
        });
      }
    };
  }
});

// src/core/ui/components/Notice.ts
function showEnhancedNotice(message, type, error) {
  if (error) {
    console.error("Notice error details:", {
      error,
      message: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
  }
  let duration;
  switch (type) {
    case "error":
      duration = 1e4;
      break;
    case "warning":
      duration = 5e3;
      break;
    default:
      duration = 3e3;
  }
  const notice = new import_obsidian5.Notice(message, duration);
  return notice;
}
var import_obsidian5;
var init_Notice = __esm({
  "src/core/ui/components/Notice.ts"() {
    import_obsidian5 = __toModule(require("obsidian"));
    init_errors();
  }
});

// src/core/ui/notifications.ts
function showNotice(message, options = {}) {
  const { type = "info", duration = 4e3 } = options;
  let prefix = "";
  switch (type) {
    case "success":
      prefix = "\u2728 ";
      break;
    case "error":
      prefix = "\u274C ";
      break;
    case "warning":
      prefix = "\u26A0\uFE0F ";
      break;
    case "info":
      prefix = "\u2139\uFE0F ";
      break;
  }
  new import_obsidian6.Notice(prefix + message, duration);
}
async function showAlert(app, message, options = {}) {
  const {
    title = options.type === "error" ? "Error" : options.type === "warning" ? "Warning" : "Alert",
    primaryButton = "OK",
    secondaryButton,
    icon = options.type === "error" ? "alert-circle" : options.type === "warning" ? "alert-triangle" : "info"
  } = options;
  const result = await showPopup(app, message, {
    title,
    primaryButton,
    secondaryButton,
    icon
  });
  return { confirmed: (result == null ? void 0 : result.confirmed) || false };
}
var import_obsidian6;
var init_notifications = __esm({
  "src/core/ui/notifications.ts"() {
    import_obsidian6 = __toModule(require("obsidian"));
    init_PopupModal();
  }
});

// src/core/ui/index.ts
var init_ui = __esm({
  "src/core/ui/index.ts"() {
    init_LoadingIndicator();
    init_Button();
    init_TextAreaModal();
    init_PopupModal();
    init_Notice();
    init_notifications();
  }
});

// src/components/FileSuggester.ts
function getFileSuggestions(app, directory) {
  const files = app.vault.getAllLoadedFiles().filter((file) => {
    var _a;
    if (!(file instanceof import_obsidian8.TFile))
      return false;
    const fileDir = (_a = file.parent) == null ? void 0 : _a.path;
    return fileDir === directory && file.extension === "md";
  });
  return new Set(files.map((file) => file.path));
}
function attachFileSuggester(inputEl, onSelect, app, directory) {
  return new FileSuggester(inputEl, onSelect, app, directory);
}
var import_obsidian8, FileSuggester;
var init_FileSuggester = __esm({
  "src/components/FileSuggester.ts"() {
    import_obsidian8 = __toModule(require("obsidian"));
    FileSuggester = class extends import_obsidian8.AbstractInputSuggest {
      constructor(inputEl, onSelectCb, app, directory) {
        super(app, inputEl);
        this.inputEl = inputEl;
        this.onSelectCb = onSelectCb;
        this.directory = directory;
        this.content = getFileSuggestions(app, directory);
      }
      getSuggestions(inputStr) {
        const lowerCaseInputStr = inputStr.toLowerCase();
        return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
      }
      renderSuggestion(content, el) {
        let display = content.replace(/\.md$/, "");
        el.setText(display);
      }
      selectSuggestion(content, evt) {
        this.onSelectCb(content);
        this.inputEl.value = content.replace(/\.md$/, "");
        this.inputEl.blur();
        this.close();
      }
    };
  }
});

// src/modals/TitleGenerationPromptModal.ts
var TitleGenerationPromptModal_exports = {};
__export(TitleGenerationPromptModal_exports, {
  TitleGenerationPromptModal: () => TitleGenerationPromptModal,
  showTitleGenerationPromptModal: () => showTitleGenerationPromptModal
});
async function showTitleGenerationPromptModal(app, plugin, currentPrompt, options) {
  const modal = new TitleGenerationPromptModal(app, plugin, currentPrompt, options == null ? void 0 : options.systemPromptsDirectory, options == null ? void 0 : options.currentCustomPath);
  return await modal.openAndGetValue();
}
var import_obsidian12, TitleGenerationPromptModal;
var init_TitleGenerationPromptModal = __esm({
  "src/modals/TitleGenerationPromptModal.ts"() {
    import_obsidian12 = __toModule(require("obsidian"));
    init_ui();
    init_FileSuggester();
    init_SystemSculptService();
    TitleGenerationPromptModal = class extends import_obsidian12.Modal {
      constructor(app, plugin, currentPrompt, systemPromptsDirectory = "SystemSculpt/System Prompts", currentCustomPath) {
        super(app);
        this.plugin = plugin;
        this.currentPrompt = currentPrompt;
        this.systemPromptsDirectory = systemPromptsDirectory;
        this.currentCustomPath = currentCustomPath;
        this.result = null;
        this.activePreset = "precise";
        this.prompts = [];
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        this.sculptService = SystemSculptService.getInstance(plugin.settings, app);
      }
      showLoading(show) {
        if (!this.loadingIndicator || !this.contentContainer)
          return;
        this.loadingIndicator.style.display = show ? "flex" : "none";
        this.contentContainer.style.display = show ? "none" : "block";
      }
      async loadPrompts() {
        try {
          this.showLoading(true);
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/title-generation-prompts`);
          if (!response.ok) {
            throw new Error("Failed to load prompts");
          }
          const data = await response.json();
          this.prompts = data.data.prompts;
          this.createPresetButtons();
          this.showLoading(false);
        } catch (error) {
          console.error("Failed to load title generation prompts:", error);
          this.showLoading(false);
          await showPopup(this.app, "", {
            title: "Error",
            description: "Failed to load prompts. Please try again later.",
            primaryButton: "OK"
          });
        }
      }
      createPresetButtons() {
        if (!this.presetButtonContainer)
          return;
        this.presetButtonContainer.empty();
        if (this.currentCustomPath) {
          this.activePreset = "custom";
        } else {
          this.prompts.forEach((preset) => {
            if (preset.systemPrompt === this.currentPrompt) {
              this.activePreset = preset.id;
            }
          });
        }
        this.prompts.forEach((preset) => {
          const button = this.presetButtonContainer.createEl("button", {
            text: preset.label,
            cls: "systemsculpt-preset-button"
          });
          if (preset.description) {
            button.setAttribute("aria-label", preset.description);
            button.addClass("has-tooltip");
          }
          if (preset.id === this.activePreset) {
            button.addClass("active");
            if (this.textArea) {
              this.textArea.value = preset.systemPrompt;
              this.textArea.readOnly = !preset.isUserConfigurable;
            }
          }
          button.onclick = () => {
            this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
            button.addClass("active");
            this.activePreset = preset.id;
            if (preset.id === "custom") {
              this.customSection.style.display = "block";
              this.customInput.focus();
              if (this.textArea) {
                this.textArea.readOnly = false;
              }
            } else {
              this.customSection.style.display = "none";
              if (this.textArea) {
                this.textArea.value = preset.systemPrompt;
                this.textArea.readOnly = !preset.isUserConfigurable;
              }
            }
          };
        });
        if (this.activePreset === "custom") {
          this.customSection.style.display = "block";
          if (this.currentCustomPath) {
            this.customInput.value = this.currentCustomPath;
          }
        }
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Edit Title Generation Prompt");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Configure how titles should be generated from your content");
        descriptionEl.style.color = "var(--text-muted)";
        descriptionEl.style.fontSize = "0.9em";
        descriptionEl.style.marginTop = "0.2em";
        this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
        this.loadingIndicator.style.display = "none";
        this.loadingIndicator.style.justifyContent = "center";
        this.loadingIndicator.style.alignItems = "center";
        this.loadingIndicator.style.padding = "20px";
        const loadingText = this.loadingIndicator.createSpan();
        loadingText.setText("Loading prompts...");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
        this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
        this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
        this.customSection.style.display = "none";
        const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
        const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
        inputWrapper.style.display = "flex";
        inputWrapper.style.gap = "8px";
        inputWrapper.style.alignItems = "center";
        this.customInput = inputWrapper.createEl("input", {
          type: "text",
          placeholder: "Search for a system prompt file...",
          cls: "systemsculpt-custom-input"
        });
        const createButton2 = inputWrapper.createEl("button", {
          cls: "systemsculpt-create-button"
        });
        createButton2.style.padding = "4px 8px";
        createButton2.style.borderRadius = "4px";
        createButton2.style.cursor = "pointer";
        (0, import_obsidian12.setIcon)(createButton2, "plus");
        createButton2.addEventListener("click", async () => {
          var _a, _b;
          let templateContent = "";
          try {
            const response = await fetch(`${this.sculptService.baseUrl}/api/v1/system-prompts/template`);
            if (!response.ok) {
              throw new Error("Failed to fetch template");
            }
            const data = await response.json();
            templateContent = data.template;
          } catch (error) {
            console.error("Error fetching system prompt template:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: "Failed to fetch system prompt template. Please try again later.",
              primaryButton: "OK"
            });
            return;
          }
          const result = await showPopup(this.app, "", {
            title: "Create New System Prompt",
            description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
            primaryButton: "Create",
            secondaryButton: "Cancel",
            inputs: [
              {
                type: "text",
                placeholder: "My Custom Title Generator",
                required: true,
                className: "systemsculpt-prompt-creation-title-input"
              },
              {
                type: "textarea",
                value: templateContent,
                required: true,
                className: "systemsculpt-prompt-creation-content"
              }
            ]
          });
          if (!(result == null ? void 0 : result.confirmed) || !((_a = result.inputs) == null ? void 0 : _a[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
            return;
          }
          const [title, content] = result.inputs;
          const fileName = title.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
          const filePath = `${this.systemPromptsDirectory}/${fileName}`;
          try {
            await this.app.vault.createFolder(this.systemPromptsDirectory).catch(() => {
            });
            const fileContent = `# ${title}

${content}`;
            const file = await this.app.vault.create(filePath + ".md", fileContent);
            if (!file) {
              throw new Error("Failed to create file");
            }
            if (this.textArea) {
              this.textArea.value = fileContent;
              this.textArea.readOnly = false;
            }
            this.customInput.value = filePath;
            await showPopup(this.app, "", {
              title: "Success",
              description: "System prompt file created successfully!",
              primaryButton: "OK"
            });
          } catch (error) {
            console.error("Error creating system prompt file:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: error instanceof Error ? error.message : "Failed to create system prompt file",
              primaryButton: "OK"
            });
          }
        });
        attachFileSuggester(this.customInput, async (selectedPath) => {
          try {
            const file = this.app.vault.getAbstractFileByPath(selectedPath);
            if (file instanceof import_obsidian12.TFile) {
              const content = await this.app.vault.read(file);
              this.textArea.value = content;
              this.textArea.readOnly = false;
              this.customInput.value = selectedPath.replace(/\.md$/, "");
            }
          } catch (error) {
            console.error("Error reading system prompt file:", error);
          }
        }, this.app, this.systemPromptsDirectory);
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            placeholder: "Enter title generation prompt"
          }
        });
        this.textArea.value = this.currentPrompt;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        const primaryButton = buttonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          const activePreset = this.prompts.find((p) => p.id === this.activePreset);
          this.result = {
            content: this.textArea.value,
            type: (activePreset == null ? void 0 : activePreset.id) || "custom",
            path: this.activePreset === "custom" ? this.customInput.value : void 0
          };
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
        await this.loadPrompts();
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/modals/PostProcessingPromptModal.ts
var PostProcessingPromptModal_exports = {};
__export(PostProcessingPromptModal_exports, {
  PostProcessingPromptModal: () => PostProcessingPromptModal,
  showPostProcessingPromptModal: () => showPostProcessingPromptModal
});
async function showPostProcessingPromptModal(app, plugin, currentPrompt, options) {
  const modal = new PostProcessingPromptModal(app, plugin, currentPrompt, options == null ? void 0 : options.systemPromptsDirectory, options == null ? void 0 : options.currentCustomPath);
  return await modal.openAndGetValue();
}
var import_obsidian13, PostProcessingPromptModal;
var init_PostProcessingPromptModal = __esm({
  "src/modals/PostProcessingPromptModal.ts"() {
    import_obsidian13 = __toModule(require("obsidian"));
    init_ui();
    init_FileSuggester();
    init_SystemSculptService();
    PostProcessingPromptModal = class extends import_obsidian13.Modal {
      constructor(app, plugin, currentPrompt, systemPromptsDirectory = "SystemSculpt/System Prompts", currentCustomPath) {
        super(app);
        this.plugin = plugin;
        this.currentPrompt = currentPrompt;
        this.systemPromptsDirectory = systemPromptsDirectory;
        this.currentCustomPath = currentCustomPath;
        this.result = null;
        this.activePreset = "general";
        this.prompts = [];
        this.modalEl.addClass("systemsculpt-modal", "systemsculpt-textarea-modal");
        this.sculptService = SystemSculptService.getInstance(plugin.settings, app);
      }
      showLoading(show) {
        if (!this.loadingIndicator || !this.contentContainer)
          return;
        this.loadingIndicator.style.display = show ? "flex" : "none";
        this.contentContainer.style.display = show ? "none" : "block";
      }
      async loadPrompts() {
        try {
          this.showLoading(true);
          const response = await fetch(`${this.sculptService.baseUrl}/api/v1/post-transcription-prompts`);
          if (!response.ok) {
            throw new Error("Failed to load prompts");
          }
          const data = await response.json();
          this.prompts = data.data.prompts;
          this.createPresetButtons();
          this.showLoading(false);
        } catch (error) {
          console.error("Failed to load post-transcription prompts:", error);
          this.showLoading(false);
          await showPopup(this.app, "", {
            title: "Error",
            description: "Failed to load prompts. Please try again later.",
            primaryButton: "OK"
          });
        }
      }
      createPresetButtons() {
        if (!this.presetButtonContainer)
          return;
        this.presetButtonContainer.empty();
        if (this.currentCustomPath) {
          this.activePreset = "custom";
        } else {
          this.prompts.forEach((preset) => {
            if (preset.systemPrompt === this.currentPrompt) {
              this.activePreset = preset.id;
            }
          });
        }
        this.prompts.forEach((preset) => {
          const button = this.presetButtonContainer.createEl("button", {
            text: preset.label,
            cls: "systemsculpt-preset-button"
          });
          if (preset.description) {
            button.setAttribute("aria-label", preset.description);
            button.addClass("has-tooltip");
          }
          if (preset.id === this.activePreset) {
            button.addClass("active");
            if (this.textArea) {
              this.textArea.value = preset.systemPrompt;
              this.textArea.readOnly = !preset.isUserConfigurable;
            }
          }
          button.onclick = () => {
            this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
            button.addClass("active");
            this.activePreset = preset.id;
            if (preset.id === "custom") {
              this.customSection.style.display = "block";
              this.customInput.focus();
              if (this.textArea) {
                this.textArea.readOnly = false;
              }
            } else {
              this.customSection.style.display = "none";
              if (this.textArea) {
                this.textArea.value = preset.systemPrompt;
                this.textArea.readOnly = !preset.isUserConfigurable;
              }
            }
          };
        });
        if (this.activePreset === "custom") {
          this.customSection.style.display = "block";
          if (this.currentCustomPath) {
            this.customInput.value = this.currentCustomPath;
          }
        }
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Edit Post-Processing Prompt");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Configure how your transcriptions should be post-processed");
        descriptionEl.style.color = "var(--text-muted)";
        descriptionEl.style.fontSize = "0.9em";
        descriptionEl.style.marginTop = "0.2em";
        this.loadingIndicator = contentEl.createDiv("systemsculpt-loading");
        this.loadingIndicator.style.display = "none";
        this.loadingIndicator.style.justifyContent = "center";
        this.loadingIndicator.style.alignItems = "center";
        this.loadingIndicator.style.padding = "20px";
        const loadingText = this.loadingIndicator.createSpan();
        loadingText.setText("Loading prompts...");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
        this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
        this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
        this.customSection.style.display = "none";
        const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
        const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
        inputWrapper.style.display = "flex";
        inputWrapper.style.gap = "8px";
        inputWrapper.style.alignItems = "center";
        this.customInput = inputWrapper.createEl("input", {
          type: "text",
          placeholder: "Search for a system prompt file...",
          cls: "systemsculpt-custom-input"
        });
        const createButton2 = inputWrapper.createEl("button", {
          cls: "systemsculpt-create-button"
        });
        createButton2.style.padding = "4px 8px";
        createButton2.style.borderRadius = "4px";
        createButton2.style.cursor = "pointer";
        (0, import_obsidian13.setIcon)(createButton2, "plus");
        createButton2.addEventListener("click", async () => {
          var _a, _b;
          let templateContent = "";
          try {
            const response = await fetch(`${this.sculptService.baseUrl}/api/v1/system-prompts/template`);
            if (!response.ok) {
              throw new Error("Failed to fetch template");
            }
            const data = await response.json();
            templateContent = data.template;
          } catch (error) {
            console.error("Error fetching system prompt template:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: "Failed to fetch system prompt template. Please try again later.",
              primaryButton: "OK"
            });
            return;
          }
          const result = await showPopup(this.app, "", {
            title: "Create New System Prompt",
            description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
            primaryButton: "Create",
            secondaryButton: "Cancel",
            inputs: [
              {
                type: "text",
                placeholder: "My Custom Assistant",
                required: true,
                className: "systemsculpt-prompt-creation-title-input"
              },
              {
                type: "textarea",
                value: templateContent,
                required: true,
                className: "systemsculpt-prompt-creation-content"
              }
            ]
          });
          if (!(result == null ? void 0 : result.confirmed) || !((_a = result.inputs) == null ? void 0 : _a[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
            return;
          }
          const [title, content] = result.inputs;
          const fileName = title.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
          const filePath = `${this.systemPromptsDirectory}/${fileName}`;
          try {
            await this.app.vault.createFolder(this.systemPromptsDirectory).catch(() => {
            });
            const fileContent = `# ${title}

${content}`;
            const file = await this.app.vault.create(filePath + ".md", fileContent);
            if (!file) {
              throw new Error("Failed to create file");
            }
            if (this.textArea) {
              this.textArea.value = fileContent;
              this.textArea.readOnly = false;
            }
            this.customInput.value = filePath;
            await showPopup(this.app, "", {
              title: "Success",
              description: "System prompt file created successfully!",
              primaryButton: "OK"
            });
          } catch (error) {
            console.error("Error creating system prompt file:", error);
            await showPopup(this.app, "", {
              title: "Error",
              description: error instanceof Error ? error.message : "Failed to create system prompt file",
              primaryButton: "OK"
            });
          }
        });
        attachFileSuggester(this.customInput, async (selectedPath) => {
          try {
            const file = this.app.vault.getAbstractFileByPath(selectedPath);
            if (file instanceof import_obsidian13.TFile) {
              const content = await this.app.vault.read(file);
              this.textArea.value = content;
              this.textArea.readOnly = false;
              this.customInput.value = selectedPath.replace(/\.md$/, "");
            }
          } catch (error) {
            console.error("Error reading system prompt file:", error);
          }
        }, this.app, this.systemPromptsDirectory);
        this.textArea = textAreaContainer.createEl("textarea", {
          cls: "systemsculpt-textarea",
          attr: {
            placeholder: "Enter post-processing prompt"
          }
        });
        this.textArea.value = this.currentPrompt;
        const resizeObserver = new ResizeObserver(() => {
          this.textArea.style.height = "auto";
          this.textArea.style.height = this.textArea.scrollHeight + "px";
        });
        resizeObserver.observe(this.textArea);
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        const secondaryButton = buttonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        const handleCancel = () => {
          this.result = null;
          this.close();
        };
        secondaryButton.onclick = handleCancel;
        const primaryButton = buttonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        const handleSave = () => {
          const activePreset = this.prompts.find((p) => p.id === this.activePreset);
          this.result = {
            content: this.textArea.value,
            type: (activePreset == null ? void 0 : activePreset.id) || "custom",
            path: this.activePreset === "custom" ? this.customInput.value : void 0
          };
          this.close();
        };
        primaryButton.onclick = handleSave;
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
            e.preventDefault();
            handleSave();
          } else if (e.key === "Escape") {
            e.preventDefault();
            handleCancel();
          }
        });
        this.textArea.focus();
        this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
        await this.loadPrompts();
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/modals/TitleGenerationModal.ts
var TitleGenerationModal_exports = {};
__export(TitleGenerationModal_exports, {
  PersistentTitleNotice: () => PersistentTitleNotice,
  TitleGenerationModal: () => TitleGenerationModal,
  showTitleGenerationModal: () => showTitleGenerationModal
});
async function showTitleGenerationModal(app, plugin, initialValue, content) {
  const modal = new TitleGenerationModal(app, plugin, initialValue, content);
  return await modal.openAndGetValue();
}
var import_obsidian33, PersistentTitleNotice, TitleGenerationModal;
var init_TitleGenerationModal = __esm({
  "src/modals/TitleGenerationModal.ts"() {
    import_obsidian33 = __toModule(require("obsidian"));
    init_ui();
    init_TitleGenerationService();
    PersistentTitleNotice = class extends import_obsidian33.Notice {
      constructor() {
        super("", 0);
        this.noticeEl.addClass("systemsculpt-title-notice");
        const progressContainer = this.noticeEl.createDiv("title-progress");
        const statusContainer = progressContainer.createDiv("title-status");
        this.statusIcon = statusContainer.createDiv("title-status-icon");
        this.statusText = statusContainer.createDiv("title-status-text");
        const progressBarContainer = progressContainer.createDiv("title-progress-bar-container");
        this.progressBar = progressBarContainer.createDiv("title-progress-bar");
        if (!document.getElementById("systemsculpt-title-notice-styles")) {
          const style = document.createElement("style");
          style.id = "systemsculpt-title-notice-styles";
          style.textContent = `
        .systemsculpt-title-notice {
          padding: 8px 12px !important;
          min-width: 260px;
        }

        .title-progress {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .title-status {
          display: flex;
          align-items: center;
          gap: 8px;
          color: var(--text-normal);
        }

        .title-status-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--text-accent);
        }

        .title-status-text {
          flex: 1;
          font-size: 14px;
        }

        .title-progress-bar-container {
          width: 100%;
          height: 4px;
          background: var(--background-modifier-border);
          border-radius: 2px;
          overflow: hidden;
        }

        .title-progress-bar {
          height: 100%;
          background: var(--text-accent);
          border-radius: 2px;
          transition: width 0.3s ease;
          width: 0%;
        }

        .notice-success .title-progress-bar {
          background: var(--text-success) !important;
        }

        .notice-error .title-progress-bar {
          background: var(--text-error) !important;
        }
      `;
          document.head.appendChild(style);
        }
      }
      updateProgress(progress, status) {
        this.progressBar.style.width = `${progress}%`;
        this.statusText.setText(status);
        this.statusIcon.empty();
        let icon = "wand-2";
        if (progress === 100) {
          icon = "check-circle";
          this.noticeEl.addClass("notice-success");
        } else if (progress === 0 && status.startsWith("Error")) {
          icon = "x-circle";
          this.noticeEl.addClass("notice-error");
        }
        (0, import_obsidian33.setIcon)(this.statusIcon, icon);
      }
    };
    TitleGenerationModal = class extends import_obsidian33.Modal {
      constructor(app, plugin, initialValue, content) {
        super(app);
        this.plugin = plugin;
        this.initialValue = initialValue;
        this.content = content;
        this.result = null;
        this.isGenerating = false;
        this.modalEl.addClass("systemsculpt-modal");
        this.titleGenerationService = TitleGenerationService.getInstance(plugin);
      }
      async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass("systemsculpt-modal-content");
        this.titleEl.setText("Change Chat Title");
        this.titleEl.addClass("systemsculpt-modal-title");
        const descriptionEl = this.titleEl.createDiv();
        descriptionEl.addClass("systemsculpt-modal-description");
        descriptionEl.setText("Enter a title manually or generate one based on your chat");
        this.contentContainer = contentEl.createDiv("systemsculpt-content-container");
        const titleContainer = this.contentContainer.createDiv();
        titleContainer.style.cssText = `
      margin: 16px 0;
      position: relative;
    `;
        this.titleInput = titleContainer.createEl("input", {
          cls: "systemsculpt-title-input",
          value: this.initialValue
        });
        this.titleInput.style.cssText = `
      width: 100%;
      padding: 12px 16px;
      border-radius: 8px;
      background: var(--background-secondary);
      border: 1px solid var(--background-modifier-border);
      font-size: 1.1em;
      font-weight: 500;
      color: var(--text-normal);
      transition: all 0.2s ease;
    `;
        this.titleInput.addEventListener("mouseover", () => {
          if (!this.isGenerating) {
            this.titleInput.style.borderColor = "var(--background-modifier-border-hover)";
          }
        });
        this.titleInput.addEventListener("mouseout", () => {
          if (!this.isGenerating) {
            this.titleInput.style.borderColor = "var(--background-modifier-border)";
          }
        });
        this.titleInput.addEventListener("focus", () => {
          if (!this.isGenerating) {
            this.titleInput.style.borderColor = "var(--interactive-accent)";
            this.titleInput.style.boxShadow = "0 0 0 2px var(--background-modifier-border-hover)";
          }
        });
        this.titleInput.addEventListener("blur", () => {
          if (!this.isGenerating) {
            this.titleInput.style.borderColor = "var(--background-modifier-border)";
            this.titleInput.style.boxShadow = "none";
          }
        });
        const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
        buttonContainer.style.marginTop = "20px";
        this.generateButton = buttonContainer.createEl("button", {
          cls: "systemsculpt-button mod-cta"
        });
        this.updateGenerateButton();
        this.generateButton.onclick = async () => {
          if (this.isGenerating) {
            return;
          }
          await this.generateTitle();
        };
        const secondaryButtonContainer = buttonContainer.createDiv();
        secondaryButtonContainer.style.display = "flex";
        secondaryButtonContainer.style.gap = "8px";
        const cancelButton = secondaryButtonContainer.createEl("button", {
          text: "Cancel",
          cls: "systemsculpt-button"
        });
        cancelButton.onclick = () => {
          this.result = null;
          this.close();
        };
        const saveButton = secondaryButtonContainer.createEl("button", {
          text: "Save",
          cls: "systemsculpt-button mod-cta"
        });
        saveButton.onclick = () => {
          this.result = this.titleInput.value;
          this.close();
        };
        this.modalEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.isComposing && !e.shiftKey) {
            e.preventDefault();
            if (e.metaKey || e.ctrlKey) {
              if (!this.isGenerating) {
                this.generateTitle();
              }
            } else {
              this.result = this.titleInput.value;
              this.close();
            }
          } else if (e.key === "Escape") {
            e.preventDefault();
            this.result = null;
            this.close();
          }
        });
        this.titleInput.focus();
        this.titleInput.select();
      }
      updateGenerateButton() {
        this.generateButton.empty();
        const buttonContent = this.generateButton.createDiv();
        buttonContent.style.display = "flex";
        buttonContent.style.alignItems = "center";
        buttonContent.style.gap = "8px";
        if (this.isGenerating) {
          const loaderIcon = buttonContent.createDiv();
          (0, import_obsidian33.setIcon)(loaderIcon, "loader-2");
          loaderIcon.style.animation = "spin 1s linear infinite";
          buttonContent.createSpan({ text: "Generating..." });
          this.generateButton.setAttribute("disabled", "true");
          this.titleInput.setAttribute("disabled", "true");
          this.titleInput.style.opacity = "0.7";
        } else {
          (0, import_obsidian33.setIcon)(buttonContent, "wand-2");
          buttonContent.createSpan({ text: "Generate Title" });
          this.generateButton.removeAttribute("disabled");
          this.titleInput.removeAttribute("disabled");
          this.titleInput.style.opacity = "1";
        }
      }
      createProgressBar() {
        const progressContainer = this.contentContainer.createDiv("systemsculpt-progress-container");
        progressContainer.style.display = "none";
        progressContainer.style.marginTop = "12px";
        progressContainer.style.marginBottom = "12px";
        progressContainer.style.position = "relative";
        const progressBar = progressContainer.createDiv("systemsculpt-progress-bar");
        progressBar.style.height = "4px";
        progressBar.style.backgroundColor = "var(--interactive-accent)";
        progressBar.style.width = "0%";
        progressBar.style.transition = "width 0.5s ease";
        progressBar.style.borderRadius = "2px";
        const progressBg = progressContainer.createDiv("systemsculpt-progress-bg");
        progressBg.style.position = "absolute";
        progressBg.style.top = "0";
        progressBg.style.left = "0";
        progressBg.style.right = "0";
        progressBg.style.height = "4px";
        progressBg.style.backgroundColor = "var(--background-modifier-border)";
        progressBg.style.borderRadius = "2px";
        progressBg.style.zIndex = "-1";
        const progressText = progressContainer.createDiv("systemsculpt-progress-text");
        progressText.style.marginTop = "8px";
        progressText.style.fontSize = "0.9em";
        progressText.style.color = "var(--text-muted)";
        progressText.style.textAlign = "center";
        let isAnimating = true;
        return {
          progressContainer,
          progressBar,
          progressText,
          stop: () => {
            isAnimating = false;
          },
          isAnimating: () => isAnimating
        };
      }
      async startProgressAnimation(progress) {
        const stages = [
          { progress: 25, text: "Analyzing contents..." },
          { progress: 50, text: "Identifying categories..." },
          { progress: 75, text: "Sorting by importance..." },
          { progress: 90, text: "Choosing best of 5 titles..." }
        ];
        for (const stage of stages) {
          if (!progress.isAnimating())
            break;
          progress.progressBar.style.width = `${stage.progress}%`;
          progress.progressText.setText(stage.text);
          await new Promise((resolve) => setTimeout(resolve, 1e3));
        }
      }
      async generateTitle() {
        this.isGenerating = true;
        this.updateGenerateButton();
        let notice = null;
        let progressBar = null;
        if (this.plugin.settings.automaticTitleGeneration) {
          notice = new PersistentTitleNotice();
          notice.updateProgress(0, "Analyzing content...");
        } else {
          progressBar = this.createProgressBar();
          progressBar.progressContainer.style.display = "block";
          this.startProgressAnimation(progressBar);
        }
        try {
          await this.titleGenerationService.generateTitle(this.content, (title) => {
            this.titleInput.value = title;
            if (notice) {
              notice.updateProgress(100, "Title generated!");
              setTimeout(() => notice == null ? void 0 : notice.hide(), 2e3);
            } else if (progressBar) {
              progressBar.stop();
              progressBar.progressBar.style.width = "100%";
              progressBar.progressText.setText("Finalizing title...");
            }
          }, (progress, status) => {
            if (notice) {
              notice.updateProgress(progress, status);
            }
          });
        } catch (error) {
          console.error("Error generating title:", error);
          if (notice) {
            notice.updateProgress(0, `Error: ${error}`);
            setTimeout(() => notice == null ? void 0 : notice.hide(), 4e3);
          } else {
            showEnhancedNotice("Failed to generate title", "error", error);
          }
        } finally {
          this.isGenerating = false;
          this.updateGenerateButton();
          if (!notice && progressBar) {
            this.titleInput.focus();
            this.titleInput.select();
            progressBar.progressContainer.remove();
          }
        }
      }
      onClose() {
        const { contentEl } = this;
        contentEl.empty();
        if (this.resolvePromise) {
          this.resolvePromise(this.result);
        }
      }
      async openAndGetValue() {
        return new Promise((resolve) => {
          this.resolvePromise = resolve;
          this.open();
        });
      }
    };
  }
});

// src/main.ts
__export(exports, {
  default: () => SystemSculptPlugin
});
var import_obsidian36 = __toModule(require("obsidian"));

// src/types/llm.ts
var DEFAULT_FILTER_SETTINGS = {
  showVisionModels: false,
  showReasoningModels: false,
  showCreativeModels: false
};

// src/types.ts
var PATREON_URL = "https://www.patreon.com/systemsculpt/membership";
var DEFAULT_SETTINGS = {
  licenseKey: "",
  licenseValid: false,
  selectedModelId: "",
  chatsDirectory: "SystemSculpt/Chats",
  lastValidated: 0,
  systemPrompt: "You are a helpful AI assistant. You help users with their questions and tasks in a clear and concise way.",
  recordingsDirectory: "SystemSculpt/Recordings",
  developmentMode: false,
  preferredMicrophoneId: "",
  autoTranscribeRecordings: true,
  autoPasteTranscription: true,
  postProcessingPrompt: "You are a transcription post-processor. Your task is to fix any transcription errors, correct grammar and punctuation, and ensure the text is properly formatted. Keep the original meaning intact while making the text more readable.",
  postProcessingEnabled: false,
  showModelTooltips: false,
  showVisionModelsOnly: false,
  showTopPicksOnly: false,
  selectedProvider: "all",
  serverUrl: "http://localhost:3001",
  attachmentsDirectory: "SystemSculpt/Attachments",
  extractionsDirectory: "SystemSculpt/Extractions",
  systemPromptsDirectory: "SystemSculpt/System Prompts",
  tasksDirectory: "SystemSculpt/Tasks",
  moveCompletedTasksDown: true,
  systemPromptType: "general-use",
  systemPromptPath: "",
  titleGenerationPrompt: "You are a specialized title generation assistant focused on creating precise, meaningful titles.",
  titleGenerationPromptType: "precise",
  titleGenerationPromptPath: "",
  automaticTitleGeneration: false,
  customProviders: [],
  modelFilterSettings: DEFAULT_FILTER_SETTINGS,
  favoriteModels: [],
  favoriteChats: [],
  activeProvider: {
    id: "systemsculpt",
    name: "SystemSculpt",
    type: "native"
  }
};

// src/main.ts
init_SystemSculptService();

// src/modals/SettingsTab.ts
var import_obsidian14 = __toModule(require("obsidian"));
init_ui();
init_SystemSculptService();

// src/components/FolderSuggester.ts
var import_obsidian7 = __toModule(require("obsidian"));
var FolderSuggester = class extends import_obsidian7.AbstractInputSuggest {
  constructor(inputEl, onSelectCb, app) {
    super(app, inputEl);
    this.inputEl = inputEl;
    this.onSelectCb = onSelectCb;
    this.content = getFolderSuggestions(app);
  }
  getSuggestions(inputStr) {
    const lowerCaseInputStr = inputStr.toLowerCase();
    return [...this.content].filter((content) => content.toLowerCase().includes(lowerCaseInputStr));
  }
  renderSuggestion(content, el) {
    el.setText(content);
  }
  selectSuggestion(content, evt) {
    this.onSelectCb(content);
    this.inputEl.value = content;
    this.inputEl.blur();
    this.close();
  }
};
function getFolderSuggestions(app) {
  const folders = app.vault.getAllLoadedFiles().filter((file) => file instanceof import_obsidian7.TFolder);
  return new Set(folders.map((folder) => folder.path));
}
function attachFolderSuggester(inputEl, onSelect, app) {
  return new FolderSuggester(inputEl, onSelect, app);
}

// src/modals/DefaultSystemPromptModal.ts
var import_obsidian11 = __toModule(require("obsidian"));
init_FileSuggester();
init_ui();
init_SystemPromptService();

// src/modals/ModelSelectionModal.ts
var import_obsidian10 = __toModule(require("obsidian"));

// src/services/SearchService.ts
var SearchService = class {
  constructor() {
    this.DEFAULT_INITIAL_RESULTS_LIMIT = 25;
    this.DEFAULT_MAX_FILTERED_RESULTS = 50;
  }
  search(items, query, getSearchableFields, options) {
    var _a, _b;
    const initialLimit = (_a = options == null ? void 0 : options.initialResultsLimit) != null ? _a : this.DEFAULT_INITIAL_RESULTS_LIMIT;
    const maxFiltered = (_b = options == null ? void 0 : options.maxFilteredResults) != null ? _b : this.DEFAULT_MAX_FILTERED_RESULTS;
    if (!query.trim()) {
      return items.slice(0, initialLimit).map((item) => ({
        item,
        matches: [],
        score: 0
      }));
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
    const results = items.map((item) => {
      const fields = getSearchableFields(item);
      const matches = [];
      let totalScore = 0;
      const searchText = fields.map((f) => {
        var _a2;
        return ((_a2 = f.text) == null ? void 0 : _a2.toLowerCase()) || "";
      }).join(" ");
      const allTermsExist = searchTerms.every((term) => searchText.includes(term));
      if (!allTermsExist) {
        return { item, matches: [], score: 0 };
      }
      searchTerms.forEach((term) => {
        var _a2;
        let pos = 0;
        const termMatches = new Set();
        while ((pos = searchText.indexOf(term, pos)) !== -1) {
          let currentPos = 0;
          for (const field of fields) {
            const fieldText = ((_a2 = field.text) == null ? void 0 : _a2.toLowerCase()) || "";
            const fieldEnd = currentPos + fieldText.length;
            if (pos >= currentPos && pos < fieldEnd) {
              const relativePos = pos - currentPos;
              const quality = this.getMatchQuality(fieldText, term, relativePos);
              matches.push({
                field: field.field,
                text: field.text || "",
                indices: Array.from({ length: term.length }, (_, i) => relativePos + i),
                matchQuality: quality
              });
              totalScore += field.weight * quality;
              break;
            }
            currentPos = fieldEnd + 1;
          }
          pos += 1;
        }
      });
      if (searchTerms.length > 1 && matches.length > 0) {
        const positions = matches.flatMap((m) => m.indices[0]);
        const maxDistance = Math.max(...positions) - Math.min(...positions);
        if (maxDistance < 50) {
          totalScore *= 1.5;
        }
      }
      return {
        item,
        matches,
        score: totalScore
      };
    });
    return results.filter((result) => result.score > 0).sort((a, b) => b.score - a.score).slice(0, maxFiltered);
  }
  getMatchQuality(text, term, position) {
    const beforeChar = position > 0 ? text[position - 1] : " ";
    const afterChar = position + term.length < text.length ? text[position + term.length] : " ";
    if ((/\s/.test(beforeChar) || /\W/.test(beforeChar)) && (/\s/.test(afterChar) || /\W/.test(afterChar))) {
      return 1;
    }
    return 0.8;
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const searchTerms = searchQuery.toLowerCase().trim().split(/\s+/).filter(Boolean);
    const regex = new RegExp(`(${searchTerms.map((term) => this.escapeRegExp(term)).join("|")})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-search-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
    }
    return fragment;
  }
  escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }
};

// src/modals/ModelSelectionHelper.ts
var ModelSelectionHelper = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.logger = console;
    this.filterSettings = { ...this.plugin.settings.modelFilterSettings };
  }
  getFilterSettings() {
    return this.filterSettings;
  }
  async setFilterSetting(key, value) {
    this.filterSettings[key] = value;
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  async resetFilterSettings() {
    this.filterSettings = { ...DEFAULT_FILTER_SETTINGS };
    this.plugin.settings.modelFilterSettings = { ...this.filterSettings };
    await this.plugin.saveSettings();
  }
  formatPrice(price) {
    try {
      if (price === null || price === void 0 || price === "0") {
        return "Free";
      }
      const numericPrice = typeof price === "string" ? parseFloat(price) : price;
      if (isNaN(numericPrice) || numericPrice === 0) {
        return "Free";
      }
      const pricePerMillion = numericPrice * 1e6;
      return `$${pricePerMillion.toFixed(2)}`;
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error formatting price", {
        price,
        error
      });
      return "Price error";
    }
  }
  highlightText(text, matches = [], searchQuery) {
    if (!matches || matches.length === 0 || !searchQuery) {
      const fragment2 = document.createDocumentFragment();
      fragment2.textContent = text;
      return fragment2;
    }
    const fragment = document.createDocumentFragment();
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        const textNode = document.createTextNode(text.slice(lastIndex, match.index));
        fragment.appendChild(textNode);
      }
      const span = document.createElement("span");
      span.className = "systemsculpt-model-highlight";
      span.textContent = match[0];
      fragment.appendChild(span);
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      const textNode = document.createTextNode(text.slice(lastIndex));
      fragment.appendChild(textNode);
    }
    return fragment;
  }
  sortModels(models) {
    const tiers = {
      favorites: [],
      essential: [],
      advanced: [],
      professional: [],
      custom: []
    };
    models.forEach((model) => {
      if (model.isFavorite) {
        tiers.favorites.push(model);
        return;
      }
      if (model.provider === "custom") {
        tiers.custom.push(model);
      } else {
      }
    });
    Object.values(tiers).forEach((tierModels) => {
      tierModels.sort((a, b) => a.name.localeCompare(b.name));
    });
    const sortedModels = [];
    if (tiers.favorites.length > 0) {
      sortedModels.push(...tiers.favorites);
    }
    sortedModels.push(...tiers.essential);
    sortedModels.push(...tiers.advanced);
    sortedModels.push(...tiers.professional);
    sortedModels.push(...tiers.custom);
    return sortedModels;
  }
  filterModels(models) {
    try {
      return models.filter((model) => {
        var _a, _b, _c;
        try {
          const hasVisionCapability = ((_a = model.capabilities) == null ? void 0 : _a.includes("vision")) || false;
          const hasReasoningCapability = ((_b = model.capabilities) == null ? void 0 : _b.includes("reasoning")) || false;
          const hasCreativeCapability = ((_c = model.capabilities) == null ? void 0 : _c.includes("creative")) || false;
          if (!Object.values(this.filterSettings).some((value) => value)) {
            return true;
          }
          return (!this.filterSettings.showVisionModels || hasVisionCapability) && (!this.filterSettings.showReasoningModels || hasReasoningCapability) && (!this.filterSettings.showCreativeModels || hasCreativeCapability);
        } catch (error) {
          this.logger.error("ModelSelectionHelper: Error filtering individual model", {
            model,
            error
          });
          return false;
        }
      });
    } catch (error) {
      this.logger.error("ModelSelectionHelper: Error in filterModels", error);
      return models;
    }
  }
};

// src/modals/CustomProviderModal.ts
var import_obsidian9 = __toModule(require("obsidian"));
var CustomProviderManagerModal = class extends import_obsidian9.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  renderProviderCard(provider, container) {
    const card = container.createDiv("systemsculpt-custom-provider-card");
    const header = card.createDiv("systemsculpt-custom-provider-card-header");
    header.createEl("h3", {
      text: provider.name,
      cls: "systemsculpt-custom-provider-card-name"
    });
    const actions = header.createDiv("systemsculpt-custom-provider-card-actions");
    const deleteBtn = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-card-action delete"
    });
    (0, import_obsidian9.setIcon)(deleteBtn, "trash-2");
    deleteBtn.addEventListener("click", async (e) => {
      e.stopPropagation();
      this.plugin.settings.customProviders = this.plugin.settings.customProviders.filter((p) => p.id !== provider.id);
      await this.plugin.saveSettings();
      await this.plugin.modelService.refreshModels();
      this.renderProviderList();
    });
    const details = card.createDiv("systemsculpt-custom-provider-card-details");
    const typeDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian9.setIcon)(typeDetail.createSpan(), "box");
    typeDetail.createSpan({
      text: "OpenAI Compatible"
    });
    const endpointDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    (0, import_obsidian9.setIcon)(endpointDetail.createSpan(), "link");
    endpointDetail.createSpan({ text: provider.endpoint });
    const statusDetail = details.createDiv("systemsculpt-custom-provider-card-detail");
    const toggleContainer = statusDetail.createDiv({
      cls: "systemsculpt-custom-provider-toggle-container"
    });
    toggleContainer.createSpan({
      text: provider.isEnabled ? "Enabled" : "Disabled",
      cls: "systemsculpt-custom-provider-toggle-label"
    });
    const toggle = toggleContainer.createDiv({
      cls: `checkbox-container ${provider.isEnabled ? "is-enabled" : ""}`
    });
    toggle.createDiv({ cls: "checkbox-toggle" });
    toggle.addEventListener("click", async (e) => {
      e.stopPropagation();
      if (provider.isEnabled) {
        provider.isEnabled = false;
        await this.plugin.saveSettings();
        await this.plugin.modelService.refreshModels();
        this.renderProviderList();
        return;
      }
      toggle.addClass("testing");
      const result = await this.plugin.customProviderService.testConnection(provider);
      toggle.removeClass("testing");
      if (result.success) {
        provider.isEnabled = true;
        await this.plugin.saveSettings();
        await this.plugin.modelService.refreshModels();
        this.renderProviderList();
      } else {
        new import_obsidian9.Notice(`Failed to enable ${provider.name}: ${result.error || "Connection failed"}`, 5e3);
      }
    });
  }
  renderProviderList() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-manager-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-manager-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-back"
    });
    (0, import_obsidian9.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Models" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Custom Providers" });
    const content = contentEl.createDiv("systemsculpt-custom-provider-manager-content");
    const listContainer = content.createDiv("systemsculpt-custom-provider-manager-list");
    const providers = this.plugin.settings.customProviders;
    if (providers.length === 0) {
      const emptyState = listContainer.createDiv("systemsculpt-custom-provider-manager-empty");
      const emptyIcon = emptyState.createDiv("systemsculpt-custom-provider-manager-empty-icon");
      (0, import_obsidian9.setIcon)(emptyIcon, "server-off");
      emptyState.createDiv({
        cls: "systemsculpt-custom-provider-manager-empty-text",
        text: "No custom providers added yet"
      });
    } else {
      providers.forEach((provider) => {
        this.renderProviderCard(provider, listContainer);
      });
    }
    const actions = content.createDiv("systemsculpt-custom-provider-manager-actions");
    const addButton = actions.createEl("button", {
      cls: "systemsculpt-custom-provider-manager-button systemsculpt-custom-provider-manager-button-primary",
      text: "Add Provider"
    });
    (0, import_obsidian9.setIcon)(addButton.createSpan(), "plus");
    addButton.addEventListener("click", () => {
      this.close();
      const customProviderModal = new CustomProviderModal(this.app, this.plugin, () => {
        const managerModal = new CustomProviderManagerModal(this.app, this.plugin, this.onBack);
        managerModal.open();
      });
      customProviderModal.open();
    });
  }
  onOpen() {
    this.renderProviderList();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var CustomProviderModal = class extends import_obsidian9.Modal {
  constructor(app, plugin, onBack) {
    super(app);
    this.plugin = plugin;
    this.logger = console;
    this.onBack = onBack;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-custom-provider-modal");
    const header = contentEl.createDiv("systemsculpt-custom-provider-header");
    const backButton = header.createEl("button", {
      cls: "systemsculpt-custom-provider-back"
    });
    (0, import_obsidian9.setIcon)(backButton.createSpan(), "arrow-left");
    backButton.createSpan({ text: "Back to Providers" });
    backButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    header.createEl("h2", { text: "Add Custom Provider" });
    const form = contentEl.createDiv("systemsculpt-custom-provider-form");
    const nameGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    nameGroup.createEl("label", { text: "Provider Name" });
    const nameInput = nameGroup.createEl("input", {
      type: "text",
      placeholder: "e.g., LM Studio, OpenAI",
      attr: {
        maxlength: "25"
      }
    });
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const urlGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    urlGroup.createEl("label", { text: "API Endpoint URL" });
    const presetContainer = urlGroup.createDiv("systemsculpt-custom-provider-presets");
    presetContainer.createEl("label", { text: "Quick Setup:" });
    const presetButtons = presetContainer.createDiv("systemsculpt-custom-provider-preset-buttons");
    const openAIButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenAI"
    });
    openAIButton.addEventListener("click", () => {
      nameInput.value = "OpenAI";
      urlInput.value = "https://api.openai.com/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const openRouterButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "OpenRouter"
    });
    openRouterButton.addEventListener("click", () => {
      nameInput.value = "OpenRouter";
      urlInput.value = "https://openrouter.ai/api/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const groqButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Groq"
    });
    groqButton.addEventListener("click", () => {
      nameInput.value = "Groq";
      urlInput.value = "https://api.groq.com/openai/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const lmStudioButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "LM Studio"
    });
    lmStudioButton.addEventListener("click", () => {
      nameInput.value = "LM Studio";
      urlInput.value = "http://localhost:1234/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const ollamaButton = presetButtons.createEl("button", {
      cls: "systemsculpt-custom-provider-button-secondary",
      text: "Ollama"
    });
    ollamaButton.addEventListener("click", () => {
      nameInput.value = "Ollama";
      urlInput.value = "http://localhost:11434/v1";
      apiKeyInput.value = "";
      resetValidation();
    });
    const urlInput = urlGroup.createEl("input", {
      type: "text",
      placeholder: "https://your-api-endpoint.com"
    });
    const urlError = urlGroup.createDiv({
      cls: "systemsculpt-custom-provider-error systemsculpt-custom-provider-error-hidden",
      text: " "
    });
    const validateEndpointUrl = (url) => {
      try {
        const parsedUrl = new URL(url);
        const isLocal = parsedUrl.hostname === "localhost" || parsedUrl.hostname === "127.0.0.1";
        if (isLocal && parsedUrl.protocol !== "http:") {
          return { isValid: false, error: "Local endpoints must use HTTP" };
        }
        if (!isLocal && parsedUrl.protocol !== "https:") {
          return { isValid: false, error: "Remote endpoints must use HTTPS" };
        }
        if (isLocal && !parsedUrl.port) {
          return {
            isValid: false,
            error: "Local endpoints require a port number"
          };
        }
        return { isValid: true };
      } catch (e) {
        return { isValid: false, error: "Invalid URL format" };
      }
    };
    const apiKeyGroup = form.createDiv("systemsculpt-custom-provider-form-group");
    apiKeyGroup.createEl("label", { text: "API Key (Optional)" });
    const apiKeyInput = apiKeyGroup.createEl("input", {
      type: "password",
      placeholder: "Enter your API key"
    });
    const resetValidation = () => {
      isConnectionTested = false;
      testResult = null;
      updateButtonState("test");
      urlError.addClass("systemsculpt-custom-provider-error-hidden");
      urlError.removeClass("systemsculpt-custom-provider-success");
    };
    nameInput.addEventListener("input", resetValidation);
    urlInput.addEventListener("input", resetValidation);
    apiKeyInput.addEventListener("input", resetValidation);
    nameInput.addEventListener("input", () => {
      const value = nameInput.value;
      const formattedValue = value.split(" ").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      if (formattedValue !== value) {
        nameInput.value = formattedValue;
      }
    });
    const formActions = form.createDiv("systemsculpt-custom-provider-form-actions");
    const cancelButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-secondary",
      text: "Cancel"
    });
    cancelButton.addEventListener("click", () => {
      this.close();
      this.onBack();
    });
    const actionButton = formActions.createEl("button", {
      cls: "systemsculpt-custom-provider-button systemsculpt-custom-provider-button-primary",
      text: "Test Connection"
    });
    let isConnectionTested = false;
    let testResult = null;
    const createProviderFromForm = () => ({
      id: crypto.randomUUID(),
      name: nameInput.value.trim(),
      endpoint: urlInput.value.trim(),
      apiKey: apiKeyInput.value.trim(),
      isEnabled: true,
      lastTested: Date.now()
    });
    const updateButtonState = (state) => {
      switch (state) {
        case "test":
          actionButton.setText("Test Connection");
          actionButton.removeAttribute("disabled");
          break;
        case "testing":
          actionButton.setText("Testing...");
          actionButton.setAttribute("disabled", "true");
          break;
        case "retry":
          actionButton.setText("Try Again");
          actionButton.removeAttribute("disabled");
          break;
        case "save":
          actionButton.setText("Save Provider");
          actionButton.removeAttribute("disabled");
          break;
      }
    };
    const validateForm = () => {
      if (!nameInput.value.trim()) {
        return { isValid: false, error: "Provider name is required" };
      }
      const urlValidation = validateEndpointUrl(urlInput.value);
      if (!urlValidation.isValid) {
        return urlValidation;
      }
      const isLocal = urlInput.value.includes("localhost") || urlInput.value.includes("127.0.0.1");
      if (!isLocal && !apiKeyInput.value.trim()) {
        return {
          isValid: false,
          error: "API key is required for remote endpoints"
        };
      }
      return { isValid: true };
    };
    actionButton.addEventListener("click", async () => {
      var _a;
      const validation = validateForm();
      if (!validation.isValid) {
        urlError.textContent = validation.error || "Invalid form data";
        urlError.removeClass("systemsculpt-custom-provider-error-hidden");
        return;
      }
      if (!isConnectionTested) {
        updateButtonState("testing");
        const provider = createProviderFromForm();
        const result = await this.plugin.customProviderService.testConnection(provider);
        if (result.success) {
          isConnectionTested = true;
          updateButtonState("save");
          testResult = result;
          urlError.textContent = `Connection successful! Found ${((_a = result.models) == null ? void 0 : _a.length) || 0} models.`;
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.addClass("systemsculpt-custom-provider-success");
        } else {
          updateButtonState("retry");
          urlError.textContent = result.error || "Connection failed";
          urlError.removeClass("systemsculpt-custom-provider-error-hidden");
          urlError.removeClass("systemsculpt-custom-provider-success");
        }
      } else {
        const provider = createProviderFromForm();
        this.plugin.settings.customProviders = [
          ...this.plugin.settings.customProviders,
          provider
        ];
        await this.plugin.saveSettings();
        await this.plugin.modelService.getModels();
        this.close();
        this.onBack();
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/ModelSelectionModal.ts
var ModelSelectionModal = class extends import_obsidian10.Modal {
  constructor(app, currentModelId, onSelect, plugin) {
    super(app);
    this.allModels = [];
    this.selectedCardIndex = -1;
    this.modelCards = [];
    this.isClosing = false;
    this.getSearchableFields = (model) => {
      return [
        { field: "name", text: model.name, weight: 200 },
        ...model.name.split(/[\s\-:\.]+/).map((part) => ({
          field: "name",
          text: part,
          weight: 150
        })),
        ...model.provider === "custom" ? [{ field: "provider", text: model.id.split("-")[0], weight: 180 }] : [],
        { field: "description", text: model.description || "", weight: 50 }
      ];
    };
    this.selectedModelId = currentModelId;
    this.onSelect = onSelect;
    this.plugin = plugin;
    this.logger = console;
    this.helper = new ModelSelectionHelper(plugin);
    this.searchService = new SearchService();
  }
  async onOpen() {
    try {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.addClass("systemsculpt-model-selection-modal");
      this.createSearchUI();
      this.createModelGrid();
      this.setupSearch();
      const loadingContainer = this.modelGrid.createDiv({
        cls: "systemsculpt-loading-container"
      });
      const loadingSpinner = loadingContainer.createDiv({
        cls: "systemsculpt-loading-spinner"
      });
      (0, import_obsidian10.setIcon)(loadingSpinner, "loader-2");
      loadingContainer.createDiv({
        cls: "systemsculpt-loading-text",
        text: "Loading models..."
      });
      this.allModels = await this.plugin.getInitialModels();
      this.renderModels(this.getVisibleModels());
    } catch (error) {
      this.logger.error("ModelSelectionModal: Error in onOpen", error);
      this.contentEl.createDiv({
        cls: "systemsculpt-error-message",
        text: "Error loading model selection modal"
      });
    }
  }
  getVisibleModels() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.allModels.map((m) => ({ item: m, matches: [], score: 0 }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.allModels, query, (model) => this.getSearchableFields(model), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
  createSearchUI() {
    const searchContainer = this.contentEl.createDiv({
      cls: "systemsculpt-search-container"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search models...",
      cls: "systemsculpt-search-input"
    });
    const providersButton = searchContainer.createEl("button", {
      cls: "systemsculpt-providers-button"
    });
    (0, import_obsidian10.setIcon)(providersButton.createSpan(), "settings");
    providersButton.createSpan({ text: "Providers" });
    providersButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modelSelectionModal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modelSelectionModal.open();
      });
      managerModal.open();
    });
  }
  createModelGrid() {
    this.modelGrid = this.contentEl.createDiv({
      cls: "systemsculpt-model-grid"
    });
  }
  setupSearch() {
    var _a, _b, _c;
    this.searchInput.addEventListener("input", () => {
      const results = this.getVisibleModels();
      this.renderModels(results);
    });
    this.contentEl.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey) {
          this.selectedCardIndex = this.selectedCardIndex <= 0 ? this.modelCards.length - 1 : this.selectedCardIndex - 1;
        } else {
          this.selectedCardIndex = this.selectedCardIndex >= this.modelCards.length - 1 ? 0 : this.selectedCardIndex + 1;
        }
        this.modelCards.forEach((card, i) => {
          const isSelected = i === this.selectedCardIndex;
          card.classList.toggle("systemsculpt-keyboard-selected", isSelected);
          if (isSelected) {
            card.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }
        });
        this.searchInput.focus();
      } else if (e.key === "Enter") {
        const highlightedCard = this.modelCards[this.selectedCardIndex];
        if (highlightedCard) {
          e.preventDefault();
          const modelId = highlightedCard.dataset.modelId;
          if (modelId) {
            this.onSelect(modelId);
            this.close();
          }
        }
      }
    });
    (_a = this.modelGrid) == null ? void 0 : _a.addEventListener("wheel", () => {
    }, { passive: true });
    (_b = this.modelGrid) == null ? void 0 : _b.addEventListener("touchstart", () => {
    }, { passive: true });
    (_c = this.modelGrid) == null ? void 0 : _c.addEventListener("touchmove", () => {
    }, { passive: true });
  }
  renderModels(searchResults) {
    var _a, _b;
    if (!this.modelGrid)
      return;
    this.modelGrid.empty();
    this.modelCards = [];
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const hasValidLicense = (_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim();
    const favorites = [];
    const nonFavorites = [];
    const visibleModels = searchResults.map((sr) => sr.item);
    visibleModels.forEach((model) => {
      if (!hasValidLicense && model.provider === "systemsculpt") {
        return;
      }
      if (model.isFavorite) {
        favorites.push(model);
      } else {
        nonFavorites.push(model);
      }
    });
    if (favorites.length > 0) {
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => {
        if (a.provider === "systemsculpt" && b.provider !== "systemsculpt")
          return -1;
        if (a.provider !== "systemsculpt" && b.provider === "systemsculpt")
          return 1;
        if (a.provider !== b.provider) {
          return a.provider.localeCompare(b.provider);
        }
        return a.name.localeCompare(b.name);
      });
      favorites.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    const modelsByProvider = new Map();
    nonFavorites.forEach((model) => {
      var _a2;
      const provider = model.provider;
      if (!modelsByProvider.has(provider)) {
        modelsByProvider.set(provider, []);
      }
      (_a2 = modelsByProvider.get(provider)) == null ? void 0 : _a2.push(model);
    });
    const systemsculptHeader = this.modelGrid.createDiv({
      cls: "systemsculpt-provider-header"
    });
    systemsculptHeader.createSpan({ text: "SystemSculpt Models" });
    if (!hasValidLicense && searchResults.some((sr) => sr.item.provider === "systemsculpt")) {
      this.createProInfoMessage(this.modelGrid);
    }
    if (hasValidLicense && modelsByProvider.has("systemsculpt")) {
      const systemsculptModels = modelsByProvider.get("systemsculpt") || [];
      const sortedSystemsculptModels = systemsculptModels.sort((a, b) => a.name.localeCompare(b.name));
      sortedSystemsculptModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    }
    modelsByProvider.delete("systemsculpt");
    const sortedProviders = Array.from(modelsByProvider.keys()).sort((a, b) => a.localeCompare(b));
    sortedProviders.forEach((provider) => {
      const models = modelsByProvider.get(provider) || [];
      if (models.length === 0)
        return;
      const sortedModels = models.sort((a, b) => a.name.localeCompare(b.name));
      const header = this.modelGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      const providerName = `${provider.charAt(0).toUpperCase() + provider.slice(1)} Models`;
      header.createSpan({ text: providerName });
      sortedModels.forEach((model) => {
        const matches = srMap.get(model.id) || [];
        const card = this.renderModelCard(model, matches);
        if (card) {
          this.modelGrid.appendChild(card);
          this.modelCards.push(card);
        }
      });
    });
    if (this.modelCards.length === 0) {
      if ((_b = this.searchInput) == null ? void 0 : _b.value) {
        const noResultsCard = this.renderNoResultsCard();
        this.modelGrid.appendChild(noResultsCard);
      } else {
        this.createCustomProviderInfoMessage(this.modelGrid);
      }
    }
  }
  renderNoResultsCard() {
    const card = createDiv({ cls: "systemsculpt-model-card" });
    const iconsContainer = card.createDiv({ cls: "systemsculpt-model-icons" });
    const searchIcon = iconsContainer.createDiv({
      cls: "systemsculpt-model-icon systemsculpt-pricing-low"
    });
    (0, import_obsidian10.setIcon)(searchIcon, "search");
    const nameContainer = card.createDiv({
      cls: "systemsculpt-model-name-container"
    });
    nameContainer.createDiv({
      cls: "systemsculpt-model-name",
      text: "No models found"
    });
    const description = card.createDiv({
      cls: "systemsculpt-model-description",
      text: "No models match your current search criteria. Click here to reset all filters."
    });
    card.createDiv({ cls: "systemsculpt-model-details" });
    card.addEventListener("click", () => {
      if (this.searchInput) {
        this.searchInput.value = "";
      }
      this.renderModels(this.allModels.map((m) => ({ item: m, matches: [], score: 0 })));
    });
    return card;
  }
  renderModelCard(model, matches = []) {
    var _a, _b, _c, _d, _e, _f, _g;
    const card = document.createElement("div");
    card.className = "systemsculpt-model-card";
    if (model.provider !== "systemsculpt") {
      card.classList.add("systemsculpt-custom-model-card");
    }
    card.setAttribute("tabindex", "0");
    card.dataset.modelId = model.id;
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${model.isFavorite ? "is-favorite" : ""}`,
      attr: {
        "aria-label": model.isFavorite ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian10.setIcon)(favoriteButton, "star");
    favoriteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isFavorite = !model.isFavorite;
      model.isFavorite = isFavorite;
      favoriteButton.classList.toggle("is-favorite", isFavorite);
      favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
      if (!Array.isArray(this.plugin.settings.favoriteModels)) {
        this.plugin.settings.favoriteModels = [];
      }
      if (isFavorite) {
        const newFav = { provider: model.provider, modelId: model.id };
        if (!this.plugin.settings.favoriteModels.some((f) => f.modelId === model.id && f.provider === model.provider)) {
          this.plugin.settings.favoriteModels.push(newFav);
        }
      } else {
        this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((f) => !(f.modelId === model.id && f.provider === model.provider));
      }
      await this.plugin.saveSettings();
      this.renderModels(this.getVisibleModels());
    });
    if (model.provider !== "systemsculpt") {
      const nameContainer = card.createDiv({
        cls: "systemsculpt-custom-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-custom-model-name"
      });
      const providerPrefix = `[${model.provider.toUpperCase()}] `;
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_a = this.searchInput) == null ? void 0 : _a.value));
    } else {
      const iconsContainer = card.createDiv({
        cls: "systemsculpt-model-icons"
      });
      const completionPrice = parseFloat(model.pricing.completion) * 1e6;
      const pricingIndicator = iconsContainer.createDiv({
        cls: "systemsculpt-model-icon",
        attr: {
          "aria-label": `Approx ~$${completionPrice.toFixed(2)} per million tokens`
        }
      });
      (0, import_obsidian10.setIcon)(pricingIndicator, "wallet");
      if ((_b = model.capabilities) == null ? void 0 : _b.includes("fast")) {
        const speedIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-speed-indicator",
          attr: { "aria-label": "Blazing fast responses" }
        });
        (0, import_obsidian10.setIcon)(speedIndicator, "zap");
      }
      if ((_c = model.capabilities) == null ? void 0 : _c.includes("reasoning")) {
        const reasonIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-reasoning-indicator",
          attr: { "aria-label": "Complex reasoning" }
        });
        (0, import_obsidian10.setIcon)(reasonIndicator, "brain");
      }
      if ((_d = model.capabilities) == null ? void 0 : _d.includes("creative")) {
        const creativeIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-creative-indicator",
          attr: { "aria-label": "Creative writing" }
        });
        (0, import_obsidian10.setIcon)(creativeIndicator, "brush");
      }
      if (((_e = model.architecture) == null ? void 0 : _e.modality) === "text+image->text") {
        const visionIndicator = iconsContainer.createDiv({
          cls: "systemsculpt-model-icon systemsculpt-vision-indicator",
          attr: { "aria-label": "Vision/image input" }
        });
        (0, import_obsidian10.setIcon)(visionIndicator, "eye");
      }
      const nameContainer = card.createDiv({
        cls: "systemsculpt-model-name-container"
      });
      const modelName = nameContainer.createDiv({
        cls: "systemsculpt-model-name"
      });
      const providerPrefix = "[SYSTEMSCULPT] ";
      const nameText = providerPrefix + model.name;
      modelName.append(this.helper.highlightText(nameText, matches, (_f = this.searchInput) == null ? void 0 : _f.value));
      const description = card.createDiv({
        cls: "systemsculpt-model-description"
      });
      description.append(this.helper.highlightText(model.description, matches, (_g = this.searchInput) == null ? void 0 : _g.value));
      description.setAttribute("aria-label", model.description);
      description.addClass("has-tooltip");
      const details = card.createDiv({ cls: "systemsculpt-model-details" });
      const contextLength = details.createDiv({
        cls: "systemsculpt-model-detail"
      });
      contextLength.createSpan({
        text: "Context: ",
        cls: "systemsculpt-detail-label"
      });
      contextLength.createSpan({
        text: `${model.context_length.toLocaleString()} tokens`,
        cls: "systemsculpt-detail-value"
      });
    }
    card.addEventListener("click", async () => {
      const customProvider = this.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === model.provider.toLowerCase());
      if (customProvider) {
        this.plugin.settings.activeProvider = {
          id: customProvider.id,
          name: customProvider.name,
          type: "custom"
        };
      } else {
        this.plugin.settings.activeProvider = {
          id: "systemsculpt",
          name: "SystemSculpt",
          type: "native"
        };
      }
      await this.plugin.saveSettings();
      this.onSelect(model.id);
      this.close();
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        this.onSelect(model.id);
        this.close();
      }
    });
    card.addEventListener("focus", () => {
      this.modelCards.forEach((c) => c.classList.remove("systemsculpt-keyboard-selected"));
      card.classList.add("systemsculpt-keyboard-selected");
      this.searchInput.focus();
    });
    return card;
  }
  onClose() {
    this.isClosing = true;
    this.contentEl.empty();
  }
  setModels(models) {
    if (!Array.isArray(models)) {
      this.logger.error("Invalid models data", { models });
      return;
    }
    this.allModels = models;
    if (this.modelGrid) {
      this.renderModels(this.getVisibleModels());
    }
  }
  createProInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian10.setIcon)(iconContainer, "sparkles");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Unlock Pro Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get instant access to o3 Mini, DeepSeek R1, and other state-of-the-art models. Always up to date so you don't have to guess which model to use."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian10.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    const patronBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const patronIcon = patronBtn.createSpan();
    (0, import_obsidian10.setIcon)(patronIcon, "heart");
    patronBtn.createSpan({ text: "Become A Patron" });
    patronBtn.addEventListener("click", () => {
      window.open(PATREON_URL, "_blank");
    });
    return infoEl;
  }
  createCustomProviderInfoMessage(container) {
    const infoEl = container.createDiv({
      cls: "systemsculpt-model-info"
    });
    const iconContainer = infoEl.createDiv({
      cls: "systemsculpt-model-icon-container"
    });
    (0, import_obsidian10.setIcon)(iconContainer, "server");
    const messageContainer = infoEl.createDiv({
      cls: "systemsculpt-model-message-container"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-title",
      text: "Add Your Own Models"
    });
    messageContainer.createDiv({
      cls: "systemsculpt-model-info-description",
      text: "Get started by adding your own custom provider like Ollama, LM Studio, or OpenAI. You can use your own models or connect to other AI services."
    });
    const buttonContainer = messageContainer.createDiv({
      cls: "systemsculpt-model-info-buttons"
    });
    const addProviderBtn = buttonContainer.createEl("button", {
      cls: "systemsculpt-info-button mod-cta"
    });
    const addProviderIcon = addProviderBtn.createSpan();
    (0, import_obsidian10.setIcon)(addProviderIcon, "plus");
    addProviderBtn.createSpan({ text: "Add A Provider" });
    addProviderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      this.close();
      const managerModal = new CustomProviderManagerModal(this.app, this.plugin, () => {
        const modal = new ModelSelectionModal(this.app, this.selectedModelId, this.onSelect, this.plugin);
        modal.open();
      });
      managerModal.open();
    });
    return infoEl;
  }
};

// src/modals/DefaultSystemPromptModal.ts
init_SystemSculptService();
function sanitizeFileName(name) {
  return name.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
}
function getSystemPromptPath(directory, fileName) {
  return `${directory}/${fileName}.md`;
}
var DefaultSystemPromptModal = class extends import_obsidian11.Modal {
  constructor(app, options) {
    super(app);
    this.result = null;
    this.systemPrompts = [];
    this.activePreset = null;
    this.options = options;
    this.currentPrompt = options.currentPrompt || "";
    this.systemPromptService = SystemPromptService.getInstance(app);
    if (options.plugin) {
      this.sculptService = SystemSculptService.getInstance(options.plugin.settings, app);
      this.systemPrompts = SystemPromptService.getCachedPrompts() || [];
    }
    this.setInitialActivePreset();
  }
  setInitialActivePreset() {
    if (this.options.currentPromptType) {
      const matchingPreset2 = this.systemPrompts.find((p) => p.id === this.options.currentPromptType);
      if (matchingPreset2) {
        this.activePreset = matchingPreset2.label;
        return;
      }
    }
    if (!this.currentPrompt) {
      this.activePreset = "General-use";
      return;
    }
    const matchingPreset = this.systemPrompts.find((p) => p.systemPrompt.trim() === this.currentPrompt.trim());
    this.activePreset = matchingPreset ? matchingPreset.label : "Custom";
  }
  showLoading(show) {
    this.loadingIndicator.style.display = show ? "flex" : "none";
    this.contentContainer.style.opacity = show ? "0.5" : "1";
  }
  setupResizeObserver() {
    const resizeObserver = new ResizeObserver(() => {
      clearTimeout(this.resizeTimeout);
      this.resizeTimeout = setTimeout(() => {
        this.textArea.style.height = "auto";
        this.textArea.style.height = this.textArea.scrollHeight + "px";
      }, 50);
    });
    resizeObserver.observe(this.textArea);
  }
  async onOpen() {
    this.containerEl.addClass("systemsculpt-system-prompt-modal");
    this.contentEl.empty();
    this.contentEl.addClass("systemsculpt-system-prompt-content");
    this.contentContainer = this.contentEl.createDiv("systemsculpt-content-container");
    this.setupLoadingIndicator();
    this.setupModelSection();
    this.setupTextArea();
    this.setupButtons();
    if (this.textArea) {
      this.textArea.value = this.currentPrompt || "";
    }
    if (this.systemPrompts.length > 0) {
      this.createPresetButtons();
      const initialPreset = this.systemPrompts.find((p) => p.label === this.activePreset) || {
        id: "custom",
        label: "Custom",
        systemPrompt: this.currentPrompt,
        isUserConfigurable: true
      };
      this.updateUIForPreset(initialPreset);
    }
    if (!this.systemPrompts.length || !SystemPromptService.isCacheValid()) {
      this.showLoading(true);
      await this.loadSystemPrompts().catch((error) => {
        console.error("[SystemSculpt] Failed to load system prompts:", error);
        this.showError("Failed to load system prompts. Please try again.");
      });
    } else {
      this.showLoading(false);
    }
    this.setupResizeObserver();
    if (this.textArea) {
      this.textArea.focus();
      this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
    }
  }
  setupModelSection() {
    var _a;
    if (!this.options.plugin || !this.options.currentModelId)
      return;
    const modelSection = this.contentContainer.createDiv("systemsculpt-model-section");
    modelSection.style.marginBottom = "1rem";
    modelSection.style.marginTop = "1.5rem";
    const modelHeader = modelSection.createDiv({
      cls: "systemsculpt-model-header",
      attr: { style: "display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; gap: 0.5rem;" }
    });
    const modelControls = modelHeader.createDiv({
      cls: "systemsculpt-model-controls",
      attr: { style: "display: flex; align-items: center; gap: 1rem; width: 100%;" }
    });
    this.modelIndicator = modelControls.createDiv({ cls: "systemsculpt-model-indicator" });
    this.modelIndicator.style.cursor = "pointer";
    this.modelIndicator.style.flex = "1";
    const currentModel = (_a = this.options.plugin.modelService.cachedModels) == null ? void 0 : _a.find((model) => model.id === this.options.currentModelId);
    const providerPrefix = currentModel ? currentModel.provider === "systemsculpt" ? "[SS AI] " : `[${currentModel.provider.toUpperCase()}] ` : "";
    this.modelIndicator.setText(`Current Model: ${providerPrefix}${(currentModel == null ? void 0 : currentModel.name) || this.options.currentModelId}`);
    const changeModelButton = modelControls.createEl("button", {
      cls: "systemsculpt-button mod-cta",
      text: "Change Model"
    });
    changeModelButton.style.padding = "4px 12px";
    changeModelButton.style.borderRadius = "4px";
    changeModelButton.style.fontSize = "14px";
    const openModelSelection = async () => {
      const models = await this.options.plugin.modelService.getModels();
      const modal = new ModelSelectionModal(this.app, this.options.currentModelId || "", async (modelId) => {
        if (this.options.onModelSelect) {
          await this.options.onModelSelect(modelId);
          const newModel = models.find((m) => m.id === modelId);
          const newPrefix = newModel ? newModel.provider === "systemsculpt" ? "[SS AI] " : `[${newModel.provider.toUpperCase()}] ` : "";
          this.modelIndicator.setText(`Current Model: ${newPrefix}${(newModel == null ? void 0 : newModel.name) || modelId}`);
        }
      }, this.options.plugin);
      modal.open();
    };
    this.modelIndicator.onclick = openModelSelection;
    changeModelButton.onclick = openModelSelection;
  }
  setupLoadingIndicator() {
    this.loadingIndicator = this.contentContainer.createDiv("systemsculpt-loading");
    this.loadingIndicator.style.display = "none";
    this.loadingIndicator.style.justifyContent = "center";
    this.loadingIndicator.style.alignItems = "center";
    this.loadingIndicator.style.padding = "20px";
    this.loadingIndicator.createSpan().setText("Loading system prompts...");
  }
  setupTextArea() {
    var _a;
    const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
    this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
    this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
    this.customSection.style.display = "none";
    const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
    const customInputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
    customInputWrapper.style.display = "flex";
    customInputWrapper.style.gap = "8px";
    customInputWrapper.style.alignItems = "center";
    this.customInput = customInputWrapper.createEl("input", {
      type: "text",
      placeholder: "Search for a system prompt file...",
      cls: "systemsculpt-custom-input"
    });
    const createButton2 = customInputWrapper.createEl("button", {
      cls: "systemsculpt-create-button"
    });
    createButton2.style.padding = "4px 8px";
    createButton2.style.borderRadius = "4px";
    createButton2.style.cursor = "pointer";
    (0, import_obsidian11.setIcon)(createButton2, "plus");
    createButton2.addEventListener("click", async () => {
      var _a2, _b, _c;
      let templateContent = "";
      try {
        templateContent = await this.systemPromptService.getSystemPromptTemplate();
      } catch (error) {
        console.error("Error fetching system prompt template:", error);
        await showPopup(this.app, "", {
          title: "Error",
          description: "Failed to fetch system prompt template. Please try again later.",
          primaryButton: "OK"
        });
        return;
      }
      const result = await showPopup(this.app, "", {
        title: "Create New System Prompt",
        description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
        primaryButton: "Create",
        secondaryButton: "Cancel",
        inputs: [
          {
            type: "text",
            placeholder: "My Custom Assistant",
            required: true,
            className: "systemsculpt-prompt-creation-title-input"
          },
          {
            type: "textarea",
            value: templateContent,
            required: true,
            className: "systemsculpt-prompt-creation-content"
          }
        ]
      });
      if (!(result == null ? void 0 : result.confirmed) || !((_a2 = result.inputs) == null ? void 0 : _a2[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
        return;
      }
      const [title, content] = result.inputs;
      const promptsDirectory = (_c = this.options.systemPromptsDirectory) != null ? _c : "SystemSculpt/System Prompts";
      const fileName = sanitizeFileName(title);
      const filePath = getSystemPromptPath(promptsDirectory, fileName);
      try {
        await this.app.vault.createFolder(promptsDirectory).catch(() => {
        });
        const fileContent = `# ${title}

${content}`;
        const file = await this.app.vault.create(filePath, fileContent);
        if (!file) {
          throw new Error("Failed to create file");
        }
        if (this.textArea) {
          this.textArea.value = fileContent;
          this.textArea.readOnly = false;
        }
        this.customInput.value = filePath;
        await showPopup(this.app, "", {
          title: "Success",
          description: "System prompt file created successfully!",
          primaryButton: "OK"
        });
      } catch (error) {
        console.error("Error creating system prompt file:", error);
        const errorMessage = error instanceof Error ? error.message : "Failed to create system prompt file. Please try again.";
        await showPopup(this.app, "", {
          title: "Error",
          description: errorMessage,
          primaryButton: "OK"
        });
      }
    });
    if (this.customInput) {
      attachFileSuggester(this.customInput, async (selectedPath) => {
        try {
          const file = this.app.vault.getAbstractFileByPath(selectedPath);
          if (file && file instanceof import_obsidian11.TFile) {
            const content = await this.app.vault.read(file);
            this.textArea.value = content;
            this.textArea.readOnly = false;
            this.customInput.value = selectedPath.replace(/\.md$/, "");
          }
        } catch (error) {
          console.error("Error reading system prompt file:", error);
        }
      }, this.app, (_a = this.options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts");
    }
    this.textArea = textAreaContainer.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter system prompt",
        readOnly: this.activePreset !== "Custom"
      }
    });
    this.textArea.value = this.currentPrompt;
  }
  setupButtons() {
    const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
    const secondaryButton = buttonContainer.createEl("button", {
      text: "Cancel",
      cls: "systemsculpt-button"
    });
    const handleCancel = () => {
      this.result = null;
      this.close();
    };
    secondaryButton.onclick = handleCancel;
    const primaryButton = buttonContainer.createEl("button", {
      text: "Save",
      cls: "systemsculpt-button mod-cta"
    });
    const handleSave = () => {
      var _a;
      const activeButton = this.modalEl.querySelector(".systemsculpt-preset-button.active");
      const activePresetLabel = (_a = activeButton == null ? void 0 : activeButton.textContent) != null ? _a : "";
      let result;
      if (activePresetLabel === "Custom" && this.customInput.value) {
        const path = this.customInput.value.replace(/\.md$/, "");
        result = {
          content: this.textArea.value,
          type: "custom",
          path
        };
      } else {
        const preset = this.systemPrompts.find((p) => p.label === activePresetLabel);
        if (preset) {
          result = {
            content: preset.systemPrompt,
            type: preset.id
          };
        } else {
          result = {
            content: this.textArea.value,
            type: "custom"
          };
        }
      }
      this.result = result;
      this.close();
    };
    primaryButton.onclick = handleSave;
    this.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
        e.preventDefault();
        handleSave();
      } else if (e.key === "Escape") {
        e.preventDefault();
        handleCancel();
      }
    });
  }
  createPresetButtons() {
    if (!this.presetButtonContainer)
      return;
    this.presetButtonContainer.empty();
    const presets = [
      ...this.systemPrompts,
      ...!this.systemPrompts.some((p) => p.id === "custom") ? [{
        id: "custom",
        label: "Custom",
        isUserConfigurable: true,
        systemPrompt: this.currentPrompt || ""
      }] : []
    ];
    presets.forEach((preset) => {
      const button = this.presetButtonContainer.createEl("button", {
        text: preset.label,
        cls: "systemsculpt-preset-button"
      });
      if (preset.label === this.activePreset) {
        button.addClass("active");
        this.updateUIForPreset(preset);
      }
      button.onclick = () => {
        this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
        button.addClass("active");
        this.activePreset = preset.label;
        this.updateUIForPreset(preset);
      };
    });
  }
  updateUIForPreset(preset) {
    if (preset.label === "Custom") {
      this.customSection.style.display = "block";
      this.customInput.focus();
      this.textArea.readOnly = false;
      if (this.options.customPromptFilePath && !this.customInput.value) {
        this.customInput.value = this.options.customPromptFilePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      this.textArea.value = this.currentPrompt || "";
    } else {
      this.customSection.style.display = "none";
      this.textArea.value = preset.systemPrompt;
      this.textArea.readOnly = !preset.isUserConfigurable;
    }
  }
  async loadSystemPrompts() {
    try {
      const prompts = await this.systemPromptService.getSystemPrompts();
      this.renderPrompts(prompts);
      this.showLoading(false);
    } catch (error) {
      console.error("Failed to load system prompts:", error);
      throw error;
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
      this.resolvePromise(this.result);
    }
  }
  async openAndGetValue() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
  renderPrompts(prompts) {
    if (!this.promptsContainer) {
      this.promptsContainer = this.contentEl.createDiv("systemsculpt-prompts-container");
    }
    this.promptsContainer.empty();
    prompts.forEach((prompt) => {
      const promptEl = this.promptsContainer.createDiv("systemsculpt-prompt-item");
      promptEl.setText(prompt.label);
      promptEl.addEventListener("click", () => {
        this.currentPrompt = prompt.systemPrompt;
        this.close();
      });
    });
  }
  hideLoading() {
    if (this.loadingIndicator) {
      this.loadingIndicator.style.display = "none";
    }
  }
  showError(message) {
    if (!this.contentContainer)
      return;
    this.showLoading(false);
    const errorEl = this.contentContainer.createDiv("systemsculpt-error-message");
    errorEl.setText(message);
    const retryButton = errorEl.createEl("button", {
      text: "Retry",
      cls: "systemsculpt-button mod-cta"
    });
    retryButton.onclick = async () => {
      errorEl.remove();
      this.showLoading(true);
      try {
        await this.loadSystemPrompts();
      } catch (error) {
        console.error("Retry failed:", error);
        this.showError("Failed to load system prompts. Please try again.");
      }
    };
  }
};
async function showDefaultSystemPromptModal(app, currentPrompt, options) {
  const defaultOptions = {
    systemPromptsDirectory: "SystemSculpt/System Prompts"
  };
  const modal = new DefaultSystemPromptModal(app, {
    ...defaultOptions,
    ...options
  });
  const result = await modal.openAndGetValue();
  if (result !== null && (options == null ? void 0 : options.onSave)) {
    await options.onSave(result.content);
  }
  return result;
}

// src/modals/SettingsTab.ts
var SystemSculptSettingTab = class extends import_obsidian14.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.debounceTimer = null;
    this.plugin = plugin;
    this.systemSculptService = SystemSculptService.getInstance(plugin.settings, this.app);
  }
  validateDirectory(path) {
    if (!path)
      return true;
    return !path.includes("..") && !path.startsWith("/") && !path.startsWith("\\");
  }
  async handleDirectoryChange(value, settingKey) {
    if (!this.validateDirectory(value)) {
      showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
      return;
    }
    if (this.debounceTimer)
      clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(async () => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    }, 500);
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    const mainContainer = containerEl.createDiv("systemsculpt-settings-container");
    mainContainer.createEl("h2", { text: "SystemSculpt AI Settings" });
    const tabContainer = mainContainer.createDiv("systemsculpt-settings-tabs");
    const contentContainer = mainContainer.createDiv("systemsculpt-settings-content");
    const tabs = [
      { id: "license", label: "License" },
      { id: "directories", label: "Directories" },
      { id: "recorder", label: "Recorder" },
      { id: "chat", label: "Chat" },
      { id: "tasks", label: "Tasks" },
      { id: "advanced", label: "Advanced" }
    ];
    tabs.forEach((tab) => {
      const tabButton = tabContainer.createEl("button", {
        cls: "systemsculpt-tab-button",
        text: tab.label
      });
      tabButton.dataset.tab = tab.id;
      if (tab.id === "license")
        tabButton.addClass("active");
    });
    const isProActive = this.plugin.settings.licenseValid === true;
    const licenseContent = contentContainer.createDiv("systemsculpt-tab-content active");
    const directoriesContent = contentContainer.createDiv("systemsculpt-tab-content");
    const recorderContent = contentContainer.createDiv("systemsculpt-tab-content");
    const chatContent = contentContainer.createDiv("systemsculpt-tab-content");
    const tasksContent = contentContainer.createDiv("systemsculpt-tab-content");
    const advancedContent = contentContainer.createDiv("systemsculpt-tab-content");
    this.displayLicenseTab(licenseContent, isProActive);
    this.displayDirectoriesTab(directoriesContent, isProActive);
    this.displayRecorderTab(recorderContent);
    this.displayChatTab(chatContent);
    this.displayTasksTab(tasksContent);
    this.displayAdvancedTab(advancedContent);
    tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((button) => {
      button.addEventListener("click", (e) => {
        var _a;
        const target = e.target;
        const tabId = target.dataset.tab;
        tabContainer.querySelectorAll(".systemsculpt-tab-button").forEach((b) => b.classList.remove("active"));
        contentContainer.querySelectorAll(".systemsculpt-tab-content").forEach((c) => c.classList.remove("active"));
        target.classList.add("active");
        (_a = contentContainer.querySelector(`[data-tab="${tabId}"]`)) == null ? void 0 : _a.classList.add("active");
      });
    });
    if (!document.getElementById("systemsculpt-settings-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-settings-styles";
      style.textContent = `
      .systemsculpt-settings-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 16px;
        border-bottom: 1px solid var(--background-modifier-border);
        padding-bottom: 8px;
        max-width: 100%;
      }
      
      .systemsculpt-tab-button {
        background: none;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: var(--text-normal);
        transition: all 0.2s ease;
        font-size: 0.9em;
        flex: 1 1 auto;
        min-width: 120px;
        text-align: center;
      }
      
      .systemsculpt-tab-button:hover {
        background-color: var(--background-modifier-hover);
      }
      
      .systemsculpt-tab-button.active {
        background-color: var(--interactive-accent);
        color: var(--text-on-accent);
      }
      
      .systemsculpt-tab-content {
        display: none;
        max-width: 100%;
        overflow-x: hidden;
      }
      
      .systemsculpt-tab-content.active {
        display: block;
        padding: 0 8px;
      }
      
      /* License Tab Styling */
      .systemsculpt-license-input {
        width: 100%;
        max-width: 400px;
      }
      
      .pro-badge {
        background: var(--interactive-accent);
        color: var(--text-on-accent);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: 600;
        margin-left: 8px;
        vertical-align: middle;
      }
      
      .token-balance-value {
        font-weight: 600;
        color: var(--text-accent);
        margin-left: 8px;
      }
      
      .pro-features-grid .setting-item {
        padding: 8px;
        border-radius: 4px;
        background: var(--background-secondary-alt);
        margin: 4px 0;
      }
      
      .pro-benefits-list {
        margin: 16px 0;
        padding-left: 20px;
        color: var(--text-muted);
      }
      
      .pro-benefits-list li {
        margin: 8px 0;
        list-style-type: '\u2192';
        padding-left: 20px;
        text-indent: -12px;
        word-break: break-word;
      }
    `;
      mainContainer.appendChild(style);
    }
  }
  displayLicenseTab(containerEl, isProActive) {
    containerEl.dataset.tab = "license";
    const licenseSettingContainer = containerEl.createDiv("systemsculpt-license-settings");
    licenseSettingContainer.createEl("h3", {
      text: "SystemSculpt License"
    });
    const licenseSetting = new import_obsidian14.Setting(licenseSettingContainer).setName("License Key").setDesc("Unlock Pro features with your license key").addText((text) => {
      text.setPlaceholder("Paste license key").setValue(this.plugin.settings.licenseKey).onChange(async (value) => {
        this.plugin.settings.licenseKey = value;
        await this.plugin.saveSettings();
      }).inputEl.addClass("systemsculpt-license-input");
      text.inputEl.type = "password";
      text.inputEl.style.fontFamily = "monospace";
      text.inputEl.addEventListener("focus", () => {
        text.inputEl.type = "text";
        text.inputEl.style.fontFamily = "inherit";
      });
      text.inputEl.addEventListener("blur", () => {
        text.inputEl.type = "password";
        text.inputEl.style.fontFamily = "monospace";
      });
      return text;
    }).addToggle((toggle) => {
      toggle.setValue(isProActive).setTooltip(isProActive ? "Disable Pro features" : "Enable Pro features").onChange(async (value) => {
        if (value) {
          const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true, true);
          if (!isValid) {
            toggle.setValue(false);
            showPopup(this.app, "Invalid license key - Pro features disabled");
          }
        } else {
          this.plugin.settings.licenseValid = false;
          await this.plugin.saveSettings();
        }
        this.display();
      });
      if (isProActive) {
        toggle.toggleEl.addClass("mod-cta");
      }
    });
    if (isProActive) {
      const statusSetting = new import_obsidian14.Setting(licenseSettingContainer).setName("Pro Status").setDesc("Active subscription \u2022 Premium features enabled");
      statusSetting.nameEl.createSpan({
        cls: "pro-badge",
        text: "ACTIVE"
      });
      const balanceEl = createSpan({
        cls: "token-balance-value",
        text: "Loading..."
      });
      statusSetting.addExtraButton((button) => {
        button.setIcon("sparkles").setTooltip("Available credits").setDisabled(true);
        statusSetting.controlEl.appendChild(balanceEl);
      });
      this.displayTokenBalance(balanceEl);
    }
    this.displayProPromotionSection(licenseSettingContainer, isProActive);
    const betaNoticeEl = licenseSettingContainer.createEl("div", {
      cls: "systemsculpt-beta-notice"
    });
    const headerContainer = betaNoticeEl.createEl("div", {
      cls: "beta-notice-header"
    });
    new import_obsidian14.Setting(headerContainer).setHeading().setName("Beta Testing Phase").addExtraButton((button) => {
      button.setIcon("rocket").setDisabled(true).extraSettingsEl.addClass("beta-header-icon");
    });
    betaNoticeEl.createEl("p", {
      text: "Thank you for trying out SystemSculpt! While some core features are available to everyone during this beta phase, certain advanced capabilities are currently limited to Patreon members to help manage the testing group size.",
      cls: "beta-notice-text"
    });
    betaNoticeEl.createEl("p", {
      text: "As a solo developer, your feedback is incredibly valuable in shaping SystemSculpt. Feel free to test the available features, and if you'd like access to the full beta experience, consider becoming a Patreon supporter!",
      cls: "beta-notice-text"
    });
    if (!document.getElementById("systemsculpt-beta-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-beta-styles";
      style.textContent = `
        .systemsculpt-beta-notice {
          margin-top: 32px;
          padding: 20px;
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .beta-notice-header {
          margin-bottom: 16px;
        }

        .beta-notice-header .setting-item {
          padding: 0;
          border: none;
        }

        .beta-notice-header .setting-item-name {
          font-size: 1.2em;
          font-weight: 600;
          color: var(--text-normal);
        }

        .beta-header-icon {
          color: var(--interactive-accent) !important;
          background: none !important;
          padding: 0 !important;
          margin-right: 8px !important;
        }

        .beta-notice-text {
          margin: 12px 0;
          color: var(--text-normal);
          line-height: 1.6;
          font-size: 0.95em;
        }

        .theme-dark .systemsculpt-beta-notice {
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
      `;
      containerEl.appendChild(style);
    }
  }
  async displayTokenBalance(containerEl) {
    try {
      const balance = await this.systemSculptService.getTokenBalance();
      containerEl.setText(`Available Credits: ${balance.toLocaleString()}`);
    } catch (error) {
      containerEl.setText("Unable to fetch credit balance");
      console.error("Failed to fetch token balance:", error);
    }
  }
  displayProPromotionSection(containerEl, isProActive) {
    if (!isProActive) {
      const proPromotionEl = containerEl.createEl("div", {
        cls: "systemsculpt-pro-promotion"
      });
      const headerContainer = proPromotionEl.createEl("div", {
        cls: "pro-promotion-header"
      });
      new import_obsidian14.Setting(headerContainer).setHeading().setName("Upgrade to Pro").addExtraButton((button) => {
        button.setIcon("sparkles").setDisabled(true).extraSettingsEl.addClass("pro-header-icon");
      });
      proPromotionEl.createEl("p", {
        text: "Transform your workflow with powerful AI features designed for serious productivity.",
        cls: "pro-promotion-text"
      });
      const benefitsList = proPromotionEl.createEl("ul", {
        cls: "pro-benefits-list"
      });
      [
        "Audio Recording & Instant Transcription",
        "Smart Document Processing",
        "Real-time Voice-to-Text in Notes & Chat",
        "Multi-format Support (PDF, Audio, Images)",
        "AI Templates & Custom Personalities",
        "Priority Access to New Features",
        "1-on-1 Support via Patreon DMs",
        "Support SystemSculpt's Development"
      ].forEach((benefit) => {
        benefitsList.createEl("li", { text: benefit });
      });
      new import_obsidian14.Setting(proPromotionEl).addButton((button) => button.setButtonText("Become a Patron").setCta().onClick(() => {
        window.open(PATREON_URL, "_blank");
      }));
    }
  }
  displayChatTab(containerEl) {
    containerEl.dataset.tab = "chat";
    containerEl.createEl("h3", { text: "Chat Settings" });
    new import_obsidian14.Setting(containerEl).setName("Chat System Prompt").setDesc("Customize the system prompt used for all new chats").addButton((button) => {
      button.setButtonText("Edit Prompt").onClick(async () => {
        const result = await showDefaultSystemPromptModal(this.app, this.plugin.settings.systemPrompt, {
          onSave: async (newPrompt) => {
            this.plugin.settings.systemPrompt = newPrompt;
            await this.plugin.saveSettings();
          },
          systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
          customPromptFilePath: this.plugin.settings.systemPromptPath,
          plugin: this.plugin,
          currentModelId: this.plugin.settings.selectedModelId,
          onModelSelect: async (modelId) => {
            this.plugin.settings.selectedModelId = modelId;
            await this.plugin.saveSettings();
          },
          currentPromptType: this.plugin.settings.systemPromptType
        });
        if (result == null ? void 0 : result.content) {
          this.plugin.settings.systemPrompt = result.content;
          this.plugin.settings.systemPromptType = result.type;
          if ((result == null ? void 0 : result.type) === "custom" && (result == null ? void 0 : result.path)) {
            this.plugin.settings.systemPromptPath = result.path;
          } else {
            this.plugin.settings.systemPromptPath = "";
          }
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayAdvancedTab(containerEl) {
    containerEl.dataset.tab = "advanced";
    new import_obsidian14.Setting(containerEl).setName("Development Mode").setDesc("Toggle between development and production API endpoints").addToggle((toggle) => toggle.setValue(this.plugin.settings.developmentMode).onChange(async (value) => {
      this.plugin.settings.developmentMode = value;
      this.plugin.settings.serverUrl = value ? "http://localhost:3001" : "https://api.systemsculpt.com";
      await this.plugin.saveSettings();
      new import_obsidian14.Notice(`Switched to ${value ? "development" : "production"} mode (${this.systemSculptService.baseUrl})`);
    }));
    new import_obsidian14.Setting(containerEl).setName("Title Generation").setDesc("Configure how titles should be generated from your content").addButton((button) => {
      button.setButtonText("Edit Prompt").setTooltip("Configure the title generation prompt").onClick(async () => {
        const { showTitleGenerationPromptModal: showTitleGenerationPromptModal2 } = await Promise.resolve().then(() => (init_TitleGenerationPromptModal(), TitleGenerationPromptModal_exports));
        const result = await showTitleGenerationPromptModal2(this.app, this.plugin, this.plugin.settings.titleGenerationPrompt, {
          systemPromptsDirectory: this.plugin.settings.systemPromptsDirectory,
          currentCustomPath: this.plugin.settings.titleGenerationPromptPath
        });
        if (result) {
          this.plugin.settings.titleGenerationPrompt = result.content;
          this.plugin.settings.titleGenerationPromptType = result.type;
          this.plugin.settings.titleGenerationPromptPath = result.path || "";
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
    new import_obsidian14.Setting(containerEl).setName("Automatic Title Generation").setDesc("Automatically generate titles for new chats without showing the modal").addToggle((toggle) => toggle.setValue(this.plugin.settings.automaticTitleGeneration).onChange(async (value) => {
      this.plugin.settings.automaticTitleGeneration = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian14.Setting(containerEl).setName("Reset to Factory Settings").setDesc("Clear all custom settings and restore defaults for this plugin.").addButton((btn) => {
      btn.setButtonText("Reset\u2026").onClick(async () => {
        const confirm = await showPopup(this.app, "Reset to Factory Defaults", {
          description: "This will delete ALL saved settings and customizations for SystemSculpt, returning everything to default. Do you want to continue?",
          primaryButton: "Reset & Reload",
          secondaryButton: "Cancel"
        });
        if (!confirm || !confirm.confirmed) {
          return;
        }
        try {
          await this.plugin.saveData(null);
          await this.plugin.getSettingsManager().updateSettings(DEFAULT_SETTINGS);
          window.location.reload();
        } catch (error) {
          console.error("Error resetting to factory settings:", error);
          showPopup(this.app, "Failed to reset: " + String(error));
        }
      });
    });
  }
  async displayDirectoriesTab(containerEl, isProActive) {
    containerEl.dataset.tab = "directories";
    containerEl.createEl("h3", { text: "Directory Settings" });
    this.createDirectorySetting(containerEl, "Chats Directory", "Select the directory for your chat history", "chatsDirectory", "SystemSculpt/Chats");
    this.createDirectorySetting(containerEl, "Recordings Directory", "Select the directory for your recordings", "recordingsDirectory", "SystemSculpt/Recordings");
    this.createDirectorySetting(containerEl, "System Prompts Directory", "Select the directory for your custom system prompts", "systemPromptsDirectory", "SystemSculpt/System Prompts");
    this.createDirectorySetting(containerEl, "Attachments Directory", "Select the directory for saved images and attachments", "attachmentsDirectory", "SystemSculpt/Attachments");
    this.createDirectorySetting(containerEl, "Extractions Directory", "Select the directory where extracted PDFs/docs will be placed", "extractionsDirectory", "SystemSculpt/Extractions");
    this.createDirectorySetting(containerEl, "Tasks Directory", "Select the directory for your task lists", "tasksDirectory", "SystemSculpt/Tasks");
  }
  createDirectorySetting(containerEl, name, desc, settingKey, placeholder) {
    new import_obsidian14.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      text.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
        await this.handleDirectoryChange(value, settingKey);
      });
      attachFolderSuggester(text.inputEl, async (selectedPath) => {
        if (this.validateDirectory(selectedPath)) {
          this.plugin.settings[settingKey] = selectedPath;
          text.setValue(selectedPath);
          await this.plugin.saveSettings();
        } else {
          showPopup(this.app, "Invalid directory path. Please use relative paths without '..' or leading slashes.");
        }
      }, this.app);
      return text;
    });
  }
  displayRecorderTab(containerEl) {
    containerEl.dataset.tab = "recorder";
    containerEl.createEl("h3", { text: "Recording Settings" });
    const microphoneSetting = new import_obsidian14.Setting(containerEl).setName("Preferred Microphone").setDesc("Select your preferred microphone for recordings");
    const micSelect = microphoneSetting.controlEl.createEl("select", {
      cls: "systemsculpt-microphone-select"
    });
    micSelect.createEl("option", {
      value: "",
      text: "Loading microphones..."
    }).setAttribute("disabled", "true");
    micSelect.disabled = true;
    try {
      navigator.mediaDevices.enumerateDevices().then((devices) => {
        var _a;
        const microphones = devices.filter((device) => device.kind === "audioinput");
        micSelect.disabled = false;
        (_a = micSelect.firstElementChild) == null ? void 0 : _a.remove();
        microphones.forEach((mic) => {
          const option = micSelect.createEl("option", {
            value: mic.deviceId,
            text: mic.label || `Microphone ${mic.deviceId.slice(0, 8)}...`
          });
          if (mic.deviceId === this.plugin.settings.preferredMicrophoneId) {
            option.selected = true;
          }
        });
      }).catch((error) => {
        console.error("Error enumerating audio devices:", error);
        micSelect.createEl("option", {
          value: "",
          text: "Unable to list microphones"
        });
      });
    } catch (error) {
      console.error("Microphone initialization failed:", error);
    }
    micSelect.addEventListener("change", async () => {
      this.plugin.settings.preferredMicrophoneId = micSelect.value;
      await this.plugin.saveSettings();
    });
    new import_obsidian14.Setting(containerEl).setName("Auto-Transcribe Recordings").setDesc("Automatically transcribe recordings when they are completed").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoTranscribeRecordings).onChange(async (value) => {
      this.plugin.settings.autoTranscribeRecordings = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian14.Setting(containerEl).setName("Auto-Paste Transcription").setDesc("Automatically paste transcriptions into the active document").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoPasteTranscription).onChange(async (value) => {
      this.plugin.settings.autoPasteTranscription = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian14.Setting(containerEl).setName("Post-Processing").setDesc("Configure how transcriptions should be post-processed").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.postProcessingEnabled).setTooltip("Enable/disable post-processing").onChange(async (value) => {
        this.plugin.settings.postProcessingEnabled = value;
        await this.plugin.saveSettings();
      });
      return toggle;
    }).addButton((button) => {
      button.setButtonText("Edit Prompt").setTooltip("Configure the post-processing prompt").onClick(async () => {
        const { showPostProcessingPromptModal: showPostProcessingPromptModal2 } = await Promise.resolve().then(() => (init_PostProcessingPromptModal(), PostProcessingPromptModal_exports));
        const result = await showPostProcessingPromptModal2(this.app, this.plugin, this.plugin.settings.postProcessingPrompt);
        if (result) {
          this.plugin.settings.postProcessingPrompt = result.content;
          await this.plugin.saveSettings();
        }
      });
      return button;
    });
  }
  displayTasksTab(containerEl) {
    containerEl.dataset.tab = "tasks";
    containerEl.createEl("h3", { text: "Tasks Settings" });
    new import_obsidian14.Setting(containerEl).setName("Auto-Move Completed Tasks").setDesc("Automatically move completed tasks to the bottom of the list").addToggle((toggle) => toggle.setValue(this.plugin.settings.moveCompletedTasksDown).onChange(async (value) => {
      this.plugin.settings.moveCompletedTasksDown = value;
      await this.plugin.saveSettings();
    }));
  }
};

// src/services/RecorderService.ts
var import_obsidian28 = __toModule(require("obsidian"));

// src/modals/AudioTranscriptionModal.ts
var import_obsidian15 = __toModule(require("obsidian"));

// src/services/TranscriptionService.ts
init_SystemSculptService();
var SUPPORTED_AUDIO_EXTENSIONS = ["wav", "m4a", "webm", "ogg", "mp3"];
var MIME_TYPE_MAP = {
  wav: "audio/wav",
  m4a: "audio/mp4",
  webm: "audio/webm",
  ogg: "audio/ogg;codecs=opus",
  mp3: "audio/mpeg"
};
var TranscriptionService = class {
  constructor(plugin) {
    this.isTranscribing = false;
    this.plugin = plugin;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!TranscriptionService.instance) {
      TranscriptionService.instance = new TranscriptionService(plugin);
    }
    return TranscriptionService.instance;
  }
  async parseErrorResponse(response) {
    try {
      const data = await response.json();
      if (data.error) {
        if (typeof data.error === "string") {
          return { message: data.error, data };
        }
        if (data.error.message) {
          return { message: data.error.message, data };
        }
        return { message: JSON.stringify(data.error), data };
      }
      return { message: response.statusText, data };
    } catch (e) {
      return { message: response.statusText };
    }
  }
  async transcribeFile(file, context) {
    var _a, _b, _c, _d;
    if (this.isTranscribing) {
      throw new Error("Already transcribing a file");
    }
    const extension = file.extension.toLowerCase();
    if (!SUPPORTED_AUDIO_EXTENSIONS.includes(extension)) {
      throw new Error(`Unsupported file type: ${extension}`);
    }
    this.isTranscribing = true;
    (_a = context == null ? void 0 : context.onProgress) == null ? void 0 : _a.call(context, 0, "Reading audio file...");
    const arrayBuffer = await this.plugin.app.vault.readBinary(file);
    const blob = new Blob([arrayBuffer], {
      type: MIME_TYPE_MAP[extension]
    });
    const formData = new FormData();
    formData.append("file", blob, file.name);
    if (context == null ? void 0 : context.timestamped) {
      formData.append("timestamped", "true");
    }
    try {
      (_b = context == null ? void 0 : context.onProgress) == null ? void 0 : _b.call(context, 20, "Uploading audio...");
      const response = await fetch(`${this.sculptService.baseUrl}/api/v1/audio/transcriptions`, {
        method: "POST",
        headers: {
          "x-license-key": this.plugin.settings.licenseKey
        },
        body: formData
      });
      let data;
      if (!response.ok) {
        const { message: errorMessage, data: parsedData } = await this.parseErrorResponse(response);
        if (response.status === 400 && errorMessage === "Credits charged successfully") {
          data = parsedData;
        } else {
          throw new Error(`Failed to transcribe file: ${response.status} - ${errorMessage}`);
        }
      } else {
        const responseText = await response.text();
        try {
          data = JSON.parse(responseText);
        } catch (e) {
          console.error("Failed to parse response JSON:", e);
          throw new Error("Invalid JSON response from server");
        }
      }
      (_c = context == null ? void 0 : context.onProgress) == null ? void 0 : _c.call(context, 60, "Processing audio...");
      if (!data || typeof data.text !== "string") {
        console.error("Invalid response data:", data);
        throw new Error("No transcription text received from server");
      }
      const trimmedText = data.text.trim();
      if (!trimmedText) {
        console.error("Empty transcription text after trimming:", data);
        throw new Error("Empty transcription text received from server");
      }
      (_d = context == null ? void 0 : context.onProgress) == null ? void 0 : _d.call(context, 100, "Transcription complete!");
      return trimmedText;
    } catch (error) {
      console.error("Transcription error:", error);
      throw error;
    } finally {
      this.isTranscribing = false;
    }
  }
  unload() {
  }
};

// src/services/PostProcessingService.ts
init_SystemSculptService();
var PostProcessingService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.defaultModelId = null;
    this.sculptService = SystemSculptService.getInstance(plugin.settings, plugin.app);
  }
  static getInstance(plugin) {
    if (!PostProcessingService.instance) {
      PostProcessingService.instance = new PostProcessingService(plugin);
    }
    return PostProcessingService.instance;
  }
  async findDefaultModel() {
    if (this.defaultModelId)
      return this.defaultModelId;
    try {
      const models = await this.sculptService.getModels();
      const defaultModel = models.find((model) => {
        var _a;
        return (_a = model.name) == null ? void 0 : _a.match(/\(Default\)/i);
      });
      if (!defaultModel) {
        throw new Error("Default model not found");
      }
      this.defaultModelId = defaultModel.id;
      return defaultModel.id;
    } catch (error) {
      console.error("Error finding default model:", error);
      throw error;
    }
  }
  async processTranscription(text) {
    if (!this.plugin.settings.postProcessingEnabled) {
      return text;
    }
    try {
      const modelId = await this.findDefaultModel();
      const messages = [
        {
          role: "system",
          content: this.plugin.settings.postProcessingPrompt,
          message_id: crypto.randomUUID()
        },
        {
          role: "user",
          content: text,
          message_id: crypto.randomUUID()
        }
      ];
      let processedText = "";
      for await (const chunk of this.sculptService.streamMessage({
        messages,
        model: modelId,
        temperature: 0.3
      })) {
        if (chunk.content) {
          processedText += chunk.content;
        }
      }
      return processedText.trim();
    } catch (error) {
      console.error("Error post-processing transcription:", error);
      return text;
    }
  }
};

// src/modals/AudioTranscriptionModal.ts
var PersistentTranscriptionNotice = class extends import_obsidian15.Notice {
  constructor() {
    super("", 0);
    this.noticeEl.addClass("systemsculpt-transcription-notice");
    const progressContainer = this.noticeEl.createDiv("transcription-progress");
    const statusContainer = progressContainer.createDiv("transcription-status");
    this.statusIcon = statusContainer.createDiv("transcription-status-icon");
    this.statusText = statusContainer.createDiv("transcription-status-text");
    const progressBarContainer = progressContainer.createDiv("transcription-progress-bar-container");
    this.progressBar = progressBarContainer.createDiv("transcription-progress-bar");
    if (!document.getElementById("systemsculpt-transcription-notice-styles")) {
      const style = document.createElement("style");
      style.id = "systemsculpt-transcription-notice-styles";
      style.textContent = `
        .systemsculpt-transcription-notice {
          padding: 8px 12px !important;
          min-width: 260px;
        }

        .transcription-progress {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .transcription-status {
          display: flex;
          align-items: center;
          gap: 8px;
          color: var(--text-normal);
        }

        .transcription-status-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--text-accent);
        }

        .transcription-status-text {
          flex: 1;
          font-size: 14px;
        }

        .transcription-progress-bar-container {
          width: 100%;
          height: 4px;
          background: var(--background-modifier-border);
          border-radius: 2px;
          overflow: hidden;
        }

        .transcription-progress-bar {
          height: 100%;
          background: var(--text-accent);
          border-radius: 2px;
          transition: width 0.3s ease;
          width: 0%;
        }

        .notice-success .transcription-progress-bar {
          background: var(--text-success) !important;
        }

        .notice-error .transcription-progress-bar {
          background: var(--text-error) !important;
        }
      `;
      document.head.appendChild(style);
    }
  }
  updateProgress({ progress, status, icon }) {
    this.progressBar.style.width = `${progress}%`;
    this.statusText.setText(status);
    this.statusIcon.empty();
    (0, import_obsidian15.setIcon)(this.statusIcon, icon);
    this.noticeEl.removeClass("notice-success", "notice-error");
    if (progress === 100) {
      this.noticeEl.addClass("notice-success");
    } else if (progress === 0 && icon === "x-circle") {
      this.noticeEl.addClass("notice-error");
    }
  }
};
var AudioTranscriptionModal = class {
  constructor(app, options) {
    this.options = options;
    this.transcriptionService = TranscriptionService.getInstance(options.plugin);
    this.postProcessingService = PostProcessingService.getInstance(options.plugin);
  }
  open() {
    this.notice = new PersistentTranscriptionNotice();
    this.startTranscription();
  }
  async startTranscription() {
    try {
      this.notice.updateProgress({
        progress: 0,
        status: "Starting transcription...",
        icon: "mic"
      });
      const text = await this.transcriptionService.transcribeFile(this.options.file, {
        type: this.options.isChat ? "chat" : "note",
        timestamped: this.options.timestamped,
        onProgress: (progress, status) => {
          this.notice.updateProgress({
            progress,
            status,
            icon: "audio-lines"
          });
        }
      });
      if (!text) {
        throw new Error("Failed to get transcription text");
      }
      let finalText = text;
      if (!this.options.isChat && this.options.plugin.settings.postProcessingEnabled) {
        this.notice.updateProgress({
          progress: 80,
          status: "Post-processing transcription...",
          icon: "wand"
        });
        const processedText = await this.postProcessingService.processTranscription(text);
        finalText = `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}

## Processed Transcription
${processedText}`;
      } else {
        finalText = this.options.isChat ? text : `# Audio Transcription
Source: ${this.options.file.basename}
Transcribed: ${new Date().toISOString()}

## Raw Transcription
${text}`;
      }
      if (this.options.onTranscriptionComplete) {
        this.options.onTranscriptionComplete(finalText);
      }
      await navigator.clipboard.writeText(finalText);
      this.notice.updateProgress({
        progress: 100,
        status: "Transcription complete!",
        icon: "check-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 2e3);
    } catch (error) {
      console.error("Transcription error:", error);
      this.notice.updateProgress({
        progress: 0,
        status: `Error: ${error instanceof Error ? error.message : String(error)}`,
        icon: "x-circle"
      });
      setTimeout(() => {
        this.notice.hide();
      }, 4e3);
    }
  }
};
async function showAudioTranscriptionModal(app, options) {
  const modal = new AudioTranscriptionModal(app, options);
  modal.open();
}

// src/views/chatview/ChatView.ts
var import_obsidian27 = __toModule(require("obsidian"));
init_SystemSculptService();

// src/services/ChatStorageService.ts
var import_obsidian16 = __toModule(require("obsidian"));
var ChatStorageService = class {
  constructor(app, chatDirectory) {
    this.app = app;
    this.chatDirectory = chatDirectory;
  }
  async saveChat(chatId, messages, selectedModelId, contextFiles, customPromptFilePath, systemPromptType, systemPromptPath, title, tokenLimit, tokenLimitPercentage) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const contextFileObjects = contextFiles ? Array.from(contextFiles).map((path) => {
        const isExtraction = path.includes("/Extractions/");
        return {
          path,
          type: isExtraction ? "extraction" : "source"
        };
      }) : [];
      const metadata = {
        id: chatId,
        model: selectedModelId,
        created: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        title: title || chatId,
        context_files: contextFileObjects,
        systemMessage: systemPromptType ? {
          type: systemPromptType,
          path: systemPromptType === "custom" && systemPromptPath ? `[[${systemPromptPath}]]` : void 0,
          tokenLimit,
          tokenLimitPercentage
        } : void 0
      };
      const content = `---
${(0, import_obsidian16.stringifyYaml)(metadata)}---

${messages.map((msg) => {
        const messageStart = `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`;
        return `${messageStart}
${msg.content}
<!-- SYSTEMSCULPT-MESSAGE-END -->`;
      }).join("\n\n")}`;
      await this.app.vault.adapter.mkdir(this.chatDirectory);
      await this.app.vault.adapter.write(filePath, content);
    } catch (error) {
      console.error("Failed to save chat:", error);
      throw new Error("Failed to save chat");
    }
  }
  async loadChats() {
    try {
      const files = await this.app.vault.adapter.list(this.chatDirectory);
      const chatFiles = files.files.filter((f) => f.endsWith(".md"));
      const chats = await Promise.all(chatFiles.map(async (filePath) => {
        const content = await this.app.vault.adapter.read(filePath);
        return this.parseMarkdownContent(content);
      }));
      return chats.filter((chat) => chat !== null);
    } catch (error) {
      console.error("Failed to load chats:", error);
      return [];
    }
  }
  async loadChat(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian16.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMarkdownContent(content);
    } catch (error) {
      console.error("Failed to load chat:", error);
      return null;
    }
  }
  generateMarkdownContent(metadata, messages) {
    const yamlMetadata = {
      systemsculpt_chat: true,
      ...metadata
    };
    const metadataSection = [
      "---",
      (0, import_obsidian16.stringifyYaml)(yamlMetadata).trim(),
      "---",
      ""
    ].join("\n");
    const messagesSection = messages.map((msg) => [
      `<!-- SYSTEMSCULPT-MESSAGE-START role="${msg.role}" message-id="${msg.message_id}" -->`,
      msg.content,
      "<!-- SYSTEMSCULPT-MESSAGE-END -->",
      ""
    ].join("\n")).join("\n");
    return metadataSection + messagesSection;
  }
  parseMetadata(content) {
    try {
      const metadataMatch = content.match(/---\n([\s\S]*?)\n---/);
      if (!metadataMatch)
        return null;
      const parsed = (0, import_obsidian16.parseYaml)(metadataMatch[1]);
      if (!parsed || typeof parsed !== "object")
        return null;
      const {
        id,
        model,
        created,
        lastModified,
        title,
        context_files,
        systemMessage
      } = parsed;
      if (!id || !model || !created || !lastModified)
        return null;
      const processedContextFiles = context_files == null ? void 0 : context_files.map((file) => {
        if (typeof file === "string") {
          const isExtraction = file.includes("/Extractions/");
          return {
            path: file,
            type: isExtraction ? "extraction" : "source"
          };
        }
        return {
          path: file.path,
          type: file.type
        };
      });
      if (systemMessage == null ? void 0 : systemMessage.path) {
        systemMessage.path = systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      return {
        id,
        model,
        created,
        lastModified,
        title: title || id,
        context_files: processedContextFiles || [],
        systemMessage
      };
    } catch (error) {
      console.error("Failed to parse metadata:", error);
      return null;
    }
  }
  async parseMarkdownContent(content) {
    var _a, _b, _c;
    try {
      const metadata = this.parseMetadata(content);
      if (!metadata)
        return null;
      const messages = [];
      const messageRegex = /<!-- SYSTEMSCULPT-MESSAGE-START role="(user|assistant)" message-id="([^"]+)" -->\n([\s\S]*?)\n<!-- SYSTEMSCULPT-MESSAGE-END -->/g;
      let msgMatch;
      while ((msgMatch = messageRegex.exec(content)) !== null) {
        const [, role, messageId, messageContent] = msgMatch;
        messages.push({
          role,
          content: messageContent.trim(),
          message_id: messageId
        });
      }
      const contextFiles = (_a = metadata.context_files) == null ? void 0 : _a.map((file) => typeof file === "string" ? file : file.path);
      return {
        id: metadata.id,
        messages,
        selectedModelId: metadata.model,
        lastModified: new Date(metadata.lastModified).getTime(),
        title: metadata.title,
        context_files: contextFiles,
        customPromptFilePath: (_b = metadata.systemMessage) == null ? void 0 : _b.path,
        tokenLimit: (_c = metadata.systemMessage) == null ? void 0 : _c.tokenLimit
      };
    } catch (error) {
      console.error("Failed to parse markdown content:", error);
      return null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async getMetadata(chatId) {
    try {
      const filePath = `${this.chatDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!(file instanceof import_obsidian16.TFile)) {
        return null;
      }
      const content = await this.app.vault.read(file);
      return this.parseMetadata(content);
    } catch (error) {
      console.error("Failed to get metadata:", error);
      return null;
    }
  }
};

// src/views/chatview/ChatView.ts
init_ui();
init_errors();

// src/views/components/MessageRenderer.ts
var import_obsidian17 = __toModule(require("obsidian"));
init_ui();
var MessageRenderer = class extends import_obsidian17.Component {
  constructor(app) {
    super();
    this.app = app;
  }
  async renderMessage({
    app,
    messageId,
    role,
    content
  }) {
    const messageEl = document.createElement("div");
    messageEl.classList.add("systemsculpt-message");
    messageEl.classList.add(`systemsculpt-${role}-message`);
    messageEl.dataset.messageId = messageId;
    const contentEl = messageEl.createEl("div", {
      cls: "systemsculpt-message-content"
    });
    if (typeof content === "string") {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(content, contentEl, "", this);
    } else if (Array.isArray(content)) {
      const parts = content;
      for (const part of parts) {
        if (part.type === "text") {
          const p = contentEl.createEl("p");
          p.setText(part.text);
        } else if (part.type === "image_url") {
          const img = contentEl.createEl("img", {
            attr: { src: part.image_url.url }
          });
          img.classList.add("systemsculpt-message-image");
        }
      }
    } else {
      await import_obsidian17.MarkdownRenderer.renderMarkdown(String(content), contentEl, "", this);
    }
    this.setupImageHandlers(contentEl);
    return { messageEl, contentEl };
  }
  async renderMarkdownContent(content, containerEl) {
    containerEl.empty();
    const markdownWrapper = containerEl.createEl("div", {
      cls: "systemsculpt-markdown-wrapper"
    });
    const normalizedContent = content.replace(/\n{3,}/g, "\n\n");
    await import_obsidian17.MarkdownRenderer.renderMarkdown(normalizedContent, markdownWrapper, "", this);
    markdownWrapper.querySelectorAll("pre").forEach((preEl) => {
      var _a;
      const codeBlockWrapper = createEl("div", {
        cls: "systemsculpt-code-block-wrapper"
      });
      (_a = preEl.parentNode) == null ? void 0 : _a.replaceChild(codeBlockWrapper, preEl);
      codeBlockWrapper.appendChild(preEl);
    });
  }
  setupImageHandlers(containerEl) {
    containerEl.querySelectorAll("img").forEach((img) => {
      img.style.cursor = "pointer";
      img.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();
        const src = img.getAttribute("src");
        if (!src)
          return;
        if (src.startsWith("app://")) {
          const path = src.replace("app://local/", "");
          this.app.workspace.openLinkText(path, "", true);
        }
      });
    });
  }
  setToolbarVisibility(toolbar, visible, expanded = false) {
    toolbar.style.opacity = visible ? "1" : "0";
    toolbar.style.pointerEvents = visible ? "all" : "none";
    toolbar.style.transform = `translateY(calc(100% + ${expanded ? "4" : "8"}px))`;
  }
  addMessageButtonToolbar(messageEl, content, role, messageId) {
    const buttonToolbar = messageEl.createEl("div", {
      cls: "systemsculpt-message-button-toolbar"
    });
    const copyButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    copyButton.setAttribute("title", "Copy message to clipboard");
    (0, import_obsidian17.setIcon)(copyButton, "copy");
    copyButton.addEventListener("click", () => {
      navigator.clipboard.writeText(content);
      (0, import_obsidian17.setIcon)(copyButton, "check");
      copyButton.classList.add("success");
      setTimeout(() => {
        (0, import_obsidian17.setIcon)(copyButton, "copy");
        copyButton.classList.remove("success");
        this.setToolbarVisibility(buttonToolbar, false);
      }, 2e3);
    });
    if (role === "user") {
      const resubmitButton = buttonToolbar.createEl("button", {
        cls: "systemsculpt-message-button"
      });
      resubmitButton.setAttribute("title", "Resubmit this message");
      (0, import_obsidian17.setIcon)(resubmitButton, "rotate-ccw");
      resubmitButton.dataset.originalIcon = "rotate-ccw";
      resubmitButton.addEventListener("click", async (e) => {
        e.stopPropagation();
        const isConfirming = resubmitButton.dataset.confirming === "true";
        if (!isConfirming) {
          resubmitButton.dataset.confirming = "true";
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmit?" });
          resubmitButton.classList.add("confirming", "success");
          const timeoutId = setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 3e3);
          resubmitButton.dataset.timeoutId = timeoutId.toString();
        } else {
          const timeoutId = resubmitButton.dataset.timeoutId;
          if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
          }
          resubmitButton.empty();
          resubmitButton.createEl("span", { text: "Resubmitting..." });
          messageEl.dispatchEvent(new CustomEvent("resubmit", {
            bubbles: true,
            detail: { messageId, content }
          }));
          setTimeout(() => {
            resubmitButton.empty();
            const originalIcon = resubmitButton.dataset.originalIcon || "rotate-ccw";
            (0, import_obsidian17.setIcon)(resubmitButton, originalIcon);
            resubmitButton.classList.remove("confirming", "success");
            resubmitButton.dataset.confirming = "false";
          }, 1e3);
        }
      });
    }
    const editButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button"
    });
    editButton.setAttribute("title", "Edit this message");
    (0, import_obsidian17.setIcon)(editButton, "pencil");
    editButton.dataset.originalIcon = "pencil";
    editButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const currentContent = messageEl.dataset.content || content;
      const modal = new TextAreaModal(this.app, "Edit Message", currentContent, {
        primaryButton: "Save",
        secondaryButton: "Cancel",
        rows: 10
      });
      const newText = await modal.openAndGetValue();
      if (newText !== null && newText !== currentContent) {
        messageEl.dispatchEvent(new CustomEvent("edit", {
          bubbles: true,
          detail: {
            messageId,
            oldContent: currentContent,
            newContent: newText
          }
        }));
      }
    });
    const deleteButton = buttonToolbar.createEl("button", {
      cls: "systemsculpt-message-button danger"
    });
    deleteButton.setAttribute("title", "Delete this message");
    (0, import_obsidian17.setIcon)(deleteButton, "trash");
    deleteButton.dataset.originalIcon = "trash";
    deleteButton.addEventListener("click", async (e) => {
      e.stopPropagation();
      const isConfirming = deleteButton.dataset.confirming === "true";
      if (!isConfirming) {
        deleteButton.dataset.confirming = "true";
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Delete?" });
        deleteButton.classList.add("confirming");
        const timeoutId = setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 3e3);
        deleteButton.dataset.timeoutId = timeoutId.toString();
      } else {
        const timeoutId = deleteButton.dataset.timeoutId;
        if (timeoutId) {
          clearTimeout(parseInt(timeoutId));
        }
        deleteButton.empty();
        deleteButton.createEl("span", { text: "Deleting..." });
        messageEl.dispatchEvent(new CustomEvent("delete", {
          bubbles: true,
          detail: { messageId }
        }));
        setTimeout(() => {
          deleteButton.empty();
          const originalIcon = deleteButton.dataset.originalIcon || "trash";
          (0, import_obsidian17.setIcon)(deleteButton, originalIcon);
          deleteButton.classList.remove("confirming");
          deleteButton.dataset.confirming = "false";
        }, 1e3);
      }
    });
    messageEl.addEventListener("mouseenter", () => {
      this.setToolbarVisibility(buttonToolbar, true, true);
    });
    messageEl.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !buttonToolbar.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
    buttonToolbar.addEventListener("mouseleave", (e) => {
      if (!e.relatedTarget || !messageEl.contains(e.relatedTarget)) {
        this.setToolbarVisibility(buttonToolbar, false);
      }
    });
  }
  createReasoningContainer(messageEl) {
    const container = messageEl.createEl("div", {
      cls: "systemsculpt-reasoning-container"
    });
    const header = container.createEl("div", {
      cls: "systemsculpt-reasoning-header"
    });
    (0, import_obsidian17.setIcon)(header, "brain");
    header.createSpan({ text: "Reasoning" });
    header.addEventListener("click", () => {
      container.classList.toggle("collapsed");
    });
    const content = container.createEl("div", {
      cls: "systemsculpt-reasoning-content"
    });
    return { container, content };
  }
  updateReasoningContent(messageEl, reasoning, isComplete = false) {
    let container = messageEl.querySelector(".systemsculpt-reasoning-container");
    let content = messageEl.querySelector(".systemsculpt-reasoning-content");
    if (!container || !content) {
      const elements = this.createReasoningContainer(messageEl);
      container = elements.container;
      content = elements.content;
      messageEl.prepend(container);
    }
    content.textContent = reasoning;
    container.classList.add("visible");
    if (isComplete) {
      container.classList.add("collapsed");
    }
  }
};

// src/views/chatview/ChatView.ts
init_SystemPromptService();

// src/views/chatview/uiSetup.ts
init_ui();

// src/views/components/FileContextManager.ts
var import_obsidian22 = __toModule(require("obsidian"));

// src/views/components/DrawerComponent.ts
var import_obsidian18 = __toModule(require("obsidian"));
var DrawerComponent = class extends import_obsidian18.Component {
  constructor(options) {
    super();
    this.isMouseInProximity = false;
    this.hideTimeout = null;
    this.options = options;
    this.initializeDrawer();
    this.setupEventListeners();
  }
  initializeDrawer() {
    this.drawer = this.options.container.createEl("div", {
      cls: `systemsculpt-drawer ${this.options.cls || ""}`
    });
    this.header = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-header"
    });
    const titleEl = this.header.createEl("div", {
      cls: "systemsculpt-drawer-title"
    });
    titleEl.createSpan({ text: this.options.title });
    this.toggle = this.header.createSpan({
      cls: "systemsculpt-drawer-toggle",
      text: "\u25BC"
    });
    this.content = this.drawer.createEl("div", {
      cls: "systemsculpt-drawer-content"
    });
    this.setVisibility(false);
  }
  setupEventListeners() {
    this.drawer.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true);
    });
    this.content.addEventListener("mouseenter", () => {
      this.isMouseInProximity = true;
      this.clearHideTimeout();
      this.setVisibility(true);
    });
    this.drawer.addEventListener("mouseleave", (e) => {
      const rect = this.drawer.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY >= rect.bottom && e.clientY <= rect.bottom + buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.content.addEventListener("mouseleave", (e) => {
      const rect = this.content.getBoundingClientRect();
      const buffer = 25;
      if (e.clientY <= rect.top && e.clientY >= rect.top - buffer && e.clientX >= rect.left && e.clientX <= rect.right) {
        return;
      }
      this.isMouseInProximity = false;
      this.scheduleHide();
    });
    this.header.addEventListener("click", () => {
      const isVisible = this.content.style.opacity === "1";
      this.setVisibility(!isVisible);
    });
  }
  clearHideTimeout() {
    if (this.hideTimeout) {
      clearTimeout(this.hideTimeout);
      this.hideTimeout = null;
    }
  }
  scheduleHide() {
    this.clearHideTimeout();
    this.hideTimeout = setTimeout(() => {
      if (!this.isMouseInProximity) {
        this.setVisibility(false);
      }
    }, 100);
  }
  setVisibility(visible) {
    this.content.style.opacity = visible ? "1" : "0";
    this.content.style.pointerEvents = visible ? "all" : "none";
    this.content.style.transform = `translateY(${visible ? "0" : "-8px"})`;
    this.toggle.style.transform = visible ? "rotate(0)" : "rotate(-90deg)";
    if (this.options.onVisibilityChange) {
      this.options.onVisibilityChange(visible);
    }
  }
  getContent() {
    return this.content;
  }
  getDrawer() {
    return this.drawer;
  }
  getHeader() {
    return this.header;
  }
  onunload() {
    this.clearHideTimeout();
    super.onunload();
  }
};

// src/modals/ContextSelectionModal.ts
var import_obsidian20 = __toModule(require("obsidian"));
var import_obsidian21 = __toModule(require("obsidian"));

// src/services/TokenCounterService.ts
var import_obsidian19 = __toModule(require("obsidian"));
var TokenCounterService = class {
  constructor() {
    this.cache = new Map();
    this.fileCache = new Map();
    this.cacheSize = 1e3;
    this.handleFileModify = this.handleFileModify.bind(this);
    this.handleFileDelete = this.handleFileDelete.bind(this);
    this.handleFileRename = this.handleFileRename.bind(this);
  }
  handleFileModify(file) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileDelete(file) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(file.path);
    }
  }
  handleFileRename(file, oldPath) {
    if (file instanceof import_obsidian19.TFile) {
      this.fileCache.delete(oldPath);
    }
  }
  static getInstance() {
    if (!TokenCounterService.instance) {
      TokenCounterService.instance = new TokenCounterService();
    }
    return TokenCounterService.instance;
  }
  setApp(app) {
    this.app = app;
    this.app.vault.on("modify", this.handleFileModify);
    this.app.vault.on("delete", this.handleFileDelete);
    this.app.vault.on("rename", this.handleFileRename);
  }
  async getFileTokenCount(file) {
    const cached = this.fileCache.get(file.path);
    if (cached && cached.mtime === file.stat.mtime) {
      return cached.tokens;
    }
    const content = await this.app.vault.read(file);
    const tokens = this.approximateTokenCount(content);
    this.fileCache.set(file.path, {
      tokens,
      mtime: file.stat.mtime
    });
    return tokens;
  }
  approximateTokenCount(text) {
    if (!text)
      return 0;
    const cacheKey = `${text.slice(0, 100)}_${text.length}`;
    const cached = this.cache.get(cacheKey);
    if (cached !== void 0)
      return cached;
    text = text.replace(/\s+/g, " ").trim();
    let tokenCount = 0;
    const commonPatterns = [
      /^https?:\/\/\S+/gm,
      /[@#]\w+/g,
      /:[a-z_]+:/g,
      /[A-Z]{2,}/g,
      /\d{1,16}/g,
      /[.,!?;:(){}\[\]"']/g
    ];
    for (const pattern of commonPatterns) {
      const matches = text.match(pattern);
      if (matches) {
        tokenCount += matches.reduce((sum, match) => {
          if (match.startsWith("http")) {
            return sum + Math.ceil(match.length / 4);
          } else if (match.length <= 4) {
            return sum + 1;
          } else {
            return sum + Math.ceil(match.length / 3);
          }
        }, 0);
        text = text.replace(pattern, " ");
      }
    }
    const words = text.split(/\s+/).filter((w) => w.length > 0);
    for (const word of words) {
      let wordTokens = 1;
      if (word.length > 4) {
        wordTokens += Math.floor((word.length - 4) / 3);
      }
      if (/[a-z][A-Z]/.test(word)) {
        wordTokens += (word.match(/[A-Z]/g) || []).length;
      }
      const nonAscii = (word.match(/[^\x00-\x7F]/g) || []).length;
      if (nonAscii > 0) {
        wordTokens += Math.ceil(nonAscii * 1.5);
      }
      tokenCount += wordTokens;
    }
    tokenCount = Math.ceil(tokenCount * 1.1);
    this.cacheResult(cacheKey, tokenCount);
    return tokenCount;
  }
  cacheResult(key, value) {
    if (this.cache.size >= this.cacheSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
  clearCache() {
    this.cache.clear();
    this.fileCache.clear();
  }
  unload() {
    if (this.app) {
      this.app.vault.off("modify", this.handleFileModify);
      this.app.vault.off("delete", this.handleFileDelete);
      this.app.vault.off("rename", this.handleFileRename);
    }
  }
  formatTokenCount(count) {
    if (count === 0)
      return "";
    if (count < 100)
      return "< 100 tokens";
    if (count >= 1e3) {
      const inK = Math.ceil(count / 1e3);
      return `~${inK}K tokens`;
    } else {
      const inHundreds = Math.ceil(count / 100) * 100;
      return `~${inHundreds} tokens`;
    }
  }
};

// src/core/license/LicenseChecker.ts
init_ui();
var LicenseChecker = class {
  static requiresProLicense(extension) {
    return this.PRO_EXTENSIONS.includes(extension.toLowerCase());
  }
  static hasValidLicense(plugin) {
    var _a;
    return ((_a = plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && plugin.settings.licenseValid;
  }
  static async showProFeaturePopup(app) {
    const result = await showPopup(app, "Support SystemSculpt's development and unlock powerful document processing features. Upgrade to Pro to process PDFs, Word documents, and audio files.", {
      title: "Pro Feature Required",
      primaryButton: "Become a Patron",
      secondaryButton: "Maybe Later",
      icon: "sparkles"
    });
    if (result == null ? void 0 : result.confirmed) {
      window.open(PATREON_URL, "_blank");
    }
    return (result == null ? void 0 : result.confirmed) || false;
  }
  static async checkLicenseForFile(file, app, plugin) {
    if (this.requiresProLicense(file.extension.toLowerCase())) {
      if (!this.hasValidLicense(plugin)) {
        await this.showProFeaturePopup(app);
        return false;
      }
    }
    return true;
  }
};
LicenseChecker.PRO_EXTENSIONS = [
  "pdf",
  "doc",
  "docx",
  "ppt",
  "pptx",
  "xls",
  "xlsx",
  "mp3",
  "wav",
  "m4a",
  "ogg",
  "webm"
];

// src/modals/ContextSelectionModal.ts
var SUPPORTED_EXTENSIONS = {
  documents: ["md", "txt"],
  proDocuments: ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"],
  images: ["png", "jpg", "jpeg", "gif", "svg", "webp"],
  audio: ["mp3", "wav", "m4a", "ogg", "webm"]
};
var ALL_SUPPORTED_EXTENSIONS = Object.values(SUPPORTED_EXTENSIONS).flat();
var ContextSelectionModal = class extends import_obsidian20.Modal {
  constructor(app, onSelect, plugin) {
    super(app);
    this.tokenCounts = new Map();
    this.currentSearchResults = [];
    this.searchTimeout = null;
    this.selectedExtensions = new Set();
    this.extensionButtons = new Map();
    this.selectedFiles = new Set();
    this.selectedIndex = 0;
    this.resultElements = [];
    this.onSelect = onSelect;
    this.searchService = new SearchService();
    this.tokenCounter = TokenCounterService.getInstance();
    this.plugin = plugin;
    this.files = this.getAvailableFiles();
    this.selectedExtensions.add("md");
  }
  getAvailableFiles() {
    return this.app.vault.getFiles().filter((file) => ALL_SUPPORTED_EXTENSIONS.includes(file.extension.toLowerCase()));
  }
  getSearchFields(file) {
    return [
      { field: "title", text: file.basename, weight: 100 },
      { field: "path", text: file.path, weight: 75 },
      { field: "extension", text: file.extension, weight: 50 }
    ];
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
  highlightText(text, matches = []) {
    var _a;
    if (!matches || matches.length === 0) {
      const fragment2 = createFragment();
      fragment2.appendText(text);
      return fragment2;
    }
    const fragment = createFragment();
    const searchQuery = ((_a = this.searchInput) == null ? void 0 : _a.value) || "";
    const normalizedQuery = searchQuery.toLowerCase().trim();
    const regex = new RegExp(`(${normalizedQuery})`, "gi");
    let lastIndex = 0;
    let match;
    while ((match = regex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        fragment.appendText(text.slice(lastIndex, match.index));
      }
      const span = fragment.createSpan({
        cls: "systemsculpt-highlight",
        text: match[0]
      });
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      fragment.appendText(text.slice(lastIndex));
    }
    return fragment;
  }
  createLoadingIndicator() {
    const container = createDiv({ cls: "systemsculpt-context-loading" });
    (0, import_obsidian21.setIcon)(container, "loader-2");
    container.appendChild(createSpan({ text: "Loading..." }));
    return container;
  }
  createEmptyState() {
    const container = createDiv({ cls: "systemsculpt-context-empty" });
    (0, import_obsidian21.setIcon)(container, "search");
    container.appendChild(createSpan({ text: "No matching files found" }));
    return container;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  createCard(file, result) {
    var _a;
    const card = createDiv({ cls: "systemsculpt-context-card" });
    card.setAttribute("tabindex", "0");
    const cardContent = card.createDiv({ cls: "systemsculpt-card-content" });
    if (file.extension.match(/png|jpe?g|gif|svg|webp/i)) {
      const thumbContainer = cardContent.createDiv({
        cls: "systemsculpt-context-thumbnail"
      });
      (async () => {
        try {
          const arrayBuffer = await this.app.vault.readBinary(file);
          const blob = new Blob([arrayBuffer]);
          const objectUrl = URL.createObjectURL(blob);
          const img = thumbContainer.createEl("img", {
            cls: "systemsculpt-context-thumb-img",
            attr: { src: objectUrl }
          });
        } catch (err) {
          console.error("Error loading thumbnail:", err);
        }
      })();
    }
    if (this.selectedFiles.has(file)) {
      card.addClass("is-added");
      const checkIcon = card.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    const textContainer = cardContent.createDiv({
      cls: "systemsculpt-card-text"
    });
    const title = textContainer.createDiv({
      cls: "systemsculpt-context-title"
    });
    title.appendChild(this.highlightText(file.basename, result.matches.filter((m) => m.field === "title")));
    const path = textContainer.createDiv({ cls: "systemsculpt-context-path" });
    path.appendChild(this.highlightText(file.path, result.matches.filter((m) => m.field === "path")));
    const meta = textContainer.createDiv({ cls: "systemsculpt-context-meta" });
    const typeGroup = meta.createDiv({
      cls: "systemsculpt-context-type-group"
    });
    const type = typeGroup.createDiv({ cls: "systemsculpt-context-type" });
    type.setText(file.extension.toUpperCase());
    if (LicenseChecker.requiresProLicense(file.extension)) {
      const proBadge = typeGroup.createDiv({
        cls: "systemsculpt-context-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge.createSpan(), "sparkles");
      proBadge.createSpan({ text: "Pro" });
    }
    const metaGroup = meta.createDiv({
      cls: "systemsculpt-context-meta-group"
    });
    const size = metaGroup.createDiv({ cls: "systemsculpt-context-size" });
    size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
    if (file.extension === "md" || file.extension === "txt") {
      const tokenCount = metaGroup.createDiv({
        cls: "systemsculpt-context-token-count"
      });
      const count = this.tokenCounts.get(file.path) || 0;
      tokenCount.setText(this.tokenCounter.formatTokenCount(count));
      if (!this.tokenCounts.has(file.path)) {
        this.updateTokenCount(file).then(() => {
          tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
        });
      }
    }
    card.addEventListener("click", () => {
      this.toggleFileSelection(file, card);
    });
    card.addEventListener("mouseenter", () => {
      const index = this.resultElements.indexOf(card);
      if (index >= 0) {
        this.selectedIndex = index;
        this.updateSelectedResult();
      }
    });
    return card;
  }
  updateSelectedResult() {
    this.resultElements.forEach((el, index) => {
      el.toggleClass("is-selected", index === this.selectedIndex && this.selectedIndex >= 0);
    });
    if (this.selectedIndex >= 0 && this.selectedIndex < this.resultElements.length) {
      this.resultElements[this.selectedIndex].scrollIntoView({
        behavior: "smooth",
        block: "nearest"
      });
    }
  }
  async toggleFileSelection(file, cardEl) {
    var _a;
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (this.selectedFiles.has(file)) {
      this.selectedFiles.delete(file);
      cardEl.removeClass("is-added");
      (_a = cardEl.querySelector(".systemsculpt-context-check")) == null ? void 0 : _a.remove();
    } else {
      this.selectedFiles.add(file);
      cardEl.addClass("is-added");
      const checkIcon = cardEl.createDiv({ cls: "systemsculpt-context-check" });
      (0, import_obsidian21.setIcon)(checkIcon, "check");
    }
    this.updateActionButton();
  }
  updateActionButton() {
    const actionButton = this.containerEl.querySelector(".systemsculpt-context-action-button");
    if (actionButton) {
      const count = this.selectedFiles.size;
      actionButton.setText(count > 0 ? `Add ${count} selected file${count === 1 ? "" : "s"}` : "Select files to add as context");
      actionButton.toggleClass("is-active", count > 0);
    }
  }
  renderResults(searchResults) {
    this.resultsContainer.empty();
    this.resultElements = [];
    this.currentSearchResults = searchResults;
    if (searchResults.length === 0) {
      this.emptyState.style.display = "flex";
      return;
    }
    this.emptyState.style.display = "none";
    const grid = this.resultsContainer.createDiv({
      cls: "systemsculpt-context-grid"
    });
    searchResults.forEach((result, index) => {
      const card = this.createCard(result.item, result);
      grid.appendChild(card);
      this.resultElements.push(card);
    });
  }
  getUniqueExtensions() {
    const extensions = new Set();
    this.files.forEach((file) => {
      if (file.extension) {
        extensions.add(file.extension.toLowerCase());
      }
    });
    return Array.from(extensions).sort((a, b) => {
      if (a === "md")
        return -1;
      if (b === "md")
        return 1;
      const aIsPro = LicenseChecker.requiresProLicense(a);
      const bIsPro = LicenseChecker.requiresProLicense(b);
      if (aIsPro && !bIsPro)
        return 1;
      if (!aIsPro && bIsPro)
        return -1;
      return a.localeCompare(b);
    });
  }
  createExtensionButton(extension) {
    const button = createDiv({
      cls: "systemsculpt-extension-button"
    });
    const iconContainer = button.createSpan({
      cls: "systemsculpt-extension-icon"
    });
    if (SUPPORTED_EXTENSIONS.documents.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "file-text");
    } else if (SUPPORTED_EXTENSIONS.images.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "image");
    } else if (SUPPORTED_EXTENSIONS.audio.includes(extension)) {
      (0, import_obsidian21.setIcon)(iconContainer, "headphones");
    }
    button.createSpan({
      text: extension.toUpperCase(),
      cls: "systemsculpt-extension-text"
    });
    if (LicenseChecker.requiresProLicense(extension)) {
      const proBadge = button.createSpan({
        cls: "systemsculpt-extension-badge pro-badge"
      });
      (0, import_obsidian21.setIcon)(proBadge, "sparkles");
    }
    button.addEventListener("click", () => {
      if (this.selectedExtensions.has(extension)) {
        this.selectedExtensions.delete(extension);
        button.removeClass("is-selected");
      } else {
        this.selectedExtensions.add(extension);
        button.addClass("is-selected");
      }
      this.performSearch(this.searchInput.value);
    });
    return button;
  }
  performSearch(query) {
    let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
    results.sort((a, b) => {
      if (b.score !== a.score)
        return b.score - a.score;
      return a.item.basename.localeCompare(b.item.basename);
    });
    this.renderResults(results);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-context-modal");
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-context-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search files to add as context..."
    });
    const extensionContainer = contentEl.createDiv({
      cls: "systemsculpt-extension-container"
    });
    const extensions = this.getUniqueExtensions();
    extensions.forEach((ext) => {
      const button = this.createExtensionButton(ext);
      this.extensionButtons.set(ext, button);
      extensionContainer.appendChild(button);
    });
    const mdBtn = this.extensionButtons.get("md");
    if (mdBtn)
      mdBtn.addClass("is-selected");
    this.loadingIndicator = this.createLoadingIndicator();
    contentEl.appendChild(this.loadingIndicator);
    this.emptyState = this.createEmptyState();
    this.emptyState.style.display = "none";
    contentEl.appendChild(this.emptyState);
    const scrollContainer = contentEl.createDiv({
      cls: "systemsculpt-scroll-container"
    });
    this.resultsContainer = scrollContainer.createDiv();
    const actionContainer = contentEl.createDiv({
      cls: "systemsculpt-action-container"
    });
    const actionButton = actionContainer.createEl("button", {
      cls: "systemsculpt-context-action-button",
      text: "Select files to add as context"
    });
    actionButton.addEventListener("click", () => {
      if (this.selectedFiles.size > 0) {
        this.onSelect(Array.from(this.selectedFiles));
        this.close();
      }
    });
    this.updateActionButton();
    this.loadingIndicator.style.display = "flex";
    this.resultsContainer.empty();
    this.setupEventListeners();
    this.containerEl.addEventListener("keydown", (e) => {
      if (document.activeElement === this.searchInput)
        return;
      if (this.currentSearchResults.length === 0)
        return;
      if (e.key === "Tab") {
        e.preventDefault();
        if (e.shiftKey && this.selectedIndex === 0) {
          this.searchInput.focus();
          return;
        }
        if (e.shiftKey) {
          this.selectedIndex = (this.selectedIndex - 1 + this.resultElements.length) % this.resultElements.length;
        } else {
          this.selectedIndex = (this.selectedIndex + 1) % this.resultElements.length;
        }
        this.updateSelectedResult();
        return;
      }
      if (e.code === "Space") {
        e.preventDefault();
        const file = this.currentSearchResults[this.selectedIndex].item;
        const cardEl = this.resultElements[this.selectedIndex];
        this.toggleFileSelection(file, cardEl);
        return;
      }
      if (e.key === "Enter") {
        e.preventDefault();
        if (this.selectedFiles.size > 0) {
          this.onSelect(Array.from(this.selectedFiles));
          this.close();
        }
        return;
      }
    });
    this.searchInput.focus();
    this.performSearch("");
    this.loadingIndicator.style.display = "none";
  }
  setupEventListeners() {
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        e.stopPropagation();
        if (this.resultElements.length > 0) {
          if (e.shiftKey) {
            this.selectedIndex = this.resultElements.length - 1;
          } else {
            this.selectedIndex = 0;
          }
          this.updateSelectedResult();
          this.resultElements[this.selectedIndex].focus();
        }
      }
    });
    this.searchInput.addEventListener("focus", () => {
      this.selectedIndex = -1;
      this.updateSelectedResult();
    });
    this.searchInput.addEventListener("input", () => {
      if (this.searchTimeout) {
        window.clearTimeout(this.searchTimeout);
      }
      this.searchTimeout = window.setTimeout(() => {
        const query = this.searchInput.value;
        let results = this.searchService.search(this.files.filter((file) => this.selectedExtensions.size === 0 || this.selectedExtensions.has(file.extension.toLowerCase())), query, (file) => this.getSearchFields(file));
        results.sort((a, b) => {
          if (b.score !== a.score)
            return b.score - a.score;
          return a.item.basename.localeCompare(b.item.basename);
        });
        this.renderResults(results);
      }, 150);
    });
  }
  onClose() {
    if (this.searchTimeout) {
      window.clearTimeout(this.searchTimeout);
    }
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/views/components/FileContextManager.ts
var import_obsidian23 = __toModule(require("obsidian"));
var FileContextManager = class extends import_obsidian22.Component {
  constructor(options) {
    super();
    this.contextFiles = new Set();
    this.processingStatus = null;
    this.processingFiles = new Map();
    this.processingTimeouts = new Map();
    this.syncStatusEl = null;
    this.isSyncing = false;
    this.tokenCounts = new Map();
    this.app = options.app;
    this.onContextChange = options.onContextChange;
    this.sculptService = options.sculptService;
    this.plugin = options.plugin;
    this.tokenCounter = TokenCounterService.getInstance();
    this.drawer = new DrawerComponent({
      container: options.container,
      title: options.title || "Files"
    });
    this.contextPanel = this.drawer.getDrawer();
    this.setupContextPanel();
    this.initializeProcessingStatus();
  }
  initializeProcessingStatus() {
    this.processingStatus = this.contextPanel.createEl("div", {
      cls: "systemsculpt-processing-status"
    });
    this.processingStatus.style.display = "none";
  }
  updateProcessingStatus(file, status, icon, remove = false) {
    const fileId = file.path;
    let statusEl = this.processingFiles.get(fileId);
    const existingTimeout = this.processingTimeouts.get(fileId);
    if (existingTimeout) {
      clearTimeout(existingTimeout);
      this.processingTimeouts.delete(fileId);
    }
    if (!statusEl && !remove && this.processingStatus) {
      statusEl = this.processingStatus.createEl("div", {
        cls: "systemsculpt-file-status"
      });
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
      this.processingFiles.set(fileId, statusEl);
    } else if (statusEl && !remove) {
      statusEl.empty();
      const iconEl = statusEl.createSpan({
        cls: "systemsculpt-status-icon"
      });
      (0, import_obsidian22.setIcon)(iconEl, icon);
      statusEl.createSpan({
        text: `${file.basename}: ${status}`,
        cls: "systemsculpt-status-text"
      });
    } else if (statusEl && remove) {
      statusEl.remove();
      this.processingFiles.delete(fileId);
    }
    if (this.processingStatus) {
      this.processingStatus.style.display = this.processingFiles.size > 0 ? "block" : "none";
    }
    if (remove || status.includes("successfully") || status.includes("completed") || status.includes("Error:")) {
      const timeout = setTimeout(() => {
        this.updateProcessingStatus(file, "", "", true);
        this.processingTimeouts.delete(fileId);
      }, 3e3);
      this.processingTimeouts.set(fileId, timeout);
    }
  }
  setupContextPanel() {
    const titleEl = this.contextPanel.querySelector(".systemsculpt-drawer-title");
    if (!titleEl)
      return;
    const contextCount = titleEl.createSpan({
      cls: "systemsculpt-drawer-count",
      text: "0"
    });
    this.syncStatusEl = titleEl.createSpan({
      cls: "systemsculpt-sync-status synced"
    });
    (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    const contextButton = titleEl.createEl("button", {
      cls: "systemsculpt-context-add-button"
    });
    (0, import_obsidian22.setIcon)(contextButton, "plus");
    contextButton.addEventListener("click", (e) => {
      e.stopPropagation();
      this.addContextFile();
    });
    this.updateContextPanel();
  }
  updateSyncStatus(syncing = false) {
    if (!this.syncStatusEl)
      return;
    this.isSyncing = syncing;
    this.syncStatusEl.empty();
    if (syncing) {
      this.syncStatusEl.removeClass("synced");
      this.syncStatusEl.addClass("syncing");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "loader-2");
    } else {
      this.syncStatusEl.removeClass("syncing");
      this.syncStatusEl.addClass("synced");
      (0, import_obsidian22.setIcon)(this.syncStatusEl, "check");
    }
  }
  async checkSyncStatus() {
    if (this.contextFiles.size === 0) {
      this.updateSyncStatus(false);
      return;
    }
    this.updateSyncStatus(true);
    this.updateSyncStatus(false);
  }
  updateContextPanel() {
    var _a;
    if (!this.contextPanel)
      return;
    const header = this.contextPanel.querySelector(".systemsculpt-drawer-header");
    const content = this.contextPanel.querySelector(".systemsculpt-drawer-content");
    const count = this.contextPanel.querySelector(".systemsculpt-drawer-count");
    if (!header || !content || !count)
      return;
    count.textContent = this.contextFiles.size.toString();
    content.empty();
    if (this.contextFiles.size === 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-empty",
        text: "No context files added yet. Click the plus button to add files in your chat."
      });
      return;
    }
    const categories = {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
    const documentGroups = new Map();
    const nonExtractedFiles = new Set();
    for (const filePath of this.contextFiles) {
      const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      if (cleanPath.includes("/Extractions/")) {
        const parts = cleanPath.split("/");
        const extractionDirIndex = parts.indexOf("Extractions");
        if (extractionDirIndex >= 0 && extractionDirIndex + 1 < parts.length) {
          const sourceDoc = parts[extractionDirIndex + 1];
          if (!documentGroups.has(sourceDoc)) {
            documentGroups.set(sourceDoc, new Set());
          }
          (_a = documentGroups.get(sourceDoc)) == null ? void 0 : _a.add(filePath);
        } else {
          nonExtractedFiles.add(filePath);
        }
      } else {
        nonExtractedFiles.add(filePath);
      }
    }
    this.categorizeFiles(Array.from(nonExtractedFiles), categories);
    for (const categoryKey of ["text", "images", "audio"]) {
      const category = categories[categoryKey];
      if (category.files.length > 0) {
        this.renderCategory(content, category);
      }
    }
    if (categories.documents.files.length > 0 || documentGroups.size > 0) {
      content.createEl("div", {
        cls: "systemsculpt-drawer-category",
        text: "Documents"
      });
      this.renderFiles(content, categories.documents.files);
      for (const [sourceDoc, extractedFiles] of documentGroups) {
        content.createEl("div", {
          cls: "systemsculpt-drawer-category",
          text: `\u{1F4C4} ${sourceDoc} Extractions`
        });
        const extractedCategories = this.createCategories();
        this.categorizeFiles(Array.from(extractedFiles), extractedCategories);
        const textFiles = extractedCategories.text.files;
        if (textFiles.length > 0) {
          this.renderFiles(content, textFiles);
        }
        const imageFiles = extractedCategories.images.files;
        if (imageFiles.length > 0) {
          this.renderFiles(content, imageFiles);
        }
        const otherFiles = [
          ...extractedCategories.audio.files,
          ...extractedCategories.documents.files
        ];
        if (otherFiles.length > 0) {
          this.renderFiles(content, otherFiles);
        }
      }
    }
  }
  createCategories() {
    return {
      text: {
        label: "Text Files",
        files: [],
        extensions: ["md", "txt", "markdown"]
      },
      images: {
        label: "Images",
        files: [],
        extensions: ["jpg", "jpeg", "png", "gif", "webp", "svg"]
      },
      audio: {
        label: "Audio Files",
        files: [],
        extensions: ["mp3", "wav", "ogg", "m4a"]
      },
      documents: {
        label: "Documents",
        files: [],
        extensions: ["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"]
      }
    };
  }
  categorizeFiles(files, categories) {
    for (const filePath of files) {
      const linkText = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(linkText, "");
      if (resolvedFile instanceof import_obsidian22.TFile) {
        const extension = resolvedFile.extension.toLowerCase();
        let categoryFound = false;
        for (const [category, info] of Object.entries(categories)) {
          if (info.extensions.includes(extension)) {
            info.files.push({ file: resolvedFile, path: filePath, linkText });
            categoryFound = true;
            break;
          }
        }
        if (!categoryFound) {
          categories.documents.files.push({
            file: resolvedFile,
            path: filePath,
            linkText
          });
        }
      }
    }
  }
  renderCategory(container, category) {
    if (category.files.length === 0)
      return;
    container.createEl("div", {
      cls: "systemsculpt-drawer-category",
      text: category.label
    });
    this.renderFiles(container, category.files);
  }
  renderFiles(container, files) {
    files.sort((a, b) => a.file.basename.localeCompare(b.file.basename));
    const imagePreview = document.body.createEl("img", {
      cls: "systemsculpt-preview systemsculpt-image-preview"
    });
    const markdownPreview = document.body.createDiv({
      cls: "systemsculpt-preview systemsculpt-markdown-preview"
    });
    let isMarkdownPreviewVisible = false;
    const handleWheel = (e) => {
      if (!isMarkdownPreviewVisible)
        return;
      e.preventDefault();
      const scrollAmount = e.deltaY;
      markdownPreview.scrollTop += scrollAmount;
    };
    document.addEventListener("wheel", handleWheel, { passive: false });
    this.register(() => {
      document.removeEventListener("wheel", handleWheel);
    });
    const calculatePreviewDimensions = (naturalWidth, naturalHeight, viewportWidth, viewportHeight) => {
      const maxWidth = Math.min(viewportWidth * 0.4, naturalWidth);
      const maxHeight = Math.min(viewportHeight * 0.6, naturalHeight);
      let width = naturalWidth;
      let height = naturalHeight;
      if (width > maxWidth) {
        width = maxWidth;
        height = naturalHeight * maxWidth / naturalWidth;
      }
      if (height > maxHeight) {
        height = maxHeight;
        width = naturalWidth * maxHeight / naturalHeight;
      }
      return { width, height };
    };
    const updatePreviewPosition = (e, previewEl) => {
      if (!previewEl)
        return;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const rect = previewEl.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      let x = e.clientX + 16;
      let y = e.clientY + 16;
      if (x + width > viewportWidth) {
        x = e.clientX - width - 16;
      }
      if (y + height > viewportHeight) {
        y = e.clientY - height - 16;
      }
      previewEl.style.left = `${x}px`;
      previewEl.style.top = `${y}px`;
    };
    this.register(() => {
      imagePreview.remove();
      markdownPreview.remove();
    });
    for (const { file, path, linkText } of files) {
      const item = container.createEl("div", {
        cls: "systemsculpt-drawer-item"
      });
      const pathEl = item.createEl("div", {
        cls: "systemsculpt-drawer-item-path"
      });
      const iconContainer = pathEl.createSpan({
        cls: "systemsculpt-file-icon"
      });
      const extension = file.extension.toLowerCase();
      let iconName = "file";
      const link = pathEl.createEl("a", {
        cls: "internal-link",
        text: file.basename,
        attr: {
          href: path,
          "data-href": path
        }
      });
      if (["md", "txt", "markdown"].includes(extension)) {
        iconName = "file-text";
        const showMarkdownPreview = async (e) => {
          try {
            const mdFile = this.app.vault.getAbstractFileByPath(file.path);
            if (mdFile instanceof import_obsidian22.TFile) {
              const content = await this.app.vault.read(mdFile);
              markdownPreview.empty();
              markdownPreview.createDiv({
                cls: "systemsculpt-preview-header",
                text: file.basename
              });
              const contentEl = markdownPreview.createDiv();
              await import_obsidian23.MarkdownRenderer.renderMarkdown(content.length > 4e3 ? content.slice(0, 4e3) + "\n\n---\n\n**Click to view full document** (showing first 4000 of " + content.length + " characters)" : content, contentEl, file.path, this);
              markdownPreview.classList.add("visible");
              isMarkdownPreviewVisible = true;
              updatePreviewPosition(e, markdownPreview);
            }
          } catch (error) {
            console.error("Failed to load markdown preview:", error);
          }
        };
        const hideMarkdownPreview = () => {
          markdownPreview.classList.remove("visible");
          markdownPreview.empty();
          isMarkdownPreviewVisible = false;
          markdownPreview.scrollTop = 0;
        };
        item.addEventListener("mouseenter", showMarkdownPreview);
        item.addEventListener("mouseleave", hideMarkdownPreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, markdownPreview));
        markdownPreview.addEventListener("mouseleave", hideMarkdownPreview);
        this.register(() => {
          markdownPreview.removeEventListener("mouseleave", hideMarkdownPreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideMarkdownPreview);
      } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        iconName = "image";
        const showImagePreview = async (e) => {
          try {
            const imageFile = this.app.vault.getAbstractFileByPath(file.path);
            if (imageFile instanceof import_obsidian22.TFile) {
              const arrayBuffer = await this.app.vault.readBinary(imageFile);
              const blob = new Blob([arrayBuffer]);
              const url = URL.createObjectURL(blob);
              imagePreview.src = url;
              imagePreview.onload = () => {
                URL.revokeObjectURL(url);
                imagePreview.classList.add("visible");
                const { width, height } = calculatePreviewDimensions(imagePreview.naturalWidth, imagePreview.naturalHeight, window.innerWidth, window.innerHeight);
                imagePreview.style.width = `${width}px`;
                imagePreview.style.height = `${height}px`;
                updatePreviewPosition(e, imagePreview);
              };
            }
          } catch (error) {
            console.error("Failed to load image preview:", error);
          }
        };
        const hideImagePreview = () => {
          imagePreview.classList.remove("visible");
          imagePreview.src = "";
          imagePreview.style.width = "";
          imagePreview.style.height = "";
        };
        item.addEventListener("mouseenter", showImagePreview);
        item.addEventListener("mouseleave", hideImagePreview);
        item.addEventListener("mousemove", (e) => updatePreviewPosition(e, imagePreview));
        imagePreview.addEventListener("mouseleave", hideImagePreview);
        this.register(() => {
          imagePreview.removeEventListener("mouseleave", hideImagePreview);
        });
        this.contextPanel.addEventListener("mouseleave", hideImagePreview);
      } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
        iconName = "audio-lines";
      } else if (["doc", "docx", "ppt", "pptx", "xls", "xlsx", "pdf"].includes(extension)) {
        iconName = "file";
      }
      (0, import_obsidian22.setIcon)(iconContainer, iconName);
      link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        this.app.workspace.openLinkText(linkText, "", true);
      });
      const meta = item.createDiv({ cls: "systemsculpt-context-meta" });
      const removeBtn = meta.createEl("button", {
        cls: "systemsculpt-drawer-item-remove",
        text: "\xD7"
      });
      removeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        this.removeContextFile(path);
      });
      const updateMetaInfo = () => {
        var _a;
        const availableWidth = container.offsetWidth - 40;
        const fileNameWidth = link.offsetWidth;
        const removeBtnWidth = 24;
        const remainingWidth = availableWidth - fileNameWidth - removeBtnWidth;
        const existingMeta = meta.querySelectorAll(".systemsculpt-context-type, .systemsculpt-context-size, .systemsculpt-context-token-count");
        existingMeta.forEach((el) => el.remove());
        if (remainingWidth > 150) {
          if (remainingWidth > 200) {
            const type = meta.createDiv({ cls: "systemsculpt-context-type" });
            type.setText(file.extension.toUpperCase());
          }
          if (remainingWidth > 100) {
            const size = meta.createDiv({ cls: "systemsculpt-context-size" });
            size.setText(this.formatFileSize(((_a = file.stat) == null ? void 0 : _a.size) || 0));
          }
          if (remainingWidth > 250 && (file.extension === "md" || file.extension === "txt")) {
            const tokenCount = meta.createDiv({
              cls: "systemsculpt-context-token-count"
            });
            const count = this.tokenCounts.get(file.path) || 0;
            tokenCount.setText(this.tokenCounter.formatTokenCount(count));
            if (!this.tokenCounts.has(file.path)) {
              this.updateTokenCount(file).then(() => {
                tokenCount.setText(this.tokenCounter.formatTokenCount(this.tokenCounts.get(file.path) || 0));
              });
            }
          }
        }
      };
      updateMetaInfo();
      const resizeObserver = new ResizeObserver(() => {
        updateMetaInfo();
      });
      resizeObserver.observe(container);
      this.register(() => {
        resizeObserver.disconnect();
      });
    }
  }
  async addContextFile() {
    const modal = new ContextSelectionModal(this.app, async (files) => {
      for (const file of files) {
        try {
          await this.addFileToContext(file);
        } catch (error) {
          this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
          setTimeout(() => {
            this.updateProcessingStatus(file, "", "", true);
          }, 3e3);
        }
      }
    }, this.plugin);
    modal.open();
  }
  async removeContextFile(filePath) {
    const normalizedPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1");
    this.contextFiles.delete(filePath);
    this.contextFiles.delete(`[[${normalizedPath}]]`);
    this.updateContextPanel();
    await this.onContextChange();
  }
  async addFileToContext(file) {
    const extension = file.extension.toLowerCase();
    const datalabDocExtensions = [
      "pdf",
      "doc",
      "docx",
      "xls",
      "xlsx",
      "ppt",
      "pptx"
    ];
    const audioExtensions = ["wav", "m4a", "webm", "ogg", "mp3"];
    if (!await LicenseChecker.checkLicenseForFile(file, this.app, this.plugin)) {
      return;
    }
    if (datalabDocExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processDocumentFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else if (audioExtensions.includes(extension)) {
      try {
        const newMdPath = await this.processAudioFile(file);
        const wikiLink = `[[${newMdPath}]]`;
        this.contextFiles.add(wikiLink);
      } catch (error) {
        this.updateProcessingStatus(file, `Error: ${error.message}`, "x-circle");
      }
    } else {
      const wikiLink = `[[${file.path}]]`;
      this.contextFiles.add(wikiLink);
    }
    this.updateContextPanel();
    await this.onContextChange();
  }
  async processDocumentFile(file) {
    var _a, _b;
    this.updateProcessingStatus(file, "Uploading...", "upload");
    const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
    if (!cached) {
      this.updateProcessingStatus(file, "Processing...", "loader-2");
      const success = await this.pollUntilComplete(documentId);
      if (!success) {
        throw new Error("Document processing not completed in time.");
      }
    }
    this.updateProcessingStatus(file, "Downloading results...", "download");
    const extractionData = await this.downloadExtraction(documentId);
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
    await this.app.vault.createFolder(parentPath).catch(() => {
    });
    const extractedText = this.getExtractionMarkdown(extractionData);
    const newMdPath = `${parentPath}/${baseName}.md`;
    try {
      await this.app.vault.create(newMdPath, extractedText);
    } catch (error) {
      if (!(error instanceof Error) || !error.message.includes("already exists")) {
        throw error;
      }
    }
    const mdWikiLink = `[[${newMdPath}]]`;
    this.contextFiles.add(mdWikiLink);
    if (extractionData.images && typeof extractionData.images === "object") {
      for (const [filename, base64Data] of Object.entries(extractionData.images)) {
        const imagePath = `${parentPath}/${filename.replace(/[\\/:*?"<>|]/g, "-").trim()}`;
        try {
          await this.app.vault.createBinary(imagePath, this.decodeBase64(base64Data));
        } catch (error) {
          if (!(error instanceof Error) || !error.message.includes("already exists")) {
            throw error;
          }
        }
        const imageWikiLink = `[[${imagePath}]]`;
        this.contextFiles.add(imageWikiLink);
      }
    }
    return newMdPath;
  }
  getExtractionMarkdown(extractionData) {
    var _a, _b, _c;
    const text = (_a = extractionData == null ? void 0 : extractionData.text) != null ? _a : "";
    const metadata = (_b = extractionData == null ? void 0 : extractionData.metadata) != null ? _b : {};
    const pageCount = (_c = extractionData == null ? void 0 : extractionData.pageCount) != null ? _c : 0;
    return `# Document Extraction
Page Count: ${pageCount}

${text}

${metadata ? `
# Metadata
${JSON.stringify(metadata, null, 2)}` : ""}
`;
  }
  decodeBase64(base64String) {
    const binaryStr = window.atob(base64String);
    const len = binaryStr.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryStr.charCodeAt(i);
    }
    return bytes.buffer;
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  getContextFiles() {
    return this.contextFiles;
  }
  async setContextFiles(files) {
    this.contextFiles = new Set(files);
    this.updateContextPanel();
    await this.checkSyncStatus();
  }
  getContainer() {
    return this.contextPanel;
  }
  unload() {
    this.processingTimeouts.forEach((timeout) => {
      clearTimeout(timeout);
    });
    this.processingTimeouts.clear();
    this.processingFiles.forEach((statusEl) => {
      statusEl.remove();
    });
    this.processingFiles.clear();
    if (this.processingStatus) {
      this.processingStatus.style.display = "none";
    }
    this.drawer.unload();
  }
  async processAudioFile(file, timestamped = false) {
    var _a, _b;
    this.updateProcessingStatus(file, "Transcribing audio...", "loader-2");
    try {
      const transcriptionService = TranscriptionService.getInstance(this.plugin);
      const text = await transcriptionService.transcribeFile(file, {
        type: "note",
        timestamped,
        onProgress: (progress, status) => {
          this.updateProcessingStatus(file, status, "loader-2");
        }
      });
      const extractionFolder = this.sculptService.extractionsDirectory;
      const baseName = file.basename.replace(/[\\/:*?"<>|]/g, "-").trim();
      const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${(_b = (_a = file.parent) == null ? void 0 : _a.path) != null ? _b : ""}/${baseName}`;
      await this.app.vault.createFolder(parentPath).catch(() => {
      });
      const outputPath = `${parentPath}/${baseName}.md`;
      const finalContent = `# Audio Transcription
Source: ${file.basename}
Transcribed: ${new Date().toISOString()}

${text}`;
      try {
        const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
        if (existingFile instanceof import_obsidian22.TFile) {
          await this.app.vault.modify(existingFile, finalContent);
        } else {
          await this.app.vault.create(outputPath, finalContent);
        }
      } catch (error) {
        console.error("File operation failed:", error);
        throw error;
      }
      this.updateProcessingStatus(file, "Added successfully!", "check-circle");
      return outputPath;
    } catch (error) {
      console.error("Audio transcription error:", error);
      this.updateProcessingStatus(file, `Error: ${error instanceof Error ? error.message : String(error)}`, "x-circle");
      throw error;
    }
  }
  async pollUntilComplete(documentId) {
    var _a, _b, _c;
    const maxTries = 50;
    for (let i = 0; i < maxTries; i++) {
      await this.sleep(3e3);
      const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}`;
      const resp = await fetch(url);
      if (!resp.ok)
        continue;
      const data = await resp.json();
      if (((_a = data == null ? void 0 : data.data) == null ? void 0 : _a.status) === "completed")
        return true;
      if (((_b = data == null ? void 0 : data.data) == null ? void 0 : _b.status) === "error") {
        throw new Error(((_c = data == null ? void 0 : data.data) == null ? void 0 : _c.error) || "Processing failed");
      }
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const url = `${this.sculptService.baseUrl}/api/v1/documents/${documentId}/download`;
    const resp = await fetch(url);
    if (!resp.ok) {
      throw new Error(`Download extraction failed: ${resp.status}`);
    }
    const data = await resp.json();
    if (!data.success) {
      throw new Error(data.error || "Failed to download extraction");
    }
    return data.data.extractionResult;
  }
  async calculateTokenCount(file) {
    try {
      if (file.extension === "md" || file.extension === "txt") {
        const content = await this.app.vault.read(file);
        return this.tokenCounter.approximateTokenCount(content);
      }
      return 0;
    } catch (error) {
      console.error("Error calculating tokens for file:", file.path, error);
      return 0;
    }
  }
  async updateTokenCount(file) {
    const count = await this.calculateTokenCount(file);
    this.tokenCounts.set(file.path, count);
  }
  formatFileSize(bytes) {
    if (bytes < 1024)
      return bytes + " B";
    const kb = bytes / 1024;
    if (kb < 1024)
      return kb.toFixed(1) + " KB";
    const mb = kb / 1024;
    return mb.toFixed(1) + " MB";
  }
};

// src/services/ScrollManagerService.ts
var ScrollManagerService = class {
  constructor(config) {
    this.state = {
      isUserScrolling: false,
      isAutoScrollEnabled: true,
      lastScrollTop: 0
    };
    this.handleScroll = () => {
      const { scrollTop, scrollHeight, clientHeight } = this.container;
      const isAtBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
      if (this.state.isUserScrolling) {
        this.state.isAutoScrollEnabled = isAtBottom;
        if (this.onScrollStateChange) {
          this.onScrollStateChange(this.state.isAutoScrollEnabled);
        }
      }
      this.state.lastScrollTop = scrollTop;
    };
    this.handleWheel = () => {
      this.state.isUserScrolling = true;
    };
    this.handleTouchStart = () => {
      this.state.isUserScrolling = true;
    };
    this.handleTouchEnd = () => {
      this.state.isUserScrolling = false;
    };
    this.container = config.container;
    this.onScrollStateChange = config.onScrollStateChange;
    this.setupEventListeners();
    this.setupResizeObserver();
  }
  setupEventListeners() {
    this.container.addEventListener("scroll", this.handleScroll, { passive: true });
    this.container.addEventListener("wheel", this.handleWheel, { passive: true });
    this.container.addEventListener("touchstart", this.handleTouchStart, { passive: true });
    this.container.addEventListener("touchend", this.handleTouchEnd, { passive: true });
  }
  setupResizeObserver() {
    this.resizeObserver = new ResizeObserver(() => {
      this.updateContentHeight();
    });
    this.resizeObserver.observe(this.container);
  }
  updateContentHeight() {
    if (this.state.isAutoScrollEnabled) {
      this.scrollToBottom();
    }
  }
  scrollToBottom() {
    requestAnimationFrame(() => {
      this.container.scrollTop = this.container.scrollHeight;
    });
  }
  cleanup() {
    if (this.resizeObserver) {
      this.resizeObserver.disconnect();
    }
    this.container.removeEventListener("scroll", this.handleScroll);
    this.container.removeEventListener("wheel", this.handleWheel);
    this.container.removeEventListener("touchstart", this.handleTouchStart);
    this.container.removeEventListener("touchend", this.handleTouchEnd);
  }
};

// src/views/components/InputHandler.ts
var import_obsidian24 = __toModule(require("obsidian"));
init_errors();
init_ui();
init_ImageProcessor();
var InputHandler = class extends import_obsidian24.Component {
  constructor(options) {
    super();
    this.isGenerating = false;
    this.renderTimeout = null;
    this.recorderVisualizer = null;
    this.isRecording = false;
    this.abortController = null;
    this.stopButton = null;
    this.webSearchEnabled = false;
    this.app = options.app;
    this.container = options.container;
    this.aiService = options.aiService;
    this.getMessages = options.getMessages;
    this.getSelectedModelId = options.getSelectedModelId;
    this.getContextFiles = options.getContextFiles;
    this.getSystemPrompt = options.getSystemPrompt;
    this.chatContainer = options.chatContainer;
    this.scrollManager = options.scrollManager;
    this.messageRenderer = options.messageRenderer;
    this.onMessageSubmit = options.onMessageSubmit;
    this.onAssistantResponse = options.onAssistantResponse;
    this.onContextFileAdd = options.onContextFileAdd;
    this.onError = options.onError;
    this.onAddContextFile = options.onAddContextFile;
    this.onEditSystemPrompt = options.onEditSystemPrompt;
    this.plugin = options.plugin;
    this.chatView = options.chatView;
    console.log("Initializing InputHandler with RecorderService");
    this.recorderService = RecorderService.getInstance(this.app, this.plugin, {
      isInChat: true,
      onTranscriptionComplete: (text) => {
        console.log("Received transcription, inserting at cursor position");
        this.insertTextAtCursor(text);
      }
    });
    const originalMessageSubmit = options.onMessageSubmit;
    this.onMessageSubmit = async (message) => {
      await originalMessageSubmit(message);
    };
    const originalAssistantResponse = options.onAssistantResponse;
    this.onAssistantResponse = async (message) => {
      await originalAssistantResponse(message);
    };
    this.setupInput();
  }
  setupInput() {
    var _a;
    this.inputContainer = this.container.createEl("div", {
      cls: "systemsculpt-input-container"
    });
    this.buttonGrid = this.inputContainer.createEl("div", {
      cls: "systemsculpt-button-grid"
    });
    const settingsButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "This Chat's Settings" }
    });
    (0, import_obsidian24.setIcon)(settingsButton, "settings");
    settingsButton.addEventListener("click", () => {
      this.onEditSystemPrompt();
    });
    const attachButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Add attachment" }
    });
    (0, import_obsidian24.setIcon)(attachButton, "paperclip");
    attachButton.addEventListener("click", (e) => {
      if (e.shiftKey) {
        this.handleDocumentUpload();
      } else {
        this.onAddContextFile();
      }
    });
    const webSearchButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Toggle web search" }
    });
    this.webSearchButton = webSearchButton;
    (0, import_obsidian24.setIcon)(webSearchButton, "globe");
    webSearchButton.addEventListener("click", async () => {
      const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
      const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
      const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
      if (!isNativeProvider && !isOpenRouter) {
        const result = await showPopup(this.app, "Web search allows the AI to access real-time information from the internet to provide up-to-date answers.", {
          title: "Feature Restriction - Web Search",
          description: "Web search is only available for SystemSculpt and OpenRouter models. Please switch to a compatible model to use this feature.",
          primaryButton: "OK"
        });
        return;
      }
      this.webSearchEnabled = !this.webSearchEnabled;
      webSearchButton.classList.toggle("is-enabled", this.webSearchEnabled);
    });
    const hasProLicense = ((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) && this.plugin.settings.licenseValid;
    const micButton = this.buttonGrid.createEl("button", {
      cls: `systemsculpt-input-action-button systemsculpt-mic-button${hasProLicense ? "" : " pro-feature"}`,
      attr: {
        "aria-label": hasProLicense ? "Record audio message" : "Record audio message (Pro feature)",
        "aria-disabled": (!hasProLicense).toString(),
        title: hasProLicense ? "Record audio message" : "Recording is a Pro feature. Click to learn more."
      }
    });
    (0, import_obsidian24.setIcon)(micButton, "mic");
    micButton.classList.toggle("disabled", !hasProLicense);
    micButton.addEventListener("click", async () => {
      if (!hasProLicense) {
        const result = await showPopup(this.app, "Voice recording allows you to quickly capture your thoughts by speaking instead of typing. This feature includes automatic transcription of your recordings to text.", {
          title: "Pro Feature - Voice Recording",
          description: "Support SystemSculpt's development and unlock voice recording, transcription, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        });
        if (result == null ? void 0 : result.confirmed) {
          window.open(PATREON_URL, "_blank");
        }
        return;
      }
      this.handleMicClick();
    });
    const sendButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-send-button",
      attr: { "aria-label": "Send message" }
    });
    (0, import_obsidian24.setIcon)(sendButton, "send");
    sendButton.addEventListener("click", this.handleSendMessage.bind(this));
    this.stopButton = this.buttonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-stop-button",
      attr: { "aria-label": "Stop generation" }
    });
    (0, import_obsidian24.setIcon)(this.stopButton, "square");
    this.stopButton.style.display = "none";
    this.stopButton.addEventListener("click", this.handleStopGeneration.bind(this));
    this.input = this.inputContainer.createEl("textarea", {
      cls: "systemsculpt-input systemsculpt-chat-input",
      attr: {
        rows: "1",
        placeholder: "Type a message..."
      }
    });
    this.input.addEventListener("keydown", this.handleKeyDown.bind(this));
    this.input.addEventListener("input", this.adjustInputHeight.bind(this));
    this.input.addEventListener("paste", this.handlePaste.bind(this));
    this.recorderService.onToggle((isRecording) => {
      this.isRecording = isRecording;
      const micButton2 = this.buttonGrid.querySelector(".systemsculpt-mic-button");
      if (micButton2) {
        micButton2.classList.toggle("active", isRecording);
      }
    });
    this.updateGeneratingState = () => {
      this.input.disabled = this.isGenerating;
      sendButton.disabled = this.isGenerating;
      micButton.disabled = this.isGenerating;
      attachButton.disabled = this.isGenerating;
      settingsButton.disabled = this.isGenerating;
      webSearchButton.disabled = this.isGenerating;
      if (this.stopButton) {
        this.stopButton.style.display = this.isGenerating ? "flex" : "none";
        sendButton.style.display = this.isGenerating ? "none" : "flex";
      }
      this.input.placeholder = this.isGenerating ? "Waiting for response..." : "Type a message...";
      this.input.classList.toggle("disabled", this.isGenerating);
      sendButton.classList.toggle("disabled", this.isGenerating);
      micButton.classList.toggle("disabled", this.isGenerating);
      attachButton.classList.toggle("disabled", this.isGenerating);
      settingsButton.classList.toggle("disabled", this.isGenerating);
      webSearchButton.classList.toggle("disabled", this.isGenerating);
    };
  }
  handleStopGeneration() {
    if (this.abortController) {
      this.abortController.abort();
      this.abortController = null;
      this.isGenerating = false;
      this.updateGeneratingState();
    }
  }
  async handleSendMessage() {
    const currentModelId = this.getSelectedModelId();
    if (!currentModelId || currentModelId.trim() === "") {
      const result = await showPopup(this.app, "No model selected", {
        description: "Please select an AI model before sending a message.",
        primaryButton: "Select Model",
        secondaryButton: "Cancel"
      });
      if (result == null ? void 0 : result.confirmed) {
        const modal = new ModelSelectionModal(this.app, "", async (modelId) => {
          await this.chatView.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected. Please re-send your message.", "info");
        }, this.plugin);
        modal.open();
      }
      return;
    }
    if (this.plugin.settings.activeProvider.type === "native" && (!this.plugin.settings.licenseKey || !this.plugin.settings.licenseKey.trim())) {
      showPopup(this.app, "You don't have a license key. Please add a valid license key in settings to use SystemSculpt AI specific models.", {
        description: "License Key Required",
        primaryButton: "OK"
      });
      return;
    }
    const content = this.input.value.trim();
    if (!content || this.isGenerating)
      return;
    this.input.value = "";
    this.adjustInputHeight();
    try {
      const userMessageId = this.generateMessageId();
      const userMessage = {
        role: "user",
        content,
        message_id: userMessageId
      };
      const modelId = this.webSearchEnabled ? `${this.getSelectedModelId()}:online` : this.getSelectedModelId();
      await this.onMessageSubmit(userMessage);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      const { messageEl, contentEl } = this.createAssistantMessageContainer();
      messageEl.setAttribute("data-message-id", this.generateMessageId());
      messageEl.appendChild(contentEl);
      let fullResponse = "";
      let accumulatedReasoning = "";
      this.isGenerating = true;
      this.updateGeneratingState();
      const loadingEl = contentEl.createEl("span", {
        cls: "systemsculpt-loading",
        text: " \u25CF Thinking..."
      });
      this.chatContainer.appendChild(messageEl);
      this.scrollManager.updateContentHeight();
      this.scrollManager.scrollToBottom();
      this.abortController = new AbortController();
      const systemPrompt = this.getSystemPrompt();
      try {
        for await (const chunk of this.aiService.streamMessage({
          messages: this.getMessages(),
          model: modelId,
          contextFiles: this.getContextFiles(),
          systemPromptType: systemPrompt.type,
          systemPromptPath: systemPrompt.path,
          signal: this.abortController.signal
        })) {
          if (!fullResponse) {
            loadingEl.textContent = " \u25CF Generating...";
          }
          if (chunk.content) {
            fullResponse += chunk.content;
            await this.scheduleRender(fullResponse, contentEl);
            contentEl.appendChild(loadingEl);
          }
          if (chunk.reasoning) {
            accumulatedReasoning += chunk.reasoning;
            this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning);
          }
          this.scrollManager.updateContentHeight();
          this.scrollManager.scrollToBottom();
        }
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        if (accumulatedReasoning) {
          this.messageRenderer.updateReasoningContent(messageEl, accumulatedReasoning, true);
        }
        const assistantMessage = {
          role: "assistant",
          content: fullResponse,
          message_id: messageEl.getAttribute("data-message-id") || this.generateMessageId()
        };
        await this.onAssistantResponse(assistantMessage);
        this.messageRenderer.addMessageButtonToolbar(messageEl, fullResponse, "assistant", assistantMessage.message_id);
        this.scrollManager.updateContentHeight();
        this.scrollManager.scrollToBottom();
        messageEl.addEventListener("delete", async (e) => {
          const { messageId } = e.detail;
          const messages = this.getMessages();
          const index = messages.findIndex((msg) => msg.message_id === messageId);
          if (index !== -1) {
            messageEl.remove();
            this.scrollManager.updateContentHeight();
          }
        });
      } catch (error) {
        this.isGenerating = false;
        this.abortController = null;
        loadingEl.remove();
        messageEl.remove();
        console.error("Chat message error:", {
          error,
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : void 0
        });
        this.onError(error);
      } finally {
        this.isGenerating = false;
        this.abortController = null;
        this.updateGeneratingState();
        this.focus();
      }
    } catch (error) {
      console.error("Outer message handling error:", {
        error,
        message: error instanceof Error ? error.message : String(error),
        stack: error instanceof Error ? error.stack : void 0
      });
      this.isGenerating = false;
      this.abortController = null;
      this.updateGeneratingState();
      this.focus();
      this.onError(error);
    }
  }
  handleMicClick() {
    if (this.isGenerating)
      return;
    this.toggleRecording();
  }
  async toggleRecording() {
    await this.recorderService.toggleRecording();
    this.input.focus();
  }
  async handlePaste(e) {
    var _a;
    const dt = e.clipboardData;
    if (!dt)
      return;
    const pastedText = (_a = dt.getData("text/plain")) != null ? _a : "";
    const allFiles = Array.from(dt.files);
    if (!allFiles.length && pastedText) {
      return;
    }
    e.preventDefault();
    if (!allFiles.length) {
      return;
    }
    for (const file of allFiles) {
      try {
        let extension = "bin";
        if (file.name && file.name.includes(".")) {
          const dotIdx = file.name.lastIndexOf(".");
          if (dotIdx >= 0) {
            extension = file.name.substring(dotIdx + 1).toLowerCase();
          }
        } else if (file.type) {
          const mimeParts = file.type.split("/");
          if (mimeParts.length === 2) {
            extension = mimeParts[1].toLowerCase().replace(/[^a-z0-9]/g, "");
          }
        }
        const now = new Date();
        const isoString = now.toISOString().replace(/[:.]/g, "-");
        const newFileName = `pasted-${isoString}.${extension}`;
        const arrayBuffer = await file.arrayBuffer();
        const attachmentsDir = this.plugin.settings.attachmentsDirectory || "Attachments";
        const finalPath = `${attachmentsDir}/${newFileName}`;
        await this.ensureDirectoryExists(attachmentsDir);
        await this.app.vault.createBinary(finalPath, arrayBuffer);
        const createdFile = this.app.vault.getAbstractFileByPath(finalPath);
        if (createdFile instanceof import_obsidian24.TFile) {
          await this.chatView.addFileToContext(createdFile);
          new import_obsidian24.Notice(`Pasted file saved & added to context: ${createdFile.name}`);
        } else {
          throw new Error("Failed to locate pasted file in vault.");
        }
      } catch (err) {
        console.error("Error handling pasted file:", err);
        new import_obsidian24.Notice(`Failed to handle pasted file: ${err}`);
      }
    }
    if (pastedText) {
      this.insertTextAtCursor(pastedText);
    }
  }
  async handleKeyDown(event) {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      await this.handleSendMessage();
    }
  }
  async handleImagePaste(clipboardData) {
    const file = clipboardData.files[0];
    if (!file || !file.type.startsWith("image/")) {
      throw new SystemSculptError("No image in clipboard", ERROR_CODES.NO_IMAGE, 400);
    }
    const base64 = await ImageProcessor.processClipboardImage(clipboardData);
    return base64;
  }
  adjustInputHeight() {
    if (!this.input)
      return;
    this.input.style.height = "auto";
    const newHeight = Math.min(Math.max(this.input.scrollHeight, 48), 200);
    this.input.style.height = newHeight + "px";
  }
  focus() {
    this.input.focus();
  }
  getValue() {
    return this.input.value;
  }
  setValue(value) {
    if (!this.input) {
      console.error("Input element not found in setValue");
      return;
    }
    try {
      this.input.value = value;
      const inputEvent = new Event("input", {
        bubbles: true,
        cancelable: true
      });
      this.input.dispatchEvent(inputEvent);
      this.adjustInputHeight();
      this.input.focus();
      this.input.setSelectionRange(value.length, value.length);
    } catch (error) {
      console.error("Error in setValue:", error);
      new import_obsidian24.Notice("\u274C Failed to set input value");
    }
  }
  unload() {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    this.recorderService.setVisualizerCanvas(null);
    if (this.recorderVisualizer) {
      this.recorderVisualizer.remove();
      this.recorderVisualizer = null;
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  createAssistantMessageContainer() {
    return {
      messageEl: createDiv({
        cls: "systemsculpt-message systemsculpt-assistant-message"
      }),
      contentEl: createDiv({ cls: "systemsculpt-message-content" })
    };
  }
  async scheduleRender(content, containerEl) {
    if (this.renderTimeout) {
      clearTimeout(this.renderTimeout);
    }
    const currentHeight = containerEl.offsetHeight;
    const tempContainer = containerEl.querySelector(".temp-text") || containerEl.createEl("div", { cls: "temp-text" });
    tempContainer.style.visibility = "hidden";
    tempContainer.style.position = "absolute";
    tempContainer.style.width = containerEl.offsetWidth + "px";
    await this.messageRenderer.renderMarkdownContent(content, tempContainer);
    if (currentHeight !== tempContainer.offsetHeight) {
      await this.messageRenderer.renderMarkdownContent(content, containerEl);
    } else {
      const lastChild = containerEl.lastChild;
      if (lastChild && lastChild.nodeType === Node.TEXT_NODE) {
        lastChild.textContent = content;
      } else {
        containerEl.appendChild(document.createTextNode(content));
      }
    }
    tempContainer.remove();
    return Promise.resolve();
  }
  async handleDocumentUpload() {
    var _a;
    try {
      if (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !this.plugin.settings.licenseValid) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Support SystemSculpt's development and unlock document processing, analysis, and other premium features by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result2) => {
          if (result2 == null ? void 0 : result2.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      const isValid = await this.plugin.getLicenseManager().validateLicenseKey(true);
      if (!isValid) {
        this.plugin.settings.licenseValid = false;
        await this.plugin.saveSettings();
        await showPopup(this.app, "Your license appears to be invalid. Please check your license key in settings.", {
          title: "License Invalid",
          primaryButton: "OK"
        });
        return;
      }
      const files = this.app.vault.getFiles();
      if (!files.length) {
        new import_obsidian24.Notice("No files found to upload.");
        return;
      }
      const firstFile = files[0];
      const result = await this.aiService.uploadDocument(firstFile);
      new import_obsidian24.Notice(`Uploaded doc. ID: ${result.documentId}, status: ${result.status}`);
    } catch (error) {
      if ((error == null ? void 0 : error.statusCode) === 401 || (error == null ? void 0 : error.statusCode) === 403) {
        await showPopup(this.app, "Upload and process documents directly in your chat conversations. SystemSculpt will automatically extract and analyze the content.", {
          title: "Pro Feature - Document Processing",
          description: "Document processing requires an active Pro subscription. Support SystemSculpt's development by becoming a Patreon member!",
          primaryButton: "Become a Patron",
          secondaryButton: "Maybe Later"
        }).then((result) => {
          if (result == null ? void 0 : result.confirmed) {
            window.open(PATREON_URL, "_blank");
          }
        });
        return;
      }
      new import_obsidian24.Notice(`Error uploading doc: ${error}`);
    }
  }
  insertTextAtCursor(text) {
    const cursorPos = this.input.selectionStart;
    const currentValue = this.input.value;
    if (cursorPos !== null) {
      const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
      this.input.value = newValue;
      this.input.selectionStart = this.input.selectionEnd = cursorPos + text.length;
    } else {
      this.input.value = currentValue + text;
      this.input.selectionStart = this.input.selectionEnd = this.input.value.length;
    }
    this.input.dispatchEvent(new Event("input"));
    this.input.focus();
  }
  updateWebSearchButtonState() {
    if (!this.webSearchButton)
      return;
    const isNativeProvider = this.plugin.settings.activeProvider.type === "native";
    const currentProvider = this.plugin.settings.customProviders.find((p) => p.id === this.plugin.settings.activeProvider.id);
    const isOpenRouter = currentProvider == null ? void 0 : currentProvider.endpoint.includes("openrouter.ai");
    const webSearchAllowed = isNativeProvider || isOpenRouter;
    if (!webSearchAllowed && this.webSearchEnabled) {
      this.webSearchEnabled = false;
      this.webSearchButton.classList.remove("is-enabled");
    }
    this.webSearchButton.classList.toggle("disabled", !webSearchAllowed);
    this.webSearchButton.setAttribute("aria-disabled", (!webSearchAllowed).toString());
  }
  onModelChange() {
    this.updateWebSearchButtonState();
  }
  async ensureDirectoryExists(dirPath) {
    try {
      await this.app.vault.adapter.mkdir(dirPath);
    } catch (err) {
      if (!err.message.includes("already exists"))
        throw err;
    }
  }
};

// src/views/chatview/uiSetup.ts
var uiSetup = {
  onOpen: async function(chatView) {
    const container = chatView.containerEl.children[1];
    container.empty();
    container.addClass("systemsculpt-chat-container");
    chatView.setupDragAndDrop(container);
    const headerContainer = container.createEl("div", { cls: "systemsculpt-chat-header" });
    const headerRow = headerContainer.createEl("div", { cls: "systemsculpt-chat-header-row" });
    const leftSection = headerRow.createEl("div", { cls: "systemsculpt-header-section-left" });
    chatView.contextManager = new FileContextManager({
      app: chatView.app,
      container: leftSection,
      onContextChange: async () => {
        await chatView.saveChat();
        await chatView.contextManager.checkSyncStatus();
      },
      sculptService: chatView.aiService,
      plugin: chatView.plugin
    });
    chatView.chatContainer = container.createEl("div", { cls: "systemsculpt-messages-container" });
    chatView.scrollManager = new ScrollManagerService({ container: chatView.chatContainer });
    chatView.inputHandler = new InputHandler({
      app: chatView.app,
      container,
      aiService: chatView.aiService,
      getMessages: () => [...chatView.messages],
      getSelectedModelId: () => chatView.selectedModelId,
      getContextFiles: () => chatView.contextManager.getContextFiles(),
      getSystemPrompt: () => ({ type: chatView.systemPromptType, path: chatView.systemPromptPath }),
      chatContainer: chatView.chatContainer,
      scrollManager: chatView.scrollManager,
      messageRenderer: chatView.messageRenderer,
      onMessageSubmit: async (message) => {
        chatView.messages.push(message);
        await chatView.saveChat();
        await chatView.addMessage(message.role, message.content, message.message_id);
      },
      onAssistantResponse: async (message) => {
        chatView.messages.push(message);
        await chatView.saveChat();
      },
      onContextFileAdd: async (wikilink) => {
        const files = chatView.contextManager.getContextFiles();
        files.add(wikilink);
        chatView.contextManager.setContextFiles(Array.from(files));
        await chatView.saveChat();
      },
      onError: (error) => chatView.handleError(error),
      onAddContextFile: () => {
        const contextButton = chatView.contextManager.getContainer().querySelector(".systemsculpt-context-add-button");
        if (contextButton instanceof HTMLElement)
          contextButton.click();
      },
      onEditSystemPrompt: () => chatView.handleSystemPromptEdit(),
      plugin: chatView.plugin,
      chatView
    });
    chatView.inputHandler.onModelChange();
    chatView.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf === chatView.leaf) {
        chatView.checkForUpdates();
        chatView.inputHandler.focus();
      }
    });
    chatView.inputHandler.focus();
    await chatView.checkForUpdates();
    if (!chatView.awaitingStateRestore && chatView.messages.length === 0) {
      await chatView.saveChat();
    }
    setTimeout(async () => {
      if (!chatView.plugin.settings.selectedModelId) {
        const result = await showPopup(chatView.app, "You don't have a default model selected yet. Would you like to choose one now? This will be used as the default for all new chats.", { title: "Select Default Model", icon: "bot", primaryButton: "Choose Model", secondaryButton: "Maybe Later" });
        if (result == null ? void 0 : result.confirmed) {
          try {
            const models = await chatView.plugin.modelService.getModels();
            const modal = new ModelSelectionModal(chatView.app, "", async (modelId) => {
              chatView.plugin.settings.selectedModelId = modelId;
              const selectedModel = models.find((model) => model.id === modelId);
              if (selectedModel) {
                const customProvider = chatView.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === selectedModel.provider.toLowerCase());
                if (customProvider) {
                  chatView.plugin.settings.activeProvider = {
                    id: customProvider.id,
                    name: customProvider.name,
                    type: "custom"
                  };
                } else {
                  chatView.plugin.settings.activeProvider = {
                    id: "systemsculpt",
                    name: "SystemSculpt",
                    type: "native"
                  };
                }
              }
              await chatView.plugin.saveSettings();
              chatView.selectedModelId = modelId;
              await chatView.updateModelIndicator();
            }, chatView.plugin);
            modal.open();
          } catch (error) {
            console.error("Error loading models:", error);
            showPopup(chatView.app, "Failed to load available models");
          }
        }
      } else {
        try {
          const models = await chatView.plugin.modelService.getModels();
          const currentModel = models.find((model) => model.id === chatView.selectedModelId);
          if (currentModel) {
            const customProvider = chatView.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === currentModel.provider.toLowerCase());
            if (customProvider) {
              chatView.plugin.settings.activeProvider = {
                id: customProvider.id,
                name: customProvider.name,
                type: "custom"
              };
            } else {
              chatView.plugin.settings.activeProvider = {
                id: "systemsculpt",
                name: "SystemSculpt",
                type: "native"
              };
            }
            await chatView.plugin.saveSettings();
          }
        } catch (error) {
          console.error("Error syncing provider:", error);
        }
      }
    }, 100);
  },
  updateModelIndicator: async function(chatView) {
    if (chatView.modelIndicator) {
      const newModelIndicator = chatView.modelIndicator.cloneNode(true);
      chatView.modelIndicator.replaceWith(newModelIndicator);
      chatView.modelIndicator = newModelIndicator;
      chatView.modelIndicator.addEventListener("click", async () => {
        const modal = new ModelSelectionModal(chatView.app, chatView.selectedModelId || "", async (modelId) => {
          await chatView.setSelectedModelId(modelId);
          showEnhancedNotice("Model selected successfully", "info");
        }, chatView.plugin);
        modal.open();
      });
      if (!chatView.selectedModelId || chatView.selectedModelId.trim() === "") {
        chatView.modelIndicator.empty();
        chatView.modelIndicator.createSpan({ text: "No model selected" });
        chatView.modelIndicator.addClass("systemsculpt-no-model");
      } else {
        try {
          const models = await chatView.plugin.modelService.getModels();
          const currentModel = models.find((model) => model.id === chatView.selectedModelId);
          let providerPrefix = "";
          if (currentModel) {
            providerPrefix = currentModel.provider === "systemsculpt" ? "[SYSTEMSCULPT] " : `[${currentModel.provider.toUpperCase()}] `;
          }
          chatView.currentModelName = (currentModel == null ? void 0 : currentModel.name) || chatView.selectedModelId;
          chatView.modelIndicator.empty();
          chatView.modelIndicator.removeClass("systemsculpt-no-model");
          chatView.modelIndicator.createSpan({ text: "Current Model: " });
          chatView.modelIndicator.createSpan({ text: providerPrefix + chatView.currentModelName });
        } catch (error) {
          chatView.currentModelName = chatView.selectedModelId;
          chatView.modelIndicator.empty();
          chatView.modelIndicator.removeClass("systemsculpt-no-model");
          chatView.modelIndicator.createSpan({ text: "Current Model: " });
          chatView.modelIndicator.createSpan({ text: chatView.currentModelName });
        }
      }
    }
  }
};

// src/views/chatview/messageHandling.ts
var messageHandling = {
  addMessage: async function(chatView, role, content, existingMessageId) {
    const messageId = existingMessageId || chatView.generateMessageId();
    const { messageEl, contentEl } = await chatView.messageRenderer.renderMessage({ app: chatView.app, messageId, role, content });
    const contentStr = typeof content === "string" ? content : JSON.stringify(content);
    messageEl.dataset.content = contentStr;
    chatView.messageRenderer.addMessageButtonToolbar(messageEl, contentStr, role, messageId);
    messageEl.addEventListener("resubmit", async (e) => {
      const { messageId: messageId2, content: content2 } = e.detail;
      const index = chatView.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        chatView.messages.splice(index);
        await chatView.saveChat();
        chatView.chatContainer.empty();
        for (const msg of chatView.messages) {
          await chatView.addMessage(msg.role, msg.content, msg.message_id);
        }
        chatView.inputHandler.setValue(content2);
        chatView.inputHandler.focus();
      }
    });
    messageEl.addEventListener("edit", async (e) => {
      const { messageId: messageId2, oldContent, newContent } = e.detail;
      const index = chatView.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        chatView.messages[index].content = newContent;
        await chatView.saveChat();
        const { contentEl: newContentEl } = await chatView.messageRenderer.renderMessage({
          app: chatView.app,
          messageId: messageId2,
          role: chatView.messages[index].role,
          content: chatView.messages[index].content
        });
        const oldContentEl = messageEl.querySelector(".systemsculpt-message-content");
        if (oldContentEl && newContentEl) {
          oldContentEl.replaceWith(newContentEl);
          chatView.messageRenderer.setupImageHandlers(newContentEl);
        }
        const updatedStr = typeof chatView.messages[index].content === "string" ? chatView.messages[index].content : JSON.stringify(chatView.messages[index].content);
        messageEl.dataset.content = updatedStr;
      }
    });
    messageEl.addEventListener("delete", async (e) => {
      const { messageId: messageId2 } = e.detail;
      const index = chatView.messages.findIndex((msg) => msg.message_id === messageId2);
      if (index !== -1) {
        chatView.messages.splice(index, 1);
        await chatView.saveChat();
        messageEl.remove();
        chatView.scrollManager.updateContentHeight();
        chatView.scrollManager.scrollToBottom();
      }
    });
    chatView.chatContainer.appendChild(messageEl);
    chatView.scrollManager.updateContentHeight();
    chatView.scrollManager.scrollToBottom();
  },
  loadMessages: async function(chatView) {
    if (!chatView.chatContainer)
      return;
    const scrollTop = chatView.chatContainer.scrollTop;
    const scrollHeight = chatView.chatContainer.scrollHeight;
    const clientHeight = chatView.chatContainer.clientHeight;
    const wasAtBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 10;
    chatView.chatContainer.empty();
    for (const message of chatView.messages) {
      await chatView.addMessage(message.role, message.content, message.message_id);
    }
    if (wasAtBottom) {
      chatView.scrollManager.scrollToBottom();
    } else {
      chatView.chatContainer.scrollTop = scrollTop;
    }
  }
};

// src/views/chatview/eventHandling.ts
var import_obsidian25 = __toModule(require("obsidian"));
init_ui();
var eventHandling = {
  setupDragAndDrop: function(chatView, container) {
    const overlay = container.createEl("div", { cls: "systemsculpt-drag-overlay" });
    const message = overlay.createEl("div", { cls: "systemsculpt-drag-message", text: "Drop files to add to context" });
    const MAX_FILES = 100;
    const parseObsidianUri = (uri) => {
      try {
        if (!uri.startsWith("obsidian://open"))
          return null;
        const url = new URL(uri);
        return decodeURIComponent(url.searchParams.get("file") || "");
      } catch (e) {
        console.error("[DragDrop] Error parsing URI:", uri, e);
        return null;
      }
    };
    const getFilesFromFolder = (folder) => {
      const files = [];
      const processFolder = (currentFolder) => {
        for (const child of currentFolder.children) {
          if (child instanceof import_obsidian25.TFile)
            files.push(child);
          else if (child instanceof import_obsidian25.TFolder)
            processFolder(child);
        }
      };
      processFolder(folder);
      return files.slice(0, MAX_FILES);
    };
    const getFileCount = async (dt) => {
      const currentContextSize = chatView.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES)
        return 0;
      const remainingSlots = MAX_FILES - currentContextSize;
      let newFileCount = 0;
      let filesToProcess = [];
      if (dt.items && dt.items.length > 0) {
        for (const item of Array.from(dt.items)) {
          if (item.type === "text/plain") {
            const text = await new Promise((resolve) => item.getAsString(resolve));
            const lines = text.split("\n").filter((line) => line.trim());
            for (const line of lines) {
              let filePath = line;
              let abstractFile = null;
              if (line.startsWith("obsidian://"))
                filePath = parseObsidianUri(line) || line;
              abstractFile = chatView.app.vault.getAbstractFileByPath(filePath);
              if (abstractFile instanceof import_obsidian25.TFolder)
                filesToProcess.push(abstractFile);
              else if (abstractFile instanceof import_obsidian25.TFile)
                filesToProcess.push(abstractFile);
              else if (!filePath.includes(".")) {
                const mdPath = `${filePath}.md`;
                const mdFile = chatView.app.vault.getAbstractFileByPath(mdPath);
                if (mdFile instanceof import_obsidian25.TFile)
                  filesToProcess.push(mdFile);
              }
            }
          }
        }
      }
      for (const item of filesToProcess) {
        if (item instanceof import_obsidian25.TFolder)
          newFileCount += getFilesFromFolder(item).length;
        else if (item instanceof import_obsidian25.TFile)
          newFileCount++;
      }
      if (newFileCount === 0 && dt.types.includes("text/uri-list")) {
        const uriData = await new Promise((resolve) => dt.items[1].getAsString(resolve));
        const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
        for (const uri of uris) {
          const filePath = parseObsidianUri(uri);
          if (!filePath)
            continue;
          const abstractFile = chatView.app.vault.getAbstractFileByPath(filePath);
          if (abstractFile instanceof import_obsidian25.TFolder)
            newFileCount += getFilesFromFolder(abstractFile).length;
          else if (abstractFile instanceof import_obsidian25.TFile)
            newFileCount++;
        }
      }
      return Math.min(newFileCount, remainingSlots);
    };
    const updateMessage = async (dt) => {
      const currentContextSize = chatView.contextManager.getContextFiles().size;
      if (currentContextSize >= MAX_FILES) {
        message.textContent = `Cannot add more files (max ${MAX_FILES} reached)`;
        return;
      }
      const fileCount = await getFileCount(dt);
      if (fileCount > 0) {
        message.textContent = `Add ${fileCount} file${fileCount > 1 ? "s" : ""} to context (${currentContextSize + fileCount}/${MAX_FILES} total)`;
      } else {
        message.textContent = `Drop files to add to context (${currentContextSize}/${MAX_FILES})`;
      }
    };
    let dragCounter = 0;
    container.addEventListener("dragenter", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter++;
      if (dragCounter === 1) {
        container.addClass("systemsculpt-drag-active");
        if (e.dataTransfer)
          updateMessage(e.dataTransfer);
      }
    });
    container.addEventListener("dragleave", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dragCounter--;
      if (dragCounter === 0)
        container.removeClass("systemsculpt-drag-active");
    });
    container.addEventListener("dragover", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (e.dataTransfer)
        await updateMessage(e.dataTransfer);
    });
    container.addEventListener("drop", async (e) => {
      var _a, _b, _c;
      e.preventDefault();
      e.stopPropagation();
      dragCounter = 0;
      container.removeClass("systemsculpt-drag-active");
      const dt = e.dataTransfer;
      if (!dt)
        return;
      const startingContextSize = chatView.contextManager.getContextFiles().size;
      if (startingContextSize >= MAX_FILES) {
        await showAlert(chatView.app, `Cannot add more files (max ${MAX_FILES} reached)`, { type: "info", icon: "alert-triangle" });
        return;
      }
      try {
        let filesToProcess = [];
        if (dt.items && dt.items.length > 0) {
          for (const item of Array.from(dt.items)) {
            if (item.type === "text/plain") {
              const text = await new Promise((resolve) => item.getAsString(resolve));
              const lines = text.split("\n").filter((line) => line.trim());
              for (const line of lines) {
                let filePath = line;
                let abstractFile = null;
                if (line.startsWith("obsidian://"))
                  filePath = parseObsidianUri(line) || line;
                abstractFile = chatView.app.vault.getAbstractFileByPath(filePath);
                if (abstractFile instanceof import_obsidian25.TFolder)
                  filesToProcess.push(abstractFile);
                else if (abstractFile instanceof import_obsidian25.TFile) {
                  const extension = abstractFile.extension.toLowerCase();
                  const requiresPro = ["pdf", "doc", "docx", "mp3", "wav", "m4a", "ogg", "webm"].includes(extension);
                  if (requiresPro && (!((_a = chatView.plugin.settings.licenseKey) == null ? void 0 : _a.trim()) || !chatView.plugin.settings.licenseValid)) {
                    await showPopup(chatView.app, "Document processing is a Pro feature...", { title: "Pro Feature", primaryButton: "Become a Patron", secondaryButton: "Maybe Later" }).then((result) => {
                      if (result == null ? void 0 : result.confirmed)
                        window.open(PATREON_URL, "_blank");
                    });
                    return;
                  }
                  filesToProcess.push(abstractFile);
                } else if (!filePath.includes(".")) {
                  const mdPath = `${filePath}.md`;
                  const mdFile = chatView.app.vault.getAbstractFileByPath(mdPath);
                  if (mdFile instanceof import_obsidian25.TFile)
                    filesToProcess.push(mdFile);
                }
              }
            }
          }
        }
        if (filesToProcess.length === 0 && dt.types.includes("text/uri-list")) {
          const uriData = await new Promise((resolve) => dt.items[1].getAsString(resolve));
          const uris = uriData.split("obsidian://open").filter((uri) => uri.trim()).map((uri) => "obsidian://open" + uri.trim());
          for (const uri of uris) {
            const filePath = parseObsidianUri(uri);
            if (!filePath)
              continue;
            let abstractFile = chatView.app.vault.getAbstractFileByPath(filePath);
            if (abstractFile instanceof import_obsidian25.TFile) {
              const extension = abstractFile.extension.toLowerCase();
              const requiresPro = ["pdf", "doc", "docx", "mp3", "wav", "m4a", "ogg", "webm"].includes(extension);
              if (requiresPro && (!((_b = chatView.plugin.settings.licenseKey) == null ? void 0 : _b.trim()) || !chatView.plugin.settings.licenseValid)) {
                await showPopup(chatView.app, "Document processing is a Pro feature...", { title: "Pro Feature", primaryButton: "Become a Patron", secondaryButton: "Maybe Later" }).then((result) => {
                  if (result == null ? void 0 : result.confirmed)
                    window.open(PATREON_URL, "_blank");
                });
                return;
              }
            }
            if (abstractFile instanceof import_obsidian25.TFile || abstractFile instanceof import_obsidian25.TFolder)
              filesToProcess.push(abstractFile);
          }
        }
        let totalFilesAdded = 0;
        const remainingSlots = MAX_FILES - startingContextSize;
        for (const item of filesToProcess) {
          if (item instanceof import_obsidian25.TFolder) {
            const files = getFilesFromFolder(item);
            for (const file of files) {
              const currentContextSize = chatView.contextManager.getContextFiles().size;
              if (currentContextSize >= MAX_FILES) {
                await showAlert(chatView.app, `File limit reached (${MAX_FILES} total)`, { type: "info", icon: "alert-triangle" });
                return;
              }
              const extension = file.extension.toLowerCase();
              const requiresPro = ["pdf", "doc", "docx", "mp3", "wav", "m4a", "ogg", "webm"].includes(extension);
              if (requiresPro && (!((_c = chatView.plugin.settings.licenseKey) == null ? void 0 : _c.trim()) || !chatView.plugin.settings.licenseValid)) {
                await showPopup(chatView.app, "Document processing is a Pro feature...", { title: "Pro Feature", primaryButton: "Become a Patron", secondaryButton: "Maybe Later" }).then((result) => {
                  if (result == null ? void 0 : result.confirmed)
                    window.open(PATREON_URL, "_blank");
                });
                return;
              }
              try {
                await chatView.contextManager.addFileToContext(file);
                totalFilesAdded++;
                const updatedContextSize = chatView.contextManager.getContextFiles().size;
                showNotice(`Added ${file.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
              } catch (error) {
                console.error("[DragDrop] Error adding file from folder:", { file: file.path, error });
              }
            }
          } else if (item instanceof import_obsidian25.TFile) {
            const currentContextSize = chatView.contextManager.getContextFiles().size;
            if (currentContextSize >= MAX_FILES) {
              await showAlert(chatView.app, `File limit reached (${MAX_FILES} total)`, { type: "info", icon: "alert-triangle" });
              return;
            }
            await chatView.contextManager.addFileToContext(item);
            totalFilesAdded++;
            const updatedContextSize = chatView.contextManager.getContextFiles().size;
            showNotice(`Added ${item.name} to context (${updatedContextSize}/${MAX_FILES})`, { type: "success" });
          }
        }
      } catch (error) {
        console.error("[DragDrop] Error processing drop:", error);
        await showAlert(chatView.app, "Failed to process dropped files", { type: "error" });
      }
    });
  }
};

// src/modals/ChatSystemPromptModal.ts
var import_obsidian26 = __toModule(require("obsidian"));
init_FileSuggester();
init_ui();
init_SystemPromptService();
init_SystemSculptService();
init_TitleGenerationService();
function sanitizeFileName2(name) {
  return name.replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/ /g, "-");
}
function getSystemPromptPath2(directory, fileName) {
  return `${directory}/${fileName}.md`;
}
var ChatSystemPromptModal = class extends import_obsidian26.Modal {
  constructor(app, options) {
    super(app);
    this.result = null;
    this.systemPrompts = [];
    this.activePreset = null;
    this.webSearchEnabled = false;
    this.isGeneratingTitle = false;
    this.options = options;
    this.currentPrompt = options.currentPrompt || "";
    this.systemPromptService = SystemPromptService.getInstance(app);
    if (options.plugin) {
      this.sculptService = SystemSculptService.getInstance(options.plugin.settings, app);
      this.systemPrompts = SystemPromptService.getCachedPrompts() || [];
    }
    this.setInitialActivePreset();
  }
  setInitialActivePreset() {
    if (!this.currentPrompt) {
      this.activePreset = "General-use";
      return;
    }
    const matchingPreset = this.systemPrompts.find((p) => p.systemPrompt.trim() === this.currentPrompt.trim());
    this.activePreset = matchingPreset ? matchingPreset.label : "Custom";
  }
  showLoading(show) {
    this.loadingIndicator.style.display = show ? "flex" : "none";
    this.contentContainer.style.opacity = show ? "0.5" : "1";
  }
  setupResizeObserver() {
    const resizeObserver = new ResizeObserver(() => {
      clearTimeout(this.resizeTimeout);
      this.resizeTimeout = setTimeout(() => {
        this.textArea.style.height = "auto";
        this.textArea.style.height = this.textArea.scrollHeight + "px";
      }, 50);
    });
    resizeObserver.observe(this.textArea);
  }
  async onOpen() {
    this.containerEl.addClass("systemsculpt-system-prompt-modal");
    this.contentEl.empty();
    this.contentEl.addClass("systemsculpt-system-prompt-content");
    this.contentContainer = this.contentEl.createDiv("systemsculpt-content-container");
    this.setupLoadingIndicator();
    this.setupTitleSection();
    this.setupModelSection();
    this.setupTextArea();
    this.setupButtons();
    if (this.textArea) {
      this.textArea.value = this.currentPrompt || "";
    }
    if (this.systemPrompts.length > 0) {
      this.createPresetButtons();
      const initialPreset = this.systemPrompts.find((p) => p.label === this.activePreset) || {
        id: "custom",
        label: "Custom",
        systemPrompt: this.currentPrompt,
        isUserConfigurable: true
      };
      this.updateUIForPreset(initialPreset);
    }
    if (!this.systemPrompts.length || !SystemPromptService.isCacheValid()) {
      this.showLoading(true);
      await this.loadSystemPrompts().catch((error) => {
        console.error("[SystemSculpt] Failed to load system prompts:", error);
        this.showError("Failed to load system prompts. Please try again.");
      });
    } else {
      this.showLoading(false);
    }
    this.setupResizeObserver();
    if (this.textArea) {
      this.textArea.focus();
      this.textArea.setSelectionRange(this.textArea.value.length, this.textArea.value.length);
    }
  }
  setupTitleSection() {
    if (!this.options.plugin || !this.options.messages)
      return;
    const titleSection = this.contentContainer.createDiv("systemsculpt-title-section");
    titleSection.style.marginBottom = "1.5rem";
    titleSection.style.marginTop = "0.5rem";
    const titleSectionHeader = titleSection.createDiv("systemsculpt-section-header");
    titleSectionHeader.style.fontSize = "0.8em";
    titleSectionHeader.style.textTransform = "uppercase";
    titleSectionHeader.style.color = "var(--text-muted)";
    titleSectionHeader.style.fontWeight = "600";
    titleSectionHeader.style.marginBottom = "0.5rem";
    titleSectionHeader.style.letterSpacing = "0.05em";
    titleSectionHeader.setText("Title");
    const titleHeader = titleSection.createDiv({
      cls: "systemsculpt-title-header",
      attr: { style: "display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; gap: 0.5rem;" }
    });
    const titleControls = titleHeader.createDiv({
      cls: "systemsculpt-title-controls",
      attr: { style: "display: flex; align-items: center; gap: 1rem; width: 100%;" }
    });
    this.titleInput = titleControls.createEl("input", {
      type: "text",
      value: this.options.chatTitle || "",
      placeholder: "Enter chat title...",
      cls: "systemsculpt-title-input"
    });
    this.titleInput.style.flex = "1";
    this.titleInput.style.padding = "4px 8px";
    this.titleInput.style.borderRadius = "4px";
    this.titleInput.style.border = "1px solid var(--background-modifier-border)";
    this.titleInput.style.backgroundColor = "var(--background-secondary)";
    this.titleInput.style.color = "var(--text-normal)";
    const generateTitleButton = titleControls.createEl("button", {
      cls: "systemsculpt-button mod-cta",
      text: "Generate Title"
    });
    generateTitleButton.style.padding = "4px 12px";
    generateTitleButton.style.borderRadius = "4px";
    generateTitleButton.style.fontSize = "14px";
    this.titleGenerationService = TitleGenerationService.getInstance(this.options.plugin);
    generateTitleButton.onclick = async () => {
      if (this.isGeneratingTitle)
        return;
      this.isGeneratingTitle = true;
      generateTitleButton.disabled = true;
      const originalText = generateTitleButton.textContent || "Generate Title";
      generateTitleButton.setText("Generating...");
      try {
        await this.titleGenerationService.generateTitle(this.options.messages, (title) => {
          this.titleInput.value = title;
        }, (progress, status) => {
          generateTitleButton.setText(`${status} (${progress}%)`);
        });
        if (this.options.onTitleChange) {
          await this.options.onTitleChange(this.titleInput.value);
        }
      } catch (error) {
        console.error("Error generating title:", error);
        showEnhancedNotice("Failed to generate title", "error", error);
      } finally {
        this.isGeneratingTitle = false;
        generateTitleButton.disabled = false;
        generateTitleButton.setText(originalText);
      }
    };
    this.titleInput.addEventListener("change", async () => {
      if (this.options.onTitleChange) {
        await this.options.onTitleChange(this.titleInput.value);
      }
    });
  }
  setupModelSection() {
    var _a;
    if (!this.options.plugin || !this.options.currentModelId)
      return;
    const modelSection = this.contentContainer.createDiv("systemsculpt-model-section");
    modelSection.style.marginBottom = "1.5rem";
    const modelSectionHeader = modelSection.createDiv("systemsculpt-section-header");
    modelSectionHeader.style.fontSize = "0.8em";
    modelSectionHeader.style.textTransform = "uppercase";
    modelSectionHeader.style.color = "var(--text-muted)";
    modelSectionHeader.style.fontWeight = "600";
    modelSectionHeader.style.marginBottom = "0.5rem";
    modelSectionHeader.style.letterSpacing = "0.05em";
    modelSectionHeader.setText("Model");
    const modelHeader = modelSection.createDiv({
      cls: "systemsculpt-model-header",
      attr: { style: "display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; gap: 0.5rem;" }
    });
    const modelControls = modelHeader.createDiv({
      cls: "systemsculpt-model-controls",
      attr: { style: "display: flex; align-items: center; gap: 1rem; width: 100%;" }
    });
    this.modelIndicator = modelControls.createDiv({ cls: "systemsculpt-model-indicator" });
    this.modelIndicator.style.cursor = "pointer";
    this.modelIndicator.style.flex = "1";
    const currentModel = (_a = this.options.plugin.modelService.cachedModels) == null ? void 0 : _a.find((model) => model.id === this.options.currentModelId);
    const providerPrefix = currentModel ? currentModel.provider === "systemsculpt" ? "[SS AI] " : `[${currentModel.provider.toUpperCase()}] ` : "";
    this.modelIndicator.setText(`Current Model: ${providerPrefix}${(currentModel == null ? void 0 : currentModel.name) || this.options.currentModelId}`);
    const changeModelButton = modelControls.createEl("button", {
      cls: "systemsculpt-button mod-cta",
      text: "Change Model"
    });
    changeModelButton.style.padding = "4px 12px";
    changeModelButton.style.borderRadius = "4px";
    changeModelButton.style.fontSize = "14px";
    const openModelSelection = async () => {
      const models = await this.options.plugin.modelService.getModels();
      const modal = new ModelSelectionModal(this.app, this.options.currentModelId || "", async (modelId) => {
        if (this.options.onModelSelect) {
          await this.options.onModelSelect(modelId);
          const newModel = models.find((m) => m.id === modelId);
          const newPrefix = newModel ? newModel.provider === "systemsculpt" ? "[SS AI] " : `[${newModel.provider.toUpperCase()}] ` : "";
          this.modelIndicator.setText(`Current Model: ${newPrefix}${(newModel == null ? void 0 : newModel.name) || modelId}`);
        }
      }, this.options.plugin);
      modal.open();
    };
    this.modelIndicator.onclick = openModelSelection;
    changeModelButton.onclick = openModelSelection;
  }
  setupLoadingIndicator() {
    this.loadingIndicator = this.contentContainer.createDiv("systemsculpt-loading");
    this.loadingIndicator.style.display = "none";
    this.loadingIndicator.style.justifyContent = "center";
    this.loadingIndicator.style.alignItems = "center";
    this.loadingIndicator.style.padding = "20px";
    this.loadingIndicator.createSpan().setText("Loading system prompts...");
  }
  setupTextArea() {
    var _a;
    const textAreaContainer = this.contentContainer.createDiv("systemsculpt-textarea-container");
    textAreaContainer.style.marginBottom = "1.5rem";
    const promptSectionHeader = textAreaContainer.createDiv("systemsculpt-section-header");
    promptSectionHeader.style.fontSize = "0.8em";
    promptSectionHeader.style.textTransform = "uppercase";
    promptSectionHeader.style.color = "var(--text-muted)";
    promptSectionHeader.style.fontWeight = "600";
    promptSectionHeader.style.marginBottom = "0.5rem";
    promptSectionHeader.style.letterSpacing = "0.05em";
    promptSectionHeader.setText("System Prompt");
    this.presetButtonContainer = textAreaContainer.createDiv("systemsculpt-preset-button-container");
    this.customSection = textAreaContainer.createDiv("systemsculpt-custom-section");
    this.customSection.style.display = "none";
    const customInputContainer = this.customSection.createDiv("systemsculpt-custom-input-container");
    const inputWrapper = customInputContainer.createDiv("systemsculpt-input-wrapper");
    inputWrapper.style.display = "flex";
    inputWrapper.style.gap = "8px";
    inputWrapper.style.alignItems = "center";
    this.customInput = inputWrapper.createEl("input", {
      type: "text",
      placeholder: "Search for a system prompt file...",
      cls: "systemsculpt-custom-input"
    });
    const createButton2 = inputWrapper.createEl("button", {
      cls: "systemsculpt-create-button"
    });
    createButton2.style.padding = "4px 8px";
    createButton2.style.borderRadius = "4px";
    createButton2.style.cursor = "pointer";
    (0, import_obsidian26.setIcon)(createButton2, "plus");
    createButton2.addEventListener("click", async () => {
      var _a2, _b, _c;
      let templateContent = "";
      try {
        templateContent = await this.systemPromptService.getSystemPromptTemplate();
      } catch (error) {
        console.error("Error fetching system prompt template:", error);
        await showPopup(this.app, "", {
          title: "Error",
          description: "Failed to fetch system prompt template. Please try again later.",
          primaryButton: "OK"
        });
        return;
      }
      const result = await showPopup(this.app, "", {
        title: "Create New System Prompt",
        description: "Enter a title and content for your new system prompt. The title will be used to create a markdown file that you can customize later.",
        primaryButton: "Create",
        secondaryButton: "Cancel",
        inputs: [
          {
            type: "text",
            placeholder: "My Custom Assistant",
            required: true,
            className: "systemsculpt-prompt-creation-title-input"
          },
          {
            type: "textarea",
            value: templateContent,
            required: true,
            className: "systemsculpt-prompt-creation-content"
          }
        ]
      });
      if (!(result == null ? void 0 : result.confirmed) || !((_a2 = result.inputs) == null ? void 0 : _a2[0]) || !((_b = result.inputs) == null ? void 0 : _b[1])) {
        return;
      }
      const [title, content] = result.inputs;
      const promptsDirectory = (_c = this.options.systemPromptsDirectory) != null ? _c : "SystemSculpt/System Prompts";
      const fileName = sanitizeFileName2(title);
      const filePath = getSystemPromptPath2(promptsDirectory, fileName);
      try {
        await this.app.vault.createFolder(promptsDirectory).catch(() => {
        });
        const fileContent = `# ${title}

${content}`;
        const file = await this.app.vault.create(filePath, fileContent);
        if (!file) {
          throw new Error("Failed to create file");
        }
        if (this.textArea) {
          this.textArea.value = fileContent;
          this.textArea.readOnly = false;
        }
        this.customInput.value = filePath;
        await showPopup(this.app, "", {
          title: "Success",
          description: "System prompt file created successfully!",
          primaryButton: "OK"
        });
      } catch (error) {
        console.error("Error creating system prompt file:", error);
        const errorMessage = error instanceof Error ? error.message : "Failed to create system prompt file. Please try again.";
        await showPopup(this.app, "", {
          title: "Error",
          description: errorMessage,
          primaryButton: "OK"
        });
      }
    });
    if (this.customInput) {
      attachFileSuggester(this.customInput, async (selectedPath) => {
        try {
          const file = this.app.vault.getAbstractFileByPath(selectedPath);
          if (file && file instanceof import_obsidian26.TFile) {
            const content = await this.app.vault.read(file);
            this.textArea.value = content;
            this.textArea.readOnly = false;
            this.customInput.value = selectedPath.replace(/\.md$/, "");
          }
        } catch (error) {
          console.error("Error reading system prompt file:", error);
        }
      }, this.app, (_a = this.options.systemPromptsDirectory) != null ? _a : "SystemSculpt/System Prompts");
    }
    this.textArea = textAreaContainer.createEl("textarea", {
      cls: "systemsculpt-textarea",
      attr: {
        placeholder: "Enter system prompt",
        readOnly: this.activePreset !== "Custom"
      }
    });
    this.textArea.value = this.currentPrompt;
  }
  setupButtons() {
    const buttonContainer = this.contentContainer.createDiv("systemsculpt-button-container");
    const actionsSectionHeader = buttonContainer.createDiv("systemsculpt-section-header");
    actionsSectionHeader.style.fontSize = "0.8em";
    actionsSectionHeader.style.textTransform = "uppercase";
    actionsSectionHeader.style.color = "var(--text-muted)";
    actionsSectionHeader.style.fontWeight = "600";
    actionsSectionHeader.style.letterSpacing = "0.05em";
    actionsSectionHeader.setText("Actions");
    buttonContainer.style.display = "flex";
    buttonContainer.style.flexDirection = "column";
    buttonContainer.style.gap = "16px";
    buttonContainer.style.alignItems = "center";
    const utilityButtonGrid = buttonContainer.createDiv("systemsculpt-utility-button-grid");
    utilityButtonGrid.style.display = "flex";
    utilityButtonGrid.style.gap = "8px";
    utilityButtonGrid.style.width = "100%";
    const copyChatButton = utilityButtonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Copy chat to clipboard" }
    });
    (0, import_obsidian26.setIcon)(copyChatButton, "copy");
    copyChatButton.addEventListener("click", async () => {
      var _a, _b, _c, _d;
      if (!this.options.plugin) {
        return;
      }
      const state = (_a = this.app.workspace.activeLeaf) == null ? void 0 : _a.getViewState();
      const chatId = (_b = state == null ? void 0 : state.state) == null ? void 0 : _b.chatId;
      if (!chatId) {
        showPopup(this.app, "Could not determine which chat to copy", {
          title: "Error",
          primaryButton: "OK",
          icon: "alert-circle"
        });
        return;
      }
      const filePath = `${this.options.plugin.settings.chatsDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian26.TFile) {
        try {
          const content = await this.app.vault.read(file);
          const fileCache = this.app.metadataCache.getFileCache(file);
          const frontmatter = fileCache == null ? void 0 : fileCache.frontmatter;
          let formattedContent = "";
          formattedContent += "<title>\n";
          formattedContent += (frontmatter == null ? void 0 : frontmatter.title) || chatId;
          formattedContent += "\n</title>\n\n";
          formattedContent += "<system_prompt>\n";
          if (((_c = frontmatter == null ? void 0 : frontmatter.systemMessage) == null ? void 0 : _c.type) === "custom" && ((_d = frontmatter == null ? void 0 : frontmatter.systemMessage) == null ? void 0 : _d.path)) {
            const promptPath = frontmatter.systemMessage.path.replace(/^\[\[(.*?)\]\]$/, "$1");
            const promptFile = this.app.vault.getAbstractFileByPath(`${promptPath}.md`);
            if (promptFile instanceof import_obsidian26.TFile) {
              const promptContent = await this.app.vault.read(promptFile);
              formattedContent += promptContent;
            }
          } else {
            const systemPromptService = SystemPromptService.getInstance(this.app);
            const prompts = await systemPromptService.getSystemPrompts();
            const prompt = prompts.find((p) => {
              var _a2;
              return p.id === ((_a2 = frontmatter == null ? void 0 : frontmatter.systemMessage) == null ? void 0 : _a2.type);
            });
            formattedContent += (prompt == null ? void 0 : prompt.systemPrompt) || "System prompt not found";
          }
          formattedContent += "\n</system_prompt>\n\n";
          if (frontmatter == null ? void 0 : frontmatter.context_files) {
            console.log("Found context files in frontmatter:", frontmatter.context_files);
            for (const contextFile of frontmatter.context_files) {
              const rawPath = typeof contextFile === "string" ? contextFile : contextFile.path;
              const filePath2 = rawPath.replace(/^\[\[(.*?)\]\]$/, "$1").replace(/\\+/g, "/");
              console.log("Processing context file path:", filePath2);
              let file2 = this.app.vault.getAbstractFileByPath(filePath2);
              if (!file2) {
                file2 = this.app.metadataCache.getFirstLinkpathDest(filePath2, "");
              }
              if (!file2 && !filePath2.endsWith(".md")) {
                file2 = this.app.vault.getAbstractFileByPath(`${filePath2}.md`);
              }
              console.log("Resolved file:", file2 == null ? void 0 : file2.path);
              if (file2 instanceof import_obsidian26.TFile) {
                const textExtensions = ["md", "txt", "js", "ts", "jsx", "tsx", "py", "java", "cpp", "c", "h", "css", "html", "json", "yaml", "yml"];
                if (textExtensions.includes(file2.extension.toLowerCase())) {
                  try {
                    const fileContent = await this.app.vault.read(file2);
                    console.log(`Successfully read content from ${file2.path}`);
                    formattedContent += `<context_file name="${file2.basename}.${file2.extension}">
`;
                    formattedContent += fileContent;
                    formattedContent += "\n</context_file>\n\n";
                  } catch (error) {
                    console.error(`Failed to read context file ${file2.path}:`, error);
                  }
                } else {
                  console.log(`Skipping non-text file: ${file2.path}`);
                }
              } else {
                console.log(`Could not resolve file for path: ${filePath2}`);
              }
            }
          } else {
            console.log("No context files found in frontmatter");
          }
          const messageRegex = /<!-- SYSTEMSCULPT-MESSAGE-START role="([^"]+)" message-id="([^"]+)" -->\n([\s\S]*?)\n<!-- SYSTEMSCULPT-MESSAGE-END -->/g;
          let match;
          while ((match = messageRegex.exec(content)) !== null) {
            const [_, role, messageId, messageContent] = match;
            formattedContent += `<${role}_message>
${messageContent.trim()}
</${role}_message>

`;
          }
          await navigator.clipboard.writeText(formattedContent);
          showEnhancedNotice("\u2713 Chat copied to clipboard!", "success");
        } catch (error) {
          console.error("Failed to copy chat:", error);
          showPopup(this.app, "Failed to copy chat to clipboard", {
            title: "Error",
            primaryButton: "OK",
            icon: "alert-circle"
          });
        }
      } else {
        showPopup(this.app, "Chat file not found", {
          title: "Error",
          primaryButton: "OK",
          icon: "alert-circle"
        });
      }
    });
    const openRawButton = utilityButtonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button",
      attr: { "aria-label": "Open raw chat file" }
    });
    (0, import_obsidian26.setIcon)(openRawButton, "file-code");
    openRawButton.addEventListener("click", async () => {
      var _a, _b;
      if (!this.options.plugin) {
        return;
      }
      const state = (_a = this.app.workspace.activeLeaf) == null ? void 0 : _a.getViewState();
      const chatId = (_b = state == null ? void 0 : state.state) == null ? void 0 : _b.chatId;
      if (!chatId) {
        showPopup(this.app, "Could not determine which chat to open", {
          title: "Error",
          primaryButton: "OK",
          icon: "alert-circle"
        });
        return;
      }
      const filePath = `${this.options.plugin.settings.chatsDirectory}/${chatId}.md`;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian26.TFile) {
        const result = await showPopup(this.app, "", {
          title: "Open Raw Chat File",
          description: "\u26A0\uFE0F Warning: Editing the raw chat file directly may corrupt your chat history. Only proceed if you know what you're doing.",
          primaryButton: "Open File",
          secondaryButton: "Cancel",
          icon: "alert-triangle"
        });
        if (result == null ? void 0 : result.confirmed) {
          await this.app.workspace.getLeaf().openFile(file);
          this.close();
        }
      } else {
        showPopup(this.app, "Chat file not found", {
          title: "Error",
          primaryButton: "OK",
          icon: "alert-circle"
        });
      }
    });
    const deleteChatButton = utilityButtonGrid.createEl("button", {
      cls: "systemsculpt-input-action-button systemsculpt-delete-button",
      attr: { "aria-label": "Delete this chat" }
    });
    (0, import_obsidian26.setIcon)(deleteChatButton, "trash");
    deleteChatButton.addEventListener("click", async () => {
      var _a, _b;
      if (!this.options.plugin) {
        return;
      }
      const state = (_a = this.app.workspace.activeLeaf) == null ? void 0 : _a.getViewState();
      const chatId = (_b = state == null ? void 0 : state.state) == null ? void 0 : _b.chatId;
      if (!chatId) {
        showPopup(this.app, "Could not determine which chat to delete", {
          title: "Error",
          primaryButton: "OK",
          icon: "alert-circle"
        });
        return;
      }
      const deleteConfirmed = await showPopup(this.app, "Are you sure you want to delete this chat?", {
        primaryButton: "Delete",
        secondaryButton: "Cancel",
        icon: "alert-triangle"
      });
      if (deleteConfirmed == null ? void 0 : deleteConfirmed.confirmed) {
        const filePath = `${this.options.plugin.settings.chatsDirectory}/${chatId}.md`;
        const file = this.app.vault.getAbstractFileByPath(filePath);
        if (file instanceof import_obsidian26.TFile) {
          await this.app.vault.delete(file);
          this.app.workspace.getLeaf().detach();
          this.close();
          showEnhancedNotice("\u2717 Chat deleted", "error");
        } else {
          showPopup(this.app, "Chat file not found", {
            title: "Error",
            primaryButton: "OK",
            icon: "alert-circle"
          });
        }
      }
    });
    const mainButtonContainer = buttonContainer.createDiv("systemsculpt-main-button-container");
    mainButtonContainer.style.display = "flex";
    mainButtonContainer.style.gap = "8px";
    mainButtonContainer.style.width = "100%";
    mainButtonContainer.style.justifyContent = "flex-end";
    const secondaryButton = mainButtonContainer.createEl("button", {
      text: "Cancel",
      cls: "systemsculpt-button"
    });
    const handleCancel = () => {
      this.result = null;
      this.close();
    };
    secondaryButton.onclick = handleCancel;
    const primaryButton = mainButtonContainer.createEl("button", {
      text: "Save",
      cls: "systemsculpt-button mod-cta"
    });
    const handleSave = () => {
      var _a;
      const activeButton = this.modalEl.querySelector(".systemsculpt-preset-button.active");
      const activePresetLabel = (_a = activeButton == null ? void 0 : activeButton.textContent) != null ? _a : "";
      let result;
      if (activePresetLabel === "Custom" && this.customInput.value) {
        const path = this.customInput.value.replace(/\.md$/, "");
        result = {
          content: this.textArea.value,
          type: "custom",
          path
        };
      } else {
        const preset = this.systemPrompts.find((p) => p.label === activePresetLabel);
        if (preset) {
          result = {
            content: preset.systemPrompt,
            type: preset.id
          };
        } else {
          result = {
            content: this.textArea.value,
            type: "custom"
          };
        }
      }
      this.result = result;
      this.close();
    };
    primaryButton.onclick = handleSave;
    this.modalEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.isComposing && !e.shiftKey && e.target !== this.textArea) {
        e.preventDefault();
        handleSave();
      } else if (e.key === "Escape") {
        e.preventDefault();
        handleCancel();
      }
    });
  }
  createPresetButtons() {
    if (!this.presetButtonContainer)
      return;
    this.presetButtonContainer.empty();
    const presets = [
      ...this.systemPrompts,
      ...!this.systemPrompts.some((p) => p.id === "custom") ? [{
        id: "custom",
        label: "Custom",
        isUserConfigurable: true,
        systemPrompt: this.currentPrompt || ""
      }] : []
    ];
    presets.forEach((preset) => {
      const button = this.presetButtonContainer.createEl("button", {
        text: preset.label,
        cls: "systemsculpt-preset-button"
      });
      if (preset.label === this.activePreset) {
        button.addClass("active");
        this.updateUIForPreset(preset);
      }
      button.onclick = () => {
        this.presetButtonContainer.querySelectorAll(".systemsculpt-preset-button").forEach((btn) => btn.removeClass("active"));
        button.addClass("active");
        this.activePreset = preset.label;
        this.updateUIForPreset(preset);
      };
    });
  }
  updateUIForPreset(preset) {
    if (preset.label === "Custom") {
      this.customSection.style.display = "block";
      this.customInput.focus();
      this.textArea.readOnly = false;
      if (this.options.customPromptFilePath && !this.customInput.value) {
        this.customInput.value = this.options.customPromptFilePath.replace(/^\[\[(.*?)\]\]$/, "$1");
      }
      this.textArea.value = this.currentPrompt || "";
    } else {
      this.customSection.style.display = "none";
      this.textArea.value = preset.systemPrompt;
      this.textArea.readOnly = !preset.isUserConfigurable;
    }
  }
  async loadSystemPrompts() {
    console.time("loadSystemPrompts");
    try {
      const prompts = await this.systemPromptService.getSystemPrompts();
      this.renderPrompts(prompts);
      this.showLoading(false);
    } catch (error) {
      console.error("Failed to load system prompts:", error);
      throw error;
    } finally {
      console.timeEnd("loadSystemPrompts");
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (this.resolvePromise !== void 0 && this.resolvePromise !== null) {
      this.resolvePromise(this.result);
    }
  }
  async openAndGetValue() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
  renderPrompts(prompts) {
    if (!this.promptsContainer) {
      this.promptsContainer = this.contentEl.createDiv("systemsculpt-prompts-container");
    }
    this.promptsContainer.empty();
    prompts.forEach((prompt) => {
      const promptEl = this.promptsContainer.createDiv("systemsculpt-prompt-item");
      promptEl.setText(prompt.label);
      promptEl.addEventListener("click", () => {
        this.currentPrompt = prompt.systemPrompt;
        this.close();
      });
    });
  }
  hideLoading() {
    if (this.loadingIndicator) {
      this.loadingIndicator.style.display = "none";
    }
  }
  showError(message) {
    if (!this.contentContainer)
      return;
    this.showLoading(false);
    const errorEl = this.contentContainer.createDiv("systemsculpt-error-message");
    errorEl.setText(message);
    const retryButton = errorEl.createEl("button", {
      text: "Retry",
      cls: "systemsculpt-button mod-cta"
    });
    retryButton.onclick = async () => {
      errorEl.remove();
      this.showLoading(true);
      try {
        await this.loadSystemPrompts();
      } catch (error) {
        console.error("Retry failed:", error);
        this.showError("Failed to load system prompts. Please try again.");
      }
    };
  }
  createSectionHeader(container, text) {
    const header = container.createDiv("systemsculpt-section-header");
    header.style.fontSize = "0.8em";
    header.style.textTransform = "uppercase";
    header.style.color = "var(--text-muted)";
    header.style.fontWeight = "600";
    header.style.marginBottom = "0.5rem";
    header.style.letterSpacing = "0.05em";
    header.setText(text);
    return header;
  }
};
async function showChatSystemPromptModal(app, currentPrompt, options) {
  const defaultOptions = {
    systemPromptsDirectory: "SystemSculpt/System Prompts"
  };
  const modal = new ChatSystemPromptModal(app, {
    ...defaultOptions,
    ...options
  });
  const result = await modal.openAndGetValue();
  if (result !== null && (options == null ? void 0 : options.onSave)) {
    await options.onSave(result.content);
  }
  return result;
}

// src/views/chatview/systemPromptHandling.ts
var systemPromptHandling = {
  handleSystemPromptEdit: async function(chatView) {
    try {
      const result = await showChatSystemPromptModal(chatView.app, "", {
        systemPromptsDirectory: chatView.plugin.settings.systemPromptsDirectory,
        customPromptFilePath: chatView.systemPromptPath,
        modelContextLength: await chatView.getModelContextLength(),
        tokenLimitPercentage: chatView.tokenLimitPercentage,
        plugin: chatView.plugin,
        onModelSelect: async (modelId) => {
          chatView.selectedModelId = modelId;
          await chatView.updateModelIndicator();
        },
        currentModelId: chatView.selectedModelId,
        currentPrompt: await chatView.getCurrentSystemPrompt(),
        chatTitle: chatView.chatTitle,
        messages: chatView.getMessages(),
        onTitleChange: async (newTitle) => {
          await chatView.setTitle(newTitle);
        }
      });
      if (result) {
        chatView.systemPromptType = result.type;
        chatView.systemPromptPath = result.path;
        chatView.tokenLimit = result.tokenLimit;
        chatView.tokenLimitPercentage = result.tokenLimitPercentage;
        await chatView.saveChat();
      }
    } catch (error) {
      console.error("Error editing system prompt:", error);
      chatView.handleError("Failed to edit system prompt");
    }
  }
};

// src/views/chatview/ChatView.ts
var CHAT_VIEW_TYPE = "systemsculpt-chat-view";
var ChatView = class extends import_obsidian27.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.messages = [];
    this.currentModelName = "";
    this.isGenerating = false;
    this.refreshInterval = null;
    this.lastRefreshTime = 0;
    this.awaitingStateRestore = false;
    this.webSearchEnabled = false;
    this.onOpen = () => uiSetup.onOpen(this);
    this.updateModelIndicator = () => uiSetup.updateModelIndicator(this);
    this.addMessage = (role, content, existingMessageId) => messageHandling.addMessage(this, role, content, existingMessageId);
    this.loadMessages = () => messageHandling.loadMessages(this);
    this.setupDragAndDrop = (container) => eventHandling.setupDragAndDrop(this, container);
    this.handleSystemPromptEdit = () => systemPromptHandling.handleSystemPromptEdit(this);
    this.plugin = plugin;
    const state = this.leaf.getViewState();
    const initialState = (state == null ? void 0 : state.state) || {};
    this.messages = [];
    this.chatId = initialState.chatId || "";
    this.chatTitle = initialState.chatTitle || "";
    this.selectedModelId = initialState.selectedModelId || plugin.settings.selectedModelId;
    this.currentModelName = "";
    this.isGenerating = false;
    this.lastRefreshTime = 0;
    this.awaitingStateRestore = !initialState.chatId;
    this.refreshInterval = null;
    this.tokenLimit = void 0;
    this.tokenLimitPercentage = void 0;
    this.currentPrompt = void 0;
    this.systemPromptPath = void 0;
    this.aiService = SystemSculptService.getInstance(plugin.settings, this.app);
    this.chatStorage = new ChatStorageService(this.app, plugin.settings.chatsDirectory);
    this.messageRenderer = new MessageRenderer(this.app);
    this.systemPromptType = plugin.settings.systemPromptType || "general-use";
    if (this.systemPromptType === "custom" && plugin.settings.systemPromptPath) {
      this.systemPromptPath = plugin.settings.systemPromptPath;
    }
    this.layoutChangeHandler = this.onLayoutChange.bind(this);
  }
  getViewType() {
    return CHAT_VIEW_TYPE;
  }
  getDisplayText() {
    return this.chatTitle || "Loading...";
  }
  async checkForUpdates() {
    if (this.isGenerating)
      return;
    try {
      const savedChats = await this.chatStorage.loadChats();
      const currentChat = savedChats.find((c) => c.id === this.chatId);
      if (!currentChat)
        return;
      const hasChanges = currentChat.messages.length !== this.messages.length || currentChat.selectedModelId !== this.selectedModelId || JSON.stringify(Array.from(this.contextManager.getContextFiles())) !== JSON.stringify(currentChat.context_files) || JSON.stringify(currentChat.messages) !== JSON.stringify(this.messages);
      if (hasChanges) {
        this.messages = currentChat.messages;
        this.selectedModelId = currentChat.selectedModelId;
        if (currentChat.context_files) {
          await this.contextManager.setContextFiles(currentChat.context_files);
        }
        await this.loadMessages();
        this.updateModelIndicator();
      } else {
        await this.contextManager.checkSyncStatus();
      }
    } catch (error) {
      console.error("Failed to check for updates:", error);
    }
  }
  async saveChat() {
    if (!this.chatId) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      const hour = String(now.getHours()).padStart(2, "0");
      const minute = String(now.getMinutes()).padStart(2, "0");
      const second = String(now.getSeconds()).padStart(2, "0");
      this.chatId = `${year}-${month}-${day} ${hour}-${minute}-${second}`;
      this.chatTitle = this.chatTitle || this.chatId;
    }
    try {
      await this.chatStorage.saveChat(this.chatId, this.messages, this.selectedModelId, this.contextManager.getContextFiles(), void 0, this.systemPromptType, this.systemPromptPath, this.chatTitle, this.tokenLimit, this.tokenLimitPercentage);
    } catch (error) {
      this.handleError("Failed to save chat");
    }
  }
  async handleError(error) {
    console.error("Chat error:", {
      error,
      message: typeof error === "string" ? error : error.message,
      code: error instanceof SystemSculptError ? error.code : void 0,
      metadata: error instanceof SystemSculptError ? error.metadata : void 0
    });
    let errorMessage = typeof error === "string" ? error : error.message;
    if (error instanceof SystemSculptError && (error.code === "MODEL_UNAVAILABLE" || error.code === "MODEL_REQUEST_ERROR" || error.code === "QUOTA_EXCEEDED")) {
      showEnhancedNotice(errorMessage, "error", error);
      const modal = new ModelSelectionModal(this.app, this.selectedModelId, async (modelId) => {
        this.selectedModelId = modelId;
        this.updateModelIndicator();
        showEnhancedNotice("Model changed. You can now retry your message.", "info");
        this.focusInput();
      }, this.plugin);
      modal.open();
      try {
        const models = await this.plugin.modelService.getModels();
        modal.setModels(models);
      } catch (err) {
        console.error("Failed to fetch models:", err);
        showEnhancedNotice("Failed to fetch available models", "error", err);
      }
      const lastMessage = this.chatContainer.querySelector(".systemsculpt-message:last-child");
      if (lastMessage)
        lastMessage.remove();
      const lastUserMessage = [...this.messages].reverse().find((msg) => msg.role === "user");
      if (lastUserMessage) {
        const index = this.messages.findIndex((msg) => msg.message_id === lastUserMessage.message_id);
        if (index !== -1) {
          this.messages.splice(index);
          const allMessages = this.chatContainer.querySelectorAll(".systemsculpt-message");
          for (let i = index; i < allMessages.length; i++)
            allMessages[i].remove();
          this.inputHandler.setValue(typeof lastUserMessage.content === "string" ? lastUserMessage.content : JSON.stringify(lastUserMessage.content));
          this.inputHandler.focus();
        }
      }
    } else {
      showEnhancedNotice(errorMessage, "error", error);
    }
  }
  async onLayoutChange() {
    var _a;
    if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian27.ItemView)) == null ? void 0 : _a.leaf) === this.leaf) {
      this.lastRefreshTime = 0;
      await this.checkForUpdates();
      this.inputHandler.focus();
    }
  }
  generateMessageId() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === "x" ? r : r & 3 | 8;
      return v.toString(16);
    });
  }
  async getModelContextLength() {
    try {
      const models = await this.plugin.modelService.getModels();
      const currentModel = models.find((model) => model.id === this.selectedModelId);
      return currentModel == null ? void 0 : currentModel.context_length;
    } catch (error) {
      console.error("Failed to get model context length:", error);
      return void 0;
    }
  }
  async getCurrentSystemPrompt() {
    if (this.systemPromptType === "custom" && this.systemPromptPath) {
      const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(this.systemPromptPath, "") || this.app.vault.getAbstractFileByPath(`${this.systemPromptPath}.md`) || this.app.vault.getAbstractFileByPath(`SystemSculpt/System Prompts/${this.systemPromptPath}.md`);
      if (resolvedFile instanceof import_obsidian27.TFile) {
        const content = await this.app.vault.read(resolvedFile);
        return content;
      }
      return this.currentPrompt || this.plugin.settings.systemPrompt;
    }
    try {
      const preset = await SystemPromptService.getInstance(this.app).getSystemPromptById(this.systemPromptType);
      if (preset) {
        return preset.systemPrompt;
      }
    } catch (error) {
      console.error("[SystemSculpt] Error fetching system prompt preset:", error);
    }
    return this.currentPrompt || this.plugin.settings.systemPrompt;
  }
  getInputValue() {
    return this.inputHandler.getValue();
  }
  onunload() {
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
      this.refreshInterval = null;
    }
    this.scrollManager.cleanup();
    this.app.workspace.off("active-leaf-change", this.checkForUpdates.bind(this));
    this.contextManager.unload();
    this.inputHandler.unload();
  }
  getState() {
    return {
      chatId: this.chatId,
      selectedModelId: this.selectedModelId,
      chatTitle: this.chatTitle
    };
  }
  async setState(state) {
    if (!(state == null ? void 0 : state.chatId)) {
      this.chatId = "";
      this.chatTitle = "New Chat";
      this.awaitingStateRestore = false;
      return;
    }
    if (this.chatId === state.chatId && !this.awaitingStateRestore) {
      return;
    }
    this.chatId = state.chatId;
    this.selectedModelId = state.selectedModelId;
    this.chatTitle = state.chatTitle;
    this.awaitingStateRestore = false;
    setTimeout(async () => {
      var _a;
      try {
        await this.loadChatById(state.chatId);
        if (((_a = this.app.workspace.getActiveViewOfType(import_obsidian27.ItemView)) == null ? void 0 : _a.leaf) === this.leaf && this.inputHandler) {
          this.inputHandler.focus();
        }
      } catch (error) {
        console.error("Failed to restore chat state:", error);
      }
    }, 0);
  }
  async loadChatById(chatId) {
    try {
      const chatData = await this.chatStorage.loadChat(chatId);
      if (!chatData) {
        return;
      }
      this.chatId = chatId;
      this.selectedModelId = chatData.selectedModelId || this.selectedModelId;
      if (chatData.title) {
        this.chatTitle = chatData.title;
        if (this.leaf) {
          this.leaf.setViewState({
            type: CHAT_VIEW_TYPE,
            state: {
              chatId: this.chatId,
              selectedModelId: this.selectedModelId,
              chatTitle: chatData.title
            }
          });
        }
      }
      this.messages = chatData.messages || [];
      if (chatData.context_files && this.contextManager) {
        const contextFiles = chatData.context_files.map((file) => typeof file === "string" ? file : file.path);
        await this.contextManager.setContextFiles(contextFiles);
      }
      if (this.modelIndicator)
        setTimeout(() => this.updateModelIndicator(), 0);
      if (this.messages.length > 0 && this.chatContainer)
        await this.renderMessagesInChunks();
    } catch (error) {
      console.error(`Failed to load chat ${chatId}:`, error);
      throw new Error("Failed to load chat");
    }
  }
  async renderMessagesInChunks(chunkSize = 5) {
    if (!this.chatContainer)
      return;
    this.chatContainer.empty();
    for (let i = 0; i < this.messages.length; i += chunkSize) {
      const chunk = this.messages.slice(i, i + chunkSize);
      await Promise.all(chunk.map((message) => this.addMessage(message.role, message.content, message.message_id)));
      if (i + chunkSize < this.messages.length)
        await new Promise((resolve) => setTimeout(resolve, 10));
    }
    this.scrollManager.updateContentHeight();
    this.scrollManager.scrollToBottom();
  }
  async addFileToContext(file) {
    await this.contextManager.addFileToContext(file);
  }
  async copyToClipboard() {
    try {
      const content = await this.getMarkdown();
      await navigator.clipboard.writeText(content);
      showNotice("Chat copied to clipboard", { type: "success" });
    } catch (error) {
      showNotice("Failed to copy chat to clipboard", { type: "error" });
    }
  }
  getTokenLimit() {
    return this.tokenLimit;
  }
  focusInput() {
    this.inputHandler.focus();
  }
  getSelectedModelId() {
    return this.selectedModelId;
  }
  async setSelectedModelId(modelId) {
    console.log("[SystemSculpt] Setting selected model:", {
      modelId,
      previousModelId: this.selectedModelId,
      activeProvider: this.plugin.settings.activeProvider
    });
    this.selectedModelId = modelId;
    const models = await this.plugin.modelService.getModels();
    const selectedModel = models.find((model) => model.id === modelId);
    if (selectedModel) {
      const customProvider = this.plugin.settings.customProviders.find((p) => p.name.toLowerCase() === selectedModel.provider.toLowerCase());
      if (customProvider) {
        this.plugin.settings.activeProvider = {
          id: customProvider.id,
          name: customProvider.name,
          type: "custom"
        };
      } else {
        this.plugin.settings.activeProvider = {
          id: "systemsculpt",
          name: "SystemSculpt",
          type: "native"
        };
      }
      await this.plugin.saveSettings();
    }
    console.log("[SystemSculpt] Selected model details:", {
      model: selectedModel ? {
        id: selectedModel.id,
        name: selectedModel.name,
        provider: selectedModel.provider,
        identifier: selectedModel.identifier
      } : null,
      tokenLimit: this.tokenLimit,
      tokenLimitPercentage: this.tokenLimitPercentage,
      activeProvider: this.plugin.settings.activeProvider
    });
    if (this.tokenLimitPercentage && (selectedModel == null ? void 0 : selectedModel.context_length)) {
      this.tokenLimit = Math.floor(this.tokenLimitPercentage / 100 * selectedModel.context_length);
      await this.saveChat();
    }
    this.inputHandler.onModelChange();
    this.focusInput();
  }
  async getMarkdown() {
    let chatContent = "";
    if (this.systemPromptType) {
      let systemPromptContent = "";
      if (this.systemPromptType === "custom" && this.systemPromptPath) {
        const file = this.app.vault.getAbstractFileByPath(this.systemPromptPath + ".md");
        if (file instanceof import_obsidian27.TFile)
          systemPromptContent = await this.app.vault.read(file);
      } else {
        try {
          const preset = await SystemPromptService.getInstance(this.app).getSystemPromptById(this.systemPromptType);
          if (preset)
            systemPromptContent = preset.systemPrompt;
        } catch (error) {
          console.error("Failed to fetch system prompt:", error);
        }
      }
      if (systemPromptContent)
        chatContent += `System Prompt:
"""""
${systemPromptContent}
"""""

`;
    }
    const contextFiles = this.contextManager.getContextFiles();
    if (contextFiles.size > 0) {
      chatContent += "Context Files:\n\n";
      for (const filePath of contextFiles) {
        if (!filePath.startsWith("doc:")) {
          const cleanPath = filePath.replace(/^\[\[(.*?)\]\]$/, "$1").replace(/\$begin:math:display\$\[(.*?)\$end:math:display\$]/g, "$1");
          const resolvedFile = this.app.metadataCache.getFirstLinkpathDest(cleanPath, "");
          if (resolvedFile instanceof import_obsidian27.TFile && !resolvedFile.extension.match(/^(jpg|jpeg|png|gif|webp)$/i)) {
            const content = await this.app.vault.read(resolvedFile);
            chatContent += `[${cleanPath}]
"""""
${content}
"""""

`;
          }
        }
      }
    }
    chatContent += "Chat History Thus Far:\n\n";
    for (const message of this.messages) {
      const role = message.role === "assistant" ? "A" : "User";
      if (typeof message.content === "string")
        chatContent += `${role}:
"""""
${message.content}
"""""

`;
    }
    return chatContent;
  }
  getMessages() {
    return [...this.messages];
  }
  getChatTitle() {
    return this.chatTitle;
  }
  async setTitle(newTitle) {
    this.chatTitle = newTitle;
    await this.saveChat();
    if (this.leaf) {
      this.leaf.setViewState({
        type: CHAT_VIEW_TYPE,
        state: {
          chatId: this.chatId,
          selectedModelId: this.selectedModelId,
          chatTitle: newTitle
        }
      });
    }
    this.app.workspace.requestSaveLayout();
  }
};

// src/services/RecorderService.ts
var RECORDING_FORMATS = [
  { mimeType: "audio/webm;codecs=opus", extension: "webm", sampleRate: 16e3 },
  { mimeType: "audio/webm", extension: "webm", sampleRate: 48e3 },
  { mimeType: "audio/ogg;codecs=opus", extension: "ogg", sampleRate: 48e3 },
  { mimeType: "audio/wav", extension: "wav", sampleRate: 48e3 }
];
var RecorderService = class {
  constructor(app, plugin, options = {}) {
    this.isRecording = false;
    this.onToggleCallbacks = new Set();
    this.mediaStream = null;
    this.mediaRecorder = null;
    this.chunks = [];
    this.selectedFormat = null;
    this.lastRecordedFilePath = null;
    this.audioContext = null;
    this.analyser = null;
    this.animationFrame = null;
    this.smoothingFactor = 0.4;
    this.visualizerCanvas = null;
    this.currentContext = null;
    this.recordingModal = null;
    this.dragCleanup = null;
    this.editorHandler = null;
    this.draw = () => {
      if (!this.isRecording || !this.analyser || !this.visualizerCanvas) {
        if (this.animationFrame) {
          cancelAnimationFrame(this.animationFrame);
          this.animationFrame = null;
        }
        return;
      }
      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
        this.animationFrame = null;
      }
      const bufferLength = this.analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      this.analyser.getByteFrequencyData(dataArray);
      const ctx = this.visualizerCanvas.getContext("2d");
      if (!ctx)
        return;
      ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      const rect = this.visualizerCanvas.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;
      const centerY = height / 2;
      const centerX = width / 2;
      const isMobile = width <= 400;
      const overlap = isMobile ? 3 : 5;
      const centerOverlapScale = isMobile ? 4 : 8;
      const amplitudeScale = isMobile ? 0.8 : 0.95;
      const edgeZoneScale = isMobile ? 0.15 : 0.2;
      const computedStyle = getComputedStyle(document.documentElement);
      let accentColor = computedStyle.getPropertyValue("--text-accent").trim();
      if (!accentColor) {
        accentColor = "#5871ef";
      }
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, accentColor);
      gradient.addColorStop(0.5, accentColor);
      gradient.addColorStop(1, accentColor);
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      const halfBufferLength = Math.floor(bufferLength / 2);
      const sliceWidth = width / 2 / halfBufferLength;
      const centerOverlap = sliceWidth * centerOverlapScale;
      const getEdgeTaper = (i, total) => {
        const edgeZone = total * edgeZoneScale;
        if (i < edgeZone) {
          return 0.3 + 0.7 * (i / edgeZone);
        } else if (i > total - edgeZone) {
          return 0.3 + 0.7 * ((total - i) / edgeZone);
        }
        return 1;
      };
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const value = dataArray[Math.abs(i)] / 255;
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        this.smoothedValues[index] = this.smoothedValues[index] * this.smoothingFactor + value * (1 - this.smoothingFactor);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX + i * sliceWidth - centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = -overlap; i < halfBufferLength + overlap; i++) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY + this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      for (let i = halfBufferLength + overlap - 1; i >= -overlap; i--) {
        const index = Math.min(Math.abs(i), halfBufferLength - 1);
        const x = centerX - i * sliceWidth + centerOverlap;
        const taper = getEdgeTaper(i + overlap, halfBufferLength + overlap * 2);
        const y = centerY - this.smoothedValues[index] * centerY * amplitudeScale * taper;
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      if (this.isRecording) {
        this.animationFrame = requestAnimationFrame(this.draw);
      }
    };
    this.app = app;
    this.plugin = plugin;
    this.smoothedValues = new Float32Array(128);
    this.updateContext(options);
  }
  static getInstance(app, plugin, options = {}) {
    if (!RecorderService.instance) {
      RecorderService.instance = new RecorderService(app, plugin);
    }
    RecorderService.instance.updateContext(options);
    return RecorderService.instance;
  }
  getActiveViewInfo() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      return { isChat: false, viewIdentifier: "unknown" };
    }
    const viewState = activeLeaf.getViewState();
    const viewType = viewState.type;
    if (viewType === CHAT_VIEW_TYPE) {
      return { isChat: true, viewIdentifier: "chat" };
    }
    const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian28.MarkdownView);
    if (markdownView == null ? void 0 : markdownView.file) {
      return {
        isChat: false,
        viewIdentifier: `note-${markdownView.file.path}`
      };
    }
    return { isChat: false, viewIdentifier: "unknown" };
  }
  updateContext(options) {
    const { isChat } = this.getActiveViewInfo();
    this.currentContext = {
      isInChat: isChat,
      onTranscriptionComplete: options.onTranscriptionComplete
    };
  }
  insertTextIntoActiveView(text) {
    const { isChat } = this.getActiveViewInfo();
    if (isChat) {
      const chatView = this.app.workspace.getActiveViewOfType(ChatView);
      if (chatView) {
        const input = chatView.containerEl.querySelector(".systemsculpt-chat-input");
        if (input) {
          const cursorPos = input.selectionStart;
          const currentValue = input.value;
          if (cursorPos !== null) {
            const newValue = currentValue.slice(0, cursorPos) + text + currentValue.slice(cursorPos);
            input.value = newValue;
            input.selectionStart = input.selectionEnd = cursorPos + text.length;
          } else {
            input.value = currentValue + text;
            input.selectionStart = input.selectionEnd = input.value.length;
          }
          input.dispatchEvent(new Event("input"));
          input.focus();
          new import_obsidian28.Notice("\u2728 Transcription pasted into chat");
        } else {
          console.warn("Chat input element not found");
          new import_obsidian28.Notice("\u2728 Transcription copied to clipboard (no chat input)");
        }
      } else {
        console.warn("No active chat view found");
        new import_obsidian28.Notice("\u2728 Transcription copied to clipboard (no active chat)");
      }
    } else {
      const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian28.MarkdownView);
      if (!(markdownView == null ? void 0 : markdownView.editor)) {
        console.warn("No active markdown editor found");
        new import_obsidian28.Notice("\u2728 Transcription copied to clipboard (no active note)");
        return;
      }
      const editor = markdownView.editor;
      const cursor = editor.getCursor();
      const lineContent = editor.getLine(cursor.line);
      const textToInsert = text ? cursor.ch > 0 && lineContent.length > 0 ? "\n" + text : text : "";
      if (!textToInsert) {
        console.warn("No text to insert");
        return;
      }
      editor.replaceRange(textToInsert, cursor);
      const lines = textToInsert.split("\n");
      const lastLine = lines[lines.length - 1] || "";
      editor.setCursor({
        line: cursor.line + lines.length - 1,
        ch: lastLine.length
      });
      new import_obsidian28.Notice("\u2728 Transcription pasted into note");
    }
  }
  async transcribeLastRecording() {
    var _a, _b;
    if (!this.lastRecordedFilePath)
      return;
    try {
      const file = this.plugin.app.vault.getAbstractFileByPath(this.lastRecordedFilePath);
      if (!file || !(file instanceof import_obsidian28.TFile))
        return;
      const modal = new AudioTranscriptionModal(this.app, {
        file,
        isChat: (_b = (_a = this.currentContext) == null ? void 0 : _a.isInChat) != null ? _b : false,
        onTranscriptionComplete: (text) => {
          var _a2;
          if ((_a2 = this.currentContext) == null ? void 0 : _a2.onTranscriptionComplete) {
            this.currentContext.onTranscriptionComplete(text);
          } else {
            this.insertTextIntoActiveView(text);
          }
        },
        plugin: this.plugin
      });
      modal.open();
      try {
        await this.plugin.app.vault.delete(file);
      } catch (error) {
        console.warn("Failed to clean up recording file:", error);
      }
    } catch (error) {
      console.error("Auto-transcription failed:", error);
      new import_obsidian28.Notice("\u274C Failed to transcribe audio");
      throw error;
    }
  }
  createRecordingModal() {
    if (this.recordingModal) {
      if (this.dragCleanup) {
        this.dragCleanup();
        this.dragCleanup = null;
      }
      this.recordingModal.remove();
      this.recordingModal = null;
    }
    this.recordingModal = document.createElement("div");
    this.recordingModal.className = "systemsculpt-recorder-modal";
    const content = document.createElement("div");
    content.className = "systemsculpt-recorder-content";
    const liveIndicator = document.createElement("div");
    liveIndicator.className = "systemsculpt-recorder-live";
    liveIndicator.textContent = "\u25CF Live";
    content.appendChild(liveIndicator);
    const canvas = document.createElement("canvas");
    canvas.className = "systemsculpt-recorder-canvas";
    content.appendChild(canvas);
    this.recordingModal.appendChild(content);
    document.body.appendChild(this.recordingModal);
    this.dragCleanup = this.setupDraggable(this.recordingModal);
    this.setVisualizerCanvas(canvas);
  }
  setupDraggable(element) {
    let pos = { x: 0, y: 0 };
    const cleanup = () => {
      element.classList.remove("dragging");
    };
    const onMove = (clientX, clientY) => {
      const rect = element.getBoundingClientRect();
      pos.x = Math.min(Math.max(0, clientX - rect.width / 2), window.innerWidth - rect.width);
      pos.y = Math.min(Math.max(0, clientY - rect.height / 2), window.innerHeight - rect.height);
      element.style.bottom = "";
      element.style.right = "";
      element.style.left = `${pos.x}px`;
      element.style.top = `${pos.y}px`;
    };
    const onPointerDown = (e) => {
      if (e.button !== 0 && e.button !== -1)
        return;
      element.classList.add("dragging");
      element.setPointerCapture(e.pointerId);
      const rect = element.getBoundingClientRect();
      pos.x = rect.left;
      pos.y = rect.top;
      onMove(e.clientX, e.clientY);
    };
    const onPointerMove = (e) => {
      if (element.hasPointerCapture(e.pointerId)) {
        onMove(e.clientX, e.clientY);
      }
    };
    const onPointerUp = (e) => {
      cleanup();
      element.releasePointerCapture(e.pointerId);
    };
    element.addEventListener("pointerdown", onPointerDown);
    element.addEventListener("pointermove", onPointerMove);
    element.addEventListener("pointerup", onPointerUp);
    element.addEventListener("pointercancel", cleanup);
    return () => {
      element.removeEventListener("pointerdown", onPointerDown);
      element.removeEventListener("pointermove", onPointerMove);
      element.removeEventListener("pointerup", onPointerUp);
      element.removeEventListener("pointercancel", cleanup);
    };
  }
  async toggleRecording() {
    try {
      if (!this.isRecording) {
        const { isChat, viewIdentifier } = this.getActiveViewInfo();
        if (viewIdentifier === "unknown") {
          new import_obsidian28.Notice("\u26A0\uFE0F Please open a note or chat before recording");
          return;
        }
        console.log("Starting recording in view:", {
          isChat,
          viewIdentifier
        });
        this.updateContext({
          isInChat: isChat
        });
        this.createRecordingModal();
      }
      if (this.isRecording) {
        await this.stopRecording();
        if (this.recordingModal) {
          if (this.dragCleanup) {
            this.dragCleanup();
            this.dragCleanup = null;
          }
          this.recordingModal.remove();
          this.recordingModal = null;
        }
      } else {
        await this.startRecording();
        if (this.recordingModal) {
          this.recordingModal.classList.add("recording");
        }
      }
    } catch (error) {
      console.error("Error toggling recording:", error);
      new import_obsidian28.Notice("\u274C Failed to toggle recording");
    }
  }
  async ensureRecordingDirectory() {
    const dir = this.plugin.settings.recordingsDirectory;
    try {
      await this.plugin.app.vault.adapter.mkdir(dir);
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : "Unknown error";
      console.error("Failed to create recordings directory:", errorMessage);
      throw new Error(`Failed to create recordings directory: ${errorMessage}`);
    }
  }
  async detectSupportedFormat() {
    for (const format of RECORDING_FORMATS) {
      try {
        if (MediaRecorder.isTypeSupported(format.mimeType)) {
          console.log(`Selected recording format: ${format.mimeType}`);
          return format;
        }
      } catch (error) {
        console.warn(`Format ${format.mimeType} check failed:`, error);
      }
    }
    throw new Error("No supported audio recording format found");
  }
  generateFileName() {
    var _a;
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-").replace("T", "_").split(".")[0];
    return `${timestamp}.${((_a = this.selectedFormat) == null ? void 0 : _a.extension) || "audio"}`;
  }
  resetVisualizationState() {
    this.smoothedValues = new Float32Array(128);
    if (this.animationFrame) {
      cancelAnimationFrame(this.animationFrame);
      this.animationFrame = null;
    }
    if (this.analyser) {
      this.analyser.disconnect();
      this.analyser = null;
    }
    if (this.audioContext) {
      this.audioContext.close();
      this.audioContext = null;
    }
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
  }
  setupVisualization() {
    if (!this.mediaStream)
      return;
    this.audioContext = new AudioContext({
      sampleRate: 16e3,
      latencyHint: "interactive"
    });
    const source = this.audioContext.createMediaStreamSource(this.mediaStream);
    this.analyser = this.audioContext.createAnalyser();
    this.analyser.fftSize = 256;
    this.analyser.smoothingTimeConstant = 0.7;
    source.connect(this.analyser);
    if (this.visualizerCanvas) {
      this.updateCanvasSize();
      this.draw();
    }
  }
  setVisualizerCanvas(canvas) {
    if (this.visualizerCanvas) {
      const ctx = this.visualizerCanvas.getContext("2d");
      if (ctx) {
        ctx.clearRect(0, 0, this.visualizerCanvas.width, this.visualizerCanvas.height);
      }
    }
    if (!canvas) {
      this.resetVisualizationState();
    }
    this.visualizerCanvas = canvas;
    if (canvas && this.isRecording) {
      this.updateCanvasSize();
      if (!this.audioContext || !this.analyser) {
        this.setupVisualization();
      } else {
        this.draw();
      }
    }
  }
  updateCanvasSize() {
    if (!this.visualizerCanvas)
      return;
    const rect = this.visualizerCanvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    this.visualizerCanvas.width = rect.width * dpr;
    this.visualizerCanvas.height = rect.height * dpr;
    const ctx = this.visualizerCanvas.getContext("2d");
    if (ctx) {
      ctx.scale(dpr, dpr);
    }
  }
  async startRecording() {
    if (this.isRecording)
      return;
    this.resetVisualizationState();
    try {
      await this.ensureRecordingDirectory();
      const permissionResult = await navigator.permissions.query({
        name: "microphone"
      });
      if (permissionResult.state === "denied") {
        throw new Error("Microphone permission denied");
      }
      this.selectedFormat = await this.detectSupportedFormat();
      const audioConstraints = {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 16e3,
        channelCount: 1
      };
      if (this.plugin.settings.preferredMicrophoneId) {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const preferredDevice = devices.find((device) => device.kind === "audioinput" && device.deviceId === this.plugin.settings.preferredMicrophoneId);
          if (preferredDevice) {
            audioConstraints.deviceId = {
              exact: this.plugin.settings.preferredMicrophoneId
            };
          } else {
            this.plugin.settings.preferredMicrophoneId = "";
            await this.plugin.saveSettings();
            console.log("Preferred microphone not found, falling back to default");
          }
        } catch (error) {
          console.error("Error checking microphone devices:", error);
        }
      }
      this.mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: audioConstraints
      });
      this.mediaRecorder = new MediaRecorder(this.mediaStream, {
        mimeType: this.selectedFormat.mimeType
      });
      this.chunks = [];
      this.mediaRecorder.ondataavailable = async (e) => {
        var _a, _b;
        if (e.data.size > 0) {
          this.chunks.push({
            blob: e.data,
            sampleRate: (_b = (_a = this.selectedFormat) == null ? void 0 : _a.sampleRate) != null ? _b : 48e3
          });
        }
      };
      this.mediaRecorder.onstop = async () => {
        var _a;
        try {
          const fileName = this.generateFileName();
          const filePath = `${this.plugin.settings.recordingsDirectory}/${fileName}`;
          const blob = new Blob(this.chunks.map((chunk) => chunk.blob), { type: (_a = this.selectedFormat) == null ? void 0 : _a.mimeType });
          const arrayBuffer = await blob.arrayBuffer();
          await this.plugin.app.vault.adapter.writeBinary(filePath, arrayBuffer);
          this.lastRecordedFilePath = filePath;
          await this.transcribeLastRecording();
        } catch (error) {
          console.error("Failed to save recording:", error);
          new import_obsidian28.Notice("\u274C Failed to save recording");
        }
      };
      this.mediaRecorder.start(1e3);
      this.setupVisualization();
      this.isRecording = true;
      this.notifyListeners();
      if (this.visualizerCanvas) {
        this.draw();
      }
    } catch (error) {
      console.error("Recording error:", error);
      const errorMessage = error instanceof Error ? error.message : "Recording failed";
      throw error;
    }
  }
  async stopRecording() {
    if (!this.isRecording)
      return;
    if (this.mediaRecorder && this.mediaRecorder.state !== "inactive") {
      this.mediaRecorder.stop();
    }
    if (this.mediaStream) {
      this.mediaStream.getTracks().forEach((track) => track.stop());
      this.mediaStream = null;
    }
    this.resetVisualizationState();
    if (this.recordingModal) {
      this.recordingModal.classList.remove("recording");
    }
    this.mediaRecorder = null;
    this.isRecording = false;
    this.notifyListeners();
  }
  onToggle(callback) {
    this.onToggleCallbacks.add(callback);
  }
  notifyListeners() {
    this.onToggleCallbacks.forEach((cb) => cb(this.isRecording));
  }
  unload() {
    this.stopRecording();
    this.onToggleCallbacks.clear();
  }
};

// src/components/SystemSculptContextMenu.ts
var import_obsidian29 = __toModule(require("obsidian"));
init_api();
var SystemSculptContextMenu = class {
  constructor(app, sculptService, plugin) {
    this.statusBarItem = null;
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
    this.app = app;
    this.sculptService = sculptService;
    this.plugin = plugin;
    this.transcriptionService = TranscriptionService.getInstance(plugin);
    this.registerContextMenu();
    this.initializeStatusBar();
  }
  initializeStatusBar() {
    this.statusBarItem = this.app.workspace.containerEl.createDiv({
      cls: "systemsculpt-status-bar"
    });
    this.statusBarItem.style.display = "none";
  }
  registerContextMenu() {
    this.app.workspace.on("editor-menu", (menu, editor, view) => {
      if (!(view instanceof import_obsidian29.MarkdownView))
        return;
      const selection = editor.getSelection();
      if (!selection)
        return;
    });
    this.app.workspace.on("file-menu", (menu, file) => {
      if (!(file instanceof import_obsidian29.TFile))
        return;
      const extension = file.extension.toLowerCase();
      if (["md", "txt", "markdown"].includes(extension) || ["pdf", "doc", "docx", "ppt", "pptx", "xls", "xlsx"].includes(extension) || ["mp3", "wav", "m4a", "ogg", "webm"].includes(extension) || ["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Chat with File").setIcon("message-square").onClick(async () => {
            try {
              const leaf = this.app.workspace.getLeaf("tab");
              const view = new ChatView(leaf, this.plugin);
              await leaf.open(view);
              await new Promise((resolve) => setTimeout(resolve, 50));
              this.app.workspace.setActiveLeaf(leaf, { focus: true });
              await view.addFileToContext(file);
            } catch (error) {
              new import_obsidian29.Notice("Failed to open chat with file");
              console.error("Chat open error:", error);
            }
          });
        });
      }
      if (file.extension === "mp3" || file.extension === "wav" || file.extension === "webm") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio").setIcon("microphone").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, false);
            } catch (error) {
              new import_obsidian29.Notice("Failed to transcribe audio file");
              console.error("Transcription error:", error);
            }
          });
        });
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Transcribe Audio (Timestamped)").setIcon("clock").onClick(async () => {
            try {
              await this.handleAudioTranscription(file, true);
            } catch (error) {
              new import_obsidian29.Notice("Failed to transcribe audio file with timestamps");
              console.error("Timestamped transcription error:", error);
            }
          });
        });
      }
      if (file.extension === "pdf" || file.extension === "docx" || file.extension === "doc") {
        menu.addItem((item) => {
          item.setTitle("SystemSculpt - Convert to Markdown").setIcon("file-text").onClick(async () => {
            try {
              await this.handleDocumentConversion(file);
            } catch (error) {
              new import_obsidian29.Notice("Failed to convert document");
              console.error("Document conversion error:", error);
            }
          });
        });
      }
    });
  }
  async handleDocumentConversion(file) {
    this.createProgressModal();
    this.updateProgressModal(0, "Processing your document...", "loader-2");
    try {
      await this.sleep(1e3);
      this.updateProgressModal(10, "Uploading document...", "upload");
      const { documentId, status, cached } = await this.sculptService.uploadDocument(file);
      if (cached) {
        this.updateProgressModal(50, "Found cached version", "check");
        const extractionData2 = await this.downloadExtraction(documentId);
        const extractionPath2 = await this.saveExtractionResults(file, extractionData2);
        this.updateProgressModal(100, "Processing complete!", "check-circle");
        this.showCompletionButtons(extractionPath2);
        return;
      }
      this.updateProgressModal(30, "Processing document...", "loader-2");
      const pollResult = await this.pollUntilComplete(documentId);
      if (!pollResult) {
        this.updateProgressModal(0, "Processing incomplete", "alert-circle");
        await this.sleep(3e3);
        this.closeProgressModal();
        return;
      }
      this.updateProgressModal(80, "Downloading results...", "download");
      const extractionData = await this.downloadExtraction(documentId);
      const extractionPath = await this.saveExtractionResults(file, extractionData);
      this.updateProgressModal(100, "Processing complete!", "check-circle");
      this.showCompletionButtons(extractionPath);
    } catch (e) {
      console.error("SystemSculpt error", e);
      this.updateProgressModal(0, `Error: ${e instanceof Error ? e.message : String(e)}`, "x-circle");
      await this.sleep(5e3);
      this.closeProgressModal();
    }
  }
  async handleAudioTranscription(file, timestamped) {
    try {
      await showAudioTranscriptionModal(this.app, {
        file,
        timestamped,
        plugin: this.plugin,
        onTranscriptionComplete: async (text) => {
          var _a;
          const baseName = file.basename;
          const fileExtension = timestamped ? "srt" : "md";
          const outputPath = `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}.${fileExtension}`;
          const content = timestamped ? text : text;
          let transcriptionFile;
          const existingFile = this.app.vault.getAbstractFileByPath(outputPath);
          if (existingFile instanceof import_obsidian29.TFile) {
            await this.app.vault.modify(existingFile, content);
            transcriptionFile = existingFile;
          } else {
            transcriptionFile = await this.app.vault.create(outputPath, content);
          }
          const leaf = this.app.workspace.getLeaf("tab");
          await leaf.openFile(transcriptionFile);
          this.app.workspace.setActiveLeaf(leaf, { focus: true });
        }
      });
    } catch (error) {
      console.error("Audio transcription error:", error);
      throw error;
    }
  }
  sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  createProgressModal() {
    if (this.progressModal)
      return;
    this.progressModal = document.createElement("div");
    this.progressModal.className = "systemsculpt-progress-modal";
    this.progressBar = this.progressModal.createDiv("systemsculpt-progress-bar");
    this.progressStatus = this.progressModal.createDiv("systemsculpt-progress-status");
    this.progressButtons = this.progressModal.createDiv("systemsculpt-progress-buttons");
    document.body.appendChild(this.progressModal);
  }
  updateProgressModal(progress, status, icon) {
    if (!this.progressModal || !this.progressBar || !this.progressStatus)
      return;
    this.progressBar.style.width = `${progress}%`;
    this.progressStatus.empty();
    (0, import_obsidian29.setIcon)(this.progressStatus, icon);
    this.progressStatus.createSpan({ text: status });
  }
  showCompletionButtons(extractionPath) {
    if (!this.progressButtons)
      return;
    this.progressButtons.empty();
    const viewButton = this.progressButtons.createEl("button", {
      text: "View Result",
      cls: "mod-cta"
    });
    viewButton.addEventListener("click", async () => {
      const file = this.app.vault.getAbstractFileByPath(extractionPath);
      if (file instanceof import_obsidian29.TFile) {
        await this.app.workspace.getLeaf().openFile(file);
      }
      this.closeProgressModal();
    });
    const closeButton = this.progressButtons.createEl("button", {
      text: "Close"
    });
    closeButton.addEventListener("click", () => {
      this.closeProgressModal();
    });
  }
  closeProgressModal() {
    if (this.progressModal && this.progressModal.parentNode) {
      this.progressModal.parentNode.removeChild(this.progressModal);
    }
    this.progressModal = null;
    this.progressBar = null;
    this.progressStatus = null;
    this.progressButtons = null;
  }
  async pollUntilComplete(documentId, maxAttempts = 30) {
    for (let i = 0; i < maxAttempts; i++) {
      const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.GET(documentId)}`, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      if (!response.ok) {
        throw new Error(`Failed to check status: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === "completed") {
        return true;
      } else if (data.status === "failed") {
        throw new Error(data.error || "Processing failed");
      }
      const progress = Math.min(30 + i / maxAttempts * 50, 80);
      this.updateProgressModal(progress, "Processing document...", "loader-2");
      await this.sleep(2e3);
    }
    return false;
  }
  async downloadExtraction(documentId) {
    const response = await fetch(`${this.sculptService.baseUrl}${SYSTEMSCULPT_API_ENDPOINTS.DOCUMENTS.DOWNLOAD(documentId)}`, {
      headers: {
        "Content-Type": "application/json"
      }
    });
    if (!response.ok) {
      throw new Error(`Failed to download extraction: ${response.statusText}`);
    }
    return response.json();
  }
  async saveExtractionResults(file, data) {
    var _a;
    const extractionFolder = this.sculptService.extractionsDirectory;
    const baseName = this.sanitizeFilename(file.basename);
    const parentPath = extractionFolder ? `${extractionFolder}/${baseName}` : `${((_a = file.parent) == null ? void 0 : _a.path) || ""}/${baseName}`;
    await this.createFolder(parentPath);
    const extractionPath = this.normalizePath(`${parentPath}/${baseName}-extraction.md`);
    const content = this.formatExtractionContent(data);
    const existingFile = this.app.vault.getAbstractFileByPath(extractionPath);
    if (existingFile instanceof import_obsidian29.TFile) {
      await this.app.vault.modify(existingFile, content);
    } else {
      await this.app.vault.create(extractionPath, content);
    }
    return extractionPath;
  }
  sanitizeFilename(filename) {
    return filename.replace(/[^a-zA-Z0-9-_ ]/g, "");
  }
  normalizePath(path) {
    return path.replace(/\\/g, "/").replace(/\/+/g, "/");
  }
  async createFolder(path) {
    const normalizedPath = this.normalizePath(path);
    if (!(this.app.vault.getAbstractFileByPath(normalizedPath) instanceof import_obsidian29.TFolder)) {
      await this.app.vault.createFolder(normalizedPath);
    }
  }
  formatExtractionContent(data) {
    return `# ${data.title || "Document Extraction"}

${data.content || ""}

---
Extracted with SystemSculpt
`;
  }
};

// src/core/settings/SettingsManager.ts
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.settings = DEFAULT_SETTINGS;
  }
  async loadSettings() {
    const loadedData = await this.plugin.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
    if (this.settings.developmentMode) {
      this.settings.serverUrl = "http://localhost:3001";
    } else {
      this.settings.serverUrl = "https://api.systemsculpt.com";
    }
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
    this.plugin.aiService.updateSettings(this.settings);
  }
  getSettings() {
    return this.settings;
  }
  async updateSettings(newSettings) {
    if (newSettings === DEFAULT_SETTINGS) {
      this.settings = { ...DEFAULT_SETTINGS };
      await this.saveSettings();
      return;
    }
    if (newSettings.developmentMode !== void 0) {
      newSettings.serverUrl = newSettings.developmentMode ? "http://localhost:3001" : "https://api.systemsculpt.com";
    }
    this.settings = { ...this.settings, ...newSettings };
    await this.saveSettings();
  }
};

// src/core/license/LicenseManager.ts
var import_obsidian30 = __toModule(require("obsidian"));
init_ui();
var _LicenseManager = class {
  constructor(plugin, app) {
    this.lastValidationTime = 0;
    this.plugin = plugin;
    this.app = app;
  }
  async initializeLicense() {
    var _a;
    if (!((_a = this.plugin.settings.licenseKey) == null ? void 0 : _a.trim())) {
      return;
    }
    const now = Date.now();
    const shouldValidate = !this.lastValidationTime || now - this.lastValidationTime > _LicenseManager.VALIDATION_INTERVAL;
    if (shouldValidate) {
      this.validateLicenseKey(true, false).then((isValid) => {
        if (!isValid && this.plugin.settings.licenseValid) {
          new import_obsidian30.Notice("Your SystemSculpt Pro license is no longer valid. Some features may be unavailable.", 5e3);
        }
      }).catch((error) => {
        console.warn("[SystemSculpt] Background license validation failed:", error);
      });
    }
  }
  async validateLicenseKey(force = false, showReloadPrompt = true) {
    if (!this.plugin.settings.licenseKey) {
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
    try {
      const isValid = await this.plugin.aiService.validateLicense(force);
      this.plugin.settings.licenseValid = isValid;
      await this.plugin.saveSettings();
      if (isValid) {
        this.lastValidationTime = Date.now();
        if (showReloadPrompt) {
          const result = await showPopup(this.app, "Pro features have been successfully activated! To ensure all features work properly, Obsidian needs to be reloaded.", {
            title: "Reload to Complete Upgrade",
            description: "Click the button below to reload Obsidian and start using your Pro features.",
            primaryButton: "Reload & Upgrade",
            icon: "sparkles"
          });
          if (result == null ? void 0 : result.confirmed) {
            window.location.reload();
          }
        }
      }
      return isValid;
    } catch (error) {
      console.error("License validation error:", error);
      this.plugin.settings.licenseValid = false;
      await this.plugin.saveSettings();
      return false;
    }
  }
};
var LicenseManager = _LicenseManager;
LicenseManager.VALIDATION_INTERVAL = 24 * 60 * 60 * 1e3;

// src/modals/JanitorModal.ts
var import_obsidian31 = __toModule(require("obsidian"));
init_ui();
var JanitorModal = class extends import_obsidian31.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  calculateSize(files) {
    const totalBytes = files.reduce((acc, file) => acc + file.stat.size, 0);
    if (totalBytes === 0) {
      return "empty";
    } else if (totalBytes < 1024) {
      return `${totalBytes} bytes`;
    } else if (totalBytes < 1024 * 1024) {
      return `${(totalBytes / 1024).toFixed(1)} KB`;
    } else if (totalBytes < 1024 * 1024 * 1024) {
      return `${(totalBytes / (1024 * 1024)).toFixed(1)} MB`;
    } else {
      return `${(totalBytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;
    }
  }
  getFilesInDirectory(directory) {
    return this.app.vault.getFiles().filter((file) => file.path.startsWith(directory));
  }
  disableButton(button) {
    button.disabled = true;
    button.addClass("mod-disabled");
    button.removeClass("mod-warning");
  }
  updateButtonState(button, files, type) {
    const size = this.calculateSize(files);
    const hasFiles = files.length > 0;
    if (hasFiles) {
      button.disabled = false;
      button.removeClass("mod-disabled");
      button.addClass("mod-warning");
      button.setText(`Clear All ${type} (${size})`);
    } else {
      button.disabled = true;
      button.addClass("mod-disabled");
      button.removeClass("mod-warning");
      button.setText(`No ${type}`);
    }
  }
  async cleanDirectory(directory) {
    if (!directory || directory === "/" || directory === "." || directory === "..") {
      throw new Error("Cannot delete root or system directories");
    }
    const files = this.getFilesInDirectory(directory);
    for (const file of files) {
      await this.app.vault.trash(file, true);
    }
    const folder = this.app.vault.getAbstractFileByPath(directory);
    if (folder instanceof import_obsidian31.TFolder) {
      const subdirs = folder.children.filter((child) => child instanceof import_obsidian31.TFolder).sort((a, b) => b.path.length - a.path.length);
      for (const subdir of subdirs) {
        if (subdir.children.length === 0) {
          await this.app.vault.trash(subdir, true);
        }
      }
      if (folder.children.length === 0) {
        await this.app.vault.trash(folder, true);
      }
    }
  }
  showFilePreview(files, type) {
    var _a, _b;
    const container = document.createElement("div");
    container.className = "systemsculpt-file-tree nav-folder";
    const summary = document.createElement("div");
    summary.className = "nav-folder-title";
    summary.textContent = `${files.length} ${type} (${this.calculateSize(files)})`;
    container.appendChild(summary);
    const sortedFiles = files.sort((a, b) => a.path.localeCompare(b.path));
    const filesByDir = new Map();
    for (const file of sortedFiles) {
      const dir = ((_a = file.parent) == null ? void 0 : _a.path) || "";
      if (!filesByDir.has(dir)) {
        filesByDir.set(dir, []);
      }
      (_b = filesByDir.get(dir)) == null ? void 0 : _b.push(file);
    }
    for (const [dir, dirFiles] of filesByDir) {
      if (dir) {
        const folderDiv = document.createElement("div");
        folderDiv.className = "nav-folder";
        const folderTitle = document.createElement("div");
        folderTitle.className = "nav-folder-title";
        (0, import_obsidian31.setIcon)(folderTitle, "folder");
        folderTitle.createSpan({ text: dir });
        folderDiv.appendChild(folderTitle);
        const folderContent = document.createElement("div");
        folderContent.className = "nav-folder-children";
        folderDiv.appendChild(folderContent);
        for (const file of dirFiles) {
          folderContent.appendChild(this.createFileItem(file));
        }
        container.appendChild(folderDiv);
      } else {
        for (const file of dirFiles) {
          container.appendChild(this.createFileItem(file));
        }
      }
    }
    return container;
  }
  createFileItem(file) {
    const fileDiv = document.createElement("div");
    fileDiv.className = "nav-file";
    const fileTitle = document.createElement("div");
    fileTitle.className = "nav-file-title";
    const extension = file.extension.toLowerCase();
    let iconName = "file";
    if (["md", "txt", "markdown"].includes(extension)) {
      iconName = "file-text";
    } else if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(extension)) {
      iconName = "image";
    } else if (["mp3", "wav", "ogg", "m4a"].includes(extension)) {
      iconName = "audio-lines";
    } else if (["pdf"].includes(extension)) {
      iconName = "file-text";
    }
    (0, import_obsidian31.setIcon)(fileTitle, iconName);
    fileTitle.createSpan({ text: file.name });
    const sizeSpan = document.createElement("span");
    sizeSpan.className = "nav-file-size";
    sizeSpan.textContent = this.calculateSize([file]);
    fileTitle.appendChild(sizeSpan);
    fileDiv.appendChild(fileTitle);
    return fileDiv;
  }
  async showConfirmationDialog(files, type, directory, button) {
    const confirmModal = new import_obsidian31.Modal(this.app);
    confirmModal.titleEl.setText(`Clear ${type}`);
    const content = confirmModal.contentEl;
    content.createDiv({
      cls: "systemsculpt-modal-description",
      text: `\u26A0\uFE0F WARNING: The following files will be moved to the Obsidian trash. You can restore them from the trash if needed.`
    });
    content.appendChild(this.showFilePreview(files, type));
    const buttonContainer = content.createDiv({
      cls: "systemsculpt-modal-buttons"
    });
    const cancelButton = buttonContainer.createEl("button", { text: "Cancel" });
    cancelButton.addEventListener("click", () => confirmModal.close());
    const confirmButton = buttonContainer.createEl("button", {
      cls: "mod-warning",
      text: "Move to Trash"
    });
    confirmButton.addEventListener("click", async () => {
      try {
        await this.cleanDirectory(directory);
        this.disableButton(button);
        button.setText(`No ${type}`);
        showPopup(this.app, `Successfully moved ${files.length} ${type.toLowerCase()} files (${this.calculateSize(files)}) to trash`, { title: "Success" });
      } catch (error) {
        console.error(`Error clearing ${type.toLowerCase()}:`, error);
        showPopup(this.app, `Failed to clear ${type.toLowerCase()}`, {
          title: "Error"
        });
      }
      confirmModal.close();
    });
    confirmModal.open();
  }
  async isEmptyFile(file) {
    if (file.stat.size === 0)
      return true;
    const extension = file.extension.toLowerCase();
    if (["md", "txt", "markdown"].includes(extension)) {
      const content = await this.app.vault.read(file);
      const contentWithoutFrontmatter = content.replace(/^---[\s\S]*?---/, "").trim();
      return !contentWithoutFrontmatter;
    }
    if ([
      "jpg",
      "jpeg",
      "png",
      "gif",
      "webp",
      "svg",
      "mp3",
      "wav",
      "ogg",
      "m4a"
    ].includes(extension)) {
      return file.stat.size === 0;
    }
    if (file.path.includes("/Extractions/")) {
      const content = await this.app.vault.read(file);
      const hasOnlyHeaders = !content.replace(/^#.*$/gm, "").trim();
      const hasErrorMessage = content.includes("Error extracting") || content.includes("Processing failed");
      return hasOnlyHeaders || hasErrorMessage;
    }
    return false;
  }
  async getEmptyFiles() {
    const allFiles = this.app.vault.getFiles();
    const emptyFiles = [];
    for (const file of allFiles) {
      if (await this.isEmptyFile(file)) {
        emptyFiles.push(file);
      }
    }
    return emptyFiles;
  }
  async getEmptyFolders() {
    const emptyFolders = [];
    const checkFolder = (folder) => {
      const hasNonEmptyChildren = folder.children.some((child) => {
        if (child instanceof import_obsidian31.TFile) {
          return child.stat.size > 0;
        }
        if (child instanceof import_obsidian31.TFolder) {
          return !checkFolder(child);
        }
        return false;
      });
      if (!hasNonEmptyChildren) {
        emptyFolders.push(folder);
        return true;
      }
      return false;
    };
    const rootFolder = this.app.vault.getRoot();
    for (const child of rootFolder.children) {
      if (child instanceof import_obsidian31.TFolder) {
        checkFolder(child);
      }
    }
    return emptyFolders;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-janitor-modal");
    const titleEl = contentEl.createDiv({ cls: "systemsculpt-modal-title" });
    titleEl.setText("SystemSculpt Janitor");
    const descriptionEl = titleEl.createDiv({
      cls: "systemsculpt-modal-description"
    });
    descriptionEl.setText("Clean up and optimize your SystemSculpt workspace");
    const mainContent = contentEl.createDiv({
      cls: "systemsculpt-janitor-content"
    });
    const sectionsContainer = mainContent.createDiv({
      cls: "systemsculpt-sections-container"
    });
    this.createEmptyContentSection(sectionsContainer);
    this.createChatHistorySection(sectionsContainer);
    this.createExtractionsSection(sectionsContainer);
    this.createRecordingsSection(sectionsContainer);
  }
  async createEmptyContentSection(container) {
    const emptySection = this.createSection(container, "Empty Content", "Clean up empty files and folders");
    const emptyFiles = await this.getEmptyFiles();
    const emptyFolders = await this.getEmptyFolders();
    const totalEmpty = emptyFiles.length + emptyFolders.length;
    const clearEmptyButton = emptySection.createEl("button", {
      cls: "systemsculpt-button",
      text: totalEmpty > 0 ? `Clear Empty Content (${totalEmpty} items)` : "No Empty Content"
    });
    this.updateButtonState(clearEmptyButton, emptyFiles, "Empty Content");
    if (totalEmpty > 0) {
      clearEmptyButton.addEventListener("click", async () => {
        if (clearEmptyButton.disabled)
          return;
        const confirmModal = new import_obsidian31.Modal(this.app);
        confirmModal.titleEl.setText("Clear Empty Content");
        const content = confirmModal.contentEl;
        content.createDiv({
          cls: "systemsculpt-modal-description",
          text: `\u26A0\uFE0F WARNING: The following empty items will be moved to the Obsidian trash. You can restore them from the trash if needed.`
        });
        if (emptyFiles.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Files"
          });
          content.appendChild(this.showFilePreview(emptyFiles, "Empty Files"));
        }
        if (emptyFolders.length > 0) {
          content.createDiv({
            cls: "systemsculpt-section-header",
            text: "Empty Folders"
          });
          const folderList = content.createDiv({
            cls: "systemsculpt-file-tree nav-folder"
          });
          for (const folder of emptyFolders) {
            const folderItem = folderList.createDiv({
              cls: "nav-folder-title"
            });
            (0, import_obsidian31.setIcon)(folderItem, "folder");
            folderItem.createSpan({ text: folder.path });
          }
        }
        const buttonContainer = content.createDiv({
          cls: "systemsculpt-modal-buttons"
        });
        const cancelButton = buttonContainer.createEl("button", {
          text: "Cancel"
        });
        cancelButton.addEventListener("click", () => confirmModal.close());
        const confirmButton = buttonContainer.createEl("button", {
          cls: "mod-warning",
          text: "Move to Trash"
        });
        confirmButton.addEventListener("click", async () => {
          try {
            for (const file of emptyFiles) {
              await this.app.vault.trash(file, true);
            }
            const sortedFolders = emptyFolders.sort((a, b) => b.path.length - a.path.length);
            for (const folder of sortedFolders) {
              await this.app.vault.trash(folder, true);
            }
            this.disableButton(clearEmptyButton);
            clearEmptyButton.setText("No Empty Content");
            showPopup(this.app, `Successfully moved ${totalEmpty} empty items to trash`, { title: "Success" });
          } catch (error) {
            console.error("Error clearing empty content:", error);
            showPopup(this.app, "Failed to clear empty content", {
              title: "Error"
            });
          }
          confirmModal.close();
        });
        confirmModal.open();
      });
    }
  }
  createChatHistorySection(container) {
    const historySection = this.createSection(container, "Chat History", "Delete all chat history and conversations permanently");
    const chatFiles = this.getFilesInDirectory(this.plugin.settings.chatsDirectory);
    const chatSize = this.calculateSize(chatFiles);
    const hasChatFiles = chatFiles.length > 0;
    const clearHistoryButton = historySection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasChatFiles ? `Clear All Chat History (${chatSize})` : "No Chat History"
    });
    this.updateButtonState(clearHistoryButton, chatFiles, "Chat History");
    if (hasChatFiles) {
      clearHistoryButton.addEventListener("click", async () => {
        if (clearHistoryButton.disabled)
          return;
        await this.showConfirmationDialog(chatFiles, "Chat History", this.plugin.settings.chatsDirectory, clearHistoryButton);
      });
    }
  }
  createExtractionsSection(container) {
    const extractionsSection = this.createSection(container, "Document Extractions", "Delete all extracted document content (PDFs, documents, etc.)");
    const extractionFiles = this.getFilesInDirectory(this.plugin.settings.extractionsDirectory);
    const extractionsSize = this.calculateSize(extractionFiles);
    const hasExtractionFiles = extractionFiles.length > 0;
    const clearExtractionsButton = extractionsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasExtractionFiles ? `Clear All Extractions (${extractionsSize})` : "No Extractions"
    });
    this.updateButtonState(clearExtractionsButton, extractionFiles, "Extractions");
    if (hasExtractionFiles) {
      clearExtractionsButton.addEventListener("click", async () => {
        if (clearExtractionsButton.disabled)
          return;
        await this.showConfirmationDialog(extractionFiles, "Extractions", this.plugin.settings.extractionsDirectory, clearExtractionsButton);
      });
    }
  }
  createRecordingsSection(container) {
    const recordingsSection = this.createSection(container, "Audio Recordings", "Delete all audio recordings (this won't affect transcriptions)");
    const recordingFiles = this.getFilesInDirectory(this.plugin.settings.recordingsDirectory);
    const recordingsSize = this.calculateSize(recordingFiles);
    const hasRecordingFiles = recordingFiles.length > 0;
    const clearRecordingsButton = recordingsSection.createEl("button", {
      cls: "systemsculpt-button",
      text: hasRecordingFiles ? `Clear All Recordings (${recordingsSize})` : "No Recordings"
    });
    this.updateButtonState(clearRecordingsButton, recordingFiles, "Recordings");
    if (hasRecordingFiles) {
      clearRecordingsButton.addEventListener("click", async () => {
        if (clearRecordingsButton.disabled)
          return;
        await this.showConfirmationDialog(recordingFiles, "Recordings", this.plugin.settings.recordingsDirectory, clearRecordingsButton);
      });
    }
  }
  createSection(container, title, description) {
    const section = container.createDiv({
      cls: "systemsculpt-janitor-section"
    });
    const header = section.createDiv({ cls: "systemsculpt-section-header" });
    header.setText(title);
    const desc = section.createDiv({ cls: "systemsculpt-section-description" });
    desc.setText(description);
    return section;
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/LoadChatModal.ts
var import_obsidian32 = __toModule(require("obsidian"));
init_SystemPromptService();
var LoadChatModal = class extends import_obsidian32.Modal {
  constructor(app, plugin) {
    super(app);
    this.chatItems = [];
    this.flattenedItems = [];
    this.selectedChatId = null;
    this.selectedCardIndex = 0;
    this.chatCards = [];
    this.currentSearchResults = [];
    this.isKeyboardNavActive = false;
    this.batchSize = 20;
    this.currentBatch = 0;
    this.isLoading = false;
    this.cardCache = new Map();
    this.getSearchableFields = (chat) => {
      return [
        { field: "title", text: chat.title, weight: 200 },
        { field: "content", text: chat.messages.map((m) => this.getMessageContent(m)).join(" "), weight: 100 }
      ];
    };
    this.plugin = plugin;
    this.searchService = new SearchService();
    this.chatStorage = new ChatStorageService(app, plugin.settings.chatsDirectory);
    this.setupVirtualScroller();
  }
  setupVirtualScroller() {
    this.virtualScroller = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !this.isLoading) {
          this.loadNextBatch();
        }
      });
    }, {
      root: null,
      rootMargin: "100px",
      threshold: 0.1
    });
  }
  async loadNextBatch() {
    if (this.isLoading || this.currentBatch * this.batchSize >= this.currentSearchResults.length) {
      return;
    }
    this.isLoading = true;
    const start = this.currentBatch * this.batchSize;
    const end = Math.min(start + this.batchSize, this.currentSearchResults.length);
    const batch = this.currentSearchResults.slice(start, end);
    const fragment = document.createDocumentFragment();
    const sectionsContainer = fragment.createDiv({
      cls: "systemsculpt-chat-sections-container"
    });
    await Promise.all(batch.map(async (result) => {
      await this.renderChatCard(result.item, result.matches || [], sectionsContainer);
    }));
    this.chatGrid.appendChild(fragment);
    this.currentBatch++;
    this.isLoading = false;
    if (end < this.currentSearchResults.length) {
      const sentinel = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-sentinel"
      });
      this.virtualScroller.observe(sentinel);
    }
  }
  async flattenChatItem(item) {
    const modelName = await this.getModelName(item.selectedModelId);
    const promptLabel = await this.getPromptLabel(item);
    const lastMessage = item.messages[item.messages.length - 1];
    const messageContent = item.messages.map((msg) => this.getMessageContent(msg)).join("\n");
    return {
      id: item.id,
      searchText: `${messageContent} ${modelName} ${promptLabel}`.toLowerCase(),
      modelName,
      promptLabel,
      lastMessage: lastMessage ? this.getMessageContent(lastMessage) : "",
      messageContent,
      item
    };
  }
  createProgressModal() {
    const { contentEl } = this;
    this.progressContainer = contentEl.createDiv({
      cls: "systemsculpt-progress-overlay"
    });
    const statusContainer = this.progressContainer.createDiv({
      cls: "systemsculpt-progress-status"
    });
    const statusIcon = statusContainer.createDiv({
      cls: "systemsculpt-progress-status-icon"
    });
    (0, import_obsidian32.setIcon)(statusIcon, "loader-2");
    this.progressText = statusContainer.createSpan({
      text: "Loading chats..."
    });
  }
  updateProgress(current, total) {
    if (current === total) {
      this.progressContainer.remove();
    }
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("systemsculpt-chat-modal");
    this.createProgressModal();
    try {
      const chats = await this.chatStorage.loadChats();
      this.chatItems = chats.sort((a, b) => b.lastModified - a.lastModified);
      this.flattenedItems = await Promise.all(this.chatItems.map(async (item, index) => {
        const flatItem = await this.flattenChatItem(item);
        this.updateProgress(index + 1, this.chatItems.length);
        return flatItem;
      }));
    } catch (error) {
      console.error("Failed to load chats:", error);
      this.chatItems = [];
      this.flattenedItems = [];
    }
    const searchContainer = contentEl.createDiv({
      cls: "systemsculpt-chat-search"
    });
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "Search chats..."
    });
    this.chatGrid = contentEl.createDiv({ cls: "systemsculpt-chat-grid" });
    await this.renderChats(this.flattenedItems.map((item) => ({
      item: item.item,
      matches: [],
      score: 0
    })));
    const buttonContainer = contentEl.createDiv({
      cls: "systemsculpt-button-container"
    });
    const newChatButton = buttonContainer.createEl("button", {
      cls: "systemsculpt-button",
      text: "Open New Chat Instead"
    });
    newChatButton.addEventListener("click", () => this.openNewChat());
    this.setupEventListeners();
    this.containerEl.style.display = "";
    this.searchInput.focus();
  }
  async handleChatSelection(chatId) {
    try {
      const chatData = await this.chatStorage.loadChat(chatId);
      if (!chatData) {
        console.error("Failed to load chat data for:", chatId);
        return;
      }
      const leaf = this.app.workspace.getLeaf("tab");
      const view = new ChatView(leaf, this.plugin);
      await view.setState({
        chatId,
        chatTitle: chatData.title || chatId,
        selectedModelId: chatData.selectedModelId
      });
      await leaf.open(view);
      this.app.workspace.setActiveLeaf(leaf, { focus: true });
      this.close();
    } catch (error) {
      console.error("Failed to load chat:", error);
      this.close();
    }
  }
  setupEventListeners() {
    this.searchInput.addEventListener("input", () => {
      const query = this.searchInput.value;
      if (!query) {
        this.currentSearchResults = this.flattenedItems.map((item) => ({
          item: item.item,
          matches: [],
          score: 0
        }));
        this.selectedCardIndex = 0;
        this.isKeyboardNavActive = false;
        this.renderChats(this.currentSearchResults);
        return;
      }
      if (query.length < 3) {
        this.chatGrid.empty();
        this.chatCards = [];
        this.selectedCardIndex = 0;
        this.isKeyboardNavActive = false;
        const messageEl = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        messageEl.setText(`Please enter at least 3 characters to search (${query.length}/3)`);
        return;
      }
      const searchTerms = query.toLowerCase().split(/\s+/).filter(Boolean);
      const results = this.flattenedItems.map((flatItem) => {
        const allTermsExist = searchTerms.every((term) => flatItem.searchText.includes(term));
        if (!allTermsExist) {
          return { item: flatItem.item, matches: [], score: 0 };
        }
        let score = 0;
        const matches = [];
        searchTerms.forEach((term) => {
          let pos = 0;
          while ((pos = flatItem.searchText.indexOf(term, pos)) !== -1) {
            score += 1;
            matches.push({
              field: "content",
              text: flatItem.searchText.slice(Math.max(0, pos - 20), pos + term.length + 20),
              indices: [pos],
              matchQuality: 1
            });
            pos += 1;
          }
        });
        if (flatItem.searchText.includes(query.toLowerCase())) {
          score *= 2;
        }
        return {
          item: flatItem.item,
          matches,
          score
        };
      }).filter((result) => result.score > 0).sort((a, b) => {
        if (b.score !== a.score) {
          return b.score - a.score;
        }
        return b.item.lastModified - a.item.lastModified;
      });
      this.currentSearchResults = results;
      this.selectedCardIndex = 0;
      this.isKeyboardNavActive = false;
      this.renderChats(results);
    });
    this.searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        if (this.chatCards.length === 0)
          return;
        if (!this.isKeyboardNavActive) {
          this.isKeyboardNavActive = true;
          this.selectedCardIndex = 0;
        } else {
          if (e.shiftKey) {
            this.selectedCardIndex = (this.selectedCardIndex - 1 + this.chatCards.length) % this.chatCards.length;
          } else {
            this.selectedCardIndex = (this.selectedCardIndex + 1) % this.chatCards.length;
          }
        }
        this.updateSelectedCard();
      } else if (e.key === "Enter" && this.isKeyboardNavActive && this.chatCards.length > 0) {
        e.preventDefault();
        const selectedCard = this.chatCards[this.selectedCardIndex];
        if (selectedCard == null ? void 0 : selectedCard.dataset.chatId) {
          this.handleChatSelection(selectedCard.dataset.chatId);
        }
      } else if (e.key === "Escape") {
        if (this.isKeyboardNavActive) {
          e.preventDefault();
          this.isKeyboardNavActive = false;
          this.updateSelectedCard();
        }
      }
    });
    this.contentEl.addEventListener("click", (e) => {
      const card = e.target.closest(".systemsculpt-chat-card");
      if (card == null ? void 0 : card.dataset.chatId) {
        this.handleChatSelection(card.dataset.chatId);
      }
      if (this.isKeyboardNavActive) {
        this.isKeyboardNavActive = false;
        this.updateSelectedCard();
      }
    });
  }
  renderChats(searchResults) {
    var _a;
    if (!this.chatGrid)
      return;
    this.chatGrid.empty();
    this.chatCards = [];
    this.currentBatch = 0;
    this.selectedCardIndex = 0;
    const srMap = new Map(searchResults.map((sr) => [sr.item.id, sr.matches || []]));
    const favorites = [];
    const nonFavorites = [];
    searchResults.forEach((sr) => {
      if (this.plugin.settings.favoriteChats.includes(sr.item.id)) {
        favorites.push(sr.item);
      } else {
        nonFavorites.push(sr.item);
      }
    });
    if (favorites.length > 0) {
      const header = this.chatGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      header.createSpan({ text: "Favorites" });
      favorites.sort((a, b) => b.lastModified - a.lastModified);
      favorites.forEach((chat) => {
        const matches = srMap.get(chat.id) || [];
        const card = this.renderChatCard(chat, matches);
        if (card) {
          this.chatGrid.appendChild(card);
        }
      });
    }
    if (nonFavorites.length > 0) {
      const recentHeader = this.chatGrid.createDiv({
        cls: "systemsculpt-provider-header"
      });
      recentHeader.createSpan({ text: "Recent Chats" });
      nonFavorites.sort((a, b) => b.lastModified - a.lastModified);
      nonFavorites.forEach((chat) => {
        const matches = srMap.get(chat.id) || [];
        const card = this.renderChatCard(chat, matches);
        if (card) {
          this.chatGrid.appendChild(card);
        }
      });
    }
    if (favorites.length === 0 && nonFavorites.length === 0) {
      if ((_a = this.searchInput) == null ? void 0 : _a.value) {
        const emptyState = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        emptyState.setText("No chats found matching your search.");
      } else {
        const emptyState = this.chatGrid.createDiv({
          cls: "systemsculpt-chat-empty"
        });
        emptyState.setText("No chat history found.");
      }
    }
    if (this.virtualScroller) {
      const sentinel = this.chatGrid.createDiv({
        cls: "systemsculpt-chat-sentinel"
      });
      this.virtualScroller.observe(sentinel);
    }
    if (this.isKeyboardNavActive && this.chatCards.length > 0) {
      this.updateSelectedCard();
    }
  }
  attachCardEventListeners(card, item) {
    const favoriteButton = card.querySelector(".systemsculpt-favorite-button");
    if (favoriteButton) {
      favoriteButton.addEventListener("click", async (e) => {
        var _a;
        e.stopPropagation();
        const target = e.target;
        const chatCard = target.closest(".systemsculpt-chat-card");
        if (!chatCard)
          return;
        const isFavorite = !this.plugin.settings.favoriteChats.includes(item.id);
        favoriteButton.classList.toggle("is-favorite", isFavorite);
        favoriteButton.setAttribute("aria-label", isFavorite ? "Remove from favorites" : "Add to favorites");
        if (!Array.isArray(this.plugin.settings.favoriteChats)) {
          this.plugin.settings.favoriteChats = [];
        }
        if (isFavorite) {
          if (!this.plugin.settings.favoriteChats.includes(item.id)) {
            this.plugin.settings.favoriteChats.push(item.id);
          }
        } else {
          this.plugin.settings.favoriteChats = this.plugin.settings.favoriteChats.filter((id) => id !== item.id);
        }
        await this.plugin.saveSettings();
        if (isFavorite) {
          let favoritesHeader2 = this.chatGrid.querySelector(".systemsculpt-provider-header");
          if (!favoritesHeader2 || !((_a = favoritesHeader2.textContent) == null ? void 0 : _a.includes("Favorites"))) {
            favoritesHeader2 = this.chatGrid.createDiv({ cls: "systemsculpt-provider-header" });
            favoritesHeader2.createSpan({ text: "Favorites" });
            this.chatGrid.insertBefore(favoritesHeader2, this.chatGrid.firstChild);
          }
          const nextElement = Array.from(this.chatGrid.children).find((el, index) => {
            if (index <= 1)
              return false;
            return !this.plugin.settings.favoriteChats.includes(el.dataset.chatId || "");
          });
          if (nextElement) {
            this.chatGrid.insertBefore(chatCard, nextElement);
          } else {
            const recentHeader2 = Array.from(this.chatGrid.children).find((el) => {
              var _a2;
              return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
            });
            this.chatGrid.insertBefore(chatCard, recentHeader2 || null);
          }
        } else {
          let recentHeader2 = Array.from(this.chatGrid.children).find((el) => {
            var _a2;
            return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
          });
          if (!recentHeader2) {
            recentHeader2 = this.chatGrid.createDiv({ cls: "systemsculpt-provider-header" });
            recentHeader2.createSpan({ text: "Recent Chats" });
            this.chatGrid.appendChild(recentHeader2);
          }
          if (recentHeader2.nextSibling) {
            this.chatGrid.insertBefore(chatCard, recentHeader2.nextSibling);
          } else {
            this.chatGrid.appendChild(chatCard);
          }
        }
        const favoritesHeader = this.chatGrid.querySelector(".systemsculpt-provider-header");
        const recentHeader = Array.from(this.chatGrid.children).find((el) => {
          var _a2;
          return el.classList.contains("systemsculpt-provider-header") && ((_a2 = el.textContent) == null ? void 0 : _a2.includes("Recent Chats"));
        });
        if (favoritesHeader && !this.plugin.settings.favoriteChats.length) {
          favoritesHeader.remove();
        }
        if (recentHeader) {
          const hasRecentChats = Array.from(this.chatGrid.children).some((el) => el.classList.contains("systemsculpt-chat-card") && !this.plugin.settings.favoriteChats.includes(el.dataset.chatId || ""));
          if (!hasRecentChats) {
            recentHeader.remove();
          }
        }
      });
    }
  }
  renderChatCard(item, matches = [], sectionsContainer) {
    var _a;
    const cachedCard = this.cardCache.get(item.id);
    if (cachedCard) {
      const card2 = cachedCard.cloneNode(true);
      if (matches.length > 0) {
        this.updateCardHighlights(card2, matches);
      }
      this.attachCardEventListeners(card2, item);
      card2.dataset.chatId = item.id;
      this.chatCards.push(card2);
      return card2;
    }
    const flatItem = this.flattenedItems.find((f) => f.id === item.id);
    if (!flatItem)
      return document.createElement("div");
    const isSelected = this.isKeyboardNavActive && this.chatCards.length === this.selectedCardIndex;
    const card = document.createElement("div");
    card.className = `systemsculpt-chat-card ${item.id === this.selectedChatId ? "selected" : ""} ${isSelected ? "systemsculpt-keyboard-selected" : ""}`;
    card.dataset.chatId = item.id;
    this.chatCards.push(card);
    const favoriteButton = card.createDiv({
      cls: `systemsculpt-favorite-button ${this.plugin.settings.favoriteChats.includes(item.id) ? "is-favorite" : ""}`,
      attr: {
        "aria-label": this.plugin.settings.favoriteChats.includes(item.id) ? "Remove from favorites" : "Add to favorites",
        role: "button"
      }
    });
    (0, import_obsidian32.setIcon)(favoriteButton, "star");
    const header = card.createDiv({ cls: "systemsculpt-chat-card-header" });
    const leftContainer = header.createDiv({ cls: "systemsculpt-chat-header-left" });
    const modelBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
    (0, import_obsidian32.setIcon)(modelBadge, "bot");
    modelBadge.appendText(flatItem.modelName);
    const promptBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
    (0, import_obsidian32.setIcon)(promptBadge, "command");
    promptBadge.appendText(flatItem.promptLabel);
    if (item.context_files && item.context_files.length > 0) {
      const docBadge = leftContainer.createDiv({ cls: "systemsculpt-chat-badge" });
      (0, import_obsidian32.setIcon)(docBadge, "file-text");
      docBadge.appendText(`${item.context_files.length} Document${item.context_files.length > 1 ? "s" : ""}`);
    }
    const preview = card.createDiv({ cls: "systemsculpt-chat-preview" });
    if (matches.length > 0) {
      const searchQuery = (_a = this.searchInput) == null ? void 0 : _a.value;
      const searchTerms = (searchQuery == null ? void 0 : searchQuery.toLowerCase().split(/\s+/).filter(Boolean)) || [];
      const contextText = this.getMatchContext(flatItem.messageContent, matches, searchTerms);
      preview.appendChild(this.searchService.highlightText(contextText, matches, searchQuery));
    } else {
      preview.appendText(flatItem.lastMessage);
    }
    const meta = card.createDiv({ cls: "systemsculpt-chat-meta" });
    const dateEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian32.setIcon)(dateEl, "calendar");
    dateEl.createSpan({ text: this.formatDate(item.lastModified) });
    const messagesEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian32.setIcon)(messagesEl, "message-square");
    messagesEl.createSpan({ text: `${item.messages.length} message${item.messages.length !== 1 ? "s" : ""}` });
    const titleEl = meta.createDiv({ cls: "systemsculpt-chat-info" });
    (0, import_obsidian32.setIcon)(titleEl, "file");
    titleEl.createSpan({ text: item.title });
    this.attachCardEventListeners(card, item);
    this.cardCache.set(item.id, card.cloneNode(true));
    return card;
  }
  updateCardHighlights(card, matches) {
    var _a;
    const preview = card.querySelector(".systemsculpt-chat-preview");
    if (!preview)
      return;
    const searchQuery = (_a = this.searchInput) == null ? void 0 : _a.value;
    const searchTerms = (searchQuery == null ? void 0 : searchQuery.toLowerCase().split(/\s+/).filter(Boolean)) || [];
    const flatItem = this.flattenedItems.find((f) => f.id === card.dataset.chatId);
    if (!flatItem)
      return;
    const contextText = this.getMatchContext(flatItem.messageContent, matches, searchTerms);
    preview.innerHTML = "";
    preview.appendChild(this.searchService.highlightText(contextText, matches, searchQuery));
  }
  formatDate(timestamp) {
    return new Date(timestamp).toLocaleString();
  }
  getMessageContent(message) {
    if (typeof message.content === "string") {
      return message.content;
    }
    return "Image message";
  }
  async getModelName(modelId) {
    try {
      const models = await this.plugin.modelService.getModels();
      if (!models)
        return modelId;
      const model = models.find((m) => m.id === modelId || m.identifier && `${m.identifier.providerId}/${m.identifier.modelId}` === modelId);
      if (model == null ? void 0 : model.identifier) {
        return model.identifier.displayName || model.identifier.modelId;
      }
      return (model == null ? void 0 : model.name) || modelId;
    } catch (error) {
      console.error("Failed to get model name:", error);
      return modelId;
    }
  }
  async getPromptLabel(item) {
    var _a;
    if (item.customPromptFilePath) {
      return ((_a = item.customPromptFilePath.split("/").pop()) == null ? void 0 : _a.replace(/\.md$/, "")) || "Custom Prompt";
    }
    if (item.systemPromptType) {
      try {
        const systemPromptService = SystemPromptService.getInstance(this.app);
        const preset = await systemPromptService.getSystemPromptById(item.systemPromptType);
        if (preset) {
          return preset.label;
        }
      } catch (error) {
        console.error("Failed to fetch system prompt:", error);
      }
    }
    return "Default";
  }
  updateSelectedCard() {
    this.chatCards.forEach((card, index) => {
      if (index === this.selectedCardIndex && this.isKeyboardNavActive) {
        card.classList.add("systemsculpt-keyboard-selected");
        card.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        card.classList.remove("systemsculpt-keyboard-selected");
      }
    });
  }
  openNewChat() {
    this.close();
    const leaf = this.app.workspace.getLeaf(true);
    leaf.setViewState({
      type: CHAT_VIEW_TYPE,
      state: {
        chatId: "",
        chatTitle: "New Chat"
      }
    });
    this.app.workspace.setActiveLeaf(leaf);
  }
  onClose() {
    if (this.virtualScroller) {
      this.virtualScroller.disconnect();
    }
    const { contentEl } = this;
    contentEl.empty();
  }
  getMatchContext(text, matches, searchTerms) {
    if (!matches.length)
      return text;
    const positions = [];
    searchTerms.forEach((term) => {
      let pos = 0;
      const textLower = text.toLowerCase();
      while ((pos = textLower.indexOf(term, pos)) !== -1) {
        positions.push(pos);
        pos += 1;
      }
    });
    if (!positions.length)
      return text;
    positions.sort((a, b) => a - b);
    const CONTEXT_SIZE = 75;
    let bestStart = positions[0];
    let bestEnd = positions[0];
    let bestSpan = Infinity;
    for (let i = 0; i < positions.length; i++) {
      const start = positions[i];
      let end = start;
      let matchCount = 1;
      for (let j = i + 1; j < positions.length; j++) {
        if (positions[j] - start > CONTEXT_SIZE * 2)
          break;
        end = positions[j];
        matchCount++;
      }
      const span = end - start;
      if (matchCount > 1 && span < bestSpan) {
        bestStart = start;
        bestEnd = end;
        bestSpan = span;
      }
    }
    const contextStart = Math.max(0, bestStart - CONTEXT_SIZE);
    const contextEnd = Math.min(text.length, bestEnd + CONTEXT_SIZE);
    let previewStart = contextStart;
    while (previewStart > 0 && !/[\s.!?\n]/.test(text[previewStart - 1])) {
      previewStart--;
    }
    let previewEnd = contextEnd;
    while (previewEnd < text.length && !/[\s.!?\n]/.test(text[previewEnd])) {
      previewEnd++;
    }
    let preview = text.slice(previewStart, previewEnd).trim();
    if (previewStart > 0)
      preview = "..." + preview;
    if (previewEnd < text.length)
      preview = preview + "...";
    return preview;
  }
  getVisibleChats() {
    if (!this.searchInput || !this.searchInput.value.trim()) {
      return this.flattenedItems.map((item) => ({
        item: item.item,
        matches: [],
        score: 0
      }));
    }
    const query = this.searchInput.value.trim();
    const results = this.searchService.search(this.flattenedItems.map((f) => f.item), query, (chat) => this.getSearchableFields(chat), {
      initialResultsLimit: 25,
      maxFilteredResults: 50
    });
    const filteredResults = results.filter((result) => result.matches.length > 0 && result.score > 0);
    return filteredResults.sort((a, b) => b.score - a.score);
  }
};

// src/core/plugin/ribbons.ts
var RibbonManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.chatStorage = new ChatStorageService(app, plugin.settings.chatsDirectory);
  }
  initialize() {
    this.registerRibbonIcons();
  }
  registerRibbonIcons() {
    this.plugin.addRibbonIcon("message-square", "Open SystemSculpt Chat", async () => {
      await this.openChatView();
    });
    this.plugin.addRibbonIcon("history", "Open SystemSculpt Chat History", () => {
      this.openChatHistoryModal();
    });
    this.plugin.addRibbonIcon("trash", "Open SystemSculpt Janitor", () => {
      this.openJanitorModal();
    });
  }
  async openChatView() {
    const { workspace } = this.app;
    const leaf = workspace.getLeaf("tab");
    const view = new ChatView(leaf, this.plugin);
    await leaf.open(view);
    workspace.setActiveLeaf(leaf, { focus: true });
  }
  openChatHistoryModal() {
    const modal = new LoadChatModal(this.app, this.plugin);
    modal.open();
  }
  openJanitorModal() {
    new JanitorModal(this.app, this.plugin).open();
  }
};

// src/core/plugin/views.ts
init_SystemPromptService();
var ViewManager = class {
  constructor(plugin, app) {
    this.isInitialized = false;
    this.isInitializing = false;
    this.initPromise = null;
    this.deferredViews = new Map();
    this.initializationTimeout = 2e3;
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  initialize() {
    this.registerView();
    setTimeout(() => this.ribbonManager.initialize(), 0);
    this.app.workspace.onLayoutReady(() => {
      this.initializeInBackground().catch((error) => {
        console.warn("[SystemSculpt] View initialization error:", error);
      });
    });
  }
  async initializeInBackground() {
    if (this.isInitializing || this.isInitialized)
      return;
    this.isInitializing = true;
    const startTime = performance.now();
    try {
      const leaves = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
      const visibleLeaves = leaves.filter((leaf) => !leaf.view.containerEl.hidden);
      for (const leaf of visibleLeaves) {
        const view = leaf.view;
        const state = leaf.getViewState();
        if (this.isValidChatState(state)) {
          await this.restoreView(view, state.state);
        }
      }
      if (visibleLeaves.length > 0) {
        await Promise.race([
          this.initializeModels(),
          new Promise((_, reject) => setTimeout(() => reject(new Error("Models init timeout")), 2e3))
        ]).catch((error) => {
          console.warn("[SystemSculpt] Models initialization failed:", error);
        });
      }
      this.isInitialized = true;
      for (const [id, initFn] of this.deferredViews) {
        try {
          initFn();
        } catch (error) {
          console.error(`[SystemSculpt] Failed to initialize deferred view ${id}:`, error);
        }
      }
      this.deferredViews.clear();
      const hiddenLeaves = leaves.filter((leaf) => leaf.view.containerEl.hidden);
      if (hiddenLeaves.length > 0) {
        setTimeout(() => {
          for (const leaf of hiddenLeaves) {
            const view = leaf.view;
            const state = leaf.getViewState();
            if (this.isValidChatState(state)) {
              this.restoreView(view, state.state).catch((error) => {
                console.error("[SystemSculpt] Failed to restore hidden view:", error);
              });
            }
          }
        }, 0);
      }
    } catch (error) {
      console.error("[SystemSculpt] Background initialization failed:", error);
    } finally {
      this.isInitializing = false;
    }
  }
  async restoreView(view, state) {
    var _a;
    try {
      await view.setState(state);
    } catch (error) {
      console.warn(`[SystemSculpt] Failed to restore chat ${state.chatId}:`, error);
      (_a = view.leaf) == null ? void 0 : _a.detach();
    }
  }
  async initializeModels() {
    try {
      const models = await this.plugin.modelService.getModels();
      return models;
    } catch (error) {
      console.warn("[SystemSculpt] Model preload failed:", error);
      return [];
    }
  }
  async initializeSystemPrompts() {
    try {
      await SystemPromptService.initializeCache();
    } catch (error) {
      console.warn("[SystemSculpt] System prompts cache initialization failed:", error);
    }
  }
  deferViewInitialization(id, initFn) {
    if (this.isInitialized) {
      initFn();
    } else {
      this.deferredViews.set(id, initFn);
    }
  }
  async restoreChatViews() {
    const leaves = this.app.workspace.getLeavesOfType(CHAT_VIEW_TYPE);
    if (leaves.length === 0) {
      return;
    }
    for (const leaf of leaves) {
      const view = leaf.view;
      const state = leaf.getViewState();
      if (!this.isValidChatState(state)) {
        console.warn("[SystemSculpt] Invalid chat state, skipping:", state);
        continue;
      }
      const chatState = state.state;
      try {
        await this.retrySetState(view, chatState);
      } catch (error) {
        console.warn(`[SystemSculpt] Failed to restore chat ${chatState.chatId}:`, error);
        leaf.detach();
      }
    }
  }
  isValidChatState(state) {
    var _a;
    if (!((_a = state == null ? void 0 : state.state) == null ? void 0 : _a.chatId)) {
      return false;
    }
    const chatId = state.state.chatId;
    if ("messages" in state.state) {
      if (!Array.isArray(state.state.messages)) {
        state.state.messages = [];
      } else if (state.state.messages.length > 0) {
      }
    }
    if ("settings" in state.state) {
      if (typeof state.state.settings !== "object" || state.state.settings === null) {
        state.state.settings = {};
      }
    }
    if (!("messages" in state.state)) {
      state.state.messages = [];
    }
    if (!("settings" in state.state)) {
      state.state.settings = {};
    }
    return true;
  }
  async retrySetState(view, state, maxRetries = 3) {
    let lastError = null;
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        if (attempt > 1) {
          await new Promise((resolve) => setTimeout(resolve, Math.pow(2, attempt - 1) * 1e3));
        }
        await view.setState(state);
        if (attempt > 1) {
        }
        return;
      } catch (error) {
        lastError = error;
      }
    }
    throw new Error(`Failed to restore chat after ${maxRetries} attempts: ${lastError == null ? void 0 : lastError.message}`);
  }
  registerView() {
    this.plugin.registerView(CHAT_VIEW_TYPE, (leaf) => new ChatView(leaf, this.plugin));
  }
  unloadViews() {
    this.app.workspace.detachLeavesOfType(CHAT_VIEW_TYPE);
  }
};

// src/core/plugin/commands.ts
var import_obsidian34 = __toModule(require("obsidian"));
init_ui();
init_TitleGenerationService();
var CommandManager = class {
  constructor(plugin, app) {
    this.plugin = plugin;
    this.app = app;
    this.ribbonManager = new RibbonManager(plugin, app);
  }
  registerCommands() {
    this.registerOpenTasksFile();
    this.registerToggleAudioRecorder();
    this.registerOpenChat();
    this.registerOpenChatHistory();
    this.registerOpenJanitor();
    this.registerReloadObsidian();
    this.registerOpenSettings();
    this.registerChangeChatModel();
    this.registerChatWithFile();
    this.registerTaskMovementCommands();
    this.registerChangeChatTitle();
  }
  registerOpenTasksFile() {
    this.plugin.addCommand({
      id: "open-tasks-file",
      name: "Open Tasks File",
      callback: async () => {
        await this.plugin.tasksService.openOrCreateTasksFile();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "t" }]
    });
  }
  registerToggleAudioRecorder() {
    this.plugin.addCommand({
      id: "toggle-audio-recorder",
      name: "Toggle Audio Recorder",
      callback: () => {
        this.plugin.getRecorderService().toggleRecording();
      },
      hotkeys: [{ modifiers: ["Mod"], key: "r" }]
    });
  }
  registerOpenChat() {
    this.plugin.addCommand({
      id: "open-systemsculpt-chat",
      name: "Open SystemSculpt Chat",
      callback: async () => {
        await this.ribbonManager.openChatView();
      }
    });
  }
  registerOpenChatHistory() {
    this.plugin.addCommand({
      id: "open-chat-history",
      name: "Open SystemSculpt Chat History",
      callback: () => {
        this.ribbonManager.openChatHistoryModal();
      }
    });
  }
  registerOpenJanitor() {
    this.plugin.addCommand({
      id: "open-systemsculpt-janitor",
      name: "Open SystemSculpt Janitor",
      callback: () => {
        this.ribbonManager.openJanitorModal();
      }
    });
  }
  registerReloadObsidian() {
    this.plugin.addCommand({
      id: "reload-obsidian",
      name: "Reload Obsidian",
      callback: () => {
        window.location.reload();
      }
    });
  }
  registerOpenSettings() {
    this.plugin.addCommand({
      id: "open-systemsculpt-settings",
      name: "Open SystemSculpt AI Settings",
      callback: () => {
        this.app.setting.open();
        this.app.setting.openTabById(this.plugin.manifest.id);
      }
    });
  }
  registerChangeChatModel() {
    this.plugin.addCommand({
      id: "change-chat-model",
      name: "Change Chat Model",
      checkCallback: (checking) => {
        const chatView = this.app.workspace.getActiveViewOfType(ChatView);
        if (!chatView) {
          if (!checking) {
            showEnhancedNotice("You need to be within a SystemSculpt chatview to change the model.", "warning");
          }
          return false;
        }
        if (!checking) {
          (async () => {
            try {
              await this.plugin.modelService.getModels();
              const modal = new ModelSelectionModal(this.app, chatView.getSelectedModelId(), async (modelId) => {
                await chatView.setSelectedModelId(modelId);
                showEnhancedNotice("Model changed successfully", "info");
              }, this.plugin);
              modal.open();
            } catch (err) {
              console.error("Failed to open model selection:", err);
              showEnhancedNotice("Failed to fetch available models", "error");
            }
          })();
        }
        return true;
      }
    });
  }
  registerChatWithFile() {
    this.plugin.addCommand({
      id: "chat-with-file",
      name: "Chat with File",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (!activeFile)
          return false;
        const extension = activeFile.extension.toLowerCase();
        const supportedExtensions = [
          "md",
          "txt",
          "markdown",
          "pdf",
          "doc",
          "docx",
          "ppt",
          "pptx",
          "xls",
          "xlsx",
          "mp3",
          "wav",
          "m4a",
          "ogg",
          "webm",
          "jpg",
          "jpeg",
          "png",
          "gif",
          "webp",
          "svg"
        ];
        if (!supportedExtensions.includes(extension))
          return false;
        if (!checking) {
          const leaf = this.app.workspace.getLeaf("tab");
          const view = new ChatView(leaf, this.plugin);
          leaf.open(view).then(async () => {
            await new Promise((resolve) => setTimeout(resolve, 50));
            this.app.workspace.setActiveLeaf(leaf, { focus: true });
            await view.addFileToContext(activeFile);
            view.focusInput();
          });
        }
        return true;
      }
    });
  }
  registerTaskMovementCommands() {
    this.plugin.addCommand({
      id: "move-task-up",
      name: "Move Task Up",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian34.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.moveTaskUp(activeView.editor);
        }
        return true;
      }
    });
    this.plugin.addCommand({
      id: "move-task-down",
      name: "Move Task Down",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian34.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.moveTaskDown(activeView.editor);
        }
        return true;
      }
    });
    this.plugin.addCommand({
      id: "indent-task-right",
      name: "Indent Task Right",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian34.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.indentTaskRight(activeView.editor);
        }
        return true;
      }
    });
    this.plugin.addCommand({
      id: "indent-task-left",
      name: "Indent Task Left",
      checkCallback: (checking) => {
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian34.MarkdownView);
        if (!activeView)
          return false;
        const file = activeView.file;
        if (!file || !this.plugin.tasksService.isTasksFile(file.path))
          return false;
        if (!checking) {
          this.plugin.tasksService.indentTaskLeft(activeView.editor);
        }
        return true;
      }
    });
  }
  registerChangeChatTitle() {
    this.plugin.addCommand({
      id: "change-chat-title",
      name: "Change/Generate Title",
      checkCallback: (checking) => {
        const chatView = this.app.workspace.getActiveViewOfType(ChatView);
        if (chatView) {
          if (!checking) {
            (async () => {
              if (this.plugin.settings.automaticTitleGeneration) {
                const { PersistentTitleNotice: PersistentTitleNotice2 } = await Promise.resolve().then(() => (init_TitleGenerationModal(), TitleGenerationModal_exports));
                const notice = new PersistentTitleNotice2();
                notice.updateProgress(0, "Analyzing content...");
                try {
                  const titleService = TitleGenerationService.getInstance(this.plugin);
                  const title = await titleService.generateTitle(chatView.getMessages(), (title2) => {
                  }, (progress, status) => {
                    notice.updateProgress(progress, status);
                  });
                  if (title && title !== chatView.getChatTitle()) {
                    await chatView.setTitle(title);
                    notice.updateProgress(100, "Title updated!");
                    setTimeout(() => notice == null ? void 0 : notice.hide(), 2e3);
                  } else {
                    notice.hide();
                  }
                } catch (error) {
                  console.error("Error generating title:", error);
                  notice.updateProgress(0, `Error: ${error}`);
                  setTimeout(() => notice == null ? void 0 : notice.hide(), 4e3);
                }
              } else {
                const { showTitleGenerationModal: showTitleGenerationModal2 } = await Promise.resolve().then(() => (init_TitleGenerationModal(), TitleGenerationModal_exports));
                const newTitle = await showTitleGenerationModal2(this.app, this.plugin, chatView.getChatTitle(), chatView.getMessages());
                if (newTitle !== null && newTitle !== chatView.getChatTitle()) {
                  await chatView.setTitle(newTitle);
                  showEnhancedNotice("Chat title updated", "info");
                }
              }
            })();
          }
          return true;
        }
        const activeFile = this.app.workspace.getActiveFile();
        if (!activeFile) {
          if (!checking) {
            showEnhancedNotice("You need to be within a note or chat view to change the title.", "warning");
          }
          return false;
        }
        if (activeFile.extension !== "md") {
          if (!checking) {
            showEnhancedNotice("Title generation is only available for markdown files.", "warning");
          }
          return false;
        }
        if (!checking) {
          (async () => {
            if (this.plugin.settings.automaticTitleGeneration) {
              const { PersistentTitleNotice: PersistentTitleNotice2 } = await Promise.resolve().then(() => (init_TitleGenerationModal(), TitleGenerationModal_exports));
              const notice = new PersistentTitleNotice2();
              notice.updateProgress(0, "Analyzing content...");
              try {
                const titleService = TitleGenerationService.getInstance(this.plugin);
                const title = await titleService.generateTitle(activeFile, (title2) => {
                }, (progress, status) => {
                  notice.updateProgress(progress, status);
                });
                if (title && title !== activeFile.basename) {
                  const newPath = activeFile.path.replace(activeFile.basename, title);
                  await this.app.fileManager.renameFile(activeFile, newPath);
                  notice.updateProgress(100, "Title updated!");
                  setTimeout(() => notice == null ? void 0 : notice.hide(), 2e3);
                } else {
                  notice.hide();
                }
              } catch (error) {
                console.error("Error generating title:", error);
                notice.updateProgress(0, `Error: ${error}`);
                setTimeout(() => notice == null ? void 0 : notice.hide(), 4e3);
              }
            } else {
              const { showTitleGenerationModal: showTitleGenerationModal2 } = await Promise.resolve().then(() => (init_TitleGenerationModal(), TitleGenerationModal_exports));
              const newTitle = await showTitleGenerationModal2(this.app, this.plugin, activeFile.basename, activeFile);
              if (newTitle !== null && newTitle !== activeFile.basename) {
                const newPath = activeFile.path.replace(activeFile.basename, newTitle);
                try {
                  await this.app.fileManager.renameFile(activeFile, newPath);
                  showEnhancedNotice("Note title updated", "info");
                } catch (error) {
                  console.error("Failed to rename file:", error);
                  showEnhancedNotice("Failed to update note title", "error");
                }
              }
            }
          })();
        }
        return true;
      },
      hotkeys: [{ modifiers: ["Mod", "Shift"], key: "t" }]
    });
  }
};

// src/main.ts
init_CustomProviderService();
init_SystemPromptService();

// src/services/TasksService.ts
var import_obsidian35 = __toModule(require("obsidian"));
var TasksService = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.taskToggleStates = new Map();
    this.app = plugin.app;
    this.settings = plugin.settings;
    this.lastTaskFileReorder = 0;
    this.reorderDebounce = 0;
    this.registerTasksFileWatcher();
    this.registerWorkspaceEvents();
    this.registerMetadataWatcher();
  }
  registerWorkspaceEvents() {
    this.plugin.registerEvent(this.app.workspace.on("active-leaf-change", (leaf) => {
      if (leaf) {
        this.handleLeafChange(leaf);
      }
    }));
    this.plugin.registerEvent(this.app.workspace.on("layout-change", () => {
      this.app.workspace.iterateAllLeaves((leaf) => {
        this.handleLeafChange(leaf);
      });
    }));
    this.plugin.registerEvent(this.app.metadataCache.on("changed", (file) => {
      if (file.path.startsWith(this.settings.tasksDirectory)) {
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a;
          if (leaf.view instanceof import_obsidian35.MarkdownView && ((_a = leaf.view.file) == null ? void 0 : _a.path) === file.path) {
            this.handleLeafChange(leaf);
          }
        });
      }
    }));
  }
  async handleLeafChange(leaf) {
    var _a;
    const view = leaf.view;
    if (!(view instanceof import_obsidian35.MarkdownView))
      return;
    const file = view.file;
    const editorContainer = view.contentEl.querySelector(".cm-editor");
    const readerContainer = view.contentEl;
    if (editorContainer) {
      editorContainer.querySelectorAll(".systemsculpt-tasks-toggle").forEach((el) => el.remove());
    }
    if (readerContainer) {
      readerContainer.querySelectorAll(".systemsculpt-tasks-toggle").forEach((el) => el.remove());
    }
    if (!file || !file.path.startsWith(this.settings.tasksDirectory))
      return;
    const contentContainer = view.getMode() === "source" ? editorContainer : readerContainer;
    if (!contentContainer)
      return;
    const cache = this.app.metadataCache.getCache(file.path);
    const isHidden = ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.hideCompleted) === true;
    this.taskToggleStates.set(file.path, isHidden);
    const toggleContainer = this.createToggleContainer(file.path, isHidden);
    contentContainer.insertBefore(toggleContainer, contentContainer.firstChild);
    this.updateTaskVisibility(file.path, isHidden);
  }
  createToggleContainer(filePath, initialState) {
    const toggleContainer = document.createElement("div");
    toggleContainer.className = "systemsculpt-tasks-toggle";
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.className = "task-toggle-checkbox";
    checkbox.checked = initialState;
    const label = document.createElement("label");
    label.textContent = "Hide completed tasks";
    label.className = "task-toggle-label";
    checkbox.addEventListener("change", async (e) => {
      const isChecked = e.target.checked;
      await this.updateToggleState(filePath, isChecked);
    });
    toggleContainer.appendChild(checkbox);
    toggleContainer.appendChild(label);
    return toggleContainer;
  }
  registerMetadataWatcher() {
    this.plugin.registerEvent(this.app.metadataCache.on("changed", (file) => {
      var _a;
      if (file.path.startsWith(this.settings.tasksDirectory)) {
        const cache = this.app.metadataCache.getCache(file.path);
        const isHidden = ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.hideCompleted) === true;
        this.taskToggleStates.set(file.path, isHidden);
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a2;
          if (leaf.view instanceof import_obsidian35.MarkdownView && ((_a2 = leaf.view.file) == null ? void 0 : _a2.path) === file.path) {
            const editorContainer = leaf.view.contentEl.querySelector(".cm-editor");
            const readerContainer = leaf.view.contentEl;
            const containers = [editorContainer, readerContainer];
            containers.forEach((container) => {
              if (container) {
                const toggle = container.querySelector(".task-toggle-checkbox");
                if (toggle) {
                  toggle.checked = isHidden;
                }
              }
            });
            this.updateTaskVisibility(file.path, isHidden);
          }
        });
      }
    }));
  }
  async updateToggleState(filePath, isChecked) {
    this.taskToggleStates.set(filePath, isChecked);
    this.updateTaskVisibility(filePath, isChecked);
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (file instanceof import_obsidian35.TFile) {
      const content = await this.app.vault.read(file);
      const hasYamlFrontmatter = content.startsWith("---\n");
      let newContent;
      if (hasYamlFrontmatter) {
        const [frontmatter, ...rest] = content.split("---\n").filter(Boolean);
        const yamlLines = frontmatter.split("\n");
        const hideCompletedIndex = yamlLines.findIndex((line) => line.startsWith("hideCompleted:"));
        if (hideCompletedIndex >= 0) {
          yamlLines[hideCompletedIndex] = `hideCompleted: ${isChecked}`;
        } else {
          yamlLines.push(`hideCompleted: ${isChecked}`);
        }
        newContent = `---
${yamlLines.join("\n")}
---
${rest.join("---\n")}`;
      } else {
        newContent = `---
hideCompleted: ${isChecked}
---

${content}`;
      }
      try {
        await this.app.vault.modify(file, newContent);
      } catch (error) {
        console.error("Failed to update hideCompleted in frontmatter:", error);
        this.taskToggleStates.set(filePath, !isChecked);
        this.updateTaskVisibility(filePath, !isChecked);
        this.app.workspace.iterateAllLeaves((leaf) => {
          var _a;
          if (leaf.view instanceof import_obsidian35.MarkdownView && ((_a = leaf.view.file) == null ? void 0 : _a.path) === filePath) {
            const editorContainer = leaf.view.contentEl.querySelector(".cm-editor");
            const readerContainer = leaf.view.contentEl;
            const containers = [editorContainer, readerContainer];
            containers.forEach((container) => {
              if (container) {
                const toggle = container.querySelector(".task-toggle-checkbox");
                if (toggle) {
                  toggle.checked = !isChecked;
                }
              }
            });
          }
        });
      }
    }
  }
  updateTaskVisibility(filePath, isHidden) {
    var _a, _b;
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (!file)
      return;
    const leaves = this.app.workspace.getLeavesOfType("markdown");
    for (const leaf of leaves) {
      const view = leaf.view;
      if (((_a = view.file) == null ? void 0 : _a.path) !== file.path)
        continue;
      const contentEl = view.contentEl;
      if (isHidden) {
        contentEl.classList.add("hide-completed-tasks");
      } else {
        contentEl.classList.remove("hide-completed-tasks");
      }
      if (view.getMode() === "source") {
        const editor = view.editor;
        if (editor) {
          editor.refresh();
        }
      } else {
        (_b = view.previewMode) == null ? void 0 : _b.rerender(true);
      }
    }
  }
  async openOrCreateTasksFile() {
    const tasksDir = this.settings.tasksDirectory;
    const fileName = `${tasksDir}/Tasks.md`;
    try {
      await this.app.vault.adapter.mkdir(tasksDir);
      if (!await this.app.vault.adapter.exists(fileName)) {
        await this.app.vault.create(fileName, `# Tasks

- [ ] Sample task
`);
      }
      const file = this.app.vault.getAbstractFileByPath(fileName);
      if (file instanceof import_obsidian35.TFile) {
        const existingLeaf = this.app.workspace.getLeavesOfType("markdown").find((leaf) => leaf.view.getState().file === file.path);
        if (existingLeaf) {
          this.app.workspace.setActiveLeaf(existingLeaf, { focus: true });
        } else {
          await this.app.workspace.getLeaf().openFile(file);
        }
      }
    } catch (error) {
      console.error("Failed to handle tasks file:", error);
      throw error;
    }
  }
  registerTasksFileWatcher() {
    this.plugin.registerEvent(this.app.vault.on("modify", async (file) => {
      const tasksDir = this.settings.tasksDirectory;
      if (file.path.startsWith(tasksDir) && file.path.endsWith(".md")) {
        await this.reorderCompletedTasks(file);
      }
    }));
  }
  async reorderCompletedTasks(file) {
    if (!this.settings.moveCompletedTasksDown) {
      return;
    }
    if (!file.path.startsWith(this.settings.tasksDirectory)) {
      return;
    }
    if (!file.path.endsWith(".md")) {
      return;
    }
    const original = await this.app.vault.read(file);
    const reordered = this.reorderContent(original);
    if (reordered !== original) {
      await this.app.vault.modify(file, reordered);
    }
  }
  reorderContent(content) {
    const lines = content.split("\n");
    const output = [];
    let listBuffer = [];
    const flushBuffer = () => {
      if (listBuffer.length > 0) {
        output.push(...this.reorderListBlock(listBuffer));
        listBuffer = [];
      }
    };
    for (const line of lines) {
      if (/^\s*-\s*\[[x\s]\]/.test(line)) {
        listBuffer.push(line);
      } else {
        flushBuffer();
        output.push(line);
      }
    }
    flushBuffer();
    return output.join("\n");
  }
  reorderListBlock(lines) {
    function getIndent(line) {
      const match = line.match(/^(\s*)/);
      return match ? match[1].length : 0;
    }
    const nodes = [];
    const stack = [];
    for (const line of lines) {
      const indent = getIndent(line);
      const node = { line, children: [], indent };
      while (stack.length > 0 && indent <= stack[stack.length - 1].indent) {
        stack.pop();
      }
      if (stack.length === 0) {
        nodes.push(node);
        stack.push(node);
      } else {
        stack[stack.length - 1].children.push(node);
        stack.push(node);
      }
    }
    function reorderNodes(nodes2) {
      for (const node of nodes2) {
        if (node.children.length > 0) {
          node.children = reorderNodes(node.children);
          node.children.sort((a, b) => {
            const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
            const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
            return aComplete - bComplete;
          });
        }
      }
      nodes2.sort((a, b) => {
        const aComplete = /^\s*-\s*\[x\]/i.test(a.line) ? 1 : 0;
        const bComplete = /^\s*-\s*\[x\]/i.test(b.line) ? 1 : 0;
        return aComplete - bComplete;
      });
      return nodes2;
    }
    const reorderedNodes = reorderNodes(nodes);
    const flattened = [];
    function flatten(nodes2) {
      for (const node of nodes2) {
        flattened.push(node.line);
        if (node.children.length > 0) {
          flatten(node.children);
        }
      }
    }
    flatten(reorderedNodes);
    return flattened;
  }
  isTasksFile(filePath) {
    return filePath.startsWith(this.settings.tasksDirectory);
  }
  getTaskTreeRange(editor, startLine) {
    const startIndent = this.getIndentLevel(editor.getLine(startLine));
    let endLine = startLine;
    for (let i = startLine + 1; i < editor.lineCount(); i++) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent <= startIndent) {
        break;
      }
      endLine = i;
    }
    return { start: startLine, end: endLine };
  }
  getPreviousTaskTreeRange(editor, currentLine, currentIndent) {
    for (let i = currentLine - 1; i >= 0; i--) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent === currentIndent && this.isTaskLine(line)) {
        return this.getTaskTreeRange(editor, i);
      }
      if (indent < currentIndent) {
        break;
      }
    }
    return null;
  }
  getNextTaskTreeRange(editor, currentLine, currentIndent) {
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    for (let i = currentTreeRange.end + 1; i < editor.lineCount(); i++) {
      const line = editor.getLine(i);
      const indent = this.getIndentLevel(line);
      if (indent === currentIndent && this.isTaskLine(line)) {
        return this.getTaskTreeRange(editor, i);
      }
      if (indent < currentIndent) {
        break;
      }
    }
    return null;
  }
  getRangeText(editor, range) {
    let text = "";
    for (let i = range.start; i <= range.end; i++) {
      text += editor.getLine(i) + "\n";
    }
    return text;
  }
  moveTaskUp(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    if (currentLine === 0)
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    const previousTreeRange = this.getPreviousTaskTreeRange(editor, currentLine, currentIndent);
    if (previousTreeRange) {
      const currentTreeText = this.getRangeText(editor, currentTreeRange);
      const previousTreeText = this.getRangeText(editor, previousTreeRange);
      editor.transaction({
        changes: [
          {
            from: { line: previousTreeRange.start, ch: 0 },
            to: { line: previousTreeRange.end + 1, ch: 0 },
            text: currentTreeText
          },
          {
            from: { line: currentTreeRange.start, ch: 0 },
            to: { line: currentTreeRange.end + 1, ch: 0 },
            text: previousTreeText
          }
        ]
      });
      const moveDistance = currentTreeRange.start - previousTreeRange.start;
      const newLine = currentLine - moveDistance;
      const newLineContent = editor.getLine(newLine);
      editor.setCursor({ line: newLine, ch: newLineContent.length });
    }
  }
  moveTaskDown(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    const currentTreeRange = this.getTaskTreeRange(editor, currentLine);
    const nextTreeRange = this.getNextTaskTreeRange(editor, currentLine, currentIndent);
    if (nextTreeRange) {
      const currentTreeText = this.getRangeText(editor, currentTreeRange);
      const nextTreeText = this.getRangeText(editor, nextTreeRange);
      editor.transaction({
        changes: [
          {
            from: { line: currentTreeRange.start, ch: 0 },
            to: { line: currentTreeRange.end + 1, ch: 0 },
            text: nextTreeText
          },
          {
            from: { line: nextTreeRange.start, ch: 0 },
            to: { line: nextTreeRange.end + 1, ch: 0 },
            text: currentTreeText
          }
        ]
      });
      const nextTreeSize = nextTreeRange.end - nextTreeRange.start + 1;
      const newLine = currentLine + nextTreeSize;
      const newLineContent = editor.getLine(newLine);
      editor.setCursor({ line: newLine, ch: newLineContent.length });
    }
  }
  indentTaskRight(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    editor.setLine(currentLine, "  " + lineContent);
    const newLineContent = editor.getLine(currentLine);
    editor.setCursor({ line: currentLine, ch: newLineContent.length });
  }
  indentTaskLeft(editor) {
    const currentLine = editor.getCursor().line;
    const lineContent = editor.getLine(currentLine);
    if (!this.isTaskLine(lineContent))
      return;
    const currentIndent = this.getIndentLevel(lineContent);
    if (currentIndent >= 2) {
      editor.setLine(currentLine, lineContent.substring(2));
      const newLineContent = editor.getLine(currentLine);
      editor.setCursor({ line: currentLine, ch: newLineContent.length });
    }
  }
  isTaskLine(line) {
    return /^\s*-\s*\[[x\s]\]/.test(line);
  }
  getIndentLevel(line) {
    const match = line.match(/^(\s*)/);
    return match ? match[1].length : 0;
  }
};

// src/services/ModelService.ts
var ModelService = class {
  constructor(plugin, customProviderService) {
    this.plugin = plugin;
    this.customProviderService = customProviderService;
    this.models = null;
    this.loadingPromise = null;
    this.lastFetchTime = 0;
    this.lastDemandTime = 0;
    this.CACHE_DURATION = 30 * 60 * 1e3;
    this.DEMAND_THRESHOLD = 5 * 60 * 1e3;
    this.isBackgroundRefreshScheduled = false;
    this.localStorageKey = "systemsculpt-models-cache";
    this.isInitialLoadDone = false;
    this.loadCachedModels();
  }
  static getInstance(plugin, customProviderService) {
    if (!this.instance) {
      this.instance = new ModelService(plugin, customProviderService);
    }
    return this.instance;
  }
  loadCachedModels() {
    try {
      const cached = localStorage.getItem(this.localStorageKey);
      if (cached) {
        const { models, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < this.CACHE_DURATION) {
          this.models = models;
          this.lastFetchTime = timestamp;
        }
      }
    } catch (error) {
      console.warn("[SystemSculpt] Failed to load models from cache:", error);
    }
  }
  saveCachedModels(models) {
    try {
      localStorage.setItem(this.localStorageKey, JSON.stringify({
        models,
        timestamp: Date.now()
      }));
    } catch (error) {
      console.warn("[SystemSculpt] Failed to save models to cache:", error);
    }
  }
  async getModels(forceRefresh = false) {
    const now = Date.now();
    this.lastDemandTime = now;
    if (!forceRefresh && this.models) {
      if (now - this.lastFetchTime >= this.CACHE_DURATION) {
        this.scheduleBackgroundRefresh();
      }
      return this.models;
    }
    if (this.loadingPromise && !forceRefresh) {
      return this.loadingPromise;
    }
    console.log("[SystemSculpt] Fetching fresh models...");
    this.loadingPromise = this.loadModels().then((models) => {
      this.models = models;
      this.lastFetchTime = now;
      this.loadingPromise = null;
      this.saveCachedModels(models);
      this.isInitialLoadDone = true;
      console.log(`[SystemSculpt] Loaded ${models.length} models`);
      return models;
    }).catch((err) => {
      console.error("[SystemSculpt] Failed to load models:", err);
      this.loadingPromise = null;
      if (this.models && !forceRefresh) {
        return this.models;
      }
      throw err;
    });
    return this.loadingPromise;
  }
  async loadModels() {
    try {
      const systemModelsPromise = this.loadWithRetry(() => this.plugin.aiService.getModels(), 3, 1e3);
      const customModelsPromise = this.loadWithRetry(() => this.loadCustomProviderModels(), 3, 1e3);
      const [systemModels, customModels] = await Promise.all([
        systemModelsPromise,
        customModelsPromise
      ]);
      const allModels = [...systemModels, ...customModels];
      this.processFavorites(allModels);
      return allModels;
    } catch (error) {
      console.error("[SystemSculpt] Failed to load models:", error);
      throw error;
    }
  }
  async loadWithRetry(fn, maxRetries, delay) {
    for (let i = 0; i < maxRetries; i++) {
      try {
        return await Promise.race([
          fn(),
          new Promise((_, reject) => setTimeout(() => reject(new Error("Operation timeout")), 5e3))
        ]);
      } catch (error) {
        if (i === maxRetries - 1)
          throw error;
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }
    throw new Error("Max retries exceeded");
  }
  processFavorites(models) {
    const favoriteModels = this.plugin.settings.favoriteModels || [];
    for (const model of models) {
      model.isFavorite = favoriteModels.some((fav) => fav.modelId === model.id && fav.provider === model.provider);
    }
  }
  async loadCustomProviderModels() {
    const { customProviders } = this.plugin.settings;
    const enabledProviders = customProviders.filter((p) => p.isEnabled);
    if (enabledProviders.length === 0) {
      return [];
    }
    const fetches = enabledProviders.map(async (provider) => {
      try {
        const result = await this.customProviderService.testConnection(provider);
        if (result.success && result.models) {
          return this.createCustomModels(provider, result.models);
        }
      } catch (error) {
        console.error(`[SystemSculpt] Failed to load models from ${provider.name}:`, error);
      }
      return [];
    });
    const results = await Promise.all(fetches);
    return results.flat();
  }
  createCustomModels(provider, modelIds) {
    console.log("[SystemSculpt] Creating custom models for provider:", {
      providerId: provider.id,
      providerName: provider.name,
      endpoint: provider.endpoint,
      modelCount: modelIds.length
    });
    return modelIds.map((modelId) => ({
      id: modelId,
      name: modelId,
      provider: provider.name.toLowerCase(),
      isFavorite: false,
      context_length: 0,
      capabilities: [],
      pricing: {
        prompt: "0",
        completion: "0",
        image: "0",
        request: "0"
      },
      architecture: {
        modality: "text->text",
        tokenizer: "",
        instruct_type: null
      },
      description: `${provider.name} model`,
      identifier: {
        providerId: provider.name.toLowerCase(),
        modelId,
        displayName: modelId
      }
    }));
  }
  async toggleFavorite(model) {
    const isNowFavorite = !model.isFavorite;
    model.isFavorite = isNowFavorite;
    if (isNowFavorite) {
      this.plugin.settings.favoriteModels.push({
        provider: model.provider,
        modelId: model.id
      });
    } else {
      this.plugin.settings.favoriteModels = this.plugin.settings.favoriteModels.filter((fav) => !(fav.modelId === model.id && fav.provider === model.provider));
    }
    await this.plugin.saveSettings();
  }
  async refreshModels() {
    console.log("[SystemSculpt] Explicitly refreshing models");
    return this.getModels(true);
  }
  scheduleBackgroundRefresh() {
    if (this.isBackgroundRefreshScheduled)
      return;
    this.isBackgroundRefreshScheduled = true;
    requestAnimationFrame(() => {
      this.getModels(true).catch((error) => {
        console.warn("[SystemSculpt] Background model refresh failed:", error);
      }).finally(() => {
        this.isBackgroundRefreshScheduled = false;
      });
    });
  }
  get cachedModels() {
    return this.models;
  }
};

// src/main.ts
var SystemSculptPlugin = class extends import_obsidian36.Plugin {
  constructor() {
    super(...arguments);
    this.isUnloading = false;
    this.isPreloadingDone = false;
    this.failures = [];
  }
  async onload() {
    try {
      await Promise.race([
        this.runCriticalInitialization(),
        new Promise((_, reject) => setTimeout(() => reject(new Error("Critical initialization timeout")), 2e3))
      ]);
      await this.runDeferredInitialization();
      try {
        await this.viewManager.restoreChatViews();
      } catch (err) {
        console.error("[SystemSculpt] Failed to preload chat views:", err);
        this.failures.push("chat view preload");
      }
    } catch (error) {
      console.error("[SystemSculpt] Plugin load failed:", error);
      this.failures.push("core initialization");
    }
    if (this.failures.length > 0) {
      this.showUserNotice(`SystemSculpt had issues with: ${this.failures.join(", ")}. Some features may be unavailable.`);
    }
  }
  showUserNotice(message) {
    new import_obsidian36.Notice(message, 5e3);
  }
  async runCriticalInitialization() {
    await this.initializeSettings();
    await this.initializeBasicServices();
    await this.initializeBasicUI();
  }
  async runDeferredInitialization() {
    if (this.isUnloading)
      return;
    try {
      await this.initializeRemainingServices();
      await this.initializeManagers();
      await this.initializeLicense();
      await this.preloadDataInBackground();
    } catch (error) {
      console.error("[SystemSculpt] Deferred initialization failed:", error);
      this.failures.push("background initialization");
    }
  }
  async initializeSettings() {
    try {
      this.settingsManager = new SettingsManager(this);
      await this.settingsManager.loadSettings();
      this.settings = this.settingsManager.getSettings();
    } catch (error) {
      console.warn("[SystemSculpt] Failed to load settings:", error);
      this.settings = { ...DEFAULT_SETTINGS };
      this.failures.push("settings");
    }
  }
  async initializeBasicServices() {
    try {
      this.customProviderService = new CustomProviderService(this);
      this.modelService = ModelService.getInstance(this, this.customProviderService);
      this.aiService = SystemSculptService.getInstance(this.settings, this.app);
      this.aiService.updateSettings(this.settings, this);
    } catch (error) {
      console.error("[SystemSculpt] Basic service initialization failed:", error);
      this.failures.push("basic services");
    }
  }
  async initializeBasicUI() {
    try {
      this.registerExtensions(["srt"], "markdown");
      this.settingsTab = new SystemSculptSettingTab(this.app, this);
      this.addSettingTab(this.settingsTab);
    } catch (error) {
      console.warn("[SystemSculpt] Basic UI setup failed:", error);
      this.failures.push("UI components");
    }
  }
  async initializeRemainingServices() {
    try {
      this.transcriptionService = TranscriptionService.getInstance(this);
      this.recorderService = RecorderService.getInstance(this.app, this);
      this.contextMenu = new SystemSculptContextMenu(this.app, this.aiService, this);
      SystemPromptService.setSystemSculptService(this.aiService);
    } catch (error) {
      console.warn("[SystemSculpt] Remaining service initialization failed:", error);
      this.failures.push("additional services");
    }
  }
  async initializeManagers() {
    try {
      this.licenseManager = new LicenseManager(this, this.app);
      this.tasksService = new TasksService(this);
      this.viewManager = new ViewManager(this, this.app);
      this.commandManager = new CommandManager(this, this.app);
      this.viewManager.initialize();
      this.commandManager.registerCommands();
    } catch (error) {
      console.warn("[SystemSculpt] Manager setup failed:", error);
      this.failures.push("plugin features");
    }
  }
  async initializeLicense() {
    try {
      if (this.licenseManager) {
        await this.licenseManager.initializeLicense();
      }
    } catch (error) {
      console.warn("[SystemSculpt] License validation failed:", error);
      this.failures.push("license validation");
    }
  }
  async onunload() {
    this.isUnloading = true;
    console.log("[SystemSculpt] Plugin unloading...");
    try {
      if (this.settingsTab) {
      }
      if (this.commandManager) {
        const commands = [
          "open-tasks-file",
          "toggle-audio-recorder",
          "open-systemsculpt-chat",
          "open-chat-history",
          "open-systemsculpt-janitor",
          "reload-obsidian",
          "open-systemsculpt-settings",
          "change-chat-model",
          "chat-with-file",
          "suggest-edits",
          "clear-suggested-edits",
          "move-task-up",
          "move-task-down",
          "indent-task-right",
          "indent-task-left"
        ];
        commands.forEach((id) => {
          this.app.commands.removeCommand(`${this.manifest.id}:${id}`);
        });
      }
      if (this.viewManager) {
        this.viewManager.unloadViews();
      }
      if (this.recorderService) {
        this.recorderService.unload();
      }
      if (this.transcriptionService) {
        this.transcriptionService.unload();
      }
      SystemPromptService.clearCache();
      this.modelService = void 0;
      this.aiService = void 0;
      this.customProviderService = void 0;
      console.log("[SystemSculpt] Plugin unloaded successfully");
    } catch (error) {
      console.error("[SystemSculpt] Error during plugin cleanup:", error);
    }
  }
  get isReady() {
    return this.isPreloadingDone;
  }
  async loadData() {
    return super.loadData();
  }
  async saveData(data) {
    return super.saveData(data);
  }
  async saveSettings() {
    await this.settingsManager.saveSettings();
  }
  getRecorderService() {
    return this.recorderService;
  }
  getTranscriptionService() {
    return this.transcriptionService;
  }
  getLicenseManager() {
    return this.licenseManager;
  }
  getSettingsManager() {
    return this.settingsManager;
  }
  getInitialModels() {
    return this.modelService.getModels();
  }
  async preloadDataInBackground() {
    if (this.isUnloading)
      return;
    const modelPromise = (async () => {
      try {
        console.log("[SystemSculpt] Preloading models in background...");
        const models = await this.modelService.getModels();
        console.log(`[SystemSculpt] Preloaded ${models.length} models`);
      } catch (error) {
        console.warn("[SystemSculpt] Background model preload failed:", error);
        this.failures.push("model preload");
      }
    })();
    const promptPromise = (async () => {
      try {
        console.log("[SystemSculpt] Initializing system prompts in background...");
        await SystemPromptService.initializeCache();
        console.log("[SystemSculpt] System prompts cached");
      } catch (error) {
        console.warn("[SystemSculpt] Background prompt cache failed:", error);
        this.failures.push("system prompts");
      }
    })();
    modelPromise.catch((error) => {
      console.error("[SystemSculpt] Fatal error in model preload:", error);
    });
    promptPromise.catch((error) => {
      console.error("[SystemSculpt] Fatal error in prompt cache:", error);
    });
    this.isPreloadingDone = true;
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2UudHMiLCAic3JjL3V0aWxzL2Vycm9ycy50cyIsICJzcmMvdXRpbHMvSW1hZ2VQcm9jZXNzb3IudHMiLCAic3JjL2NvbnN0YW50cy9hcGkudHMiLCAic3JjL3NlcnZpY2VzL0N1c3RvbVByb3ZpZGVyU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZS50cyIsICJzcmMvY29yZS91aS9jb21wb25lbnRzL0xvYWRpbmdJbmRpY2F0b3IudHMiLCAic3JjL2NvcmUvdWkvY29tcG9uZW50cy9CdXR0b24udHMiLCAic3JjL3NlcnZpY2VzL1RpdGxlR2VuZXJhdGlvblNlcnZpY2UudHMiLCAic3JjL2NvcmUvdWkvbW9kYWxzL1RleHRBcmVhTW9kYWwudHMiLCAic3JjL2NvcmUvdWkvbW9kYWxzL1BvcHVwTW9kYWwudHMiLCAic3JjL2NvcmUvdWkvY29tcG9uZW50cy9Ob3RpY2UudHMiLCAic3JjL2NvcmUvdWkvbm90aWZpY2F0aW9ucy50cyIsICJzcmMvY29yZS91aS9pbmRleC50cyIsICJzcmMvY29tcG9uZW50cy9GaWxlU3VnZ2VzdGVyLnRzIiwgInNyYy9tb2RhbHMvVGl0bGVHZW5lcmF0aW9uUHJvbXB0TW9kYWwudHMiLCAic3JjL21vZGFscy9Qb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsLnRzIiwgInNyYy9tb2RhbHMvVGl0bGVHZW5lcmF0aW9uTW9kYWwudHMiLCAic3JjL21haW4udHMiLCAic3JjL3R5cGVzL2xsbS50cyIsICJzcmMvdHlwZXMudHMiLCAic3JjL21vZGFscy9TZXR0aW5nc1RhYi50cyIsICJzcmMvY29tcG9uZW50cy9Gb2xkZXJTdWdnZXN0ZXIudHMiLCAic3JjL21vZGFscy9EZWZhdWx0U3lzdGVtUHJvbXB0TW9kYWwudHMiLCAic3JjL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlLnRzIiwgInNyYy9tb2RhbHMvTW9kZWxTZWxlY3Rpb25IZWxwZXIudHMiLCAic3JjL21vZGFscy9DdXN0b21Qcm92aWRlck1vZGFsLnRzIiwgInNyYy9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2UudHMiLCAic3JjL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbC50cyIsICJzcmMvc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1Bvc3RQcm9jZXNzaW5nU2VydmljZS50cyIsICJzcmMvdmlld3MvY2hhdHZpZXcvQ2hhdFZpZXcudHMiLCAic3JjL3NlcnZpY2VzL0NoYXRTdG9yYWdlU2VydmljZS50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9NZXNzYWdlUmVuZGVyZXIudHMiLCAic3JjL3ZpZXdzL2NoYXR2aWV3L3VpU2V0dXAudHMiLCAic3JjL3ZpZXdzL2NvbXBvbmVudHMvRmlsZUNvbnRleHRNYW5hZ2VyLnRzIiwgInNyYy92aWV3cy9jb21wb25lbnRzL0RyYXdlckNvbXBvbmVudC50cyIsICJzcmMvbW9kYWxzL0NvbnRleHRTZWxlY3Rpb25Nb2RhbC50cyIsICJzcmMvc2VydmljZXMvVG9rZW5Db3VudGVyU2VydmljZS50cyIsICJzcmMvY29yZS9saWNlbnNlL0xpY2Vuc2VDaGVja2VyLnRzIiwgInNyYy9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZS50cyIsICJzcmMvdmlld3MvY29tcG9uZW50cy9JbnB1dEhhbmRsZXIudHMiLCAic3JjL3ZpZXdzL2NoYXR2aWV3L21lc3NhZ2VIYW5kbGluZy50cyIsICJzcmMvdmlld3MvY2hhdHZpZXcvZXZlbnRIYW5kbGluZy50cyIsICJzcmMvbW9kYWxzL0NoYXRTeXN0ZW1Qcm9tcHRNb2RhbC50cyIsICJzcmMvdmlld3MvY2hhdHZpZXcvc3lzdGVtUHJvbXB0SGFuZGxpbmcudHMiLCAic3JjL2NvbXBvbmVudHMvU3lzdGVtU2N1bHB0Q29udGV4dE1lbnUudHMiLCAic3JjL2NvcmUvc2V0dGluZ3MvU2V0dGluZ3NNYW5hZ2VyLnRzIiwgInNyYy9jb3JlL2xpY2Vuc2UvTGljZW5zZU1hbmFnZXIudHMiLCAic3JjL21vZGFscy9KYW5pdG9yTW9kYWwudHMiLCAic3JjL21vZGFscy9Mb2FkQ2hhdE1vZGFsLnRzIiwgInNyYy9jb3JlL3BsdWdpbi9yaWJib25zLnRzIiwgInNyYy9jb3JlL3BsdWdpbi92aWV3cy50cyIsICJzcmMvY29yZS9wbHVnaW4vY29tbWFuZHMudHMiLCAic3JjL3NlcnZpY2VzL1Rhc2tzU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvTW9kZWxTZXJ2aWNlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFByZXNldCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcblxuaW50ZXJmYWNlIFN5c3RlbVByb21wdENhY2hlIHtcbiAgcHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBieUlkOiB7IFtrZXk6IHN0cmluZ106IFN5c3RlbVByb21wdFByZXNldCB9O1xufVxuXG5leHBvcnQgY2xhc3MgU3lzdGVtUHJvbXB0U2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc3RhdGljIGNhY2hlOiBTeXN0ZW1Qcm9tcHRDYWNoZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDQUNIRV9EVVJBVElPTiA9IDQgKiA2MCAqIDYwICogMTAwMDsgLy8gNCBob3VycyBpbiBtaWxsaXNlY29uZHNcbiAgcHJpdmF0ZSBzdGF0aWMgaW5pdFByb21pc2U6IFByb21pc2U8dm9pZD4gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzdGF0aWMgaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdGF0aWMgaXNCYWNrZ3JvdW5kUmVmcmVzaFNjaGVkdWxlZCA9IGZhbHNlO1xuICBwcml2YXRlIHN0YXRpYyBzeXN0ZW1TY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHN0YXRpYyBsb2NhbFN0b3JhZ2VLZXkgPSAnc3lzdGVtc2N1bHB0LXByb21wdHMtY2FjaGUnO1xuICBwcml2YXRlIHN0YXRpYyBpc0luaXRpYWxMb2FkRG9uZSA9IGZhbHNlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCkge1xuICAgIC8vIFRyeSB0byBsb2FkIGNhY2hlZCBwcm9tcHRzIGZyb20gbG9jYWxTdG9yYWdlXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5sb2FkQ2FjaGVkUHJvbXB0cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgbG9hZENhY2hlZFByb21wdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFN5c3RlbVByb21wdFNlcnZpY2UubG9jYWxTdG9yYWdlS2V5KTtcbiAgICAgIGlmIChjYWNoZWQpIHtcbiAgICAgICAgY29uc3QgeyBjYWNoZSwgdGltZXN0YW1wIH0gPSBKU09OLnBhcnNlKGNhY2hlZCk7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGltZXN0YW1wIDwgU3lzdGVtUHJvbXB0U2VydmljZS5DQUNIRV9EVVJBVElPTikge1xuICAgICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUgPSBjYWNoZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gbG9hZCBwcm9tcHRzIGZyb20gY2FjaGU6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBzYXZlQ2FjaGVkUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU3lzdGVtUHJvbXB0U2VydmljZS5sb2NhbFN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBjYWNoZTogU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gc2F2ZSBwcm9tcHRzIHRvIGNhY2hlOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZShhcHA6IEFwcCk6IFN5c3RlbVByb21wdFNlcnZpY2Uge1xuICAgIGlmICghdGhpcy5pbnN0YW5jZSkge1xuICAgICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlKGFwcCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBzZXRTeXN0ZW1TY3VscHRTZXJ2aWNlKHNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2UpIHtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnN5c3RlbVNjdWxwdFNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIC8vIE9ubHkgaW5pdGlhbGl6ZSBjYWNoZSBpZiB3ZSBkb24ndCBoYXZlIHZhbGlkIGNhY2hlZCBkYXRhXG4gICAgaWYgKCFTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQ2FjaGVWYWxpZCgpICYmICFTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzSW5pdGlhbGl6aW5nKSB7XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRpYWxpemVDYWNoZSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0Q2FjaGVkUHJvbXB0cygpOiBTeXN0ZW1Qcm9tcHRQcmVzZXRbXSB8IG51bGwge1xuICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlPy5wcm9tcHRzIHx8IG51bGw7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGlzQ2FjaGVWYWxpZCgpOiBib29sZWFuIHtcbiAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIHJldHVybiAoXG4gICAgICBub3cgLSBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLnRpbWVzdGFtcCA8XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLkNBQ0hFX0RVUkFUSU9OXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHVwZGF0ZUNhY2hlKHByb21wdHM6IFN5c3RlbVByb21wdFByZXNldFtdKTogdm9pZCB7XG4gICAgY29uc3QgYnlJZDogeyBba2V5OiBzdHJpbmddOiBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSA9IHt9O1xuICAgIHByb21wdHMuZm9yRWFjaCgocHJvbXB0KSA9PiB7XG4gICAgICBieUlkW3Byb21wdC5pZF0gPSBwcm9tcHQ7XG4gICAgfSk7XG5cbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlID0ge1xuICAgICAgcHJvbXB0cyxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGJ5SWQsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZUNhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlKSB7XG4gICAgICByZXR1cm4gU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZTtcbiAgICB9XG5cbiAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlN5c3RlbVNjdWxwdFNlcnZpY2Ugbm90IGluaXRpYWxpemVkXCIpKTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIHZhbGlkIGNhY2hlZCBkYXRhLCBqdXN0IHJldHVyblxuICAgIGlmIChTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQ2FjaGVWYWxpZCgpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0luaXRpYWxpemluZyA9IHRydWU7XG5cbiAgICAvLyBBZGQgdGltZW91dCBhbmQgcmV0cnkgbG9naWNcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gU3lzdGVtUHJvbXB0U2VydmljZS5sb2FkV2l0aFJldHJ5KFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgIGAke1N5c3RlbVByb21wdFNlcnZpY2Uuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvc3lzdGVtLXByb21wdHNgXG4gICAgICAgICk7XG4gICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0czogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UudXBkYXRlQ2FjaGUoZGF0YS5wcm9tcHRzKTtcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5zYXZlQ2FjaGVkUHJvbXB0cygpO1xuICAgICAgfSxcbiAgICAgIDMsIC8vIG1heCByZXRyaWVzXG4gICAgICAxMDAwIC8vIGRlbGF5IGJldHdlZW4gcmV0cmllc1xuICAgIClcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW5pdGlhbGl6aW5nIHN5c3RlbSBwcm9tcHRzIGNhY2hlOlwiLCBlcnJvcik7XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gbnVsbDtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcbiAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsTG9hZERvbmUgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2U7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBsb2FkV2l0aFJldHJ5KFxuICAgIGZuOiAoKSA9PiBQcm9taXNlPHZvaWQ+LFxuICAgIG1heFJldHJpZXM6IG51bWJlcixcbiAgICBkZWxheTogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4UmV0cmllczsgaSsrKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5yYWNlKFtcbiAgICAgICAgICBmbigpLFxuICAgICAgICAgIG5ldyBQcm9taXNlPHZvaWQ+KChfLCByZWplY3QpID0+XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoXCJPcGVyYXRpb24gdGltZW91dFwiKSksIDUwMDApXG4gICAgICAgICAgKVxuICAgICAgICBdKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChpID09PSBtYXhSZXRyaWVzIC0gMSkgdGhyb3cgZXJyb3I7XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheSkpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNYXggcmV0cmllcyBleGNlZWRlZFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlQ2FjaGVJbml0aWFsaXplZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5pc0NhY2hlVmFsaWQoKSkgcmV0dXJuO1xuXG4gICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2UpIHtcbiAgICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdFByb21pc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKTtcbiAgfVxuXG4gIGFzeW5jIGdldFN5c3RlbVByb21wdHMoKTogUHJvbWlzZTxTeXN0ZW1Qcm9tcHRQcmVzZXRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZXR1cm4gY2FjaGVkIGRhdGEgaW1tZWRpYXRlbHkgaWYgYXZhaWxhYmxlXG4gICAgICBpZiAoU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZT8ucHJvbXB0cykge1xuICAgICAgICAvLyBJZiBjYWNoZSBpcyBleHBpcmVkIGFuZCB0aGlzIGlzIGZpcnN0IGxvYWQsIHJlZnJlc2ggaW4gYmFja2dyb3VuZFxuICAgICAgICBpZiAoIVN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkgJiYgXG4gICAgICAgICAgICAhU3lzdGVtUHJvbXB0U2VydmljZS5pc0JhY2tncm91bmRSZWZyZXNoU2NoZWR1bGVkICYmXG4gICAgICAgICAgICAhU3lzdGVtUHJvbXB0U2VydmljZS5pc0luaXRpYWxMb2FkRG9uZSkge1xuICAgICAgICAgIFN5c3RlbVByb21wdFNlcnZpY2UuaXNJbml0aWFsTG9hZERvbmUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucmVmcmVzaENhY2hlSW5CYWNrZ3JvdW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGUucHJvbXB0cztcbiAgICAgIH1cblxuICAgICAgLy8gSWYgbm8gY2FjaGUgYXQgYWxsLCB3ZSBoYXZlIHRvIHdhaXQgZm9yIHRoZSBpbml0aWFsIGxvYWRcbiAgICAgIGF3YWl0IHRoaXMuZW5zdXJlQ2FjaGVJbml0aWFsaXplZCgpO1xuICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGU/LnByb21wdHMgPz8gW107XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGU/LnByb21wdHMgPz8gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWZyZXNoQ2FjaGVJbkJhY2tncm91bmQoKSB7XG4gICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuaXNCYWNrZ3JvdW5kUmVmcmVzaFNjaGVkdWxlZCkgcmV0dXJuO1xuXG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0JhY2tncm91bmRSZWZyZXNoU2NoZWR1bGVkID0gdHJ1ZTtcbiAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuaW5pdGlhbGl6ZUNhY2hlKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBCYWNrZ3JvdW5kIGNhY2hlIHJlZnJlc2ggZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmlzQmFja2dyb3VuZFJlZnJlc2hTY2hlZHVsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9LCAwKTtcbiAgfVxuXG4gIGFzeW5jIGdldFN5c3RlbVByb21wdEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8U3lzdGVtUHJvbXB0UHJlc2V0IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmVuc3VyZUNhY2hlSW5pdGlhbGl6ZWQoKTtcblxuICAgICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICAgIGlmIChcbiAgICAgICAgU3lzdGVtUHJvbXB0U2VydmljZS5pc0NhY2hlVmFsaWQoKSAmJlxuICAgICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlPy5ieUlkW2lkXVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLmJ5SWRbaWRdO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBjYWNoZSBpcyBtaXNzaW5nIG9yIGludmFsaWQsIGZldGNoIGFsbCBwcm9tcHRzIHRvIHJlZnJlc2ggY2FjaGVcbiAgICAgIGF3YWl0IHRoaXMuZ2V0U3lzdGVtUHJvbXB0cygpO1xuXG4gICAgICAvLyBSZXR1cm4gZnJvbSByZWZyZXNoZWQgY2FjaGVcbiAgICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlPy5ieUlkW2lkXSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0ICR7aWR9OmAsIGVycm9yKTtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGNhY2hlIGV2ZW4gaWYgZXhwaXJlZFxuICAgICAgaWYgKFN5c3RlbVByb21wdFNlcnZpY2UuY2FjaGU/LmJ5SWRbaWRdKSB7XG4gICAgICAgIHJldHVybiBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlLmJ5SWRbaWRdO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0U3lzdGVtUHJvbXB0VGVtcGxhdGUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7U3lzdGVtUHJvbXB0U2VydmljZS5zeXN0ZW1TY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9zeXN0ZW0tcHJvbXB0cy90ZW1wbGF0ZWBcbiAgICAgICk7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQgdGVtcGxhdGU6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIGRhdGEudGVtcGxhdGU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBGb3JjZSByZWZyZXNoIHRoZSBjYWNoZVxuICBhc3luYyByZWZyZXNoQ2FjaGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5jYWNoZSA9IG51bGw7XG4gICAgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0UHJvbWlzZSA9IG51bGw7XG4gICAgYXdhaXQgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKTtcbiAgfVxuXG4gIC8vIENsZWFyIHRoZSBjYWNoZVxuICBzdGF0aWMgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNhY2hlID0gbnVsbDtcbiAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmluaXRQcm9taXNlID0gbnVsbDtcbiAgfVxufVxuIiwgImV4cG9ydCBjb25zdCBFUlJPUl9DT0RFUyA9IHtcbiAgLy8gQXV0aGVudGljYXRpb24gRXJyb3JzXG4gIElOVkFMSURfTElDRU5TRTogXCJJTlZBTElEX0xJQ0VOU0VcIixcbiAgTElDRU5TRV9FWFBJUkVEOiBcIkxJQ0VOU0VfRVhQSVJFRFwiLFxuICBMSUNFTlNFX0RJU0FCTEVEOiBcIkxJQ0VOU0VfRElTQUJMRURcIixcbiAgUFJPX1JFUVVJUkVEOiBcIlBST19SRVFVSVJFRFwiLFxuXG4gIC8vIE1vZGVsIEVycm9yc1xuICBNT0RFTF9VTkFWQUlMQUJMRTogXCJNT0RFTF9VTkFWQUlMQUJMRVwiLFxuICBNT0RFTF9SRVFVRVNUX0VSUk9SOiBcIk1PREVMX1JFUVVFU1RfRVJST1JcIixcblxuICAvLyBTdHJlYW0gRXJyb3JzXG4gIFNUUkVBTV9FUlJPUjogXCJTVFJFQU1fRVJST1JcIixcbiAgSU5WQUxJRF9SRVNQT05TRTogXCJJTlZBTElEX1JFU1BPTlNFXCIsXG4gIE5PX0lNQUdFOiBcIk5PX0lNQUdFXCIsXG5cbiAgLy8gRmlsZSBQcm9jZXNzaW5nIEVycm9yc1xuICBGSUxFX05PVF9GT1VORDogXCJGSUxFX05PVF9GT1VORFwiLFxuICBGSUxFX1RPT19MQVJHRTogXCJGSUxFX1RPT19MQVJHRVwiLFxuICBVTlNVUFBPUlRFRF9GT1JNQVQ6IFwiVU5TVVBQT1JURURfRk9STUFUXCIsXG4gIFBST0NFU1NJTkdfRVJST1I6IFwiUFJPQ0VTU0lOR19FUlJPUlwiLFxuXG4gIC8vIEdlbmVyaWMgRXJyb3JzXG4gIFVOS05PV05fRVJST1I6IFwiVU5LTk9XTl9FUlJPUlwiLFxuICBRVU9UQV9FWENFRURFRDogXCJRVU9UQV9FWENFRURFRFwiLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgRXJyb3JDb2RlID0gKHR5cGVvZiBFUlJPUl9DT0RFUylba2V5b2YgdHlwZW9mIEVSUk9SX0NPREVTXTtcblxudHlwZSBFcnJvck1lc3NhZ2VGdW5jdGlvbiA9IChtb2RlbD86IHN0cmluZykgPT4gc3RyaW5nO1xudHlwZSBFcnJvck1lc3NhZ2VWYWx1ZSA9IHN0cmluZyB8IEVycm9yTWVzc2FnZUZ1bmN0aW9uO1xuXG5leHBvcnQgY29uc3QgRVJST1JfTUVTU0FHRVM6IFJlY29yZDxFcnJvckNvZGUsIEVycm9yTWVzc2FnZVZhbHVlPiA9IHtcbiAgW0VSUk9SX0NPREVTLklOVkFMSURfTElDRU5TRV06XG4gICAgXCJJbnZhbGlkIGxpY2Vuc2Uga2V5LiBQbGVhc2UgY2hlY2sgYW5kIHRyeSBhZ2Fpbi5cIixcbiAgW0VSUk9SX0NPREVTLkxJQ0VOU0VfRVhQSVJFRF06IFwiWW91ciBsaWNlbnNlIGhhcyBleHBpcmVkLlwiLFxuICBbRVJST1JfQ09ERVMuTElDRU5TRV9ESVNBQkxFRF06IFwiVGhpcyBsaWNlbnNlIGhhcyBiZWVuIGRpc2FibGVkLlwiLFxuICBbRVJST1JfQ09ERVMuUFJPX1JFUVVJUkVEXTpcbiAgICBcIlRoaXMgZmVhdHVyZSByZXF1aXJlcyBhIFBybyBzdWJzY3JpcHRpb24uIFBsZWFzZSB1cGdyYWRlLlwiLFxuICBbRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEVdOiAobW9kZWw/OiBzdHJpbmcpID0+XG4gICAgYE1vZGVsICR7bW9kZWwgfHwgXCJcIn0gaXMgY3VycmVudGx5IHVuYXZhaWxhYmxlLmAsXG4gIFtFUlJPUl9DT0RFUy5NT0RFTF9SRVFVRVNUX0VSUk9SXTogKG1vZGVsPzogc3RyaW5nKSA9PlxuICAgIGBNb2RlbCAke21vZGVsIHx8IFwiXCJ9IGNhbm5vdCBwcm9jZXNzIHRoaXMgcmVxdWVzdC5gLFxuICBbRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SXTogXCJTdHJlYW1pbmcgZmFpbGVkLiBQbGVhc2UgdHJ5IGFnYWluLlwiLFxuICBbRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRV06XG4gICAgXCJJbnZhbGlkIHJlc3BvbnNlIHJlY2VpdmVkIGZyb20gc2VydmVyLiBQbGVhc2UgdHJ5IGFnYWluLlwiLFxuICBbRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUl06XG4gICAgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIG9yIGNvbnRhY3Qgc3VwcG9ydC5cIixcbiAgW0VSUk9SX0NPREVTLlFVT1RBX0VYQ0VFREVEXTpcbiAgICBcIllvdSBoYXZlIGV4Y2VlZGVkIHlvdXIgcXVvdGEuIFBsZWFzZSB1cGdyYWRlIHlvdXIgcGxhbi5cIixcbiAgW0VSUk9SX0NPREVTLk5PX0lNQUdFXTogXCJObyBpbWFnZSBpbiBjbGlwYm9hcmRcIixcbiAgW0VSUk9SX0NPREVTLkZJTEVfTk9UX0ZPVU5EXTogXCJGaWxlIG5vdCBmb3VuZFwiLFxuICBbRVJST1JfQ09ERVMuRklMRV9UT09fTEFSR0VdOiBcIkZpbGUgdG9vIGxhcmdlIChtYXggMTBNQilcIixcbiAgW0VSUk9SX0NPREVTLlVOU1VQUE9SVEVEX0ZPUk1BVF06IFwiVW5zdXBwb3J0ZWQgZmlsZSBmb3JtYXRcIixcbiAgW0VSUk9SX0NPREVTLlBST0NFU1NJTkdfRVJST1JdOiBcIkZhaWxlZCB0byBwcm9jZXNzIGZpbGVcIixcbn07XG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1TY3VscHRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyBjb2RlOiBFcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SLFxuICAgIHB1YmxpYyBzdGF0dXNDb2RlOiBudW1iZXIgPSA1MDAsXG4gICAgcHVibGljIG1ldGFkYXRhPzoge1xuICAgICAgcHJvdmlkZXI/OiBzdHJpbmc7XG4gICAgICBtb2RlbD86IHN0cmluZztcbiAgICAgIHNob3VsZFJlc3VibWl0PzogYm9vbGVhbjtcbiAgICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgICB9XG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9IFwiU3lzdGVtU2N1bHB0RXJyb3JcIjtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGNvZGU6IEVycm9yQ29kZSwgbW9kZWw/OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBtZXNzYWdlID0gRVJST1JfTUVTU0FHRVNbY29kZV07XG4gIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIG1lc3NhZ2UobW9kZWwpO1xuICB9XG4gIHJldHVybiBtZXNzYWdlO1xufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdEVycm9yIH0gZnJvbSBcIi4vZXJyb3JzXCI7XG5cbmV4cG9ydCBjbGFzcyBJbWFnZVByb2Nlc3NvciB7XG4gIHByaXZhdGUgc3RhdGljIE1BWF9GSUxFX1NJWkUgPSAxMCAqIDEwMjQgKiAxMDI0OyBcbiAgcHJpdmF0ZSBzdGF0aWMgU1VQUE9SVEVEX0ZPUk1BVFMgPSBuZXcgU2V0KFtcbiAgICBcImpwZ1wiLFxuICAgIFwianBlZ1wiLFxuICAgIFwicG5nXCIsXG4gICAgXCJnaWZcIixcbiAgICBcIndlYnBcIixcbiAgXSk7XG5cbiAgc3RhdGljIGFzeW5jIHByb2Nlc3NJbWFnZShmaWxlOiBURmlsZSwgYXBwOiBBcHApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIFxuICAgIGlmICghZmlsZSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFwiRmlsZSBub3QgZm91bmRcIiwgXCJGSUxFX05PVF9GT1VORFwiLCA0MDQpO1xuICAgIH1cblxuICAgIFxuICAgIGlmIChmaWxlLnN0YXQuc2l6ZSA+IEltYWdlUHJvY2Vzc29yLk1BWF9GSUxFX1NJWkUpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJJbWFnZSB0b28gbGFyZ2UgKG1heCAxME1CKVwiLFxuICAgICAgICBcIkZJTEVfVE9PX0xBUkdFXCIsXG4gICAgICAgIDQxM1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBcbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgIGlmICghSW1hZ2VQcm9jZXNzb3IuU1VQUE9SVEVEX0ZPUk1BVFMuaGFzKGV4dGVuc2lvbikpIHtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJVbnN1cHBvcnRlZCBpbWFnZSBmb3JtYXRcIixcbiAgICAgICAgXCJVTlNVUFBPUlRFRF9GT1JNQVRcIixcbiAgICAgICAgNDE1XG4gICAgICApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBcbiAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG5cbiAgICAgIFxuICAgICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgZGF0YVVybCA9IHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nO1xuICAgICAgICAgIHJlc29sdmUoZGF0YVVybCk7XG4gICAgICAgIH07XG4gICAgICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KHJlYWRlci5lcnJvcik7XG5cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHR5cGUgPSBgaW1hZ2UvJHtleHRlbnNpb24gPT09IFwianBnXCIgPyBcImpwZWdcIiA6IGV4dGVuc2lvbn1gO1xuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2FycmF5QnVmZmVyXSwgeyB0eXBlIH0pO1xuXG4gICAgICAgIFxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gYmFzZTY0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiSW1hZ2UgcHJvY2Vzc2luZyBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgXCJGYWlsZWQgdG8gcHJvY2VzcyBpbWFnZVwiLFxuICAgICAgICBcIlBST0NFU1NJTkdfRVJST1JcIixcbiAgICAgICAgNTAwXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzQ2xpcGJvYXJkSW1hZ2UoXG4gICAgY2xpcGJvYXJkRGF0YTogRGF0YVRyYW5zZmVyXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZmlsZSA9IGNsaXBib2FyZERhdGEuZmlsZXNbMF07XG4gICAgaWYgKCFmaWxlIHx8ICFmaWxlLnR5cGUuc3RhcnRzV2l0aChcImltYWdlL1wiKSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFwiTm8gaW1hZ2UgaW4gY2xpcGJvYXJkXCIsIFwiTk9fSU1BR0VcIiwgNDAwKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsZS5zaXplID4gdGhpcy5NQVhfRklMRV9TSVpFKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIFwiSW1hZ2UgdG9vIGxhcmdlIChtYXggMTBNQilcIixcbiAgICAgICAgXCJGSUxFX1RPT19MQVJHRVwiLFxuICAgICAgICA0MTNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0IGFzIHN0cmluZyk7XG4gICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChyZWFkZXIuZXJyb3IpO1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsICIvLyBCYXNlIFVSTCBmb3IgQVBJIHJlcXVlc3RzXG5leHBvcnQgY29uc3QgQVBJX0JBU0VfVVJMID1cbiAgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiXG4gICAgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9hcGkvdjFcIlxuICAgIDogXCJodHRwczovL2FwaS5zeXN0ZW1zY3VscHQuY29tL2FwaS92MVwiO1xuXG5leHBvcnQgY29uc3QgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMgPSB7XG4gIExJQ0VOU0U6IHtcbiAgICBWQUxJREFURTogKGtleTogc3RyaW5nKSA9PiBgL2FwaS92MS9saWNlbnNlL3ZhbGlkYXRlLyR7a2V5fWAsXG4gIH0sXG4gIE1PREVMUzoge1xuICAgIExJU1Q6IFwiL2FwaS92MS9tb2RlbHNcIixcbiAgICBHRVQ6IChtb2RlbElkOiBzdHJpbmcpID0+IGAvYXBpL3YxL21vZGVscy8ke21vZGVsSWR9YCxcbiAgfSxcbiAgQ0hBVDoge1xuICAgIENPTVBMRVRJT05TOiBcIi9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICB9LFxuICBTWVNURU1fUFJPTVBUUzoge1xuICAgIEdFVDogKGlkOiBzdHJpbmcpID0+IGAvYXBpL3YxL3N5c3RlbS1wcm9tcHRzLyR7aWR9YCxcbiAgICBMSVNUOiBcIi9hcGkvdjEvc3lzdGVtLXByb21wdHNcIixcbiAgfSxcbiAgRE9DVU1FTlRTOiB7XG4gICAgUFJPQ0VTUzogXCIvYXBpL3YxL2RvY3VtZW50cy9wcm9jZXNzXCIsXG4gICAgR0VUOiAoaWQ6IHN0cmluZykgPT4gYC9hcGkvdjEvZG9jdW1lbnRzLyR7aWR9YCxcbiAgICBET1dOTE9BRDogKGlkOiBzdHJpbmcpID0+IGAvYXBpL3YxL2RvY3VtZW50cy8ke2lkfS9kb3dubG9hZGAsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgT1BFTlJPVVRFUl9BUElfRU5EUE9JTlRTID0ge1xuICBDSEFUOiB7XG4gICAgQ09NUExFVElPTjogXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL2NoYXQvY29tcGxldGlvbnNcIixcbiAgICBNT0RFTFM6IFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9tb2RlbHNcIixcbiAgfSxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBMT0NBTF9BUElfRU5EUE9JTlRTID0ge1xuICBDSEFUOiB7XG4gICAgQ09NUExFVElPTjogXCJodHRwOi8vbG9jYWxob3N0OjgwMDAvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICAgIE1PREVMUzogXCJodHRwOi8vbG9jYWxob3N0OjgwMDAvdjEvbW9kZWxzXCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgaW50ZXJmYWNlIEFwaUVycm9yRGV0YWlscyB7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgY29kZTogc3RyaW5nO1xuICBzdGF0dXNDb2RlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpUmVzcG9uc2U8VD4ge1xuICBzdGF0dXM6IFwic3VjY2Vzc1wiIHwgXCJlcnJvclwiO1xuICBkYXRhOiBUIHwgbnVsbDtcbiAgZXJyb3I/OiBBcGlFcnJvckRldGFpbHM7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGljZW5zZVZhbGlkYXRpb25SZXNwb25zZSB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIGNyZWRpdHNfYmFsYW5jZTogbnVtYmVyO1xuICBzdWJzY3JpcHRpb25fc3RhdHVzOiBzdHJpbmc7XG4gIGxpY2Vuc2Vfa2V5OiBzdHJpbmc7XG4gIGlzX3BybzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb2tlbkJhbGFuY2VSZXNwb25zZSB7XG4gIGJhbGFuY2U6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGVja291dFJlc3BvbnNlIHtcbiAgY2hlY2tvdXRVcmw6IHN0cmluZztcbiAgc2Vzc2lvbklkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlblJvdXRlckNvbXBsZXRpb25SZXNwb25zZSB7XG4gIGlkOiBzdHJpbmc7XG4gIGNob2ljZXM6IEFycmF5PHtcbiAgICBtZXNzYWdlOiB7XG4gICAgICByb2xlOiBzdHJpbmc7XG4gICAgICBjb250ZW50OiBzdHJpbmc7XG4gICAgfTtcbiAgICBmaW5pc2hfcmVhc29uOiBzdHJpbmc7XG4gIH0+O1xufVxuXG5leHBvcnQgY29uc3QgU1lTVEVNU0NVTFBUX0FQSV9IRUFERVJTID0ge1xuICBERUZBVUxUOiB7XG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG4gIFdJVEhfTElDRU5TRTogKGxpY2Vuc2VLZXk6IHN0cmluZykgPT4gKHtcbiAgICAuLi5TWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuREVGQVVMVCxcbiAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7bGljZW5zZUtleX1gLFxuICB9KSxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBPUEVOUk9VVEVSX0FQSV9IRUFERVJTID0ge1xuICBERUZBVUxUOiAoYXBpS2V5OiBzdHJpbmcpID0+ICh7XG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FwaUtleX1gLFxuICAgIFwiSFRUUC1SZWZlcmVyXCI6IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCIsXG4gICAgXCJYLVRpdGxlXCI6IFwiU3lzdGVtU2N1bHB0IEFJXCIsXG4gIH0pLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IExPQ0FMX0FQSV9IRUFERVJTID0ge1xuICBERUZBVUxUOiB7XG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuIiwgImltcG9ydCB7IEN1c3RvbVByb3ZpZGVyIH0gZnJvbSBcInNyYy90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcInNyYy9tYWluXCI7XG5cbmludGVyZmFjZSBUZXN0Q29ubmVjdGlvblJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yPzogc3RyaW5nO1xuICBtb2RlbHM/OiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBPcGVuUm91dGVyTW9kZWwge1xuICBpZDogc3RyaW5nO1xuICBwcmljaW5nOiB7XG4gICAgcHJvbXB0OiBzdHJpbmc7XG4gICAgY29tcGxldGlvbjogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgc3RhdGljIGNvbm5lY3Rpb25UZXN0Q2FjaGU6IE1hcDxcbiAgICBzdHJpbmcsXG4gICAge1xuICAgICAgcmVzdWx0OiBUZXN0Q29ubmVjdGlvblJlc3VsdDtcbiAgICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICAgIH1cbiAgPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBzdGF0aWMgY29ubmVjdGlvblRlc3RQcm9taXNlczogTWFwPFxuICAgIHN0cmluZyxcbiAgICBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PlxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IENBQ0hFX0RVUkFUSU9OID0gMzAgKiA2MCAqIDEwMDA7IC8vIDMwIG1pbnV0ZXNcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IGNvbm5lY3Rpb24gdG8gYSBwcm92aWRlciBieSBhdHRlbXB0aW5nIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcbiAgICogRm9yIE9wZW5Sb3V0ZXIsIHdlIGFsc28gdmFsaWRhdGUgdGhlIEFQSSBrZXkgYnkgbWFraW5nIGEgbWluaW1hbCBjb21wbGV0aW9uIHJlcXVlc3RcbiAgICovXG4gIGFzeW5jIHRlc3RDb25uZWN0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlclxuICApOiBQcm9taXNlPFRlc3RDb25uZWN0aW9uUmVzdWx0PiB7XG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RDYWNoZS5nZXQocHJvdmlkZXIuaWQpO1xuICAgIGlmIChjYWNoZWQgJiYgRGF0ZS5ub3coKSAtIGNhY2hlZC5yZXN1bHQudGltZXN0YW1wIDwgdGhpcy5DQUNIRV9EVVJBVElPTikge1xuICAgICAgcmV0dXJuIGNhY2hlZC5yZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSB0ZXN0aW5nIHRoaXMgcHJvdmlkZXJcbiAgICBjb25zdCBleGlzdGluZ1Byb21pc2UgPSBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5nZXQoXG4gICAgICBwcm92aWRlci5pZFxuICAgICk7XG4gICAgaWYgKGV4aXN0aW5nUHJvbWlzZSkge1xuICAgICAgcmV0dXJuIGV4aXN0aW5nUHJvbWlzZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBuZXcgdGVzdFxuICAgIGNvbnN0IHRlc3RQcm9taXNlID0gdGhpcy5wZXJmb3JtQ29ubmVjdGlvblRlc3QocHJvdmlkZXIpO1xuICAgIEN1c3RvbVByb3ZpZGVyU2VydmljZS5jb25uZWN0aW9uVGVzdFByb21pc2VzLnNldChwcm92aWRlci5pZCwgdGVzdFByb21pc2UpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RQcm9taXNlO1xuICAgICAgLy8gQ2FjaGUgc3VjY2Vzc2Z1bCByZXN1bHRzXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlLmNvbm5lY3Rpb25UZXN0Q2FjaGUuc2V0KHByb3ZpZGVyLmlkLCB7XG4gICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBDdXN0b21Qcm92aWRlclNlcnZpY2UuY29ubmVjdGlvblRlc3RQcm9taXNlcy5kZWxldGUocHJvdmlkZXIuaWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gYWN0dWFsbHkgcGVyZm9ybSB0aGUgY29ubmVjdGlvbiB0ZXN0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1Db25uZWN0aW9uVGVzdChcbiAgICBwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXJcbiAgKTogUHJvbWlzZTxUZXN0Q29ubmVjdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLmdldE1vZGVscyhwcm92aWRlcik7XG5cbiAgICAgIC8vIEZvciBPcGVuUm91dGVyLCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBBUEkga2V5IGJ5IG1ha2luZyBhIHRlc3QgY29tcGxldGlvblxuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnZhbGlkYXRlT3BlblJvdXRlcktleShwcm92aWRlciwgbW9kZWxzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbW9kZWxzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIkNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6XCIsIGVycm9yKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB0aGlzLmdldEVycm9yTWVzc2FnZShlcnJvciksXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIE9wZW5Sb3V0ZXIgQVBJIGtleSBieSBtYWtpbmcgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZU9wZW5Sb3V0ZXJLZXkoXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyLFxuICAgIG1vZGVsSWRzOiBzdHJpbmdbXVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cHJvdmlkZXIuYXBpS2V5fWAsXG4gICAgICBcIkhUVFAtUmVmZXJlclwiOiBcImh0dHBzOi8vc3lzdGVtc2N1bHB0LmNvbVwiLFxuICAgICAgXCJYLVRpdGxlXCI6IFwiU3lzdGVtU2N1bHB0IEFJXCIsXG4gICAgfTtcblxuICAgIC8vIE1ha2UgYSBtaW5pbWFsIGNvbXBsZXRpb24gcmVxdWVzdCB3aXRoIHRoZSBmcmVlIG1vZGVsXG4gICAgY29uc3QgY29tcGxldGlvblJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6IFwibWV0YS1sbGFtYS9sbGFtYS0zLThiLWluc3RydWN0OmZyZWVcIixcbiAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IFwiSGlcIiB9XSxcbiAgICAgICAgICBtYXhfdG9rZW5zOiAxLFxuICAgICAgICB9KSxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDEwMDAwKSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFjb21wbGV0aW9uUmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IGNvbXBsZXRpb25SZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkludmFsaWQgQVBJIGtleS4gUGxlYXNlIGNoZWNrIHlvdXIgT3BlblJvdXRlciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDAyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkluc3VmZmljaWVudCBjcmVkaXRzLiBQbGVhc2UgYWRkIGNyZWRpdHMgdG8geW91ciBPcGVuUm91dGVyIGFjY291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcGxldGlvblJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlJhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gaW4gYSBmZXcgbWludXRlcy5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQVBJIGtleSB2YWxpZGF0aW9uIGZhaWxlZDogJHtcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgY29tcGxldGlvblJlc3BvbnNlLnN0YXR1c1RleHRcbiAgICAgICAgfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSBhIHByb3ZpZGVyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldE1vZGVscyhwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH07XG5cbiAgICAvLyBBZGQgQVBJIGtleSBpZiBwcmVzZW50XG4gICAgaWYgKHByb3ZpZGVyLmFwaUtleSkge1xuICAgICAgaWYgKHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgICAgaGVhZGVyc1tcIkhUVFAtUmVmZXJlclwiXSA9IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCI7IC8vIFJlcXVpcmVkIGJ5IE9wZW5Sb3V0ZXJcbiAgICAgICAgaGVhZGVyc1tcIlgtVGl0bGVcIl0gPSBcIlN5c3RlbVNjdWxwdCBBSVwiOyAvLyBSZXF1aXJlZCBieSBPcGVuUm91dGVyXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtwcm92aWRlci5hcGlLZXl9YDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEaWZmZXJlbnQgZW5kcG9pbnRzIGJhc2VkIG9uIHByb3ZpZGVyIHR5cGUgYW5kIFVSTFxuICAgIGxldCBlbmRwb2ludDogc3RyaW5nO1xuICAgIGlmIChwcm92aWRlci5lbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIikpIHtcbiAgICAgIGVuZHBvaW50ID0gXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL21vZGVsc1wiOyAvLyBPcGVuUm91dGVyIGhhcyBhIHNwZWNpZmljIG1vZGVscyBlbmRwb2ludFxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3IgT3BlbkFJLWNvbXBhdGlibGUgZW5kcG9pbnRzLCBlbnN1cmUgd2UncmUgdXNpbmcgdGhlIC92MS9tb2RlbHMgcGF0aFxuICAgICAgY29uc3QgYmFzZVVybCA9IHByb3ZpZGVyLmVuZHBvaW50LnJlcGxhY2UoL1xcLyskLywgXCJcIik7IC8vIFJlbW92ZSB0cmFpbGluZyBzbGFzaGVzXG4gICAgICBlbmRwb2ludCA9IGJhc2VVcmwuZW5kc1dpdGgoXCIvdjFcIilcbiAgICAgICAgPyBgJHtiYXNlVXJsfS9tb2RlbHNgXG4gICAgICAgIDogYmFzZVVybC5lbmRzV2l0aChcIi92MS9tb2RlbHNcIilcbiAgICAgICAgPyBiYXNlVXJsXG4gICAgICAgIDogYCR7YmFzZVVybH0vdjEvbW9kZWxzYDtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgLy8gQWRkIHRpbWVvdXRcbiAgICAgIHNpZ25hbDogQWJvcnRTaWduYWwudGltZW91dCgxMDAwMCksIC8vIDEwIHNlY29uZCB0aW1lb3V0XG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBBUEkga2V5LiBQbGVhc2UgY2hlY2sgeW91ciBBUEkga2V5IGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQWNjZXNzIGRlbmllZC4gUGxlYXNlIHZlcmlmeSB5b3VyIEFQSSBrZXkgaGFzIHRoZSBjb3JyZWN0IHBlcm1pc3Npb25zLlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkFQSSBlbmRwb2ludCBub3QgZm91bmQuIFBsZWFzZSBjaGVjayB0aGUgVVJMIGFuZCB0cnkgYWdhaW4uXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEhUVFAgZXJyb3I6ICR7ZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgLy8gQWxsIHByb3ZpZGVycyB1c2UgT3BlbkFJIGZvcm1hdDogeyBkYXRhOiBbeyBpZDogc3RyaW5nLCAuLi4gfV0gfVxuICAgIHJldHVybiAoZGF0YS5kYXRhPy5tYXAoKG1vZGVsOiBhbnkpID0+IG1vZGVsLmlkKSB8fCBbXSkuZmlsdGVyKFxuICAgICAgKGlkOiBzdHJpbmcpID0+ICFpZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwid2hpc3BlclwiKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgdXNlci1mcmllbmRseSBlcnJvciBtZXNzYWdlIGZyb20gYW4gZXJyb3Igb2JqZWN0XG4gICAqL1xuICBwcml2YXRlIGdldEVycm9yTWVzc2FnZShlcnJvcjogYW55KTogc3RyaW5nIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgaWYgKGVycm9yLm5hbWUgPT09IFwiQWJvcnRFcnJvclwiKSB7XG4gICAgICAgIHJldHVybiBcIkNvbm5lY3Rpb24gdGltZWQgb3V0LiBQbGVhc2UgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCB0cnkgYWdhaW4uXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiB0aGUgZXJyb3IgbWVzc2FnZSBkaXJlY3RseSBzaW5jZSB3ZSd2ZSBhbHJlYWR5IG1hZGUgaXQgdXNlci1mcmllbmRseVxuICAgICAgLy8gaW4gdmFsaWRhdGVPcGVuUm91dGVyS2V5IGFuZCBnZXRNb2RlbHMgbWV0aG9kc1xuICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQgaWYgdGhlIGlzc3VlIHBlcnNpc3RzLlwiO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgcmVxdWVzdFVybCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIENoYXRNZXNzYWdlLFxuICBTeXN0ZW1TY3VscHRNb2RlbCxcbiAgU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bmssXG4gIFN5c3RlbVNjdWxwdFNldHRpbmdzLFxuICBDdXN0b21Qcm92aWRlcixcbn0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQge1xuICBTeXN0ZW1TY3VscHRFcnJvcixcbiAgRVJST1JfQ09ERVMsXG4gIEVycm9yQ29kZSxcbiAgZ2V0RXJyb3JNZXNzYWdlLFxufSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBJbWFnZVByb2Nlc3NvciB9IGZyb20gXCIuLi91dGlscy9JbWFnZVByb2Nlc3NvclwiO1xuaW1wb3J0IHtcbiAgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMsXG4gIFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUyxcbiAgTGljZW5zZVZhbGlkYXRpb25SZXNwb25zZSxcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy9hcGlcIjtcbmltcG9ydCB7IEN1c3RvbVByb3ZpZGVyU2VydmljZSB9IGZyb20gXCIuL0N1c3RvbVByb3ZpZGVyU2VydmljZVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykge1xuICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgY29uc3QgdiA9IGMgPT09IFwieFwiID8gciA6IChyICYgMHgzKSB8IDB4ODtcbiAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gIH0pO1xufVxuXG5leHBvcnQgY2xhc3MgU3lzdGVtU2N1bHB0U2VydmljZSB7XG4gIHByaXZhdGUgbGljZW5zZUtleTogc3RyaW5nO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgc3RhdGljIGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbiAgcHJpdmF0ZSBpc0luc2lkZVRoaW5rVGFncyA9IGZhbHNlO1xuICBwcml2YXRlIGhhc0xvZ2dlZERldk1vZGUgPSBmYWxzZTsgLy8gVHJhY2sgaWYgd2UndmUgbG9nZ2VkIGRldiBtb2RlIHN0YXR1c1xuICBwcml2YXRlIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlO1xuXG4gIHB1YmxpYyBnZXQgYmFzZVVybCgpOiBzdHJpbmcge1xuICAgIC8vIE9ubHkgbG9nIGRldiBtb2RlIHN0YXR1cyBvbmNlXG4gICAgaWYgKCF0aGlzLmhhc0xvZ2dlZERldk1vZGUpIHtcbiAgICAgIHRoaXMuaGFzTG9nZ2VkRGV2TW9kZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gSWYgaW4gZGV2ZWxvcG1lbnQgbW9kZSwgdXNlIHNlcnZlclVybCAod2hpY2ggZGVmYXVsdHMgdG8gbG9jYWxob3N0OjMwMDEpXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5zZXJ2ZXJVcmw7XG4gICAgfVxuXG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgdXNlIHRoZSBwcm9kdWN0aW9uIFVSTFxuICAgIHJldHVybiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb21cIjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZXh0cmFjdGlvbnNEaXJlY3RvcnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5leHRyYWN0aW9uc0RpcmVjdG9yeSA/PyBcIlwiO1xuICB9XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MsIGFwcDogQXBwKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMubGljZW5zZUtleSA9IHNldHRpbmdzLmxpY2Vuc2VLZXk7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgc2V0dGluZ3M6IFN5c3RlbVNjdWxwdFNldHRpbmdzLFxuICAgIGFwcDogQXBwXG4gICk6IFN5c3RlbVNjdWxwdFNlcnZpY2Uge1xuICAgIGlmICghU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZSA9IG5ldyBTeXN0ZW1TY3VscHRTZXJ2aWNlKHNldHRpbmdzLCBhcHApO1xuICAgIH0gZWxzZSB7XG4gICAgICBTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICBTeXN0ZW1TY3VscHRTZXJ2aWNlLmluc3RhbmNlLmxpY2Vuc2VLZXkgPSBzZXR0aW5ncy5saWNlbnNlS2V5O1xuICAgIH1cbiAgICByZXR1cm4gU3lzdGVtU2N1bHB0U2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKTogdm9pZCB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMubGljZW5zZUtleSA9IHNldHRpbmdzLmxpY2Vuc2VLZXk7XG4gICAgaWYgKCF0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSAmJiBwbHVnaW4pIHtcbiAgICAgIHRoaXMuY3VzdG9tUHJvdmlkZXJTZXJ2aWNlID0gbmV3IEN1c3RvbVByb3ZpZGVyU2VydmljZShwbHVnaW4pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbWFrZVJlcXVlc3Q8VD4oXG4gICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBtZXRob2Q/OiBzdHJpbmc7XG4gICAgICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgICAgIGJvZHk/OiBzdHJpbmc7XG4gICAgICBzaG93Tm90aWNlcz86IGJvb2xlYW47XG4gICAgICByZXF1aXJlc1Bybz86IGJvb2xlYW47XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8VD4ge1xuICAgIGlmIChvcHRpb25zLnJlcXVpcmVzUHJvICYmICFlbmRwb2ludC5pbmNsdWRlcyhcIi9saWNlbnNlL3ZhbGlkYXRlXCIpKSB7XG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpY2Vuc2UodHJ1ZSk7XG4gICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5QUk9fUkVRVUlSRUQpLFxuICAgICAgICAgIEVSUk9SX0NPREVTLlBST19SRVFVSVJFRCxcbiAgICAgICAgICA0MDNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBoZWFkZXJzID0gdGhpcy5saWNlbnNlS2V5XG4gICAgICA/IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUy5XSVRIX0xJQ0VOU0UodGhpcy5saWNlbnNlS2V5KVxuICAgICAgOiBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMuREVGQVVMVDtcblxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0ke2VuZHBvaW50fWA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0VXJsKHtcbiAgICAgIHVybCxcbiAgICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QgfHwgXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgLi4uaGVhZGVycyxcbiAgICAgICAgLi4uKG9wdGlvbnMuaGVhZGVycyB8fCB7fSksXG4gICAgICB9LFxuICAgICAgYm9keTogb3B0aW9ucy5ib2R5LFxuICAgICAgdGhyb3c6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgbGV0IGFwaVJlc3BvbnNlOiBhbnk7XG4gICAgdHJ5IHtcbiAgICAgIGFwaVJlc3BvbnNlID0gcmVzcG9uc2UuanNvbjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIGdldEVycm9yTWVzc2FnZShFUlJPUl9DT0RFUy5JTlZBTElEX1JFU1BPTlNFKSxcbiAgICAgICAgRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRSxcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCB8fCBhcGlSZXNwb25zZS5zdGF0dXMgPT09IFwiZXJyb3JcIikge1xuICAgICAgdGhpcy5oYW5kbGVBcGlFcnJvcihlbmRwb2ludCwgcmVzcG9uc2UsIGFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgcmVzcG9uc2UgaXMgd3JhcHBlZCBpbiBhIGRhdGEgZmllbGQsIHJldHVybiB0aGF0LCBvdGhlcndpc2UgcmV0dXJuIHRoZSB3aG9sZSByZXNwb25zZVxuICAgIHJldHVybiAoXG4gICAgICBhcGlSZXNwb25zZS5kYXRhICE9PSB1bmRlZmluZWQgPyBhcGlSZXNwb25zZS5kYXRhIDogYXBpUmVzcG9uc2VcbiAgICApIGFzIFQ7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUFwaUVycm9yKFxuICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgcmVzcG9uc2U6IHsgc3RhdHVzOiBudW1iZXIgfSxcbiAgICBhcGlSZXNwb25zZTogYW55XG4gICk6IG5ldmVyIHtcbiAgICBpZiAoYXBpUmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yQ29kZSA9IChhcGlSZXNwb25zZS5lcnJvci5jb2RlIHx8XG4gICAgICAgIEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IpIGFzIEVycm9yQ29kZTtcbiAgICAgIGNvbnN0IHN0YXR1c0NvZGUgPSBhcGlSZXNwb25zZS5lcnJvci5zdGF0dXNDb2RlIHx8IHJlc3BvbnNlLnN0YXR1cztcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZShlcnJvckNvZGUsIGFwaVJlc3BvbnNlLmVycm9yLm1vZGVsKTtcblxuICAgICAgY29uc3QgbWV0YWRhdGE6IFN5c3RlbVNjdWxwdEVycm9yW1wibWV0YWRhdGFcIl0gPSB7fTtcblxuICAgICAgaWYgKFxuICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFIHx8XG4gICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfUkVRVUVTVF9FUlJPUlxuICAgICAgKSB7XG4gICAgICAgIG1ldGFkYXRhLnNob3VsZFJlc3VibWl0ID0gdHJ1ZTtcbiAgICAgICAgbWV0YWRhdGEubW9kZWwgPSBhcGlSZXNwb25zZS5lcnJvci5tb2RlbDtcbiAgICAgIH1cblxuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgc3RhdHVzQ29kZSxcbiAgICAgICAgbWV0YWRhdGFcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgZ2V0RXJyb3JNZXNzYWdlKEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IpLFxuICAgICAgRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUixcbiAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVN0cmVhbUVycm9yKFxuICAgIHJlc3BvbnNlOiBSZXNwb25zZSxcbiAgICBpc0N1c3RvbVByb3ZpZGVyID0gZmFsc2VcbiAgKTogUHJvbWlzZTxuZXZlcj4ge1xuICAgIC8vIExvZyByYXcgcmVzcG9uc2UgZmlyc3RcbiAgICBjb25zb2xlLmVycm9yKFwiU3RyZWFtIGVycm9yIHJlc3BvbnNlOlwiLCB7XG4gICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICBjb250ZW50VHlwZTogcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJjb250ZW50LXR5cGVcIiksXG4gICAgICBpc0N1c3RvbVByb3ZpZGVyLFxuICAgIH0pO1xuXG4gICAgbGV0IGVycm9yQ29kZTogRXJyb3JDb2RlID0gRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SO1xuICAgIGxldCBtZXRhZGF0YTogU3lzdGVtU2N1bHB0RXJyb3JbXCJtZXRhZGF0YVwiXSA9IHt9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTdHJlYW0gZXJyb3IgZGF0YTpcIiwgZXJyb3JEYXRhKTtcblxuICAgICAgLy8gSGFuZGxlIGN1c3RvbSBwcm92aWRlciBlcnJvcnNcbiAgICAgIGlmIChpc0N1c3RvbVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIFByZXNlcnZlIHJhdyBlcnJvciBkYXRhXG4gICAgICAgIG1ldGFkYXRhLnJhd0Vycm9yID0gZXJyb3JEYXRhO1xuICAgICAgICBtZXRhZGF0YS5wcm92aWRlciA9IFwiY3VzdG9tXCI7XG5cbiAgICAgICAgLy8gQ29tbW9uIGVycm9yIHN0YXR1cyBjb2RlcyBmb3IgT3BlbkFJLWNvbXBhdGlibGUgQVBJc1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICBlcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5JTlZBTElEX0xJQ0VOU0U7XG4gICAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgICAgZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IFwiSW52YWxpZCBBUEkga2V5IGZvciBjdXN0b20gcHJvdmlkZXJcIixcbiAgICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQyOSkge1xuICAgICAgICAgIGVycm9yQ29kZSA9IEVSUk9SX0NPREVTLlFVT1RBX0VYQ0VFREVEO1xuICAgICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fFxuICAgICAgICAgICAgICBcIlJhdGUgbGltaXQgZXhjZWVkZWQgZm9yIGN1c3RvbSBwcm92aWRlclwiLFxuICAgICAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgZXJyb3JDb2RlID0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEU7XG4gICAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgICAgZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IFwiTW9kZWwgbm90IGZvdW5kIG9yIGVuZHBvaW50IGluY29ycmVjdFwiLFxuICAgICAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9yIG90aGVyIGVycm9ycywgcGFzcyB0aHJvdWdoIHRoZSBwcm92aWRlcidzIGVycm9yIG1lc3NhZ2VcbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVycm9yRGF0YS5lcnJvcikge1xuICAgICAgICBlcnJvckNvZGUgPSAoZXJyb3JEYXRhLmVycm9yLmNvZGUgfHxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IpIGFzIEVycm9yQ29kZTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgZXJyb3JDb2RlID09PSBFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRSB8fFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfUkVRVUVTVF9FUlJPUlxuICAgICAgICApIHtcbiAgICAgICAgICBtZXRhZGF0YSA9IHtcbiAgICAgICAgICAgIG1vZGVsOiBlcnJvckRhdGEuZXJyb3IubW9kZWwsXG4gICAgICAgICAgICBzaG91bGRSZXN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgICAgIHJhd0Vycm9yOiBlcnJvckRhdGEsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExvZyBwYXJzZSBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHBhcnNpbmcgZXJyb3IgcmVzcG9uc2U6XCIsIGUpO1xuXG4gICAgICAvLyBJZiB3ZSBjYW4ndCBwYXJzZSB0aGUgZXJyb3IgcmVzcG9uc2Ugb3IgaXQncyBhbHJlYWR5IGEgU3lzdGVtU2N1bHB0RXJyb3IsIHRocm93IGl0XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yKSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UgdXNlIGRlZmF1bHQgc3RyZWFtIGVycm9yXG4gICAgICBlcnJvckNvZGUgPSBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1I7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgZ2V0RXJyb3JNZXNzYWdlKGVycm9yQ29kZSwgbWV0YWRhdGEubW9kZWwpLFxuICAgICAgZXJyb3JDb2RlLFxuICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgbWV0YWRhdGFcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGVMaWNlbnNlKGZvcmNlQ2hlY2sgPSBmYWxzZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5saWNlbnNlS2V5KSByZXR1cm4gZmFsc2U7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDxMaWNlbnNlVmFsaWRhdGlvblJlc3BvbnNlPihcbiAgICAgICAgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuTElDRU5TRS5WQUxJREFURSh0aGlzLmxpY2Vuc2VLZXkpLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUy5XSVRIX0xJQ0VOU0UodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldE1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHJlZ3VsYXIgbW9kZWxzXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8eyBtb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10gfT4oXG4gICAgICAgIFwiL2FwaS92MS9tb2RlbHNcIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKCFyZXNwb25zZSB8fCAhQXJyYXkuaXNBcnJheShyZXNwb25zZS5tb2RlbHMpKSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRSksXG4gICAgICAgICAgRVJST1JfQ09ERVMuSU5WQUxJRF9SRVNQT05TRSxcbiAgICAgICAgICA1MDBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IHByb3ZpZGVyIHRvIHN5c3RlbXNjdWxwdCBmb3Igb3VyIG1vZGVsc1xuICAgICAgY29uc3Qgc3lzdGVtc2N1bHB0TW9kZWxzID0gcmVzcG9uc2UubW9kZWxzLm1hcCgobW9kZWwpID0+ICh7XG4gICAgICAgIC4uLm1vZGVsLFxuICAgICAgICBwcm92aWRlcjogXCJzeXN0ZW1zY3VscHRcIixcbiAgICAgIH0pKTtcblxuICAgICAgLy8gUmV0dXJuIG9ubHkgc3lzdGVtIG1vZGVsc1xuICAgICAgcmV0dXJuIHN5c3RlbXNjdWxwdE1vZGVscztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VG9rZW5CYWxhbmNlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaWNlbnNlKHRydWUpO1xuICAgIGlmICghaXNWYWxpZCkgcmV0dXJuIDA7XG5cbiAgICAvLyByZS12YWxpZGF0ZSB0byBnZXQgZnJlc2ggbGljZW5zZSBkYXRhXG4gICAgY29uc3QgbGljZW5zZUluZm8gPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PExpY2Vuc2VWYWxpZGF0aW9uUmVzcG9uc2U+KFxuICAgICAgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuTElDRU5TRS5WQUxJREFURSh0aGlzLmxpY2Vuc2VLZXkpLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGhlYWRlcnM6IFNZU1RFTVNDVUxQVF9BUElfSEVBREVSUy5XSVRIX0xJQ0VOU0UodGhpcy5saWNlbnNlS2V5KSxcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBsaWNlbnNlSW5mby5jcmVkaXRzX2JhbGFuY2UgfHwgMDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q29udGV4dEZpbGVDb250ZW50cyhcbiAgICBmaWxlUGF0aDogc3RyaW5nXG4gICk6IFByb21pc2U8c3RyaW5nIHwgbnVsbCB8IHsgdHlwZTogXCJpbWFnZVwiOyBiYXNlNjQ6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENsZWFuIHRoZSB3aWtpLWxpbmsgZm9ybWF0OiBbW3BhdGhdXSAtPiBwYXRoXG4gICAgICBjb25zdCBsaW5rVGV4dCA9IGZpbGVQYXRoLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpO1xuXG4gICAgICAvLyBSZW1vdmUgYW55IG1hdGggZGlzcGxheSBtYXJrZXJzIGlmIHByZXNlbnRcbiAgICAgIGNvbnN0IGNsZWFuUGF0aCA9IGxpbmtUZXh0LnJlcGxhY2UoXG4gICAgICAgIC9cXCRiZWdpbjptYXRoOmRpc3BsYXlcXCRcXFsoLio/KVxcJGVuZDptYXRoOmRpc3BsYXlcXCRdL2csXG4gICAgICAgIFwiJDFcIlxuICAgICAgKTtcblxuICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgdGhlIGZpbGUgdXNpbmcgdGhlIGNsZWFuZWQgcGF0aFxuICAgICAgY29uc3QgcmVzb2x2ZWRGaWxlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChcbiAgICAgICAgY2xlYW5QYXRoLFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgaWYgKHJlc29sdmVkRmlsZS5leHRlbnNpb24ubWF0Y2goL14oanBnfGpwZWd8cG5nfGdpZnx3ZWJwKSQvaSkpIHtcbiAgICAgICAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCBJbWFnZVByb2Nlc3Nvci5wcm9jZXNzSW1hZ2UoXG4gICAgICAgICAgICByZXNvbHZlZEZpbGUsXG4gICAgICAgICAgICB0aGlzLmFwcFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJpbWFnZVwiLCBiYXNlNjQgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChyZXNvbHZlZEZpbGUpO1xuICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgZmlsZSBub3QgZm91bmQsIHRyeSByZXNvbHZpbmcgd2l0aG91dCB0aGUgZm9sZGVyIHN0cnVjdHVyZVxuICAgICAgY29uc3QgZmlsZU5hbWUgPSBjbGVhblBhdGguc3BsaXQoXCIvXCIpLnBvcCgpO1xuICAgICAgaWYgKGZpbGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IGFsbEZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdGaWxlID0gYWxsRmlsZXMuZmluZCgoZikgPT4gZi5uYW1lID09PSBmaWxlTmFtZSk7XG4gICAgICAgIGlmIChtYXRjaGluZ0ZpbGUpIHtcbiAgICAgICAgICBpZiAobWF0Y2hpbmdGaWxlLmV4dGVuc2lvbi5tYXRjaCgvXihqcGd8anBlZ3xwbmd8Z2lmfHdlYnApJC9pKSkge1xuICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgSW1hZ2VQcm9jZXNzb3IucHJvY2Vzc0ltYWdlKFxuICAgICAgICAgICAgICBtYXRjaGluZ0ZpbGUsXG4gICAgICAgICAgICAgIHRoaXMuYXBwXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJpbWFnZVwiLCBiYXNlNjQgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQobWF0Y2hpbmdGaWxlKTtcbiAgICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBidWlsZENvbnRleHRNZXNzYWdlRnJvbUZpbGUoXG4gICAgZmlsZVBhdGg6IHN0cmluZ1xuICApOiBQcm9taXNlPENoYXRNZXNzYWdlIHwgbnVsbD4ge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmdldENvbnRleHRGaWxlQ29udGVudHMoZmlsZVBhdGgpO1xuICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gZmlsZVBhdGgucmVwbGFjZShcbiAgICAgIC9cXCRiZWdpbjptYXRoOmRpc3BsYXlcXCRcXFsoLio/KVxcJGVuZDptYXRoOmRpc3BsYXlcXCRdL2csXG4gICAgICBcIiQxXCJcbiAgICApO1xuXG4gICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGBDb250ZXh0IGZyb20gJHtkaXNwbGF5TmFtZX06XFxuXFxuJHtjb250ZW50fWAsXG4gICAgICAgICAgbWVzc2FnZV9pZDogZ2VuZXJhdGVVVUlEKCksXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKGNvbnRlbnQudHlwZSA9PT0gXCJpbWFnZVwiKSB7XG4gICAgICAgIC8vIENvbnN0cnVjdCBhIFwidHlwZTppbWFnZV91cmxcIiBhcnJheSBlbnRyeTpcbiAgICAgICAgLy8gT3B0aW9uYWxseSBwcmVmaXggd2l0aCBhIFwidHlwZTp0ZXh0XCIgZW50cnkgZm9yIGFueSBsYWJlbCBvciBtZW50aW9uIG9mIHRoZSBmaWxlXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgICAgdGV4dDogYENvbnRleHQgZnJvbSAke2Rpc3BsYXlOYW1lfTpcXG5cXG5gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZV91cmxcIixcbiAgICAgICAgICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgICAgICAgICAgLy8gSWYgcG9zc2libGUsIHByZWZpeCB3aXRoIGRhdGE6aW1hZ2UvPGV4dD5cbiAgICAgICAgICAgICAgICB1cmw6IGBkYXRhOmltYWdlL3BuZztiYXNlNjQsJHtjb250ZW50LmJhc2U2NC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgL15kYXRhOi4qO2Jhc2U2NCwvLFxuICAgICAgICAgICAgICAgICAgXCJcIlxuICAgICAgICAgICAgICAgICl9YCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBnZW5lcmF0ZVVVSUQoKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByZXBhcmVNZXNzYWdlc1dpdGhDb250ZXh0KFxuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLFxuICAgIGNvbnRleHRGaWxlczogU2V0PHN0cmluZz4sXG4gICAgc3lzdGVtUHJvbXB0VHlwZT86IHN0cmluZyxcbiAgICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nXG4gICk6IFByb21pc2U8Q2hhdE1lc3NhZ2VbXT4ge1xuICAgIGNvbnN0IHByZXBhcmVkTWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXTtcblxuICAgIC8vIEFkZCBzeXN0ZW0gbWVzc2FnZSBmaXJzdFxuICAgIGxldCBzeXN0ZW1Qcm9tcHRDb250ZW50OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgaWYgKHN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiYgc3lzdGVtUHJvbXB0UGF0aCkge1xuICAgICAgLy8gRm9yIGN1c3RvbSBwcm9tcHRzLCByZWFkIGZyb20gdGhlIGZpbGVcbiAgICAgIC8vIFRyeSB0byByZXNvbHZlIHRoZSBmaWxlIHVzaW5nIHRoZSBjbGVhbmVkIHBhdGhcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIHN5c3RlbVByb21wdFBhdGgsXG4gICAgICAgIFwiXCJcbiAgICAgICk7XG5cbiAgICAgIGlmIChyZXNvbHZlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChyZXNvbHZlZEZpbGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgbm90IGZvdW5kLCB0cnkgd2l0aCAubWQgZXh0ZW5zaW9uXG4gICAgICAgIGNvbnN0IGZpbGVXaXRoRXh0ID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKFxuICAgICAgICAgIGAke3N5c3RlbVByb21wdFBhdGh9Lm1kYFxuICAgICAgICApO1xuICAgICAgICBpZiAoZmlsZVdpdGhFeHQgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGVXaXRoRXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUcnkgaW4gdGhlIHN5c3RlbSBwcm9tcHRzIGRpcmVjdG9yeVxuICAgICAgICAgIGNvbnN0IGZpbGVJblN5c3RlbVByb21wdHNEaXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoXG4gICAgICAgICAgICBgU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzLyR7c3lzdGVtUHJvbXB0UGF0aH0ubWRgXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoZmlsZUluU3lzdGVtUHJvbXB0c0RpciBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChcbiAgICAgICAgICAgICAgZmlsZUluU3lzdGVtUHJvbXB0c0RpclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHN5c3RlbVByb21wdFR5cGUpIHtcbiAgICAgIC8vIEZvciBub24tY3VzdG9tIHByb21wdHMsIGZldGNoIGZyb20gc2VydmVyXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcmVzZXQgPSBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwKS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKFxuICAgICAgICAgIHN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZXNldCkge1xuICAgICAgICAgIHN5c3RlbVByb21wdENvbnRlbnQgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgZXJyb3IgYW5kIGNvbnRpbnVlIHdpdGhvdXQgc3lzdGVtIHByb21wdFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCBzeXN0ZW0gbWVzc2FnZSBpZiB3ZSBoYXZlIGNvbnRlbnRcbiAgICBpZiAoc3lzdGVtUHJvbXB0Q29udGVudCkge1xuICAgICAgcHJlcGFyZWRNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgY29udGVudDogc3lzdGVtUHJvbXB0Q29udGVudCxcbiAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgY29udGV4dCBmaWxlcyBhbmQgY29sbGVjdCBkb2N1bWVudCBJRHMgZm9yIHRoZSBzZXJ2ZXJcbiAgICBjb25zdCBkb2N1bWVudElkczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIGRvY3VtZW50IHJlZmVyZW5jZSAoc3RhcnRzIHdpdGggXCJkb2M6XCIpXG4gICAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aChcImRvYzpcIikpIHtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IGZpbGVQYXRoLnN1YnN0cmluZyg0KTtcbiAgICAgICAgZG9jdW1lbnRJZHMucHVzaChkb2N1bWVudElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSByZWd1bGFyIGZpbGUgY29udGV4dHMgYXMgYmVmb3JlXG4gICAgICAgIGNvbnN0IGNvbnRleHRNZXNzYWdlID0gYXdhaXQgdGhpcy5idWlsZENvbnRleHRNZXNzYWdlRnJvbUZpbGUoZmlsZVBhdGgpO1xuICAgICAgICBpZiAoY29udGV4dE1lc3NhZ2UpIHtcbiAgICAgICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goY29udGV4dE1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGRvY3VtZW50IGNvbnRleHQgdG8gdGhlIGZpcnN0IG1lc3NhZ2UgaWYgd2UgaGF2ZSBkb2N1bWVudCBJRHNcbiAgICBpZiAoZG9jdW1lbnRJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmlyc3RNZXNzYWdlID0gbWVzc2FnZXNbMF07XG4gICAgICBpZiAoZmlyc3RNZXNzYWdlKSB7XG4gICAgICAgIGZpcnN0TWVzc2FnZS5kb2N1bWVudENvbnRleHQgPSB7IGRvY3VtZW50SWRzIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBhY3R1YWwgY2hhdCBtZXNzYWdlc1xuICAgIGZvciAoY29uc3QgbXNnIG9mIG1lc3NhZ2VzKSB7XG4gICAgICBwcmVwYXJlZE1lc3NhZ2VzLnB1c2goe1xuICAgICAgICByb2xlOiBtc2cucm9sZSxcbiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VfaWQ6IG1zZy5tZXNzYWdlX2lkIHx8IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICBkb2N1bWVudENvbnRleHQ6IG1zZy5kb2N1bWVudENvbnRleHQsXG4gICAgICAgIHN5c3RlbVByb21wdFR5cGU6IG1zZy5zeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoOiBtc2cuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBwcmVwYXJlZE1lc3NhZ2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVEYXRhUHJlZml4KGxpbmU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFsaW5lPy50cmltKCkpIHJldHVybiBcIlwiO1xuICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgIC8vIFNraXAgc3BlY2lhbCBtZXNzYWdlc1xuICAgIGlmIChcbiAgICAgIHRyaW1tZWQgPT09IFwiZGF0YTpcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJkYXRhOiBcIiB8fFxuICAgICAgdHJpbW1lZCA9PT0gXCJbRE9ORV1cIiB8fFxuICAgICAgdHJpbW1lZC5zdGFydHNXaXRoKFwiOiBPUEVOUk9VVEVSXCIpXG4gICAgKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJpbW1lZC5yZXBsYWNlKC9eKD86ZGF0YTpcXHMqKSsvLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNWYWxpZFN0cmVhbUV2ZW50KGRhdGE6IHN0cmluZywgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlKTogYm9vbGVhbiB7XG4gICAgaWYgKCFkYXRhKSByZXR1cm4gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIHJldHVybiAhIShcbiAgICAgICAgcGFyc2VkICYmXG4gICAgICAgIChwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fFxuICAgICAgICAgIHBhcnNlZC5jaG9pY2VzPy5bMF0/LmRlbHRhPy5yZWFzb25pbmcgfHxcbiAgICAgICAgICBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uZnVuY3Rpb25fY2FsbCB8fFxuICAgICAgICAgIHBhcnNlZC5lcnJvcilcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc1N0cmVhbUxpbmUoXG4gICAgbGluZTogc3RyaW5nLFxuICAgIGlzQ3VzdG9tUHJvdmlkZXIgPSBmYWxzZVxuICApOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoIWxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IHRoaXMubm9ybWFsaXplRGF0YVByZWZpeChsaW5lKTtcbiAgICByZXR1cm4gdGhpcy5pc1ZhbGlkU3RyZWFtRXZlbnQobm9ybWFsaXplZCwgaXNDdXN0b21Qcm92aWRlcilcbiAgICAgID8gbm9ybWFsaXplZFxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1FdmVudChcbiAgICBldmVudDogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8eyBjb250ZW50OiBzdHJpbmcgfCBudWxsOyByZWFzb25pbmc6IHN0cmluZyB8IG51bGwgfSB8IG51bGw+IHtcbiAgICBpZiAoIWV2ZW50KSByZXR1cm4gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFyc2VkOiBTeXN0ZW1TY3VscHRTdHJlYW1DaHVuaztcbiAgICAgIHRyeSB7XG4gICAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoZXZlbnQpO1xuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwYXJzZWQpIHJldHVybiBudWxsO1xuXG4gICAgICAvLyBIYW5kbGUgZXJyb3JzXG4gICAgICBpZiAocGFyc2VkLmVycm9yKSB7XG4gICAgICAgIGNvbnN0IGVycm9yQ29kZSA9IChwYXJzZWQuZXJyb3IuY29kZSB8fFxuICAgICAgICAgIEVSUk9SX0NPREVTLlNUUkVBTV9FUlJPUikgYXMgRXJyb3JDb2RlO1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBwYXJzZWQuZXJyb3IubWVzc2FnZSB8fCBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlLCBtb2RlbCk7XG5cbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgc2hvdWxkUmVzdWJtaXQ6IGZhbHNlLFxuICAgICAgICAgIHJhd0Vycm9yOiBwYXJzZWQuZXJyb3IsXG4gICAgICAgICAgb3JpZ2luYWxFdmVudDogZXZlbnQsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yQ29kZSA9PT0gRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUgfHxcbiAgICAgICAgICBlcnJvckNvZGUgPT09IEVSUk9SX0NPREVTLk1PREVMX1JFUVVFU1RfRVJST1JcbiAgICAgICAgKSB7XG4gICAgICAgICAgbWV0YWRhdGEuc2hvdWxkUmVzdWJtaXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICAgICBlcnJvckNvZGUsXG4gICAgICAgICAgcGFyc2VkLmVycm9yLnN0YXR1c0NvZGUgfHwgNTAwLFxuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFsbCBwcm92aWRlcnMgdXNlIE9wZW5BSSBmb3JtYXRcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBwYXJzZWQuY2hvaWNlcz8uWzBdPy5kZWx0YT8uY29udGVudCB8fCBudWxsO1xuICAgICAgY29uc3QgcmVhc29uaW5nID0gcGFyc2VkLmNob2ljZXM/LlswXT8uZGVsdGE/LnJlYXNvbmluZyB8fCBudWxsO1xuXG4gICAgICAvLyBJZiB3ZSdyZSBpbiB0aGluayBtb2RlLCBhbGwgY29udGVudCBzaG91bGQgYmUgdHJlYXRlZCBhcyByZWFzb25pbmcgdW50aWwgd2Ugc2VlIDwvdGhpbms+XG4gICAgICBpZiAodGhpcy5pc0luc2lkZVRoaW5rVGFncykge1xuICAgICAgICAvLyBDaGVjayBib3RoIGNvbnRlbnQgYW5kIHJlYXNvbmluZyBmb3IgPC90aGluaz5cbiAgICAgICAgbGV0IGNvbWJpbmVkVGV4dCA9IFwiXCI7XG4gICAgICAgIGlmIChyZWFzb25pbmcpIGNvbWJpbmVkVGV4dCArPSByZWFzb25pbmc7XG4gICAgICAgIGlmIChjb250ZW50KSBjb21iaW5lZFRleHQgKz0gY29udGVudDtcblxuICAgICAgICBjb25zdCB0aGlua0VuZE1hdGNoID0gY29tYmluZWRUZXh0Lm1hdGNoKC8oLio/KVxccyo8XFwvdGhpbms+XFxzKiguKikvKTtcbiAgICAgICAgaWYgKHRoaW5rRW5kTWF0Y2gpIHtcbiAgICAgICAgICB0aGlzLmlzSW5zaWRlVGhpbmtUYWdzID0gZmFsc2U7XG4gICAgICAgICAgLy8gRXZlcnl0aGluZyBiZWZvcmUgPC90aGluaz4gaXMgcmVhc29uaW5nLCBldmVyeXRoaW5nIGFmdGVyIGlzIGNvbnRlbnRcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua0VuZE1hdGNoWzFdIHx8IFwiXCIsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlua0VuZE1hdGNoWzJdIHx8IFwiXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIG5vIDwvdGhpbms+IGZvdW5kLCBldmVyeXRoaW5nIGlzIHN0aWxsIHJlYXNvbmluZ1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgcmVhc29uaW5nOiBjb21iaW5lZFRleHQgfHwgbnVsbCxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGNvbnRlbnQgY29udGFpbnMgPHRoaW5rPlxuICAgICAgICBpZiAoY29udGVudCkge1xuICAgICAgICAgIGNvbnN0IHRoaW5rU3RhcnRNYXRjaCA9IGNvbnRlbnQubWF0Y2goLzx0aGluaz5cXHMqKC4qKS8pO1xuICAgICAgICAgIGlmICh0aGlua1N0YXJ0TWF0Y2gpIHtcbiAgICAgICAgICAgIHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY29udGVudDogbnVsbCxcbiAgICAgICAgICAgICAgcmVhc29uaW5nOiB0aGlua1N0YXJ0TWF0Y2hbMV0gfHwgXCJcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGNvbnRlbnQsIHJlYXNvbmluZyB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1N0cmVhbUNodW5rKFxuICAgIGNodW5rOiBVaW50OEFycmF5LFxuICAgIGJ1ZmZlcjogc3RyaW5nLFxuICAgIG1vZGVsOiBzdHJpbmcsXG4gICAgaXNDdXN0b21Qcm92aWRlciA9IGZhbHNlXG4gICk6IFByb21pc2U8e1xuICAgIG5ld0J1ZmZlcjogc3RyaW5nO1xuICAgIGNvbnRlbnRzOiBzdHJpbmdbXTtcbiAgICByZWFzb25pbmdzOiBzdHJpbmdbXTtcbiAgfT4ge1xuICAgIGNvbnN0IGRlY29kZWQgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmRlY29kZXIuZGVjb2RlKGNodW5rLCB7IHN0cmVhbTogdHJ1ZSB9KTtcbiAgICBjb25zdCBmdWxsQ2h1bmsgPSBidWZmZXIgKyBkZWNvZGVkO1xuXG4gICAgY29uc3QgbGluZXMgPSBmdWxsQ2h1bmsuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3QgY29udGVudHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgcmVhc29uaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFByb2Nlc3MgYWxsIGxpbmVzIGV4Y2VwdCBwb3RlbnRpYWxseSBpbmNvbXBsZXRlIGxhc3QgbGluZVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICBjb25zdCBldmVudCA9IHRoaXMucHJvY2Vzc1N0cmVhbUxpbmUobGluZXNbaV0sIGlzQ3VzdG9tUHJvdmlkZXIpO1xuICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXZlbnQoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgaXNDdXN0b21Qcm92aWRlclxuICAgICAgICApO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5jb250ZW50KSBjb250ZW50cy5wdXNoKHJlc3VsdC5jb250ZW50KTtcbiAgICAgICAgICBpZiAocmVzdWx0LnJlYXNvbmluZykgcmVhc29uaW5ncy5wdXNoKHJlc3VsdC5yZWFzb25pbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gS2VlcCBsYXN0IGxpbmUgYXMgYnVmZmVyIGlmIG5vbi1lbXB0eVxuICAgIGNvbnN0IG5ld0J1ZmZlciA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLnRyaW0oKVxuICAgICAgPyBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXVxuICAgICAgOiBcIlwiO1xuXG4gICAgcmV0dXJuIHsgbmV3QnVmZmVyLCBjb250ZW50cywgcmVhc29uaW5ncyB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzdHJpcFByb3ZpZGVyUHJlZml4ZXMobW9kZWxJZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IHJlbW92ZSB0aGUgb3BlbnJvdXRlci8gcHJlZml4LCBrZWVwIHRoZSBwcm92aWRlciBpZGVudGlmaWVyXG4gICAgcmV0dXJuIG1vZGVsSWQucmVwbGFjZSgvXm9wZW5yb3V0ZXJcXC8vLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TW9kZWxJbmZvKG1vZGVsSWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlzQ3VzdG9tOiBib29sZWFuO1xuICAgIHByb3ZpZGVyPzogQ3VzdG9tUHJvdmlkZXI7XG4gICAgYWN0dWFsTW9kZWxJZDogc3RyaW5nO1xuICB9PiB7XG4gICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBHZXR0aW5nIG1vZGVsIGluZm86XCIsIHtcbiAgICAgIG1vZGVsSWQsXG4gICAgICBhY3RpdmVQcm92aWRlcjogdGhpcy5zZXR0aW5ncy5hY3RpdmVQcm92aWRlcixcbiAgICAgIGN1c3RvbVByb3ZpZGVyczogdGhpcy5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMubWFwKHAgPT4gKHtcbiAgICAgICAgaWQ6IHAuaWQsXG4gICAgICAgIG5hbWU6IHAubmFtZSxcbiAgICAgICAgaXNFbmFibGVkOiBwLmlzRW5hYmxlZFxuICAgICAgfSkpXG4gICAgfSk7XG5cbiAgICAvLyBGaXJzdCwgY2hlY2sgaWYgdGhpcyBpcyBhIG5hdGl2ZSBTeXN0ZW1TY3VscHQgbW9kZWxcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3lzdGVtTW9kZWxzID0gYXdhaXQgdGhpcy5nZXRNb2RlbHMoKTtcbiAgICAgIC8vIFN0cmlwIDpvbmxpbmUgc3VmZml4IGZvciBuYXRpdmUgbW9kZWwgY2hlY2tcbiAgICAgIGNvbnN0IGJhc2VNb2RlbElkID0gbW9kZWxJZC5yZXBsYWNlKC86b25saW5lJC8sIFwiXCIpO1xuICAgICAgY29uc3QgaXNTeXN0ZW1Nb2RlbCA9IHN5c3RlbU1vZGVscy5zb21lKG0gPT4gbS5pZCA9PT0gYmFzZU1vZGVsSWQpO1xuICAgICAgXG4gICAgICBpZiAoaXNTeXN0ZW1Nb2RlbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIEZvdW5kIGFzIG5hdGl2ZSBTeXN0ZW1TY3VscHQgbW9kZWw6XCIsIG1vZGVsSWQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzQ3VzdG9tOiBmYWxzZSxcbiAgICAgICAgICBhY3R1YWxNb2RlbElkOiB0aGlzLnN0cmlwUHJvdmlkZXJQcmVmaXhlcyhtb2RlbElkKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIltTeXN0ZW1TY3VscHRdIEVycm9yIGNoZWNraW5nIHN5c3RlbSBtb2RlbHM6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBnZXQgaGVyZSwgaXQncyBub3QgYSBuYXRpdmUgbW9kZWwsIHNvIGNoZWNrIGN1c3RvbSBwcm92aWRlcnNcbiAgICBjb25zdCBhY3RpdmVQcm92aWRlciA9IHRoaXMuc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXI7XG4gICAgXG4gICAgaWYgKGFjdGl2ZVByb3ZpZGVyLnR5cGUgIT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1N5c3RlbVNjdWxwdF0gTm8gY3VzdG9tIHByb3ZpZGVyIGFjdGl2ZSBidXQgbW9kZWwgbm90IGZvdW5kIGluIG5hdGl2ZSBtb2RlbHM6XCIsIG1vZGVsSWQpO1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBgTW9kZWwgJHttb2RlbElkfSBub3QgZm91bmQgaW4gbmF0aXZlIG1vZGVscyBhbmQgbm8gY3VzdG9tIHByb3ZpZGVyIGlzIGFjdGl2ZWAsXG4gICAgICAgIEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFLFxuICAgICAgICA0MDRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgYWN0aXZlIGN1c3RvbSBwcm92aWRlclxuICAgIGNvbnN0IGN1c3RvbVByb3ZpZGVyID0gdGhpcy5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMuZmluZChcbiAgICAgIHAgPT4gcC5pZCA9PT0gYWN0aXZlUHJvdmlkZXIuaWQgJiYgcC5pc0VuYWJsZWRcbiAgICApO1xuXG4gICAgaWYgKCFjdXN0b21Qcm92aWRlcikge1xuICAgICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBBY3RpdmUgY3VzdG9tIHByb3ZpZGVyIG5vdCBmb3VuZCBvciBkaXNhYmxlZDpcIiwgYWN0aXZlUHJvdmlkZXIpO1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBgUHJvdmlkZXIgJHthY3RpdmVQcm92aWRlci5uYW1lfSBub3QgZm91bmQgb3IgZGlzYWJsZWRgLFxuICAgICAgICBFUlJPUl9DT0RFUy5NT0RFTF9VTkFWQUlMQUJMRSxcbiAgICAgICAgNDA0XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSB0aGUgbW9kZWwgZXhpc3RzIGluIHRoaXMgcHJvdmlkZXJcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24oY3VzdG9tUHJvdmlkZXIpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2VzcyB8fCAhcmVzdWx0Lm1vZGVscz8uaW5jbHVkZXMobW9kZWxJZCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBNb2RlbCBub3QgZm91bmQgaW4gYWN0aXZlIGN1c3RvbSBwcm92aWRlcjpcIiwge1xuICAgICAgICAgIG1vZGVsSWQsXG4gICAgICAgICAgcHJvdmlkZXI6IGN1c3RvbVByb3ZpZGVyLm5hbWUsXG4gICAgICAgICAgYXZhaWxhYmxlTW9kZWxzOiByZXN1bHQubW9kZWxzXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgICAgYE1vZGVsICR7bW9kZWxJZH0gbm90IGZvdW5kIGluIHByb3ZpZGVyICR7Y3VzdG9tUHJvdmlkZXIubmFtZX1gLFxuICAgICAgICAgIEVSUk9SX0NPREVTLk1PREVMX1VOQVZBSUxBQkxFLFxuICAgICAgICAgIDQwNFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRXJyb3IgdmVyaWZ5aW5nIG1vZGVsIGluIHByb3ZpZGVyOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgU3lzdGVtU2N1bHB0RXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gdmVyaWZ5IG1vZGVsICR7bW9kZWxJZH0gd2l0aCBwcm92aWRlciAke2N1c3RvbVByb3ZpZGVyLm5hbWV9YCxcbiAgICAgICAgRVJST1JfQ09ERVMuTU9ERUxfVU5BVkFJTEFCTEUsXG4gICAgICAgIDQwNFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIFVzaW5nIGN1c3RvbSBwcm92aWRlcjpcIiwge1xuICAgICAgaWQ6IGN1c3RvbVByb3ZpZGVyLmlkLFxuICAgICAgbmFtZTogY3VzdG9tUHJvdmlkZXIubmFtZSxcbiAgICAgIGVuZHBvaW50OiBjdXN0b21Qcm92aWRlci5lbmRwb2ludCxcbiAgICAgIG1vZGVsSWRcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBpc0N1c3RvbTogdHJ1ZSxcbiAgICAgIHByb3ZpZGVyOiBjdXN0b21Qcm92aWRlcixcbiAgICAgIGFjdHVhbE1vZGVsSWQ6IG1vZGVsSWQsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlQ3VzdG9tUHJvdmlkZXJDb21wbGV0aW9uKFxuICAgIHByb3ZpZGVyOiBDdXN0b21Qcm92aWRlcixcbiAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICB0ZW1wZXJhdHVyZTogbnVtYmVyLFxuICAgIG1vZGVsSWQ6IHN0cmluZyxcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbFxuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgLy8gQWRkIGRldGFpbGVkIGxvZ2dpbmdcbiAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIEN1c3RvbSBQcm92aWRlciBSZXF1ZXN0IERldGFpbHM6XCIsIHtcbiAgICAgIHByb3ZpZGVyOiB7XG4gICAgICAgIGlkOiBwcm92aWRlci5pZCxcbiAgICAgICAgbmFtZTogcHJvdmlkZXIubmFtZSxcbiAgICAgICAgZW5kcG9pbnQ6IHByb3ZpZGVyLmVuZHBvaW50LFxuICAgICAgICBpc0VuYWJsZWQ6IHByb3ZpZGVyLmlzRW5hYmxlZFxuICAgICAgfSxcbiAgICAgIG1vZGVsSWQsXG4gICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgIGlzT3BlblJvdXRlcjogcHJvdmlkZXIuZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpLFxuICAgICAgaXNPcGVuQUk6IHByb3ZpZGVyLmVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIilcbiAgICB9KTtcblxuICAgIGNvbnN0IGVuZHBvaW50ID0gcHJvdmlkZXIuZW5kcG9pbnQudHJpbSgpLnJlcGxhY2UoL1xcLyQvLCBcIlwiKTtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cHJvdmlkZXIuYXBpS2V5fWAsXG4gICAgfTtcblxuICAgIC8vIEFkZCBPcGVuUm91dGVyIHNwZWNpZmljIGhlYWRlcnMgaWYgaXQncyBhbiBPcGVuUm91dGVyIGVuZHBvaW50XG4gICAgaWYgKGVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKSkge1xuICAgICAgaGVhZGVyc1tcIkhUVFAtUmVmZXJlclwiXSA9IFwiaHR0cHM6Ly9zeXN0ZW1zY3VscHQuY29tXCI7XG4gICAgICBoZWFkZXJzW1wiWC1UaXRsZVwiXSA9IFwiU3lzdGVtU2N1bHB0IEFJXCI7XG4gICAgfVxuXG4gICAgLy8gQmFzZSByZXF1ZXN0IGJvZHlcbiAgICBjb25zdCBiYXNlUmVxdWVzdEJvZHkgPSB7XG4gICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcy5tYXAoKG1zZykgPT4gKHtcbiAgICAgICAgcm9sZTogbXNnLnJvbGUsXG4gICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50LFxuICAgICAgfSkpLFxuICAgICAgc3RyZWFtOiB0cnVlLFxuICAgIH07XG5cbiAgICAvLyBBZGQgcHJvdmlkZXItc3BlY2lmaWMgcGFyYW1ldGVyc1xuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgLi4uYmFzZVJlcXVlc3RCb2R5LFxuICAgICAgLy8gQWRkIHRlbXBlcmF0dXJlIG9ubHkgZm9yIG5vbi1PcGVuQUkgZW5kcG9pbnRzXG4gICAgICAuLi4oIWVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIikgJiYgeyB0ZW1wZXJhdHVyZSB9KSxcbiAgICAgIC8vIEFkZCBpbmNsdWRlX3JlYXNvbmluZyBmb3IgT3BlblJvdXRlciBlbmRwb2ludHNcbiAgICAgIC4uLihlbmRwb2ludC5pbmNsdWRlcyhcIm9wZW5yb3V0ZXIuYWlcIikgJiYge1xuICAgICAgICBpbmNsdWRlX3JlYXNvbmluZzogdHJ1ZSxcbiAgICAgIH0pLFxuICAgICAgLy8gQWRkIHJlYXNvbmluZ19lZmZvcnQgZm9yIE9wZW5BSSdzIG8zLW1pbmkgbW9kZWxcbiAgICAgIC4uLihlbmRwb2ludC5pbmNsdWRlcyhcImFwaS5vcGVuYWkuY29tXCIpICYmXG4gICAgICAgIG1vZGVsSWQgPT09IFwibzMtbWluaVwiICYmIHtcbiAgICAgICAgICByZWFzb25pbmdfZWZmb3J0OiBcImhpZ2hcIixcbiAgICAgICAgfSksXG4gICAgfTtcblxuICAgIC8vIExvZyB0aGUgcmVxdWVzdCBib2R5IGlmIGl0J3MgT3BlbkFJIGFuZCBvMy1taW5pXG4gICAgaWYgKGVuZHBvaW50LmluY2x1ZGVzKFwiYXBpLm9wZW5haS5jb21cIikgJiYgbW9kZWxJZCA9PT0gXCJvMy1taW5pXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWFraW5nIE9wZW5BSSBBUEkgY2FsbCB3aXRoIG8zLW1pbmkgbW9kZWw6XCIsIHtcbiAgICAgICAgZW5kcG9pbnQsXG4gICAgICAgIG1vZGVsSWQsXG4gICAgICAgIHJlcXVlc3RCb2R5LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtlbmRwb2ludH0vY2hhdC9jb21wbGV0aW9uc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgc2lnbmFsLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTdHJlYW1FcnJvcihyZXNwb25zZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgYXN5bmMgKnN0cmVhbU1lc3NhZ2Uoe1xuICAgIG1lc3NhZ2VzLFxuICAgIG1vZGVsLFxuICAgIHRlbXBlcmF0dXJlID0gMC43LFxuICAgIG9uRXJyb3IsXG4gICAgY29udGV4dEZpbGVzLFxuICAgIHN5c3RlbVByb21wdFR5cGUsXG4gICAgc3lzdGVtUHJvbXB0UGF0aCxcbiAgICBzaWduYWwsXG4gICAgZm9yY2VTeXN0ZW1TY3VscHRBcGkgPSBmYWxzZSxcbiAgfToge1xuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgIG1vZGVsOiBzdHJpbmc7XG4gICAgdGVtcGVyYXR1cmU/OiBudW1iZXI7XG4gICAgb25FcnJvcj86IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkO1xuICAgIGNvbnRleHRGaWxlcz86IFNldDxzdHJpbmc+O1xuICAgIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmc7XG4gICAgc3lzdGVtUHJvbXB0UGF0aD86IHN0cmluZztcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbDtcbiAgICBmb3JjZVN5c3RlbVNjdWxwdEFwaT86IGJvb2xlYW47XG4gIH0pOiBBc3luY0dlbmVyYXRvcjx7IGNvbnRlbnQ/OiBzdHJpbmc7IHJlYXNvbmluZz86IHN0cmluZyB9LCB2b2lkLCB1bmtub3duPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlc2V0IHRoaW5rIHRhZyBzdGF0ZSBhdCBzdGFydCBvZiBzdHJlYW1cbiAgICAgIHRoaXMuaXNJbnNpZGVUaGlua1RhZ3MgPSBmYWxzZTtcblxuICAgICAgY29uc3QgcHJlcGFyZWRNZXNzYWdlcyA9IGF3YWl0IHRoaXMucHJlcGFyZU1lc3NhZ2VzV2l0aENvbnRleHQoXG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBjb250ZXh0RmlsZXMgfHwgbmV3IFNldCgpLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoXG4gICAgICApO1xuXG4gICAgICAvLyBHZXQgbW9kZWwgaW5mbyAtIHNraXAgY3VzdG9tIHByb3ZpZGVyIGxvZ2ljIGlmIGZvcmNlU3lzdGVtU2N1bHB0QXBpIGlzIHRydWVcbiAgICAgIGNvbnN0IHsgaXNDdXN0b20sIHByb3ZpZGVyLCBhY3R1YWxNb2RlbElkIH0gPSBmb3JjZVN5c3RlbVNjdWxwdEFwaSBcbiAgICAgICAgPyB7IGlzQ3VzdG9tOiBmYWxzZSwgcHJvdmlkZXI6IHVuZGVmaW5lZCwgYWN0dWFsTW9kZWxJZDogbW9kZWwgfVxuICAgICAgICA6IGF3YWl0IHRoaXMuZ2V0TW9kZWxJbmZvKG1vZGVsKTtcblxuICAgICAgbGV0IHJlc3BvbnNlOiBSZXNwb25zZTtcblxuICAgICAgaWYgKGlzQ3VzdG9tICYmIHByb3ZpZGVyKSB7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5oYW5kbGVDdXN0b21Qcm92aWRlckNvbXBsZXRpb24oXG4gICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgcHJlcGFyZWRNZXNzYWdlcyxcbiAgICAgICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgICAgICBhY3R1YWxNb2RlbElkLFxuICAgICAgICAgIHNpZ25hbFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciBTeXN0ZW1TY3VscHQgQVBJIHJlcXVlc3RcbiAgICAgICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XG4gICAgICAgICAgbW9kZWw6IGFjdHVhbE1vZGVsSWQsXG4gICAgICAgICAgbWVzc2FnZXM6IHByZXBhcmVkTWVzc2FnZXMsXG4gICAgICAgICAgdGVtcGVyYXR1cmUsXG4gICAgICAgICAgc3RyZWFtOiB0cnVlLFxuICAgICAgICAgIGluY2x1ZGVfcmVhc29uaW5nOiB0cnVlLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgYCR7dGhpcy5iYXNlVXJsfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuQ0hBVC5DT01QTEVUSU9OU31gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICBBY2NlcHQ6IFwidGV4dC9ldmVudC1zdHJlYW1cIixcbiAgICAgICAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIixcbiAgICAgICAgICAgICAgXCJYLVJlcXVlc3QtSURcIjogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMubGljZW5zZUtleSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksXG4gICAgICAgICAgICBzaWduYWwsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU3RyZWFtRXJyb3IocmVzcG9uc2UsICEhcHJvdmlkZXIpO1xuICAgICAgfVxuICAgICAgaWYgKCFyZXNwb25zZS5ib2R5KSB7XG4gICAgICAgIHRocm93IG5ldyBTeXN0ZW1TY3VscHRFcnJvcihcbiAgICAgICAgICBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuU1RSRUFNX0VSUk9SKSxcbiAgICAgICAgICBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IsXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7XG4gICAgICBsZXQgYnVmZmVyID0gXCJcIjtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICBjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuXG4gICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgZmluYWwgY2h1bmsgaWYgYW55XG4gICAgICAgICAgICBjb25zdCBmaW5hbENodW5rID0gU3lzdGVtU2N1bHB0U2VydmljZS5kZWNvZGVyLmRlY29kZSgpO1xuICAgICAgICAgICAgaWYgKGZpbmFsQ2h1bmspIHtcbiAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLnByb2Nlc3NTdHJlYW1MaW5lKGZpbmFsQ2h1bmspO1xuICAgICAgICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmhhbmRsZVN0cmVhbUV2ZW50KFxuICAgICAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgICAgICEhcHJvdmlkZXJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29udGVudCB8fCByZXN1bHQucmVhc29uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXN1bHQuY29udGVudCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgcmVhc29uaW5nOiByZXN1bHQucmVhc29uaW5nIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFByb2Nlc3MgY2h1bmsgYW5kIHlpZWxkIGNvbnRlbnRzXG4gICAgICAgICAgY29uc3QgeyBuZXdCdWZmZXIsIGNvbnRlbnRzLCByZWFzb25pbmdzIH0gPVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzU3RyZWFtQ2h1bmsodmFsdWUsIGJ1ZmZlciwgbW9kZWwsICEhcHJvdmlkZXIpO1xuICAgICAgICAgIGJ1ZmZlciA9IG5ld0J1ZmZlcjtcblxuICAgICAgICAgIC8vIFlpZWxkIGJvdGggY29udGVudCBhbmQgcmVhc29uaW5nIGNodW5rc1xuICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBpIDwgTWF0aC5tYXgoY29udGVudHMubGVuZ3RoLCByZWFzb25pbmdzLmxlbmd0aCk7XG4gICAgICAgICAgICBpKytcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgY29udGVudDogY29udGVudHNbaV0sXG4gICAgICAgICAgICAgIHJlYXNvbmluZzogcmVhc29uaW5nc1tpXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICByZWFkZXIucmVsZWFzZUxvY2soKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uICYmIGVycm9yLm5hbWUgPT09IFwiQWJvcnRFcnJvclwiKSB7XG4gICAgICAgIC8vIEhhbmRsZSBhYm9ydCBncmFjZWZ1bGx5XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiBnZXRFcnJvck1lc3NhZ2UoRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUik7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgJiZcbiAgICAgICAgICBlcnJvci5jb2RlID09PSBFUlJPUl9DT0RFUy5TVFJFQU1fRVJST1IgJiZcbiAgICAgICAgICBlcnJvci5zdGF0dXNDb2RlID09PSA0MDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlICs9XG4gICAgICAgICAgICBcIlxcblBsZWFzZSB0cnkgYWdhaW4gaW4gYSBmZXcgbW9tZW50cy4gSWYgdGhlIGlzc3VlIHBlcnNpc3RzLCB0cnkgc2VsZWN0aW5nIGEgZGlmZmVyZW50IG1vZGVsLlwiO1xuICAgICAgICB9XG4gICAgICAgIG9uRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGxvYWRzIGEgZmlsZSB0byB0aGUgc2VydmVyIGZvciBkb2N1bWVudCBwcm9jZXNzaW5nLlxuICAgKiBSZXR1cm5zIHtkb2N1bWVudElkLCBzdGF0dXM6IFwicXVldWVkXCIgfCBcInByb2Nlc3NpbmdcIiB8IFwiY29tcGxldGVkXCIsIGNhY2hlZD86IGJvb2xlYW59IGlmIHN1Y2Nlc3NmdWwuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdXBsb2FkRG9jdW1lbnQoXG4gICAgZmlsZTogVEZpbGVcbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50SWQ6IHN0cmluZzsgc3RhdHVzOiBzdHJpbmc7IGNhY2hlZD86IGJvb2xlYW4gfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZWFkIGZpbGUgZnJvbSB2YXVsdFxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG5cbiAgICAgIC8vIFByZXBhcmUgbXVsdGlwYXJ0IGZvcm0gZGF0YVxuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZGF0YV0sIHsgdHlwZTogXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIiB9KTtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgYmxvYiwgZmlsZS5uYW1lKTtcblxuICAgICAgLy8gTWFrZSByZXF1ZXN0IHRvIC9hcGkvdjEvZG9jdW1lbnRzL3Byb2Nlc3NcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hcGkvdjEvZG9jdW1lbnRzL3Byb2Nlc3NgLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIngtbGljZW5zZS1rZXlcIjogdGhpcy5saWNlbnNlS2V5LFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVXBsb2FkIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBsb2FkcyBhbiBhdWRpbyBmaWxlIHRvIHRoZSBzZXJ2ZXIgZm9yIHNwZWVjaC10by10ZXh0IGV4dHJhY3Rpb24uXG4gICAqIFJldHVybnMge2RvY3VtZW50SWQsIHN0YXR1czogXCJxdWV1ZWRcInxcInByb2Nlc3NpbmdcInxcImNvbXBsZXRlZFwiLCBjYWNoZWQ/OiBib29sZWFufSBpZiBzdWNjZXNzZnVsLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHVwbG9hZEF1ZGlvKFxuICAgIGZpbGU6IFRGaWxlXG4gICk6IFByb21pc2U8eyBkb2N1bWVudElkOiBzdHJpbmc7IHN0YXR1czogc3RyaW5nOyBjYWNoZWQ/OiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVhZCBmaWxlIGZyb20gdmF1bHRcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuXG4gICAgICAvLyBQcmVwYXJlIG11bHRpcGFydCBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGFdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIgfSk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGJsb2IsIGZpbGUubmFtZSk7XG5cbiAgICAgIC8vIE1ha2UgcmVxdWVzdCB0byAvYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zIGVuZHBvaW50XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLmJhc2VVcmx9L2FwaS92MS9hdWRpby90cmFuc2NyaXB0aW9uc2AsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF1ZGlvIHVwbG9hZCBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHByZWxvYWRNb2RlbHMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gUmVtb3ZlIHByZWxvYWRpbmcgc2luY2Ugd2UncmUgbm90IGNhY2hpbmdcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cbn1cbiIsICJleHBvcnQgY29uc3QgY3JlYXRlTG9hZGluZ0luZGljYXRvciA9ICgpID0+IHtcbiAgY29uc3QgaW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgaW5kaWNhdG9yLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LWxvYWRpbmdcIjtcbiAgaW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJcdTI1Q0ZcIjtcbiAgcmV0dXJuIGluZGljYXRvcjtcbn07XG4iLCAiZXhwb3J0IGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IChcbiAgdGV4dDogc3RyaW5nLFxuICBvbkNsaWNrOiAoKSA9PiB2b2lkLFxuICBjbGFzc05hbWUgPSBcIlwiXG4pID0+IHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgYnV0dG9uLmNsYXNzTmFtZSA9IGBzeXN0ZW1zY3VscHQtYnV0dG9uICR7Y2xhc3NOYW1lfWA7XG4gIGJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIGJ1dHRvbi5vbmNsaWNrID0gb25DbGljaztcbiAgcmV0dXJuIGJ1dHRvbjtcbn07XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFRpdGxlR2VuZXJhdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSB0aXRsZUdlbmVyYXRpb25Nb2RlbDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHBsdWdpbi5hcHBcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKTogVGl0bGVHZW5lcmF0aW9uU2VydmljZSB7XG4gICAgaWYgKCFUaXRsZUdlbmVyYXRpb25TZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlLmluc3RhbmNlID0gbmV3IFRpdGxlR2VuZXJhdGlvblNlcnZpY2UocGx1Z2luKTtcbiAgICB9XG4gICAgcmV0dXJuIFRpdGxlR2VuZXJhdGlvblNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldE1vZGVsKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKHRoaXMudGl0bGVHZW5lcmF0aW9uTW9kZWwpIHJldHVybiB0aGlzLnRpdGxlR2VuZXJhdGlvbk1vZGVsO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvdGl0bGUtZ2VuZXJhdGlvbi1wcm9tcHRzYFxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRpdGxlIGdlbmVyYXRpb24gY29uZmlndXJhdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBpZiAoIWRhdGEuZGF0YS5tb2RlbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB0aXRsZSBnZW5lcmF0aW9uIG1vZGVsIGNvbmZpZ3VyZWQgb24gc2VydmVyXCIpO1xuICAgICAgfVxuICAgICAgdGhpcy50aXRsZUdlbmVyYXRpb25Nb2RlbCA9IGRhdGEuZGF0YS5tb2RlbCBhcyBzdHJpbmc7XG4gICAgICByZXR1cm4gdGhpcy50aXRsZUdlbmVyYXRpb25Nb2RlbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHRpdGxlIGdlbmVyYXRpb24gbW9kZWw6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdlbmVyYXRlVGl0bGUoXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gfCBURmlsZSxcbiAgICBvblByb2dyZXNzPzogKHRpdGxlOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgb25TdGF0dXNVcGRhdGU/OiAocHJvZ3Jlc3M6IG51bWJlciwgc3RhdHVzOiBzdHJpbmcpID0+IHZvaWRcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRoZSBzZXJ2ZXIncyBjaG9zZW4gbW9kZWwgZm9yIHRpdGxlIGdlbmVyYXRpb25cbiAgICAgIGNvbnN0IG1vZGVsSWQgPSBhd2FpdCB0aGlzLmdldE1vZGVsKCk7XG4gICAgICBpZiAoIW1vZGVsSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCB0aXRsZSBnZW5lcmF0aW9uIG1vZGVsIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICBsZXQgY29udGVudFhtbCA9IFwiXCI7XG4gICAgICBcbiAgICAgIGlmIChtZXNzYWdlcyBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIC8vIEhhbmRsZSByZWd1bGFyIE9ic2lkaWFuIG5vdGVcbiAgICAgICAgb25TdGF0dXNVcGRhdGU/LigyMCwgXCJSZWFkaW5nIG5vdGUgY29udGVudC4uLlwiKTtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5yZWFkKG1lc3NhZ2VzKTtcbiAgICAgICAgY29udGVudFhtbCA9IGA8Y29udGVudF90b19nZW5lcmF0ZV90aXRsZV9mcm9tPlxuPG5vdGVfdGl0bGU+JHttZXNzYWdlcy5iYXNlbmFtZX08L25vdGVfdGl0bGU+XG48bm90ZV9jb250ZW50PlxuJHtjb250ZW50fVxuPC9ub3RlX2NvbnRlbnQ+XG48L2NvbnRlbnRfdG9fZ2VuZXJhdGVfdGl0bGVfZnJvbT5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIGNoYXQgbWVzc2FnZXNcbiAgICAgICAgb25TdGF0dXNVcGRhdGU/LigyMCwgXCJQcm9jZXNzaW5nIGNoYXQgbWVzc2FnZXMuLi5cIik7XG4gICAgICAgIC8vIFRha2UgdXAgdG8gZmlyc3QgMjUgbWVzc2FnZXNcbiAgICAgICAgY29uc3QgbWVzc2FnZXNUb1VzZSA9IG1lc3NhZ2VzLnNsaWNlKDAsIDI1KTtcbiAgICAgICAgY29udGVudFhtbCA9IGA8Y29udGVudF90b19nZW5lcmF0ZV90aXRsZV9mcm9tPlxuJHttZXNzYWdlc1RvVXNlLm1hcChtc2cgPT4ge1xuICBjb25zdCBjb250ZW50ID0gdHlwZW9mIG1zZy5jb250ZW50ID09PSAnc3RyaW5nJyA/IG1zZy5jb250ZW50IDogSlNPTi5zdHJpbmdpZnkobXNnLmNvbnRlbnQpO1xuICByZXR1cm4gYFske21zZy5yb2xlfV06ICR7Y29udGVudH1gO1xufSkuam9pbignXFxuJyl9XG48L2NvbnRlbnRfdG9fZ2VuZXJhdGVfdGl0bGVfZnJvbT5gO1xuICAgICAgfVxuXG4gICAgICBvblN0YXR1c1VwZGF0ZT8uKDQwLCBcIkFuYWx5emluZyBjb250ZW50Li4uXCIpO1xuXG4gICAgICBjb25zdCBwcm9tcHRNZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDogdGhpcy5wbHVnaW4uc2V0dGluZ3MudGl0bGVHZW5lcmF0aW9uUHJvbXB0LFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBjb250ZW50WG1sLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBsZXQgZ2VuZXJhdGVkVGl0bGUgPSBcIlwiO1xuICAgICAgb25TdGF0dXNVcGRhdGU/Lig2MCwgXCJHZW5lcmF0aW5nIHRpdGxlLi4uXCIpO1xuXG4gICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHRoaXMuc2N1bHB0U2VydmljZS5zdHJlYW1NZXNzYWdlKHtcbiAgICAgICAgbWVzc2FnZXM6IHByb21wdE1lc3NhZ2VzLFxuICAgICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgZm9yY2VTeXN0ZW1TY3VscHRBcGk6IHRydWUsXG4gICAgICB9KSkge1xuICAgICAgICBpZiAoY2h1bmsuY29udGVudCkge1xuICAgICAgICAgIGdlbmVyYXRlZFRpdGxlICs9IGNodW5rLmNvbnRlbnQ7XG4gICAgICAgICAgaWYgKG9uUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIG9uUHJvZ3Jlc3MoZ2VuZXJhdGVkVGl0bGUudHJpbSgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgb25TdGF0dXNVcGRhdGU/Lig4MCwgXCJGaW5hbGl6aW5nIHRpdGxlLi4uXCIpO1xuICAgICAgcmV0dXJuIGdlbmVyYXRlZFRpdGxlLnRyaW0oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgdGl0bGU6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxufSAiLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVGl0bGVHZW5lcmF0aW9uU2VydmljZSB9IGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9UaXRsZUdlbmVyYXRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSB9IGZyb20gXCIuLi8uLi8uLi90eXBlc1wiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi8uLi9tYWluXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dEFyZWFNb2RhbE9wdGlvbnMge1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgdmFsdWU/OiBzdHJpbmc7XG4gIHJvd3M/OiBudW1iZXI7XG4gIHByaW1hcnlCdXR0b24/OiBzdHJpbmc7XG4gIHNlY29uZGFyeUJ1dHRvbj86IHN0cmluZztcbiAgcGx1Z2luPzogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBtZXNzYWdlcz86IENoYXRNZXNzYWdlW107XG59XG5cbmV4cG9ydCBjbGFzcyBUZXh0QXJlYU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHJlc3VsdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogc3RyaW5nIHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSB0aXRsZUdlbmVyYXRpb25TZXJ2aWNlOiBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZ2VuZXJhdGVCdXR0b246IEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSB0aXRsZTogc3RyaW5nLFxuICAgIHByaXZhdGUgaW5pdGlhbFZhbHVlOiBzdHJpbmcsXG4gICAgcHJpdmF0ZSBvcHRpb25zOiBUZXh0QXJlYU1vZGFsT3B0aW9ucyA9IHt9XG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb2RhbEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsXCIsIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLW1vZGFsXCIpO1xuICAgIGlmIChvcHRpb25zLnBsdWdpbiAmJiBvcHRpb25zLm1lc3NhZ2VzKSB7XG4gICAgICB0aGlzLnRpdGxlR2VuZXJhdGlvblNlcnZpY2UgPSBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlLmdldEluc3RhbmNlKG9wdGlvbnMucGx1Z2luKTtcbiAgICB9XG4gIH1cblxuICBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWNvbnRlbnRcIik7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dCh0aGlzLnRpdGxlKTtcbiAgICB0aGlzLnRpdGxlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtdGl0bGVcIik7XG5cbiAgICBjb25zdCB0ZXh0QXJlYUNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHJvd3M6IHRoaXMub3B0aW9ucy5yb3dzIHx8IDEsXG4gICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIgfHwgXCJcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRoaXMuaW5pdGlhbFZhbHVlO1xuXG4gICAgLy8gQWRkIHJlc2l6ZSBvYnNlcnZlciB0byBoYW5kbGUgZHluYW1pYyBjb250ZW50XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGhpcy50ZXh0QXJlYS5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfSk7XG4gICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRleHRBcmVhKTtcblxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiKTtcblxuICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5QnV0dG9uIHx8IFwiQ2FuY2VsXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHNlY29uZGFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlQ2FuY2VsO1xuXG4gICAgLy8gQWRkIEdlbmVyYXRlIFRpdGxlIGJ1dHRvbiBpZiB3ZSBoYXZlIHRoZSBzZXJ2aWNlIGFuZCBtZXNzYWdlc1xuICAgIGlmICh0aGlzLnRpdGxlR2VuZXJhdGlvblNlcnZpY2UgJiYgdGhpcy5vcHRpb25zLm1lc3NhZ2VzKSB7XG4gICAgICB0aGlzLmdlbmVyYXRlQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgdGV4dDogXCJHZW5lcmF0ZSBUaXRsZVwiLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgfSk7XG4gICAgICB0aGlzLmdlbmVyYXRlQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmdlbmVyYXRlQnV0dG9uKSB7XG4gICAgICAgICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbi5zZXRBdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgIHRoaXMuZ2VuZXJhdGVCdXR0b24uc2V0VGV4dChcIkdlbmVyYXRpbmcuLi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnRpdGxlR2VuZXJhdGlvblNlcnZpY2U/LmdlbmVyYXRlVGl0bGUoXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVzc2FnZXMhLFxuICAgICAgICAgICAgKHRpdGxlKSA9PiB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRpdGxlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyB0aXRsZTpcIiwgZXJyb3IpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGlmICh0aGlzLmdlbmVyYXRlQnV0dG9uKSB7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbi5zZXRUZXh0KFwiR2VuZXJhdGUgVGl0bGVcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnByaW1hcnlCdXR0b24gfHwgXCJTYXZlXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlU2F2ZSA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy50ZXh0QXJlYS52YWx1ZTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHByaW1hcnlCdXR0b24ub25jbGljayA9IGhhbmRsZVNhdmU7XG5cbiAgICAvLyBIYW5kbGUga2V5Ym9hcmQgZXZlbnRzXG4gICAgdGhpcy5tb2RhbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgIWUuaXNDb21wb3NpbmcgJiZcbiAgICAgICAgIWUuc2hpZnRLZXkgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLnJvd3MgPT09IDFcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVNhdmUoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVDYW5jZWwoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZvY3VzIHRoZSB0ZXh0YXJlYSBhbmQgcGxhY2UgY3Vyc29yIGF0IHRoZSBlbmRcbiAgICB0aGlzLnRleHRBcmVhLmZvY3VzKCk7XG4gICAgdGhpcy50ZXh0QXJlYS5zZXRTZWxlY3Rpb25SYW5nZShcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoLFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGhcbiAgICApO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucmVzb2x2ZVByb21pc2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dUZXh0YXJlYVBvcHVwKFxuICBhcHA6IEFwcCxcbiAgdGl0bGU6IHN0cmluZyxcbiAgaW5pdGlhbENvbnRlbnQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IFRleHRBcmVhTW9kYWxPcHRpb25zXG4pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgVGV4dEFyZWFNb2RhbChhcHAsIHRpdGxlLCBpbml0aWFsQ29udGVudCwgb3B0aW9ucyk7XG4gIHJldHVybiBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIFBvcHVwT3B0aW9ucyB7XG4gIHByaW1hcnlCdXR0b24/OiBzdHJpbmc7XG4gIHNlY29uZGFyeUJ1dHRvbj86IHN0cmluZztcbiAgdGl0bGU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpY29uPzogc3RyaW5nO1xuICBpbnB1dHM/OiB7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gIH1bXTtcbn1cblxuZXhwb3J0IGNsYXNzIFBvcHVwQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBtZXNzYWdlOiBzdHJpbmc7XG4gIHByaXZhdGUgb3B0aW9uczogUG9wdXBPcHRpb25zO1xuICBwcml2YXRlIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKFxuICAgIHZhbHVlOiB7IGNvbmZpcm1lZDogYm9vbGVhbjsgaW5wdXRzPzogc3RyaW5nW10gfSB8IG51bGxcbiAgKSA9PiB2b2lkO1xuICBwcml2YXRlIHJlc3VsdDogeyBjb25maXJtZWQ6IGJvb2xlYW47IGlucHV0cz86IHN0cmluZ1tdIH0gfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgbWVzc2FnZTogc3RyaW5nLCBvcHRpb25zOiBQb3B1cE9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUG9wdXAoKSB7XG4gICAgLy8gQ3JlYXRlIGNvbnRhaW5lclxuICAgIHRoaXMuY29udGFpbmVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtcG9wdXAtY29udGFpbmVyXCIpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXJFbCk7XG5cbiAgICAvLyBDcmVhdGUgcG9wdXBcbiAgICBjb25zdCBwb3B1cEVsID0gdGhpcy5jb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwXCIgfSk7XG4gICAgY29uc3QgY29udGVudCA9IHBvcHVwRWwuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1jb250ZW50XCIgfSk7XG5cbiAgICAvLyBBZGQgdGl0bGUgaWYgcHJvdmlkZWRcbiAgICBpZiAodGhpcy5vcHRpb25zLnRpdGxlKSB7XG4gICAgICBjb25zdCB0aXRsZUVsID0gY29udGVudC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LXBvcHVwLXRpdGxlXCIgfSk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmljb24pIHtcbiAgICAgICAgY29uc3QgaWNvbkVsID0gdGl0bGVFbC5jcmVhdGVTcGFuKHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1pY29uXCIgfSk7XG4gICAgICAgIHNldEljb24oaWNvbkVsLCB0aGlzLm9wdGlvbnMuaWNvbik7XG4gICAgICB9XG4gICAgICB0aXRsZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiB0aGlzLm9wdGlvbnMudGl0bGUgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIG1haW4gbWVzc2FnZVxuICAgIGlmICh0aGlzLm1lc3NhZ2UpIHtcbiAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1tZXNzYWdlXCIsXG4gICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvbiBpZiBwcm92aWRlZFxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGVzY3JpcHRpb24pIHtcbiAgICAgIGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1kZXNjcmlwdGlvblwiLFxuICAgICAgICB0ZXh0OiB0aGlzLm9wdGlvbnMuZGVzY3JpcHRpb24sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgaW5wdXRzIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRoaXMub3B0aW9ucy5pbnB1dHMpIHtcbiAgICAgIGNvbnN0IGlucHV0c0NvbnRhaW5lciA9IGNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1pbnB1dHNcIixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLm9wdGlvbnMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgIGlmIChpbnB1dC50eXBlID09PSBcInRleHRhcmVhXCIpIHtcbiAgICAgICAgICBpbnB1dHNDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICAgICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtcG9wdXAtdGV4dGFyZWEgJHtpbnB1dC5jbGFzc05hbWUgfHwgXCJcIn1gLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGlucHV0LnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgdmFsdWU6IGlucHV0LnZhbHVlIHx8IFwiXCIsXG4gICAgICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBpbnB1dC5yZXF1aXJlZCA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnB1dHNDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LXBvcHVwLWlucHV0ICR7aW5wdXQuY2xhc3NOYW1lIHx8IFwiXCJ9YCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBpbnB1dC5wbGFjZWhvbGRlcixcbiAgICAgICAgICAgIHZhbHVlOiBpbnB1dC52YWx1ZSB8fCBcIlwiLFxuICAgICAgICAgICAgYXR0cjoge1xuICAgICAgICAgICAgICByZXF1aXJlZDogaW5wdXQucmVxdWlyZWQgPyB0cnVlIDogbnVsbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBidXR0b25zXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gcG9wdXBFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLnNlY29uZGFyeUJ1dHRvbikge1xuICAgICAgY29uc3Qgc2Vjb25kYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b24gc3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLnNlY29uZGFyeUJ1dHRvbixcbiAgICAgIH0pO1xuICAgICAgc2Vjb25kYXJ5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0geyBjb25maXJtZWQ6IGZhbHNlIH07XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBgc3lzdGVtc2N1bHB0LXBvcHVwLWJ1dHRvbiAke1xuICAgICAgICB0aGlzLm9wdGlvbnMucHJpbWFyeUJ1dHRvbiA9PT0gXCJCZWNvbWUgQSBQYXRyb25cIiB8fFxuICAgICAgICB0aGlzLm9wdGlvbnMucHJpbWFyeUJ1dHRvbiA9PT0gXCJCZWNvbWUgYSBQYXRyb25cIlxuICAgICAgICAgID8gXCJzeXN0ZW1zY3VscHQtcG9wdXAtYnV0dG9uLXBhdHJvblwiXG4gICAgICAgICAgOiBcInN5c3RlbXNjdWxwdC1wb3B1cC1idXR0b24tcHJpbWFyeVwiXG4gICAgICB9YCxcbiAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5wcmltYXJ5QnV0dG9uIHx8IFwiT0tcIixcbiAgICB9KTtcblxuICAgIHByaW1hcnlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5wdXRzKSB7XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oXG4gICAgICAgICAgcG9wdXBFbC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHRleHRhcmVhXCIpIGFzIE5vZGVMaXN0T2Y8XG4gICAgICAgICAgICBIVE1MSW5wdXRFbGVtZW50IHwgSFRNTFRleHRBcmVhRWxlbWVudFxuICAgICAgICAgID5cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBpZiBhbnkgcmVxdWlyZWQgaW5wdXRzIGFyZSBlbXB0eVxuICAgICAgICBjb25zdCBoYXNFbXB0eVJlcXVpcmVkID0gaW5wdXRzLnNvbWUoXG4gICAgICAgICAgKGlucHV0KSA9PiBpbnB1dC5yZXF1aXJlZCAmJiAhaW5wdXQudmFsdWUudHJpbSgpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChoYXNFbXB0eVJlcXVpcmVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7XG4gICAgICAgICAgY29uZmlybWVkOiB0cnVlLFxuICAgICAgICAgIGlucHV0czogaW5wdXRzLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0geyBjb25maXJtZWQ6IHRydWUgfTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBrZXlib2FyZCBoYW5kbGVyc1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICB0aGlzLnJlc3VsdCA9IHsgY29uZmlybWVkOiBmYWxzZSB9O1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZS5pc0NvbXBvc2luZyAmJiAhZS5zaGlmdEtleSkge1xuICAgICAgICBwcmltYXJ5QnV0dG9uLmNsaWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDbG9zZSBvbiBiYWNrZ3JvdW5kIGNsaWNrXG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuY29udGFpbmVyRWwpIHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSB7IGNvbmZpcm1lZDogZmFsc2UgfTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjbG9zZSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lckVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LXBvcHVwLWNsb3NpbmdcIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRhaW5lckVsLnJlbW92ZSgpO1xuICAgICAgaWYgKHRoaXMucmVzb2x2ZVByb21pc2UpIHtcbiAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTsgLy8gTWF0Y2ggdGhlIGFuaW1hdGlvbiBkdXJhdGlvblxuICB9XG5cbiAgcHVibGljIG9wZW4oKTogUHJvbWlzZTx7IGNvbmZpcm1lZDogYm9vbGVhbjsgaW5wdXRzPzogc3RyaW5nW10gfSB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5jcmVhdGVQb3B1cCgpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93UG9wdXAoXG4gIGFwcDogQXBwLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIG9wdGlvbnM6IFBvcHVwT3B0aW9ucyA9IHt9XG4pOiBQcm9taXNlPHsgY29uZmlybWVkOiBib29sZWFuOyBpbnB1dHM/OiBzdHJpbmdbXSB9IHwgbnVsbD4ge1xuICBjb25zdCBwb3B1cCA9IG5ldyBQb3B1cENvbXBvbmVudChhcHAsIG1lc3NhZ2UsIG9wdGlvbnMpO1xuICByZXR1cm4gcG9wdXAub3BlbigpO1xufVxuIiwgImltcG9ydCB7IE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0RXJyb3IgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvZXJyb3JzXCI7XG5cbnR5cGUgTm90aWNlVHlwZSA9IFwiaW5mb1wiIHwgXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcInN1Y2Nlc3NcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHNob3dFbmhhbmNlZE5vdGljZShcbiAgbWVzc2FnZTogc3RyaW5nLFxuICB0eXBlPzogTm90aWNlVHlwZSxcbiAgZXJyb3I/OiBFcnJvciB8IFN5c3RlbVNjdWxwdEVycm9yIHwgdW5rbm93blxuKSB7XG4gIC8vIEFsd2F5cyBsb2cgZXJyb3JzIHRvIGNvbnNvbGUgaWYgcHJlc2VudFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiTm90aWNlIGVycm9yIGRldGFpbHM6XCIsIHtcbiAgICAgIGVycm9yLFxuICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIG1ldGFkYXRhOiBlcnJvciBpbnN0YW5jZW9mIFN5c3RlbVNjdWxwdEVycm9yID8gZXJyb3IubWV0YWRhdGEgOiB1bmRlZmluZWQsXG4gICAgfSk7XG4gIH1cblxuICBsZXQgZHVyYXRpb246IG51bWJlcjtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBkdXJhdGlvbiA9IDEwMDAwOyAvLyAxMCBzZWNvbmRzIGZvciBlcnJvcnNcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ3YXJuaW5nXCI6XG4gICAgICBkdXJhdGlvbiA9IDUwMDA7IC8vIDUgc2Vjb25kcyBmb3Igd2FybmluZ3NcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBkdXJhdGlvbiA9IDMwMDA7IC8vIDMgc2Vjb25kcyBmb3IgaW5mbyBhbmQgc3VjY2Vzc1xuICB9XG5cbiAgY29uc3Qgbm90aWNlID0gbmV3IE5vdGljZShtZXNzYWdlLCBkdXJhdGlvbik7XG4gIHJldHVybiBub3RpY2U7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuL21vZGFscy9Qb3B1cE1vZGFsXCI7XG5cbmludGVyZmFjZSBOb3RpZmljYXRpb25PcHRpb25zIHtcbiAgdHlwZT86IFwic3VjY2Vzc1wiIHwgXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcImluZm9cIjtcbiAgZHVyYXRpb24/OiBudW1iZXI7XG4gIGljb24/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBBbGVydE9wdGlvbnMge1xuICB0aXRsZT86IHN0cmluZztcbiAgcHJpbWFyeUJ1dHRvbj86IHN0cmluZztcbiAgc2Vjb25kYXJ5QnV0dG9uPzogc3RyaW5nO1xuICBpY29uPzogc3RyaW5nO1xuICB0eXBlPzogXCJlcnJvclwiIHwgXCJ3YXJuaW5nXCIgfCBcImluZm9cIjtcbn1cblxuLyoqXG4gKiBTaG93IGEgcXVpY2sgbm90aWZpY2F0aW9uIGZvciBub24tY3JpdGljYWwgaW5mb3JtYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dOb3RpY2UobWVzc2FnZTogc3RyaW5nLCBvcHRpb25zOiBOb3RpZmljYXRpb25PcHRpb25zID0ge30pIHtcbiAgY29uc3QgeyB0eXBlID0gXCJpbmZvXCIsIGR1cmF0aW9uID0gNDAwMCB9ID0gb3B0aW9ucztcbiAgbGV0IHByZWZpeCA9IFwiXCI7XG5cbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcInN1Y2Nlc3NcIjpcbiAgICAgIHByZWZpeCA9IFwiXHUyNzI4IFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBwcmVmaXggPSBcIlx1Mjc0QyBcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ3YXJuaW5nXCI6XG4gICAgICBwcmVmaXggPSBcIlx1MjZBMFx1RkUwRiBcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJpbmZvXCI6XG4gICAgICBwcmVmaXggPSBcIlx1MjEzOVx1RkUwRiBcIjtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgbmV3IE5vdGljZShwcmVmaXggKyBtZXNzYWdlLCBkdXJhdGlvbik7XG59XG5cbi8qKlxuICogU2hvdyBhbiBhbGVydCBwb3B1cCBmb3IgaW1wb3J0YW50IG1lc3NhZ2VzIHRoYXQgbmVlZCB1c2VyIGF0dGVudGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd0FsZXJ0KFxuICBhcHA6IEFwcCxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBvcHRpb25zOiBBbGVydE9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTx7IGNvbmZpcm1lZDogYm9vbGVhbiB9PiB7XG4gIGNvbnN0IHtcbiAgICB0aXRsZSA9IG9wdGlvbnMudHlwZSA9PT0gXCJlcnJvclwiXG4gICAgICA/IFwiRXJyb3JcIlxuICAgICAgOiBvcHRpb25zLnR5cGUgPT09IFwid2FybmluZ1wiXG4gICAgICA/IFwiV2FybmluZ1wiXG4gICAgICA6IFwiQWxlcnRcIixcbiAgICBwcmltYXJ5QnV0dG9uID0gXCJPS1wiLFxuICAgIHNlY29uZGFyeUJ1dHRvbixcbiAgICBpY29uID0gb3B0aW9ucy50eXBlID09PSBcImVycm9yXCJcbiAgICAgID8gXCJhbGVydC1jaXJjbGVcIlxuICAgICAgOiBvcHRpb25zLnR5cGUgPT09IFwid2FybmluZ1wiXG4gICAgICA/IFwiYWxlcnQtdHJpYW5nbGVcIlxuICAgICAgOiBcImluZm9cIixcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKGFwcCwgbWVzc2FnZSwge1xuICAgIHRpdGxlLFxuICAgIHByaW1hcnlCdXR0b24sXG4gICAgc2Vjb25kYXJ5QnV0dG9uLFxuICAgIGljb24sXG4gIH0pO1xuXG4gIHJldHVybiB7IGNvbmZpcm1lZDogcmVzdWx0Py5jb25maXJtZWQgfHwgZmFsc2UgfTtcbn1cblxuLyoqXG4gKiBTaG93IGEgY29uZmlybWF0aW9uIHBvcHVwIGZvciBhY3Rpb25zIHRoYXQgbmVlZCB1c2VyIGFwcHJvdmFsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93Q29uZmlybShcbiAgYXBwOiBBcHAsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgb3B0aW9uczogQWxlcnRPcHRpb25zID0ge31cbik6IFByb21pc2U8eyBjb25maXJtZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7XG4gICAgdGl0bGUgPSBcIkNvbmZpcm0gQWN0aW9uXCIsXG4gICAgcHJpbWFyeUJ1dHRvbiA9IFwiQ29uZmlybVwiLFxuICAgIHNlY29uZGFyeUJ1dHRvbiA9IFwiQ2FuY2VsXCIsXG4gICAgaWNvbiA9IFwiaGVscC1jaXJjbGVcIixcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKGFwcCwgbWVzc2FnZSwge1xuICAgIHRpdGxlLFxuICAgIHByaW1hcnlCdXR0b24sXG4gICAgc2Vjb25kYXJ5QnV0dG9uLFxuICAgIGljb24sXG4gIH0pO1xuXG4gIHJldHVybiB7IGNvbmZpcm1lZDogcmVzdWx0Py5jb25maXJtZWQgfHwgZmFsc2UgfTtcbn1cbiIsICJleHBvcnQgeyBjcmVhdGVMb2FkaW5nSW5kaWNhdG9yIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Mb2FkaW5nSW5kaWNhdG9yXCI7XG5leHBvcnQgeyBjcmVhdGVCdXR0b24gfSBmcm9tIFwiLi9jb21wb25lbnRzL0J1dHRvblwiO1xuZXhwb3J0IHtcbiAgVGV4dEFyZWFNb2RhbCxcbiAgdHlwZSBUZXh0QXJlYU1vZGFsT3B0aW9ucyxcbiAgc2hvd1RleHRhcmVhUG9wdXAsXG59IGZyb20gXCIuL21vZGFscy9UZXh0QXJlYU1vZGFsXCI7XG5leHBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi9tb2RhbHMvUG9wdXBNb2RhbFwiO1xuZXhwb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Ob3RpY2VcIjtcbmV4cG9ydCB7IHNob3dOb3RpY2UsIHNob3dBbGVydCwgc2hvd0NvbmZpcm0gfSBmcm9tIFwiLi9ub3RpZmljYXRpb25zXCI7XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgQWJzdHJhY3RJbnB1dFN1Z2dlc3QgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuZXhwb3J0IGNsYXNzIEZpbGVTdWdnZXN0ZXIgZXh0ZW5kcyBBYnN0cmFjdElucHV0U3VnZ2VzdDxzdHJpbmc+IHtcbiAgcHJpdmF0ZSBjb250ZW50OiBTZXQ8c3RyaW5nPjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gICAgcHJpdmF0ZSBvblNlbGVjdENiOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZCxcbiAgICBhcHA6IEFwcCxcbiAgICBwcml2YXRlIGRpcmVjdG9yeTogc3RyaW5nXG4gICkge1xuICAgIHN1cGVyKGFwcCwgaW5wdXRFbCk7XG4gICAgdGhpcy5jb250ZW50ID0gZ2V0RmlsZVN1Z2dlc3Rpb25zKGFwcCwgZGlyZWN0b3J5KTtcbiAgfVxuXG4gIGdldFN1Z2dlc3Rpb25zKGlucHV0U3RyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgbG93ZXJDYXNlSW5wdXRTdHIgPSBpbnB1dFN0ci50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBbLi4udGhpcy5jb250ZW50XS5maWx0ZXIoKGNvbnRlbnQpID0+XG4gICAgICBjb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlSW5wdXRTdHIpXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBlbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAvLyBSZW1vdmUgYW55IHRyYWlsaW5nIFwiLm1kXCIgZXh0ZW5zaW9uIHRvIGF2b2lkIGNsdXR0ZXJcbiAgICBsZXQgZGlzcGxheSA9IGNvbnRlbnQucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgZWwuc2V0VGV4dChkaXNwbGF5KTtcbiAgfVxuXG4gIHNlbGVjdFN1Z2dlc3Rpb24oY29udGVudDogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5vblNlbGVjdENiKGNvbnRlbnQpO1xuICAgIHRoaXMuaW5wdXRFbC52YWx1ZSA9IGNvbnRlbnQucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgdGhpcy5pbnB1dEVsLmJsdXIoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbGVTdWdnZXN0aW9ucyhhcHA6IEFwcCwgZGlyZWN0b3J5OiBzdHJpbmcpOiBTZXQ8c3RyaW5nPiB7XG4gIGNvbnN0IGZpbGVzID0gYXBwLnZhdWx0LmdldEFsbExvYWRlZEZpbGVzKCkuZmlsdGVyKChmaWxlKTogZmlsZSBpcyBURmlsZSA9PiB7XG4gICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkgcmV0dXJuIGZhbHNlO1xuICAgIC8vIE9ubHkgaW5jbHVkZSAubWQgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHNwZWNpZmllZCBkaXJlY3RvcnkgKG5vdCBpbiBzdWJkaXJlY3RvcmllcylcbiAgICBjb25zdCBmaWxlRGlyID0gZmlsZS5wYXJlbnQ/LnBhdGg7XG4gICAgcmV0dXJuIGZpbGVEaXIgPT09IGRpcmVjdG9yeSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiO1xuICB9KTtcbiAgcmV0dXJuIG5ldyBTZXQoZmlsZXMubWFwKChmaWxlKSA9PiBmaWxlLnBhdGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaEZpbGVTdWdnZXN0ZXIoXG4gIGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoOiBzdHJpbmcpID0+IHZvaWQsXG4gIGFwcDogQXBwLFxuICBkaXJlY3Rvcnk6IHN0cmluZ1xuKTogRmlsZVN1Z2dlc3RlciB7XG4gIHJldHVybiBuZXcgRmlsZVN1Z2dlc3RlcihpbnB1dEVsLCBvblNlbGVjdCwgYXBwLCBkaXJlY3RvcnkpO1xufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgYXR0YWNoRmlsZVN1Z2dlc3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVTdWdnZXN0ZXJcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGl0bGVHZW5lcmF0aW9uUHJvbXB0VHlwZSB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47XG4gIHN5c3RlbVByb21wdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRpdGxlR2VuZXJhdGlvblByb21wdFJlc3VsdCB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdHlwZTogXCJwcmVjaXNlXCIgfCBcIm1vdmllLXN0eWxlXCIgfCBcImN1c3RvbVwiO1xuICBwYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgVGl0bGVHZW5lcmF0aW9uUHJvbXB0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcmVzdWx0OiBUaXRsZUdlbmVyYXRpb25Qcm9tcHRSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBUaXRsZUdlbmVyYXRpb25Qcm9tcHRSZXN1bHQgfCBudWxsKSA9PiB2b2lkO1xuICBwcml2YXRlIHRleHRBcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIGxvYWRpbmdJbmRpY2F0b3I6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGNvbnRlbnRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHByZXNldEJ1dHRvbkNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tU2VjdGlvbjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY3VzdG9tSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgYWN0aXZlUHJlc2V0OiBzdHJpbmcgfCBudWxsID0gXCJwcmVjaXNlXCI7IC8vIERlZmF1bHQgdG8gcHJlY2lzZVxuICBwcml2YXRlIHByb21wdHM6IFRpdGxlR2VuZXJhdGlvblByb21wdFR5cGVbXSA9IFtdO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBwcml2YXRlIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgICBwcml2YXRlIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZyA9IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gICAgcHJpdmF0ZSBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZ1xuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiLCBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1tb2RhbFwiKTtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKHBsdWdpbi5zZXR0aW5ncywgYXBwKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd0xvYWRpbmcoc2hvdzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5sb2FkaW5nSW5kaWNhdG9yIHx8ICF0aGlzLmNvbnRlbnRDb250YWluZXIpIHJldHVybjtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG4gIH1cblxuICBhc3luYyBsb2FkUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyh0cnVlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvdGl0bGUtZ2VuZXJhdGlvbi1wcm9tcHRzYFxuICAgICAgKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvYWQgcHJvbXB0c1wiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICB0aGlzLnByb21wdHMgPSBkYXRhLmRhdGEucHJvbXB0cztcblxuICAgICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b25zIGFmdGVyIGxvYWRpbmcgZGF0YVxuICAgICAgdGhpcy5jcmVhdGVQcmVzZXRCdXR0b25zKCk7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIHRpdGxlIGdlbmVyYXRpb24gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRmFpbGVkIHRvIGxvYWQgcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcmVzZXRCdXR0b25zKCkge1xuICAgIGlmICghdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIpIHJldHVybjtcblxuICAgIC8vIENsZWFyIGV4aXN0aW5nIGJ1dHRvbnNcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBhY3RpdmUgcHJlc2V0IGJhc2VkIG9uIGN1cnJlbnQgcHJvbXB0IGFuZCBwYXRoXG4gICAgaWYgKHRoaXMuY3VycmVudEN1c3RvbVBhdGgpIHtcbiAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gXCJjdXN0b21cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcm9tcHRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICBpZiAocHJlc2V0LnN5c3RlbVByb21wdCA9PT0gdGhpcy5jdXJyZW50UHJvbXB0KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQuaWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9ucyBmb3IgZWFjaCBwcm9tcHRcbiAgICB0aGlzLnByb21wdHMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIHRleHQ6IHByZXNldC5sYWJlbCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHRvb2x0aXAgd2l0aCBkZXNjcmlwdGlvbiBpZiBhdmFpbGFibGVcbiAgICAgIGlmIChwcmVzZXQuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcHJlc2V0LmRlc2NyaXB0aW9uKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiaGFzLXRvb2x0aXBcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBpbml0aWFsIGFjdGl2ZSBzdGF0ZVxuICAgICAgaWYgKHByZXNldC5pZCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpIHtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2ZSBjbGFzcyBmcm9tIGFsbCBidXR0b25zXG4gICAgICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyXG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIilcbiAgICAgICAgICAuZm9yRWFjaCgoYnRuKSA9PiBidG4ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmlkO1xuXG4gICAgICAgIC8vIFNob3cvaGlkZSBjdXN0b20gc2VjdGlvblxuICAgICAgICBpZiAocHJlc2V0LmlkID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC5mb2N1cygpO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9ICFwcmVzZXQuaXNVc2VyQ29uZmlndXJhYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIFNob3cgY3VzdG9tIHNlY3Rpb24gaWYgaXQncyBhY3RpdmVcbiAgICBpZiAodGhpcy5hY3RpdmVQcmVzZXQgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgaWYgKHRoaXMuY3VycmVudEN1c3RvbVBhdGgpIHtcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHRoaXMuY3VycmVudEN1c3RvbVBhdGg7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1jb250ZW50XCIpO1xuXG4gICAgLy8gQWRkIHRpdGxlXG4gICAgdGhpcy50aXRsZUVsLnNldFRleHQoXCJFZGl0IFRpdGxlIEdlbmVyYXRpb24gUHJvbXB0XCIpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aGlzLnRpdGxlRWwuY3JlYXRlRGl2KCk7XG4gICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbkVsLnNldFRleHQoXG4gICAgICBcIkNvbmZpZ3VyZSBob3cgdGl0bGVzIHNob3VsZCBiZSBnZW5lcmF0ZWQgZnJvbSB5b3VyIGNvbnRlbnRcIlxuICAgICk7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmZvbnRTaXplID0gXCIwLjllbVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUubWFyZ2luVG9wID0gXCIwLjJlbVwiO1xuXG4gICAgLy8gQ3JlYXRlIGxvYWRpbmcgaW5kaWNhdG9yXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IHRoaXMubG9hZGluZ0luZGljYXRvci5jcmVhdGVTcGFuKCk7XG4gICAgbG9hZGluZ1RleHQuc2V0VGV4dChcIkxvYWRpbmcgcHJvbXB0cy4uLlwiKTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9uIGNvbnRhaW5lclxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHNlY3Rpb24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuY3VzdG9tU2VjdGlvbiA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1zZWN0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBjdXN0b21JbnB1dENvbnRhaW5lciA9IHRoaXMuY3VzdG9tU2VjdGlvbi5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgYW5kIGJ1dHRvblxuICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGN1c3RvbUlucHV0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LXdyYXBwZXJcIlxuICAgICk7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdGhlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuY3VzdG9tSW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmb3IgYSBzeXN0ZW0gcHJvbXB0IGZpbGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNyZWF0ZSBuZXcgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnV0dG9uID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3JlYXRlLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gXCI0cHggOHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHNldEljb24oY3JlYXRlQnV0dG9uLCBcInBsdXNcIik7XG5cbiAgICBjcmVhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnQgPSBcIlwiO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzL3RlbXBsYXRlYFxuICAgICAgICApO1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRlbXBsYXRlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIHRlbXBsYXRlQ29udGVudCA9IGRhdGEudGVtcGxhdGU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJDcmVhdGUgTmV3IFN5c3RlbSBQcm9tcHRcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJFbnRlciBhIHRpdGxlIGFuZCBjb250ZW50IGZvciB5b3VyIG5ldyBzeXN0ZW0gcHJvbXB0LiBUaGUgdGl0bGUgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIG1hcmtkb3duIGZpbGUgdGhhdCB5b3UgY2FuIGN1c3RvbWl6ZSBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJDcmVhdGVcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIk15IEN1c3RvbSBUaXRsZSBHZW5lcmF0b3JcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tdGl0bGUtaW5wdXRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgICAgIHZhbHVlOiB0ZW1wbGF0ZUNvbnRlbnQsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLWNvbnRlbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzdWx0Py5jb25maXJtZWQgfHwgIXJlc3VsdC5pbnB1dHM/LlswXSB8fCAhcmVzdWx0LmlucHV0cz8uWzFdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3RpdGxlLCBjb250ZW50XSA9IHJlc3VsdC5pbnB1dHM7XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHRpdGxlLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKS5yZXBsYWNlKC8gL2csIFwiLVwiKTtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5fS8ke2ZpbGVOYW1lfWA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHRcbiAgICAgICAgICAuY3JlYXRlRm9sZGVyKHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSlcbiAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgLyogRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QgKi9cbiAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGAjICR7dGl0bGV9XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGggKyBcIi5tZFwiLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSB0ZXh0YXJlYSB3aXRoIHRoZSBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGZpbGVDb250ZW50O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgZmlsZVxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gZmlsZVBhdGg7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN5c3RlbSBwcm9tcHQgZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgOiBcIkZhaWxlZCB0byBjcmVhdGUgc3lzdGVtIHByb21wdCBmaWxlXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEF0dGFjaCBmaWxlIHN1Z2dlc3RlciBmb3IgY3VzdG9tIHByb21wdHNcbiAgICBhdHRhY2hGaWxlU3VnZ2VzdGVyKFxuICAgICAgdGhpcy5jdXN0b21JbnB1dCxcbiAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBjb250ZW50O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlIHdpdGhvdXQgLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHNlbGVjdGVkUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeVxuICAgICk7XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHRpdGxlIGdlbmVyYXRpb24gcHJvbXB0XCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQ7XG5cbiAgICAvLyBBZGQgcmVzaXplIG9ic2VydmVyIHRvIGhhbmRsZSBkeW5hbWljIGNvbnRlbnRcbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSB0aGlzLnRleHRBcmVhLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICB9KTtcbiAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMudGV4dEFyZWEpO1xuXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVDYW5jZWw7XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiU2F2ZVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZVNhdmUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBhY3RpdmVQcmVzZXQgPSB0aGlzLnByb21wdHMuZmluZCgocCkgPT4gcC5pZCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpO1xuICAgICAgdGhpcy5yZXN1bHQgPSB7XG4gICAgICAgIGNvbnRlbnQ6IHRoaXMudGV4dEFyZWEudmFsdWUsXG4gICAgICAgIHR5cGU6IChhY3RpdmVQcmVzZXQ/LmlkIHx8IFwiY3VzdG9tXCIpIGFzIFwicHJlY2lzZVwiIHwgXCJtb3ZpZS1zdHlsZVwiIHwgXCJjdXN0b21cIixcbiAgICAgICAgcGF0aDpcbiAgICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9PT0gXCJjdXN0b21cIiA/IHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgOiB1bmRlZmluZWQsXG4gICAgICB9O1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlU2F2ZTtcblxuICAgIC8vIEhhbmRsZSBrZXlib2FyZCBldmVudHNcbiAgICB0aGlzLm1vZGFsRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZS5rZXkgPT09IFwiRW50ZXJcIiAmJlxuICAgICAgICAhZS5pc0NvbXBvc2luZyAmJlxuICAgICAgICAhZS5zaGlmdEtleSAmJlxuICAgICAgICBlLnRhcmdldCAhPT0gdGhpcy50ZXh0QXJlYVxuICAgICAgKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlU2F2ZSgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUNhbmNlbCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgdGhlIHRleHRhcmVhIGFuZCBwbGFjZSBjdXJzb3IgYXQgdGhlIGVuZFxuICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICB0aGlzLnRleHRBcmVhLnNldFNlbGVjdGlvblJhbmdlKFxuICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aFxuICAgICk7XG5cbiAgICAvLyBTdGFydCBsb2FkaW5nIHByb21wdHMgYWZ0ZXIgVUkgaXMgc2V0IHVwXG4gICAgYXdhaXQgdGhpcy5sb2FkUHJvbXB0cygpO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucmVzb2x2ZVByb21pc2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPFRpdGxlR2VuZXJhdGlvblByb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dUaXRsZUdlbmVyYXRpb25Qcm9tcHRNb2RhbChcbiAgYXBwOiBBcHAsXG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiB7XG4gICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeT86IHN0cmluZztcbiAgICBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZztcbiAgfVxuKTogUHJvbWlzZTxUaXRsZUdlbmVyYXRpb25Qcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gIGNvbnN0IG1vZGFsID0gbmV3IFRpdGxlR2VuZXJhdGlvblByb21wdE1vZGFsKFxuICAgIGFwcCxcbiAgICBwbHVnaW4sXG4gICAgY3VycmVudFByb21wdCxcbiAgICBvcHRpb25zPy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgIG9wdGlvbnM/LmN1cnJlbnRDdXN0b21QYXRoXG4gICk7XG4gIHJldHVybiBhd2FpdCBtb2RhbC5vcGVuQW5kR2V0VmFsdWUoKTtcbn0gIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgYXR0YWNoRmlsZVN1Z2dlc3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVTdWdnZXN0ZXJcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9zdFRyYW5zY3JpcHRpb25Qcm9tcHRUeXBlIHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGlzVXNlckNvbmZpZ3VyYWJsZTogYm9vbGVhbjtcbiAgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHR5cGU6IFwiZ2VuZXJhbFwiIHwgXCJyaHltZVwiIHwgXCJjdXN0b21cIjtcbiAgcGF0aD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFBvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgcmVzdWx0OiBQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IFBvc3RQcm9jZXNzaW5nUHJvbXB0UmVzdWx0IHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVzZXRCdXR0b25Db250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbVNlY3Rpb246IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGN1c3RvbUlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIGFjdGl2ZVByZXNldDogc3RyaW5nIHwgbnVsbCA9IFwiZ2VuZXJhbFwiOyAvLyBEZWZhdWx0IHRvIGdlbmVyYWxcbiAgcHJpdmF0ZSBwcm9tcHRzOiBQb3N0VHJhbnNjcmlwdGlvblByb21wdFR5cGVbXSA9IFtdO1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgICBwcml2YXRlIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgICBwcml2YXRlIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZyA9IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gICAgcHJpdmF0ZSBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZ1xuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiLCBcInN5c3RlbXNjdWxwdC10ZXh0YXJlYS1tb2RhbFwiKTtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKHBsdWdpbi5zZXR0aW5ncywgYXBwKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd0xvYWRpbmcoc2hvdzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5sb2FkaW5nSW5kaWNhdG9yIHx8ICF0aGlzLmNvbnRlbnRDb250YWluZXIpIHJldHVybjtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG4gIH1cblxuICBhc3luYyBsb2FkUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyh0cnVlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGAke3RoaXMuc2N1bHB0U2VydmljZS5iYXNlVXJsfS9hcGkvdjEvcG9zdC10cmFuc2NyaXB0aW9uLXByb21wdHNgXG4gICAgICApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBwcm9tcHRzXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHRoaXMucHJvbXB0cyA9IGRhdGEuZGF0YS5wcm9tcHRzO1xuXG4gICAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgYWZ0ZXIgbG9hZGluZyBkYXRhXG4gICAgICB0aGlzLmNyZWF0ZVByZXNldEJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgcG9zdC10cmFuc2NyaXB0aW9uIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkZhaWxlZCB0byBsb2FkIHByb21wdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsXG4gICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJlc2V0QnV0dG9ucygpIHtcbiAgICBpZiAoIXRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICAvLyBDbGVhciBleGlzdGluZyBidXR0b25zXG4gICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuZW1wdHkoKTtcblxuICAgIC8vIEluaXRpYWxpemUgYWN0aXZlIHByZXNldCBiYXNlZCBvbiBjdXJyZW50IHByb21wdCBhbmQgcGF0aFxuICAgIGlmICh0aGlzLmN1cnJlbnRDdXN0b21QYXRoKSB7XG4gICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IFwiY3VzdG9tXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvbXB0cy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgaWYgKHByZXNldC5zeXN0ZW1Qcm9tcHQgPT09IHRoaXMuY3VycmVudFByb21wdCkge1xuICAgICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmlkO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgZm9yIGVhY2ggcHJvbXB0XG4gICAgdGhpcy5wcm9tcHRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBwcmVzZXQubGFiZWwsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCB0b29sdGlwIHdpdGggZGVzY3JpcHRpb24gaWYgYXZhaWxhYmxlXG4gICAgICBpZiAocHJlc2V0LmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHByZXNldC5kZXNjcmlwdGlvbik7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImhhcy10b29sdGlwXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgaW5pdGlhbCBhY3RpdmUgc3RhdGVcbiAgICAgIGlmIChwcmVzZXQuaWQgPT09IHRoaXMuYWN0aXZlUHJlc2V0KSB7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gIXByZXNldC5pc1VzZXJDb25maWd1cmFibGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3RpdmUgY2xhc3MgZnJvbSBhbGwgYnV0dG9uc1xuICAgICAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lclxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIpXG4gICAgICAgICAgLmZvckVhY2goKGJ0bikgPT4gYnRuLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpKTtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB0aGlzLmFjdGl2ZVByZXNldCA9IHByZXNldC5pZDtcblxuICAgICAgICAvLyBTaG93L2hpZGUgY3VzdG9tIHNlY3Rpb25cbiAgICAgICAgaWYgKHByZXNldC5pZCA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgIHRoaXMuY3VzdG9tSW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICBpZiAodGhpcy50ZXh0QXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBTaG93IGN1c3RvbSBzZWN0aW9uIGlmIGl0J3MgYWN0aXZlXG4gICAgaWYgKHRoaXMuYWN0aXZlUHJlc2V0ID09PSBcImN1c3RvbVwiKSB7XG4gICAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRDdXN0b21QYXRoKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSB0aGlzLmN1cnJlbnRDdXN0b21QYXRoO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbW9kYWwtY29udGVudFwiKTtcblxuICAgIC8vIEFkZCB0aXRsZVxuICAgIHRoaXMudGl0bGVFbC5zZXRUZXh0KFwiRWRpdCBQb3N0LVByb2Nlc3NpbmcgUHJvbXB0XCIpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aGlzLnRpdGxlRWwuY3JlYXRlRGl2KCk7XG4gICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbkVsLnNldFRleHQoXG4gICAgICBcIkNvbmZpZ3VyZSBob3cgeW91ciB0cmFuc2NyaXB0aW9ucyBzaG91bGQgYmUgcG9zdC1wcm9jZXNzZWRcIlxuICAgICk7XG4gICAgZGVzY3JpcHRpb25FbC5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBkZXNjcmlwdGlvbkVsLnN0eWxlLmZvbnRTaXplID0gXCIwLjllbVwiO1xuICAgIGRlc2NyaXB0aW9uRWwuc3R5bGUubWFyZ2luVG9wID0gXCIwLjJlbVwiO1xuXG4gICAgLy8gQ3JlYXRlIGxvYWRpbmcgaW5kaWNhdG9yXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IHRoaXMubG9hZGluZ0luZGljYXRvci5jcmVhdGVTcGFuKCk7XG4gICAgbG9hZGluZ1RleHQuc2V0VGV4dChcIkxvYWRpbmcgcHJvbXB0cy4uLlwiKTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBwcmVzZXQgYnV0dG9uIGNvbnRhaW5lclxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHNlY3Rpb24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuY3VzdG9tU2VjdGlvbiA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1zZWN0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBjdXN0b21JbnB1dENvbnRhaW5lciA9IHRoaXMuY3VzdG9tU2VjdGlvbi5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgYW5kIGJ1dHRvblxuICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGN1c3RvbUlucHV0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LXdyYXBwZXJcIlxuICAgICk7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdGhlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuY3VzdG9tSW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmb3IgYSBzeXN0ZW0gcHJvbXB0IGZpbGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNyZWF0ZSBuZXcgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnV0dG9uID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3JlYXRlLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gXCI0cHggOHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHNldEljb24oY3JlYXRlQnV0dG9uLCBcInBsdXNcIik7XG5cbiAgICBjcmVhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnQgPSBcIlwiO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL3N5c3RlbS1wcm9tcHRzL3RlbXBsYXRlYFxuICAgICAgICApO1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRlbXBsYXRlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIHRlbXBsYXRlQ29udGVudCA9IGRhdGEudGVtcGxhdGU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJDcmVhdGUgTmV3IFN5c3RlbSBQcm9tcHRcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJFbnRlciBhIHRpdGxlIGFuZCBjb250ZW50IGZvciB5b3VyIG5ldyBzeXN0ZW0gcHJvbXB0LiBUaGUgdGl0bGUgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIG1hcmtkb3duIGZpbGUgdGhhdCB5b3UgY2FuIGN1c3RvbWl6ZSBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJDcmVhdGVcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIk15IEN1c3RvbSBBc3Npc3RhbnRcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tdGl0bGUtaW5wdXRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgICAgIHZhbHVlOiB0ZW1wbGF0ZUNvbnRlbnQsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLWNvbnRlbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzdWx0Py5jb25maXJtZWQgfHwgIXJlc3VsdC5pbnB1dHM/LlswXSB8fCAhcmVzdWx0LmlucHV0cz8uWzFdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3RpdGxlLCBjb250ZW50XSA9IHJlc3VsdC5pbnB1dHM7XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHRpdGxlLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKS5yZXBsYWNlKC8gL2csIFwiLVwiKTtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5fS8ke2ZpbGVOYW1lfWA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHRcbiAgICAgICAgICAuY3JlYXRlRm9sZGVyKHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSlcbiAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgLyogRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QgKi9cbiAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGAjICR7dGl0bGV9XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGggKyBcIi5tZFwiLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSB0ZXh0YXJlYSB3aXRoIHRoZSBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGZpbGVDb250ZW50O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgZmlsZVxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gZmlsZVBhdGg7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN5c3RlbSBwcm9tcHQgZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgOiBcIkZhaWxlZCB0byBjcmVhdGUgc3lzdGVtIHByb21wdCBmaWxlXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEF0dGFjaCBmaWxlIHN1Z2dlc3RlciBmb3IgY3VzdG9tIHByb21wdHNcbiAgICBhdHRhY2hGaWxlU3VnZ2VzdGVyKFxuICAgICAgdGhpcy5jdXN0b21JbnB1dCxcbiAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBjb250ZW50O1xuICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlIHdpdGhvdXQgLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHNlbGVjdGVkUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0aGlzLmFwcCxcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeVxuICAgICk7XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHBvc3QtcHJvY2Vzc2luZyBwcm9tcHRcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IHRoaXMuY3VycmVudFByb21wdDtcblxuICAgIC8vIEFkZCByZXNpemUgb2JzZXJ2ZXIgdG8gaGFuZGxlIGR5bmFtaWMgY29udGVudFxuICAgIGNvbnN0IHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHtcbiAgICAgIHRoaXMudGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMudGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgIH0pO1xuICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy50ZXh0QXJlYSk7XG5cbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdCA9IG51bGw7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBzZWNvbmRhcnlCdXR0b24ub25jbGljayA9IGhhbmRsZUNhbmNlbDtcblxuICAgIGNvbnN0IHByaW1hcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJTYXZlXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlU2F2ZSA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGl2ZVByZXNldCA9IHRoaXMucHJvbXB0cy5maW5kKChwKSA9PiBwLmlkID09PSB0aGlzLmFjdGl2ZVByZXNldCk7XG4gICAgICB0aGlzLnJlc3VsdCA9IHtcbiAgICAgICAgY29udGVudDogdGhpcy50ZXh0QXJlYS52YWx1ZSxcbiAgICAgICAgdHlwZTogKGFjdGl2ZVByZXNldD8uaWQgfHwgXCJjdXN0b21cIikgYXMgXCJnZW5lcmFsXCIgfCBcInJoeW1lXCIgfCBcImN1c3RvbVwiLFxuICAgICAgICBwYXRoOlxuICAgICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID09PSBcImN1c3RvbVwiID8gdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfTtcbiAgICBwcmltYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVTYXZlO1xuXG4gICAgLy8gSGFuZGxlIGtleWJvYXJkIGV2ZW50c1xuICAgIHRoaXMubW9kYWxFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLmtleSA9PT0gXCJFbnRlclwiICYmXG4gICAgICAgICFlLmlzQ29tcG9zaW5nICYmXG4gICAgICAgICFlLnNoaWZ0S2V5ICYmXG4gICAgICAgIGUudGFyZ2V0ICE9PSB0aGlzLnRleHRBcmVhXG4gICAgICApIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVTYXZlKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlQ2FuY2VsKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGb2N1cyB0aGUgdGV4dGFyZWEgYW5kIHBsYWNlIGN1cnNvciBhdCB0aGUgZW5kXG4gICAgdGhpcy50ZXh0QXJlYS5mb2N1cygpO1xuICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UoXG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlLmxlbmd0aCxcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoXG4gICAgKTtcblxuICAgIC8vIFN0YXJ0IGxvYWRpbmcgcHJvbXB0cyBhZnRlciBVSSBpcyBzZXQgdXBcbiAgICBhd2FpdCB0aGlzLmxvYWRQcm9tcHRzKCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8UG9zdFByb2Nlc3NpbmdQcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93UG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbChcbiAgYXBwOiBBcHAsXG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLFxuICBjdXJyZW50UHJvbXB0OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiB7XG4gICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeT86IHN0cmluZztcbiAgICBjdXJyZW50Q3VzdG9tUGF0aD86IHN0cmluZztcbiAgfVxuKTogUHJvbWlzZTxQb3N0UHJvY2Vzc2luZ1Byb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgY29uc3QgbW9kYWwgPSBuZXcgUG9zdFByb2Nlc3NpbmdQcm9tcHRNb2RhbChcbiAgICBhcHAsXG4gICAgcGx1Z2luLFxuICAgIGN1cnJlbnRQcm9tcHQsXG4gICAgb3B0aW9ucz8uc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSxcbiAgICBvcHRpb25zPy5jdXJyZW50Q3VzdG9tUGF0aFxuICApO1xuICByZXR1cm4gYXdhaXQgbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgc2V0SWNvbiwgVEZpbGUsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2hvd0VuaGFuY2VkTm90aWNlIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IFRpdGxlR2VuZXJhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvVGl0bGVHZW5lcmF0aW9uU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgUGVyc2lzdGVudFRpdGxlTm90aWNlIGV4dGVuZHMgTm90aWNlIHtcbiAgcHJpdmF0ZSBwcm9ncmVzc0JhcjogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgc3RhdHVzVGV4dDogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgc3RhdHVzSWNvbjogSFRNTERpdkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoXCJcIiwgMCk7IC8vIE5ldmVyIGF1dG8taGlkZVxuICAgIHRoaXMubm90aWNlRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtdGl0bGUtbm90aWNlXCIpO1xuXG4gICAgLy8gQ3JlYXRlIHByb2dyZXNzIGNvbnRhaW5lclxuICAgIGNvbnN0IHByb2dyZXNzQ29udGFpbmVyID0gdGhpcy5ub3RpY2VFbC5jcmVhdGVEaXYoXCJ0aXRsZS1wcm9ncmVzc1wiKTtcblxuICAgIC8vIEFkZCBzdGF0dXMgY29udGFpbmVyIHdpdGggaWNvbiBhbmQgdGV4dFxuICAgIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IHByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZURpdihcInRpdGxlLXN0YXR1c1wiKTtcbiAgICB0aGlzLnN0YXR1c0ljb24gPSBzdGF0dXNDb250YWluZXIuY3JlYXRlRGl2KFwidGl0bGUtc3RhdHVzLWljb25cIik7XG4gICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzQ29udGFpbmVyLmNyZWF0ZURpdihcInRpdGxlLXN0YXR1cy10ZXh0XCIpO1xuXG4gICAgLy8gQWRkIHByb2dyZXNzIGJhclxuICAgIGNvbnN0IHByb2dyZXNzQmFyQ29udGFpbmVyID0gcHJvZ3Jlc3NDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJ0aXRsZS1wcm9ncmVzcy1iYXItY29udGFpbmVyXCJcbiAgICApO1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBwcm9ncmVzc0JhckNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInRpdGxlLXByb2dyZXNzLWJhclwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LXRpdGxlLW5vdGljZS1zdHlsZXNcIikpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgICAgc3R5bGUuaWQgPSBcInN5c3RlbXNjdWxwdC10aXRsZS1ub3RpY2Utc3R5bGVzXCI7XG4gICAgICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAgICAgLnN5c3RlbXNjdWxwdC10aXRsZS1ub3RpY2Uge1xuICAgICAgICAgIHBhZGRpbmc6IDhweCAxMnB4ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgbWluLXdpZHRoOiAyNjBweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50aXRsZS1wcm9ncmVzcyB7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgICAgICAgIGdhcDogOHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnRpdGxlLXN0YXR1cyB7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgIGdhcDogOHB4O1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgIH1cblxuICAgICAgICAudGl0bGUtc3RhdHVzLWljb24ge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRpdGxlLXN0YXR1cy10ZXh0IHtcbiAgICAgICAgICBmbGV4OiAxO1xuICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50aXRsZS1wcm9ncmVzcy1iYXItY29udGFpbmVyIHtcbiAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICBoZWlnaHQ6IDRweDtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogMnB4O1xuICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgIH1cblxuICAgICAgICAudGl0bGUtcHJvZ3Jlc3MtYmFyIHtcbiAgICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgICAgICAgICB0cmFuc2l0aW9uOiB3aWR0aCAwLjNzIGVhc2U7XG4gICAgICAgICAgd2lkdGg6IDAlO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5vdGljZS1zdWNjZXNzIC50aXRsZS1wcm9ncmVzcy1iYXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtc3VjY2VzcykgIWltcG9ydGFudDtcbiAgICAgICAgfVxuXG4gICAgICAgIC5ub3RpY2UtZXJyb3IgLnRpdGxlLXByb2dyZXNzLWJhciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1lcnJvcikgIWltcG9ydGFudDtcbiAgICAgICAgfVxuICAgICAgYDtcbiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVByb2dyZXNzKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nKSB7XG4gICAgdGhpcy5wcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IGAke3Byb2dyZXNzfSVgO1xuICAgIHRoaXMuc3RhdHVzVGV4dC5zZXRUZXh0KHN0YXR1cyk7XG4gICAgdGhpcy5zdGF0dXNJY29uLmVtcHR5KCk7XG4gICAgXG4gICAgbGV0IGljb24gPSBcIndhbmQtMlwiO1xuICAgIGlmIChwcm9ncmVzcyA9PT0gMTAwKSB7XG4gICAgICBpY29uID0gXCJjaGVjay1jaXJjbGVcIjtcbiAgICAgIHRoaXMubm90aWNlRWwuYWRkQ2xhc3MoXCJub3RpY2Utc3VjY2Vzc1wiKTtcbiAgICB9IGVsc2UgaWYgKHByb2dyZXNzID09PSAwICYmIHN0YXR1cy5zdGFydHNXaXRoKFwiRXJyb3JcIikpIHtcbiAgICAgIGljb24gPSBcIngtY2lyY2xlXCI7XG4gICAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwibm90aWNlLWVycm9yXCIpO1xuICAgIH1cbiAgICBcbiAgICBzZXRJY29uKHRoaXMuc3RhdHVzSWNvbiwgaWNvbik7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRpdGxlR2VuZXJhdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHJlc3VsdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogc3RyaW5nIHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0aXRsZUdlbmVyYXRpb25TZXJ2aWNlOiBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlO1xuICBwcml2YXRlIGNvbnRlbnRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHRpdGxlSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIHByaXZhdGUgZ2VuZXJhdGVCdXR0b246IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGlzR2VuZXJhdGluZyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgcHJpdmF0ZSBpbml0aWFsVmFsdWU6IHN0cmluZyxcbiAgICBwcml2YXRlIGNvbnRlbnQ6IENoYXRNZXNzYWdlW10gfCBURmlsZVxuICApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbFwiKTtcbiAgICB0aGlzLnRpdGxlR2VuZXJhdGlvblNlcnZpY2UgPSBUaXRsZUdlbmVyYXRpb25TZXJ2aWNlLmdldEluc3RhbmNlKHBsdWdpbik7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LW1vZGFsLWNvbnRlbnRcIik7XG5cbiAgICAvLyBBZGQgdGl0bGVcbiAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dChcIkNoYW5nZSBDaGF0IFRpdGxlXCIpO1xuICAgIHRoaXMudGl0bGVFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC10aXRsZVwiKTtcblxuICAgIC8vIEFkZCBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uRWwgPSB0aGlzLnRpdGxlRWwuY3JlYXRlRGl2KCk7XG4gICAgZGVzY3JpcHRpb25FbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbkVsLnNldFRleHQoXG4gICAgICBcIkVudGVyIGEgdGl0bGUgbWFudWFsbHkgb3IgZ2VuZXJhdGUgb25lIGJhc2VkIG9uIHlvdXIgY2hhdFwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0aXRsZSBpbnB1dCBhcmVhXG4gICAgY29uc3QgdGl0bGVDb250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KCk7XG4gICAgdGl0bGVDb250YWluZXIuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICAgIG1hcmdpbjogMTZweCAwO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGA7XG5cbiAgICB0aGlzLnRpdGxlSW5wdXQgPSB0aXRsZUNvbnRhaW5lci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGl0bGUtaW5wdXRcIixcbiAgICAgIHZhbHVlOiB0aGlzLmluaXRpYWxWYWx1ZSxcbiAgICB9KTtcbiAgICB0aGlzLnRpdGxlSW5wdXQuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgcGFkZGluZzogMTJweCAxNnB4O1xuICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnkpO1xuICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgZm9udC1zaXplOiAxLjFlbTtcbiAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7XG4gICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTtcbiAgICBgO1xuXG4gICAgLy8gQWRkIGhvdmVyIGFuZCBmb2N1cyBzdHlsZXNcbiAgICB0aGlzLnRpdGxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5ib3JkZXJDb2xvciA9IFwidmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXItaG92ZXIpXCI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy50aXRsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5ib3JkZXJDb2xvciA9IFwidmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpXCI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy50aXRsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5ib3JkZXJDb2xvciA9IFwidmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KVwiO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQuc3R5bGUuYm94U2hhZG93ID0gXCIwIDAgMCAycHggdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXItaG92ZXIpXCI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy50aXRsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsICgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc0dlbmVyYXRpbmcpIHtcbiAgICAgICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmJvcmRlckNvbG9yID0gXCJ2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcilcIjtcbiAgICAgICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmJveFNoYWRvdyA9IFwibm9uZVwiO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGJ1dHRvbiBjb250YWluZXJcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICBidXR0b25Db250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gXCIyMHB4XCI7XG5cbiAgICAvLyBDcmVhdGUgZ2VuZXJhdGUgYnV0dG9uXG4gICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVHZW5lcmF0ZUJ1dHRvbigpO1xuXG4gICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbi5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuZ2VuZXJhdGVUaXRsZSgpO1xuICAgIH07XG5cbiAgICAvLyBDcmVhdGUgc2Vjb25kYXJ5IGJ1dHRvbnNcbiAgICBjb25zdCBzZWNvbmRhcnlCdXR0b25Db250YWluZXIgPSBidXR0b25Db250YWluZXIuY3JlYXRlRGl2KCk7XG4gICAgc2Vjb25kYXJ5QnV0dG9uQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBzZWNvbmRhcnlCdXR0b25Db250YWluZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcblxuICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IHNlY29uZGFyeUJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b25cIixcbiAgICB9KTtcbiAgICBjYW5jZWxCdXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IHNlY29uZGFyeUJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIlNhdmVcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBzYXZlQnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdCA9IHRoaXMudGl0bGVJbnB1dC52YWx1ZTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgLy8gSGFuZGxlIGtleWJvYXJkIGV2ZW50c1xuICAgIHRoaXMubW9kYWxFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgIWUuaXNDb21wb3NpbmcgJiYgIWUuc2hpZnRLZXkpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoZS5tZXRhS2V5IHx8IGUuY3RybEtleSkge1xuICAgICAgICAgIC8vIENtZC9DdHJsICsgRW50ZXIgdG8gZ2VuZXJhdGVcbiAgICAgICAgICBpZiAoIXRoaXMuaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlVGl0bGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gSnVzdCBFbnRlciB0byBzYXZlXG4gICAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLnRpdGxlSW5wdXQudmFsdWU7XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBTZWxlY3QgYWxsIHRleHQgaW4gaW5wdXQgb24gb3BlblxuICAgIHRoaXMudGl0bGVJbnB1dC5mb2N1cygpO1xuICAgIHRoaXMudGl0bGVJbnB1dC5zZWxlY3QoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlR2VuZXJhdGVCdXR0b24oKSB7XG4gICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgIFxuICAgIGNvbnN0IGJ1dHRvbkNvbnRlbnQgPSB0aGlzLmdlbmVyYXRlQnV0dG9uLmNyZWF0ZURpdigpO1xuICAgIGJ1dHRvbkNvbnRlbnQuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIGJ1dHRvbkNvbnRlbnQuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgYnV0dG9uQ29udGVudC5zdHlsZS5nYXAgPSBcIjhweFwiO1xuICAgIFxuICAgIGlmICh0aGlzLmlzR2VuZXJhdGluZykge1xuICAgICAgY29uc3QgbG9hZGVySWNvbiA9IGJ1dHRvbkNvbnRlbnQuY3JlYXRlRGl2KCk7XG4gICAgICBzZXRJY29uKGxvYWRlckljb24sIFwibG9hZGVyLTJcIik7XG4gICAgICBsb2FkZXJJY29uLnN0eWxlLmFuaW1hdGlvbiA9IFwic3BpbiAxcyBsaW5lYXIgaW5maW5pdGVcIjtcbiAgICAgIGJ1dHRvbkNvbnRlbnQuY3JlYXRlU3Bhbih7IHRleHQ6IFwiR2VuZXJhdGluZy4uLlwiIH0pO1xuICAgICAgdGhpcy5nZW5lcmF0ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICAvLyBBbHNvIGRpc2FibGUgdGhlIGlucHV0IHdoaWxlIGdlbmVyYXRpbmdcbiAgICAgIHRoaXMudGl0bGVJbnB1dC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICB0aGlzLnRpdGxlSW5wdXQuc3R5bGUub3BhY2l0eSA9IFwiMC43XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldEljb24oYnV0dG9uQ29udGVudCwgXCJ3YW5kLTJcIik7XG4gICAgICBidXR0b25Db250ZW50LmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkdlbmVyYXRlIFRpdGxlXCIgfSk7XG4gICAgICB0aGlzLmdlbmVyYXRlQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgLy8gUmUtZW5hYmxlIHRoZSBpbnB1dFxuICAgICAgdGhpcy50aXRsZUlucHV0LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVByb2dyZXNzQmFyKCkge1xuICAgIGNvbnN0IHByb2dyZXNzQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1jb250YWluZXJcIik7XG4gICAgcHJvZ3Jlc3NDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHByb2dyZXNzQ29udGFpbmVyLnN0eWxlLm1hcmdpblRvcCA9IFwiMTJweFwiO1xuICAgIHByb2dyZXNzQ29udGFpbmVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMTJweFwiO1xuICAgIHByb2dyZXNzQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXG4gICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtcHJvZ3Jlc3MtYmFyXCIpO1xuICAgIHByb2dyZXNzQmFyLnN0eWxlLmhlaWdodCA9IFwiNHB4XCI7XG4gICAgcHJvZ3Jlc3NCYXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpXCI7XG4gICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBcIjAlXCI7XG4gICAgcHJvZ3Jlc3NCYXIuc3R5bGUudHJhbnNpdGlvbiA9IFwid2lkdGggMC41cyBlYXNlXCI7XG4gICAgcHJvZ3Jlc3NCYXIuc3R5bGUuYm9yZGVyUmFkaXVzID0gXCIycHhcIjtcblxuICAgIGNvbnN0IHByb2dyZXNzQmcgPSBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtcHJvZ3Jlc3MtYmdcIik7XG4gICAgcHJvZ3Jlc3NCZy5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBwcm9ncmVzc0JnLnN0eWxlLnRvcCA9IFwiMFwiO1xuICAgIHByb2dyZXNzQmcuc3R5bGUubGVmdCA9IFwiMFwiO1xuICAgIHByb2dyZXNzQmcuc3R5bGUucmlnaHQgPSBcIjBcIjtcbiAgICBwcm9ncmVzc0JnLnN0eWxlLmhlaWdodCA9IFwiNHB4XCI7XG4gICAgcHJvZ3Jlc3NCZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKVwiO1xuICAgIHByb2dyZXNzQmcuc3R5bGUuYm9yZGVyUmFkaXVzID0gXCIycHhcIjtcbiAgICBwcm9ncmVzc0JnLnN0eWxlLnpJbmRleCA9IFwiLTFcIjtcblxuICAgIGNvbnN0IHByb2dyZXNzVGV4dCA9IHByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy10ZXh0XCIpO1xuICAgIHByb2dyZXNzVGV4dC5zdHlsZS5tYXJnaW5Ub3AgPSBcIjhweFwiO1xuICAgIHByb2dyZXNzVGV4dC5zdHlsZS5mb250U2l6ZSA9IFwiMC45ZW1cIjtcbiAgICBwcm9ncmVzc1RleHQuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgcHJvZ3Jlc3NUZXh0LnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG5cbiAgICBsZXQgaXNBbmltYXRpbmcgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2dyZXNzQ29udGFpbmVyLFxuICAgICAgcHJvZ3Jlc3NCYXIsXG4gICAgICBwcm9ncmVzc1RleHQsXG4gICAgICBzdG9wOiAoKSA9PiB7IGlzQW5pbWF0aW5nID0gZmFsc2U7IH0sXG4gICAgICBpc0FuaW1hdGluZzogKCkgPT4gaXNBbmltYXRpbmdcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdGFydFByb2dyZXNzQW5pbWF0aW9uKHByb2dyZXNzOiBSZXR1cm5UeXBlPHR5cGVvZiB0aGlzLmNyZWF0ZVByb2dyZXNzQmFyPikge1xuICAgIGNvbnN0IHN0YWdlcyA9IFtcbiAgICAgIHsgcHJvZ3Jlc3M6IDI1LCB0ZXh0OiBcIkFuYWx5emluZyBjb250ZW50cy4uLlwiIH0sXG4gICAgICB7IHByb2dyZXNzOiA1MCwgdGV4dDogXCJJZGVudGlmeWluZyBjYXRlZ29yaWVzLi4uXCIgfSxcbiAgICAgIHsgcHJvZ3Jlc3M6IDc1LCB0ZXh0OiBcIlNvcnRpbmcgYnkgaW1wb3J0YW5jZS4uLlwiIH0sXG4gICAgICB7IHByb2dyZXNzOiA5MCwgdGV4dDogXCJDaG9vc2luZyBiZXN0IG9mIDUgdGl0bGVzLi4uXCIgfVxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHN0YWdlIG9mIHN0YWdlcykge1xuICAgICAgaWYgKCFwcm9ncmVzcy5pc0FuaW1hdGluZygpKSBicmVhaztcbiAgICAgIHByb2dyZXNzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7c3RhZ2UucHJvZ3Jlc3N9JWA7XG4gICAgICBwcm9ncmVzcy5wcm9ncmVzc1RleHQuc2V0VGV4dChzdGFnZS50ZXh0KTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVRpdGxlKCkge1xuICAgIHRoaXMuaXNHZW5lcmF0aW5nID0gdHJ1ZTtcbiAgICB0aGlzLnVwZGF0ZUdlbmVyYXRlQnV0dG9uKCk7XG5cbiAgICBsZXQgbm90aWNlOiBQZXJzaXN0ZW50VGl0bGVOb3RpY2UgfCBudWxsID0gbnVsbDtcbiAgICBsZXQgcHJvZ3Jlc3NCYXI6IFJldHVyblR5cGU8dHlwZW9mIHRoaXMuY3JlYXRlUHJvZ3Jlc3NCYXI+IHwgbnVsbCA9IG51bGw7XG4gICAgXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9tYXRpY1RpdGxlR2VuZXJhdGlvbikge1xuICAgICAgbm90aWNlID0gbmV3IFBlcnNpc3RlbnRUaXRsZU5vdGljZSgpO1xuICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKDAsIFwiQW5hbHl6aW5nIGNvbnRlbnQuLi5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb2dyZXNzQmFyID0gdGhpcy5jcmVhdGVQcm9ncmVzc0JhcigpO1xuICAgICAgcHJvZ3Jlc3NCYXIucHJvZ3Jlc3NDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIHRoaXMuc3RhcnRQcm9ncmVzc0FuaW1hdGlvbihwcm9ncmVzc0Jhcik7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMudGl0bGVHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZVRpdGxlKFxuICAgICAgICB0aGlzLmNvbnRlbnQsXG4gICAgICAgICh0aXRsZSkgPT4ge1xuICAgICAgICAgIHRoaXMudGl0bGVJbnB1dC52YWx1ZSA9IHRpdGxlO1xuICAgICAgICAgIGlmIChub3RpY2UpIHtcbiAgICAgICAgICAgIG5vdGljZS51cGRhdGVQcm9ncmVzcygxMDAsIFwiVGl0bGUgZ2VuZXJhdGVkIVwiKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gbm90aWNlPy5oaWRlKCksIDIwMDApO1xuICAgICAgICAgIH0gZWxzZSBpZiAocHJvZ3Jlc3NCYXIpIHtcbiAgICAgICAgICAgIC8vIFN0b3AgdGhlIHByb2dyZXNzIGFuaW1hdGlvbiBhbmQgc2hvdyBjb21wbGV0aW9uXG4gICAgICAgICAgICBwcm9ncmVzc0Jhci5zdG9wKCk7XG4gICAgICAgICAgICBwcm9ncmVzc0Jhci5wcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgICAgICAgICAgcHJvZ3Jlc3NCYXIucHJvZ3Jlc3NUZXh0LnNldFRleHQoXCJGaW5hbGl6aW5nIHRpdGxlLi4uXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgaWYgKG5vdGljZSkge1xuICAgICAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKHByb2dyZXNzLCBzdGF0dXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgdGl0bGU6XCIsIGVycm9yKTtcbiAgICAgIGlmIChub3RpY2UpIHtcbiAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKDAsIGBFcnJvcjogJHtlcnJvcn1gKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBub3RpY2U/LmhpZGUoKSwgNDAwMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJGYWlsZWQgdG8gZ2VuZXJhdGUgdGl0bGVcIiwgXCJlcnJvclwiLCBlcnJvcik7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRlQnV0dG9uKCk7XG4gICAgICBpZiAoIW5vdGljZSAmJiBwcm9ncmVzc0Jhcikge1xuICAgICAgICAvLyBTZWxlY3QgdGhlIGdlbmVyYXRlZCB0ZXh0XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5mb2N1cygpO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQuc2VsZWN0KCk7XG4gICAgICAgIC8vIENsZWFuIHVwIHByb2dyZXNzIGJhclxuICAgICAgICBwcm9ncmVzc0Jhci5wcm9ncmVzc0NvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlKSB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuQW5kR2V0VmFsdWUoKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93VGl0bGVHZW5lcmF0aW9uTW9kYWwoXG4gIGFwcDogQXBwLFxuICBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbixcbiAgaW5pdGlhbFZhbHVlOiBzdHJpbmcsXG4gIGNvbnRlbnQ6IENoYXRNZXNzYWdlW10gfCBURmlsZVxuKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gIGNvbnN0IG1vZGFsID0gbmV3IFRpdGxlR2VuZXJhdGlvbk1vZGFsKGFwcCwgcGx1Z2luLCBpbml0aWFsVmFsdWUsIGNvbnRlbnQpO1xuICByZXR1cm4gYXdhaXQgbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG59ICIsICJpbXBvcnQgeyBQbHVnaW4sIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwgfSBmcm9tIFwiLi90eXBlcy9sbG1cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiIH0gZnJvbSBcIi4vbW9kYWxzL1NldHRpbmdzVGFiXCI7XG5pbXBvcnQgeyBSZWNvcmRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9SZWNvcmRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdENvbnRleHRNZW51IH0gZnJvbSBcIi4vY29tcG9uZW50cy9TeXN0ZW1TY3VscHRDb250ZXh0TWVudVwiO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9zZXR0aW5ncy9TZXR0aW5nc01hbmFnZXJcIjtcbmltcG9ydCB7IExpY2Vuc2VNYW5hZ2VyIH0gZnJvbSBcIi4vY29yZS9saWNlbnNlL0xpY2Vuc2VNYW5hZ2VyXCI7XG5pbXBvcnQgeyBWaWV3TWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL3ZpZXdzXCI7XG5pbXBvcnQgeyBDb21tYW5kTWFuYWdlciB9IGZyb20gXCIuL2NvcmUvcGx1Z2luL2NvbW1hbmRzXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlclNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9DdXN0b21Qcm92aWRlclNlcnZpY2VcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBUYXNrc1NlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9UYXNrc1NlcnZpY2VcIjtcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL01vZGVsU2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTeXN0ZW1TY3VscHRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIGFpU2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgc2V0dGluZ3NUYWI6IFN5c3RlbVNjdWxwdFNldHRpbmdUYWI7XG4gIGN1c3RvbVByb3ZpZGVyU2VydmljZTogQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHJlY29yZGVyU2VydmljZTogUmVjb3JkZXJTZXJ2aWNlO1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlcjtcbiAgcHJpdmF0ZSBsaWNlbnNlTWFuYWdlcjogTGljZW5zZU1hbmFnZXI7XG4gIHB1YmxpYyB0YXNrc1NlcnZpY2U6IFRhc2tzU2VydmljZTtcbiAgcHJpdmF0ZSB2aWV3TWFuYWdlcjogVmlld01hbmFnZXI7XG4gIHByaXZhdGUgY29tbWFuZE1hbmFnZXI6IENvbW1hbmRNYW5hZ2VyO1xuICBwcml2YXRlIGNvbnRleHRNZW51OiBTeXN0ZW1TY3VscHRDb250ZXh0TWVudTtcbiAgcHVibGljIG1vZGVsU2VydmljZTogTW9kZWxTZXJ2aWNlO1xuICBwcml2YXRlIGlzVW5sb2FkaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgaXNQcmVsb2FkaW5nRG9uZSA9IGZhbHNlO1xuICBwcml2YXRlIGZhaWx1cmVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICB0cnkge1xuICAgICAgLy8gUnVuIGNyaXRpY2FsIGluaXRpYWxpemF0aW9uIHdpdGggYSB0aW1lb3V0XG4gICAgICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgICB0aGlzLnJ1bkNyaXRpY2FsSW5pdGlhbGl6YXRpb24oKSxcbiAgICAgICAgbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT5cbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoXCJDcml0aWNhbCBpbml0aWFsaXphdGlvbiB0aW1lb3V0XCIpKSwgMjAwMClcbiAgICAgICAgKSxcbiAgICAgIF0pO1xuXG4gICAgICAvLyBEZWZlciBub24tY3JpdGljYWwgaW5pdGlhbGl6YXRpb25cbiAgICAgIGF3YWl0IHRoaXMucnVuRGVmZXJyZWRJbml0aWFsaXphdGlvbigpO1xuXG4gICAgICAvLyBGb3JjZSBwcmVsb2FkIG9mIGFsbCBjaGF0IHZpZXdzIGltbWVkaWF0ZWx5IGFmdGVyIGluaXRpYWxpemF0aW9uXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnZpZXdNYW5hZ2VyLnJlc3RvcmVDaGF0Vmlld3MoKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRmFpbGVkIHRvIHByZWxvYWQgY2hhdCB2aWV3czpcIiwgZXJyKTtcbiAgICAgICAgdGhpcy5mYWlsdXJlcy5wdXNoKFwiY2hhdCB2aWV3IHByZWxvYWRcIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBQbHVnaW4gbG9hZCBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcImNvcmUgaW5pdGlhbGl6YXRpb25cIik7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBjb25zb2xpZGF0ZWQgbm90aWNlIGlmIHRoZXJlIHdlcmUgYW55IGZhaWx1cmVzXG4gICAgaWYgKHRoaXMuZmFpbHVyZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zaG93VXNlck5vdGljZShcbiAgICAgICAgYFN5c3RlbVNjdWxwdCBoYWQgaXNzdWVzIHdpdGg6ICR7dGhpcy5mYWlsdXJlcy5qb2luKFwiLCBcIil9LiBTb21lIGZlYXR1cmVzIG1heSBiZSB1bmF2YWlsYWJsZS5gXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvd1VzZXJOb3RpY2UobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgbmV3IE5vdGljZShtZXNzYWdlLCA1MDAwKTsgLy8gU2hvdyBmb3IgNSBzZWNvbmRzIHRvIGVuc3VyZSB2aXNpYmlsaXR5XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJ1bkNyaXRpY2FsSW5pdGlhbGl6YXRpb24oKSB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplU2V0dGluZ3MoKTtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVCYXNpY1NlcnZpY2VzKCk7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplQmFzaWNVSSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBydW5EZWZlcnJlZEluaXRpYWxpemF0aW9uKCkge1xuICAgIGlmICh0aGlzLmlzVW5sb2FkaW5nKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUmVtYWluaW5nU2VydmljZXMoKTtcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZU1hbmFnZXJzKCk7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVMaWNlbnNlKCk7XG4gICAgICBhd2FpdCB0aGlzLnByZWxvYWREYXRhSW5CYWNrZ3JvdW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBEZWZlcnJlZCBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcImJhY2tncm91bmQgaW5pdGlhbGl6YXRpb25cIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplU2V0dGluZ3MoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyID0gbmV3IFNldHRpbmdzTWFuYWdlcih0aGlzKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmxvYWRTZXR0aW5ncygpO1xuICAgICAgdGhpcy5zZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmdzKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIltTeXN0ZW1TY3VscHRdIEZhaWxlZCB0byBsb2FkIHNldHRpbmdzOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnNldHRpbmdzID0geyAuLi5ERUZBVUxUX1NFVFRJTkdTIH07XG4gICAgICB0aGlzLmZhaWx1cmVzLnB1c2goXCJzZXR0aW5nc1wiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVCYXNpY1NlcnZpY2VzKCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSA9IG5ldyBDdXN0b21Qcm92aWRlclNlcnZpY2UodGhpcyk7XG4gICAgICB0aGlzLm1vZGVsU2VydmljZSA9IE1vZGVsU2VydmljZS5nZXRJbnN0YW5jZSh0aGlzLCB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZSk7XG4gICAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcy5zZXR0aW5ncywgdGhpcy5hcHApO1xuICAgICAgdGhpcy5haVNlcnZpY2UudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncywgdGhpcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBCYXNpYyBzZXJ2aWNlIGluaXRpYWxpemF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5mYWlsdXJlcy5wdXNoKFwiYmFzaWMgc2VydmljZXNcIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplQmFzaWNVSSgpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5yZWdpc3RlckV4dGVuc2lvbnMoW1wic3J0XCJdLCBcIm1hcmtkb3duXCIpO1xuICAgICAgdGhpcy5zZXR0aW5nc1RhYiA9IG5ldyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKTtcbiAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYih0aGlzLnNldHRpbmdzVGFiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gQmFzaWMgVUkgc2V0dXAgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmZhaWx1cmVzLnB1c2goXCJVSSBjb21wb25lbnRzXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZVJlbWFpbmluZ1NlcnZpY2VzKCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcyk7XG4gICAgICB0aGlzLnJlY29yZGVyU2VydmljZSA9IFJlY29yZGVyU2VydmljZS5nZXRJbnN0YW5jZSh0aGlzLmFwcCwgdGhpcyk7XG4gICAgICB0aGlzLmNvbnRleHRNZW51ID0gbmV3IFN5c3RlbVNjdWxwdENvbnRleHRNZW51KHRoaXMuYXBwLCB0aGlzLmFpU2VydmljZSwgdGhpcyk7XG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLnNldFN5c3RlbVNjdWxwdFNlcnZpY2UodGhpcy5haVNlcnZpY2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBSZW1haW5pbmcgc2VydmljZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcImFkZGl0aW9uYWwgc2VydmljZXNcIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplTWFuYWdlcnMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubGljZW5zZU1hbmFnZXIgPSBuZXcgTGljZW5zZU1hbmFnZXIodGhpcywgdGhpcy5hcHApO1xuICAgICAgdGhpcy50YXNrc1NlcnZpY2UgPSBuZXcgVGFza3NTZXJ2aWNlKHRoaXMpO1xuICAgICAgdGhpcy52aWV3TWFuYWdlciA9IG5ldyBWaWV3TWFuYWdlcih0aGlzLCB0aGlzLmFwcCk7XG4gICAgICB0aGlzLmNvbW1hbmRNYW5hZ2VyID0gbmV3IENvbW1hbmRNYW5hZ2VyKHRoaXMsIHRoaXMuYXBwKTtcblxuICAgICAgdGhpcy52aWV3TWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICB0aGlzLmNvbW1hbmRNYW5hZ2VyLnJlZ2lzdGVyQ29tbWFuZHMoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gTWFuYWdlciBzZXR1cCBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcInBsdWdpbiBmZWF0dXJlc1wiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVMaWNlbnNlKCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5saWNlbnNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCB0aGlzLmxpY2Vuc2VNYW5hZ2VyLmluaXRpYWxpemVMaWNlbnNlKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIltTeXN0ZW1TY3VscHRdIExpY2Vuc2UgdmFsaWRhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcImxpY2Vuc2UgdmFsaWRhdGlvblwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvbnVubG9hZCgpIHtcbiAgICB0aGlzLmlzVW5sb2FkaW5nID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIFBsdWdpbiB1bmxvYWRpbmcuLi5cIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW51cCBVSSBjb21wb25lbnRzIGZpcnN0XG4gICAgICBpZiAodGhpcy5zZXR0aW5nc1RhYikge1xuICAgICAgICAvLyBTZXR0aW5ncyB0YWIgaXMgYXV0b21hdGljYWxseSBjbGVhbmVkIHVwIGJ5IE9ic2lkaWFuXG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFudXAgbWFuYWdlcnMgYW5kIHZpZXdzXG4gICAgICBpZiAodGhpcy5jb21tYW5kTWFuYWdlcikge1xuICAgICAgICBjb25zdCBjb21tYW5kcyA9IFtcbiAgICAgICAgICBcIm9wZW4tdGFza3MtZmlsZVwiLFxuICAgICAgICAgIFwidG9nZ2xlLWF1ZGlvLXJlY29yZGVyXCIsXG4gICAgICAgICAgXCJvcGVuLXN5c3RlbXNjdWxwdC1jaGF0XCIsXG4gICAgICAgICAgXCJvcGVuLWNoYXQtaGlzdG9yeVwiLFxuICAgICAgICAgIFwib3Blbi1zeXN0ZW1zY3VscHQtamFuaXRvclwiLFxuICAgICAgICAgIFwicmVsb2FkLW9ic2lkaWFuXCIsXG4gICAgICAgICAgXCJvcGVuLXN5c3RlbXNjdWxwdC1zZXR0aW5nc1wiLFxuICAgICAgICAgIFwiY2hhbmdlLWNoYXQtbW9kZWxcIixcbiAgICAgICAgICBcImNoYXQtd2l0aC1maWxlXCIsXG4gICAgICAgICAgXCJzdWdnZXN0LWVkaXRzXCIsXG4gICAgICAgICAgXCJjbGVhci1zdWdnZXN0ZWQtZWRpdHNcIixcbiAgICAgICAgICBcIm1vdmUtdGFzay11cFwiLFxuICAgICAgICAgIFwibW92ZS10YXNrLWRvd25cIixcbiAgICAgICAgICBcImluZGVudC10YXNrLXJpZ2h0XCIsXG4gICAgICAgICAgXCJpbmRlbnQtdGFzay1sZWZ0XCJcbiAgICAgICAgXTtcbiAgICAgICAgY29tbWFuZHMuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgICAgICAvLyBAdHMtaWdub3JlIC0gcmVtb3ZlQ29tbWFuZCBleGlzdHMgYnV0IGlzbid0IGluIHRoZSB0eXBlc1xuICAgICAgICAgIHRoaXMuYXBwLmNvbW1hbmRzLnJlbW92ZUNvbW1hbmQoYCR7dGhpcy5tYW5pZmVzdC5pZH06JHtpZH1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFudXAgdmlld3NcbiAgICAgIGlmICh0aGlzLnZpZXdNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMudmlld01hbmFnZXIudW5sb2FkVmlld3MoKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYW51cCBzZXJ2aWNlcyBpbiByZXZlcnNlIG9yZGVyIG9mIGluaXRpYWxpemF0aW9uXG4gICAgICBpZiAodGhpcy5yZWNvcmRlclNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5yZWNvcmRlclNlcnZpY2UudW5sb2FkKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy50cmFuc2NyaXB0aW9uU2VydmljZSkge1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnVubG9hZCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhciBzZXJ2aWNlIGluc3RhbmNlcyBhbmQgY2FjaGVzXG4gICAgICBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmNsZWFyQ2FjaGUoKTtcbiAgICAgIFxuICAgICAgLy8gQ2xlYXIgc2VydmljZSByZWZlcmVuY2VzIHdpdGhvdXQgcmVhc3NpZ25tZW50XG4gICAgICAvLyBAdHMtaWdub3JlIC0gQ2xlYW51cCBpcyBoYW5kbGVkIGJ5IGdhcmJhZ2UgY29sbGVjdGlvblxuICAgICAgdGhpcy5tb2RlbFNlcnZpY2UgPSB1bmRlZmluZWQ7XG4gICAgICAvLyBAdHMtaWdub3JlIC0gQ2xlYW51cCBpcyBoYW5kbGVkIGJ5IGdhcmJhZ2UgY29sbGVjdGlvblxuICAgICAgdGhpcy5haVNlcnZpY2UgPSB1bmRlZmluZWQ7XG4gICAgICAvLyBAdHMtaWdub3JlIC0gQ2xlYW51cCBpcyBoYW5kbGVkIGJ5IGdhcmJhZ2UgY29sbGVjdGlvblxuICAgICAgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiW1N5c3RlbVNjdWxwdF0gUGx1Z2luIHVubG9hZGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIltTeXN0ZW1TY3VscHRdIEVycm9yIGR1cmluZyBwbHVnaW4gY2xlYW51cDpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNSZWFkeSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc1ByZWxvYWRpbmdEb25lO1xuICB9XG5cbiAgYXN5bmMgbG9hZERhdGEoKSB7XG4gICAgcmV0dXJuIHN1cGVyLmxvYWREYXRhKCk7XG4gIH1cblxuICBhc3luYyBzYXZlRGF0YShkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gc3VwZXIuc2F2ZURhdGEoZGF0YSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBnZXRSZWNvcmRlclNlcnZpY2UoKTogUmVjb3JkZXJTZXJ2aWNlIHtcbiAgICByZXR1cm4gdGhpcy5yZWNvcmRlclNlcnZpY2U7XG4gIH1cblxuICBnZXRUcmFuc2NyaXB0aW9uU2VydmljZSgpOiBUcmFuc2NyaXB0aW9uU2VydmljZSB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIH1cblxuICBnZXRMaWNlbnNlTWFuYWdlcigpOiBMaWNlbnNlTWFuYWdlciB7XG4gICAgcmV0dXJuIHRoaXMubGljZW5zZU1hbmFnZXI7XG4gIH1cblxuICBnZXRTZXR0aW5nc01hbmFnZXIoKTogU2V0dGluZ3NNYW5hZ2VyIHtcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5nc01hbmFnZXI7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZyZXNoIG1vZGVscyBmcm9tIHRoZSBtb2RlbCBzZXJ2aWNlXG4gICAqL1xuICBwdWJsaWMgZ2V0SW5pdGlhbE1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByZWxvYWREYXRhSW5CYWNrZ3JvdW5kKCkge1xuICAgIGlmICh0aGlzLmlzVW5sb2FkaW5nKSByZXR1cm47XG5cbiAgICAvLyBTdGFydCBib3RoIG9wZXJhdGlvbnMgaW4gcGFyYWxsZWwgd2l0aG91dCBhd2FpdGluZ1xuICAgIGNvbnN0IG1vZGVsUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIFByZWxvYWRpbmcgbW9kZWxzIGluIGJhY2tncm91bmQuLi5cIik7XG4gICAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICBjb25zb2xlLmxvZyhgW1N5c3RlbVNjdWxwdF0gUHJlbG9hZGVkICR7bW9kZWxzLmxlbmd0aH0gbW9kZWxzYCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBCYWNrZ3JvdW5kIG1vZGVsIHByZWxvYWQgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICAgIHRoaXMuZmFpbHVyZXMucHVzaChcIm1vZGVsIHByZWxvYWRcIik7XG4gICAgICB9XG4gICAgfSkoKTtcblxuICAgIGNvbnN0IHByb21wdFByb21pc2UgPSAoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBJbml0aWFsaXppbmcgc3lzdGVtIHByb21wdHMgaW4gYmFja2dyb3VuZC4uLlwiKTtcbiAgICAgICAgYXdhaXQgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBTeXN0ZW0gcHJvbXB0cyBjYWNoZWRcIik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBCYWNrZ3JvdW5kIHByb21wdCBjYWNoZSBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgdGhpcy5mYWlsdXJlcy5wdXNoKFwic3lzdGVtIHByb21wdHNcIik7XG4gICAgICB9XG4gICAgfSkoKTtcblxuICAgIC8vIERvbid0IGF3YWl0IHRoZXNlIHByb21pc2VzIC0gbGV0IHRoZW0gcnVuIGluIHRoZSBiYWNrZ3JvdW5kXG4gICAgbW9kZWxQcm9taXNlLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBGYXRhbCBlcnJvciBpbiBtb2RlbCBwcmVsb2FkOlwiLCBlcnJvcik7XG4gICAgfSk7XG5cbiAgICBwcm9tcHRQcm9taXNlLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBGYXRhbCBlcnJvciBpbiBwcm9tcHQgY2FjaGU6XCIsIGVycm9yKTtcbiAgICB9KTtcblxuICAgIC8vIE1hcmsgcHJlbG9hZGluZyBhcyBkb25lIGltbWVkaWF0ZWx5XG4gICAgdGhpcy5pc1ByZWxvYWRpbmdEb25lID0gdHJ1ZTtcbiAgfVxufVxuIiwgImV4cG9ydCBpbnRlcmZhY2UgTW9kZWxBcmNoaXRlY3R1cmUge1xuICBtb2RhbGl0eTogc3RyaW5nO1xuICB0b2tlbml6ZXI6IHN0cmluZztcbiAgaW5zdHJ1Y3RfdHlwZTogc3RyaW5nIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbFByaWNpbmcge1xuICBwcm9tcHQ6IHN0cmluZztcbiAgY29tcGxldGlvbjogc3RyaW5nO1xuICBpbWFnZTogc3RyaW5nO1xuICByZXF1ZXN0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9wUHJvdmlkZXIge1xuICBjb250ZXh0X2xlbmd0aDogbnVtYmVyO1xuICBtYXhfY29tcGxldGlvbl90b2tlbnM6IG51bWJlciB8IG51bGw7XG4gIGlzX21vZGVyYXRlZDogYm9vbGVhbjtcbn1cblxuLy8gTmV3IGludGVyZmFjZSBmb3Igc3RvcmluZyBmYXZvcml0ZSBtb2RlbHNcbmV4cG9ydCBpbnRlcmZhY2UgRmF2b3JpdGVNb2RlbCB7XG4gIHByb3ZpZGVyOiBzdHJpbmc7XG4gIG1vZGVsSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbElkZW50aWZpZXIge1xuICBwcm92aWRlcklkOiBzdHJpbmc7IC8vIGUuZy4gXCJvcGVucm91dGVyXCIsIFwic3lzdGVtc2N1bHB0XCJcbiAgbW9kZWxJZDogc3RyaW5nOyAvLyBlLmcuIFwiZ3B0LTRcIiwgXCJtaXN0cmFsLTdiXCJcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmc7IC8vIE9wdGlvbmFsIGRpc3BsYXkgbmFtZSBvdmVycmlkZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVNjdWxwdE1vZGVsIHtcbiAgaWRlbnRpZmllcjogTW9kZWxJZGVudGlmaWVyOyAvLyBOZXcgc3RydWN0dXJlZCBpZGVudGlmaWVyXG4gIGlkOiBzdHJpbmc7IC8vIEtlcHQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBjb250ZXh0X2xlbmd0aDogbnVtYmVyO1xuICBjYXBhYmlsaXRpZXM6IHN0cmluZ1tdO1xuICBhcmNoaXRlY3R1cmU6IHtcbiAgICBtb2RhbGl0eTogc3RyaW5nO1xuICAgIHRva2VuaXplcj86IHN0cmluZztcbiAgICBpbnN0cnVjdF90eXBlPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgcHJpY2luZzoge1xuICAgIHByb21wdDogc3RyaW5nO1xuICAgIGNvbXBsZXRpb246IHN0cmluZztcbiAgICBpbWFnZTogc3RyaW5nO1xuICAgIHJlcXVlc3Q6IHN0cmluZztcbiAgfTtcbiAgcHJvdmlkZXI6IHN0cmluZztcbiAgdG9wX3Byb3ZpZGVyPzoge1xuICAgIGNvbnRleHRfbGVuZ3RoOiBudW1iZXI7XG4gICAgbWF4X2NvbXBsZXRpb25fdG9rZW5zOiBudW1iZXIgfCBudWxsO1xuICAgIGlzX21vZGVyYXRlZDogYm9vbGVhbjtcbiAgfTtcbiAgaXNGYXZvcml0ZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3VzdG9tUHJvdmlkZXIge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGVuZHBvaW50OiBzdHJpbmc7XG4gIGFwaUtleTogc3RyaW5nO1xuICBpc0VuYWJsZWQ6IGJvb2xlYW47XG4gIGxhc3RUZXN0ZWQ/OiBudW1iZXI7IC8vIFRpbWVzdGFtcCBvZiBsYXN0IGNvbm5lY3Rpb24gdGVzdFxuICBjYWNoZWRNb2RlbHM/OiBzdHJpbmdbXTsgLy8gQ2FjaGVkIGxpc3Qgb2YgbW9kZWwgSURzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aXZlUHJvdmlkZXIge1xuICBpZDogc3RyaW5nOyAvLyBVbmlxdWUgSUQgb2YgdGhlIHByb3ZpZGVyXG4gIG5hbWU6IHN0cmluZzsgLy8gRGlzcGxheSBuYW1lIChlLmcuLCBcIlN5c3RlbVNjdWxwdFwiLCBcIk9sbGFtYVwiLCBldGMuKVxuICB0eXBlOiBcIm5hdGl2ZVwiIHwgXCJjdXN0b21cIjsgLy8gV2hldGhlciBpdCdzIHRoZSBuYXRpdmUgU3lzdGVtU2N1bHB0IG9yIGEgY3VzdG9tIHByb3ZpZGVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kZWxGaWx0ZXJTZXR0aW5ncyB7XG4gIHNob3dWaXNpb25Nb2RlbHM6IGJvb2xlYW47XG4gIHNob3dSZWFzb25pbmdNb2RlbHM6IGJvb2xlYW47XG4gIHNob3dDcmVhdGl2ZU1vZGVsczogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTOiBNb2RlbEZpbHRlclNldHRpbmdzID0ge1xuICBzaG93VmlzaW9uTW9kZWxzOiBmYWxzZSxcbiAgc2hvd1JlYXNvbmluZ01vZGVsczogZmFsc2UsXG4gIHNob3dDcmVhdGl2ZU1vZGVsczogZmFsc2UsXG59O1xuIiwgImltcG9ydCB7IEFwcCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IFNjcm9sbE1hbmFnZXJTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB7IE1lc3NhZ2VSZW5kZXJlciB9IGZyb20gXCIuL3ZpZXdzL2NvbXBvbmVudHMvTWVzc2FnZVJlbmRlcmVyXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB0eXBlIHtcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG4gIEN1c3RvbVByb3ZpZGVyLFxuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBBY3RpdmVQcm92aWRlcixcbiAgRmF2b3JpdGVNb2RlbCxcbn0gZnJvbSBcIi4vdHlwZXMvbGxtXCI7XG5pbXBvcnQgeyBERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyB9IGZyb20gXCIuL3R5cGVzL2xsbVwiO1xuXG4vLyBSZS1leHBvcnQgZm9yIGNvbnZlbmllbmNlXG5leHBvcnQgdHlwZSB7XG4gIFN5c3RlbVNjdWxwdE1vZGVsLFxuICBDdXN0b21Qcm92aWRlcixcbiAgTW9kZWxGaWx0ZXJTZXR0aW5ncyxcbiAgQWN0aXZlUHJvdmlkZXIsXG4gIEZhdm9yaXRlTW9kZWwsXG59IGZyb20gXCIuL3R5cGVzL2xsbVwiO1xuXG5leHBvcnQgY29uc3QgUEFUUkVPTl9VUkwgPSBcImh0dHBzOi8vd3d3LnBhdHJlb24uY29tL3N5c3RlbXNjdWxwdC9tZW1iZXJzaGlwXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0U2V0dGluZ3Mge1xuICBsaWNlbnNlS2V5OiBzdHJpbmc7XG4gIGxpY2Vuc2VWYWxpZDogYm9vbGVhbjtcbiAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIGNoYXRzRGlyZWN0b3J5OiBzdHJpbmc7XG4gIGxhc3RWYWxpZGF0ZWQ6IG51bWJlcjtcbiAgLyoqXG4gICAqIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB3ZSdsbCBrZWVwIHN5c3RlbVByb21wdCBhcyB0aGUgbGFzdC1zYXZlZFxuICAgKiB1c2VyLWNob3NlbiB0ZXh0LiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgZGlyZWN0IHN0b3JhZ2UgaWYgdGhlIHVzZXJcbiAgICogcGlja3MgYSBwcmVzZXQgb3IgdHlwZWQgY29udGVudC4gQnV0IGlmIHN5c3RlbVByb21wdFR5cGUgaXMgXCJjdXN0b21cIixcbiAgICogd2UnbGwgcmVhZCBmcm9tIHN5c3RlbVByb21wdFBhdGguXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHQ6IHN0cmluZztcbiAgcmVjb3JkaW5nc0RpcmVjdG9yeTogc3RyaW5nO1xuICBkZXZlbG9wbWVudE1vZGU6IGJvb2xlYW47XG4gIHByZWZlcnJlZE1pY3JvcGhvbmVJZDogc3RyaW5nO1xuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IGJvb2xlYW47XG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IGJvb2xlYW47XG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OiBzdHJpbmc7XG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogYm9vbGVhbjtcbiAgc2hvd01vZGVsVG9vbHRpcHM6IGJvb2xlYW47XG4gIHNob3dWaXNpb25Nb2RlbHNPbmx5OiBib29sZWFuO1xuICBzaG93VG9wUGlja3NPbmx5OiBib29sZWFuO1xuICBzZWxlY3RlZFByb3ZpZGVyOiBzdHJpbmc7XG4gIHNlcnZlclVybDogc3RyaW5nO1xuICBhdHRhY2htZW50c0RpcmVjdG9yeTogc3RyaW5nO1xuICBleHRyYWN0aW9uc0RpcmVjdG9yeTogc3RyaW5nO1xuICAvLyBDaGFuZ2VkIGJlbG93IHRvIFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIgd2l0aCBhIHNwYWNlXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IHN0cmluZztcbiAgdGFza3NEaXJlY3Rvcnk6IHN0cmluZztcbiAgbW92ZUNvbXBsZXRlZFRhc2tzRG93bjogYm9vbGVhbjtcblxuICAvKipcbiAgICogTkVXIEZJRUxEUzpcbiAgICogc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiXG4gICAqIHN5c3RlbVByb21wdFBhdGg6IHBhdGggdG8gdGhlIGZpbGUgdGhhdCBob2xkcyB0aGUgY3VzdG9tIHN5c3RlbSBwcm9tcHQgKGlmIGFueSkuXG4gICAqL1xuICBzeXN0ZW1Qcm9tcHRUeXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHN5c3RlbVByb21wdFBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogVGl0bGUgZ2VuZXJhdGlvbiBwcm9tcHQgc2V0dGluZ3NcbiAgICovXG4gIHRpdGxlR2VuZXJhdGlvblByb21wdDogc3RyaW5nO1xuICB0aXRsZUdlbmVyYXRpb25Qcm9tcHRUeXBlOiBcInByZWNpc2VcIiB8IFwibW92aWUtc3R5bGVcIiB8IFwiY3VzdG9tXCI7XG4gIHRpdGxlR2VuZXJhdGlvblByb21wdFBhdGg6IHN0cmluZztcbiAgYXV0b21hdGljVGl0bGVHZW5lcmF0aW9uOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBDdXN0b20gcHJvdmlkZXIgc2V0dGluZ3NcbiAgICovXG4gIGN1c3RvbVByb3ZpZGVyczogQ3VzdG9tUHJvdmlkZXJbXTtcblxuICBtb2RlbEZpbHRlclNldHRpbmdzOiBNb2RlbEZpbHRlclNldHRpbmdzO1xuXG4gIGZhdm9yaXRlTW9kZWxzOiBGYXZvcml0ZU1vZGVsW107XG5cbiAgZmF2b3JpdGVDaGF0czogc3RyaW5nW107XG5cbiAgYWN0aXZlUHJvdmlkZXI6IEFjdGl2ZVByb3ZpZGVyO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU3lzdGVtU2N1bHB0U2V0dGluZ3MgPSB7XG4gIGxpY2Vuc2VLZXk6IFwiXCIsXG4gIGxpY2Vuc2VWYWxpZDogZmFsc2UsXG4gIHNlbGVjdGVkTW9kZWxJZDogXCJcIixcbiAgY2hhdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0NoYXRzXCIsXG4gIGxhc3RWYWxpZGF0ZWQ6IDAsXG4gIC8vIFRoaXMgaXMgdGhlIGZhbGxiYWNrIHN5c3RlbSBwcm9tcHQgaWYgdGhlIHVzZXIgaGFzbid0IGNob3NlbiBhIGN1c3RvbSBvciBwcmVzZXRcbiAgc3lzdGVtUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50LiBZb3UgaGVscCB1c2VycyB3aXRoIHRoZWlyIHF1ZXN0aW9ucyBhbmQgdGFza3MgaW4gYSBjbGVhciBhbmQgY29uY2lzZSB3YXkuXCIsXG4gIHJlY29yZGluZ3NEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1JlY29yZGluZ3NcIixcbiAgZGV2ZWxvcG1lbnRNb2RlOiBmYWxzZSxcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBcIlwiLFxuICBhdXRvVHJhbnNjcmliZVJlY29yZGluZ3M6IHRydWUsXG4gIGF1dG9QYXN0ZVRyYW5zY3JpcHRpb246IHRydWUsXG4gIHBvc3RQcm9jZXNzaW5nUHJvbXB0OlxuICAgIFwiWW91IGFyZSBhIHRyYW5zY3JpcHRpb24gcG9zdC1wcm9jZXNzb3IuIFlvdXIgdGFzayBpcyB0byBmaXggYW55IHRyYW5zY3JpcHRpb24gZXJyb3JzLCBjb3JyZWN0IGdyYW1tYXIgYW5kIHB1bmN0dWF0aW9uLCBhbmQgZW5zdXJlIHRoZSB0ZXh0IGlzIHByb3Blcmx5IGZvcm1hdHRlZC4gS2VlcCB0aGUgb3JpZ2luYWwgbWVhbmluZyBpbnRhY3Qgd2hpbGUgbWFraW5nIHRoZSB0ZXh0IG1vcmUgcmVhZGFibGUuXCIsXG4gIHBvc3RQcm9jZXNzaW5nRW5hYmxlZDogZmFsc2UsXG4gIHNob3dNb2RlbFRvb2x0aXBzOiBmYWxzZSxcbiAgc2hvd1Zpc2lvbk1vZGVsc09ubHk6IGZhbHNlLFxuICBzaG93VG9wUGlja3NPbmx5OiBmYWxzZSxcbiAgc2VsZWN0ZWRQcm92aWRlcjogXCJhbGxcIixcbiAgc2VydmVyVXJsOiBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiLFxuICBhdHRhY2htZW50c0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvQXR0YWNobWVudHNcIixcbiAgZXh0cmFjdGlvbnNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L0V4dHJhY3Rpb25zXCIsXG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IFwiU3lzdGVtU2N1bHB0L1N5c3RlbSBQcm9tcHRzXCIsXG4gIHRhc2tzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9UYXNrc1wiLFxuICBtb3ZlQ29tcGxldGVkVGFza3NEb3duOiB0cnVlLFxuXG4gIC8qKlxuICAgKiBORVcgRklFTERTIERFRkFVTFRTOlxuICAgKi9cbiAgc3lzdGVtUHJvbXB0VHlwZTogXCJnZW5lcmFsLXVzZVwiLFxuICBzeXN0ZW1Qcm9tcHRQYXRoOiBcIlwiLFxuXG4gIC8qKlxuICAgKiBUaXRsZSBnZW5lcmF0aW9uIHByb21wdCBkZWZhdWx0c1xuICAgKi9cbiAgdGl0bGVHZW5lcmF0aW9uUHJvbXB0OiBcIllvdSBhcmUgYSBzcGVjaWFsaXplZCB0aXRsZSBnZW5lcmF0aW9uIGFzc2lzdGFudCBmb2N1c2VkIG9uIGNyZWF0aW5nIHByZWNpc2UsIG1lYW5pbmdmdWwgdGl0bGVzLlwiLFxuICB0aXRsZUdlbmVyYXRpb25Qcm9tcHRUeXBlOiBcInByZWNpc2VcIixcbiAgdGl0bGVHZW5lcmF0aW9uUHJvbXB0UGF0aDogXCJcIixcbiAgYXV0b21hdGljVGl0bGVHZW5lcmF0aW9uOiBmYWxzZSxcblxuICAvKipcbiAgICogQ3VzdG9tIHByb3ZpZGVyIGRlZmF1bHRzXG4gICAqL1xuICBjdXN0b21Qcm92aWRlcnM6IFtdLFxuXG4gIG1vZGVsRmlsdGVyU2V0dGluZ3M6IERFRkFVTFRfRklMVEVSX1NFVFRJTkdTLFxuXG4gIGZhdm9yaXRlTW9kZWxzOiBbXSxcblxuICBmYXZvcml0ZUNoYXRzOiBbXSxcblxuICBhY3RpdmVQcm92aWRlcjoge1xuICAgIGlkOiBcInN5c3RlbXNjdWxwdFwiLFxuICAgIG5hbWU6IFwiU3lzdGVtU2N1bHB0XCIsXG4gICAgdHlwZTogXCJuYXRpdmVcIixcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCBTRU5TSVRJVkVfU0VUVElOR1M6IFBhcnRpYWw8XG4gIFJlY29yZDxrZXlvZiBTeXN0ZW1TY3VscHRTZXR0aW5ncywgXCJub25lXCIgfCBcImJvdGhcIiB8IFwidmFsdWVcIj5cbj4gPSB7XG4gIGxpY2Vuc2VLZXk6IFwiYm90aFwiLFxuICBzZWxlY3RlZE1vZGVsSWQ6IFwibm9uZVwiLFxuICBjaGF0c0RpcmVjdG9yeTogXCJub25lXCIsXG4gIGxhc3RWYWxpZGF0ZWQ6IFwibm9uZVwiLFxuICBzeXN0ZW1Qcm9tcHQ6IFwibm9uZVwiLFxuICByZWNvcmRpbmdzRGlyZWN0b3J5OiBcIm5vbmVcIixcbiAgZGV2ZWxvcG1lbnRNb2RlOiBcIm5vbmVcIixcbiAgcHJlZmVycmVkTWljcm9waG9uZUlkOiBcIm5vbmVcIixcbiAgYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzOiBcIm5vbmVcIixcbiAgYXV0b1Bhc3RlVHJhbnNjcmlwdGlvbjogXCJub25lXCIsXG4gIHRhc2tzRGlyZWN0b3J5OiBcIm5vbmVcIixcbn07XG5cbmV4cG9ydCB0eXBlIENoYXRSb2xlID0gXCJ1c2VyXCIgfCBcImFzc2lzdGFudFwiIHwgXCJzeXN0ZW1cIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbWFnZUNvbnRlbnQge1xuICB0eXBlOiBcImltYWdlX3VybFwiO1xuICBpbWFnZV91cmw6IHtcbiAgICB1cmw6IHN0cmluZztcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0Q29udGVudCB7XG4gIHR5cGU6IFwidGV4dFwiO1xuICB0ZXh0OiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIE11bHRpUGFydENvbnRlbnQgPSBUZXh0Q29udGVudCB8IEltYWdlQ29udGVudDtcblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1Qcm9tcHRJbmZvIHtcbiAgdHlwZTogc3RyaW5nO1xuICBwYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElucHV0SGFuZGxlck9wdGlvbnMge1xuICBhcHA6IEFwcDtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBnZXRNZXNzYWdlczogKCkgPT4gQ2hhdE1lc3NhZ2VbXTtcbiAgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiBzdHJpbmc7XG4gIGdldENvbnRleHRGaWxlczogKCkgPT4gU2V0PHN0cmluZz47XG4gIGdldFN5c3RlbVByb21wdDogKCkgPT4gU3lzdGVtUHJvbXB0SW5mbztcbiAgY2hhdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgb25NZXNzYWdlU3VibWl0OiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIG9uQXNzaXN0YW50UmVzcG9uc2U6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Db250ZXh0RmlsZUFkZDogKHdpa2lsaW5rOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIG9uRXJyb3I6IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkO1xuICBvbkFkZENvbnRleHRGaWxlOiAoKSA9PiB2b2lkO1xuICBvbkVkaXRTeXN0ZW1Qcm9tcHQ6ICgpID0+IHZvaWQ7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRNZXNzYWdlIHtcbiAgcm9sZTogQ2hhdFJvbGU7XG4gIGNvbnRlbnQ6IHN0cmluZyB8IE11bHRpUGFydENvbnRlbnRbXTtcbiAgbWVzc2FnZV9pZDogc3RyaW5nO1xuICBkb2N1bWVudENvbnRleHQ/OiB7XG4gICAgZG9jdW1lbnRJZHM6IHN0cmluZ1tdO1xuICB9O1xuICBzeXN0ZW1Qcm9tcHRUeXBlPzogc3RyaW5nO1xuICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVNjdWxwdFJlc3BvbnNlIHtcbiAgaWQ6IHN0cmluZztcbiAgY2hvaWNlczoge1xuICAgIG1lc3NhZ2U6IENoYXRNZXNzYWdlO1xuICB9W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtU2N1bHB0U3RyZWFtQ2h1bmsge1xuICBpZD86IHN0cmluZztcbiAgY2hvaWNlcz86IEFycmF5PHtcbiAgICBkZWx0YT86IHtcbiAgICAgIGNvbnRlbnQ/OiBzdHJpbmc7XG4gICAgICB0ZXh0Pzogc3RyaW5nO1xuICAgICAgcmVhc29uaW5nPzogc3RyaW5nO1xuICAgIH07XG4gIH0+O1xuICBjb21wbGV0aW9uPzogc3RyaW5nO1xuICBkZWx0YT86IHtcbiAgICB0ZXh0Pzogc3RyaW5nO1xuICAgIHJlYXNvbmluZz86IHN0cmluZztcbiAgfTtcbiAgZXJyb3I/OiB7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBzdGF0dXNDb2RlPzogbnVtYmVyO1xuICAgIG1vZGVsPzogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdFByZXNldCB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47XG4gIHN5c3RlbVByb21wdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5c3RlbVByb21wdFR5cGUge1xuICBpZDogc3RyaW5nOyAvLyBlLmcuLCBcInRleHRfbW9kaWZpY2F0aW9uXCJcbiAgbGFiZWw6IHN0cmluZzsgLy8gZS5nLiwgXCJUZXh0IE1vZGlmaWNhdGlvblwiXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nOyAvLyBPcHRpb25hbCBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoaXMgcHJvbXB0IHR5cGUgZG9lc1xuICBpc1VzZXJDb25maWd1cmFibGU6IGJvb2xlYW47IC8vIFdoZXRoZXIgdXNlciBjYW4gY3VzdG9taXplIHRoZSBwcm9tcHRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0TW9kaWZpY2F0aW9uU3RhdGUge1xuICBvcmlnaW5hbFRleHQ6IHN0cmluZztcbiAgbW9kaWZpZWRUZXh0OiBzdHJpbmc7XG4gIGlzU3RyZWFtaW5nOiBib29sZWFuO1xuICBzdHJlYW1Db21wbGV0ZTogYm9vbGVhbjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTLCBQQVRSRU9OX1VSTCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4vTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgYXR0YWNoRm9sZGVyU3VnZ2VzdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9sZGVyU3VnZ2VzdGVyXCI7XG5pbXBvcnQgeyByZXF1ZXN0VXJsIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93RGVmYXVsdFN5c3RlbVByb21wdE1vZGFsIH0gZnJvbSBcIi4vRGVmYXVsdFN5c3RlbVByb21wdE1vZGFsXCI7XG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1TY3VscHRTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIHN5c3RlbVNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgZGVib3VuY2VUaW1lcjogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zeXN0ZW1TY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHRoaXMuYXBwXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVEaXJlY3RvcnkocGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCFwYXRoKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gKFxuICAgICAgIXBhdGguaW5jbHVkZXMoXCIuLlwiKSAmJiAhcGF0aC5zdGFydHNXaXRoKFwiL1wiKSAmJiAhcGF0aC5zdGFydHNXaXRoKFwiXFxcXFwiKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZURpcmVjdG9yeUNoYW5nZShcbiAgICB2YWx1ZTogc3RyaW5nLFxuICAgIHNldHRpbmdLZXk6XG4gICAgICB8IFwiYXR0YWNobWVudHNEaXJlY3RvcnlcIlxuICAgICAgfCBcInJlY29yZGluZ3NEaXJlY3RvcnlcIlxuICAgICAgfCBcImNoYXRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJleHRyYWN0aW9uc0RpcmVjdG9yeVwiXG4gICAgICB8IFwic3lzdGVtUHJvbXB0c0RpcmVjdG9yeVwiXG4gICAgICB8IFwidGFza3NEaXJlY3RvcnlcIlxuICApIHtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGVEaXJlY3RvcnkodmFsdWUpKSB7XG4gICAgICBzaG93UG9wdXAoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkludmFsaWQgZGlyZWN0b3J5IHBhdGguIFBsZWFzZSB1c2UgcmVsYXRpdmUgcGF0aHMgd2l0aG91dCAnLi4nIG9yIGxlYWRpbmcgc2xhc2hlcy5cIlxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZWJvdW5jZVRpbWVyKSBjbGVhclRpbWVvdXQodGhpcy5kZWJvdW5jZVRpbWVyKTtcblxuICAgIHRoaXMuZGVib3VuY2VUaW1lciA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0gPSB2YWx1ZTtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgIH0sIDUwMCk7XG4gIH1cblxuICBhc3luYyBkaXNwbGF5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIC8vIE1haW4gY29udGFpbmVyIHdpdGggdGFic1xuICAgIGNvbnN0IG1haW5Db250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1jb250YWluZXJcIlxuICAgICk7XG4gICAgbWFpbkNvbnRhaW5lci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJTeXN0ZW1TY3VscHQgQUkgU2V0dGluZ3NcIiB9KTtcblxuICAgIC8vIFRhYiBuYXZpZ2F0aW9uXG4gICAgY29uc3QgdGFiQ29udGFpbmVyID0gbWFpbkNvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtc2V0dGluZ3MtdGFic1wiKTtcbiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gbWFpbkNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1jb250ZW50XCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHRhYnNcbiAgICBjb25zdCB0YWJzID0gW1xuICAgICAgeyBpZDogXCJsaWNlbnNlXCIsIGxhYmVsOiBcIkxpY2Vuc2VcIiB9LFxuICAgICAgeyBpZDogXCJkaXJlY3Rvcmllc1wiLCBsYWJlbDogXCJEaXJlY3Rvcmllc1wiIH0sXG4gICAgICB7IGlkOiBcInJlY29yZGVyXCIsIGxhYmVsOiBcIlJlY29yZGVyXCIgfSxcbiAgICAgIHsgaWQ6IFwiY2hhdFwiLCBsYWJlbDogXCJDaGF0XCIgfSxcbiAgICAgIHsgaWQ6IFwidGFza3NcIiwgbGFiZWw6IFwiVGFza3NcIiB9LFxuICAgICAgeyBpZDogXCJhZHZhbmNlZFwiLCBsYWJlbDogXCJBZHZhbmNlZFwiIH0sXG4gICAgXTtcblxuICAgIC8vIEFkZCB0YWIgYnV0dG9uc1xuICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PiB7XG4gICAgICBjb25zdCB0YWJCdXR0b24gPSB0YWJDb250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRhYi1idXR0b25cIixcbiAgICAgICAgdGV4dDogdGFiLmxhYmVsLFxuICAgICAgfSk7XG4gICAgICB0YWJCdXR0b24uZGF0YXNldC50YWIgPSB0YWIuaWQ7XG4gICAgICBpZiAodGFiLmlkID09PSBcImxpY2Vuc2VcIikgdGFiQnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRhYiBjb250ZW50IHNlY3Rpb25zXG4gICAgY29uc3QgaXNQcm9BY3RpdmUgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPT09IHRydWU7XG4gICAgY29uc3QgbGljZW5zZUNvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50IGFjdGl2ZVwiXG4gICAgKTtcbiAgICBjb25zdCBkaXJlY3Rvcmllc0NvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCJcbiAgICApO1xuICAgIGNvbnN0IHJlY29yZGVyQ29udGVudCA9IGNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgY2hhdENvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiKTtcbiAgICBjb25zdCB0YXNrc0NvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC10YWItY29udGVudFwiKTtcbiAgICBjb25zdCBhZHZhbmNlZENvbnRlbnQgPSBjb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRhYi1jb250ZW50XCJcbiAgICApO1xuXG4gICAgLy8gQWRkIGNvbnRlbnQgdG8gZWFjaCB0YWJcbiAgICB0aGlzLmRpc3BsYXlMaWNlbnNlVGFiKGxpY2Vuc2VDb250ZW50LCBpc1Byb0FjdGl2ZSk7XG4gICAgdGhpcy5kaXNwbGF5RGlyZWN0b3JpZXNUYWIoZGlyZWN0b3JpZXNDb250ZW50LCBpc1Byb0FjdGl2ZSk7XG4gICAgdGhpcy5kaXNwbGF5UmVjb3JkZXJUYWIocmVjb3JkZXJDb250ZW50KTtcbiAgICB0aGlzLmRpc3BsYXlDaGF0VGFiKGNoYXRDb250ZW50KTtcbiAgICB0aGlzLmRpc3BsYXlUYXNrc1RhYih0YXNrc0NvbnRlbnQpO1xuICAgIHRoaXMuZGlzcGxheUFkdmFuY2VkVGFiKGFkdmFuY2VkQ29udGVudCk7XG5cbiAgICAvLyBBZGQgdGFiIGNsaWNrIGhhbmRsZXJzXG4gICAgdGFiQ29udGFpbmVyXG4gICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvblwiKVxuICAgICAgLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgY29uc3QgdGFiSWQgPSB0YXJnZXQuZGF0YXNldC50YWI7XG5cbiAgICAgICAgICAvLyBSZW1vdmUgYWN0aXZlIGNsYXNzZXNcbiAgICAgICAgICB0YWJDb250YWluZXJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uXCIpXG4gICAgICAgICAgICAuZm9yRWFjaCgoYikgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpKTtcbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnRcIilcbiAgICAgICAgICAgIC5mb3JFYWNoKChjKSA9PiBjLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xuXG4gICAgICAgICAgLy8gQWRkIGFjdGl2ZSBjbGFzc2VzIHRvIHNlbGVjdGVkIHRhYlxuICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICAgIGNvbnRlbnRDb250YWluZXJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWI9XCIke3RhYklkfVwiXWApXG4gICAgICAgICAgICA/LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyBBZGQgc3R5bGVzIGlmIG5vdCBhbHJlYWR5IGFkZGVkXG4gICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1zdHlsZXNcIikpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgICAgc3R5bGUuaWQgPSBcInN5c3RlbXNjdWxwdC1zZXR0aW5ncy1zdHlsZXNcIjtcbiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgLnN5c3RlbXNjdWxwdC1zZXR0aW5ncy10YWJzIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgZmxleC13cmFwOiB3cmFwO1xuICAgICAgICBnYXA6IDRweDtcbiAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTtcbiAgICAgICAgcGFkZGluZy1ib3R0b206IDhweDtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDAlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1idXR0b24ge1xuICAgICAgICBiYWNrZ3JvdW5kOiBub25lO1xuICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgIHBhZGRpbmc6IDZweCAxMnB4O1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTtcbiAgICAgICAgZm9udC1zaXplOiAwLjllbTtcbiAgICAgICAgZmxleDogMSAxIGF1dG87XG4gICAgICAgIG1pbi13aWR0aDogMTIwcHg7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnN5c3RlbXNjdWxwdC10YWItYnV0dG9uOmhvdmVyIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ob3Zlcik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWJ1dHRvbi5hY3RpdmUge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1vbi1hY2NlbnQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAuc3lzdGVtc2N1bHB0LXRhYi1jb250ZW50IHtcbiAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDAlO1xuICAgICAgICBvdmVyZmxvdy14OiBoaWRkZW47XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5zeXN0ZW1zY3VscHQtdGFiLWNvbnRlbnQuYWN0aXZlIHtcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIHBhZGRpbmc6IDAgOHB4O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvKiBMaWNlbnNlIFRhYiBTdHlsaW5nICovXG4gICAgICAuc3lzdGVtc2N1bHB0LWxpY2Vuc2UtaW5wdXQge1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgbWF4LXdpZHRoOiA0MDBweDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnByby1iYWRnZSB7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgICAgIHBhZGRpbmc6IDJweCA4cHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgZm9udC1zaXplOiAwLjhlbTtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgICAgICAgbWFyZ2luLWxlZnQ6IDhweDtcbiAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLnRva2VuLWJhbGFuY2UtdmFsdWUge1xuICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICBtYXJnaW4tbGVmdDogOHB4O1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWZlYXR1cmVzLWdyaWQgLnNldHRpbmctaXRlbSB7XG4gICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeS1hbHQpO1xuICAgICAgICBtYXJnaW46IDRweCAwO1xuICAgICAgfVxuICAgICAgXG4gICAgICAucHJvLWJlbmVmaXRzLWxpc3Qge1xuICAgICAgICBtYXJnaW46IDE2cHggMDtcbiAgICAgICAgcGFkZGluZy1sZWZ0OiAyMHB4O1xuICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC5wcm8tYmVuZWZpdHMtbGlzdCBsaSB7XG4gICAgICAgIG1hcmdpbjogOHB4IDA7XG4gICAgICAgIGxpc3Qtc3R5bGUtdHlwZTogJ1x1MjE5Mic7XG4gICAgICAgIHBhZGRpbmctbGVmdDogMjBweDtcbiAgICAgICAgdGV4dC1pbmRlbnQ6IC0xMnB4O1xuICAgICAgICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICAgICAgfVxuICAgIGA7XG4gICAgICBtYWluQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlMaWNlbnNlVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgaXNQcm9BY3RpdmU6IGJvb2xlYW4pIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwibGljZW5zZVwiO1xuICAgIGNvbnN0IGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtbGljZW5zZS1zZXR0aW5nc1wiXG4gICAgKTtcblxuICAgIGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiaDNcIiwge1xuICAgICAgdGV4dDogXCJTeXN0ZW1TY3VscHQgTGljZW5zZVwiLFxuICAgIH0pO1xuXG4gICAgLy8gTGljZW5zZSBLZXkgU2VjdGlvblxuICAgIGNvbnN0IGxpY2Vuc2VTZXR0aW5nID0gbmV3IFNldHRpbmcobGljZW5zZVNldHRpbmdDb250YWluZXIpXG4gICAgICAuc2V0TmFtZShcIkxpY2Vuc2UgS2V5XCIpXG4gICAgICAuc2V0RGVzYyhcIlVubG9jayBQcm8gZmVhdHVyZXMgd2l0aCB5b3VyIGxpY2Vuc2Uga2V5XCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiUGFzdGUgbGljZW5zZSBrZXlcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5ID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5pbnB1dEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWxpY2Vuc2UtaW5wdXRcIik7XG4gICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gXCJwYXNzd29yZFwiO1xuICAgICAgICB0ZXh0LmlucHV0RWwuc3R5bGUuZm9udEZhbWlseSA9IFwibW9ub3NwYWNlXCI7XG4gICAgICAgIHRleHQuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gXCJ0ZXh0XCI7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBcImluaGVyaXRcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIHRleHQuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCAoKSA9PiB7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnR5cGUgPSBcInBhc3N3b3JkXCI7XG4gICAgICAgICAgdGV4dC5pbnB1dEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBcIm1vbm9zcGFjZVwiO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICB9KVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZShpc1Byb0FjdGl2ZSlcbiAgICAgICAgICAuc2V0VG9vbHRpcChcbiAgICAgICAgICAgIGlzUHJvQWN0aXZlID8gXCJEaXNhYmxlIFBybyBmZWF0dXJlc1wiIDogXCJFbmFibGUgUHJvIGZlYXR1cmVzXCJcbiAgICAgICAgICApXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgIC8vIE9ubHkgdmFsaWRhdGUgd2hlbiB0b2dnbGluZyBPTlxuICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICAgICAuZ2V0TGljZW5zZU1hbmFnZXIoKVxuICAgICAgICAgICAgICAgIC52YWxpZGF0ZUxpY2Vuc2VLZXkodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICBcIkludmFsaWQgbGljZW5zZSBrZXkgLSBQcm8gZmVhdHVyZXMgZGlzYWJsZWRcIlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChpc1Byb0FjdGl2ZSkge1xuICAgICAgICAgIHRvZ2dsZS50b2dnbGVFbC5hZGRDbGFzcyhcIm1vZC1jdGFcIik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgaWYgKGlzUHJvQWN0aXZlKSB7XG4gICAgICBjb25zdCBzdGF0dXNTZXR0aW5nID0gbmV3IFNldHRpbmcobGljZW5zZVNldHRpbmdDb250YWluZXIpXG4gICAgICAgIC5zZXROYW1lKFwiUHJvIFN0YXR1c1wiKVxuICAgICAgICAuc2V0RGVzYyhcIkFjdGl2ZSBzdWJzY3JpcHRpb24gXHUyMDIyIFByZW1pdW0gZmVhdHVyZXMgZW5hYmxlZFwiKTtcblxuICAgICAgc3RhdHVzU2V0dGluZy5uYW1lRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJwcm8tYmFkZ2VcIixcbiAgICAgICAgdGV4dDogXCJBQ1RJVkVcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBiYWxhbmNlRWwgPSBjcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInRva2VuLWJhbGFuY2UtdmFsdWVcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nLi4uXCIsXG4gICAgICB9KTtcblxuICAgICAgc3RhdHVzU2V0dGluZy5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRJY29uKFwic3BhcmtsZXNcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkF2YWlsYWJsZSBjcmVkaXRzXCIpXG4gICAgICAgICAgLnNldERpc2FibGVkKHRydWUpO1xuICAgICAgICBzdGF0dXNTZXR0aW5nLmNvbnRyb2xFbC5hcHBlbmRDaGlsZChiYWxhbmNlRWwpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmRpc3BsYXlUb2tlbkJhbGFuY2UoYmFsYW5jZUVsKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgUHJvIHByb21vdGlvbiBzZWN0aW9uIGlmIG5vdCBhY3RpdmVcbiAgICB0aGlzLmRpc3BsYXlQcm9Qcm9tb3Rpb25TZWN0aW9uKGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLCBpc1Byb0FjdGl2ZSk7XG5cbiAgICAvLyBBZGQgYmV0YSBub3RpY2Ugc2VjdGlvblxuICAgIGNvbnN0IGJldGFOb3RpY2VFbCA9IGxpY2Vuc2VTZXR0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYmV0YS1ub3RpY2VcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IGJldGFOb3RpY2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwiYmV0YS1ub3RpY2UtaGVhZGVyXCIsXG4gICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhoZWFkZXJDb250YWluZXIpXG4gICAgICAuc2V0SGVhZGluZygpXG4gICAgICAuc2V0TmFtZShcIkJldGEgVGVzdGluZyBQaGFzZVwiKVxuICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uXG4gICAgICAgICAgLnNldEljb24oXCJyb2NrZXRcIilcbiAgICAgICAgICAuc2V0RGlzYWJsZWQodHJ1ZSlcbiAgICAgICAgICAuZXh0cmFTZXR0aW5nc0VsLmFkZENsYXNzKFwiYmV0YS1oZWFkZXItaWNvblwiKTtcbiAgICAgIH0pO1xuXG4gICAgYmV0YU5vdGljZUVsLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBcIlRoYW5rIHlvdSBmb3IgdHJ5aW5nIG91dCBTeXN0ZW1TY3VscHQhIFdoaWxlIHNvbWUgY29yZSBmZWF0dXJlcyBhcmUgYXZhaWxhYmxlIHRvIGV2ZXJ5b25lIGR1cmluZyB0aGlzIGJldGEgcGhhc2UsIGNlcnRhaW4gYWR2YW5jZWQgY2FwYWJpbGl0aWVzIGFyZSBjdXJyZW50bHkgbGltaXRlZCB0byBQYXRyZW9uIG1lbWJlcnMgdG8gaGVscCBtYW5hZ2UgdGhlIHRlc3RpbmcgZ3JvdXAgc2l6ZS5cIixcbiAgICAgIGNsczogXCJiZXRhLW5vdGljZS10ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBiZXRhTm90aWNlRWwuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgIHRleHQ6IFwiQXMgYSBzb2xvIGRldmVsb3BlciwgeW91ciBmZWVkYmFjayBpcyBpbmNyZWRpYmx5IHZhbHVhYmxlIGluIHNoYXBpbmcgU3lzdGVtU2N1bHB0LiBGZWVsIGZyZWUgdG8gdGVzdCB0aGUgYXZhaWxhYmxlIGZlYXR1cmVzLCBhbmQgaWYgeW91J2QgbGlrZSBhY2Nlc3MgdG8gdGhlIGZ1bGwgYmV0YSBleHBlcmllbmNlLCBjb25zaWRlciBiZWNvbWluZyBhIFBhdHJlb24gc3VwcG9ydGVyIVwiLFxuICAgICAgY2xzOiBcImJldGEtbm90aWNlLXRleHRcIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LWJldGEtc3R5bGVzXCIpKSB7XG4gICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgICAgIHN0eWxlLmlkID0gXCJzeXN0ZW1zY3VscHQtYmV0YS1zdHlsZXNcIjtcbiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgICAuc3lzdGVtc2N1bHB0LWJldGEtbm90aWNlIHtcbiAgICAgICAgICBtYXJnaW4tdG9wOiAzMnB4O1xuICAgICAgICAgIHBhZGRpbmc6IDIwcHg7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgICAgICBib3gtc2hhZG93OiAwIDFweCAzcHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgICAgICB9XG5cbiAgICAgICAgLmJldGEtbm90aWNlLWhlYWRlciB7XG4gICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC5iZXRhLW5vdGljZS1oZWFkZXIgLnNldHRpbmctaXRlbSB7XG4gICAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtaGVhZGVyIC5zZXR0aW5nLWl0ZW0tbmFtZSB7XG4gICAgICAgICAgZm9udC1zaXplOiAxLjJlbTtcbiAgICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1oZWFkZXItaWNvbiB7XG4gICAgICAgICAgY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCkgIWltcG9ydGFudDtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xuICAgICAgICAgIG1hcmdpbi1yaWdodDogOHB4ICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cblxuICAgICAgICAuYmV0YS1ub3RpY2UtdGV4dCB7XG4gICAgICAgICAgbWFyZ2luOiAxMnB4IDA7XG4gICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgICBsaW5lLWhlaWdodDogMS42O1xuICAgICAgICAgIGZvbnQtc2l6ZTogMC45NWVtO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRoZW1lLWRhcmsgLnN5c3RlbXNjdWxwdC1iZXRhLW5vdGljZSB7XG4gICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwgMCwgMCwgMC4yKTtcbiAgICAgICAgfVxuICAgICAgYDtcbiAgICAgIGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRpc3BsYXlUb2tlbkJhbGFuY2UoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCB0aGlzLnN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0VG9rZW5CYWxhbmNlKCk7XG4gICAgICBjb250YWluZXJFbC5zZXRUZXh0KGBBdmFpbGFibGUgQ3JlZGl0czogJHtiYWxhbmNlLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnRhaW5lckVsLnNldFRleHQoXCJVbmFibGUgdG8gZmV0Y2ggY3JlZGl0IGJhbGFuY2VcIik7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHRva2VuIGJhbGFuY2U6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlQcm9Qcm9tb3Rpb25TZWN0aW9uKFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcbiAgICBpc1Byb0FjdGl2ZTogYm9vbGVhblxuICApIHtcbiAgICBpZiAoIWlzUHJvQWN0aXZlKSB7XG4gICAgICBjb25zdCBwcm9Qcm9tb3Rpb25FbCA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm8tcHJvbW90aW9uXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaGVhZGVyQ29udGFpbmVyID0gcHJvUHJvbW90aW9uRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwicHJvLXByb21vdGlvbi1oZWFkZXJcIixcbiAgICAgIH0pO1xuXG4gICAgICBuZXcgU2V0dGluZyhoZWFkZXJDb250YWluZXIpXG4gICAgICAgIC5zZXRIZWFkaW5nKClcbiAgICAgICAgLnNldE5hbWUoXCJVcGdyYWRlIHRvIFByb1wiKVxuICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIGJ1dHRvblxuICAgICAgICAgICAgLnNldEljb24oXCJzcGFya2xlc1wiKVxuICAgICAgICAgICAgLnNldERpc2FibGVkKHRydWUpXG4gICAgICAgICAgICAuZXh0cmFTZXR0aW5nc0VsLmFkZENsYXNzKFwicHJvLWhlYWRlci1pY29uXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgcHJvUHJvbW90aW9uRWwuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgICAgdGV4dDogXCJUcmFuc2Zvcm0geW91ciB3b3JrZmxvdyB3aXRoIHBvd2VyZnVsIEFJIGZlYXR1cmVzIGRlc2lnbmVkIGZvciBzZXJpb3VzIHByb2R1Y3Rpdml0eS5cIixcbiAgICAgICAgY2xzOiBcInByby1wcm9tb3Rpb24tdGV4dFwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJlbmVmaXRzTGlzdCA9IHByb1Byb21vdGlvbkVsLmNyZWF0ZUVsKFwidWxcIiwge1xuICAgICAgICBjbHM6IFwicHJvLWJlbmVmaXRzLWxpc3RcIixcbiAgICAgIH0pO1xuXG4gICAgICBbXG4gICAgICAgIFwiQXVkaW8gUmVjb3JkaW5nICYgSW5zdGFudCBUcmFuc2NyaXB0aW9uXCIsXG4gICAgICAgIFwiU21hcnQgRG9jdW1lbnQgUHJvY2Vzc2luZ1wiLFxuICAgICAgICBcIlJlYWwtdGltZSBWb2ljZS10by1UZXh0IGluIE5vdGVzICYgQ2hhdFwiLFxuICAgICAgICBcIk11bHRpLWZvcm1hdCBTdXBwb3J0IChQREYsIEF1ZGlvLCBJbWFnZXMpXCIsXG4gICAgICAgIFwiQUkgVGVtcGxhdGVzICYgQ3VzdG9tIFBlcnNvbmFsaXRpZXNcIixcbiAgICAgICAgXCJQcmlvcml0eSBBY2Nlc3MgdG8gTmV3IEZlYXR1cmVzXCIsXG4gICAgICAgIFwiMS1vbi0xIFN1cHBvcnQgdmlhIFBhdHJlb24gRE1zXCIsXG4gICAgICAgIFwiU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBEZXZlbG9wbWVudFwiLFxuICAgICAgXS5mb3JFYWNoKChiZW5lZml0KSA9PiB7XG4gICAgICAgIGJlbmVmaXRzTGlzdC5jcmVhdGVFbChcImxpXCIsIHsgdGV4dDogYmVuZWZpdCB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBuZXcgU2V0dGluZyhwcm9Qcm9tb3Rpb25FbCkuYWRkQnV0dG9uKChidXR0b24pID0+XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQmVjb21lIGEgUGF0cm9uXCIpXG4gICAgICAgICAgLnNldEN0YSgpXG4gICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheUNoYXRUYWIoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyRWwuZGF0YXNldC50YWIgPSBcImNoYXRcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJDaGF0IFNldHRpbmdzXCIgfSk7XG5cbiAgICAvLyBTeXN0ZW0gUHJvbXB0IFNldHRpbmdcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQ2hhdCBTeXN0ZW0gUHJvbXB0XCIpXG4gICAgICAuc2V0RGVzYyhcIkN1c3RvbWl6ZSB0aGUgc3lzdGVtIHByb21wdCB1c2VkIGZvciBhbGwgbmV3IGNoYXRzXCIpXG4gICAgICAuYWRkQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoXCJFZGl0IFByb21wdFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93RGVmYXVsdFN5c3RlbVByb21wdE1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG9uU2F2ZTogYXN5bmMgKG5ld1Byb21wdCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdCA9IG5ld1Byb21wdDtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTpcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgICAgICAgICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDogdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgICAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsSWQ6IHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgICAgb25Nb2RlbFNlbGVjdDogYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGN1cnJlbnRQcm9tcHRUeXBlOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChyZXN1bHQ/LmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN5c3RlbVByb21wdCA9IHJlc3VsdC5jb250ZW50O1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0VHlwZSA9IHJlc3VsdC50eXBlO1xuICAgICAgICAgICAgaWYgKHJlc3VsdD8udHlwZSA9PT0gXCJjdXN0b21cIiAmJiByZXN1bHQ/LnBhdGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aCA9IHJlc3VsdC5wYXRoO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aCA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlBZHZhbmNlZFRhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwiYWR2YW5jZWRcIjtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJEZXZlbG9wbWVudCBNb2RlXCIpXG4gICAgICAuc2V0RGVzYyhcIlRvZ2dsZSBiZXR3ZWVuIGRldmVsb3BtZW50IGFuZCBwcm9kdWN0aW9uIEFQSSBlbmRwb2ludHNcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZXZlbG9wbWVudE1vZGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlcnZlclVybCA9IHZhbHVlXG4gICAgICAgICAgICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjMwMDFcIlxuICAgICAgICAgICAgICA6IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgICBgU3dpdGNoZWQgdG8gJHt2YWx1ZSA/IFwiZGV2ZWxvcG1lbnRcIiA6IFwicHJvZHVjdGlvblwifSBtb2RlICgke1xuICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtU2N1bHB0U2VydmljZS5iYXNlVXJsXG4gICAgICAgICAgICAgIH0pYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIC8vIEFkZCBUaXRsZSBHZW5lcmF0aW9uIFByb21wdCBTZXR0aW5nc1xuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJUaXRsZSBHZW5lcmF0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkNvbmZpZ3VyZSBob3cgdGl0bGVzIHNob3VsZCBiZSBnZW5lcmF0ZWQgZnJvbSB5b3VyIGNvbnRlbnRcIilcbiAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkVkaXQgUHJvbXB0XCIpXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJDb25maWd1cmUgdGhlIHRpdGxlIGdlbmVyYXRpb24gcHJvbXB0XCIpXG4gICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBzaG93VGl0bGVHZW5lcmF0aW9uUHJvbXB0TW9kYWwgfSA9IGF3YWl0IGltcG9ydChcbiAgICAgICAgICAgICAgXCIuL1RpdGxlR2VuZXJhdGlvblByb21wdE1vZGFsXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93VGl0bGVHZW5lcmF0aW9uUHJvbXB0TW9kYWwoXG4gICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGl0bGVHZW5lcmF0aW9uUHJvbXB0LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTogdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICBjdXJyZW50Q3VzdG9tUGF0aDogdGhpcy5wbHVnaW4uc2V0dGluZ3MudGl0bGVHZW5lcmF0aW9uUHJvbXB0UGF0aCxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aXRsZUdlbmVyYXRpb25Qcm9tcHQgPSByZXN1bHQuY29udGVudDtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGl0bGVHZW5lcmF0aW9uUHJvbXB0VHlwZSA9IHJlc3VsdC50eXBlO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aXRsZUdlbmVyYXRpb25Qcm9tcHRQYXRoID0gcmVzdWx0LnBhdGggfHwgXCJcIjtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidXR0b247XG4gICAgICB9KTtcblxuICAgIC8vIEFkZCBBdXRvbWF0aWMgVGl0bGUgR2VuZXJhdGlvbiBTZXR0aW5nXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkF1dG9tYXRpYyBUaXRsZSBHZW5lcmF0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgZ2VuZXJhdGUgdGl0bGVzIGZvciBuZXcgY2hhdHMgd2l0aG91dCBzaG93aW5nIHRoZSBtb2RhbFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b21hdGljVGl0bGVHZW5lcmF0aW9uKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9tYXRpY1RpdGxlR2VuZXJhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAvLyBSZXNldCB0byBGYWN0b3J5IFNldHRpbmdzIGJ1dHRvblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJSZXNldCB0byBGYWN0b3J5IFNldHRpbmdzXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJDbGVhciBhbGwgY3VzdG9tIHNldHRpbmdzIGFuZCByZXN0b3JlIGRlZmF1bHRzIGZvciB0aGlzIHBsdWdpbi5cIlxuICAgICAgKVxuICAgICAgLmFkZEJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KFwiUmVzZXRcdTIwMjZcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29uZmlybSA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgXCJSZXNldCB0byBGYWN0b3J5IERlZmF1bHRzXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICAgIFwiVGhpcyB3aWxsIGRlbGV0ZSBBTEwgc2F2ZWQgc2V0dGluZ3MgYW5kIGN1c3RvbWl6YXRpb25zIGZvciBTeXN0ZW1TY3VscHQsIHJldHVybmluZyBldmVyeXRoaW5nIHRvIGRlZmF1bHQuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlP1wiLFxuICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlJlc2V0ICYgUmVsb2FkXCIsXG4gICAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghY29uZmlybSB8fCAhY29uZmlybS5jb25maXJtZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEobnVsbCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpblxuICAgICAgICAgICAgICAuZ2V0U2V0dGluZ3NNYW5hZ2VyKClcbiAgICAgICAgICAgICAgLnVwZGF0ZVNldHRpbmdzKERFRkFVTFRfU0VUVElOR1MpO1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVzZXR0aW5nIHRvIGZhY3Rvcnkgc2V0dGluZ3M6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJGYWlsZWQgdG8gcmVzZXQ6IFwiICsgU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkaXNwbGF5RGlyZWN0b3JpZXNUYWIoXG4gICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxuICAgIGlzUHJvQWN0aXZlOiBib29sZWFuXG4gICkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJkaXJlY3Rvcmllc1wiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIkRpcmVjdG9yeSBTZXR0aW5nc1wiIH0pO1xuXG4gICAgLy8gQ29yZSBkaXJlY3RvcmllcyAoYWx3YXlzIGF2YWlsYWJsZSlcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiQ2hhdHMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIGNoYXQgaGlzdG9yeVwiLFxuICAgICAgXCJjaGF0c0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvQ2hhdHNcIlxuICAgICk7XG5cbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiUmVjb3JkaW5ncyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgcmVjb3JkaW5nc1wiLFxuICAgICAgXCJyZWNvcmRpbmdzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9SZWNvcmRpbmdzXCJcbiAgICApO1xuXG4gICAgLy8gQ2hhbmdlZCB0byBcIlN5c3RlbSBQcm9tcHRzXCJcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiU3lzdGVtIFByb21wdHMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IGZvciB5b3VyIGN1c3RvbSBzeXN0ZW0gcHJvbXB0c1wiLFxuICAgICAgXCJzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XCIsXG4gICAgICBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiXG4gICAgKTtcblxuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJBdHRhY2htZW50cyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHNhdmVkIGltYWdlcyBhbmQgYXR0YWNobWVudHNcIixcbiAgICAgIFwiYXR0YWNobWVudHNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L0F0dGFjaG1lbnRzXCJcbiAgICApO1xuXG4gICAgLy8gQWx3YXlzIGRpc3BsYXkgdGhlc2UgZGlyZWN0b3JpZXNcbiAgICB0aGlzLmNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgICBjb250YWluZXJFbCxcbiAgICAgIFwiRXh0cmFjdGlvbnMgRGlyZWN0b3J5XCIsXG4gICAgICBcIlNlbGVjdCB0aGUgZGlyZWN0b3J5IHdoZXJlIGV4dHJhY3RlZCBQREZzL2RvY3Mgd2lsbCBiZSBwbGFjZWRcIixcbiAgICAgIFwiZXh0cmFjdGlvbnNEaXJlY3RvcnlcIixcbiAgICAgIFwiU3lzdGVtU2N1bHB0L0V4dHJhY3Rpb25zXCJcbiAgICApO1xuICAgIHRoaXMuY3JlYXRlRGlyZWN0b3J5U2V0dGluZyhcbiAgICAgIGNvbnRhaW5lckVsLFxuICAgICAgXCJUYXNrcyBEaXJlY3RvcnlcIixcbiAgICAgIFwiU2VsZWN0IHRoZSBkaXJlY3RvcnkgZm9yIHlvdXIgdGFzayBsaXN0c1wiLFxuICAgICAgXCJ0YXNrc0RpcmVjdG9yeVwiLFxuICAgICAgXCJTeXN0ZW1TY3VscHQvVGFza3NcIlxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURpcmVjdG9yeVNldHRpbmcoXG4gICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBkZXNjOiBzdHJpbmcsXG4gICAgc2V0dGluZ0tleTpcbiAgICAgIHwgXCJhdHRhY2htZW50c0RpcmVjdG9yeVwiXG4gICAgICB8IFwicmVjb3JkaW5nc0RpcmVjdG9yeVwiXG4gICAgICB8IFwiY2hhdHNEaXJlY3RvcnlcIlxuICAgICAgfCBcImV4dHJhY3Rpb25zRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5XCJcbiAgICAgIHwgXCJ0YXNrc0RpcmVjdG9yeVwiLFxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmdcbiAgKSB7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShuYW1lKVxuICAgICAgLnNldERlc2MoZGVzYylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIocGxhY2Vob2xkZXIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlRGlyZWN0b3J5Q2hhbmdlKHZhbHVlLCBzZXR0aW5nS2V5KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhdHRhY2hGb2xkZXJTdWdnZXN0ZXIoXG4gICAgICAgICAgdGV4dC5pbnB1dEVsLFxuICAgICAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsaWRhdGVEaXJlY3Rvcnkoc2VsZWN0ZWRQYXRoKSkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSA9IHNlbGVjdGVkUGF0aDtcbiAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShzZWxlY3RlZFBhdGgpO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNob3dQb3B1cChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICBcIkludmFsaWQgZGlyZWN0b3J5IHBhdGguIFBsZWFzZSB1c2UgcmVsYXRpdmUgcGF0aHMgd2l0aG91dCAnLi4nIG9yIGxlYWRpbmcgc2xhc2hlcy5cIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5hcHBcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheVJlY29yZGVyVGFiKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnRhaW5lckVsLmRhdGFzZXQudGFiID0gXCJyZWNvcmRlclwiO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIlJlY29yZGluZyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgY29uc3QgbWljcm9waG9uZVNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUHJlZmVycmVkIE1pY3JvcGhvbmVcIilcbiAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHlvdXIgcHJlZmVycmVkIG1pY3JvcGhvbmUgZm9yIHJlY29yZGluZ3NcIik7XG5cbiAgICBjb25zdCBtaWNTZWxlY3QgPSBtaWNyb3Bob25lU2V0dGluZy5jb250cm9sRWwuY3JlYXRlRWwoXCJzZWxlY3RcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1taWNyb3Bob25lLXNlbGVjdFwiLFxuICAgIH0pO1xuXG4gICAgbWljU2VsZWN0XG4gICAgICAuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICB2YWx1ZTogXCJcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nIG1pY3JvcGhvbmVzLi4uXCIsXG4gICAgICB9KVxuICAgICAgLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcblxuICAgIG1pY1NlbGVjdC5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlc1xuICAgICAgICAuZW51bWVyYXRlRGV2aWNlcygpXG4gICAgICAgIC50aGVuKChkZXZpY2VzKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWljcm9waG9uZXMgPSBkZXZpY2VzLmZpbHRlcihcbiAgICAgICAgICAgIChkZXZpY2UpID0+IGRldmljZS5raW5kID09PSBcImF1ZGlvaW5wdXRcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgbWljU2VsZWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgbWljU2VsZWN0LmZpcnN0RWxlbWVudENoaWxkPy5yZW1vdmUoKTsgLy8gUmVtb3ZlIGxvYWRpbmcgbWVzc2FnZVxuICAgICAgICAgIG1pY3JvcGhvbmVzLmZvckVhY2goKG1pYykgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gbWljU2VsZWN0LmNyZWF0ZUVsKFwib3B0aW9uXCIsIHtcbiAgICAgICAgICAgICAgdmFsdWU6IG1pYy5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgdGV4dDogbWljLmxhYmVsIHx8IGBNaWNyb3Bob25lICR7bWljLmRldmljZUlkLnNsaWNlKDAsIDgpfS4uLmAsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChtaWMuZGV2aWNlSWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCkge1xuICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVudW1lcmF0aW5nIGF1ZGlvIGRldmljZXM6XCIsIGVycm9yKTtcbiAgICAgICAgICBtaWNTZWxlY3QuY3JlYXRlRWwoXCJvcHRpb25cIiwge1xuICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIlVuYWJsZSB0byBsaXN0IG1pY3JvcGhvbmVzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTWljcm9waG9uZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICBtaWNTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWQgPSBtaWNTZWxlY3QudmFsdWU7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBdXRvLVRyYW5zY3JpYmUgUmVjb3JkaW5nc1wiKVxuICAgICAgLnNldERlc2MoXCJBdXRvbWF0aWNhbGx5IHRyYW5zY3JpYmUgcmVjb3JkaW5ncyB3aGVuIHRoZXkgYXJlIGNvbXBsZXRlZFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1RyYW5zY3JpYmVSZWNvcmRpbmdzKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9UcmFuc2NyaWJlUmVjb3JkaW5ncyA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQXV0by1QYXN0ZSBUcmFuc2NyaXB0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgcGFzdGUgdHJhbnNjcmlwdGlvbnMgaW50byB0aGUgYWN0aXZlIGRvY3VtZW50XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvUGFzdGVUcmFuc2NyaXB0aW9uKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9QYXN0ZVRyYW5zY3JpcHRpb24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgLy8gQWRkIG5ldyBwb3N0LXByb2Nlc3NpbmcgcHJvbXB0IHNldHRpbmdcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUG9zdC1Qcm9jZXNzaW5nXCIpXG4gICAgICAuc2V0RGVzYyhcIkNvbmZpZ3VyZSBob3cgdHJhbnNjcmlwdGlvbnMgc2hvdWxkIGJlIHBvc3QtcHJvY2Vzc2VkXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZClcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkVuYWJsZS9kaXNhYmxlIHBvc3QtcHJvY2Vzc2luZ1wiKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0b2dnbGU7XG4gICAgICB9KVxuICAgICAgLmFkZEJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiRWRpdCBQcm9tcHRcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkNvbmZpZ3VyZSB0aGUgcG9zdC1wcm9jZXNzaW5nIHByb21wdFwiKVxuICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2hvd1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWwgfSA9IGF3YWl0IGltcG9ydChcbiAgICAgICAgICAgICAgXCIuL1Bvc3RQcm9jZXNzaW5nUHJvbXB0TW9kYWxcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3N0UHJvY2Vzc2luZ1Byb21wdE1vZGFsKFxuICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nUHJvbXB0ID0gcmVzdWx0LmNvbnRlbnQ7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlUYXNrc1RhYihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXJFbC5kYXRhc2V0LnRhYiA9IFwidGFza3NcIjtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJUYXNrcyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkF1dG8tTW92ZSBDb21wbGV0ZWQgVGFza3NcIilcbiAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSBtb3ZlIGNvbXBsZXRlZCB0YXNrcyB0byB0aGUgYm90dG9tIG9mIHRoZSBsaXN0XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb3ZlQ29tcGxldGVkVGFza3NEb3duKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vdmVDb21wbGV0ZWRUYXNrc0Rvd24gPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURm9sZGVyLCBBYnN0cmFjdElucHV0U3VnZ2VzdCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgRm9sZGVyU3VnZ2VzdGVyIGV4dGVuZHMgQWJzdHJhY3RJbnB1dFN1Z2dlc3Q8c3RyaW5nPiB7XG4gIHByaXZhdGUgY29udGVudDogU2V0PHN0cmluZz47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICAgIHByaXZhdGUgb25TZWxlY3RDYjogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQsXG4gICAgYXBwOiBBcHBcbiAgKSB7XG4gICAgc3VwZXIoYXBwLCBpbnB1dEVsKTtcbiAgICB0aGlzLmNvbnRlbnQgPSBnZXRGb2xkZXJTdWdnZXN0aW9ucyhhcHApO1xuICB9XG5cbiAgZ2V0U3VnZ2VzdGlvbnMoaW5wdXRTdHI6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBsb3dlckNhc2VJbnB1dFN0ciA9IGlucHV0U3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIFsuLi50aGlzLmNvbnRlbnRdLmZpbHRlcigoY29udGVudCkgPT5cbiAgICAgIGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlckNhc2VJbnB1dFN0cilcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyU3VnZ2VzdGlvbihjb250ZW50OiBzdHJpbmcsIGVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGVsLnNldFRleHQoY29udGVudCk7XG4gIH1cblxuICBzZWxlY3RTdWdnZXN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZXZ0OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMub25TZWxlY3RDYihjb250ZW50KTtcbiAgICB0aGlzLmlucHV0RWwudmFsdWUgPSBjb250ZW50O1xuICAgIHRoaXMuaW5wdXRFbC5ibHVyKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb2xkZXJTdWdnZXN0aW9ucyhhcHA6IEFwcCk6IFNldDxzdHJpbmc+IHtcbiAgY29uc3QgZm9sZGVycyA9IGFwcC52YXVsdFxuICAgIC5nZXRBbGxMb2FkZWRGaWxlcygpXG4gICAgLmZpbHRlcigoZmlsZSkgPT4gZmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIGFzIFRGb2xkZXJbXTtcbiAgcmV0dXJuIG5ldyBTZXQoZm9sZGVycy5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLnBhdGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaEZvbGRlclN1Z2dlc3RlcihcbiAgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudCxcbiAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4gdm9pZCxcbiAgYXBwOiBBcHBcbik6IEZvbGRlclN1Z2dlc3RlciB7XG4gIHJldHVybiBuZXcgRm9sZGVyU3VnZ2VzdGVyKGlucHV0RWwsIG9uU2VsZWN0LCBhcHApO1xufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFRGaWxlLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBhdHRhY2hGaWxlU3VnZ2VzdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRmlsZVN1Z2dlc3RlclwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0UHJlc2V0IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4vTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRNb2RlbCB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5mdW5jdGlvbiBzYW5pdGl6ZUZpbGVOYW1lKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKS5yZXBsYWNlKC8gL2csIFwiLVwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0U3lzdGVtUHJvbXB0UGF0aChkaXJlY3Rvcnk6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtkaXJlY3Rvcnl9LyR7ZmlsZU5hbWV9Lm1kYDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZWZhdWx0U3lzdGVtUHJvbXB0UmVzdWx0IHtcbiAgY29udGVudDogc3RyaW5nO1xuICB0eXBlOiBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCI7XG4gIHBhdGg/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVmYXVsdFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucyB7XG4gIG9uU2F2ZT86IChuZXdQcm9tcHQ6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeT86IHN0cmluZztcbiAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gIHBsdWdpbj86IGFueTtcbiAgb25Nb2RlbFNlbGVjdD86IChtb2RlbElkOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIGN1cnJlbnRNb2RlbElkPzogc3RyaW5nO1xuICBjdXJyZW50UHJvbXB0Pzogc3RyaW5nO1xuICBjdXJyZW50UHJvbXB0VHlwZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIERlZmF1bHRTeXN0ZW1Qcm9tcHRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSByZXN1bHQ6IERlZmF1bHRTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBEZWZhdWx0U3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21JbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21TZWN0aW9uOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvcHRpb25zOiBEZWZhdWx0U3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zO1xuICBwcml2YXRlIHN5c3RlbVByb21wdFNlcnZpY2U6IFN5c3RlbVByb21wdFNlcnZpY2U7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10gPSBbXTtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVzZXRCdXR0b25Db250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGFjdGl2ZVByZXNldDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbW9kZWxJbmRpY2F0b3I6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgbW9kYWxPcGVuVGltZTogbnVtYmVyO1xuICBwcml2YXRlIHJlc2l6ZVRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0O1xuICBwcml2YXRlIHByb21wdHNDb250YWluZXI6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIGxvYWRpbmdFbDogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgY3VycmVudFByb21wdDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvcHRpb25zOiBEZWZhdWx0U3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuY3VycmVudFByb21wdCA9IG9wdGlvbnMuY3VycmVudFByb21wdCB8fCBcIlwiO1xuICAgIHRoaXMuc3lzdGVtUHJvbXB0U2VydmljZSA9IFN5c3RlbVByb21wdFNlcnZpY2UuZ2V0SW5zdGFuY2UoYXBwKTtcbiAgICBpZiAob3B0aW9ucy5wbHVnaW4pIHtcbiAgICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2Uob3B0aW9ucy5wbHVnaW4uc2V0dGluZ3MsIGFwcCk7XG4gICAgICAvLyBQcmUtbG9hZCBjYWNoZWQgZGF0YVxuICAgICAgdGhpcy5zeXN0ZW1Qcm9tcHRzID0gU3lzdGVtUHJvbXB0U2VydmljZS5nZXRDYWNoZWRQcm9tcHRzKCkgfHwgW107XG4gICAgfVxuICAgIC8vIFNldCBpbml0aWFsIGFjdGl2ZSBwcmVzZXQgYmFzZWQgb24gY3VycmVudFByb21wdFxuICAgIHRoaXMuc2V0SW5pdGlhbEFjdGl2ZVByZXNldCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbml0aWFsQWN0aXZlUHJlc2V0KCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuY3VycmVudFByb21wdFR5cGUpIHtcbiAgICAgIGNvbnN0IG1hdGNoaW5nUHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQocCA9PiBwLmlkID09PSB0aGlzLm9wdGlvbnMuY3VycmVudFByb21wdFR5cGUpO1xuICAgICAgaWYgKG1hdGNoaW5nUHJlc2V0KSB7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gbWF0Y2hpbmdQcmVzZXQubGFiZWw7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKCF0aGlzLmN1cnJlbnRQcm9tcHQpIHtcbiAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gXCJHZW5lcmFsLXVzZVwiOyAvLyBEZWZhdWx0IGZvciBuZXcgY2hhdFxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtYXRjaGluZ1ByZXNldCA9IHRoaXMuc3lzdGVtUHJvbXB0cy5maW5kKHAgPT4gcC5zeXN0ZW1Qcm9tcHQudHJpbSgpID09PSB0aGlzLmN1cnJlbnRQcm9tcHQudHJpbSgpKTtcbiAgICB0aGlzLmFjdGl2ZVByZXNldCA9IG1hdGNoaW5nUHJlc2V0ID8gbWF0Y2hpbmdQcmVzZXQubGFiZWwgOiBcIkN1c3RvbVwiO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93TG9hZGluZyhzaG93OiBib29sZWFuKSB7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcbiAgICB0aGlzLmNvbnRlbnRDb250YWluZXIuc3R5bGUub3BhY2l0eSA9IHNob3cgPyBcIjAuNVwiIDogXCIxXCI7XG4gIH1cblxuICBwcml2YXRlIHNldHVwUmVzaXplT2JzZXJ2ZXIoKSB7XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVzaXplVGltZW91dCk7XG4gICAgICB0aGlzLnJlc2l6ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgICAgdGhpcy50ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSB0aGlzLnRleHRBcmVhLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICAgIH0sIDUwKTtcbiAgICB9KTtcbiAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMudGV4dEFyZWEpO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtc3lzdGVtLXByb21wdC1tb2RhbFwiKTtcbiAgICB0aGlzLmNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIHRoaXMuY29udGVudEVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LXN5c3RlbS1wcm9tcHQtY29udGVudFwiKTtcblxuICAgIHRoaXMuY29udGVudENvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jb250ZW50LWNvbnRhaW5lclwiKTtcbiAgICB0aGlzLnNldHVwTG9hZGluZ0luZGljYXRvcigpO1xuICAgIHRoaXMuc2V0dXBNb2RlbFNlY3Rpb24oKTtcbiAgICB0aGlzLnNldHVwVGV4dEFyZWEoKTtcbiAgICB0aGlzLnNldHVwQnV0dG9ucygpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB3aXRoIGN1cnJlbnQgcHJvbXB0IGltbWVkaWF0ZWx5LCBubyBBUEkgY2FsbHMgeWV0XG4gICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQgfHwgXCJcIjtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgd2l0aCBjYWNoZWQgZGF0YSBmaXJzdFxuICAgIGlmICh0aGlzLnN5c3RlbVByb21wdHMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5jcmVhdGVQcmVzZXRCdXR0b25zKCk7XG4gICAgICAvLyBFbnN1cmUgaW5pdGlhbCBwcmVzZXQgaXMgcmVmbGVjdGVkIGltbWVkaWF0ZWx5XG4gICAgICBjb25zdCBpbml0aWFsUHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQocCA9PiBwLmxhYmVsID09PSB0aGlzLmFjdGl2ZVByZXNldCkgfHwge1xuICAgICAgICBpZDogXCJjdXN0b21cIixcbiAgICAgICAgbGFiZWw6IFwiQ3VzdG9tXCIsXG4gICAgICAgIHN5c3RlbVByb21wdDogdGhpcy5jdXJyZW50UHJvbXB0LFxuICAgICAgICBpc1VzZXJDb25maWd1cmFibGU6IHRydWVcbiAgICAgIH07XG4gICAgICB0aGlzLnVwZGF0ZVVJRm9yUHJlc2V0KGluaXRpYWxQcmVzZXQpO1xuICAgIH1cblxuICAgIC8vIE9ubHkgc2hvdyBsb2FkaW5nIGFuZCBmZXRjaCBmcmVzaCBwcm9tcHRzIGlmIGNhY2hlIGlzIGludmFsaWQgb3IgZW1wdHlcbiAgICBpZiAoIXRoaXMuc3lzdGVtUHJvbXB0cy5sZW5ndGggfHwgIVN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkpIHtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcodHJ1ZSk7XG4gICAgICBhd2FpdCB0aGlzLmxvYWRTeXN0ZW1Qcm9tcHRzKCkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRmFpbGVkIHRvIGxvYWQgc3lzdGVtIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cFJlc2l6ZU9ic2VydmVyKCk7XG4gICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldHVwTW9kZWxTZWN0aW9uKCkge1xuICAgIGlmICghdGhpcy5vcHRpb25zLnBsdWdpbiB8fCAhdGhpcy5vcHRpb25zLmN1cnJlbnRNb2RlbElkKSByZXR1cm47XG5cbiAgICBjb25zdCBtb2RlbFNlY3Rpb24gPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LW1vZGVsLXNlY3Rpb25cIik7XG4gICAgbW9kZWxTZWN0aW9uLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMXJlbVwiO1xuICAgIG1vZGVsU2VjdGlvbi5zdHlsZS5tYXJnaW5Ub3AgPSBcIjEuNXJlbVwiO1xuXG4gICAgY29uc3QgbW9kZWxIZWFkZXIgPSBtb2RlbFNlY3Rpb24uY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaGVhZGVyXCIsXG4gICAgICBhdHRyOiB7IHN0eWxlOiBcImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgbWFyZ2luLWJvdHRvbTogMC41cmVtOyBnYXA6IDAuNXJlbTtcIiB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2RlbENvbnRyb2xzID0gbW9kZWxIZWFkZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtY29udHJvbHNcIixcbiAgICAgIGF0dHI6IHsgc3R5bGU6IFwiZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxcmVtOyB3aWR0aDogMTAwJTtcIiB9XG4gICAgfSk7XG5cbiAgICB0aGlzLm1vZGVsSW5kaWNhdG9yID0gbW9kZWxDb250cm9scy5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZGljYXRvclwiIH0pO1xuICAgIHRoaXMubW9kZWxJbmRpY2F0b3Iuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XG4gICAgdGhpcy5tb2RlbEluZGljYXRvci5zdHlsZS5mbGV4ID0gXCIxXCI7XG5cbiAgICBjb25zdCBjdXJyZW50TW9kZWwgPSB0aGlzLm9wdGlvbnMucGx1Z2luLm1vZGVsU2VydmljZS5jYWNoZWRNb2RlbHM/LmZpbmQoXG4gICAgICAobW9kZWw6IFN5c3RlbVNjdWxwdE1vZGVsKSA9PiBtb2RlbC5pZCA9PT0gdGhpcy5vcHRpb25zLmN1cnJlbnRNb2RlbElkXG4gICAgKTtcbiAgICBjb25zdCBwcm92aWRlclByZWZpeCA9IGN1cnJlbnRNb2RlbFxuICAgICAgPyBjdXJyZW50TW9kZWwucHJvdmlkZXIgPT09IFwic3lzdGVtc2N1bHB0XCIgPyBcIltTUyBBSV0gXCIgOiBgWyR7Y3VycmVudE1vZGVsLnByb3ZpZGVyLnRvVXBwZXJDYXNlKCl9XSBgXG4gICAgICA6IFwiXCI7XG4gICAgdGhpcy5tb2RlbEluZGljYXRvci5zZXRUZXh0KGBDdXJyZW50IE1vZGVsOiAke3Byb3ZpZGVyUHJlZml4fSR7Y3VycmVudE1vZGVsPy5uYW1lIHx8IHRoaXMub3B0aW9ucy5jdXJyZW50TW9kZWxJZH1gKTtcblxuICAgIGNvbnN0IGNoYW5nZU1vZGVsQnV0dG9uID0gbW9kZWxDb250cm9scy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgICB0ZXh0OiBcIkNoYW5nZSBNb2RlbFwiXG4gICAgfSk7XG4gICAgY2hhbmdlTW9kZWxCdXR0b24uc3R5bGUucGFkZGluZyA9IFwiNHB4IDEycHhcIjtcbiAgICBjaGFuZ2VNb2RlbEJ1dHRvbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICAgIGNoYW5nZU1vZGVsQnV0dG9uLnN0eWxlLmZvbnRTaXplID0gXCIxNHB4XCI7XG5cbiAgICBjb25zdCBvcGVuTW9kZWxTZWxlY3Rpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCB0aGlzLm9wdGlvbnMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLm9wdGlvbnMuY3VycmVudE1vZGVsSWQgfHwgXCJcIixcbiAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25Nb2RlbFNlbGVjdCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5vcHRpb25zLm9uTW9kZWxTZWxlY3QobW9kZWxJZCk7XG4gICAgICAgICAgICBjb25zdCBuZXdNb2RlbCA9IG1vZGVscy5maW5kKChtOiBTeXN0ZW1TY3VscHRNb2RlbCkgPT4gbS5pZCA9PT0gbW9kZWxJZCk7XG4gICAgICAgICAgICBjb25zdCBuZXdQcmVmaXggPSBuZXdNb2RlbFxuICAgICAgICAgICAgICA/IG5ld01vZGVsLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiID8gXCJbU1MgQUldIFwiIDogYFske25ld01vZGVsLnByb3ZpZGVyLnRvVXBwZXJDYXNlKCl9XSBgXG4gICAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMubW9kZWxJbmRpY2F0b3Iuc2V0VGV4dChgQ3VycmVudCBNb2RlbDogJHtuZXdQcmVmaXh9JHtuZXdNb2RlbD8ubmFtZSB8fCBtb2RlbElkfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnBsdWdpblxuICAgICAgKTtcbiAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICB9O1xuXG4gICAgdGhpcy5tb2RlbEluZGljYXRvci5vbmNsaWNrID0gb3Blbk1vZGVsU2VsZWN0aW9uO1xuICAgIGNoYW5nZU1vZGVsQnV0dG9uLm9uY2xpY2sgPSBvcGVuTW9kZWxTZWxlY3Rpb247XG4gIH1cblxuICBwcml2YXRlIHNldHVwTG9hZGluZ0luZGljYXRvcigpIHtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3IgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWxvYWRpbmdcIik7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUucGFkZGluZyA9IFwiMjBweFwiO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5jcmVhdGVTcGFuKCkuc2V0VGV4dChcIkxvYWRpbmcgc3lzdGVtIHByb21wdHMuLi5cIik7XG4gIH1cblxuICBwcml2YXRlIHNldHVwVGV4dEFyZWEoKSB7XG4gICAgY29uc3QgdGV4dEFyZWFDb250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWEtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHByZXNldCBidXR0b24gY29udGFpbmVyIGJ1dCBkb24ndCBwb3B1bGF0ZSB5ZXRcbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24tY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGN1c3RvbSBzZWN0aW9uIChoaWRkZW4gYnkgZGVmYXVsdClcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24gPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tc2VjdGlvblwiXG4gICAgKTtcbiAgICB0aGlzLmN1c3RvbVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgY3VzdG9tSW5wdXRDb250YWluZXIgPSB0aGlzLmN1c3RvbVNlY3Rpb24uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0LWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIGlucHV0IGFuZCBidXR0b25cbiAgICBjb25zdCBjdXN0b21JbnB1dFdyYXBwZXIgPSBjdXN0b21JbnB1dENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1pbnB1dC13cmFwcGVyXCJcbiAgICApO1xuICAgIGN1c3RvbUlucHV0V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgY3VzdG9tSW5wdXRXcmFwcGVyLnN0eWxlLmdhcCA9IFwiOHB4XCI7XG4gICAgY3VzdG9tSW5wdXRXcmFwcGVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuXG4gICAgLy8gQWRkIHRoZSBzZWFyY2ggaW5wdXRcbiAgICB0aGlzLmN1c3RvbUlucHV0ID0gY3VzdG9tSW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2ggZm9yIGEgc3lzdGVtIHByb21wdCBmaWxlLi4uXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1pbnB1dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjcmVhdGUgbmV3IGJ1dHRvblxuICAgIGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IGN1c3RvbUlucHV0V3JhcHBlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNyZWF0ZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjcmVhdGVCdXR0b24uc3R5bGUucGFkZGluZyA9IFwiNHB4IDhweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICBzZXRJY29uKGNyZWF0ZUJ1dHRvbiwgXCJwbHVzXCIpO1xuXG4gICAgY3JlYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgdGVtcGxhdGVDb250ZW50ID0gXCJcIjtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRlbXBsYXRlQ29udGVudCA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5zeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdFRlbXBsYXRlKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCB0ZW1wbGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgXCJGYWlsZWQgdG8gZmV0Y2ggc3lzdGVtIHByb21wdCB0ZW1wbGF0ZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICB0aXRsZTogXCJDcmVhdGUgTmV3IFN5c3RlbSBQcm9tcHRcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJFbnRlciBhIHRpdGxlIGFuZCBjb250ZW50IGZvciB5b3VyIG5ldyBzeXN0ZW0gcHJvbXB0LiBUaGUgdGl0bGUgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIG1hcmtkb3duIGZpbGUgdGhhdCB5b3UgY2FuIGN1c3RvbWl6ZSBsYXRlci5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJDcmVhdGVcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIk15IEN1c3RvbSBBc3Npc3RhbnRcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tdGl0bGUtaW5wdXRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgICAgIHZhbHVlOiB0ZW1wbGF0ZUNvbnRlbnQsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWNyZWF0aW9uLWNvbnRlbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzdWx0Py5jb25maXJtZWQgfHwgIXJlc3VsdC5pbnB1dHM/LlswXSB8fCAhcmVzdWx0LmlucHV0cz8uWzFdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3RpdGxlLCBjb250ZW50XSA9IHJlc3VsdC5pbnB1dHM7XG4gICAgICBjb25zdCBwcm9tcHRzRGlyZWN0b3J5ID1cbiAgICAgICAgdGhpcy5vcHRpb25zLnN5c3RlbVByb21wdHNEaXJlY3RvcnkgPz8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIjtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gc2FuaXRpemVGaWxlTmFtZSh0aXRsZSk7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGdldFN5c3RlbVByb21wdFBhdGgocHJvbXB0c0RpcmVjdG9yeSwgZmlsZU5hbWUpO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwcm9tcHRzRGlyZWN0b3J5KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgLyogRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QgKi9cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBgIyAke3RpdGxlfVxcblxcbiR7Y29udGVudH1gO1xuICAgICAgICBjb25zdCBmaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSB0ZXh0YXJlYSB3aXRoIHRoZSBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLnRleHRBcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGZpbGVDb250ZW50O1xuICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgZmlsZVxuICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gZmlsZVBhdGg7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN5c3RlbSBwcm9tcHQgZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIixcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHN5c3RlbSBwcm9tcHQgZmlsZTpcIiwgZXJyb3IpO1xuXG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICA6IFwiRmFpbGVkIHRvIGNyZWF0ZSBzeXN0ZW0gcHJvbXB0IGZpbGUuIFBsZWFzZSB0cnkgYWdhaW4uXCI7XG5cbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZXJyb3JNZXNzYWdlLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBPbmx5IGF0dGFjaCBmaWxlIHN1Z2dlc3RlciBhZnRlciBpbnB1dCBpcyBjcmVhdGVkXG4gICAgaWYgKHRoaXMuY3VzdG9tSW5wdXQpIHtcbiAgICAgIGF0dGFjaEZpbGVTdWdnZXN0ZXIoXG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQsXG4gICAgICAgIGFzeW5jIChzZWxlY3RlZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHNlbGVjdGVkUGF0aCk7XG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBjb250ZW50O1xuICAgICAgICAgICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCB2YWx1ZSB3aXRob3V0IC5tZCBleHRlbnNpb25cbiAgICAgICAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHNlbGVjdGVkUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5vcHRpb25zLnN5c3RlbVByb21wdHNEaXJlY3RvcnkgPz8gXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRleHRBcmVhID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRleHRhcmVhXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHN5c3RlbSBwcm9tcHRcIixcbiAgICAgICAgcmVhZE9ubHk6IHRoaXMuYWN0aXZlUHJlc2V0ICE9PSBcIkN1c3RvbVwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gdGhpcy5jdXJyZW50UHJvbXB0O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cEJ1dHRvbnMoKSB7XG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICBjb25zdCBzZWNvbmRhcnlCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVDYW5jZWw7XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiU2F2ZVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhbmRsZVNhdmUgPSAoKSA9PiB7XG4gICAgICAvLyBGaW5kIHdoaWNoIHByZXNldCBpcyBhY3RpdmVcbiAgICAgIGNvbnN0IGFjdGl2ZUJ1dHRvbiA9IHRoaXMubW9kYWxFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIi5zeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi5hY3RpdmVcIlxuICAgICAgKTtcbiAgICAgIGNvbnN0IGFjdGl2ZVByZXNldExhYmVsID0gYWN0aXZlQnV0dG9uPy50ZXh0Q29udGVudCA/PyBcIlwiO1xuXG4gICAgICBsZXQgcmVzdWx0OiBEZWZhdWx0U3lzdGVtUHJvbXB0UmVzdWx0O1xuXG4gICAgICBpZiAoYWN0aXZlUHJlc2V0TGFiZWwgPT09IFwiQ3VzdG9tXCIgJiYgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSkge1xuICAgICAgICAvLyBSZW1vdmUgLm1kIGV4dGVuc2lvbiBhbmQgY29udmVydCB0byByZWxhdGl2ZSBsaW5rIGZvcm1hdFxuICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5jdXN0b21JbnB1dC52YWx1ZS5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMudGV4dEFyZWEudmFsdWUsXG4gICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQoXG4gICAgICAgICAgKHApID0+IHAubGFiZWwgPT09IGFjdGl2ZVByZXNldExhYmVsXG4gICAgICAgICk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICBjb250ZW50OiBwcmVzZXQuc3lzdGVtUHJvbXB0LFxuICAgICAgICAgICAgdHlwZTogcHJlc2V0LmlkIGFzIFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGN1cnJlbnQgY29udGVudCBpZiBubyBwcmVzZXQgZm91bmRcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLnRleHRBcmVhLnZhbHVlLFxuICAgICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0O1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgcHJpbWFyeUJ1dHRvbi5vbmNsaWNrID0gaGFuZGxlU2F2ZTtcblxuICAgIC8vIEhhbmRsZSBrZXlib2FyZCBldmVudHNcbiAgICB0aGlzLm1vZGFsRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIC8vIE9ubHkgaGFuZGxlIEVudGVyIGlmIG5vdCBpbiB0ZXh0YXJlYSAod2hlcmUgd2Ugd2FudCB0byBhbGxvdyBuZXdsaW5lcylcbiAgICAgIGlmIChcbiAgICAgICAgZS5rZXkgPT09IFwiRW50ZXJcIiAmJlxuICAgICAgICAhZS5pc0NvbXBvc2luZyAmJlxuICAgICAgICAhZS5zaGlmdEtleSAmJlxuICAgICAgICBlLnRhcmdldCAhPT0gdGhpcy50ZXh0QXJlYVxuICAgICAgKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlU2F2ZSgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUNhbmNlbCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcmVzZXRCdXR0b25zKCkge1xuICAgIGlmICghdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIpIHJldHVybjtcblxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICBjb25zdCBwcmVzZXRzID0gW1xuICAgICAgLi4udGhpcy5zeXN0ZW1Qcm9tcHRzLFxuICAgICAgLi4uKCF0aGlzLnN5c3RlbVByb21wdHMuc29tZShwID0+IHAuaWQgPT09IFwiY3VzdG9tXCIpID8gW3tcbiAgICAgICAgaWQ6IFwiY3VzdG9tXCIsXG4gICAgICAgIGxhYmVsOiBcIkN1c3RvbVwiLFxuICAgICAgICBpc1VzZXJDb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIHN5c3RlbVByb21wdDogdGhpcy5jdXJyZW50UHJvbXB0IHx8IFwiXCJcbiAgICAgIH1dIDogW10pXG4gICAgXTtcblxuICAgIHByZXNldHMuZm9yRWFjaChwcmVzZXQgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBwcmVzZXQubGFiZWwsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiXG4gICAgICB9KTtcblxuICAgICAgaWYgKHByZXNldC5sYWJlbCA9PT0gdGhpcy5hY3RpdmVQcmVzZXQpIHtcbiAgICAgICAgYnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB0aGlzLnVwZGF0ZVVJRm9yUHJlc2V0KHByZXNldCk7XG4gICAgICB9XG5cbiAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLnN5c3RlbXNjdWxwdC1wcmVzZXQtYnV0dG9uXCIpXG4gICAgICAgICAgLmZvckVhY2goYnRuID0+IGJ0bi5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKSk7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBwcmVzZXQubGFiZWw7XG4gICAgICAgIHRoaXMudXBkYXRlVUlGb3JQcmVzZXQocHJlc2V0KTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVVJRm9yUHJlc2V0KHByZXNldDogU3lzdGVtUHJvbXB0UHJlc2V0KSB7XG4gICAgaWYgKHByZXNldC5sYWJlbCA9PT0gXCJDdXN0b21cIikge1xuICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICB0aGlzLmN1c3RvbUlucHV0LmZvY3VzKCk7XG4gICAgICB0aGlzLnRleHRBcmVhLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAvLyBPbmx5IHNldCBjdXN0b21JbnB1dCBpZiB3ZSBoYXZlIGEgdmFsaWQgY3VzdG9tUHJvbXB0RmlsZVBhdGggYW5kIGl0IGhhc24ndCBiZWVuIHNldCB5ZXRcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY3VzdG9tUHJvbXB0RmlsZVBhdGggJiYgIXRoaXMuY3VzdG9tSW5wdXQudmFsdWUpIHtcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dC52YWx1ZSA9IHRoaXMub3B0aW9ucy5jdXN0b21Qcm9tcHRGaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcbiAgICAgIH1cbiAgICAgIC8vIEtlZXAgY3VycmVudCBwcm9tcHQgZm9yIGN1c3RvbSBwcmVzZXRcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQgfHwgXCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXN0b21TZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9ICFwcmVzZXQuaXNVc2VyQ29uZmlndXJhYmxlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZFN5c3RlbVByb21wdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHByb21wdHMgPSBhd2FpdCB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0cygpO1xuICAgICAgdGhpcy5yZW5kZXJQcm9tcHRzKHByb21wdHMpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0czpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBpZiAodGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucmVzb2x2ZVByb21pc2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UodGhpcy5yZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9wZW5BbmRHZXRWYWx1ZSgpOiBQcm9taXNlPERlZmF1bHRTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJQcm9tcHRzKHByb21wdHM6IFN5c3RlbVByb21wdFByZXNldFtdKSB7XG4gICAgaWYgKCF0aGlzLnByb21wdHNDb250YWluZXIpIHtcbiAgICAgIHRoaXMucHJvbXB0c0NvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1wcm9tcHRzLWNvbnRhaW5lclwiKTtcbiAgICB9XG4gICAgdGhpcy5wcm9tcHRzQ29udGFpbmVyLmVtcHR5KCk7XG4gICAgXG4gICAgcHJvbXB0cy5mb3JFYWNoKChwcm9tcHQ6IFN5c3RlbVByb21wdFByZXNldCkgPT4ge1xuICAgICAgY29uc3QgcHJvbXB0RWwgPSB0aGlzLnByb21wdHNDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXByb21wdC1pdGVtXCIpO1xuICAgICAgcHJvbXB0RWwuc2V0VGV4dChwcm9tcHQubGFiZWwpO1xuICAgICAgcHJvbXB0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50UHJvbXB0ID0gcHJvbXB0LnN5c3RlbVByb21wdDtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGhpZGVMb2FkaW5nKCkge1xuICAgIGlmICh0aGlzLmxvYWRpbmdJbmRpY2F0b3IpIHtcbiAgICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG93RXJyb3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLmNvbnRlbnRDb250YWluZXIpIHJldHVybjtcbiAgICBcbiAgICB0aGlzLnNob3dMb2FkaW5nKGZhbHNlKTtcbiAgICBjb25zdCBlcnJvckVsID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1lcnJvci1tZXNzYWdlXCIpO1xuICAgIGVycm9yRWwuc2V0VGV4dChtZXNzYWdlKTtcbiAgICBcbiAgICAvLyBBZGQgcmV0cnkgYnV0dG9uXG4gICAgY29uc3QgcmV0cnlCdXR0b24gPSBlcnJvckVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiUmV0cnlcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIlxuICAgIH0pO1xuICAgIHJldHJ5QnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICBlcnJvckVsLnJlbW92ZSgpO1xuICAgICAgdGhpcy5zaG93TG9hZGluZyh0cnVlKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFN5c3RlbVByb21wdHMoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZXRyeSBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2hvd0RlZmF1bHRTeXN0ZW1Qcm9tcHRNb2RhbChcbiAgYXBwOiBBcHAsXG4gIGN1cnJlbnRQcm9tcHQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IFBhcnRpYWw8RGVmYXVsdFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucz5cbik6IFByb21pc2U8RGVmYXVsdFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IERlZmF1bHRTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnMgPSB7XG4gICAgc3lzdGVtUHJvbXB0c0RpcmVjdG9yeTogXCJTeXN0ZW1TY3VscHQvU3lzdGVtIFByb21wdHNcIixcbiAgfTtcblxuICBjb25zdCBtb2RhbCA9IG5ldyBEZWZhdWx0U3lzdGVtUHJvbXB0TW9kYWwoYXBwLCB7XG4gICAgLi4uZGVmYXVsdE9wdGlvbnMsXG4gICAgLi4ub3B0aW9ucyxcbiAgfSk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xuXG4gIGlmIChyZXN1bHQgIT09IG51bGwgJiYgb3B0aW9ucz8ub25TYXZlKSB7XG4gICAgYXdhaXQgb3B0aW9ucy5vblNhdmUocmVzdWx0LmNvbnRlbnQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn0gIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdE1vZGVsIH0gZnJvbSBcIi4uL3R5cGVzL2xsbVwiO1xuaW1wb3J0IHtcbiAgU2VhcmNoU2VydmljZSxcbiAgU2VhcmNoTWF0Y2gsXG4gIFNlYXJjaFJlc3VsdCxcbiAgU2VhcmNoYWJsZUZpZWxkLFxufSBmcm9tIFwiLi4vc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25IZWxwZXIgfSBmcm9tIFwiLi9Nb2RlbFNlbGVjdGlvbkhlbHBlclwiO1xuaW1wb3J0IHsgQ3VzdG9tUHJvdmlkZXJNYW5hZ2VyTW9kYWwgfSBmcm9tIFwiLi9DdXN0b21Qcm92aWRlck1vZGFsXCI7XG5pbXBvcnQgeyBQQVRSRU9OX1VSTCB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgTW9kZWxTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBhbGxNb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcbiAgcHJpdmF0ZSBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBvblNlbGVjdDogKG1vZGVsSWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBtb2RlbEdyaWQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2U7XG4gIHByaXZhdGUgc2VsZWN0ZWRDYXJkSW5kZXg6IG51bWJlciA9IC0xO1xuICBwcml2YXRlIG1vZGVsQ2FyZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgaXNDbG9zaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgaGVscGVyOiBNb2RlbFNlbGVjdGlvbkhlbHBlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBjdXJyZW50TW9kZWxJZDogc3RyaW5nLFxuICAgIG9uU2VsZWN0OiAobW9kZWxJZDogc3RyaW5nKSA9PiB2b2lkLFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBjdXJyZW50TW9kZWxJZDtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5sb2dnZXIgPSBjb25zb2xlO1xuICAgIHRoaXMuaGVscGVyID0gbmV3IE1vZGVsU2VsZWN0aW9uSGVscGVyKHBsdWdpbik7XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1tb2RlbC1zZWxlY3Rpb24tbW9kYWxcIik7XG5cbiAgICAgIC8vIENyZWF0ZSBVSSBlbGVtZW50c1xuICAgICAgdGhpcy5jcmVhdGVTZWFyY2hVSSgpO1xuICAgICAgdGhpcy5jcmVhdGVNb2RlbEdyaWQoKTtcbiAgICAgIHRoaXMuc2V0dXBTZWFyY2goKTtcblxuICAgICAgLy8gU2hvdyBsb2FkaW5nIHN0YXRlXG4gICAgICBjb25zdCBsb2FkaW5nQ29udGFpbmVyID0gdGhpcy5tb2RlbEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1sb2FkaW5nLWNvbnRhaW5lclwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBsb2FkaW5nU3Bpbm5lciA9IGxvYWRpbmdDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1sb2FkaW5nLXNwaW5uZXJcIixcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihsb2FkaW5nU3Bpbm5lciwgXCJsb2FkZXItMlwiKTtcbiAgICAgIGxvYWRpbmdDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1sb2FkaW5nLXRleHRcIixcbiAgICAgICAgdGV4dDogXCJMb2FkaW5nIG1vZGVscy4uLlwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVzZSB0aGUgcGx1Z2luJ3MgaW5pdGlhbCBtb2RlbHMgcHJvbWlzZVxuICAgICAgdGhpcy5hbGxNb2RlbHMgPSBhd2FpdCB0aGlzLnBsdWdpbi5nZXRJbml0aWFsTW9kZWxzKCk7XG5cbiAgICAgIC8vIEluaXRpYWwgcmVuZGVyXG4gICAgICB0aGlzLnJlbmRlck1vZGVscyh0aGlzLmdldFZpc2libGVNb2RlbHMoKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiTW9kZWxTZWxlY3Rpb25Nb2RhbDogRXJyb3IgaW4gb25PcGVuXCIsIGVycm9yKTtcbiAgICAgIHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXJyb3ItbWVzc2FnZVwiLFxuICAgICAgICB0ZXh0OiBcIkVycm9yIGxvYWRpbmcgbW9kZWwgc2VsZWN0aW9uIG1vZGFsXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFZpc2libGVNb2RlbHMoKTogU2VhcmNoUmVzdWx0PFN5c3RlbVNjdWxwdE1vZGVsPltdIHtcbiAgICAvLyBJZiB0aGVyZSdzIG5vIHNlYXJjaCBxdWVyeSwganVzdCByZXR1cm4gdGhlbSBhbGwgc29ydGVkIGJ5IHByb3ZpZGVyXG4gICAgaWYgKCF0aGlzLnNlYXJjaElucHV0IHx8ICF0aGlzLnNlYXJjaElucHV0LnZhbHVlLnRyaW0oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuYWxsTW9kZWxzLm1hcCgobSkgPT4gKHsgaXRlbTogbSwgbWF0Y2hlczogW10sIHNjb3JlOiAwIH0pKTtcbiAgICB9XG5cbiAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQudmFsdWUudHJpbSgpO1xuXG4gICAgLy8gQXBwbHkgc2VhcmNoIGFuZCBmaWx0ZXJcbiAgICBjb25zdCByZXN1bHRzID0gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaChcbiAgICAgIHRoaXMuYWxsTW9kZWxzLFxuICAgICAgcXVlcnksXG4gICAgICAobW9kZWwpID0+IHRoaXMuZ2V0U2VhcmNoYWJsZUZpZWxkcyhtb2RlbCksXG4gICAgICB7XG4gICAgICAgIGluaXRpYWxSZXN1bHRzTGltaXQ6IDI1LFxuICAgICAgICBtYXhGaWx0ZXJlZFJlc3VsdHM6IDUwLFxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBGaWx0ZXIgb3V0IHJlc3VsdHMgd2l0aCBubyBtYXRjaGVzIG9yIGxvdyBzY29yZXNcbiAgICBjb25zdCBmaWx0ZXJlZFJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihcbiAgICAgIChyZXN1bHQpID0+IHJlc3VsdC5tYXRjaGVzLmxlbmd0aCA+IDAgJiYgcmVzdWx0LnNjb3JlID4gMFxuICAgICk7XG5cbiAgICAvLyBTb3J0IHJlc3VsdHMgYnkgc2NvcmVcbiAgICByZXR1cm4gZmlsdGVyZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VhcmNoYWJsZUZpZWxkcyA9IChcbiAgICBtb2RlbDogU3lzdGVtU2N1bHB0TW9kZWxcbiAgKTogU2VhcmNoYWJsZUZpZWxkW10gPT4ge1xuICAgIHJldHVybiBbXG4gICAgICB7IGZpZWxkOiBcIm5hbWVcIiwgdGV4dDogbW9kZWwubmFtZSwgd2VpZ2h0OiAyMDAgfSxcbiAgICAgIC4uLm1vZGVsLm5hbWUuc3BsaXQoL1tcXHNcXC06XFwuXSsvKS5tYXAoKHBhcnQpID0+ICh7XG4gICAgICAgIGZpZWxkOiBcIm5hbWVcIixcbiAgICAgICAgdGV4dDogcGFydCxcbiAgICAgICAgd2VpZ2h0OiAxNTAsXG4gICAgICB9KSksXG4gICAgICAuLi4obW9kZWwucHJvdmlkZXIgPT09IFwiY3VzdG9tXCJcbiAgICAgICAgPyBbeyBmaWVsZDogXCJwcm92aWRlclwiLCB0ZXh0OiBtb2RlbC5pZC5zcGxpdChcIi1cIilbMF0sIHdlaWdodDogMTgwIH1dXG4gICAgICAgIDogW10pLFxuICAgICAgeyBmaWVsZDogXCJkZXNjcmlwdGlvblwiLCB0ZXh0OiBtb2RlbC5kZXNjcmlwdGlvbiB8fCBcIlwiLCB3ZWlnaHQ6IDUwIH0sXG4gICAgXTtcbiAgfTtcblxuICBwcml2YXRlIGNyZWF0ZVNlYXJjaFVJKCkge1xuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlYXJjaC1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBzZWFyY2ggaW5wdXRcbiAgICB0aGlzLnNlYXJjaElucHV0ID0gc2VhcmNoQ29udGFpbmVyLmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2ggbW9kZWxzLi4uXCIsXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlYXJjaC1pbnB1dFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVycyBidXR0b25cbiAgICBjb25zdCBwcm92aWRlcnNCdXR0b24gPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlcnMtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihwcm92aWRlcnNCdXR0b24uY3JlYXRlU3BhbigpLCBcInNldHRpbmdzXCIpO1xuICAgIHByb3ZpZGVyc0J1dHRvbi5jcmVhdGVTcGFuKHsgdGV4dDogXCJQcm92aWRlcnNcIiB9KTtcblxuICAgIHByb3ZpZGVyc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG5cbiAgICAgIC8vIE9wZW4gY3VzdG9tIHByb3ZpZGVyIG1hbmFnZXIgbW9kYWxcbiAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgLy8gT24gYmFja1xuICAgICAgICAgIGNvbnN0IG1vZGVsU2VsZWN0aW9uTW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICB0aGlzLm9uU2VsZWN0LFxuICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICApO1xuICAgICAgICAgIG1vZGVsU2VsZWN0aW9uTW9kYWwub3BlbigpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTW9kZWxHcmlkKCkge1xuICAgIHRoaXMubW9kZWxHcmlkID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZ3JpZFwiLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cFNlYXJjaCgpIHtcbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5nZXRWaXNpYmxlTW9kZWxzKCk7XG4gICAgICB0aGlzLnJlbmRlck1vZGVscyhyZXN1bHRzKTtcbiAgICB9KTtcblxuICAgIC8vIEtleWJvYXJkIG5hdlxuICAgIHRoaXMuY29udGVudEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPVxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA8PSAwXG4gICAgICAgICAgICAgID8gdGhpcy5tb2RlbENhcmRzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgOiB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4IC0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPj0gdGhpcy5tb2RlbENhcmRzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgIDogdGhpcy5zZWxlY3RlZENhcmRJbmRleCArIDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2RlbENhcmRzLmZvckVhY2goKGNhcmQsIGkpID0+IHtcbiAgICAgICAgICBjb25zdCBpc1NlbGVjdGVkID0gaSA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleDtcbiAgICAgICAgICBjYXJkLmNsYXNzTGlzdC50b2dnbGUoXCJzeXN0ZW1zY3VscHQta2V5Ym9hcmQtc2VsZWN0ZWRcIiwgaXNTZWxlY3RlZCk7XG4gICAgICAgICAgaWYgKGlzU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIGNhcmQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogXCJzbW9vdGhcIiwgYmxvY2s6IFwibmVhcmVzdFwiIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQuZm9jdXMoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBjb25zdCBoaWdobGlnaHRlZENhcmQgPSB0aGlzLm1vZGVsQ2FyZHNbdGhpcy5zZWxlY3RlZENhcmRJbmRleF07XG4gICAgICAgIGlmIChoaWdobGlnaHRlZENhcmQpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgY29uc3QgbW9kZWxJZCA9IGhpZ2hsaWdodGVkQ2FyZC5kYXRhc2V0Lm1vZGVsSWQ7XG4gICAgICAgICAgaWYgKG1vZGVsSWQpIHtcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QobW9kZWxJZCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBQYXNzaXZlIHNjcm9sbC90b3VjaFxuICAgIHRoaXMubW9kZWxHcmlkPy5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJ3aGVlbFwiLFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvLyBqdXN0IGEgbm8tb3BcbiAgICAgIH0sXG4gICAgICB7IHBhc3NpdmU6IHRydWUgfVxuICAgICk7XG4gICAgdGhpcy5tb2RlbEdyaWQ/LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsICgpID0+IHt9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG4gICAgdGhpcy5tb2RlbEdyaWQ/LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgKCkgPT4ge30sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXJzIGFsbCBjdXJyZW50bHkgdmlzaWJsZSBtb2RlbHMgYnV0IGluIDIgc2ltcGxlIHNlY3Rpb25zOlxuICAgKiAtIFN5c3RlbVNjdWxwdCBtb2RlbHNcbiAgICogLSBDdXN0b20gcHJvdmlkZXIgbW9kZWxzXG4gICAqL1xuICBwcml2YXRlIHJlbmRlck1vZGVscyhzZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8U3lzdGVtU2N1bHB0TW9kZWw+W10pIHtcbiAgICBpZiAoIXRoaXMubW9kZWxHcmlkKSByZXR1cm47XG5cbiAgICB0aGlzLm1vZGVsR3JpZC5lbXB0eSgpO1xuICAgIHRoaXMubW9kZWxDYXJkcyA9IFtdO1xuXG4gICAgLy8gQ3JlYXRlIGEgbG9va3VwIGZvciBzZWFyY2hNYXRjaGVzXG4gICAgY29uc3Qgc3JNYXAgPSBuZXcgTWFwKFxuICAgICAgc2VhcmNoUmVzdWx0cy5tYXAoKHNyKSA9PiBbc3IuaXRlbS5pZCwgc3IubWF0Y2hlcyB8fCBbXV0pXG4gICAgKTtcblxuICAgIC8vIENoZWNrIGxpY2Vuc2Ugc3RhdHVzIG9uY2VcbiAgICBjb25zdCBoYXNWYWxpZExpY2Vuc2UgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5Py50cmltKCk7XG5cbiAgICAvLyBGaXJzdCwgc2VwYXJhdGUgZmF2b3JpdGVzIGZyb20gb3RoZXIgbW9kZWxzXG4gICAgY29uc3QgZmF2b3JpdGVzOiBTeXN0ZW1TY3VscHRNb2RlbFtdID0gW107XG4gICAgY29uc3Qgbm9uRmF2b3JpdGVzOiBTeXN0ZW1TY3VscHRNb2RlbFtdID0gW107XG5cbiAgICAvLyBPbmx5IHByb2Nlc3MgbW9kZWxzIHRoYXQgYXJlIGluIG91ciBzZWFyY2ggcmVzdWx0c1xuICAgIGNvbnN0IHZpc2libGVNb2RlbHMgPSBzZWFyY2hSZXN1bHRzLm1hcCgoc3IpID0+IHNyLml0ZW0pO1xuICAgIHZpc2libGVNb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgIC8vIFNraXAgU3lzdGVtU2N1bHB0IG1vZGVscyBpZiBubyB2YWxpZCBsaWNlbnNlXG4gICAgICBpZiAoIWhhc1ZhbGlkTGljZW5zZSAmJiBtb2RlbC5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChtb2RlbC5pc0Zhdm9yaXRlKSB7XG4gICAgICAgIGZhdm9yaXRlcy5wdXNoKG1vZGVsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vbkZhdm9yaXRlcy5wdXNoKG1vZGVsKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJlbmRlciBmYXZvcml0ZXMgc2VjdGlvbiBpZiB0aGVyZSBhcmUgYW55IGZhdm9yaXRlc1xuICAgIGlmIChmYXZvcml0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gQWRkIGZhdm9yaXRlcyBoZWFkZXJcbiAgICAgIGNvbnN0IGhlYWRlciA9IHRoaXMubW9kZWxHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIsXG4gICAgICB9KTtcbiAgICAgIGhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogXCJGYXZvcml0ZXNcIiB9KTtcblxuICAgICAgLy8gU29ydCBmYXZvcml0ZXM6IFN5c3RlbVNjdWxwdCBmaXJzdCwgdGhlbiBieSBwcm92aWRlciBhbmQgbmFtZVxuICAgICAgZmF2b3JpdGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgLy8gU3lzdGVtU2N1bHB0IG1vZGVscyBjb21lIGZpcnN0XG4gICAgICAgIGlmIChhLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiICYmIGIucHJvdmlkZXIgIT09IFwic3lzdGVtc2N1bHB0XCIpXG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICBpZiAoYS5wcm92aWRlciAhPT0gXCJzeXN0ZW1zY3VscHRcIiAmJiBiLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiKVxuICAgICAgICAgIHJldHVybiAxO1xuXG4gICAgICAgIC8vIFRoZW4gc29ydCBieSBwcm92aWRlclxuICAgICAgICBpZiAoYS5wcm92aWRlciAhPT0gYi5wcm92aWRlcikge1xuICAgICAgICAgIHJldHVybiBhLnByb3ZpZGVyLmxvY2FsZUNvbXBhcmUoYi5wcm92aWRlcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5hbGx5IHNvcnQgYnkgbmFtZVxuICAgICAgICByZXR1cm4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBSZW5kZXIgZmF2b3JpdGUgbW9kZWxzXG4gICAgICBmYXZvcml0ZXMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChtb2RlbC5pZCkgfHwgW107XG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLnJlbmRlck1vZGVsQ2FyZChtb2RlbCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5tb2RlbEdyaWQuYXBwZW5kQ2hpbGQoY2FyZCk7XG4gICAgICAgICAgdGhpcy5tb2RlbENhcmRzLnB1c2goY2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEdyb3VwIHJlbWFpbmluZyBtb2RlbHMgYnkgcHJvdmlkZXJcbiAgICBjb25zdCBtb2RlbHNCeVByb3ZpZGVyID0gbmV3IE1hcDxzdHJpbmcsIFN5c3RlbVNjdWxwdE1vZGVsW10+KCk7XG4gICAgbm9uRmF2b3JpdGVzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IG1vZGVsLnByb3ZpZGVyO1xuICAgICAgaWYgKCFtb2RlbHNCeVByb3ZpZGVyLmhhcyhwcm92aWRlcikpIHtcbiAgICAgICAgbW9kZWxzQnlQcm92aWRlci5zZXQocHJvdmlkZXIsIFtdKTtcbiAgICAgIH1cbiAgICAgIG1vZGVsc0J5UHJvdmlkZXIuZ2V0KHByb3ZpZGVyKT8ucHVzaChtb2RlbCk7XG4gICAgfSk7XG5cbiAgICAvLyBBbHdheXMgc2hvdyBTeXN0ZW1TY3VscHQgc2VjdGlvbiBmaXJzdFxuICAgIGNvbnN0IHN5c3RlbXNjdWxwdEhlYWRlciA9IHRoaXMubW9kZWxHcmlkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiLFxuICAgIH0pO1xuICAgIHN5c3RlbXNjdWxwdEhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogXCJTeXN0ZW1TY3VscHQgTW9kZWxzXCIgfSk7XG5cbiAgICAvLyBTaG93IHBybyBpbmZvIG1lc3NhZ2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSB2YWxpZCBsaWNlbnNlIGFuZCB0aGVyZSBhcmUgU3lzdGVtU2N1bHB0IG1vZGVsc1xuICAgIGlmIChcbiAgICAgICFoYXNWYWxpZExpY2Vuc2UgJiZcbiAgICAgIHNlYXJjaFJlc3VsdHMuc29tZSgoc3IpID0+IHNyLml0ZW0ucHJvdmlkZXIgPT09IFwic3lzdGVtc2N1bHB0XCIpXG4gICAgKSB7XG4gICAgICB0aGlzLmNyZWF0ZVByb0luZm9NZXNzYWdlKHRoaXMubW9kZWxHcmlkKTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIFN5c3RlbVNjdWxwdCBtb2RlbHMgYW5kIGEgdmFsaWQgbGljZW5zZSwgc2hvdyB0aGVtXG4gICAgaWYgKGhhc1ZhbGlkTGljZW5zZSAmJiBtb2RlbHNCeVByb3ZpZGVyLmhhcyhcInN5c3RlbXNjdWxwdFwiKSkge1xuICAgICAgY29uc3Qgc3lzdGVtc2N1bHB0TW9kZWxzID0gbW9kZWxzQnlQcm92aWRlci5nZXQoXCJzeXN0ZW1zY3VscHRcIikgfHwgW107XG4gICAgICBjb25zdCBzb3J0ZWRTeXN0ZW1zY3VscHRNb2RlbHMgPSBzeXN0ZW1zY3VscHRNb2RlbHMuc29ydCgoYSwgYikgPT5cbiAgICAgICAgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKVxuICAgICAgKTtcblxuICAgICAgc29ydGVkU3lzdGVtc2N1bHB0TW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBzck1hcC5nZXQobW9kZWwuaWQpIHx8IFtdO1xuICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5yZW5kZXJNb2RlbENhcmQobW9kZWwsIG1hdGNoZXMpO1xuICAgICAgICBpZiAoY2FyZCkge1xuICAgICAgICAgIHRoaXMubW9kZWxHcmlkLmFwcGVuZENoaWxkKGNhcmQpO1xuICAgICAgICAgIHRoaXMubW9kZWxDYXJkcy5wdXNoKGNhcmQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgU3lzdGVtU2N1bHB0IGZyb20gdGhlIG1hcCBzaW5jZSB3ZSd2ZSBoYW5kbGVkIGl0XG4gICAgbW9kZWxzQnlQcm92aWRlci5kZWxldGUoXCJzeXN0ZW1zY3VscHRcIik7XG5cbiAgICAvLyBSZW5kZXIgcmVtYWluaW5nIHByb3ZpZGVyc1xuICAgIGNvbnN0IHNvcnRlZFByb3ZpZGVycyA9IEFycmF5LmZyb20obW9kZWxzQnlQcm92aWRlci5rZXlzKCkpLnNvcnQoKGEsIGIpID0+XG4gICAgICBhLmxvY2FsZUNvbXBhcmUoYilcbiAgICApO1xuXG4gICAgLy8gUmVuZGVyIGVhY2ggcmVtYWluaW5nIHByb3ZpZGVyIHNlY3Rpb25cbiAgICBzb3J0ZWRQcm92aWRlcnMuZm9yRWFjaCgocHJvdmlkZXIpID0+IHtcbiAgICAgIGNvbnN0IG1vZGVscyA9IG1vZGVsc0J5UHJvdmlkZXIuZ2V0KHByb3ZpZGVyKSB8fCBbXTtcblxuICAgICAgLy8gU2tpcCBlbXB0eSBwcm92aWRlcnNcbiAgICAgIGlmIChtb2RlbHMubGVuZ3RoID09PSAwKSByZXR1cm47XG5cbiAgICAgIC8vIFNvcnQgbW9kZWxzIGFscGhhYmV0aWNhbGx5XG4gICAgICBjb25zdCBzb3J0ZWRNb2RlbHMgPSBtb2RlbHMuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG5cbiAgICAgIC8vIEFkZCBwcm92aWRlciBoZWFkZXJcbiAgICAgIGNvbnN0IGhlYWRlciA9IHRoaXMubW9kZWxHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHByb3ZpZGVyTmFtZSA9IGAke1xuICAgICAgICBwcm92aWRlci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb3ZpZGVyLnNsaWNlKDEpXG4gICAgICB9IE1vZGVsc2A7XG4gICAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IHByb3ZpZGVyTmFtZSB9KTtcblxuICAgICAgLy8gUmVuZGVyIG1vZGVscyBmb3IgdGhpcyBwcm92aWRlclxuICAgICAgc29ydGVkTW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBzck1hcC5nZXQobW9kZWwuaWQpIHx8IFtdO1xuICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5yZW5kZXJNb2RlbENhcmQobW9kZWwsIG1hdGNoZXMpO1xuICAgICAgICBpZiAoY2FyZCkge1xuICAgICAgICAgIHRoaXMubW9kZWxHcmlkLmFwcGVuZENoaWxkKGNhcmQpO1xuICAgICAgICAgIHRoaXMubW9kZWxDYXJkcy5wdXNoKGNhcmQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIElmIG5vIGNhcmRzIGF0IGFsbCwgc2hvdyBhcHByb3ByaWF0ZSBtZXNzYWdlIGJhc2VkIG9uIGNvbnRleHRcbiAgICBpZiAodGhpcy5tb2RlbENhcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlKSB7XG4gICAgICAgIC8vIElmIHRoZXJlJ3MgYSBzZWFyY2ggcXVlcnksIHNob3cgdGhlIG5vIHJlc3VsdHMgY2FyZFxuICAgICAgICBjb25zdCBub1Jlc3VsdHNDYXJkID0gdGhpcy5yZW5kZXJOb1Jlc3VsdHNDYXJkKCk7XG4gICAgICAgIHRoaXMubW9kZWxHcmlkLmFwcGVuZENoaWxkKG5vUmVzdWx0c0NhcmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgdGhlcmUncyBubyBzZWFyY2ggcXVlcnkgYW5kIG5vIG1vZGVscywgc2hvdyB0aGUgY3VzdG9tIHByb3ZpZGVyIGluZm9cbiAgICAgICAgdGhpcy5jcmVhdGVDdXN0b21Qcm92aWRlckluZm9NZXNzYWdlKHRoaXMubW9kZWxHcmlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlck5vUmVzdWx0c0NhcmQoKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWNhcmRcIiB9KTtcblxuICAgIGNvbnN0IGljb25zQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb25zXCIgfSk7XG4gICAgY29uc3Qgc2VhcmNoSWNvbiA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LXByaWNpbmctbG93XCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihzZWFyY2hJY29uLCBcInNlYXJjaFwiKTtcblxuICAgIGNvbnN0IG5hbWVDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW5hbWUtY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgbmFtZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1uYW1lXCIsXG4gICAgICB0ZXh0OiBcIk5vIG1vZGVscyBmb3VuZFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRlc2NyaXB0aW9uXCIsXG4gICAgICB0ZXh0OiBcIk5vIG1vZGVscyBtYXRjaCB5b3VyIGN1cnJlbnQgc2VhcmNoIGNyaXRlcmlhLiBDbGljayBoZXJlIHRvIHJlc2V0IGFsbCBmaWx0ZXJzLlwiLFxuICAgIH0pO1xuXG4gICAgY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRldGFpbHNcIiB9KTtcblxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNlYXJjaElucHV0KSB7XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW5kZXJNb2RlbHMoXG4gICAgICAgIHRoaXMuYWxsTW9kZWxzLm1hcCgobSkgPT4gKHsgaXRlbTogbSwgbWF0Y2hlczogW10sIHNjb3JlOiAwIH0pKVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBjYXJkO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJNb2RlbENhcmQoXG4gICAgbW9kZWw6IFN5c3RlbVNjdWxwdE1vZGVsLFxuICAgIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10gPSBbXVxuICApOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY2FyZC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1tb2RlbC1jYXJkXCI7XG4gICAgaWYgKG1vZGVsLnByb3ZpZGVyICE9PSBcInN5c3RlbXNjdWxwdFwiKSB7XG4gICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLW1vZGVsLWNhcmRcIik7XG4gICAgfVxuICAgIGNhcmQuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCIwXCIpO1xuICAgIGNhcmQuZGF0YXNldC5tb2RlbElkID0gbW9kZWwuaWQ7XG5cbiAgICAvLyBGYXZvcml0ZSBzdGFyXG4gICAgY29uc3QgZmF2b3JpdGVCdXR0b24gPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IGBzeXN0ZW1zY3VscHQtZmF2b3JpdGUtYnV0dG9uICR7XG4gICAgICAgIG1vZGVsLmlzRmF2b3JpdGUgPyBcImlzLWZhdm9yaXRlXCIgOiBcIlwiXG4gICAgICB9YCxcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgXCJhcmlhLWxhYmVsXCI6IG1vZGVsLmlzRmF2b3JpdGVcbiAgICAgICAgICA/IFwiUmVtb3ZlIGZyb20gZmF2b3JpdGVzXCJcbiAgICAgICAgICA6IFwiQWRkIHRvIGZhdm9yaXRlc1wiLFxuICAgICAgICByb2xlOiBcImJ1dHRvblwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKGZhdm9yaXRlQnV0dG9uLCBcInN0YXJcIik7XG5cbiAgICAvLyBGYXZvcml0ZSB0b2dnbGVcbiAgICBmYXZvcml0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBjb25zdCBpc0Zhdm9yaXRlID0gIW1vZGVsLmlzRmF2b3JpdGU7XG4gICAgICBtb2RlbC5pc0Zhdm9yaXRlID0gaXNGYXZvcml0ZTtcblxuICAgICAgZmF2b3JpdGVCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImlzLWZhdm9yaXRlXCIsIGlzRmF2b3JpdGUpO1xuICAgICAgZmF2b3JpdGVCdXR0b24uc2V0QXR0cmlidXRlKFxuICAgICAgICBcImFyaWEtbGFiZWxcIixcbiAgICAgICAgaXNGYXZvcml0ZSA/IFwiUmVtb3ZlIGZyb20gZmF2b3JpdGVzXCIgOiBcIkFkZCB0byBmYXZvcml0ZXNcIlxuICAgICAgKTtcblxuICAgICAgLy8gRW5zdXJlIGFycmF5XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMpKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzID0gW107XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBvciByZW1vdmUgZnJvbSBzZXR0aW5nc1xuICAgICAgaWYgKGlzRmF2b3JpdGUpIHtcbiAgICAgICAgY29uc3QgbmV3RmF2ID0geyBwcm92aWRlcjogbW9kZWwucHJvdmlkZXIsIG1vZGVsSWQ6IG1vZGVsLmlkIH07XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVNb2RlbHMuc29tZShcbiAgICAgICAgICAgIChmKSA9PiBmLm1vZGVsSWQgPT09IG1vZGVsLmlkICYmIGYucHJvdmlkZXIgPT09IG1vZGVsLnByb3ZpZGVyXG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5wdXNoKG5ld0Zhdik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzID1cbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5maWx0ZXIoXG4gICAgICAgICAgICAoZikgPT4gIShmLm1vZGVsSWQgPT09IG1vZGVsLmlkICYmIGYucHJvdmlkZXIgPT09IG1vZGVsLnByb3ZpZGVyKVxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblxuICAgICAgLy8gUmUtcmVuZGVyIHRvIG1vdmUgdGhlIG1vZGVsIHRvIGl0cyBuZXcgc2VjdGlvblxuICAgICAgdGhpcy5yZW5kZXJNb2RlbHModGhpcy5nZXRWaXNpYmxlTW9kZWxzKCkpO1xuICAgIH0pO1xuXG4gICAgLy8gUmVuZGVyIG1haW4gY29udGVudFxuICAgIGlmIChtb2RlbC5wcm92aWRlciAhPT0gXCJzeXN0ZW1zY3VscHRcIikge1xuICAgICAgLy8gSnVzdCBzaG93IG1vZGVsIG5hbWUgZm9yIGN1c3RvbSBwcm92aWRlcnNcbiAgICAgIGNvbnN0IG5hbWVDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLW1vZGVsLW5hbWUtY29udGFpbmVyXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9kZWxOYW1lID0gbmFtZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1tb2RlbC1uYW1lXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHByb3ZpZGVyIHByZWZpeCBpbiBicmFja2V0c1xuICAgICAgY29uc3QgcHJvdmlkZXJQcmVmaXggPSBgWyR7bW9kZWwucHJvdmlkZXIudG9VcHBlckNhc2UoKX1dIGA7XG4gICAgICBjb25zdCBuYW1lVGV4dCA9IHByb3ZpZGVyUHJlZml4ICsgbW9kZWwubmFtZTtcblxuICAgICAgbW9kZWxOYW1lLmFwcGVuZChcbiAgICAgICAgdGhpcy5oZWxwZXIuaGlnaGxpZ2h0VGV4dChuYW1lVGV4dCwgbWF0Y2hlcywgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWUpXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOb3JtYWwgc3lzdGVtIG1vZGVsIGNhcmRcbiAgICAgIGNvbnN0IGljb25zQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb25zXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gU2ltcGxlIGNvc3QgaW5kaWNhdG9yXG4gICAgICBjb25zdCBjb21wbGV0aW9uUHJpY2UgPSBwYXJzZUZsb2F0KG1vZGVsLnByaWNpbmcuY29tcGxldGlvbikgKiAxXzAwMF8wMDA7XG4gICAgICBjb25zdCBwcmljaW5nSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uXCIsXG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBcImFyaWEtbGFiZWxcIjogYEFwcHJveCB+JCR7Y29tcGxldGlvblByaWNlLnRvRml4ZWQoXG4gICAgICAgICAgICAyXG4gICAgICAgICAgKX0gcGVyIG1pbGxpb24gdG9rZW5zYCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgc2V0SWNvbihwcmljaW5nSW5kaWNhdG9yLCBcIndhbGxldFwiKTtcblxuICAgICAgLy8gY2FwYWJpbGl0eSBpY29uc1xuICAgICAgaWYgKG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJmYXN0XCIpKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LXNwZWVkLWluZGljYXRvclwiLFxuICAgICAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQmxhemluZyBmYXN0IHJlc3BvbnNlc1wiIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJY29uKHNwZWVkSW5kaWNhdG9yLCBcInphcFwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwicmVhc29uaW5nXCIpKSB7XG4gICAgICAgIGNvbnN0IHJlYXNvbkluZGljYXRvciA9IGljb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uIHN5c3RlbXNjdWxwdC1yZWFzb25pbmctaW5kaWNhdG9yXCIsXG4gICAgICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJDb21wbGV4IHJlYXNvbmluZ1wiIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJY29uKHJlYXNvbkluZGljYXRvciwgXCJicmFpblwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RlbC5jYXBhYmlsaXRpZXM/LmluY2x1ZGVzKFwiY3JlYXRpdmVcIikpIHtcbiAgICAgICAgY29uc3QgY3JlYXRpdmVJbmRpY2F0b3IgPSBpY29uc0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaWNvbiBzeXN0ZW1zY3VscHQtY3JlYXRpdmUtaW5kaWNhdG9yXCIsXG4gICAgICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJDcmVhdGl2ZSB3cml0aW5nXCIgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNldEljb24oY3JlYXRpdmVJbmRpY2F0b3IsIFwiYnJ1c2hcIik7XG4gICAgICB9XG4gICAgICBpZiAobW9kZWwuYXJjaGl0ZWN0dXJlPy5tb2RhbGl0eSA9PT0gXCJ0ZXh0K2ltYWdlLT50ZXh0XCIpIHtcbiAgICAgICAgY29uc3QgdmlzaW9uSW5kaWNhdG9yID0gaWNvbnNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWljb24gc3lzdGVtc2N1bHB0LXZpc2lvbi1pbmRpY2F0b3JcIixcbiAgICAgICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIlZpc2lvbi9pbWFnZSBpbnB1dFwiIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJY29uKHZpc2lvbkluZGljYXRvciwgXCJleWVcIik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5hbWVDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtbmFtZS1jb250YWluZXJcIixcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbW9kZWxOYW1lID0gbmFtZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW5hbWVcIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgcHJvdmlkZXIgcHJlZml4IGluIGJyYWNrZXRzIGZvciBTeXN0ZW1TY3VscHQgbW9kZWxzXG4gICAgICBjb25zdCBwcm92aWRlclByZWZpeCA9IFwiW1NZU1RFTVNDVUxQVF0gXCI7XG4gICAgICBjb25zdCBuYW1lVGV4dCA9IHByb3ZpZGVyUHJlZml4ICsgbW9kZWwubmFtZTtcblxuICAgICAgbW9kZWxOYW1lLmFwcGVuZChcbiAgICAgICAgdGhpcy5oZWxwZXIuaGlnaGxpZ2h0VGV4dChuYW1lVGV4dCwgbWF0Y2hlcywgdGhpcy5zZWFyY2hJbnB1dD8udmFsdWUpXG4gICAgICApO1xuXG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1kZXNjcmlwdGlvblwiLFxuICAgICAgfSk7XG4gICAgICBkZXNjcmlwdGlvbi5hcHBlbmQoXG4gICAgICAgIHRoaXMuaGVscGVyLmhpZ2hsaWdodFRleHQoXG4gICAgICAgICAgbW9kZWwuZGVzY3JpcHRpb24sXG4gICAgICAgICAgbWF0Y2hlcyxcbiAgICAgICAgICB0aGlzLnNlYXJjaElucHV0Py52YWx1ZVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBtb2RlbC5kZXNjcmlwdGlvbik7XG4gICAgICBkZXNjcmlwdGlvbi5hZGRDbGFzcyhcImhhcy10b29sdGlwXCIpO1xuXG4gICAgICBjb25zdCBkZXRhaWxzID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWRldGFpbHNcIiB9KTtcbiAgICAgIGNvbnN0IGNvbnRleHRMZW5ndGggPSBkZXRhaWxzLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtZGV0YWlsXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnRleHRMZW5ndGguY3JlYXRlU3Bhbih7XG4gICAgICAgIHRleHQ6IFwiQ29udGV4dDogXCIsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZGV0YWlsLWxhYmVsXCIsXG4gICAgICB9KTtcbiAgICAgIGNvbnRleHRMZW5ndGguY3JlYXRlU3Bhbih7XG4gICAgICAgIHRleHQ6IGAke21vZGVsLmNvbnRleHRfbGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHRva2Vuc2AsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZGV0YWlsLXZhbHVlXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlclxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIElmIGN1c3RvbSwgcGljayB0aGF0IGFzIHByb3ZpZGVyXG4gICAgICBjb25zdCBjdXN0b21Qcm92aWRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maW5kKFxuICAgICAgICAocCkgPT4gcC5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1vZGVsLnByb3ZpZGVyLnRvTG93ZXJDYXNlKClcbiAgICAgICk7XG4gICAgICBpZiAoY3VzdG9tUHJvdmlkZXIpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIgPSB7XG4gICAgICAgICAgaWQ6IGN1c3RvbVByb3ZpZGVyLmlkLFxuICAgICAgICAgIG5hbWU6IGN1c3RvbVByb3ZpZGVyLm5hbWUsXG4gICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyID0ge1xuICAgICAgICAgIGlkOiBcInN5c3RlbXNjdWxwdFwiLFxuICAgICAgICAgIG5hbWU6IFwiU3lzdGVtU2N1bHB0XCIsXG4gICAgICAgICAgdHlwZTogXCJuYXRpdmVcIixcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgdGhpcy5vblNlbGVjdChtb2RlbC5pZCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICAvLyBLZXlib2FyZCBuYXZcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMub25TZWxlY3QobW9kZWwuaWQpO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm1vZGVsQ2FyZHMuZm9yRWFjaCgoYykgPT5cbiAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpXG4gICAgICApO1xuICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNhcmQ7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIHRoaXMuaXNDbG9zaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyB5b3UgdG8gcHJvZ3JhbW1hdGljYWxseSBzZXQgbW9kZWxzIGlmIG5lZWRlZCAob2xkIHVzYWdlKS5cbiAgICovXG4gIHB1YmxpYyBzZXRNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogdm9pZCB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KG1vZGVscykpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiSW52YWxpZCBtb2RlbHMgZGF0YVwiLCB7IG1vZGVscyB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5hbGxNb2RlbHMgPSBtb2RlbHM7XG4gICAgaWYgKHRoaXMubW9kZWxHcmlkKSB7XG4gICAgICB0aGlzLnJlbmRlck1vZGVscyh0aGlzLmdldFZpc2libGVNb2RlbHMoKSk7XG4gICAgfVxuICB9XG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgcHJvLWluZm8gbWVzc2FnZVxuICBwcml2YXRlIGNyZWF0ZVByb0luZm9NZXNzYWdlKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBpbmZvRWwgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mb1wiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGljb24gY29udGFpbmVyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGluZm9FbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgXCJzcGFya2xlc1wiKTtcblxuICAgIC8vIENyZWF0ZSBtYWluIG1lc3NhZ2VcbiAgICBjb25zdCBtZXNzYWdlQ29udGFpbmVyID0gaW5mb0VsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLW1lc3NhZ2UtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tdGl0bGVcIixcbiAgICAgIHRleHQ6IFwiVW5sb2NrIFBybyBNb2RlbHNcIixcbiAgICB9KTtcblxuICAgIG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogXCJHZXQgaW5zdGFudCBhY2Nlc3MgdG8gbzMgTWluaSwgRGVlcFNlZWsgUjEsIGFuZCBvdGhlciBzdGF0ZS1vZi10aGUtYXJ0IG1vZGVscy4gQWx3YXlzIHVwIHRvIGRhdGUgc28geW91IGRvbid0IGhhdmUgdG8gZ3Vlc3Mgd2hpY2ggbW9kZWwgdG8gdXNlLlwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGJ1dHRvbiBjb250YWluZXJcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBtZXNzYWdlQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWluZm8tYnV0dG9uc1wiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGJ1dHRvblxuICAgIGNvbnN0IGFkZFByb3ZpZGVyQnRuID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5mby1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb25zdCBhZGRQcm92aWRlckljb24gPSBhZGRQcm92aWRlckJ0bi5jcmVhdGVTcGFuKCk7XG4gICAgc2V0SWNvbihhZGRQcm92aWRlckljb24sIFwicGx1c1wiKTtcbiAgICBhZGRQcm92aWRlckJ0bi5jcmVhdGVTcGFuKHsgdGV4dDogXCJBZGQgQSBQcm92aWRlclwiIH0pO1xuICAgIGFkZFByb3ZpZGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgY29uc3QgbWFuYWdlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTWFuYWdlck1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QsXG4gICAgICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICB9KTtcblxuICAgIC8vIEJlY29tZSBwYXRyb24gYnV0dG9uXG4gICAgY29uc3QgcGF0cm9uQnRuID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5mby1idXR0b24gbW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIGNvbnN0IHBhdHJvbkljb24gPSBwYXRyb25CdG4uY3JlYXRlU3BhbigpO1xuICAgIHNldEljb24ocGF0cm9uSWNvbiwgXCJoZWFydFwiKTtcbiAgICBwYXRyb25CdG4uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQmVjb21lIEEgUGF0cm9uXCIgfSk7XG4gICAgcGF0cm9uQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5mb0VsO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDdXN0b21Qcm92aWRlckluZm9NZXNzYWdlKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBpbmZvRWwgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mb1wiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGljb24gY29udGFpbmVyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGluZm9FbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pY29uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgXCJzZXJ2ZXJcIik7XG5cbiAgICAvLyBDcmVhdGUgbWFpbiBtZXNzYWdlXG4gICAgY29uc3QgbWVzc2FnZUNvbnRhaW5lciA9IGluZm9FbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1tZXNzYWdlLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmZvLXRpdGxlXCIsXG4gICAgICB0ZXh0OiBcIkFkZCBZb3VyIE93biBNb2RlbHNcIixcbiAgICB9KTtcblxuICAgIG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogXCJHZXQgc3RhcnRlZCBieSBhZGRpbmcgeW91ciBvd24gY3VzdG9tIHByb3ZpZGVyIGxpa2UgT2xsYW1hLCBMTSBTdHVkaW8sIG9yIE9wZW5BSS4gWW91IGNhbiB1c2UgeW91ciBvd24gbW9kZWxzIG9yIGNvbm5lY3QgdG8gb3RoZXIgQUkgc2VydmljZXMuXCIsXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgYnV0dG9uIGNvbnRhaW5lclxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IG1lc3NhZ2VDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kZWwtaW5mby1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgcHJvdmlkZXIgYnV0dG9uXG4gICAgY29uc3QgYWRkUHJvdmlkZXJCdG4gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbmZvLWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY29uc3QgYWRkUHJvdmlkZXJJY29uID0gYWRkUHJvdmlkZXJCdG4uY3JlYXRlU3BhbigpO1xuICAgIHNldEljb24oYWRkUHJvdmlkZXJJY29uLCBcInBsdXNcIik7XG4gICAgYWRkUHJvdmlkZXJCdG4uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQWRkIEEgUHJvdmlkZXJcIiB9KTtcbiAgICBhZGRQcm92aWRlckJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICB0aGlzLm9uU2VsZWN0LFxuICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICApO1xuICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIG1hbmFnZXJNb2RhbC5vcGVuKCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5mb0VsO1xuICB9XG59XG4iLCAiZXhwb3J0IGludGVyZmFjZSBTZWFyY2hhYmxlRmllbGQge1xuICBmaWVsZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkO1xuICB3ZWlnaHQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hNYXRjaCB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgaW5kaWNlczogbnVtYmVyW107XG4gIG1hdGNoUXVhbGl0eTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFJlc3VsdDxUPiB7XG4gIGl0ZW06IFQ7XG4gIG1hdGNoZXM6IFNlYXJjaE1hdGNoW107XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoVUlPcHRpb25zPFQ+IHtcbiAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50O1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgZ2V0SXRlbVRpdGxlOiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtRGVzY3JpcHRpb24/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtQmFkZ2U/OiAoaXRlbTogVCkgPT4gc3RyaW5nO1xuICBnZXRJdGVtQ29udGV4dD86IChpdGVtOiBUKSA9PiBzdHJpbmc7XG4gIGdldEl0ZW1NZXRhPzogKGl0ZW06IFQpID0+IHN0cmluZztcbiAgb25TZWxlY3Q6IChpdGVtOiBUKSA9PiB2b2lkO1xuICBpbml0aWFsUXVlcnk/OiBzdHJpbmc7XG4gIGluaXRpYWxSZXN1bHRzTGltaXQ/OiBudW1iZXI7XG4gIG1heEZpbHRlcmVkUmVzdWx0cz86IG51bWJlcjtcbiAgZW1wdHlTdGF0ZVRleHQ/OiBzdHJpbmc7XG4gIGlzTG9hZGluZz86IGJvb2xlYW47XG4gIGxvYWRpbmdTdGF0ZVRleHQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmxhdHRlbmVkU2VhcmNoSXRlbTxUPiB7XG4gIGl0ZW06IFQ7XG4gIHNlYXJjaFRleHQ6IHN0cmluZztcbiAgZmllbGRXZWlnaHRzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xufVxuXG5leHBvcnQgY2xhc3MgU2VhcmNoU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9JTklUSUFMX1JFU1VMVFNfTElNSVQgPSAyNTtcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX01BWF9GSUxURVJFRF9SRVNVTFRTID0gNTA7XG5cbiAgcHVibGljIHNlYXJjaDxUPihcbiAgICBpdGVtczogVFtdLFxuICAgIHF1ZXJ5OiBzdHJpbmcsXG4gICAgZ2V0U2VhcmNoYWJsZUZpZWxkczogKGl0ZW06IFQpID0+IFNlYXJjaGFibGVGaWVsZFtdLFxuICAgIG9wdGlvbnM/OiB7IGluaXRpYWxSZXN1bHRzTGltaXQ/OiBudW1iZXI7IG1heEZpbHRlcmVkUmVzdWx0cz86IG51bWJlciB9XG4gICk6IFNlYXJjaFJlc3VsdDxUPltdIHtcbiAgICBjb25zdCBpbml0aWFsTGltaXQgPSBvcHRpb25zPy5pbml0aWFsUmVzdWx0c0xpbWl0ID8/IHRoaXMuREVGQVVMVF9JTklUSUFMX1JFU1VMVFNfTElNSVQ7XG4gICAgY29uc3QgbWF4RmlsdGVyZWQgPSBvcHRpb25zPy5tYXhGaWx0ZXJlZFJlc3VsdHMgPz8gdGhpcy5ERUZBVUxUX01BWF9GSUxURVJFRF9SRVNVTFRTO1xuXG4gICAgLy8gSWYgbm8gcXVlcnksIHJldHVybiBpbml0aWFsIGl0ZW1zIHdpdGggbm8gbWF0Y2hlc1xuICAgIGlmICghcXVlcnkudHJpbSgpKSB7XG4gICAgICByZXR1cm4gaXRlbXMuc2xpY2UoMCwgaW5pdGlhbExpbWl0KS5tYXAoKGl0ZW0pID0+ICh7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIG1hdGNoZXM6IFtdLFxuICAgICAgICBzY29yZTogMCxcbiAgICAgIH0pKTtcbiAgICB9XG5cbiAgICAvLyBTcGxpdCBxdWVyeSBpbnRvIHRlcm1zIGFuZCBub3JtYWxpemVcbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgXG4gICAgLy8gRmFzdCBzZWFyY2ggdXNpbmcgZmxhdHRlbmVkIHN0cnVjdHVyZVxuICAgIGNvbnN0IHJlc3VsdHMgPSBpdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBnZXRTZWFyY2hhYmxlRmllbGRzKGl0ZW0pO1xuICAgICAgY29uc3QgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdO1xuICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuXG4gICAgICAvLyBDb21iaW5lIGFsbCBzZWFyY2hhYmxlIHRleHQgd2l0aCBmaWVsZCB3ZWlnaHRzXG4gICAgICBjb25zdCBzZWFyY2hUZXh0ID0gZmllbGRzLm1hcChmID0+IGYudGV4dD8udG9Mb3dlckNhc2UoKSB8fCAnJykuam9pbignICcpO1xuICAgICAgXG4gICAgICAvLyBRdWljayBjaGVjayBpZiBhbGwgdGVybXMgZXhpc3RcbiAgICAgIGNvbnN0IGFsbFRlcm1zRXhpc3QgPSBzZWFyY2hUZXJtcy5ldmVyeSh0ZXJtID0+IHNlYXJjaFRleHQuaW5jbHVkZXModGVybSkpO1xuICAgICAgaWYgKCFhbGxUZXJtc0V4aXN0KSB7XG4gICAgICAgIHJldHVybiB7IGl0ZW0sIG1hdGNoZXM6IFtdLCBzY29yZTogMCB9O1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5kIG1hdGNoZXMgYW5kIGNhbGN1bGF0ZSBzY29yZVxuICAgICAgc2VhcmNoVGVybXMuZm9yRWFjaCh0ZXJtID0+IHtcbiAgICAgICAgbGV0IHBvcyA9IDA7XG4gICAgICAgIGNvbnN0IHRlcm1NYXRjaGVzID0gbmV3IFNldDxudW1iZXI+KCk7XG4gICAgICAgIFxuICAgICAgICB3aGlsZSAoKHBvcyA9IHNlYXJjaFRleHQuaW5kZXhPZih0ZXJtLCBwb3MpKSAhPT0gLTEpIHtcbiAgICAgICAgICAvLyBGaW5kIHdoaWNoIGZpZWxkIHRoaXMgbWF0Y2ggYmVsb25ncyB0b1xuICAgICAgICAgIGxldCBjdXJyZW50UG9zID0gMDtcbiAgICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuICAgICAgICAgICAgY29uc3QgZmllbGRUZXh0ID0gZmllbGQudGV4dD8udG9Mb3dlckNhc2UoKSB8fCAnJztcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkRW5kID0gY3VycmVudFBvcyArIGZpZWxkVGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwb3MgPj0gY3VycmVudFBvcyAmJiBwb3MgPCBmaWVsZEVuZCkge1xuICAgICAgICAgICAgICAvLyBNYXRjaCBpcyBpbiB0aGlzIGZpZWxkXG4gICAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlUG9zID0gcG9zIC0gY3VycmVudFBvcztcbiAgICAgICAgICAgICAgY29uc3QgcXVhbGl0eSA9IHRoaXMuZ2V0TWF0Y2hRdWFsaXR5KGZpZWxkVGV4dCwgdGVybSwgcmVsYXRpdmVQb3MpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGQuZmllbGQsXG4gICAgICAgICAgICAgICAgdGV4dDogZmllbGQudGV4dCB8fCAnJyxcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0ZXJtLmxlbmd0aCB9LCAoXywgaSkgPT4gcmVsYXRpdmVQb3MgKyBpKSxcbiAgICAgICAgICAgICAgICBtYXRjaFF1YWxpdHk6IHF1YWxpdHlcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IGZpZWxkLndlaWdodCAqIHF1YWxpdHk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFBvcyA9IGZpZWxkRW5kICsgMTsgLy8gKzEgZm9yIHRoZSBzcGFjZSB3ZSBhZGRlZCBiZXR3ZWVuIGZpZWxkc1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb3MgKz0gMTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBwcm94aW1pdHkgYm9udXMgZm9yIG11bHRpcGxlIHRlcm1zXG4gICAgICBpZiAoc2VhcmNoVGVybXMubGVuZ3RoID4gMSAmJiBtYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgcG9zaXRpb25zID0gbWF0Y2hlcy5mbGF0TWFwKG0gPT4gbS5pbmRpY2VzWzBdKTtcbiAgICAgICAgY29uc3QgbWF4RGlzdGFuY2UgPSBNYXRoLm1heCguLi5wb3NpdGlvbnMpIC0gTWF0aC5taW4oLi4ucG9zaXRpb25zKTtcbiAgICAgICAgaWYgKG1heERpc3RhbmNlIDwgNTApIHtcbiAgICAgICAgICB0b3RhbFNjb3JlICo9IDEuNTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpdGVtLFxuICAgICAgICBtYXRjaGVzLFxuICAgICAgICBzY29yZTogdG90YWxTY29yZVxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIEZpbHRlciBhbmQgc29ydCByZXN1bHRzXG4gICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgIC5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5zY29yZSA+IDApXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpXG4gICAgICAuc2xpY2UoMCwgbWF4RmlsdGVyZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNYXRjaFF1YWxpdHkodGV4dDogc3RyaW5nLCB0ZXJtOiBzdHJpbmcsIHBvc2l0aW9uOiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSB3b3JkIGJvdW5kYXJ5IG1hdGNoXG4gICAgY29uc3QgYmVmb3JlQ2hhciA9IHBvc2l0aW9uID4gMCA/IHRleHRbcG9zaXRpb24gLSAxXSA6ICcgJztcbiAgICBjb25zdCBhZnRlckNoYXIgPSBwb3NpdGlvbiArIHRlcm0ubGVuZ3RoIDwgdGV4dC5sZW5ndGggPyB0ZXh0W3Bvc2l0aW9uICsgdGVybS5sZW5ndGhdIDogJyAnO1xuICAgIFxuICAgIGlmICgoL1xccy8udGVzdChiZWZvcmVDaGFyKSB8fCAvXFxXLy50ZXN0KGJlZm9yZUNoYXIpKSAmJiBcbiAgICAgICAgKC9cXHMvLnRlc3QoYWZ0ZXJDaGFyKSB8fCAvXFxXLy50ZXN0KGFmdGVyQ2hhcikpKSB7XG4gICAgICByZXR1cm4gMS4wOyAvLyBQZXJmZWN0IHdvcmQgYm91bmRhcnkgbWF0Y2hcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIDAuODsgLy8gUGFydGlhbCBtYXRjaFxuICB9XG5cbiAgcHVibGljIGhpZ2hsaWdodFRleHQodGV4dDogc3RyaW5nLCBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdID0gW10sIHNlYXJjaFF1ZXJ5Pzogc3RyaW5nKTogRG9jdW1lbnRGcmFnbWVudCB7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoID09PSAwIHx8ICFzZWFyY2hRdWVyeSkge1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICBmcmFnbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3Qgc2VhcmNoVGVybXMgPSBzZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKTtcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYCgke3NlYXJjaFRlcm1zLm1hcCh0ZXJtID0+IHRoaXMuZXNjYXBlUmVnRXhwKHRlcm0pKS5qb2luKCd8Jyl9KWAsIFwiZ2lcIik7XG4gICAgbGV0IGxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoO1xuXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyBBZGQgbm9uLWhpZ2hsaWdodGVkIHRleHQgYmVmb3JlIG1hdGNoXG4gICAgICBpZiAobWF0Y2guaW5kZXggPiBsYXN0SW5kZXgpIHtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zbGljZShsYXN0SW5kZXgsIG1hdGNoLmluZGV4KSkpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgaGlnaGxpZ2h0ZWQgbWF0Y2hcbiAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgIHNwYW4uY2xhc3NOYW1lID0gXCJzeXN0ZW1zY3VscHQtc2VhcmNoLWhpZ2hsaWdodFwiO1xuICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IG1hdGNoWzBdO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7XG5cbiAgICAgIGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIEFkZCByZW1haW5pbmcgdGV4dFxuICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zbGljZShsYXN0SW5kZXgpKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZyYWdtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBlc2NhcGVSZWdFeHAoc3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTsgLy8gJCYgbWVhbnMgdGhlIHdob2xlIG1hdGNoZWQgc3RyaW5nXG4gIH1cbn1cbiIsICJpbXBvcnQge1xuICBNb2RlbEZpbHRlclNldHRpbmdzLFxuICBERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyxcbiAgU3lzdGVtU2N1bHB0TW9kZWwsXG59IGZyb20gXCIuLi90eXBlcy9sbG1cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IFNlYXJjaE1hdGNoIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1NlYXJjaFNlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBUaWVySW5mbyB7XG4gIG5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjb25zdCBUSUVSX0lORk86IHsgW2tleTogc3RyaW5nXTogVGllckluZm8gfSA9IHtcbiAgZmF2b3JpdGVzOiB7XG4gICAgbmFtZTogXCJGYXZvcml0ZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJZb3VyIGZhdm9yaXRlIG1vZGVscyBmb3IgcXVpY2sgYWNjZXNzXCIsXG4gICAgY2xhc3NOYW1lOiBcImZhdm9yaXRlXCIsXG4gIH0sXG4gIGVzc2VudGlhbDoge1xuICAgIG5hbWU6IFwiRXNzZW50aWFsXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIkJ1ZGdldC1mcmllbmRseSwgZ3JlYXQgZm9yIGRhaWx5IHRhc2tzLCBpbmNsdWRlcyB2aXNpb24gYW5kIHJlYXNvbmluZyBjYXBhYmlsaXRpZXMsIGV4Y2VsbGVudCB2YWx1ZVwiLFxuICAgIGNsYXNzTmFtZTogXCJlc3NlbnRpYWxcIixcbiAgfSxcbiAgYWR2YW5jZWQ6IHtcbiAgICBuYW1lOiBcIkFkdmFuY2VkXCIsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICBcIkJhbGFuY2VkIHBlcmZvcm1hbmNlLCBlbmhhbmNlZCBjYXBhYmlsaXRpZXMsIGlkZWFsIGZvciBjb21wbGV4IHRhc2tzLCBlZmZpY2llbnQgcmVzb3VyY2UgdXNhZ2VcIixcbiAgICBjbGFzc05hbWU6IFwiYWR2YW5jZWRcIixcbiAgfSxcbiAgcHJvZmVzc2lvbmFsOiB7XG4gICAgbmFtZTogXCJQcm9mZXNzaW9uYWxcIixcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgIFwiTWF4aW11bSBwZXJmb3JtYW5jZSwgYWR2YW5jZWQgZmVhdHVyZXMsIHNwZWNpYWxpemVkIHdvcmtmbG93cywgZW50ZXJwcmlzZS1ncmFkZSBjYXBhYmlsaXRpZXNcIixcbiAgICBjbGFzc05hbWU6IFwicHJvZmVzc2lvbmFsXCIsXG4gIH0sXG4gIGN1c3RvbToge1xuICAgIG5hbWU6IFwiQ3VzdG9tIE1vZGVsc1wiLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgXCJZb3VyIHBlcnNvbmFsbHkgY29uZmlndXJlZCBtb2RlbHMgZnJvbSBjdXN0b20gcHJvdmlkZXJzLCBhbGxvd2luZyBmdWxsIGNvbnRyb2wgb3ZlciBtb2RlbCBzZWxlY3Rpb25cIixcbiAgICBjbGFzc05hbWU6IFwiY3VzdG9tXCIsXG4gIH0sXG4gIC8vIEZhbGxiYWNrIGZvciBhbnkgdW5rbm93biB0aWVyXG4gIGRlZmF1bHQ6IHtcbiAgICBuYW1lOiBcIk1vZGVsc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkF2YWlsYWJsZSBtb2RlbHNcIixcbiAgICBjbGFzc05hbWU6IFwiZGVmYXVsdFwiLFxuICB9LFxufTtcblxuZXhwb3J0IGNsYXNzIE1vZGVsU2VsZWN0aW9uSGVscGVyIHtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgZmlsdGVyU2V0dGluZ3M6IE1vZGVsRmlsdGVyU2V0dGluZ3M7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmxvZ2dlciA9IGNvbnNvbGU7XG4gICAgLy8gSW5pdGlhbGl6ZSB3aXRoIHNhdmVkIHNldHRpbmdzIG9yIGRlZmF1bHRzXG4gICAgdGhpcy5maWx0ZXJTZXR0aW5ncyA9IHsgLi4udGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxGaWx0ZXJTZXR0aW5ncyB9O1xuICB9XG5cbiAgZ2V0RmlsdGVyU2V0dGluZ3MoKTogTW9kZWxGaWx0ZXJTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyU2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyBzZXRGaWx0ZXJTZXR0aW5nKGtleToga2V5b2YgTW9kZWxGaWx0ZXJTZXR0aW5ncywgdmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzW2tleV0gPSB2YWx1ZTtcbiAgICAvLyBVcGRhdGUgcGx1Z2luIHNldHRpbmdzIGFuZCBzYXZlXG4gICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxGaWx0ZXJTZXR0aW5ncyA9IHsgLi4udGhpcy5maWx0ZXJTZXR0aW5ncyB9O1xuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICB9XG5cbiAgYXN5bmMgcmVzZXRGaWx0ZXJTZXR0aW5ncygpIHtcbiAgICB0aGlzLmZpbHRlclNldHRpbmdzID0geyAuLi5ERUZBVUxUX0ZJTFRFUl9TRVRUSU5HUyB9O1xuICAgIC8vIFVwZGF0ZSBwbHVnaW4gc2V0dGluZ3MgYW5kIHNhdmVcbiAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbEZpbHRlclNldHRpbmdzID0geyAuLi50aGlzLmZpbHRlclNldHRpbmdzIH07XG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gIH1cblxuICBmb3JtYXRQcmljZShwcmljZTogbnVtYmVyIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICB0cnkge1xuICAgICAgaWYgKHByaWNlID09PSBudWxsIHx8IHByaWNlID09PSB1bmRlZmluZWQgfHwgcHJpY2UgPT09IFwiMFwiKSB7XG4gICAgICAgIHJldHVybiBcIkZyZWVcIjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbnVtZXJpY1ByaWNlID1cbiAgICAgICAgdHlwZW9mIHByaWNlID09PSBcInN0cmluZ1wiID8gcGFyc2VGbG9hdChwcmljZSkgOiBwcmljZTtcblxuICAgICAgaWYgKGlzTmFOKG51bWVyaWNQcmljZSkgfHwgbnVtZXJpY1ByaWNlID09PSAwKSB7XG4gICAgICAgIHJldHVybiBcIkZyZWVcIjtcbiAgICAgIH1cblxuICAgICAgLy8gTXVsdGlwbHkgYnkgMSwwMDAsMDAwIHRvIGNvbnZlcnQgZnJvbSBwZXIgdG9rZW4gdG8gcGVyIDFNIHRva2Vuc1xuICAgICAgY29uc3QgcHJpY2VQZXJNaWxsaW9uID0gbnVtZXJpY1ByaWNlICogMTAwMDAwMDtcblxuICAgICAgLy8gQWx3YXlzIHNob3cgZXhhY3RseSAyIGRlY2ltYWwgcGxhY2VzXG4gICAgICByZXR1cm4gYCQke3ByaWNlUGVyTWlsbGlvbi50b0ZpeGVkKDIpfWA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiTW9kZWxTZWxlY3Rpb25IZWxwZXI6IEVycm9yIGZvcm1hdHRpbmcgcHJpY2VcIiwge1xuICAgICAgICBwcmljZSxcbiAgICAgICAgZXJyb3IsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBcIlByaWNlIGVycm9yXCI7XG4gICAgfVxuICB9XG5cbiAgaGlnaGxpZ2h0VGV4dChcbiAgICB0ZXh0OiBzdHJpbmcsXG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdLFxuICAgIHNlYXJjaFF1ZXJ5Pzogc3RyaW5nXG4gICk6IERvY3VtZW50RnJhZ21lbnQge1xuICAgIGlmICghbWF0Y2hlcyB8fCBtYXRjaGVzLmxlbmd0aCA9PT0gMCB8fCAhc2VhcmNoUXVlcnkpIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgZnJhZ21lbnQudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHNlYXJjaFF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gICAgLy8gVXNlIHJlZ2V4IHRvIGZpbmQgd2hvbGUgd29yZCBvciBwaHJhc2UgbWF0Y2hlc1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7bm9ybWFsaXplZFF1ZXJ5fSlgLCBcImdpXCIpO1xuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaDtcblxuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgLy8gQWRkIG5vbi1oaWdobGlnaHRlZCB0ZXh0IGJlZm9yZSBtYXRjaFxuICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgIGNvbnN0IHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXG4gICAgICAgICAgdGV4dC5zbGljZShsYXN0SW5kZXgsIG1hdGNoLmluZGV4KVxuICAgICAgICApO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCBtYXRjaFxuICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgc3Bhbi5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1tb2RlbC1oaWdobGlnaHRcIjtcbiAgICAgIHNwYW4udGV4dENvbnRlbnQgPSBtYXRjaFswXTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNwYW4pO1xuXG4gICAgICBsYXN0SW5kZXggPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zbGljZShsYXN0SW5kZXgpKTtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBzb3J0TW9kZWxzKG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSk6IFN5c3RlbVNjdWxwdE1vZGVsW10ge1xuICAgIC8vIENyZWF0ZSB0aWVyIGdyb3VwcyBpbmNsdWRpbmcgZmF2b3JpdGVzXG4gICAgY29uc3QgdGllcnMgPSB7XG4gICAgICBmYXZvcml0ZXM6IFtdIGFzIFN5c3RlbVNjdWxwdE1vZGVsW10sXG4gICAgICBlc3NlbnRpYWw6IFtdIGFzIFN5c3RlbVNjdWxwdE1vZGVsW10sXG4gICAgICBhZHZhbmNlZDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIHByb2Zlc3Npb25hbDogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICAgIGN1c3RvbTogW10gYXMgU3lzdGVtU2N1bHB0TW9kZWxbXSxcbiAgICB9O1xuXG4gICAgLy8gRmlyc3QgcGFzczogZGlzdHJpYnV0ZSBtb2RlbHMgdG8gdGhlaXIgcmVzcGVjdGl2ZSB0aWVyc1xuICAgIG1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgLy8gRmF2b3JpdGVkIG1vZGVscyBPTkxZIGdvIHRvIGZhdm9yaXRlcyB0aWVyXG4gICAgICBpZiAobW9kZWwuaXNGYXZvcml0ZSkge1xuICAgICAgICB0aWVycy5mYXZvcml0ZXMucHVzaChtb2RlbCk7XG4gICAgICAgIHJldHVybjsgLy8gU2tpcCBhZGRpbmcgdG8gb3RoZXIgdGllcnNcbiAgICAgIH1cblxuICAgICAgLy8gTm9uLWZhdm9yaXRlcyBnbyB0byB0aGVpciByZXNwZWN0aXZlIHRpZXJzXG4gICAgICBpZiAobW9kZWwucHJvdmlkZXIgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgdGllcnMuY3VzdG9tLnB1c2gobW9kZWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNvcnQgbW9kZWxzIHdpdGhpbiBlYWNoIHRpZXIgYnkgbmFtZVxuICAgIE9iamVjdC52YWx1ZXModGllcnMpLmZvckVhY2goKHRpZXJNb2RlbHMpID0+IHtcbiAgICAgIHRpZXJNb2RlbHMuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG4gICAgfSk7XG5cbiAgICAvLyBDb21iaW5lIHRpZXJzIGluIHRoZSBjb3JyZWN0IG9yZGVyLCBvbmx5IGluY2x1ZGluZyBub24tZW1wdHkgdGllcnNcbiAgICBjb25zdCBzb3J0ZWRNb2RlbHM6IFN5c3RlbVNjdWxwdE1vZGVsW10gPSBbXTtcblxuICAgIC8vIEZhdm9yaXRlcyBhbHdheXMgZmlyc3QgKGlmIGFueSBleGlzdClcbiAgICBpZiAodGllcnMuZmF2b3JpdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmZhdm9yaXRlcyk7XG4gICAgfVxuXG4gICAgLy8gVGhlbiB0aGUgc3RhbmRhcmQgdGllcnMgaW4gb3JkZXJcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5lc3NlbnRpYWwpO1xuICAgIHNvcnRlZE1vZGVscy5wdXNoKC4uLnRpZXJzLmFkdmFuY2VkKTtcbiAgICBzb3J0ZWRNb2RlbHMucHVzaCguLi50aWVycy5wcm9mZXNzaW9uYWwpO1xuXG4gICAgLy8gQ3VzdG9tIG1vZGVscyBsYXN0XG4gICAgc29ydGVkTW9kZWxzLnB1c2goLi4udGllcnMuY3VzdG9tKTtcblxuICAgIHJldHVybiBzb3J0ZWRNb2RlbHM7XG4gIH1cblxuICBmaWx0ZXJNb2RlbHMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogU3lzdGVtU2N1bHB0TW9kZWxbXSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBtb2RlbHMuZmlsdGVyKChtb2RlbCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGhhc1Zpc2lvbkNhcGFiaWxpdHkgPVxuICAgICAgICAgICAgbW9kZWwuY2FwYWJpbGl0aWVzPy5pbmNsdWRlcyhcInZpc2lvblwiKSB8fCBmYWxzZTtcbiAgICAgICAgICBjb25zdCBoYXNSZWFzb25pbmdDYXBhYmlsaXR5ID1cbiAgICAgICAgICAgIG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJyZWFzb25pbmdcIikgfHwgZmFsc2U7XG4gICAgICAgICAgY29uc3QgaGFzQ3JlYXRpdmVDYXBhYmlsaXR5ID1cbiAgICAgICAgICAgIG1vZGVsLmNhcGFiaWxpdGllcz8uaW5jbHVkZXMoXCJjcmVhdGl2ZVwiKSB8fCBmYWxzZTtcblxuICAgICAgICAgIC8vIElmIG5vIGZpbHRlcnMgYXJlIGFjdGl2ZSwgc2hvdyBhbGwgbW9kZWxzXG4gICAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKHRoaXMuZmlsdGVyU2V0dGluZ3MpLnNvbWUoKHZhbHVlKSA9PiB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENoZWNrIGVhY2ggYWN0aXZlIGZpbHRlclxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAoIXRoaXMuZmlsdGVyU2V0dGluZ3Muc2hvd1Zpc2lvbk1vZGVscyB8fCBoYXNWaXNpb25DYXBhYmlsaXR5KSAmJlxuICAgICAgICAgICAgKCF0aGlzLmZpbHRlclNldHRpbmdzLnNob3dSZWFzb25pbmdNb2RlbHMgfHxcbiAgICAgICAgICAgICAgaGFzUmVhc29uaW5nQ2FwYWJpbGl0eSkgJiZcbiAgICAgICAgICAgICghdGhpcy5maWx0ZXJTZXR0aW5ncy5zaG93Q3JlYXRpdmVNb2RlbHMgfHwgaGFzQ3JlYXRpdmVDYXBhYmlsaXR5KVxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICBcIk1vZGVsU2VsZWN0aW9uSGVscGVyOiBFcnJvciBmaWx0ZXJpbmcgaW5kaXZpZHVhbCBtb2RlbFwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIk1vZGVsU2VsZWN0aW9uSGVscGVyOiBFcnJvciBpbiBmaWx0ZXJNb2RlbHNcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG1vZGVscztcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBOb3RpY2UsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcInNyYy9tYWluXCI7XG5pbXBvcnQgeyBDdXN0b21Qcm92aWRlciB9IGZyb20gXCJzcmMvdHlwZXMvbGxtXCI7XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBsb2dnZXI6IENvbnNvbGU7XG4gIHByaXZhdGUgb25CYWNrOiAoKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbiwgb25CYWNrOiAoKSA9PiB2b2lkKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmxvZ2dlciA9IGNvbnNvbGU7XG4gICAgdGhpcy5vbkJhY2sgPSBvbkJhY2s7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByb3ZpZGVyQ2FyZChwcm92aWRlcjogQ3VzdG9tUHJvdmlkZXIsIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBjYXJkID0gY29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZFwiKTtcblxuICAgIC8vIEhlYWRlciB3aXRoIG5hbWUgYW5kIGFjdGlvbnNcbiAgICBjb25zdCBoZWFkZXIgPSBjYXJkLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1oZWFkZXJcIik7XG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwiaDNcIiwge1xuICAgICAgdGV4dDogcHJvdmlkZXIubmFtZSxcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtbmFtZVwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWN0aW9ucyA9IGhlYWRlci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gRGVsZXRlIGJ1dHRvblxuICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1hY3Rpb24gZGVsZXRlXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihkZWxldGVCdG4sIFwidHJhc2gtMlwiKTtcbiAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAvLyBSZW1vdmUgcHJvdmlkZXJcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycyA9XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maWx0ZXIoXG4gICAgICAgICAgKHApID0+IHAuaWQgIT09IHByb3ZpZGVyLmlkXG4gICAgICAgICk7XG5cbiAgICAgIC8vIFNhdmUgc2V0dGluZ3NcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAvLyBHZXQgZnJlc2ggbW9kZWxzIGFuZCB1cGRhdGUgVUlcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5yZWZyZXNoTW9kZWxzKCk7XG5cbiAgICAgIC8vIFJlLXJlbmRlciBsaXN0XG4gICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgIH0pO1xuXG4gICAgLy8gRGV0YWlscyBzZWN0aW9uXG4gICAgY29uc3QgZGV0YWlscyA9IGNhcmQuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbHNcIik7XG5cbiAgICAvLyBUeXBlXG4gICAgY29uc3QgdHlwZURldGFpbCA9IGRldGFpbHMuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWNhcmQtZGV0YWlsXCJcbiAgICApO1xuICAgIHNldEljb24odHlwZURldGFpbC5jcmVhdGVTcGFuKCksIFwiYm94XCIpO1xuICAgIHR5cGVEZXRhaWwuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBcIk9wZW5BSSBDb21wYXRpYmxlXCIsXG4gICAgfSk7XG5cbiAgICAvLyBFbmRwb2ludFxuICAgIGNvbnN0IGVuZHBvaW50RGV0YWlsID0gZGV0YWlscy5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItY2FyZC1kZXRhaWxcIlxuICAgICk7XG4gICAgc2V0SWNvbihlbmRwb2ludERldGFpbC5jcmVhdGVTcGFuKCksIFwibGlua1wiKTtcbiAgICBlbmRwb2ludERldGFpbC5jcmVhdGVTcGFuKHsgdGV4dDogcHJvdmlkZXIuZW5kcG9pbnQgfSk7XG5cbiAgICAvLyBTdGF0dXNcbiAgICBjb25zdCBzdGF0dXNEZXRhaWwgPSBkZXRhaWxzLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1jYXJkLWRldGFpbFwiXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0b2dnbGUgY29udGFpbmVyXG4gICAgY29uc3QgdG9nZ2xlQ29udGFpbmVyID0gc3RhdHVzRGV0YWlsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci10b2dnbGUtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgbGFiZWxcbiAgICB0b2dnbGVDb250YWluZXIuY3JlYXRlU3Bhbih7XG4gICAgICB0ZXh0OiBwcm92aWRlci5pc0VuYWJsZWQgPyBcIkVuYWJsZWRcIiA6IFwiRGlzYWJsZWRcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXRvZ2dsZS1sYWJlbFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRvZ2dsZSBzd2l0Y2hcbiAgICBjb25zdCB0b2dnbGUgPSB0b2dnbGVDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYGNoZWNrYm94LWNvbnRhaW5lciAke3Byb3ZpZGVyLmlzRW5hYmxlZCA/IFwiaXMtZW5hYmxlZFwiIDogXCJcIn1gLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSB0b2dnbGUgdHJhY2sgYW5kIHRodW1iXG4gICAgdG9nZ2xlLmNyZWF0ZURpdih7IGNsczogXCJjaGVja2JveC10b2dnbGVcIiB9KTtcblxuICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIGZvciBzdGF0dXMgdG9nZ2xlXG4gICAgdG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgLy8gSWYgYWxyZWFkeSBlbmFibGVkLCBqdXN0IGRpc2FibGVcbiAgICAgIGlmIChwcm92aWRlci5pc0VuYWJsZWQpIHtcbiAgICAgICAgcHJvdmlkZXIuaXNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UucmVmcmVzaE1vZGVscygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGVuYWJsaW5nLCB0ZXN0IGNvbm5lY3Rpb24gZmlyc3RcbiAgICAgIHRvZ2dsZS5hZGRDbGFzcyhcInRlc3RpbmdcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24oXG4gICAgICAgIHByb3ZpZGVyXG4gICAgICApO1xuICAgICAgdG9nZ2xlLnJlbW92ZUNsYXNzKFwidGVzdGluZ1wiKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHByb3ZpZGVyLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5tb2RlbFNlcnZpY2UucmVmcmVzaE1vZGVscygpO1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyTGlzdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvciBub3RpY2VcbiAgICAgICAgbmV3IE5vdGljZShcbiAgICAgICAgICBgRmFpbGVkIHRvIGVuYWJsZSAke3Byb3ZpZGVyLm5hbWV9OiAke1xuICAgICAgICAgICAgcmVzdWx0LmVycm9yIHx8IFwiQ29ubmVjdGlvbiBmYWlsZWRcIlxuICAgICAgICAgIH1gLFxuICAgICAgICAgIDUwMDBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvdmlkZXJMaXN0KCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgLy8gQ2xlYXIgZXhpc3RpbmcgY29udGVudFxuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1tb2RhbFwiKTtcblxuICAgIC8vIENyZWF0ZSBoZWFkZXIgd2l0aCBiYWNrIGJ1dHRvblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1oZWFkZXJcIlxuICAgICk7XG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJhY2tcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGJhY2tCdXR0b24uY3JlYXRlU3BhbigpLCBcImFycm93LWxlZnRcIik7XG4gICAgYmFja0J1dHRvbi5jcmVhdGVTcGFuKHsgdGV4dDogXCJCYWNrIHRvIE1vZGVsc1wiIH0pO1xuXG4gICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIGhlYWRlci5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDdXN0b20gUHJvdmlkZXJzXCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXJcbiAgICBjb25zdCBjb250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWNvbnRlbnRcIlxuICAgICk7XG4gICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGNvbnRlbnQuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItbGlzdFwiXG4gICAgKTtcblxuICAgIC8vIEdldCBwcm92aWRlcnMgZnJvbSBzZXR0aW5nc1xuICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycztcblxuICAgIGlmIChwcm92aWRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBTaG93IGVtcHR5IHN0YXRlXG4gICAgICBjb25zdCBlbXB0eVN0YXRlID0gbGlzdENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWVtcHR5XCJcbiAgICAgICk7XG4gICAgICBjb25zdCBlbXB0eUljb24gPSBlbXB0eVN0YXRlLmNyZWF0ZURpdihcbiAgICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1hbmFnZXItZW1wdHktaWNvblwiXG4gICAgICApO1xuICAgICAgc2V0SWNvbihlbXB0eUljb24sIFwic2VydmVyLW9mZlwiKTtcbiAgICAgIGVtcHR5U3RhdGUuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1lbXB0eS10ZXh0XCIsXG4gICAgICAgIHRleHQ6IFwiTm8gY3VzdG9tIHByb3ZpZGVycyBhZGRlZCB5ZXRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZW5kZXIgcHJvdmlkZXIgY2FyZHNcbiAgICAgIHByb3ZpZGVycy5mb3JFYWNoKChwcm92aWRlcikgPT4ge1xuICAgICAgICB0aGlzLnJlbmRlclByb3ZpZGVyQ2FyZChwcm92aWRlciwgbGlzdENvbnRhaW5lcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYWN0aW9ucyBjb250YWluZXJcbiAgICBjb25zdCBhY3Rpb25zID0gY29udGVudC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1hY3Rpb25zXCJcbiAgICApO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGJ1dHRvblxuICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItbWFuYWdlci1idXR0b24gc3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1tYW5hZ2VyLWJ1dHRvbi1wcmltYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkFkZCBQcm92aWRlclwiLFxuICAgIH0pO1xuICAgIHNldEljb24oYWRkQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJwbHVzXCIpO1xuXG4gICAgYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICBjb25zdCBjdXN0b21Qcm92aWRlck1vZGFsID0gbmV3IEN1c3RvbVByb3ZpZGVyTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnBsdWdpbixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1hbmFnZXJNb2RhbCA9IG5ldyBDdXN0b21Qcm92aWRlck1hbmFnZXJNb2RhbChcbiAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICB0aGlzLm9uQmFja1xuICAgICAgICAgICk7XG4gICAgICAgICAgbWFuYWdlck1vZGFsLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGN1c3RvbVByb3ZpZGVyTW9kYWwub3BlbigpO1xuICAgIH0pO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIHRoaXMucmVuZGVyUHJvdmlkZXJMaXN0KCk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Qcm92aWRlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGxvZ2dlcjogQ29uc29sZTtcbiAgcHJpdmF0ZSBvbkJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBvbkJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubG9nZ2VyID0gY29uc29sZTtcbiAgICB0aGlzLm9uQmFjayA9IG9uQmFjaztcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLW1vZGFsXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGhlYWRlciB3aXRoIGJhY2sgYnV0dG9uXG4gICAgY29uc3QgaGVhZGVyID0gY29udGVudEVsLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItaGVhZGVyXCIpO1xuXG4gICAgY29uc3QgYmFja0J1dHRvbiA9IGhlYWRlci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1iYWNrXCIsXG4gICAgfSk7XG4gICAgc2V0SWNvbihiYWNrQnV0dG9uLmNyZWF0ZVNwYW4oKSwgXCJhcnJvdy1sZWZ0XCIpO1xuICAgIGJhY2tCdXR0b24uY3JlYXRlU3Bhbih7IHRleHQ6IFwiQmFjayB0byBQcm92aWRlcnNcIiB9KTtcblxuICAgIGJhY2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIHRoaXMub25CYWNrKCk7XG4gICAgfSk7XG5cbiAgICBoZWFkZXIuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQWRkIEN1c3RvbSBQcm92aWRlclwiIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGZvcm0gY29udGFpbmVyXG4gICAgY29uc3QgZm9ybSA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm1cIik7XG5cbiAgICAvLyBQcm92aWRlciBOYW1lXG4gICAgY29uc3QgbmFtZUdyb3VwID0gZm9ybS5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tZ3JvdXBcIik7XG4gICAgbmFtZUdyb3VwLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIlByb3ZpZGVyIE5hbWVcIiB9KTtcbiAgICBjb25zdCBuYW1lSW5wdXQgPSBuYW1lR3JvdXAuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcImUuZy4sIExNIFN0dWRpbywgT3BlbkFJXCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIG1heGxlbmd0aDogXCIyNVwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEFkZCBpbnB1dCBydWxlcyBmb3IgcHJvdmlkZXIgbmFtZVxuICAgIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBuYW1lSW5wdXQudmFsdWU7XG5cbiAgICAgIC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyIG9mIGVhY2ggd29yZFxuICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgIC5tYXAoKHdvcmQpID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKVxuICAgICAgICAuam9pbihcIiBcIik7XG5cbiAgICAgIC8vIE9ubHkgdXBkYXRlIGlmIHRoZSB2YWx1ZSBoYXMgY2hhbmdlZCB0byBwcmV2ZW50IGN1cnNvciBqdW1waW5nXG4gICAgICBpZiAoZm9ybWF0dGVkVmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IGZvcm1hdHRlZFZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRW5kcG9pbnQgVVJMXG4gICAgY29uc3QgdXJsR3JvdXAgPSBmb3JtLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZm9ybS1ncm91cFwiKTtcbiAgICB1cmxHcm91cC5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogXCJBUEkgRW5kcG9pbnQgVVJMXCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnNcbiAgICBjb25zdCBwcmVzZXRDb250YWluZXIgPSB1cmxHcm91cC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0c1wiXG4gICAgKTtcbiAgICBwcmVzZXRDb250YWluZXIuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiUXVpY2sgU2V0dXA6XCIgfSk7XG5cbiAgICAvLyBBZGQgcHJlc2V0IGJ1dHRvbnMgY29udGFpbmVyXG4gICAgY29uc3QgcHJlc2V0QnV0dG9ucyA9IHByZXNldENvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItcHJlc2V0LWJ1dHRvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgT3BlbkFJIHByZXNldFxuICAgIGNvbnN0IG9wZW5BSUJ1dHRvbiA9IHByZXNldEJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJPcGVuQUlcIixcbiAgICB9KTtcblxuICAgIG9wZW5BSUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJPcGVuQUlcIjtcbiAgICAgIHVybElucHV0LnZhbHVlID0gXCJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBPcGVuUm91dGVyIHByZXNldFxuICAgIGNvbnN0IG9wZW5Sb3V0ZXJCdXR0b24gPSBwcmVzZXRCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWJ1dHRvbi1zZWNvbmRhcnlcIixcbiAgICAgIHRleHQ6IFwiT3BlblJvdXRlclwiLFxuICAgIH0pO1xuXG4gICAgb3BlblJvdXRlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gXCJPcGVuUm91dGVyXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MVwiO1xuICAgICAgYXBpS2V5SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgR3JvcSBwcmVzZXRcbiAgICBjb25zdCBncm9xQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkdyb3FcIixcbiAgICB9KTtcblxuICAgIGdyb3FCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IFwiR3JvcVwiO1xuICAgICAgdXJsSW5wdXQudmFsdWUgPSBcImh0dHBzOi8vYXBpLmdyb3EuY29tL29wZW5haS92MVwiO1xuICAgICAgYXBpS2V5SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgTE0gU3R1ZGlvIHByZXNldFxuICAgIGNvbnN0IGxtU3R1ZGlvQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIkxNIFN0dWRpb1wiLFxuICAgIH0pO1xuXG4gICAgbG1TdHVkaW9CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IFwiTE0gU3R1ZGlvXCI7XG4gICAgICB1cmxJbnB1dC52YWx1ZSA9IFwiaHR0cDovL2xvY2FsaG9zdDoxMjM0L3YxXCI7XG4gICAgICBhcGlLZXlJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICByZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBPbGxhbWEgcHJlc2V0XG4gICAgY29uc3Qgb2xsYW1hQnV0dG9uID0gcHJlc2V0QnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1idXR0b24tc2Vjb25kYXJ5XCIsXG4gICAgICB0ZXh0OiBcIk9sbGFtYVwiLFxuICAgIH0pO1xuXG4gICAgb2xsYW1hQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSBcIk9sbGFtYVwiO1xuICAgICAgdXJsSW5wdXQudmFsdWUgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQvdjFcIjtcbiAgICAgIGFwaUtleUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdXJsSW5wdXQgPSB1cmxHcm91cC5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiaHR0cHM6Ly95b3VyLWFwaS1lbmRwb2ludC5jb21cIixcbiAgICB9KTtcblxuICAgIC8vIEFkZCBlcnJvciBtZXNzYWdlIGNvbnRhaW5lclxuICAgIGNvbnN0IHVybEVycm9yID0gdXJsR3JvdXAuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIsXG4gICAgICB0ZXh0OiBcIiBcIiwgLy8gU3BhY2UgdG8gbWFpbnRhaW4gaGVpZ2h0XG4gICAgfSk7XG5cbiAgICAvLyBVUkwgdmFsaWRhdGlvbiBmdW5jdGlvblxuICAgIGNvbnN0IHZhbGlkYXRlRW5kcG9pbnRVcmwgPSAoXG4gICAgICB1cmw6IHN0cmluZ1xuICAgICk6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHVybCk7XG4gICAgICAgIGNvbnN0IGlzTG9jYWwgPVxuICAgICAgICAgIHBhcnNlZFVybC5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiB8fFxuICAgICAgICAgIHBhcnNlZFVybC5ob3N0bmFtZSA9PT0gXCIxMjcuMC4wLjFcIjtcblxuICAgICAgICBpZiAoaXNMb2NhbCAmJiBwYXJzZWRVcmwucHJvdG9jb2wgIT09IFwiaHR0cDpcIikge1xuICAgICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJMb2NhbCBlbmRwb2ludHMgbXVzdCB1c2UgSFRUUFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzTG9jYWwgJiYgcGFyc2VkVXJsLnByb3RvY29sICE9PSBcImh0dHBzOlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIlJlbW90ZSBlbmRwb2ludHMgbXVzdCB1c2UgSFRUUFNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzTG9jYWwgJiYgIXBhcnNlZFVybC5wb3J0KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IFwiTG9jYWwgZW5kcG9pbnRzIHJlcXVpcmUgYSBwb3J0IG51bWJlclwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlIH07XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkludmFsaWQgVVJMIGZvcm1hdFwiIH07XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEFQSSBLZXlcbiAgICBjb25zdCBhcGlLZXlHcm91cCA9IGZvcm0uY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWZvcm0tZ3JvdXBcIlxuICAgICk7XG4gICAgYXBpS2V5R3JvdXAuY3JlYXRlRWwoXCJsYWJlbFwiLCB7IHRleHQ6IFwiQVBJIEtleSAoT3B0aW9uYWwpXCIgfSk7XG4gICAgY29uc3QgYXBpS2V5SW5wdXQgPSBhcGlLZXlHcm91cC5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIHlvdXIgQVBJIGtleVwiLFxuICAgIH0pO1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gcmVzZXQgdmFsaWRhdGlvbiBzdGF0ZVxuICAgIGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9ICgpID0+IHtcbiAgICAgIGlzQ29ubmVjdGlvblRlc3RlZCA9IGZhbHNlO1xuICAgICAgdGVzdFJlc3VsdCA9IG51bGw7XG4gICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInRlc3RcIik7XG4gICAgICB1cmxFcnJvci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLXN1Y2Nlc3NcIik7XG4gICAgfTtcblxuICAgIC8vIEFkZCBjaGFuZ2UgbGlzdGVuZXJzIHRvIGFsbCBpbnB1dHNcbiAgICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG4gICAgdXJsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG4gICAgYXBpS2V5SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHJlc2V0VmFsaWRhdGlvbik7XG5cbiAgICAvLyBBZGQgaW5wdXQgcnVsZXMgZm9yIHByb3ZpZGVyIG5hbWVcbiAgICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbmFtZUlucHV0LnZhbHVlO1xuXG4gICAgICAvLyBDYXBpdGFsaXplIGZpcnN0IGxldHRlciBvZiBlYWNoIHdvcmRcbiAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gdmFsdWVcbiAgICAgICAgLnNwbGl0KFwiIFwiKVxuICAgICAgICAubWFwKCh3b3JkKSA9PiB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xuXG4gICAgICAvLyBPbmx5IHVwZGF0ZSBpZiB0aGUgdmFsdWUgaGFzIGNoYW5nZWQgdG8gcHJldmVudCBjdXJzb3IganVtcGluZ1xuICAgICAgaWYgKGZvcm1hdHRlZFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICBuYW1lSW5wdXQudmFsdWUgPSBmb3JtYXR0ZWRWYWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBmb3JtIGFjdGlvbnMgY29udGFpbmVyXG4gICAgY29uc3QgZm9ybUFjdGlvbnMgPSBmb3JtLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1mb3JtLWFjdGlvbnNcIlxuICAgICk7XG5cbiAgICAvLyBBZGQgY2FuY2VsIGJ1dHRvbiBmaXJzdCAob24gdGhlIGxlZnQpXG4gICAgY29uc3QgY2FuY2VsQnV0dG9uID0gZm9ybUFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXNlY29uZGFyeVwiLFxuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICB9KTtcblxuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCB0ZXN0L3NhdmUgYnV0dG9uIChvbiB0aGUgcmlnaHQpXG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gZm9ybUFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uIHN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItYnV0dG9uLXByaW1hcnlcIixcbiAgICAgIHRleHQ6IFwiVGVzdCBDb25uZWN0aW9uXCIsXG4gICAgfSk7XG5cbiAgICBsZXQgaXNDb25uZWN0aW9uVGVzdGVkID0gZmFsc2U7XG4gICAgbGV0IHRlc3RSZXN1bHQ6IHsgc3VjY2VzczogYm9vbGVhbjsgbW9kZWxzPzogc3RyaW5nW10gfSB8IG51bGwgPSBudWxsO1xuXG4gICAgLy8gRnVuY3Rpb24gdG8gY3JlYXRlIGEgcHJvdmlkZXIgb2JqZWN0IGZyb20gZm9ybSBkYXRhXG4gICAgY29uc3QgY3JlYXRlUHJvdmlkZXJGcm9tRm9ybSA9ICgpOiBDdXN0b21Qcm92aWRlciA9PiAoe1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBuYW1lOiBuYW1lSW5wdXQudmFsdWUudHJpbSgpLFxuICAgICAgZW5kcG9pbnQ6IHVybElucHV0LnZhbHVlLnRyaW0oKSxcbiAgICAgIGFwaUtleTogYXBpS2V5SW5wdXQudmFsdWUudHJpbSgpLFxuICAgICAgaXNFbmFibGVkOiB0cnVlLFxuICAgICAgbGFzdFRlc3RlZDogRGF0ZS5ub3coKSxcbiAgICB9KTtcblxuICAgIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBidXR0b24gc3RhdGVcbiAgICBjb25zdCB1cGRhdGVCdXR0b25TdGF0ZSA9IChcbiAgICAgIHN0YXRlOiBcInRlc3RcIiB8IFwidGVzdGluZ1wiIHwgXCJyZXRyeVwiIHwgXCJzYXZlXCJcbiAgICApID0+IHtcbiAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgY2FzZSBcInRlc3RcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlRlc3QgQ29ubmVjdGlvblwiKTtcbiAgICAgICAgICBhY3Rpb25CdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0ZXN0aW5nXCI6XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnNldFRleHQoXCJUZXN0aW5nLi4uXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZXRyeVwiOlxuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFwiVHJ5IEFnYWluXCIpO1xuICAgICAgICAgIGFjdGlvbkJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNhdmVcIjpcbiAgICAgICAgICBhY3Rpb25CdXR0b24uc2V0VGV4dChcIlNhdmUgUHJvdmlkZXJcIik7XG4gICAgICAgICAgYWN0aW9uQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBGdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgaW5wdXRzXG4gICAgY29uc3QgdmFsaWRhdGVGb3JtID0gKCk6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSA9PiB7XG4gICAgICAvLyBDaGVjayBuYW1lXG4gICAgICBpZiAoIW5hbWVJbnB1dC52YWx1ZS50cmltKCkpIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIlByb3ZpZGVyIG5hbWUgaXMgcmVxdWlyZWRcIiB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBVUkxcbiAgICAgIGNvbnN0IHVybFZhbGlkYXRpb24gPSB2YWxpZGF0ZUVuZHBvaW50VXJsKHVybElucHV0LnZhbHVlKTtcbiAgICAgIGlmICghdXJsVmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgIHJldHVybiB1cmxWYWxpZGF0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBBUEkga2V5IChyZXF1aXJlZCBmb3Igbm9uLWxvY2FsIGVuZHBvaW50cylcbiAgICAgIGNvbnN0IGlzTG9jYWwgPVxuICAgICAgICB1cmxJbnB1dC52YWx1ZS5pbmNsdWRlcyhcImxvY2FsaG9zdFwiKSB8fFxuICAgICAgICB1cmxJbnB1dC52YWx1ZS5pbmNsdWRlcyhcIjEyNy4wLjAuMVwiKTtcbiAgICAgIGlmICghaXNMb2NhbCAmJiAhYXBpS2V5SW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IFwiQVBJIGtleSBpcyByZXF1aXJlZCBmb3IgcmVtb3RlIGVuZHBvaW50c1wiLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlIH07XG4gICAgfTtcblxuICAgIC8vIEhhbmRsZSBidXR0b24gY2xpY2tcbiAgICBhY3Rpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUZvcm0oKTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvclxuICAgICAgICB1cmxFcnJvci50ZXh0Q29udGVudCA9IHZhbGlkYXRpb24uZXJyb3IgfHwgXCJJbnZhbGlkIGZvcm0gZGF0YVwiO1xuICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNDb25uZWN0aW9uVGVzdGVkKSB7XG4gICAgICAgIC8vIFRlc3QgY29ubmVjdGlvblxuICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShcInRlc3RpbmdcIik7XG5cbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBjcmVhdGVQcm92aWRlckZyb21Gb3JtKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGx1Z2luLmN1c3RvbVByb3ZpZGVyU2VydmljZS50ZXN0Q29ubmVjdGlvbihcbiAgICAgICAgICBwcm92aWRlclxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGlzQ29ubmVjdGlvblRlc3RlZCA9IHRydWU7XG4gICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoXCJzYXZlXCIpO1xuICAgICAgICAgIHRlc3RSZXN1bHQgPSByZXN1bHQ7XG5cbiAgICAgICAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZVxuICAgICAgICAgIHVybEVycm9yLnRleHRDb250ZW50ID0gYENvbm5lY3Rpb24gc3VjY2Vzc2Z1bCEgRm91bmQgJHtcbiAgICAgICAgICAgIHJlc3VsdC5tb2RlbHM/Lmxlbmd0aCB8fCAwXG4gICAgICAgICAgfSBtb2RlbHMuYDtcbiAgICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItZXJyb3ItaGlkZGVuXCIpO1xuICAgICAgICAgIHVybEVycm9yLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LWN1c3RvbS1wcm92aWRlci1zdWNjZXNzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKFwicmV0cnlcIik7XG5cbiAgICAgICAgICAvLyBTaG93IGVycm9yIG1lc3NhZ2VcbiAgICAgICAgICB1cmxFcnJvci50ZXh0Q29udGVudCA9IHJlc3VsdC5lcnJvciB8fCBcIkNvbm5lY3Rpb24gZmFpbGVkXCI7XG4gICAgICAgICAgdXJsRXJyb3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY3VzdG9tLXByb3ZpZGVyLWVycm9yLWhpZGRlblwiKTtcbiAgICAgICAgICB1cmxFcnJvci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1jdXN0b20tcHJvdmlkZXItc3VjY2Vzc1wiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2F2ZSBwcm92aWRlclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IGNyZWF0ZVByb3ZpZGVyRnJvbUZvcm0oKTtcblxuICAgICAgICAvLyBBZGQgdG8gc2V0dGluZ3NcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzID0gW1xuICAgICAgICAgIC4uLnRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycyxcbiAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBTYXZlIHNldHRpbmdzXG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXG4gICAgICAgIC8vIEdldCBmcmVzaCBtb2RlbHNcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuXG4gICAgICAgIC8vIENsb3NlIGFuZCBnbyBiYWNrXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5vbkJhY2soKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldywgTm90aWNlLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQge1xuICBUcmFuc2NyaXB0aW9uU2VydmljZSxcbiAgdHlwZSBUcmFuc2NyaXB0aW9uQ29udGV4dCxcbn0gZnJvbSBcIi4vVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgQ0hBVF9WSUVXX1RZUEUsIENoYXRWaWV3IH0gZnJvbSBcIi4uL3ZpZXdzL2NoYXR2aWV3L0NoYXRWaWV3XCI7XG4vLyBFZGl0b3JIYW5kbGVyIGludGVyZmFjZSBhbmQgaW1wbGVtZW50YXRpb25zXG5pbnRlcmZhY2UgRWRpdG9ySGFuZGxlciB7XG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKTogdm9pZDtcbn1cblxuY2xhc3MgTWFya2Rvd25FZGl0b3JIYW5kbGVyIGltcGxlbWVudHMgRWRpdG9ySGFuZGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHApIHt9XG5cbiAgaW5zZXJ0VGV4dCh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICBpZiAoIWFjdGl2ZVZpZXc/LmVkaXRvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiTm8gYWN0aXZlIG1hcmtkb3duIGVkaXRvciBmb3VuZCBmb3IgcGFzdGluZ1wiKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChubyBhY3RpdmUgbm90ZSlcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZWRpdG9yID0gYWN0aXZlVmlldy5lZGl0b3I7XG4gICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3Vyc29yLmxpbmUpO1xuXG4gICAgY29uc3QgdGV4dFRvSW5zZXJ0ID0gdGV4dFxuICAgICAgPyBjdXJzb3IuY2ggPiAwICYmIGxpbmVDb250ZW50Lmxlbmd0aCA+IDBcbiAgICAgICAgPyBcIlxcblwiICsgdGV4dFxuICAgICAgICA6IHRleHRcbiAgICAgIDogXCJcIjtcblxuICAgIGlmICghdGV4dFRvSW5zZXJ0KSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyB0ZXh0IHRvIGluc2VydFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlZGl0b3IucmVwbGFjZVJhbmdlKHRleHRUb0luc2VydCwgY3Vyc29yKTtcbiAgICBjb25zdCBsaW5lcyA9IHRleHRUb0luc2VydC5zcGxpdChcIlxcblwiKTtcbiAgICBjb25zdCBsYXN0TGluZSA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdIHx8IFwiXCI7XG5cbiAgICBlZGl0b3Iuc2V0Q3Vyc29yKHtcbiAgICAgIGxpbmU6IGN1cnNvci5saW5lICsgbGluZXMubGVuZ3RoIC0gMSxcbiAgICAgIGNoOiBsYXN0TGluZS5sZW5ndGgsXG4gICAgfSk7XG5cbiAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gcGFzdGVkIGludG8gbm90ZVwiKTtcbiAgfVxufVxuXG5jbGFzcyBDaGF0RWRpdG9ySGFuZGxlciBpbXBsZW1lbnRzIEVkaXRvckhhbmRsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiAoKHRleHQ6IHN0cmluZykgPT4gdm9pZCkgfCB1bmRlZmluZWRcbiAgKSB7fVxuXG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgIHRoaXMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUodGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIGNoYXQgaGFuZGxlciBmb3VuZCBmb3IgdHJhbnNjcmlwdGlvblwiKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBjb3BpZWQgdG8gY2xpcGJvYXJkIChjaGF0IGhhbmRsZXIgbWlzc2luZylcIik7XG4gICAgfVxuICB9XG59XG5cbi8vIFByaW9yaXRpemVkIE1JTUUgdHlwZXMgZm9yIHJlY29yZGluZ1xuY29uc3QgUkVDT1JESU5HX0ZPUk1BVFMgPSBbXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vd2VibTtjb2RlY3M9b3B1c1wiLCBleHRlbnNpb246IFwid2VibVwiLCBzYW1wbGVSYXRlOiAxNjAwMCB9LCAvLyBPcHRpbWFsIGZvciBzcGVlY2gsIHNtYWxsIHNpemVcbiAgeyBtaW1lVHlwZTogXCJhdWRpby93ZWJtXCIsIGV4dGVuc2lvbjogXCJ3ZWJtXCIsIHNhbXBsZVJhdGU6IDQ4MDAwIH0sIC8vIEZhbGxiYWNrIHdpdGggZGVmYXVsdCBjb2RlY1xuICB7IG1pbWVUeXBlOiBcImF1ZGlvL29nZztjb2RlY3M9b3B1c1wiLCBleHRlbnNpb246IFwib2dnXCIsIHNhbXBsZVJhdGU6IDQ4MDAwIH0sIC8vIEFsdGVybmF0aXZlIE9wdXMgY29udGFpbmVyXG4gIHsgbWltZVR5cGU6IFwiYXVkaW8vd2F2XCIsIGV4dGVuc2lvbjogXCJ3YXZcIiwgc2FtcGxlUmF0ZTogNDgwMDAgfSwgLy8gTGFzdCByZXNvcnQgZmFsbGJhY2tcbl0gYXMgY29uc3Q7XG5cbmludGVyZmFjZSBBdWRpb0NodW5rIHtcbiAgYmxvYjogQmxvYjtcbiAgc2FtcGxlUmF0ZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgUmVjb3JkZXJPcHRpb25zIHtcbiAgaXNJbkNoYXQ/OiBib29sZWFuO1xuICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZT86ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmludGVyZmFjZSBSZWNvcmRpbmdDb250ZXh0IHtcbiAgaXNJbkNoYXQ6IGJvb2xlYW47XG4gIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlPzogKHRleHQ6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFJlY29yZGVyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBSZWNvcmRlclNlcnZpY2U7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBvblRvZ2dsZUNhbGxiYWNrczogU2V0PChpc1JlY29yZGluZzogYm9vbGVhbikgPT4gdm9pZD4gPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgbWVkaWFTdHJlYW06IE1lZGlhU3RyZWFtIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbWVkaWFSZWNvcmRlcjogTWVkaWFSZWNvcmRlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGNodW5rczogQXVkaW9DaHVua1tdID0gW107XG4gIHByaXZhdGUgc2VsZWN0ZWRGb3JtYXQ6ICh0eXBlb2YgUkVDT1JESU5HX0ZPUk1BVFMpW251bWJlcl0gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBsYXN0UmVjb3JkZWRGaWxlUGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhbmFseXNlcjogQW5hbHlzZXJOb2RlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYW5pbWF0aW9uRnJhbWU6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNtb290aGVkVmFsdWVzOiBGbG9hdDMyQXJyYXk7XG4gIHByaXZhdGUgcmVhZG9ubHkgc21vb3RoaW5nRmFjdG9yID0gMC40O1xuICBwcml2YXRlIHZpc3VhbGl6ZXJDYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY3VycmVudENvbnRleHQ6IFJlY29yZGluZ0NvbnRleHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWNvcmRpbmdNb2RhbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkcmFnQ2xlYW51cDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZWRpdG9ySGFuZGxlcjogRWRpdG9ySGFuZGxlciB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgb3B0aW9uczogUmVjb3JkZXJPcHRpb25zID0ge31cbiAgKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zbW9vdGhlZFZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkoMTI4KTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHQob3B0aW9ucyk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgb3B0aW9uczogUmVjb3JkZXJPcHRpb25zID0ge31cbiAgKTogUmVjb3JkZXJTZXJ2aWNlIHtcbiAgICBpZiAoIVJlY29yZGVyU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlID0gbmV3IFJlY29yZGVyU2VydmljZShhcHAsIHBsdWdpbik7XG4gICAgfVxuXG4gICAgLy8gQWx3YXlzIHVwZGF0ZSBjb250ZXh0IHdoZW4gZ2V0SW5zdGFuY2UgaXMgY2FsbGVkXG4gICAgUmVjb3JkZXJTZXJ2aWNlLmluc3RhbmNlLnVwZGF0ZUNvbnRleHQob3B0aW9ucyk7XG4gICAgcmV0dXJuIFJlY29yZGVyU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QWN0aXZlVmlld0luZm8oKTogeyBpc0NoYXQ6IGJvb2xlYW47IHZpZXdJZGVudGlmaWVyOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgYWN0aXZlTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVMZWFmO1xuICAgIGlmICghYWN0aXZlTGVhZikge1xuICAgICAgcmV0dXJuIHsgaXNDaGF0OiBmYWxzZSwgdmlld0lkZW50aWZpZXI6IFwidW5rbm93blwiIH07XG4gICAgfVxuXG4gICAgY29uc3Qgdmlld1N0YXRlID0gYWN0aXZlTGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICBjb25zdCB2aWV3VHlwZSA9IHZpZXdTdGF0ZS50eXBlO1xuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIGNoYXQgdmlld1xuICAgIGlmICh2aWV3VHlwZSA9PT0gQ0hBVF9WSUVXX1RZUEUpIHtcbiAgICAgIHJldHVybiB7IGlzQ2hhdDogdHJ1ZSwgdmlld0lkZW50aWZpZXI6IFwiY2hhdFwiIH07XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIG1hcmtkb3duIHZpZXdcbiAgICBjb25zdCBtYXJrZG93blZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgIGlmIChtYXJrZG93blZpZXc/LmZpbGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQ2hhdDogZmFsc2UsXG4gICAgICAgIHZpZXdJZGVudGlmaWVyOiBgbm90ZS0ke21hcmtkb3duVmlldy5maWxlLnBhdGh9YCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaXNDaGF0OiBmYWxzZSwgdmlld0lkZW50aWZpZXI6IFwidW5rbm93blwiIH07XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUNvbnRleHQob3B0aW9uczogUmVjb3JkZXJPcHRpb25zKSB7XG4gICAgY29uc3QgeyBpc0NoYXQgfSA9IHRoaXMuZ2V0QWN0aXZlVmlld0luZm8oKTtcbiAgICB0aGlzLmN1cnJlbnRDb250ZXh0ID0ge1xuICAgICAgaXNJbkNoYXQ6IGlzQ2hhdCxcbiAgICAgIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiBvcHRpb25zLm9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGluc2VydFRleHRJbnRvQWN0aXZlVmlldyh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCB7IGlzQ2hhdCB9ID0gdGhpcy5nZXRBY3RpdmVWaWV3SW5mbygpO1xuXG4gICAgaWYgKGlzQ2hhdCkge1xuICAgICAgY29uc3QgY2hhdFZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShDaGF0Vmlldyk7XG4gICAgICBpZiAoY2hhdFZpZXcpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBjaGF0Vmlldy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLnN5c3RlbXNjdWxwdC1jaGF0LWlucHV0XCJcbiAgICAgICAgKSBhcyBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICBjb25zdCBjdXJzb3JQb3MgPSBpbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuICAgICAgICAgIGlmIChjdXJzb3JQb3MgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEluc2VydCBhdCBjdXJzb3IgcG9zaXRpb25cbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID1cbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKDAsIGN1cnNvclBvcykgK1xuICAgICAgICAgICAgICB0ZXh0ICtcbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNsaWNlKGN1cnNvclBvcyk7XG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgLy8gTW92ZSBjdXJzb3IgdG8gZW5kIG9mIGluc2VydGVkIHRleHRcbiAgICAgICAgICAgIGlucHV0LnNlbGVjdGlvblN0YXJ0ID0gaW5wdXQuc2VsZWN0aW9uRW5kID0gY3Vyc29yUG9zICsgdGV4dC5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEFwcGVuZCB0byBlbmQgaWYgbm8gY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGN1cnJlbnRWYWx1ZSArIHRleHQ7XG4gICAgICAgICAgICBpbnB1dC5zZWxlY3Rpb25TdGFydCA9IGlucHV0LnNlbGVjdGlvbkVuZCA9IGlucHV0LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUcmlnZ2VyIGlucHV0IGV2ZW50IGZvciBoZWlnaHQgYWRqdXN0bWVudCBhbmQgdG9rZW4gY291bnRpbmdcbiAgICAgICAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcbiAgICAgICAgICAvLyBGb2N1cyB0aGUgaW5wdXQgYWZ0ZXIgaW5zZXJ0aW9uXG4gICAgICAgICAgaW5wdXQuZm9jdXMoKTtcblxuICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3MjggVHJhbnNjcmlwdGlvbiBwYXN0ZWQgaW50byBjaGF0XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcIkNoYXQgaW5wdXQgZWxlbWVudCBub3QgZm91bmRcIik7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIGNvcGllZCB0byBjbGlwYm9hcmQgKG5vIGNoYXQgaW5wdXQpXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJObyBhY3RpdmUgY2hhdCB2aWV3IGZvdW5kXCIpO1xuICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gYWN0aXZlIGNoYXQpXCIpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtYXJrZG93blZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgaWYgKCFtYXJrZG93blZpZXc/LmVkaXRvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJObyBhY3RpdmUgbWFya2Rvd24gZWRpdG9yIGZvdW5kXCIpO1xuICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzI4IFRyYW5zY3JpcHRpb24gY29waWVkIHRvIGNsaXBib2FyZCAobm8gYWN0aXZlIG5vdGUpXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVkaXRvciA9IG1hcmtkb3duVmlldy5lZGl0b3I7XG4gICAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgICBjb25zdCBsaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKTtcbiAgICAgIGNvbnN0IHRleHRUb0luc2VydCA9IHRleHRcbiAgICAgICAgPyBjdXJzb3IuY2ggPiAwICYmIGxpbmVDb250ZW50Lmxlbmd0aCA+IDBcbiAgICAgICAgICA/IFwiXFxuXCIgKyB0ZXh0XG4gICAgICAgICAgOiB0ZXh0XG4gICAgICAgIDogXCJcIjtcblxuICAgICAgaWYgKCF0ZXh0VG9JbnNlcnQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiTm8gdGV4dCB0byBpbnNlcnRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZSh0ZXh0VG9JbnNlcnQsIGN1cnNvcik7XG4gICAgICBjb25zdCBsaW5lcyA9IHRleHRUb0luc2VydC5zcGxpdChcIlxcblwiKTtcbiAgICAgIGNvbnN0IGxhc3RMaW5lID0gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0gfHwgXCJcIjtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3Ioe1xuICAgICAgICBsaW5lOiBjdXJzb3IubGluZSArIGxpbmVzLmxlbmd0aCAtIDEsXG4gICAgICAgIGNoOiBsYXN0TGluZS5sZW5ndGgsXG4gICAgICB9KTtcblxuICAgICAgbmV3IE5vdGljZShcIlx1MjcyOCBUcmFuc2NyaXB0aW9uIHBhc3RlZCBpbnRvIG5vdGVcIik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2NyaWJlTGFzdFJlY29yZGluZygpIHtcbiAgICBpZiAoIXRoaXMubGFzdFJlY29yZGVkRmlsZVBhdGgpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChcbiAgICAgICAgdGhpcy5sYXN0UmVjb3JkZWRGaWxlUGF0aFxuICAgICAgKTtcbiAgICAgIGlmICghZmlsZSB8fCAhKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcblxuICAgICAgY29uc3QgbW9kYWwgPSBuZXcgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwodGhpcy5hcHAsIHtcbiAgICAgICAgZmlsZSxcbiAgICAgICAgaXNDaGF0OiB0aGlzLmN1cnJlbnRDb250ZXh0Py5pc0luQ2hhdCA/PyBmYWxzZSxcbiAgICAgICAgb25UcmFuc2NyaXB0aW9uQ29tcGxldGU6ICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29udGV4dD8ub25UcmFuc2NyaXB0aW9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRleHQub25UcmFuc2NyaXB0aW9uQ29tcGxldGUodGV4dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0VGV4dEludG9BY3RpdmVWaWV3KHRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luOiB0aGlzLnBsdWdpbixcbiAgICAgIH0pO1xuICAgICAgbW9kYWwub3BlbigpO1xuXG4gICAgICAvLyBDbGVhbiB1cCB0aGUgcmVjb3JkaW5nIGZpbGVcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5kZWxldGUoZmlsZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gY2xlYW4gdXAgcmVjb3JkaW5nIGZpbGU6XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1dG8tdHJhbnNjcmlwdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJcdTI3NEMgRmFpbGVkIHRvIHRyYW5zY3JpYmUgYXVkaW9cIik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVJlY29yZGluZ01vZGFsKCk6IHZvaWQge1xuICAgIC8vIENsZWFudXAgYW55IG9sZCBpbnN0YW5jZVxuICAgIGlmICh0aGlzLnJlY29yZGluZ01vZGFsKSB7XG4gICAgICBpZiAodGhpcy5kcmFnQ2xlYW51cCkge1xuICAgICAgICB0aGlzLmRyYWdDbGVhbnVwKCk7XG4gICAgICAgIHRoaXMuZHJhZ0NsZWFudXAgPSBudWxsO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5yZW1vdmUoKTtcbiAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0aGUgbmV3IGZsb2F0aW5nIG1vZGFsXG4gICAgdGhpcy5yZWNvcmRpbmdNb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1tb2RhbFwiO1xuXG4gICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGVudC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1jb250ZW50XCI7XG5cbiAgICBjb25zdCBsaXZlSW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBsaXZlSW5kaWNhdG9yLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LXJlY29yZGVyLWxpdmVcIjtcbiAgICBsaXZlSW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJcdTI1Q0YgTGl2ZVwiO1xuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQobGl2ZUluZGljYXRvcik7XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhcy5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1yZWNvcmRlci1jYW52YXNcIjtcbiAgICBjb250ZW50LmFwcGVuZENoaWxkKGNhbnZhcyk7XG5cbiAgICB0aGlzLnJlY29yZGluZ01vZGFsLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5yZWNvcmRpbmdNb2RhbCk7XG5cbiAgICB0aGlzLmRyYWdDbGVhbnVwID0gdGhpcy5zZXR1cERyYWdnYWJsZSh0aGlzLnJlY29yZGluZ01vZGFsKTtcbiAgICB0aGlzLnNldFZpc3VhbGl6ZXJDYW52YXMoY2FudmFzKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBEcmFnZ2FibGUoZWxlbWVudDogSFRNTEVsZW1lbnQpOiAoKSA9PiB2b2lkIHtcbiAgICAvLyBUcmFjayBwb3NpdGlvbiBzdGF0ZVxuICAgIGxldCBwb3MgPSB7IHg6IDAsIHk6IDAgfTtcblxuICAgIC8vIENsZWFuIGV2ZW50IGhhbmRsaW5nXG4gICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImRyYWdnaW5nXCIpO1xuICAgIH07XG5cbiAgICAvLyBTaW1wbGUgbW92ZSBoYW5kbGVyIHdpdGggYm91bmRzIGNoZWNraW5nXG4gICAgY29uc3Qgb25Nb3ZlID0gKGNsaWVudFg6IG51bWJlciwgY2xpZW50WTogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHBvcy54ID0gTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KDAsIGNsaWVudFggLSByZWN0LndpZHRoIC8gMiksXG4gICAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC0gcmVjdC53aWR0aFxuICAgICAgKTtcbiAgICAgIHBvcy55ID0gTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KDAsIGNsaWVudFkgLSByZWN0LmhlaWdodCAvIDIpLFxuICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHQgLSByZWN0LmhlaWdodFxuICAgICAgKTtcblxuICAgICAgLy8gUmVtb3ZlIGJvdHRvbS9yaWdodCBwb3NpdGlvbmluZyB3aGVuIGRyYWdnaW5nIHN0YXJ0c1xuICAgICAgZWxlbWVudC5zdHlsZS5ib3R0b20gPSBcIlwiO1xuICAgICAgZWxlbWVudC5zdHlsZS5yaWdodCA9IFwiXCI7XG5cbiAgICAgIC8vIEFwcGx5IG5ldyBwb3NpdGlvblxuICAgICAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7cG9zLnh9cHhgO1xuICAgICAgZWxlbWVudC5zdHlsZS50b3AgPSBgJHtwb3MueX1weGA7XG4gICAgfTtcblxuICAgIC8vIFBvaW50ZXIgZXZlbnQgaGFuZGxlcnNcbiAgICBjb25zdCBvblBvaW50ZXJEb3duID0gKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xuICAgICAgLy8gT25seSBoYW5kbGUgbGVmdCBjbGljayBvciB0b3VjaFxuICAgICAgaWYgKGUuYnV0dG9uICE9PSAwICYmIGUuYnV0dG9uICE9PSAtMSkgcmV0dXJuO1xuXG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkcmFnZ2luZ1wiKTtcbiAgICAgIGVsZW1lbnQuc2V0UG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpO1xuXG4gICAgICAvLyBTZXQgaW5pdGlhbCBwb3NpdGlvbiBiYXNlZCBvbiBjdXJyZW50IGxvY2F0aW9uXG4gICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHBvcy54ID0gcmVjdC5sZWZ0O1xuICAgICAgcG9zLnkgPSByZWN0LnRvcDtcblxuICAgICAgLy8gSW5pdGlhbCBtb3ZlIHRvIHByZXZlbnQganVtcHNcbiAgICAgIG9uTW92ZShlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uUG9pbnRlck1vdmUgPSAoZTogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5oYXNQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCkpIHtcbiAgICAgICAgb25Nb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgb25Qb2ludGVyVXAgPSAoZTogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICBjbGVhbnVwKCk7XG4gICAgICBlbGVtZW50LnJlbGVhc2VQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7XG4gICAgfTtcblxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBvblBvaW50ZXJEb3duKTtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLCBvblBvaW50ZXJNb3ZlKTtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIiwgb25Qb2ludGVyVXApO1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIiwgY2xlYW51cCk7XG5cbiAgICAvLyBDbGVhbnVwIGZ1bmN0aW9uIGZvciByZW1vdmluZyBsaXN0ZW5lcnNcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcmRvd25cIiwgb25Qb2ludGVyRG93bik7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLCBvblBvaW50ZXJNb3ZlKTtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBvblBvaW50ZXJVcCk7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsIGNsZWFudXApO1xuICAgIH07XG4gIH1cblxuICBhc3luYyB0b2dnbGVSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGhpcy5pc1JlY29yZGluZykge1xuICAgICAgICBjb25zdCB7IGlzQ2hhdCwgdmlld0lkZW50aWZpZXIgfSA9IHRoaXMuZ2V0QWN0aXZlVmlld0luZm8oKTtcblxuICAgICAgICBpZiAodmlld0lkZW50aWZpZXIgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlx1MjZBMFx1RkUwRiBQbGVhc2Ugb3BlbiBhIG5vdGUgb3IgY2hhdCBiZWZvcmUgcmVjb3JkaW5nXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgcmVjb3JkaW5nIGluIHZpZXc6XCIsIHtcbiAgICAgICAgICBpc0NoYXQsXG4gICAgICAgICAgdmlld0lkZW50aWZpZXIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBjb250ZXh0IHdpdGggY3VycmVudCB2aWV3IGluZm9cbiAgICAgICAgdGhpcy51cGRhdGVDb250ZXh0KHtcbiAgICAgICAgICBpc0luQ2hhdDogaXNDaGF0LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBbHdheXMgY3JlYXRlIHRoZSBkcmFnZ2FibGUgbW9kYWxcbiAgICAgICAgdGhpcy5jcmVhdGVSZWNvcmRpbmdNb2RhbCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc1JlY29yZGluZykge1xuICAgICAgICBhd2FpdCB0aGlzLnN0b3BSZWNvcmRpbmcoKTtcblxuICAgICAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgICAgIGlmICh0aGlzLmRyYWdDbGVhbnVwKSB7XG4gICAgICAgICAgICB0aGlzLmRyYWdDbGVhbnVwKCk7XG4gICAgICAgICAgICB0aGlzLmRyYWdDbGVhbnVwID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5yZWNvcmRpbmdNb2RhbC5yZW1vdmUoKTtcbiAgICAgICAgICB0aGlzLnJlY29yZGluZ01vZGFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydFJlY29yZGluZygpO1xuICAgICAgICBpZiAodGhpcy5yZWNvcmRpbmdNb2RhbCkge1xuICAgICAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuY2xhc3NMaXN0LmFkZChcInJlY29yZGluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdG9nZ2xpbmcgcmVjb3JkaW5nOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byB0b2dnbGUgcmVjb3JkaW5nXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlUmVjb3JkaW5nRGlyZWN0b3J5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRpciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3Rvcnk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKGRpcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCI7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSByZWNvcmRpbmdzIGRpcmVjdG9yeTpcIiwgZXJyb3JNZXNzYWdlKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSByZWNvcmRpbmdzIGRpcmVjdG9yeTogJHtlcnJvck1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RTdXBwb3J0ZWRGb3JtYXQoKTogUHJvbWlzZTxcbiAgICAodHlwZW9mIFJFQ09SRElOR19GT1JNQVRTKVtudW1iZXJdXG4gID4ge1xuICAgIGZvciAoY29uc3QgZm9ybWF0IG9mIFJFQ09SRElOR19GT1JNQVRTKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoZm9ybWF0Lm1pbWVUeXBlKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBTZWxlY3RlZCByZWNvcmRpbmcgZm9ybWF0OiAke2Zvcm1hdC5taW1lVHlwZX1gKTtcbiAgICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYEZvcm1hdCAke2Zvcm1hdC5taW1lVHlwZX0gY2hlY2sgZmFpbGVkOmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gc3VwcG9ydGVkIGF1ZGlvIHJlY29yZGluZyBmb3JtYXQgZm91bmRcIik7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlRmlsZU5hbWUoKTogc3RyaW5nIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5vd1xuICAgICAgLnRvSVNPU3RyaW5nKClcbiAgICAgIC5yZXBsYWNlKC9bOi5dL2csIFwiLVwiKVxuICAgICAgLnJlcGxhY2UoXCJUXCIsIFwiX1wiKVxuICAgICAgLnNwbGl0KFwiLlwiKVswXTtcbiAgICByZXR1cm4gYCR7dGltZXN0YW1wfS4ke3RoaXMuc2VsZWN0ZWRGb3JtYXQ/LmV4dGVuc2lvbiB8fCBcImF1ZGlvXCJ9YDtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTogdm9pZCB7XG4gICAgLy8gUmVzZXQgc21vb3RoZWQgdmFsdWVzXG4gICAgdGhpcy5zbW9vdGhlZFZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkoMTI4KTtcblxuICAgIC8vIENhbmNlbCBhbnkgb25nb2luZyBhbmltYXRpb25cbiAgICBpZiAodGhpcy5hbmltYXRpb25GcmFtZSkge1xuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25GcmFtZSk7XG4gICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBQcm9wZXJseSBkaXNjb25uZWN0IGFuZCBudWxsIG91dCBhbmFseXplclxuICAgIGlmICh0aGlzLmFuYWx5c2VyKSB7XG4gICAgICB0aGlzLmFuYWx5c2VyLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuYW5hbHlzZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENsb3NlIGFuZCBudWxsIG91dCBhdWRpbyBjb250ZXh0XG4gICAgaWYgKHRoaXMuYXVkaW9Db250ZXh0KSB7XG4gICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jbG9zZSgpO1xuICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGNhbnZhcyBpZiBpdCBleGlzdHNcbiAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgaWYgKGN0eCkge1xuICAgICAgICBjdHguY2xlYXJSZWN0KFxuICAgICAgICAgIDAsXG4gICAgICAgICAgMCxcbiAgICAgICAgICB0aGlzLnZpc3VhbGl6ZXJDYW52YXMud2lkdGgsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBWaXN1YWxpemF0aW9uKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tZWRpYVN0cmVhbSkgcmV0dXJuO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyBhdWRpbyBjb250ZXh0XG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KHtcbiAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgbGF0ZW5jeUhpbnQ6IFwiaW50ZXJhY3RpdmVcIixcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBhbmQgY29ubmVjdCBtZWRpYSBzdHJlYW0gc291cmNlXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UodGhpcy5tZWRpYVN0cmVhbSk7XG5cbiAgICAvLyBDcmVhdGUgYW5kIGNvbmZpZ3VyZSBhbmFseXplclxuICAgIHRoaXMuYW5hbHlzZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVBbmFseXNlcigpO1xuICAgIHRoaXMuYW5hbHlzZXIuZmZ0U2l6ZSA9IDI1NjtcbiAgICB0aGlzLmFuYWx5c2VyLnNtb290aGluZ1RpbWVDb25zdGFudCA9IDAuNztcblxuICAgIC8vIENvbm5lY3Qgc291cmNlIHRvIGFuYWx5emVyXG4gICAgc291cmNlLmNvbm5lY3QodGhpcy5hbmFseXNlcik7XG5cbiAgICAvLyBTdGFydCB2aXN1YWxpemF0aW9uIGlmIGNhbnZhcyBleGlzdHNcbiAgICBpZiAodGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNhbnZhc1NpemUoKTtcbiAgICAgIHRoaXMuZHJhdygpO1xuICAgIH1cbiAgfVxuXG4gIHNldFZpc3VhbGl6ZXJDYW52YXMoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCB8IG51bGwpOiB2b2lkIHtcbiAgICAvLyBDbGVhbiB1cCBvbGQgY2FudmFzXG4gICAgaWYgKHRoaXMudmlzdWFsaXplckNhbnZhcykge1xuICAgICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGlmIChjdHgpIHtcbiAgICAgICAgY3R4LmNsZWFyUmVjdChcbiAgICAgICAgICAwLFxuICAgICAgICAgIDAsXG4gICAgICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoLFxuICAgICAgICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy5oZWlnaHRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXNldCBzdGF0ZSBpZiByZW1vdmluZyBjYW52YXNcbiAgICBpZiAoIWNhbnZhcykge1xuICAgICAgdGhpcy5yZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpO1xuICAgIH1cblxuICAgIHRoaXMudmlzdWFsaXplckNhbnZhcyA9IGNhbnZhcztcblxuICAgIC8vIEluaXRpYWxpemUgbmV3IGNhbnZhcyBpZiByZWNvcmRpbmdcbiAgICBpZiAoY2FudmFzICYmIHRoaXMuaXNSZWNvcmRpbmcpIHtcbiAgICAgIHRoaXMudXBkYXRlQ2FudmFzU2l6ZSgpO1xuICAgICAgLy8gUmVpbml0aWFsaXplIHZpc3VhbGl6YXRpb24gaWYgbmVlZGVkXG4gICAgICBpZiAoIXRoaXMuYXVkaW9Db250ZXh0IHx8ICF0aGlzLmFuYWx5c2VyKSB7XG4gICAgICAgIHRoaXMuc2V0dXBWaXN1YWxpemF0aW9uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUNhbnZhc1NpemUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHJldHVybjtcblxuICAgIGNvbnN0IHJlY3QgPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblxuICAgIHRoaXMudmlzdWFsaXplckNhbnZhcy53aWR0aCA9IHJlY3Qud2lkdGggKiBkcHI7XG4gICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodCA9IHJlY3QuaGVpZ2h0ICogZHByO1xuXG4gICAgY29uc3QgY3R4ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBpZiAoY3R4KSB7XG4gICAgICBjdHguc2NhbGUoZHByLCBkcHIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc3RhcnRSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuaXNSZWNvcmRpbmcpIHJldHVybjtcblxuICAgIC8vIFJlc2V0IGFsbCB2aXN1YWxpemF0aW9uIHN0YXRlIGJlZm9yZSBzdGFydGluZ1xuICAgIHRoaXMucmVzZXRWaXN1YWxpemF0aW9uU3RhdGUoKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmVuc3VyZVJlY29yZGluZ0RpcmVjdG9yeSgpO1xuXG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB3ZSBoYXZlIHBlcm1pc3Npb25cbiAgICAgIGNvbnN0IHBlcm1pc3Npb25SZXN1bHQgPSBhd2FpdCBuYXZpZ2F0b3IucGVybWlzc2lvbnMucXVlcnkoe1xuICAgICAgICBuYW1lOiBcIm1pY3JvcGhvbmVcIiBhcyBQZXJtaXNzaW9uTmFtZSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocGVybWlzc2lvblJlc3VsdC5zdGF0ZSA9PT0gXCJkZW5pZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaWNyb3Bob25lIHBlcm1pc3Npb24gZGVuaWVkXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZXRlY3Qgc3VwcG9ydGVkIGZvcm1hdCBiZWZvcmUgc3RhcnRpbmdcbiAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtYXQgPSBhd2FpdCB0aGlzLmRldGVjdFN1cHBvcnRlZEZvcm1hdCgpO1xuXG4gICAgICBjb25zdCBhdWRpb0NvbnN0cmFpbnRzOiBNZWRpYVRyYWNrQ29uc3RyYWludHMgPSB7XG4gICAgICAgIGVjaG9DYW5jZWxsYXRpb246IHRydWUsXG4gICAgICAgIG5vaXNlU3VwcHJlc3Npb246IHRydWUsXG4gICAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgICBjaGFubmVsQ291bnQ6IDEsIC8vIE1vbm8gZm9yIHNwZWVjaFxuICAgICAgfTtcblxuICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGRldmljZXMgPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKTtcbiAgICAgICAgICBjb25zdCBwcmVmZXJyZWREZXZpY2UgPSBkZXZpY2VzLmZpbmQoXG4gICAgICAgICAgICAoZGV2aWNlKSA9PlxuICAgICAgICAgICAgICBkZXZpY2Uua2luZCA9PT0gXCJhdWRpb2lucHV0XCIgJiZcbiAgICAgICAgICAgICAgZGV2aWNlLmRldmljZUlkID09PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmZXJyZWRNaWNyb3Bob25lSWRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKHByZWZlcnJlZERldmljZSkge1xuICAgICAgICAgICAgYXVkaW9Db25zdHJhaW50cy5kZXZpY2VJZCA9IHtcbiAgICAgICAgICAgICAgZXhhY3Q6IHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByZWZlcnJlZE1pY3JvcGhvbmVJZCA9IFwiXCI7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICBcIlByZWZlcnJlZCBtaWNyb3Bob25lIG5vdCBmb3VuZCwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHRcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoZWNraW5nIG1pY3JvcGhvbmUgZGV2aWNlczpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcXVlc3QgbWVkaWEgc3RyZWFtXG4gICAgICB0aGlzLm1lZGlhU3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICBhdWRpbzogYXVkaW9Db25zdHJhaW50cyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgbWVkaWEgcmVjb3JkZXJcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlciA9IG5ldyBNZWRpYVJlY29yZGVyKHRoaXMubWVkaWFTdHJlYW0sIHtcbiAgICAgICAgbWltZVR5cGU6IHRoaXMuc2VsZWN0ZWRGb3JtYXQubWltZVR5cGUsXG4gICAgICB9KTtcblxuICAgICAgLy8gU2V0IHVwIGRhdGEgaGFuZGxpbmdcbiAgICAgIHRoaXMuY2h1bmtzID0gW107XG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIub25kYXRhYXZhaWxhYmxlID0gYXN5bmMgKGU6IEJsb2JFdmVudCkgPT4ge1xuICAgICAgICBpZiAoZS5kYXRhLnNpemUgPiAwKSB7XG4gICAgICAgICAgdGhpcy5jaHVua3MucHVzaCh7XG4gICAgICAgICAgICBibG9iOiBlLmRhdGEsXG4gICAgICAgICAgICBzYW1wbGVSYXRlOiB0aGlzLnNlbGVjdGVkRm9ybWF0Py5zYW1wbGVSYXRlID8/IDQ4MDAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBIYW5kbGUgcmVjb3JkaW5nIHN0b3BcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5vbnN0b3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gU2F2ZSB0aGUgcmVjb3JkaW5nXG4gICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLmdlbmVyYXRlRmlsZU5hbWUoKTtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3Rvcnl9LyR7ZmlsZU5hbWV9YDtcblxuICAgICAgICAgIC8vIENvbWJpbmUgYWxsIGNodW5rcyBpbnRvIGEgc2luZ2xlIGJsb2JcbiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoXG4gICAgICAgICAgICB0aGlzLmNodW5rcy5tYXAoKGNodW5rKSA9PiBjaHVuay5ibG9iKSxcbiAgICAgICAgICAgIHsgdHlwZTogdGhpcy5zZWxlY3RlZEZvcm1hdD8ubWltZVR5cGUgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IGJsb2IgdG8gYXJyYXkgYnVmZmVyXG4gICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgICAgICAvLyBTYXZlIHRvIGZpbGVcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuYWRhcHRlci53cml0ZUJpbmFyeShcbiAgICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgICAgYXJyYXlCdWZmZXJcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gU3RvcmUgdGhlIHBhdGggZm9yIHRyYW5zY3JpcHRpb25cbiAgICAgICAgICB0aGlzLmxhc3RSZWNvcmRlZEZpbGVQYXRoID0gZmlsZVBhdGg7XG5cbiAgICAgICAgICAvLyBTdGFydCB0cmFuc2NyaXB0aW9uXG4gICAgICAgICAgYXdhaXQgdGhpcy50cmFuc2NyaWJlTGFzdFJlY29yZGluZygpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSByZWNvcmRpbmc6XCIsIGVycm9yKTtcbiAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byBzYXZlIHJlY29yZGluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gU3RhcnQgcmVjb3JkaW5nIHdpdGggYSBzbWFsbGVyIHRpbWVzbGljZSBmb3IgbW9yZSBmcmVxdWVudCBvbmRhdGFhdmFpbGFibGUgZXZlbnRzXG4gICAgICB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhcnQoMTAwMCk7XG5cbiAgICAgIC8vIFNldCB1cCB2aXN1YWxpemF0aW9uIGNoYWluXG4gICAgICB0aGlzLnNldHVwVmlzdWFsaXphdGlvbigpO1xuXG4gICAgICB0aGlzLmlzUmVjb3JkaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKCk7XG5cbiAgICAgIC8vIFN0YXJ0IHZpc3VhbGl6YXRpb24gaW1tZWRpYXRlbHlcbiAgICAgIGlmICh0aGlzLnZpc3VhbGl6ZXJDYW52YXMpIHtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWNvcmRpbmcgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJSZWNvcmRpbmcgZmFpbGVkXCI7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHN0b3BSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzUmVjb3JkaW5nKSByZXR1cm47XG5cbiAgICAvLyBTdG9wIG1lZGlhIHJlY29yZGVyIGZpcnN0XG4gICAgaWYgKHRoaXMubWVkaWFSZWNvcmRlciAmJiB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgIT09IFwiaW5hY3RpdmVcIikge1xuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0b3AoKTtcbiAgICB9XG5cbiAgICAvLyBTdG9wIGFsbCBtZWRpYSB0cmFja3NcbiAgICBpZiAodGhpcy5tZWRpYVN0cmVhbSkge1xuICAgICAgdGhpcy5tZWRpYVN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4gdHJhY2suc3RvcCgpKTtcbiAgICAgIHRoaXMubWVkaWFTdHJlYW0gPSBudWxsO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IGFsbCB2aXN1YWxpemF0aW9uIHN0YXRlXG4gICAgdGhpcy5yZXNldFZpc3VhbGl6YXRpb25TdGF0ZSgpO1xuXG4gICAgLy8gUmVtb3ZlIHJlY29yZGluZyBjbGFzcyBmcm9tIG1vZGFsXG4gICAgaWYgKHRoaXMucmVjb3JkaW5nTW9kYWwpIHtcbiAgICAgIHRoaXMucmVjb3JkaW5nTW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcInJlY29yZGluZ1wiKTtcbiAgICB9XG5cbiAgICB0aGlzLm1lZGlhUmVjb3JkZXIgPSBudWxsO1xuICAgIHRoaXMuaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3ID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5pc1JlY29yZGluZyB8fCAhdGhpcy5hbmFseXNlciB8fCAhdGhpcy52aXN1YWxpemVyQ2FudmFzKSB7XG4gICAgICBpZiAodGhpcy5hbmltYXRpb25GcmFtZSkge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIGFuaW1hdGlvbiBmcmFtZSBiZWZvcmUgc3RhcnRpbmcgbmV3IG9uZVxuICAgIGlmICh0aGlzLmFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcbiAgICAgIHRoaXMuYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYW5hbHlzZXIuZnJlcXVlbmN5QmluQ291bnQ7XG4gICAgY29uc3QgZGF0YUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyTGVuZ3RoKTtcbiAgICB0aGlzLmFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7XG5cbiAgICBjb25zdCBjdHggPSB0aGlzLnZpc3VhbGl6ZXJDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSByZXR1cm47XG5cbiAgICAvLyBDbGVhciB0aGUgY2FudmFzIGJlZm9yZSBkcmF3aW5nXG4gICAgY3R4LmNsZWFyUmVjdChcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLndpZHRoLFxuICAgICAgdGhpcy52aXN1YWxpemVyQ2FudmFzLmhlaWdodFxuICAgICk7XG5cbiAgICBjb25zdCByZWN0ID0gdGhpcy52aXN1YWxpemVyQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHdpZHRoID0gcmVjdC53aWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSByZWN0LmhlaWdodDtcbiAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjtcbiAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHJlc3BvbnNpdmUgdmFsdWVzIGJhc2VkIG9uIHNjcmVlbiB3aWR0aFxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2lkdGggPD0gNDAwO1xuICAgIGNvbnN0IG92ZXJsYXAgPSBpc01vYmlsZSA/IDMgOiA1OyAvLyBSZWR1Y2VkIG92ZXJsYXAgcG9pbnRzIGZvciBtb2JpbGVcbiAgICBjb25zdCBjZW50ZXJPdmVybGFwU2NhbGUgPSBpc01vYmlsZSA/IDQgOiA4OyAvLyBSZWR1Y2VkIGNlbnRlciBvdmVybGFwIGZvciBtb2JpbGVcbiAgICBjb25zdCBhbXBsaXR1ZGVTY2FsZSA9IGlzTW9iaWxlID8gMC44IDogMC45NTsgLy8gU2xpZ2h0bHkgcmVkdWNlZCBhbXBsaXR1ZGUgZm9yIG1vYmlsZVxuICAgIGNvbnN0IGVkZ2Vab25lU2NhbGUgPSBpc01vYmlsZSA/IDAuMTUgOiAwLjI7IC8vIEFkanVzdGVkIGVkZ2UgdGFwZXIgem9uZSBmb3IgbW9iaWxlXG5cbiAgICAvLyBHZXQgdGhlIGNvbXB1dGVkIGFjY2VudCBjb2xvciB3aXRoIGZhbGxiYWNrXG4gICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTtcbiAgICBsZXQgYWNjZW50Q29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLXRleHQtYWNjZW50XCIpLnRyaW0oKTtcbiAgICBpZiAoIWFjY2VudENvbG9yKSB7XG4gICAgICBhY2NlbnRDb2xvciA9IFwiIzU4NzFlZlwiO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBncmFkaWVudFxuICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIGhlaWdodCk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIGFjY2VudENvbG9yKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCBhY2NlbnRDb2xvcik7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIGFjY2VudENvbG9yKTtcbiAgICBjdHguZmlsbFN0eWxlID0gZ3JhZGllbnQ7XG5cbiAgICAvLyBEcmF3IHRoZSB3YXZlZm9ybVxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKGNlbnRlclgsIGNlbnRlclkpO1xuXG4gICAgY29uc3QgaGFsZkJ1ZmZlckxlbmd0aCA9IE1hdGguZmxvb3IoYnVmZmVyTGVuZ3RoIC8gMik7XG4gICAgY29uc3Qgc2xpY2VXaWR0aCA9IHdpZHRoIC8gMiAvIGhhbGZCdWZmZXJMZW5ndGg7XG4gICAgY29uc3QgY2VudGVyT3ZlcmxhcCA9IHNsaWNlV2lkdGggKiBjZW50ZXJPdmVybGFwU2NhbGU7XG5cbiAgICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGVkZ2UgdGFwZXJcbiAgICBjb25zdCBnZXRFZGdlVGFwZXIgPSAoaTogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBlZGdlWm9uZSA9IHRvdGFsICogZWRnZVpvbmVTY2FsZTtcbiAgICAgIGlmIChpIDwgZWRnZVpvbmUpIHtcbiAgICAgICAgcmV0dXJuIDAuMyArIDAuNyAqIChpIC8gZWRnZVpvbmUpO1xuICAgICAgfSBlbHNlIGlmIChpID4gdG90YWwgLSBlZGdlWm9uZSkge1xuICAgICAgICByZXR1cm4gMC4zICsgMC43ICogKCh0b3RhbCAtIGkpIC8gZWRnZVpvbmUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDE7XG4gICAgfTtcblxuICAgIC8vIERyYXcgcmlnaHQgc2lkZSAodG9wIGhhbGYpXG4gICAgZm9yIChsZXQgaSA9IC1vdmVybGFwOyBpIDwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXA7IGkrKykge1xuICAgICAgY29uc3QgdmFsdWUgPSBkYXRhQXJyYXlbTWF0aC5hYnMoaSldIC8gMjU1LjA7XG4gICAgICBjb25zdCBpbmRleCA9IE1hdGgubWluKE1hdGguYWJzKGkpLCBoYWxmQnVmZmVyTGVuZ3RoIC0gMSk7XG4gICAgICB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSA9XG4gICAgICAgIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogdGhpcy5zbW9vdGhpbmdGYWN0b3IgK1xuICAgICAgICB2YWx1ZSAqICgxIC0gdGhpcy5zbW9vdGhpbmdGYWN0b3IpO1xuXG4gICAgICBjb25zdCB4ID0gY2VudGVyWCArIGkgKiBzbGljZVdpZHRoIC0gY2VudGVyT3ZlcmxhcDtcbiAgICAgIGNvbnN0IHRhcGVyID0gZ2V0RWRnZVRhcGVyKGkgKyBvdmVybGFwLCBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAqIDIpO1xuICAgICAgY29uc3QgeSA9XG4gICAgICAgIGNlbnRlclkgLSB0aGlzLnNtb290aGVkVmFsdWVzW2luZGV4XSAqIGNlbnRlclkgKiBhbXBsaXR1ZGVTY2FsZSAqIHRhcGVyO1xuICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICB9XG5cbiAgICAvLyBEcmF3IHJpZ2h0IHNpZGUgKGJvdHRvbSBoYWxmKVxuICAgIGZvciAobGV0IGkgPSBoYWxmQnVmZmVyTGVuZ3RoICsgb3ZlcmxhcCAtIDE7IGkgPj0gLW92ZXJsYXA7IGktLSkge1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihNYXRoLmFicyhpKSwgaGFsZkJ1ZmZlckxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgeCA9IGNlbnRlclggKyBpICogc2xpY2VXaWR0aCAtIGNlbnRlck92ZXJsYXA7XG4gICAgICBjb25zdCB0YXBlciA9IGdldEVkZ2VUYXBlcihpICsgb3ZlcmxhcCwgaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgKiAyKTtcbiAgICAgIGNvbnN0IHkgPVxuICAgICAgICBjZW50ZXJZICsgdGhpcy5zbW9vdGhlZFZhbHVlc1tpbmRleF0gKiBjZW50ZXJZICogYW1wbGl0dWRlU2NhbGUgKiB0YXBlcjtcbiAgICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBsZWZ0IHNpZGUgKGJvdHRvbSBoYWxmKVxuICAgIGZvciAobGV0IGkgPSAtb3ZlcmxhcDsgaSA8IGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwOyBpKyspIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYIC0gaSAqIHNsaWNlV2lkdGggKyBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSArIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIC8vIERyYXcgbGVmdCBzaWRlICh0b3AgaGFsZilcbiAgICBmb3IgKGxldCBpID0gaGFsZkJ1ZmZlckxlbmd0aCArIG92ZXJsYXAgLSAxOyBpID49IC1vdmVybGFwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5taW4oTWF0aC5hYnMoaSksIGhhbGZCdWZmZXJMZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IHggPSBjZW50ZXJYIC0gaSAqIHNsaWNlV2lkdGggKyBjZW50ZXJPdmVybGFwO1xuICAgICAgY29uc3QgdGFwZXIgPSBnZXRFZGdlVGFwZXIoaSArIG92ZXJsYXAsIGhhbGZCdWZmZXJMZW5ndGggKyBvdmVybGFwICogMik7XG4gICAgICBjb25zdCB5ID1cbiAgICAgICAgY2VudGVyWSAtIHRoaXMuc21vb3RoZWRWYWx1ZXNbaW5kZXhdICogY2VudGVyWSAqIGFtcGxpdHVkZVNjYWxlICogdGFwZXI7XG4gICAgICBjdHgubGluZVRvKHgsIHkpO1xuICAgIH1cblxuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguZmlsbCgpO1xuXG4gICAgLy8gU2NoZWR1bGUgbmV4dCBmcmFtZSBvbmx5IGlmIHN0aWxsIHJlY29yZGluZ1xuICAgIGlmICh0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhdyk7XG4gICAgfVxuICB9O1xuXG4gIG9uVG9nZ2xlKGNhbGxiYWNrOiAoaXNSZWNvcmRpbmc6IGJvb2xlYW4pID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG9nZ2xlQ2FsbGJhY2tzLmFkZChjYWxsYmFjayk7XG4gIH1cblxuICBwcml2YXRlIG5vdGlmeUxpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG9nZ2xlQ2FsbGJhY2tzLmZvckVhY2goKGNiKSA9PiBjYih0aGlzLmlzUmVjb3JkaW5nKSk7XG4gIH1cblxuICB1bmxvYWQoKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wUmVjb3JkaW5nKCk7XG4gICAgdGhpcy5vblRvZ2dsZUNhbGxiYWNrcy5jbGVhcigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIHNldEljb24sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvUG9zdFByb2Nlc3NpbmdTZXJ2aWNlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXVkaW9UcmFuc2NyaXB0aW9uUHJvZ3Jlc3Mge1xuICBwcm9ncmVzczogbnVtYmVyO1xuICBzdGF0dXM6IHN0cmluZztcbiAgaWNvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnMge1xuICBmaWxlOiBURmlsZTtcbiAgdGltZXN0YW1wZWQ/OiBib29sZWFuO1xuICBpc0NoYXQ/OiBib29sZWFuO1xuICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZT86ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xufVxuXG5jbGFzcyBQZXJzaXN0ZW50VHJhbnNjcmlwdGlvbk5vdGljZSBleHRlbmRzIE5vdGljZSB7XG4gIHByaXZhdGUgcHJvZ3Jlc3NCYXI6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHN0YXR1c1RleHQ6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHN0YXR1c0ljb246IEhUTUxEaXZFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFwiXCIsIDApOyAvLyBOZXZlciBhdXRvLWhpZGVcbiAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlXCIpO1xuXG4gICAgLy8gQ3JlYXRlIHByb2dyZXNzIGNvbnRhaW5lclxuICAgIGNvbnN0IHByb2dyZXNzQ29udGFpbmVyID0gdGhpcy5ub3RpY2VFbC5jcmVhdGVEaXYoXCJ0cmFuc2NyaXB0aW9uLXByb2dyZXNzXCIpO1xuXG4gICAgLy8gQWRkIHN0YXR1cyBjb250YWluZXIgd2l0aCBpY29uIGFuZCB0ZXh0XG4gICAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gcHJvZ3Jlc3NDb250YWluZXIuY3JlYXRlRGl2KFwidHJhbnNjcmlwdGlvbi1zdGF0dXNcIik7XG4gICAgdGhpcy5zdGF0dXNJY29uID0gc3RhdHVzQ29udGFpbmVyLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tc3RhdHVzLWljb25cIik7XG4gICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzQ29udGFpbmVyLmNyZWF0ZURpdihcInRyYW5zY3JpcHRpb24tc3RhdHVzLXRleHRcIik7XG5cbiAgICAvLyBBZGQgcHJvZ3Jlc3MgYmFyXG4gICAgY29uc3QgcHJvZ3Jlc3NCYXJDb250YWluZXIgPSBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVEaXYoXG4gICAgICBcInRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzQmFyID0gcHJvZ3Jlc3NCYXJDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJ0cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhclwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBzdHlsZXMgaWYgbm90IGFscmVhZHkgYWRkZWRcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlLXN0eWxlc1wiKSkge1xuICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICBzdHlsZS5pZCA9IFwic3lzdGVtc2N1bHB0LXRyYW5zY3JpcHRpb24tbm90aWNlLXN0eWxlc1wiO1xuICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgICAgIC5zeXN0ZW1zY3VscHQtdHJhbnNjcmlwdGlvbi1ub3RpY2Uge1xuICAgICAgICAgIHBhZGRpbmc6IDhweCAxMnB4ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgbWluLXdpZHRoOiAyNjBweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzIHtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgICAgICAgZ2FwOiA4cHg7XG4gICAgICAgIH1cblxuICAgICAgICAudHJhbnNjcmlwdGlvbi1zdGF0dXMge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBnYXA6IDhweDtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tc3RhdHVzLWljb24ge1xuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tc3RhdHVzLXRleHQge1xuICAgICAgICAgIGZsZXg6IDE7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lciB7XG4gICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgaGVpZ2h0OiA0cHg7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICB9XG5cbiAgICAgICAgLnRyYW5zY3JpcHRpb24tcHJvZ3Jlc3MtYmFyIHtcbiAgICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1hY2NlbnQpO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgICAgICAgICB0cmFuc2l0aW9uOiB3aWR0aCAwLjNzIGVhc2U7XG4gICAgICAgICAgd2lkdGg6IDAlO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5vdGljZS1zdWNjZXNzIC50cmFuc2NyaXB0aW9uLXByb2dyZXNzLWJhciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1zdWNjZXNzKSAhaW1wb3J0YW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLm5vdGljZS1lcnJvciAudHJhbnNjcmlwdGlvbi1wcm9ncmVzcy1iYXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtZXJyb3IpICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cbiAgICAgIGA7XG4gICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVQcm9ncmVzcyh7IHByb2dyZXNzLCBzdGF0dXMsIGljb24gfTogQXVkaW9UcmFuc2NyaXB0aW9uUHJvZ3Jlc3MpIHtcbiAgICB0aGlzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7cHJvZ3Jlc3N9JWA7XG4gICAgdGhpcy5zdGF0dXNUZXh0LnNldFRleHQoc3RhdHVzKTtcbiAgICB0aGlzLnN0YXR1c0ljb24uZW1wdHkoKTtcbiAgICBzZXRJY29uKHRoaXMuc3RhdHVzSWNvbiwgaWNvbik7XG5cbiAgICAvLyBVcGRhdGUgbm90aWNlIGNsYXNzIGJhc2VkIG9uIHN0YXR1c1xuICAgIHRoaXMubm90aWNlRWwucmVtb3ZlQ2xhc3MoXCJub3RpY2Utc3VjY2Vzc1wiLCBcIm5vdGljZS1lcnJvclwiKTtcbiAgICBpZiAocHJvZ3Jlc3MgPT09IDEwMCkge1xuICAgICAgdGhpcy5ub3RpY2VFbC5hZGRDbGFzcyhcIm5vdGljZS1zdWNjZXNzXCIpO1xuICAgIH0gZWxzZSBpZiAocHJvZ3Jlc3MgPT09IDAgJiYgaWNvbiA9PT0gXCJ4LWNpcmNsZVwiKSB7XG4gICAgICB0aGlzLm5vdGljZUVsLmFkZENsYXNzKFwibm90aWNlLWVycm9yXCIpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwge1xuICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBwb3N0UHJvY2Vzc2luZ1NlcnZpY2U6IFBvc3RQcm9jZXNzaW5nU2VydmljZTtcbiAgcHJpdmF0ZSBvcHRpb25zOiBBdWRpb1RyYW5zY3JpcHRpb25PcHRpb25zO1xuICBwcml2YXRlIG5vdGljZTogUGVyc2lzdGVudFRyYW5zY3JpcHRpb25Ob3RpY2U7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG9wdGlvbnM6IEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnMpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2UgPSBUcmFuc2NyaXB0aW9uU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIG9wdGlvbnMucGx1Z2luXG4gICAgKTtcbiAgICB0aGlzLnBvc3RQcm9jZXNzaW5nU2VydmljZSA9IFBvc3RQcm9jZXNzaW5nU2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIG9wdGlvbnMucGx1Z2luXG4gICAgKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5ub3RpY2UgPSBuZXcgUGVyc2lzdGVudFRyYW5zY3JpcHRpb25Ob3RpY2UoKTtcbiAgICB0aGlzLnN0YXJ0VHJhbnNjcmlwdGlvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdGFydFRyYW5zY3JpcHRpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNob3cgaW5pdGlhbCBzdGF0dXNcbiAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgIHN0YXR1czogXCJTdGFydGluZyB0cmFuc2NyaXB0aW9uLi4uXCIsXG4gICAgICAgIGljb246IFwibWljXCIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHRoaXMudHJhbnNjcmlwdGlvblNlcnZpY2UudHJhbnNjcmliZUZpbGUoXG4gICAgICAgIHRoaXMub3B0aW9ucy5maWxlLFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogdGhpcy5vcHRpb25zLmlzQ2hhdCA/IFwiY2hhdFwiIDogXCJub3RlXCIsXG4gICAgICAgICAgdGltZXN0YW1wZWQ6IHRoaXMub3B0aW9ucy50aW1lc3RhbXBlZCxcbiAgICAgICAgICBvblByb2dyZXNzOiAocHJvZ3Jlc3MsIHN0YXR1cykgPT4ge1xuICAgICAgICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICAgICAgICBwcm9ncmVzcyxcbiAgICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgICBpY29uOiBcImF1ZGlvLWxpbmVzXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCB0cmFuc2NyaXB0aW9uIHRleHRcIik7XG4gICAgICB9XG5cbiAgICAgIGxldCBmaW5hbFRleHQgPSB0ZXh0O1xuXG4gICAgICAvLyBTa2lwIHBvc3QtcHJvY2Vzc2luZyBmb3IgY2hhdCB2aWV3cyB0byBlbnN1cmUgcmF3IHRyYW5zY3JpcHRpb25cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlzQ2hhdCAmJiB0aGlzLm9wdGlvbnMucGx1Z2luLnNldHRpbmdzLnBvc3RQcm9jZXNzaW5nRW5hYmxlZCkge1xuICAgICAgICB0aGlzLm5vdGljZS51cGRhdGVQcm9ncmVzcyh7XG4gICAgICAgICAgcHJvZ3Jlc3M6IDgwLFxuICAgICAgICAgIHN0YXR1czogXCJQb3N0LXByb2Nlc3NpbmcgdHJhbnNjcmlwdGlvbi4uLlwiLFxuICAgICAgICAgIGljb246IFwid2FuZFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcHJvY2Vzc2VkVGV4dCA9IGF3YWl0IHRoaXMucG9zdFByb2Nlc3NpbmdTZXJ2aWNlLnByb2Nlc3NUcmFuc2NyaXB0aW9uKFxuICAgICAgICAgIHRleHRcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBGb3JtYXQgdGhlIGZpbmFsIHRleHQgd2l0aCBib3RoIHZlcnNpb25zIGZvciBub3Rlc1xuICAgICAgICBmaW5hbFRleHQgPSBgIyBBdWRpbyBUcmFuc2NyaXB0aW9uXG5Tb3VyY2U6ICR7dGhpcy5vcHRpb25zLmZpbGUuYmFzZW5hbWV9XG5UcmFuc2NyaWJlZDogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9XG5cbiMjIFJhdyBUcmFuc2NyaXB0aW9uXG4ke3RleHR9XG5cbiMjIFByb2Nlc3NlZCBUcmFuc2NyaXB0aW9uXG4ke3Byb2Nlc3NlZFRleHR9YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciBjaGF0IHZpZXdzIG9yIHdoZW4gcG9zdC1wcm9jZXNzaW5nIGlzIGRpc2FibGVkLCBqdXN0IHVzZSB0aGUgcmF3IHRyYW5zY3JpcHRpb25cbiAgICAgICAgZmluYWxUZXh0ID0gdGhpcy5vcHRpb25zLmlzQ2hhdCA/IHRleHQgOiBgIyBBdWRpbyBUcmFuc2NyaXB0aW9uXG5Tb3VyY2U6ICR7dGhpcy5vcHRpb25zLmZpbGUuYmFzZW5hbWV9XG5UcmFuc2NyaWJlZDogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9XG5cbiMjIFJhdyBUcmFuc2NyaXB0aW9uXG4ke3RleHR9YDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsbCB0aGUgY29tcGxldGlvbiBjYWxsYmFjayBpZiBwcm92aWRlZFxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5vblRyYW5zY3JpcHRpb25Db21wbGV0ZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMub25UcmFuc2NyaXB0aW9uQ29tcGxldGUoZmluYWxUZXh0KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29weSB0ZXh0IHRvIGNsaXBib2FyZFxuICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoZmluYWxUZXh0KTtcblxuICAgICAgLy8gU2hvdyBzdWNjZXNzIG1lc3NhZ2VcbiAgICAgIHRoaXMubm90aWNlLnVwZGF0ZVByb2dyZXNzKHtcbiAgICAgICAgcHJvZ3Jlc3M6IDEwMCxcbiAgICAgICAgc3RhdHVzOiBcIlRyYW5zY3JpcHRpb24gY29tcGxldGUhXCIsXG4gICAgICAgIGljb246IFwiY2hlY2stY2lyY2xlXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gSGlkZSBub3RpY2UgYWZ0ZXIgc3VjY2Vzc1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMubm90aWNlLmhpZGUoKTtcbiAgICAgIH0sIDIwMDApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5ub3RpY2UudXBkYXRlUHJvZ3Jlc3Moe1xuICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgc3RhdHVzOiBgRXJyb3I6ICR7XG4gICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICAgIH1gLFxuICAgICAgICBpY29uOiBcIngtY2lyY2xlXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gSGlkZSBub3RpY2UgYWZ0ZXIgZXJyb3JcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLm5vdGljZS5oaWRlKCk7XG4gICAgICB9LCA0MDAwKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNob3dBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbChcbiAgYXBwOiBBcHAsXG4gIG9wdGlvbnM6IEF1ZGlvVHJhbnNjcmlwdGlvbk9wdGlvbnNcbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBtb2RhbCA9IG5ldyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbChhcHAsIG9wdGlvbnMpO1xuICBtb2RhbC5vcGVuKCk7XG59XG4iLCAiaW1wb3J0IHsgUGx1Z2luLCBOb3RpY2UsIE1lbnUsIFRGaWxlLCBNYXJrZG93blZpZXcgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSB7IFN5c3RlbVNjdWxwdFNldHRpbmdzIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBTWVNURU1TQ1VMUFRfQVBJX0hFQURFUlMgfSBmcm9tIFwiLi4vY29uc3RhbnRzL2FwaVwiO1xuXG4vLyBNYXRjaCBzZXJ2ZXItc2lkZSBjb25maWd1cmF0aW9uXG5jb25zdCBTVVBQT1JURURfQVVESU9fRVhURU5TSU9OUyA9IFtcIndhdlwiLCBcIm00YVwiLCBcIndlYm1cIiwgXCJvZ2dcIiwgXCJtcDNcIl07XG5jb25zdCBNSU1FX1RZUEVfTUFQID0ge1xuICB3YXY6IFwiYXVkaW8vd2F2XCIsXG4gIG00YTogXCJhdWRpby9tcDRcIixcbiAgd2VibTogXCJhdWRpby93ZWJtXCIsXG4gIG9nZzogXCJhdWRpby9vZ2c7Y29kZWNzPW9wdXNcIixcbiAgbXAzOiBcImF1ZGlvL21wZWdcIixcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNjcmlwdGlvbkNvbnRleHQge1xuICB0eXBlOiBcIm5vdGVcIiB8IFwiY2hhdFwiO1xuICB0aW1lc3RhbXBlZD86IGJvb2xlYW47XG4gIG9uUHJvZ3Jlc3M/OiAocHJvZ3Jlc3M6IG51bWJlciwgc3RhdHVzOiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBUcmFuc2NyaXB0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgcGx1Z2luOiBQbHVnaW4gJiB7IHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9O1xuICBwcml2YXRlIGlzVHJhbnNjcmliaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocGx1Z2luOiBQbHVnaW4gJiB7IHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB9KSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5zY3VscHRTZXJ2aWNlID0gU3lzdGVtU2N1bHB0U2VydmljZS5nZXRJbnN0YW5jZShcbiAgICAgIHBsdWdpbi5zZXR0aW5ncyxcbiAgICAgIHBsdWdpbi5hcHBcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIHBsdWdpbjogUGx1Z2luICYgeyBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3MgfVxuICApOiBUcmFuc2NyaXB0aW9uU2VydmljZSB7XG4gICAgaWYgKCFUcmFuc2NyaXB0aW9uU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgVHJhbnNjcmlwdGlvblNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgVHJhbnNjcmlwdGlvblNlcnZpY2UocGx1Z2luKTtcbiAgICB9XG4gICAgcmV0dXJuIFRyYW5zY3JpcHRpb25TZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwYXJzZUVycm9yUmVzcG9uc2UoXG4gICAgcmVzcG9uc2U6IFJlc3BvbnNlXG4gICk6IFByb21pc2U8eyBtZXNzYWdlOiBzdHJpbmc7IGRhdGE/OiBhbnkgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmVycm9yID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogZGF0YS5lcnJvciwgZGF0YSB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLmVycm9yLm1lc3NhZ2UpIHtcbiAgICAgICAgICByZXR1cm4geyBtZXNzYWdlOiBkYXRhLmVycm9yLm1lc3NhZ2UsIGRhdGEgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBtZXNzYWdlOiBKU09OLnN0cmluZ2lmeShkYXRhLmVycm9yKSwgZGF0YSB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogcmVzcG9uc2Uuc3RhdHVzVGV4dCwgZGF0YSB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiB7IG1lc3NhZ2U6IHJlc3BvbnNlLnN0YXR1c1RleHQgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyB0cmFuc2NyaWJlRmlsZShcbiAgICBmaWxlOiBURmlsZSxcbiAgICBjb250ZXh0PzogVHJhbnNjcmlwdGlvbkNvbnRleHRcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAodGhpcy5pc1RyYW5zY3JpYmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSB0cmFuc2NyaWJpbmcgYSBmaWxlXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCFTVVBQT1JURURfQVVESU9fRVhURU5TSU9OUy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGZpbGUgdHlwZTogJHtleHRlbnNpb259YCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc1RyYW5zY3JpYmluZyA9IHRydWU7XG5cbiAgICAvLyBSZXBvcnQgaW5pdGlhbCBwcm9ncmVzc1xuICAgIGNvbnRleHQ/Lm9uUHJvZ3Jlc3M/LigwLCBcIlJlYWRpbmcgYXVkaW8gZmlsZS4uLlwiKTtcblxuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHtcbiAgICAgIHR5cGU6IE1JTUVfVFlQRV9NQVBbZXh0ZW5zaW9uIGFzIGtleW9mIHR5cGVvZiBNSU1FX1RZUEVfTUFQXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBibG9iLCBmaWxlLm5hbWUpO1xuICAgIGlmIChjb250ZXh0Py50aW1lc3RhbXBlZCkge1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwidGltZXN0YW1wZWRcIiwgXCJ0cnVlXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBSZXBvcnQgdXBsb2FkIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oMjAsIFwiVXBsb2FkaW5nIGF1ZGlvLi4uXCIpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHt0aGlzLnNjdWxwdFNlcnZpY2UuYmFzZVVybH0vYXBpL3YxL2F1ZGlvL3RyYW5zY3JpcHRpb25zYCxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJ4LWxpY2Vuc2Uta2V5XCI6IHRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgbGV0IGRhdGE6IGFueTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsIGRhdGE6IHBhcnNlZERhdGEgfSA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXJzZUVycm9yUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAvLyBTcGVjaWFsIGNhc2U6IENSRURJVF9VUERBVEUgaXMgYWN0dWFsbHkgYSBzdWNjZXNzXG4gICAgICAgIGlmIChcbiAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPT09IDQwMCAmJlxuICAgICAgICAgIGVycm9yTWVzc2FnZSA9PT0gXCJDcmVkaXRzIGNoYXJnZWQgc3VjY2Vzc2Z1bGx5XCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQ29udGludWUgcHJvY2Vzc2luZyAtIHRoaXMgaXMgbm90IGFjdHVhbGx5IGFuIGVycm9yXG4gICAgICAgICAgZGF0YSA9IHBhcnNlZERhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhaWxlZCB0byB0cmFuc2NyaWJlIGZpbGU6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7ZXJyb3JNZXNzYWdlfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgcmVzcG9uc2UgSlNPTjpcIiwgZSk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBKU09OIHJlc3BvbnNlIGZyb20gc2VydmVyXCIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcG9ydCBwcm9jZXNzaW5nIHByb2dyZXNzXG4gICAgICBjb250ZXh0Py5vblByb2dyZXNzPy4oNjAsIFwiUHJvY2Vzc2luZyBhdWRpby4uLlwiKTtcblxuICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgdmFsaWQgdHJhbnNjcmlwdGlvbiB0ZXh0XG4gICAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEudGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCByZXNwb25zZSBkYXRhOlwiLCBkYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdHJhbnNjcmlwdGlvbiB0ZXh0IHJlY2VpdmVkIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSB0ZXh0IGlzIG5vdCBlbXB0eSBhZnRlciB0cmltbWluZ1xuICAgICAgY29uc3QgdHJpbW1lZFRleHQgPSBkYXRhLnRleHQudHJpbSgpO1xuICAgICAgaWYgKCF0cmltbWVkVGV4dCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRW1wdHkgdHJhbnNjcmlwdGlvbiB0ZXh0IGFmdGVyIHRyaW1taW5nOlwiLCBkYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW1wdHkgdHJhbnNjcmlwdGlvbiB0ZXh0IHJlY2VpdmVkIGZyb20gc2VydmVyXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXBvcnQgY29tcGxldGlvbiBwcm9ncmVzc1xuICAgICAgY29udGV4dD8ub25Qcm9ncmVzcz8uKDEwMCwgXCJUcmFuc2NyaXB0aW9uIGNvbXBsZXRlIVwiKTtcblxuICAgICAgcmV0dXJuIHRyaW1tZWRUZXh0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuaXNUcmFuc2NyaWJpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICB1bmxvYWQoKSB7XG4gICAgLy8gTm90aGluZyB0byB1bmxvYWQgY3VycmVudGx5XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4vU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgUG9zdFByb2Nlc3NpbmdTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFBvc3RQcm9jZXNzaW5nU2VydmljZTtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIGRlZmF1bHRNb2RlbElkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgcGx1Z2luLnNldHRpbmdzLFxuICAgICAgcGx1Z2luLmFwcFxuICAgICk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pOiBQb3N0UHJvY2Vzc2luZ1NlcnZpY2Uge1xuICAgIGlmICghUG9zdFByb2Nlc3NpbmdTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UuaW5zdGFuY2UgPSBuZXcgUG9zdFByb2Nlc3NpbmdTZXJ2aWNlKHBsdWdpbik7XG4gICAgfVxuICAgIHJldHVybiBQb3N0UHJvY2Vzc2luZ1NlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGZpbmREZWZhdWx0TW9kZWwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAodGhpcy5kZWZhdWx0TW9kZWxJZCkgcmV0dXJuIHRoaXMuZGVmYXVsdE1vZGVsSWQ7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5zY3VscHRTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgY29uc3QgZGVmYXVsdE1vZGVsID0gbW9kZWxzLmZpbmQoKG1vZGVsKSA9PlxuICAgICAgICBtb2RlbC5uYW1lPy5tYXRjaCgvXFwoRGVmYXVsdFxcKS9pKVxuICAgICAgKTtcbiAgICAgIGlmICghZGVmYXVsdE1vZGVsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRlZmF1bHQgbW9kZWwgbm90IGZvdW5kXCIpO1xuICAgICAgfVxuICAgICAgdGhpcy5kZWZhdWx0TW9kZWxJZCA9IGRlZmF1bHRNb2RlbC5pZDtcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWwuaWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmaW5kaW5nIGRlZmF1bHQgbW9kZWw6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NUcmFuc2NyaXB0aW9uKHRleHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0UHJvY2Vzc2luZ0VuYWJsZWQpIHtcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RlbElkID0gYXdhaXQgdGhpcy5maW5kRGVmYXVsdE1vZGVsKCk7XG4gICAgICBjb25zdCBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDogdGhpcy5wbHVnaW4uc2V0dGluZ3MucG9zdFByb2Nlc3NpbmdQcm9tcHQsXG4gICAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IHRleHQsXG4gICAgICAgICAgbWVzc2FnZV9pZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGxldCBwcm9jZXNzZWRUZXh0ID0gXCJcIjtcbiAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgdGhpcy5zY3VscHRTZXJ2aWNlLnN0cmVhbU1lc3NhZ2Uoe1xuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgbW9kZWw6IG1vZGVsSWQsXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsIC8vIExvd2VyIHRlbXBlcmF0dXJlIGZvciBtb3JlIGNvbnNpc3RlbnQgb3V0cHV0XG4gICAgICB9KSkge1xuICAgICAgICBpZiAoY2h1bmsuY29udGVudCkge1xuICAgICAgICAgIHByb2Nlc3NlZFRleHQgKz0gY2h1bmsuY29udGVudDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJvY2Vzc2VkVGV4dC50cmltKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwb3N0LXByb2Nlc3NpbmcgdHJhbnNjcmlwdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgLy8gT24gZXJyb3IsIHJldHVybiBvcmlnaW5hbCB0ZXh0XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBJdGVtVmlldywgV29ya3NwYWNlTGVhZiwgVEZpbGUsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDaGF0TWVzc2FnZSwgQ2hhdFJvbGUsIE11bHRpUGFydENvbnRlbnQsIFBBVFJFT05fVVJMIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBDaGF0U3RvcmFnZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTY3JvbGxNYW5hZ2VyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZVwiO1xuaW1wb3J0IHR5cGUgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UsIHNob3dQb3B1cCwgc2hvd05vdGljZSwgc2hvd0FsZXJ0IH0gZnJvbSBcIi4uLy4uL2NvcmUvdWkvXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuLi8uLi91dGlscy9lcnJvcnNcIjtcbmltcG9ydCB7IERyYXdlckNvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnRzL0RyYXdlckNvbXBvbmVudFwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvTWVzc2FnZVJlbmRlcmVyXCI7XG5pbXBvcnQgeyBJbnB1dEhhbmRsZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9JbnB1dEhhbmRsZXJcIjtcbmltcG9ydCB7IEZpbGVDb250ZXh0TWFuYWdlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVDb250ZXh0TWFuYWdlclwiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBMb2FkQ2hhdE1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Mb2FkQ2hhdE1vZGFsXCI7XG5cbmltcG9ydCB7IHVpU2V0dXAgfSBmcm9tIFwiLi91aVNldHVwXCI7XG5pbXBvcnQgeyBtZXNzYWdlSGFuZGxpbmcgfSBmcm9tIFwiLi9tZXNzYWdlSGFuZGxpbmdcIjtcbmltcG9ydCB7IGV2ZW50SGFuZGxpbmcgfSBmcm9tIFwiLi9ldmVudEhhbmRsaW5nXCI7XG5pbXBvcnQgeyBzeXN0ZW1Qcm9tcHRIYW5kbGluZyB9IGZyb20gXCIuL3N5c3RlbVByb21wdEhhbmRsaW5nXCI7XG5cbmV4cG9ydCBjb25zdCBDSEFUX1ZJRVdfVFlQRSA9IFwic3lzdGVtc2N1bHB0LWNoYXQtdmlld1wiO1xuXG5leHBvcnQgY2xhc3MgQ2hhdFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gIHB1YmxpYyBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtdO1xuICBwdWJsaWMgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwdWJsaWMgY2hhdFN0b3JhZ2U6IENoYXRTdG9yYWdlU2VydmljZTtcbiAgcHVibGljIGNoYXRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwdWJsaWMgaW5wdXRIYW5kbGVyOiBJbnB1dEhhbmRsZXI7XG4gIHB1YmxpYyBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHVibGljIGNoYXRJZDogc3RyaW5nO1xuICBwdWJsaWMgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gIHB1YmxpYyBtb2RlbEluZGljYXRvcjogSFRNTEVsZW1lbnQ7XG4gIHB1YmxpYyBjdXJyZW50TW9kZWxOYW1lOiBzdHJpbmcgPSBcIlwiO1xuICBwdWJsaWMgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gIHB1YmxpYyBjb250ZXh0TWFuYWdlcjogRmlsZUNvbnRleHRNYW5hZ2VyO1xuICBwdWJsaWMgcmVmcmVzaEludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwdWJsaWMgbGFzdFJlZnJlc2hUaW1lID0gMDtcbiAgcHVibGljIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBwdWJsaWMgbGF5b3V0Q2hhbmdlSGFuZGxlcjogKCkgPT4gdm9pZDtcbiAgcHVibGljIGF3YWl0aW5nU3RhdGVSZXN0b3JlID0gZmFsc2U7XG4gIHB1YmxpYyBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgcHVibGljIHN5c3RlbVByb21wdFR5cGU6IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIjtcbiAgcHVibGljIHN5c3RlbVByb21wdFBhdGg/OiBzdHJpbmc7XG4gIHB1YmxpYyB0b2tlbkxpbWl0PzogbnVtYmVyO1xuICBwdWJsaWMgY2hhdFRpdGxlOiBzdHJpbmc7XG4gIHB1YmxpYyB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcbiAgcHVibGljIGN1cnJlbnRQcm9tcHQ/OiBzdHJpbmc7XG4gIHB1YmxpYyB3ZWJTZWFyY2hFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IobGVhZjogV29ya3NwYWNlTGVhZiwgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4pIHtcbiAgICBzdXBlcihsZWFmKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICBcbiAgICAvLyBHZXQgdGhlIGluaXRpYWwgc3RhdGUgZnJvbSB0aGUgbGVhZiBpZiBpdCBleGlzdHNcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMubGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSAoc3RhdGU/LnN0YXRlIGFzIHsgY2hhdElkPzogc3RyaW5nOyBjaGF0VGl0bGU/OiBzdHJpbmc7IHNlbGVjdGVkTW9kZWxJZD86IHN0cmluZyB9KSB8fCB7fTtcbiAgICBcbiAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgdGhpcy5jaGF0SWQgPSBpbml0aWFsU3RhdGUuY2hhdElkIHx8IFwiXCI7XG4gICAgdGhpcy5jaGF0VGl0bGUgPSBpbml0aWFsU3RhdGUuY2hhdFRpdGxlIHx8IFwiXCI7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBpbml0aWFsU3RhdGUuc2VsZWN0ZWRNb2RlbElkIHx8IHBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQ7XG4gICAgdGhpcy5jdXJyZW50TW9kZWxOYW1lID0gXCJcIjtcbiAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgIHRoaXMubGFzdFJlZnJlc2hUaW1lID0gMDtcbiAgICB0aGlzLmF3YWl0aW5nU3RhdGVSZXN0b3JlID0gIWluaXRpYWxTdGF0ZS5jaGF0SWQ7IC8vIE9ubHkgYXdhaXQgcmVzdG9yZSBpZiB3ZSBkb24ndCBoYXZlIGEgY2hhdElkXG4gICAgdGhpcy5yZWZyZXNoSW50ZXJ2YWwgPSBudWxsO1xuICAgIHRoaXMudG9rZW5MaW1pdCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnRva2VuTGltaXRQZXJjZW50YWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY3VycmVudFByb21wdCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN5c3RlbVByb21wdFBhdGggPSB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLmFpU2VydmljZSA9IFN5c3RlbVNjdWxwdFNlcnZpY2UuZ2V0SW5zdGFuY2UocGx1Z2luLnNldHRpbmdzLCB0aGlzLmFwcCk7XG4gICAgdGhpcy5jaGF0U3RvcmFnZSA9IG5ldyBDaGF0U3RvcmFnZVNlcnZpY2UodGhpcy5hcHAsIHBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeSk7XG4gICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIgPSBuZXcgTWVzc2FnZVJlbmRlcmVyKHRoaXMuYXBwKTtcblxuICAgIHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9IHBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRUeXBlIHx8IFwiZ2VuZXJhbC11c2VcIjtcbiAgICBpZiAodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRQYXRoKSB7XG4gICAgICB0aGlzLnN5c3RlbVByb21wdFBhdGggPSBwbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0UGF0aDtcbiAgICB9XG5cbiAgICB0aGlzLmxheW91dENoYW5nZUhhbmRsZXIgPSB0aGlzLm9uTGF5b3V0Q2hhbmdlLmJpbmQodGhpcyk7XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBDSEFUX1ZJRVdfVFlQRTtcbiAgfVxuXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2hhdFRpdGxlIHx8IFwiTG9hZGluZy4uLlwiO1xuICB9XG5cbiAgLy8gRGVsZWdhdGVkIG1ldGhvZHNcbiAgb25PcGVuID0gKCkgPT4gdWlTZXR1cC5vbk9wZW4odGhpcyk7XG4gIHVwZGF0ZU1vZGVsSW5kaWNhdG9yID0gKCkgPT4gdWlTZXR1cC51cGRhdGVNb2RlbEluZGljYXRvcih0aGlzKTtcbiAgYWRkTWVzc2FnZSA9IChyb2xlOiBDaGF0Um9sZSwgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdLCBleGlzdGluZ01lc3NhZ2VJZD86IHN0cmluZykgPT5cbiAgICBtZXNzYWdlSGFuZGxpbmcuYWRkTWVzc2FnZSh0aGlzLCByb2xlLCBjb250ZW50LCBleGlzdGluZ01lc3NhZ2VJZCk7XG4gIGxvYWRNZXNzYWdlcyA9ICgpID0+IG1lc3NhZ2VIYW5kbGluZy5sb2FkTWVzc2FnZXModGhpcyk7XG4gIHNldHVwRHJhZ0FuZERyb3AgPSAoY29udGFpbmVyOiBIVE1MRWxlbWVudCkgPT4gZXZlbnRIYW5kbGluZy5zZXR1cERyYWdBbmREcm9wKHRoaXMsIGNvbnRhaW5lcik7XG4gIGhhbmRsZVN5c3RlbVByb21wdEVkaXQgPSAoKSA9PiBzeXN0ZW1Qcm9tcHRIYW5kbGluZy5oYW5kbGVTeXN0ZW1Qcm9tcHRFZGl0KHRoaXMpO1xuXG4gIHB1YmxpYyBhc3luYyBjaGVja0ZvclVwZGF0ZXMoKSB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNhdmVkQ2hhdHMgPSBhd2FpdCB0aGlzLmNoYXRTdG9yYWdlLmxvYWRDaGF0cygpO1xuICAgICAgY29uc3QgY3VycmVudENoYXQgPSBzYXZlZENoYXRzLmZpbmQoKGMpID0+IGMuaWQgPT09IHRoaXMuY2hhdElkKTtcbiAgICAgIGlmICghY3VycmVudENoYXQpIHJldHVybjtcblxuICAgICAgY29uc3QgaGFzQ2hhbmdlcyA9XG4gICAgICAgIGN1cnJlbnRDaGF0Lm1lc3NhZ2VzLmxlbmd0aCAhPT0gdGhpcy5tZXNzYWdlcy5sZW5ndGggfHxcbiAgICAgICAgY3VycmVudENoYXQuc2VsZWN0ZWRNb2RlbElkICE9PSB0aGlzLnNlbGVjdGVkTW9kZWxJZCB8fFxuICAgICAgICBKU09OLnN0cmluZ2lmeShBcnJheS5mcm9tKHRoaXMuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkpKSAhPT1cbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2hhdC5jb250ZXh0X2ZpbGVzKSB8fFxuICAgICAgICBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2hhdC5tZXNzYWdlcykgIT09IEpTT04uc3RyaW5naWZ5KHRoaXMubWVzc2FnZXMpO1xuXG4gICAgICBpZiAoaGFzQ2hhbmdlcykge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gY3VycmVudENoYXQubWVzc2FnZXM7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gY3VycmVudENoYXQuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICBpZiAoY3VycmVudENoYXQuY29udGV4dF9maWxlcykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKGN1cnJlbnRDaGF0LmNvbnRleHRfZmlsZXMpO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZE1lc3NhZ2VzKCk7XG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY29udGV4dE1hbmFnZXIuY2hlY2tTeW5jU3RhdHVzKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZm9yIHVwZGF0ZXM6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2F2ZUNoYXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNoYXRJZCkge1xuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IHllYXIgPSBub3cuZ2V0RnVsbFllYXIoKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKG5vdy5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgY29uc3QgZGF5ID0gU3RyaW5nKG5vdy5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIGNvbnN0IGhvdXIgPSBTdHJpbmcobm93LmdldEhvdXJzKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgIGNvbnN0IG1pbnV0ZSA9IFN0cmluZyhub3cuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICBjb25zdCBzZWNvbmQgPSBTdHJpbmcobm93LmdldFNlY29uZHMoKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgdGhpcy5jaGF0SWQgPSBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX0gJHtob3VyfS0ke21pbnV0ZX0tJHtzZWNvbmR9YDtcbiAgICAgIHRoaXMuY2hhdFRpdGxlID0gdGhpcy5jaGF0VGl0bGUgfHwgdGhpcy5jaGF0SWQ7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2Uuc2F2ZUNoYXQoXG4gICAgICAgIHRoaXMuY2hhdElkLFxuICAgICAgICB0aGlzLm1lc3NhZ2VzLFxuICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB0aGlzLnN5c3RlbVByb21wdFR5cGUsXG4gICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgICAgdGhpcy5jaGF0VGl0bGUsXG4gICAgICAgIHRoaXMudG9rZW5MaW1pdCxcbiAgICAgICAgdGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcihcIkZhaWxlZCB0byBzYXZlIGNoYXRcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGhhbmRsZUVycm9yKGVycm9yOiBzdHJpbmcgfCBTeXN0ZW1TY3VscHRFcnJvcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJDaGF0IGVycm9yOlwiLCB7XG4gICAgICBlcnJvcixcbiAgICAgIG1lc3NhZ2U6IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3IubWVzc2FnZSxcbiAgICAgIGNvZGU6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5jb2RlIDogdW5kZWZpbmVkLFxuICAgICAgbWV0YWRhdGE6IGVycm9yIGluc3RhbmNlb2YgU3lzdGVtU2N1bHB0RXJyb3IgPyBlcnJvci5tZXRhZGF0YSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcblxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yLm1lc3NhZ2U7XG4gICAgaWYgKFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBTeXN0ZW1TY3VscHRFcnJvciAmJlxuICAgICAgKGVycm9yLmNvZGUgPT09IFwiTU9ERUxfVU5BVkFJTEFCTEVcIiB8fCBlcnJvci5jb2RlID09PSBcIk1PREVMX1JFUVVFU1RfRVJST1JcIiB8fCBlcnJvci5jb2RlID09PSBcIlFVT1RBX0VYQ0VFREVEXCIpXG4gICAgKSB7XG4gICAgICBzaG93RW5oYW5jZWROb3RpY2UoZXJyb3JNZXNzYWdlLCBcImVycm9yXCIsIGVycm9yKTtcbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNb2RlbElkID0gbW9kZWxJZDtcbiAgICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsSW5kaWNhdG9yKCk7XG4gICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiTW9kZWwgY2hhbmdlZC4gWW91IGNhbiBub3cgcmV0cnkgeW91ciBtZXNzYWdlLlwiLCBcImluZm9cIik7XG4gICAgICAgICAgdGhpcy5mb2N1c0lucHV0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucGx1Z2luXG4gICAgICApO1xuICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICBtb2RhbC5zZXRNb2RlbHMobW9kZWxzKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIG1vZGVsczpcIiwgZXJyKTtcbiAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIGF2YWlsYWJsZSBtb2RlbHNcIiwgXCJlcnJvclwiLCBlcnIpO1xuICAgICAgfVxuICAgICAgY29uc3QgbGFzdE1lc3NhZ2UgPSB0aGlzLmNoYXRDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtbWVzc2FnZTpsYXN0LWNoaWxkXCIpO1xuICAgICAgaWYgKGxhc3RNZXNzYWdlKSBsYXN0TWVzc2FnZS5yZW1vdmUoKTtcbiAgICAgIGNvbnN0IGxhc3RVc2VyTWVzc2FnZSA9IFsuLi50aGlzLm1lc3NhZ2VzXS5yZXZlcnNlKCkuZmluZCgobXNnKSA9PiBtc2cucm9sZSA9PT0gXCJ1c2VyXCIpO1xuICAgICAgaWYgKGxhc3RVc2VyTWVzc2FnZSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMubWVzc2FnZXMuZmluZEluZGV4KChtc2cpID0+IG1zZy5tZXNzYWdlX2lkID09PSBsYXN0VXNlck1lc3NhZ2UubWVzc2FnZV9pZCk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnNwbGljZShpbmRleCk7XG4gICAgICAgICAgY29uc3QgYWxsTWVzc2FnZXMgPSB0aGlzLmNoYXRDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtbWVzc2FnZVwiKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCBhbGxNZXNzYWdlcy5sZW5ndGg7IGkrKykgYWxsTWVzc2FnZXNbaV0ucmVtb3ZlKCk7XG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuc2V0VmFsdWUoXG4gICAgICAgICAgICB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09IFwic3RyaW5nXCIgPyBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzaG93RW5oYW5jZWROb3RpY2UoZXJyb3JNZXNzYWdlLCBcImVycm9yXCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9uTGF5b3V0Q2hhbmdlKCkge1xuICAgIGlmICh0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShJdGVtVmlldyk/LmxlYWYgPT09IHRoaXMubGVhZikge1xuICAgICAgdGhpcy5sYXN0UmVmcmVzaFRpbWUgPSAwO1xuICAgICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcbiAgICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdlbmVyYXRlTWVzc2FnZUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCAoYykgPT4ge1xuICAgICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0TW9kZWxDb250ZXh0TGVuZ3RoKCk6IFByb21pc2U8bnVtYmVyIHwgdW5kZWZpbmVkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbCA9IG1vZGVscy5maW5kKChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMuc2VsZWN0ZWRNb2RlbElkKTtcbiAgICAgIHJldHVybiBjdXJyZW50TW9kZWw/LmNvbnRleHRfbGVuZ3RoO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBtb2RlbCBjb250ZXh0IGxlbmd0aDpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0Q3VycmVudFN5c3RlbVByb21wdCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICh0aGlzLnN5c3RlbVByb21wdFR5cGUgPT09IFwiY3VzdG9tXCIgJiYgdGhpcy5zeXN0ZW1Qcm9tcHRQYXRoKSB7XG4gICAgICBjb25zdCByZXNvbHZlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KHRoaXMuc3lzdGVtUHJvbXB0UGF0aCwgXCJcIikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGAke3RoaXMuc3lzdGVtUHJvbXB0UGF0aH0ubWRgKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoYFN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0cy8ke3RoaXMuc3lzdGVtUHJvbXB0UGF0aH0ubWRgKTtcbiAgICAgIGlmIChyZXNvbHZlZEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChyZXNvbHZlZEZpbGUpO1xuICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9tcHQgfHwgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3lzdGVtUHJvbXB0O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcmVzZXQgPSBhd2FpdCBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwKS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKHRoaXMuc3lzdGVtUHJvbXB0VHlwZSk7XG4gICAgICBpZiAocHJlc2V0KSB7XG4gICAgICAgIHJldHVybiBwcmVzZXQuc3lzdGVtUHJvbXB0O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRXJyb3IgZmV0Y2hpbmcgc3lzdGVtIHByb21wdCBwcmVzZXQ6XCIsIGVycm9yKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFByb21wdCB8fCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHQ7XG4gIH1cblxuICBwcml2YXRlIGdldElucHV0VmFsdWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dEhhbmRsZXIuZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIGlmICh0aGlzLnJlZnJlc2hJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlZnJlc2hJbnRlcnZhbCk7XG4gICAgICB0aGlzLnJlZnJlc2hJbnRlcnZhbCA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuc2Nyb2xsTWFuYWdlci5jbGVhbnVwKCk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZihcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLCB0aGlzLmNoZWNrRm9yVXBkYXRlcy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmNvbnRleHRNYW5hZ2VyLnVubG9hZCgpO1xuICAgIHRoaXMuaW5wdXRIYW5kbGVyLnVubG9hZCgpO1xuICB9XG5cbiAgZ2V0U3RhdGUoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgY2hhdElkOiB0aGlzLmNoYXRJZCxcbiAgICAgIHNlbGVjdGVkTW9kZWxJZDogdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICBjaGF0VGl0bGU6IHRoaXMuY2hhdFRpdGxlXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIHNldFN0YXRlKHN0YXRlOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXN0YXRlPy5jaGF0SWQpIHtcbiAgICAgIHRoaXMuY2hhdElkID0gXCJcIjtcbiAgICAgIHRoaXMuY2hhdFRpdGxlID0gXCJOZXcgQ2hhdFwiO1xuICAgICAgdGhpcy5hd2FpdGluZ1N0YXRlUmVzdG9yZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBEb24ndCByZXN0b3JlIHN0YXRlIGlmIHdlIGFscmVhZHkgaGF2ZSB0aGlzIGNoYXQgbG9hZGVkXG4gICAgaWYgKHRoaXMuY2hhdElkID09PSBzdGF0ZS5jaGF0SWQgJiYgIXRoaXMuYXdhaXRpbmdTdGF0ZVJlc3RvcmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5jaGF0SWQgPSBzdGF0ZS5jaGF0SWQ7XG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBzdGF0ZS5zZWxlY3RlZE1vZGVsSWQ7XG4gICAgdGhpcy5jaGF0VGl0bGUgPSBzdGF0ZS5jaGF0VGl0bGU7XG4gICAgdGhpcy5hd2FpdGluZ1N0YXRlUmVzdG9yZSA9IGZhbHNlO1xuXG4gICAgLy8gTG9hZCB0aGUgcmVzdCBvZiB0aGUgY2hhdCBkYXRhIGFzeW5jaHJvbm91c2x5XG4gICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRDaGF0QnlJZChzdGF0ZS5jaGF0SWQpO1xuICAgICAgICBpZiAodGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoSXRlbVZpZXcpPy5sZWFmID09PSB0aGlzLmxlYWYgJiYgdGhpcy5pbnB1dEhhbmRsZXIpIHtcbiAgICAgICAgICB0aGlzLmlucHV0SGFuZGxlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHJlc3RvcmUgY2hhdCBzdGF0ZTpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH0sIDApO1xuICB9XG5cbiAgYXN5bmMgbG9hZENoYXRCeUlkKGNoYXRJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoYXREYXRhID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5sb2FkQ2hhdChjaGF0SWQpO1xuICAgICAgaWYgKCFjaGF0RGF0YSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2hhdElkID0gY2hhdElkO1xuICAgICAgdGhpcy5zZWxlY3RlZE1vZGVsSWQgPSBjaGF0RGF0YS5zZWxlY3RlZE1vZGVsSWQgfHwgdGhpcy5zZWxlY3RlZE1vZGVsSWQ7XG4gICAgICBpZiAoY2hhdERhdGEudGl0bGUpIHtcbiAgICAgICAgdGhpcy5jaGF0VGl0bGUgPSBjaGF0RGF0YS50aXRsZTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSB2aWV3IHN0YXRlIHRvIHJlZmxlY3QgdGhlIHRpdGxlIGNoYW5nZVxuICAgICAgICBpZiAodGhpcy5sZWFmKSB7XG4gICAgICAgICAgdGhpcy5sZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICAgICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgICAgICAgIHN0YXRlOiB7XG4gICAgICAgICAgICAgIGNoYXRJZDogdGhpcy5jaGF0SWQsXG4gICAgICAgICAgICAgIHNlbGVjdGVkTW9kZWxJZDogdGhpcy5zZWxlY3RlZE1vZGVsSWQsXG4gICAgICAgICAgICAgIGNoYXRUaXRsZTogY2hhdERhdGEudGl0bGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLm1lc3NhZ2VzID0gY2hhdERhdGEubWVzc2FnZXMgfHwgW107XG5cbiAgICAgIGlmIChjaGF0RGF0YS5jb250ZXh0X2ZpbGVzICYmIHRoaXMuY29udGV4dE1hbmFnZXIpIHtcbiAgICAgICAgY29uc3QgY29udGV4dEZpbGVzID0gY2hhdERhdGEuY29udGV4dF9maWxlcy5tYXAoKGZpbGU6IHN0cmluZyB8IHsgcGF0aDogc3RyaW5nIH0pID0+IFxuICAgICAgICAgIHR5cGVvZiBmaWxlID09PSAnc3RyaW5nJyA/IGZpbGUgOiBmaWxlLnBhdGhcbiAgICAgICAgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jb250ZXh0TWFuYWdlci5zZXRDb250ZXh0RmlsZXMoY29udGV4dEZpbGVzKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMubW9kZWxJbmRpY2F0b3IpIHNldFRpbWVvdXQoKCkgPT4gdGhpcy51cGRhdGVNb2RlbEluZGljYXRvcigpLCAwKTtcbiAgICAgIGlmICh0aGlzLm1lc3NhZ2VzLmxlbmd0aCA+IDAgJiYgdGhpcy5jaGF0Q29udGFpbmVyKSBhd2FpdCB0aGlzLnJlbmRlck1lc3NhZ2VzSW5DaHVua3MoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgY2hhdCAke2NoYXRJZH06YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdFwiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlck1lc3NhZ2VzSW5DaHVua3MoY2h1bmtTaXplOiBudW1iZXIgPSA1KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNoYXRDb250YWluZXIpIHJldHVybjtcbiAgICB0aGlzLmNoYXRDb250YWluZXIuZW1wdHkoKTtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWVzc2FnZXMubGVuZ3RoOyBpICs9IGNodW5rU2l6ZSkge1xuICAgICAgY29uc3QgY2h1bmsgPSB0aGlzLm1lc3NhZ2VzLnNsaWNlKGksIGkgKyBjaHVua1NpemUpO1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoY2h1bmsubWFwKG1lc3NhZ2UgPT4gXG4gICAgICAgIHRoaXMuYWRkTWVzc2FnZShtZXNzYWdlLnJvbGUsIG1lc3NhZ2UuY29udGVudCwgbWVzc2FnZS5tZXNzYWdlX2lkKVxuICAgICAgKSk7XG4gICAgICBpZiAoaSArIGNodW5rU2l6ZSA8IHRoaXMubWVzc2FnZXMubGVuZ3RoKSBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTApKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgfVxuXG4gIGFzeW5jIGFkZEZpbGVUb0NvbnRleHQoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNvbnRleHRNYW5hZ2VyLmFkZEZpbGVUb0NvbnRleHQoZmlsZSk7XG4gIH1cblxuICBhc3luYyBjb3B5VG9DbGlwYm9hcmQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmdldE1hcmtkb3duKCk7XG4gICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb250ZW50KTtcbiAgICAgIHNob3dOb3RpY2UoXCJDaGF0IGNvcGllZCB0byBjbGlwYm9hcmRcIiwgeyB0eXBlOiBcInN1Y2Nlc3NcIiB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc2hvd05vdGljZShcIkZhaWxlZCB0byBjb3B5IGNoYXQgdG8gY2xpcGJvYXJkXCIsIHsgdHlwZTogXCJlcnJvclwiIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRUb2tlbkxpbWl0KCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMudG9rZW5MaW1pdDtcbiAgfVxuXG4gIHB1YmxpYyBmb2N1c0lucHV0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0U2VsZWN0ZWRNb2RlbElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRNb2RlbElkO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNldFNlbGVjdGVkTW9kZWxJZChtb2RlbElkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIFNldHRpbmcgc2VsZWN0ZWQgbW9kZWw6XCIsIHtcbiAgICAgIG1vZGVsSWQsXG4gICAgICBwcmV2aW91c01vZGVsSWQ6IHRoaXMuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgYWN0aXZlUHJvdmlkZXI6IHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyXG4gICAgfSk7XG5cbiAgICB0aGlzLnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgIGNvbnN0IHNlbGVjdGVkTW9kZWwgPSBtb2RlbHMuZmluZCgobW9kZWwpID0+IG1vZGVsLmlkID09PSBtb2RlbElkKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgYWN0aXZlIHByb3ZpZGVyIGJhc2VkIG9uIHNlbGVjdGVkIG1vZGVsXG4gICAgaWYgKHNlbGVjdGVkTW9kZWwpIHtcbiAgICAgIGNvbnN0IGN1c3RvbVByb3ZpZGVyID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgIChwKSA9PiBwLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gc2VsZWN0ZWRNb2RlbC5wcm92aWRlci50b0xvd2VyQ2FzZSgpXG4gICAgICApO1xuICAgICAgaWYgKGN1c3RvbVByb3ZpZGVyKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyID0ge1xuICAgICAgICAgIGlkOiBjdXN0b21Qcm92aWRlci5pZCxcbiAgICAgICAgICBuYW1lOiBjdXN0b21Qcm92aWRlci5uYW1lLFxuICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlciA9IHtcbiAgICAgICAgICBpZDogXCJzeXN0ZW1zY3VscHRcIixcbiAgICAgICAgICBuYW1lOiBcIlN5c3RlbVNjdWxwdFwiLFxuICAgICAgICAgIHR5cGU6IFwibmF0aXZlXCIsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBTZWxlY3RlZCBtb2RlbCBkZXRhaWxzOlwiLCB7XG4gICAgICBtb2RlbDogc2VsZWN0ZWRNb2RlbCA/IHtcbiAgICAgICAgaWQ6IHNlbGVjdGVkTW9kZWwuaWQsXG4gICAgICAgIG5hbWU6IHNlbGVjdGVkTW9kZWwubmFtZSxcbiAgICAgICAgcHJvdmlkZXI6IHNlbGVjdGVkTW9kZWwucHJvdmlkZXIsXG4gICAgICAgIGlkZW50aWZpZXI6IHNlbGVjdGVkTW9kZWwuaWRlbnRpZmllclxuICAgICAgfSA6IG51bGwsXG4gICAgICB0b2tlbkxpbWl0OiB0aGlzLnRva2VuTGltaXQsXG4gICAgICB0b2tlbkxpbWl0UGVyY2VudGFnZTogdGhpcy50b2tlbkxpbWl0UGVyY2VudGFnZSxcbiAgICAgIGFjdGl2ZVByb3ZpZGVyOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlclxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgJiYgc2VsZWN0ZWRNb2RlbD8uY29udGV4dF9sZW5ndGgpIHtcbiAgICAgIHRoaXMudG9rZW5MaW1pdCA9IE1hdGguZmxvb3IoKHRoaXMudG9rZW5MaW1pdFBlcmNlbnRhZ2UgLyAxMDApICogc2VsZWN0ZWRNb2RlbC5jb250ZXh0X2xlbmd0aCk7XG4gICAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5pbnB1dEhhbmRsZXIub25Nb2RlbENoYW5nZSgpO1xuICAgIHRoaXMuZm9jdXNJbnB1dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRNYXJrZG93bigpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGxldCBjaGF0Q29udGVudCA9IFwiXCI7XG4gICAgaWYgKHRoaXMuc3lzdGVtUHJvbXB0VHlwZSkge1xuICAgICAgbGV0IHN5c3RlbVByb21wdENvbnRlbnQgPSBcIlwiO1xuICAgICAgaWYgKHRoaXMuc3lzdGVtUHJvbXB0VHlwZSA9PT0gXCJjdXN0b21cIiAmJiB0aGlzLnN5c3RlbVByb21wdFBhdGgpIHtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCh0aGlzLnN5c3RlbVByb21wdFBhdGggKyBcIi5tZFwiKTtcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkgc3lzdGVtUHJvbXB0Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHByZXNldCA9IGF3YWl0IFN5c3RlbVByb21wdFNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcy5hcHApLmdldFN5c3RlbVByb21wdEJ5SWQodGhpcy5zeXN0ZW1Qcm9tcHRUeXBlKTtcbiAgICAgICAgICBpZiAocHJlc2V0KSBzeXN0ZW1Qcm9tcHRDb250ZW50ID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQ6XCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHN5c3RlbVByb21wdENvbnRlbnQpIGNoYXRDb250ZW50ICs9IGBTeXN0ZW0gUHJvbXB0OlxcblwiXCJcIlwiXCJcXG4ke3N5c3RlbVByb21wdENvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGV4dEZpbGVzID0gdGhpcy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKTtcbiAgICBpZiAoY29udGV4dEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICBjaGF0Q29udGVudCArPSBcIkNvbnRleHQgRmlsZXM6XFxuXFxuXCI7XG4gICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGNvbnRleHRGaWxlcykge1xuICAgICAgICBpZiAoIWZpbGVQYXRoLnN0YXJ0c1dpdGgoXCJkb2M6XCIpKSB7XG4gICAgICAgICAgY29uc3QgY2xlYW5QYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIikucmVwbGFjZShcbiAgICAgICAgICAgIC9cXCRiZWdpbjptYXRoOmRpc3BsYXlcXCRcXFsoLio/KVxcJGVuZDptYXRoOmRpc3BsYXlcXCRdL2csXG4gICAgICAgICAgICBcIiQxXCJcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoY2xlYW5QYXRoLCBcIlwiKTtcbiAgICAgICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgIXJlc29sdmVkRmlsZS5leHRlbnNpb24ubWF0Y2goL14oanBnfGpwZWd8cG5nfGdpZnx3ZWJwKSQvaSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKHJlc29sdmVkRmlsZSk7XG4gICAgICAgICAgICBjaGF0Q29udGVudCArPSBgWyR7Y2xlYW5QYXRofV1cXG5cIlwiXCJcIlwiXFxuJHtjb250ZW50fVxcblwiXCJcIlwiXCJcXG5cXG5gO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNoYXRDb250ZW50ICs9IFwiQ2hhdCBIaXN0b3J5IFRodXMgRmFyOlxcblxcblwiO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiB0aGlzLm1lc3NhZ2VzKSB7XG4gICAgICBjb25zdCByb2xlID0gbWVzc2FnZS5yb2xlID09PSBcImFzc2lzdGFudFwiID8gXCJBXCIgOiBcIlVzZXJcIjtcbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5jb250ZW50ID09PSBcInN0cmluZ1wiKSBjaGF0Q29udGVudCArPSBgJHtyb2xlfTpcXG5cIlwiXCJcIlwiXFxuJHttZXNzYWdlLmNvbnRlbnR9XFxuXCJcIlwiXCJcIlxcblxcbmA7XG4gICAgfVxuICAgIHJldHVybiBjaGF0Q29udGVudDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNZXNzYWdlcygpOiBDaGF0TWVzc2FnZVtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubWVzc2FnZXNdO1xuICB9XG5cbiAgcHVibGljIGdldENoYXRUaXRsZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNoYXRUaXRsZTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZXRUaXRsZShuZXdUaXRsZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5jaGF0VGl0bGUgPSBuZXdUaXRsZTtcbiAgICBhd2FpdCB0aGlzLnNhdmVDaGF0KCk7XG4gICAgaWYgKHRoaXMubGVhZikge1xuICAgICAgdGhpcy5sZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICAgIHR5cGU6IENIQVRfVklFV19UWVBFLFxuICAgICAgICBzdGF0ZToge1xuICAgICAgICAgIGNoYXRJZDogdGhpcy5jaGF0SWQsXG4gICAgICAgICAgc2VsZWN0ZWRNb2RlbElkOiB0aGlzLnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgICBjaGF0VGl0bGU6IG5ld1RpdGxlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLmFwcC53b3Jrc3BhY2UucmVxdWVzdFNhdmVMYXlvdXQoKTtcbiAgfVxufSIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBwYXJzZVlhbWwsIHN0cmluZ2lmeVlhbWwgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBDaGF0Um9sZSwgU3lzdGVtUHJvbXB0UHJlc2V0IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmludGVyZmFjZSBDb250ZXh0RmlsZSB7XG4gIHBhdGg6IHN0cmluZztcbiAgdHlwZTogXCJzb3VyY2VcIiB8IFwiZXh0cmFjdGlvblwiO1xufVxuXG5pbnRlcmZhY2UgQ2hhdE1ldGFkYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgbW9kZWw6IHN0cmluZztcbiAgY3JlYXRlZDogc3RyaW5nO1xuICBsYXN0TW9kaWZpZWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGV4dF9maWxlcz86IENvbnRleHRGaWxlW107XG4gIHN5c3RlbU1lc3NhZ2U/OiB7XG4gICAgdHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgICB0b2tlbkxpbWl0UGVyY2VudGFnZT86IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIENoYXRTdG9yYWdlU2VydmljZSB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY2hhdERpcmVjdG9yeTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBjaGF0RGlyZWN0b3J5OiBzdHJpbmcpIHtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLmNoYXREaXJlY3RvcnkgPSBjaGF0RGlyZWN0b3J5O1xuICB9XG5cbiAgYXN5bmMgc2F2ZUNoYXQoXG4gICAgY2hhdElkOiBzdHJpbmcsXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10sXG4gICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmcsXG4gICAgY29udGV4dEZpbGVzPzogU2V0PHN0cmluZz4sXG4gICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmcsXG4gICAgc3lzdGVtUHJvbXB0VHlwZT86IFwiZ2VuZXJhbC11c2VcIiB8IFwiY29uY2lzZVwiIHwgXCJjdXN0b21cIixcbiAgICBzeXN0ZW1Qcm9tcHRQYXRoPzogc3RyaW5nLFxuICAgIHRpdGxlPzogc3RyaW5nLFxuICAgIHRva2VuTGltaXQ/OiBudW1iZXIsXG4gICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U/OiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5jaGF0RGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuXG4gICAgICAvLyBDb252ZXJ0IFNldDxzdHJpbmc+IHRvIENvbnRleHRGaWxlW11cbiAgICAgIGNvbnN0IGNvbnRleHRGaWxlT2JqZWN0cyA9IGNvbnRleHRGaWxlc1xuICAgICAgICA/IEFycmF5LmZyb20oY29udGV4dEZpbGVzKS5tYXAoKHBhdGgpID0+IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYW4gZXh0cmFjdGlvbiBieSBsb29raW5nIGF0IHRoZSBwYXRoXG4gICAgICAgICAgICBjb25zdCBpc0V4dHJhY3Rpb24gPSBwYXRoLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICAgIHR5cGU6IGlzRXh0cmFjdGlvblxuICAgICAgICAgICAgICAgID8gKFwiZXh0cmFjdGlvblwiIGFzIGNvbnN0KVxuICAgICAgICAgICAgICAgIDogKFwic291cmNlXCIgYXMgY29uc3QpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICA6IFtdO1xuXG4gICAgICBjb25zdCBtZXRhZGF0YTogQ2hhdE1ldGFkYXRhID0ge1xuICAgICAgICBpZDogY2hhdElkLFxuICAgICAgICBtb2RlbDogc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB0aXRsZTogdGl0bGUgfHwgY2hhdElkLFxuICAgICAgICBjb250ZXh0X2ZpbGVzOiBjb250ZXh0RmlsZU9iamVjdHMsXG4gICAgICAgIHN5c3RlbU1lc3NhZ2U6IHN5c3RlbVByb21wdFR5cGVcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgdHlwZTogc3lzdGVtUHJvbXB0VHlwZSxcbiAgICAgICAgICAgICAgcGF0aDpcbiAgICAgICAgICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlID09PSBcImN1c3RvbVwiICYmIHN5c3RlbVByb21wdFBhdGhcbiAgICAgICAgICAgICAgICAgID8gYFtbJHtzeXN0ZW1Qcm9tcHRQYXRofV1dYFxuICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHRva2VuTGltaXQsXG4gICAgICAgICAgICAgIHRva2VuTGltaXRQZXJjZW50YWdlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGVudCA9IGAtLS1cXG4ke3N0cmluZ2lmeVlhbWwobWV0YWRhdGEpfS0tLVxcblxcbiR7bWVzc2FnZXNcbiAgICAgICAgLm1hcCgobXNnKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWVzc2FnZVN0YXJ0ID0gYDwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtU1RBUlQgcm9sZT1cIiR7bXNnLnJvbGV9XCIgbWVzc2FnZS1pZD1cIiR7bXNnLm1lc3NhZ2VfaWR9XCIgLS0+YDtcbiAgICAgICAgICByZXR1cm4gYCR7bWVzc2FnZVN0YXJ0fVxcbiR7bXNnLmNvbnRlbnR9XFxuPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+YDtcbiAgICAgICAgfSlcbiAgICAgICAgLmpvaW4oXCJcXG5cXG5cIil9YDtcblxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2Rpcih0aGlzLmNoYXREaXJlY3RvcnkpO1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci53cml0ZShmaWxlUGF0aCwgY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBjaGF0OlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBjaGF0XCIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRDaGF0cygpOiBQcm9taXNlPFxuICAgIHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICAgICAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICAgICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gICAgfVtdXG4gID4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIubGlzdCh0aGlzLmNoYXREaXJlY3RvcnkpO1xuICAgICAgY29uc3QgY2hhdEZpbGVzID0gZmlsZXMuZmlsZXMuZmlsdGVyKChmKSA9PiBmLmVuZHNXaXRoKFwiLm1kXCIpKTtcblxuICAgICAgY29uc3QgY2hhdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgY2hhdEZpbGVzLm1hcChhc3luYyAoZmlsZVBhdGgpID0+IHtcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5yZWFkKGZpbGVQYXRoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZU1hcmtkb3duQ29udGVudChjb250ZW50KTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBjaGF0cy5maWx0ZXIoXG4gICAgICAgIChjaGF0KTogY2hhdCBpcyBOb25OdWxsYWJsZTx0eXBlb2YgY2hhdD4gPT4gY2hhdCAhPT0gbnVsbFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXRzOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENoYXQoY2hhdElkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICBpZDogc3RyaW5nO1xuICAgIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICAgIHNlbGVjdGVkTW9kZWxJZDogc3RyaW5nO1xuICAgIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgY29udGV4dF9maWxlcz86IHN0cmluZ1tdO1xuICAgIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICAgIHRva2VuTGltaXQ/OiBudW1iZXI7XG4gIH0gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5jaGF0RGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VNYXJrZG93bkNvbnRlbnQoY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBjaGF0OlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWFya2Rvd25Db250ZW50KFxuICAgIG1ldGFkYXRhOiBDaGF0TWV0YWRhdGEsXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW11cbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCB5YW1sTWV0YWRhdGEgPSB7XG4gICAgICBzeXN0ZW1zY3VscHRfY2hhdDogdHJ1ZSxcbiAgICAgIC4uLm1ldGFkYXRhLFxuICAgIH07XG5cbiAgICBjb25zdCBtZXRhZGF0YVNlY3Rpb24gPSBbXG4gICAgICBcIi0tLVwiLFxuICAgICAgc3RyaW5naWZ5WWFtbCh5YW1sTWV0YWRhdGEpLnRyaW0oKSxcbiAgICAgIFwiLS0tXCIsXG4gICAgICBcIlwiLFxuICAgIF0uam9pbihcIlxcblwiKTtcblxuICAgIGNvbnN0IG1lc3NhZ2VzU2VjdGlvbiA9IG1lc3NhZ2VzXG4gICAgICAubWFwKChtc2cpID0+XG4gICAgICAgIFtcbiAgICAgICAgICBgPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1TVEFSVCByb2xlPVwiJHttc2cucm9sZX1cIiBtZXNzYWdlLWlkPVwiJHttc2cubWVzc2FnZV9pZH1cIiAtLT5gLFxuICAgICAgICAgIG1zZy5jb250ZW50LFxuICAgICAgICAgIFwiPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+XCIsXG4gICAgICAgICAgXCJcIixcbiAgICAgICAgXS5qb2luKFwiXFxuXCIpXG4gICAgICApXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIHJldHVybiBtZXRhZGF0YVNlY3Rpb24gKyBtZXNzYWdlc1NlY3Rpb247XG4gIH1cblxuICBwcml2YXRlIHBhcnNlTWV0YWRhdGEoY29udGVudDogc3RyaW5nKTogQ2hhdE1ldGFkYXRhIHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1ldGFkYXRhTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC8tLS1cXG4oW1xcc1xcU10qPylcXG4tLS0vKTtcbiAgICAgIGlmICghbWV0YWRhdGFNYXRjaCkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlWWFtbChtZXRhZGF0YU1hdGNoWzFdKTtcbiAgICAgIGlmICghcGFyc2VkIHx8IHR5cGVvZiBwYXJzZWQgIT09IFwib2JqZWN0XCIpIHJldHVybiBudWxsO1xuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGlkLFxuICAgICAgICBtb2RlbCxcbiAgICAgICAgY3JlYXRlZCxcbiAgICAgICAgbGFzdE1vZGlmaWVkLFxuICAgICAgICB0aXRsZSxcbiAgICAgICAgY29udGV4dF9maWxlcyxcbiAgICAgICAgc3lzdGVtTWVzc2FnZSxcbiAgICAgIH0gPSBwYXJzZWQ7XG4gICAgICBpZiAoIWlkIHx8ICFtb2RlbCB8fCAhY3JlYXRlZCB8fCAhbGFzdE1vZGlmaWVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgLy8gQ29udmVydCBvbGQgZm9ybWF0IChzdHJpbmdbXSkgdG8gbmV3IGZvcm1hdCAoQ29udGV4dEZpbGVbXSlcbiAgICAgIGNvbnN0IHByb2Nlc3NlZENvbnRleHRGaWxlcyA9IGNvbnRleHRfZmlsZXM/Lm1hcChcbiAgICAgICAgKGZpbGU6IHN0cmluZyB8IENvbnRleHRGaWxlKSA9PiB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBmaWxlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAvLyBMZWdhY3kgZm9ybWF0IC0gY29udmVydCB0byBuZXcgZm9ybWF0XG4gICAgICAgICAgICBjb25zdCBpc0V4dHJhY3Rpb24gPSBmaWxlLmluY2x1ZGVzKFwiL0V4dHJhY3Rpb25zL1wiKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBhdGg6IGZpbGUsXG4gICAgICAgICAgICAgIHR5cGU6IGlzRXh0cmFjdGlvblxuICAgICAgICAgICAgICAgID8gKFwiZXh0cmFjdGlvblwiIGFzIGNvbnN0KVxuICAgICAgICAgICAgICAgIDogKFwic291cmNlXCIgYXMgY29uc3QpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGg6IGZpbGUucGF0aCxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBDbGVhbiB1cCBzeXN0ZW0gbWVzc2FnZSBwYXRoIGlmIGl0IGV4aXN0c1xuICAgICAgaWYgKHN5c3RlbU1lc3NhZ2U/LnBhdGgpIHtcbiAgICAgICAgc3lzdGVtTWVzc2FnZS5wYXRoID0gc3lzdGVtTWVzc2FnZS5wYXRoLnJlcGxhY2UoXG4gICAgICAgICAgL15cXFtcXFsoLio/KVxcXVxcXSQvLFxuICAgICAgICAgIFwiJDFcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZCxcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIGNyZWF0ZWQsXG4gICAgICAgIGxhc3RNb2RpZmllZCxcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8IGlkLFxuICAgICAgICBjb250ZXh0X2ZpbGVzOiBwcm9jZXNzZWRDb250ZXh0RmlsZXMgfHwgW10sXG4gICAgICAgIHN5c3RlbU1lc3NhZ2UsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIG1ldGFkYXRhOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBhcnNlTWFya2Rvd25Db250ZW50KGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgc2VsZWN0ZWRNb2RlbElkOiBzdHJpbmc7XG4gICAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBjb250ZXh0X2ZpbGVzPzogc3RyaW5nW107XG4gICAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gICAgdG9rZW5MaW1pdD86IG51bWJlcjtcbiAgfSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLnBhcnNlTWV0YWRhdGEoY29udGVudCk7XG4gICAgICBpZiAoIW1ldGFkYXRhKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10gPSBbXTtcblxuICAgICAgLy8gUGFyc2UgdXNlciBhbmQgYXNzaXN0YW50IG1lc3NhZ2VzXG4gICAgICBjb25zdCBtZXNzYWdlUmVnZXggPVxuICAgICAgICAvPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1TVEFSVCByb2xlPVwiKHVzZXJ8YXNzaXN0YW50KVwiIG1lc3NhZ2UtaWQ9XCIoW15cIl0rKVwiIC0tPlxcbihbXFxzXFxTXSo/KVxcbjwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtRU5EIC0tPi9nO1xuXG4gICAgICBsZXQgbXNnTWF0Y2g7XG4gICAgICB3aGlsZSAoKG1zZ01hdGNoID0gbWVzc2FnZVJlZ2V4LmV4ZWMoY29udGVudCkpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IFssIHJvbGUsIG1lc3NhZ2VJZCwgbWVzc2FnZUNvbnRlbnRdID0gbXNnTWF0Y2g7XG4gICAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgIHJvbGU6IHJvbGUgYXMgQ2hhdFJvbGUsXG4gICAgICAgICAgY29udGVudDogbWVzc2FnZUNvbnRlbnQudHJpbSgpLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvbnZlcnQgQ29udGV4dEZpbGVbXSB0byBzdHJpbmdbXSBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgY29uc3QgY29udGV4dEZpbGVzID0gbWV0YWRhdGEuY29udGV4dF9maWxlcz8ubWFwKChmaWxlKSA9PlxuICAgICAgICB0eXBlb2YgZmlsZSA9PT0gXCJzdHJpbmdcIiA/IGZpbGUgOiBmaWxlLnBhdGhcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBtZXRhZGF0YS5pZCxcbiAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgIHNlbGVjdGVkTW9kZWxJZDogbWV0YWRhdGEubW9kZWwsXG4gICAgICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUobWV0YWRhdGEubGFzdE1vZGlmaWVkKS5nZXRUaW1lKCksXG4gICAgICAgIHRpdGxlOiBtZXRhZGF0YS50aXRsZSxcbiAgICAgICAgY29udGV4dF9maWxlczogY29udGV4dEZpbGVzLFxuICAgICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDogbWV0YWRhdGEuc3lzdGVtTWVzc2FnZT8ucGF0aCxcbiAgICAgICAgdG9rZW5MaW1pdDogbWV0YWRhdGEuc3lzdGVtTWVzc2FnZT8udG9rZW5MaW1pdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgbWFya2Rvd24gY29udGVudDpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lc3NhZ2VJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XG4gICAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0TWV0YWRhdGEoY2hhdElkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRNZXRhZGF0YSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLmNoYXREaXJlY3Rvcnl9LyR7Y2hhdElkfS5tZGA7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZU1ldGFkYXRhKGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBtZXRhZGF0YTpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgTWFya2Rvd25SZW5kZXJlciwgVEZpbGUsIEFwcCwgQ29tcG9uZW50LCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDaGF0Um9sZSwgSW1hZ2VDb250ZW50LCBNdWx0aVBhcnRDb250ZW50IH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAsIFRleHRBcmVhTW9kYWwgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VSZW5kZXJPcHRpb25zIHtcbiAgYXBwOiBBcHA7XG4gIG1lc3NhZ2VJZDogc3RyaW5nO1xuICByb2xlOiBDaGF0Um9sZTtcbiAgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdO1xufVxuXG5leHBvcnQgY2xhc3MgTWVzc2FnZVJlbmRlcmVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVuZGVyTWVzc2FnZSh7XG4gICAgYXBwLFxuICAgIG1lc3NhZ2VJZCxcbiAgICByb2xlLFxuICAgIGNvbnRlbnQsXG4gIH06IHtcbiAgICBhcHA6IEFwcDtcbiAgICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgICByb2xlOiBDaGF0Um9sZTtcbiAgICBjb250ZW50OiBzdHJpbmcgfCBNdWx0aVBhcnRDb250ZW50W107XG4gIH0pOiBQcm9taXNlPHsgbWVzc2FnZUVsOiBIVE1MRWxlbWVudDsgY29udGVudEVsOiBIVE1MRWxlbWVudCB9PiB7XG4gICAgY29uc3QgbWVzc2FnZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtZXNzYWdlRWwuY2xhc3NMaXN0LmFkZChcInN5c3RlbXNjdWxwdC1tZXNzYWdlXCIpO1xuICAgIG1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKGBzeXN0ZW1zY3VscHQtJHtyb2xlfS1tZXNzYWdlYCk7XG4gICAgbWVzc2FnZUVsLmRhdGFzZXQubWVzc2FnZUlkID0gbWVzc2FnZUlkO1xuXG4gICAgY29uc3QgY29udGVudEVsID0gbWVzc2FnZUVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIC8vIEV4aXN0aW5nIHBhdGg6IHRyZWF0IGl0IGFzIG1hcmtkb3duIHRleHRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oY29udGVudCwgY29udGVudEVsLCBcIlwiLCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudCBhcyBNdWx0aVBhcnRDb250ZW50W107XG4gICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHtcbiAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAvLyBTaW1wbGUgdGV4dCBzbmlwcGV0XG4gICAgICAgICAgY29uc3QgcCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcInBcIik7XG4gICAgICAgICAgcC5zZXRUZXh0KHBhcnQudGV4dCk7XG4gICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBcImltYWdlX3VybFwiKSB7XG4gICAgICAgICAgLy8gSW5zZXJ0IHRoZSA8aW1nPlxuICAgICAgICAgIGNvbnN0IGltZyA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImltZ1wiLCB7XG4gICAgICAgICAgICBhdHRyOiB7IHNyYzogcGFydC5pbWFnZV91cmwudXJsIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaW1nLmNsYXNzTGlzdC5hZGQoXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1pbWFnZVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjayBpZiBuZWVkZWRcbiAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgIFN0cmluZyhjb250ZW50KSxcbiAgICAgICAgY29udGVudEVsLFxuICAgICAgICBcIlwiLFxuICAgICAgICB0aGlzXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnNldHVwSW1hZ2VIYW5kbGVycyhjb250ZW50RWwpO1xuXG4gICAgcmV0dXJuIHsgbWVzc2FnZUVsLCBjb250ZW50RWwgfTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZW5kZXJNYXJrZG93bkNvbnRlbnQoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29uc3QgbWFya2Rvd25XcmFwcGVyID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tYXJrZG93bi13cmFwcGVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvXFxuezMsfS9nLCBcIlxcblxcblwiKTtcblxuICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICBub3JtYWxpemVkQ29udGVudCxcbiAgICAgIG1hcmtkb3duV3JhcHBlcixcbiAgICAgIFwiXCIsXG4gICAgICB0aGlzXG4gICAgKTtcblxuICAgIG1hcmtkb3duV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKFwicHJlXCIpLmZvckVhY2goKHByZUVsKSA9PiB7XG4gICAgICBjb25zdCBjb2RlQmxvY2tXcmFwcGVyID0gY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvZGUtYmxvY2std3JhcHBlclwiLFxuICAgICAgfSk7XG5cbiAgICAgIHByZUVsLnBhcmVudE5vZGU/LnJlcGxhY2VDaGlsZChjb2RlQmxvY2tXcmFwcGVyLCBwcmVFbCk7XG4gICAgICBjb2RlQmxvY2tXcmFwcGVyLmFwcGVuZENoaWxkKHByZUVsKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXR1cEltYWdlSGFuZGxlcnMoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29udGFpbmVyRWwucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKS5mb3JFYWNoKChpbWcpID0+IHtcbiAgICAgIGltZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGNvbnN0IHNyYyA9IGltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gICAgICAgIGlmICghc3JjKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHNyYy5zdGFydHNXaXRoKFwiYXBwOi8vXCIpKSB7XG4gICAgICAgICAgY29uc3QgcGF0aCA9IHNyYy5yZXBsYWNlKFwiYXBwOi8vbG9jYWwvXCIsIFwiXCIpO1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQocGF0aCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb29sYmFyVmlzaWJpbGl0eShcbiAgICB0b29sYmFyOiBIVE1MRWxlbWVudCxcbiAgICB2aXNpYmxlOiBib29sZWFuLFxuICAgIGV4cGFuZGVkOiBib29sZWFuID0gZmFsc2VcbiAgKTogdm9pZCB7XG4gICAgdG9vbGJhci5zdHlsZS5vcGFjaXR5ID0gdmlzaWJsZSA/IFwiMVwiIDogXCIwXCI7XG4gICAgdG9vbGJhci5zdHlsZS5wb2ludGVyRXZlbnRzID0gdmlzaWJsZSA/IFwiYWxsXCIgOiBcIm5vbmVcIjtcbiAgICB0b29sYmFyLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKGNhbGMoMTAwJSArICR7XG4gICAgICBleHBhbmRlZCA/IFwiNFwiIDogXCI4XCJcbiAgICB9cHgpKWA7XG4gIH1cblxuICBwdWJsaWMgYWRkTWVzc2FnZUJ1dHRvblRvb2xiYXIoXG4gICAgbWVzc2FnZUVsOiBIVE1MRWxlbWVudCxcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgcm9sZTogQ2hhdFJvbGUsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmdcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYnV0dG9uVG9vbGJhciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2UtYnV0dG9uLXRvb2xiYXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvcHlCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBjb3B5QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiQ29weSBtZXNzYWdlIHRvIGNsaXBib2FyZFwiKTtcbiAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICBjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb250ZW50KTtcbiAgICAgIHNldEljb24oY29weUJ1dHRvbiwgXCJjaGVja1wiKTtcbiAgICAgIGNvcHlCdXR0b24uY2xhc3NMaXN0LmFkZChcInN1Y2Nlc3NcIik7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJY29uKGNvcHlCdXR0b24sIFwiY29weVwiKTtcbiAgICAgICAgY29weUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic3VjY2Vzc1wiKTtcbiAgICAgICAgdGhpcy5zZXRUb29sYmFyVmlzaWJpbGl0eShidXR0b25Ub29sYmFyLCBmYWxzZSk7XG4gICAgICB9LCAyMDAwKTtcbiAgICB9KTtcblxuICAgIGlmIChyb2xlID09PSBcInVzZXJcIikge1xuICAgICAgY29uc3QgcmVzdWJtaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlLWJ1dHRvblwiLFxuICAgICAgfSk7XG4gICAgICByZXN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlJlc3VibWl0IHRoaXMgbWVzc2FnZVwiKTtcbiAgICAgIHNldEljb24ocmVzdWJtaXRCdXR0b24sIFwicm90YXRlLWNjd1wiKTtcbiAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJyb3RhdGUtY2N3XCI7XG5cbiAgICAgIHJlc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBpc0NvbmZpcm1pbmcgPSByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPT09IFwidHJ1ZVwiO1xuXG4gICAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZGF0YXNldC5jb25maXJtaW5nID0gXCJ0cnVlXCI7XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0P1wiIH0pO1xuICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcblxuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZCA9IHRpbWVvdXRJZC50b1N0cmluZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHJlc3VibWl0QnV0dG9uLmRhdGFzZXQudGltZW91dElkO1xuICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICByZXN1Ym1pdEJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlJlc3VibWl0dGluZy4uLlwiIH0pO1xuXG4gICAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJyZXN1Ym1pdFwiLCB7XG4gICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQsIGNvbnRlbnQgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzdWJtaXRCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9XG4gICAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uIHx8IFwicm90YXRlLWNjd1wiO1xuICAgICAgICAgICAgc2V0SWNvbihyZXN1Ym1pdEJ1dHRvbiwgb3JpZ2luYWxJY29uKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIHJlc3VibWl0QnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFuIFwiRWRpdFwiIGJ1dHRvblxuICAgIGNvbnN0IGVkaXRCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b25cIixcbiAgICB9KTtcbiAgICBlZGl0QnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRWRpdCB0aGlzIG1lc3NhZ2VcIik7XG4gICAgc2V0SWNvbihlZGl0QnV0dG9uLCBcInBlbmNpbFwiKTtcbiAgICBlZGl0QnV0dG9uLmRhdGFzZXQub3JpZ2luYWxJY29uID0gXCJwZW5jaWxcIjtcblxuICAgIC8vIEhhbmRsZSBjbGljayBcdTIxOTIgb3BlbiBhbiBlZGl0aW5nIG1vZGFsXG4gICAgZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIFVzZSBleGlzdGluZyB0ZXh0LWFyZWEgbW9kYWwgZm9yIGVkaXRpbmdcbiAgICAgIC8vIEdldCBjdXJyZW50IGNvbnRlbnQgZnJvbSBkYXRhc2V0IHdoaWNoIGlzIGFsd2F5cyB1cC10by1kYXRlXG4gICAgICBjb25zdCBjdXJyZW50Q29udGVudCA9IG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgfHwgY29udGVudDtcbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IFRleHRBcmVhTW9kYWwoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIkVkaXQgTWVzc2FnZVwiLFxuICAgICAgICBjdXJyZW50Q29udGVudCxcbiAgICAgICAge1xuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiU2F2ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICByb3dzOiAxMCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgbmV3VGV4dCA9IGF3YWl0IG1vZGFsLm9wZW5BbmRHZXRWYWx1ZSgpO1xuICAgICAgaWYgKG5ld1RleHQgIT09IG51bGwgJiYgbmV3VGV4dCAhPT0gY3VycmVudENvbnRlbnQpIHtcbiAgICAgICAgLy8gRGlzcGF0Y2ggZWRpdCBldmVudCB3aXRoIG9sZCBhbmQgbmV3IGNvbnRlbnRcbiAgICAgICAgbWVzc2FnZUVsLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KFwiZWRpdFwiLCB7XG4gICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgZGV0YWlsOiB7XG4gICAgICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICAgICAgb2xkQ29udGVudDogY3VycmVudENvbnRlbnQsXG4gICAgICAgICAgICAgIG5ld0NvbnRlbnQ6IG5ld1RleHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZWxldGVCdXR0b24gPSBidXR0b25Ub29sYmFyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1idXR0b24gZGFuZ2VyXCIsXG4gICAgfSk7XG4gICAgZGVsZXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiRGVsZXRlIHRoaXMgbWVzc2FnZVwiKTtcbiAgICBzZXRJY29uKGRlbGV0ZUJ1dHRvbiwgXCJ0cmFzaFwiKTtcbiAgICBkZWxldGVCdXR0b24uZGF0YXNldC5vcmlnaW5hbEljb24gPSBcInRyYXNoXCI7XG5cbiAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgaXNDb25maXJtaW5nID0gZGVsZXRlQnV0dG9uLmRhdGFzZXQuY29uZmlybWluZyA9PT0gXCJ0cnVlXCI7XG5cbiAgICAgIGlmICghaXNDb25maXJtaW5nKSB7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcInRydWVcIjtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmVtcHR5KCk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIkRlbGV0ZT9cIiB9KTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjb25maXJtaW5nXCIpO1xuXG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDMwMDApO1xuICAgICAgICBkZWxldGVCdXR0b24uZGF0YXNldC50aW1lb3V0SWQgPSB0aW1lb3V0SWQudG9TdHJpbmcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LnRpbWVvdXRJZDtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChwYXJzZUludCh0aW1lb3V0SWQpKTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGVCdXR0b24uZW1wdHkoKTtcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNyZWF0ZUVsKFwic3BhblwiLCB7IHRleHQ6IFwiRGVsZXRpbmcuLi5cIiB9KTtcblxuICAgICAgICBtZXNzYWdlRWwuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJkZWxldGVcIiwge1xuICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgIGRldGFpbDogeyBtZXNzYWdlSWQgfSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5lbXB0eSgpO1xuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsSWNvbiA9IGRlbGV0ZUJ1dHRvbi5kYXRhc2V0Lm9yaWdpbmFsSWNvbiB8fCBcInRyYXNoXCI7XG4gICAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIG9yaWdpbmFsSWNvbik7XG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjb25maXJtaW5nXCIpO1xuICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5kYXRhc2V0LmNvbmZpcm1pbmcgPSBcImZhbHNlXCI7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgdHJ1ZSwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgIWUucmVsYXRlZFRhcmdldCB8fFxuICAgICAgICAhYnV0dG9uVG9vbGJhci5jb250YWlucyhlLnJlbGF0ZWRUYXJnZXQgYXMgTm9kZSlcbiAgICAgICkge1xuICAgICAgICB0aGlzLnNldFRvb2xiYXJWaXNpYmlsaXR5KGJ1dHRvblRvb2xiYXIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGJ1dHRvblRvb2xiYXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFtZXNzYWdlRWwuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0IGFzIE5vZGUpKSB7XG4gICAgICAgIHRoaXMuc2V0VG9vbGJhclZpc2liaWxpdHkoYnV0dG9uVG9vbGJhciwgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVJlYXNvbmluZ0NvbnRhaW5lcihtZXNzYWdlRWw6IEhUTUxFbGVtZW50KToge1xuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgY29udGVudDogSFRNTEVsZW1lbnQ7XG4gIH0ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IG1lc3NhZ2VFbC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1oZWFkZXJcIixcbiAgICB9KTtcbiAgICBzZXRJY29uKGhlYWRlciwgXCJicmFpblwiKTtcbiAgICBoZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiUmVhc29uaW5nXCIgfSk7XG5cbiAgICAvLyBBZGQgY2xpY2sgaGFuZGxlciB0byB0b2dnbGUgY29sbGFwc2VcbiAgICBoZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKFwiY29sbGFwc2VkXCIpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIsXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBjb250YWluZXIsIGNvbnRlbnQgfTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVSZWFzb25pbmdDb250ZW50KFxuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQsXG4gICAgcmVhc29uaW5nOiBzdHJpbmcsXG4gICAgaXNDb21wbGV0ZTogYm9vbGVhbiA9IGZhbHNlXG4gICk6IHZvaWQge1xuICAgIGxldCBjb250YWluZXIgPSBtZXNzYWdlRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1yZWFzb25pbmctY29udGFpbmVyXCJcbiAgICApO1xuICAgIGxldCBjb250ZW50ID0gbWVzc2FnZUVsLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LXJlYXNvbmluZy1jb250ZW50XCIpO1xuXG4gICAgaWYgKCFjb250YWluZXIgfHwgIWNvbnRlbnQpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5jcmVhdGVSZWFzb25pbmdDb250YWluZXIobWVzc2FnZUVsKTtcbiAgICAgIGNvbnRhaW5lciA9IGVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgICAgIGNvbnRlbnQgPSBlbGVtZW50cy5jb250ZW50O1xuICAgICAgbWVzc2FnZUVsLnByZXBlbmQoY29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBjb250ZW50LnRleHRDb250ZW50ID0gcmVhc29uaW5nO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcblxuICAgIC8vIEF1dG8tY29sbGFwc2Ugd2hlbiBzdHJlYW1pbmcgaXMgY29tcGxldGVcbiAgICBpZiAoaXNDb21wbGV0ZSkge1xuICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJjb2xsYXBzZWRcIik7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi9DaGF0Vmlld1wiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvTW9kZWxTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgc2hvd1BvcHVwLCBzaG93RW5oYW5jZWROb3RpY2UgfSBmcm9tIFwiLi4vLi4vY29yZS91aS9cIjtcbmltcG9ydCB7IEZpbGVDb250ZXh0TWFuYWdlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0ZpbGVDb250ZXh0TWFuYWdlclwiO1xuaW1wb3J0IHsgU2Nyb2xsTWFuYWdlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvU2Nyb2xsTWFuYWdlclNlcnZpY2VcIjtcbmltcG9ydCB7IElucHV0SGFuZGxlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0lucHV0SGFuZGxlclwiO1xuXG5leHBvcnQgY29uc3QgdWlTZXR1cCA9IHtcbiAgb25PcGVuOiBhc3luYyBmdW5jdGlvbihjaGF0VmlldzogQ2hhdFZpZXcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBjaGF0Vmlldy5jb250YWluZXJFbC5jaGlsZHJlblsxXSBhcyBIVE1MRWxlbWVudDtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcbiAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY2hhdC1jb250YWluZXJcIik7XG5cbiAgICBjaGF0Vmlldy5zZXR1cERyYWdBbmREcm9wKGNvbnRhaW5lcik7XG5cbiAgICBjb25zdCBoZWFkZXJDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGVhZGVyXCIgfSk7XG4gICAgY29uc3QgaGVhZGVyUm93ID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWhlYWRlci1yb3dcIiB9KTtcbiAgICBjb25zdCBsZWZ0U2VjdGlvbiA9IGhlYWRlclJvdy5jcmVhdGVFbChcImRpdlwiLCB7IGNsczogXCJzeXN0ZW1zY3VscHQtaGVhZGVyLXNlY3Rpb24tbGVmdFwiIH0pO1xuXG4gICAgY2hhdFZpZXcuY29udGV4dE1hbmFnZXIgPSBuZXcgRmlsZUNvbnRleHRNYW5hZ2VyKHtcbiAgICAgIGFwcDogY2hhdFZpZXcuYXBwLFxuICAgICAgY29udGFpbmVyOiBsZWZ0U2VjdGlvbixcbiAgICAgIG9uQ29udGV4dENoYW5nZTogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBjaGF0Vmlldy5zYXZlQ2hhdCgpO1xuICAgICAgICBhd2FpdCBjaGF0Vmlldy5jb250ZXh0TWFuYWdlci5jaGVja1N5bmNTdGF0dXMoKTtcbiAgICAgIH0sXG4gICAgICBzY3VscHRTZXJ2aWNlOiBjaGF0Vmlldy5haVNlcnZpY2UsXG4gICAgICBwbHVnaW46IGNoYXRWaWV3LnBsdWdpbixcbiAgICB9KTtcblxuICAgIGNoYXRWaWV3LmNoYXRDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1lc3NhZ2VzLWNvbnRhaW5lclwiIH0pO1xuICAgIGNoYXRWaWV3LnNjcm9sbE1hbmFnZXIgPSBuZXcgU2Nyb2xsTWFuYWdlclNlcnZpY2UoeyBjb250YWluZXI6IGNoYXRWaWV3LmNoYXRDb250YWluZXIgfSk7XG5cbiAgICBjaGF0Vmlldy5pbnB1dEhhbmRsZXIgPSBuZXcgSW5wdXRIYW5kbGVyKHtcbiAgICAgIGFwcDogY2hhdFZpZXcuYXBwLFxuICAgICAgY29udGFpbmVyLFxuICAgICAgYWlTZXJ2aWNlOiBjaGF0Vmlldy5haVNlcnZpY2UsXG4gICAgICBnZXRNZXNzYWdlczogKCkgPT4gWy4uLmNoYXRWaWV3Lm1lc3NhZ2VzXSxcbiAgICAgIGdldFNlbGVjdGVkTW9kZWxJZDogKCkgPT4gY2hhdFZpZXcuc2VsZWN0ZWRNb2RlbElkLFxuICAgICAgZ2V0Q29udGV4dEZpbGVzOiAoKSA9PiBjaGF0Vmlldy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKSxcbiAgICAgIGdldFN5c3RlbVByb21wdDogKCkgPT4gKHsgdHlwZTogY2hhdFZpZXcuc3lzdGVtUHJvbXB0VHlwZSwgcGF0aDogY2hhdFZpZXcuc3lzdGVtUHJvbXB0UGF0aCB9KSxcbiAgICAgIGNoYXRDb250YWluZXI6IGNoYXRWaWV3LmNoYXRDb250YWluZXIsXG4gICAgICBzY3JvbGxNYW5hZ2VyOiBjaGF0Vmlldy5zY3JvbGxNYW5hZ2VyLFxuICAgICAgbWVzc2FnZVJlbmRlcmVyOiBjaGF0Vmlldy5tZXNzYWdlUmVuZGVyZXIsXG4gICAgICBvbk1lc3NhZ2VTdWJtaXQ6IGFzeW5jIChtZXNzYWdlKSA9PiB7XG4gICAgICAgIGNoYXRWaWV3Lm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgICAgIGF3YWl0IGNoYXRWaWV3LnNhdmVDaGF0KCk7XG4gICAgICAgIGF3YWl0IGNoYXRWaWV3LmFkZE1lc3NhZ2UobWVzc2FnZS5yb2xlLCBtZXNzYWdlLmNvbnRlbnQsIG1lc3NhZ2UubWVzc2FnZV9pZCk7XG4gICAgICB9LFxuICAgICAgb25Bc3Npc3RhbnRSZXNwb25zZTogYXN5bmMgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgY2hhdFZpZXcubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2F2ZUNoYXQoKTtcbiAgICAgIH0sXG4gICAgICBvbkNvbnRleHRGaWxlQWRkOiBhc3luYyAod2lraWxpbmspID0+IHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSBjaGF0Vmlldy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKTtcbiAgICAgICAgZmlsZXMuYWRkKHdpa2lsaW5rKTtcbiAgICAgICAgY2hhdFZpZXcuY29udGV4dE1hbmFnZXIuc2V0Q29udGV4dEZpbGVzKEFycmF5LmZyb20oZmlsZXMpKTtcbiAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2F2ZUNoYXQoKTtcbiAgICAgIH0sXG4gICAgICBvbkVycm9yOiAoZXJyb3IpID0+IGNoYXRWaWV3LmhhbmRsZUVycm9yKGVycm9yKSxcbiAgICAgIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHtcbiAgICAgICAgY29uc3QgY29udGV4dEJ1dHRvbiA9IGNoYXRWaWV3LmNvbnRleHRNYW5hZ2VyLmdldENvbnRhaW5lcigpLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LWNvbnRleHQtYWRkLWJ1dHRvblwiKTtcbiAgICAgICAgaWYgKGNvbnRleHRCdXR0b24gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgY29udGV4dEJ1dHRvbi5jbGljaygpO1xuICAgICAgfSxcbiAgICAgIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4gY2hhdFZpZXcuaGFuZGxlU3lzdGVtUHJvbXB0RWRpdCgpLFxuICAgICAgcGx1Z2luOiBjaGF0Vmlldy5wbHVnaW4sXG4gICAgICBjaGF0VmlldyxcbiAgICB9KTtcblxuICAgIGNoYXRWaWV3LmlucHV0SGFuZGxlci5vbk1vZGVsQ2hhbmdlKCk7XG5cbiAgICBjaGF0Vmlldy5hcHAud29ya3NwYWNlLm9uKFwiYWN0aXZlLWxlYWYtY2hhbmdlXCIsIChsZWFmKSA9PiB7XG4gICAgICBpZiAobGVhZiA9PT0gY2hhdFZpZXcubGVhZikge1xuICAgICAgICBjaGF0Vmlldy5jaGVja0ZvclVwZGF0ZXMoKTtcbiAgICAgICAgY2hhdFZpZXcuaW5wdXRIYW5kbGVyLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGF0Vmlldy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcblxuICAgIGF3YWl0IGNoYXRWaWV3LmNoZWNrRm9yVXBkYXRlcygpO1xuXG4gICAgaWYgKCFjaGF0Vmlldy5hd2FpdGluZ1N0YXRlUmVzdG9yZSAmJiBjaGF0Vmlldy5tZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGF3YWl0IGNoYXRWaWV3LnNhdmVDaGF0KCk7XG4gICAgfVxuXG4gICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgIGNoYXRWaWV3LmFwcCxcbiAgICAgICAgICBcIllvdSBkb24ndCBoYXZlIGEgZGVmYXVsdCBtb2RlbCBzZWxlY3RlZCB5ZXQuIFdvdWxkIHlvdSBsaWtlIHRvIGNob29zZSBvbmUgbm93PyBUaGlzIHdpbGwgYmUgdXNlZCBhcyB0aGUgZGVmYXVsdCBmb3IgYWxsIG5ldyBjaGF0cy5cIixcbiAgICAgICAgICB7IHRpdGxlOiBcIlNlbGVjdCBEZWZhdWx0IE1vZGVsXCIsIGljb246IFwiYm90XCIsIHByaW1hcnlCdXR0b246IFwiQ2hvb3NlIE1vZGVsXCIsIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiIH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgY2hhdFZpZXcucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoY2hhdFZpZXcuYXBwLCBcIlwiLCBhc3luYyAobW9kZWxJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgIGNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZE1vZGVsSWQgPSBtb2RlbElkO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gVXBkYXRlIGFjdGl2ZSBwcm92aWRlciBiYXNlZCBvbiBzZWxlY3RlZCBtb2RlbFxuICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE1vZGVsID0gbW9kZWxzLmZpbmQoKG1vZGVsKSA9PiBtb2RlbC5pZCA9PT0gbW9kZWxJZCk7XG4gICAgICAgICAgICAgIGlmIChzZWxlY3RlZE1vZGVsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tUHJvdmlkZXIgPSBjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgICAgICAgICAgICAocCkgPT4gcC5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IHNlbGVjdGVkTW9kZWwucHJvdmlkZXIudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgaWYgKGN1c3RvbVByb3ZpZGVyKSB7XG4gICAgICAgICAgICAgICAgICBjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBjdXN0b21Qcm92aWRlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogY3VzdG9tUHJvdmlkZXIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU3lzdGVtU2N1bHB0XCIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibmF0aXZlXCIsXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgYXdhaXQgY2hhdFZpZXcucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICBjaGF0Vmlldy5zZWxlY3RlZE1vZGVsSWQgPSBtb2RlbElkO1xuICAgICAgICAgICAgICBhd2FpdCBjaGF0Vmlldy51cGRhdGVNb2RlbEluZGljYXRvcigpO1xuICAgICAgICAgICAgfSwgY2hhdFZpZXcucGx1Z2luKTtcbiAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgbW9kZWxzOlwiLCBlcnJvcik7XG4gICAgICAgICAgICBzaG93UG9wdXAoY2hhdFZpZXcuYXBwLCBcIkZhaWxlZCB0byBsb2FkIGF2YWlsYWJsZSBtb2RlbHNcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgZXhpc3RpbmcgY2hhdHMsIGVuc3VyZSBwcm92aWRlciBpcyBzeW5jZWQgd2l0aCB0aGUgc2VsZWN0ZWQgbW9kZWxcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBtb2RlbHMgPSBhd2FpdCBjaGF0Vmlldy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbCA9IG1vZGVscy5maW5kKChtb2RlbCkgPT4gbW9kZWwuaWQgPT09IGNoYXRWaWV3LnNlbGVjdGVkTW9kZWxJZCk7XG4gICAgICAgICAgaWYgKGN1cnJlbnRNb2RlbCkge1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tUHJvdmlkZXIgPSBjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tUHJvdmlkZXJzLmZpbmQoXG4gICAgICAgICAgICAgIChwKSA9PiBwLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gY3VycmVudE1vZGVsLnByb3ZpZGVyLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoY3VzdG9tUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICAgY2hhdFZpZXcucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyID0ge1xuICAgICAgICAgICAgICAgIGlkOiBjdXN0b21Qcm92aWRlci5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBjdXN0b21Qcm92aWRlci5uYW1lLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlUHJvdmlkZXIgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IFwic3lzdGVtc2N1bHB0XCIsXG4gICAgICAgICAgICAgICAgbmFtZTogXCJTeXN0ZW1TY3VscHRcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm5hdGl2ZVwiLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgY2hhdFZpZXcucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3luY2luZyBwcm92aWRlcjpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTAwKTtcbiAgfSxcblxuICB1cGRhdGVNb2RlbEluZGljYXRvcjogYXN5bmMgZnVuY3Rpb24oY2hhdFZpZXc6IENoYXRWaWV3KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yKSB7XG4gICAgICBjb25zdCBuZXdNb2RlbEluZGljYXRvciA9IGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yLnJlcGxhY2VXaXRoKG5ld01vZGVsSW5kaWNhdG9yKTtcbiAgICAgIGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yID0gbmV3TW9kZWxJbmRpY2F0b3IgYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgIGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoY2hhdFZpZXcuYXBwLCBjaGF0Vmlldy5zZWxlY3RlZE1vZGVsSWQgfHwgXCJcIiwgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LnNldFNlbGVjdGVkTW9kZWxJZChtb2RlbElkKTtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJNb2RlbCBzZWxlY3RlZCBzdWNjZXNzZnVsbHlcIiwgXCJpbmZvXCIpO1xuICAgICAgICB9LCBjaGF0Vmlldy5wbHVnaW4pO1xuICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjaGF0Vmlldy5zZWxlY3RlZE1vZGVsSWQgfHwgY2hhdFZpZXcuc2VsZWN0ZWRNb2RlbElkLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICBjaGF0Vmlldy5tb2RlbEluZGljYXRvci5lbXB0eSgpO1xuICAgICAgICBjaGF0Vmlldy5tb2RlbEluZGljYXRvci5jcmVhdGVTcGFuKHsgdGV4dDogXCJObyBtb2RlbCBzZWxlY3RlZFwiIH0pO1xuICAgICAgICBjaGF0Vmlldy5tb2RlbEluZGljYXRvci5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1uby1tb2RlbFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgY2hhdFZpZXcucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWwgPSBtb2RlbHMuZmluZCgobW9kZWwpID0+IG1vZGVsLmlkID09PSBjaGF0Vmlldy5zZWxlY3RlZE1vZGVsSWQpO1xuXG4gICAgICAgICAgbGV0IHByb3ZpZGVyUHJlZml4ID0gXCJcIjtcbiAgICAgICAgICBpZiAoY3VycmVudE1vZGVsKSB7XG4gICAgICAgICAgICBwcm92aWRlclByZWZpeCA9IGN1cnJlbnRNb2RlbC5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIiA/IFwiW1NZU1RFTVNDVUxQVF0gXCIgOiBgWyR7Y3VycmVudE1vZGVsLnByb3ZpZGVyLnRvVXBwZXJDYXNlKCl9XSBgO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNoYXRWaWV3LmN1cnJlbnRNb2RlbE5hbWUgPSBjdXJyZW50TW9kZWw/Lm5hbWUgfHwgY2hhdFZpZXcuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yLmVtcHR5KCk7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbm8tbW9kZWxcIik7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IHByb3ZpZGVyUHJlZml4ICsgY2hhdFZpZXcuY3VycmVudE1vZGVsTmFtZSB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjaGF0Vmlldy5jdXJyZW50TW9kZWxOYW1lID0gY2hhdFZpZXcuc2VsZWN0ZWRNb2RlbElkO1xuICAgICAgICAgIGNoYXRWaWV3Lm1vZGVsSW5kaWNhdG9yLmVtcHR5KCk7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoXCJzeXN0ZW1zY3VscHQtbm8tbW9kZWxcIik7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQ3VycmVudCBNb2RlbDogXCIgfSk7XG4gICAgICAgICAgY2hhdFZpZXcubW9kZWxJbmRpY2F0b3IuY3JlYXRlU3Bhbih7IHRleHQ6IGNoYXRWaWV3LmN1cnJlbnRNb2RlbE5hbWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn07IiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIHNldEljb24sIENvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgRHJhd2VyQ29tcG9uZW50IH0gZnJvbSBcIi4vRHJhd2VyQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBDb250ZXh0U2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0NvbnRleHRTZWxlY3Rpb25Nb2RhbFwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1TY3VscHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBNYXJrZG93blJlbmRlcmVyIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgVG9rZW5Db3VudGVyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9Ub2tlbkNvdW50ZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBBdWRpb1RyYW5zY3JpcHRpb25Nb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvQXVkaW9UcmFuc2NyaXB0aW9uTW9kYWxcIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi8uLi9jb3JlL3VpXCI7XG5pbXBvcnQgeyBMaWNlbnNlQ2hlY2tlciB9IGZyb20gXCIuLi8uLi9jb3JlL2xpY2Vuc2UvTGljZW5zZUNoZWNrZXJcIjtcblxuaW50ZXJmYWNlIENvbnRleHRGaWxlIHtcbiAgcGF0aDogc3RyaW5nO1xuICB0eXBlOiBcInNvdXJjZVwiIHwgXCJleHRyYWN0aW9uXCI7XG59XG5cbmludGVyZmFjZSBDYXRlZ29yeUZpbGUge1xuICBmaWxlOiBURmlsZTtcbiAgcGF0aDogc3RyaW5nO1xuICBsaW5rVGV4dDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ2F0ZWdvcnkge1xuICBsYWJlbDogc3RyaW5nO1xuICBmaWxlczogQ2F0ZWdvcnlGaWxlW107XG4gIGV4dGVuc2lvbnM6IHN0cmluZ1tdO1xufVxuXG5pbnRlcmZhY2UgRmlsZUNvbnRleHRNYW5hZ2VyT3B0aW9ucyB7XG4gIGFwcDogQXBwO1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICB0aXRsZT86IHN0cmluZztcbiAgb25Db250ZXh0Q2hhbmdlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwbHVnaW46IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIEZpbGVDb250ZXh0TWFuYWdlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgY29udGV4dEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIHByaXZhdGUgZHJhd2VyOiBEcmF3ZXJDb21wb25lbnQ7XG4gIHByaXZhdGUgY29udGV4dFBhbmVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvbkNvbnRleHRDaGFuZ2U6ICgpID0+IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgcHJvY2Vzc2luZ1N0YXR1czogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nRmlsZXMgPSBuZXcgTWFwPHN0cmluZywgSFRNTEVsZW1lbnQ+KCk7XG4gIHByaXZhdGUgcHJvY2Vzc2luZ1RpbWVvdXRzID0gbmV3IE1hcDxzdHJpbmcsIE5vZGVKUy5UaW1lb3V0PigpO1xuICBwcml2YXRlIHN5bmNTdGF0dXNFbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpc1N5bmNpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIHBsdWdpbjogYW55O1xuICBwcml2YXRlIHRva2VuQ291bnRlcjogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSB0b2tlbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogRmlsZUNvbnRleHRNYW5hZ2VyT3B0aW9ucykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hcHAgPSBvcHRpb25zLmFwcDtcbiAgICB0aGlzLm9uQ29udGV4dENoYW5nZSA9IG9wdGlvbnMub25Db250ZXh0Q2hhbmdlO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IG9wdGlvbnMuc2N1bHB0U2VydmljZTtcbiAgICB0aGlzLnBsdWdpbiA9IG9wdGlvbnMucGx1Z2luO1xuICAgIHRoaXMudG9rZW5Db3VudGVyID0gVG9rZW5Db3VudGVyU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4gICAgdGhpcy5kcmF3ZXIgPSBuZXcgRHJhd2VyQ29tcG9uZW50KHtcbiAgICAgIGNvbnRhaW5lcjogb3B0aW9ucy5jb250YWluZXIsXG4gICAgICB0aXRsZTogb3B0aW9ucy50aXRsZSB8fCBcIkZpbGVzXCIsXG4gICAgfSk7XG4gICAgdGhpcy5jb250ZXh0UGFuZWwgPSB0aGlzLmRyYXdlci5nZXREcmF3ZXIoKTtcblxuICAgIHRoaXMuc2V0dXBDb250ZXh0UGFuZWwoKTtcbiAgICB0aGlzLmluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVQcm9jZXNzaW5nU3RhdHVzKCkge1xuICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cyA9IHRoaXMuY29udGV4dFBhbmVsLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJvY2Vzc2luZy1zdGF0dXNcIixcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdTdGF0dXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIHN0YXR1czogc3RyaW5nLFxuICAgIGljb246IHN0cmluZyxcbiAgICByZW1vdmU6IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICBjb25zdCBmaWxlSWQgPSBmaWxlLnBhdGg7XG4gICAgbGV0IHN0YXR1c0VsID0gdGhpcy5wcm9jZXNzaW5nRmlsZXMuZ2V0KGZpbGVJZCk7XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZW91dCBmb3IgdGhpcyBmaWxlXG4gICAgY29uc3QgZXhpc3RpbmdUaW1lb3V0ID0gdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZ2V0KGZpbGVJZCk7XG4gICAgaWYgKGV4aXN0aW5nVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGV4aXN0aW5nVGltZW91dCk7XG4gICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICB9XG5cbiAgICBpZiAoIXN0YXR1c0VsICYmICFyZW1vdmUgJiYgdGhpcy5wcm9jZXNzaW5nU3RhdHVzKSB7XG4gICAgICBzdGF0dXNFbCA9IHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZmlsZS1zdGF0dXNcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG5cbiAgICAgIHN0YXR1c0VsLmNyZWF0ZVNwYW4oe1xuICAgICAgICB0ZXh0OiBgJHtmaWxlLmJhc2VuYW1lfTogJHtzdGF0dXN9YCxcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtdGV4dFwiLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLnNldChmaWxlSWQsIHN0YXR1c0VsKTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1c0VsICYmICFyZW1vdmUpIHtcbiAgICAgIHN0YXR1c0VsLmVtcHR5KCk7XG4gICAgICBjb25zdCBpY29uRWwgPSBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1zdGF0dXMtaWNvblwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKGljb25FbCwgaWNvbik7XG4gICAgICBzdGF0dXNFbC5jcmVhdGVTcGFuKHtcbiAgICAgICAgdGV4dDogYCR7ZmlsZS5iYXNlbmFtZX06ICR7c3RhdHVzfWAsXG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc3RhdHVzLXRleHRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc3RhdHVzRWwgJiYgcmVtb3ZlKSB7XG4gICAgICBzdGF0dXNFbC5yZW1vdmUoKTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmRlbGV0ZShmaWxlSWQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnByb2Nlc3NpbmdTdGF0dXMpIHtcbiAgICAgIHRoaXMucHJvY2Vzc2luZ1N0YXR1cy5zdHlsZS5kaXNwbGF5ID1cbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuc2l6ZSA+IDAgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGlzIGlzIGEgc3VjY2VzcyBvciBlcnJvciBtZXNzYWdlLCBvciBleHBsaWNpdCByZW1vdmFsIHJlcXVlc3RlZCwgc2V0IGEgdGltZW91dCB0byByZW1vdmUgaXRcbiAgICBpZiAoXG4gICAgICByZW1vdmUgfHxcbiAgICAgIHN0YXR1cy5pbmNsdWRlcyhcInN1Y2Nlc3NmdWxseVwiKSB8fFxuICAgICAgc3RhdHVzLmluY2x1ZGVzKFwiY29tcGxldGVkXCIpIHx8XG4gICAgICBzdGF0dXMuaW5jbHVkZXMoXCJFcnJvcjpcIilcbiAgICApIHtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0cy5kZWxldGUoZmlsZUlkKTtcbiAgICAgIH0sIDMwMDApO1xuICAgICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuc2V0KGZpbGVJZCwgdGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cENvbnRleHRQYW5lbCgpOiB2b2lkIHtcbiAgICBjb25zdCB0aXRsZUVsID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItdGl0bGVcIlxuICAgICk7XG4gICAgaWYgKCF0aXRsZUVsKSByZXR1cm47XG5cbiAgICBjb25zdCBjb250ZXh0Q291bnQgPSB0aXRsZUVsLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY291bnRcIixcbiAgICAgIHRleHQ6IFwiMFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHN5bmMgc3RhdHVzIGVsZW1lbnRcbiAgICB0aGlzLnN5bmNTdGF0dXNFbCA9IHRpdGxlRWwuY3JlYXRlU3Bhbih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXN5bmMtc3RhdHVzIHN5bmNlZFwiLFxuICAgIH0pO1xuICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwiY2hlY2tcIik7XG5cbiAgICBjb25zdCBjb250ZXh0QnV0dG9uID0gdGl0bGVFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtYWRkLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIHNldEljb24oY29udGV4dEJ1dHRvbiwgXCJwbHVzXCIpO1xuICAgIGNvbnRleHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5hZGRDb250ZXh0RmlsZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU3luY1N0YXR1cyhzeW5jaW5nOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoIXRoaXMuc3luY1N0YXR1c0VsKSByZXR1cm47XG5cbiAgICB0aGlzLmlzU3luY2luZyA9IHN5bmNpbmc7XG4gICAgdGhpcy5zeW5jU3RhdHVzRWwuZW1wdHkoKTtcblxuICAgIGlmIChzeW5jaW5nKSB7XG4gICAgICB0aGlzLnN5bmNTdGF0dXNFbC5yZW1vdmVDbGFzcyhcInN5bmNlZFwiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHNldEljb24odGhpcy5zeW5jU3RhdHVzRWwsIFwibG9hZGVyLTJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLnJlbW92ZUNsYXNzKFwic3luY2luZ1wiKTtcbiAgICAgIHRoaXMuc3luY1N0YXR1c0VsLmFkZENsYXNzKFwic3luY2VkXCIpO1xuICAgICAgc2V0SWNvbih0aGlzLnN5bmNTdGF0dXNFbCwgXCJjaGVja1wiKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY2hlY2tTeW5jU3RhdHVzKCkge1xuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlU3luY1N0YXR1cyh0cnVlKTtcbiAgICAvLyBObyBuZWVkIHRvIHNpbXVsYXRlLCBqdXN0IHVwZGF0ZSBzdGF0dXNcbiAgICB0aGlzLnVwZGF0ZVN5bmNTdGF0dXMoZmFsc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDb250ZXh0UGFuZWwoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNvbnRleHRQYW5lbCkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVhZGVyID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1kcmF3ZXItaGVhZGVyXCJcbiAgICApO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmNvbnRleHRQYW5lbC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuc3lzdGVtc2N1bHB0LWRyYXdlci1jb250ZW50XCJcbiAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb250ZXh0UGFuZWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtZHJhd2VyLWNvdW50XCIpO1xuXG4gICAgaWYgKCFoZWFkZXIgfHwgIWNvbnRlbnQgfHwgIWNvdW50KSByZXR1cm47XG5cbiAgICBjb3VudC50ZXh0Q29udGVudCA9IHRoaXMuY29udGV4dEZpbGVzLnNpemUudG9TdHJpbmcoKTtcblxuICAgIGNvbnRlbnQuZW1wdHkoKTtcblxuICAgIGlmICh0aGlzLmNvbnRleHRGaWxlcy5zaXplID09PSAwKSB7XG4gICAgICBjb250ZW50LmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItZW1wdHlcIixcbiAgICAgICAgdGV4dDogXCJObyBjb250ZXh0IGZpbGVzIGFkZGVkIHlldC4gQ2xpY2sgdGhlIHBsdXMgYnV0dG9uIHRvIGFkZCBmaWxlcyBpbiB5b3VyIGNoYXQuXCIsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT4gPSB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIGxhYmVsOiBcIlRleHQgRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtZFwiLCBcInR4dFwiLCBcIm1hcmtkb3duXCJdLFxuICAgICAgfSxcbiAgICAgIGltYWdlczoge1xuICAgICAgICBsYWJlbDogXCJJbWFnZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJqcGdcIiwgXCJqcGVnXCIsIFwicG5nXCIsIFwiZ2lmXCIsIFwid2VicFwiLCBcInN2Z1wiXSxcbiAgICAgIH0sXG4gICAgICBhdWRpbzoge1xuICAgICAgICBsYWJlbDogXCJBdWRpbyBGaWxlc1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXSxcbiAgICAgIH0sXG4gICAgICBkb2N1bWVudHM6IHtcbiAgICAgICAgbGFiZWw6IFwiRG9jdW1lbnRzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wiZG9jXCIsIFwiZG9jeFwiLCBcInBwdFwiLCBcInBwdHhcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwicGRmXCJdLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgLy8gR3JvdXAgZXh0cmFjdGVkIGZpbGVzIGJ5IHRoZWlyIHNvdXJjZSBkb2N1bWVudFxuICAgIGNvbnN0IGRvY3VtZW50R3JvdXBzID0gbmV3IE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+PigpO1xuICAgIGNvbnN0IG5vbkV4dHJhY3RlZEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIHRoaXMuY29udGV4dEZpbGVzKSB7XG4gICAgICBjb25zdCBjbGVhblBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcblxuICAgICAgaWYgKGNsZWFuUGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIikpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBjbGVhblBhdGguc3BsaXQoXCIvXCIpO1xuICAgICAgICBjb25zdCBleHRyYWN0aW9uRGlySW5kZXggPSBwYXJ0cy5pbmRleE9mKFwiRXh0cmFjdGlvbnNcIik7XG4gICAgICAgIGlmIChleHRyYWN0aW9uRGlySW5kZXggPj0gMCAmJiBleHRyYWN0aW9uRGlySW5kZXggKyAxIDwgcGFydHMubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3Qgc291cmNlRG9jID0gcGFydHNbZXh0cmFjdGlvbkRpckluZGV4ICsgMV07XG4gICAgICAgICAgaWYgKCFkb2N1bWVudEdyb3Vwcy5oYXMoc291cmNlRG9jKSkge1xuICAgICAgICAgICAgZG9jdW1lbnRHcm91cHMuc2V0KHNvdXJjZURvYywgbmV3IFNldCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZG9jdW1lbnRHcm91cHMuZ2V0KHNvdXJjZURvYyk/LmFkZChmaWxlUGF0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9uRXh0cmFjdGVkRmlsZXMuYWRkKGZpbGVQYXRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaXJzdCwgY2F0ZWdvcml6ZSBub24tZXh0cmFjdGVkIGZpbGVzXG4gICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShub25FeHRyYWN0ZWRGaWxlcyksIGNhdGVnb3JpZXMpO1xuXG4gICAgLy8gUmVuZGVyIHJlZ3VsYXIgY2F0ZWdvcmllcyBmaXJzdFxuICAgIGZvciAoY29uc3QgY2F0ZWdvcnlLZXkgb2YgW1widGV4dFwiLCBcImltYWdlc1wiLCBcImF1ZGlvXCJdKSB7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGNhdGVnb3JpZXNbY2F0ZWdvcnlLZXldO1xuICAgICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5yZW5kZXJDYXRlZ29yeShjb250ZW50LCBjYXRlZ29yeSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZG9jdW1lbnRzIGNhdGVnb3J5XG4gICAgaWYgKGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLmxlbmd0aCA+IDAgfHwgZG9jdW1lbnRHcm91cHMuc2l6ZSA+IDApIHtcbiAgICAgIC8vIE1haW4gXCJEb2N1bWVudHNcIiBjYXRlZ29yeSBoZWFkZXJcbiAgICAgIGNvbnRlbnQuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1jYXRlZ29yeVwiLFxuICAgICAgICB0ZXh0OiBcIkRvY3VtZW50c1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEZpcnN0IHJlbmRlciBzdGFuZGFsb25lIGRvY3VtZW50c1xuICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBjYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyk7XG5cbiAgICAgIC8vIFRoZW4gcmVuZGVyIGVhY2ggZG9jdW1lbnQgZ3JvdXAgYXMgYSBzdWJjYXRlZ29yeVxuICAgICAgZm9yIChjb25zdCBbc291cmNlRG9jLCBleHRyYWN0ZWRGaWxlc10gb2YgZG9jdW1lbnRHcm91cHMpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgc3ViY2F0ZWdvcnkgZm9yIHRoaXMgZG9jdW1lbnRcbiAgICAgICAgY29udGVudC5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY2F0ZWdvcnlcIixcbiAgICAgICAgICB0ZXh0OiBgXHVEODNEXHVEQ0M0ICR7c291cmNlRG9jfSBFeHRyYWN0aW9uc2AsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhdGVnb3JpemUgZXh0cmFjdGVkIGZpbGVzXG4gICAgICAgIGNvbnN0IGV4dHJhY3RlZENhdGVnb3JpZXMgPSB0aGlzLmNyZWF0ZUNhdGVnb3JpZXMoKTtcbiAgICAgICAgdGhpcy5jYXRlZ29yaXplRmlsZXMoQXJyYXkuZnJvbShleHRyYWN0ZWRGaWxlcyksIGV4dHJhY3RlZENhdGVnb3JpZXMpO1xuXG4gICAgICAgIC8vIEZpcnN0IHJlbmRlciB0ZXh0IGZpbGVzIChtZCwgdHh0LCBtYXJrZG93bilcbiAgICAgICAgY29uc3QgdGV4dEZpbGVzID0gZXh0cmFjdGVkQ2F0ZWdvcmllcy50ZXh0LmZpbGVzO1xuICAgICAgICBpZiAodGV4dEZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckZpbGVzKGNvbnRlbnQsIHRleHRGaWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGVuIHJlbmRlciBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VGaWxlcyA9IGV4dHJhY3RlZENhdGVnb3JpZXMuaW1hZ2VzLmZpbGVzO1xuICAgICAgICBpZiAoaW1hZ2VGaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJGaWxlcyhjb250ZW50LCBpbWFnZUZpbGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsbHkgcmVuZGVyIGFueSBvdGhlciB0eXBlcyBpZiB0aGV5IGV4aXN0XG4gICAgICAgIGNvbnN0IG90aGVyRmlsZXMgPSBbXG4gICAgICAgICAgLi4uZXh0cmFjdGVkQ2F0ZWdvcmllcy5hdWRpby5maWxlcyxcbiAgICAgICAgICAuLi5leHRyYWN0ZWRDYXRlZ29yaWVzLmRvY3VtZW50cy5maWxlcyxcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKG90aGVyRmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGVudCwgb3RoZXJGaWxlcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNhdGVnb3JpZXMoKTogUmVjb3JkPHN0cmluZywgQ2F0ZWdvcnk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgdGV4dDoge1xuICAgICAgICBsYWJlbDogXCJUZXh0IEZpbGVzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wibWRcIiwgXCJ0eHRcIiwgXCJtYXJrZG93blwiXSxcbiAgICAgIH0sXG4gICAgICBpbWFnZXM6IHtcbiAgICAgICAgbGFiZWw6IFwiSW1hZ2VzXCIsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgZXh0ZW5zaW9uczogW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0sXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgbGFiZWw6IFwiQXVkaW8gRmlsZXNcIixcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICBleHRlbnNpb25zOiBbXCJtcDNcIiwgXCJ3YXZcIiwgXCJvZ2dcIiwgXCJtNGFcIl0sXG4gICAgICB9LFxuICAgICAgZG9jdW1lbnRzOiB7XG4gICAgICAgIGxhYmVsOiBcIkRvY3VtZW50c1wiLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIGV4dGVuc2lvbnM6IFtcImRvY1wiLCBcImRvY3hcIiwgXCJwcHRcIiwgXCJwcHR4XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcInBkZlwiXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUZpbGVzKFxuICAgIGZpbGVzOiBzdHJpbmdbXSxcbiAgICBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCBDYXRlZ29yeT5cbiAgKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWxlUGF0aC5yZXBsYWNlKC9eXFxbXFxbKC4qPylcXF1cXF0kLywgXCIkMVwiKTtcbiAgICAgIGNvbnN0IHJlc29sdmVkRmlsZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoXG4gICAgICAgIGxpbmtUZXh0LFxuICAgICAgICBcIlwiXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzb2x2ZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gcmVzb2x2ZWRGaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQgY2F0ZWdvcnlGb3VuZCA9IGZhbHNlO1xuXG4gICAgICAgIGZvciAoY29uc3QgW2NhdGVnb3J5LCBpbmZvXSBvZiBPYmplY3QuZW50cmllcyhjYXRlZ29yaWVzKSkge1xuICAgICAgICAgIGlmIChpbmZvLmV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgaW5mby5maWxlcy5wdXNoKHsgZmlsZTogcmVzb2x2ZWRGaWxlLCBwYXRoOiBmaWxlUGF0aCwgbGlua1RleHQgfSk7XG4gICAgICAgICAgICBjYXRlZ29yeUZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY2F0ZWdvcnlGb3VuZCkge1xuICAgICAgICAgIGNhdGVnb3JpZXMuZG9jdW1lbnRzLmZpbGVzLnB1c2goe1xuICAgICAgICAgICAgZmlsZTogcmVzb2x2ZWRGaWxlLFxuICAgICAgICAgICAgcGF0aDogZmlsZVBhdGgsXG4gICAgICAgICAgICBsaW5rVGV4dCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyQ2F0ZWdvcnkoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgY2F0ZWdvcnk6IENhdGVnb3J5KTogdm9pZCB7XG4gICAgaWYgKGNhdGVnb3J5LmZpbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWNhdGVnb3J5XCIsXG4gICAgICB0ZXh0OiBjYXRlZ29yeS5sYWJlbCxcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyRmlsZXMoY29udGFpbmVyLCBjYXRlZ29yeS5maWxlcyk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckZpbGVzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGZpbGVzOiBDYXRlZ29yeUZpbGVbXSk6IHZvaWQge1xuICAgIGZpbGVzLnNvcnQoKGEsIGIpID0+IGEuZmlsZS5iYXNlbmFtZS5sb2NhbGVDb21wYXJlKGIuZmlsZS5iYXNlbmFtZSkpO1xuXG4gICAgLy8gQ3JlYXRlIHByZXZpZXcgZWxlbWVudHMgb25jZSBhbmQgcmV1c2VcbiAgICBjb25zdCBpbWFnZVByZXZpZXcgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZUVsKFwiaW1nXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldyBzeXN0ZW1zY3VscHQtaW1hZ2UtcHJldmlld1wiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWFya2Rvd25QcmV2aWV3ID0gZG9jdW1lbnQuYm9keS5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcmV2aWV3IHN5c3RlbXNjdWxwdC1tYXJrZG93bi1wcmV2aWV3XCIsXG4gICAgfSk7XG5cbiAgICAvLyBUcmFjayBpZiBtYXJrZG93biBwcmV2aWV3IGlzIHZpc2libGVcbiAgICBsZXQgaXNNYXJrZG93blByZXZpZXdWaXNpYmxlID0gZmFsc2U7XG5cbiAgICAvLyBIYW5kbGUgd2hlZWwgZXZlbnRzIGZvciBtYXJrZG93biBwcmV2aWV3IHNjcm9sbGluZ1xuICAgIGNvbnN0IGhhbmRsZVdoZWVsID0gKGU6IFdoZWVsRXZlbnQpID0+IHtcbiAgICAgIGlmICghaXNNYXJrZG93blByZXZpZXdWaXNpYmxlKSByZXR1cm47XG5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHNjcm9sbEFtb3VudCA9IGUuZGVsdGFZO1xuICAgICAgbWFya2Rvd25QcmV2aWV3LnNjcm9sbFRvcCArPSBzY3JvbGxBbW91bnQ7XG4gICAgfTtcblxuICAgIC8vIEFkZCB3aGVlbCBldmVudCBsaXN0ZW5lciB0byBkb2N1bWVudFxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcblxuICAgIC8vIENsZWFuIHVwIHdoZWVsIGV2ZW50IGxpc3RlbmVyIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCBoYW5kbGVXaGVlbCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjYWxjdWxhdGVQcmV2aWV3RGltZW5zaW9ucyA9IChcbiAgICAgIG5hdHVyYWxXaWR0aDogbnVtYmVyLFxuICAgICAgbmF0dXJhbEhlaWdodDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRXaWR0aDogbnVtYmVyLFxuICAgICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlclxuICAgICkgPT4ge1xuICAgICAgLy8gTWF4aW11bSBzaXplIHNob3VsZCBiZSBhIHBlcmNlbnRhZ2Ugb2Ygdmlld3BvcnRcbiAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4odmlld3BvcnRXaWR0aCAqIDAuNCwgbmF0dXJhbFdpZHRoKTsgLy8gNDAlIG9mIHZpZXdwb3J0IHdpZHRoXG4gICAgICBjb25zdCBtYXhIZWlnaHQgPSBNYXRoLm1pbih2aWV3cG9ydEhlaWdodCAqIDAuNiwgbmF0dXJhbEhlaWdodCk7IC8vIDYwJSBvZiB2aWV3cG9ydCBoZWlnaHRcblxuICAgICAgLy8gQ2FsY3VsYXRlIGRpbWVuc2lvbnMgbWFpbnRhaW5pbmcgYXNwZWN0IHJhdGlvXG4gICAgICBsZXQgd2lkdGggPSBuYXR1cmFsV2lkdGg7XG4gICAgICBsZXQgaGVpZ2h0ID0gbmF0dXJhbEhlaWdodDtcblxuICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgd2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgaGVpZ2h0ID0gKG5hdHVyYWxIZWlnaHQgKiBtYXhXaWR0aCkgLyBuYXR1cmFsV2lkdGg7XG4gICAgICB9XG5cbiAgICAgIGlmIChoZWlnaHQgPiBtYXhIZWlnaHQpIHtcbiAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICAgICAgICB3aWR0aCA9IChuYXR1cmFsV2lkdGggKiBtYXhIZWlnaHQpIC8gbmF0dXJhbEhlaWdodDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9O1xuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVQcmV2aWV3UG9zaXRpb24gPSAoZTogTW91c2VFdmVudCwgcHJldmlld0VsOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgaWYgKCFwcmV2aWV3RWwpIHJldHVybjtcblxuICAgICAgLy8gR2V0IHZpZXdwb3J0IGRpbWVuc2lvbnNcbiAgICAgIGNvbnN0IHZpZXdwb3J0V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgIGNvbnN0IHZpZXdwb3J0SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAvLyBHZXQgcHJldmlldyBkaW1lbnNpb25zXG4gICAgICBjb25zdCByZWN0ID0gcHJldmlld0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3Qgd2lkdGggPSByZWN0LndpZHRoO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwb3NpdGlvblxuICAgICAgbGV0IHggPSBlLmNsaWVudFggKyAxNjsgLy8gRGVmYXVsdCBvZmZzZXQgZnJvbSBjdXJzb3JcbiAgICAgIGxldCB5ID0gZS5jbGllbnRZICsgMTY7XG5cbiAgICAgIC8vIENoZWNrIGlmIHByZXZpZXcgd291bGQgZ28gb2ZmIHNjcmVlblxuICAgICAgaWYgKHggKyB3aWR0aCA+IHZpZXdwb3J0V2lkdGgpIHtcbiAgICAgICAgeCA9IGUuY2xpZW50WCAtIHdpZHRoIC0gMTY7IC8vIFNob3cgb24gbGVmdCBzaWRlIG9mIGN1cnNvclxuICAgICAgfVxuICAgICAgaWYgKHkgKyBoZWlnaHQgPiB2aWV3cG9ydEhlaWdodCkge1xuICAgICAgICB5ID0gZS5jbGllbnRZIC0gaGVpZ2h0IC0gMTY7IC8vIFNob3cgYWJvdmUgY3Vyc29yXG4gICAgICB9XG5cbiAgICAgIHByZXZpZXdFbC5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7XG4gICAgICBwcmV2aWV3RWwuc3R5bGUudG9wID0gYCR7eX1weGA7XG4gICAgfTtcblxuICAgIC8vIENsZWFuIHVwIHByZXZpZXdzIHdoZW4gY29tcG9uZW50IHVubG9hZHNcbiAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgIGltYWdlUHJldmlldy5yZW1vdmUoKTtcbiAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgeyBmaWxlLCBwYXRoLCBsaW5rVGV4dCB9IG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBpdGVtID0gY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaXRlbVwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHBhdGhFbCA9IGl0ZW0uY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYXdlci1pdGVtLXBhdGhcIixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpY29uQ29udGFpbmVyID0gcGF0aEVsLmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWZpbGUtaWNvblwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgaWNvbk5hbWUgPSBcImZpbGVcIjtcblxuICAgICAgLy8gQ3JlYXRlIGxpbmsgZmlyc3Qgc28gd2UgY2FuIHJlZmVyZW5jZSBpdCBmb3IgaG92ZXIgZXZlbnRzXG4gICAgICBjb25zdCBsaW5rID0gcGF0aEVsLmNyZWF0ZUVsKFwiYVwiLCB7XG4gICAgICAgIGNsczogXCJpbnRlcm5hbC1saW5rXCIsXG4gICAgICAgIHRleHQ6IGZpbGUuYmFzZW5hbWUsXG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBocmVmOiBwYXRoLFxuICAgICAgICAgIFwiZGF0YS1ocmVmXCI6IHBhdGgsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIGZvciBtYXJrZG93biBmaWxlc1xuICAgICAgICBjb25zdCBzaG93TWFya2Rvd25QcmV2aWV3ID0gYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGUucGF0aCk7XG4gICAgICAgICAgICBpZiAobWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQobWRGaWxlKTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgaGVhZGVyIHdpdGggZmlsZW5hbWVcbiAgICAgICAgICAgICAgbWFya2Rvd25QcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtcHJldmlldy1oZWFkZXJcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBmaWxlLmJhc2VuYW1lLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgY29udGVudCBjb250YWluZXIgYW5kIHJlbmRlciBtYXJrZG93blxuICAgICAgICAgICAgICBjb25zdCBjb250ZW50RWwgPSBtYXJrZG93blByZXZpZXcuY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBmaXJzdCA0MDAwIGNoYXJhY3RlcnMgd2l0aCBtZXNzYWdlIGlmIGxvbmdlclxuICAgICAgICAgICAgICAgIGNvbnRlbnQubGVuZ3RoID4gNDAwMFxuICAgICAgICAgICAgICAgICAgPyBjb250ZW50LnNsaWNlKDAsIDQwMDApICtcbiAgICAgICAgICAgICAgICAgICAgICBcIlxcblxcbi0tLVxcblxcbioqQ2xpY2sgdG8gdmlldyBmdWxsIGRvY3VtZW50KiogKHNob3dpbmcgZmlyc3QgNDAwMCBvZiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudC5sZW5ndGggK1xuICAgICAgICAgICAgICAgICAgICAgIFwiIGNoYXJhY3RlcnMpXCJcbiAgICAgICAgICAgICAgICAgIDogY29udGVudCxcbiAgICAgICAgICAgICAgICBjb250ZW50RWwsXG4gICAgICAgICAgICAgICAgZmlsZS5wYXRoLFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBtYXJrZG93blByZXZpZXcuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XG4gICAgICAgICAgICAgIGlzTWFya2Rvd25QcmV2aWV3VmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBtYXJrZG93blByZXZpZXcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgbWFya2Rvd24gcHJldmlldzpcIiwgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoaWRlTWFya2Rvd25QcmV2aWV3ID0gKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuZW1wdHkoKTtcbiAgICAgICAgICBpc01hcmtkb3duUHJldmlld1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAvLyBSZXNldCBzY3JvbGwgcG9zaXRpb24gd2hlbiBoaWRpbmdcbiAgICAgICAgICBtYXJrZG93blByZXZpZXcuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBZGQgaG92ZXIgaGFuZGxlcnMgdG8gdGhlIGVudGlyZSBpdGVtIGNvbnRhaW5lclxuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIHNob3dNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgKGUpID0+XG4gICAgICAgICAgdXBkYXRlUHJldmlld1Bvc2l0aW9uKGUsIG1hcmtkb3duUHJldmlldylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBZGQgbW91c2VsZWF2ZSBoYW5kbGVyIHRvIHRoZSBwcmV2aWV3IGl0c2VsZlxuICAgICAgICBtYXJrZG93blByZXZpZXcuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZU1hcmtkb3duUHJldmlldyk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIHByZXZpZXcncyBtb3VzZWxlYXZlIGhhbmRsZXIgb24gdW5sb2FkXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoKCkgPT4ge1xuICAgICAgICAgIG1hcmtkb3duUHJldmlldy5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgXCJtb3VzZWxlYXZlXCIsXG4gICAgICAgICAgICBoaWRlTWFya2Rvd25QcmV2aWV3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9yY2UgdGhlIHByZXZpZXcgdG8gaGlkZSB3aGVuZXZlciB0aGUgcG9pbnRlciBsZWF2ZXMgdGhlIHdob2xlIHBhbmVsXG4gICAgICAgIHRoaXMuY29udGV4dFBhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVNYXJrZG93blByZXZpZXcpO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgW1wianBnXCIsIFwianBlZ1wiLCBcInBuZ1wiLCBcImdpZlwiLCBcIndlYnBcIiwgXCJzdmdcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJpbWFnZVwiO1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBoYW5kbGVycyBmb3IgaW1hZ2VzXG4gICAgICAgIGNvbnN0IHNob3dJbWFnZVByZXZpZXcgPSBhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGlmIChpbWFnZUZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoaW1hZ2VGaWxlKTtcbiAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0pO1xuICAgICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5zcmMgPSB1cmw7XG4gICAgICAgICAgICAgIGltYWdlUHJldmlldy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb24gYW5kIHNpemUgaW1tZWRpYXRlbHkgYWZ0ZXIgaW1hZ2UgbG9hZHNcbiAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbGN1bGF0ZVByZXZpZXdEaW1lbnNpb25zKFxuICAgICAgICAgICAgICAgICAgaW1hZ2VQcmV2aWV3Lm5hdHVyYWxXaWR0aCxcbiAgICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5uYXR1cmFsSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgd2luZG93LmlubmVyV2lkdGgsXG4gICAgICAgICAgICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDtcbiAgICAgICAgICAgICAgICBpbWFnZVByZXZpZXcuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3UG9zaXRpb24oZSwgaW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGltYWdlIHByZXZpZXc6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaGlkZUltYWdlUHJldmlldyA9ICgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnNyYyA9IFwiXCI7XG4gICAgICAgICAgLy8gUmVzZXQgZGltZW5zaW9uc1xuICAgICAgICAgIGltYWdlUHJldmlldy5zdHlsZS53aWR0aCA9IFwiXCI7XG4gICAgICAgICAgaW1hZ2VQcmV2aWV3LnN0eWxlLmhlaWdodCA9IFwiXCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIGhvdmVyIGhhbmRsZXJzIHRvIHRoZSBlbnRpcmUgaXRlbSBjb250YWluZXJcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBzaG93SW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIChlKSA9PlxuICAgICAgICAgIHVwZGF0ZVByZXZpZXdQb3NpdGlvbihlLCBpbWFnZVByZXZpZXcpXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQWRkIG1vdXNlbGVhdmUgaGFuZGxlciB0byB0aGUgcHJldmlldyBpdHNlbGZcbiAgICAgICAgaW1hZ2VQcmV2aWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGhpZGVJbWFnZVByZXZpZXcpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSBwcmV2aWV3J3MgbW91c2VsZWF2ZSBoYW5kbGVyIG9uIHVubG9hZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCgpID0+IHtcbiAgICAgICAgICBpbWFnZVByZXZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgaGlkZUltYWdlUHJldmlldyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvcmNlIHRoZSBwcmV2aWV3IHRvIGhpZGUgd2hlbmV2ZXIgdGhlIHBvaW50ZXIgbGVhdmVzIHRoZSB3aG9sZSBwYW5lbFxuICAgICAgICB0aGlzLmNvbnRleHRQYW5lbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBoaWRlSW1hZ2VQcmV2aWV3KTtcbiAgICAgIH0gZWxzZSBpZiAoW1wibXAzXCIsIFwid2F2XCIsIFwib2dnXCIsIFwibTRhXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgaWNvbk5hbWUgPSBcImF1ZGlvLWxpbmVzXCI7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBbXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJwZGZcIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGljb25OYW1lID0gXCJmaWxlXCI7XG4gICAgICB9XG5cbiAgICAgIHNldEljb24oaWNvbkNvbnRhaW5lciwgaWNvbk5hbWUpO1xuXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQobGlua1RleHQsIFwiXCIsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBtZXRhIGNvbnRhaW5lciBidXQgZG9uJ3QgYWRkIGVsZW1lbnRzIHlldFxuICAgICAgY29uc3QgbWV0YSA9IGl0ZW0uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LW1ldGFcIiB9KTtcblxuICAgICAgLy8gQ3JlYXRlIHJlbW92ZSBidXR0b24gZmlyc3QgKGFsd2F5cyB2aXNpYmxlKVxuICAgICAgY29uc3QgcmVtb3ZlQnRuID0gbWV0YS5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZHJhd2VyLWl0ZW0tcmVtb3ZlXCIsXG4gICAgICAgIHRleHQ6IFwiXHUwMEQ3XCIsXG4gICAgICB9KTtcbiAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZW1vdmVDb250ZXh0RmlsZShwYXRoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgbWV0YSBpbmZvIGJhc2VkIG9uIGF2YWlsYWJsZSB3aWR0aFxuICAgICAgY29uc3QgdXBkYXRlTWV0YUluZm8gPSAoKSA9PiB7XG4gICAgICAgIC8vIEdldCBhdmFpbGFibGUgd2lkdGggKGNvbnRhaW5lciB3aWR0aCBtaW51cyBwYWRkaW5nIGFuZCBpY29uKVxuICAgICAgICBjb25zdCBhdmFpbGFibGVXaWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aCAtIDQwOyAvLyA0MHB4IGZvciBwYWRkaW5nIGFuZCBpY29uXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lV2lkdGggPSBsaW5rLm9mZnNldFdpZHRoO1xuICAgICAgICBjb25zdCByZW1vdmVCdG5XaWR0aCA9IDI0OyAvLyBGaXhlZCB3aWR0aCBvZiByZW1vdmUgYnV0dG9uXG4gICAgICAgIFxuICAgICAgICAvLyBDYWxjdWxhdGUgcmVtYWluaW5nIHdpZHRoXG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1dpZHRoID0gYXZhaWxhYmxlV2lkdGggLSBmaWxlTmFtZVdpZHRoIC0gcmVtb3ZlQnRuV2lkdGg7XG5cbiAgICAgICAgLy8gQ2xlYXIgZXhpc3RpbmcgbWV0YSBlbGVtZW50c1xuICAgICAgICBjb25zdCBleGlzdGluZ01ldGEgPSBtZXRhLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zeXN0ZW1zY3VscHQtY29udGV4dC10eXBlLCAuc3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZSwgLnN5c3RlbXNjdWxwdC1jb250ZXh0LXRva2VuLWNvdW50Jyk7XG4gICAgICAgIGV4aXN0aW5nTWV0YS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcblxuICAgICAgICAvLyBPbmx5IGFkZCBtZXRhIGVsZW1lbnRzIGlmIHdlIGhhdmUgZW5vdWdoIHNwYWNlXG4gICAgICAgIGlmIChyZW1haW5pbmdXaWR0aCA+IDE1MCkgeyAvLyBNaW5pbXVtIHdpZHRoIG5lZWRlZCBmb3IgbWV0YSBpbmZvXG4gICAgICAgICAgLy8gQWRkIGZpbGUgdHlwZSAoaWYgd2UgaGF2ZSByb29tKVxuICAgICAgICAgIGlmIChyZW1haW5pbmdXaWR0aCA+IDIwMCkge1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IG1ldGEuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXR5cGVcIiB9KTtcbiAgICAgICAgICAgIHR5cGUuc2V0VGV4dChmaWxlLmV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBBZGQgZmlsZSBzaXplIChpZiB3ZSBoYXZlIHJvb20pXG4gICAgICAgICAgaWYgKHJlbWFpbmluZ1dpZHRoID4gMTAwKSB7XG4gICAgICAgICAgICBjb25zdCBzaXplID0gbWV0YS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtc2l6ZVwiIH0pO1xuICAgICAgICAgICAgc2l6ZS5zZXRUZXh0KHRoaXMuZm9ybWF0RmlsZVNpemUoZmlsZS5zdGF0Py5zaXplIHx8IDApKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBBZGQgdG9rZW4gY291bnQgZm9yIHRleHQgZmlsZXMgKGlmIHdlIGhhdmUgcm9vbSlcbiAgICAgICAgICBpZiAocmVtYWluaW5nV2lkdGggPiAyNTAgJiYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpKSB7XG4gICAgICAgICAgICBjb25zdCB0b2tlbkNvdW50ID0gbWV0YS5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdG9rZW4tY291bnRcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDA7XG4gICAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQodGhpcy50b2tlbkNvdW50ZXIuZm9ybWF0VG9rZW5Db3VudChjb3VudCkpO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG9rZW4gY291bnQgaWYgbm90IGFscmVhZHkgZG9uZVxuICAgICAgICAgICAgaWYgKCF0aGlzLnRva2VuQ291bnRzLmhhcyhmaWxlLnBhdGgpKSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlVG9rZW5Db3VudChmaWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0b2tlbkNvdW50LnNldFRleHQoXG4gICAgICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRva2VuQ291bnRzLmdldChmaWxlLnBhdGgpIHx8IDBcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEluaXRpYWwgdXBkYXRlXG4gICAgICB1cGRhdGVNZXRhSW5mbygpO1xuXG4gICAgICAvLyBVcGRhdGUgb24gcmVzaXplXG4gICAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICAgIHVwZGF0ZU1ldGFJbmZvKCk7XG4gICAgICB9KTtcbiAgICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUoY29udGFpbmVyKTtcblxuICAgICAgLy8gQ2xlYW4gdXAgb2JzZXJ2ZXIgd2hlbiBjb21wb25lbnQgdW5sb2Fkc1xuICAgICAgdGhpcy5yZWdpc3RlcigoKSA9PiB7XG4gICAgICAgIHJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYWRkQ29udGV4dEZpbGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgQ29udGV4dFNlbGVjdGlvbk1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICBhc3luYyAoZmlsZXM6IFRGaWxlW10pID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICBgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiXCIsIFwiXCIsIHRydWUpO1xuICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGhpcy5wbHVnaW5cbiAgICApO1xuICAgIG1vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVtb3ZlQ29udGV4dEZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG4gICAgdGhpcy5jb250ZXh0RmlsZXMuZGVsZXRlKGZpbGVQYXRoKTtcbiAgICB0aGlzLmNvbnRleHRGaWxlcy5kZWxldGUoYFtbJHtub3JtYWxpemVkUGF0aH1dXWApO1xuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gICAgYXdhaXQgdGhpcy5vbkNvbnRleHRDaGFuZ2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBhZGRGaWxlVG9Db250ZXh0KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBkYXRhbGFiRG9jRXh0ZW5zaW9ucyA9IFtcbiAgICAgIFwicGRmXCIsXG4gICAgICBcImRvY1wiLFxuICAgICAgXCJkb2N4XCIsXG4gICAgICBcInhsc1wiLFxuICAgICAgXCJ4bHN4XCIsXG4gICAgICBcInBwdFwiLFxuICAgICAgXCJwcHR4XCIsXG4gICAgXTtcbiAgICBjb25zdCBhdWRpb0V4dGVuc2lvbnMgPSBbXCJ3YXZcIiwgXCJtNGFcIiwgXCJ3ZWJtXCIsIFwib2dnXCIsIFwibXAzXCJdO1xuXG4gICAgLy8gQ2hlY2sgbGljZW5zZSBiZWZvcmUgcHJvY2Vzc2luZ1xuICAgIGlmIChcbiAgICAgICEoYXdhaXQgTGljZW5zZUNoZWNrZXIuY2hlY2tMaWNlbnNlRm9yRmlsZShmaWxlLCB0aGlzLmFwcCwgdGhpcy5wbHVnaW4pKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIGZpbGUgaXMgYSBkb2N1bWVudCB0aGF0IG5lZWRzIERhdGFsYWIgcHJvY2Vzc2luZ1xuICAgIGlmIChkYXRhbGFiRG9jRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NEb2N1bWVudEZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGF1ZGlvRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdNZFBhdGggPSBhd2FpdCB0aGlzLnByb2Nlc3NBdWRpb0ZpbGUoZmlsZSk7XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgICAgICB0aGlzLmNvbnRleHRGaWxlcy5hZGQod2lraUxpbmspO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3JpZ2luYWwgbG9naWMgZm9yIG5vcm1hbCBmaWxlXG4gICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7ZmlsZS5wYXRofV1dYDtcbiAgICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZCh3aWtpTGluayk7XG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVDb250ZXh0UGFuZWwoKTtcbiAgICBhd2FpdCB0aGlzLm9uQ29udGV4dENoYW5nZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzRG9jdW1lbnRGaWxlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSB1cGxvYWRpbmdcbiAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgXCJVcGxvYWRpbmcuLi5cIiwgXCJ1cGxvYWRcIik7XG4gICAgY29uc3QgeyBkb2N1bWVudElkLCBzdGF0dXMsIGNhY2hlZCB9ID1cbiAgICAgIGF3YWl0IHRoaXMuc2N1bHB0U2VydmljZS51cGxvYWREb2N1bWVudChmaWxlKTtcblxuICAgIC8vIElmIGRvY3VtZW50IGlzIGNhY2hlZCwgc2tpcCBwb2xsXG4gICAgaWYgKCFjYWNoZWQpIHtcbiAgICAgIC8vIEluZGljYXRlIHdlJ3JlIHByb2Nlc3NpbmdcbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIlByb2Nlc3NpbmcuLi5cIiwgXCJsb2FkZXItMlwiKTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLnBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQpO1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvY3VtZW50IHByb2Nlc3Npbmcgbm90IGNvbXBsZXRlZCBpbiB0aW1lLlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJbmRpY2F0ZSB3ZSdyZSBkb3dubG9hZGluZyByZXN1bHRzXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiRG93bmxvYWRpbmcgcmVzdWx0cy4uLlwiLCBcImRvd25sb2FkXCIpO1xuICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG5cbiAgICAvLyBDcmVhdGUgc3ViZm9sZGVyIGFuZCAubWQgd2l0aCBleHRyYWN0ZWQgdGV4dFxuICAgIGNvbnN0IGV4dHJhY3Rpb25Gb2xkZXIgPSB0aGlzLnNjdWxwdFNlcnZpY2UuZXh0cmFjdGlvbnNEaXJlY3Rvcnk7XG4gICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lLnJlcGxhY2UoL1tcXFxcLzoqP1wiPD58XS9nLCBcIi1cIikudHJpbSgpO1xuICAgIGNvbnN0IHBhcmVudFBhdGggPSBleHRyYWN0aW9uRm9sZGVyXG4gICAgICA/IGAke2V4dHJhY3Rpb25Gb2xkZXJ9LyR7YmFzZU5hbWV9YFxuICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCA/PyBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIocGFyZW50UGF0aCkuY2F0Y2goKCkgPT4ge1xuICAgICAgLyogZm9sZGVyIG1heSBleGlzdCAqL1xuICAgIH0pO1xuXG4gICAgY29uc3QgZXh0cmFjdGVkVGV4dCA9IHRoaXMuZ2V0RXh0cmFjdGlvbk1hcmtkb3duKGV4dHJhY3Rpb25EYXRhKTtcbiAgICBjb25zdCBuZXdNZFBhdGggPSBgJHtwYXJlbnRQYXRofS8ke2Jhc2VOYW1lfS5tZGA7XG5cbiAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBtYXJrZG93biBmaWxlLCBpZiBpdCBleGlzdHMsIHdlJ2xsIHVzZSB0aGUgZXhpc3Rpbmcgb25lXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShuZXdNZFBhdGgsIGV4dHJhY3RlZFRleHQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBGaWxlIGV4aXN0cywgdGhhdCdzIG9rYXkgLSB3ZSdsbCB1c2UgaXRcbiAgICAgIGlmIChcbiAgICAgICAgIShlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB8fFxuICAgICAgICAhZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IGlmIGl0J3Mgbm90IGEgXCJmaWxlIGV4aXN0c1wiIGVycm9yXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBtYXJrZG93biBmaWxlIHRvIGNvbnRleHRcbiAgICBjb25zdCBtZFdpa2lMaW5rID0gYFtbJHtuZXdNZFBhdGh9XV1gO1xuICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZChtZFdpa2lMaW5rKTtcblxuICAgIC8vIEhhbmRsZSBpbWFnZXMgYW5kIGFkZCB0aGVtIHRvIGNvbnRleHRcbiAgICBpZiAoZXh0cmFjdGlvbkRhdGEuaW1hZ2VzICYmIHR5cGVvZiBleHRyYWN0aW9uRGF0YS5pbWFnZXMgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGZvciAoY29uc3QgW2ZpbGVuYW1lLCBiYXNlNjREYXRhXSBvZiBPYmplY3QuZW50cmllcyhcbiAgICAgICAgZXh0cmFjdGlvbkRhdGEuaW1hZ2VzXG4gICAgICApKSB7XG4gICAgICAgIGNvbnN0IGltYWdlUGF0aCA9IGAke3BhcmVudFBhdGh9LyR7ZmlsZW5hbWVcbiAgICAgICAgICAucmVwbGFjZSgvW1xcXFwvOio/XCI8PnxdL2csIFwiLVwiKVxuICAgICAgICAgIC50cmltKCl9YDtcblxuICAgICAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBpbWFnZSBmaWxlLCBpZiBpdCBleGlzdHMsIHdlJ2xsIHVzZSB0aGUgZXhpc3Rpbmcgb25lXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlQmluYXJ5KFxuICAgICAgICAgICAgaW1hZ2VQYXRoLFxuICAgICAgICAgICAgdGhpcy5kZWNvZGVCYXNlNjQoYmFzZTY0RGF0YSBhcyBzdHJpbmcpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAvLyBGaWxlIGV4aXN0cywgdGhhdCdzIG9rYXkgLSB3ZSdsbCB1c2UgaXRcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHx8XG4gICAgICAgICAgICAhZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgaWYgaXQncyBub3QgYSBcImZpbGUgZXhpc3RzXCIgZXJyb3JcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgZWFjaCBpbWFnZSB0byBjb250ZXh0XG4gICAgICAgIGNvbnN0IGltYWdlV2lraUxpbmsgPSBgW1ske2ltYWdlUGF0aH1dXWA7XG4gICAgICAgIHRoaXMuY29udGV4dEZpbGVzLmFkZChpbWFnZVdpa2lMaW5rKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3TWRQYXRoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeHRyYWN0aW9uTWFya2Rvd24oZXh0cmFjdGlvbkRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGV4dCA9IGV4dHJhY3Rpb25EYXRhPy50ZXh0ID8/IFwiXCI7XG4gICAgY29uc3QgbWV0YWRhdGEgPSBleHRyYWN0aW9uRGF0YT8ubWV0YWRhdGEgPz8ge307XG4gICAgY29uc3QgcGFnZUNvdW50ID0gZXh0cmFjdGlvbkRhdGE/LnBhZ2VDb3VudCA/PyAwO1xuICAgIHJldHVybiBgIyBEb2N1bWVudCBFeHRyYWN0aW9uXG5QYWdlIENvdW50OiAke3BhZ2VDb3VudH1cblxuJHt0ZXh0fVxuXG4ke21ldGFkYXRhID8gYFxcbiMgTWV0YWRhdGFcXG4ke0pTT04uc3RyaW5naWZ5KG1ldGFkYXRhLCBudWxsLCAyKX1gIDogXCJcIn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGRlY29kZUJhc2U2NChiYXNlNjRTdHJpbmc6IHN0cmluZyk6IEFycmF5QnVmZmVyIHtcbiAgICBjb25zdCBiaW5hcnlTdHIgPSB3aW5kb3cuYXRvYihiYXNlNjRTdHJpbmcpO1xuICAgIGNvbnN0IGxlbiA9IGJpbmFyeVN0ci5sZW5ndGg7XG4gICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShsZW4pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGJ5dGVzW2ldID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgfVxuICAgIHJldHVybiBieXRlcy5idWZmZXI7XG4gIH1cblxuICBwcml2YXRlIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIGdldENvbnRleHRGaWxlcygpOiBTZXQ8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuY29udGV4dEZpbGVzO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNldENvbnRleHRGaWxlcyhmaWxlczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmNvbnRleHRGaWxlcyA9IG5ldyBTZXQoZmlsZXMpO1xuICAgIHRoaXMudXBkYXRlQ29udGV4dFBhbmVsKCk7XG4gICAgYXdhaXQgdGhpcy5jaGVja1N5bmNTdGF0dXMoKTtcbiAgfVxuXG4gIGdldENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuY29udGV4dFBhbmVsO1xuICB9XG5cbiAgdW5sb2FkKCk6IHZvaWQge1xuICAgIC8vIENsZWFyIGFsbCBwcm9jZXNzaW5nIHRpbWVvdXRzXG4gICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dHMuZm9yRWFjaCgodGltZW91dCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgIH0pO1xuICAgIHRoaXMucHJvY2Vzc2luZ1RpbWVvdXRzLmNsZWFyKCk7XG5cbiAgICAvLyBDbGVhciBhbGwgcHJvY2Vzc2luZyBzdGF0dXNlc1xuICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmZvckVhY2goKHN0YXR1c0VsKSA9PiB7XG4gICAgICBzdGF0dXNFbC5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5jbGVhcigpO1xuXG4gICAgaWYgKHRoaXMucHJvY2Vzc2luZ1N0YXR1cykge1xuICAgICAgdGhpcy5wcm9jZXNzaW5nU3RhdHVzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICB0aGlzLmRyYXdlci51bmxvYWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0F1ZGlvRmlsZShcbiAgICBmaWxlOiBURmlsZSxcbiAgICB0aW1lc3RhbXBlZDogYm9vbGVhbiA9IGZhbHNlXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gSW5kaWNhdGUgd2UncmUgdHJhbnNjcmliaW5nXG4gICAgdGhpcy51cGRhdGVQcm9jZXNzaW5nU3RhdHVzKGZpbGUsIFwiVHJhbnNjcmliaW5nIGF1ZGlvLi4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIFRyYW5zY3JpcHRpb25TZXJ2aWNlIGRpcmVjdGx5XG4gICAgICBjb25zdCB0cmFuc2NyaXB0aW9uU2VydmljZSA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldEluc3RhbmNlKFxuICAgICAgICB0aGlzLnBsdWdpblxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0cmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlRmlsZShmaWxlLCB7XG4gICAgICAgIHR5cGU6IFwibm90ZVwiLFxuICAgICAgICB0aW1lc3RhbXBlZCxcbiAgICAgICAgb25Qcm9ncmVzczogKHByb2dyZXNzLCBzdGF0dXMpID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVByb2Nlc3NpbmdTdGF0dXMoZmlsZSwgc3RhdHVzLCBcImxvYWRlci0yXCIpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBzdWJmb2xkZXIgKyAubWQgd2l0aCB0cmFuc2NyaWJlZCB0ZXh0XG4gICAgICBjb25zdCBleHRyYWN0aW9uRm9sZGVyID0gdGhpcy5zY3VscHRTZXJ2aWNlLmV4dHJhY3Rpb25zRGlyZWN0b3J5O1xuICAgICAgY29uc3QgYmFzZU5hbWUgPSBmaWxlLmJhc2VuYW1lLnJlcGxhY2UoL1tcXFxcLzoqP1wiPD58XS9nLCBcIi1cIikudHJpbSgpO1xuICAgICAgY29uc3QgcGFyZW50UGF0aCA9IGV4dHJhY3Rpb25Gb2xkZXJcbiAgICAgICAgPyBgJHtleHRyYWN0aW9uRm9sZGVyfS8ke2Jhc2VOYW1lfWBcbiAgICAgICAgOiBgJHtmaWxlLnBhcmVudD8ucGF0aCA/PyBcIlwifS8ke2Jhc2VOYW1lfWA7XG5cbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwYXJlbnRQYXRoKS5jYXRjaCgoKSA9PiB7fSk7XG5cbiAgICAgIGNvbnN0IG91dHB1dFBhdGggPSBgJHtwYXJlbnRQYXRofS8ke2Jhc2VOYW1lfS5tZGA7XG4gICAgICBjb25zdCBmaW5hbENvbnRlbnQgPSBgIyBBdWRpbyBUcmFuc2NyaXB0aW9uXG5Tb3VyY2U6ICR7ZmlsZS5iYXNlbmFtZX1cblRyYW5zY3JpYmVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cblxuJHt0ZXh0fWA7XG5cbiAgICAgIC8vIFRyeSBjcmVhdGluZyB0aGUgLm1kXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgob3V0cHV0UGF0aCk7XG4gICAgICAgIGlmIChleGlzdGluZ0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGZpbmFsQ29udGVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKG91dHB1dFBhdGgsIGZpbmFsQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGaWxlIG9wZXJhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhmaWxlLCBcIkFkZGVkIHN1Y2Nlc3NmdWxseSFcIiwgXCJjaGVjay1jaXJjbGVcIik7XG4gICAgICByZXR1cm4gb3V0cHV0UGF0aDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkF1ZGlvIHRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMudXBkYXRlUHJvY2Vzc2luZ1N0YXR1cyhcbiAgICAgICAgZmlsZSxcbiAgICAgICAgYEVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgICBcIngtY2lyY2xlXCJcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IG1heFRyaWVzID0gNTA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhUcmllczsgaSsrKSB7XG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDMwMDApO1xuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9kb2N1bWVudHMvJHtkb2N1bWVudElkfWA7XG4gICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgIGlmICghcmVzcC5vaykgY29udGludWU7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICBpZiAoZGF0YT8uZGF0YT8uc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChkYXRhPy5kYXRhPy5zdGF0dXMgPT09IFwiZXJyb3JcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YT8uZGF0YT8uZXJyb3IgfHwgXCJQcm9jZXNzaW5nIGZhaWxlZFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmx9L2FwaS92MS9kb2N1bWVudHMvJHtkb2N1bWVudElkfS9kb3dubG9hZGA7XG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgaWYgKCFyZXNwLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERvd25sb2FkIGV4dHJhY3Rpb24gZmFpbGVkOiAke3Jlc3Auc3RhdHVzfWApO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgaWYgKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yIHx8IFwiRmFpbGVkIHRvIGRvd25sb2FkIGV4dHJhY3Rpb25cIik7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLmRhdGEuZXh0cmFjdGlvblJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlOiBURmlsZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiIHx8IGZpbGUuZXh0ZW5zaW9uID09PSBcInR4dFwiKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICByZXR1cm4gdGhpcy50b2tlbkNvdW50ZXIuYXBwcm94aW1hdGVUb2tlbkNvdW50KGNvbnRlbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxjdWxhdGluZyB0b2tlbnMgZm9yIGZpbGU6XCIsIGZpbGUucGF0aCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVRva2VuQ291bnQoZmlsZSk7XG4gICAgdGhpcy50b2tlbkNvdW50cy5zZXQoZmlsZS5wYXRoLCBjb3VudCk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChieXRlcyA8IDEwMjQpIHJldHVybiBieXRlcyArIFwiIEJcIjtcbiAgICBjb25zdCBrYiA9IGJ5dGVzIC8gMTAyNDtcbiAgICBpZiAoa2IgPCAxMDI0KSByZXR1cm4ga2IudG9GaXhlZCgxKSArIFwiIEtCXCI7XG4gICAgY29uc3QgbWIgPSBrYiAvIDEwMjQ7XG4gICAgcmV0dXJuIG1iLnRvRml4ZWQoMSkgKyBcIiBNQlwiO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQ29tcG9uZW50LCBQbGF0Zm9ybSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIERyYXdlck9wdGlvbnMge1xuICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICB0aXRsZTogc3RyaW5nO1xuICBjbHM/OiBzdHJpbmc7XG4gIG9uVmlzaWJpbGl0eUNoYW5nZT86ICh2aXNpYmxlOiBib29sZWFuKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgRHJhd2VyQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBkcmF3ZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGhlYWRlcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgY29udGVudDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgdG9nZ2xlOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBpc01vdXNlSW5Qcm94aW1pdHkgPSBmYWxzZTtcbiAgcHJpdmF0ZSBoaWRlVGltZW91dDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBvcHRpb25zOiBEcmF3ZXJPcHRpb25zO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IERyYXdlck9wdGlvbnMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgdGhpcy5pbml0aWFsaXplRHJhd2VyKCk7XG4gICAgdGhpcy5zZXR1cEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVEcmF3ZXIoKTogdm9pZCB7XG4gICAgdGhpcy5kcmF3ZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1kcmF3ZXIgJHt0aGlzLm9wdGlvbnMuY2xzIHx8IFwiXCJ9YCxcbiAgICB9KTtcblxuICAgIHRoaXMuaGVhZGVyID0gdGhpcy5kcmF3ZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItaGVhZGVyXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCB0aXRsZUVsID0gdGhpcy5oZWFkZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItdGl0bGVcIixcbiAgICB9KTtcbiAgICB0aXRsZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiB0aGlzLm9wdGlvbnMudGl0bGUgfSk7XG5cbiAgICB0aGlzLnRvZ2dsZSA9IHRoaXMuaGVhZGVyLmNyZWF0ZVNwYW4oe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItdG9nZ2xlXCIsXG4gICAgICB0ZXh0OiBcIlx1MjVCQ1wiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5jb250ZW50ID0gdGhpcy5kcmF3ZXIuY3JlYXRlRWwoXCJkaXZcIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmF3ZXItY29udGVudFwiLFxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRWaXNpYmlsaXR5KGZhbHNlKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBFdmVudExpc3RlbmVycygpOiB2b2lkIHtcbiAgICAvLyBVc2UgaG92ZXIgYmVoYXZpb3IgZm9yIGFsbCBkZXZpY2VzXG4gICAgdGhpcy5kcmF3ZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSB0cnVlO1xuICAgICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgICB0aGlzLnNldFZpc2liaWxpdHkodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSB0cnVlO1xuICAgICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgICB0aGlzLnNldFZpc2liaWxpdHkodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmRyYXdlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgcmVjdCA9IHRoaXMuZHJhd2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgYnVmZmVyID0gMjU7XG5cbiAgICAgIGlmIChcbiAgICAgICAgZS5jbGllbnRZID49IHJlY3QuYm90dG9tICYmXG4gICAgICAgIGUuY2xpZW50WSA8PSByZWN0LmJvdHRvbSArIGJ1ZmZlciAmJlxuICAgICAgICBlLmNsaWVudFggPj0gcmVjdC5sZWZ0ICYmXG4gICAgICAgIGUuY2xpZW50WCA8PSByZWN0LnJpZ2h0XG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmlzTW91c2VJblByb3hpbWl0eSA9IGZhbHNlO1xuICAgICAgdGhpcy5zY2hlZHVsZUhpZGUoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgcmVjdCA9IHRoaXMuY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IDI1O1xuXG4gICAgICBpZiAoXG4gICAgICAgIGUuY2xpZW50WSA8PSByZWN0LnRvcCAmJlxuICAgICAgICBlLmNsaWVudFkgPj0gcmVjdC50b3AgLSBidWZmZXIgJiZcbiAgICAgICAgZS5jbGllbnRYID49IHJlY3QubGVmdCAmJlxuICAgICAgICBlLmNsaWVudFggPD0gcmVjdC5yaWdodFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc01vdXNlSW5Qcm94aW1pdHkgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NoZWR1bGVIaWRlKCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgY2xpY2sgYmVoYXZpb3IgZm9yIGFsbCBkZXZpY2VzXG4gICAgdGhpcy5oZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzVmlzaWJsZSA9IHRoaXMuY29udGVudC5zdHlsZS5vcGFjaXR5ID09PSBcIjFcIjtcbiAgICAgIHRoaXMuc2V0VmlzaWJpbGl0eSghaXNWaXNpYmxlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJIaWRlVGltZW91dCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oaWRlVGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaGlkZVRpbWVvdXQpO1xuICAgICAgdGhpcy5oaWRlVGltZW91dCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzY2hlZHVsZUhpZGUoKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhckhpZGVUaW1lb3V0KCk7XG4gICAgdGhpcy5oaWRlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmlzTW91c2VJblByb3hpbWl0eSkge1xuICAgICAgICB0aGlzLnNldFZpc2liaWxpdHkoZmFsc2UpO1xuICAgICAgfVxuICAgIH0sIDEwMCk7XG4gIH1cblxuICBwdWJsaWMgc2V0VmlzaWJpbGl0eSh2aXNpYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5jb250ZW50LnN0eWxlLm9wYWNpdHkgPSB2aXNpYmxlID8gXCIxXCIgOiBcIjBcIjtcbiAgICB0aGlzLmNvbnRlbnQuc3R5bGUucG9pbnRlckV2ZW50cyA9IHZpc2libGUgPyBcImFsbFwiIDogXCJub25lXCI7XG4gICAgdGhpcy5jb250ZW50LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7dmlzaWJsZSA/IFwiMFwiIDogXCItOHB4XCJ9KWA7XG4gICAgdGhpcy50b2dnbGUuc3R5bGUudHJhbnNmb3JtID0gdmlzaWJsZSA/IFwicm90YXRlKDApXCIgOiBcInJvdGF0ZSgtOTBkZWcpXCI7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLm9uVmlzaWJpbGl0eUNoYW5nZSkge1xuICAgICAgdGhpcy5vcHRpb25zLm9uVmlzaWJpbGl0eUNoYW5nZSh2aXNpYmxlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29udGVudCgpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuY29udGVudDtcbiAgfVxuXG4gIHB1YmxpYyBnZXREcmF3ZXIoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmRyYXdlcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRIZWFkZXIoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmhlYWRlcjtcbiAgfVxuXG4gIG9udW5sb2FkKCk6IHZvaWQge1xuICAgIHRoaXMuY2xlYXJIaWRlVGltZW91dCgpO1xuICAgIHN1cGVyLm9udW5sb2FkKCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSB9IGZyb20gXCJzcmMvc2VydmljZXMvU2VhcmNoU2VydmljZVwiO1xuaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVG9rZW5Db3VudGVyU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9Ub2tlbkNvdW50ZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgTGljZW5zZUNoZWNrZXIgfSBmcm9tIFwiLi4vY29yZS9saWNlbnNlL0xpY2Vuc2VDaGVja2VyXCI7XG5cbi8vIERlZmluZSBzdXBwb3J0ZWQgZmlsZSB0eXBlc1xuY29uc3QgU1VQUE9SVEVEX0VYVEVOU0lPTlMgPSB7XG4gIGRvY3VtZW50czogW1wibWRcIiwgXCJ0eHRcIl0sXG4gIHByb0RvY3VtZW50czogW1wicGRmXCIsIFwiZG9jXCIsIFwiZG9jeFwiLCBcInBwdFwiLCBcInBwdHhcIiwgXCJ4bHNcIiwgXCJ4bHN4XCJdLFxuICBpbWFnZXM6IFtcInBuZ1wiLCBcImpwZ1wiLCBcImpwZWdcIiwgXCJnaWZcIiwgXCJzdmdcIiwgXCJ3ZWJwXCJdLFxuICBhdWRpbzogW1wibXAzXCIsIFwid2F2XCIsIFwibTRhXCIsIFwib2dnXCIsIFwid2VibVwiXSxcbn07XG5cbi8vIEZsYXR0ZW4gYWxsIHN1cHBvcnRlZCBleHRlbnNpb25zIGludG8gYSBzaW5nbGUgYXJyYXlcbmNvbnN0IEFMTF9TVVBQT1JURURfRVhURU5TSU9OUyA9IE9iamVjdC52YWx1ZXMoU1VQUE9SVEVEX0VYVEVOU0lPTlMpLmZsYXQoKTtcblxuaW50ZXJmYWNlIFNlYXJjaE1hdGNoIHtcbiAgZmllbGQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICBpbmRpY2VzOiBudW1iZXJbXTtcbiAgbWF0Y2hRdWFsaXR5OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBTZWFyY2hSZXN1bHQ8VD4ge1xuICBpdGVtOiBUO1xuICBtYXRjaGVzOiBTZWFyY2hNYXRjaFtdO1xuICBzY29yZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgQ29udGV4dENhcmQge1xuICB0aXRsZTogc3RyaW5nO1xuICBwYXRoOiBzdHJpbmc7XG4gIHNpemU6IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQ29udGV4dFNlbGVjdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2U7XG4gIHByaXZhdGUgdG9rZW5Db3VudGVyOiBUb2tlbkNvdW50ZXJTZXJ2aWNlO1xuICBwcml2YXRlIHRva2VuQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgcHJpdmF0ZSBvblNlbGVjdDogKGZpbGVzOiBURmlsZVtdKSA9PiB2b2lkO1xuICBwcml2YXRlIGZpbGVzOiBURmlsZVtdO1xuICBwcml2YXRlIHNlYXJjaElucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIHJlc3VsdHNDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGN1cnJlbnRTZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8VEZpbGU+W10gPSBbXTtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBlbXB0eVN0YXRlOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBzZWFyY2hUaW1lb3V0OiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzZWxlY3RlZEV4dGVuc2lvbnM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICBwcml2YXRlIGV4dGVuc2lvbkJ1dHRvbnM6IE1hcDxzdHJpbmcsIEhUTUxFbGVtZW50PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBzZWxlY3RlZEZpbGVzOiBTZXQ8VEZpbGU+ID0gbmV3IFNldCgpO1xuICBwcml2YXRlIHNlbGVjdGVkSW5kZXggPSAwO1xuICBwcml2YXRlIHJlc3VsdEVsZW1lbnRzOiBIVE1MRWxlbWVudFtdID0gW107XG4gIHByaXZhdGUgcGx1Z2luOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG9uU2VsZWN0OiAoZmlsZXM6IFRGaWxlW10pID0+IHZvaWQsIHBsdWdpbjogYW55KSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlID0gbmV3IFNlYXJjaFNlcnZpY2UoKTtcbiAgICB0aGlzLnRva2VuQ291bnRlciA9IFRva2VuQ291bnRlclNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmZpbGVzID0gdGhpcy5nZXRBdmFpbGFibGVGaWxlcygpO1xuICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmFkZChcIm1kXCIpOyAvLyBEZWZhdWx0IHRvIE1hcmtkb3duIGZpbHRlclxuICB9XG5cbiAgcHJpdmF0ZSBnZXRBdmFpbGFibGVGaWxlcygpOiBURmlsZVtdIHtcbiAgICAvLyBTaG93IG9ubHkgc3VwcG9ydGVkIGZpbGVzXG4gICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0XG4gICAgICAuZ2V0RmlsZXMoKVxuICAgICAgLmZpbHRlcigoZmlsZSkgPT5cbiAgICAgICAgQUxMX1NVUFBPUlRFRF9FWFRFTlNJT05TLmluY2x1ZGVzKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpXG4gICAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZWFyY2hGaWVsZHMoZmlsZTogVEZpbGUpIHtcbiAgICByZXR1cm4gW1xuICAgICAgeyBmaWVsZDogXCJ0aXRsZVwiLCB0ZXh0OiBmaWxlLmJhc2VuYW1lLCB3ZWlnaHQ6IDEwMCB9LFxuICAgICAgeyBmaWVsZDogXCJwYXRoXCIsIHRleHQ6IGZpbGUucGF0aCwgd2VpZ2h0OiA3NSB9LFxuICAgICAgeyBmaWVsZDogXCJleHRlbnNpb25cIiwgdGV4dDogZmlsZS5leHRlbnNpb24sIHdlaWdodDogNTAgfSxcbiAgICBdO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRGaWxlU2l6ZShieXRlczogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoYnl0ZXMgPCAxMDI0KSByZXR1cm4gYnl0ZXMgKyBcIiBCXCI7XG4gICAgY29uc3Qga2IgPSBieXRlcyAvIDEwMjQ7XG4gICAgaWYgKGtiIDwgMTAyNCkgcmV0dXJuIGtiLnRvRml4ZWQoMSkgKyBcIiBLQlwiO1xuICAgIGNvbnN0IG1iID0ga2IgLyAxMDI0O1xuICAgIHJldHVybiBtYi50b0ZpeGVkKDEpICsgXCIgTUJcIjtcbiAgfVxuXG4gIHByaXZhdGUgaGlnaGxpZ2h0VGV4dChcbiAgICB0ZXh0OiBzdHJpbmcsXG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdXG4gICk6IERvY3VtZW50RnJhZ21lbnQge1xuICAgIGlmICghbWF0Y2hlcyB8fCBtYXRjaGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSBjcmVhdGVGcmFnbWVudCgpO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kVGV4dCh0ZXh0KTtcbiAgICAgIHJldHVybiBmcmFnbWVudDtcbiAgICB9XG5cbiAgICBjb25zdCBmcmFnbWVudCA9IGNyZWF0ZUZyYWdtZW50KCk7XG4gICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB0aGlzLnNlYXJjaElucHV0Py52YWx1ZSB8fCBcIlwiO1xuXG4gICAgLy8gVXNlIHJlZ2V4IHRvIGZpbmQgd2hvbGUgd29yZCBvciBwaHJhc2UgbWF0Y2hlc1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHNlYXJjaFF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7bm9ybWFsaXplZFF1ZXJ5fSlgLCBcImdpXCIpO1xuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaDtcblxuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgLy8gQWRkIG5vbi1oaWdobGlnaHRlZCB0ZXh0IGJlZm9yZSBtYXRjaFxuICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dC5zbGljZShsYXN0SW5kZXgsIG1hdGNoLmluZGV4KSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaWdobGlnaHRlZCBtYXRjaFxuICAgICAgY29uc3Qgc3BhbiA9IGZyYWdtZW50LmNyZWF0ZVNwYW4oe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWhpZ2hsaWdodFwiLFxuICAgICAgICB0ZXh0OiBtYXRjaFswXSxcbiAgICAgIH0pO1xuXG4gICAgICBsYXN0SW5kZXggPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZFRleHQodGV4dC5zbGljZShsYXN0SW5kZXgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJhZ21lbnQ7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUxvYWRpbmdJbmRpY2F0b3IoKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1sb2FkaW5nXCIgfSk7XG4gICAgc2V0SWNvbihjb250YWluZXIsIFwibG9hZGVyLTJcIik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkxvYWRpbmcuLi5cIiB9KSk7XG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRW1wdHlTdGF0ZSgpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWVtcHR5XCIgfSk7XG4gICAgc2V0SWNvbihjb250YWluZXIsIFwic2VhcmNoXCIpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVTcGFuKHsgdGV4dDogXCJObyBtYXRjaGluZyBmaWxlcyBmb3VuZFwiIH0pKTtcbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVUb2tlbkNvdW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSBcIm1kXCIgfHwgZmlsZS5leHRlbnNpb24gPT09IFwidHh0XCIpIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuQ291bnRlci5hcHByb3hpbWF0ZVRva2VuQ291bnQoY29udGVudCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNhbGN1bGF0aW5nIHRva2VucyBmb3IgZmlsZTpcIiwgZmlsZS5wYXRoLCBlcnJvcik7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVRva2VuQ291bnQoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb3VudCA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlVG9rZW5Db3VudChmaWxlKTtcbiAgICB0aGlzLnRva2VuQ291bnRzLnNldChmaWxlLnBhdGgsIGNvdW50KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ2FyZChmaWxlOiBURmlsZSwgcmVzdWx0OiBTZWFyY2hSZXN1bHQ8VEZpbGU+KTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtY2FyZFwiIH0pO1xuICAgIGNhcmQuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCIwXCIpO1xuICAgIGNvbnN0IGNhcmRDb250ZW50ID0gY2FyZC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNhcmQtY29udGVudFwiIH0pO1xuXG4gICAgLy8gQWRkIHRodW1ibmFpbCBmb3IgaW1hZ2UgZmlsZXNcbiAgICBpZiAoZmlsZS5leHRlbnNpb24ubWF0Y2goL3BuZ3xqcGU/Z3xnaWZ8c3ZnfHdlYnAvaSkpIHtcbiAgICAgIGNvbnN0IHRodW1iQ29udGFpbmVyID0gY2FyZENvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXRodW1ibmFpbFwiLFxuICAgICAgfSk7XG5cbiAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xuICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdKTtcbiAgICAgICAgICBjb25zdCBvYmplY3RVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXG4gICAgICAgICAgY29uc3QgaW1nID0gdGh1bWJDb250YWluZXIuY3JlYXRlRWwoXCJpbWdcIiwge1xuICAgICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXRodW1iLWltZ1wiLFxuICAgICAgICAgICAgYXR0cjogeyBzcmM6IG9iamVjdFVybCB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyB0aHVtYm5haWw6XCIsIGVycik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlcy5oYXMoZmlsZSkpIHtcbiAgICAgIGNhcmQuYWRkQ2xhc3MoXCJpcy1hZGRlZFwiKTtcbiAgICAgIGNvbnN0IGNoZWNrSWNvbiA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWNoZWNrXCIgfSk7XG4gICAgICBzZXRJY29uKGNoZWNrSWNvbiwgXCJjaGVja1wiKTtcbiAgICB9XG5cbiAgICBjb25zdCB0ZXh0Q29udGFpbmVyID0gY2FyZENvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY2FyZC10ZXh0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCB0aXRsZSA9IHRleHRDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10aXRsZVwiLFxuICAgIH0pO1xuICAgIHRpdGxlLmFwcGVuZENoaWxkKFxuICAgICAgdGhpcy5oaWdobGlnaHRUZXh0KFxuICAgICAgICBmaWxlLmJhc2VuYW1lLFxuICAgICAgICByZXN1bHQubWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0uZmllbGQgPT09IFwidGl0bGVcIilcbiAgICAgIClcbiAgICApO1xuXG4gICAgY29uc3QgcGF0aCA9IHRleHRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXBhdGhcIiB9KTtcbiAgICBwYXRoLmFwcGVuZENoaWxkKFxuICAgICAgdGhpcy5oaWdobGlnaHRUZXh0KFxuICAgICAgICBmaWxlLnBhdGgsXG4gICAgICAgIHJlc3VsdC5tYXRjaGVzLmZpbHRlcigobSkgPT4gbS5maWVsZCA9PT0gXCJwYXRoXCIpXG4gICAgICApXG4gICAgKTtcblxuICAgIGNvbnN0IG1ldGEgPSB0ZXh0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tZXRhXCIgfSk7XG5cbiAgICBjb25zdCB0eXBlR3JvdXAgPSBtZXRhLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNvbnRleHQtdHlwZS1ncm91cFwiLFxuICAgIH0pO1xuICAgIGNvbnN0IHR5cGUgPSB0eXBlR3JvdXAuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXR5cGVcIiB9KTtcbiAgICB0eXBlLnNldFRleHQoZmlsZS5leHRlbnNpb24udG9VcHBlckNhc2UoKSk7XG5cbiAgICAvLyBBZGQgcHJvIGJhZGdlIG5leHQgdG8gZmlsZSBleHRlbnNpb24gaWYgcmVxdWlyZWRcbiAgICBpZiAoTGljZW5zZUNoZWNrZXIucmVxdWlyZXNQcm9MaWNlbnNlKGZpbGUuZXh0ZW5zaW9uKSkge1xuICAgICAgY29uc3QgcHJvQmFkZ2UgPSB0eXBlR3JvdXAuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWJhZGdlIHByby1iYWRnZVwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKHByb0JhZGdlLmNyZWF0ZVNwYW4oKSwgXCJzcGFya2xlc1wiKTtcbiAgICAgIHByb0JhZGdlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlByb1wiIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldGFHcm91cCA9IG1ldGEuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tZXRhLWdyb3VwXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzaXplID0gbWV0YUdyb3VwLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1zaXplXCIgfSk7XG4gICAgc2l6ZS5zZXRUZXh0KHRoaXMuZm9ybWF0RmlsZVNpemUoZmlsZS5zdGF0Py5zaXplIHx8IDApKTtcblxuICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gXCJtZFwiIHx8IGZpbGUuZXh0ZW5zaW9uID09PSBcInR4dFwiKSB7XG4gICAgICBjb25zdCB0b2tlbkNvdW50ID0gbWV0YUdyb3VwLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC10b2tlbi1jb3VudFwiLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXMudG9rZW5Db3VudHMuZ2V0KGZpbGUucGF0aCkgfHwgMDtcbiAgICAgIHRva2VuQ291bnQuc2V0VGV4dCh0aGlzLnRva2VuQ291bnRlci5mb3JtYXRUb2tlbkNvdW50KGNvdW50KSk7XG5cbiAgICAgIGlmICghdGhpcy50b2tlbkNvdW50cy5oYXMoZmlsZS5wYXRoKSkge1xuICAgICAgICB0aGlzLnVwZGF0ZVRva2VuQ291bnQoZmlsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgdG9rZW5Db3VudC5zZXRUZXh0KFxuICAgICAgICAgICAgdGhpcy50b2tlbkNvdW50ZXIuZm9ybWF0VG9rZW5Db3VudChcbiAgICAgICAgICAgICAgdGhpcy50b2tlbkNvdW50cy5nZXQoZmlsZS5wYXRoKSB8fCAwXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy50b2dnbGVGaWxlU2VsZWN0aW9uKGZpbGUsIGNhcmQpO1xuICAgIH0pO1xuXG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMucmVzdWx0RWxlbWVudHMuaW5kZXhPZihjYXJkKTtcbiAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUmVzdWx0KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU2VsZWN0ZWRSZXN1bHQoKSB7XG4gICAgdGhpcy5yZXN1bHRFbGVtZW50cy5mb3JFYWNoKChlbCwgaW5kZXgpID0+IHtcbiAgICAgIGVsLnRvZ2dsZUNsYXNzKFxuICAgICAgICBcImlzLXNlbGVjdGVkXCIsXG4gICAgICAgIGluZGV4ID09PSB0aGlzLnNlbGVjdGVkSW5kZXggJiYgdGhpcy5zZWxlY3RlZEluZGV4ID49IDBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPj0gMCAmJlxuICAgICAgdGhpcy5zZWxlY3RlZEluZGV4IDwgdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGhcbiAgICApIHtcbiAgICAgIHRoaXMucmVzdWx0RWxlbWVudHNbdGhpcy5zZWxlY3RlZEluZGV4XS5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgIGJlaGF2aW9yOiBcInNtb290aFwiLFxuICAgICAgICBibG9jazogXCJuZWFyZXN0XCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHRvZ2dsZUZpbGVTZWxlY3Rpb24oZmlsZTogVEZpbGUsIGNhcmRFbDogSFRNTEVsZW1lbnQpIHtcbiAgICAvLyBDaGVjayBsaWNlbnNlIGJlZm9yZSBhbGxvd2luZyBzZWxlY3Rpb25cbiAgICBpZiAoXG4gICAgICAhKGF3YWl0IExpY2Vuc2VDaGVja2VyLmNoZWNrTGljZW5zZUZvckZpbGUoZmlsZSwgdGhpcy5hcHAsIHRoaXMucGx1Z2luKSlcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLmhhcyhmaWxlKSkge1xuICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzLmRlbGV0ZShmaWxlKTtcbiAgICAgIGNhcmRFbC5yZW1vdmVDbGFzcyhcImlzLWFkZGVkXCIpO1xuICAgICAgY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuc3lzdGVtc2N1bHB0LWNvbnRleHQtY2hlY2tcIik/LnJlbW92ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRmlsZXMuYWRkKGZpbGUpO1xuICAgICAgY2FyZEVsLmFkZENsYXNzKFwiaXMtYWRkZWRcIik7XG4gICAgICBjb25zdCBjaGVja0ljb24gPSBjYXJkRWwuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LWNoZWNrXCIgfSk7XG4gICAgICBzZXRJY29uKGNoZWNrSWNvbiwgXCJjaGVja1wiKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVBY3Rpb25CdXR0b24oKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQWN0aW9uQnV0dG9uKCkge1xuICAgIGNvbnN0IGFjdGlvbkJ1dHRvbiA9IHRoaXMuY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnN5c3RlbXNjdWxwdC1jb250ZXh0LWFjdGlvbi1idXR0b25cIlxuICAgICk7XG4gICAgaWYgKGFjdGlvbkJ1dHRvbikge1xuICAgICAgY29uc3QgY291bnQgPSB0aGlzLnNlbGVjdGVkRmlsZXMuc2l6ZTtcbiAgICAgIGFjdGlvbkJ1dHRvbi5zZXRUZXh0KFxuICAgICAgICBjb3VudCA+IDBcbiAgICAgICAgICA/IGBBZGQgJHtjb3VudH0gc2VsZWN0ZWQgZmlsZSR7Y291bnQgPT09IDEgPyBcIlwiIDogXCJzXCJ9YFxuICAgICAgICAgIDogXCJTZWxlY3QgZmlsZXMgdG8gYWRkIGFzIGNvbnRleHRcIlxuICAgICAgKTtcbiAgICAgIGFjdGlvbkJ1dHRvbi50b2dnbGVDbGFzcyhcImlzLWFjdGl2ZVwiLCBjb3VudCA+IDApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUmVzdWx0cyhzZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8VEZpbGU+W10pIHtcbiAgICB0aGlzLnJlc3VsdHNDb250YWluZXIuZW1wdHkoKTtcbiAgICB0aGlzLnJlc3VsdEVsZW1lbnRzID0gW107XG4gICAgdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyA9IHNlYXJjaFJlc3VsdHM7XG5cbiAgICBpZiAoc2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuZW1wdHlTdGF0ZS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5lbXB0eVN0YXRlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGNvbnN0IGdyaWQgPSB0aGlzLnJlc3VsdHNDb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1ncmlkXCIsXG4gICAgfSk7XG5cbiAgICBzZWFyY2hSZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNyZWF0ZUNhcmQocmVzdWx0Lml0ZW0sIHJlc3VsdCk7XG4gICAgICBncmlkLmFwcGVuZENoaWxkKGNhcmQpO1xuICAgICAgdGhpcy5yZXN1bHRFbGVtZW50cy5wdXNoKGNhcmQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRVbmlxdWVFeHRlbnNpb25zKCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBleHRlbnNpb25zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgdGhpcy5maWxlcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICBpZiAoZmlsZS5leHRlbnNpb24pIHtcbiAgICAgICAgZXh0ZW5zaW9ucy5hZGQoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDdXN0b20gc29ydGluZzogTUQgZmlyc3QsIHRoZW4gbm9uLXBybywgdGhlbiBwcm9cbiAgICByZXR1cm4gQXJyYXkuZnJvbShleHRlbnNpb25zKS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAvLyBNRCBmaWxlcyBhbHdheXMgY29tZSBmaXJzdFxuICAgICAgaWYgKGEgPT09IFwibWRcIikgcmV0dXJuIC0xO1xuICAgICAgaWYgKGIgPT09IFwibWRcIikgcmV0dXJuIDE7XG5cbiAgICAgIGNvbnN0IGFJc1BybyA9IExpY2Vuc2VDaGVja2VyLnJlcXVpcmVzUHJvTGljZW5zZShhKTtcbiAgICAgIGNvbnN0IGJJc1BybyA9IExpY2Vuc2VDaGVja2VyLnJlcXVpcmVzUHJvTGljZW5zZShiKTtcblxuICAgICAgLy8gVGhlbiBzb3J0IGJ5IHByby9ub24tcHJvXG4gICAgICBpZiAoYUlzUHJvICYmICFiSXNQcm8pIHJldHVybiAxO1xuICAgICAgaWYgKCFhSXNQcm8gJiYgYklzUHJvKSByZXR1cm4gLTE7XG5cbiAgICAgIC8vIEZpbmFsbHkgc29ydCBhbHBoYWJldGljYWxseSB3aXRoaW4gdGhlaXIgZ3JvdXBzXG4gICAgICByZXR1cm4gYS5sb2NhbGVDb21wYXJlKGIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFeHRlbnNpb25CdXR0b24oZXh0ZW5zaW9uOiBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgYnV0dG9uID0gY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXh0ZW5zaW9uLWJ1dHRvblwiLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGljb24gYmFzZWQgb24gZmlsZSB0eXBlXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGJ1dHRvbi5jcmVhdGVTcGFuKHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXh0ZW5zaW9uLWljb25cIixcbiAgICB9KTtcblxuICAgIGlmIChTVVBQT1JURURfRVhURU5TSU9OUy5kb2N1bWVudHMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgc2V0SWNvbihpY29uQ29udGFpbmVyLCBcImZpbGUtdGV4dFwiKTtcbiAgICB9IGVsc2UgaWYgKFNVUFBPUlRFRF9FWFRFTlNJT05TLmltYWdlcy5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBzZXRJY29uKGljb25Db250YWluZXIsIFwiaW1hZ2VcIik7XG4gICAgfSBlbHNlIGlmIChTVVBQT1JURURfRVhURU5TSU9OUy5hdWRpby5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBzZXRJY29uKGljb25Db250YWluZXIsIFwiaGVhZHBob25lc1wiKTsgLy8gQ2hhbmdlZCBmcm9tICdhdWRpbycgdG8gJ2hlYWRwaG9uZXMnXG4gICAgfVxuXG4gICAgYnV0dG9uLmNyZWF0ZVNwYW4oe1xuICAgICAgdGV4dDogZXh0ZW5zaW9uLnRvVXBwZXJDYXNlKCksXG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi10ZXh0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgcHJvIGJhZGdlIGlmIG5lZWRlZFxuICAgIGlmIChMaWNlbnNlQ2hlY2tlci5yZXF1aXJlc1Byb0xpY2Vuc2UoZXh0ZW5zaW9uKSkge1xuICAgICAgY29uc3QgcHJvQmFkZ2UgPSBidXR0b24uY3JlYXRlU3Bhbih7XG4gICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtZXh0ZW5zaW9uLWJhZGdlIHByby1iYWRnZVwiLFxuICAgICAgfSk7XG4gICAgICBzZXRJY29uKHByb0JhZGdlLCBcInNwYXJrbGVzXCIpO1xuICAgIH1cblxuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmhhcyhleHRlbnNpb24pKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmRlbGV0ZShleHRlbnNpb24pO1xuICAgICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJpcy1zZWxlY3RlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmFkZChleHRlbnNpb24pO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJpcy1zZWxlY3RlZFwiKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wZXJmb3JtU2VhcmNoKHRoaXMuc2VhcmNoSW5wdXQudmFsdWUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGJ1dHRvbjtcbiAgfVxuXG4gIHByaXZhdGUgcGVyZm9ybVNlYXJjaChxdWVyeTogc3RyaW5nKSB7XG4gICAgbGV0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgdGhpcy5maWxlcy5maWx0ZXIoXG4gICAgICAgIChmaWxlKSA9PlxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLnNpemUgPT09IDAgfHxcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5oYXMoZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKSlcbiAgICAgICksXG4gICAgICBxdWVyeSxcbiAgICAgIChmaWxlKSA9PiB0aGlzLmdldFNlYXJjaEZpZWxkcyhmaWxlKVxuICAgICk7XG5cbiAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICByZXR1cm4gYS5pdGVtLmJhc2VuYW1lLmxvY2FsZUNvbXBhcmUoYi5pdGVtLmJhc2VuYW1lKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyUmVzdWx0cyhyZXN1bHRzKTtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICBjb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtY29udGV4dC1tb2RhbFwiKTtcblxuICAgIGNvbnN0IHNlYXJjaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jb250ZXh0LXNlYXJjaFwiLFxuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmaWxlcyB0byBhZGQgYXMgY29udGV4dC4uLlwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZXh0ZW5zaW9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWV4dGVuc2lvbi1jb250YWluZXJcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGV4dGVuc2lvbnMgPSB0aGlzLmdldFVuaXF1ZUV4dGVuc2lvbnMoKTtcbiAgICBleHRlbnNpb25zLmZvckVhY2goKGV4dCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5jcmVhdGVFeHRlbnNpb25CdXR0b24oZXh0KTtcbiAgICAgIHRoaXMuZXh0ZW5zaW9uQnV0dG9ucy5zZXQoZXh0LCBidXR0b24pO1xuICAgICAgZXh0ZW5zaW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgfSk7XG5cbiAgICAvLyBNYXJrIE1EIGJ1dHRvbiBhcyBzZWxlY3RlZCBieSBkZWZhdWx0XG4gICAgY29uc3QgbWRCdG4gPSB0aGlzLmV4dGVuc2lvbkJ1dHRvbnMuZ2V0KFwibWRcIik7XG4gICAgaWYgKG1kQnRuKSBtZEJ0bi5hZGRDbGFzcyhcImlzLXNlbGVjdGVkXCIpO1xuXG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gdGhpcy5jcmVhdGVMb2FkaW5nSW5kaWNhdG9yKCk7XG4gICAgY29udGVudEVsLmFwcGVuZENoaWxkKHRoaXMubG9hZGluZ0luZGljYXRvcik7XG5cbiAgICB0aGlzLmVtcHR5U3RhdGUgPSB0aGlzLmNyZWF0ZUVtcHR5U3RhdGUoKTtcbiAgICB0aGlzLmVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIGNvbnRlbnRFbC5hcHBlbmRDaGlsZCh0aGlzLmVtcHR5U3RhdGUpO1xuXG4gICAgY29uc3Qgc2Nyb2xsQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNjcm9sbC1jb250YWluZXJcIixcbiAgICB9KTtcbiAgICB0aGlzLnJlc3VsdHNDb250YWluZXIgPSBzY3JvbGxDb250YWluZXIuY3JlYXRlRGl2KCk7XG5cbiAgICBjb25zdCBhY3Rpb25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYWN0aW9uLWNvbnRhaW5lclwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWN0aW9uQnV0dG9uID0gYWN0aW9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY29udGV4dC1hY3Rpb24tYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBcIlNlbGVjdCBmaWxlcyB0byBhZGQgYXMgY29udGV4dFwiLFxuICAgIH0pO1xuXG4gICAgYWN0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICAgIHRoaXMub25TZWxlY3QoQXJyYXkuZnJvbSh0aGlzLnNlbGVjdGVkRmlsZXMpKTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy51cGRhdGVBY3Rpb25CdXR0b24oKTtcblxuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgdGhpcy5yZXN1bHRzQ29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgIHRoaXMuY29udGFpbmVyRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLnNlYXJjaElucHV0KSByZXR1cm47XG4gICAgICBpZiAodGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgaWYgKGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAoZS5zaGlmdEtleSAmJiB0aGlzLnNlbGVjdGVkSW5kZXggPT09IDApIHtcbiAgICAgICAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPVxuICAgICAgICAgICAgKHRoaXMuc2VsZWN0ZWRJbmRleCAtIDEgKyB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCkgJVxuICAgICAgICAgICAgdGhpcy5yZXN1bHRFbGVtZW50cy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID1cbiAgICAgICAgICAgICh0aGlzLnNlbGVjdGVkSW5kZXggKyAxKSAlIHRoaXMucmVzdWx0RWxlbWVudHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSZXN1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoZS5jb2RlID09PSBcIlNwYWNlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLml0ZW07XG4gICAgICAgIGNvbnN0IGNhcmRFbCA9IHRoaXMucmVzdWx0RWxlbWVudHNbdGhpcy5zZWxlY3RlZEluZGV4XTtcbiAgICAgICAgdGhpcy50b2dnbGVGaWxlU2VsZWN0aW9uKGZpbGUsIGNhcmRFbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpbGVzLnNpemUgPiAwKSB7XG4gICAgICAgICAgdGhpcy5vblNlbGVjdChBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRGaWxlcykpO1xuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7XG5cbiAgICB0aGlzLnBlcmZvcm1TZWFyY2goXCJcIik7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGlmICh0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgLy8gU0hJRlQrVGFiID0+IGZvY3VzIGxhc3QgcmVzdWx0XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLnJlc3VsdEVsZW1lbnRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG5vcm1hbCBUYWIgPT4gZm9jdXMgZmlyc3QgcmVzdWx0XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUmVzdWx0KCk7XG4gICAgICAgICAgdGhpcy5yZXN1bHRFbGVtZW50c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJlc3VsdCgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2VhcmNoVGltZW91dCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoVGltZW91dCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2VhcmNoVGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlO1xuXG4gICAgICAgIGxldCByZXN1bHRzID0gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaChcbiAgICAgICAgICB0aGlzLmZpbGVzLmZpbHRlcihcbiAgICAgICAgICAgIChmaWxlKSA9PlxuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0ZW5zaW9ucy5zaXplID09PSAwIHx8XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHRlbnNpb25zLmhhcyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICksXG4gICAgICAgICAgcXVlcnksXG4gICAgICAgICAgKGZpbGUpID0+IHRoaXMuZ2V0U2VhcmNoRmllbGRzKGZpbGUpXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgICAgICAgICByZXR1cm4gYS5pdGVtLmJhc2VuYW1lLmxvY2FsZUNvbXBhcmUoYi5pdGVtLmJhc2VuYW1lKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJSZXN1bHRzKHJlc3VsdHMpO1xuICAgICAgfSwgMTUwKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgaWYgKHRoaXMuc2VhcmNoVGltZW91dCkge1xuICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnNlYXJjaFRpbWVvdXQpO1xuICAgIH1cbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIEV2ZW50cyB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgRmlsZVRva2VuQ2FjaGUge1xuICB0b2tlbnM6IG51bWJlcjtcbiAgbXRpbWU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFRva2VuQ291bnRlclNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogVG9rZW5Db3VudGVyU2VydmljZTtcbiAgcHJpdmF0ZSBjYWNoZTogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBmaWxlQ2FjaGU6IE1hcDxzdHJpbmcsIEZpbGVUb2tlbkNhY2hlPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBjYWNoZVNpemUgPSAxMDAwO1xuICBwcml2YXRlIGFwcDogQXBwO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gQmluZCB0aGUgZXZlbnQgaGFuZGxlcnNcbiAgICB0aGlzLmhhbmRsZUZpbGVNb2RpZnkgPSB0aGlzLmhhbmRsZUZpbGVNb2RpZnkuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUZpbGVEZWxldGUgPSB0aGlzLmhhbmRsZUZpbGVEZWxldGUuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUZpbGVSZW5hbWUgPSB0aGlzLmhhbmRsZUZpbGVSZW5hbWUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRmlsZU1vZGlmeShmaWxlOiBURmlsZSk6IHZvaWQge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHRoaXMuZmlsZUNhY2hlLmRlbGV0ZShmaWxlLnBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRmlsZURlbGV0ZShmaWxlOiBURmlsZSk6IHZvaWQge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHRoaXMuZmlsZUNhY2hlLmRlbGV0ZShmaWxlLnBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRmlsZVJlbmFtZShmaWxlOiBURmlsZSwgb2xkUGF0aDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgdGhpcy5maWxlQ2FjaGUuZGVsZXRlKG9sZFBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBUb2tlbkNvdW50ZXJTZXJ2aWNlIHtcbiAgICBpZiAoIVRva2VuQ291bnRlclNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIFRva2VuQ291bnRlclNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgVG9rZW5Db3VudGVyU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gVG9rZW5Db3VudGVyU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHNldEFwcChhcHA6IEFwcCk6IHZvaWQge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuXG4gICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwibW9kaWZ5XCIsIHRoaXMuaGFuZGxlRmlsZU1vZGlmeSk7XG4gICAgdGhpcy5hcHAudmF1bHQub24oXCJkZWxldGVcIiwgdGhpcy5oYW5kbGVGaWxlRGVsZXRlKTtcbiAgICB0aGlzLmFwcC52YXVsdC5vbihcInJlbmFtZVwiLCB0aGlzLmhhbmRsZUZpbGVSZW5hbWUpO1xuICB9XG5cbiAgYXN5bmMgZ2V0RmlsZVRva2VuQ291bnQoZmlsZTogVEZpbGUpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSB2YWxpZCBjYWNoZWQgY291bnRcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmZpbGVDYWNoZS5nZXQoZmlsZS5wYXRoKTtcbiAgICBpZiAoY2FjaGVkICYmIGNhY2hlZC5tdGltZSA9PT0gZmlsZS5zdGF0Lm10aW1lKSB7XG4gICAgICByZXR1cm4gY2FjaGVkLnRva2VucztcbiAgICB9XG5cbiAgICAvLyBSZWFkIGFuZCBjb3VudCB0b2tlbnNcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICBjb25zdCB0b2tlbnMgPSB0aGlzLmFwcHJveGltYXRlVG9rZW5Db3VudChjb250ZW50KTtcblxuICAgIC8vIENhY2hlIHRoZSByZXN1bHQgd2l0aCB0aGUgY3VycmVudCBtdGltZVxuICAgIHRoaXMuZmlsZUNhY2hlLnNldChmaWxlLnBhdGgsIHtcbiAgICAgIHRva2VucyxcbiAgICAgIG10aW1lOiBmaWxlLnN0YXQubXRpbWUsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdG9rZW5zO1xuICB9XG5cbiAgYXBwcm94aW1hdGVUb2tlbkNvdW50KHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgaWYgKCF0ZXh0KSByZXR1cm4gMDtcblxuICAgIC8vIENhY2hlIGNoZWNrXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgJHt0ZXh0LnNsaWNlKDAsIDEwMCl9XyR7dGV4dC5sZW5ndGh9YDtcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmNhY2hlLmdldChjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gY2FjaGVkO1xuXG4gICAgLy8gUHJlLXByb2Nlc3MgdGV4dCBmb3IgbW9yZSBhY2N1cmF0ZSBjb3VudGluZ1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xccysvZywgXCIgXCIpLnRyaW0oKTtcblxuICAgIGxldCB0b2tlbkNvdW50ID0gMDtcblxuICAgIC8vIENvdW50IHNwZWNpYWwgcGF0dGVybnMgdGhhdCBjb21tb25seSBtYXAgdG8gc2luZ2xlIHRva2Vuc1xuICAgIGNvbnN0IGNvbW1vblBhdHRlcm5zID0gW1xuICAgICAgL15odHRwcz86XFwvXFwvXFxTKy9nbSwgLy8gVVJMc1xuICAgICAgL1tAI11cXHcrL2csIC8vIE1lbnRpb25zIGFuZCBoYXNodGFnc1xuICAgICAgLzpbYS16X10rOi9nLCAvLyBFbW9qaSBjb2Rlc1xuICAgICAgL1tBLVpdezIsfS9nLCAvLyBBY3Jvbnltc1xuICAgICAgL1xcZHsxLDE2fS9nLCAvLyBOdW1iZXJzXG4gICAgICAvWy4sIT87Oigpe31cXFtcXF1cIiddL2csIC8vIENvbW1vbiBwdW5jdHVhdGlvblxuICAgIF07XG5cbiAgICAvLyBSZW1vdmUgYW5kIGNvdW50IHNwZWNpYWwgcGF0dGVybnMgZmlyc3RcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgY29tbW9uUGF0dGVybnMpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSB0ZXh0Lm1hdGNoKHBhdHRlcm4pO1xuICAgICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgICAgdG9rZW5Db3VudCArPSBtYXRjaGVzLnJlZHVjZSgoc3VtLCBtYXRjaCkgPT4ge1xuICAgICAgICAgIC8vIEFkanVzdCB0b2tlbiBjb3VudCBiYXNlZCBvbiBwYXR0ZXJuIHR5cGUgYW5kIGxlbmd0aFxuICAgICAgICAgIGlmIChtYXRjaC5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIE1hdGguY2VpbChtYXRjaC5sZW5ndGggLyA0KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA8PSA0KSB7XG4gICAgICAgICAgICByZXR1cm4gc3VtICsgMTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIE1hdGguY2VpbChtYXRjaC5sZW5ndGggLyAzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDApO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHBhdHRlcm4sIFwiIFwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTcGxpdCByZW1haW5pbmcgdGV4dCBhbmQgY291bnRcbiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xccysvKS5maWx0ZXIoKHcpID0+IHcubGVuZ3RoID4gMCk7XG4gICAgZm9yIChjb25zdCB3b3JkIG9mIHdvcmRzKSB7XG4gICAgICAvLyBCYXNlIHRva2VuIGNvdW50XG4gICAgICBsZXQgd29yZFRva2VucyA9IDE7XG5cbiAgICAgIC8vIEFkanVzdCBmb3Igd29yZCBsZW5ndGggKG1vc3QgbW9kZWxzIHNwbGl0IGxvbmcgd29yZHMpXG4gICAgICBpZiAod29yZC5sZW5ndGggPiA0KSB7XG4gICAgICAgIHdvcmRUb2tlbnMgKz0gTWF0aC5mbG9vcigod29yZC5sZW5ndGggLSA0KSAvIDMpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGp1c3QgZm9yIG1peGVkIGNhc2UgKHBvdGVudGlhbCBzdWJ3b3JkIHRva2VucylcbiAgICAgIGlmICgvW2Etel1bQS1aXS8udGVzdCh3b3JkKSkge1xuICAgICAgICB3b3JkVG9rZW5zICs9ICh3b3JkLm1hdGNoKC9bQS1aXS9nKSB8fCBbXSkubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGp1c3QgZm9yIG5vbi1BU0NJSSBjaGFyYWN0ZXJzXG4gICAgICBjb25zdCBub25Bc2NpaSA9ICh3b3JkLm1hdGNoKC9bXlxceDAwLVxceDdGXS9nKSB8fCBbXSkubGVuZ3RoO1xuICAgICAgaWYgKG5vbkFzY2lpID4gMCkge1xuICAgICAgICB3b3JkVG9rZW5zICs9IE1hdGguY2VpbChub25Bc2NpaSAqIDEuNSk7XG4gICAgICB9XG5cbiAgICAgIHRva2VuQ291bnQgKz0gd29yZFRva2VucztcbiAgICB9XG5cbiAgICAvLyBBZGQgMTAlIHNhZmV0eSBtYXJnaW4gZm9yIG92ZXJlc3RpbWF0aW9uXG4gICAgdG9rZW5Db3VudCA9IE1hdGguY2VpbCh0b2tlbkNvdW50ICogMS4xKTtcblxuICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICB0aGlzLmNhY2hlUmVzdWx0KGNhY2hlS2V5LCB0b2tlbkNvdW50KTtcblxuICAgIHJldHVybiB0b2tlbkNvdW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWNoZVJlc3VsdChrZXk6IHN0cmluZywgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0aGlzLmNhY2hlLnNpemUgPj0gdGhpcy5jYWNoZVNpemUpIHtcbiAgICAgIGNvbnN0IGZpcnN0S2V5ID0gdGhpcy5jYWNoZS5rZXlzKCkubmV4dCgpLnZhbHVlO1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoZmlyc3RLZXkpO1xuICAgIH1cbiAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTtcbiAgfVxuXG4gIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5jbGVhcigpO1xuICAgIHRoaXMuZmlsZUNhY2hlLmNsZWFyKCk7XG4gIH1cblxuICB1bmxvYWQoKTogdm9pZCB7XG4gICAgLy8gQ2xlYW4gdXAgZXZlbnQgbGlzdGVuZXJzIHdoZW4gcGx1Z2luIGlzIGRpc2FibGVkXG4gICAgaWYgKHRoaXMuYXBwKSB7XG4gICAgICB0aGlzLmFwcC52YXVsdC5vZmYoXCJtb2RpZnlcIiwgdGhpcy5oYW5kbGVGaWxlTW9kaWZ5KTtcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9mZihcImRlbGV0ZVwiLCB0aGlzLmhhbmRsZUZpbGVEZWxldGUpO1xuICAgICAgdGhpcy5hcHAudmF1bHQub2ZmKFwicmVuYW1lXCIsIHRoaXMuaGFuZGxlRmlsZVJlbmFtZSk7XG4gICAgfVxuICB9XG5cbiAgZm9ybWF0VG9rZW5Db3VudChjb3VudDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoY291bnQgPT09IDApIHJldHVybiBcIlwiO1xuICAgIGlmIChjb3VudCA8IDEwMCkgcmV0dXJuIFwiPCAxMDAgdG9rZW5zXCI7XG4gICAgaWYgKGNvdW50ID49IDEwMDApIHtcbiAgICAgIC8vIFJvdW5kIHVwIHRvIG5lYXJlc3QgdGhvdXNhbmRcbiAgICAgIGNvbnN0IGluSyA9IE1hdGguY2VpbChjb3VudCAvIDEwMDApO1xuICAgICAgcmV0dXJuIGB+JHtpbkt9SyB0b2tlbnNgO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSb3VuZCB1cCB0byBuZWFyZXN0IGh1bmRyZWRcbiAgICAgIGNvbnN0IGluSHVuZHJlZHMgPSBNYXRoLmNlaWwoY291bnQgLyAxMDApICogMTAwO1xuICAgICAgcmV0dXJuIGB+JHtpbkh1bmRyZWRzfSB0b2tlbnNgO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi91aVwiO1xuaW1wb3J0IHsgUEFUUkVPTl9VUkwgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIExpY2Vuc2VDaGVja2VyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgUFJPX0VYVEVOU0lPTlMgPSBbXG4gICAgXCJwZGZcIixcbiAgICBcImRvY1wiLFxuICAgIFwiZG9jeFwiLFxuICAgIFwicHB0XCIsXG4gICAgXCJwcHR4XCIsXG4gICAgXCJ4bHNcIixcbiAgICBcInhsc3hcIixcbiAgICBcIm1wM1wiLFxuICAgIFwid2F2XCIsXG4gICAgXCJtNGFcIixcbiAgICBcIm9nZ1wiLFxuICAgIFwid2VibVwiLFxuICBdO1xuXG4gIHB1YmxpYyBzdGF0aWMgcmVxdWlyZXNQcm9MaWNlbnNlKGV4dGVuc2lvbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuUFJPX0VYVEVOU0lPTlMuaW5jbHVkZXMoZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBoYXNWYWxpZExpY2Vuc2UocGx1Z2luOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSAmJiBwbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBhc3luYyBzaG93UHJvRmVhdHVyZVBvcHVwKGFwcDogQXBwKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgYXBwLFxuICAgICAgXCJTdXBwb3J0IFN5c3RlbVNjdWxwdCdzIGRldmVsb3BtZW50IGFuZCB1bmxvY2sgcG93ZXJmdWwgZG9jdW1lbnQgcHJvY2Vzc2luZyBmZWF0dXJlcy4gVXBncmFkZSB0byBQcm8gdG8gcHJvY2VzcyBQREZzLCBXb3JkIGRvY3VtZW50cywgYW5kIGF1ZGlvIGZpbGVzLlwiLFxuICAgICAge1xuICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZSBSZXF1aXJlZFwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgaWNvbjogXCJzcGFya2xlc1wiLFxuICAgICAgfVxuICAgICk7XG5cbiAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0Py5jb25maXJtZWQgfHwgZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIGNoZWNrTGljZW5zZUZvckZpbGUoXG4gICAgZmlsZTogVEZpbGUsXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBhbnlcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKHRoaXMucmVxdWlyZXNQcm9MaWNlbnNlKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICBpZiAoIXRoaXMuaGFzVmFsaWRMaWNlbnNlKHBsdWdpbikpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zaG93UHJvRmVhdHVyZVBvcHVwKGFwcCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgU2Nyb2xsU3RhdGUge1xuICBpc0F1dG9TY3JvbGxFbmFibGVkOiBib29sZWFuO1xuICBpc1VzZXJTY3JvbGxpbmc6IGJvb2xlYW47XG4gIGxhc3RDb250ZW50SGVpZ2h0OiBudW1iZXI7XG4gIGxhc3RTY3JvbGxUb3A6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFNjcm9sbENvbmZpZyB7XG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIG9uU2Nyb2xsU3RhdGVDaGFuZ2U/OiAoaXNBdXRvU2Nyb2xsRW5hYmxlZDogYm9vbGVhbikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFNjcm9sbE1hbmFnZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG9uU2Nyb2xsU3RhdGVDaGFuZ2U/OiAoaXNBdXRvU2Nyb2xsRW5hYmxlZDogYm9vbGVhbikgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzdGF0ZSA9IHtcbiAgICBpc1VzZXJTY3JvbGxpbmc6IGZhbHNlLFxuICAgIGlzQXV0b1Njcm9sbEVuYWJsZWQ6IHRydWUsXG4gICAgbGFzdFNjcm9sbFRvcDogMCxcbiAgfTtcbiAgcHJpdmF0ZSByZXNpemVPYnNlcnZlcjogUmVzaXplT2JzZXJ2ZXI7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBTY3JvbGxDb25maWcpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbmZpZy5jb250YWluZXI7XG4gICAgdGhpcy5vblNjcm9sbFN0YXRlQ2hhbmdlID0gY29uZmlnLm9uU2Nyb2xsU3RhdGVDaGFuZ2U7XG4gICAgdGhpcy5zZXR1cEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5zZXR1cFJlc2l6ZU9ic2VydmVyKCk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgLy8gVXNlIHBhc3NpdmUgbGlzdGVuZXJzIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuaGFuZGxlU2Nyb2xsLCB7IHBhc3NpdmU6IHRydWUgfSk7XG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIndoZWVsXCIsIHRoaXMuaGFuZGxlV2hlZWwsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCB0aGlzLmhhbmRsZVRvdWNoU3RhcnQsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5oYW5kbGVUb3VjaEVuZCwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTY3JvbGwgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBzY3JvbGxUb3AsIHNjcm9sbEhlaWdodCwgY2xpZW50SGVpZ2h0IH0gPSB0aGlzLmNvbnRhaW5lcjtcbiAgICBjb25zdCBpc0F0Qm90dG9tID0gTWF0aC5hYnMoc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wIC0gY2xpZW50SGVpZ2h0KSA8IDEwO1xuICAgIFxuICAgIGlmICh0aGlzLnN0YXRlLmlzVXNlclNjcm9sbGluZykge1xuICAgICAgdGhpcy5zdGF0ZS5pc0F1dG9TY3JvbGxFbmFibGVkID0gaXNBdEJvdHRvbTtcbiAgICAgIGlmICh0aGlzLm9uU2Nyb2xsU3RhdGVDaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5vblNjcm9sbFN0YXRlQ2hhbmdlKHRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHRoaXMuc3RhdGUubGFzdFNjcm9sbFRvcCA9IHNjcm9sbFRvcDtcbiAgfTtcblxuICBwcml2YXRlIGhhbmRsZVdoZWVsID0gKCkgPT4ge1xuICAgIHRoaXMuc3RhdGUuaXNVc2VyU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgfTtcblxuICBwcml2YXRlIGhhbmRsZVRvdWNoU3RhcnQgPSAoKSA9PiB7XG4gICAgdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPSB0cnVlO1xuICB9O1xuXG4gIHByaXZhdGUgaGFuZGxlVG91Y2hFbmQgPSAoKSA9PiB7XG4gICAgdGhpcy5zdGF0ZS5pc1VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgfTtcblxuICBwcml2YXRlIHNldHVwUmVzaXplT2JzZXJ2ZXIoKSB7XG4gICAgdGhpcy5yZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLnJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy5jb250YWluZXIpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUNvbnRlbnRIZWlnaHQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc3RhdGUuaXNBdXRvU2Nyb2xsRW5hYmxlZCkge1xuICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzY3JvbGxUb0JvdHRvbSgpOiB2b2lkIHtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wID0gdGhpcy5jb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNsZWFudXAoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucmVzaXplT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgdGhpcy5oYW5kbGVXaGVlbCk7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdGhpcy5oYW5kbGVUb3VjaFN0YXJ0KTtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5oYW5kbGVUb3VjaEVuZCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBzZXRJY29uLCBDb21wb25lbnQsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHtcbiAgQ2hhdE1lc3NhZ2UsXG4gIFN5c3RlbVByb21wdEluZm8sXG4gIENoYXRSb2xlLFxuICBNdWx0aVBhcnRDb250ZW50LFxuICBQQVRSRU9OX1VSTCxcbn0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBTeXN0ZW1TY3VscHRTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL1N5c3RlbVNjdWxwdFNlcnZpY2VcIjtcbmltcG9ydCB7IEVSUk9SX0NPREVTLCBTeXN0ZW1TY3VscHRFcnJvciB9IGZyb20gXCIuLi8uLi91dGlscy9lcnJvcnNcIjtcbmltcG9ydCB7IHNob3dFbmhhbmNlZE5vdGljZSwgc2hvd1BvcHVwIH0gZnJvbSBcIi4uLy4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IEltYWdlUHJvY2Vzc29yIH0gZnJvbSBcIi4uLy4uL3V0aWxzL0ltYWdlUHJvY2Vzc29yXCI7XG5pbXBvcnQgeyBTY3JvbGxNYW5hZ2VyU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TY3JvbGxNYW5hZ2VyU2VydmljZVwiO1xuaW1wb3J0IHsgTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vTWVzc2FnZVJlbmRlcmVyXCI7XG5pbXBvcnQgeyBSZWNvcmRlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvUmVjb3JkZXJTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IE1vZGVsU2VsZWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL01vZGVsU2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IExvYWRDaGF0TW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0xvYWRDaGF0TW9kYWxcIjtcbmltcG9ydCB7IENIQVRfVklFV19UWVBFLCBDaGF0VmlldyB9IGZyb20gXCIuLi8uLi92aWV3cy9jaGF0dmlldy9DaGF0Vmlld1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIElucHV0SGFuZGxlck9wdGlvbnMge1xuICBhcHA6IEFwcDtcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBnZXRNZXNzYWdlczogKCkgPT4gQ2hhdE1lc3NhZ2VbXTtcbiAgZ2V0U2VsZWN0ZWRNb2RlbElkOiAoKSA9PiBzdHJpbmc7XG4gIGdldENvbnRleHRGaWxlczogKCkgPT4gU2V0PHN0cmluZz47XG4gIGdldFN5c3RlbVByb21wdDogKCkgPT4gU3lzdGVtUHJvbXB0SW5mbztcbiAgY2hhdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBtZXNzYWdlUmVuZGVyZXI6IE1lc3NhZ2VSZW5kZXJlcjtcbiAgb25NZXNzYWdlU3VibWl0OiAobWVzc2FnZTogQ2hhdE1lc3NhZ2UpID0+IFByb21pc2U8dm9pZD47XG4gIG9uQXNzaXN0YW50UmVzcG9uc2U6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25Db250ZXh0RmlsZUFkZDogKHdpa2lsaW5rOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIG9uRXJyb3I6IChlcnJvcjogc3RyaW5nIHwgU3lzdGVtU2N1bHB0RXJyb3IpID0+IHZvaWQ7XG4gIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHZvaWQ7XG4gIG9uRWRpdFN5c3RlbVByb21wdDogKCkgPT4gdm9pZDtcbiAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIGNoYXRWaWV3OiBhbnk7XG59XG5cbmV4cG9ydCBjbGFzcyBJbnB1dEhhbmRsZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgYWlTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlO1xuICBwcml2YXRlIGdldE1lc3NhZ2VzOiAoKSA9PiBDaGF0TWVzc2FnZVtdO1xuICBwcml2YXRlIGdldFNlbGVjdGVkTW9kZWxJZDogKCkgPT4gc3RyaW5nO1xuICBwcml2YXRlIGdldENvbnRleHRGaWxlczogKCkgPT4gU2V0PHN0cmluZz47XG4gIHByaXZhdGUgZ2V0U3lzdGVtUHJvbXB0OiAoKSA9PiBTeXN0ZW1Qcm9tcHRJbmZvO1xuICBwcml2YXRlIGNoYXRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHNjcm9sbE1hbmFnZXI6IFNjcm9sbE1hbmFnZXJTZXJ2aWNlO1xuICBwcml2YXRlIG1lc3NhZ2VSZW5kZXJlcjogTWVzc2FnZVJlbmRlcmVyO1xuICBwcml2YXRlIG9uTWVzc2FnZVN1Ym1pdDogKG1lc3NhZ2U6IENoYXRNZXNzYWdlKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIG9uQXNzaXN0YW50UmVzcG9uc2U6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgcHJpdmF0ZSBvbkNvbnRleHRGaWxlQWRkOiAod2lraWxpbms6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgcHJpdmF0ZSBvbkVycm9yOiAoZXJyb3I6IHN0cmluZyB8IFN5c3RlbVNjdWxwdEVycm9yKSA9PiB2b2lkO1xuICBwcml2YXRlIG9uQWRkQ29udGV4dEZpbGU6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgb25FZGl0U3lzdGVtUHJvbXB0OiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIGlucHV0OiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBwcml2YXRlIGlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICBwcml2YXRlIHJlbmRlclRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVjb3JkZXJTZXJ2aWNlOiBSZWNvcmRlclNlcnZpY2U7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgaW5wdXRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGJ1dHRvbkdyaWQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHJlY29yZGVyVmlzdWFsaXplcjogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpc1JlY29yZGluZyA9IGZhbHNlO1xuICBwcml2YXRlIHVwZGF0ZUdlbmVyYXRpbmdTdGF0ZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBhYm9ydENvbnRyb2xsZXI6IEFib3J0Q29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHN0b3BCdXR0b246IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY2hhdFZpZXc6IGFueTtcbiAgcHJpdmF0ZSB3ZWJTZWFyY2hFbmFibGVkID0gZmFsc2U7XG4gIHByaXZhdGUgd2ViU2VhcmNoQnV0dG9uOiBIVE1MRWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBJbnB1dEhhbmRsZXJPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmFwcCA9IG9wdGlvbnMuYXBwO1xuICAgIHRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XG4gICAgdGhpcy5haVNlcnZpY2UgPSBvcHRpb25zLmFpU2VydmljZTtcbiAgICB0aGlzLmdldE1lc3NhZ2VzID0gb3B0aW9ucy5nZXRNZXNzYWdlcztcbiAgICB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCA9IG9wdGlvbnMuZ2V0U2VsZWN0ZWRNb2RlbElkO1xuICAgIHRoaXMuZ2V0Q29udGV4dEZpbGVzID0gb3B0aW9ucy5nZXRDb250ZXh0RmlsZXM7XG4gICAgdGhpcy5nZXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLmdldFN5c3RlbVByb21wdDtcbiAgICB0aGlzLmNoYXRDb250YWluZXIgPSBvcHRpb25zLmNoYXRDb250YWluZXI7XG4gICAgdGhpcy5zY3JvbGxNYW5hZ2VyID0gb3B0aW9ucy5zY3JvbGxNYW5hZ2VyO1xuICAgIHRoaXMubWVzc2FnZVJlbmRlcmVyID0gb3B0aW9ucy5tZXNzYWdlUmVuZGVyZXI7XG4gICAgdGhpcy5vbk1lc3NhZ2VTdWJtaXQgPSBvcHRpb25zLm9uTWVzc2FnZVN1Ym1pdDtcbiAgICB0aGlzLm9uQXNzaXN0YW50UmVzcG9uc2UgPSBvcHRpb25zLm9uQXNzaXN0YW50UmVzcG9uc2U7XG4gICAgdGhpcy5vbkNvbnRleHRGaWxlQWRkID0gb3B0aW9ucy5vbkNvbnRleHRGaWxlQWRkO1xuICAgIHRoaXMub25FcnJvciA9IG9wdGlvbnMub25FcnJvcjtcbiAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUgPSBvcHRpb25zLm9uQWRkQ29udGV4dEZpbGU7XG4gICAgdGhpcy5vbkVkaXRTeXN0ZW1Qcm9tcHQgPSBvcHRpb25zLm9uRWRpdFN5c3RlbVByb21wdDtcbiAgICB0aGlzLnBsdWdpbiA9IG9wdGlvbnMucGx1Z2luO1xuICAgIHRoaXMuY2hhdFZpZXcgPSBvcHRpb25zLmNoYXRWaWV3O1xuXG4gICAgY29uc29sZS5sb2coXCJJbml0aWFsaXppbmcgSW5wdXRIYW5kbGVyIHdpdGggUmVjb3JkZXJTZXJ2aWNlXCIpO1xuICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlID0gUmVjb3JkZXJTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwge1xuICAgICAgaXNJbkNoYXQ6IHRydWUsXG4gICAgICBvblRyYW5zY3JpcHRpb25Db21wbGV0ZTogKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlY2VpdmVkIHRyYW5zY3JpcHRpb24sIGluc2VydGluZyBhdCBjdXJzb3IgcG9zaXRpb25cIik7XG4gICAgICAgIHRoaXMuaW5zZXJ0VGV4dEF0Q3Vyc29yKHRleHQpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNpbXBsaWZ5IG1lc3NhZ2UgaGFuZGxlcnNcbiAgICBjb25zdCBvcmlnaW5hbE1lc3NhZ2VTdWJtaXQgPSBvcHRpb25zLm9uTWVzc2FnZVN1Ym1pdDtcbiAgICB0aGlzLm9uTWVzc2FnZVN1Ym1pdCA9IGFzeW5jIChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4ge1xuICAgICAgYXdhaXQgb3JpZ2luYWxNZXNzYWdlU3VibWl0KG1lc3NhZ2UpO1xuICAgIH07XG5cbiAgICBjb25zdCBvcmlnaW5hbEFzc2lzdGFudFJlc3BvbnNlID0gb3B0aW9ucy5vbkFzc2lzdGFudFJlc3BvbnNlO1xuICAgIHRoaXMub25Bc3Npc3RhbnRSZXNwb25zZSA9IGFzeW5jIChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4ge1xuICAgICAgYXdhaXQgb3JpZ2luYWxBc3Npc3RhbnRSZXNwb25zZShtZXNzYWdlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXR1cElucHV0KCk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwSW5wdXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbnB1dENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmJ1dHRvbkdyaWQgPSB0aGlzLmlucHV0Q29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWdyaWRcIixcbiAgICB9KTtcblxuICAgIC8vIEdST1VQIDE6IENoYXQgQ29uZmlndXJhdGlvblxuICAgIGNvbnN0IHNldHRpbmdzQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJUaGlzIENoYXQncyBTZXR0aW5nc1wiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihzZXR0aW5nc0J1dHRvbiwgXCJzZXR0aW5nc1wiKTtcbiAgICBzZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vbkVkaXRTeXN0ZW1Qcm9tcHQoKTtcbiAgICB9KTtcblxuICAgIC8vIEdST1VQIDI6IENvbnRleHQgJiBTZWFyY2hcbiAgICBjb25zdCBhdHRhY2hCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkFkZCBhdHRhY2htZW50XCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKGF0dGFjaEJ1dHRvbiwgXCJwYXBlcmNsaXBcIik7XG4gICAgYXR0YWNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgLy8gU0hJRlQtY2xpY2sgPT4gZGlyZWN0IHVwbG9hZCB0byBzZXJ2ZXJcbiAgICAgICAgdGhpcy5oYW5kbGVEb2N1bWVudFVwbG9hZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciBjbGljayA9PiBhZGQgY29udGV4dCBmaWxlIGFzIGJlZm9yZVxuICAgICAgICB0aGlzLm9uQWRkQ29udGV4dEZpbGUoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHdlYlNlYXJjaEJ1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiVG9nZ2xlIHdlYiBzZWFyY2hcIiB9LFxuICAgIH0pO1xuICAgIHRoaXMud2ViU2VhcmNoQnV0dG9uID0gd2ViU2VhcmNoQnV0dG9uO1xuICAgIHNldEljb24od2ViU2VhcmNoQnV0dG9uLCBcImdsb2JlXCIpO1xuICAgIHdlYlNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2V0IGN1cnJlbnQgcHJvdmlkZXIgaW5mb1xuICAgICAgY29uc3QgaXNOYXRpdmVQcm92aWRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLnR5cGUgPT09IFwibmF0aXZlXCI7XG4gICAgICBjb25zdCBjdXJyZW50UHJvdmlkZXIgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jdXN0b21Qcm92aWRlcnMuZmluZChcbiAgICAgICAgKHA6IHsgaWQ6IHN0cmluZzsgZW5kcG9pbnQ6IHN0cmluZyB9KSA9PiBwLmlkID09PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci5pZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGlzT3BlblJvdXRlciA9IGN1cnJlbnRQcm92aWRlcj8uZW5kcG9pbnQuaW5jbHVkZXMoXCJvcGVucm91dGVyLmFpXCIpO1xuXG4gICAgICAvLyBPbmx5IGFsbG93IHdlYiBzZWFyY2ggZm9yIG5hdGl2ZSBtb2RlbHMgb3IgT3BlblJvdXRlclxuICAgICAgaWYgKCFpc05hdGl2ZVByb3ZpZGVyICYmICFpc09wZW5Sb3V0ZXIpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIFwiV2ViIHNlYXJjaCBhbGxvd3MgdGhlIEFJIHRvIGFjY2VzcyByZWFsLXRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgaW50ZXJuZXQgdG8gcHJvdmlkZSB1cC10by1kYXRlIGFuc3dlcnMuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiRmVhdHVyZSBSZXN0cmljdGlvbiAtIFdlYiBTZWFyY2hcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIldlYiBzZWFyY2ggaXMgb25seSBhdmFpbGFibGUgZm9yIFN5c3RlbVNjdWxwdCBhbmQgT3BlblJvdXRlciBtb2RlbHMuIFBsZWFzZSBzd2l0Y2ggdG8gYSBjb21wYXRpYmxlIG1vZGVsIHRvIHVzZSB0aGlzIGZlYXR1cmUuXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMud2ViU2VhcmNoRW5hYmxlZCA9ICF0aGlzLndlYlNlYXJjaEVuYWJsZWQ7XG4gICAgICB3ZWJTZWFyY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImlzLWVuYWJsZWRcIiwgdGhpcy53ZWJTZWFyY2hFbmFibGVkKTtcbiAgICB9KTtcblxuICAgIC8vIEdST1VQIDM6IElucHV0IE1ldGhvZHNcbiAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBwcm8gbGljZW5zZVxuICAgIGNvbnN0IGhhc1Byb0xpY2Vuc2UgPVxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpICYmXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQ7XG5cbiAgICAvLyBDcmVhdGUgbWljIGJ1dHRvbiB3aXRoIHByby1vbmx5IGhhbmRsaW5nXG4gICAgY29uc3QgbWljQnV0dG9uID0gdGhpcy5idXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1taWMtYnV0dG9uJHtcbiAgICAgICAgaGFzUHJvTGljZW5zZSA/IFwiXCIgOiBcIiBwcm8tZmVhdHVyZVwiXG4gICAgICB9YCxcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgXCJhcmlhLWxhYmVsXCI6IGhhc1Byb0xpY2Vuc2VcbiAgICAgICAgICA/IFwiUmVjb3JkIGF1ZGlvIG1lc3NhZ2VcIlxuICAgICAgICAgIDogXCJSZWNvcmQgYXVkaW8gbWVzc2FnZSAoUHJvIGZlYXR1cmUpXCIsXG4gICAgICAgIFwiYXJpYS1kaXNhYmxlZFwiOiAoIWhhc1Byb0xpY2Vuc2UpLnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiBoYXNQcm9MaWNlbnNlXG4gICAgICAgICAgPyBcIlJlY29yZCBhdWRpbyBtZXNzYWdlXCJcbiAgICAgICAgICA6IFwiUmVjb3JkaW5nIGlzIGEgUHJvIGZlYXR1cmUuIENsaWNrIHRvIGxlYXJuIG1vcmUuXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHNldEljb24obWljQnV0dG9uLCBcIm1pY1wiKTtcblxuICAgIC8vIEFkZC9yZW1vdmUgZGlzYWJsZWQgY2xhc3MgYmFzZWQgb24gbGljZW5zZSBzdGF0dXNcbiAgICBtaWNCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsICFoYXNQcm9MaWNlbnNlKTtcblxuICAgIG1pY0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFoYXNQcm9MaWNlbnNlKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlZvaWNlIHJlY29yZGluZyBhbGxvd3MgeW91IHRvIHF1aWNrbHkgY2FwdHVyZSB5b3VyIHRob3VnaHRzIGJ5IHNwZWFraW5nIGluc3RlYWQgb2YgdHlwaW5nLiBUaGlzIGZlYXR1cmUgaW5jbHVkZXMgYXV0b21hdGljIHRyYW5zY3JpcHRpb24gb2YgeW91ciByZWNvcmRpbmdzIHRvIHRleHQuXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvIEZlYXR1cmUgLSBWb2ljZSBSZWNvcmRpbmdcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIlN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYW5kIHVubG9jayB2b2ljZSByZWNvcmRpbmcsIHRyYW5zY3JpcHRpb24sIGFuZCBvdGhlciBwcmVtaXVtIGZlYXR1cmVzIGJ5IGJlY29taW5nIGEgUGF0cmVvbiBtZW1iZXIhXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkJlY29tZSBhIFBhdHJvblwiLFxuICAgICAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkge1xuICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaGFuZGxlTWljQ2xpY2soKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlbmRCdXR0b24gPSB0aGlzLmJ1dHRvbkdyaWQuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1pbnB1dC1hY3Rpb24tYnV0dG9uIHN5c3RlbXNjdWxwdC1zZW5kLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJTZW5kIG1lc3NhZ2VcIiB9LFxuICAgIH0pO1xuICAgIHNldEljb24oc2VuZEJ1dHRvbiwgXCJzZW5kXCIpO1xuICAgIHNlbmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGFuZGxlU2VuZE1lc3NhZ2UuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBDcmVhdGUgc3RvcCBidXR0b24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuc3RvcEJ1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b24gc3lzdGVtc2N1bHB0LXN0b3AtYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIlN0b3AgZ2VuZXJhdGlvblwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbih0aGlzLnN0b3BCdXR0b24sIFwic3F1YXJlXCIpO1xuICAgIHRoaXMuc3RvcEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5zdG9wQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcImNsaWNrXCIsXG4gICAgICB0aGlzLmhhbmRsZVN0b3BHZW5lcmF0aW9uLmJpbmQodGhpcylcbiAgICApO1xuXG4gICAgdGhpcy5pbnB1dCA9IHRoaXMuaW5wdXRDb250YWluZXIuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0IHN5c3RlbXNjdWxwdC1jaGF0LWlucHV0XCIsXG4gICAgICBhdHRyOiB7XG4gICAgICAgIHJvd3M6IFwiMVwiLFxuICAgICAgICBwbGFjZWhvbGRlcjogXCJUeXBlIGEgbWVzc2FnZS4uLlwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFJlbW92ZSB0b2tlbiBjb3VudGVyIGVsZW1lbnQgY3JlYXRpb24gYW5kIGV2ZW50IGxpc3RlbmVyc1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcykpO1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHRoaXMuYWRqdXN0SW5wdXRIZWlnaHQuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwicGFzdGVcIiwgdGhpcy5oYW5kbGVQYXN0ZS5iaW5kKHRoaXMpKTtcblxuICAgIC8vIFNpbXBsaWZpZWQgcmVjb3JkZXIgaGFuZGxpbmdcbiAgICB0aGlzLnJlY29yZGVyU2VydmljZS5vblRvZ2dsZSgoaXNSZWNvcmRpbmcpID0+IHtcbiAgICAgIHRoaXMuaXNSZWNvcmRpbmcgPSBpc1JlY29yZGluZztcbiAgICAgIGNvbnN0IG1pY0J1dHRvbiA9IHRoaXMuYnV0dG9uR3JpZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIi5zeXN0ZW1zY3VscHQtbWljLWJ1dHRvblwiXG4gICAgICApO1xuICAgICAgaWYgKG1pY0J1dHRvbikge1xuICAgICAgICBtaWNCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBpc1JlY29yZGluZyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBVcGRhdGUgVUkgd2hlbiBnZW5lcmF0aW5nIHN0YXRlIGNoYW5nZXNcbiAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSA9ICgpID0+IHtcbiAgICAgIHRoaXMuaW5wdXQuZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIHNlbmRCdXR0b24uZGlzYWJsZWQgPSB0aGlzLmlzR2VuZXJhdGluZztcbiAgICAgIG1pY0J1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgYXR0YWNoQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG4gICAgICBzZXR0aW5nc0J1dHRvbi5kaXNhYmxlZCA9IHRoaXMuaXNHZW5lcmF0aW5nO1xuICAgICAgd2ViU2VhcmNoQnV0dG9uLmRpc2FibGVkID0gdGhpcy5pc0dlbmVyYXRpbmc7XG5cbiAgICAgIGlmICh0aGlzLnN0b3BCdXR0b24pIHtcbiAgICAgICAgdGhpcy5zdG9wQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmlzR2VuZXJhdGluZyA/IFwiZmxleFwiIDogXCJub25lXCI7XG4gICAgICAgIHNlbmRCdXR0b24uc3R5bGUuZGlzcGxheSA9IHRoaXMuaXNHZW5lcmF0aW5nID8gXCJub25lXCIgOiBcImZsZXhcIjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuaXNHZW5lcmF0aW5nXG4gICAgICAgID8gXCJXYWl0aW5nIGZvciByZXNwb25zZS4uLlwiXG4gICAgICAgIDogXCJUeXBlIGEgbWVzc2FnZS4uLlwiO1xuXG4gICAgICAvLyBUb2dnbGUgZGlzYWJsZWQgY2xhc3Nlc1xuICAgICAgdGhpcy5pbnB1dC5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgc2VuZEJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWRcIiwgdGhpcy5pc0dlbmVyYXRpbmcpO1xuICAgICAgbWljQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICBhdHRhY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICAgIHNldHRpbmdzQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCB0aGlzLmlzR2VuZXJhdGluZyk7XG4gICAgICB3ZWJTZWFyY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsIHRoaXMuaXNHZW5lcmF0aW5nKTtcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTdG9wR2VuZXJhdGlvbigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5hYm9ydENvbnRyb2xsZXIpIHtcbiAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy51cGRhdGVHZW5lcmF0aW5nU3RhdGUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVNlbmRNZXNzYWdlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEZpcnN0LCBjaGVjayBpZiBhIG1vZGVsIGlzIHNlbGVjdGVkXG4gICAgY29uc3QgY3VycmVudE1vZGVsSWQgPSB0aGlzLmdldFNlbGVjdGVkTW9kZWxJZCgpO1xuICAgIGlmICghY3VycmVudE1vZGVsSWQgfHwgY3VycmVudE1vZGVsSWQudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiTm8gbW9kZWwgc2VsZWN0ZWRcIiwge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJQbGVhc2Ugc2VsZWN0IGFuIEFJIG1vZGVsIGJlZm9yZSBzZW5kaW5nIGEgbWVzc2FnZS5cIixcbiAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJTZWxlY3QgTW9kZWxcIixcbiAgICAgICAgc2Vjb25kYXJ5QnV0dG9uOiBcIkNhbmNlbFwiLFxuICAgICAgfSk7XG4gICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgLy8gT3BlbiB0aGUgbW9kZWwgc2VsZWN0aW9uIG1vZGFsXG4gICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGVsU2VsZWN0aW9uTW9kYWwoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJcIiwgLy8gbm8gbW9kZWwgaXMgc2VsZWN0ZWQgY3VycmVudGx5XG4gICAgICAgICAgYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBjaGF0IHZpZXcgd2l0aCB0aGUgY2hvc2VuIG1vZGVsXG4gICAgICAgICAgICBhd2FpdCAodGhpcy5jaGF0VmlldyBhcyBhbnkpLnNldFNlbGVjdGVkTW9kZWxJZChtb2RlbElkKTtcbiAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICAgICAgXCJNb2RlbCBzZWxlY3RlZC4gUGxlYXNlIHJlLXNlbmQgeW91ciBtZXNzYWdlLlwiLFxuICAgICAgICAgICAgICBcImluZm9cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMucGx1Z2luXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjsgLy8gRG8gbm90IHByb2NlZWQgd2l0aCBzZW5kaW5nIHRoZSBtZXNzYWdlXG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGxpY2Vuc2Uga2V5IG9ubHkgd2hlbiB1c2luZyBuYXRpdmUgU3lzdGVtU2N1bHB0IG1vZGVsc1xuICAgIGlmIChcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLnR5cGUgPT09IFwibmF0aXZlXCIgJiZcbiAgICAgICghdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleSB8fFxuICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleS50cmltKCkpXG4gICAgKSB7XG4gICAgICBzaG93UG9wdXAoXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICBcIllvdSBkb24ndCBoYXZlIGEgbGljZW5zZSBrZXkuIFBsZWFzZSBhZGQgYSB2YWxpZCBsaWNlbnNlIGtleSBpbiBzZXR0aW5ncyB0byB1c2UgU3lzdGVtU2N1bHB0IEFJIHNwZWNpZmljIG1vZGVscy5cIixcbiAgICAgICAge1xuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkxpY2Vuc2UgS2V5IFJlcXVpcmVkXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmlucHV0LnZhbHVlLnRyaW0oKTtcbiAgICBpZiAoIWNvbnRlbnQgfHwgdGhpcy5pc0dlbmVyYXRpbmcpIHJldHVybjtcblxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSBcIlwiO1xuICAgIHRoaXMuYWRqdXN0SW5wdXRIZWlnaHQoKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgdXNlciBtZXNzYWdlXG4gICAgICBjb25zdCB1c2VyTWVzc2FnZUlkID0gdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpO1xuICAgICAgY29uc3QgdXNlck1lc3NhZ2U6IENoYXRNZXNzYWdlID0ge1xuICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgY29udGVudCxcbiAgICAgICAgbWVzc2FnZV9pZDogdXNlck1lc3NhZ2VJZCxcbiAgICAgIH07XG5cbiAgICAgIC8vIE1vZGlmeSB0aGUgbW9kZWwgSUQgaWYgd2ViIHNlYXJjaCBpcyBlbmFibGVkXG4gICAgICBjb25zdCBtb2RlbElkID0gdGhpcy53ZWJTZWFyY2hFbmFibGVkXG4gICAgICAgID8gYCR7dGhpcy5nZXRTZWxlY3RlZE1vZGVsSWQoKX06b25saW5lYFxuICAgICAgICA6IHRoaXMuZ2V0U2VsZWN0ZWRNb2RlbElkKCk7XG5cbiAgICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2UgYW5kIHByZXBhcmUgZm9yIGFzc2lzdGFudCByZXNwb25zZVxuICAgICAgYXdhaXQgdGhpcy5vbk1lc3NhZ2VTdWJtaXQodXNlck1lc3NhZ2UpO1xuXG4gICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgIC8vIFByZXBhcmUgYXNzaXN0YW50IG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICBjb25zdCB7IG1lc3NhZ2VFbCwgY29udGVudEVsIH0gPSB0aGlzLmNyZWF0ZUFzc2lzdGFudE1lc3NhZ2VDb250YWluZXIoKTtcbiAgICAgIG1lc3NhZ2VFbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLW1lc3NhZ2UtaWRcIiwgdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpKTtcbiAgICAgIG1lc3NhZ2VFbC5hcHBlbmRDaGlsZChjb250ZW50RWwpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHJlc3BvbnNlIGhhbmRsaW5nXG4gICAgICBsZXQgZnVsbFJlc3BvbnNlID0gXCJcIjtcbiAgICAgIGxldCBhY2N1bXVsYXRlZFJlYXNvbmluZyA9IFwiXCI7XG4gICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuXG4gICAgICBjb25zdCBsb2FkaW5nRWwgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJzcGFuXCIsIHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIsXG4gICAgICAgIHRleHQ6IFwiIFx1MjVDRiBUaGlua2luZy4uLlwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCB0byBET00gYW5kIHNjcm9sbFxuICAgICAgdGhpcy5jaGF0Q29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VFbCk7XG4gICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnNjcm9sbFRvQm90dG9tKCk7XG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgYWJvcnQgY29udHJvbGxlciBmb3IgdGhpcyByZXF1ZXN0XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcblxuICAgICAgLy8gR2V0IHN5c3RlbSBwcm9tcHQgaW5mb1xuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gdGhpcy5nZXRTeXN0ZW1Qcm9tcHQoKTtcblxuICAgICAgLy8gU3RyZWFtIHRoZSByZXNwb25zZVxuICAgICAgdHJ5IHtcbiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiB0aGlzLmFpU2VydmljZS5zdHJlYW1NZXNzYWdlKHtcbiAgICAgICAgICBtZXNzYWdlczogdGhpcy5nZXRNZXNzYWdlcygpLFxuICAgICAgICAgIG1vZGVsOiBtb2RlbElkLFxuICAgICAgICAgIGNvbnRleHRGaWxlczogdGhpcy5nZXRDb250ZXh0RmlsZXMoKSxcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRUeXBlOiBzeXN0ZW1Qcm9tcHQudHlwZSxcbiAgICAgICAgICBzeXN0ZW1Qcm9tcHRQYXRoOiBzeXN0ZW1Qcm9tcHQucGF0aCxcbiAgICAgICAgICBzaWduYWw6IHRoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbCxcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICBpZiAoIWZ1bGxSZXNwb25zZSkge1xuICAgICAgICAgICAgbG9hZGluZ0VsLnRleHRDb250ZW50ID0gXCIgXHUyNUNGIEdlbmVyYXRpbmcuLi5cIjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBIYW5kbGUgY29udGVudCBhbmQgcmVhc29uaW5nIGNodW5rc1xuICAgICAgICAgIGlmIChjaHVuay5jb250ZW50KSB7XG4gICAgICAgICAgICBmdWxsUmVzcG9uc2UgKz0gY2h1bmsuY29udGVudDtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2NoZWR1bGVSZW5kZXIoZnVsbFJlc3BvbnNlLCBjb250ZW50RWwpO1xuICAgICAgICAgICAgY29udGVudEVsLmFwcGVuZENoaWxkKGxvYWRpbmdFbCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNodW5rLnJlYXNvbmluZykge1xuICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmcgKz0gY2h1bmsucmVhc29uaW5nO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIudXBkYXRlUmVhc29uaW5nQ29udGVudChcbiAgICAgICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgICAgICBhY2N1bXVsYXRlZFJlYXNvbmluZ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBFbnN1cmUgcHJvcGVyIHNjcm9sbCBhZnRlciBlYWNoIGNodW5rXG4gICAgICAgICAgdGhpcy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmFsaXplIGFzc2lzdGFudCByZXNwb25zZVxuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGxvYWRpbmdFbC5yZW1vdmUoKTtcblxuICAgICAgICAvLyBVcGRhdGUgcmVhc29uaW5nIG9uZSBmaW5hbCB0aW1lIHdpdGggaXNDb21wbGV0ZT10cnVlIHRvIHRyaWdnZXIgYXV0by1jb2xsYXBzZVxuICAgICAgICBpZiAoYWNjdW11bGF0ZWRSZWFzb25pbmcpIHtcbiAgICAgICAgICB0aGlzLm1lc3NhZ2VSZW5kZXJlci51cGRhdGVSZWFzb25pbmdDb250ZW50KFxuICAgICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgICAgYWNjdW11bGF0ZWRSZWFzb25pbmcsXG4gICAgICAgICAgICB0cnVlIC8vIE1hcmsgYXMgY29tcGxldGUgdG8gdHJpZ2dlciBhdXRvLWNvbGxhcHNlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFzc2lzdGFudE1lc3NhZ2U6IENoYXRNZXNzYWdlID0ge1xuICAgICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgICAgY29udGVudDogZnVsbFJlc3BvbnNlLFxuICAgICAgICAgIG1lc3NhZ2VfaWQ6XG4gICAgICAgICAgICBtZXNzYWdlRWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1tZXNzYWdlLWlkXCIpIHx8XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlTWVzc2FnZUlkKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgYXdhaXQgdGhpcy5vbkFzc2lzdGFudFJlc3BvbnNlKGFzc2lzdGFudE1lc3NhZ2UpO1xuXG4gICAgICAgIC8vIEFkZCBtZXNzYWdlIHRvb2xiYXIgYWZ0ZXIgcmVzcG9uc2UgaXMgY29tcGxldGVcbiAgICAgICAgdGhpcy5tZXNzYWdlUmVuZGVyZXIuYWRkTWVzc2FnZUJ1dHRvblRvb2xiYXIoXG4gICAgICAgICAgbWVzc2FnZUVsLFxuICAgICAgICAgIGZ1bGxSZXNwb25zZSxcbiAgICAgICAgICBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIGFzc2lzdGFudE1lc3NhZ2UubWVzc2FnZV9pZFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEZpbmFsIHNjcm9sbCB0byBib3R0b20gYWZ0ZXIgdG9vbGJhciBpcyBhZGRlZFxuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcblxuICAgICAgICAvLyBIYW5kbGUgbWVzc2FnZSB0b29sYmFyIGV2ZW50c1xuICAgICAgICBtZXNzYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImRlbGV0ZVwiLCBhc3luYyAoZTogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgICAgICBjb25zdCB7IG1lc3NhZ2VJZCB9ID0gZS5kZXRhaWw7XG4gICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLmdldE1lc3NhZ2VzKCk7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBtZXNzYWdlcy5maW5kSW5kZXgoXG4gICAgICAgICAgICAobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBtZXNzYWdlRWwucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGxvYWRpbmdFbC5yZW1vdmUoKTtcbiAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuXG4gICAgICAgIC8vIExvZyBhbGwgZXJyb3JzIHRvIGNvbnNvbGUgZmlyc3RcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNoYXQgbWVzc2FnZSBlcnJvcjpcIiwge1xuICAgICAgICAgIGVycm9yLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZW1vdmUgZXJyb3IgZmlsdGVyaW5nIC0gYWx3YXlzIHNob3cgZXJyb3JzXG4gICAgICAgIHRoaXMub25FcnJvcihlcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICB0aGlzLmlzR2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMudXBkYXRlR2VuZXJhdGluZ1N0YXRlKCk7XG4gICAgICAgIC8vIEZvY3VzIGlucHV0IGFmdGVyIGl0J3MgcmUtZW5hYmxlZFxuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIExvZyBvdXRlciBlcnJvciBhcyB3ZWxsXG4gICAgICBjb25zb2xlLmVycm9yKFwiT3V0ZXIgbWVzc2FnZSBoYW5kbGluZyBlcnJvcjpcIiwge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmFib3J0Q29udHJvbGxlciA9IG51bGw7XG4gICAgICB0aGlzLnVwZGF0ZUdlbmVyYXRpbmdTdGF0ZSgpO1xuICAgICAgLy8gRm9jdXMgaW5wdXQgYWZ0ZXIgaXQncyByZS1lbmFibGVkXG4gICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB0aGlzLm9uRXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlTWljQ2xpY2soKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nKSByZXR1cm47XG4gICAgdGhpcy50b2dnbGVSZWNvcmRpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdG9nZ2xlUmVjb3JkaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucmVjb3JkZXJTZXJ2aWNlLnRvZ2dsZVJlY29yZGluZygpO1xuICAgIC8vIEtlZXAgZm9jdXMvY3Vyc29yIGluIGNoYXRcbiAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVBhc3RlKGU6IENsaXBib2FyZEV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZHQgPSBlLmNsaXBib2FyZERhdGE7XG4gICAgaWYgKCFkdCkgcmV0dXJuO1xuXG4gICAgLy8gUmV0cmlldmUgYW55IHBsYWluIHRleHRcbiAgICBjb25zdCBwYXN0ZWRUZXh0ID0gZHQuZ2V0RGF0YShcInRleHQvcGxhaW5cIikgPz8gXCJcIjtcblxuICAgIC8vIFJldHJpZXZlIGZpbGVzXG4gICAgY29uc3QgYWxsRmlsZXMgPSBBcnJheS5mcm9tKGR0LmZpbGVzKTtcblxuICAgIC8vIElmIHdlIGhhdmUgbm8gZmlsZXMgYnV0IGRvIGhhdmUgdGV4dCwgbGV0IHRoZSBub3JtYWwgcGFzdGUgaGFwcGVuXG4gICAgaWYgKCFhbGxGaWxlcy5sZW5ndGggJiYgcGFzdGVkVGV4dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHdlIGhhdmUgZmlsZXMgKGFuZCBwb3NzaWJseSBhbHNvIHRleHQpLCBwcmV2ZW50IGRlZmF1bHQgc28gd2UgY2FuIGhhbmRsZSB0aGVtXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgaWYgKCFhbGxGaWxlcy5sZW5ndGgpIHtcbiAgICAgIC8vIElmIG5vIGZpbGVzIGF0IGFsbCwgYnV0IGNvZGUgaGFzIG5vdCByZXR1cm5lZCB5ZXQsIGl0IG1lYW5zIHRoZXJlJ3Mgbm8gdGV4dCBlaXRoZXJcbiAgICAgIC8vIEp1c3QgcmV0dXJuIHNvIHdlIGRvbid0IGJyZWFrIGRlZmF1bHQgYmVoYXZpb3IgaW4gYSBjb3JuZXIgY2FzZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgYWxsIGZpbGVzIGluIHRoZSBjbGlwYm9hcmRcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgYWxsRmlsZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIERlcml2ZSBleHRlbnNpb24gZnJvbSBmaWxlbmFtZSBvciBNSU1FIHR5cGVcbiAgICAgICAgbGV0IGV4dGVuc2lvbiA9IFwiYmluXCI7XG4gICAgICAgIGlmIChmaWxlLm5hbWUgJiYgZmlsZS5uYW1lLmluY2x1ZGVzKFwiLlwiKSkge1xuICAgICAgICAgIGNvbnN0IGRvdElkeCA9IGZpbGUubmFtZS5sYXN0SW5kZXhPZihcIi5cIik7XG4gICAgICAgICAgaWYgKGRvdElkeCA+PSAwKSB7XG4gICAgICAgICAgICBleHRlbnNpb24gPSBmaWxlLm5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZpbGUudHlwZSkge1xuICAgICAgICAgIGNvbnN0IG1pbWVQYXJ0cyA9IGZpbGUudHlwZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgaWYgKG1pbWVQYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgIGV4dGVuc2lvbiA9IG1pbWVQYXJ0c1sxXS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XS9nLCBcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCdWlsZCBhIHRpbWVzdGFtcC1iYXNlZCBmaWxlIG5hbWVcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaXNvU3RyaW5nID0gbm93LnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvWzouXS9nLCBcIi1cIik7XG4gICAgICAgIGNvbnN0IG5ld0ZpbGVOYW1lID0gYHBhc3RlZC0ke2lzb1N0cmluZ30uJHtleHRlbnNpb259YDtcblxuICAgICAgICAvLyBSZWFkIHRoZSBjbGlwYm9hcmQgZmlsZSBhcyBiaW5hcnlcbiAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIGF0dGFjaG1lbnRzIHBhdGggZnJvbSBwbHVnaW4gc2V0dGluZ3NcbiAgICAgICAgY29uc3QgYXR0YWNobWVudHNEaXIgPVxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF0dGFjaG1lbnRzRGlyZWN0b3J5IHx8IFwiQXR0YWNobWVudHNcIjtcbiAgICAgICAgY29uc3QgZmluYWxQYXRoID0gYCR7YXR0YWNobWVudHNEaXJ9LyR7bmV3RmlsZU5hbWV9YDtcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVEaXJlY3RvcnlFeGlzdHMoYXR0YWNobWVudHNEaXIpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZmlsZSBpbiB0aGUgdmF1bHRcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlQmluYXJ5KGZpbmFsUGF0aCwgYXJyYXlCdWZmZXIpO1xuXG4gICAgICAgIC8vIEF0dGVtcHQgdG8gbG9hZCB0aGUgbmV3bHkgY3JlYXRlZCBmaWxlXG4gICAgICAgIGNvbnN0IGNyZWF0ZWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbmFsUGF0aCk7XG4gICAgICAgIGlmIChjcmVhdGVkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgLy8gQWRkIHRvIHRoaXMgY2hhdCdzIGNvbnRleHRcbiAgICAgICAgICBhd2FpdCB0aGlzLmNoYXRWaWV3LmFkZEZpbGVUb0NvbnRleHQoY3JlYXRlZEZpbGUpO1xuICAgICAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgICAgICBgUGFzdGVkIGZpbGUgc2F2ZWQgJiBhZGRlZCB0byBjb250ZXh0OiAke2NyZWF0ZWRGaWxlLm5hbWV9YFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvY2F0ZSBwYXN0ZWQgZmlsZSBpbiB2YXVsdC5cIik7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaGFuZGxpbmcgcGFzdGVkIGZpbGU6XCIsIGVycik7XG4gICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBoYW5kbGUgcGFzdGVkIGZpbGU6ICR7ZXJyfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZpbmFsbHksIGlmIHRoZXJlJ3MgYWxzbyB0ZXh0IGluIHRoZSBzYW1lIHBhc3RlIGV2ZW50LCBpbnNlcnQgdGhhdCBhZnRlciBmaWxlIGhhbmRsaW5nXG4gICAgaWYgKHBhc3RlZFRleHQpIHtcbiAgICAgIHRoaXMuaW5zZXJ0VGV4dEF0Q3Vyc29yKHBhc3RlZFRleHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVNlbmRNZXNzYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVJbWFnZVBhc3RlKGNsaXBib2FyZERhdGE6IERhdGFUcmFuc2Zlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZmlsZSA9IGNsaXBib2FyZERhdGEuZmlsZXNbMF07XG4gICAgaWYgKCFmaWxlIHx8ICFmaWxlLnR5cGUuc3RhcnRzV2l0aChcImltYWdlL1wiKSkge1xuICAgICAgdGhyb3cgbmV3IFN5c3RlbVNjdWxwdEVycm9yKFxuICAgICAgICBcIk5vIGltYWdlIGluIGNsaXBib2FyZFwiLFxuICAgICAgICBFUlJPUl9DT0RFUy5OT19JTUFHRSxcbiAgICAgICAgNDAwXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGJhc2U2NCA9IGF3YWl0IEltYWdlUHJvY2Vzc29yLnByb2Nlc3NDbGlwYm9hcmRJbWFnZShjbGlwYm9hcmREYXRhKTtcbiAgICByZXR1cm4gYmFzZTY0O1xuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3RJbnB1dEhlaWdodCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQpIHJldHVybjtcblxuICAgIHRoaXMuaW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gICAgY29uc3QgbmV3SGVpZ2h0ID0gTWF0aC5taW4oTWF0aC5tYXgodGhpcy5pbnB1dC5zY3JvbGxIZWlnaHQsIDQ4KSwgMjAwKTsgLy8gTWluIDQ4cHgsIG1heCAyMDBweFxuICAgIHRoaXMuaW5wdXQuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0ICsgXCJweFwiO1xuICB9XG5cbiAgcHVibGljIGZvY3VzKCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnB1dCBlbGVtZW50IG5vdCBmb3VuZCBpbiBzZXRWYWx1ZVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gU2V0IHRoZSB2YWx1ZSBkaXJlY3RseVxuICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHZhbHVlO1xuXG4gICAgICAvLyBUcmlnZ2VyIGlucHV0IGV2ZW50IGZvciBhbnkgbGlzdGVuZXJzXG4gICAgICBjb25zdCBpbnB1dEV2ZW50ID0gbmV3IEV2ZW50KFwiaW5wdXRcIiwge1xuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICBjYW5jZWxhYmxlOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICB0aGlzLmlucHV0LmRpc3BhdGNoRXZlbnQoaW5wdXRFdmVudCk7XG5cbiAgICAgIC8vIEFkanVzdCBoZWlnaHQgYWZ0ZXIgdmFsdWUgaXMgc2V0XG4gICAgICB0aGlzLmFkanVzdElucHV0SGVpZ2h0KCk7XG5cbiAgICAgIC8vIEZvY3VzIHRoZSBpbnB1dCBhbmQgbW92ZSBjdXJzb3IgdG8gZW5kXG4gICAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gICAgICB0aGlzLmlucHV0LnNldFNlbGVjdGlvblJhbmdlKHZhbHVlLmxlbmd0aCwgdmFsdWUubGVuZ3RoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIHNldFZhbHVlOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIEZhaWxlZCB0byBzZXQgaW5wdXQgdmFsdWVcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVubG9hZCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yZW5kZXJUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5yZW5kZXJUaW1lb3V0KTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHJlY29yZGVyIHNlcnZpY2UgY2xlYW51cFxuICAgIHRoaXMucmVjb3JkZXJTZXJ2aWNlLnNldFZpc3VhbGl6ZXJDYW52YXMobnVsbCk7XG4gICAgaWYgKHRoaXMucmVjb3JkZXJWaXN1YWxpemVyKSB7XG4gICAgICB0aGlzLnJlY29yZGVyVmlzdWFsaXplci5yZW1vdmUoKTtcbiAgICAgIHRoaXMucmVjb3JkZXJWaXN1YWxpemVyID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWVzc2FnZUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCAoYykgPT4ge1xuICAgICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMDtcbiAgICAgIGNvbnN0IHYgPSBjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDg7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUFzc2lzdGFudE1lc3NhZ2VDb250YWluZXIoKToge1xuICAgIG1lc3NhZ2VFbDogSFRNTEVsZW1lbnQ7XG4gICAgY29udGVudEVsOiBIVE1MRWxlbWVudDtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2VFbDogY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tZXNzYWdlIHN5c3RlbXNjdWxwdC1hc3Npc3RhbnQtbWVzc2FnZVwiLFxuICAgICAgfSksXG4gICAgICBjb250ZW50RWw6IGNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIgfSksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2NoZWR1bGVSZW5kZXIoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5yZW5kZXJUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5yZW5kZXJUaW1lb3V0KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBoZWlnaHRcbiAgICBjb25zdCBjdXJyZW50SGVpZ2h0ID0gY29udGFpbmVyRWwub2Zmc2V0SGVpZ2h0O1xuXG4gICAgLy8gVXBkYXRlIHRleHQgaW4gYSB0ZW1wb3JhcnkgY29udGFpbmVyIHRvIGNoZWNrIGhlaWdodFxuICAgIGNvbnN0IHRlbXBDb250YWluZXIgPVxuICAgICAgKGNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC10ZXh0XCIpIGFzIEhUTUxFbGVtZW50KSB8fFxuICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwidGVtcC10ZXh0XCIgfSk7XG4gICAgdGVtcENvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICB0ZW1wQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHRlbXBDb250YWluZXIuc3R5bGUud2lkdGggPSBjb250YWluZXJFbC5vZmZzZXRXaWR0aCArIFwicHhcIjtcbiAgICBhd2FpdCB0aGlzLm1lc3NhZ2VSZW5kZXJlci5yZW5kZXJNYXJrZG93bkNvbnRlbnQoY29udGVudCwgdGVtcENvbnRhaW5lcik7XG5cbiAgICAvLyBJZiBoZWlnaHQgY2hhbmdlZCwgZG8gYSBmdWxsIHJlbmRlclxuICAgIGlmIChjdXJyZW50SGVpZ2h0ICE9PSB0ZW1wQ29udGFpbmVyLm9mZnNldEhlaWdodCkge1xuICAgICAgYXdhaXQgdGhpcy5tZXNzYWdlUmVuZGVyZXIucmVuZGVyTWFya2Rvd25Db250ZW50KGNvbnRlbnQsIGNvbnRhaW5lckVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3RoZXJ3aXNlIGp1c3QgdXBkYXRlIHRoZSB2aXNpYmxlIHRleHRcbiAgICAgIGNvbnN0IGxhc3RDaGlsZCA9IGNvbnRhaW5lckVsLmxhc3RDaGlsZDtcbiAgICAgIGlmIChsYXN0Q2hpbGQgJiYgbGFzdENoaWxkLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xuICAgICAgICBsYXN0Q2hpbGQudGV4dENvbnRlbnQgPSBjb250ZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29udGVudCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFuIHVwXG4gICAgdGVtcENvbnRhaW5lci5yZW1vdmUoKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZURvY3VtZW50VXBsb2FkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB1c2VyIGhhcyBhIHZhbGlkIGxpY2Vuc2Uga2V5XG4gICAgICBpZiAoXG4gICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5Py50cmltKCkgfHxcbiAgICAgICAgIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZFxuICAgICAgKSB7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICBcIlVwbG9hZCBhbmQgcHJvY2VzcyBkb2N1bWVudHMgZGlyZWN0bHkgaW4geW91ciBjaGF0IGNvbnZlcnNhdGlvbnMuIFN5c3RlbVNjdWxwdCB3aWxsIGF1dG9tYXRpY2FsbHkgZXh0cmFjdCBhbmQgYW5hbHl6ZSB0aGUgY29udGVudC5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJQcm8gRmVhdHVyZSAtIERvY3VtZW50IFByb2Nlc3NpbmdcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIlN1cHBvcnQgU3lzdGVtU2N1bHB0J3MgZGV2ZWxvcG1lbnQgYW5kIHVubG9jayBkb2N1bWVudCBwcm9jZXNzaW5nLCBhbmFseXNpcywgYW5kIG90aGVyIHByZW1pdW0gZmVhdHVyZXMgYnkgYmVjb21pbmcgYSBQYXRyZW9uIG1lbWJlciFcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsXG4gICAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiTWF5YmUgTGF0ZXJcIixcbiAgICAgICAgICB9XG4gICAgICAgICkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBEb3VibGUgY2hlY2sgbGljZW5zZSBpcyBzdGlsbCB2YWxpZCB3aXRoIHNlcnZlclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHRoaXMucGx1Z2luXG4gICAgICAgIC5nZXRMaWNlbnNlTWFuYWdlcigpXG4gICAgICAgIC52YWxpZGF0ZUxpY2Vuc2VLZXkodHJ1ZSk7XG4gICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkID0gZmFsc2U7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICBhd2FpdCBzaG93UG9wdXAoXG4gICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgXCJZb3VyIGxpY2Vuc2UgYXBwZWFycyB0byBiZSBpbnZhbGlkLiBQbGVhc2UgY2hlY2sgeW91ciBsaWNlbnNlIGtleSBpbiBzZXR0aW5ncy5cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogXCJMaWNlbnNlIEludmFsaWRcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gTm93IHByb2NlZWQgd2l0aCBkb2N1bWVudCB1cGxvYWRcbiAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKTtcbiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgIG5ldyBOb3RpY2UoXCJObyBmaWxlcyBmb3VuZCB0byB1cGxvYWQuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpcnN0RmlsZSA9IGZpbGVzWzBdO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5haVNlcnZpY2UudXBsb2FkRG9jdW1lbnQoZmlyc3RGaWxlKTtcbiAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgIGBVcGxvYWRlZCBkb2MuIElEOiAke3Jlc3VsdC5kb2N1bWVudElkfSwgc3RhdHVzOiAke3Jlc3VsdC5zdGF0dXN9YFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIDQwMS80MDMgZXJyb3JzIGdyYWNlZnVsbHlcbiAgICAgIGlmIChlcnJvcj8uc3RhdHVzQ29kZSA9PT0gNDAxIHx8IGVycm9yPy5zdGF0dXNDb2RlID09PSA0MDMpIHtcbiAgICAgICAgYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIFwiVXBsb2FkIGFuZCBwcm9jZXNzIGRvY3VtZW50cyBkaXJlY3RseSBpbiB5b3VyIGNoYXQgY29udmVyc2F0aW9ucy4gU3lzdGVtU2N1bHB0IHdpbGwgYXV0b21hdGljYWxseSBleHRyYWN0IGFuZCBhbmFseXplIHRoZSBjb250ZW50LlwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIlBybyBGZWF0dXJlIC0gRG9jdW1lbnQgUHJvY2Vzc2luZ1wiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICAgIFwiRG9jdW1lbnQgcHJvY2Vzc2luZyByZXF1aXJlcyBhbiBhY3RpdmUgUHJvIHN1YnNjcmlwdGlvbi4gU3VwcG9ydCBTeXN0ZW1TY3VscHQncyBkZXZlbG9wbWVudCBieSBiZWNvbWluZyBhIFBhdHJlb24gbWVtYmVyIVwiLFxuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJCZWNvbWUgYSBQYXRyb25cIixcbiAgICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiLFxuICAgICAgICAgIH1cbiAgICAgICAgKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0Py5jb25maXJtZWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBvdGhlciBlcnJvcnNcbiAgICAgIG5ldyBOb3RpY2UoYEVycm9yIHVwbG9hZGluZyBkb2M6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnRUZXh0QXRDdXJzb3IodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgY3Vyc29yUG9zID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlO1xuXG4gICAgaWYgKGN1cnNvclBvcyAhPT0gbnVsbCkge1xuICAgICAgLy8gSW5zZXJ0IGF0IGN1cnNvciBwb3NpdGlvblxuICAgICAgY29uc3QgbmV3VmFsdWUgPVxuICAgICAgICBjdXJyZW50VmFsdWUuc2xpY2UoMCwgY3Vyc29yUG9zKSArIHRleHQgKyBjdXJyZW50VmFsdWUuc2xpY2UoY3Vyc29yUG9zKTtcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgIC8vIE1vdmUgY3Vyc29yIHRvIGVuZCBvZiBpbnNlcnRlZCB0ZXh0XG4gICAgICB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25FbmQgPVxuICAgICAgICBjdXJzb3JQb3MgKyB0ZXh0Lmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXBwZW5kIHRvIGVuZCBpZiBubyBjdXJzb3IgcG9zaXRpb25cbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsdWUgKyB0ZXh0O1xuICAgICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uRW5kID1cbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gVHJpZ2dlciBpbnB1dCBldmVudCBmb3IgaGVpZ2h0IGFkanVzdG1lbnRcbiAgICB0aGlzLmlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIikpO1xuXG4gICAgLy8gRm9jdXMgdGhlIGlucHV0IGFmdGVyIGluc2VydGlvblxuICAgIHRoaXMuaW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlV2ViU2VhcmNoQnV0dG9uU3RhdGUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLndlYlNlYXJjaEJ1dHRvbikgcmV0dXJuO1xuXG4gICAgY29uc3QgaXNOYXRpdmVQcm92aWRlciA9XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVQcm92aWRlci50eXBlID09PSBcIm5hdGl2ZVwiO1xuICAgIGNvbnN0IGN1cnJlbnRQcm92aWRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVByb3ZpZGVycy5maW5kKFxuICAgICAgKHApID0+IHAuaWQgPT09IHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZVByb3ZpZGVyLmlkXG4gICAgKTtcbiAgICBjb25zdCBpc09wZW5Sb3V0ZXIgPSBjdXJyZW50UHJvdmlkZXI/LmVuZHBvaW50LmluY2x1ZGVzKFwib3BlbnJvdXRlci5haVwiKTtcblxuICAgIGNvbnN0IHdlYlNlYXJjaEFsbG93ZWQgPSBpc05hdGl2ZVByb3ZpZGVyIHx8IGlzT3BlblJvdXRlcjtcblxuICAgIC8vIFJlc2V0IHdlYiBzZWFyY2ggc3RhdGUgaWYgaXQgd2FzIGVuYWJsZWQgYnV0IGlzIG5vIGxvbmdlciBhbGxvd2VkXG4gICAgaWYgKCF3ZWJTZWFyY2hBbGxvd2VkICYmIHRoaXMud2ViU2VhcmNoRW5hYmxlZCkge1xuICAgICAgdGhpcy53ZWJTZWFyY2hFbmFibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLndlYlNlYXJjaEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiaXMtZW5hYmxlZFwiKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgYnV0dG9uIHN0YXRlXG4gICAgdGhpcy53ZWJTZWFyY2hCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsICF3ZWJTZWFyY2hBbGxvd2VkKTtcbiAgICB0aGlzLndlYlNlYXJjaEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXG4gICAgICBcImFyaWEtZGlzYWJsZWRcIixcbiAgICAgICghd2ViU2VhcmNoQWxsb3dlZCkudG9TdHJpbmcoKVxuICAgICk7XG4gIH1cblxuICAvLyBDYWxsIHRoaXMgd2hlbiBtb2RlbCBjaGFuZ2VzXG4gIHB1YmxpYyBvbk1vZGVsQ2hhbmdlKCk6IHZvaWQge1xuICAgIHRoaXMudXBkYXRlV2ViU2VhcmNoQnV0dG9uU3RhdGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlRGlyZWN0b3J5RXhpc3RzKGRpclBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLm1rZGlyKGRpclBhdGgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZXhpc3RzXCIpKSB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi9DaGF0Vmlld1wiO1xuaW1wb3J0IHsgQ2hhdFJvbGUsIE11bHRpUGFydENvbnRlbnQgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNvbnN0IG1lc3NhZ2VIYW5kbGluZyA9IHtcbiAgYWRkTWVzc2FnZTogYXN5bmMgZnVuY3Rpb24oY2hhdFZpZXc6IENoYXRWaWV3LCByb2xlOiBDaGF0Um9sZSwgY29udGVudDogc3RyaW5nIHwgTXVsdGlQYXJ0Q29udGVudFtdLCBleGlzdGluZ01lc3NhZ2VJZD86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1lc3NhZ2VJZCA9IGV4aXN0aW5nTWVzc2FnZUlkIHx8IGNoYXRWaWV3LmdlbmVyYXRlTWVzc2FnZUlkKCk7XG4gICAgY29uc3QgeyBtZXNzYWdlRWwsIGNvbnRlbnRFbCB9ID0gYXdhaXQgY2hhdFZpZXcubWVzc2FnZVJlbmRlcmVyLnJlbmRlck1lc3NhZ2UoeyBhcHA6IGNoYXRWaWV3LmFwcCwgbWVzc2FnZUlkLCByb2xlLCBjb250ZW50IH0pO1xuXG4gICAgY29uc3QgY29udGVudFN0ciA9IHR5cGVvZiBjb250ZW50ID09PSBcInN0cmluZ1wiID8gY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQpO1xuICAgIG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgPSBjb250ZW50U3RyO1xuXG4gICAgY2hhdFZpZXcubWVzc2FnZVJlbmRlcmVyLmFkZE1lc3NhZ2VCdXR0b25Ub29sYmFyKG1lc3NhZ2VFbCwgY29udGVudFN0ciwgcm9sZSwgbWVzc2FnZUlkKTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwicmVzdWJtaXRcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG1lc3NhZ2VJZCwgY29udGVudCB9ID0gZS5kZXRhaWw7XG4gICAgICBjb25zdCBpbmRleCA9IGNoYXRWaWV3Lm1lc3NhZ2VzLmZpbmRJbmRleCgobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgY2hhdFZpZXcubWVzc2FnZXMuc3BsaWNlKGluZGV4KTtcbiAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2F2ZUNoYXQoKTtcbiAgICAgICAgY2hhdFZpZXcuY2hhdENvbnRhaW5lci5lbXB0eSgpO1xuICAgICAgICBmb3IgKGNvbnN0IG1zZyBvZiBjaGF0Vmlldy5tZXNzYWdlcykge1xuICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LmFkZE1lc3NhZ2UobXNnLnJvbGUsIG1zZy5jb250ZW50LCBtc2cubWVzc2FnZV9pZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2hhdFZpZXcuaW5wdXRIYW5kbGVyLnNldFZhbHVlKGNvbnRlbnQpO1xuICAgICAgICBjaGF0Vmlldy5pbnB1dEhhbmRsZXIuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG1lc3NhZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiZWRpdFwiLCBhc3luYyAoZTogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHsgbWVzc2FnZUlkLCBvbGRDb250ZW50LCBuZXdDb250ZW50IH0gPSBlLmRldGFpbDtcbiAgICAgIGNvbnN0IGluZGV4ID0gY2hhdFZpZXcubWVzc2FnZXMuZmluZEluZGV4KChtc2cpID0+IG1zZy5tZXNzYWdlX2lkID09PSBtZXNzYWdlSWQpO1xuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICBjaGF0Vmlldy5tZXNzYWdlc1tpbmRleF0uY29udGVudCA9IG5ld0NvbnRlbnQ7XG4gICAgICAgIGF3YWl0IGNoYXRWaWV3LnNhdmVDaGF0KCk7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsOiBuZXdDb250ZW50RWwgfSA9IGF3YWl0IGNoYXRWaWV3Lm1lc3NhZ2VSZW5kZXJlci5yZW5kZXJNZXNzYWdlKHtcbiAgICAgICAgICBhcHA6IGNoYXRWaWV3LmFwcCxcbiAgICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgICAgcm9sZTogY2hhdFZpZXcubWVzc2FnZXNbaW5kZXhdLnJvbGUsXG4gICAgICAgICAgY29udGVudDogY2hhdFZpZXcubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBvbGRDb250ZW50RWwgPSBtZXNzYWdlRWwucXVlcnlTZWxlY3RvcihcIi5zeXN0ZW1zY3VscHQtbWVzc2FnZS1jb250ZW50XCIpO1xuICAgICAgICBpZiAob2xkQ29udGVudEVsICYmIG5ld0NvbnRlbnRFbCkge1xuICAgICAgICAgIG9sZENvbnRlbnRFbC5yZXBsYWNlV2l0aChuZXdDb250ZW50RWwpO1xuICAgICAgICAgIGNoYXRWaWV3Lm1lc3NhZ2VSZW5kZXJlci5zZXR1cEltYWdlSGFuZGxlcnMobmV3Q29udGVudEVsKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGRhdGVkU3RyID0gdHlwZW9mIGNoYXRWaWV3Lm1lc3NhZ2VzW2luZGV4XS5jb250ZW50ID09PSBcInN0cmluZ1wiID8gY2hhdFZpZXcubWVzc2FnZXNbaW5kZXhdLmNvbnRlbnQgOiBKU09OLnN0cmluZ2lmeShjaGF0Vmlldy5tZXNzYWdlc1tpbmRleF0uY29udGVudCk7XG4gICAgICAgIG1lc3NhZ2VFbC5kYXRhc2V0LmNvbnRlbnQgPSB1cGRhdGVkU3RyO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWVzc2FnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJkZWxldGVcIiwgYXN5bmMgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG1lc3NhZ2VJZCB9ID0gZS5kZXRhaWw7XG4gICAgICBjb25zdCBpbmRleCA9IGNoYXRWaWV3Lm1lc3NhZ2VzLmZpbmRJbmRleCgobXNnKSA9PiBtc2cubWVzc2FnZV9pZCA9PT0gbWVzc2FnZUlkKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgY2hhdFZpZXcubWVzc2FnZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2F2ZUNoYXQoKTtcbiAgICAgICAgbWVzc2FnZUVsLnJlbW92ZSgpO1xuICAgICAgICBjaGF0Vmlldy5zY3JvbGxNYW5hZ2VyLnVwZGF0ZUNvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgY2hhdFZpZXcuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY2hhdFZpZXcuY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWwpO1xuICAgIGNoYXRWaWV3LnNjcm9sbE1hbmFnZXIudXBkYXRlQ29udGVudEhlaWdodCgpO1xuICAgIGNoYXRWaWV3LnNjcm9sbE1hbmFnZXIuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgfSxcblxuICBsb2FkTWVzc2FnZXM6IGFzeW5jIGZ1bmN0aW9uKGNoYXRWaWV3OiBDaGF0Vmlldyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghY2hhdFZpZXcuY2hhdENvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgY29uc3Qgc2Nyb2xsVG9wID0gY2hhdFZpZXcuY2hhdENvbnRhaW5lci5zY3JvbGxUb3A7XG4gICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gY2hhdFZpZXcuY2hhdENvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgY29uc3QgY2xpZW50SGVpZ2h0ID0gY2hhdFZpZXcuY2hhdENvbnRhaW5lci5jbGllbnRIZWlnaHQ7XG4gICAgY29uc3Qgd2FzQXRCb3R0b20gPSBNYXRoLmFicyhzY3JvbGxIZWlnaHQgLSBzY3JvbGxUb3AgLSBjbGllbnRIZWlnaHQpIDwgMTA7XG5cbiAgICBjaGF0Vmlldy5jaGF0Q29udGFpbmVyLmVtcHR5KCk7XG4gICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIGNoYXRWaWV3Lm1lc3NhZ2VzKSB7XG4gICAgICBhd2FpdCBjaGF0Vmlldy5hZGRNZXNzYWdlKG1lc3NhZ2Uucm9sZSwgbWVzc2FnZS5jb250ZW50LCBtZXNzYWdlLm1lc3NhZ2VfaWQpO1xuICAgIH1cblxuICAgIGlmICh3YXNBdEJvdHRvbSkge1xuICAgICAgY2hhdFZpZXcuc2Nyb2xsTWFuYWdlci5zY3JvbGxUb0JvdHRvbSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGF0Vmlldy5jaGF0Q29udGFpbmVyLnNjcm9sbFRvcCA9IHNjcm9sbFRvcDtcbiAgICB9XG4gIH1cbn07IiwgImltcG9ydCB7IENoYXRWaWV3IH0gZnJvbSBcIi4vQ2hhdFZpZXdcIjtcbmltcG9ydCB7IFRGaWxlLCBURm9sZGVyIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAsIHNob3dOb3RpY2UsIHNob3dBbGVydCB9IGZyb20gXCIuLi8uLi9jb3JlL3VpL1wiO1xuaW1wb3J0IHsgUEFUUkVPTl9VUkwgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNvbnN0IGV2ZW50SGFuZGxpbmcgPSB7XG4gIHNldHVwRHJhZ0FuZERyb3A6IGZ1bmN0aW9uKGNoYXRWaWV3OiBDaGF0VmlldywgY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGNvbnN0IG92ZXJsYXkgPSBjb250YWluZXIuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwic3lzdGVtc2N1bHB0LWRyYWctb3ZlcmxheVwiIH0pO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBvdmVybGF5LmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcInN5c3RlbXNjdWxwdC1kcmFnLW1lc3NhZ2VcIiwgdGV4dDogXCJEcm9wIGZpbGVzIHRvIGFkZCB0byBjb250ZXh0XCIgfSk7XG4gICAgY29uc3QgTUFYX0ZJTEVTID0gMTAwO1xuXG4gICAgY29uc3QgcGFyc2VPYnNpZGlhblVyaSA9ICh1cmk6IHN0cmluZyk6IHN0cmluZyB8IG51bGwgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCF1cmkuc3RhcnRzV2l0aChcIm9ic2lkaWFuOi8vb3BlblwiKSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwodXJpKTtcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh1cmwuc2VhcmNoUGFyYW1zLmdldChcImZpbGVcIikgfHwgXCJcIik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbRHJhZ0Ryb3BdIEVycm9yIHBhcnNpbmcgVVJJOlwiLCB1cmksIGUpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgZ2V0RmlsZXNGcm9tRm9sZGVyID0gKGZvbGRlcjogVEZvbGRlcik6IFRGaWxlW10gPT4ge1xuICAgICAgY29uc3QgZmlsZXM6IFRGaWxlW10gPSBbXTtcbiAgICAgIGNvbnN0IHByb2Nlc3NGb2xkZXIgPSAoY3VycmVudEZvbGRlcjogVEZvbGRlcikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGN1cnJlbnRGb2xkZXIuY2hpbGRyZW4pIHtcbiAgICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURmlsZSkgZmlsZXMucHVzaChjaGlsZCk7XG4gICAgICAgICAgZWxzZSBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSBwcm9jZXNzRm9sZGVyKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHByb2Nlc3NGb2xkZXIoZm9sZGVyKTtcbiAgICAgIHJldHVybiBmaWxlcy5zbGljZSgwLCBNQVhfRklMRVMpO1xuICAgIH07XG5cbiAgICBjb25zdCBnZXRGaWxlQ291bnQgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2Zlcik6IFByb21pc2U8bnVtYmVyPiA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50Q29udGV4dFNpemUgPSBjaGF0Vmlldy5jb250ZXh0TWFuYWdlci5nZXRDb250ZXh0RmlsZXMoKS5zaXplO1xuICAgICAgaWYgKGN1cnJlbnRDb250ZXh0U2l6ZSA+PSBNQVhfRklMRVMpIHJldHVybiAwO1xuICAgICAgY29uc3QgcmVtYWluaW5nU2xvdHMgPSBNQVhfRklMRVMgLSBjdXJyZW50Q29udGV4dFNpemU7XG5cbiAgICAgIGxldCBuZXdGaWxlQ291bnQgPSAwO1xuICAgICAgbGV0IGZpbGVzVG9Qcm9jZXNzOiAoVEZpbGUgfCBURm9sZGVyKVtdID0gW107XG5cbiAgICAgIGlmIChkdC5pdGVtcyAmJiBkdC5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSkgPT4gaXRlbS5nZXRBc1N0cmluZyhyZXNvbHZlKSk7XG4gICAgICAgICAgICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoXCJcXG5cIikuZmlsdGVyKChsaW5lKSA9PiBsaW5lLnRyaW0oKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgICAgbGV0IGZpbGVQYXRoID0gbGluZTtcbiAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG4gICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoXCJvYnNpZGlhbjovL1wiKSkgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKGxpbmUpIHx8IGxpbmU7XG4gICAgICAgICAgICAgIGFic3RyYWN0RmlsZSA9IGNoYXRWaWV3LmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICBlbHNlIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICBlbHNlIGlmICghZmlsZVBhdGguaW5jbHVkZXMoXCIuXCIpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWRQYXRoID0gYCR7ZmlsZVBhdGh9Lm1kYDtcbiAgICAgICAgICAgICAgICBjb25zdCBtZEZpbGUgPSBjaGF0Vmlldy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG1kUGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKG1kRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSBmaWxlc1RvUHJvY2Vzcy5wdXNoKG1kRmlsZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGZpbGVzVG9Qcm9jZXNzKSB7XG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgVEZvbGRlcikgbmV3RmlsZUNvdW50ICs9IGdldEZpbGVzRnJvbUZvbGRlcihpdGVtKS5sZW5ndGg7XG4gICAgICAgIGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBURmlsZSkgbmV3RmlsZUNvdW50Kys7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXdGaWxlQ291bnQgPT09IDAgJiYgZHQudHlwZXMuaW5jbHVkZXMoXCJ0ZXh0L3VyaS1saXN0XCIpKSB7XG4gICAgICAgIGNvbnN0IHVyaURhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlKSA9PiBkdC5pdGVtc1sxXS5nZXRBc1N0cmluZyhyZXNvbHZlKSk7XG4gICAgICAgIGNvbnN0IHVyaXMgPSB1cmlEYXRhLnNwbGl0KFwib2JzaWRpYW46Ly9vcGVuXCIpLmZpbHRlcigodXJpKSA9PiB1cmkudHJpbSgpKS5tYXAoKHVyaSkgPT4gXCJvYnNpZGlhbjovL29wZW5cIiArIHVyaS50cmltKCkpO1xuICAgICAgICBmb3IgKGNvbnN0IHVyaSBvZiB1cmlzKSB7XG4gICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKHVyaSk7XG4gICAgICAgICAgaWYgKCFmaWxlUGF0aCkgY29udGludWU7XG4gICAgICAgICAgY29uc3QgYWJzdHJhY3RGaWxlID0gY2hhdFZpZXcuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIG5ld0ZpbGVDb3VudCArPSBnZXRGaWxlc0Zyb21Gb2xkZXIoYWJzdHJhY3RGaWxlKS5sZW5ndGg7XG4gICAgICAgICAgZWxzZSBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIG5ld0ZpbGVDb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gTWF0aC5taW4obmV3RmlsZUNvdW50LCByZW1haW5pbmdTbG90cyk7XG4gICAgfTtcblxuICAgIGNvbnN0IHVwZGF0ZU1lc3NhZ2UgPSBhc3luYyAoZHQ6IERhdGFUcmFuc2ZlcikgPT4ge1xuICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID0gY2hhdFZpZXcuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBgQ2Fubm90IGFkZCBtb3JlIGZpbGVzIChtYXggJHtNQVhfRklMRVN9IHJlYWNoZWQpYDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZmlsZUNvdW50ID0gYXdhaXQgZ2V0RmlsZUNvdW50KGR0KTtcbiAgICAgIGlmIChmaWxlQ291bnQgPiAwKSB7XG4gICAgICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBgQWRkICR7ZmlsZUNvdW50fSBmaWxlJHtmaWxlQ291bnQgPiAxID8gXCJzXCIgOiBcIlwifSB0byBjb250ZXh0ICgke2N1cnJlbnRDb250ZXh0U2l6ZSArIGZpbGVDb3VudH0vJHtNQVhfRklMRVN9IHRvdGFsKWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gYERyb3AgZmlsZXMgdG8gYWRkIHRvIGNvbnRleHQgKCR7Y3VycmVudENvbnRleHRTaXplfS8ke01BWF9GSUxFU30pYDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbGV0IGRyYWdDb3VudGVyID0gMDtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VudGVyXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZHJhZ0NvdW50ZXIrKztcbiAgICAgIGlmIChkcmFnQ291bnRlciA9PT0gMSkge1xuICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtZHJhZy1hY3RpdmVcIik7XG4gICAgICAgIGlmIChlLmRhdGFUcmFuc2ZlcikgdXBkYXRlTWVzc2FnZShlLmRhdGFUcmFuc2Zlcik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGRyYWdDb3VudGVyLS07XG4gICAgICBpZiAoZHJhZ0NvdW50ZXIgPT09IDApIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInN5c3RlbXNjdWxwdC1kcmFnLWFjdGl2ZVwiKTtcbiAgICB9KTtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIGF3YWl0IHVwZGF0ZU1lc3NhZ2UoZS5kYXRhVHJhbnNmZXIpO1xuICAgIH0pO1xuXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZHJhZ0NvdW50ZXIgPSAwO1xuICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwic3lzdGVtc2N1bHB0LWRyYWctYWN0aXZlXCIpO1xuXG4gICAgICBjb25zdCBkdCA9IGUuZGF0YVRyYW5zZmVyO1xuICAgICAgaWYgKCFkdCkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBzdGFydGluZ0NvbnRleHRTaXplID0gY2hhdFZpZXcuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgIGlmIChzdGFydGluZ0NvbnRleHRTaXplID49IE1BWF9GSUxFUykge1xuICAgICAgICBhd2FpdCBzaG93QWxlcnQoY2hhdFZpZXcuYXBwLCBgQ2Fubm90IGFkZCBtb3JlIGZpbGVzIChtYXggJHtNQVhfRklMRVN9IHJlYWNoZWQpYCwgeyB0eXBlOiBcImluZm9cIiwgaWNvbjogXCJhbGVydC10cmlhbmdsZVwiIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBmaWxlc1RvUHJvY2VzczogKFRGaWxlIHwgVEZvbGRlcilbXSA9IFtdO1xuICAgICAgICBpZiAoZHQuaXRlbXMgJiYgZHQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBBcnJheS5mcm9tKGR0Lml0ZW1zKSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUpID0+IGl0ZW0uZ2V0QXNTdHJpbmcocmVzb2x2ZSkpO1xuICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoXCJcXG5cIikuZmlsdGVyKChsaW5lKSA9PiBsaW5lLnRyaW0oKSk7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgICAgIGxldCBmaWxlUGF0aCA9IGxpbmU7XG4gICAgICAgICAgICAgICAgbGV0IGFic3RyYWN0RmlsZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcIm9ic2lkaWFuOi8vXCIpKSBmaWxlUGF0aCA9IHBhcnNlT2JzaWRpYW5VcmkobGluZSkgfHwgbGluZTtcbiAgICAgICAgICAgICAgICBhYnN0cmFjdEZpbGUgPSBjaGF0Vmlldy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikgZmlsZXNUb1Byb2Nlc3MucHVzaChhYnN0cmFjdEZpbGUpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhYnN0cmFjdEZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCByZXF1aXJlc1BybyA9IFtcInBkZlwiLCBcImRvY1wiLCBcImRvY3hcIiwgXCJtcDNcIiwgXCJ3YXZcIiwgXCJtNGFcIiwgXCJvZ2dcIiwgXCJ3ZWJtXCJdLmluY2x1ZGVzKGV4dGVuc2lvbik7XG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVzUHJvICYmXG4gICAgICAgICAgICAgICAgICAgICghY2hhdFZpZXcucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSB8fCAhY2hhdFZpZXcucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VWYWxpZClcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaG93UG9wdXAoY2hhdFZpZXcuYXBwLCBcIkRvY3VtZW50IHByb2Nlc3NpbmcgaXMgYSBQcm8gZmVhdHVyZS4uLlwiLCB7IHRpdGxlOiBcIlBybyBGZWF0dXJlXCIsIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiIH0pXG4gICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4geyBpZiAocmVzdWx0Py5jb25maXJtZWQpIHdpbmRvdy5vcGVuKFBBVFJFT05fVVJMLCBcIl9ibGFua1wiKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZpbGVzVG9Qcm9jZXNzLnB1c2goYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFmaWxlUGF0aC5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1kUGF0aCA9IGAke2ZpbGVQYXRofS5tZGA7XG4gICAgICAgICAgICAgICAgICBjb25zdCBtZEZpbGUgPSBjaGF0Vmlldy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG1kUGF0aCk7XG4gICAgICAgICAgICAgICAgICBpZiAobWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIGZpbGVzVG9Qcm9jZXNzLnB1c2gobWRGaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZmlsZXNUb1Byb2Nlc3MubGVuZ3RoID09PSAwICYmIGR0LnR5cGVzLmluY2x1ZGVzKFwidGV4dC91cmktbGlzdFwiKSkge1xuICAgICAgICAgIGNvbnN0IHVyaURhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlKSA9PiBkdC5pdGVtc1sxXS5nZXRBc1N0cmluZyhyZXNvbHZlKSk7XG4gICAgICAgICAgY29uc3QgdXJpcyA9IHVyaURhdGEuc3BsaXQoXCJvYnNpZGlhbjovL29wZW5cIikuZmlsdGVyKCh1cmkpID0+IHVyaS50cmltKCkpLm1hcCgodXJpKSA9PiBcIm9ic2lkaWFuOi8vb3BlblwiICsgdXJpLnRyaW0oKSk7XG4gICAgICAgICAgZm9yIChjb25zdCB1cmkgb2YgdXJpcykge1xuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXJzZU9ic2lkaWFuVXJpKHVyaSk7XG4gICAgICAgICAgICBpZiAoIWZpbGVQYXRoKSBjb250aW51ZTtcbiAgICAgICAgICAgIGxldCBhYnN0cmFjdEZpbGUgPSBjaGF0Vmlldy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhYnN0cmFjdEZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgIGNvbnN0IHJlcXVpcmVzUHJvID0gW1wicGRmXCIsIFwiZG9jXCIsIFwiZG9jeFwiLCBcIm1wM1wiLCBcIndhdlwiLCBcIm00YVwiLCBcIm9nZ1wiLCBcIndlYm1cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKTtcbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUHJvICYmXG4gICAgICAgICAgICAgICAgKCFjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZUtleT8udHJpbSgpIHx8ICFjaGF0Vmlldy5wbHVnaW4uc2V0dGluZ3MubGljZW5zZVZhbGlkKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzaG93UG9wdXAoY2hhdFZpZXcuYXBwLCBcIkRvY3VtZW50IHByb2Nlc3NpbmcgaXMgYSBQcm8gZmVhdHVyZS4uLlwiLCB7IHRpdGxlOiBcIlBybyBGZWF0dXJlXCIsIHByaW1hcnlCdXR0b246IFwiQmVjb21lIGEgUGF0cm9uXCIsIHNlY29uZGFyeUJ1dHRvbjogXCJNYXliZSBMYXRlclwiIH0pXG4gICAgICAgICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7IGlmIChyZXN1bHQ/LmNvbmZpcm1lZCkgd2luZG93Lm9wZW4oUEFUUkVPTl9VUkwsIFwiX2JsYW5rXCIpOyB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSB8fCBhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSBmaWxlc1RvUHJvY2Vzcy5wdXNoKGFic3RyYWN0RmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdGFsRmlsZXNBZGRlZCA9IDA7XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1Nsb3RzID0gTUFYX0ZJTEVTIC0gc3RhcnRpbmdDb250ZXh0U2l6ZTtcblxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZmlsZXNUb1Byb2Nlc3MpIHtcbiAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gZ2V0RmlsZXNGcm9tRm9sZGVyKGl0ZW0pO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb250ZXh0U2l6ZSA9IGNoYXRWaWV3LmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2hvd0FsZXJ0KGNoYXRWaWV3LmFwcCwgYEZpbGUgbGltaXQgcmVhY2hlZCAoJHtNQVhfRklMRVN9IHRvdGFsKWAsIHsgdHlwZTogXCJpbmZvXCIsIGljb246IFwiYWxlcnQtdHJpYW5nbGVcIiB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZXNQcm8gPSBbXCJwZGZcIiwgXCJkb2NcIiwgXCJkb2N4XCIsIFwibXAzXCIsIFwid2F2XCIsIFwibTRhXCIsIFwib2dnXCIsIFwid2VibVwiXS5pbmNsdWRlcyhleHRlbnNpb24pO1xuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQcm8gJiZcbiAgICAgICAgICAgICAgICAoIWNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5Py50cmltKCkgfHwgIWNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQpXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHNob3dQb3B1cChjaGF0Vmlldy5hcHAsIFwiRG9jdW1lbnQgcHJvY2Vzc2luZyBpcyBhIFBybyBmZWF0dXJlLi4uXCIsIHsgdGl0bGU6IFwiUHJvIEZlYXR1cmVcIiwgcHJpbWFyeUJ1dHRvbjogXCJCZWNvbWUgYSBQYXRyb25cIiwgc2Vjb25kYXJ5QnV0dG9uOiBcIk1heWJlIExhdGVyXCIgfSlcbiAgICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHsgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB3aW5kb3cub3BlbihQQVRSRU9OX1VSTCwgXCJfYmxhbmtcIik7IH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LmNvbnRleHRNYW5hZ2VyLmFkZEZpbGVUb0NvbnRleHQoZmlsZSk7XG4gICAgICAgICAgICAgICAgdG90YWxGaWxlc0FkZGVkKys7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbnRleHRTaXplID0gY2hhdFZpZXcuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgICAgICAgICAgICBzaG93Tm90aWNlKGBBZGRlZCAke2ZpbGUubmFtZX0gdG8gY29udGV4dCAoJHt1cGRhdGVkQ29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgLCB7IHR5cGU6IFwic3VjY2Vzc1wiIH0pO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbRHJhZ0Ryb3BdIEVycm9yIGFkZGluZyBmaWxlIGZyb20gZm9sZGVyOlwiLCB7IGZpbGU6IGZpbGUucGF0aCwgZXJyb3IgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRleHRTaXplID0gY2hhdFZpZXcuY29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEZpbGVzKCkuc2l6ZTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q29udGV4dFNpemUgPj0gTUFYX0ZJTEVTKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHNob3dBbGVydChjaGF0Vmlldy5hcHAsIGBGaWxlIGxpbWl0IHJlYWNoZWQgKCR7TUFYX0ZJTEVTfSB0b3RhbClgLCB7IHR5cGU6IFwiaW5mb1wiLCBpY29uOiBcImFsZXJ0LXRyaWFuZ2xlXCIgfSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LmNvbnRleHRNYW5hZ2VyLmFkZEZpbGVUb0NvbnRleHQoaXRlbSk7XG4gICAgICAgICAgICB0b3RhbEZpbGVzQWRkZWQrKztcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRDb250ZXh0U2l6ZSA9IGNoYXRWaWV3LmNvbnRleHRNYW5hZ2VyLmdldENvbnRleHRGaWxlcygpLnNpemU7XG4gICAgICAgICAgICBzaG93Tm90aWNlKGBBZGRlZCAke2l0ZW0ubmFtZX0gdG8gY29udGV4dCAoJHt1cGRhdGVkQ29udGV4dFNpemV9LyR7TUFYX0ZJTEVTfSlgLCB7IHR5cGU6IFwic3VjY2Vzc1wiIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltEcmFnRHJvcF0gRXJyb3IgcHJvY2Vzc2luZyBkcm9wOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dBbGVydChjaGF0Vmlldy5hcHAsIFwiRmFpbGVkIHRvIHByb2Nlc3MgZHJvcHBlZCBmaWxlc1wiLCB7IHR5cGU6IFwiZXJyb3JcIiB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTsiLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVEZpbGUsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IGF0dGFjaEZpbGVTdWdnZXN0ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9GaWxlU3VnZ2VzdGVyXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRQcmVzZXQgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IHNob3dQb3B1cCwgc2hvd0VuaGFuY2VkTm90aWNlIH0gZnJvbSBcIi4uL2NvcmUvdWlcIjtcbmltcG9ydCB7IFN5c3RlbVByb21wdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtUHJvbXB0U2VydmljZVwiO1xuaW1wb3J0IHsgTW9kZWxTZWxlY3Rpb25Nb2RhbCB9IGZyb20gXCIuL01vZGVsU2VsZWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFRpdGxlR2VuZXJhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvVGl0bGVHZW5lcmF0aW9uU2VydmljZVwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlTmFtZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gbmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOS1fIF0vZywgXCJcIikucmVwbGFjZSgvIC9nLCBcIi1cIik7XG59XG5cbmZ1bmN0aW9uIGdldFN5c3RlbVByb21wdFBhdGgoZGlyZWN0b3J5OiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7ZGlyZWN0b3J5fS8ke2ZpbGVOYW1lfS5tZGA7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFN5c3RlbVByb21wdFJlc3VsdCB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdHlwZTogXCJnZW5lcmFsLXVzZVwiIHwgXCJjb25jaXNlXCIgfCBcImN1c3RvbVwiO1xuICBwYXRoPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRTeXN0ZW1Qcm9tcHRNb2RhbE9wdGlvbnMge1xuICBvblNhdmU/OiAobmV3UHJvbXB0OiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk/OiBzdHJpbmc7XG4gIGN1c3RvbVByb21wdEZpbGVQYXRoPzogc3RyaW5nO1xuICBwbHVnaW4/OiBhbnk7XG4gIG9uTW9kZWxTZWxlY3Q/OiAobW9kZWxJZDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBjdXJyZW50TW9kZWxJZD86IHN0cmluZztcbiAgY3VycmVudFByb21wdD86IHN0cmluZztcbiAgY2hhdFRpdGxlPzogc3RyaW5nO1xuICBvblRpdGxlQ2hhbmdlPzogKG5ld1RpdGxlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gIG1lc3NhZ2VzPzogQ2hhdE1lc3NhZ2VbXTtcbn1cblxuZXhwb3J0IGNsYXNzIENoYXRTeXN0ZW1Qcm9tcHRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSByZXN1bHQ6IENoYXRTeXN0ZW1Qcm9tcHRSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBDaGF0U3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0ZXh0QXJlYTogSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21JbnB1dDogSFRNTElucHV0RWxlbWVudDtcbiAgcHJpdmF0ZSBjdXN0b21TZWN0aW9uOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvcHRpb25zOiBDaGF0U3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zO1xuICBwcml2YXRlIHN5c3RlbVByb21wdFNlcnZpY2U6IFN5c3RlbVByb21wdFNlcnZpY2U7XG4gIHByaXZhdGUgc3lzdGVtUHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10gPSBbXTtcbiAgcHJpdmF0ZSBsb2FkaW5nSW5kaWNhdG9yOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVzZXRCdXR0b25Db250YWluZXI6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGFjdGl2ZVByZXNldDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbW9kZWxJbmRpY2F0b3I6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIHNjdWxwdFNlcnZpY2U6IFN5c3RlbVNjdWxwdFNlcnZpY2U7XG4gIHByaXZhdGUgbW9kYWxPcGVuVGltZTogbnVtYmVyO1xuICBwcml2YXRlIHJlc2l6ZVRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0O1xuICBwcml2YXRlIHByb21wdHNDb250YWluZXI6IEhUTUxEaXZFbGVtZW50O1xuICBwcml2YXRlIGxvYWRpbmdFbDogSFRNTERpdkVsZW1lbnQ7XG4gIHByaXZhdGUgY3VycmVudFByb21wdDogc3RyaW5nO1xuICBwcml2YXRlIHdlYlNlYXJjaEVuYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSB0aXRsZUlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIHRpdGxlR2VuZXJhdGlvblNlcnZpY2U6IFRpdGxlR2VuZXJhdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgaXNHZW5lcmF0aW5nVGl0bGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgb3B0aW9uczogQ2hhdFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucykge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLmN1cnJlbnRQcm9tcHQgPSBvcHRpb25zLmN1cnJlbnRQcm9tcHQgfHwgXCJcIjtcbiAgICB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UgPSBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldEluc3RhbmNlKGFwcCk7XG4gICAgaWYgKG9wdGlvbnMucGx1Z2luKSB7XG4gICAgICB0aGlzLnNjdWxwdFNlcnZpY2UgPSBTeXN0ZW1TY3VscHRTZXJ2aWNlLmdldEluc3RhbmNlKG9wdGlvbnMucGx1Z2luLnNldHRpbmdzLCBhcHApO1xuICAgICAgLy8gUHJlLWxvYWQgY2FjaGVkIGRhdGFcbiAgICAgIHRoaXMuc3lzdGVtUHJvbXB0cyA9IFN5c3RlbVByb21wdFNlcnZpY2UuZ2V0Q2FjaGVkUHJvbXB0cygpIHx8IFtdO1xuICAgIH1cbiAgICAvLyBTZXQgaW5pdGlhbCBhY3RpdmUgcHJlc2V0IGJhc2VkIG9uIGN1cnJlbnRQcm9tcHRcbiAgICB0aGlzLnNldEluaXRpYWxBY3RpdmVQcmVzZXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SW5pdGlhbEFjdGl2ZVByZXNldCgpIHtcbiAgICBpZiAoIXRoaXMuY3VycmVudFByb21wdCkge1xuICAgICAgdGhpcy5hY3RpdmVQcmVzZXQgPSBcIkdlbmVyYWwtdXNlXCI7IC8vIERlZmF1bHQgZm9yIG5ldyBjaGF0XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1hdGNoaW5nUHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQocCA9PiBwLnN5c3RlbVByb21wdC50cmltKCkgPT09IHRoaXMuY3VycmVudFByb21wdC50cmltKCkpO1xuICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gbWF0Y2hpbmdQcmVzZXQgPyBtYXRjaGluZ1ByZXNldC5sYWJlbCA6IFwiQ3VzdG9tXCI7XG4gIH1cblxuICBwcml2YXRlIHNob3dMb2FkaW5nKHNob3c6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgIHRoaXMuY29udGVudENvbnRhaW5lci5zdHlsZS5vcGFjaXR5ID0gc2hvdyA/IFwiMC41XCIgOiBcIjFcIjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBSZXNpemVPYnNlcnZlcigpIHtcbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5yZXNpemVUaW1lb3V0KTtcbiAgICAgIHRoaXMucmVzaXplVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgICB0aGlzLnRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMudGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgfSwgNTApO1xuICAgIH0pO1xuICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy50ZXh0QXJlYSk7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgdGhpcy5jb250YWluZXJFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1zeXN0ZW0tcHJvbXB0LW1vZGFsXCIpO1xuICAgIHRoaXMuY29udGVudEVsLmVtcHR5KCk7XG4gICAgdGhpcy5jb250ZW50RWwuYWRkQ2xhc3MoXCJzeXN0ZW1zY3VscHQtc3lzdGVtLXByb21wdC1jb250ZW50XCIpO1xuXG4gICAgdGhpcy5jb250ZW50Q29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWNvbnRlbnQtY29udGFpbmVyXCIpO1xuICAgIHRoaXMuc2V0dXBMb2FkaW5nSW5kaWNhdG9yKCk7XG4gICAgdGhpcy5zZXR1cFRpdGxlU2VjdGlvbigpO1xuICAgIHRoaXMuc2V0dXBNb2RlbFNlY3Rpb24oKTtcbiAgICB0aGlzLnNldHVwVGV4dEFyZWEoKTtcbiAgICB0aGlzLnNldHVwQnV0dG9ucygpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB3aXRoIGN1cnJlbnQgcHJvbXB0IGltbWVkaWF0ZWx5LCBubyBBUEkgY2FsbHMgeWV0XG4gICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQgfHwgXCJcIjtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbnMgd2l0aCBjYWNoZWQgZGF0YSBmaXJzdFxuICAgIGlmICh0aGlzLnN5c3RlbVByb21wdHMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5jcmVhdGVQcmVzZXRCdXR0b25zKCk7XG4gICAgICAvLyBFbnN1cmUgaW5pdGlhbCBwcmVzZXQgaXMgcmVmbGVjdGVkIGltbWVkaWF0ZWx5XG4gICAgICBjb25zdCBpbml0aWFsUHJlc2V0ID0gdGhpcy5zeXN0ZW1Qcm9tcHRzLmZpbmQocCA9PiBwLmxhYmVsID09PSB0aGlzLmFjdGl2ZVByZXNldCkgfHwge1xuICAgICAgICBpZDogXCJjdXN0b21cIixcbiAgICAgICAgbGFiZWw6IFwiQ3VzdG9tXCIsXG4gICAgICAgIHN5c3RlbVByb21wdDogdGhpcy5jdXJyZW50UHJvbXB0LFxuICAgICAgICBpc1VzZXJDb25maWd1cmFibGU6IHRydWVcbiAgICAgIH07XG4gICAgICB0aGlzLnVwZGF0ZVVJRm9yUHJlc2V0KGluaXRpYWxQcmVzZXQpO1xuICAgIH1cblxuICAgIC8vIE9ubHkgc2hvdyBsb2FkaW5nIGFuZCBmZXRjaCBmcmVzaCBwcm9tcHRzIGlmIGNhY2hlIGlzIGludmFsaWQgb3IgZW1wdHlcbiAgICBpZiAoIXRoaXMuc3lzdGVtUHJvbXB0cy5sZW5ndGggfHwgIVN5c3RlbVByb21wdFNlcnZpY2UuaXNDYWNoZVZhbGlkKCkpIHtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcodHJ1ZSk7XG4gICAgICBhd2FpdCB0aGlzLmxvYWRTeXN0ZW1Qcm9tcHRzKCkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW1N5c3RlbVNjdWxwdF0gRmFpbGVkIHRvIGxvYWQgc3lzdGVtIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzeXN0ZW0gcHJvbXB0cy4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG93TG9hZGluZyhmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cFJlc2l6ZU9ic2VydmVyKCk7XG4gICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgIHRoaXMudGV4dEFyZWEuZm9jdXMoKTtcbiAgICAgIHRoaXMudGV4dEFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy50ZXh0QXJlYS52YWx1ZS5sZW5ndGgsIHRoaXMudGV4dEFyZWEudmFsdWUubGVuZ3RoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldHVwVGl0bGVTZWN0aW9uKCkge1xuICAgIGlmICghdGhpcy5vcHRpb25zLnBsdWdpbiB8fCAhdGhpcy5vcHRpb25zLm1lc3NhZ2VzKSByZXR1cm47XG5cbiAgICBjb25zdCB0aXRsZVNlY3Rpb24gPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXRpdGxlLXNlY3Rpb25cIik7XG4gICAgdGl0bGVTZWN0aW9uLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMS41cmVtXCI7XG4gICAgdGl0bGVTZWN0aW9uLnN0eWxlLm1hcmdpblRvcCA9IFwiMC41cmVtXCI7XG5cbiAgICAvLyBBZGQgc2VjdGlvbiBoZWFkZXJcbiAgICBjb25zdCB0aXRsZVNlY3Rpb25IZWFkZXIgPSB0aXRsZVNlY3Rpb24uY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIpO1xuICAgIHRpdGxlU2VjdGlvbkhlYWRlci5zdHlsZS5mb250U2l6ZSA9IFwiMC44ZW1cIjtcbiAgICB0aXRsZVNlY3Rpb25IZWFkZXIuc3R5bGUudGV4dFRyYW5zZm9ybSA9IFwidXBwZXJjYXNlXCI7XG4gICAgdGl0bGVTZWN0aW9uSGVhZGVyLnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW11dGVkKVwiO1xuICAgIHRpdGxlU2VjdGlvbkhlYWRlci5zdHlsZS5mb250V2VpZ2h0ID0gXCI2MDBcIjtcbiAgICB0aXRsZVNlY3Rpb25IZWFkZXIuc3R5bGUubWFyZ2luQm90dG9tID0gXCIwLjVyZW1cIjtcbiAgICB0aXRsZVNlY3Rpb25IZWFkZXIuc3R5bGUubGV0dGVyU3BhY2luZyA9IFwiMC4wNWVtXCI7XG4gICAgdGl0bGVTZWN0aW9uSGVhZGVyLnNldFRleHQoXCJUaXRsZVwiKTtcblxuICAgIGNvbnN0IHRpdGxlSGVhZGVyID0gdGl0bGVTZWN0aW9uLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRpdGxlLWhlYWRlclwiLFxuICAgICAgYXR0cjogeyBzdHlsZTogXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDAuNXJlbTsgZ2FwOiAwLjVyZW07XCIgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgdGl0bGVDb250cm9scyA9IHRpdGxlSGVhZGVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXRpdGxlLWNvbnRyb2xzXCIsXG4gICAgICBhdHRyOiB7IHN0eWxlOiBcImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMXJlbTsgd2lkdGg6IDEwMCU7XCIgfVxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRpdGxlIGlucHV0XG4gICAgdGhpcy50aXRsZUlucHV0ID0gdGl0bGVDb250cm9scy5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgdmFsdWU6IHRoaXMub3B0aW9ucy5jaGF0VGl0bGUgfHwgXCJcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIkVudGVyIGNoYXQgdGl0bGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGl0bGUtaW5wdXRcIlxuICAgIH0pO1xuICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5mbGV4ID0gXCIxXCI7XG4gICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweCA4cHhcIjtcbiAgICB0aGlzLnRpdGxlSW5wdXQuc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI0cHhcIjtcbiAgICB0aGlzLnRpdGxlSW5wdXQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpXCI7XG4gICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwidmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnkpXCI7XG4gICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW5vcm1hbClcIjtcblxuICAgIC8vIENyZWF0ZSBnZW5lcmF0ZSB0aXRsZSBidXR0b25cbiAgICBjb25zdCBnZW5lcmF0ZVRpdGxlQnV0dG9uID0gdGl0bGVDb250cm9scy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvbiBtb2QtY3RhXCIsXG4gICAgICB0ZXh0OiBcIkdlbmVyYXRlIFRpdGxlXCJcbiAgICB9KTtcbiAgICBnZW5lcmF0ZVRpdGxlQnV0dG9uLnN0eWxlLnBhZGRpbmcgPSBcIjRweCAxMnB4XCI7XG4gICAgZ2VuZXJhdGVUaXRsZUJ1dHRvbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICAgIGdlbmVyYXRlVGl0bGVCdXR0b24uc3R5bGUuZm9udFNpemUgPSBcIjE0cHhcIjtcblxuICAgIC8vIEluaXRpYWxpemUgdGl0bGUgZ2VuZXJhdGlvbiBzZXJ2aWNlXG4gICAgdGhpcy50aXRsZUdlbmVyYXRpb25TZXJ2aWNlID0gVGl0bGVHZW5lcmF0aW9uU2VydmljZS5nZXRJbnN0YW5jZSh0aGlzLm9wdGlvbnMucGx1Z2luKTtcblxuICAgIC8vIEhhbmRsZSB0aXRsZSBnZW5lcmF0aW9uXG4gICAgZ2VuZXJhdGVUaXRsZUJ1dHRvbi5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaXNHZW5lcmF0aW5nVGl0bGUpIHJldHVybjtcblxuICAgICAgdGhpcy5pc0dlbmVyYXRpbmdUaXRsZSA9IHRydWU7XG4gICAgICBnZW5lcmF0ZVRpdGxlQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGdlbmVyYXRlVGl0bGVCdXR0b24udGV4dENvbnRlbnQgfHwgXCJHZW5lcmF0ZSBUaXRsZVwiO1xuICAgICAgZ2VuZXJhdGVUaXRsZUJ1dHRvbi5zZXRUZXh0KFwiR2VuZXJhdGluZy4uLlwiKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy50aXRsZUdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlVGl0bGUoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLm1lc3NhZ2VzISxcbiAgICAgICAgICAodGl0bGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgdGhpcy50aXRsZUlucHV0LnZhbHVlID0gdGl0bGU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAocHJvZ3Jlc3M6IG51bWJlciwgc3RhdHVzOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGdlbmVyYXRlVGl0bGVCdXR0b24uc2V0VGV4dChgJHtzdGF0dXN9ICgke3Byb2dyZXNzfSUpYCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25UaXRsZUNoYW5nZSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMub3B0aW9ucy5vblRpdGxlQ2hhbmdlKHRoaXMudGl0bGVJbnB1dC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIHRpdGxlOlwiLCBlcnJvcik7XG4gICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byBnZW5lcmF0ZSB0aXRsZVwiLCBcImVycm9yXCIsIGVycm9yKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIHRoaXMuaXNHZW5lcmF0aW5nVGl0bGUgPSBmYWxzZTtcbiAgICAgICAgZ2VuZXJhdGVUaXRsZUJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICBnZW5lcmF0ZVRpdGxlQnV0dG9uLnNldFRleHQob3JpZ2luYWxUZXh0KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gSGFuZGxlIG1hbnVhbCB0aXRsZSBjaGFuZ2VzXG4gICAgdGhpcy50aXRsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5vblRpdGxlQ2hhbmdlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMub3B0aW9ucy5vblRpdGxlQ2hhbmdlKHRoaXMudGl0bGVJbnB1dC52YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwTW9kZWxTZWN0aW9uKCkge1xuICAgIGlmICghdGhpcy5vcHRpb25zLnBsdWdpbiB8fCAhdGhpcy5vcHRpb25zLmN1cnJlbnRNb2RlbElkKSByZXR1cm47XG5cbiAgICBjb25zdCBtb2RlbFNlY3Rpb24gPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LW1vZGVsLXNlY3Rpb25cIik7XG4gICAgbW9kZWxTZWN0aW9uLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMS41cmVtXCI7XG5cbiAgICAvLyBBZGQgc2VjdGlvbiBoZWFkZXJcbiAgICBjb25zdCBtb2RlbFNlY3Rpb25IZWFkZXIgPSBtb2RlbFNlY3Rpb24uY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIpO1xuICAgIG1vZGVsU2VjdGlvbkhlYWRlci5zdHlsZS5mb250U2l6ZSA9IFwiMC44ZW1cIjtcbiAgICBtb2RlbFNlY3Rpb25IZWFkZXIuc3R5bGUudGV4dFRyYW5zZm9ybSA9IFwidXBwZXJjYXNlXCI7XG4gICAgbW9kZWxTZWN0aW9uSGVhZGVyLnN0eWxlLmNvbG9yID0gXCJ2YXIoLS10ZXh0LW11dGVkKVwiO1xuICAgIG1vZGVsU2VjdGlvbkhlYWRlci5zdHlsZS5mb250V2VpZ2h0ID0gXCI2MDBcIjtcbiAgICBtb2RlbFNlY3Rpb25IZWFkZXIuc3R5bGUubWFyZ2luQm90dG9tID0gXCIwLjVyZW1cIjtcbiAgICBtb2RlbFNlY3Rpb25IZWFkZXIuc3R5bGUubGV0dGVyU3BhY2luZyA9IFwiMC4wNWVtXCI7XG4gICAgbW9kZWxTZWN0aW9uSGVhZGVyLnNldFRleHQoXCJNb2RlbFwiKTtcblxuICAgIGNvbnN0IG1vZGVsSGVhZGVyID0gbW9kZWxTZWN0aW9uLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWhlYWRlclwiLFxuICAgICAgYXR0cjogeyBzdHlsZTogXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDAuNXJlbTsgZ2FwOiAwLjVyZW07XCIgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxDb250cm9scyA9IG1vZGVsSGVhZGVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGVsLWNvbnRyb2xzXCIsXG4gICAgICBhdHRyOiB7IHN0eWxlOiBcImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMXJlbTsgd2lkdGg6IDEwMCU7XCIgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5tb2RlbEluZGljYXRvciA9IG1vZGVsQ29udHJvbHMuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RlbC1pbmRpY2F0b3JcIiB9KTtcbiAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHRoaXMubW9kZWxJbmRpY2F0b3Iuc3R5bGUuZmxleCA9IFwiMVwiO1xuXG4gICAgY29uc3QgY3VycmVudE1vZGVsID0gdGhpcy5vcHRpb25zLnBsdWdpbi5tb2RlbFNlcnZpY2UuY2FjaGVkTW9kZWxzPy5maW5kKFxuICAgICAgKG1vZGVsOiBTeXN0ZW1TY3VscHRNb2RlbCkgPT4gbW9kZWwuaWQgPT09IHRoaXMub3B0aW9ucy5jdXJyZW50TW9kZWxJZFxuICAgICk7XG4gICAgY29uc3QgcHJvdmlkZXJQcmVmaXggPSBjdXJyZW50TW9kZWxcbiAgICAgID8gY3VycmVudE1vZGVsLnByb3ZpZGVyID09PSBcInN5c3RlbXNjdWxwdFwiID8gXCJbU1MgQUldIFwiIDogYFske2N1cnJlbnRNb2RlbC5wcm92aWRlci50b1VwcGVyQ2FzZSgpfV0gYFxuICAgICAgOiBcIlwiO1xuICAgIHRoaXMubW9kZWxJbmRpY2F0b3Iuc2V0VGV4dChgQ3VycmVudCBNb2RlbDogJHtwcm92aWRlclByZWZpeH0ke2N1cnJlbnRNb2RlbD8ubmFtZSB8fCB0aGlzLm9wdGlvbnMuY3VycmVudE1vZGVsSWR9YCk7XG5cbiAgICBjb25zdCBjaGFuZ2VNb2RlbEJ1dHRvbiA9IG1vZGVsQ29udHJvbHMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiLFxuICAgICAgdGV4dDogXCJDaGFuZ2UgTW9kZWxcIlxuICAgIH0pO1xuICAgIGNoYW5nZU1vZGVsQnV0dG9uLnN0eWxlLnBhZGRpbmcgPSBcIjRweCAxMnB4XCI7XG4gICAgY2hhbmdlTW9kZWxCdXR0b24uc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI0cHhcIjtcbiAgICBjaGFuZ2VNb2RlbEJ1dHRvbi5zdHlsZS5mb250U2l6ZSA9IFwiMTRweFwiO1xuXG4gICAgY29uc3Qgb3Blbk1vZGVsU2VsZWN0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5vcHRpb25zLnBsdWdpbi5tb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCk7XG4gICAgICBjb25zdCBtb2RhbCA9IG5ldyBNb2RlbFNlbGVjdGlvbk1vZGFsKFxuICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgdGhpcy5vcHRpb25zLmN1cnJlbnRNb2RlbElkIHx8IFwiXCIsXG4gICAgICAgIGFzeW5jIChtb2RlbElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm9uTW9kZWxTZWxlY3QpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMub3B0aW9ucy5vbk1vZGVsU2VsZWN0KG1vZGVsSWQpO1xuICAgICAgICAgICAgY29uc3QgbmV3TW9kZWwgPSBtb2RlbHMuZmluZCgobTogU3lzdGVtU2N1bHB0TW9kZWwpID0+IG0uaWQgPT09IG1vZGVsSWQpO1xuICAgICAgICAgICAgY29uc3QgbmV3UHJlZml4ID0gbmV3TW9kZWxcbiAgICAgICAgICAgICAgPyBuZXdNb2RlbC5wcm92aWRlciA9PT0gXCJzeXN0ZW1zY3VscHRcIiA/IFwiW1NTIEFJXSBcIiA6IGBbJHtuZXdNb2RlbC5wcm92aWRlci50b1VwcGVyQ2FzZSgpfV0gYFxuICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgICAgICB0aGlzLm1vZGVsSW5kaWNhdG9yLnNldFRleHQoYEN1cnJlbnQgTW9kZWw6ICR7bmV3UHJlZml4fSR7bmV3TW9kZWw/Lm5hbWUgfHwgbW9kZWxJZH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMub3B0aW9ucy5wbHVnaW5cbiAgICAgICk7XG4gICAgICBtb2RhbC5vcGVuKCk7XG4gICAgfTtcblxuICAgIHRoaXMubW9kZWxJbmRpY2F0b3Iub25jbGljayA9IG9wZW5Nb2RlbFNlbGVjdGlvbjtcbiAgICBjaGFuZ2VNb2RlbEJ1dHRvbi5vbmNsaWNrID0gb3Blbk1vZGVsU2VsZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cExvYWRpbmdJbmRpY2F0b3IoKSB7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1sb2FkaW5nXCIpO1xuICAgIHRoaXMubG9hZGluZ0luZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgICB0aGlzLmxvYWRpbmdJbmRpY2F0b3IuY3JlYXRlU3BhbigpLnNldFRleHQoXCJMb2FkaW5nIHN5c3RlbSBwcm9tcHRzLi4uXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cFRleHRBcmVhKCkge1xuICAgIGNvbnN0IHRleHRBcmVhQ29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LXRleHRhcmVhLWNvbnRhaW5lclwiXG4gICAgKTtcbiAgICB0ZXh0QXJlYUNvbnRhaW5lci5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjEuNXJlbVwiO1xuXG4gICAgLy8gQWRkIHNlY3Rpb24gaGVhZGVyXG4gICAgY29uc3QgcHJvbXB0U2VjdGlvbkhlYWRlciA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWhlYWRlclwiKTtcbiAgICBwcm9tcHRTZWN0aW9uSGVhZGVyLnN0eWxlLmZvbnRTaXplID0gXCIwLjhlbVwiO1xuICAgIHByb21wdFNlY3Rpb25IZWFkZXIuc3R5bGUudGV4dFRyYW5zZm9ybSA9IFwidXBwZXJjYXNlXCI7XG4gICAgcHJvbXB0U2VjdGlvbkhlYWRlci5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBwcm9tcHRTZWN0aW9uSGVhZGVyLnN0eWxlLmZvbnRXZWlnaHQgPSBcIjYwMFwiO1xuICAgIHByb21wdFNlY3Rpb25IZWFkZXIuc3R5bGUubWFyZ2luQm90dG9tID0gXCIwLjVyZW1cIjtcbiAgICBwcm9tcHRTZWN0aW9uSGVhZGVyLnN0eWxlLmxldHRlclNwYWNpbmcgPSBcIjAuMDVlbVwiO1xuICAgIHByb21wdFNlY3Rpb25IZWFkZXIuc2V0VGV4dChcIlN5c3RlbSBQcm9tcHRcIik7XG5cbiAgICAvLyBDcmVhdGUgcHJlc2V0IGJ1dHRvbiBjb250YWluZXIgYnV0IGRvbid0IHBvcHVsYXRlIHlldFxuICAgIHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyID0gdGV4dEFyZWFDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvbi1jb250YWluZXJcIlxuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHNlY3Rpb24gKGhpZGRlbiBieSBkZWZhdWx0KVxuICAgIHRoaXMuY3VzdG9tU2VjdGlvbiA9IHRleHRBcmVhQ29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWN1c3RvbS1zZWN0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBjdXN0b21JbnB1dENvbnRhaW5lciA9IHRoaXMuY3VzdG9tU2VjdGlvbi5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1jdXN0b20taW5wdXQtY29udGFpbmVyXCJcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgYW5kIGJ1dHRvblxuICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGN1c3RvbUlucHV0Q29udGFpbmVyLmNyZWF0ZURpdihcbiAgICAgIFwic3lzdGVtc2N1bHB0LWlucHV0LXdyYXBwZXJcIlxuICAgICk7XG4gICAgaW5wdXRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBpbnB1dFdyYXBwZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdGhlIHNlYXJjaCBpbnB1dFxuICAgIHRoaXMuY3VzdG9tSW5wdXQgPSBpbnB1dFdyYXBwZXIuY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCBmb3IgYSBzeXN0ZW0gcHJvbXB0IGZpbGUuLi5cIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3VzdG9tLWlucHV0XCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNyZWF0ZSBuZXcgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnV0dG9uID0gaW5wdXRXcmFwcGVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtY3JlYXRlLWJ1dHRvblwiLFxuICAgIH0pO1xuICAgIGNyZWF0ZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gXCI0cHggOHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNHB4XCI7XG4gICAgY3JlYXRlQnV0dG9uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICAgIHNldEljb24oY3JlYXRlQnV0dG9uLCBcInBsdXNcIik7XG5cbiAgICBjcmVhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnQgPSBcIlwiO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGVtcGxhdGVDb250ZW50ID1cbiAgICAgICAgICBhd2FpdCB0aGlzLnN5c3RlbVByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0VGVtcGxhdGUoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlOlwiLCBlcnJvcik7XG4gICAgICAgIGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICBcIkZhaWxlZCB0byBmZXRjaCBzeXN0ZW0gcHJvbXB0IHRlbXBsYXRlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIlwiLCB7XG4gICAgICAgIHRpdGxlOiBcIkNyZWF0ZSBOZXcgU3lzdGVtIFByb21wdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkVudGVyIGEgdGl0bGUgYW5kIGNvbnRlbnQgZm9yIHlvdXIgbmV3IHN5c3RlbSBwcm9tcHQuIFRoZSB0aXRsZSB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGEgbWFya2Rvd24gZmlsZSB0aGF0IHlvdSBjYW4gY3VzdG9taXplIGxhdGVyLlwiLFxuICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkNyZWF0ZVwiLFxuICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgIGlucHV0czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiTXkgQ3VzdG9tIEFzc2lzdGFudFwiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3lzdGVtc2N1bHB0LXByb21wdC1jcmVhdGlvbi10aXRsZS1pbnB1dFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogXCJ0ZXh0YXJlYVwiLFxuICAgICAgICAgICAgdmFsdWU6IHRlbXBsYXRlQ29udGVudCxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInN5c3RlbXNjdWxwdC1wcm9tcHQtY3JlYXRpb24tY29udGVudFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXN1bHQ/LmNvbmZpcm1lZCB8fCAhcmVzdWx0LmlucHV0cz8uWzBdIHx8ICFyZXN1bHQuaW5wdXRzPy5bMV0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbdGl0bGUsIGNvbnRlbnRdID0gcmVzdWx0LmlucHV0cztcbiAgICAgIGNvbnN0IHByb21wdHNEaXJlY3RvcnkgPVxuICAgICAgICB0aGlzLm9wdGlvbnMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSA/PyBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiO1xuICAgICAgY29uc3QgZmlsZU5hbWUgPSBzYW5pdGl6ZUZpbGVOYW1lKHRpdGxlKTtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gZ2V0U3lzdGVtUHJvbXB0UGF0aChwcm9tcHRzRGlyZWN0b3J5LCBmaWxlTmFtZSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKHByb21wdHNEaXJlY3RvcnkpLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAvKiBEaXJlY3RvcnkgbWlnaHQgYWxyZWFkeSBleGlzdCAqL1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGAjICR7dGl0bGV9XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIGZpbGVDb250ZW50KTtcblxuICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGZpbGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIHRleHRhcmVhIHdpdGggdGhlIGNvbnRlbnRcbiAgICAgICAgaWYgKHRoaXMudGV4dEFyZWEpIHtcbiAgICAgICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gZmlsZUNvbnRlbnQ7XG4gICAgICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnB1dCB0byBzaG93IHRoZSBzZWxlY3RlZCBmaWxlXG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSBmaWxlUGF0aDtcblxuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiU3lzdGVtIHByb21wdCBmaWxlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgc3lzdGVtIHByb21wdCBmaWxlOlwiLCBlcnJvcik7XG5cbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgICA/IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIDogXCJGYWlsZWQgdG8gY3JlYXRlIHN5c3RlbSBwcm9tcHQgZmlsZS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIjtcblxuICAgICAgICBhd2FpdCBzaG93UG9wdXAodGhpcy5hcHAsIFwiXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE9ubHkgYXR0YWNoIGZpbGUgc3VnZ2VzdGVyIGFmdGVyIGlucHV0IGlzIGNyZWF0ZWRcbiAgICBpZiAodGhpcy5jdXN0b21JbnB1dCkge1xuICAgICAgYXR0YWNoRmlsZVN1Z2dlc3RlcihcbiAgICAgICAgdGhpcy5jdXN0b21JbnB1dCxcbiAgICAgICAgYXN5bmMgKHNlbGVjdGVkUGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc2VsZWN0ZWRQYXRoKTtcbiAgICAgICAgICAgIGlmIChmaWxlICYmIGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgICAgdGhpcy50ZXh0QXJlYS52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlIHdpdGhvdXQgLm1kIGV4dGVuc2lvblxuICAgICAgICAgICAgICB0aGlzLmN1c3RvbUlucHV0LnZhbHVlID0gc2VsZWN0ZWRQYXRoLnJlcGxhY2UoL1xcLm1kJC8sIFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVhZGluZyBzeXN0ZW0gcHJvbXB0IGZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuYXBwLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc3lzdGVtUHJvbXB0c0RpcmVjdG9yeSA/PyBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMudGV4dEFyZWEgPSB0ZXh0QXJlYUNvbnRhaW5lci5jcmVhdGVFbChcInRleHRhcmVhXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtdGV4dGFyZWFcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiRW50ZXIgc3lzdGVtIHByb21wdFwiLFxuICAgICAgICByZWFkT25seTogdGhpcy5hY3RpdmVQcmVzZXQgIT09IFwiQ3VzdG9tXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMudGV4dEFyZWEudmFsdWUgPSB0aGlzLmN1cnJlbnRQcm9tcHQ7XG4gIH1cblxuICBwcml2YXRlIHNldHVwQnV0dG9ucygpIHtcbiAgICBjb25zdCBidXR0b25Db250YWluZXIgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtYnV0dG9uLWNvbnRhaW5lclwiXG4gICAgKTtcblxuICAgIC8vIEFkZCBzZWN0aW9uIGhlYWRlclxuICAgIGNvbnN0IGFjdGlvbnNTZWN0aW9uSGVhZGVyID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWhlYWRlclwiKTtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zdHlsZS5mb250U2l6ZSA9IFwiMC44ZW1cIjtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zdHlsZS50ZXh0VHJhbnNmb3JtID0gXCJ1cHBlcmNhc2VcIjtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zdHlsZS5jb2xvciA9IFwidmFyKC0tdGV4dC1tdXRlZClcIjtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zdHlsZS5mb250V2VpZ2h0ID0gXCI2MDBcIjtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gXCIwLjA1ZW1cIjtcbiAgICBhY3Rpb25zU2VjdGlvbkhlYWRlci5zZXRUZXh0KFwiQWN0aW9uc1wiKTtcblxuICAgIGJ1dHRvbkNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG4gICAgYnV0dG9uQ29udGFpbmVyLnN0eWxlLmZsZXhEaXJlY3Rpb24gPSBcImNvbHVtblwiO1xuICAgIGJ1dHRvbkNvbnRhaW5lci5zdHlsZS5nYXAgPSBcIjE2cHhcIjtcbiAgICBidXR0b25Db250YWluZXIuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG5cbiAgICAvLyBBZGQgdXRpbGl0eSBidXR0b24gZ3JpZFxuICAgIGNvbnN0IHV0aWxpdHlCdXR0b25HcmlkID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZURpdihcInN5c3RlbXNjdWxwdC11dGlsaXR5LWJ1dHRvbi1ncmlkXCIpO1xuICAgIHV0aWxpdHlCdXR0b25HcmlkLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICB1dGlsaXR5QnV0dG9uR3JpZC5zdHlsZS5nYXAgPSBcIjhweFwiO1xuICAgIHV0aWxpdHlCdXR0b25HcmlkLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cbiAgICAvLyBDb3B5IENoYXQgQnV0dG9uXG4gICAgY29uc3QgY29weUNoYXRCdXR0b24gPSB1dGlsaXR5QnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiQ29weSBjaGF0IHRvIGNsaXBib2FyZFwiIH0sXG4gICAgfSk7XG4gICAgc2V0SWNvbihjb3B5Q2hhdEJ1dHRvbiwgXCJjb3B5XCIpO1xuICAgIGNvcHlDaGF0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMub3B0aW9ucy5wbHVnaW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgY2hhdCdzIGxlYWYgdmlldyBzdGF0ZVxuICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZj8uZ2V0Vmlld1N0YXRlKCk7XG4gICAgICBjb25zdCBjaGF0SWQgPSBzdGF0ZT8uc3RhdGU/LmNoYXRJZDtcblxuICAgICAgaWYgKCFjaGF0SWQpIHtcbiAgICAgICAgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIkNvdWxkIG5vdCBkZXRlcm1pbmUgd2hpY2ggY2hhdCB0byBjb3B5XCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICBpY29uOiBcImFsZXJ0LWNpcmNsZVwiXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5vcHRpb25zLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeX0vJHtjaGF0SWR9Lm1kYDtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFBhcnNlIHRoZSBtYXJrZG93biBjb250ZW50XG4gICAgICAgICAgY29uc3QgZmlsZUNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBmaWxlQ2FjaGU/LmZyb250bWF0dGVyO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEJ1aWxkIGZvcm1hdHRlZCBjb250ZW50XG4gICAgICAgICAgbGV0IGZvcm1hdHRlZENvbnRlbnQgPSAnJztcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBZGQgdGl0bGVcbiAgICAgICAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8dGl0bGU+XFxuJztcbiAgICAgICAgICBmb3JtYXR0ZWRDb250ZW50ICs9IGZyb250bWF0dGVyPy50aXRsZSB8fCBjaGF0SWQ7XG4gICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSAnXFxuPC90aXRsZT5cXG5cXG4nO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFkZCBzeXN0ZW0gcHJvbXB0XG4gICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSAnPHN5c3RlbV9wcm9tcHQ+XFxuJztcbiAgICAgICAgICBpZiAoZnJvbnRtYXR0ZXI/LnN5c3RlbU1lc3NhZ2U/LnR5cGUgPT09ICdjdXN0b20nICYmIGZyb250bWF0dGVyPy5zeXN0ZW1NZXNzYWdlPy5wYXRoKSB7XG4gICAgICAgICAgICAvLyBGb3IgY3VzdG9tIHByb21wdHMsIGdldCB0aGUgY29udGVudCBmcm9tIHRoZSBmaWxlXG4gICAgICAgICAgICBjb25zdCBwcm9tcHRQYXRoID0gZnJvbnRtYXR0ZXIuc3lzdGVtTWVzc2FnZS5wYXRoLnJlcGxhY2UoL15cXFtcXFsoLio/KVxcXVxcXSQvLCBcIiQxXCIpO1xuICAgICAgICAgICAgY29uc3QgcHJvbXB0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChgJHtwcm9tcHRQYXRofS5tZGApO1xuICAgICAgICAgICAgaWYgKHByb21wdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBwcm9tcHRDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChwcm9tcHRGaWxlKTtcbiAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSBwcm9tcHRDb250ZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3IgYnVpbHQtaW4gcHJvbXB0cywgZ2V0IGZyb20gdGhlIHNlcnZpY2VcbiAgICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwKTtcbiAgICAgICAgICAgIGNvbnN0IHByb21wdHMgPSBhd2FpdCBzeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdHMoKTtcbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IHByb21wdHMuZmluZChwID0+IHAuaWQgPT09IGZyb250bWF0dGVyPy5zeXN0ZW1NZXNzYWdlPy50eXBlKTtcbiAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgKz0gcHJvbXB0Py5zeXN0ZW1Qcm9tcHQgfHwgJ1N5c3RlbSBwcm9tcHQgbm90IGZvdW5kJztcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSAnXFxuPC9zeXN0ZW1fcHJvbXB0Plxcblxcbic7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWRkIGNvbnRleHQgZmlsZXNcbiAgICAgICAgICBpZiAoZnJvbnRtYXR0ZXI/LmNvbnRleHRfZmlsZXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRm91bmQgY29udGV4dCBmaWxlcyBpbiBmcm9udG1hdHRlcjpcIiwgZnJvbnRtYXR0ZXIuY29udGV4dF9maWxlcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNvbnRleHRGaWxlIG9mIGZyb250bWF0dGVyLmNvbnRleHRfZmlsZXMpIHtcbiAgICAgICAgICAgICAgY29uc3QgcmF3UGF0aCA9IHR5cGVvZiBjb250ZXh0RmlsZSA9PT0gJ3N0cmluZycgPyBjb250ZXh0RmlsZSA6IGNvbnRleHRGaWxlLnBhdGg7XG4gICAgICAgICAgICAgIC8vIFJlbW92ZSB3aWtpbGluayBicmFja2V0cyBhbmQgaGFuZGxlIGFueSBlc2NhcGluZ1xuICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHJhd1BhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIikucmVwbGFjZSgvXFxcXCsvZywgJy8nKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQcm9jZXNzaW5nIGNvbnRleHQgZmlsZSBwYXRoOlwiLCBmaWxlUGF0aCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBUcnkgZGlmZmVyZW50IHdheXMgdG8gcmVzb2x2ZSB0aGUgZmlsZVxuICAgICAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICAgIC8vIFRyeSBnZXR0aW5nIGZyb20gbWV0YWRhdGEgY2FjaGUgZmlyc3QgKGJlc3QgZm9yIHdpa2lsaW5rcylcbiAgICAgICAgICAgICAgICBmaWxlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChmaWxlUGF0aCwgXCJcIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKCFmaWxlICYmICFmaWxlUGF0aC5lbmRzV2l0aCgnLm1kJykpIHtcbiAgICAgICAgICAgICAgICAvLyBUcnkgd2l0aCAubWQgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChgJHtmaWxlUGF0aH0ubWRgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXNvbHZlZCBmaWxlOlwiLCBmaWxlPy5wYXRoKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IGluY2x1ZGUgdGV4dC1iYXNlZCBmaWxlc1xuICAgICAgICAgICAgICAgIGNvbnN0IHRleHRFeHRlbnNpb25zID0gWydtZCcsICd0eHQnLCAnanMnLCAndHMnLCAnanN4JywgJ3RzeCcsICdweScsICdqYXZhJywgJ2NwcCcsICdjJywgJ2gnLCAnY3NzJywgJ2h0bWwnLCAnanNvbicsICd5YW1sJywgJ3ltbCddO1xuICAgICAgICAgICAgICAgIGlmICh0ZXh0RXh0ZW5zaW9ucy5pbmNsdWRlcyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IHJlYWQgY29udGVudCBmcm9tICR7ZmlsZS5wYXRofWApO1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRDb250ZW50ICs9IGA8Y29udGV4dF9maWxlIG5hbWU9XCIke2ZpbGUuYmFzZW5hbWV9LiR7ZmlsZS5leHRlbnNpb259XCI+XFxuYDtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSBmaWxlQ29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSAnXFxuPC9jb250ZXh0X2ZpbGU+XFxuXFxuJztcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byByZWFkIGNvbnRleHQgZmlsZSAke2ZpbGUucGF0aH06YCwgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU2tpcHBpbmcgbm9uLXRleHQgZmlsZTogJHtmaWxlLnBhdGh9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDb3VsZCBub3QgcmVzb2x2ZSBmaWxlIGZvciBwYXRoOiAke2ZpbGVQYXRofWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTm8gY29udGV4dCBmaWxlcyBmb3VuZCBpbiBmcm9udG1hdHRlclwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gUGFyc2UgbWVzc2FnZXMgZnJvbSBIVE1MIGNvbW1lbnRzXG4gICAgICAgICAgY29uc3QgbWVzc2FnZVJlZ2V4ID0gLzwhLS0gU1lTVEVNU0NVTFBULU1FU1NBR0UtU1RBUlQgcm9sZT1cIihbXlwiXSspXCIgbWVzc2FnZS1pZD1cIihbXlwiXSspXCIgLS0+XFxuKFtcXHNcXFNdKj8pXFxuPCEtLSBTWVNURU1TQ1VMUFQtTUVTU0FHRS1FTkQgLS0+L2c7XG4gICAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICAgIHdoaWxlICgobWF0Y2ggPSBtZXNzYWdlUmVnZXguZXhlYyhjb250ZW50KSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IFtfLCByb2xlLCBtZXNzYWdlSWQsIG1lc3NhZ2VDb250ZW50XSA9IG1hdGNoO1xuICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCArPSBgPCR7cm9sZX1fbWVzc2FnZT5cXG4ke21lc3NhZ2VDb250ZW50LnRyaW0oKX1cXG48LyR7cm9sZX1fbWVzc2FnZT5cXG5cXG5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChmb3JtYXR0ZWRDb250ZW50KTtcbiAgICAgICAgICBzaG93RW5oYW5jZWROb3RpY2UoXCJcdTI3MTMgQ2hhdCBjb3BpZWQgdG8gY2xpcGJvYXJkIVwiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjb3B5IGNoYXQ6XCIsIGVycm9yKTtcbiAgICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiRmFpbGVkIHRvIGNvcHkgY2hhdCB0byBjbGlwYm9hcmRcIiwge1xuICAgICAgICAgICAgdGl0bGU6IFwiRXJyb3JcIixcbiAgICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICAgIGljb246IFwiYWxlcnQtY2lyY2xlXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2hvd1BvcHVwKHRoaXMuYXBwLCBcIkNoYXQgZmlsZSBub3QgZm91bmRcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICAgIGljb246IFwiYWxlcnQtY2lyY2xlXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBPcGVuIFJhdyBGaWxlIEJ1dHRvblxuICAgIGNvbnN0IG9wZW5SYXdCdXR0b24gPSB1dGlsaXR5QnV0dG9uR3JpZC5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWlucHV0LWFjdGlvbi1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiT3BlbiByYXcgY2hhdCBmaWxlXCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKG9wZW5SYXdCdXR0b24sIFwiZmlsZS1jb2RlXCIpO1xuICAgIG9wZW5SYXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnBsdWdpbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB0aGUgY3VycmVudCBjaGF0J3MgbGVhZiB2aWV3IHN0YXRlXG4gICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVMZWFmPy5nZXRWaWV3U3RhdGUoKTtcbiAgICAgIGNvbnN0IGNoYXRJZCA9IHN0YXRlPy5zdGF0ZT8uY2hhdElkO1xuXG4gICAgICBpZiAoIWNoYXRJZCkge1xuICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiQ291bGQgbm90IGRldGVybWluZSB3aGljaCBjaGF0IHRvIG9wZW5cIiwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPS1wiLFxuICAgICAgICAgIGljb246IFwiYWxlcnQtY2lyY2xlXCJcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLm9wdGlvbnMucGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5fS8ke2NoYXRJZH0ubWRgO1xuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dQb3B1cCh0aGlzLmFwcCwgXCJcIiwge1xuICAgICAgICAgIHRpdGxlOiBcIk9wZW4gUmF3IENoYXQgRmlsZVwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlx1MjZBMFx1RkUwRiBXYXJuaW5nOiBFZGl0aW5nIHRoZSByYXcgY2hhdCBmaWxlIGRpcmVjdGx5IG1heSBjb3JydXB0IHlvdXIgY2hhdCBoaXN0b3J5LiBPbmx5IHByb2NlZWQgaWYgeW91IGtub3cgd2hhdCB5b3UncmUgZG9pbmcuXCIsXG4gICAgICAgICAgcHJpbWFyeUJ1dHRvbjogXCJPcGVuIEZpbGVcIixcbiAgICAgICAgICBzZWNvbmRhcnlCdXR0b246IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgaWNvbjogXCJhbGVydC10cmlhbmdsZVwiXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShmaWxlKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJDaGF0IGZpbGUgbm90IGZvdW5kXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICBpY29uOiBcImFsZXJ0LWNpcmNsZVwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRGVsZXRlIENoYXQgQnV0dG9uXG4gICAgY29uc3QgZGVsZXRlQ2hhdEJ1dHRvbiA9IHV0aWxpdHlCdXR0b25HcmlkLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtaW5wdXQtYWN0aW9uLWJ1dHRvbiBzeXN0ZW1zY3VscHQtZGVsZXRlLWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJEZWxldGUgdGhpcyBjaGF0XCIgfSxcbiAgICB9KTtcbiAgICBzZXRJY29uKGRlbGV0ZUNoYXRCdXR0b24sIFwidHJhc2hcIik7XG4gICAgZGVsZXRlQ2hhdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucGx1Z2luKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IGNoYXQncyBsZWFmIHZpZXcgc3RhdGVcbiAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5hcHAud29ya3NwYWNlLmFjdGl2ZUxlYWY/LmdldFZpZXdTdGF0ZSgpO1xuICAgICAgY29uc3QgY2hhdElkID0gc3RhdGU/LnN0YXRlPy5jaGF0SWQ7XG5cbiAgICAgIGlmICghY2hhdElkKSB7XG4gICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJDb3VsZCBub3QgZGV0ZXJtaW5lIHdoaWNoIGNoYXQgdG8gZGVsZXRlXCIsIHtcbiAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgIHByaW1hcnlCdXR0b246IFwiT0tcIixcbiAgICAgICAgICBpY29uOiBcImFsZXJ0LWNpcmNsZVwiXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlbGV0ZUNvbmZpcm1lZCA9IGF3YWl0IHNob3dQb3B1cChcbiAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGNoYXQ/XCIsXG4gICAgICAgIHtcbiAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIkRlbGV0ZVwiLFxuICAgICAgICAgIHNlY29uZGFyeUJ1dHRvbjogXCJDYW5jZWxcIixcbiAgICAgICAgICBpY29uOiBcImFsZXJ0LXRyaWFuZ2xlXCJcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKGRlbGV0ZUNvbmZpcm1lZD8uY29uZmlybWVkKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5vcHRpb25zLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeX0vJHtjaGF0SWR9Lm1kYDtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5kZWxldGUoZmlsZSk7XG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5kZXRhY2goKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiXHUyNzE3IENoYXQgZGVsZXRlZFwiLCBcImVycm9yXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNob3dQb3B1cCh0aGlzLmFwcCwgXCJDaGF0IGZpbGUgbm90IGZvdW5kXCIsIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIk9LXCIsXG4gICAgICAgICAgICBpY29uOiBcImFsZXJ0LWNpcmNsZVwiXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE1haW4gYWN0aW9uIGJ1dHRvbnMgY29udGFpbmVyXG4gICAgY29uc3QgbWFpbkJ1dHRvbkNvbnRhaW5lciA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtbWFpbi1idXR0b24tY29udGFpbmVyXCIpO1xuICAgIG1haW5CdXR0b25Db250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIG1haW5CdXR0b25Db250YWluZXIuc3R5bGUuZ2FwID0gXCI4cHhcIjtcbiAgICBtYWluQnV0dG9uQ29udGFpbmVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgbWFpbkJ1dHRvbkNvbnRhaW5lci5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1lbmRcIjtcblxuICAgIGNvbnN0IHNlY29uZGFyeUJ1dHRvbiA9IG1haW5CdXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH07XG4gICAgc2Vjb25kYXJ5QnV0dG9uLm9uY2xpY2sgPSBoYW5kbGVDYW5jZWw7XG5cbiAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gbWFpbkJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIlNhdmVcIixcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uIG1vZC1jdGFcIixcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVTYXZlID0gKCkgPT4ge1xuICAgICAgLy8gRmluZCB3aGljaCBwcmVzZXQgaXMgYWN0aXZlXG4gICAgICBjb25zdCBhY3RpdmVCdXR0b24gPSB0aGlzLm1vZGFsRWwucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuc3lzdGVtc2N1bHB0LXByZXNldC1idXR0b24uYWN0aXZlXCJcbiAgICAgICk7XG4gICAgICBjb25zdCBhY3RpdmVQcmVzZXRMYWJlbCA9IGFjdGl2ZUJ1dHRvbj8udGV4dENvbnRlbnQgPz8gXCJcIjtcblxuICAgICAgbGV0IHJlc3VsdDogQ2hhdFN5c3RlbVByb21wdFJlc3VsdDtcblxuICAgICAgaWYgKGFjdGl2ZVByZXNldExhYmVsID09PSBcIkN1c3RvbVwiICYmIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUpIHtcbiAgICAgICAgLy8gUmVtb3ZlIC5tZCBleHRlbnNpb24gYW5kIGNvbnZlcnQgdG8gcmVsYXRpdmUgbGluayBmb3JtYXRcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3VzdG9tSW5wdXQudmFsdWUucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICBjb250ZW50OiB0aGlzLnRleHRBcmVhLnZhbHVlLFxuICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByZXNldCA9IHRoaXMuc3lzdGVtUHJvbXB0cy5maW5kKFxuICAgICAgICAgIChwKSA9PiBwLmxhYmVsID09PSBhY3RpdmVQcmVzZXRMYWJlbFxuICAgICAgICApO1xuICAgICAgICBpZiAocHJlc2V0KSB7XG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgY29udGVudDogcHJlc2V0LnN5c3RlbVByb21wdCxcbiAgICAgICAgICAgIHR5cGU6IHByZXNldC5pZCBhcyBcImdlbmVyYWwtdXNlXCIgfCBcImNvbmNpc2VcIiB8IFwiY3VzdG9tXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjayB0byBjdXJyZW50IGNvbnRlbnQgaWYgbm8gcHJlc2V0IGZvdW5kXG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgY29udGVudDogdGhpcy50ZXh0QXJlYS52YWx1ZSxcbiAgICAgICAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9O1xuICAgIHByaW1hcnlCdXR0b24ub25jbGljayA9IGhhbmRsZVNhdmU7XG5cbiAgICAvLyBIYW5kbGUga2V5Ym9hcmQgZXZlbnRzXG4gICAgdGhpcy5tb2RhbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgJiZcbiAgICAgICAgIWUuaXNDb21wb3NpbmcgJiZcbiAgICAgICAgIWUuc2hpZnRLZXkgJiZcbiAgICAgICAgZS50YXJnZXQgIT09IHRoaXMudGV4dEFyZWFcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVNhdmUoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVDYW5jZWwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJlc2V0QnV0dG9ucygpIHtcbiAgICBpZiAoIXRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICB0aGlzLnByZXNldEJ1dHRvbkNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgY29uc3QgcHJlc2V0cyA9IFtcbiAgICAgIC4uLnRoaXMuc3lzdGVtUHJvbXB0cyxcbiAgICAgIC4uLighdGhpcy5zeXN0ZW1Qcm9tcHRzLnNvbWUocCA9PiBwLmlkID09PSBcImN1c3RvbVwiKSA/IFt7XG4gICAgICAgIGlkOiBcImN1c3RvbVwiLFxuICAgICAgICBsYWJlbDogXCJDdXN0b21cIixcbiAgICAgICAgaXNVc2VyQ29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBzeXN0ZW1Qcm9tcHQ6IHRoaXMuY3VycmVudFByb21wdCB8fCBcIlwiXG4gICAgICB9XSA6IFtdKVxuICAgIF07XG5cbiAgICBwcmVzZXRzLmZvckVhY2gocHJlc2V0ID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMucHJlc2V0QnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgdGV4dDogcHJlc2V0LmxhYmVsLFxuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByZXNldC1idXR0b25cIlxuICAgICAgfSk7XG5cbiAgICAgIGlmIChwcmVzZXQubGFiZWwgPT09IHRoaXMuYWN0aXZlUHJlc2V0KSB7XG4gICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgdGhpcy51cGRhdGVVSUZvclByZXNldChwcmVzZXQpO1xuICAgICAgfVxuXG4gICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5wcmVzZXRCdXR0b25Db250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zeXN0ZW1zY3VscHQtcHJlc2V0LWJ1dHRvblwiKVxuICAgICAgICAgIC5mb3JFYWNoKGJ0biA9PiBidG4ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIHRoaXMuYWN0aXZlUHJlc2V0ID0gcHJlc2V0LmxhYmVsO1xuICAgICAgICB0aGlzLnVwZGF0ZVVJRm9yUHJlc2V0KHByZXNldCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVVSUZvclByZXNldChwcmVzZXQ6IFN5c3RlbVByb21wdFByZXNldCkge1xuICAgIGlmIChwcmVzZXQubGFiZWwgPT09IFwiQ3VzdG9tXCIpIHtcbiAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgdGhpcy5jdXN0b21JbnB1dC5mb2N1cygpO1xuICAgICAgdGhpcy50ZXh0QXJlYS5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgLy8gT25seSBzZXQgY3VzdG9tSW5wdXQgaWYgd2UgaGF2ZSBhIHZhbGlkIGN1c3RvbVByb21wdEZpbGVQYXRoIGFuZCBpdCBoYXNuJ3QgYmVlbiBzZXQgeWV0XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmN1c3RvbVByb21wdEZpbGVQYXRoICYmICF0aGlzLmN1c3RvbUlucHV0LnZhbHVlKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tSW5wdXQudmFsdWUgPSB0aGlzLm9wdGlvbnMuY3VzdG9tUHJvbXB0RmlsZVBhdGgucmVwbGFjZSgvXlxcW1xcWyguKj8pXFxdXFxdJC8sIFwiJDFcIik7XG4gICAgICB9XG4gICAgICAvLyBLZWVwIGN1cnJlbnQgcHJvbXB0IGZvciBjdXN0b20gcHJlc2V0XG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gdGhpcy5jdXJyZW50UHJvbXB0IHx8IFwiXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VzdG9tU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB0aGlzLnRleHRBcmVhLnZhbHVlID0gcHJlc2V0LnN5c3RlbVByb21wdDtcbiAgICAgIHRoaXMudGV4dEFyZWEucmVhZE9ubHkgPSAhcHJlc2V0LmlzVXNlckNvbmZpZ3VyYWJsZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRTeXN0ZW1Qcm9tcHRzKCkge1xuICAgIGNvbnNvbGUudGltZShcImxvYWRTeXN0ZW1Qcm9tcHRzXCIpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcm9tcHRzID0gYXdhaXQgdGhpcy5zeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldFN5c3RlbVByb21wdHMoKTtcbiAgICAgIHRoaXMucmVuZGVyUHJvbXB0cyhwcm9tcHRzKTtcbiAgICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc3lzdGVtIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBjb25zb2xlLnRpbWVFbmQoXCJsb2FkU3lzdGVtUHJvbXB0c1wiKTtcbiAgICB9XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yZXNvbHZlUHJvbWlzZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0aGlzLnJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8Q2hhdFN5c3RlbVByb21wdFJlc3VsdCB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgdGhpcy5vcGVuKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByb21wdHMocHJvbXB0czogU3lzdGVtUHJvbXB0UHJlc2V0W10pIHtcbiAgICBpZiAoIXRoaXMucHJvbXB0c0NvbnRhaW5lcikge1xuICAgICAgdGhpcy5wcm9tcHRzQ29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LXByb21wdHMtY29udGFpbmVyXCIpO1xuICAgIH1cbiAgICB0aGlzLnByb21wdHNDb250YWluZXIuZW1wdHkoKTtcbiAgICBcbiAgICBwcm9tcHRzLmZvckVhY2goKHByb21wdDogU3lzdGVtUHJvbXB0UHJlc2V0KSA9PiB7XG4gICAgICBjb25zdCBwcm9tcHRFbCA9IHRoaXMucHJvbXB0c0NvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtcHJvbXB0LWl0ZW1cIik7XG4gICAgICBwcm9tcHRFbC5zZXRUZXh0KHByb21wdC5sYWJlbCk7XG4gICAgICBwcm9tcHRFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmN1cnJlbnRQcm9tcHQgPSBwcm9tcHQuc3lzdGVtUHJvbXB0O1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGlkZUxvYWRpbmcoKSB7XG4gICAgaWYgKHRoaXMubG9hZGluZ0luZGljYXRvcikge1xuICAgICAgdGhpcy5sb2FkaW5nSW5kaWNhdG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3dFcnJvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuY29udGVudENvbnRhaW5lcikgcmV0dXJuO1xuICAgIFxuICAgIHRoaXMuc2hvd0xvYWRpbmcoZmFsc2UpO1xuICAgIGNvbnN0IGVycm9yRWwgPSB0aGlzLmNvbnRlbnRDb250YWluZXIuY3JlYXRlRGl2KFwic3lzdGVtc2N1bHB0LWVycm9yLW1lc3NhZ2VcIik7XG4gICAgZXJyb3JFbC5zZXRUZXh0KG1lc3NhZ2UpO1xuICAgIFxuICAgIC8vIEFkZCByZXRyeSBidXR0b25cbiAgICBjb25zdCByZXRyeUJ1dHRvbiA9IGVycm9yRWwuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJSZXRyeVwiLFxuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24gbW9kLWN0YVwiXG4gICAgfSk7XG4gICAgcmV0cnlCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IHtcbiAgICAgIGVycm9yRWwucmVtb3ZlKCk7XG4gICAgICB0aGlzLnNob3dMb2FkaW5nKHRydWUpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU3lzdGVtUHJvbXB0cygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlJldHJ5IGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgICB0aGlzLnNob3dFcnJvcihcIkZhaWxlZCB0byBsb2FkIHN5c3RlbSBwcm9tcHRzLiBQbGVhc2UgdHJ5IGFnYWluLlwiKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gSGVscGVyIG1ldGhvZCB0byBjcmVhdGUgY29uc2lzdGVudCBzZWN0aW9uIGhlYWRlcnNcbiAgcHJpdmF0ZSBjcmVhdGVTZWN0aW9uSGVhZGVyKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHRleHQ6IHN0cmluZykge1xuICAgIGNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1oZWFkZXJcIik7XG4gICAgaGVhZGVyLnN0eWxlLmZvbnRTaXplID0gXCIwLjhlbVwiO1xuICAgIGhlYWRlci5zdHlsZS50ZXh0VHJhbnNmb3JtID0gXCJ1cHBlcmNhc2VcIjtcbiAgICBoZWFkZXIuc3R5bGUuY29sb3IgPSBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgaGVhZGVyLnN0eWxlLmZvbnRXZWlnaHQgPSBcIjYwMFwiO1xuICAgIGhlYWRlci5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjAuNXJlbVwiO1xuICAgIGhlYWRlci5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gXCIwLjA1ZW1cIjtcbiAgICBoZWFkZXIuc2V0VGV4dCh0ZXh0KTtcbiAgICByZXR1cm4gaGVhZGVyO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93Q2hhdFN5c3RlbVByb21wdE1vZGFsKFxuICBhcHA6IEFwcCxcbiAgY3VycmVudFByb21wdDogc3RyaW5nLFxuICBvcHRpb25zPzogUGFydGlhbDxDaGF0U3lzdGVtUHJvbXB0TW9kYWxPcHRpb25zPlxuKTogUHJvbWlzZTxDaGF0U3lzdGVtUHJvbXB0UmVzdWx0IHwgbnVsbD4ge1xuICBjb25zdCBkZWZhdWx0T3B0aW9uczogQ2hhdFN5c3RlbVByb21wdE1vZGFsT3B0aW9ucyA9IHtcbiAgICBzeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5OiBcIlN5c3RlbVNjdWxwdC9TeXN0ZW0gUHJvbXB0c1wiLFxuICB9O1xuXG4gIGNvbnN0IG1vZGFsID0gbmV3IENoYXRTeXN0ZW1Qcm9tcHRNb2RhbChhcHAsIHtcbiAgICAuLi5kZWZhdWx0T3B0aW9ucyxcbiAgICAuLi5vcHRpb25zLFxuICB9KTtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kYWwub3BlbkFuZEdldFZhbHVlKCk7XG5cbiAgaWYgKHJlc3VsdCAhPT0gbnVsbCAmJiBvcHRpb25zPy5vblNhdmUpIHtcbiAgICBhd2FpdCBvcHRpb25zLm9uU2F2ZShyZXN1bHQuY29udGVudCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufSAiLCAiaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi9DaGF0Vmlld1wiO1xuaW1wb3J0IHsgc2hvd0NoYXRTeXN0ZW1Qcm9tcHRNb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvQ2hhdFN5c3RlbVByb21wdE1vZGFsXCI7XG5cbmV4cG9ydCBjb25zdCBzeXN0ZW1Qcm9tcHRIYW5kbGluZyA9IHtcbiAgaGFuZGxlU3lzdGVtUHJvbXB0RWRpdDogYXN5bmMgZnVuY3Rpb24oY2hhdFZpZXc6IENoYXRWaWV3KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNob3dDaGF0U3lzdGVtUHJvbXB0TW9kYWwoY2hhdFZpZXcuYXBwLCBcIlwiLCB7XG4gICAgICAgIHN5c3RlbVByb21wdHNEaXJlY3Rvcnk6IGNoYXRWaWV3LnBsdWdpbi5zZXR0aW5ncy5zeXN0ZW1Qcm9tcHRzRGlyZWN0b3J5LFxuICAgICAgICBjdXN0b21Qcm9tcHRGaWxlUGF0aDogY2hhdFZpZXcuc3lzdGVtUHJvbXB0UGF0aCxcbiAgICAgICAgbW9kZWxDb250ZXh0TGVuZ3RoOiBhd2FpdCBjaGF0Vmlldy5nZXRNb2RlbENvbnRleHRMZW5ndGgoKSxcbiAgICAgICAgdG9rZW5MaW1pdFBlcmNlbnRhZ2U6IGNoYXRWaWV3LnRva2VuTGltaXRQZXJjZW50YWdlLFxuICAgICAgICBwbHVnaW46IGNoYXRWaWV3LnBsdWdpbixcbiAgICAgICAgb25Nb2RlbFNlbGVjdDogYXN5bmMgKG1vZGVsSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNoYXRWaWV3LnNlbGVjdGVkTW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgICAgICAgYXdhaXQgY2hhdFZpZXcudXBkYXRlTW9kZWxJbmRpY2F0b3IoKTtcbiAgICAgICAgfSxcbiAgICAgICAgY3VycmVudE1vZGVsSWQ6IGNoYXRWaWV3LnNlbGVjdGVkTW9kZWxJZCxcbiAgICAgICAgY3VycmVudFByb21wdDogYXdhaXQgY2hhdFZpZXcuZ2V0Q3VycmVudFN5c3RlbVByb21wdCgpLFxuICAgICAgICBjaGF0VGl0bGU6IGNoYXRWaWV3LmNoYXRUaXRsZSxcbiAgICAgICAgbWVzc2FnZXM6IGNoYXRWaWV3LmdldE1lc3NhZ2VzKCksXG4gICAgICAgIG9uVGl0bGVDaGFuZ2U6IGFzeW5jIChuZXdUaXRsZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2V0VGl0bGUobmV3VGl0bGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICBjaGF0Vmlldy5zeXN0ZW1Qcm9tcHRUeXBlID0gcmVzdWx0LnR5cGU7XG4gICAgICAgIGNoYXRWaWV3LnN5c3RlbVByb21wdFBhdGggPSByZXN1bHQucGF0aDtcbiAgICAgICAgY2hhdFZpZXcudG9rZW5MaW1pdCA9IHJlc3VsdC50b2tlbkxpbWl0O1xuICAgICAgICBjaGF0Vmlldy50b2tlbkxpbWl0UGVyY2VudGFnZSA9IHJlc3VsdC50b2tlbkxpbWl0UGVyY2VudGFnZTtcbiAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2F2ZUNoYXQoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVkaXRpbmcgc3lzdGVtIHByb21wdDpcIiwgZXJyb3IpO1xuICAgICAgY2hhdFZpZXcuaGFuZGxlRXJyb3IoXCJGYWlsZWQgdG8gZWRpdCBzeXN0ZW0gcHJvbXB0XCIpO1xuICAgIH1cbiAgfVxufTsiLCAiaW1wb3J0IHtcbiAgQXBwLFxuICBNZW51LFxuICBOb3RpY2UsXG4gIFRGaWxlLFxuICBURm9sZGVyLFxuICBWYXVsdCxcbiAgc2V0SWNvbixcbiAgTWFya2Rvd25WaWV3LFxufSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN5c3RlbVNjdWxwdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU3lzdGVtU2N1bHB0U2VydmljZVwiO1xuaW1wb3J0IHsgU1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMgfSBmcm9tIFwiLi4vY29uc3RhbnRzL2FwaVwiO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvVHJhbnNjcmlwdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IENoYXRWaWV3IH0gZnJvbSBcIi4uL3ZpZXdzL2NoYXR2aWV3L0NoYXRWaWV3XCI7XG5pbXBvcnQgdHlwZSBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IEF1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbFwiO1xuaW1wb3J0IHsgc2hvd0F1ZGlvVHJhbnNjcmlwdGlvbk1vZGFsIH0gZnJvbSBcIi4uL21vZGFscy9BdWRpb1RyYW5zY3JpcHRpb25Nb2RhbFwiO1xuXG4vLyBGb3IgYSB0eXBpY2FsIE9ic2lkaWFuIHBsdWdpbiwgeW91J2QgaW5pdGlhbGl6ZSB0aGlzIGluIHlvdXIgbWFpbiBwbHVnaW4gY2xhc3MuXG5cbmV4cG9ydCBjbGFzcyBTeXN0ZW1TY3VscHRDb250ZXh0TWVudSB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIHByaXZhdGUgc2N1bHB0U2VydmljZTogU3lzdGVtU2N1bHB0U2VydmljZTtcbiAgcHJpdmF0ZSB0cmFuc2NyaXB0aW9uU2VydmljZTogVHJhbnNjcmlwdGlvblNlcnZpY2U7XG4gIHByaXZhdGUgc3RhdHVzQmFySXRlbTogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcm9ncmVzc01vZGFsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzQmFyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzU3RhdHVzOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzQnV0dG9uczogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhcHA6IEFwcCxcbiAgICBzY3VscHRTZXJ2aWNlOiBTeXN0ZW1TY3VscHRTZXJ2aWNlLFxuICAgIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luXG4gICkge1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMuc2N1bHB0U2VydmljZSA9IHNjdWxwdFNlcnZpY2U7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZSA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldEluc3RhbmNlKHBsdWdpbik7XG4gICAgdGhpcy5yZWdpc3RlckNvbnRleHRNZW51KCk7XG4gICAgdGhpcy5pbml0aWFsaXplU3RhdHVzQmFyKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVTdGF0dXNCYXIoKSB7XG4gICAgdGhpcy5zdGF0dXNCYXJJdGVtID0gdGhpcy5hcHAud29ya3NwYWNlLmNvbnRhaW5lckVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXN0YXR1cy1iYXJcIixcbiAgICB9KTtcbiAgICB0aGlzLnN0YXR1c0Jhckl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlckNvbnRleHRNZW51KCkge1xuICAgIC8vIFJlZ2lzdGVyIHRoZSBlZGl0b3IgbWVudSBldmVudCBmb3IgdGV4dCBtb2RpZmljYXRpb25cbiAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJlZGl0b3ItbWVudVwiLCAobWVudSwgZWRpdG9yLCB2aWV3KSA9PiB7XG4gICAgICBpZiAoISh2aWV3IGluc3RhbmNlb2YgTWFya2Rvd25WaWV3KSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICBpZiAoIXNlbGVjdGlvbikgcmV0dXJuO1xuXG4gICAgfSk7XG5cbiAgICAvLyBSZWdpc3RlciB0aGUgZmlsZSBtZW51IGV2ZW50IGZvciBhdWRpbyBmaWxlc1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImZpbGUtbWVudVwiLCAobWVudSwgZmlsZSkgPT4ge1xuICAgICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAvLyBBZGQgXCJDaGF0IHdpdGggRmlsZVwiIGZvciBhbGwgc3VwcG9ydGVkIGZpbGUgdHlwZXNcbiAgICAgIGlmIChcbiAgICAgICAgLy8gVGV4dCBmaWxlc1xuICAgICAgICBbXCJtZFwiLCBcInR4dFwiLCBcIm1hcmtkb3duXCJdLmluY2x1ZGVzKGV4dGVuc2lvbikgfHxcbiAgICAgICAgLy8gRG9jdW1lbnRzICh3aWxsIGJlIGF1dG8tZXh0cmFjdGVkKVxuICAgICAgICBbXCJwZGZcIiwgXCJkb2NcIiwgXCJkb2N4XCIsIFwicHB0XCIsIFwicHB0eFwiLCBcInhsc1wiLCBcInhsc3hcIl0uaW5jbHVkZXMoXG4gICAgICAgICAgZXh0ZW5zaW9uXG4gICAgICAgICkgfHxcbiAgICAgICAgLy8gQXVkaW8gZmlsZXMgKHdpbGwgYmUgYXV0by10cmFuc2NyaWJlZClcbiAgICAgICAgW1wibXAzXCIsIFwid2F2XCIsIFwibTRhXCIsIFwib2dnXCIsIFwid2VibVwiXS5pbmNsdWRlcyhleHRlbnNpb24pIHx8XG4gICAgICAgIC8vIEltYWdlcyAoZm9yIHZpc2lvbiBtb2RlbHMpXG4gICAgICAgIFtcImpwZ1wiLCBcImpwZWdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJ3ZWJwXCIsIFwic3ZnXCJdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICAgICkge1xuICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJTeXN0ZW1TY3VscHQgLSBDaGF0IHdpdGggRmlsZVwiKVxuICAgICAgICAgICAgLnNldEljb24oXCJtZXNzYWdlLXNxdWFyZVwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3IENoYXRWaWV3KGxlYWYsIHRoaXMucGx1Z2luKTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW4odmlldyk7XG4gICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIGF3YWl0IHZpZXcuYWRkRmlsZVRvQ29udGV4dChmaWxlKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIG9wZW4gY2hhdCB3aXRoIGZpbGVcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNoYXQgb3BlbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBhdWRpbyBmaWxlc1xuICAgICAgaWYgKFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJtcDNcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ3YXZcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJ3ZWJtXCJcbiAgICAgICkge1xuICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJTeXN0ZW1TY3VscHQgLSBUcmFuc2NyaWJlIEF1ZGlvXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcIm1pY3JvcGhvbmVcIilcbiAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZUF1ZGlvVHJhbnNjcmlwdGlvbihmaWxlLCBmYWxzZSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZhaWxlZCB0byB0cmFuc2NyaWJlIGF1ZGlvIGZpbGVcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlRyYW5zY3JpcHRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBuZXcgbWVudSBpdGVtIGZvciB0aW1lc3RhbXBlZCB0cmFuc2NyaXB0aW9uXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5zZXRUaXRsZShcIlN5c3RlbVNjdWxwdCAtIFRyYW5zY3JpYmUgQXVkaW8gKFRpbWVzdGFtcGVkKVwiKVxuICAgICAgICAgICAgLnNldEljb24oXCJjbG9ja1wiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQXVkaW9UcmFuc2NyaXB0aW9uKGZpbGUsIHRydWUpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gdHJhbnNjcmliZSBhdWRpbyBmaWxlIHdpdGggdGltZXN0YW1wc1wiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVGltZXN0YW1wZWQgdHJhbnNjcmlwdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBkb2N1bWVudCBmaWxlc1xuICAgICAgaWYgKFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJwZGZcIiB8fFxuICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gXCJkb2N4XCIgfHxcbiAgICAgICAgZmlsZS5leHRlbnNpb24gPT09IFwiZG9jXCJcbiAgICAgICkge1xuICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJTeXN0ZW1TY3VscHQgLSBDb252ZXJ0IHRvIE1hcmtkb3duXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcImZpbGUtdGV4dFwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlRG9jdW1lbnRDb252ZXJzaW9uKGZpbGUpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gY29udmVydCBkb2N1bWVudFwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRG9jdW1lbnQgY29udmVyc2lvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZURvY3VtZW50Q29udmVyc2lvbihmaWxlOiBURmlsZSkge1xuICAgIHRoaXMuY3JlYXRlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3NNb2RhbCgwLCBcIlByb2Nlc3NpbmcgeW91ciBkb2N1bWVudC4uLlwiLCBcImxvYWRlci0yXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNtYWxsIGRlbGF5IHRvIGVuc3VyZSB1c2VycyBzZWUgdGhlIGluaXRpYWwgcHJvY2Vzc2luZyBtZXNzYWdlXG4gICAgICBhd2FpdCB0aGlzLnNsZWVwKDEwMDApO1xuXG4gICAgICAvLyBTaG93IHVwbG9hZCBzdGF0dXNcbiAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3NNb2RhbCgxMCwgXCJVcGxvYWRpbmcgZG9jdW1lbnQuLi5cIiwgXCJ1cGxvYWRcIik7XG5cbiAgICAgIC8vIFVwbG9hZCB0aGUgZmlsZVxuICAgICAgY29uc3QgeyBkb2N1bWVudElkLCBzdGF0dXMsIGNhY2hlZCB9ID1cbiAgICAgICAgYXdhaXQgdGhpcy5zY3VscHRTZXJ2aWNlLnVwbG9hZERvY3VtZW50KGZpbGUpO1xuXG4gICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3NNb2RhbCg1MCwgXCJGb3VuZCBjYWNoZWQgdmVyc2lvblwiLCBcImNoZWNrXCIpO1xuICAgICAgICBjb25zdCBleHRyYWN0aW9uRGF0YSA9IGF3YWl0IHRoaXMuZG93bmxvYWRFeHRyYWN0aW9uKGRvY3VtZW50SWQpO1xuICAgICAgICBjb25zdCBleHRyYWN0aW9uUGF0aCA9IGF3YWl0IHRoaXMuc2F2ZUV4dHJhY3Rpb25SZXN1bHRzKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgZXh0cmFjdGlvbkRhdGFcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDEwMCwgXCJQcm9jZXNzaW5nIGNvbXBsZXRlIVwiLCBcImNoZWNrLWNpcmNsZVwiKTtcbiAgICAgICAgdGhpcy5zaG93Q29tcGxldGlvbkJ1dHRvbnMoZXh0cmFjdGlvblBhdGgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3NNb2RhbCgzMCwgXCJQcm9jZXNzaW5nIGRvY3VtZW50Li4uXCIsIFwibG9hZGVyLTJcIik7XG5cbiAgICAgIC8vIFBvbGwgZm9yIHN0YXR1cyB1bnRpbCBjb21wbGV0ZWRcbiAgICAgIGNvbnN0IHBvbGxSZXN1bHQgPSBhd2FpdCB0aGlzLnBvbGxVbnRpbENvbXBsZXRlKGRvY3VtZW50SWQpO1xuXG4gICAgICBpZiAoIXBvbGxSZXN1bHQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDAsIFwiUHJvY2Vzc2luZyBpbmNvbXBsZXRlXCIsIFwiYWxlcnQtY2lyY2xlXCIpO1xuICAgICAgICBhd2FpdCB0aGlzLnNsZWVwKDMwMDApO1xuICAgICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3NNb2RhbCg4MCwgXCJEb3dubG9hZGluZyByZXN1bHRzLi4uXCIsIFwiZG93bmxvYWRcIik7XG5cbiAgICAgIC8vIERvd25sb2FkIGV4dHJhY3Rpb25cbiAgICAgIGNvbnN0IGV4dHJhY3Rpb25EYXRhID0gYXdhaXQgdGhpcy5kb3dubG9hZEV4dHJhY3Rpb24oZG9jdW1lbnRJZCk7XG4gICAgICBjb25zdCBleHRyYWN0aW9uUGF0aCA9IGF3YWl0IHRoaXMuc2F2ZUV4dHJhY3Rpb25SZXN1bHRzKFxuICAgICAgICBmaWxlLFxuICAgICAgICBleHRyYWN0aW9uRGF0YVxuICAgICAgKTtcblxuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKDEwMCwgXCJQcm9jZXNzaW5nIGNvbXBsZXRlIVwiLCBcImNoZWNrLWNpcmNsZVwiKTtcbiAgICAgIHRoaXMuc2hvd0NvbXBsZXRpb25CdXR0b25zKGV4dHJhY3Rpb25QYXRoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU3lzdGVtU2N1bHB0IGVycm9yXCIsIGUpO1xuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKFxuICAgICAgICAwLFxuICAgICAgICBgRXJyb3I6ICR7ZSBpbnN0YW5jZW9mIEVycm9yID8gZS5tZXNzYWdlIDogU3RyaW5nKGUpfWAsXG4gICAgICAgIFwieC1jaXJjbGVcIlxuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoNTAwMCk7XG4gICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlQXVkaW9UcmFuc2NyaXB0aW9uKFxuICAgIGZpbGU6IFRGaWxlLFxuICAgIHRpbWVzdGFtcGVkOiBib29sZWFuXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzaG93QXVkaW9UcmFuc2NyaXB0aW9uTW9kYWwodGhpcy5hcHAsIHtcbiAgICAgICAgZmlsZSxcbiAgICAgICAgdGltZXN0YW1wZWQsXG4gICAgICAgIHBsdWdpbjogdGhpcy5wbHVnaW4sXG4gICAgICAgIG9uVHJhbnNjcmlwdGlvbkNvbXBsZXRlOiBhc3luYyAodGV4dDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSBvdXRwdXQgZmlsZVxuICAgICAgICAgIGNvbnN0IGJhc2VOYW1lID0gZmlsZS5iYXNlbmFtZTtcbiAgICAgICAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gdGltZXN0YW1wZWQgPyBcInNydFwiIDogXCJtZFwiO1xuICAgICAgICAgIGNvbnN0IG91dHB1dFBhdGggPSBgJHtcbiAgICAgICAgICAgIGZpbGUucGFyZW50Py5wYXRoIHx8IFwiXCJcbiAgICAgICAgICB9LyR7YmFzZU5hbWV9LiR7ZmlsZUV4dGVuc2lvbn1gO1xuXG4gICAgICAgICAgLy8gRm9yIFNSVCBmaWxlcywgdXNlIHJhdyB0ZXh0LiBGb3IgTUQgZmlsZXMsIHRoZSB0ZXh0IGlzIGFscmVhZHkgZm9ybWF0dGVkXG4gICAgICAgICAgY29uc3QgY29udGVudCA9IHRpbWVzdGFtcGVkID8gdGV4dCA6IHRleHQ7XG5cbiAgICAgICAgICAvLyBDcmVhdGUgb3IgdXBkYXRlIHRoZSBmaWxlXG4gICAgICAgICAgbGV0IHRyYW5zY3JpcHRpb25GaWxlOiBURmlsZTtcbiAgICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgob3V0cHV0UGF0aCk7XG4gICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZXhpc3RpbmdGaWxlLCBjb250ZW50KTtcbiAgICAgICAgICAgIHRyYW5zY3JpcHRpb25GaWxlID0gZXhpc3RpbmdGaWxlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0cmFuc2NyaXB0aW9uRmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShcbiAgICAgICAgICAgICAgb3V0cHV0UGF0aCxcbiAgICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBPcGVuIHRoZSB0cmFuc2NyaXB0aW9uIGZpbGUgaW4gYSBuZXcgbGVhZlxuICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihcInRhYlwiKTtcbiAgICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKHRyYW5zY3JpcHRpb25GaWxlKTtcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdWRpbyB0cmFuc2NyaXB0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJvZ3Jlc3NNb2RhbCgpIHtcbiAgICBpZiAodGhpcy5wcm9ncmVzc01vZGFsKSByZXR1cm47XG5cbiAgICB0aGlzLnByb2dyZXNzTW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMucHJvZ3Jlc3NNb2RhbC5jbGFzc05hbWUgPSBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1tb2RhbFwiO1xuXG4gICAgdGhpcy5wcm9ncmVzc0JhciA9IHRoaXMucHJvZ3Jlc3NNb2RhbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1iYXJcIlxuICAgICk7XG4gICAgdGhpcy5wcm9ncmVzc1N0YXR1cyA9IHRoaXMucHJvZ3Jlc3NNb2RhbC5jcmVhdGVEaXYoXG4gICAgICBcInN5c3RlbXNjdWxwdC1wcm9ncmVzcy1zdGF0dXNcIlxuICAgICk7XG4gICAgdGhpcy5wcm9ncmVzc0J1dHRvbnMgPSB0aGlzLnByb2dyZXNzTW9kYWwuY3JlYXRlRGl2KFxuICAgICAgXCJzeXN0ZW1zY3VscHQtcHJvZ3Jlc3MtYnV0dG9uc1wiXG4gICAgKTtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5wcm9ncmVzc01vZGFsKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUHJvZ3Jlc3NNb2RhbChwcm9ncmVzczogbnVtYmVyLCBzdGF0dXM6IHN0cmluZywgaWNvbjogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnByb2dyZXNzTW9kYWwgfHwgIXRoaXMucHJvZ3Jlc3NCYXIgfHwgIXRoaXMucHJvZ3Jlc3NTdGF0dXMpXG4gICAgICByZXR1cm47XG5cbiAgICB0aGlzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7cHJvZ3Jlc3N9JWA7XG4gICAgdGhpcy5wcm9ncmVzc1N0YXR1cy5lbXB0eSgpO1xuICAgIHNldEljb24odGhpcy5wcm9ncmVzc1N0YXR1cywgaWNvbik7XG4gICAgdGhpcy5wcm9ncmVzc1N0YXR1cy5jcmVhdGVTcGFuKHsgdGV4dDogc3RhdHVzIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93Q29tcGxldGlvbkJ1dHRvbnMoZXh0cmFjdGlvblBhdGg6IHN0cmluZykge1xuICAgIGlmICghdGhpcy5wcm9ncmVzc0J1dHRvbnMpIHJldHVybjtcblxuICAgIHRoaXMucHJvZ3Jlc3NCdXR0b25zLmVtcHR5KCk7XG5cbiAgICAvLyBWaWV3IGJ1dHRvblxuICAgIGNvbnN0IHZpZXdCdXR0b24gPSB0aGlzLnByb2dyZXNzQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICB0ZXh0OiBcIlZpZXcgUmVzdWx0XCIsXG4gICAgICBjbHM6IFwibW9kLWN0YVwiLFxuICAgIH0pO1xuICAgIHZpZXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZXh0cmFjdGlvblBhdGgpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKGZpbGUpO1xuICAgICAgfVxuICAgICAgdGhpcy5jbG9zZVByb2dyZXNzTW9kYWwoKTtcbiAgICB9KTtcblxuICAgIC8vIENsb3NlIGJ1dHRvblxuICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gdGhpcy5wcm9ncmVzc0J1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDbG9zZVwiLFxuICAgIH0pO1xuICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlUHJvZ3Jlc3NNb2RhbCgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjbG9zZVByb2dyZXNzTW9kYWwoKSB7XG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NNb2RhbCAmJiB0aGlzLnByb2dyZXNzTW9kYWwucGFyZW50Tm9kZSkge1xuICAgICAgdGhpcy5wcm9ncmVzc01vZGFsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wcm9ncmVzc01vZGFsKTtcbiAgICB9XG4gICAgdGhpcy5wcm9ncmVzc01vZGFsID0gbnVsbDtcbiAgICB0aGlzLnByb2dyZXNzQmFyID0gbnVsbDtcbiAgICB0aGlzLnByb2dyZXNzU3RhdHVzID0gbnVsbDtcbiAgICB0aGlzLnByb2dyZXNzQnV0dG9ucyA9IG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBvbGxVbnRpbENvbXBsZXRlKFxuICAgIGRvY3VtZW50SWQ6IHN0cmluZyxcbiAgICBtYXhBdHRlbXB0cyA9IDMwXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4QXR0ZW1wdHM7IGkrKykge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7XG4gICAgICAgICAgdGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmxcbiAgICAgICAgfSR7U1lTVEVNU0NVTFBUX0FQSV9FTkRQT0lOVFMuRE9DVU1FTlRTLkdFVChkb2N1bWVudElkKX1gLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjaGVjayBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZGF0YS5zdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IgfHwgXCJQcm9jZXNzaW5nIGZhaWxlZFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIHByb2dyZXNzIGJhc2VkIG9uIGF0dGVtcHQgbnVtYmVyXG4gICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKDMwICsgKGkgLyBtYXhBdHRlbXB0cykgKiA1MCwgODApO1xuICAgICAgdGhpcy51cGRhdGVQcm9ncmVzc01vZGFsKHByb2dyZXNzLCBcIlByb2Nlc3NpbmcgZG9jdW1lbnQuLi5cIiwgXCJsb2FkZXItMlwiKTtcblxuICAgICAgYXdhaXQgdGhpcy5zbGVlcCgyMDAwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRvd25sb2FkRXh0cmFjdGlvbihkb2N1bWVudElkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBgJHtcbiAgICAgICAgdGhpcy5zY3VscHRTZXJ2aWNlLmJhc2VVcmxcbiAgICAgIH0ke1NZU1RFTVNDVUxQVF9BUElfRU5EUE9JTlRTLkRPQ1VNRU5UUy5ET1dOTE9BRChkb2N1bWVudElkKX1gLFxuICAgICAge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGRvd25sb2FkIGV4dHJhY3Rpb246ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzYXZlRXh0cmFjdGlvblJlc3VsdHMoZmlsZTogVEZpbGUsIGRhdGE6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZXh0cmFjdGlvbkZvbGRlciA9IHRoaXMuc2N1bHB0U2VydmljZS5leHRyYWN0aW9uc0RpcmVjdG9yeTtcbiAgICBjb25zdCBiYXNlTmFtZSA9IHRoaXMuc2FuaXRpemVGaWxlbmFtZShmaWxlLmJhc2VuYW1lKTtcbiAgICBjb25zdCBwYXJlbnRQYXRoID0gZXh0cmFjdGlvbkZvbGRlclxuICAgICAgPyBgJHtleHRyYWN0aW9uRm9sZGVyfS8ke2Jhc2VOYW1lfWBcbiAgICAgIDogYCR7ZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIn0vJHtiYXNlTmFtZX1gO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSB0YXJnZXQgZm9sZGVyXG4gICAgYXdhaXQgdGhpcy5jcmVhdGVGb2xkZXIocGFyZW50UGF0aCk7XG5cbiAgICAvLyBDcmVhdGUgZXh0cmFjdGlvbiBmaWxlIHBhdGhcbiAgICBjb25zdCBleHRyYWN0aW9uUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChcbiAgICAgIGAke3BhcmVudFBhdGh9LyR7YmFzZU5hbWV9LWV4dHJhY3Rpb24ubWRgXG4gICAgKTtcblxuICAgIC8vIFNhdmUgdGhlIGV4dHJhY3Rpb24gY29udGVudFxuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmZvcm1hdEV4dHJhY3Rpb25Db250ZW50KGRhdGEpO1xuICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChleHRyYWN0aW9uUGF0aCk7XG4gICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZXhpc3RpbmdGaWxlLCBjb250ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGV4dHJhY3Rpb25QYXRoLCBjb250ZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXh0cmFjdGlvblBhdGg7XG4gIH1cblxuICBwcml2YXRlIHNhbml0aXplRmlsZW5hbWUoZmlsZW5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGZpbGVuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05LV8gXS9nLCBcIlwiKTtcbiAgfVxuXG4gIHByaXZhdGUgbm9ybWFsaXplUGF0aChwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBwYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpLnJlcGxhY2UoL1xcLysvZywgXCIvXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVGb2xkZXIocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSB0aGlzLm5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgaWYgKFxuICAgICAgISh0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgobm9ybWFsaXplZFBhdGgpIGluc3RhbmNlb2YgVEZvbGRlcilcbiAgICApIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihub3JtYWxpemVkUGF0aCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRFeHRyYWN0aW9uQ29udGVudChkYXRhOiBhbnkpOiBzdHJpbmcge1xuICAgIHJldHVybiBgIyAke2RhdGEudGl0bGUgfHwgXCJEb2N1bWVudCBFeHRyYWN0aW9uXCJ9XG5cbiR7ZGF0YS5jb250ZW50IHx8IFwiXCJ9XG5cbi0tLVxuRXh0cmFjdGVkIHdpdGggU3lzdGVtU2N1bHB0XG5gO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIFNldHRpbmdzTWFuYWdlciB7XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHNldHRpbmdzOiBTeXN0ZW1TY3VscHRTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBERUZBVUxUX1NFVFRJTkdTO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSBhd2FpdCB0aGlzLnBsdWdpbi5sb2FkRGF0YSgpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBsb2FkZWREYXRhKTtcblxuICAgIC8vIEVuc3VyZSBzZXJ2ZXIgVVJMIG1hdGNoZXMgZGV2ZWxvcG1lbnQgbW9kZVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRldmVsb3BtZW50TW9kZSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy5zZXJ2ZXJVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldHRpbmdzLnNlcnZlclVybCA9IFwiaHR0cHM6Ly9hcGkuc3lzdGVtc2N1bHB0LmNvbVwiO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB0aGlzLnBsdWdpbi5haVNlcnZpY2UudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBnZXRTZXR0aW5ncygpOiBTeXN0ZW1TY3VscHRTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTZXR0aW5ncyhuZXdTZXR0aW5nczogUGFydGlhbDxTeXN0ZW1TY3VscHRTZXR0aW5ncz4pIHtcbiAgICAvLyBGb3IgYSBjb21wbGV0ZSByZXNldCB0byBkZWZhdWx0cywgcmVwbGFjZSBlbnRpcmUgc2V0dGluZ3Mgb2JqZWN0XG4gICAgaWYgKG5ld1NldHRpbmdzID09PSBERUZBVUxUX1NFVFRJTkdTKSB7XG4gICAgICB0aGlzLnNldHRpbmdzID0geyAuLi5ERUZBVUxUX1NFVFRJTkdTIH07XG4gICAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEZvciBwYXJ0aWFsIHVwZGF0ZXMsIG1lcmdlIHdpdGggZXhpc3Rpbmcgc2V0dGluZ3NcbiAgICBpZiAobmV3U2V0dGluZ3MuZGV2ZWxvcG1lbnRNb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG5ld1NldHRpbmdzLnNlcnZlclVybCA9IG5ld1NldHRpbmdzLmRldmVsb3BtZW50TW9kZVxuICAgICAgICA/IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCJcbiAgICAgICAgOiBcImh0dHBzOi8vYXBpLnN5c3RlbXNjdWxwdC5jb21cIjtcbiAgICB9XG4gICAgdGhpcy5zZXR0aW5ncyA9IHsgLi4udGhpcy5zZXR0aW5ncywgLi4ubmV3U2V0dGluZ3MgfTtcbiAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IHNob3dQb3B1cCB9IGZyb20gXCIuLi91aVwiO1xuXG5leHBvcnQgY2xhc3MgTGljZW5zZU1hbmFnZXIge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIGxhc3RWYWxpZGF0aW9uVGltZTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgVkFMSURBVElPTl9JTlRFUlZBTCA9IDI0ICogNjAgKiA2MCAqIDEwMDA7IC8vIDI0IGhvdXJzXG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gIH1cblxuICBhc3luYyBpbml0aWFsaXplTGljZW5zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmxpY2Vuc2VLZXk/LnRyaW0oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gdmFsaWRhdGUgYmFzZWQgb24gdGltZSBpbnRlcnZhbFxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgc2hvdWxkVmFsaWRhdGUgPSBcbiAgICAgICF0aGlzLmxhc3RWYWxpZGF0aW9uVGltZSB8fCBcbiAgICAgIChub3cgLSB0aGlzLmxhc3RWYWxpZGF0aW9uVGltZSkgPiBMaWNlbnNlTWFuYWdlci5WQUxJREFUSU9OX0lOVEVSVkFMO1xuXG4gICAgaWYgKHNob3VsZFZhbGlkYXRlKSB7XG4gICAgICAvLyBEb24ndCBhd2FpdCAtIGxldCBpdCBydW4gaW4gYmFja2dyb3VuZFxuICAgICAgdGhpcy52YWxpZGF0ZUxpY2Vuc2VLZXkodHJ1ZSwgZmFsc2UpLnRoZW4oaXNWYWxpZCA9PiB7XG4gICAgICAgIGlmICghaXNWYWxpZCAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQpIHtcbiAgICAgICAgICAvLyBPbmx5IHNob3cgbm90aWNlIGlmIGxpY2Vuc2Ugd2FzIHByZXZpb3VzbHkgdmFsaWQgYW5kIGlzIG5vdyBpbnZhbGlkXG4gICAgICAgICAgbmV3IE5vdGljZShcIllvdXIgU3lzdGVtU2N1bHB0IFBybyBsaWNlbnNlIGlzIG5vIGxvbmdlciB2YWxpZC4gU29tZSBmZWF0dXJlcyBtYXkgYmUgdW5hdmFpbGFibGUuXCIsIDUwMDApO1xuICAgICAgICB9XG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIltTeXN0ZW1TY3VscHRdIEJhY2tncm91bmQgbGljZW5zZSB2YWxpZGF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGVMaWNlbnNlS2V5KGZvcmNlID0gZmFsc2UsIHNob3dSZWxvYWRQcm9tcHQgPSB0cnVlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlS2V5KSB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPSBmYWxzZTtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdGhpcy5wbHVnaW4uYWlTZXJ2aWNlLnZhbGlkYXRlTGljZW5zZShmb3JjZSk7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPSBpc1ZhbGlkO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICAgIHRoaXMubGFzdFZhbGlkYXRpb25UaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzaG93UmVsb2FkUHJvbXB0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2hvd1BvcHVwKFxuICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICBcIlBybyBmZWF0dXJlcyBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IGFjdGl2YXRlZCEgVG8gZW5zdXJlIGFsbCBmZWF0dXJlcyB3b3JrIHByb3Blcmx5LCBPYnNpZGlhbiBuZWVkcyB0byBiZSByZWxvYWRlZC5cIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiUmVsb2FkIHRvIENvbXBsZXRlIFVwZ3JhZGVcIixcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQ2xpY2sgdGhlIGJ1dHRvbiBiZWxvdyB0byByZWxvYWQgT2JzaWRpYW4gYW5kIHN0YXJ0IHVzaW5nIHlvdXIgUHJvIGZlYXR1cmVzLlwiLFxuICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uOiBcIlJlbG9hZCAmIFVwZ3JhZGVcIixcbiAgICAgICAgICAgICAgaWNvbjogXCJzcGFya2xlc1wiLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHJlc3VsdD8uY29uZmlybWVkKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTGljZW5zZSB2YWxpZGF0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWNlbnNlVmFsaWQgPSBmYWxzZTtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFRGaWxlLCBURm9sZGVyLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBzaG93UG9wdXAgfSBmcm9tIFwiLi4vY29yZS91aVwiO1xuXG5leHBvcnQgY2xhc3MgSmFuaXRvck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVNpemUoZmlsZXM6IFRGaWxlW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IHRvdGFsQnl0ZXMgPSBmaWxlcy5yZWR1Y2UoKGFjYywgZmlsZSkgPT4gYWNjICsgZmlsZS5zdGF0LnNpemUsIDApO1xuICAgIGlmICh0b3RhbEJ5dGVzID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJlbXB0eVwiO1xuICAgIH0gZWxzZSBpZiAodG90YWxCeXRlcyA8IDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHt0b3RhbEJ5dGVzfSBieXRlc2A7XG4gICAgfSBlbHNlIGlmICh0b3RhbEJ5dGVzIDwgMTAyNCAqIDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHsodG90YWxCeXRlcyAvIDEwMjQpLnRvRml4ZWQoMSl9IEtCYDtcbiAgICB9IGVsc2UgaWYgKHRvdGFsQnl0ZXMgPCAxMDI0ICogMTAyNCAqIDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHsodG90YWxCeXRlcyAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSl9IE1CYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEJ5dGVzIC8gKDEwMjQgKiAxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSl9IEdCYDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEZpbGVzSW5EaXJlY3RvcnkoZGlyZWN0b3J5OiBzdHJpbmcpOiBURmlsZVtdIHtcbiAgICByZXR1cm4gdGhpcy5hcHAudmF1bHRcbiAgICAgIC5nZXRGaWxlcygpXG4gICAgICAuZmlsdGVyKChmaWxlKSA9PiBmaWxlLnBhdGguc3RhcnRzV2l0aChkaXJlY3RvcnkpKTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzYWJsZUJ1dHRvbihidXR0b246IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBidXR0b24uYWRkQ2xhc3MoXCJtb2QtZGlzYWJsZWRcIik7XG4gICAgYnV0dG9uLnJlbW92ZUNsYXNzKFwibW9kLXdhcm5pbmdcIik7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUJ1dHRvblN0YXRlKFxuICAgIGJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQsXG4gICAgZmlsZXM6IFRGaWxlW10sXG4gICAgdHlwZTogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IHNpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoZmlsZXMpO1xuICAgIGNvbnN0IGhhc0ZpbGVzID0gZmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGlmIChoYXNGaWxlcykge1xuICAgICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoXCJtb2QtZGlzYWJsZWRcIik7XG4gICAgICBidXR0b24uYWRkQ2xhc3MoXCJtb2Qtd2FybmluZ1wiKTtcbiAgICAgIGJ1dHRvbi5zZXRUZXh0KGBDbGVhciBBbGwgJHt0eXBlfSAoJHtzaXplfSlgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcIm1vZC1kaXNhYmxlZFwiKTtcbiAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcyhcIm1vZC13YXJuaW5nXCIpO1xuICAgICAgYnV0dG9uLnNldFRleHQoYE5vICR7dHlwZX1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNsZWFuRGlyZWN0b3J5KGRpcmVjdG9yeTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRlbGV0aW9uIG9mIHJvb3Qgb3Igc3lzdGVtIGRpcmVjdG9yaWVzXG4gICAgaWYgKFxuICAgICAgIWRpcmVjdG9yeSB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi9cIiB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi5cIiB8fFxuICAgICAgZGlyZWN0b3J5ID09PSBcIi4uXCJcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBkZWxldGUgcm9vdCBvciBzeXN0ZW0gZGlyZWN0b3JpZXNcIik7XG4gICAgfVxuXG4gICAgLy8gR2V0IGFsbCBmaWxlcyBpbiB0aGUgZGlyZWN0b3J5XG4gICAgY29uc3QgZmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoZGlyZWN0b3J5KTtcblxuICAgIC8vIE1vdmUgZmlsZXMgdG8gdHJhc2hcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZpbGUsIHRydWUpO1xuICAgIH1cblxuICAgIC8vIEFmdGVyIGZpbGVzIGFyZSBtb3ZlZCB0byB0cmFzaCwgY2xlYW4gdXAgZW1wdHkgZGlyZWN0b3JpZXNcbiAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZGlyZWN0b3J5KTtcbiAgICBpZiAoZm9sZGVyIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgLy8gR2V0IGFsbCBzdWJkaXJlY3Rvcmllc1xuICAgICAgY29uc3Qgc3ViZGlycyA9IGZvbGRlci5jaGlsZHJlblxuICAgICAgICAuZmlsdGVyKChjaGlsZCk6IGNoaWxkIGlzIFRGb2xkZXIgPT4gY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5wYXRoLmxlbmd0aCAtIGEucGF0aC5sZW5ndGgpOyAvLyBTb3J0IGJ5IHBhdGggbGVuZ3RoIGRlc2NlbmRpbmcgdG8gZGVsZXRlIGRlZXBlc3QgZmlyc3RcblxuICAgICAgLy8gRGVsZXRlIHN1YmRpcmVjdG9yaWVzIGlmIHRoZXkncmUgZW1wdHlcbiAgICAgIGZvciAoY29uc3Qgc3ViZGlyIG9mIHN1YmRpcnMpIHtcbiAgICAgICAgaWYgKHN1YmRpci5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC50cmFzaChzdWJkaXIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSB0aGUgbWFpbiBkaXJlY3RvcnkgaWYgaXQncyBlbXB0eVxuICAgICAgaWYgKGZvbGRlci5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZm9sZGVyLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3dGaWxlUHJldmlldyhmaWxlczogVEZpbGVbXSwgdHlwZTogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic3lzdGVtc2N1bHB0LWZpbGUtdHJlZSBuYXYtZm9sZGVyXCI7XG5cbiAgICAvLyBBZGQgc3VtbWFyeSB0ZXh0XG4gICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3VtbWFyeS5jbGFzc05hbWUgPSBcIm5hdi1mb2xkZXItdGl0bGVcIjtcbiAgICBzdW1tYXJ5LnRleHRDb250ZW50ID0gYCR7ZmlsZXMubGVuZ3RofSAke3R5cGV9ICgke3RoaXMuY2FsY3VsYXRlU2l6ZShcbiAgICAgIGZpbGVzXG4gICAgKX0pYDtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3VtbWFyeSk7XG5cbiAgICAvLyBTb3J0IGZpbGVzIGJ5IHBhdGggZm9yIGJldHRlciBvcmdhbml6YXRpb25cbiAgICBjb25zdCBzb3J0ZWRGaWxlcyA9IGZpbGVzLnNvcnQoKGEsIGIpID0+IGEucGF0aC5sb2NhbGVDb21wYXJlKGIucGF0aCkpO1xuXG4gICAgLy8gR3JvdXAgZmlsZXMgYnkgZGlyZWN0b3J5XG4gICAgY29uc3QgZmlsZXNCeURpciA9IG5ldyBNYXA8c3RyaW5nLCBURmlsZVtdPigpO1xuICAgIGZvciAoY29uc3QgZmlsZSBvZiBzb3J0ZWRGaWxlcykge1xuICAgICAgY29uc3QgZGlyID0gZmlsZS5wYXJlbnQ/LnBhdGggfHwgXCJcIjtcbiAgICAgIGlmICghZmlsZXNCeURpci5oYXMoZGlyKSkge1xuICAgICAgICBmaWxlc0J5RGlyLnNldChkaXIsIFtdKTtcbiAgICAgIH1cbiAgICAgIGZpbGVzQnlEaXIuZ2V0KGRpcik/LnB1c2goZmlsZSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGZpbGUgdHJlZVxuICAgIGZvciAoY29uc3QgW2RpciwgZGlyRmlsZXNdIG9mIGZpbGVzQnlEaXIpIHtcbiAgICAgIGlmIChkaXIpIHtcbiAgICAgICAgY29uc3QgZm9sZGVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZm9sZGVyRGl2LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlclwiO1xuXG4gICAgICAgIGNvbnN0IGZvbGRlclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZm9sZGVyVGl0bGUuY2xhc3NOYW1lID0gXCJuYXYtZm9sZGVyLXRpdGxlXCI7XG4gICAgICAgIHNldEljb24oZm9sZGVyVGl0bGUsIFwiZm9sZGVyXCIpO1xuICAgICAgICBmb2xkZXJUaXRsZS5jcmVhdGVTcGFuKHsgdGV4dDogZGlyIH0pO1xuICAgICAgICBmb2xkZXJEaXYuYXBwZW5kQ2hpbGQoZm9sZGVyVGl0bGUpO1xuXG4gICAgICAgIGNvbnN0IGZvbGRlckNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBmb2xkZXJDb250ZW50LmNsYXNzTmFtZSA9IFwibmF2LWZvbGRlci1jaGlsZHJlblwiO1xuICAgICAgICBmb2xkZXJEaXYuYXBwZW5kQ2hpbGQoZm9sZGVyQ29udGVudCk7XG5cbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGRpckZpbGVzKSB7XG4gICAgICAgICAgZm9sZGVyQ29udGVudC5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUZpbGVJdGVtKGZpbGUpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmb2xkZXJEaXYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmlsZXMgaW4gcm9vdFxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZGlyRmlsZXMpIHtcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVGaWxlSXRlbShmaWxlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVGaWxlSXRlbShmaWxlOiBURmlsZSk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBmaWxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBmaWxlRGl2LmNsYXNzTmFtZSA9IFwibmF2LWZpbGVcIjtcblxuICAgIGNvbnN0IGZpbGVUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZmlsZVRpdGxlLmNsYXNzTmFtZSA9IFwibmF2LWZpbGUtdGl0bGVcIjtcblxuICAgIC8vIFNldCBhcHByb3ByaWF0ZSBpY29uIGJhc2VkIG9uIGZpbGUgdHlwZVxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IGljb25OYW1lID0gXCJmaWxlXCI7XG4gICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgaWNvbk5hbWUgPSBcImZpbGUtdGV4dFwiO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBbXCJqcGdcIiwgXCJqcGVnXCIsIFwicG5nXCIsIFwiZ2lmXCIsIFwid2VicFwiLCBcInN2Z1wiXS5pbmNsdWRlcyhleHRlbnNpb24pXG4gICAgKSB7XG4gICAgICBpY29uTmFtZSA9IFwiaW1hZ2VcIjtcbiAgICB9IGVsc2UgaWYgKFtcIm1wM1wiLCBcIndhdlwiLCBcIm9nZ1wiLCBcIm00YVwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiYXVkaW8tbGluZXNcIjtcbiAgICB9IGVsc2UgaWYgKFtcInBkZlwiXS5pbmNsdWRlcyhleHRlbnNpb24pKSB7XG4gICAgICBpY29uTmFtZSA9IFwiZmlsZS10ZXh0XCI7XG4gICAgfVxuICAgIHNldEljb24oZmlsZVRpdGxlLCBpY29uTmFtZSk7XG5cbiAgICAvLyBGaWxlIG5hbWVcbiAgICBmaWxlVGl0bGUuY3JlYXRlU3Bhbih7IHRleHQ6IGZpbGUubmFtZSB9KTtcblxuICAgIC8vIEZpbGUgc2l6ZVxuICAgIGNvbnN0IHNpemVTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgc2l6ZVNwYW4uY2xhc3NOYW1lID0gXCJuYXYtZmlsZS1zaXplXCI7XG4gICAgc2l6ZVNwYW4udGV4dENvbnRlbnQgPSB0aGlzLmNhbGN1bGF0ZVNpemUoW2ZpbGVdKTtcbiAgICBmaWxlVGl0bGUuYXBwZW5kQ2hpbGQoc2l6ZVNwYW4pO1xuXG4gICAgZmlsZURpdi5hcHBlbmRDaGlsZChmaWxlVGl0bGUpO1xuICAgIHJldHVybiBmaWxlRGl2O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgIGZpbGVzOiBURmlsZVtdLFxuICAgIHR5cGU6IHN0cmluZyxcbiAgICBkaXJlY3Rvcnk6IHN0cmluZyxcbiAgICBidXR0b246IEhUTUxCdXR0b25FbGVtZW50XG4gICkge1xuICAgIGNvbnN0IGNvbmZpcm1Nb2RhbCA9IG5ldyBNb2RhbCh0aGlzLmFwcCk7XG4gICAgY29uZmlybU1vZGFsLnRpdGxlRWwuc2V0VGV4dChgQ2xlYXIgJHt0eXBlfWApO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbmZpcm1Nb2RhbC5jb250ZW50RWw7XG4gICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgICAgdGV4dDogYFx1MjZBMFx1RkUwRiBXQVJOSU5HOiBUaGUgZm9sbG93aW5nIGZpbGVzIHdpbGwgYmUgbW92ZWQgdG8gdGhlIE9ic2lkaWFuIHRyYXNoLiBZb3UgY2FuIHJlc3RvcmUgdGhlbSBmcm9tIHRoZSB0cmFzaCBpZiBuZWVkZWQuYCxcbiAgICB9KTtcblxuICAgIC8vIEFkZCBmaWxlIHByZXZpZXcgbGlzdFxuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGhpcy5zaG93RmlsZVByZXZpZXcoZmlsZXMsIHR5cGUpKTtcblxuICAgIC8vIEFkZCBidXR0b25zXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1idXR0b25zXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIkNhbmNlbFwiIH0pO1xuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY29uZmlybU1vZGFsLmNsb3NlKCkpO1xuXG4gICAgY29uc3QgY29uZmlybUJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwibW9kLXdhcm5pbmdcIixcbiAgICAgIHRleHQ6IFwiTW92ZSB0byBUcmFzaFwiLFxuICAgIH0pO1xuICAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xlYW5EaXJlY3RvcnkoZGlyZWN0b3J5KTtcbiAgICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKGJ1dHRvbik7XG4gICAgICAgIGJ1dHRvbi5zZXRUZXh0KGBObyAke3R5cGV9YCk7XG5cbiAgICAgICAgc2hvd1BvcHVwKFxuICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgIGBTdWNjZXNzZnVsbHkgbW92ZWQgJHtcbiAgICAgICAgICAgIGZpbGVzLmxlbmd0aFxuICAgICAgICAgIH0gJHt0eXBlLnRvTG93ZXJDYXNlKCl9IGZpbGVzICgke3RoaXMuY2FsY3VsYXRlU2l6ZShcbiAgICAgICAgICAgIGZpbGVzXG4gICAgICAgICAgKX0pIHRvIHRyYXNoYCxcbiAgICAgICAgICB7IHRpdGxlOiBcIlN1Y2Nlc3NcIiB9XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjbGVhcmluZyAke3R5cGUudG9Mb3dlckNhc2UoKX06YCwgZXJyb3IpO1xuICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIGBGYWlsZWQgdG8gY2xlYXIgJHt0eXBlLnRvTG93ZXJDYXNlKCl9YCwge1xuICAgICAgICAgIHRpdGxlOiBcIkVycm9yXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uZmlybU1vZGFsLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICBjb25maXJtTW9kYWwub3BlbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpc0VtcHR5RmlsZShmaWxlOiBURmlsZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIENoZWNrIGZpbGUgc2l6ZSBmaXJzdFxuICAgIGlmIChmaWxlLnN0YXQuc2l6ZSA9PT0gMCkgcmV0dXJuIHRydWU7XG5cbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuXG4gICAgLy8gRm9yIG1hcmtkb3duIGZpbGVzLCBjaGVjayBjb250ZW50XG4gICAgaWYgKFtcIm1kXCIsIFwidHh0XCIsIFwibWFya2Rvd25cIl0uaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAvLyBSZW1vdmUgZnJvbnRtYXR0ZXIgYW5kIGNoZWNrIGlmIHJlbWFpbmluZyBjb250ZW50IGlzIGVtcHR5XG4gICAgICBjb25zdCBjb250ZW50V2l0aG91dEZyb250bWF0dGVyID0gY29udGVudFxuICAgICAgICAucmVwbGFjZSgvXi0tLVtcXHNcXFNdKj8tLS0vLCBcIlwiKVxuICAgICAgICAudHJpbSgpO1xuICAgICAgcmV0dXJuICFjb250ZW50V2l0aG91dEZyb250bWF0dGVyO1xuICAgIH1cblxuICAgIC8vIEZvciBpbWFnZXMgYW5kIGJpbmFyeSBmaWxlcywganVzdCBjaGVjayBzaXplXG4gICAgaWYgKFxuICAgICAgW1xuICAgICAgICBcImpwZ1wiLFxuICAgICAgICBcImpwZWdcIixcbiAgICAgICAgXCJwbmdcIixcbiAgICAgICAgXCJnaWZcIixcbiAgICAgICAgXCJ3ZWJwXCIsXG4gICAgICAgIFwic3ZnXCIsXG4gICAgICAgIFwibXAzXCIsXG4gICAgICAgIFwid2F2XCIsXG4gICAgICAgIFwib2dnXCIsXG4gICAgICAgIFwibTRhXCIsXG4gICAgICBdLmluY2x1ZGVzKGV4dGVuc2lvbilcbiAgICApIHtcbiAgICAgIHJldHVybiBmaWxlLnN0YXQuc2l6ZSA9PT0gMDtcbiAgICB9XG5cbiAgICAvLyBGb3IgZXh0cmFjdGlvbnMsIGNoZWNrIGlmIGl0J3MganVzdCBoZWFkZXJzIG9yIGVycm9yIG1lc3NhZ2VzXG4gICAgaWYgKGZpbGUucGF0aC5pbmNsdWRlcyhcIi9FeHRyYWN0aW9ucy9cIikpIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgY29uc3QgaGFzT25seUhlYWRlcnMgPSAhY29udGVudC5yZXBsYWNlKC9eIy4qJC9nbSwgXCJcIikudHJpbSgpO1xuICAgICAgY29uc3QgaGFzRXJyb3JNZXNzYWdlID1cbiAgICAgICAgY29udGVudC5pbmNsdWRlcyhcIkVycm9yIGV4dHJhY3RpbmdcIikgfHxcbiAgICAgICAgY29udGVudC5pbmNsdWRlcyhcIlByb2Nlc3NpbmcgZmFpbGVkXCIpO1xuICAgICAgcmV0dXJuIGhhc09ubHlIZWFkZXJzIHx8IGhhc0Vycm9yTWVzc2FnZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEVtcHR5RmlsZXMoKTogUHJvbWlzZTxURmlsZVtdPiB7XG4gICAgY29uc3QgYWxsRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpO1xuICAgIGNvbnN0IGVtcHR5RmlsZXM6IFRGaWxlW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xuICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFbXB0eUZpbGUoZmlsZSkpIHtcbiAgICAgICAgZW1wdHlGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbXB0eUZpbGVzO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRFbXB0eUZvbGRlcnMoKTogUHJvbWlzZTxURm9sZGVyW10+IHtcbiAgICBjb25zdCBlbXB0eUZvbGRlcnM6IFRGb2xkZXJbXSA9IFtdO1xuICAgIGNvbnN0IGNoZWNrRm9sZGVyID0gKGZvbGRlcjogVEZvbGRlcik6IGJvb2xlYW4gPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgZm9sZGVyIGhhcyBhbnkgbm9uLWVtcHR5IGNoaWxkcmVuXG4gICAgICBjb25zdCBoYXNOb25FbXB0eUNoaWxkcmVuID0gZm9sZGVyLmNoaWxkcmVuLnNvbWUoKGNoaWxkKSA9PiB7XG4gICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkLnN0YXQuc2l6ZSA+IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgIHJldHVybiAhY2hlY2tGb2xkZXIoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWhhc05vbkVtcHR5Q2hpbGRyZW4pIHtcbiAgICAgICAgZW1wdHlGb2xkZXJzLnB1c2goZm9sZGVyKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIGNvbnN0IHJvb3RGb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRSb290KCk7XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiByb290Rm9sZGVyLmNoaWxkcmVuKSB7XG4gICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XG4gICAgICAgIGNoZWNrRm9sZGVyKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZW1wdHlGb2xkZXJzO1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1qYW5pdG9yLW1vZGFsXCIpO1xuXG4gICAgLy8gQWRkIHRpdGxlXG4gICAgY29uc3QgdGl0bGVFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LW1vZGFsLXRpdGxlXCIgfSk7XG4gICAgdGl0bGVFbC5zZXRUZXh0KFwiU3lzdGVtU2N1bHB0IEphbml0b3JcIik7XG5cbiAgICAvLyBBZGQgZGVzY3JpcHRpb25cbiAgICBjb25zdCBkZXNjcmlwdGlvbkVsID0gdGl0bGVFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1tb2RhbC1kZXNjcmlwdGlvblwiLFxuICAgIH0pO1xuICAgIGRlc2NyaXB0aW9uRWwuc2V0VGV4dChcIkNsZWFuIHVwIGFuZCBvcHRpbWl6ZSB5b3VyIFN5c3RlbVNjdWxwdCB3b3Jrc3BhY2VcIik7XG5cbiAgICAvLyBDcmVhdGUgbWFpbiBjb250ZW50IGNvbnRhaW5lclxuICAgIGNvbnN0IG1haW5Db250ZW50ID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWphbml0b3ItY29udGVudFwiLFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHNlY3Rpb25zIGNvbnRhaW5lclxuICAgIGNvbnN0IHNlY3Rpb25zQ29udGFpbmVyID0gbWFpbkNvbnRlbnQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbnMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgRW1wdHkgQ29udGVudCBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVFbXB0eUNvbnRlbnRTZWN0aW9uKHNlY3Rpb25zQ29udGFpbmVyKTtcblxuICAgIC8vIEFkZCBDaGF0IEhpc3RvcnkgU2VjdGlvblxuICAgIHRoaXMuY3JlYXRlQ2hhdEhpc3RvcnlTZWN0aW9uKHNlY3Rpb25zQ29udGFpbmVyKTtcblxuICAgIC8vIEFkZCBFeHRyYWN0aW9ucyBTZWN0aW9uXG4gICAgdGhpcy5jcmVhdGVFeHRyYWN0aW9uc1NlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuXG4gICAgLy8gQWRkIFJlY29yZGluZ3MgU2VjdGlvblxuICAgIHRoaXMuY3JlYXRlUmVjb3JkaW5nc1NlY3Rpb24oc2VjdGlvbnNDb250YWluZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVFbXB0eUNvbnRlbnRTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBlbXB0eVNlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkVtcHR5IENvbnRlbnRcIixcbiAgICAgIFwiQ2xlYW4gdXAgZW1wdHkgZmlsZXMgYW5kIGZvbGRlcnNcIlxuICAgICk7XG5cbiAgICBjb25zdCBlbXB0eUZpbGVzID0gYXdhaXQgdGhpcy5nZXRFbXB0eUZpbGVzKCk7XG4gICAgY29uc3QgZW1wdHlGb2xkZXJzID0gYXdhaXQgdGhpcy5nZXRFbXB0eUZvbGRlcnMoKTtcbiAgICBjb25zdCB0b3RhbEVtcHR5ID0gZW1wdHlGaWxlcy5sZW5ndGggKyBlbXB0eUZvbGRlcnMubGVuZ3RoO1xuXG4gICAgY29uc3QgY2xlYXJFbXB0eUJ1dHRvbiA9IGVtcHR5U2VjdGlvbi5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDpcbiAgICAgICAgdG90YWxFbXB0eSA+IDBcbiAgICAgICAgICA/IGBDbGVhciBFbXB0eSBDb250ZW50ICgke3RvdGFsRW1wdHl9IGl0ZW1zKWBcbiAgICAgICAgICA6IFwiTm8gRW1wdHkgQ29udGVudFwiLFxuICAgIH0pIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuXG4gICAgdGhpcy51cGRhdGVCdXR0b25TdGF0ZShjbGVhckVtcHR5QnV0dG9uLCBlbXB0eUZpbGVzLCBcIkVtcHR5IENvbnRlbnRcIik7XG5cbiAgICBpZiAodG90YWxFbXB0eSA+IDApIHtcbiAgICAgIGNsZWFyRW1wdHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyRW1wdHlCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcblxuICAgICAgICAvLyBDcmVhdGUgYSBwcmV2aWV3IHRoYXQgaW5jbHVkZXMgYm90aCBmaWxlcyBhbmQgZm9sZGVyc1xuICAgICAgICBjb25zdCBjb25maXJtTW9kYWwgPSBuZXcgTW9kYWwodGhpcy5hcHApO1xuICAgICAgICBjb25maXJtTW9kYWwudGl0bGVFbC5zZXRUZXh0KFwiQ2xlYXIgRW1wdHkgQ29udGVudFwiKTtcblxuICAgICAgICBjb25zdCBjb250ZW50ID0gY29uZmlybU1vZGFsLmNvbnRlbnRFbDtcbiAgICAgICAgY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtZGVzY3JpcHRpb25cIixcbiAgICAgICAgICB0ZXh0OiBgXHUyNkEwXHVGRTBGIFdBUk5JTkc6IFRoZSBmb2xsb3dpbmcgZW1wdHkgaXRlbXMgd2lsbCBiZSBtb3ZlZCB0byB0aGUgT2JzaWRpYW4gdHJhc2guIFlvdSBjYW4gcmVzdG9yZSB0aGVtIGZyb20gdGhlIHRyYXNoIGlmIG5lZWRlZC5gLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTaG93IGVtcHR5IGZpbGVzXG4gICAgICAgIGlmIChlbXB0eUZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIkVtcHR5IEZpbGVzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLnNob3dGaWxlUHJldmlldyhlbXB0eUZpbGVzLCBcIkVtcHR5IEZpbGVzXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNob3cgZW1wdHkgZm9sZGVyc1xuICAgICAgICBpZiAoZW1wdHlGb2xkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXNlY3Rpb24taGVhZGVyXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIkVtcHR5IEZvbGRlcnNcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBmb2xkZXJMaXN0ID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1maWxlLXRyZWUgbmF2LWZvbGRlclwiLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZm9yIChjb25zdCBmb2xkZXIgb2YgZW1wdHlGb2xkZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBmb2xkZXJJdGVtID0gZm9sZGVyTGlzdC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICBjbHM6IFwibmF2LWZvbGRlci10aXRsZVwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZXRJY29uKGZvbGRlckl0ZW0sIFwiZm9sZGVyXCIpO1xuICAgICAgICAgICAgZm9sZGVySXRlbS5jcmVhdGVTcGFuKHsgdGV4dDogZm9sZGVyLnBhdGggfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGJ1dHRvbnNcbiAgICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudC5jcmVhdGVEaXYoe1xuICAgICAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtbW9kYWwtYnV0dG9uc1wiLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNvbmZpcm1Nb2RhbC5jbG9zZSgpKTtcblxuICAgICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgICAgICBjbHM6IFwibW9kLXdhcm5pbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIk1vdmUgdG8gVHJhc2hcIixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBEZWxldGUgZW1wdHkgZmlsZXMgZmlyc3RcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBlbXB0eUZpbGVzKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZpbGUsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGVuIGRlbGV0ZSBlbXB0eSBmb2xkZXJzIChkZWVwZXN0IGZpcnN0KVxuICAgICAgICAgICAgY29uc3Qgc29ydGVkRm9sZGVycyA9IGVtcHR5Rm9sZGVycy5zb3J0KFxuICAgICAgICAgICAgICAoYSwgYikgPT4gYi5wYXRoLmxlbmd0aCAtIGEucGF0aC5sZW5ndGhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBzb3J0ZWRGb2xkZXJzKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LnRyYXNoKGZvbGRlciwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbihjbGVhckVtcHR5QnV0dG9uKTtcbiAgICAgICAgICAgIGNsZWFyRW1wdHlCdXR0b24uc2V0VGV4dChcIk5vIEVtcHR5IENvbnRlbnRcIik7XG5cbiAgICAgICAgICAgIHNob3dQb3B1cChcbiAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgIGBTdWNjZXNzZnVsbHkgbW92ZWQgJHt0b3RhbEVtcHR5fSBlbXB0eSBpdGVtcyB0byB0cmFzaGAsXG4gICAgICAgICAgICAgIHsgdGl0bGU6IFwiU3VjY2Vzc1wiIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjbGVhcmluZyBlbXB0eSBjb250ZW50OlwiLCBlcnJvcik7XG4gICAgICAgICAgICBzaG93UG9wdXAodGhpcy5hcHAsIFwiRmFpbGVkIHRvIGNsZWFyIGVtcHR5IGNvbnRlbnRcIiwge1xuICAgICAgICAgICAgICB0aXRsZTogXCJFcnJvclwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbmZpcm1Nb2RhbC5jbG9zZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25maXJtTW9kYWwub3BlbigpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDaGF0SGlzdG9yeVNlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGhpc3RvcnlTZWN0aW9uID0gdGhpcy5jcmVhdGVTZWN0aW9uKFxuICAgICAgY29udGFpbmVyLFxuICAgICAgXCJDaGF0IEhpc3RvcnlcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBjaGF0IGhpc3RvcnkgYW5kIGNvbnZlcnNhdGlvbnMgcGVybWFuZW50bHlcIlxuICAgICk7XG5cbiAgICBjb25zdCBjaGF0RmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgY2hhdFNpemUgPSB0aGlzLmNhbGN1bGF0ZVNpemUoY2hhdEZpbGVzKTtcbiAgICBjb25zdCBoYXNDaGF0RmlsZXMgPSBjaGF0RmlsZXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNsZWFySGlzdG9yeUJ1dHRvbiA9IGhpc3RvcnlTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNDaGF0RmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIENoYXQgSGlzdG9yeSAoJHtjaGF0U2l6ZX0pYFxuICAgICAgICA6IFwiTm8gQ2hhdCBIaXN0b3J5XCIsXG4gICAgfSkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG5cbiAgICB0aGlzLnVwZGF0ZUJ1dHRvblN0YXRlKGNsZWFySGlzdG9yeUJ1dHRvbiwgY2hhdEZpbGVzLCBcIkNoYXQgSGlzdG9yeVwiKTtcblxuICAgIGlmIChoYXNDaGF0RmlsZXMpIHtcbiAgICAgIGNsZWFySGlzdG9yeUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoY2xlYXJIaXN0b3J5QnV0dG9uLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIGF3YWl0IHRoaXMuc2hvd0NvbmZpcm1hdGlvbkRpYWxvZyhcbiAgICAgICAgICBjaGF0RmlsZXMsXG4gICAgICAgICAgXCJDaGF0IEhpc3RvcnlcIixcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0c0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhckhpc3RvcnlCdXR0b25cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXh0cmFjdGlvbnNTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBleHRyYWN0aW9uc1NlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkRvY3VtZW50IEV4dHJhY3Rpb25zXCIsXG4gICAgICBcIkRlbGV0ZSBhbGwgZXh0cmFjdGVkIGRvY3VtZW50IGNvbnRlbnQgKFBERnMsIGRvY3VtZW50cywgZXRjLilcIlxuICAgICk7XG5cbiAgICBjb25zdCBleHRyYWN0aW9uRmlsZXMgPSB0aGlzLmdldEZpbGVzSW5EaXJlY3RvcnkoXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHRyYWN0aW9uc0RpcmVjdG9yeVxuICAgICk7XG4gICAgY29uc3QgZXh0cmFjdGlvbnNTaXplID0gdGhpcy5jYWxjdWxhdGVTaXplKGV4dHJhY3Rpb25GaWxlcyk7XG4gICAgY29uc3QgaGFzRXh0cmFjdGlvbkZpbGVzID0gZXh0cmFjdGlvbkZpbGVzLmxlbmd0aCA+IDA7XG5cbiAgICBjb25zdCBjbGVhckV4dHJhY3Rpb25zQnV0dG9uID0gZXh0cmFjdGlvbnNTZWN0aW9uLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJzeXN0ZW1zY3VscHQtYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBoYXNFeHRyYWN0aW9uRmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIEV4dHJhY3Rpb25zICgke2V4dHJhY3Rpb25zU2l6ZX0pYFxuICAgICAgICA6IFwiTm8gRXh0cmFjdGlvbnNcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoXG4gICAgICBjbGVhckV4dHJhY3Rpb25zQnV0dG9uLFxuICAgICAgZXh0cmFjdGlvbkZpbGVzLFxuICAgICAgXCJFeHRyYWN0aW9uc1wiXG4gICAgKTtcblxuICAgIGlmIChoYXNFeHRyYWN0aW9uRmlsZXMpIHtcbiAgICAgIGNsZWFyRXh0cmFjdGlvbnNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyRXh0cmFjdGlvbnNCdXR0b24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgYXdhaXQgdGhpcy5zaG93Q29uZmlybWF0aW9uRGlhbG9nKFxuICAgICAgICAgIGV4dHJhY3Rpb25GaWxlcyxcbiAgICAgICAgICBcIkV4dHJhY3Rpb25zXCIsXG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXh0cmFjdGlvbnNEaXJlY3RvcnksXG4gICAgICAgICAgY2xlYXJFeHRyYWN0aW9uc0J1dHRvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZWNvcmRpbmdzU2VjdGlvbihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgcmVjb3JkaW5nc1NlY3Rpb24gPSB0aGlzLmNyZWF0ZVNlY3Rpb24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBcIkF1ZGlvIFJlY29yZGluZ3NcIixcbiAgICAgIFwiRGVsZXRlIGFsbCBhdWRpbyByZWNvcmRpbmdzICh0aGlzIHdvbid0IGFmZmVjdCB0cmFuc2NyaXB0aW9ucylcIlxuICAgICk7XG5cbiAgICBjb25zdCByZWNvcmRpbmdGaWxlcyA9IHRoaXMuZ2V0RmlsZXNJbkRpcmVjdG9yeShcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJlY29yZGluZ3NEaXJlY3RvcnlcbiAgICApO1xuICAgIGNvbnN0IHJlY29yZGluZ3NTaXplID0gdGhpcy5jYWxjdWxhdGVTaXplKHJlY29yZGluZ0ZpbGVzKTtcbiAgICBjb25zdCBoYXNSZWNvcmRpbmdGaWxlcyA9IHJlY29yZGluZ0ZpbGVzLmxlbmd0aCA+IDA7XG5cbiAgICBjb25zdCBjbGVhclJlY29yZGluZ3NCdXR0b24gPSByZWNvcmRpbmdzU2VjdGlvbi5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogaGFzUmVjb3JkaW5nRmlsZXNcbiAgICAgICAgPyBgQ2xlYXIgQWxsIFJlY29yZGluZ3MgKCR7cmVjb3JkaW5nc1NpemV9KWBcbiAgICAgICAgOiBcIk5vIFJlY29yZGluZ3NcIixcbiAgICB9KSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgIHRoaXMudXBkYXRlQnV0dG9uU3RhdGUoY2xlYXJSZWNvcmRpbmdzQnV0dG9uLCByZWNvcmRpbmdGaWxlcywgXCJSZWNvcmRpbmdzXCIpO1xuXG4gICAgaWYgKGhhc1JlY29yZGluZ0ZpbGVzKSB7XG4gICAgICBjbGVhclJlY29yZGluZ3NCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGNsZWFyUmVjb3JkaW5nc0J1dHRvbi5kaXNhYmxlZCkgcmV0dXJuO1xuICAgICAgICBhd2FpdCB0aGlzLnNob3dDb25maXJtYXRpb25EaWFsb2coXG4gICAgICAgICAgcmVjb3JkaW5nRmlsZXMsXG4gICAgICAgICAgXCJSZWNvcmRpbmdzXCIsXG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVjb3JkaW5nc0RpcmVjdG9yeSxcbiAgICAgICAgICBjbGVhclJlY29yZGluZ3NCdXR0b25cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2VjdGlvbihcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgZGVzY3JpcHRpb246IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1qYW5pdG9yLXNlY3Rpb25cIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWRlciA9IHNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1zZWN0aW9uLWhlYWRlclwiIH0pO1xuICAgIGhlYWRlci5zZXRUZXh0KHRpdGxlKTtcblxuICAgIGNvbnN0IGRlc2MgPSBzZWN0aW9uLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtc2VjdGlvbi1kZXNjcmlwdGlvblwiIH0pO1xuICAgIGRlc2Muc2V0VGV4dChkZXNjcmlwdGlvbik7XG5cbiAgICByZXR1cm4gc2VjdGlvbjtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBzZXRJY29uLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IFNlYXJjaFNlcnZpY2UsIFNlYXJjaGFibGVGaWVsZCwgU2VhcmNoTWF0Y2gsIFNlYXJjaFJlc3VsdCB9IGZyb20gXCIuLi9zZXJ2aWNlcy9TZWFyY2hTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDaGF0U3RvcmFnZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5pbXBvcnQgeyBTeXN0ZW1Qcm9tcHRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL1N5c3RlbVByb21wdFNlcnZpY2VcIjtcbmltcG9ydCB7IENIQVRfVklFV19UWVBFLCBDaGF0VmlldyB9IGZyb20gXCIuLi92aWV3cy9jaGF0dmlldy9DaGF0Vmlld1wiO1xuaW50ZXJmYWNlIENoYXRIaXN0b3J5SXRlbSB7XG4gIGlkOiBzdHJpbmc7XG4gIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdO1xuICBzZWxlY3RlZE1vZGVsSWQ6IHN0cmluZztcbiAgbGFzdE1vZGlmaWVkOiBudW1iZXI7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRleHRfZmlsZXM/OiBzdHJpbmdbXTtcbiAgY3VzdG9tUHJvbXB0RmlsZVBhdGg/OiBzdHJpbmc7XG4gIHN5c3RlbVByb21wdFR5cGU/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBGbGF0dGVuZWRDaGF0SXRlbSB7XG4gIGlkOiBzdHJpbmc7XG4gIHNlYXJjaFRleHQ6IHN0cmluZztcbiAgbW9kZWxOYW1lOiBzdHJpbmc7XG4gIHByb21wdExhYmVsOiBzdHJpbmc7XG4gIGxhc3RNZXNzYWdlOiBzdHJpbmc7XG4gIG1lc3NhZ2VDb250ZW50OiBzdHJpbmc7XG4gIGl0ZW06IENoYXRIaXN0b3J5SXRlbTtcbn1cblxuZXhwb3J0IGNsYXNzIExvYWRDaGF0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHByaXZhdGUgY2hhdEl0ZW1zOiBDaGF0SGlzdG9yeUl0ZW1bXSA9IFtdO1xuICBwcml2YXRlIGZsYXR0ZW5lZEl0ZW1zOiBGbGF0dGVuZWRDaGF0SXRlbVtdID0gW107XG4gIHByaXZhdGUgc2VsZWN0ZWRDaGF0SWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNlYXJjaElucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICBwcml2YXRlIGNoYXRHcmlkOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlO1xuICBwcml2YXRlIHNlbGVjdGVkQ2FyZEluZGV4OiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGNoYXRDYXJkczogSFRNTEVsZW1lbnRbXSA9IFtdO1xuICBwcml2YXRlIGN1cnJlbnRTZWFyY2hSZXN1bHRzOiBTZWFyY2hSZXN1bHQ8Q2hhdEhpc3RvcnlJdGVtPltdID0gW107XG4gIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW47XG4gIHByaXZhdGUgaXNLZXlib2FyZE5hdkFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGNoYXRTdG9yYWdlOiBDaGF0U3RvcmFnZVNlcnZpY2U7XG4gIHByaXZhdGUgdmlydHVhbFNjcm9sbGVyOiBJbnRlcnNlY3Rpb25PYnNlcnZlcjtcbiAgcHJpdmF0ZSBiYXRjaFNpemU6IG51bWJlciA9IDIwO1xuICBwcml2YXRlIGN1cnJlbnRCYXRjaDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBpc0xvYWRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBjYXJkQ2FjaGU6IE1hcDxzdHJpbmcsIEhUTUxFbGVtZW50PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBwcm9ncmVzc01vZGFsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcm9ncmVzc0JhcjogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcHJvZ3Jlc3NUZXh0OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcm9ncmVzc0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW5cbiAgKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2UgPSBuZXcgU2VhcmNoU2VydmljZSgpO1xuICAgIHRoaXMuY2hhdFN0b3JhZ2UgPSBuZXcgQ2hhdFN0b3JhZ2VTZXJ2aWNlKFxuICAgICAgYXBwLFxuICAgICAgcGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5XG4gICAgKTtcbiAgICB0aGlzLnNldHVwVmlydHVhbFNjcm9sbGVyKCk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwVmlydHVhbFNjcm9sbGVyKCkge1xuICAgIHRoaXMudmlydHVhbFNjcm9sbGVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKFxuICAgICAgKGVudHJpZXMpID0+IHtcbiAgICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZyAmJiAhdGhpcy5pc0xvYWRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZE5leHRCYXRjaCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByb290OiBudWxsLFxuICAgICAgICByb290TWFyZ2luOiBcIjEwMHB4XCIsXG4gICAgICAgIHRocmVzaG9sZDogMC4xLFxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWROZXh0QmF0Y2goKSB7XG4gICAgaWYgKHRoaXMuaXNMb2FkaW5nIHx8IHRoaXMuY3VycmVudEJhdGNoICogdGhpcy5iYXRjaFNpemUgPj0gdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgY29uc3Qgc3RhcnQgPSB0aGlzLmN1cnJlbnRCYXRjaCAqIHRoaXMuYmF0Y2hTaXplO1xuICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKHN0YXJ0ICsgdGhpcy5iYXRjaFNpemUsIHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMubGVuZ3RoKTtcbiAgICBjb25zdCBiYXRjaCA9IHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMuc2xpY2Uoc3RhcnQsIGVuZCk7XG5cbiAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBjb25zdCBzZWN0aW9uc0NvbnRhaW5lciA9IGZyYWdtZW50LmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtc2VjdGlvbnMtY29udGFpbmVyXCIsXG4gICAgfSk7XG5cbiAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIGJhdGNoLm1hcChhc3luYyAocmVzdWx0KSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVuZGVyQ2hhdENhcmQocmVzdWx0Lml0ZW0sIHJlc3VsdC5tYXRjaGVzIHx8IFtdLCBzZWN0aW9uc0NvbnRhaW5lcik7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLmNoYXRHcmlkLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbiAgICB0aGlzLmN1cnJlbnRCYXRjaCsrO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgICAvLyBBZGQgc2VudGluZWwgZWxlbWVudCBmb3IgaW5maW5pdGUgc2Nyb2xsXG4gICAgaWYgKGVuZCA8IHRoaXMuY3VycmVudFNlYXJjaFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBzZW50aW5lbCA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LXNlbnRpbmVsXCIsXG4gICAgICB9KTtcbiAgICAgIHRoaXMudmlydHVhbFNjcm9sbGVyLm9ic2VydmUoc2VudGluZWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZmxhdHRlbkNoYXRJdGVtKGl0ZW06IENoYXRIaXN0b3J5SXRlbSk6IFByb21pc2U8RmxhdHRlbmVkQ2hhdEl0ZW0+IHtcbiAgICBjb25zdCBtb2RlbE5hbWUgPSBhd2FpdCB0aGlzLmdldE1vZGVsTmFtZShpdGVtLnNlbGVjdGVkTW9kZWxJZCk7XG4gICAgY29uc3QgcHJvbXB0TGFiZWwgPSBhd2FpdCB0aGlzLmdldFByb21wdExhYmVsKGl0ZW0pO1xuICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gaXRlbS5tZXNzYWdlc1tpdGVtLm1lc3NhZ2VzLmxlbmd0aCAtIDFdO1xuICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gaXRlbS5tZXNzYWdlcy5tYXAobXNnID0+IHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobXNnKSkuam9pbihcIlxcblwiKTtcblxuICAgIHJldHVybiB7XG4gICAgICBpZDogaXRlbS5pZCxcbiAgICAgIHNlYXJjaFRleHQ6IGAke21lc3NhZ2VDb250ZW50fSAke21vZGVsTmFtZX0gJHtwcm9tcHRMYWJlbH1gLnRvTG93ZXJDYXNlKCksXG4gICAgICBtb2RlbE5hbWUsXG4gICAgICBwcm9tcHRMYWJlbCxcbiAgICAgIGxhc3RNZXNzYWdlOiBsYXN0TWVzc2FnZSA/IHRoaXMuZ2V0TWVzc2FnZUNvbnRlbnQobGFzdE1lc3NhZ2UpIDogXCJcIixcbiAgICAgIG1lc3NhZ2VDb250ZW50LFxuICAgICAgaXRlbVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVByb2dyZXNzTW9kYWwoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgdGhpcy5wcm9ncmVzc0NvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiAnc3lzdGVtc2N1bHB0LXByb2dyZXNzLW92ZXJsYXknXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdGF0dXNDb250YWluZXIgPSB0aGlzLnByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6ICdzeXN0ZW1zY3VscHQtcHJvZ3Jlc3Mtc3RhdHVzJ1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RhdHVzSWNvbiA9IHN0YXR1c0NvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiAnc3lzdGVtc2N1bHB0LXByb2dyZXNzLXN0YXR1cy1pY29uJ1xuICAgIH0pO1xuICAgIHNldEljb24oc3RhdHVzSWNvbiwgJ2xvYWRlci0yJyk7XG5cbiAgICB0aGlzLnByb2dyZXNzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6ICdMb2FkaW5nIGNoYXRzLi4uJ1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQcm9ncmVzcyhjdXJyZW50OiBudW1iZXIsIHRvdGFsOiBudW1iZXIpIHtcbiAgICBpZiAoY3VycmVudCA9PT0gdG90YWwpIHtcbiAgICAgIHRoaXMucHJvZ3Jlc3NDb250YWluZXIucmVtb3ZlKCk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgYXN5bmMgb25PcGVuKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5hZGRDbGFzcyhcInN5c3RlbXNjdWxwdC1jaGF0LW1vZGFsXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGFuZCBzaG93IHByb2dyZXNzIG1vZGFsXG4gICAgdGhpcy5jcmVhdGVQcm9ncmVzc01vZGFsKCk7XG5cbiAgICAvLyBMb2FkIGFuZCBwcmVwYXJlIGNoYXRzXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgdGhpcy5jaGF0U3RvcmFnZS5sb2FkQ2hhdHMoKTtcbiAgICAgIHRoaXMuY2hhdEl0ZW1zID0gY2hhdHMuc29ydCgoYSwgYikgPT4gYi5sYXN0TW9kaWZpZWQgLSBhLmxhc3RNb2RpZmllZCk7XG4gICAgICBcbiAgICAgIC8vIFByZS1mbGF0dGVuIGFsbCBpdGVtcyBpbiBwYXJhbGxlbFxuICAgICAgdGhpcy5mbGF0dGVuZWRJdGVtcyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICB0aGlzLmNoYXRJdGVtcy5tYXAoYXN5bmMgKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29uc3QgZmxhdEl0ZW0gPSBhd2FpdCB0aGlzLmZsYXR0ZW5DaGF0SXRlbShpdGVtKTtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKGluZGV4ICsgMSwgdGhpcy5jaGF0SXRlbXMubGVuZ3RoKTtcbiAgICAgICAgICByZXR1cm4gZmxhdEl0ZW07XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2hhdHM6XCIsIGVycm9yKTtcbiAgICAgIHRoaXMuY2hhdEl0ZW1zID0gW107XG4gICAgICB0aGlzLmZsYXR0ZW5lZEl0ZW1zID0gW107XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIFVJXG4gICAgY29uc3Qgc2VhcmNoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtc2VhcmNoXCIsXG4gICAgfSk7XG4gICAgdGhpcy5zZWFyY2hJbnB1dCA9IHNlYXJjaENvbnRhaW5lci5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoIGNoYXRzLi4uXCIsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNoYXRHcmlkID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1ncmlkXCIgfSk7XG5cbiAgICAvLyBJbml0aWFsIHJlbmRlclxuICAgIGF3YWl0IHRoaXMucmVuZGVyQ2hhdHModGhpcy5mbGF0dGVuZWRJdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgaXRlbTogaXRlbS5pdGVtLFxuICAgICAgbWF0Y2hlczogW10sXG4gICAgICBzY29yZTogMFxuICAgIH0pKSk7XG5cbiAgICAvLyBBZGQgdGhlIG5ldyBjaGF0IGJ1dHRvblxuICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1idXR0b24tY29udGFpbmVyXCIsXG4gICAgfSk7XG4gICAgY29uc3QgbmV3Q2hhdEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWJ1dHRvblwiLFxuICAgICAgdGV4dDogXCJPcGVuIE5ldyBDaGF0IEluc3RlYWRcIixcbiAgICB9KTtcbiAgICBuZXdDaGF0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLm9wZW5OZXdDaGF0KCkpO1xuXG4gICAgLy8gU2V0dXAgZXZlbnQgbGlzdGVuZXJzXG4gICAgdGhpcy5zZXR1cEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgXG4gICAgLy8gU2hvdyBtb2RhbCBhbmQgZm9jdXMgc2VhcmNoXG4gICAgdGhpcy5jb250YWluZXJFbC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgdGhpcy5zZWFyY2hJbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVDaGF0U2VsZWN0aW9uKGNoYXRJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEZpcnN0IGxvYWQgdGhlIGNoYXQgZGF0YSB0byBnZXQgdGhlIHRpdGxlXG4gICAgICBjb25zdCBjaGF0RGF0YSA9IGF3YWl0IHRoaXMuY2hhdFN0b3JhZ2UubG9hZENoYXQoY2hhdElkKTtcbiAgICAgIGlmICghY2hhdERhdGEpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGNoYXQgZGF0YSBmb3I6XCIsIGNoYXRJZCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHRoZSBsZWFmIGFuZCB2aWV3XG4gICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoXCJ0YWJcIik7XG4gICAgICBjb25zdCB2aWV3ID0gbmV3IENoYXRWaWV3KGxlYWYsIHRoaXMucGx1Z2luKTtcbiAgICAgIFxuICAgICAgLy8gU2V0IHRoZSBzdGF0ZSBiZWZvcmUgb3BlbmluZ1xuICAgICAgYXdhaXQgdmlldy5zZXRTdGF0ZSh7XG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgY2hhdFRpdGxlOiBjaGF0RGF0YS50aXRsZSB8fCBjaGF0SWQsXG4gICAgICAgIHNlbGVjdGVkTW9kZWxJZDogY2hhdERhdGEuc2VsZWN0ZWRNb2RlbElkXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gT3BlbiB0aGUgdmlldyBhbmQgZm9jdXMgaXRcbiAgICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBjaGF0OlwiLCBlcnJvcik7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cEV2ZW50TGlzdGVuZXJzKCk6IHZvaWQge1xuICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dC52YWx1ZTtcbiAgICAgIFxuICAgICAgaWYgKCFxdWVyeSkge1xuICAgICAgICAvLyBTaG93IGFsbCBjaGF0cyBzb3J0ZWQgYnkgZGF0ZVxuICAgICAgICB0aGlzLmN1cnJlbnRTZWFyY2hSZXN1bHRzID0gdGhpcy5mbGF0dGVuZWRJdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgIGl0ZW06IGl0ZW0uaXRlbSxcbiAgICAgICAgICBtYXRjaGVzOiBbXSxcbiAgICAgICAgICBzY29yZTogMCxcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVuZGVyQ2hhdHModGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHF1ZXJ5Lmxlbmd0aCA8IDMpIHtcbiAgICAgICAgdGhpcy5jaGF0R3JpZC5lbXB0eSgpO1xuICAgICAgICB0aGlzLmNoYXRDYXJkcyA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VFbCA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtZW1wdHlcIixcbiAgICAgICAgfSk7XG4gICAgICAgIG1lc3NhZ2VFbC5zZXRUZXh0KGBQbGVhc2UgZW50ZXIgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzIHRvIHNlYXJjaCAoJHtxdWVyeS5sZW5ndGh9LzMpYCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRmFzdCBzZWFyY2ggdXNpbmcgZmxhdHRlbmVkIGl0ZW1zXG4gICAgICBjb25zdCBzZWFyY2hUZXJtcyA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5mbGF0dGVuZWRJdGVtc1xuICAgICAgICAubWFwKGZsYXRJdGVtID0+IHtcbiAgICAgICAgICAvLyBRdWljayBjaGVjayBpZiBhbGwgdGVybXMgZXhpc3RcbiAgICAgICAgICBjb25zdCBhbGxUZXJtc0V4aXN0ID0gc2VhcmNoVGVybXMuZXZlcnkodGVybSA9PiBcbiAgICAgICAgICAgIGZsYXRJdGVtLnNlYXJjaFRleHQuaW5jbHVkZXModGVybSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKCFhbGxUZXJtc0V4aXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBpdGVtOiBmbGF0SXRlbS5pdGVtLCBtYXRjaGVzOiBbXSwgc2NvcmU6IDAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDYWxjdWxhdGUgc2NvcmUgYW5kIGZpbmQgbWF0Y2hlc1xuICAgICAgICAgIGxldCBzY29yZSA9IDA7XG4gICAgICAgICAgY29uc3QgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdO1xuXG4gICAgICAgICAgc2VhcmNoVGVybXMuZm9yRWFjaCh0ZXJtID0+IHtcbiAgICAgICAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgICAgICAgd2hpbGUgKChwb3MgPSBmbGF0SXRlbS5zZWFyY2hUZXh0LmluZGV4T2YodGVybSwgcG9zKSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgIHNjb3JlICs9IDE7XG4gICAgICAgICAgICAgIG1hdGNoZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiY29udGVudFwiLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZsYXRJdGVtLnNlYXJjaFRleHQuc2xpY2UoTWF0aC5tYXgoMCwgcG9zIC0gMjApLCBwb3MgKyB0ZXJtLmxlbmd0aCArIDIwKSxcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBbcG9zXSxcbiAgICAgICAgICAgICAgICBtYXRjaFF1YWxpdHk6IDFcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHBvcyArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQm9vc3Qgc2NvcmUgZm9yIGV4YWN0IG1hdGNoZXNcbiAgICAgICAgICBpZiAoZmxhdEl0ZW0uc2VhcmNoVGV4dC5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgc2NvcmUgKj0gMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXRlbTogZmxhdEl0ZW0uaXRlbSxcbiAgICAgICAgICAgIG1hdGNoZXMsXG4gICAgICAgICAgICBzY29yZVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICAgIC5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5zY29yZSA+IDApXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgaWYgKGIuc2NvcmUgIT09IGEuc2NvcmUpIHtcbiAgICAgICAgICAgIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGIuaXRlbS5sYXN0TW9kaWZpZWQgLSBhLml0ZW0ubGFzdE1vZGlmaWVkO1xuICAgICAgICB9KTtcblxuICAgICAgdGhpcy5jdXJyZW50U2VhcmNoUmVzdWx0cyA9IHJlc3VsdHM7XG4gICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID0gMDtcbiAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgdGhpcy5yZW5kZXJDaGF0cyhyZXN1bHRzKTtcbiAgICB9KTtcblxuICAgIC8vIEtleWJvYXJkIG5hdmlnYXRpb25cbiAgICB0aGlzLnNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5jaGF0Q2FyZHMubGVuZ3RoID09PSAwKSByZXR1cm47XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ID0gKHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXggLSAxICsgdGhpcy5jaGF0Q2FyZHMubGVuZ3RoKSAlIHRoaXMuY2hhdENhcmRzLmxlbmd0aDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9ICh0aGlzLnNlbGVjdGVkQ2FyZEluZGV4ICsgMSkgJSB0aGlzLmNoYXRDYXJkcy5sZW5ndGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlICYmIHRoaXMuY2hhdENhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZENhcmQgPSB0aGlzLmNoYXRDYXJkc1t0aGlzLnNlbGVjdGVkQ2FyZEluZGV4XTtcbiAgICAgICAgaWYgKHNlbGVjdGVkQ2FyZD8uZGF0YXNldC5jaGF0SWQpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUNoYXRTZWxlY3Rpb24oc2VsZWN0ZWRDYXJkLmRhdGFzZXQuY2hhdElkKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBpZiAodGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY29udGVudEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IChlLnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xvc2VzdChcIi5zeXN0ZW1zY3VscHQtY2hhdC1jYXJkXCIpIGFzIEhUTUxEaXZFbGVtZW50IHwgbnVsbDtcbiAgICAgIGlmIChjYXJkPy5kYXRhc2V0LmNoYXRJZCkge1xuICAgICAgICB0aGlzLmhhbmRsZUNoYXRTZWxlY3Rpb24oY2FyZC5kYXRhc2V0LmNoYXRJZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICh0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgdGhpcy5pc0tleWJvYXJkTmF2QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRDYXJkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckNoYXRzKHNlYXJjaFJlc3VsdHM6IFNlYXJjaFJlc3VsdDxDaGF0SGlzdG9yeUl0ZW0+W10pIHtcbiAgICBpZiAoIXRoaXMuY2hhdEdyaWQpIHJldHVybjtcblxuICAgIHRoaXMuY2hhdEdyaWQuZW1wdHkoKTtcbiAgICB0aGlzLmNoYXRDYXJkcyA9IFtdO1xuICAgIHRoaXMuY3VycmVudEJhdGNoID0gMDsgLy8gUmVzZXQgYmF0Y2ggY291bnRlciBmb3IgaW5maW5pdGUgc2Nyb2xsXG4gICAgdGhpcy5zZWxlY3RlZENhcmRJbmRleCA9IDA7IC8vIFJlc2V0IHNlbGVjdGVkIGNhcmQgaW5kZXhcblxuICAgIC8vIENyZWF0ZSBhIGxvb2t1cCBmb3Igc2VhcmNoTWF0Y2hlc1xuICAgIGNvbnN0IHNyTWFwID0gbmV3IE1hcChcbiAgICAgIHNlYXJjaFJlc3VsdHMubWFwKChzcikgPT4gW3NyLml0ZW0uaWQsIHNyLm1hdGNoZXMgfHwgW11dKVxuICAgICk7XG5cbiAgICAvLyBTZXBhcmF0ZSBmYXZvcml0ZXMgZnJvbSBvdGhlciBjaGF0c1xuICAgIGNvbnN0IGZhdm9yaXRlczogQ2hhdEhpc3RvcnlJdGVtW10gPSBbXTtcbiAgICBjb25zdCBub25GYXZvcml0ZXM6IENoYXRIaXN0b3J5SXRlbVtdID0gW107XG5cbiAgICAvLyBPbmx5IHByb2Nlc3MgY2hhdHMgdGhhdCBhcmUgaW4gb3VyIHNlYXJjaCByZXN1bHRzXG4gICAgc2VhcmNoUmVzdWx0cy5mb3JFYWNoKChzcikgPT4ge1xuICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlQ2hhdHMuaW5jbHVkZXMoc3IuaXRlbS5pZCkpIHtcbiAgICAgICAgZmF2b3JpdGVzLnB1c2goc3IuaXRlbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub25GYXZvcml0ZXMucHVzaChzci5pdGVtKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJlbmRlciBmYXZvcml0ZXMgc2VjdGlvbiBpZiB0aGVyZSBhcmUgYW55IGZhdm9yaXRlc1xuICAgIGlmIChmYXZvcml0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gQWRkIGZhdm9yaXRlcyBoZWFkZXJcbiAgICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIixcbiAgICAgIH0pO1xuICAgICAgaGVhZGVyLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkZhdm9yaXRlc1wiIH0pO1xuXG4gICAgICAvLyBTb3J0IGZhdm9yaXRlcyBieSBsYXN0IG1vZGlmaWVkIGRhdGVcbiAgICAgIGZhdm9yaXRlcy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKTtcblxuICAgICAgLy8gUmVuZGVyIGZhdm9yaXRlIGNoYXRzXG4gICAgICBmYXZvcml0ZXMuZm9yRWFjaCgoY2hhdCkgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gc3JNYXAuZ2V0KGNoYXQuaWQpIHx8IFtdO1xuICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5yZW5kZXJDaGF0Q2FyZChjaGF0LCBtYXRjaGVzKTtcbiAgICAgICAgaWYgKGNhcmQpIHtcbiAgICAgICAgICB0aGlzLmNoYXRHcmlkLmFwcGVuZENoaWxkKGNhcmQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmVjZW50IGNoYXRzIGhlYWRlclxuICAgIGlmIChub25GYXZvcml0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcmVjZW50SGVhZGVyID0gdGhpcy5jaGF0R3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlclwiLFxuICAgICAgfSk7XG4gICAgICByZWNlbnRIZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiUmVjZW50IENoYXRzXCIgfSk7XG5cbiAgICAgIC8vIFNvcnQgbm9uLWZhdm9yaXRlcyBieSBsYXN0IG1vZGlmaWVkIGRhdGVcbiAgICAgIG5vbkZhdm9yaXRlcy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKTtcblxuICAgICAgLy8gUmVuZGVyIG5vbi1mYXZvcml0ZSBjaGF0c1xuICAgICAgbm9uRmF2b3JpdGVzLmZvckVhY2goKGNoYXQpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNyTWFwLmdldChjaGF0LmlkKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMucmVuZGVyQ2hhdENhcmQoY2hhdCwgbWF0Y2hlcyk7XG4gICAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgICAgdGhpcy5jaGF0R3JpZC5hcHBlbmRDaGlsZChjYXJkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSWYgbm8gY2FyZHMgYXQgYWxsLCBzaG93IGFwcHJvcHJpYXRlIG1lc3NhZ2VcbiAgICBpZiAoZmF2b3JpdGVzLmxlbmd0aCA9PT0gMCAmJiBub25GYXZvcml0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dD8udmFsdWUpIHtcbiAgICAgICAgY29uc3QgZW1wdHlTdGF0ZSA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHtcbiAgICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtZW1wdHlcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGVtcHR5U3RhdGUuc2V0VGV4dChcIk5vIGNoYXRzIGZvdW5kIG1hdGNoaW5nIHlvdXIgc2VhcmNoLlwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgICAgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWVtcHR5XCIsXG4gICAgICAgIH0pO1xuICAgICAgICBlbXB0eVN0YXRlLnNldFRleHQoXCJObyBjaGF0IGhpc3RvcnkgZm91bmQuXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlc2V0IGluZmluaXRlIHNjcm9sbCBpZiBuZWVkZWRcbiAgICBpZiAodGhpcy52aXJ0dWFsU2Nyb2xsZXIpIHtcbiAgICAgIGNvbnN0IHNlbnRpbmVsID0gdGhpcy5jaGF0R3JpZC5jcmVhdGVEaXYoe1xuICAgICAgICBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtc2VudGluZWxcIixcbiAgICAgIH0pO1xuICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsZXIub2JzZXJ2ZShzZW50aW5lbCk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGtleWJvYXJkIG5hdmlnYXRpb24gaWYgYWN0aXZlXG4gICAgaWYgKHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSAmJiB0aGlzLmNoYXRDYXJkcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQ2FyZCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoQ2FyZEV2ZW50TGlzdGVuZXJzKGNhcmQ6IEhUTUxFbGVtZW50LCBpdGVtOiBDaGF0SGlzdG9yeUl0ZW0pOiB2b2lkIHtcbiAgICAvLyBBZGQgZmF2b3JpdGUgYnV0dG9uIGhhbmRsZXJcbiAgICBjb25zdCBmYXZvcml0ZUJ1dHRvbiA9IGNhcmQucXVlcnlTZWxlY3RvcignLnN5c3RlbXNjdWxwdC1mYXZvcml0ZS1idXR0b24nKTtcbiAgICBpZiAoZmF2b3JpdGVCdXR0b24pIHtcbiAgICAgIGZhdm9yaXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgY29uc3QgY2hhdENhcmQgPSB0YXJnZXQuY2xvc2VzdCgnLnN5c3RlbXNjdWxwdC1jaGF0LWNhcmQnKTtcbiAgICAgICAgaWYgKCFjaGF0Q2FyZCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IGlzRmF2b3JpdGUgPSAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcyhpdGVtLmlkKTtcblxuICAgICAgICBmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiaXMtZmF2b3JpdGVcIiwgaXNGYXZvcml0ZSk7XG4gICAgICAgIGZhdm9yaXRlQnV0dG9uLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICBcImFyaWEtbGFiZWxcIixcbiAgICAgICAgICBpc0Zhdm9yaXRlID8gXCJSZW1vdmUgZnJvbSBmYXZvcml0ZXNcIiA6IFwiQWRkIHRvIGZhdm9yaXRlc1wiXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gRW5zdXJlIGFycmF5IGV4aXN0c1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cykpIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZUNoYXRzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgb3IgcmVtb3ZlIGZyb20gc2V0dGluZ3NcbiAgICAgICAgaWYgKGlzRmF2b3JpdGUpIHtcbiAgICAgICAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlQ2hhdHMuaW5jbHVkZXMoaXRlbS5pZCkpIHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlQ2hhdHMucHVzaChpdGVtLmlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlQ2hhdHMuZmlsdGVyKFxuICAgICAgICAgICAgKGlkKSA9PiBpZCAhPT0gaXRlbS5pZFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gTW92ZSB0aGUgY2FyZCB0byB0aGUgYXBwcm9wcmlhdGUgc2VjdGlvblxuICAgICAgICBpZiAoaXNGYXZvcml0ZSkge1xuICAgICAgICAgIC8vIENoZWNrIGlmIGZhdm9yaXRlcyBzZWN0aW9uIGV4aXN0cywgY3JlYXRlIGlmIG5vdFxuICAgICAgICAgIGxldCBmYXZvcml0ZXNIZWFkZXIgPSB0aGlzLmNoYXRHcmlkLnF1ZXJ5U2VsZWN0b3IoJy5zeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyJyk7XG4gICAgICAgICAgaWYgKCFmYXZvcml0ZXNIZWFkZXIgfHwgIWZhdm9yaXRlc0hlYWRlci50ZXh0Q29udGVudD8uaW5jbHVkZXMoJ0Zhdm9yaXRlcycpKSB7XG4gICAgICAgICAgICBmYXZvcml0ZXNIZWFkZXIgPSB0aGlzLmNoYXRHcmlkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyXCIgfSk7XG4gICAgICAgICAgICBmYXZvcml0ZXNIZWFkZXIuY3JlYXRlU3Bhbih7IHRleHQ6IFwiRmF2b3JpdGVzXCIgfSk7XG4gICAgICAgICAgICB0aGlzLmNoYXRHcmlkLmluc2VydEJlZm9yZShmYXZvcml0ZXNIZWFkZXIsIHRoaXMuY2hhdEdyaWQuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpbmQgd2hlcmUgdG8gaW5zZXJ0IHRoZSBjYXJkIChhZnRlciBoZWFkZXIsIGJlZm9yZSBmaXJzdCBub24tZmF2b3JpdGUpXG4gICAgICAgICAgY29uc3QgbmV4dEVsZW1lbnQgPSBBcnJheS5mcm9tKHRoaXMuY2hhdEdyaWQuY2hpbGRyZW4pLmZpbmQoKGVsLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKGluZGV4IDw9IDEpIHJldHVybiBmYWxzZTsgLy8gU2tpcCBoZWFkZXJcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgKGVsIGFzIEhUTUxFbGVtZW50KS5kYXRhc2V0LmNoYXRJZCB8fCAnJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAobmV4dEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhdEdyaWQuaW5zZXJ0QmVmb3JlKGNoYXRDYXJkLCBuZXh0RWxlbWVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIElmIG5vIG5vbi1mYXZvcml0ZXMsIGluc2VydCBiZWZvcmUgdGhlIFwiUmVjZW50IENoYXRzXCIgaGVhZGVyIG9yIGF0IHRoZSBlbmRcbiAgICAgICAgICAgIGNvbnN0IHJlY2VudEhlYWRlciA9IEFycmF5LmZyb20odGhpcy5jaGF0R3JpZC5jaGlsZHJlbikuZmluZChcbiAgICAgICAgICAgICAgZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyJykgJiYgXG4gICAgICAgICAgICAgICAgICAgKGVsIGFzIEhUTUxFbGVtZW50KS50ZXh0Q29udGVudD8uaW5jbHVkZXMoJ1JlY2VudCBDaGF0cycpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5jaGF0R3JpZC5pbnNlcnRCZWZvcmUoY2hhdENhcmQsIHJlY2VudEhlYWRlciB8fCBudWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTW92ZSB0byByZWNlbnQgY2hhdHMgc2VjdGlvblxuICAgICAgICAgIGxldCByZWNlbnRIZWFkZXIgPSBBcnJheS5mcm9tKHRoaXMuY2hhdEdyaWQuY2hpbGRyZW4pLmZpbmQoXG4gICAgICAgICAgICBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3N5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXInKSAmJiBcbiAgICAgICAgICAgICAgICAgKGVsIGFzIEhUTUxFbGVtZW50KS50ZXh0Q29udGVudD8uaW5jbHVkZXMoJ1JlY2VudCBDaGF0cycpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDcmVhdGUgcmVjZW50IGhlYWRlciBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgICAgaWYgKCFyZWNlbnRIZWFkZXIpIHtcbiAgICAgICAgICAgIHJlY2VudEhlYWRlciA9IHRoaXMuY2hhdEdyaWQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1wcm92aWRlci1oZWFkZXJcIiB9KTtcbiAgICAgICAgICAgIHJlY2VudEhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogXCJSZWNlbnQgQ2hhdHNcIiB9KTtcbiAgICAgICAgICAgIHRoaXMuY2hhdEdyaWQuYXBwZW5kQ2hpbGQocmVjZW50SGVhZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSW5zZXJ0IGFmdGVyIHJlY2VudCBoZWFkZXJcbiAgICAgICAgICBpZiAocmVjZW50SGVhZGVyLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXRHcmlkLmluc2VydEJlZm9yZShjaGF0Q2FyZCwgcmVjZW50SGVhZGVyLm5leHRTaWJsaW5nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jaGF0R3JpZC5hcHBlbmRDaGlsZChjaGF0Q2FyZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgZW1wdHkgc2VjdGlvbnNcbiAgICAgICAgY29uc3QgZmF2b3JpdGVzSGVhZGVyID0gdGhpcy5jaGF0R3JpZC5xdWVyeVNlbGVjdG9yKCcuc3lzdGVtc2N1bHB0LXByb3ZpZGVyLWhlYWRlcicpO1xuICAgICAgICBjb25zdCByZWNlbnRIZWFkZXIgPSBBcnJheS5mcm9tKHRoaXMuY2hhdEdyaWQuY2hpbGRyZW4pLmZpbmQoXG4gICAgICAgICAgZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzeXN0ZW1zY3VscHQtcHJvdmlkZXItaGVhZGVyJykgJiYgXG4gICAgICAgICAgICAgICAoZWwgYXMgSFRNTEVsZW1lbnQpLnRleHRDb250ZW50Py5pbmNsdWRlcygnUmVjZW50IENoYXRzJylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBSZW1vdmUgZmF2b3JpdGVzIGhlYWRlciBpZiBubyBmYXZvcml0ZXNcbiAgICAgICAgaWYgKGZhdm9yaXRlc0hlYWRlciAmJiAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5sZW5ndGgpIHtcbiAgICAgICAgICBmYXZvcml0ZXNIZWFkZXIucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW1vdmUgcmVjZW50IGhlYWRlciBpZiBubyByZWNlbnQgY2hhdHNcbiAgICAgICAgaWYgKHJlY2VudEhlYWRlcikge1xuICAgICAgICAgIGNvbnN0IGhhc1JlY2VudENoYXRzID0gQXJyYXkuZnJvbSh0aGlzLmNoYXRHcmlkLmNoaWxkcmVuKS5zb21lKGVsID0+IFxuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzeXN0ZW1zY3VscHQtY2hhdC1jYXJkJykgJiYgXG4gICAgICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcygoZWwgYXMgSFRNTEVsZW1lbnQpLmRhdGFzZXQuY2hhdElkIHx8ICcnKVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFoYXNSZWNlbnRDaGF0cykge1xuICAgICAgICAgICAgcmVjZW50SGVhZGVyLnJlbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJDaGF0Q2FyZChcbiAgICBpdGVtOiBDaGF0SGlzdG9yeUl0ZW0sXG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSA9IFtdLFxuICAgIHNlY3Rpb25zQ29udGFpbmVyPzogSFRNTEVsZW1lbnRcbiAgKTogSFRNTEVsZW1lbnQge1xuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkQ2FyZCA9IHRoaXMuY2FyZENhY2hlLmdldChpdGVtLmlkKTtcbiAgICBpZiAoY2FjaGVkQ2FyZCkge1xuICAgICAgY29uc3QgY2FyZCA9IGNhY2hlZENhcmQuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUNhcmRIaWdobGlnaHRzKGNhcmQsIG1hdGNoZXMpO1xuICAgICAgfVxuICAgICAgdGhpcy5hdHRhY2hDYXJkRXZlbnRMaXN0ZW5lcnMoY2FyZCwgaXRlbSk7XG4gICAgICBjYXJkLmRhdGFzZXQuY2hhdElkID0gaXRlbS5pZDtcbiAgICAgIHRoaXMuY2hhdENhcmRzLnB1c2goY2FyZCk7XG4gICAgICByZXR1cm4gY2FyZDtcbiAgICB9XG5cbiAgICBjb25zdCBmbGF0SXRlbSA9IHRoaXMuZmxhdHRlbmVkSXRlbXMuZmluZChmID0+IGYuaWQgPT09IGl0ZW0uaWQpO1xuICAgIGlmICghZmxhdEl0ZW0pIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsgLy8gUmV0dXJuIGVtcHR5IGRpdiBpZiBpdGVtIG5vdCBmb3VuZFxuXG4gICAgY29uc3QgaXNTZWxlY3RlZCA9IHRoaXMuaXNLZXlib2FyZE5hdkFjdGl2ZSAmJiB0aGlzLmNoYXRDYXJkcy5sZW5ndGggPT09IHRoaXMuc2VsZWN0ZWRDYXJkSW5kZXg7XG5cbiAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FyZC5jbGFzc05hbWUgPSBgc3lzdGVtc2N1bHB0LWNoYXQtY2FyZCAke2l0ZW0uaWQgPT09IHRoaXMuc2VsZWN0ZWRDaGF0SWQgPyBcInNlbGVjdGVkXCIgOiBcIlwifSAke2lzU2VsZWN0ZWQgPyBcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiIDogXCJcIn1gO1xuXG4gICAgY2FyZC5kYXRhc2V0LmNoYXRJZCA9IGl0ZW0uaWQ7XG4gICAgdGhpcy5jaGF0Q2FyZHMucHVzaChjYXJkKTtcblxuICAgIC8vIEFkZCBmYXZvcml0ZSBidXR0b25cbiAgICBjb25zdCBmYXZvcml0ZUJ1dHRvbiA9IGNhcmQuY3JlYXRlRGl2KHtcbiAgICAgIGNsczogYHN5c3RlbXNjdWxwdC1mYXZvcml0ZS1idXR0b24gJHtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcyhpdGVtLmlkKSA/IFwiaXMtZmF2b3JpdGVcIiA6IFwiXCJcbiAgICAgIH1gLFxuICAgICAgYXR0cjoge1xuICAgICAgICBcImFyaWEtbGFiZWxcIjogdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmF2b3JpdGVDaGF0cy5pbmNsdWRlcyhpdGVtLmlkKVxuICAgICAgICAgID8gXCJSZW1vdmUgZnJvbSBmYXZvcml0ZXNcIlxuICAgICAgICAgIDogXCJBZGQgdG8gZmF2b3JpdGVzXCIsXG4gICAgICAgIHJvbGU6IFwiYnV0dG9uXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHNldEljb24oZmF2b3JpdGVCdXR0b24sIFwic3RhclwiKTtcblxuICAgIGNvbnN0IGhlYWRlciA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWNhcmQtaGVhZGVyXCIgfSk7XG4gICAgY29uc3QgbGVmdENvbnRhaW5lciA9IGhlYWRlci5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaGVhZGVyLWxlZnRcIiB9KTtcblxuICAgIC8vIEFkZCBtb2RlbCBiYWRnZVxuICAgIGNvbnN0IG1vZGVsQmFkZ2UgPSBsZWZ0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1iYWRnZVwiIH0pO1xuICAgIHNldEljb24obW9kZWxCYWRnZSwgXCJib3RcIik7XG4gICAgbW9kZWxCYWRnZS5hcHBlbmRUZXh0KGZsYXRJdGVtLm1vZGVsTmFtZSk7XG5cbiAgICAvLyBBZGQgcHJvbXB0IGJhZGdlXG4gICAgY29uc3QgcHJvbXB0QmFkZ2UgPSBsZWZ0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1iYWRnZVwiIH0pO1xuICAgIHNldEljb24ocHJvbXB0QmFkZ2UsIFwiY29tbWFuZFwiKTtcbiAgICBwcm9tcHRCYWRnZS5hcHBlbmRUZXh0KGZsYXRJdGVtLnByb21wdExhYmVsKTtcblxuICAgIC8vIEFkZCBkb2N1bWVudCBjb250ZXh0IGJhZGdlIGlmIHByZXNlbnRcbiAgICBpZiAoaXRlbS5jb250ZXh0X2ZpbGVzICYmIGl0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBkb2NCYWRnZSA9IGxlZnRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWJhZGdlXCIgfSk7XG4gICAgICBzZXRJY29uKGRvY0JhZGdlLCBcImZpbGUtdGV4dFwiKTtcbiAgICAgIGRvY0JhZGdlLmFwcGVuZFRleHQoYCR7aXRlbS5jb250ZXh0X2ZpbGVzLmxlbmd0aH0gRG9jdW1lbnQke2l0ZW0uY29udGV4dF9maWxlcy5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwifWApO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZpZXcgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1wcmV2aWV3XCIgfSk7XG4gICAgXG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB0aGlzLnNlYXJjaElucHV0Py52YWx1ZTtcbiAgICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gc2VhcmNoUXVlcnk/LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbikgfHwgW107XG4gICAgICBjb25zdCBjb250ZXh0VGV4dCA9IHRoaXMuZ2V0TWF0Y2hDb250ZXh0KGZsYXRJdGVtLm1lc3NhZ2VDb250ZW50LCBtYXRjaGVzLCBzZWFyY2hUZXJtcyk7XG4gICAgICBwcmV2aWV3LmFwcGVuZENoaWxkKHRoaXMuc2VhcmNoU2VydmljZS5oaWdobGlnaHRUZXh0KGNvbnRleHRUZXh0LCBtYXRjaGVzLCBzZWFyY2hRdWVyeSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcmV2aWV3LmFwcGVuZFRleHQoZmxhdEl0ZW0ubGFzdE1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldGEgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1tZXRhXCIgfSk7XG5cbiAgICBjb25zdCBkYXRlRWwgPSBtZXRhLmNyZWF0ZURpdih7IGNsczogXCJzeXN0ZW1zY3VscHQtY2hhdC1pbmZvXCIgfSk7XG4gICAgc2V0SWNvbihkYXRlRWwsIFwiY2FsZW5kYXJcIik7XG4gICAgZGF0ZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiB0aGlzLmZvcm1hdERhdGUoaXRlbS5sYXN0TW9kaWZpZWQpIH0pO1xuXG4gICAgY29uc3QgbWVzc2FnZXNFbCA9IG1ldGEuY3JlYXRlRGl2KHsgY2xzOiBcInN5c3RlbXNjdWxwdC1jaGF0LWluZm9cIiB9KTtcbiAgICBzZXRJY29uKG1lc3NhZ2VzRWwsIFwibWVzc2FnZS1zcXVhcmVcIik7XG4gICAgbWVzc2FnZXNFbC5jcmVhdGVTcGFuKHsgdGV4dDogYCR7aXRlbS5tZXNzYWdlcy5sZW5ndGh9IG1lc3NhZ2Uke2l0ZW0ubWVzc2FnZXMubGVuZ3RoICE9PSAxID8gXCJzXCIgOiBcIlwifWAgfSk7XG5cbiAgICBjb25zdCB0aXRsZUVsID0gbWV0YS5jcmVhdGVEaXYoeyBjbHM6IFwic3lzdGVtc2N1bHB0LWNoYXQtaW5mb1wiIH0pO1xuICAgIHNldEljb24odGl0bGVFbCwgXCJmaWxlXCIpO1xuICAgIHRpdGxlRWwuY3JlYXRlU3Bhbih7IHRleHQ6IGl0ZW0udGl0bGUgfSk7XG5cbiAgICAvLyBBdHRhY2ggZXZlbnQgbGlzdGVuZXJzXG4gICAgdGhpcy5hdHRhY2hDYXJkRXZlbnRMaXN0ZW5lcnMoY2FyZCwgaXRlbSk7XG5cbiAgICAvLyBDYWNoZSB0aGUgY2FyZFxuICAgIHRoaXMuY2FyZENhY2hlLnNldChpdGVtLmlkLCBjYXJkLmNsb25lTm9kZSh0cnVlKSBhcyBIVE1MRWxlbWVudCk7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ2FyZEhpZ2hsaWdodHMoY2FyZDogSFRNTEVsZW1lbnQsIG1hdGNoZXM6IFNlYXJjaE1hdGNoW10pIHtcbiAgICBjb25zdCBwcmV2aWV3ID0gY2FyZC5xdWVyeVNlbGVjdG9yKFwiLnN5c3RlbXNjdWxwdC1jaGF0LXByZXZpZXdcIik7XG4gICAgaWYgKCFwcmV2aWV3KSByZXR1cm47XG5cbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuc2VhcmNoSW5wdXQ/LnZhbHVlO1xuICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gc2VhcmNoUXVlcnk/LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbikgfHwgW107XG4gICAgY29uc3QgZmxhdEl0ZW0gPSB0aGlzLmZsYXR0ZW5lZEl0ZW1zLmZpbmQoZiA9PiBmLmlkID09PSBjYXJkLmRhdGFzZXQuY2hhdElkKTtcbiAgICBpZiAoIWZsYXRJdGVtKSByZXR1cm47XG5cbiAgICBjb25zdCBjb250ZXh0VGV4dCA9IHRoaXMuZ2V0TWF0Y2hDb250ZXh0KGZsYXRJdGVtLm1lc3NhZ2VDb250ZW50LCBtYXRjaGVzLCBzZWFyY2hUZXJtcyk7XG4gICAgcHJldmlldy5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHByZXZpZXcuYXBwZW5kQ2hpbGQodGhpcy5zZWFyY2hTZXJ2aWNlLmhpZ2hsaWdodFRleHQoY29udGV4dFRleHQsIG1hdGNoZXMsIHNlYXJjaFF1ZXJ5KSk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdERhdGUodGltZXN0YW1wOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBuZXcgRGF0ZSh0aW1lc3RhbXApLnRvTG9jYWxlU3RyaW5nKCk7XG4gIH1cblxuICBwcml2YXRlIGdldE1lc3NhZ2VDb250ZW50KG1lc3NhZ2U6IENoYXRNZXNzYWdlKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZW9mIG1lc3NhZ2UuY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG1lc3NhZ2UuY29udGVudDtcbiAgICB9XG4gICAgcmV0dXJuIFwiSW1hZ2UgbWVzc2FnZVwiO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRNb2RlbE5hbWUobW9kZWxJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgaWYgKCFtb2RlbHMpIHJldHVybiBtb2RlbElkO1xuXG4gICAgICBjb25zdCBtb2RlbCA9IG1vZGVscy5maW5kKFxuICAgICAgICAobTogeyBpZDogc3RyaW5nOyBpZGVudGlmaWVyPzogeyBwcm92aWRlcklkOiBzdHJpbmc7IG1vZGVsSWQ6IHN0cmluZzsgZGlzcGxheU5hbWU/OiBzdHJpbmc7IH07IH0pID0+XG4gICAgICAgICAgbS5pZCA9PT0gbW9kZWxJZCB8fFxuICAgICAgICAgIChtLmlkZW50aWZpZXIgJiYgYCR7bS5pZGVudGlmaWVyLnByb3ZpZGVySWR9LyR7bS5pZGVudGlmaWVyLm1vZGVsSWR9YCA9PT0gbW9kZWxJZClcbiAgICAgICk7XG5cbiAgICAgIGlmIChtb2RlbD8uaWRlbnRpZmllcikge1xuICAgICAgICByZXR1cm4gbW9kZWwuaWRlbnRpZmllci5kaXNwbGF5TmFtZSB8fCBtb2RlbC5pZGVudGlmaWVyLm1vZGVsSWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtb2RlbD8ubmFtZSB8fCBtb2RlbElkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBtb2RlbCBuYW1lOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4gbW9kZWxJZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFByb21wdExhYmVsKGl0ZW06IENoYXRIaXN0b3J5SXRlbSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKGl0ZW0uY3VzdG9tUHJvbXB0RmlsZVBhdGgpIHtcbiAgICAgIHJldHVybiBpdGVtLmN1c3RvbVByb21wdEZpbGVQYXRoLnNwbGl0KFwiL1wiKS5wb3AoKT8ucmVwbGFjZSgvXFwubWQkLywgXCJcIikgfHwgXCJDdXN0b20gUHJvbXB0XCI7XG4gICAgfVxuICAgIGlmIChpdGVtLnN5c3RlbVByb21wdFR5cGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdFNlcnZpY2UgPSBTeXN0ZW1Qcm9tcHRTZXJ2aWNlLmdldEluc3RhbmNlKHRoaXMuYXBwKTtcbiAgICAgICAgY29uc3QgcHJlc2V0ID0gYXdhaXQgc3lzdGVtUHJvbXB0U2VydmljZS5nZXRTeXN0ZW1Qcm9tcHRCeUlkKGl0ZW0uc3lzdGVtUHJvbXB0VHlwZSk7XG4gICAgICAgIGlmIChwcmVzZXQpIHtcbiAgICAgICAgICByZXR1cm4gcHJlc2V0LmxhYmVsO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHN5c3RlbSBwcm9tcHQ6XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFwiRGVmYXVsdFwiO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZENhcmQoKSB7XG4gICAgdGhpcy5jaGF0Q2FyZHMuZm9yRWFjaCgoY2FyZCwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5zZWxlY3RlZENhcmRJbmRleCAmJiB0aGlzLmlzS2V5Ym9hcmROYXZBY3RpdmUpIHtcbiAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwic3lzdGVtc2N1bHB0LWtleWJvYXJkLXNlbGVjdGVkXCIpO1xuICAgICAgICBjYXJkLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcIm5lYXJlc3RcIiB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZShcInN5c3RlbXNjdWxwdC1rZXlib2FyZC1zZWxlY3RlZFwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbk5ld0NoYXQoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKTtcbiAgICBsZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICB0eXBlOiBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIHN0YXRlOiB7XG4gICAgICAgIGNoYXRJZDogXCJcIixcbiAgICAgICAgY2hhdFRpdGxlOiBcIk5ldyBDaGF0XCJcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZik7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGlmICh0aGlzLnZpcnR1YWxTY3JvbGxlcikge1xuICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsZXIuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWF0Y2hDb250ZXh0KHRleHQ6IHN0cmluZywgbWF0Y2hlczogU2VhcmNoTWF0Y2hbXSwgc2VhcmNoVGVybXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICBpZiAoIW1hdGNoZXMubGVuZ3RoKSByZXR1cm4gdGV4dDtcblxuICAgIC8vIEZpbmQgYWxsIHRlcm0gcG9zaXRpb25zXG4gICAgY29uc3QgcG9zaXRpb25zOiBudW1iZXJbXSA9IFtdO1xuICAgIHNlYXJjaFRlcm1zLmZvckVhY2godGVybSA9PiB7XG4gICAgICBsZXQgcG9zID0gMDtcbiAgICAgIGNvbnN0IHRleHRMb3dlciA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgIHdoaWxlICgocG9zID0gdGV4dExvd2VyLmluZGV4T2YodGVybSwgcG9zKSkgIT09IC0xKSB7XG4gICAgICAgIHBvc2l0aW9ucy5wdXNoKHBvcyk7XG4gICAgICAgIHBvcyArPSAxO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFwb3NpdGlvbnMubGVuZ3RoKSByZXR1cm4gdGV4dDtcblxuICAgIC8vIFNvcnQgcG9zaXRpb25zIGFuZCBmaW5kIHRoZSBiZXN0IGNsdXN0ZXJcbiAgICBwb3NpdGlvbnMuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgIFxuICAgIGNvbnN0IENPTlRFWFRfU0laRSA9IDc1O1xuICAgIGxldCBiZXN0U3RhcnQgPSBwb3NpdGlvbnNbMF07XG4gICAgbGV0IGJlc3RFbmQgPSBwb3NpdGlvbnNbMF07XG4gICAgbGV0IGJlc3RTcGFuID0gSW5maW5pdHk7XG5cbiAgICAvLyBGaW5kIHNtYWxsZXN0IHdpbmRvdyBjb250YWluaW5nIG1vc3QgbWF0Y2hlc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zaXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdGFydCA9IHBvc2l0aW9uc1tpXTtcbiAgICAgIGxldCBlbmQgPSBzdGFydDtcbiAgICAgIGxldCBtYXRjaENvdW50ID0gMTtcblxuICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgcG9zaXRpb25zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbnNbal0gLSBzdGFydCA+IENPTlRFWFRfU0laRSAqIDIpIGJyZWFrO1xuICAgICAgICBlbmQgPSBwb3NpdGlvbnNbal07XG4gICAgICAgIG1hdGNoQ291bnQrKztcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3BhbiA9IGVuZCAtIHN0YXJ0O1xuICAgICAgaWYgKG1hdGNoQ291bnQgPiAxICYmIHNwYW4gPCBiZXN0U3Bhbikge1xuICAgICAgICBiZXN0U3RhcnQgPSBzdGFydDtcbiAgICAgICAgYmVzdEVuZCA9IGVuZDtcbiAgICAgICAgYmVzdFNwYW4gPSBzcGFuO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBwcmV2aWV3IHdpbmRvd1xuICAgIGNvbnN0IGNvbnRleHRTdGFydCA9IE1hdGgubWF4KDAsIGJlc3RTdGFydCAtIENPTlRFWFRfU0laRSk7XG4gICAgY29uc3QgY29udGV4dEVuZCA9IE1hdGgubWluKHRleHQubGVuZ3RoLCBiZXN0RW5kICsgQ09OVEVYVF9TSVpFKTtcblxuICAgIC8vIEZpbmQgY2xlYW4gd29yZCBib3VuZGFyaWVzXG4gICAgbGV0IHByZXZpZXdTdGFydCA9IGNvbnRleHRTdGFydDtcbiAgICB3aGlsZSAocHJldmlld1N0YXJ0ID4gMCAmJiAhL1tcXHMuIT9cXG5dLy50ZXN0KHRleHRbcHJldmlld1N0YXJ0IC0gMV0pKSB7XG4gICAgICBwcmV2aWV3U3RhcnQtLTtcbiAgICB9XG5cbiAgICBsZXQgcHJldmlld0VuZCA9IGNvbnRleHRFbmQ7XG4gICAgd2hpbGUgKHByZXZpZXdFbmQgPCB0ZXh0Lmxlbmd0aCAmJiAhL1tcXHMuIT9cXG5dLy50ZXN0KHRleHRbcHJldmlld0VuZF0pKSB7XG4gICAgICBwcmV2aWV3RW5kKys7XG4gICAgfVxuXG4gICAgbGV0IHByZXZpZXcgPSB0ZXh0LnNsaWNlKHByZXZpZXdTdGFydCwgcHJldmlld0VuZCkudHJpbSgpO1xuICAgIFxuICAgIC8vIEFkZCBlbGxpcHNpc1xuICAgIGlmIChwcmV2aWV3U3RhcnQgPiAwKSBwcmV2aWV3ID0gXCIuLi5cIiArIHByZXZpZXc7XG4gICAgaWYgKHByZXZpZXdFbmQgPCB0ZXh0Lmxlbmd0aCkgcHJldmlldyA9IHByZXZpZXcgKyBcIi4uLlwiO1xuXG4gICAgcmV0dXJuIHByZXZpZXc7XG4gIH1cblxuICBwcml2YXRlIGdldFZpc2libGVDaGF0cygpOiBTZWFyY2hSZXN1bHQ8Q2hhdEhpc3RvcnlJdGVtPltdIHtcbiAgICAvLyBJZiB0aGVyZSdzIG5vIHNlYXJjaCBxdWVyeSwganVzdCByZXR1cm4gdGhlbSBhbGwgc29ydGVkIGJ5IGRhdGVcbiAgICBpZiAoIXRoaXMuc2VhcmNoSW5wdXQgfHwgIXRoaXMuc2VhcmNoSW5wdXQudmFsdWUudHJpbSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy5mbGF0dGVuZWRJdGVtcy5tYXAoKGl0ZW0pID0+ICh7XG4gICAgICAgIGl0ZW06IGl0ZW0uaXRlbSxcbiAgICAgICAgbWF0Y2hlczogW10sXG4gICAgICAgIHNjb3JlOiAwLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5zZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgICAvLyBBcHBseSBzZWFyY2ggYW5kIGZpbHRlclxuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoKFxuICAgICAgdGhpcy5mbGF0dGVuZWRJdGVtcy5tYXAoZiA9PiBmLml0ZW0pLFxuICAgICAgcXVlcnksXG4gICAgICAoY2hhdCkgPT4gdGhpcy5nZXRTZWFyY2hhYmxlRmllbGRzKGNoYXQpLFxuICAgICAge1xuICAgICAgICBpbml0aWFsUmVzdWx0c0xpbWl0OiAyNSxcbiAgICAgICAgbWF4RmlsdGVyZWRSZXN1bHRzOiA1MCxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gRmlsdGVyIG91dCByZXN1bHRzIHdpdGggbm8gbWF0Y2hlcyBvciBsb3cgc2NvcmVzXG4gICAgY29uc3QgZmlsdGVyZWRSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoXG4gICAgICAocmVzdWx0KSA9PiByZXN1bHQubWF0Y2hlcy5sZW5ndGggPiAwICYmIHJlc3VsdC5zY29yZSA+IDBcbiAgICApO1xuXG4gICAgLy8gU29ydCByZXN1bHRzIGJ5IHNjb3JlXG4gICAgcmV0dXJuIGZpbHRlcmVkUmVzdWx0cy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlYXJjaGFibGVGaWVsZHMgPSAoXG4gICAgICBjaGF0OiBDaGF0SGlzdG9yeUl0ZW1cbiAgKTogU2VhcmNoYWJsZUZpZWxkW10gPT4ge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgeyBmaWVsZDogXCJ0aXRsZVwiLCB0ZXh0OiBjaGF0LnRpdGxlLCB3ZWlnaHQ6IDIwMCB9LFxuICAgICAgICB7IGZpZWxkOiBcImNvbnRlbnRcIiwgdGV4dDogY2hhdC5tZXNzYWdlcy5tYXAobSA9PiB0aGlzLmdldE1lc3NhZ2VDb250ZW50KG0pKS5qb2luKFwiIFwiKSwgd2VpZ2h0OiAxMDAgfSxcbiAgICAgIF07XG4gIH07XG59XG4iLCAiaW1wb3J0IHsgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBKYW5pdG9yTW9kYWwgfSBmcm9tIFwiLi4vLi4vbW9kYWxzL0phbml0b3JNb2RhbFwiO1xuaW1wb3J0IHsgTG9hZENoYXRNb2RhbCB9IGZyb20gXCIuLi8uLi9tb2RhbHMvTG9hZENoYXRNb2RhbFwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcsIENIQVRfVklFV19UWVBFIH0gZnJvbSBcIi4uLy4uL3ZpZXdzL2NoYXR2aWV3L0NoYXRWaWV3XCI7XG5pbXBvcnQgeyBDaGF0U3RvcmFnZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvQ2hhdFN0b3JhZ2VTZXJ2aWNlXCI7XG5cbmV4cG9ydCBjbGFzcyBSaWJib25NYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBjaGF0U3RvcmFnZTogQ2hhdFN0b3JhZ2VTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBhcHA6IEFwcCkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMuY2hhdFN0b3JhZ2UgPSBuZXcgQ2hhdFN0b3JhZ2VTZXJ2aWNlKGFwcCwgcGx1Z2luLnNldHRpbmdzLmNoYXRzRGlyZWN0b3J5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSByaWJib24gbWFuYWdlciBhbmQgcmVnaXN0ZXIgYWxsIHJpYmJvbiBpY29uc1xuICAgKi9cbiAgaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyUmliYm9uSWNvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhbGwgcmliYm9uIGljb25zIGluIHRoZSBjb3JyZWN0IG9yZGVyOlxuICAgKiAxLiBTeXN0ZW1TY3VscHQgQ2hhdFxuICAgKiAyLiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XG4gICAqIDMuIFN5c3RlbVNjdWxwdCBKYW5pdG9yXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyUmliYm9uSWNvbnMoKSB7XG4gICAgLy8gMS4gU3lzdGVtU2N1bHB0IENoYXRcbiAgICB0aGlzLnBsdWdpbi5hZGRSaWJib25JY29uKFxuICAgICAgXCJtZXNzYWdlLXNxdWFyZVwiLFxuICAgICAgXCJPcGVuIFN5c3RlbVNjdWxwdCBDaGF0XCIsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMub3BlbkNoYXRWaWV3KCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIDIuIENoYXQgSGlzdG9yeVxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXG4gICAgICBcImhpc3RvcnlcIixcbiAgICAgIFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdCBIaXN0b3J5XCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMub3BlbkNoYXRIaXN0b3J5TW9kYWwoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gMy4gSmFuaXRvclxuICAgIHRoaXMucGx1Z2luLmFkZFJpYmJvbkljb24oXCJ0cmFzaFwiLCBcIk9wZW4gU3lzdGVtU2N1bHB0IEphbml0b3JcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vcGVuSmFuaXRvck1vZGFsKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogT3BlbiBhIG5ldyBTeXN0ZW1TY3VscHQgQ2hhdCB2aWV3IGluIGEgbmV3IHRhYlxuICAgKi9cbiAgcHVibGljIGFzeW5jIG9wZW5DaGF0VmlldygpIHtcbiAgICBjb25zdCB7IHdvcmtzcGFjZSB9ID0gdGhpcy5hcHA7XG4gICAgY29uc3QgbGVhZiA9IHdvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgIGF3YWl0IGxlYWYub3Blbih2aWV3KTtcbiAgICB3b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBDaGF0IEhpc3RvcnkgbW9kYWxcbiAgICovXG4gIHB1YmxpYyBvcGVuQ2hhdEhpc3RvcnlNb2RhbCgpIHtcbiAgICBjb25zdCBtb2RhbCA9IG5ldyBMb2FkQ2hhdE1vZGFsKFxuICAgICAgdGhpcy5hcHAsXG4gICAgICB0aGlzLnBsdWdpblxuICAgICk7XG4gICAgbW9kYWwub3BlbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIFN5c3RlbVNjdWxwdCBKYW5pdG9yIG1vZGFsXG4gICAqL1xuICBwdWJsaWMgb3Blbkphbml0b3JNb2RhbCgpIHtcbiAgICBuZXcgSmFuaXRvck1vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbikub3BlbigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgU3lzdGVtU2N1bHB0UGx1Z2luIGZyb20gXCIuLi8uLi9tYWluXCI7XG5pbXBvcnQgeyBSaWJib25NYW5hZ2VyIH0gZnJvbSBcIi4vcmliYm9uc1wiO1xuaW1wb3J0IHsgU3lzdGVtUHJvbXB0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9TeXN0ZW1Qcm9tcHRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBDSEFUX1ZJRVdfVFlQRSwgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vLi4vdmlld3MvY2hhdHZpZXcvQ2hhdFZpZXdcIjtcblxuaW50ZXJmYWNlIENoYXRTdGF0ZSB7XG4gIGNoYXRJZDogc3RyaW5nO1xuICBtZXNzYWdlczogYW55W107XG4gIHNldHRpbmdzOiBhbnk7XG4gIFtrZXk6IHN0cmluZ106IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIFZpZXdNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBwbHVnaW46IFN5c3RlbVNjdWxwdFBsdWdpbjtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSByaWJib25NYW5hZ2VyOiBSaWJib25NYW5hZ2VyO1xuICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBpc0luaXRpYWxpemluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGluaXRQcm9taXNlOiBQcm9taXNlPHZvaWQ+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGVmZXJyZWRWaWV3czogTWFwPHN0cmluZywgKCkgPT4gdm9pZD4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgaW5pdGlhbGl6YXRpb25UaW1lb3V0OiBudW1iZXIgPSAyMDAwO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luLCBhcHA6IEFwcCkge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuYXBwID0gYXBwO1xuICAgIHRoaXMucmliYm9uTWFuYWdlciA9IG5ldyBSaWJib25NYW5hZ2VyKHBsdWdpbiwgYXBwKTtcbiAgfVxuXG4gIGluaXRpYWxpemUoKSB7XG4gICAgLy8gUmVnaXN0ZXIgdmlldyBpbW1lZGlhdGVseSAtIHRoaXMgaXMgY3JpdGljYWxcbiAgICB0aGlzLnJlZ2lzdGVyVmlldygpO1xuICAgIFxuICAgIC8vIEluaXRpYWxpemUgcmliYm9uIG1hbmFnZXIgaW4gdGhlIGJhY2tncm91bmRcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmliYm9uTWFuYWdlci5pbml0aWFsaXplKCksIDApO1xuICAgIFxuICAgIC8vIFdhaXQgZm9yIGxheW91dCB0byBiZSByZWFkeSBiZWZvcmUgbWluaW1hbCBpbml0aWFsaXphdGlvblxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KCgpID0+IHtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZUluQmFja2dyb3VuZCgpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gVmlldyBpbml0aWFsaXphdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVJbkJhY2tncm91bmQoKSB7XG4gICAgaWYgKHRoaXMuaXNJbml0aWFsaXppbmcgfHwgdGhpcy5pc0luaXRpYWxpemVkKSByZXR1cm47XG4gICAgdGhpcy5pc0luaXRpYWxpemluZyA9IHRydWU7XG5cbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgLy8gT25seSBpbml0aWFsaXplIHdoYXQncyBuZWVkZWQgZm9yIHZpc2libGUgdmlld3NcbiAgICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoQ0hBVF9WSUVXX1RZUEUpO1xuICAgICAgY29uc3QgdmlzaWJsZUxlYXZlcyA9IGxlYXZlcy5maWx0ZXIobGVhZiA9PiAhbGVhZi52aWV3LmNvbnRhaW5lckVsLmhpZGRlbik7XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgbGVhZiBvZiB2aXNpYmxlTGVhdmVzKSB7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXcgYXMgQ2hhdFZpZXc7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gbGVhZi5nZXRWaWV3U3RhdGUoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNWYWxpZENoYXRTdGF0ZShzdGF0ZSkpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlc3RvcmVWaWV3KHZpZXcsIHN0YXRlLnN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsaXplIG1vZGVscyBhbmQgcHJvbXB0cyBvbmx5IGlmIG5lZWRlZFxuICAgICAgaWYgKHZpc2libGVMZWF2ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZU1vZGVscygpLFxuICAgICAgICAgIG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcihcIk1vZGVscyBpbml0IHRpbWVvdXRcIikpLCAyMDAwKSlcbiAgICAgICAgXSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcIltTeXN0ZW1TY3VscHRdIE1vZGVscyBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgIC8vIFByb2Nlc3MgYW55IGRlZmVycmVkIHZpZXdzXG4gICAgICBmb3IgKGNvbnN0IFtpZCwgaW5pdEZuXSBvZiB0aGlzLmRlZmVycmVkVmlld3MpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpbml0Rm4oKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkZWZlcnJlZCB2aWV3ICR7aWR9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5kZWZlcnJlZFZpZXdzLmNsZWFyKCk7XG5cbiAgICAgIC8vIFJlc3RvcmUgcmVtYWluaW5nIGNoYXQgdmlld3MgaW4gdGhlIGJhY2tncm91bmRcbiAgICAgIGNvbnN0IGhpZGRlbkxlYXZlcyA9IGxlYXZlcy5maWx0ZXIobGVhZiA9PiBsZWFmLnZpZXcuY29udGFpbmVyRWwuaGlkZGVuKTtcbiAgICAgIGlmIChoaWRkZW5MZWF2ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGxlYWYgb2YgaGlkZGVuTGVhdmVzKSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3ID0gbGVhZi52aWV3IGFzIENoYXRWaWV3O1xuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBsZWFmLmdldFZpZXdTdGF0ZSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWYWxpZENoYXRTdGF0ZShzdGF0ZSkpIHtcbiAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlVmlldyh2aWV3LCBzdGF0ZS5zdGF0ZSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gcmVzdG9yZSBoaWRkZW4gdmlldzpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIDApO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBCYWNrZ3JvdW5kIGluaXRpYWxpemF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZXN0b3JlVmlldyh2aWV3OiBDaGF0Vmlldywgc3RhdGU6IENoYXRTdGF0ZSkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB2aWV3LnNldFN0YXRlKHN0YXRlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gcmVzdG9yZSBjaGF0ICR7c3RhdGUuY2hhdElkfTpgLCBlcnJvcik7XG4gICAgICB2aWV3LmxlYWY/LmRldGFjaCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZU1vZGVscygpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgdGhpcy5wbHVnaW4ubW9kZWxTZXJ2aWNlLmdldE1vZGVscygpO1xuICAgICAgcmV0dXJuIG1vZGVscztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gTW9kZWwgcHJlbG9hZCBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIC8vIENvbnRpbnVlIHdpdGggaW5pdGlhbGl6YXRpb24gLSBtb2RlbHMgY2FuIGxvYWQgb24gZGVtYW5kXG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplU3lzdGVtUHJvbXB0cygpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgU3lzdGVtUHJvbXB0U2VydmljZS5pbml0aWFsaXplQ2FjaGUoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gU3lzdGVtIHByb21wdHMgY2FjaGUgaW5pdGlhbGl6YXRpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICAvLyBDb250aW51ZSB3aXRoIGluaXRpYWxpemF0aW9uIC0gcHJvbXB0cyBjYW4gbG9hZCBvbiBkZW1hbmRcbiAgICB9XG4gIH1cblxuICAvLyBNZXRob2QgdG8gZGVmZXIgYSB2aWV3IGluaXRpYWxpemF0aW9uXG4gIHB1YmxpYyBkZWZlclZpZXdJbml0aWFsaXphdGlvbihpZDogc3RyaW5nLCBpbml0Rm46ICgpID0+IHZvaWQpIHtcbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICAvLyBJZiBhbHJlYWR5IGluaXRpYWxpemVkLCBydW4gaW1tZWRpYXRlbHlcbiAgICAgIGluaXRGbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPdGhlcndpc2Ugc3RvcmUgZm9yIGxhdGVyXG4gICAgICB0aGlzLmRlZmVycmVkVmlld3Muc2V0KGlkLCBpbml0Rm4pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlc3RvcmVDaGF0Vmlld3MoKSB7XG4gICAgY29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShDSEFUX1ZJRVdfVFlQRSk7XG4gICAgaWYgKGxlYXZlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGxlYWYgb2YgbGVhdmVzKSB7XG4gICAgICBjb25zdCB2aWV3ID0gbGVhZi52aWV3IGFzIENoYXRWaWV3O1xuICAgICAgY29uc3Qgc3RhdGUgPSBsZWFmLmdldFZpZXdTdGF0ZSgpO1xuICAgICAgXG4gICAgICBpZiAoIXRoaXMuaXNWYWxpZENoYXRTdGF0ZShzdGF0ZSkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gSW52YWxpZCBjaGF0IHN0YXRlLCBza2lwcGluZzpcIiwgc3RhdGUpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IHN0YXRlLnN0YXRlIGV4aXN0cyBhbmQgaXMgdmFsaWRcbiAgICAgIGNvbnN0IGNoYXRTdGF0ZSA9IHN0YXRlLnN0YXRlIGFzIENoYXRTdGF0ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmV0cnlTZXRTdGF0ZSh2aWV3LCBjaGF0U3RhdGUpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gcmVzdG9yZSBjaGF0ICR7Y2hhdFN0YXRlLmNoYXRJZH06YCwgZXJyb3IpO1xuICAgICAgICAvLyBDbGVhbiB1cCBpbnZhbGlkIGxlYWYgdG8gcHJldmVudCBmdXR1cmUgZXJyb3JzXG4gICAgICAgIGxlYWYuZGV0YWNoKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1ZhbGlkQ2hhdFN0YXRlKHN0YXRlOiBhbnkpOiBzdGF0ZSBpcyB7IHN0YXRlOiBDaGF0U3RhdGUgfSB7XG4gICAgLy8gTXVzdCBoYXZlIGF0IGxlYXN0IGEgY2hhdElkXG4gICAgaWYgKCFzdGF0ZT8uc3RhdGU/LmNoYXRJZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGNoYXRJZCA9IHN0YXRlLnN0YXRlLmNoYXRJZDtcblxuICAgIC8vIFZhbGlkYXRlIGRhdGEgdHlwZXMgaWYgdGhleSBleGlzdCwgYnV0IGRvbid0IGNyZWF0ZSB0aGVtIHlldFxuICAgIGlmIChcIm1lc3NhZ2VzXCIgaW4gc3RhdGUuc3RhdGUpIHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZS5zdGF0ZS5tZXNzYWdlcykpIHtcbiAgICAgICAgc3RhdGUuc3RhdGUubWVzc2FnZXMgPSBbXTtcbiAgICAgIH0gZWxzZSBpZiAoc3RhdGUuc3RhdGUubWVzc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcInNldHRpbmdzXCIgaW4gc3RhdGUuc3RhdGUpIHtcbiAgICAgIGlmICh0eXBlb2Ygc3RhdGUuc3RhdGUuc2V0dGluZ3MgIT09IFwib2JqZWN0XCIgfHwgc3RhdGUuc3RhdGUuc2V0dGluZ3MgPT09IG51bGwpIHtcbiAgICAgICAgc3RhdGUuc3RhdGUuc2V0dGluZ3MgPSB7fTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBPbmx5IGluaXRpYWxpemUgZW1wdHkgYXJyYXlzL29iamVjdHMgaWYgdGhleSBkb24ndCBleGlzdCBhdCBhbGxcbiAgICBpZiAoIShcIm1lc3NhZ2VzXCIgaW4gc3RhdGUuc3RhdGUpKSB7XG4gICAgICBzdGF0ZS5zdGF0ZS5tZXNzYWdlcyA9IFtdO1xuICAgIH1cblxuICAgIGlmICghKFwic2V0dGluZ3NcIiBpbiBzdGF0ZS5zdGF0ZSkpIHtcbiAgICAgIHN0YXRlLnN0YXRlLnNldHRpbmdzID0ge307XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJldHJ5U2V0U3RhdGUodmlldzogQ2hhdFZpZXcsIHN0YXRlOiBhbnksIG1heFJldHJpZXM6IG51bWJlciA9IDMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xuICAgIFxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAxOyBhdHRlbXB0IDw9IG1heFJldHJpZXM7IGF0dGVtcHQrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGF0dGVtcHQgPiAxKSB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIE1hdGgucG93KDIsIGF0dGVtcHQgLSAxKSAqIDEwMDApKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYXdhaXQgdmlldy5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgICAgIGlmIChhdHRlbXB0ID4gMSkge1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVycm9yIGFzIEVycm9yO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJlc3RvcmUgY2hhdCBhZnRlciAke21heFJldHJpZXN9IGF0dGVtcHRzOiAke2xhc3RFcnJvcj8ubWVzc2FnZX1gKTtcbiAgfVxuXG4gIHJlZ2lzdGVyVmlldygpIHtcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlclZpZXcoXG4gICAgICBDSEFUX1ZJRVdfVFlQRSxcbiAgICAgIChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pXG4gICAgKTtcbiAgfVxuXG4gIHVubG9hZFZpZXdzKCkge1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5kZXRhY2hMZWF2ZXNPZlR5cGUoQ0hBVF9WSUVXX1RZUEUpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNYXJrZG93blZpZXcgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBTeXN0ZW1TY3VscHRQbHVnaW4gZnJvbSBcIi4uLy4uL21haW5cIjtcbmltcG9ydCB7IFJpYmJvbk1hbmFnZXIgfSBmcm9tIFwiLi9yaWJib25zXCI7XG5pbXBvcnQgeyBNb2RlbFNlbGVjdGlvbk1vZGFsIH0gZnJvbSBcIi4uLy4uL21vZGFscy9Nb2RlbFNlbGVjdGlvbk1vZGFsXCI7XG5pbXBvcnQgeyBzaG93RW5oYW5jZWROb3RpY2UgfSBmcm9tIFwiLi4vLi4vY29yZS91aVwiO1xuaW1wb3J0IHsgQ2hhdFZpZXcgfSBmcm9tIFwiLi4vLi4vdmlld3MvY2hhdHZpZXcvQ2hhdFZpZXdcIjtcbmltcG9ydCB7IFRpdGxlR2VuZXJhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvVGl0bGVHZW5lcmF0aW9uU2VydmljZVwiO1xuXG5leHBvcnQgY2xhc3MgQ29tbWFuZE1hbmFnZXIge1xuICBwcml2YXRlIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luO1xuICBwcml2YXRlIGFwcDogQXBwO1xuICBwcml2YXRlIHJpYmJvbk1hbmFnZXI6IFJpYmJvbk1hbmFnZXI7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sIGFwcDogQXBwKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5yaWJib25NYW5hZ2VyID0gbmV3IFJpYmJvbk1hbmFnZXIocGx1Z2luLCBhcHApO1xuICB9XG5cbiAgcmVnaXN0ZXJDb21tYW5kcygpIHtcbiAgICB0aGlzLnJlZ2lzdGVyT3BlblRhc2tzRmlsZSgpO1xuICAgIHRoaXMucmVnaXN0ZXJUb2dnbGVBdWRpb1JlY29yZGVyKCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5DaGF0KCk7XG4gICAgdGhpcy5yZWdpc3Rlck9wZW5DaGF0SGlzdG9yeSgpO1xuICAgIHRoaXMucmVnaXN0ZXJPcGVuSmFuaXRvcigpO1xuICAgIHRoaXMucmVnaXN0ZXJSZWxvYWRPYnNpZGlhbigpO1xuICAgIHRoaXMucmVnaXN0ZXJPcGVuU2V0dGluZ3MoKTtcbiAgICB0aGlzLnJlZ2lzdGVyQ2hhbmdlQ2hhdE1vZGVsKCk7XG4gICAgdGhpcy5yZWdpc3RlckNoYXRXaXRoRmlsZSgpO1xuICAgIHRoaXMucmVnaXN0ZXJUYXNrTW92ZW1lbnRDb21tYW5kcygpO1xuICAgIHRoaXMucmVnaXN0ZXJDaGFuZ2VDaGF0VGl0bGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPcGVuVGFza3NGaWxlKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwib3Blbi10YXNrcy1maWxlXCIsXG4gICAgICBuYW1lOiBcIk9wZW4gVGFza3MgRmlsZVwiLFxuICAgICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLm9wZW5PckNyZWF0ZVRhc2tzRmlsZSgpO1xuICAgICAgfSxcbiAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiTW9kXCJdLCBrZXk6IFwidFwiIH1dLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlclRvZ2dsZUF1ZGlvUmVjb3JkZXIoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJ0b2dnbGUtYXVkaW8tcmVjb3JkZXJcIixcbiAgICAgIG5hbWU6IFwiVG9nZ2xlIEF1ZGlvIFJlY29yZGVyXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICB0aGlzLnBsdWdpbi5nZXRSZWNvcmRlclNlcnZpY2UoKS50b2dnbGVSZWNvcmRpbmcoKTtcbiAgICAgIH0sXG4gICAgICBob3RrZXlzOiBbeyBtb2RpZmllcnM6IFtcIk1vZFwiXSwga2V5OiBcInJcIiB9XSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPcGVuQ2hhdCgpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tc3lzdGVtc2N1bHB0LWNoYXRcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBTeXN0ZW1TY3VscHQgQ2hhdFwiLFxuICAgICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5yaWJib25NYW5hZ2VyLm9wZW5DaGF0VmlldygpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPcGVuQ2hhdEhpc3RvcnkoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLWNoYXQtaGlzdG9yeVwiLFxuICAgICAgbmFtZTogXCJPcGVuIFN5c3RlbVNjdWxwdCBDaGF0IEhpc3RvcnlcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucmliYm9uTWFuYWdlci5vcGVuQ2hhdEhpc3RvcnlNb2RhbCgpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPcGVuSmFuaXRvcigpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tc3lzdGVtc2N1bHB0LWphbml0b3JcIixcbiAgICAgIG5hbWU6IFwiT3BlbiBTeXN0ZW1TY3VscHQgSmFuaXRvclwiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5yaWJib25NYW5hZ2VyLm9wZW5KYW5pdG9yTW9kYWwoKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyUmVsb2FkT2JzaWRpYW4oKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJyZWxvYWQtb2JzaWRpYW5cIixcbiAgICAgIG5hbWU6IFwiUmVsb2FkIE9ic2lkaWFuXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9wZW5TZXR0aW5ncygpIHtcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm9wZW4tc3lzdGVtc2N1bHB0LXNldHRpbmdzXCIsXG4gICAgICBuYW1lOiBcIk9wZW4gU3lzdGVtU2N1bHB0IEFJIFNldHRpbmdzXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAvLyBAdHMtaWdub3JlIFx1MjAxMyB0aGlzIGlzIGEga25vd24gT2JzaWRpYW4gQVBJIGJ1Z1xuICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLm9wZW4oKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLm9wZW5UYWJCeUlkKHRoaXMucGx1Z2luLm1hbmlmZXN0LmlkKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ2hhbmdlQ2hhdE1vZGVsKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2hhbmdlLWNoYXQtbW9kZWxcIixcbiAgICAgIG5hbWU6IFwiQ2hhbmdlIENoYXQgTW9kZWxcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBjaGF0VmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKENoYXRWaWV3KTtcbiAgICAgICAgaWYgKCFjaGF0Vmlldykge1xuICAgICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICAgICAgXCJZb3UgbmVlZCB0byBiZSB3aXRoaW4gYSBTeXN0ZW1TY3VscHQgY2hhdHZpZXcgdG8gY2hhbmdlIHRoZSBtb2RlbC5cIixcbiAgICAgICAgICAgICAgXCJ3YXJuaW5nXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLm1vZGVsU2VydmljZS5nZXRNb2RlbHMoKTtcbiAgICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kZWxTZWxlY3Rpb25Nb2RhbChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICBjaGF0Vmlldy5nZXRTZWxlY3RlZE1vZGVsSWQoKSxcbiAgICAgICAgICAgICAgICBhc3luYyAobW9kZWxJZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2V0U2VsZWN0ZWRNb2RlbElkKG1vZGVsSWQpO1xuICAgICAgICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiTW9kZWwgY2hhbmdlZCBzdWNjZXNzZnVsbHlcIiwgXCJpbmZvXCIpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gb3BlbiBtb2RlbCBzZWxlY3Rpb246XCIsIGVycik7XG4gICAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byBmZXRjaCBhdmFpbGFibGUgbW9kZWxzXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ2hhdFdpdGhGaWxlKCkge1xuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2hhdC13aXRoLWZpbGVcIixcbiAgICAgIG5hbWU6IFwiQ2hhdCB3aXRoIEZpbGVcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICAgICAgaWYgKCFhY3RpdmVGaWxlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGFjdGl2ZUZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHN1cHBvcnRlZEV4dGVuc2lvbnMgPSBbXG4gICAgICAgICAgXCJtZFwiLFxuICAgICAgICAgIFwidHh0XCIsXG4gICAgICAgICAgXCJtYXJrZG93blwiLFxuICAgICAgICAgIFwicGRmXCIsXG4gICAgICAgICAgXCJkb2NcIixcbiAgICAgICAgICBcImRvY3hcIixcbiAgICAgICAgICBcInBwdFwiLFxuICAgICAgICAgIFwicHB0eFwiLFxuICAgICAgICAgIFwieGxzXCIsXG4gICAgICAgICAgXCJ4bHN4XCIsXG4gICAgICAgICAgXCJtcDNcIixcbiAgICAgICAgICBcIndhdlwiLFxuICAgICAgICAgIFwibTRhXCIsXG4gICAgICAgICAgXCJvZ2dcIixcbiAgICAgICAgICBcIndlYm1cIixcbiAgICAgICAgICBcImpwZ1wiLFxuICAgICAgICAgIFwianBlZ1wiLFxuICAgICAgICAgIFwicG5nXCIsXG4gICAgICAgICAgXCJnaWZcIixcbiAgICAgICAgICBcIndlYnBcIixcbiAgICAgICAgICBcInN2Z1wiLFxuICAgICAgICBdO1xuICAgICAgICBpZiAoIXN1cHBvcnRlZEV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKFwidGFiXCIpO1xuICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgQ2hhdFZpZXcobGVhZiwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgIGxlYWYub3Blbih2aWV3KS50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwKSk7XG4gICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICAgICAgYXdhaXQgdmlldy5hZGRGaWxlVG9Db250ZXh0KGFjdGl2ZUZpbGUpO1xuICAgICAgICAgICAgdmlldy5mb2N1c0lucHV0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGFsbCB0YXNrIG1vdmVtZW50IHJlbGF0ZWQgY29tbWFuZHNcbiAgICovXG4gIHByaXZhdGUgcmVnaXN0ZXJUYXNrTW92ZW1lbnRDb21tYW5kcygpIHtcbiAgICAvLyBNb3ZlIHRhc2sgdXBcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcIm1vdmUtdGFzay11cFwiLFxuICAgICAgbmFtZTogXCJNb3ZlIFRhc2sgVXBcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaWxlID0gYWN0aXZlVmlldy5maWxlO1xuICAgICAgICBpZiAoIWZpbGUgfHwgIXRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5pc1Rhc2tzRmlsZShmaWxlLnBhdGgpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5tb3ZlVGFza1VwKGFjdGl2ZVZpZXcuZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE1vdmUgdGFzayBkb3duXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJtb3ZlLXRhc2stZG93blwiLFxuICAgICAgbmFtZTogXCJNb3ZlIFRhc2sgRG93blwiLFxuICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZpbGUgPSBhY3RpdmVWaWV3LmZpbGU7XG4gICAgICAgIGlmICghZmlsZSB8fCAhdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLmlzVGFza3NGaWxlKGZpbGUucGF0aCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4udGFza3NTZXJ2aWNlLm1vdmVUYXNrRG93bihhY3RpdmVWaWV3LmVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJbmRlbnQgdGFzayByaWdodFxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiaW5kZW50LXRhc2stcmlnaHRcIixcbiAgICAgIG5hbWU6IFwiSW5kZW50IFRhc2sgUmlnaHRcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaWxlID0gYWN0aXZlVmlldy5maWxlO1xuICAgICAgICBpZiAoIWZpbGUgfHwgIXRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5pc1Rhc2tzRmlsZShmaWxlLnBhdGgpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnRhc2tzU2VydmljZS5pbmRlbnRUYXNrUmlnaHQoYWN0aXZlVmlldy5lZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSW5kZW50IHRhc2sgbGVmdFxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiaW5kZW50LXRhc2stbGVmdFwiLFxuICAgICAgbmFtZTogXCJJbmRlbnQgVGFzayBMZWZ0XCIsXG4gICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgY29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgIGlmICghYWN0aXZlVmlldykgcmV0dXJuIGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZmlsZSA9IGFjdGl2ZVZpZXcuZmlsZTtcbiAgICAgICAgaWYgKCFmaWxlIHx8ICF0aGlzLnBsdWdpbi50YXNrc1NlcnZpY2UuaXNUYXNrc0ZpbGUoZmlsZS5wYXRoKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi50YXNrc1NlcnZpY2UuaW5kZW50VGFza0xlZnQoYWN0aXZlVmlldy5lZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGNvbW1hbmQgdG8gY2hhbmdlL2dlbmVyYXRlIGNoYXQgdGl0bGVcbiAgICovXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFuZ2VDaGF0VGl0bGUoKSB7XG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjaGFuZ2UtY2hhdC10aXRsZVwiLFxuICAgICAgbmFtZTogXCJDaGFuZ2UvR2VuZXJhdGUgVGl0bGVcIixcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICAvLyBGaXJzdCBjaGVjayBpZiB3ZSdyZSBpbiBhIGNoYXQgdmlld1xuICAgICAgICBjb25zdCBjaGF0VmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKENoYXRWaWV3KTtcbiAgICAgICAgaWYgKGNoYXRWaWV3KSB7XG4gICAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9tYXRpY1RpdGxlR2VuZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIHBlcnNpc3RlbnQgbm90aWNlIGZvciBhdXRvbWF0aWMgbW9kZVxuICAgICAgICAgICAgICAgIGNvbnN0IHsgUGVyc2lzdGVudFRpdGxlTm90aWNlIH0gPSBhd2FpdCBpbXBvcnQoXCIuLi8uLi9tb2RhbHMvVGl0bGVHZW5lcmF0aW9uTW9kYWxcIik7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm90aWNlID0gbmV3IFBlcnNpc3RlbnRUaXRsZU5vdGljZSgpO1xuICAgICAgICAgICAgICAgIG5vdGljZS51cGRhdGVQcm9ncmVzcygwLCBcIkFuYWx5emluZyBjb250ZW50Li4uXCIpO1xuXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlU2VydmljZSA9IFRpdGxlR2VuZXJhdGlvblNlcnZpY2UuZ2V0SW5zdGFuY2UodGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCB0aXRsZVNlcnZpY2UuZ2VuZXJhdGVUaXRsZShcbiAgICAgICAgICAgICAgICAgICAgY2hhdFZpZXcuZ2V0TWVzc2FnZXMoKSxcbiAgICAgICAgICAgICAgICAgICAgKHRpdGxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gTm8gbmVlZCB0byB1cGRhdGUgVUkgZHVyaW5nIGdlbmVyYXRpb24gaW4gYXV0b21hdGljIG1vZGVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgKHByb2dyZXNzOiBudW1iZXIsIHN0YXR1czogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKHByb2dyZXNzLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICBpZiAodGl0bGUgJiYgdGl0bGUgIT09IGNoYXRWaWV3LmdldENoYXRUaXRsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNoYXRWaWV3LnNldFRpdGxlKHRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKDEwMCwgXCJUaXRsZSB1cGRhdGVkIVwiKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBub3RpY2U/LmhpZGUoKSwgMjAwMCk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBub3RpY2UuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyB0aXRsZTpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKDAsIGBFcnJvcjogJHtlcnJvcn1gKTtcbiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gbm90aWNlPy5oaWRlKCksIDQwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBTaG93IG1vZGFsIGluIG1hbnVhbCBtb2RlXG4gICAgICAgICAgICAgICAgY29uc3QgeyBzaG93VGl0bGVHZW5lcmF0aW9uTW9kYWwgfSA9IGF3YWl0IGltcG9ydChcIi4uLy4uL21vZGFscy9UaXRsZUdlbmVyYXRpb25Nb2RhbFwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUaXRsZSA9IGF3YWl0IHNob3dUaXRsZUdlbmVyYXRpb25Nb2RhbChcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4sXG4gICAgICAgICAgICAgICAgICBjaGF0Vmlldy5nZXRDaGF0VGl0bGUoKSxcbiAgICAgICAgICAgICAgICAgIGNoYXRWaWV3LmdldE1lc3NhZ2VzKClcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKG5ld1RpdGxlICE9PSBudWxsICYmIG5ld1RpdGxlICE9PSBjaGF0Vmlldy5nZXRDaGF0VGl0bGUoKSkge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgY2hhdFZpZXcuc2V0VGl0bGUobmV3VGl0bGUpO1xuICAgICAgICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFwiQ2hhdCB0aXRsZSB1cGRhdGVkXCIsIFwiaW5mb1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgbm90IGluIGNoYXQgdmlldywgY2hlY2sgaWYgd2UncmUgaW4gYSByZWd1bGFyIG5vdGVcbiAgICAgICAgY29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgIGlmICghYWN0aXZlRmlsZSkge1xuICAgICAgICAgIGlmICghY2hlY2tpbmcpIHtcbiAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcbiAgICAgICAgICAgICAgXCJZb3UgbmVlZCB0byBiZSB3aXRoaW4gYSBub3RlIG9yIGNoYXQgdmlldyB0byBjaGFuZ2UgdGhlIHRpdGxlLlwiLFxuICAgICAgICAgICAgICBcIndhcm5pbmdcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT25seSBhbGxvdyBmb3IgbWFya2Rvd24gZmlsZXNcbiAgICAgICAgaWYgKGFjdGl2ZUZpbGUuZXh0ZW5zaW9uICE9PSAnbWQnKSB7XG4gICAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgICAgc2hvd0VuaGFuY2VkTm90aWNlKFxuICAgICAgICAgICAgICBcIlRpdGxlIGdlbmVyYXRpb24gaXMgb25seSBhdmFpbGFibGUgZm9yIG1hcmtkb3duIGZpbGVzLlwiLFxuICAgICAgICAgICAgICBcIndhcm5pbmdcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b21hdGljVGl0bGVHZW5lcmF0aW9uKSB7XG4gICAgICAgICAgICAgIC8vIENyZWF0ZSBhIHBlcnNpc3RlbnQgbm90aWNlIGZvciBhdXRvbWF0aWMgbW9kZVxuICAgICAgICAgICAgICBjb25zdCB7IFBlcnNpc3RlbnRUaXRsZU5vdGljZSB9ID0gYXdhaXQgaW1wb3J0KFwiLi4vLi4vbW9kYWxzL1RpdGxlR2VuZXJhdGlvbk1vZGFsXCIpO1xuICAgICAgICAgICAgICBjb25zdCBub3RpY2UgPSBuZXcgUGVyc2lzdGVudFRpdGxlTm90aWNlKCk7XG4gICAgICAgICAgICAgIG5vdGljZS51cGRhdGVQcm9ncmVzcygwLCBcIkFuYWx5emluZyBjb250ZW50Li4uXCIpO1xuXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGVTZXJ2aWNlID0gVGl0bGVHZW5lcmF0aW9uU2VydmljZS5nZXRJbnN0YW5jZSh0aGlzLnBsdWdpbik7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCB0aXRsZVNlcnZpY2UuZ2VuZXJhdGVUaXRsZShcbiAgICAgICAgICAgICAgICAgIGFjdGl2ZUZpbGUsXG4gICAgICAgICAgICAgICAgICAodGl0bGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm8gbmVlZCB0byB1cGRhdGUgVUkgZHVyaW5nIGdlbmVyYXRpb24gaW4gYXV0b21hdGljIG1vZGVcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAocHJvZ3Jlc3M6IG51bWJlciwgc3RhdHVzOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbm90aWNlLnVwZGF0ZVByb2dyZXNzKHByb2dyZXNzLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGl0bGUgJiYgdGl0bGUgIT09IGFjdGl2ZUZpbGUuYmFzZW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgbmV3IHBhdGggd2l0aCB0aGUgbmV3IHRpdGxlXG4gICAgICAgICAgICAgICAgICBjb25zdCBuZXdQYXRoID0gYWN0aXZlRmlsZS5wYXRoLnJlcGxhY2UoYWN0aXZlRmlsZS5iYXNlbmFtZSwgdGl0bGUpO1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucmVuYW1lRmlsZShhY3RpdmVGaWxlLCBuZXdQYXRoKTtcbiAgICAgICAgICAgICAgICAgIG5vdGljZS51cGRhdGVQcm9ncmVzcygxMDAsIFwiVGl0bGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IG5vdGljZT8uaGlkZSgpLCAyMDAwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgbm90aWNlLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgdGl0bGU6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICBub3RpY2UudXBkYXRlUHJvZ3Jlc3MoMCwgYEVycm9yOiAke2Vycm9yfWApO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gbm90aWNlPy5oaWRlKCksIDQwMDApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTaG93IG1vZGFsIGluIG1hbnVhbCBtb2RlXG4gICAgICAgICAgICAgIGNvbnN0IHsgc2hvd1RpdGxlR2VuZXJhdGlvbk1vZGFsIH0gPSBhd2FpdCBpbXBvcnQoXCIuLi8uLi9tb2RhbHMvVGl0bGVHZW5lcmF0aW9uTW9kYWxcIik7XG4gICAgICAgICAgICAgIGNvbnN0IG5ld1RpdGxlID0gYXdhaXQgc2hvd1RpdGxlR2VuZXJhdGlvbk1vZGFsKFxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLFxuICAgICAgICAgICAgICAgIGFjdGl2ZUZpbGUuYmFzZW5hbWUsXG4gICAgICAgICAgICAgICAgYWN0aXZlRmlsZVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgIGlmIChuZXdUaXRsZSAhPT0gbnVsbCAmJiBuZXdUaXRsZSAhPT0gYWN0aXZlRmlsZS5iYXNlbmFtZSkge1xuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgbmV3IHBhdGggd2l0aCB0aGUgbmV3IHRpdGxlXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3UGF0aCA9IGFjdGl2ZUZpbGUucGF0aC5yZXBsYWNlKGFjdGl2ZUZpbGUuYmFzZW5hbWUsIG5ld1RpdGxlKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucmVuYW1lRmlsZShhY3RpdmVGaWxlLCBuZXdQYXRoKTtcbiAgICAgICAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIk5vdGUgdGl0bGUgdXBkYXRlZFwiLCBcImluZm9cIik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcmVuYW1lIGZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgIHNob3dFbmhhbmNlZE5vdGljZShcIkZhaWxlZCB0byB1cGRhdGUgbm90ZSB0aXRsZVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIiwgXCJTaGlmdFwiXSwga2V5OiBcInRcIiB9XSxcbiAgICB9KTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUsIE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsIE1hcmtkb3duVmlldywgV29ya3NwYWNlTGVhZiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgU3lzdGVtU2N1bHB0U2V0dGluZ3MgfSBmcm9tIFwiLi4vdHlwZXNcIjtcbmltcG9ydCB7IEVkaXRvciB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgVGFza3NTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgcHJpdmF0ZSBzZXR0aW5nczogU3lzdGVtU2N1bHB0U2V0dGluZ3M7XG4gIHByaXZhdGUgdGFza1RvZ2dsZVN0YXRlczogTWFwPHN0cmluZywgYm9vbGVhbj4gPSBuZXcgTWFwKCk7XG5cbiAgcHJpdmF0ZSBsYXN0VGFza0ZpbGVSZW9yZGVyOiBudW1iZXI7XG4gIHByaXZhdGUgcmVvcmRlckRlYm91bmNlOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IocHVibGljIHBsdWdpbjogU3lzdGVtU2N1bHB0UGx1Z2luKSB7XG4gICAgLy8gSW5pdGlhbGl6ZSBhcHAgYW5kIHNldHRpbmdzIGZpcnN0XG4gICAgdGhpcy5hcHAgPSBwbHVnaW4uYXBwO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBwbHVnaW4uc2V0dGluZ3M7XG5cbiAgICAvLyBUcmFjayBsYXN0IHJlb3JkZXIgdG8gcHJldmVudCBpbW1lZGlhdGUgcmUtZWRpdHMgY2F1c2luZyBpbmZpbml0ZSBsb29wczpcbiAgICB0aGlzLmxhc3RUYXNrRmlsZVJlb3JkZXIgPSAwO1xuICAgIHRoaXMucmVvcmRlckRlYm91bmNlID0gMDsgLy8gTm8gZGVsYXkgLSBwcm9jZXNzIGltbWVkaWF0ZWx5XG5cbiAgICAvLyBSZWdpc3RlciBldmVudCBmb3IgZGV0ZWN0aW5nIGNoYW5nZXMgdG8gdGhlIHRhc2tzIGZpbGU6XG4gICAgdGhpcy5yZWdpc3RlclRhc2tzRmlsZVdhdGNoZXIoKTtcbiAgICBcbiAgICAvLyBSZWdpc3RlciB3b3Jrc3BhY2UgZXZlbnRzIGZvciBoYW5kbGluZyBMaXZlIFByZXZpZXdcbiAgICB0aGlzLnJlZ2lzdGVyV29ya3NwYWNlRXZlbnRzKCk7XG5cbiAgICAvLyBSZWdpc3RlciBtZXRhZGF0YSBjaGFuZ2VzIHRvIHN5bmMgaGlkZUNvbXBsZXRlZCBzdGF0ZVxuICAgIHRoaXMucmVnaXN0ZXJNZXRhZGF0YVdhdGNoZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJXb3Jrc3BhY2VFdmVudHMoKSB7XG4gICAgLy8gSGFuZGxlIGFjdGl2ZSBsZWFmIGNoYW5nZXNcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKCdhY3RpdmUtbGVhZi1jaGFuZ2UnLCAobGVhZikgPT4ge1xuICAgICAgICBpZiAobGVhZikge1xuICAgICAgICAgIHRoaXMuaGFuZGxlTGVhZkNoYW5nZShsZWFmKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gSGFuZGxlIGxheW91dCBjaGFuZ2VzXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbignbGF5b3V0LWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLml0ZXJhdGVBbGxMZWF2ZXMobGVhZiA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVMZWFmQ2hhbmdlKGxlYWYpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIEhhbmRsZSBmaWxlIGNoYW5nZXNcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5vbignY2hhbmdlZCcsIChmaWxlKSA9PiB7XG4gICAgICAgIGlmIChmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KSkge1xuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5pdGVyYXRlQWxsTGVhdmVzKGxlYWYgPT4ge1xuICAgICAgICAgICAgaWYgKGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldyAmJiBsZWFmLnZpZXcuZmlsZT8ucGF0aCA9PT0gZmlsZS5wYXRoKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGVhZkNoYW5nZShsZWFmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVMZWFmQ2hhbmdlKGxlYWY6IFdvcmtzcGFjZUxlYWYpIHtcbiAgICBjb25zdCB2aWV3ID0gbGVhZi52aWV3O1xuICAgIGlmICghKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpKSByZXR1cm47XG4gICAgXG4gICAgY29uc3QgZmlsZSA9IHZpZXcuZmlsZTtcbiAgICBcbiAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIHRvZ2dsZXMgZnJvbSBib3RoIGVkaXRvciBhbmQgcmVhZGVyIGNvbnRhaW5lcnNcbiAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSB2aWV3LmNvbnRlbnRFbC5xdWVyeVNlbGVjdG9yKCcuY20tZWRpdG9yJyk7XG4gICAgY29uc3QgcmVhZGVyQ29udGFpbmVyID0gdmlldy5jb250ZW50RWw7XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgdG9nZ2xlcyBmcm9tIGJvdGggY29udGFpbmVycyByZWdhcmRsZXNzIG9mIGN1cnJlbnQgdmlldyBtb2RlXG4gICAgaWYgKGVkaXRvckNvbnRhaW5lcikge1xuICAgICAgZWRpdG9yQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zeXN0ZW1zY3VscHQtdGFza3MtdG9nZ2xlJykuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7XG4gICAgfVxuICAgIGlmIChyZWFkZXJDb250YWluZXIpIHtcbiAgICAgIHJlYWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuc3lzdGVtc2N1bHB0LXRhc2tzLXRvZ2dsZScpLmZvckVhY2goZWwgPT4gZWwucmVtb3ZlKCkpO1xuICAgIH1cblxuICAgIC8vIElmIG5vdCBhIHRhc2tzIGZpbGUgb3Igbm8gZmlsZSBpcyBvcGVuLCByZXR1cm4gZWFybHkgYWZ0ZXIgY2xlYW51cFxuICAgIGlmICghZmlsZSB8fCAhZmlsZS5wYXRoLnN0YXJ0c1dpdGgodGhpcy5zZXR0aW5ncy50YXNrc0RpcmVjdG9yeSkpIHJldHVybjtcblxuICAgIC8vIEdldCB0aGUgYXBwcm9wcmlhdGUgY29udGFpbmVyIGJhc2VkIG9uIGN1cnJlbnQgdmlldyBtb2RlXG4gICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IHZpZXcuZ2V0TW9kZSgpID09PSAnc291cmNlJyA/IGVkaXRvckNvbnRhaW5lciA6IHJlYWRlckNvbnRhaW5lcjtcbiAgICBpZiAoIWNvbnRlbnRDb250YWluZXIpIHJldHVybjtcblxuICAgIC8vIExvYWQgdGhlIHN0YXRlIGZyb20gZnJvbnRtYXR0ZXIgZmlyc3RcbiAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Q2FjaGUoZmlsZS5wYXRoKTtcbiAgICBjb25zdCBpc0hpZGRlbiA9IGNhY2hlPy5mcm9udG1hdHRlcj8uaGlkZUNvbXBsZXRlZCA9PT0gdHJ1ZTtcbiAgICBcbiAgICAvLyBVcGRhdGUgaW50ZXJuYWwgc3RhdGUgdG8gbWF0Y2ggZnJvbnRtYXR0ZXJcbiAgICB0aGlzLnRhc2tUb2dnbGVTdGF0ZXMuc2V0KGZpbGUucGF0aCwgaXNIaWRkZW4pO1xuXG4gICAgLy8gQ3JlYXRlIGFuZCBpbnNlcnQgdG9nZ2xlIGF0IHRoZSB0b3Agd2l0aCB0aGUgY3VycmVudCBzdGF0ZVxuICAgIGNvbnN0IHRvZ2dsZUNvbnRhaW5lciA9IHRoaXMuY3JlYXRlVG9nZ2xlQ29udGFpbmVyKGZpbGUucGF0aCwgaXNIaWRkZW4pO1xuICAgIGNvbnRlbnRDb250YWluZXIuaW5zZXJ0QmVmb3JlKHRvZ2dsZUNvbnRhaW5lciwgY29udGVudENvbnRhaW5lci5maXJzdENoaWxkKTtcblxuICAgIC8vIEFwcGx5IHRoZSB2aXNpYmlsaXR5XG4gICAgdGhpcy51cGRhdGVUYXNrVmlzaWJpbGl0eShmaWxlLnBhdGgsIGlzSGlkZGVuKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVG9nZ2xlQ29udGFpbmVyKGZpbGVQYXRoOiBzdHJpbmcsIGluaXRpYWxTdGF0ZTogYm9vbGVhbik6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCB0b2dnbGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0b2dnbGVDb250YWluZXIuY2xhc3NOYW1lID0gJ3N5c3RlbXNjdWxwdC10YXNrcy10b2dnbGUnO1xuXG4gICAgY29uc3QgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGNoZWNrYm94LnR5cGUgPSAnY2hlY2tib3gnO1xuICAgIGNoZWNrYm94LmNsYXNzTmFtZSA9ICd0YXNrLXRvZ2dsZS1jaGVja2JveCc7XG4gICAgY2hlY2tib3guY2hlY2tlZCA9IGluaXRpYWxTdGF0ZTtcblxuICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbC50ZXh0Q29udGVudCA9ICdIaWRlIGNvbXBsZXRlZCB0YXNrcyc7XG4gICAgbGFiZWwuY2xhc3NOYW1lID0gJ3Rhc2stdG9nZ2xlLWxhYmVsJztcblxuICAgIGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7XG4gICAgICBjb25zdCBpc0NoZWNrZWQgPSAoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkuY2hlY2tlZDtcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlVG9nZ2xlU3RhdGUoZmlsZVBhdGgsIGlzQ2hlY2tlZCk7XG4gICAgfSk7XG5cbiAgICB0b2dnbGVDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hlY2tib3gpO1xuICAgIHRvZ2dsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7XG5cbiAgICByZXR1cm4gdG9nZ2xlQ29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck1ldGFkYXRhV2F0Y2hlcigpOiB2b2lkIHtcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5vbignY2hhbmdlZCcsIChmaWxlKSA9PiB7XG4gICAgICAgIGlmIChmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KSkge1xuICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRDYWNoZShmaWxlLnBhdGgpO1xuICAgICAgICAgIGNvbnN0IGlzSGlkZGVuID0gY2FjaGU/LmZyb250bWF0dGVyPy5oaWRlQ29tcGxldGVkID09PSB0cnVlO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFsd2F5cyB1cGRhdGUgaW50ZXJuYWwgc3RhdGUgdG8gbWF0Y2ggZnJvbnRtYXR0ZXJcbiAgICAgICAgICB0aGlzLnRhc2tUb2dnbGVTdGF0ZXMuc2V0KGZpbGUucGF0aCwgaXNIaWRkZW4pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFVwZGF0ZSBhbnkgdmlzaWJsZSB0b2dnbGVzIGZvciB0aGlzIGZpbGVcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcyhsZWFmID0+IHtcbiAgICAgICAgICAgIGlmIChsZWFmLnZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcgJiYgbGVhZi52aWV3LmZpbGU/LnBhdGggPT09IGZpbGUucGF0aCkge1xuICAgICAgICAgICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBsZWFmLnZpZXcuY29udGVudEVsLnF1ZXJ5U2VsZWN0b3IoJy5jbS1lZGl0b3InKTtcbiAgICAgICAgICAgICAgY29uc3QgcmVhZGVyQ29udGFpbmVyID0gbGVhZi52aWV3LmNvbnRlbnRFbDtcbiAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVycyA9IFtlZGl0b3JDb250YWluZXIsIHJlYWRlckNvbnRhaW5lcl07XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBjb250YWluZXJzLmZvckVhY2goY29udGFpbmVyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB0b2dnbGUgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnRhc2stdG9nZ2xlLWNoZWNrYm94JykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgICAgICAgICAgIGlmICh0b2dnbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlLmNoZWNrZWQgPSBpc0hpZGRlbjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gVXBkYXRlIHZpc2liaWxpdHkgYWZ0ZXIgdXBkYXRpbmcgdG9nZ2xlc1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVRhc2tWaXNpYmlsaXR5KGZpbGUucGF0aCwgaXNIaWRkZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVRvZ2dsZVN0YXRlKGZpbGVQYXRoOiBzdHJpbmcsIGlzQ2hlY2tlZDogYm9vbGVhbikge1xuICAgIC8vIFVwZGF0ZSB0aGUgaW50ZXJuYWwgc3RhdGUgZmlyc3RcbiAgICB0aGlzLnRhc2tUb2dnbGVTdGF0ZXMuc2V0KGZpbGVQYXRoLCBpc0NoZWNrZWQpO1xuICAgIHRoaXMudXBkYXRlVGFza1Zpc2liaWxpdHkoZmlsZVBhdGgsIGlzQ2hlY2tlZCk7XG5cbiAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgIGNvbnN0IGhhc1lhbWxGcm9udG1hdHRlciA9IGNvbnRlbnQuc3RhcnRzV2l0aCgnLS0tXFxuJyk7XG4gICAgICBcbiAgICAgIGxldCBuZXdDb250ZW50OiBzdHJpbmc7XG4gICAgICBpZiAoaGFzWWFtbEZyb250bWF0dGVyKSB7XG4gICAgICAgIGNvbnN0IFtmcm9udG1hdHRlciwgLi4ucmVzdF0gPSBjb250ZW50LnNwbGl0KCctLS1cXG4nKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgIGNvbnN0IHlhbWxMaW5lcyA9IGZyb250bWF0dGVyLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgY29uc3QgaGlkZUNvbXBsZXRlZEluZGV4ID0geWFtbExpbmVzLmZpbmRJbmRleChsaW5lID0+IGxpbmUuc3RhcnRzV2l0aCgnaGlkZUNvbXBsZXRlZDonKSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoaGlkZUNvbXBsZXRlZEluZGV4ID49IDApIHtcbiAgICAgICAgICB5YW1sTGluZXNbaGlkZUNvbXBsZXRlZEluZGV4XSA9IGBoaWRlQ29tcGxldGVkOiAke2lzQ2hlY2tlZH1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHlhbWxMaW5lcy5wdXNoKGBoaWRlQ29tcGxldGVkOiAke2lzQ2hlY2tlZH1gKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbmV3Q29udGVudCA9IGAtLS1cXG4ke3lhbWxMaW5lcy5qb2luKCdcXG4nKX1cXG4tLS1cXG4ke3Jlc3Quam9pbignLS0tXFxuJyl9YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld0NvbnRlbnQgPSBgLS0tXFxuaGlkZUNvbXBsZXRlZDogJHtpc0NoZWNrZWR9XFxuLS0tXFxuXFxuJHtjb250ZW50fWA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSBhIHRyeS1jYXRjaCB0byBoYW5kbGUgcG90ZW50aWFsIGZpbGUgbW9kaWZpY2F0aW9uIGVycm9yc1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIG5ld0NvbnRlbnQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBoaWRlQ29tcGxldGVkIGluIGZyb250bWF0dGVyOicsIGVycm9yKTtcbiAgICAgICAgLy8gUmV2ZXJ0IHRoZSB0b2dnbGUgc3RhdGUgaWYgdGhlIGZpbGUgbW9kaWZpY2F0aW9uIGZhaWxlZFxuICAgICAgICB0aGlzLnRhc2tUb2dnbGVTdGF0ZXMuc2V0KGZpbGVQYXRoLCAhaXNDaGVja2VkKTtcbiAgICAgICAgdGhpcy51cGRhdGVUYXNrVmlzaWJpbGl0eShmaWxlUGF0aCwgIWlzQ2hlY2tlZCk7XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgdGhlIFVJIHRvZ2dsZSBiYWNrIHRvIGl0cyBwcmV2aW91cyBzdGF0ZVxuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcyhsZWFmID0+IHtcbiAgICAgICAgICBpZiAobGVhZi52aWV3IGluc3RhbmNlb2YgTWFya2Rvd25WaWV3ICYmIGxlYWYudmlldy5maWxlPy5wYXRoID09PSBmaWxlUGF0aCkge1xuICAgICAgICAgICAgY29uc3QgZWRpdG9yQ29udGFpbmVyID0gbGVhZi52aWV3LmNvbnRlbnRFbC5xdWVyeVNlbGVjdG9yKCcuY20tZWRpdG9yJyk7XG4gICAgICAgICAgICBjb25zdCByZWFkZXJDb250YWluZXIgPSBsZWFmLnZpZXcuY29udGVudEVsO1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVycyA9IFtlZGl0b3JDb250YWluZXIsIHJlYWRlckNvbnRhaW5lcl07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnRhaW5lcnMuZm9yRWFjaChjb250YWluZXIgPT4ge1xuICAgICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9nZ2xlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50YXNrLXRvZ2dsZS1jaGVja2JveCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgaWYgKHRvZ2dsZSkge1xuICAgICAgICAgICAgICAgICAgdG9nZ2xlLmNoZWNrZWQgPSAhaXNDaGVja2VkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVRhc2tWaXNpYmlsaXR5KGZpbGVQYXRoOiBzdHJpbmcsIGlzSGlkZGVuOiBib29sZWFuKSB7XG4gICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgaWYgKCFmaWxlKSByZXR1cm47XG5cbiAgICBjb25zdCBsZWF2ZXMgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKCdtYXJrZG93bicpO1xuICAgIGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcbiAgICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXcgYXMgTWFya2Rvd25WaWV3O1xuICAgICAgaWYgKHZpZXcuZmlsZT8ucGF0aCAhPT0gZmlsZS5wYXRoKSBjb250aW51ZTtcblxuICAgICAgLy8gQXBwbHkgdG8gYm90aCB0aGUgY29udGVudCBlbGVtZW50IGFuZCBhbnkgZWRpdG9yIGluc3RhbmNlc1xuICAgICAgY29uc3QgY29udGVudEVsID0gdmlldy5jb250ZW50RWw7XG4gICAgICBpZiAoaXNIaWRkZW4pIHtcbiAgICAgICAgY29udGVudEVsLmNsYXNzTGlzdC5hZGQoJ2hpZGUtY29tcGxldGVkLXRhc2tzJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50RWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZS1jb21wbGV0ZWQtdGFza3MnKTtcbiAgICAgIH1cblxuICAgICAgLy8gRm9yY2UgcmVmcmVzaCB0aGUgdmlld1xuICAgICAgaWYgKHZpZXcuZ2V0TW9kZSgpID09PSAnc291cmNlJykge1xuICAgICAgICAvLyBGb3Igc291cmNlIHZpZXcsIHRyaWdnZXIgYSByZWZyZXNoIG9mIHRoZSBlZGl0b3JcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdmlldy5lZGl0b3I7XG4gICAgICAgIGlmIChlZGl0b3IpIHtcbiAgICAgICAgICBlZGl0b3IucmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgcmVhZGluZyB2aWV3LCBmb3JjZSBhIHJlLXJlbmRlclxuICAgICAgICB2aWV3LnByZXZpZXdNb2RlPy5yZXJlbmRlcih0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuT3JDcmVhdGVUYXNrc0ZpbGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdGFza3NEaXIgPSB0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5O1xuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7dGFza3NEaXJ9L1Rhc2tzLm1kYDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2Rpcih0YXNrc0Rpcik7XG5cbiAgICAgIC8vIENyZWF0ZSBkZWZhdWx0IFRhc2tzLm1kIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgIGlmICghKGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKGZpbGVOYW1lKSkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVOYW1lLCBgIyBUYXNrc1xcblxcbi0gWyBdIFNhbXBsZSB0YXNrXFxuYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9wZW4gdGhlIGZpbGVcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZU5hbWUpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGlzIGFscmVhZHkgb3BlbiBpbiBhbnkgbGVhZlxuICAgICAgICBjb25zdCBleGlzdGluZ0xlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2VcbiAgICAgICAgICAuZ2V0TGVhdmVzT2ZUeXBlKFwibWFya2Rvd25cIilcbiAgICAgICAgICAuZmluZCgobGVhZikgPT4gbGVhZi52aWV3LmdldFN0YXRlKCkuZmlsZSA9PT0gZmlsZS5wYXRoKTtcblxuICAgICAgICBpZiAoZXhpc3RpbmdMZWFmKSB7XG4gICAgICAgICAgLy8gRm9jdXMgZXhpc3RpbmcgdGFiXG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYoZXhpc3RpbmdMZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE9wZW4gaW4gbmV3IHRhYlxuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBoYW5kbGUgdGFza3MgZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlclRhc2tzRmlsZVdhdGNoZXIoKTogdm9pZCB7XG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKFwibW9kaWZ5XCIsIGFzeW5jIChmaWxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHRhc2tzRGlyID0gdGhpcy5zZXR0aW5ncy50YXNrc0RpcmVjdG9yeTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG1vZGlmaWVkIGZpbGUgaXMgYSBtYXJrZG93biBmaWxlIHdpdGhpbiB0aGUgdGFza3MgZGlyZWN0b3J5XG4gICAgICAgIGlmIChmaWxlLnBhdGguc3RhcnRzV2l0aCh0YXNrc0RpcikgJiYgZmlsZS5wYXRoLmVuZHNXaXRoKFwiLm1kXCIpKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZW9yZGVyQ29tcGxldGVkVGFza3MoZmlsZSBhcyBURmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVvcmRlckNvbXBsZXRlZFRhc2tzKGZpbGU6IFRGaWxlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSWYgbW92aW5nIGNvbXBsZXRlZCB0YXNrcyBkb3duIGlzIGRpc2FibGVkLCBkbyBub3RoaW5nXG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLm1vdmVDb21wbGV0ZWRUYXNrc0Rvd24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTa2lwIGlmIGZpbGUgaXMgbm90IGluIHRhc2tzIGRpcmVjdG9yeVxuICAgIGlmICghZmlsZS5wYXRoLnN0YXJ0c1dpdGgodGhpcy5zZXR0aW5ncy50YXNrc0RpcmVjdG9yeSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTa2lwIGlmIG5vdCBhIG1hcmtkb3duIGZpbGVcbiAgICBpZiAoIWZpbGUucGF0aC5lbmRzV2l0aChcIi5tZFwiKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG9yaWdpbmFsID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICBjb25zdCByZW9yZGVyZWQgPSB0aGlzLnJlb3JkZXJDb250ZW50KG9yaWdpbmFsKTtcbiAgICAvLyBJZiBubyBjaGFuZ2UsIGRvIG5vdGhpbmcgdG8gcHJldmVudCBhbiBlbmRsZXNzIG1vZGlmeSBsb29wXG4gICAgaWYgKHJlb3JkZXJlZCAhPT0gb3JpZ2luYWwpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCByZW9yZGVyZWQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVvcmRlckNvbnRlbnQoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3Qgb3V0cHV0OiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBsaXN0QnVmZmVyOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgY29uc3QgZmx1c2hCdWZmZXIgPSAoKSA9PiB7XG4gICAgICBpZiAobGlzdEJ1ZmZlci5sZW5ndGggPiAwKSB7XG4gICAgICAgIG91dHB1dC5wdXNoKC4uLnRoaXMucmVvcmRlckxpc3RCbG9jayhsaXN0QnVmZmVyKSk7XG4gICAgICAgIGxpc3RCdWZmZXIgPSBbXTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAvLyBJZiB0aGUgbGluZSBpcyBhIHRhc2sgbGlzdCBpdGVtLCBhZGQgdG8gb3VyIGJ1ZmZlcjsgb3RoZXJ3aXNlIGZsdXNoIGl0LlxuICAgICAgaWYgKC9eXFxzKi1cXHMqXFxbW3hcXHNdXFxdLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgIGxpc3RCdWZmZXIucHVzaChsaW5lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZsdXNoQnVmZmVyKCk7XG4gICAgICAgIG91dHB1dC5wdXNoKGxpbmUpO1xuICAgICAgfVxuICAgIH1cbiAgICBmbHVzaEJ1ZmZlcigpO1xuICAgIHJldHVybiBvdXRwdXQuam9pbihcIlxcblwiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaXZlbiBhIGNvbnRpZ3VvdXMgYmxvY2sgb2YgdGFzayBsaW5lcywgYnVpbGQgYSB0cmVlIGJhc2VkIG9uIGluZGVudCBsZXZlbHNcbiAgICogYW5kIHRoZW4gcmVjdXJzaXZlbHkgcmVvcmRlciBlYWNoIGdyb3VwIHNvIHRoYXQgd2l0aGluIGVhY2ggZ3JvdXAsIGluY29tcGxldGVcbiAgICogdGFza3MgYXBwZWFyIGFib3ZlIGNvbXBsZXRlZCB0YXNrcyB3aGlsZSBrZWVwaW5nIG5lc3RlZCBzdWJ0YXNrcyB3aXRoIHRoZWlyIHBhcmVudC5cbiAgICovXG4gIHByaXZhdGUgcmVvcmRlckxpc3RCbG9jayhsaW5lczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgdHlwZSBUYXNrTm9kZSA9IHtcbiAgICAgIGxpbmU6IHN0cmluZztcbiAgICAgIGNoaWxkcmVuOiBUYXNrTm9kZVtdO1xuICAgICAgaW5kZW50OiBudW1iZXI7XG4gICAgfTtcblxuICAgIC8vIEhlbHBlcjogY291bnQgbGVhZGluZyB3aGl0ZXNwYWNlIChpbmRlbnRhdGlvbilcbiAgICBmdW5jdGlvbiBnZXRJbmRlbnQobGluZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKS8pO1xuICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0ubGVuZ3RoIDogMDtcbiAgICB9XG5cbiAgICAvLyBCdWlsZCB0aGUgdHJlZTogZWFjaCB0YXNrIGJlY29tZXMgYSBub2RlLCBhbmQgc3Vic2VxdWVudCBsaW5lcyB3aXRoIGdyZWF0ZXIgaW5kZW50IGJlY29tZSBpdHMgY2hpbGRyZW4uXG4gICAgY29uc3Qgbm9kZXM6IFRhc2tOb2RlW10gPSBbXTtcbiAgICBjb25zdCBzdGFjazogVGFza05vZGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBjb25zdCBpbmRlbnQgPSBnZXRJbmRlbnQobGluZSk7XG4gICAgICBjb25zdCBub2RlOiBUYXNrTm9kZSA9IHsgbGluZSwgY2hpbGRyZW46IFtdLCBpbmRlbnQgfTtcbiAgICAgIC8vIFBvcCBmcm9tIHRoZSBzdGFjayB1bnRpbCBmaW5kaW5nIGEgbm9kZSB3aXRoIGxvd2VyIGluZGVudGF0aW9uXG4gICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBpbmRlbnQgPD0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uaW5kZW50KSB7XG4gICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgfVxuICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICBzdGFjay5wdXNoKG5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWRkIGFzIGEgY2hpbGQgb2YgdGhlIG5vZGUgYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2tcbiAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgc3RhY2sucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZWN1cnNpdmVseSByZW9yZGVyIG5vZGVzIGJ5IG1vdmluZyBjb21wbGV0ZWQgdGFza3MgKHRob3NlIHdob3NlIGNoZWNrYm94IGlzIFt4XSkgYmVsb3cgaW5jb21wbGV0ZSBvbmVzLlxuICAgIGZ1bmN0aW9uIHJlb3JkZXJOb2Rlcyhub2RlczogVGFza05vZGVbXSk6IFRhc2tOb2RlW10ge1xuICAgICAgLy8gRmlyc3QsIHByb2Nlc3MgY2hpbGRyZW4gcmVjdXJzaXZlbHkuXG4gICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIG5vZGUuY2hpbGRyZW4gPSByZW9yZGVyTm9kZXMobm9kZS5jaGlsZHJlbik7XG4gICAgICAgICAgLy8gU29ydCBjaGlsZHJlbiBzbyB0aGF0IGluY29tcGxldGUgdGFza3MgY29tZSBiZWZvcmUgY29tcGxldGUgb25lcy5cbiAgICAgICAgICBub2RlLmNoaWxkcmVuLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFDb21wbGV0ZSA9IC9eXFxzKi1cXHMqXFxbeFxcXS9pLnRlc3QoYS5saW5lKSA/IDEgOiAwO1xuICAgICAgICAgICAgY29uc3QgYkNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChiLmxpbmUpID8gMSA6IDA7XG4gICAgICAgICAgICByZXR1cm4gYUNvbXBsZXRlIC0gYkNvbXBsZXRlO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBUaGVuIHNvcnQgdGhlIGN1cnJlbnQgbGV2ZWwgb2Ygbm9kZXMgc2ltaWxhcmx5LlxuICAgICAgbm9kZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCBhQ29tcGxldGUgPSAvXlxccyotXFxzKlxcW3hcXF0vaS50ZXN0KGEubGluZSkgPyAxIDogMDtcbiAgICAgICAgY29uc3QgYkNvbXBsZXRlID0gL15cXHMqLVxccypcXFt4XFxdL2kudGVzdChiLmxpbmUpID8gMSA6IDA7XG4gICAgICAgIHJldHVybiBhQ29tcGxldGUgLSBiQ29tcGxldGU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBub2RlcztcbiAgICB9XG5cbiAgICBjb25zdCByZW9yZGVyZWROb2RlcyA9IHJlb3JkZXJOb2Rlcyhub2Rlcyk7XG5cbiAgICAvLyBGbGF0dGVuIHRoZSB0cmVlIGJhY2sgdG8gYW4gYXJyYXkgb2YgbGluZXNcbiAgICBjb25zdCBmbGF0dGVuZWQ6IHN0cmluZ1tdID0gW107XG4gICAgZnVuY3Rpb24gZmxhdHRlbihub2RlczogVGFza05vZGVbXSkge1xuICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKSB7XG4gICAgICAgIGZsYXR0ZW5lZC5wdXNoKG5vZGUubGluZSk7XG4gICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmbGF0dGVuKG5vZGUuY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZsYXR0ZW4ocmVvcmRlcmVkTm9kZXMpO1xuICAgIHJldHVybiBmbGF0dGVuZWQ7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byBjaGVjayBpZiBhIGZpbGUgaXMgaW4gdGhlIHRhc2tzIGRpcmVjdG9yeVxuICAgKi9cbiAgcHVibGljIGlzVGFza3NGaWxlKGZpbGVQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmlsZVBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhc2tzRGlyZWN0b3J5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJhbmdlIG9mIGxpbmVzIHRoYXQgbWFrZSB1cCBhIHRhc2sgdHJlZSAodGhlIHRhc2sgYW5kIGFsbCBpdHMgc3VidGFza3MpXG4gICAqL1xuICBwcml2YXRlIGdldFRhc2tUcmVlUmFuZ2UoZWRpdG9yOiBFZGl0b3IsIHN0YXJ0TGluZTogbnVtYmVyKTogeyBzdGFydDogbnVtYmVyOyBlbmQ6IG51bWJlciB9IHtcbiAgICBjb25zdCBzdGFydEluZGVudCA9IHRoaXMuZ2V0SW5kZW50TGV2ZWwoZWRpdG9yLmdldExpbmUoc3RhcnRMaW5lKSk7XG4gICAgbGV0IGVuZExpbmUgPSBzdGFydExpbmU7XG4gICAgXG4gICAgLy8gTG9vayBhdCBzdWJzZXF1ZW50IGxpbmVzIHRvIGZpbmQgdGhlIGVuZCBvZiB0aGUgdHJlZVxuICAgIGZvciAobGV0IGkgPSBzdGFydExpbmUgKyAxOyBpIDwgZWRpdG9yLmxpbmVDb3VudCgpOyBpKyspIHtcbiAgICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShpKTtcbiAgICAgIGNvbnN0IGluZGVudCA9IHRoaXMuZ2V0SW5kZW50TGV2ZWwobGluZSk7XG4gICAgICBcbiAgICAgIC8vIElmIHdlIGZpbmQgYSBsaW5lIHdpdGggc2FtZSBvciBsb3dlciBpbmRlbnQsIHdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgdHJlZVxuICAgICAgaWYgKGluZGVudCA8PSBzdGFydEluZGVudCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGVuZExpbmUgPSBpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBzdGFydDogc3RhcnRMaW5lLCBlbmQ6IGVuZExpbmUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJhbmdlIG9mIHRoZSBwcmV2aW91cyB0YXNrIHRyZWUgYXQgdGhlIHNhbWUgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgZ2V0UHJldmlvdXNUYXNrVHJlZVJhbmdlKGVkaXRvcjogRWRpdG9yLCBjdXJyZW50TGluZTogbnVtYmVyLCBjdXJyZW50SW5kZW50OiBudW1iZXIpOiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyIH0gfCBudWxsIHtcbiAgICAvLyBMb29rIGJhY2t3YXJkcyBmb3IgYSB0YXNrIGF0IHRoZSBzYW1lIGxldmVsXG4gICAgZm9yIChsZXQgaSA9IGN1cnJlbnRMaW5lIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShpKTtcbiAgICAgIGNvbnN0IGluZGVudCA9IHRoaXMuZ2V0SW5kZW50TGV2ZWwobGluZSk7XG4gICAgICBcbiAgICAgIC8vIElmIHdlIGZpbmQgYSB0YXNrIGF0IHRoZSBzYW1lIGxldmVsXG4gICAgICBpZiAoaW5kZW50ID09PSBjdXJyZW50SW5kZW50ICYmIHRoaXMuaXNUYXNrTGluZShsaW5lKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRUYXNrVHJlZVJhbmdlKGVkaXRvciwgaSk7XG4gICAgICB9XG4gICAgICAvLyBJZiB3ZSBmaW5kIHNvbWV0aGluZyB3aXRoIGxvd2VyIGluZGVudCwgc3RvcCBsb29raW5nXG4gICAgICBpZiAoaW5kZW50IDwgY3VycmVudEluZGVudCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSByYW5nZSBvZiB0aGUgbmV4dCB0YXNrIHRyZWUgYXQgdGhlIHNhbWUgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgZ2V0TmV4dFRhc2tUcmVlUmFuZ2UoZWRpdG9yOiBFZGl0b3IsIGN1cnJlbnRMaW5lOiBudW1iZXIsIGN1cnJlbnRJbmRlbnQ6IG51bWJlcik6IHsgc3RhcnQ6IG51bWJlcjsgZW5kOiBudW1iZXIgfSB8IG51bGwge1xuICAgIGNvbnN0IGN1cnJlbnRUcmVlUmFuZ2UgPSB0aGlzLmdldFRhc2tUcmVlUmFuZ2UoZWRpdG9yLCBjdXJyZW50TGluZSk7XG4gICAgXG4gICAgLy8gTG9vayBmb3J3YXJkIGZyb20gdGhlIGVuZCBvZiBjdXJyZW50IHRyZWUgZm9yIGEgdGFzayBhdCB0aGUgc2FtZSBsZXZlbFxuICAgIGZvciAobGV0IGkgPSBjdXJyZW50VHJlZVJhbmdlLmVuZCArIDE7IGkgPCBlZGl0b3IubGluZUNvdW50KCk7IGkrKykge1xuICAgICAgY29uc3QgbGluZSA9IGVkaXRvci5nZXRMaW5lKGkpO1xuICAgICAgY29uc3QgaW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChsaW5lKTtcbiAgICAgIFxuICAgICAgLy8gSWYgd2UgZmluZCBhIHRhc2sgYXQgdGhlIHNhbWUgbGV2ZWxcbiAgICAgIGlmIChpbmRlbnQgPT09IGN1cnJlbnRJbmRlbnQgJiYgdGhpcy5pc1Rhc2tMaW5lKGxpbmUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRhc2tUcmVlUmFuZ2UoZWRpdG9yLCBpKTtcbiAgICAgIH1cbiAgICAgIC8vIElmIHdlIGZpbmQgc29tZXRoaW5nIHdpdGggbG93ZXIgaW5kZW50LCBzdG9wIGxvb2tpbmdcbiAgICAgIGlmIChpbmRlbnQgPCBjdXJyZW50SW5kZW50KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgY29udGVudCBvZiBhIHJhbmdlIG9mIGxpbmVzXG4gICAqL1xuICBwcml2YXRlIGdldFJhbmdlVGV4dChlZGl0b3I6IEVkaXRvciwgcmFuZ2U6IHsgc3RhcnQ6IG51bWJlcjsgZW5kOiBudW1iZXIgfSk6IHN0cmluZyB7XG4gICAgbGV0IHRleHQgPSAnJztcbiAgICBmb3IgKGxldCBpID0gcmFuZ2Uuc3RhcnQ7IGkgPD0gcmFuZ2UuZW5kOyBpKyspIHtcbiAgICAgIHRleHQgKz0gZWRpdG9yLmdldExpbmUoaSkgKyAnXFxuJztcbiAgICB9XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgY3VycmVudCB0YXNrIHRyZWUgdXBcbiAgICovXG4gIHB1YmxpYyBtb3ZlVGFza1VwKGVkaXRvcjogRWRpdG9yKTogdm9pZCB7XG4gICAgY29uc3QgY3VycmVudExpbmUgPSBlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZTtcbiAgICBjb25zdCBsaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnJlbnRMaW5lKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBjdXJyZW50IGxpbmUgaXMgYSB0YXNrXG4gICAgaWYgKCF0aGlzLmlzVGFza0xpbmUobGluZUNvbnRlbnQpKSByZXR1cm47XG4gICAgXG4gICAgLy8gQ2FuJ3QgbW92ZSB1cCBpZiB3ZSdyZSBhdCB0aGUgZmlyc3QgbGluZVxuICAgIGlmIChjdXJyZW50TGluZSA9PT0gMCkgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRJbmRlbnQgPSB0aGlzLmdldEluZGVudExldmVsKGxpbmVDb250ZW50KTtcbiAgICBjb25zdCBjdXJyZW50VHJlZVJhbmdlID0gdGhpcy5nZXRUYXNrVHJlZVJhbmdlKGVkaXRvciwgY3VycmVudExpbmUpO1xuICAgIGNvbnN0IHByZXZpb3VzVHJlZVJhbmdlID0gdGhpcy5nZXRQcmV2aW91c1Rhc2tUcmVlUmFuZ2UoZWRpdG9yLCBjdXJyZW50TGluZSwgY3VycmVudEluZGVudCk7XG4gICAgXG4gICAgaWYgKHByZXZpb3VzVHJlZVJhbmdlKSB7XG4gICAgICBjb25zdCBjdXJyZW50VHJlZVRleHQgPSB0aGlzLmdldFJhbmdlVGV4dChlZGl0b3IsIGN1cnJlbnRUcmVlUmFuZ2UpO1xuICAgICAgY29uc3QgcHJldmlvdXNUcmVlVGV4dCA9IHRoaXMuZ2V0UmFuZ2VUZXh0KGVkaXRvciwgcHJldmlvdXNUcmVlUmFuZ2UpO1xuICAgICAgXG4gICAgICBlZGl0b3IudHJhbnNhY3Rpb24oe1xuICAgICAgICBjaGFuZ2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZnJvbTogeyBsaW5lOiBwcmV2aW91c1RyZWVSYW5nZS5zdGFydCwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRvOiB7IGxpbmU6IHByZXZpb3VzVHJlZVJhbmdlLmVuZCArIDEsIGNoOiAwIH0sXG4gICAgICAgICAgICB0ZXh0OiBjdXJyZW50VHJlZVRleHRcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZyb206IHsgbGluZTogY3VycmVudFRyZWVSYW5nZS5zdGFydCwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRvOiB7IGxpbmU6IGN1cnJlbnRUcmVlUmFuZ2UuZW5kICsgMSwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRleHQ6IHByZXZpb3VzVHJlZVRleHRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBNb3ZlIHRoZSBjdXJzb3IgdXAgd2l0aCB0aGUgdGFzayB0cmVlIGFuZCB0byB0aGUgZW5kIG9mIHRoZSBsaW5lXG4gICAgICBjb25zdCBtb3ZlRGlzdGFuY2UgPSBjdXJyZW50VHJlZVJhbmdlLnN0YXJ0IC0gcHJldmlvdXNUcmVlUmFuZ2Uuc3RhcnQ7XG4gICAgICBjb25zdCBuZXdMaW5lID0gY3VycmVudExpbmUgLSBtb3ZlRGlzdGFuY2U7XG4gICAgICBjb25zdCBuZXdMaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKG5ld0xpbmUpO1xuICAgICAgZWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IG5ld0xpbmUsIGNoOiBuZXdMaW5lQ29udGVudC5sZW5ndGggfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhlIGN1cnJlbnQgdGFzayB0cmVlIGRvd25cbiAgICovXG4gIHB1YmxpYyBtb3ZlVGFza0Rvd24oZWRpdG9yOiBFZGl0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50TGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgbGluZSBpcyBhIHRhc2tcbiAgICBpZiAoIXRoaXMuaXNUYXNrTGluZShsaW5lQ29udGVudCkpIHJldHVybjtcbiAgICBcbiAgICBjb25zdCBjdXJyZW50SW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChsaW5lQ29udGVudCk7XG4gICAgY29uc3QgY3VycmVudFRyZWVSYW5nZSA9IHRoaXMuZ2V0VGFza1RyZWVSYW5nZShlZGl0b3IsIGN1cnJlbnRMaW5lKTtcbiAgICBjb25zdCBuZXh0VHJlZVJhbmdlID0gdGhpcy5nZXROZXh0VGFza1RyZWVSYW5nZShlZGl0b3IsIGN1cnJlbnRMaW5lLCBjdXJyZW50SW5kZW50KTtcbiAgICBcbiAgICBpZiAobmV4dFRyZWVSYW5nZSkge1xuICAgICAgY29uc3QgY3VycmVudFRyZWVUZXh0ID0gdGhpcy5nZXRSYW5nZVRleHQoZWRpdG9yLCBjdXJyZW50VHJlZVJhbmdlKTtcbiAgICAgIGNvbnN0IG5leHRUcmVlVGV4dCA9IHRoaXMuZ2V0UmFuZ2VUZXh0KGVkaXRvciwgbmV4dFRyZWVSYW5nZSk7XG4gICAgICBcbiAgICAgIGVkaXRvci50cmFuc2FjdGlvbih7XG4gICAgICAgIGNoYW5nZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmcm9tOiB7IGxpbmU6IGN1cnJlbnRUcmVlUmFuZ2Uuc3RhcnQsIGNoOiAwIH0sXG4gICAgICAgICAgICB0bzogeyBsaW5lOiBjdXJyZW50VHJlZVJhbmdlLmVuZCArIDEsIGNoOiAwIH0sXG4gICAgICAgICAgICB0ZXh0OiBuZXh0VHJlZVRleHRcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZyb206IHsgbGluZTogbmV4dFRyZWVSYW5nZS5zdGFydCwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRvOiB7IGxpbmU6IG5leHRUcmVlUmFuZ2UuZW5kICsgMSwgY2g6IDAgfSxcbiAgICAgICAgICAgIHRleHQ6IGN1cnJlbnRUcmVlVGV4dFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgc2l6ZSBvZiB0aGUgbmV4dCB0cmVlIHdlJ3JlIG1vdmluZyBwYXN0XG4gICAgICBjb25zdCBuZXh0VHJlZVNpemUgPSBuZXh0VHJlZVJhbmdlLmVuZCAtIG5leHRUcmVlUmFuZ2Uuc3RhcnQgKyAxO1xuICAgICAgXG4gICAgICAvLyBNb3ZlIHRoZSBjdXJzb3IgdG8gdGhlIG5ldyBwb3NpdGlvbiwgYWNjb3VudGluZyBmb3IgdGhlIHNpemUgb2YgdGhlIHRyZWUgd2UgbW92ZWQgcGFzdFxuICAgICAgY29uc3QgbmV3TGluZSA9IGN1cnJlbnRMaW5lICsgbmV4dFRyZWVTaXplO1xuICAgICAgY29uc3QgbmV3TGluZUNvbnRlbnQgPSBlZGl0b3IuZ2V0TGluZShuZXdMaW5lKTtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBuZXdMaW5lLCBjaDogbmV3TGluZUNvbnRlbnQubGVuZ3RoIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRlbnQgdGhlIGN1cnJlbnQgdGFzayBsaW5lIHJpZ2h0XG4gICAqL1xuICBwdWJsaWMgaW5kZW50VGFza1JpZ2h0KGVkaXRvcjogRWRpdG9yKTogdm9pZCB7XG4gICAgY29uc3QgY3VycmVudExpbmUgPSBlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZTtcbiAgICBjb25zdCBsaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnJlbnRMaW5lKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBjdXJyZW50IGxpbmUgaXMgYSB0YXNrXG4gICAgaWYgKCF0aGlzLmlzVGFza0xpbmUobGluZUNvbnRlbnQpKSByZXR1cm47XG4gICAgXG4gICAgLy8gQWRkIHR3byBzcGFjZXMgZm9yIGluZGVudGF0aW9uXG4gICAgZWRpdG9yLnNldExpbmUoY3VycmVudExpbmUsICcgICcgKyBsaW5lQ29udGVudCk7XG4gICAgXG4gICAgLy8gTW92ZSBjdXJzb3IgdG8gZW5kIG9mIGxpbmVcbiAgICBjb25zdCBuZXdMaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnJlbnRMaW5lKTtcbiAgICBlZGl0b3Iuc2V0Q3Vyc29yKHsgbGluZTogY3VycmVudExpbmUsIGNoOiBuZXdMaW5lQ29udGVudC5sZW5ndGggfSk7XG4gIH1cblxuICAvKipcbiAgICogSW5kZW50IHRoZSBjdXJyZW50IHRhc2sgbGluZSBsZWZ0XG4gICAqL1xuICBwdWJsaWMgaW5kZW50VGFza0xlZnQoZWRpdG9yOiBFZGl0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50TGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZWRpdG9yLmdldExpbmUoY3VycmVudExpbmUpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgbGluZSBpcyBhIHRhc2tcbiAgICBpZiAoIXRoaXMuaXNUYXNrTGluZShsaW5lQ29udGVudCkpIHJldHVybjtcbiAgICBcbiAgICBjb25zdCBjdXJyZW50SW5kZW50ID0gdGhpcy5nZXRJbmRlbnRMZXZlbChsaW5lQ29udGVudCk7XG4gICAgaWYgKGN1cnJlbnRJbmRlbnQgPj0gMikge1xuICAgICAgLy8gUmVtb3ZlIHR3byBzcGFjZXMgZnJvbSBpbmRlbnRhdGlvblxuICAgICAgZWRpdG9yLnNldExpbmUoY3VycmVudExpbmUsIGxpbmVDb250ZW50LnN1YnN0cmluZygyKSk7XG4gICAgICBcbiAgICAgIC8vIE1vdmUgY3Vyc29yIHRvIGVuZCBvZiBsaW5lXG4gICAgICBjb25zdCBuZXdMaW5lQ29udGVudCA9IGVkaXRvci5nZXRMaW5lKGN1cnJlbnRMaW5lKTtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBjdXJyZW50TGluZSwgY2g6IG5ld0xpbmVDb250ZW50Lmxlbmd0aCB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIHRvIGNoZWNrIGlmIGEgbGluZSBpcyBhIHRhc2tcbiAgICovXG4gIHByaXZhdGUgaXNUYXNrTGluZShsaW5lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gL15cXHMqLVxccypcXFtbeFxcc11cXF0vLnRlc3QobGluZSk7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIHRvIGdldCBpbmRlbnRhdGlvbiBsZXZlbCAobnVtYmVyIG9mIHNwYWNlcyBiZWZvcmUgY29udGVudClcbiAgICovXG4gIHByaXZhdGUgZ2V0SW5kZW50TGV2ZWwobGluZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goL14oXFxzKikvKTtcbiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXS5sZW5ndGggOiAwO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgU3lzdGVtU2N1bHB0TW9kZWwsIEN1c3RvbVByb3ZpZGVyLCBGYXZvcml0ZU1vZGVsIH0gZnJvbSBcIi4uL3R5cGVzL2xsbVwiO1xuaW1wb3J0IFN5c3RlbVNjdWxwdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlIH0gZnJvbSBcIi4vQ3VzdG9tUHJvdmlkZXJTZXJ2aWNlXCI7XG5cbmV4cG9ydCBjbGFzcyBNb2RlbFNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogTW9kZWxTZXJ2aWNlO1xuICBwcml2YXRlIG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGxvYWRpbmdQcm9taXNlOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbGFzdEZldGNoVGltZTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBsYXN0RGVtYW5kVGltZTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSByZWFkb25seSBDQUNIRV9EVVJBVElPTiA9IDMwICogNjAgKiAxMDAwOyAvLyAzMCBtaW51dGVzXG4gIHByaXZhdGUgcmVhZG9ubHkgREVNQU5EX1RIUkVTSE9MRCA9IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlc1xuICBwcml2YXRlIGlzQmFja2dyb3VuZFJlZnJlc2hTY2hlZHVsZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBsb2NhbFN0b3JhZ2VLZXkgPSAnc3lzdGVtc2N1bHB0LW1vZGVscy1jYWNoZSc7XG4gIHByaXZhdGUgaXNJbml0aWFsTG9hZERvbmUgPSBmYWxzZTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgcHJpdmF0ZSBjdXN0b21Qcm92aWRlclNlcnZpY2U6IEN1c3RvbVByb3ZpZGVyU2VydmljZVxuICApIHtcbiAgICAvLyBUcnkgdG8gbG9hZCBjYWNoZWQgbW9kZWxzIGZyb20gbG9jYWxTdG9yYWdlXG4gICAgdGhpcy5sb2FkQ2FjaGVkTW9kZWxzKCk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoXG4gICAgcGx1Z2luOiBTeXN0ZW1TY3VscHRQbHVnaW4sXG4gICAgY3VzdG9tUHJvdmlkZXJTZXJ2aWNlOiBDdXN0b21Qcm92aWRlclNlcnZpY2VcbiAgKSB7XG4gICAgaWYgKCF0aGlzLmluc3RhbmNlKSB7XG4gICAgICB0aGlzLmluc3RhbmNlID0gbmV3IE1vZGVsU2VydmljZShwbHVnaW4sIGN1c3RvbVByb3ZpZGVyU2VydmljZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkQ2FjaGVkTW9kZWxzKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYWNoZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLmxvY2FsU3RvcmFnZUtleSk7XG4gICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgIGNvbnN0IHsgbW9kZWxzLCB0aW1lc3RhbXAgfSA9IEpTT04ucGFyc2UoY2FjaGVkKTtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aW1lc3RhbXAgPCB0aGlzLkNBQ0hFX0RVUkFUSU9OKSB7XG4gICAgICAgICAgdGhpcy5tb2RlbHMgPSBtb2RlbHM7XG4gICAgICAgICAgdGhpcy5sYXN0RmV0Y2hUaW1lID0gdGltZXN0YW1wO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIltTeXN0ZW1TY3VscHRdIEZhaWxlZCB0byBsb2FkIG1vZGVscyBmcm9tIGNhY2hlOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzYXZlQ2FjaGVkTW9kZWxzKG1vZGVsczogU3lzdGVtU2N1bHB0TW9kZWxbXSkge1xuICAgIHRyeSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmxvY2FsU3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBtb2RlbHMsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gc2F2ZSBtb2RlbHMgdG8gY2FjaGU6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRNb2RlbHMoZm9yY2VSZWZyZXNoOiBib29sZWFuID0gZmFsc2UpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMubGFzdERlbWFuZFRpbWUgPSBub3c7XG5cbiAgICAvLyBBbHdheXMgcmV0dXJuIGNhY2hlIGltbWVkaWF0ZWx5IGlmIGF2YWlsYWJsZSwgcmVnYXJkbGVzcyBvZiBleHBpcnlcbiAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiB0aGlzLm1vZGVscykge1xuICAgICAgLy8gU2NoZWR1bGUgYmFja2dyb3VuZCByZWZyZXNoIGlmIGNhY2hlIGlzIGV4cGlyZWRcbiAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RGZXRjaFRpbWUgPj0gdGhpcy5DQUNIRV9EVVJBVElPTikge1xuICAgICAgICB0aGlzLnNjaGVkdWxlQmFja2dyb3VuZFJlZnJlc2goKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLm1vZGVscztcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gZXhpc3RpbmcgbG9hZGluZyBwcm9taXNlIGlmIG9uZSBpcyBpbiBwcm9ncmVzc1xuICAgIGlmICh0aGlzLmxvYWRpbmdQcm9taXNlICYmICFmb3JjZVJlZnJlc2gpIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRpbmdQcm9taXNlO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwiW1N5c3RlbVNjdWxwdF0gRmV0Y2hpbmcgZnJlc2ggbW9kZWxzLi4uXCIpO1xuICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSB0aGlzLmxvYWRNb2RlbHMoKS50aGVuKG1vZGVscyA9PiB7XG4gICAgICB0aGlzLm1vZGVscyA9IG1vZGVscztcbiAgICAgIHRoaXMubGFzdEZldGNoVGltZSA9IG5vdztcbiAgICAgIHRoaXMubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuICAgICAgdGhpcy5zYXZlQ2FjaGVkTW9kZWxzKG1vZGVscyk7XG4gICAgICB0aGlzLmlzSW5pdGlhbExvYWREb25lID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUubG9nKGBbU3lzdGVtU2N1bHB0XSBMb2FkZWQgJHttb2RlbHMubGVuZ3RofSBtb2RlbHNgKTtcbiAgICAgIHJldHVybiBtb2RlbHM7XG4gICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gbG9hZCBtb2RlbHM6XCIsIGVycik7XG4gICAgICB0aGlzLmxvYWRpbmdQcm9taXNlID0gbnVsbDtcbiAgICAgIGlmICh0aGlzLm1vZGVscyAmJiAhZm9yY2VSZWZyZXNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVscztcbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmxvYWRpbmdQcm9taXNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2FkTW9kZWxzKCk6IFByb21pc2U8U3lzdGVtU2N1bHB0TW9kZWxbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBMb2FkIHN5c3RlbSBtb2RlbHMgd2l0aCB0aW1lb3V0IGFuZCByZXRyeVxuICAgICAgY29uc3Qgc3lzdGVtTW9kZWxzUHJvbWlzZSA9IHRoaXMubG9hZFdpdGhSZXRyeShcbiAgICAgICAgKCkgPT4gdGhpcy5wbHVnaW4uYWlTZXJ2aWNlLmdldE1vZGVscygpLFxuICAgICAgICAzLCAvLyBtYXggcmV0cmllc1xuICAgICAgICAxMDAwIC8vIGRlbGF5IGJldHdlZW4gcmV0cmllc1xuICAgICAgKTtcblxuICAgICAgLy8gTG9hZCBjdXN0b20gcHJvdmlkZXIgbW9kZWxzIHdpdGggdGltZW91dCBhbmQgcmV0cnlcbiAgICAgIGNvbnN0IGN1c3RvbU1vZGVsc1Byb21pc2UgPSB0aGlzLmxvYWRXaXRoUmV0cnkoXG4gICAgICAgICgpID0+IHRoaXMubG9hZEN1c3RvbVByb3ZpZGVyTW9kZWxzKCksXG4gICAgICAgIDMsXG4gICAgICAgIDEwMDBcbiAgICAgICk7XG5cbiAgICAgIC8vIFdhaXQgZm9yIGJvdGggdG8gY29tcGxldGVcbiAgICAgIGNvbnN0IFtzeXN0ZW1Nb2RlbHMsIGN1c3RvbU1vZGVsc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHN5c3RlbU1vZGVsc1Byb21pc2UsXG4gICAgICAgIGN1c3RvbU1vZGVsc1Byb21pc2VcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCBhbGxNb2RlbHMgPSBbLi4uc3lzdGVtTW9kZWxzLCAuLi5jdXN0b21Nb2RlbHNdO1xuICAgICAgdGhpcy5wcm9jZXNzRmF2b3JpdGVzKGFsbE1vZGVscyk7XG5cbiAgICAgIHJldHVybiBhbGxNb2RlbHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbU3lzdGVtU2N1bHB0XSBGYWlsZWQgdG8gbG9hZCBtb2RlbHM6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZFdpdGhSZXRyeTxUPihcbiAgICBmbjogKCkgPT4gUHJvbWlzZTxUPixcbiAgICBtYXhSZXRyaWVzOiBudW1iZXIsXG4gICAgZGVsYXk6IG51bWJlclxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1heFJldHJpZXM7IGkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgICAgZm4oKSxcbiAgICAgICAgICBuZXcgUHJvbWlzZTxUPigoXywgcmVqZWN0KSA9PlxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKFwiT3BlcmF0aW9uIHRpbWVvdXRcIikpLCA1MDAwKVxuICAgICAgICAgIClcbiAgICAgICAgXSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoaSA9PT0gbWF4UmV0cmllcyAtIDEpIHRocm93IGVycm9yO1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXkpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWF4IHJldHJpZXMgZXhjZWVkZWRcIik7XG4gIH1cblxuICBwcml2YXRlIHByb2Nlc3NGYXZvcml0ZXMobW9kZWxzOiBTeXN0ZW1TY3VscHRNb2RlbFtdKTogdm9pZCB7XG4gICAgY29uc3QgZmF2b3JpdGVNb2RlbHMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyB8fCBbXTtcbiAgICBmb3IgKGNvbnN0IG1vZGVsIG9mIG1vZGVscykge1xuICAgICAgbW9kZWwuaXNGYXZvcml0ZSA9IGZhdm9yaXRlTW9kZWxzLnNvbWUoXG4gICAgICAgIGZhdiA9PiBmYXYubW9kZWxJZCA9PT0gbW9kZWwuaWQgJiYgZmF2LnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlclxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRDdXN0b21Qcm92aWRlck1vZGVscygpOiBQcm9taXNlPFN5c3RlbVNjdWxwdE1vZGVsW10+IHtcbiAgICBjb25zdCB7IGN1c3RvbVByb3ZpZGVycyB9ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG4gICAgY29uc3QgZW5hYmxlZFByb3ZpZGVycyA9IGN1c3RvbVByb3ZpZGVycy5maWx0ZXIocCA9PiBwLmlzRW5hYmxlZCk7XG5cbiAgICBpZiAoZW5hYmxlZFByb3ZpZGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBmZXRjaGVzID0gZW5hYmxlZFByb3ZpZGVycy5tYXAoYXN5bmMgcHJvdmlkZXIgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jdXN0b21Qcm92aWRlclNlcnZpY2UudGVzdENvbm5lY3Rpb24ocHJvdmlkZXIpO1xuICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0Lm1vZGVscykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUN1c3RvbU1vZGVscyhwcm92aWRlciwgcmVzdWx0Lm1vZGVscyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFtTeXN0ZW1TY3VscHRdIEZhaWxlZCB0byBsb2FkIG1vZGVscyBmcm9tICR7cHJvdmlkZXIubmFtZX06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtdO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGZldGNoZXMpO1xuICAgIHJldHVybiByZXN1bHRzLmZsYXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIFN5c3RlbVNjdWxwdE1vZGVsIG9iamVjdHMgZm9yIGEgZ2l2ZW4gY3VzdG9tIHByb3ZpZGVyLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVDdXN0b21Nb2RlbHMoXG4gICAgcHJvdmlkZXI6IEN1c3RvbVByb3ZpZGVyLFxuICAgIG1vZGVsSWRzOiBzdHJpbmdbXVxuICApOiBTeXN0ZW1TY3VscHRNb2RlbFtdIHtcbiAgICBjb25zb2xlLmxvZyhcIltTeXN0ZW1TY3VscHRdIENyZWF0aW5nIGN1c3RvbSBtb2RlbHMgZm9yIHByb3ZpZGVyOlwiLCB7XG4gICAgICBwcm92aWRlcklkOiBwcm92aWRlci5pZCxcbiAgICAgIHByb3ZpZGVyTmFtZTogcHJvdmlkZXIubmFtZSxcbiAgICAgIGVuZHBvaW50OiBwcm92aWRlci5lbmRwb2ludCxcbiAgICAgIG1vZGVsQ291bnQ6IG1vZGVsSWRzLmxlbmd0aFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsSWRzLm1hcCgobW9kZWxJZCkgPT4gKHtcbiAgICAgIGlkOiBtb2RlbElkLFxuICAgICAgbmFtZTogbW9kZWxJZCxcbiAgICAgIHByb3ZpZGVyOiBwcm92aWRlci5uYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICBpc0Zhdm9yaXRlOiBmYWxzZSxcbiAgICAgIGNvbnRleHRfbGVuZ3RoOiAwLFxuICAgICAgY2FwYWJpbGl0aWVzOiBbXSxcbiAgICAgIHByaWNpbmc6IHtcbiAgICAgICAgcHJvbXB0OiBcIjBcIixcbiAgICAgICAgY29tcGxldGlvbjogXCIwXCIsXG4gICAgICAgIGltYWdlOiBcIjBcIixcbiAgICAgICAgcmVxdWVzdDogXCIwXCIsXG4gICAgICB9LFxuICAgICAgYXJjaGl0ZWN0dXJlOiB7XG4gICAgICAgIG1vZGFsaXR5OiBcInRleHQtPnRleHRcIixcbiAgICAgICAgdG9rZW5pemVyOiBcIlwiLFxuICAgICAgICBpbnN0cnVjdF90eXBlOiBudWxsLFxuICAgICAgfSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgJHtwcm92aWRlci5uYW1lfSBtb2RlbGAsXG4gICAgICBpZGVudGlmaWVyOiB7XG4gICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLm5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgbW9kZWxJZDogbW9kZWxJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IG1vZGVsSWQsXG4gICAgICB9LFxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGUgZmF2b3JpdGUgc3RhdHVzIGZvciBhIG1vZGVsXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdG9nZ2xlRmF2b3JpdGUobW9kZWw6IFN5c3RlbVNjdWxwdE1vZGVsKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgaXNOb3dGYXZvcml0ZSA9ICFtb2RlbC5pc0Zhdm9yaXRlO1xuICAgIG1vZGVsLmlzRmF2b3JpdGUgPSBpc05vd0Zhdm9yaXRlO1xuXG4gICAgLy8gVXBkYXRlIHBsdWdpbiBzZXR0aW5nc1xuICAgIGlmIChpc05vd0Zhdm9yaXRlKSB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscy5wdXNoKHtcbiAgICAgICAgcHJvdmlkZXI6IG1vZGVsLnByb3ZpZGVyLFxuICAgICAgICBtb2RlbElkOiBtb2RlbC5pZCxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYXZvcml0ZU1vZGVscyA9XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZhdm9yaXRlTW9kZWxzLmZpbHRlcihcbiAgICAgICAgICAoZmF2KSA9PlxuICAgICAgICAgICAgIShmYXYubW9kZWxJZCA9PT0gbW9kZWwuaWQgJiYgZmF2LnByb3ZpZGVyID09PSBtb2RlbC5wcm92aWRlcilcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hNb2RlbHMoKTogUHJvbWlzZTxTeXN0ZW1TY3VscHRNb2RlbFtdPiB7XG4gICAgY29uc29sZS5sb2coXCJbU3lzdGVtU2N1bHB0XSBFeHBsaWNpdGx5IHJlZnJlc2hpbmcgbW9kZWxzXCIpO1xuICAgIHJldHVybiB0aGlzLmdldE1vZGVscyh0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgc2NoZWR1bGVCYWNrZ3JvdW5kUmVmcmVzaCgpIHtcbiAgICBpZiAodGhpcy5pc0JhY2tncm91bmRSZWZyZXNoU2NoZWR1bGVkKSByZXR1cm47XG4gICAgdGhpcy5pc0JhY2tncm91bmRSZWZyZXNoU2NoZWR1bGVkID0gdHJ1ZTtcblxuICAgIC8vIFVzZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgdG8gc2NoZWR1bGUgdGhlIHJlZnJlc2ggZm9yIHRoZSBuZXh0IGZyYW1lXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIHRoaXMuZ2V0TW9kZWxzKHRydWUpXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFwiW1N5c3RlbVNjdWxwdF0gQmFja2dyb3VuZCBtb2RlbCByZWZyZXNoIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgICB9KVxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5pc0JhY2tncm91bmRSZWZyZXNoU2NoZWR1bGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gRXhwb3NlIG1vZGVscyBmb3IgcXVpY2sgYWNjZXNzIHdpdGhvdXQgdHJpZ2dlcmluZyBhIGxvYWRcbiAgZ2V0IGNhY2hlZE1vZGVscygpOiBTeXN0ZW1TY3VscHRNb2RlbFtdIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxzO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQVVPO0FBVlA7QUFBQTtBQVVPLGlDQUEwQjtBQUFBLE1BV3ZCLFlBQW9CLEtBQVU7QUFBVjtBQUUxQiw2QkFBb0I7QUFBQTtBQUFBLGFBR1Asb0JBQW9CO0FBQ2pDLFlBQUk7QUFDRixnQkFBTSxTQUFTLGFBQWEsUUFBUSxxQkFBb0I7QUFDeEQsY0FBSSxRQUFRO0FBQ1Ysa0JBQU0sRUFBRSxPQUFPLGNBQWMsS0FBSyxNQUFNO0FBQ3hDLGdCQUFJLEtBQUssUUFBUSxZQUFZLHFCQUFvQixnQkFBZ0I7QUFDL0Qs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
